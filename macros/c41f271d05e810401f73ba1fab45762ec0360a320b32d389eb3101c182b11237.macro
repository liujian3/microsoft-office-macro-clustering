Attribute VB_Name = "Classify"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private m_Name As String
Private m_Cnt As Integer
Private m_Values() As Variant

Public Property Get Name() As Variant
    Name = m_Name
End Property

Public Property Let Name(ByVal vNewValue As Variant)
    m_Name = vNewValue
End Property

Public Property Get cnt() As Variant
    cnt = m_Cnt
End Property

Public Sub AddValue(ByVal vNewValue As Variant)
    m_Cnt = m_Cnt + 1
    ReDim Preserve m_Values(1 To m_Cnt)
    m_Values(m_Cnt) = vNewValue
End Sub

Public Property Get Values() As Variant
    Dim i As Long, j As Long
    Dim val() As Variant
    ReDim val(1 To m_Cnt, 1 To 1)
    For i = 1 To m_Cnt
        val(i, 1) = m_Values(i)
    Next i
    Values = val
End Property

Private Sub Class_Initialize()
    m_Cnt = 0
End Sub

Private Sub Class_Terminate()
    ReDim m_Values(0)
End Sub
Attribute VB_Name = "MdlTenGrp"
'=======================================================
' Graph for Sss_SRK Ver3.0 (SDSKD Ten Graph)
'
' 2008.04 WZH
'=======================================================

Option Explicit
Private Const ERR_NULLRGE As String = "The data range should not be empty"

Private Sub DrawTenBorder(ByVal rgeData As Range)
    rgeData.Borders(xlDiagonalDown).LineStyle = xlNone
    rgeData.Borders(xlDiagonalUp).LineStyle = xlNone
    With rgeData.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .colorIndex = xlAutomatic
    End With
    With rgeData.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .colorIndex = xlAutomatic
    End With
    With rgeData.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .colorIndex = xlAutomatic
    End With
    With rgeData.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .colorIndex = xlAutomatic
    End With
End Sub

Private Function ProcData(ByRef bTitle As Boolean, ByRef nCateNum As Integer, ByRef sht As Worksheet, _
                          ByRef RgeNameData As Range, ByRef RgeClsData As Range, _
                          ByRef RgeXData As Range, ByRef RgeYData As Range) As Integer
    Dim rge As Range, rgeFiltered As Range
    Dim i, j, nSmpNum As Integer
    Dim bModified As Boolean
    nSmpNum = RgeClsData.Rows.Count
    If nSmpNum < RgeXData.Rows.Count Then
        nSmpNum = RgeXData.Rows.Count
    End If
    If nSmpNum < RgeYData.Rows.Count Then
        nSmpNum = RgeYData.Rows.Count
    End If
    'Set sht = RgeClsData.Worksheet.Parent.Worksheets.Add
    'Set sht = ThisWorkbook.Worksheets("TempSht")
    Set rge = sht.Range("A1")
    rge(1, 1) = "|fffd||91||316||fffd||fffd||fffd|"
    If Not bTitle Then
        rge(1, 2) = "CLASS"
        rge(1, 3) = "X"
        rge(1, 4) = "Y"
        Set rge = rge(2, 2)
        nSmpNum = nSmpNum + 1
    End If
    If Not RgeNameData Is Nothing Then
        Call RgeNameData.Columns(1).Copy
        rge(2, 1).PasteSpecial xlPasteValues
    Else
        For i = 2 To nSmpNum
            rge(i, 1) = i - 1
        Next i
    End If
    RgeClsData.Columns(1).Copy
    rge(1, 2).PasteSpecial xlPasteValues
    RgeXData.Columns(1).Copy
    rge(1, 3).PasteSpecial xlPasteValues
    RgeYData.Columns(1).Copy
    rge(1, 4).PasteSpecial xlPasteValues
'08.11.18 add -- bgn -- : avoid "AdvancedFilter" delete 0 sample
    bModified = False
    For i = 2 To nSmpNum
        For j = 2 To 4
            If rge(i, j) = 0 Then
                rge(i, j) = 1E-32
                bModified = True
            End If
        Next j
    Next i
'08.11.18 add -- end --

    'rge(1, 6).Range("A1:C1") = ""
    'rge(2, 6).Range("A1:C1").FormulaR1C1 = "=VALUE(RC[-4])"
    rge(1, 6) = Range("B1")
    rge(2, 6).FormulaR1C1 = ">0"
    Set rge = Range(rge(1, 1), rge(nSmpNum, 4))
    rge.AdvancedFilter xlFilterCopy, sht.Range("$E$1:$F$2"), sht.Range("$J$1"), False
    Set rge = sht.Range("$J$1")
    nSmpNum = sht.Range(rge(1, 2), rge(1, 2).End(xlDown)).Rows.Count
    Set rge = sht.Range(rge, rge(nSmpNum, 1))
    Set RgeNameData = sht.Range(rge(1, 1), rge(nSmpNum, 1))
    Set RgeClsData = sht.Range(rge(1, 2), rge(nSmpNum, 2))
    Set RgeXData = sht.Range(rge(1, 3), rge(nSmpNum, 3))
    Set RgeYData = sht.Range(rge(1, 4), rge(nSmpNum, 4))
'08.11.18 add -- bgn --
    If bModified Then
        For i = 2 To nSmpNum
            For j = 2 To 4
                If rge(i, j) = 1E-32 Then
                    rge(i, j) = 0
                End If
            Next j
        Next i
    End If
'08.11.18 add -- end --
    
    bTitle = True
    nCateNum = Application.WorksheetFunction.Max(RgeClsData) - Application.WorksheetFunction.Min(RgeClsData) + 1
    If nSmpNum < 1 Then
        ProcData = -1
    Else
        ProcData = 0
    End If
End Function

#If 0 Then '12.9.15 LSQ cmt : not used (compile error for "gxlabkgraph" not defined)

Public Sub drawTenGrp(ByVal yRge As String, ByVal xRge As String, ByVal clsrge As String, _
                          ByVal outRge As String, ByVal nameRge As String, ByVal strPara As String)
    Dim i, j, k As Integer
    Dim rtn As Integer
    Dim RgeYData As Range, RgeXData As Range, RgeClsData As Range
    Dim RgeOut As Range, RgeNameData As Range, RgeCateData As Range
    Dim RgeTmp As Range
    Dim bSmpName As Boolean
    Dim bCateName As Boolean
    Dim bOutYes As Boolean
    Dim bDataTitle As Boolean, bContinue As Boolean
    Dim oRow As Integer, oCol As Integer
    Dim nSmpNum As Integer, nCateNum As Integer
    Dim strXTitle As String, strYTitle As String, strChtTitle As String
    Dim tmpSht As Worksheet
    Dim xData() As Variant, yData() As Variant
    Dim tmpVal As Double
    Dim colorIndex() As Variant
    Dim flgMarker As Integer
    Dim para As Object
    Dim grpWidth As Long, grpHeight As Long
    Dim minCateNo As Integer
    
    colorIndex() = Array(5, 7, 10, 3, 1, 45, 8, 54, 4)
    
    On Error Resume Next
redisp:

    Set RgeYData = Nothing
    Set RgeXData = Nothing
    Set RgeClsData = Nothing
    Set RgeOut = Nothing
    Set RgeNameData = Nothing
    
    If 1 Then
        Set RgeYData = Range(toXlA1str(yRge)) '07.2.9 LSQ add "toXlA1()", |fffd||209||fffd||fffd||fffd|
        Set RgeXData = Range(toXlA1str(xRge))
        Set RgeClsData = Range(toXlA1str(clsrge))
        Set RgeOut = Range(toXlA1str(outRge))
        Set para = Comm_SetDict(strPara)
        If para.exists("Marker") Then
            flgMarker = para("Marker")
        Else
            flgMarker = 0
        End If
        If para.exists("Width") Then
            grpWidth = para("Width")
        Else
            grpWidth = 0
        End If
        If para.exists("Height") Then
            grpHeight = para("Height")
        Else
            grpHeight = 0
        End If
        bDataTitle = True
        bContinue = True
        
        '09.1.29 LSQ add
        If para.exists("ChartTitle") Then
            strChtTitle = para("ChartTitle")
        Else
            strChtTitle = ""
        End If
        'end
        
        If para.exists("SmpName") Then
            bSmpName = (para("SmpName") = 1)
        Else
            bSmpName = True
        End If
        If bSmpName Then
            Set RgeNameData = Range(toXlA1str(nameRge))
        End If
        If para.exists("CateName") Then
            bCateName = (para("CateName") = 1)
        Else
            bCateName = False
        End If
        If bCateName Then
            If para.exists("CateRange") Then
                Set RgeCateData = Range(toXlA1str(para("CateRange")))
                If RgeCateData Is Nothing Then
                    bCateName = False
                End If
            Else
                bCateName = False
            End If
        End If
        
        bOutYes = False
        
        nSmpNum = RgeXData.Rows.Count - 1
        
        If Err.Number <> 0 Then
            Exit Sub
        End If
        
        Set tmpSht = RgeOut.Worksheet.Parent.Worksheets.Add
        
        rtn = ProcData(bDataTitle, nCateNum, tmpSht, RgeNameData, RgeClsData, RgeXData, RgeYData)
        If rtn < 0 Then Exit Sub
        
        Application.ScreenUpdating = False
        RgeOut.Worksheet.Activate
        RgeOut.Select
        oRow = 1
        oCol = 1
        RgeOut(oRow, oCol).Resize(nSmpNum + 2, nCateNum + 3).ClearContents
        RgeOut(oRow, oCol) = "|fffd|O|fffd||fffd||fffd|t|fffd|p|fffd|f|fffd|[|fffd|^"
        oRow = oRow + 1
        RgeOut(oRow, oCol) = "|fffd||91||316||fffd||fffd||fffd|"
        If bDataTitle Then
            RgeOut(oRow, oCol + 1) = RgeXData(1, 1)
            strXTitle = RgeXData(1, 1).Text
            strYTitle = RgeYData(1, 1).Text
            Set RgeXData = Range(RgeXData(2, 1), RgeXData(nSmpNum + 1, 1))
            Set RgeYData = Range(RgeYData(2, 1), RgeYData(nSmpNum + 1, 1))
            Set RgeClsData = Range(RgeClsData(2, 1), RgeClsData(nSmpNum + 1, 1))
            Set RgeNameData = Range(RgeNameData(2, 1), RgeNameData(nSmpNum + 1, 1))
            'nSmpNum = nSmpNum - 1
        Else
            RgeOut(oRow, oCol + 1) = "X"
            strXTitle = "X"
            strYTitle = "Y"
        End If
        minCateNo = Application.WorksheetFunction.Min(RgeClsData)
        If bCateName Then
            For i = 1 To nCateNum
                RgeOut(oRow, oCol + i + 1) = RgeCateData(i, 1)
            Next i
        Else
            For i = 1 To nCateNum
                RgeOut(oRow, oCol + i + 1) = minCateNo + i - 1
            Next i
        End If
        'oRow = oRow + 1
        For i = 1 To nSmpNum
            If bSmpName Then
                RgeOut(oRow + i, oCol) = RgeNameData(i, 1)
            Else
                RgeOut(oRow + i, oCol) = i
            End If
            RgeOut(oRow + i, oCol + 1) = RgeXData(i, 1)
            RgeOut(oRow + i, oCol + val(RgeClsData(i, 1).Value) - minCateNo + 1 + 1) = RgeYData(i, 1)
        Next i
        Set RgeTmp = Range(RgeOut(2, 1), RgeOut(nSmpNum + 2, nCateNum + 2))
        For i = 1 To nCateNum + 2
            Call DrawTenBorder(RgeTmp.Columns(i))
            Call DrawTenBorder(RgeTmp(1, i))
        Next i
        Set RgeTmp = Range(RgeOut(3, 2), RgeOut(nSmpNum + 2, nCateNum + 2))
        'ThisWorkbook.Worksheets("tmplTenGrp").ChartObjects("grpTen").Copy
        Workbooks(gxlabkgraph).Worksheets("tmplTenGrp").ChartObjects("grpTen").Copy
        RgeOut.Worksheet.Activate
        RgeOut(1, 1).Select
        ActiveSheet.Paste
        Call ActiveChart.SetSourceData(RgeTmp)
        For i = 1 To nCateNum
            'ActiveChart.SeriesCollection(i).XValues = "='" & RgeTmp.Worksheet.Name & "'!" & toXlRCstr(RgeTmp.Columns(1).Address)
            'ActiveChart.SeriesCollection(i).Values = "='" & RgeTmp.Worksheet.Name & "'!" & toXlRCstr(RgeTmp.Columns(i + 1).Address)
            ActiveChart.SeriesCollection(i).Name = "='" & RgeTmp.Worksheet.Name & "'!" & Comm_toXlRCstr(RgeOut(2, i + 2).Address)
        Next i
        ActiveChart.Axes(xlValue).HasTitle = True
        ActiveChart.Axes(xlCategory).HasTitle = True
        ActiveChart.Axes(xlValue).AxisTitle.Characters.Text = strYTitle
        ActiveChart.Axes(xlCategory).AxisTitle.Characters.Text = strXTitle
        ActiveChart.Axes(xlValue).AxisTitle.Orientation = xlHorizontal
        ActiveChart.Axes(xlValue).AxisTitle.Top = 6
        If strChtTitle <> "" Then '09.1.29 LSQ add : graph title
            ActiveChart.chartTitle.Characters.Text = strChtTitle
        End If
        
        If Not bSmpName Then
            For i = 1 To nCateNum
                ActiveChart.SeriesCollection(i).ApplyDataLabels Type:=xlDataLabelsShowNone, LegendKey:=False
            Next i
        Else
            For i = 1 To nCateNum
                ActiveChart.SeriesCollection(i).ApplyDataLabels Type:=xlDataLabelsShowLabel, LegendKey:=False
                For j = 1 To ActiveChart.SeriesCollection(i).Points.Count
                    If ActiveChart.SeriesCollection(i).Points(j).HasDataLabel Then
                        ActiveChart.SeriesCollection(i).Points(j).DataLabel.Text = RgeNameData(j, 1)
                    End If
                Next j
            Next i
        End If
        For i = 1 To nCateNum
            With ActiveChart.SeriesCollection(i)
                .MarkerBackgroundColorIndex = colorIndex((i - 1) Mod 9)
                .MarkerForegroundColorIndex = .MarkerBackgroundColorIndex
                If flgMarker = 0 Then
                .MarkerStyle = IIf(i = 1, xlCircle, xlDiamond)  '08.12.29 LSQ mdf
                Else
                .MarkerStyle = IIf(flgMarker = 1, xlCircle, xlDiamond)
                .MarkerBackgroundColorIndex = colorIndex((flgMarker - 1) Mod 9)
                .MarkerForegroundColorIndex = .MarkerBackgroundColorIndex
                End If
                .Smooth = False
                .MarkerSize = 6
                .Shadow = False
                .Border.LineStyle = xlNone
            End With
        Next i
        Call Comm_setChartPosSize(ActiveChart.Parent, RgeOut(1, 1), grpHeight, grpWidth)
        ActiveChart.ChartArea.Select
        Call Comm_MatchWorkbookFont
        ActiveChart.HasLegend = False
        If para.exists("HasLegend") Then
            ActiveChart.HasLegend = (para("HasLegend") = 1)
            If ActiveChart.HasLegend Then
                ActiveChart.Legend.Border.colorIndex = 1
            End If
        End If
        If bOutYes Then
            Set RgeTmp = RgeOut.Worksheet.Cells(ActiveChart.Parent.BottomRightCell.Row + 1, ActiveChart.Parent.TopLeftCell.Column)
            RgeTmp(1, 1) = "|fffd||fffd||fffd|P|fffd||fffd||fffd||58c|W|fffd||fffd|"
            Set RgeTmp = RgeTmp(2, 1)
            For i = 1 To nCateNum
                RgeTmp(i, 1) = RgeOut(2, i + 2)
                k = 0
                For j = 1 To nSmpNum
                    If val(RgeClsData(j, 1)) = i Then
                        k = k + 1
                        ReDim Preserve xData(1 To k)
                        ReDim Preserve yData(1 To k)
                        xData(k) = RgeXData(j, 1)
                        yData(k) = RgeYData(j, 1)
                    End If
                Next j
                tmpVal = Application.WorksheetFunction.Correl(xData, yData)
                RgeTmp(i, 2) = tmpVal
            Next i
            RgeTmp(nCateNum + 1, 1) = "|fffd|S|fffd||fffd|"
            RgeTmp(nCateNum + 1, 2) = Application.WorksheetFunction.Correl(RgeXData, RgeYData)
            Call DrawTenBorder(Range(RgeTmp(1, 1), RgeTmp(nCateNum, 1)))
            Call DrawTenBorder(Range(RgeTmp(1, 2), RgeTmp(nCateNum, 2)))
            Call DrawTenBorder(RgeTmp(nCateNum + 1, 1))
            Call DrawTenBorder(RgeTmp(nCateNum + 1, 2))
        End If
        Application.DisplayAlerts = False
        tmpSht.Delete
        Application.DisplayAlerts = True
        RgeOut.Select
    End If
    Set para = Nothing
    On Error GoTo 0
End Sub

#End If '12.9.15

'=== EOF ===


Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "mdlCommGrp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' Common Functions
' 2007.01 WZH
'=======================================================

Option Explicit

#If 0 Then '--- moved : 07.2.7 ---
Sub SetDataLabel(ByVal ser As Series, ByVal nameRge As Range, _
                 Optional ByVal fontsize As Integer = 10, _
                 Optional ByVal charcnt As Integer = 32)
    Dim i As Integer
    On Error Resume Next
    ser.ApplyDataLabels Type:= _
            xlDataLabelsShowLabel, AutoText:=True, LegendKey:=False
    ser.DataLabels.Font.Size = fontsize
    For i = 1 To ser.Points.Count
        If getExcelVerNo() < 12 Then
            ser.Points(i).DataLabel.Characters.Text = MidB(nameRge.Range("A1").Offset(i - 1, 0).Value, 1, charcnt)
        Else
            ser.Points(i).DataLabel.Text = MidB(nameRge.Range("A1").Offset(i - 1, 0).Value, 1, charcnt)
        End If
    Next i
    On Error GoTo 0
End Sub

Function SetDict(ByVal strPara As String) As Object
    Dim arys() As String, subarys() As String
    Dim s As String
    Dim i As Integer, j As Integer
    Dim dict As Object
    arys = Split(strPara, "&")
    Set dict = CreateObject("Scripting.dictionary")
    For i = 0 To UBound(arys)
        subarys = Split(arys(i), "=")
        dict(subarys(0)) = subarys(1)
    Next i
    i = 1
    Set SetDict = dict
    Set dict = Nothing
End Function
#End If '--- moved : 07.2.7 ---

Sub SetTicks(ByVal cht As Chart, ByVal strTicks As String)
    Dim i As Integer, j As Integer
    Dim Ticks() As String
    Dim bRevStatus As Boolean
    Dim xSeries As Series
    Dim CateCnt As Integer
    Dim CateNum As Integer
    Dim cates() As Integer
    Dim MaxScale As Double, MinScale As Double
    Dim bScreenUpdating As Boolean
    On Error Resume Next
    bScreenUpdating = Application.ScreenUpdating
    Application.ScreenUpdating = False
    bRevStatus = cht.Axes(xlCategory).ReversePlotOrder
    If bRevStatus Then
        cht.Axes(xlCategory).ReversePlotOrder = False
        strTicks = StrReverse(strTicks)
    End If
    Ticks = Split(strTicks, ",")
    CateNum = 0
    CateCnt = UBound(Ticks)
    ReDim cates(1 To CateCnt)
    For i = 1 To CateCnt
        CateNum = CateNum + CInt(Ticks(i - 1))
        cates(i) = CInt(Ticks(i - 1))
        For j = 1 To i - 1
            cates(i) = cates(i) + CInt(Ticks(j - 1))
        Next j
    Next i
    CateNum = CateNum + CInt(Ticks(CateCnt))
    Set xSeries = cht.SeriesCollection.NewSeries
    xSeries.Name = "tick1"
    xSeries.ChartType = xlXYScatterLinesNoMarkers
    cht.Axes(xlValue, xlSecondary).MinimumScale = 0
    cht.Axes(xlValue, xlSecondary).MaximumScale = CateNum
    cht.Axes(xlValue, xlSecondary).MinorUnitIsAuto = True
    cht.Axes(xlValue, xlSecondary).MajorUnit = 1
    MaxScale = cht.Axes(xlValue, xlPrimary).MaximumScale
    MinScale = cht.Axes(xlValue, xlPrimary).MinimumScale
    cht.Axes(xlValue, xlPrimary).MaximumScaleIsAuto = False
    cht.Axes(xlValue, xlPrimary).MinimumScaleIsAuto = False
    cht.Axes(xlCategory, xlSecondary).MinimumScale = MinScale
    cht.Axes(xlCategory, xlSecondary).MaximumScale = MaxScale
    xSeries.XValues = "={" & MinScale & "," & MaxScale & "}"
    xSeries.Values = "={" & cates(1) & "," & cates(1) & "}"
    xSeries.Border.colorIndex = 1
    xSeries.Border.LineStyle = xlDot
    xSeries.Border.Weight = xlThin
    xSeries.MarkerStyle = xlNone
    For i = 2 To CateCnt
        Set xSeries = cht.SeriesCollection.NewSeries
        xSeries.ChartType = xlXYScatterLinesNoMarkers
        xSeries.Name = "tick" & i
        xSeries.XValues = "={" & MinScale & "," & MaxScale & "}"
        xSeries.Values = "={" & cates(i) & "," & cates(i) & "}"
        xSeries.Border.colorIndex = 1
        xSeries.Border.LineStyle = xlDot
        xSeries.Border.Weight = xlThin
        xSeries.MarkerStyle = xlNone
    Next i
    
    cht.Axes(xlValue, xlSecondary).Delete
    cht.Axes(xlCategory, xlSecondary).Delete
    cht.Axes(xlCategory).Select
    cht.Axes(xlCategory).ReversePlotOrder = bRevStatus
    cht.Axes(xlValue).MinimumScale = MinScale
    cht.Axes(xlValue).MaximumScale = MaxScale
    Application.ScreenUpdating = bScreenUpdating
    On Error GoTo 0
End Sub

Attribute VB_Name = "mdlCommPub"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' Common Public
' 2007.1.29 LSQ
'=======================================================
Option Explicit
Option Private Module

'prefix = 'G' : means public used in this file
Public GrgeStr As String
Public GbkName As String
Public GstName As String
Public GrgStr As String

'=== EOF ===

Attribute VB_Name = "mdlDotPlot"
'=======================================================
' Graph for SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_ (DotPlot)
'
' 2008.12.23 WZH
'=======================================================
Option Explicit

Private Const MAXITEMNUM As Integer = 20
Private Const maxCateNum As Integer = 200
Private Const MINCLSSMPNUM As Integer = 2

Private Const ERR_NULLOUT As String = "The output range should not be empty"
Private Const ERR_OVERITEMNUM As String = "The count of items is over "
Private Const ERR_OVERCATENUM As String = "The count of categories is over "
Private Const ERR_NUMDATA As String = "Non-numeric data exists"
Private Const ERR_CLSSMPNUM As String = "The number of sample in each class should be at least "

Type DotPlot_T
    rgeClass As Range
    rgeItem As Range
    RgeOut As Range
    bNewSheet As Boolean
    typeForNoData As Integer
    typeForOut As Integer
    dataMKSize As Integer
    avgMKSize As Integer
    medMKSize As Integer
    typeStdev As Integer
    UniqueCount As Collection
    maxClsCnt As Integer
    minClsCnt As Integer
End Type

Private Function CollectionSort(ByRef oCollection As Collection, Optional bSortAscending As Boolean = True) As Long
    Dim lSort1 As Long, lSort2 As Long
    Dim vTempItem1 As Variant, vTempItem2 As Variant, bSwap As Boolean
    
    On Error GoTo ErrFailed
    For lSort1 = 1 To oCollection.Count - 1
        For lSort2 = lSort1 + 1 To oCollection.Count
            If bSortAscending Then
                If oCollection(lSort1).Name > oCollection(lSort2).Name Then
                    bSwap = True
                Else
                    bSwap = False
                End If
            Else
                If oCollection(lSort1).Name < oCollection(lSort2).Name Then
                    bSwap = True
                Else
                    bSwap = False
                End If
            End If
            If bSwap Then
                'Store the items
                If VarType(oCollection(lSort1)) = vbObject Then
                    Set vTempItem1 = oCollection(lSort1)
                Else
                    vTempItem1 = oCollection(lSort1)
                End If
                
                If VarType(oCollection(lSort2)) = vbObject Then
                    Set vTempItem2 = oCollection(lSort2)
                Else
                    vTempItem2 = oCollection(lSort2)
                End If
                
                'Swap the items over
                oCollection.Add vTempItem1, , lSort2
                oCollection.Add vTempItem2, , lSort1
                'Delete the original items
                oCollection.Remove lSort1 + 1
                oCollection.Remove lSort2 + 1
            End If
        Next
    Next
    Exit Function

ErrFailed:
    CollectionSort = Err.Number
    On Error GoTo 0
End Function

Private Sub SetRangeBorder(ByVal rge As Range, _
                           ByVal wtLeft As XlBorderWeight, ByVal wtTop As XlBorderWeight, _
                           ByVal wtRight As XlBorderWeight, ByVal wtBottom As XlBorderWeight)
    rge.Borders(xlEdgeTop).Weight = wtTop
    rge.Borders(xlEdgeLeft).Weight = wtLeft
    rge.Borders(xlEdgeBottom).Weight = wtBottom
    rge.Borders(xlEdgeRight).Weight = wtRight
End Sub

'process nonumeric data
Private Sub ProcNoNumeric(ByVal flg As Integer, ByVal rowCnt As Integer, ByVal colcnt As Integer, data As Variant)
    Dim i As Integer, j As Integer
    Dim mdfFlg As Boolean
    For i = 1 To rowCnt
        mdfFlg = False
        For j = 1 To colcnt
            If Not IsNumeric(data(i, j)) Then
                If flg = 1 Then
                    data(i, j) = ""
                Else
                    mdfFlg = True
                    Exit For
                End If
            End If
        Next j
        If mdfFlg Then
            For j = 1 To colcnt
                data(i, j) = ""
            Next j
        End If
    Next i
End Sub

'get category count
Private Function GetUniqueCount(dotPlot As DotPlot_T) As Integer
    Dim rgeClass As Range, rge As Range
    Dim r As Range, o As Range
    Dim t As Integer
    Dim tt As Classify
    Dim maxCnt  As Long, minCnt  As Long
    Dim i As Integer
    
    Set rgeClass = dotPlot.rgeClass
    
    Application.Volatile
    On Error Resume Next
    Set rge = Range(rgeClass(2, 1), rgeClass(rgeClass.Rows.Count, rgeClass.Columns.Count))
    For Each r In rge
        If Trim(CStr(r.Value)) <> vbNullString Then
            Set tt = dotPlot.UniqueCount.Item(CStr(r.Value))
            If tt Is Nothing Then
                Set tt = New Classify
                tt.Name = r.Value
                Call tt.AddValue(CInt(r.Row - rge.Row + 1))
                dotPlot.UniqueCount.Add tt, CStr(r.Value)
            Else
                Call tt.AddValue(CInt(r.Row - rge.Row + 1))
            End If
            Set tt = Nothing
        End If
    Next
    
    minCnt = dotPlot.UniqueCount(1).cnt
    maxCnt = minCnt
    For i = 2 To dotPlot.UniqueCount.Count
        Set tt = dotPlot.UniqueCount(i)
        If tt.cnt > maxCnt Then maxCnt = tt.cnt
        If tt.cnt < minCnt Then minCnt = tt.cnt
    Next i
    
    dotPlot.maxClsCnt = maxCnt
    dotPlot.minClsCnt = minCnt
    GetUniqueCount = dotPlot.UniqueCount.Count
    Call CollectionSort(dotPlot.UniqueCount)
    On Error GoTo 0
End Function

'check input
Private Function checkData(dotPlot As DotPlot_T) As Boolean
    Dim itemnum As Integer, SmpNum As Integer, minClsCnt As Integer
    Dim newSht As Worksheet
    Dim rge As Range
    If dotPlot.rgeItem Is Nothing Then
       checkData = False
       Exit Function
    End If
    itemnum = dotPlot.rgeItem.Columns.Count
    SmpNum = dotPlot.rgeItem.Rows.Count
    If itemnum > MAXITEMNUM Then
        checkData = False
        Call MsgBox(ERR_OVERITEMNUM & MAXITEMNUM, vbCritical, "Error")
        Exit Function
    End If
    
    Set rge = Range(dotPlot.rgeItem(2, 1), dotPlot.rgeItem(SmpNum, itemnum))
    If dotPlot.typeForNoData = 3 Then
        If Application.WorksheetFunction.Count(rge) <> rge.Rows.Count * rge.Columns.Count Then
            checkData = False
            Call MsgBox(ERR_NUMDATA, vbCritical, "Error")
            Exit Function
        End If
    End If
    If dotPlot.bNewSheet Then
        Set newSht = dotPlot.rgeItem.Worksheet.Parent.Worksheets.Add
        Set dotPlot.RgeOut = newSht.Range("A1")
    ElseIf dotPlot.RgeOut Is Nothing Then
        checkData = False
        Call MsgBox(ERR_NULLOUT, vbCritical, "Error")
        Exit Function
    End If
    If Not dotPlot.rgeClass Is Nothing Then
        Set dotPlot.UniqueCount = New Collection
        itemnum = GetUniqueCount(dotPlot)
        minClsCnt = dotPlot.minClsCnt
        If itemnum > maxCateNum Or minClsCnt < 2 Then
            If dotPlot.bNewSheet Then
                Application.DisplayAlerts = False
                dotPlot.RgeOut.Worksheet.Delete
                dotPlot.rgeItem.Cells(1, 1).Select
                Application.DisplayAlerts = True
            End If
            Set dotPlot.UniqueCount = Nothing
            checkData = False
            If itemnum > maxCateNum Then
                Call MsgBox(ERR_OVERCATENUM & maxCateNum, vbCritical, "Error")
            Else
                Call MsgBox(ERR_CLSSMPNUM & MINCLSSMPNUM, vbCritical, "Error")
            End If
            Exit Function
        End If
    End If
    checkData = True
End Function

'modify series marker
Private Sub SetMarkers(ByVal cht As Chart, dotPlot As DotPlot_T)
    Dim i As Integer, serCnt As Integer, mkCnt As Integer
    Dim ser As Series
    On Error Resume Next
    serCnt = cht.SeriesCollection.Count
    'mkCnt = IIf(dotPlot.typeForOut = 1, 2, IIf(dotPlot.typeForOut = 2, 1, 0))
    For i = 1 To serCnt
        Set ser = cht.SeriesCollection.Item(i)
        If i <= serCnt Then
            ser.MarkerSize = dotPlot.dataMKSize
            ser.Border.LineStyle = xlNone
            With ser
                .MarkerBackgroundColorIndex = 1
                .MarkerForegroundColorIndex = 1
                .MarkerStyle = xlDiamond
                .MarkerSize = 6
                .Border.LineStyle = xlNone
            End With
        Else
            With ser
                .MarkerBackgroundColorIndex = IIf(i = serCnt, 5, 3)
                .MarkerForegroundColorIndex = IIf(i = serCnt, 5, 3)
                .MarkerStyle = xlDiamond
                .MarkerSize = IIf(i = serCnt, dotPlot.medMKSize, dotPlot.avgMKSize)
                .Border.LineStyle = xlNone
            End With
        End If
    Next i
    'For i = 0 To mkCnt - 1
    '    Set ser = cht.SeriesCollection.Item(serCnt - i)
    '    ser.Delete
    'Next i
    On Error GoTo 0
End Sub

Private Function subDotPlot(dotPlot As DotPlot_T) As Range
    If dotPlot.rgeClass Is Nothing Then
        Set subDotPlot = doNoClass(dotPlot)
    Else
        Set subDotPlot = doWithClass(dotPlot)
    End If
End Function

'procedure for data without class item
Private Function doNoClass(dotPlot As DotPlot_T) As Range
    Dim RgeOut As Range, rgeItem As Range
    Dim rge As Range, o As Range, r As Range
    Dim i As Long, j As Long, k As Long
    Dim itemCnt As Long, smpCnt As Long
    Dim data As Variant, itemData As Variant
    
    Set RgeOut = dotPlot.RgeOut
    Set rgeItem = dotPlot.rgeItem
    Set rge = rgeItem.Rows(1)
    Set rgeItem = rgeItem.Worksheet.Range(rgeItem(2, 1), rgeItem(rgeItem.Rows.Count, rgeItem.Columns.Count))
    itemCnt = rgeItem.Columns.Count
    smpCnt = rgeItem.Rows.Count

    itemData = rgeItem.Value
    Call ProcNoNumeric(dotPlot.typeForNoData, smpCnt, itemCnt, itemData)
    
    'RgeOut.Offset(1, 0).Value = "|fffd|f|fffd|[|fffd|^"
    'RgeOut.Offset(smpCnt + 1, 0).Value = "|fffd||fffd||fffd||3d2|l"
    'RgeOut.Offset(smpCnt + 2, 0).Value = "|fffd||fffd||fffd||fffd||fffd|l"
    'RgeOut.Offset(smpCnt + 3, 0).Value = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
    'RgeOut.Offset(smpCnt + 4, 0).Value = "n"
    For i = 1 To itemCnt
        RgeOut.Offset(0, i).Value = rge.Cells(1, i).Value '"Item" & i
        data = rgeItem.Columns(i).Value
        For j = 1 To smpCnt
            data(j, 1) = itemData(j, i)
        Next j
        Range(RgeOut, RgeOut.Offset(smpCnt - 1)).Offset(1, i).Value = data
        'RgeOut.Offset(smpCnt + 1, i).Value = Application.WorksheetFunction.Average(data)
        'RgeOut.Offset(smpCnt + 2, i).Value = Application.WorksheetFunction.Median(data)
        'If dotPlot.typeStdev = 1 Then
        '    RgeOut.Offset(smpCnt + 3, i).Value = Application.WorksheetFunction.StDev(data)
        'Else
        '    RgeOut.Offset(smpCnt + 3, i).Value = Application.WorksheetFunction.StDevP(data)
        'End If
        'RgeOut.Offset(smpCnt + 4, i).Value = Application.WorksheetFunction.Count(data)
        Call SetRangeBorder(RgeOut.Offset(0, i), xlHairline, xlThin, xlHairline, xlThin)
        Call SetRangeBorder(Range(RgeOut.Offset(1, i), RgeOut.Offset(smpCnt, i)), xlHairline, xlThin, xlHairline, xlThin)
        'Call SetRangeBorder(Range(RgeOut.Offset(smpCnt + 1, i), RgeOut.Offset(smpCnt + 4, i)), xlHairline, xlThin, xlHairline, xlThin)
    Next i
    Set doNoClass = Range(RgeOut, RgeOut.Offset(smpCnt, itemCnt))
    Call SetRangeBorder(RgeOut, xlThick, xlThick, xlThin, xlThin)
    'Call SetRangeBorder(Range(RgeOut.Offset(1, 0), RgeOut.Offset(smpCnt, 0)), xlThin, xlThin, xlThin, xlThin)
    'Call SetRangeBorder(Range(RgeOut.Offset(smpCnt + 1, 0), RgeOut.Offset(smpCnt + 4, 0)), xlThin, xlThin, xlThin, xlThin)
    Call SetRangeBorder(doNoClass, xlThick, xlThick, xlThick, xlThick)
End Function

'10.09.27 DZH cmt
'procedure for data with class item
#If 0 Then
Private Function doWithClass(dotPlot As DotPlot_T) As Range
    Dim RgeOut As Range, rgeItem As Range, rgeName As Range
    Dim rge As Range
    Dim r As Range, o As Range
    Dim t As Integer
    Dim tt As Classify, dd As Classify
    Dim val As Variant, data As Variant
    Dim maxCnt As Long
    Dim i As Long, m As Long, k As Long
    
    Set RgeOut = dotPlot.RgeOut
    Set rgeItem = dotPlot.rgeItem
    Set rgeName = rgeItem.Rows(1)
    
    maxCnt = dotPlot.maxClsCnt
    
    Set rge = rgeItem.Worksheet.Range(rgeItem(2, 1), rgeItem(rgeItem.Rows.Count, rgeItem.Columns.Count))
    
    Set o = RgeOut
    'o.Offset(2, 0).Value = "|fffd|f|fffd|[|fffd|^"
    'o.Offset(maxCnt + 2, 0).Value = "|fffd||fffd||fffd||3d2|l"
    'o.Offset(maxCnt + 3, 0).Value = "|fffd||fffd||fffd||fffd||fffd|l"
    'o.Offset(maxCnt + 4, 0).Value = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
    'o.Offset(maxCnt + 5, 0).Value = "n"
    data = rge.Value
    Call ProcNoNumeric(dotPlot.typeForNoData, rge.Rows.Count, rge.Columns.Count, data)
    
    'Call SetRangeBorder(Range(o.Offset(2, 0), o.Offset(maxCnt + 1, 0)), xlThin, xlThin, xlThin, xlThin)
    'Call SetRangeBorder(Range(o.Offset(maxCnt + 2, 0), o.Offset(maxCnt + 5, 0)), xlThin, xlThin, xlThin, xlThin)
    For i = 1 To rge.Columns.Count
        o.Offset(0, 1).Value = rgeName.Cells(1, i) '    data(1, i) '"Item" & i
        For m = 1 To dotPlot.UniqueCount.Count
            Set tt = dotPlot.UniqueCount(m)
            o.Offset(1, m).Value = "|fffd||fffd|" + tt.Name + "|fffd|Q"
            Call SetRangeBorder(o.Offset(1, m), xlHairline, xlThin, xlHairline, xlThin)
            'Set dd = New Classify
            val = tt.Values
            For k = 1 To tt.cnt
                o.Offset(k + 1, m).Value = data(val(k, 1), i)
                'Call dd.AddValue((data(val(k, 1), i)))
            Next
            'val = dd.Values
            'o.Offset(maxCnt + 2, m).Value = Application.WorksheetFunction.Average(val)
            'o.Offset(maxCnt + 3, m).Value = Application.WorksheetFunction.Median(val)
            'If dotPlot.typeStdev = 1 Then
            '    o.Offset(maxCnt + 4, m).Value = Application.WorksheetFunction.StDev(val)
            'Else
            '    o.Offset(maxCnt + 4, m).Value = Application.WorksheetFunction.StDevP(val)
            'End If
            'o.Offset(maxCnt + 5, m).Value = dd.cnt
            'Set dd = Nothing
            Call SetRangeBorder(Range(o.Offset(2, m), o.Offset(maxCnt + 1, m)), xlHairline, xlThin, xlHairline, xlThin)
            'Call SetRangeBorder(Range(o.Offset(maxCnt + 2, m), o.Offset(maxCnt + 5, m)), xlHairline, xlThin, xlHairline, xlThin)
        Next m
        Call SetRangeBorder(Range(o.Offset(0, 1), o.Offset(maxCnt + 1, dotPlot.UniqueCount.Count)), xlThin, xlThin, xlThin, xlThin)  '08.12.24 LSQ, old: xlThin, xlThick, xlThin, xlThick
        Set o = o.Offset(0, dotPlot.UniqueCount.Count)
    Next i
    Set doWithClass = Range(RgeOut, RgeOut.Offset(maxCnt + 1, dotPlot.UniqueCount.Count * rge.Columns.Count))
    'Call SetRangeBorder(doWithClass, xlThin, xlThin, xlThin, xlThin) '08.12.24 LSQ, old: xlThick, xlThick, xlThick, xlThick
End Function
#End If

'10.09.27 DZH add
'procedure for data with class item
Private Function doWithClass(dotPlot As DotPlot_T) As Range
    Dim RgeOut As Range, rgeItem As Range, rgeName As Range
    Dim rge As Range
    Dim r As Range, o As Range
    Dim t As Integer
    Dim tt As Classify, dd As Classify
    Dim val As Variant, data As Variant
    Dim maxCnt As Long
    Dim i As Long, m As Long, k As Long, z As Integer
    Dim tmpAry1() As Double
    
    Set RgeOut = dotPlot.RgeOut
    Set rgeItem = dotPlot.rgeItem
    Set rgeName = rgeItem.Rows(1)
    
    maxCnt = dotPlot.maxClsCnt
    
    Set rge = rgeItem.Worksheet.Range(rgeItem(2, 1), rgeItem(rgeItem.Rows.Count, rgeItem.Columns.Count))
    
    Set o = RgeOut
    'o.Offset(2, 0).Value = "|fffd|f|fffd|[|fffd|^"
    'o.Offset(maxCnt + 2, 0).Value = "|fffd||fffd||fffd||3d2|l"
    'o.Offset(maxCnt + 3, 0).Value = "|fffd||fffd||fffd||fffd||fffd|l"
    'o.Offset(maxCnt + 4, 0).Value = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
    'o.Offset(maxCnt + 5, 0).Value = "n"
    data = rge.Value
    Call ProcNoNumeric(dotPlot.typeForNoData, rge.Rows.Count, rge.Columns.Count, data)

    For i = 1 To rge.Columns.Count
        o.Offset(0, 1).Value = rgeName.Cells(1, i) '    data(1, i) '"Item" & i
        z = 1
        For m = 1 To dotPlot.UniqueCount.Count
            Set tt = dotPlot.UniqueCount(m)
            o.Offset(1, m).Value = "|fffd||fffd|" + tt.Name + "|fffd|Q"
            
            Call SetRangeBorder(o.Offset(1, m), xlHairline, xlThin, xlHairline, xlThin)
            
            Call SetRangeBorder(o.Offset(1, m + dotPlot.UniqueCount.Count), xlHairline, xlThin, xlHairline, xlThin)
            
            val = tt.Values
            o.Offset(1, m + dotPlot.UniqueCount.Count).Value = 0
         #If 0 Then
            For k = 1 To tt.cnt
                o.Offset(k + 1, m).Value = data(val(k, 1), i)
                o.Offset(k + 1, m + dotPlot.UniqueCount.Count).Value = z
            Next
         #Else
            ReDim tmpAry1(1 To tt.cnt, 1 To 1) As Double
            For k = 1 To tt.cnt
                tmpAry1(k, 1) = data(val(k, 1), i)
            Next
            o.Offset(2, m).Resize(tt.cnt, 1) = tmpAry1
            o.Offset(2, m + dotPlot.UniqueCount.Count).Resize(tt.cnt, 1) = z
         #End If
            z = z + 1
            
            Call SetRangeBorder(Range(o.Offset(2, m), o.Offset(maxCnt + 1, m)), xlHairline, xlThin, xlHairline, xlThin)
            
            Call SetRangeBorder(Range(o.Offset(2, m + dotPlot.UniqueCount.Count), o.Offset(maxCnt + 1, m + dotPlot.UniqueCount.Count)), xlHairline, xlThin, xlHairline, xlThin)
        Next m

        Call SetRangeBorder(Range(o.Offset(0, 1), o.Offset(maxCnt + 1, dotPlot.UniqueCount.Count * 2)), xlThin, xlThin, xlThin, xlThin) '08.12.24 LSQ, old: xlThin, xlThick, xlThin, xlThick

        Set o = o.Offset(0, dotPlot.UniqueCount.Count * 2)
        
    Next i
   
    Set doWithClass = Range(RgeOut, RgeOut.Offset(maxCnt + 1, dotPlot.UniqueCount.Count * 2 * rge.Columns.Count))
   
End Function


'10.09.27 DZh cmt
#If 0 Then
'draw a dot plot
Private Function DrawDotPlot(ByVal rgeGrpOut As Range, ByVal rgeData As Range) As Chart
    Dim cht As Chart
    
    'ThisWorkbook.Worksheets("tmplDotPlot").ChartObjects("grpDotPlot").Copy
    Set cht = Comm_GetTmplGrp(rgeGrpOut, ThisWorkbook.Name, "tmplDotPlot", "grpDotPlot")
    'rgeGrpOut.Select
    'ActiveSheet.Paste
    'Set cht = ActiveChart
    Call cht.SetSourceData(rgeData)
    cht.Parent.Left = rgeGrpOut.Left
    cht.Parent.Top = rgeGrpOut.Top
    'cht.Parent.Width = rgeGrpOut.Offset(0, 9).Left - rgeGrpOut.Left
    'cht.Parent.Height = rgeGrpOut.Offset(18, 0).Top - rgeGrpOut.Top
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    Set DrawDotPlot = cht
End Function
#End If

'10.09.25 DZH add
'draw a dot plot
'Note: slove the problem that if series's amount over 255  chart can not draw
Private Function DrawDotPlot(ByVal rgeGrpOut As Range, ByVal rgeData As Range) As Chart
    Dim cht As Chart
    
    Dim rowNum As Integer, colNum As Integer
    Dim i As Integer, j As Integer
    Dim tmpRge As Range, rge As Range
    Dim maxNum As Double, minNum As Double
    
    rowNum = rgeData.Rows.Count
    colNum = rgeData.Columns.Count
    
    If colNum Mod 2 = 0 Then
         colNum = colNum / 2
    Else
        MsgBox "Data Range Error"
        Exit Function
    End If
   
    Set rge = rgeData.Offset(1, 0).Resize(rowNum - 1, colNum)
    Set rge = rge.Resize(rowNum - 1, 1)
    
    'copy Chart from Model sheet
    Set cht = Comm_GetTmplGrp(rgeGrpOut, ThisWorkbook.Name, "tmplDotPlot", "SR2DotPlot")
    
#If 0 Then 'for 3 or more group use
    If colNum > 2 Then
        For i = 3 To colNum
            cht.SeriesCollection.NewSeries
            cht.SeriesCollection(i + 1).ChartType = xlXYScatter
            ActiveChart.SeriesCollection(i + 1).AxisGroup = 2
        Next
    ElseIf colNum = 1 Then
        cht.SeriesCollection(3).Delete
    End If
#End If
    
    'set bar data range
    With cht.SeriesCollection(1)
        .XValues = rgeData.Resize(1, colNum)
        .Values = rgeData.Offset(0, colNum).Resize(1, colNum)
    End With
    
    'set Dot data range
    For i = 1 To cht.SeriesCollection.Count - 1
        With cht.SeriesCollection(i + 1)
            .XValues = rge.Offset(0, i + colNum - 1)
            .Values = rge.Offset(0, i - 1)
        End With
    Next
    
    'set The fisrt Y-Axes'value = the second Y-Axes's value
    With ActiveChart.Axes(xlValue, xlSecondary)
        .MinimumScaleIsAuto = True
        .MaximumScaleIsAuto = True
        minNum = .MinimumScale
        maxNum = .MaximumScale
    End With
    
    With ActiveChart.Axes(xlValue)
        .MinimumScale = minNum
        .MaximumScale = maxNum
    End With
    
    'for 3 or more group use
     'set The second X-Axes
    'With ActiveChart.Axes(xlCategory)
        '.MajorTickMark = xlNone
        '.MinorTickMark = xlNone
        '.TickLabelPosition = xlLow
    'End With
    
    'set Chart's position
    With cht
        .Parent.Left = rgeGrpOut.Left
        .Parent.Top = rgeGrpOut.Top
    End With
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    Set DrawDotPlot = cht
End Function

'main entrance for procedure
Public Sub DrawDotPlot_A(ByVal strRgeClass As String, ByVal strRgeItemData As String, ByVal strRgeOut As String, _
                                  ByVal crossAt As Double)
    Dim dotPlot As DotPlot_T
    Dim rge As Range, rgeGrp As Range
    Dim cht As Chart
    Dim itemCnt As Long, smpCnt As Long
    Dim i As Long, j As Long
    Dim dlg As DialogSheet
    Dim ret As Boolean
    
    On Error GoTo DrawDotPlot_err
    Set dotPlot.rgeClass = Range(strRgeClass)
    Set dotPlot.rgeItem = Range(strRgeItemData)
    Set dotPlot.RgeOut = Range(strRgeOut)
    dotPlot.bNewSheet = False
    dotPlot.typeForNoData = 1
    dotPlot.typeForOut = 1
    dotPlot.typeStdev = 1
    dotPlot.dataMKSize = 6
    dotPlot.avgMKSize = 6
    dotPlot.medMKSize = 6
    
    If Not checkData(dotPlot) Then
        Exit Sub
    End If
    
    itemCnt = dotPlot.rgeItem.Columns.Count
    Set rgeGrp = dotPlot.RgeOut.Offset(0, itemCnt + 3)
    
    Set rge = subDotPlot(dotPlot)
    If dotPlot.rgeClass Is Nothing Then
        smpCnt = rge.Rows.Count
        Set cht = DrawDotPlot(rgeGrp, Range(rge(1, 2), rge(smpCnt, itemCnt + 1)))
        Call SetMarkers(cht, dotPlot)
    Else
        smpCnt = rge.Rows.Count
        j = (rge.Columns.Count - 1) \ itemCnt
        Set rgeGrp = dotPlot.RgeOut.Offset(0, 1) '08.12.24 LSQ mdf, old = dotPlot.RgeOut
        For i = 1 To itemCnt
            Set cht = DrawDotPlot(rgeGrp, Range(rge(2, 2 + (i - 1) * j), rge(smpCnt, i * j + 1)))
            cht.chartTitle.Text = dotPlot.rgeItem.Rows(1).Cells(1, i).Text ' "Item" & i
            cht.Axes(xlValue).CrossesAt = crossAt
            Set rgeGrp = rgeGrp.Offset(0, 9)
            Call SetMarkers(cht, dotPlot)
        Next i
    End If
    
    dotPlot.RgeOut.Select
exit_sub:
    Set dotPlot.UniqueCount = Nothing
    Exit Sub
DrawDotPlot_err:
    Resume exit_sub
End Sub

'=== EOF ===
Attribute VB_Name = "mdlSdsGrp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|SDSKD
' 2007.01 WZH
' 2007.1.29 LSQ mdf
'=======================================================

Option Explicit

Sub DrawSdsCateBar(ByVal strWrkSht As String, _
                   ByVal strGrpOut As String, ByVal strGrpData As String, _
                   ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range, crge As Range
    Dim cht As Chart, srsY As Series, srsX As Series
    Dim para As Object
    Dim nAxisNo As Integer
    Dim grpflg As Integer, dataNum As Integer
    Dim i As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    grpflg = CInt(para("GrpFlg"))
    nAxisNo = CInt(para("AxesNo"))
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSDS", "grpCateBar")
    If cht Is Nothing Then
        Exit Sub
    End If
    Set srsY = cht.SeriesCollection(1)
    Set srsX = cht.SeriesCollection(2)
    
    dataNum = dataRge.Rows.Count
    Set xRge = Range(dataRge(1, 1), dataRge(dataNum, 1))
    Set yRge = xRge.Offset(0, 1)
    
#If 1 Then '10.7.31 LSQ mdf
    If grpflg = 1 Then
        Call setSrsData(srsY, xRge, yRge, "Y")
        srsX.Delete
    ElseIf grpflg = 2 Then
        srsY.Delete
        Set srsX = cht.SeriesCollection(1)
        Call setSrsData(srsX, xRge, yRge, "X")
    Else
        Call setSrsData(srsY, xRge, yRge, "Y")
        Call setSrsData(srsX, xRge, yRge.Offset(0, 1), "X")
    End If
#Else
    'cht.SetSourceData datarge
    Set xRge = Range(dataRge(1, 1), dataRge(dataNum, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(1, 2), dataRge(dataNum, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If grpflg = 1 Then
        serObj.Interior.colorIndex = 17
        serObj.Interior.Pattern = xlSolid
    ElseIf grpflg = 2 Then
        serObj.Fill.Patterned Pattern:=msoPatternSmallGrid
        serObj.Fill.Visible = True
        serObj.Fill.ForeColor.SchemeColor = 32
        serObj.Fill.BackColor.SchemeColor = 17
    Else
        Set crge = Range(dataRge(1, 3), dataRge(dataNum, 3))
        For i = 1 To serObj.Points.Count
            If crge(i, 1) = 1 Then
                serObj.Points(i).Interior.colorIndex = 17
                serObj.Points(i).Interior.Pattern = xlSolid
            Else
                serObj.Points(i).Fill.Patterned Pattern:=msoPatternSmallGrid
                serObj.Points(i).Fill.Visible = True
                serObj.Points(i).Fill.ForeColor.SchemeColor = 32
                serObj.Points(i).Fill.BackColor.SchemeColor = 17
            End If
        Next i
    End If
#End If

    cht.chartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|i" & nAxisNo & "|fffd||fffd||fffd|j"  '10.7.31 LSQ; old : "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|^" & nAxisNo & "|fffd||fffd|"

    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, 18, 7)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub
'
'10.7.31 LSQ add
'
Private Sub setSrsData(ByVal srs As Series, ByVal xRge As Range, ByVal yRge As Range, Optional ByVal srsName As String = "")
    srs.Name = srsName
    srs.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    srs.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
End Sub

Sub DrawSdsCateScore(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart, serObj As Series, pntObj As Point
    Dim xaxis As Integer, yaxis As Integer
    Dim i As Integer
    Dim para As Object
    Dim bFlgCateName As Boolean
    Dim fontsize As Integer, charcnt As Integer
    Dim grpflg As Integer
    Dim nAxisNo As Integer
    Dim dataNumX As Integer, dataNumY As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bFlgCateName = CBool(para("bCateName"))
    xaxis = CInt(para("XAxisNo"))
    yaxis = CInt(para("YAxisNo"))
    fontsize = CInt(para("FontSize"))
    charcnt = CInt(para("CharCnt"))
    grpflg = CInt(para("GrpFlg"))
    dataNumX = CInt(para("XNum"))
    dataNumY = CInt(para("YNum"))
    
    Set para = Nothing
    Set nameRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    Set dataRge = Range(dataRge(1, 2), dataRge(dataRge.Rows.Count, 3))
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSDS", "grpCateScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    Set serObj = cht.SeriesCollection(1)
    
    'cht.SetSourceData datarge
    serObj.Name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("B1").Address)
    Set xRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(2, 2), dataRge(dataRge.Rows.Count, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If bFlgCateName Then
        Call Comm_SetDataLabel(serObj, nameRge.Range("A1"), fontsize, charcnt)
    End If
    cht.Axes(xlValue).AxisTitle.Characters.Text = xaxis & "|fffd||fffd|"
    cht.Axes(xlCategory).AxisTitle.Characters.Text = yaxis & "|fffd||fffd|"
    
    If grpflg = 0 Then
    For i = 1 To serObj.Points.Count
        Set pntObj = serObj.Points(i)
        
        If i <= dataNumY Then
            pntObj.MarkerBackgroundColorIndex = xlAutomatic
            pntObj.MarkerForegroundColorIndex = xlAutomatic
            pntObj.MarkerStyle = xlDiamond
        Else
            pntObj.MarkerBackgroundColorIndex = 2
            pntObj.MarkerForegroundColorIndex = 1
            pntObj.MarkerStyle = xlCircle
        End If
    Next i
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub
Attribute VB_Name = "mdlSr1Grp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|1|fffd||fffd|
' 2006.12 WZH
' 2007.1.29 LSQ mdf
'=======================================================
Option Explicit
Option Base 1   '10.5.31 LSQ add

Sub DrawSr1CateScore(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, cateRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim strCates As String
    Dim strCateRge As String
    Dim GrpRows As Integer, GrpCols As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    strCates = para("Cates")
    strCateRge = para("CateRge")
    GrpRows = para("Rows")
    GrpCols = para("Cols")
    Set cateRge = wrkst.Range(Comm_toXlA1str(strCateRge))
    
    Set dataRge = Union(cateRge, dataRge)
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR1", "grpCateScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.chartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A"
    cht.SetSourceData dataRge
    Call SetTicks(cht, strCates)
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, GrpRows, GrpCols)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr1SmpScore1(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim cht As Chart
    Dim strName As String
    Dim i As Long, rowNum As Long
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim corr As Double
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    strName = para("NameRange")
    bNameDisp = CInt(para("NameDisp"))
    corr = CDbl(para("Cor"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR1", "grpSmpScore1")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.Shapes("relVal").DrawingObject.Caption = "|fffd||fffd||fffd||58c|W|fffd||fffd|=" & corr
    If bNameDisp Then
        Set nameRge = wrkst.Range(Comm_toXlA1str(strName))
        Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("A1"))
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr1SmpScore2(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim cht As Chart
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR1", "grpSmpScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
End Sub

'2010.05.24 added
Function hkRank_Or_medRank(medTable As Variant, ByVal nVal As Long, ByVal iVal As Long) As Double
    Dim i As Long, id As Long
    If (nVal > 20) Then
        hkRank_Or_medRank = (1# * iVal) / (nVal + 1#)
        Exit Function
    End If
    id = 0
    For i = 1 To iVal - 1
        id = id + (21 - i)
    Next i
    id = id + (nVal - iVal)
    If (id < 0 Or id >= 210) Then
        hkRank_Or_medRank = -1
        Exit Function
    End If
    hkRank_Or_medRank = medTable(id + 1) '10.5.31 LSQ mdf; 1 based
End Function
'
'
'10.5.31 LSQ mdf (refer to \Design\ProbPlot.xls)
'
#If 0 Then '12.9.15 LSQ cmt : not used (compile error for "gxlabkgraph" not defined)
Sub DrawSr1LogGrp(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                                    ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, wrkRge As Range
    Dim cht As Chart
    Dim SmpNum As Long
    Dim i As Long, j As Long, rowNum As Long
    Dim para As Object
    Dim dblMax As Double, dblMin As Double
    Dim medTable As Variant, v As Variant 'prob_x As Variant,
    Dim tmpstr As String
    Dim xAry(1 To 3) As Double
    
'   prob_x = Array(3.09, 2.326, 1.645, 1.282, 0.524, 0#, -0.524, -1.282, -1.645, -2.326, -3.09)
    medTable = Array(0.5, 0.293, 0.206, 0.159, 0.129, 0.109, 0.094, 0.083, 0.074, 0.067, 0.061, 0.056, 0.052, 0.048, 0.045, 0.042, 0.04, 0.038, 0.036, 0.034, _
       0.707, 0.5, 0.386, 0.314, 0.264, 0.228, 0.201, 0.18, 0.162, 0.148, 0.136, 0.126, 0.117, 0.109, 0.103, 0.097, 0.092, 0.087, 0.083, _
              0.794, 0.614, 0.5, 0.421, 0.364, 0.321, 0.286, 0.259, 0.236, 0.217, 0.2, 0.186, 0.174, 0.164, 0.154, 0.146, 0.138, 0.131, _
                     0.841, 0.686, 0.579, 0.5, 0.44, 0.393, 0.355, 0.324, 0.298, 0.275, 0.256, 0.239, 0.225, 0.212, 0.2, 0.19, 0.181, _
                            0.871, 0.736, 0.636, 0.56, 0.5, 0.452, 0.412, 0.379, 0.35, 0.326, 0.305, 0.286, 0.269, 0.255, 0.242, 0.23, _
                                   0.891, 0.772, 0.679, 0.607, 0.548, 0.5, 0.46, 0.425, 0.395, 0.37, 0.347, 0.327, 0.309, 0.293, 0.279, _
                                          0.906, 0.799, 0.714, 0.645, 0.588, 0.54, 0.5, 0.465, 0.435, 0.408, 0.385, 0.364, 0.645, 0.328, _
                                                 0.917, 0.82, 0.741, 0.676, 0.621, 0.575, 0.535, 0.5, 0.469, 0.442, 0.418, 0.397, 0.377, _
                                                        0.926, 0.838, 0.764, 0.702, 0.65, 0.605, 0.565, 0.531, 0.5, 0.473, 0.448, 0.426, _
                                                               0.933, 0.852, 0.783, 0.725, 0.674, 0.63, 0.592, 0.558, 0.527, 0.5, 0.475, _
                                                                       0.939, 0.864, 0.8, 0.744, 0.695, 0.653, 0.615, 0.582, 0.552, 0.525, _
                                                                              0.944, 0.874, 0.814, 0.761, 0.714, 0.673, 0.636, 0.603, 0.574, _
                                                                                     0.948, 0.883, 0.826, 0.775, 0.731, 0.691, 0.655, 0.623, _
                                                                                            0.952, 0.891, 0.836, 0.788, 0.745, 0.707, 0.672, _
                                                                                                   0.955, 0.897, 0.846, 0.8, 0.758, 0.721, _
                                                                                                          0.958, 0.903, 0.854, 0.81, 0.77, _
                                                                                                                 0.96, 0.908, 0.862, 0.819, _
                                                                                                                        0.962, 0.913, 0.869, _
                                                                                                                               0.964, 0.917, _
                                                                                                                                      0.966)
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))
    dblMax = Application.WorksheetFunction.Max(dataRge)
    dblMin = Application.WorksheetFunction.Min(dataRge)
    
    SmpNum = para("SmpNum")
    Set para = Nothing
   
    Set wrkRge = outRge.Range("B2") '.Worksheet.Parent.Worksheets.Add.Range("B2")
    Set wrkRge = wrkRge.Resize(SmpNum, 1)
    v = dataRge.Value
    wrkRge.Value = v
    Call wrkRge.Sort(Key1:=outRge.Range("B2"), Order1:=xlAscending)
    For i = 1 To SmpNum
        v(i, 1) = i
    Next i
    Set wrkRge = outRge.Range("A2")
    Set wrkRge = wrkRge.Resize(SmpNum, 1)
    wrkRge.Value = v
    For i = 1 To SmpNum
        v(i, 1) = hkRank_Or_medRank(medTable, SmpNum, i)
        v(i, 1) = Application.WorksheetFunction.NormSInv(v(i, 1))
    Next i
    Set wrkRge = outRge.Range("C2")
    Set wrkRge = wrkRge.Resize(SmpNum, 1)
    wrkRge.Value = v

    'wrkRge.Worksheet.Visible = xlSheetHidden
    tmpstr = "=" & wrkRge.Worksheet.Name & "!"
    Set wrkRge = outRge.Range("C2").Resize(SmpNum, 1)
    outRge.Worksheet.Activate
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplLog", "grpLog")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    'Set dummy lines; 10.5.31 LSQ add
    Call setDummyLines(cht, dblMin, dblMax)

    For i = 1 To 1  '10.5.31 LSQ mdf; old : 1 to 12
        cht.SeriesCollection(i).Values = tmpstr & Comm_toXlRCstr(wrkRge.Address)
        cht.SeriesCollection(i).XValues = tmpstr & Comm_toXlRCstr(outRge.Range("B2:B" & SmpNum + 1).Address)
        Set wrkRge = wrkRge.Offset(0, 1)
    Next i
   
    '
    With ActiveChart.Axes(xlCategory)
        .MinimumScale = dblMin
        .MaximumScale = dblMax
        .Crosses = xlCustom
        .CrossesAt = dblMax
    End With
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, 24, 9)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
    
    '10.5.31 LSQ add
    Call Comm_CutDataLink(ActiveWorkbook, gxlabkgraph)
End Sub
'end add
#End If '12.9.15

#If 0 Then '10.5.31
Private Sub NU_setSrsLable(ByVal srs As Series, ByVal strLabel As String)
    srs.ApplyDataLabels
    srs.DataLabels.Position = xlLabelPositionLeft
    
    srs.Points(1).DataLabel.Text = ""
    srs.Points(2).DataLabel.Text = strLabel
    srs.Points(3).DataLabel.Text = ""

End Sub
#End If

Private Sub setDummyLines(ByVal cht As Chart, ByVal dMin As Double, ByVal dMax As Double)
    Dim i As Integer, a As Double
    Dim xAry(1 To 3) As Double, yAry As Variant ', labAry As Variant
    Dim srs As Series
    
    'X values
    xAry(1) = WorksheetFunction.Round(dMin - 0.005, 2)
    xAry(2) = WorksheetFunction.Round(dMin + 0.005, 2)
    xAry(3) = WorksheetFunction.Round(dMax + 0.005, 2)
    'dMin = xAry(1)
    'dMax = xAry(3)
    
    'Y values & Labels are fixed
    yAry = Array(3.0902, 2.3263, 1.6449, 1.2816, 0.6745) '0.7 -- 0.5244
    'labAry = Array(0.999, 0.99, 0.95, 0.9, 0.75, 0.5, 0.25, 0.1, 0.05, 0.01, 0.001) 'prob
    
    For i = 1 To 11
        Set srs = cht.SeriesCollection(i + 1)
        
        If i = 6 Then
            a = 0
        ElseIf i < 6 Then
            a = yAry(i)
        Else
            a = -yAry(11 - i + 1)
        End If
        
        srs.XValues = xAry()
        srs.Values = Array(a, a, a)
        
        'already set labels in template chart
        'Call setSrsLable(srs, labAry(i))
    Next i
End Sub

'=== EOF ===
Attribute VB_Name = "mdlSr2Grp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|2|fffd||fffd|
' 2007.01 WZH
' 2007.1.29 LSQ mdf
'=======================================================

Option Explicit

Sub DrawSr2CateScore1(ByVal strWrkSht As String, _
                      ByVal strGrpOut As String, ByVal strGrpData As String, _
                      ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, xRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim strCates As String
    Dim strXRge As String
    Dim nAxisNo As Integer
    Dim GrpRows As Integer
    Dim GrpCols As Integer
    Dim GrpType As Integer
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    strXRge = para("XRge")
    strCates = para("Cates")
    nAxisNo = CInt(para("AxesNo"))
    GrpRows = para("Rows")
    GrpCols = para("Cols")
    GrpType = para("GrpType")
    
    Set para = Nothing
    
    Set xRge = wrkst.Range(Comm_toXlA1str(strXRge))
    Set dataRge = Union(xRge, dataRge)

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR2", "grpCateScore1")
    If cht Is Nothing Then
        Exit Sub
    End If

    cht.SetSourceData dataRge
    If GrpType = 2 Then
        cht.chartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|i" & nAxisNo & "|fffd||fffd||fffd|j"
        cht.Axes(xlCategory).AxisTitle.Delete
    Else
        cht.chartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A"
        cht.Axes(xlCategory).AxisTitle.Delete                               '2010.06.16 added
    End If
    Call SetTicks(cht, strCates)
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, GrpRows, GrpCols)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr2CateScore2(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                      ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim cht As Chart
    Dim strName As String, strNameX As String, strNameY As String '09.1.30 LSQ
    Dim i As Long, rowNum As Long
    Dim para As Object
    Dim bNameDisp As Boolean
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strName = para("NameRange")
    strNameX = para("AxisXName") '09.1.30 LSQ add
    strNameY = para("AxisYName") '09.1.30 LSQ add
    Set para = Nothing
    Set nameRge = wrkst.Range(toXlA1str(strName))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR2", "grpCateScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.Axes(1).AxisTitle.Caption = strNameX '09.1.30 LSQ add
    cht.Axes(2).AxisTitle.Caption = strNameY '09.1.30 LSQ add
    If bNameDisp Then
        Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("B2"))
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr2SmpScore1(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, xRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim strAxis As String
    Dim strXRge As String
    Dim nAxisNo As Integer
    Dim i As Integer
    Dim GrpRows As Integer
    Dim GrpCols As Integer
    Dim colorInx() As Variant
    colorInx = Array(5, 7, 10, 3, 1, 45, 8, 54, 4)
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    nAxisNo = CInt(para("AxesNo"))
    strXRge = para("XRge")
    GrpRows = para("Rows")
    GrpCols = para("Cols")
    Set para = Nothing
    
    Set xRge = wrkst.Range(Comm_toXlA1str(strXRge))
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))
    
    Set dataRge = Union(xRge, dataRge)
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR2", "grpSmpScore1")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.SeriesCollection(1).Delete
    'strAxis = Split(strGrpData, ",")(0)
    'Set dataRge = wrkst.Range(toXlA1str(strAxis))
    'Set dataRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    Set dataRge = Range(xRge(2, 1), xRge(xRge.Rows.Count, 1))
    strAxis = Comm_toXlRCstr(dataRge.Address)
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & strAxis
    cht.chartTitle.Characters.Text = "|fffd||fffd||fffd||283|O|fffd||fffd||fffd|t" & nAxisNo
    
    For i = 1 To cht.SeriesCollection.Count
        With cht.SeriesCollection.Item(i).Border
            .colorIndex = colorInx((i - 1) Mod 9)
            .Weight = xlThin
            .LineStyle = xlContinuous
        End With
        cht.SeriesCollection.Item(i).MarkerStyle = xlNone
    Next i
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, GrpRows, GrpCols)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr2SmpScore2(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, yRge1 As Range, yRge2 As Range
    Dim cht As Chart
    Dim para As Object
    Dim strAxis As String
    Dim strYRge1 As String
    Dim strYRge2 As String
    Dim i As Integer
    Dim GrpRows As Integer
    Dim GrpCols As Integer
    Dim colorInx() As Variant
    colorInx = Array(5, 7, 10, 3, 1, 45, 8, 54, 4)
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox "Invalid data!"
        Exit Sub
    End If
    
    strYRge1 = para("YRge1")
    strYRge2 = para("YRge2")
    GrpRows = para("Rows")
    GrpCols = para("Cols")
    Set para = Nothing
    
    Set yRge1 = wrkst.Range(Comm_toXlA1str(strYRge1))
    Set yRge2 = wrkst.Range(Comm_toXlA1str(strYRge2))
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))
    
    Set dataRge = Union(dataRge, yRge1, yRge2)
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR2", "grpSmpScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.SeriesCollection(1).Delete
    strAxis = strGrpData                'Split(strGrpData, ",")(0)
    Set dataRge = wrkst.Range(Comm_toXlA1str(strAxis))
    Set dataRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    strAxis = Comm_toXlRCstr(dataRge.Address)
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & strAxis
    
    For i = 1 To cht.SeriesCollection.Count
        With cht.SeriesCollection.Item(i).Border
            .colorIndex = colorInx((i - 1) Mod 9)
            .Weight = xlThin
            .LineStyle = xlContinuous
        End With
        cht.SeriesCollection.Item(i).MarkerStyle = xlNone
    Next i
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, GrpRows, GrpCols)
    
    cht.ChartArea.Select
    Comm_MatchWorkbookFont
    
    outRge.Select
End Sub
'=== EOF ===


Attribute VB_Name = "mdlSr3Grp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|3|fffd||fffd|
' 2007.01 WZH
' 2007.1.29 LSQ mdf
'=======================================================

Option Explicit

'same as in DLL
Const rowNumGRP As Integer = 17
Const colNumGRP As Integer = 8


Sub DrawSr3CateBar(ByVal strWrkSht As String, _
                   ByVal strGrpOut As String, ByVal strGrpData As String, _
                   ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim nAxisNo As Integer
    Dim GrpRows As Integer
    Dim GrpCols As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    nAxisNo = CInt(para("AxesNo"))
    GrpRows = para("Rows")
    GrpCols = para("Cols")
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR3-1", "grpCateBar")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    'cht.SetSourceData datarge
    Set xRge = Range(dataRge(1, 1), dataRge(dataRge.Rows.Count, 1))
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(1, 2), dataRge(dataRge.Rows.Count, 2))
    cht.SeriesCollection(1).Values = "='" & GstName & "'!" & ToXlRCStr(yRge.Address)
    cht.chartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A(" & nAxisNo & "|fffd||fffd|)"
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, GrpRows, GrpCols)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3CateScore(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim cht As Chart
    Dim xaxis As String, yaxis As String
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer
    Dim GrpRows As Integer, GrpCols As Integer
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    GrpRows = para("Rows")
    GrpCols = para("Cols")
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR3-1", "grpCateScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    yaxis = (dataRge(1, 1).Value)
    xaxis = (dataRge(1, 2).Value)
    cht.Axes(xlValue).AxisTitle.Characters.Text = xaxis
    cht.Axes(xlCategory).AxisTitle.Characters.Text = yaxis
    If bNameDisp Then
        Set nameRge = wrkst.Range(Comm_toXlA1str(strNameRge))
        Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("A1"), fontsize, charcnt)
    End If
    
    cht.Axes(xlValue).MajorGridlines.Delete
    cht.Axes(xlCategory).MajorGridlines.Delete
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, GrpRows, GrpCols)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3SmpScore1(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart
    Dim strAxis As String
    Dim i As Integer, j As Integer
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer
    Dim tmp As Long, SmpNum As Long, predictNum As Long
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    predictNum = CLng(para("PredictNum"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR3-2", "grpSmpScore1")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    'cht.SetSourceData datarge
    cht.SeriesCollection(1).Name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("B1").Address)
    j = CInt(val(dataRge(1, 1)))
    i = CInt(val(dataRge(1, 2)))
    cht.Axes(xlValue).AxisTitle.Characters.Text = i & "|fffd||fffd|"
    cht.Axes(xlCategory).AxisTitle.Characters.Text = j & "|fffd||fffd|"
    
    Set xRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & ToXlRCStr(xRge.Address)
    Set yRge = Range(dataRge(2, 2), dataRge(dataRge.Rows.Count, 2))
    cht.SeriesCollection(1).Values = "='" & GstName & "'!" & ToXlRCStr(yRge.Address)
    If bNameDisp Then
        Set dataRge = wrkst.Range(toXlA1str(strNameRge))
        Call Comm_SetDataLabel(cht.SeriesCollection(1), dataRge.Range("A1"), fontsize, charcnt)
    End If
    
    SmpNum = dataRge.Rows.Count
    tmp = SmpNum - predictNum + 1
    If (tmp >= 1 And tmp <= SmpNum) Then
        Do While (tmp <= SmpNum)
            Call setMarkToPoint(tmp)
            tmp = tmp + 1
        Loop
    End If
    
    cht.Axes(xlValue).MajorGridlines.Delete
    cht.Axes(xlCategory).MajorGridlines.Delete
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3SmpScore2(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart, serObj As Series
    Dim strAxis As String
    Dim i As Integer, j As Integer
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR3-2", "grpSmpScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    Set serObj = cht.SeriesCollection(1)
    
    'cht.SetSourceData datarge
    serObj.Name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("B1").Address)
    j = CInt(val(dataRge(1, 1)))
    i = CInt(val(dataRge(1, 2)))
    cht.Axes(xlValue).AxisTitle.Characters.Text = i & "|fffd||fffd|"
    cht.Axes(xlCategory).AxisTitle.Characters.Text = j & "|fffd||fffd|"
    Set xRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(2, 2), dataRge(dataRge.Rows.Count, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If bNameDisp Then
        Set dataRge = wrkst.Range(Comm_toXlA1str(strNameRge))
        Call Comm_SetDataLabel(serObj, dataRge.Range("A1"), fontsize, charcnt)
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3AttrBar(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                   ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, rge As Range, rgeSave As Range
    Dim cht As Chart
    Dim cnt As Integer, i As Integer
    Dim para As Object
    Dim flgFrom As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut)).Range("A1")
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))
    cnt = CInt(para("GrpCnt"))
    flgFrom = CInt(para("flgFrom"))
    Set rge = Range(dataRge(1, 1), dataRge(dataRge.Rows.Count, 2))
    Set rgeSave = outRge '10.12.15 LSQ
    For i = 1 To cnt
        Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR3-3", "grpAttrBar")
        If cht Is Nothing Then
            Exit Sub
        End If
        
        cht.SetSourceData rge
        '2009.02.04 mdf
        'cht.Axes(xlValue).AxisTitle.Characters.Text = " " & i & " |fffd||fffd|"
        If flgFrom = 1 Then
            cht.chartTitle.Text = "|fffd||fffd||fffd||fffd||fffd||28f|d|fffd|S|fffd|i|fffd||542c||fffd||fffd|" & i & "|fffd|j"
        Else
            cht.chartTitle.Text = "|fffd||fffd||fffd||fffd||fffd||28f|d|fffd|S|fffd|i" & i & "|fffd||fffd||fffd|j"
        End If
        cht.Axes(xlValue).HasTitle = False
        'end mdf
        '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
        If flgFrom = 1 Then '10.12.15 LSQ add if
            Call Comm_setChartPosSize(cht.Parent, outRge, rowNumGRP, colNumGRP)
        Else
            Call Comm_setChartPosSize(cht.Parent, outRge)
        End If
        
        cht.ChartArea.Select
        MatchWorkbookFont
        
        'next data
        If flgFrom = 1 Then '10.12.15 LSQ add if
            Set rge = rge.Offset(0, colNumGRP + 1)
            Set outRge = outRge.Offset(0, colNumGRP + 1)
        Else
            Set rge = rge.Offset(0, 2)
            Set outRge = outRge.Offset(1, 1)
        End If
    Next i
    
    rgeSave.Select
End Sub

Sub DrawSr3AttrScore(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, rge As Range, nameRge As Range, rgeSave As Range
    Dim cht As Chart
    Dim strAry() As String
    Dim cnt As Integer, i As Integer, j As Integer
    Dim yaxis As String, xaxis As String
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer, flgFrom As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut)).Range("A1")
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    cnt = CInt(para("GrpCnt"))
    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    flgFrom = CInt(para("flgFrom")) '10.12.15 LSQ add
    Set para = Nothing
    
    Set rge = Range(dataRge(1, 1), dataRge(dataRge.Rows.Count, 2))
    Set nameRge = wrkst.Range(Comm_toXlA1str(strNameRge))
    Set rgeSave = outRge
    For i = 1 To cnt
        Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplSR3-3", "grpAttrScore")
        If cht Is Nothing Then
            Exit Sub
        End If
        
        cht.SetSourceData rge
        yaxis = CStr(rge(1, 1))
        xaxis = CStr(rge(1, 2))
        cht.Axes(xlValue).AxisTitle.Characters.Text = xaxis
        cht.Axes(xlCategory).AxisTitle.Characters.Text = yaxis
        If bNameDisp Then
            Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("A1"), fontsize, charcnt)
        End If
        '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
        If flgFrom = 1 Then '10.12.15 LSQ add if
            Call Comm_setChartPosSize(cht.Parent, outRge, rowNumGRP, colNumGRP)
        Else
            Call Comm_setChartPosSize(cht.Parent, outRge)
        End If
        
        
        cht.Axes(xlValue).MajorGridlines.Delete
        cht.Axes(xlCategory).MajorGridlines.Delete
    
        cht.ChartArea.Select
        MatchWorkbookFont
        
        'next data
        If flgFrom = 1 Then '10.12.15 LSQ add if
            Set rge = rge.Offset(0, colNumGRP + 1)
            Set outRge = outRge.Offset(0, colNumGRP + 1)
        Else
            Set rge = rge.Offset(0, 2)
            Set outRge = outRge.Offset(1, 1)
        End If
    Next i
       
    rgeSave.Select
End Sub

Private Sub setMarkToPoint(ByVal ptNo As Integer)
    ActiveChart.SeriesCollection(1).Select
    ActiveChart.SeriesCollection(1).Points(ptNo).Select
    With Selection.Border
        .Weight = xlHairline
        .LineStyle = xlNone
    End With
    With Selection
        .MarkerBackgroundColorIndex = 2
        .MarkerForegroundColorIndex = 1
        .MarkerStyle = xlCircle
        .MarkerSize = 5
        .Shadow = False
    End With
End Sub
'=== EOF ===




Attribute VB_Name = "mdlTh2Grp"
'=======================================================
' SSS|fffd||fffd||fffd||3d7||289||fffd||fffd|Ver5.5 : THR2
'
' 2007.1 PYJ
' 2011.1 LSQ mdf
'=======================================================

Option Explicit

#If VBA7 Then
    Public Declare PtrSafe Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As LongPtr) 'For 64 Bit Systems
#Else
    Public Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long) 'For 32 Bit Systems
#End If

'11.1.6 LSQ add
'Graph's size; should be same as in DLL
Const rowNumGRP As Integer = 17
Const colNumGRP As Integer = 8

'Bar Graph
Sub Th2BarChart(ByVal strWrkSht As String, ByVal strGrpOut As String, ByVal strGrpData As String, ByVal strGrpData0 As String, _
        ByVal chartTitle As String, ByVal txtLen As Integer, ByVal fontsize As Integer, ByVal bSmpName As Integer, ByVal predictNum As Integer)
    Dim wrkbk As Workbook
    Dim wrksht As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim cht As Chart
    
    On Error Resume Next
    Set wrkbk = Range("'" & strWrkSht & "'!$A$1").Worksheet.Parent
    Set wrksht = Range("'" & strWrkSht & "'!$A$1").Worksheet
    Set outRge = wrksht.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = Range(Comm_toXlA1str(strGrpData))
    On Error GoTo 0
    
    If outRge Is Nothing Or dataRge Is Nothing Then
        Exit Sub
    End If
      
    DoEventsWithSleep
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.Name, "tmplTh2", "grpBarChart")
    DoEventsWithSleep
    
    If cht Is Nothing Then
        Exit Sub
    End If
    
    DoEventsWithSleep
    cht.SetSourceData dataRge
    cht.chartTitle.Characters.Text = chartTitle & "(" & dataRge(1, 2) & ")"
    cht.Axes(xlValue).HasTitle = False
    'cht.Axes(xlValue).AxisTitle.Characters.Text = datarge(1, 2)
    'cht.Axes(xlCategory).AxisTitle.Characters.Text = datarge(1, 1)
        
    Call Comm_setChartPosSize(cht.Parent, outRge, rowNumGRP, colNumGRP) '11.1.6 LSQ (TaiV5 : 10.12.15 LSQ mdf)
    Call Comm_CutDataLink(ActiveWorkbook, ThisWorkbook.Name)
    
    DoEventsWithSleep
    ActiveChart.ChartArea.Select
    Call MatchWorkbookFont
    DoEventsWithSleep
    
    wrksht.Activate
    outRge.Select
End Sub

'Draw Point Graph
Sub Th2PointChart(ByVal strWrkSht As String, ByVal strGrpOut As String, ByVal strGrpData As String, ByVal strGrpData0 As String, _
        ByVal chartTitle As String, ByVal txtLen As Integer, ByVal fontsize As Integer, ByVal bSmpName As Integer, ByVal predictNum As Integer)
    Dim hyoRge As Range, outGrp As Range
    Dim xRge As Range, vRge As Range, rngName As Range
    Dim grpTitle As String, vName As String, nmStr As String
    Dim cht As Chart
    Dim OStObj As Worksheet
    Dim SmpNum As Long, ct As Long, tmp As Long

    On Error Resume Next
    Set OStObj = Range("'" & strWrkSht & "'!$A$1").Worksheet
    Set outGrp = OStObj.Range(Comm_toXlA1str(strGrpOut))
    Set hyoRge = Range(Comm_toXlA1str(strGrpData))
    Set rngName = Range(Comm_toXlA1str(strGrpData0))
    On Error GoTo 0
    If outGrp Is Nothing Or hyoRge Is Nothing Or rngName Is Nothing Then
        Exit Sub
    End If
    
    SmpNum = hyoRge.Rows.Count - 1
    Set xRge = hyoRge.Offset(1, 0).Range("A1:A" & SmpNum)   'Yoko
    Set vRge = xRge.Offset(0, 1)                            'Tate
    Set rngName = rngName.Offset(1, -1)
    vName = hyoRge(1, 2)
    
    '|fffd||fffd|}
    DoEventsWithSleep
    Set cht = Comm_GetTmplGrp(outGrp, ThisWorkbook.Name, "tmplTh2", "grpPointChart")
    DoEventsWithSleep
    
    If cht Is Nothing Then Exit Sub
    
    '--|fffd|f|fffd|[|fffd|^|fffd||348||fffd|
    cht.SeriesCollection(1).XValues = xRge
    cht.SeriesCollection(1).Values = vRge
    cht.SeriesCollection(1).Name = vName
    
    cht.chartTitle.Characters.Text = chartTitle
    
    'Point Name
    If bSmpName Then
        Call Comm_SetDataLabel(cht.SeriesCollection(1), rngName(1, 1), fontsize, txtLen)
    Else
        cht.ApplyDataLabels Type:=xlDataLabelsShowNone
    End If
    
    'Point mark; H14.11.15 LSQ add
    tmp = SmpNum - predictNum + 1
    If (tmp >= 1 And tmp <= SmpNum) Then
        Do While (tmp <= SmpNum)
            Call setMarkToPoint(tmp)
            tmp = tmp + 1
        Loop
    End If
    
    cht.Axes(xlValue).HasTitle = True
    cht.Axes(xlValue).AxisTitle.Characters.Text = vName
    cht.Axes(xlCategory).HasTitle = True
    cht.Axes(xlCategory).AxisTitle.Characters.Text = xRge.Offset(-1, 0)(1, 1)
        
    cht.Axes(xlValue).MajorGridlines.Delete
    cht.Axes(xlCategory).MajorGridlines.Delete
    
    Call Comm_setChartPosSize(cht.Parent, outGrp, rowNumGRP, colNumGRP) '11.1.6 LSQ (TaiV5 : 10.12.15 LSQ mdf)
    Call Comm_CutDataLink(ActiveWorkbook, ThisWorkbook.Name)
    
    DoEventsWithSleep
    ActiveChart.ChartArea.Select
    Call MatchWorkbookFont
    DoEventsWithSleep
    
    OStObj.Activate
    outGrp.Select
End Sub

Private Sub setMarkToPoint(ByVal ptNo As Integer)
    ActiveChart.SeriesCollection(1).Select
    ActiveChart.SeriesCollection(1).Points(ptNo).Select
    With Selection.Border
        .Weight = xlHairline
        .LineStyle = xlNone
    End With
    With Selection
        .MarkerBackgroundColorIndex = 2
        .MarkerForegroundColorIndex = 1
        .MarkerStyle = xlCircle
        .MarkerSize = 5
        .Shadow = False
    End With
End Sub

'
'2015.12.9 LSQ Trial (see 2014.09.05, SSS_THRV7.xls )
'
Private Sub DoEventsWithSleep(Optional ByVal nSleepMs As Integer = 100)
    DoEvents
    'Sleep nSleepMs
End Sub

'=== EOF ===


' InQuest injected base64 decoded content
' ZrH+

INQUEST-PP=macro
