Attribute VB_Name = "Auto"
Option Explicit
Option Base 1

Public sUzytkownik, sSkoroszyt, sSkoroszytTmp, sKatalog, sPassS, sPassW As String
Public sNrR, sNrW, sNrWP, sNrWPGR, sNrO, sNrP, sNrT, sNabor, sWersja, sPorada, sPorada_DW As String
Public bOrgSkoroszyt, bMoveAfterReturn, bBlad, bAutoRecoverEnabled, bEnableAutoComplete, bNie_wolno As Boolean
Public iMoveAfterReturnDirection As Integer

Public MPopUpM As String

Public Tab_Dzialki(), Tab_Uprawy(), Tab_Przypisania() As Variant
Public iNrDzialki, iNrUprawy, iNrPrzypisania, iIlDzialki, iIlUprawy, iIlPrzypisania As Integer
Public iNrWW_p, iPkt_p, iPkt0_p, iPkt1_p, iPkt2_p, iPkt3_p, iPkt4_p, iPkt5_p As Integer
Public sInwM_p, sInwM0_p As String
Public bSkoroszytSaved As Boolean

Private Sub Auto_Open()
'UWAGA!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
Application.DisplayFormulaBar = False
Application.CellDragAndDrop = False
Application.Calculation = xlAutomatic
Application.OnKey "%{DOWN}", ""

Ini4Pub

bMoveAfterReturn = Application.MoveAfterReturn
Application.MoveAfterReturn = True
iMoveAfterReturnDirection = Application.MoveAfterReturnDirection
Application.MoveAfterReturnDirection = xlToRight
bAutoRecoverEnabled = Application.AutoRecover.Enabled
Application.AutoRecover.Enabled = False
Application.EnableAutoComplete = False

Odkryj
'!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
If bOrgSkoroszyt Then
    bNie_wolno = False
    UF_Nie_wolno.Show

    If Not bNie_wolno Then
        ActiveWorkbook.Close SaveChanges:=False
    End If
End If


Worksheets("Zestawienie").Activate
Worksheets("Strona_tytulowa").Activate

End Sub

Private Sub Ini4Pub()

sPorada_DW = "W celu dopisania wiersza nale|fffd|y klikn|fffd||fffd| prawy przycisk myszki." & Chr(13) & Chr(13) & _
    "W celu usuni|fffd|cia wiersza nale|fffd|y klikn|fffd||fffd| prawy przycisk myszki na usuwanym wierszu."
sPorada = "Do wszystkich kom|fffd|rek wyr|fffd|nionych czerwonym t|fffd|em nale|fffd|y wprowadzi|fffd| dane!" & Chr(13) & Chr(13) & _
    "Nawet je|fffd|eli zdarzenie nie dotyczy Wnioskodawcy" & Chr(13) & Chr(13) & _
    "(nale|fffd|y w|fffd|wczas wpisa|fffd| odpowiednio '0' (zero) lub 'nie dotyczy')."

bBlad = False

MPopUpM = "MojePopUpMenu"

sNabor = Worksheets("Parametry").Range("Nabor").Value
sWersja = Worksheets("Parametry").Range("Wersja").Value

sPassS = "oa&@%*BXY"
sPassW = "AOE8)!anr"

sUzytkownik = Application.UserName

sSkoroszyt = ActiveWorkbook.Name

If Replace(sSkoroszyt, ".xls", "") = Worksheets("Parametry").Range("Szablon").Value Then
    bOrgSkoroszyt = True
Else
    bOrgSkoroszyt = False
    sSkoroszytTmp = Worksheets("Info").Range("Skoroszyt").Value
    If Replace(sSkoroszyt, ".xls", "") <> Replace(sSkoroszytTmp, ".xls", "") Then
        MsgBox "B|fffd||fffd|d! W|fffd|a|fffd|ciwa nazwa skoroszytu: '" & sSkoroszytTmp & "'!", vbCritical, "Kontrola poprawno|fffd|ci danych..."
        ActiveWorkbook.Close SaveChanges:=False
    End If
    sNrP = Range("NrP").Value
End If

sNrT = Range("NrT").Value
sKatalog = ActiveWorkbook.Path & "\"

bMoveAfterReturn = True
iMoveAfterReturnDirection = xlToRight

bAutoRecoverEnabled = Application.AutoRecover.Enabled
bEnableAutoComplete = Application.EnableAutoComplete

End Sub

Private Sub Auto_Close()
'UWAGA:
'W_orkbook_BeforeSave
'
'Zabezp. uruch. makr bez param.

If Not bOrgSkoroszyt And Not bBlad Then
    bSkoroszytSaved = ActiveWorkbook.Saved
    
    If Not bSkoroszytSaved Then
        If MsgBox("Czy chcesz zapisa|fffd| zmiany?", vbYesNo, "Zapisywanie zmian...") = vbYes Then
            bSkoroszytSaved = True
        End If
    End If
    
    If bSkoroszytSaved Then
        Ukryj
    End If
End If

Application.CellDragAndDrop = True
Application.DisplayFormulaBar = True
If Not IsEmpty(bMoveAfterReturn) Then
    Application.MoveAfterReturn = bMoveAfterReturn
    Application.MoveAfterReturnDirection = iMoveAfterReturnDirection
End If

Application.AutoRecover.Enabled = bAutoRecoverEnabled
Application.EnableAutoComplete = bEnableAutoComplete

End Sub

Private Sub Odkryj()
Dim iNrArk As Integer
Dim sArk As String
Dim bUkrycie, bOchrona As Boolean

Application.ScreenUpdating = False
Application.EnableEvents = False

If IsEmpty(sPassW) Then
    Application.Run "Auto.Ini4Pub"
End If

ActiveWorkbook.Unprotect Password:=sPassW

iNrArk = 2
Do
    sArk = Worksheets("Arkusze").Cells(iNrArk, 1).Value
    If sArk = "" Then
        Exit Do
    End If
    bUkrycie = Worksheets("Arkusze").Cells(iNrArk, 2).Value
    Worksheets(sArk).Visible = bUkrycie
    
    bOchrona = Worksheets("Arkusze").Cells(iNrArk, 3).Value
    If bOchrona Then
        Worksheets(sArk).Unprotect Password:=sPassS
    End If
    
    iNrArk = iNrArk + 1
Loop

ActiveWorkbook.Protect Password:=sPassW
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Ukryj()
Dim iNrArk As Integer
Dim sArk As String
Dim bUkrycie, bOchrona As Boolean

Application.ScreenUpdating = False
Application.EnableEvents = False

If IsEmpty(sSkoroszyt) Then
    Application.Run "Auto.Ini4Pub"
End If

Windows(sSkoroszyt).Activate

ActiveWorkbook.Unprotect Password:=sPassW

iNrArk = 256
Do
    sArk = Workbooks(sSkoroszyt).Worksheets("Arkusze").Cells(iNrArk, 1).Value
    If sArk <> "" Then
        bUkrycie = Workbooks(sSkoroszyt).Worksheets("Arkusze").Cells(iNrArk, 2).Value
        Workbooks(sSkoroszyt).Worksheets(sArk).Visible = Not bUkrycie
        
        bOchrona = Workbooks(sSkoroszyt).Worksheets("Arkusze").Cells(iNrArk, 3).Value
        If bOchrona Then
            Workbooks(sSkoroszyt).Worksheets(sArk).Protect Password:=sPassS
        End If
    End If
    If iNrArk = 2 Then
        Exit Do
    End If
    
    iNrArk = iNrArk - 1
Loop

Workbooks(sSkoroszyt).Protect Password:=sPassW, Structure:=True, Windows:=False

Application.Run "Nal4All.Nal4All"

Workbooks(sSkoroszyt).Save

Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub ukryj_()
Dim TabArk(), sArk As String
Dim iNrArk, iIlArk As Integer

ActiveWorkbook.Unprotect "HJ12*^scs"

TabArk = Array("Arkusze", "Ostrzezenie", "Parametry", "Info", "Obreb", "Gmi", "Pow", "Woj", _
"Cel", "Tytul_prawny", "TN", "Identyfikator")
iIlArk = UBound(TabArk)

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

For iNrArk = 1 To iIlArk
    sArk = TabArk(iNrArk)
    Worksheets(sArk).Visible = False
    Worksheets(sArk).Protect Password:=sPassS
Next

End Sub

Private Sub odkryj_()
Dim TabArk(), sArk As String
Dim iNrArk, iIlArk As Integer

ActiveWorkbook.Unprotect "HJ12*^scs"

TabArk = Array("Arkusze", "Ostrzezenie", "Parametry", "Info", "Obreb", "Gmi", "Pow", "Woj", _
"Cel", "Tytul_prawny", "TN", "Identyfikator")
iIlArk = UBound(TabArk)

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

For iNrArk = 1 To iIlArk
    sArk = TabArk(iNrArk)
    Worksheets(sArk).Visible = True
    Worksheets(sArk).Unprotect Password:=sPassS
Next

End Sub
Attribute VB_Name = "Check4Kolor"
Option Base 1
Option Explicit

Sub Check4Kolor(pArkusz, pNrW, pNrK)

'If IsEmpty(sPassW) Then
'    Application.Run "Auto.Ini4Pub"
'End If

'Worksheets(pArkusz).Unprotect Password:=sPassS

If Worksheets(pArkusz).Cells(pNrW, pNrK).Value = "" Then
    With Worksheets(pArkusz).Cells(pNrW, pNrK).Interior
        .ColorIndex = 3
        .Pattern = xlSolid
    End With
Else
    Worksheets(pArkusz).Cells(pNrW, pNrK).Interior.ColorIndex = xlNone
End If

'Worksheets(pArkusz).Protect Password:=sPassS

End Sub

Sub SetKolor(pArkusz, pNrW, pNrK)

With Worksheets(pArkusz).Cells(pNrW, pNrK).Interior
    .ColorIndex = 3
    .Pattern = xlSolid
End With
    
End Sub
Attribute VB_Name = "DS_Cel"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "DS_Formula4BSO"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DS_Gmi"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub agasg()
Dim vWynik
Dim iNrW As Double
Application.ScreenUpdating = False
For nrw = 2 To 4000
    sNrWPGR = Cells(nrw, 1).Value
    If sNrWPGR = "" Then
        Exit For
    End If
    iNrW = 0
    With Worksheets("Obreb").Range("c1:c65000")
        Set vWynik = .Find(sNrWPGR, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrW = vWynik.Row
        End If
    End With
    
    If iNrW > 0 Then
        Cells(nrw, 4).Value = True
    Else
        Cells(nrw, 4).Value = False
    End If

Next

Application.ScreenUpdating = True

End Sub
Attribute VB_Name = "DS_Identyfikator"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "DS_Inwestycje_M"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "DS_Obreb"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DS_Pow"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DS_Reg"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DS_SO"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DS_TF"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DS_TF8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DS_TN"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "DS_Tytul_prawny"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "DS_Woj"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "D_000"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim sFormula1 As String
Dim iNrP As Integer
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If
Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Range("Data").Value = Date
Worksheets("Strona_tytulowa").Range("Nabor") = Worksheets("Parametry").Range("Nabor").Value & "." & Worksheets("Parametry").Range("Wersja").Value

sFormula1 = ""
For iNrP = 2 To 1000
    If Worksheets("Identyfikator").Cells(iNrP, 1).Value = "" Then
        Exit For
    End If
    If InStr(Worksheets("Identyfikator").Cells(iNrP, 2).Value, sNrT) > 0 Then
        sFormula1 = sFormula1 & Worksheets("Identyfikator").Cells(iNrP, 1).Value & ":,"
    End If
Next

sFormula1 = Left(sFormula1, Len(sFormula1) - 1)

Range("a15").Validation.Modify Formula1:=sFormula1

Range("m15").Value = sFormula1

If bOrgSkoroszyt Then
    UF_INI.Show
End If

Worksheets("Strona_tytulowa").Protect Password:=sPassS

Worksheets("Strona_tytulowa").Range("H5").Select

Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrTabSK, iIlTabSK, iNr_SK, iDl_SK, iNrW_SK, iNrK_SK  As Integer
Dim sArk, sIdentyfikator, sID, TabSK_(), sWartosc_SK, sZ_SK, sArk_SK, sRange_SK As String
Dim vWartosc, vWartosc_SK
Dim bMultiTarget, bPoprawnyId As Boolean
Dim sPref, sFormat As String
Dim dSK As Double

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

Wal4Str_t sArk
SK4Str_t sArk

Application.ScreenUpdating = False
Application.EnableEvents = False

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets("Strona_tytulowa").Unprotect Password:=sPassS

Select Case iNrW
    Case 5
        Select Case iNrK
            Case 8
                If vWartosc <> "" Then
                    Worksheets("Info").Unprotect Password:=sPassS
                    Worksheets("Info").Range("Zima_rb").Value = Worksheets("Strona_tytulowa").Range("RokBazowy").Value - 1 & "/" & _
                    Worksheets("Strona_tytulowa").Range("RokBazowy").Value
                    Worksheets("Info").Protect Password:=sPassS
                    
                    Worksheets("Uprawy").Unprotect Password:=sPassS
                    Worksheets("Uprawy").Cells(3, 5).Value = "Okrywa" & Chr(10) & "zimowa" & Chr(10) & _
                    Worksheets("Strona_tytulowa").Range("RokBazowy").Value - 1 & "/" & _
                    Worksheets("Strona_tytulowa").Range("RokBazowy").Value
                    Worksheets("Uprawy").Protect Password:=sPassS
                    
                    Worksheets("Poplony").Unprotect Password:=sPassS
                    Worksheets("Poplony").Cells(3, 5).Value = "Okrywa" & Chr(10) & "zimowa" & Chr(10) & _
                    Worksheets("Strona_tytulowa").Range("RokBazowy").Value - 1 & "/" & _
                    Worksheets("Strona_tytulowa").Range("RokBazowy").Value
                    Worksheets("Poplony").Protect Password:=sPassS
                End If
            Case 11
                If vWartosc <> "" Then
                    Worksheets("Info").Unprotect Password:=sPassS
                    Worksheets("Info").Range("Zima_rd").Value = Worksheets("Strona_tytulowa").Range("RokDocelowy").Value - 1 & "/" & _
                    Worksheets("Strona_tytulowa").Range("RokDocelowy").Value
                    Worksheets("Info").Protect Password:=sPassS
                    
                    Worksheets("Uprawy").Unprotect Password:=sPassS
                    Worksheets("Uprawy").Cells(3, 9).Value = "Okrywa" & Chr(10) & "zimowa" & Chr(10) & _
                    Worksheets("Strona_tytulowa").Range("RokDocelowy").Value - 1 & "/" & _
                    Worksheets("Strona_tytulowa").Range("RokDocelowy").Value
                    Worksheets("Uprawy").Protect Password:=sPassS
                    
                    Worksheets("Poplony").Unprotect Password:=sPassS
                    Worksheets("Poplony").Cells(3, 9).Value = "Okrywa" & Chr(10) & "zimowa" & Chr(10) & _
                    Worksheets("Strona_tytulowa").Range("RokDocelowy").Value - 1 & "/" & _
                    Worksheets("Strona_tytulowa").Range("RokDocelowy").Value
                    Worksheets("Poplony").Protect Password:=sPassS
                End If
        End Select
    Case 14
        Select Case iNrK
            Case 4
'                sPref = Left(vWartosc, 2)
'                Select Case sPref
'                    Case "50", "51", "53", "57", "60", "66", "69", "72", "73", "78", "79", "88"
'                        sFormat = "###-###-###"
'                    Case Else
'                        sFormat = "(###) ###-##-##"
'                End Select
'                Worksheets(sArk).Cells(iNrW, iNrK).NumberFormat = sFormat
        End Select
    Case 15
        Select Case iNrK
            Case 1
                Worksheets("Strona_tytulowa").Cells(15, 4).Value = ""
                Wal.SetKolor "Strona_tytulowa", "d15", 3, "-"
            Case 4
                sIdentyfikator = Worksheets("Strona_tytulowa").Cells(15, 1).Value
                sID = CStr(vWartosc)
                bPoprawnyId = False
                Select Case sIdentyfikator
                    Case "PESEL:"
                        bPoprawnyId = Chk4PESEL(sID)
                    Case "NIP:"
                        bPoprawnyId = Chk4NIP(sID)
                    Case "REGON:"
                        bPoprawnyId = Chk4Regon(sID)
                    Case "Nr identyfikacyjny EP:"
                        bPoprawnyId = Chk4Nr_EP(sID)
                    Case Else
                        bPoprawnyId = True
                End Select
                If bPoprawnyId Then
                    Wal.SetKolor sArk, "d15", xlNone, "-"
                Else
                    Wal.SetKolor sArk, "d15", 3, "Dane niepoprawne"
                End If
        End Select
    Case 17
        Select Case iNrK
            Case 4
                If ActiveSheet.Name = sArk Then
                    Worksheets("Strona_tytulowa").Range("h5").Select
                End If
        End Select
End Select

Worksheets("Strona_tytulowa").Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    If Target.AddressLocal <> "$D$4:$K$4" Then
        Exit Sub
    End If
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

Select Case iNrW
    Case 4
        Select Case iNrK
            Case 4
                UF_Cel.Show
                
            End Select
End Select

Wal4Str_t sArk
SK4Str_t sArk

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    If Target.AddressLocal <> "$D$4:$K$4" Then
        Exit Sub
    End If
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

Select Case iNrW
    Case 4
        Select Case iNrK
            Case 4
                UF_Cel.Show
                
            End Select
End Select

SK4Str_t sArk

Cancel = True

End Sub

Private Function Chk4NIP(ByVal pNIP As String) As Boolean
 
Dim TabWag()
Dim lNIP As String
Dim lSK As Integer
Dim lNrZ As Integer
 
Chk4NIP = False
 
lSK = 0
 
TabWag = Array(6, 5, 7, 2, 3, 4, 5, 6, 7)
 
lNIP = LTrim(RTrim(pNIP))
lNIP = Replace(lNIP, " ", "")
lNIP = Replace(lNIP, "-", "")

If Len(lNIP) = 10 And IsNumeric(lNIP) Then
    lNrZ = 0
    For lNrZ = 1 To 9
        lSK = lSK + (Mid(lNIP, lNrZ, 1) * CInt(TabWag(lNrZ)))
    Next
    If lSK Mod 11 = Mid(lNIP, 10, 1) Then
        Chk4NIP = True
    End If
End If
 
End Function

Private Function Chk4PESEL(ByVal pPesel As String) As Boolean
 
Dim TabWag()
Dim lPESEL As String
Dim lSK As Integer
Dim lNrZ As Integer
 
Chk4PESEL = False
 
lSK = 0
 
TabWag = Array(1, 3, 7, 9, 1, 3, 7, 9, 1, 3, 1)
 
lPESEL = LTrim(RTrim(pPesel))
 
If Len(lPESEL) = 11 And IsNumeric(lPESEL) Then
    lNrZ = 0
    For lNrZ = 1 To 11
        lSK = lSK + (Mid(lPESEL, lNrZ, 1) * CInt(TabWag(lNrZ)))
    Next
    If lSK Mod 10 = 0 Then
        Chk4PESEL = True
    End If
End If
 
End Function

Private Function Chk4Regon(ByVal pRegon As String) As Boolean
Dim iDlRegon, iNrR, iDlR, iNrWag9, iIlWag9, iWag9, iNrWag14, iIlWag14, iWag14 As Integer
Dim sRs, sREGON As String
Dim dR, dSK As Double
Dim TabWag9(), TabWag14()
Dim bChk4Regon As Boolean

Chk4Regon = False
bChk4Regon = False

TabWag9 = Array(8, 9, 2, 3, 4, 5, 6, 7)
TabWag14 = Array(2, 4, 8, 5, 0, 9, 7, 3, 6, 1, 2, 4, 8)

sREGON = LTrim(RTrim(pRegon))
sREGON = Replace(sREGON, " ", "")
sREGON = Replace(sREGON, "-", "")
iDlRegon = Len(sREGON)

Select Case iDlRegon
    Case Is <= 9
        iDlR = 9
    Case Is <= 14
        iDlR = 14
End Select

sREGON = Left(sREGON & String(iDlR, "0"), iDlR)

iDlRegon = Len(sREGON)

If iDlRegon = 9 Or iDlRegon = 14 Then
    For iNrR = 1 To 8
        iWag9 = TabWag9(iNrR)
        sRs = Mid(sREGON, iNrR, 1)
        If IsNumeric(sRs) Then
            dR = Val(sRs)
            dSK = dSK + dR * iWag9
        Else
            Exit For
        End If
    Next
    dSK = dSK Mod 11
    If dSK = 10 Then
        dSK = 0
    End If
    sRs = Mid(sREGON, 9, 1)
    If IsNumeric(sRs) Then
        dR = Val(sRs)
        If dR = dSK Then
            bChk4Regon = True
        End If
    End If
End If

If bChk4Regon And iDlRegon = 14 Then
    bChk4Regon = False
    dSK = 0
    For iNrR = 1 To 13
        iWag14 = TabWag14(iNrR)
        sRs = Mid(sREGON, iNrR, 1)
        If IsNumeric(sRs) Then
            dR = Val(sRs)
            dSK = dSK + dR * iWag14
        Else
            Exit For
        End If
    Next
    dSK = dSK Mod 11
    If dSK = 10 Then
        dSK = 0
    End If
    sRs = Mid(sREGON, 14, 1)
    If IsNumeric(sRs) Then
        dR = Val(sRs)
        If dR = dSK Then
            bChk4Regon = True
        End If
    End If

End If

Chk4Regon = bChk4Regon

End Function

Private Function Chk4Nr_EP(ByVal pNr_EP As String) As Boolean
Dim iLp, iSn, iSp, iSuma, iCK, iCK_, iV As Integer
Dim iDlNr_EP, iNr As Integer
Dim sZ, sP, sZ_ As String

sP = "02468"

Chk4Nr_EP = False

iDlNr_EP = Len(pNr_EP) - 1

If iDlNr_EP <> 8 Then
    Exit Function
End If

iCK_ = Val(Right(pNr_EP, 1))

iLp = 0

For iNr = 1 To iDlNr_EP
    sZ = Mid(pNr_EP, iNr, 1)
    If iNr < iDlNr_EP Then
        sZ_ = Mid(pNr_EP, iNr + 1, 1)
        If sZ = sZ_ Then
            Exit Function
        End If
    End If
    iV = Val(sZ)
    If InStr(sP, sZ) > 0 Then
        iLp = iLp + 1
        iSp = iSp + iV
    Else
        iSn = iSn + iV
    End If
Next

iCK = (23 * iSp + 17 * iSn + iLp) Mod 7

If iCK = iCK_ Then
    Chk4Nr_EP = True
End If

End Function

Private Function Check4ID(pID) As Boolean
Dim sDozwoloneZnaki, sZ As String
Dim iNrZ, iIlZ As Integer

sDozwoloneZnaki = " a|fffd|bc|fffd|de|fffd|fghijkl|fffd|mn|fffd|o|fffd|pqrs|fffd|tuwvxyz|fffd||fffd|A|fffd|BC|fffd|DE|fffd|FGHIJKL|fffd|MN|fffd|O|fffd|PQRS|fffd|TUWVXYZ|fffd||fffd|-+=*_&,.;/:()[]{}<>'`" & Chr(9) & Chr(10) & Chr(11) & Chr(12) & Chr(13) & Chr(14) & Chr(15) & Chr(34) & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|0123456789"

Check4ID = False

iIlZ = Len(pID)

If iIlZ > 0 Then
    Check4ID = True
    For iNrZ = 1 To iIlZ
        sZ = Mid(pID, iNrZ, 1)
        If InStr(sDozwoloneZnaki, sZ) = 0 Then
            Check4ID = False
            MsgBox "B|fffd||fffd|d! Nieprawid|fffd|owy znak '" & sZ & "' w imieniu lub nazwisku '" & pID & "'!", vbCritical, "Kontrola poprawno|fffd|ci danych..."
        End If
    Next
End If

End Function

Private Function Check4Ok(pImiona, pNazwisko, pRIdent, pIdentyfikator) As Boolean
Dim bPoprawnyId As Boolean

Check4Ok = True

If Check4ID(pImiona) Then
    If Check4ID(pNazwisko) Then
        If pRIdent <> "" Then
            If pRIdent = "brak identyfikatora" Then
                Check4Ok = True
            Else
                Select Case pRIdent
                    Case "PESEL"
                        bPoprawnyId = Chk4PESEL(pIdentyfikator)
                    Case "NIP"
                        bPoprawnyId = Chk4NIP(pIdentyfikator)
                    Case "REGON"
                        bPoprawnyId = Chk4Regon(pIdentyfikator)
                    Case "Nr identyfikacyjny EP"
                        bPoprawnyId = Chk4Nr_EP(pIdentyfikator)
                    Case Else
                        bPoprawnyId = Check4ID(pIdentyfikator)
                End Select
                    Check4Ok = bPoprawnyId
            End If
        Else
            Check4Ok = False
        End If
    Else
        Check4Ok = False
    End If
Else
    Check4Ok = False
End If

End Function

Private Sub Wal4Str_t(pArk)

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(pArk).Unprotect Password:=sPassS

'Walidacja
Wal.Wal pArk, "d4", pArk, "h5", "Brak danych"
Wal.Wal pArk, "h5", pArk, "k5", "Brak danych"
Wal.Wal pArk, "k5", pArk, "d8", "Brak danych"
Wal.Wal pArk, "d8", pArk, "d9", "Brak danych"
Wal.Wal pArk, "d9", pArk, "d11", "Brak danych"

Wal.Wal pArk, "d11", pArk, "d12", "Brak danych"
Wal.Wal pArk, "d12", pArk, "d13", "Brak danych"
Wal.Wal pArk, "d13", pArk, "f13", "Brak danych"
Wal.Wal pArk, "f13", pArk, "d15", "Brak danych"

If Worksheets(pArk).Range("d15").Value = "" Then
    Wal.Wal pArk, "d15", pArk, "d17", "Brak danych"
End If

If Worksheets("Strona_tytulowa").Range("RokBazowy").Value > _
Worksheets("Strona_tytulowa").Range("RokDocelowy").Value Then
    Wal.SetKolor pArk, "h5", 3, "-"
    Wal.SetKolor pArk, "k5", 3, "-"
End If

If Worksheets(pArk).Range("d10").Value = "" Then
    Wal.SetKolor pArk, "d10", 37, "-"
Else
    Wal.SetKolor pArk, "d10", xlNone, "-"
End If
If Worksheets(pArk).Range("d14").Value = "" Then
    Wal.SetKolor pArk, "d14", 37, "-"
Else
    Wal.SetKolor pArk, "d14", xlNone, "-"
End If
If Worksheets(pArk).Range("d17").Value = "" Then
    Wal.SetKolor pArk, "d17", 37, "-"
Else
    Wal.SetKolor pArk, "d17", xlNone, "-"
End If

Worksheets(pArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Drukuj()

Application.Run "Nal4All.Nal4All"

Application.ScreenUpdating = False
Application.EnableEvents = False

Sheets(Array("Strona_tytulowa", "Zestawienie", "Kryteria_dostepu", "Kryteria_pkt")).Select

Application.Dialogs(xlDialogPrint).Show

Worksheets("Strona_tytulowa").Select

Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub SK4Str_t(pArk)
Dim sRange, sWartosc, sZ As String
Dim rCell As Range
Dim dSK As Double
Dim vWartosc
Dim iNrW, iNrK, iNr, iDl As Integer

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(pArk).Unprotect Password:=sPassS

'Suma kontrolna
sRange = "d4,h5,k5,d8,d9,d10,d11,d12,d13,f13,d14,d15,d17"

For Each rCell In Worksheets(pArk).Range(sRange)
    vWartosc = rCell.Value
    If VarType(vWartosc) <> vbString Then
        sWartosc = CStr(vWartosc)
    Else
        sWartosc = vWartosc
    End If
    iDl = Len(sWartosc)
    iNrW = rCell.Row
    iNrK = rCell.Column
    For iNr = 1 To iDl
        sZ = Mid(sWartosc, iNr, 1)
        dSK = dSK + iNrW * iNrK * iNr * Asc(sZ)
    Next
Next
Worksheets(pArk).Cells(6, 10).Value = dSK

Worksheets(pArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub
Attribute VB_Name = "D_020"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrKT, iNrW As Integer
Dim vWynik, vPKol
Dim sArk As String

sArk = ActiveSheet.Name

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iDlTekstu, iKrotnosc As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean
Dim dRowHeight As Double

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

Wal4Cele sArk

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

iDlTekstu = Len(vWartosc)
iKrotnosc = Int(iDlTekstu / 100) + 1

If iKrotnosc = 0 Then
    iKrotnosc = 1
End If

dRowHeight = 14 * iKrotnosc
If dRowHeight > 405 Then
    dRowHeight = 405
End If

Worksheets(sArk).Rows(iNrW).RowHeight = dRowHeight

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

Select Case iNrW
    Case 4, 7, 9, 12, 14, 16, 18, 20, 22, 27, 29, 31, 33, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 57, 59, 61, 63
        Select Case iNrK
            Case 6
                UF_TN.Show
        End Select
End Select

Wal4Cele sArk

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

Select Case iNrW
    Case 4, 7, 9, 12, 14, 16, 18, 20, 22, 27, 29, 31, 33, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 57, 59, 61, 63
        Select Case iNrK
            Case 6
                UF_TN.Show
        End Select
End Select

Wal4Cele sArk

Cancel = True

End Sub

Private Sub Wal4Cele(pArk)
Dim sAdres As String

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(pArk).Unprotect Password:=sPassS

'walidacja
Wal.Wal_TN pArk, "f4", "-"
Wal.Wal_T pArk, "f4", pArk, "b5", "-"
Wal.Wal_TN pArk, "f7", "-"
Wal.Wal_T pArk, "f7", pArk, "b8", "-"
Wal.Wal_TN pArk, "f9", "-"
Wal.Wal_T pArk, "f9", pArk, "b10", "-"
Wal.Wal_TN pArk, "f12", "-"
Wal.Wal_T pArk, "f12", pArk, "b13", "-"
Wal.Wal_TN pArk, "f14", "-"
Wal.Wal_T pArk, "f14", pArk, "b15", "-"
Wal.Wal_TN pArk, "f16", "-"
Wal.Wal_T pArk, "f16", pArk, "b17", "-"
Wal.Wal_TN pArk, "f18", "-"
Wal.Wal_T pArk, "f18", pArk, "b19", "-"
Wal.Wal_TN pArk, "f20", "-"
Wal.Wal_T pArk, "f20", pArk, "b21", "-"
Wal.Wal_TN pArk, "f22", "-"
Wal.Wal_T pArk, "f22", pArk, "b23", "-"

Wal.Wal_TN pArk, "f27", "-"
Wal.Wal_T pArk, "f27", pArk, "b28", "-"
Wal.Wal_TN pArk, "f29", "-"
Wal.Wal_T pArk, "f29", pArk, "b30", "-"
Wal.Wal_TN pArk, "f31", "-"
Wal.Wal_T pArk, "f31", pArk, "b32", "-"
Wal.Wal_TN pArk, "f33", "-"
Wal.Wal_T pArk, "f33", pArk, "b34", "-"

Wal.Wal_TN pArk, "f36", "-"
Wal.Wal_T pArk, "f36", pArk, "b37", "-"
Wal.Wal_TN pArk, "f38", "-"
Wal.Wal_T pArk, "f38", pArk, "b39", "-"
Wal.Wal_TN pArk, "f40", "-"
Wal.Wal_T pArk, "f40", pArk, "b41", "-"
Wal.Wal_TN pArk, "f42", "-"
Wal.Wal_T pArk, "f42", pArk, "b43", "-"
Wal.Wal_TN pArk, "f44", "-"
Wal.Wal_T pArk, "f44", pArk, "b45", "-"
Wal.Wal_TN pArk, "f46", "-"
Wal.Wal_T pArk, "f46", pArk, "b47", "-"
Wal.Wal_TN pArk, "f48", "-"
Wal.Wal_T pArk, "f48", pArk, "b49", "-"
Wal.Wal_TN pArk, "f50", "-"
Wal.Wal_T pArk, "f50", pArk, "b51", "-"
Wal.Wal_TN pArk, "f52", "-"
Wal.Wal_T pArk, "f52", pArk, "b53", "-"
Wal.Wal_TN pArk, "f54", "-"
Wal.Wal_T pArk, "f54", pArk, "b55", "-"

Wal.Wal_TN pArk, "f57", "-"
Wal.Wal_T pArk, "f57", pArk, "b58", "-"
Wal.Wal_TN pArk, "f59", "-"
Wal.Wal_T pArk, "f59", pArk, "b60", "-"
Wal.Wal_TN pArk, "f61", "-"
Wal.Wal_T pArk, "f61", pArk, "b62", "-"
Wal.Wal_TN pArk, "f63", "-"
Wal.Wal_T pArk, "f63", pArk, "b64", "-"

Worksheets(pArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Nieb(pArk, pAdres)

If Worksheets(pArk).Range(pAdres).Value = "" Then
    Wal.SetKolor pArk, pAdres, 37, "-"
Else
    Wal.SetKolor pArk, pAdres, xlNone, "-"
End If
End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_030"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_Dw").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrWW, iNrKK As Double
Dim iNrP As Double
Dim sArk, sAdres, sID As String
Dim vWartosc, vWynik
Dim bCosJest, bMultiTarget, bPoprawnyId As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 16 Then
    If Not bMultiTarget Then
        Worksheets(sArk).Cells(iNrW, 10).Value = Worksheets(sArk).Cells(iNrW, 11).Value + Worksheets(sArk).Cells(iNrW, 12).Value
    End If
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        If iNrK = 8 Then
            Wal.SetKolor sArk, sAdres, 37, "-"
        Else
            Wal.SetKolor sArk, sAdres, 3, "-"
        End If
    End If
    'Usuwanie pustego wiersza
    Usuw4Dzialki sArk
    LP4Dzialki sArk
    Formula4Dzialki sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrWW, iNrP As Double
Dim sArk, sTP, sItem As String
Dim vWartosc
Dim vWynik
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

iNrP = 0
sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

If iNrW > 16 Then
    Select Case iNrK
        Case 2
            UF_Woj.Show
        Case 3
            sNrW = Worksheets(sArk).Cells(iNrW, 101).Value
            If sNrW <> "" Then
                If UF_Pow.CB_Pow.ListCount > 0 Then
                    For iNrP = 1 To UF_Pow.CB_Pow.ListCount
                        UF_Pow.CB_Pow.RemoveItem 0
                    Next
                End If
                For iNrP = 2 To 1000
                    If Worksheets("Pow").Cells(iNrP, 3).Value = "" Then
                        Exit For
                    End If
                    If Worksheets("Pow").Cells(iNrP, 3).Value = sNrW Then
                        UF_Pow.CB_Pow.AddItem Worksheets("Pow").Cells(iNrP, 2).Value
                    End If
                Next
                UF_Pow.Show
            End If
        Case 4
            sNrWP = Worksheets(sArk).Cells(iNrW, 102).Value
            If sNrWP <> "" Then
                If UF_Gmi.CB_Gmi.ListCount > 0 Then
                    For iNrP = 1 To UF_Gmi.CB_Gmi.ListCount
                        UF_Gmi.CB_Gmi.RemoveItem 0
                    Next
                End If
                For iNrP = 2 To 10000
                    If Worksheets("Gmi").Cells(iNrP, 2).Value = "" Then
                        Exit For
                    End If
                    If Worksheets("Gmi").Cells(iNrP, 2).Value = sNrWP Then
                        UF_Gmi.CB_Gmi.AddItem Worksheets("Gmi").Cells(iNrP, 1).Value
                    End If
                Next
                UF_Gmi.Show
            End If
        Case 5
            sNrWPGR = Worksheets(sArk).Cells(iNrW, 103).Value
            If sNrWPGR <> "" Then
                If UF_Obreb.CB_Obreb.ListCount > 0 Then
                    For iNrP = 1 To UF_Obreb.CB_Obreb.ListCount
                        UF_Obreb.CB_Obreb.RemoveItem 0
                    Next
                End If
                With Worksheets("Obreb").Range("b1:b65000")
                    Set vWynik = .Find(sNrWPGR, LookIn:=xlFormulas, LookAt:=xlWhole)
                    If Not vWynik Is Nothing Then
                        iNrWW = vWynik.Row
                    End If
                End With
                If iNrWW = 0 Then
                    iNrWW = 2
                End If
                For iNrP = iNrWW To 100000
                    If Worksheets("Obreb").Cells(iNrP, 2).Value <> sNrWPGR Then
                        Exit For
                    End If
                    If Worksheets("Obreb").Cells(iNrP, 2).Value = sNrWPGR Then
                        UF_Obreb.CB_Obreb.AddItem Worksheets("Obreb").Cells(iNrP, 1).Value
                    End If
                Next
                UF_Obreb.Show
            End If
        Case 13
            If UF_TP.CB_TP.ListCount > 0 Then
                For iNrP = 1 To UF_TP.CB_TP.ListCount
                    UF_TP.CB_TP.RemoveItem 0
                Next
            End If
            sTP = ""
            For iNrP = 2 To 1000
                If Worksheets("Tytul_prawny").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                sItem = Worksheets("Tytul_prawny").Cells(iNrP, 2).Value
                If InStr(sTP, sItem) = 0 And sItem <> "-" Then
                    UF_TP.CB_TP.AddItem sItem
                    sTP = sTP & sItem
                End If
            Next
            UF_TP.Show
        End Select
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Usuw4Dzialki sArk
LP4Dzialki sArk
Formula4Dzialki sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrWW, iNrP As Double
Dim sArk, sTP, sItem As String
Dim vWartosc
Dim vWynik
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

iNrP = 0
sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

'to z selection change
'If vWartosc <> "" Then
'    Exit Sub
'End If

If iNrW > 16 Then
    Select Case iNrK
        Case 2
            UF_Woj.Show
        Case 3
            sNrW = Worksheets(sArk).Cells(iNrW, 101).Value
            If sNrW <> "" Then
                If UF_Pow.CB_Pow.ListCount > 0 Then
                    For iNrP = 1 To UF_Pow.CB_Pow.ListCount
                        UF_Pow.CB_Pow.RemoveItem 0
                    Next
                End If
                For iNrP = 2 To 1000
                    If Worksheets("Pow").Cells(iNrP, 3).Value = "" Then
                        Exit For
                    End If
                    If Worksheets("Pow").Cells(iNrP, 3).Value = sNrW Then
                        UF_Pow.CB_Pow.AddItem Worksheets("Pow").Cells(iNrP, 2).Value
                    End If
                Next
                UF_Pow.Show
            End If
        Case 4
            sNrWP = Worksheets(sArk).Cells(iNrW, 102).Value
            If sNrWP <> "" Then
                If UF_Gmi.CB_Gmi.ListCount > 0 Then
                    For iNrP = 1 To UF_Gmi.CB_Gmi.ListCount
                        UF_Gmi.CB_Gmi.RemoveItem 0
                    Next
                End If
                For iNrP = 2 To 10000
                    If Worksheets("Gmi").Cells(iNrP, 2).Value = "" Then
                        Exit For
                    End If
                    If Worksheets("Gmi").Cells(iNrP, 2).Value = sNrWP Then
                        UF_Gmi.CB_Gmi.AddItem Worksheets("Gmi").Cells(iNrP, 1).Value
                    End If
                Next
                UF_Gmi.Show
            End If
        Case 5
            sNrWPGR = Worksheets(sArk).Cells(iNrW, 103).Value
            If sNrWPGR <> "" Then
                If UF_Obreb.CB_Obreb.ListCount > 0 Then
                    For iNrP = 1 To UF_Obreb.CB_Obreb.ListCount
                        UF_Obreb.CB_Obreb.RemoveItem 0
                    Next
                End If
                With Worksheets("Obreb").Range("b1:b65000")
                    Set vWynik = .Find(sNrWPGR, LookIn:=xlFormulas, LookAt:=xlWhole)
                    If Not vWynik Is Nothing Then
                        iNrWW = vWynik.Row
                    End If
                End With
                If iNrWW = 0 Then
                    iNrWW = 2
                End If
                For iNrP = iNrWW To 100000
                    If Worksheets("Obreb").Cells(iNrP, 2).Value <> sNrWPGR Then
                        Exit For
                    End If
                    If Worksheets("Obreb").Cells(iNrP, 2).Value = sNrWPGR Then
                        UF_Obreb.CB_Obreb.AddItem Worksheets("Obreb").Cells(iNrP, 1).Value
                    End If
                Next
                UF_Obreb.Show
            End If
        Case 13
            If UF_TP.CB_TP.ListCount > 0 Then
                For iNrP = 1 To UF_TP.CB_TP.ListCount
                    UF_TP.CB_TP.RemoveItem 0
                Next
            End If
            sTP = ""
            For iNrP = 2 To 1000
                If Worksheets("Tytul_prawny").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                sItem = Worksheets("Tytul_prawny").Cells(iNrP, 2).Value
                If InStr(sTP, sItem) = 0 And sItem <> "-" Then
                    UF_TP.CB_TP.AddItem sItem
                    sTP = sTP & sItem
                End If
            Next
            UF_TP.Show
        End Select
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Usuw4Dzialki sArk
LP4Dzialki sArk
Formula4Dzialki sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Select Case iNrK
    Case 2, 3, 4, 5, 13
        Cancel = True
    Case Else
        Cancel = False
End Select

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
Dim sArk As String

sArk = Target.Worksheet.Name

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Dzialki sArk
Formula4Dzialki sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Cancel = True

End Sub

Private Sub Usuw4Dzialki(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 17 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 14
        sAdres = Chr(iNrKK + 96) & iNrWW
        If iNrKK <> 6 And iNrKK <> 7 And iNrKK <> 10 And Worksheets(pArk).Cells(iNrWW, iNrKK).Value <> "" Then
        'VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Select Case iNrKK
                Case 2 To 5, 8 To 9, 11 To 13
                    Wal.SetKolor pArk, sAdres, xlNone, "-"
                Case 14
                    If Worksheets(pArk).Cells(iNrWW, 13).Value <> "BRAK" Then
                        Wal.SetKolor pArk, sAdres, xlNone, "-"
                    Else
                        Wal.SetKolor pArk, sAdres, 15, "-"
                    End If
            End Select
        Else
            Worksheets(pArk).Cells(iNrWW, iNrKK + 99).Value = ""
            Select Case iNrKK
                Case 2 To 5, 8 To 9, 11 To 13
                    If iNrKK = 8 Then
                        Wal.SetKolor pArk, sAdres, 37, "-"
                    Else
                        Wal.SetKolor pArk, sAdres, 3, "-"
                    End If
                Case 14
                    If Worksheets(pArk).Cells(iNrWW, 13).Value <> "BRAK" Then
                        Wal.SetKolor pArk, sAdres, 3, "-"
                    Else
                        Wal.SetKolor pArk, sAdres, 15, "-"
                    End If
            End Select
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 65536 To 65530 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4Dzialki(pArk)
Dim iNrWW As Double

For iNrWW = 17 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 16 & "."
Next

End Sub

Private Sub Formula4Dzialki(pArk)
Dim iNrWW As Integer
Dim vWynik
Dim TabWoj(), TabPow() As String
Dim TabUR_Woj(), TabUR_Pow() As Double
Dim iNrWWoj, iIlWWoj As Integer
Dim sNrWWoj As String
Dim bJestWWoj As Boolean
Dim dUR, dUR_Woj As Double
Dim iNrPPow, iIlPPow As Integer
Dim sNrPPow, sNrPPPow, sPPPow, sWojewodztwo As String
Dim bJestPPow As Boolean
Dim dUR_Pow, dRazem_PUR, dRazem_PP As Double
Dim dUR_Pow2, dUR_Pow3, dUR_Woj2, dUR_Woj3 As Double
Dim sNrPPPow2, sNrPPPow3, sNrW2, sNrW3 As String
Dim dSr_PUR, dSr_PUR2, dSr_PUR3 As Double
Dim sNrR2, sNrR3 As String
Dim sWojewodztwo2, sWojewodztwo3 As String

sNrR = ""
iIlWWoj = 0
iIlPPow = 0
dRazem_PUR = 0
dRazem_PP = 0
sNrW = ""

For iNrWW = 17 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    dRazem_PUR = dRazem_PUR + Worksheets(pArk).Cells(iNrWW, 11).Value
    dRazem_PP = dRazem_PP + Worksheets(pArk).Cells(iNrWW, 12).Value
    sNrWWoj = Worksheets(pArk).Cells(iNrWW, 101).Value
    If IsNumeric(Worksheets(pArk).Cells(iNrWW, 11).Value) Then
        dUR = Worksheets(pArk).Cells(iNrWW, 11).Value
    Else
        dUR = 0
    End If
    If iIlWWoj > 0 Then
        bJestWWoj = False
        For iNrWWoj = 1 To iIlWWoj
            If sNrWWoj = TabWoj(iNrWWoj) Then
                bJestWWoj = True
                Exit For
            End If
        Next
        If bJestWWoj Then
            TabUR_Woj(iNrWWoj) = TabUR_Woj(iNrWWoj) + dUR
        Else
            iIlWWoj = iIlWWoj + 1
            ReDim Preserve TabWoj(iIlWWoj)
            ReDim Preserve TabUR_Woj(iIlWWoj)
            TabWoj(iIlWWoj) = sNrWWoj
            TabUR_Woj(iIlWWoj) = dUR
        End If
    Else
        iIlWWoj = 1
        ReDim Preserve TabWoj(iIlWWoj)
        ReDim Preserve TabUR_Woj(iIlWWoj)
        TabWoj(iIlWWoj) = sNrWWoj
        TabUR_Woj(iIlWWoj) = dUR
    End If
    sNrPPow = Worksheets(pArk).Cells(iNrWW, 102).Value
    If iIlPPow > 0 Then
        bJestPPow = False
        For iNrPPow = 1 To iIlPPow
            If sNrPPow = TabPow(iNrPPow) Then
                bJestPPow = True
                Exit For
            End If
        Next
        If bJestPPow Then
            TabUR_Pow(iNrPPow) = TabUR_Pow(iNrPPow) + dUR
        Else
            iIlPPow = iIlPPow + 1
            ReDim Preserve TabPow(iIlPPow)
            ReDim Preserve TabUR_Pow(iIlPPow)
            TabPow(iIlPPow) = sNrPPow
            TabUR_Pow(iIlPPow) = dUR
        End If
    Else
        iIlPPow = 1
        ReDim Preserve TabPow(iIlPPow)
        ReDim Preserve TabUR_Pow(iIlPPow)
        TabPow(iIlPPow) = sNrPPow
        TabUR_Pow(iIlPPow) = dUR
    End If
Next
Worksheets(pArk).Cells(16, 11) = dRazem_PUR
Worksheets(pArk).Cells(16, 12) = dRazem_PP
Worksheets(pArk).Cells(16, 10) = dRazem_PUR + dRazem_PP
dUR_Woj = 0
dUR_Woj2 = 0
dUR_Woj3 = 0
sNrW = ""
sNrW2 = ""
sNrW3 = ""
For iNrWWoj = 1 To iIlWWoj
    If TabUR_Woj(iNrWWoj) >= dUR_Woj Then
        dUR_Woj3 = dUR_Woj2
        sNrW3 = sNrW2
        dUR_Woj2 = dUR_Woj
        sNrW2 = sNrW
        dUR_Woj = TabUR_Woj(iNrWWoj)
        sNrW = TabWoj(iNrWWoj)
    End If
Next

With Worksheets("Woj").Range("a1:a100")
    Set vWynik = .Find(sNrW, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrWWoj = vWynik.Row
    End If
End With
sNrR = Worksheets("Woj").Cells(iNrWWoj, 3).Value
sWojewodztwo = Worksheets("Woj").Cells(iNrWWoj, 2).Value
dSr_PUR = Worksheets("Woj").Cells(iNrWWoj, 4).Value
dSr_PUR2 = 0
dSr_PUR3 = 0

If dUR_Woj = dUR_Woj2 Then
    With Worksheets("Woj").Range("a1:a100")
        Set vWynik = .Find(sNrW2, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWWoj = vWynik.Row
        End If
    End With
    sNrR2 = Worksheets("Woj").Cells(iNrWWoj, 3).Value
    sWojewodztwo2 = Worksheets("Woj").Cells(iNrWWoj, 2).Value
    dSr_PUR2 = Worksheets("Woj").Cells(iNrWWoj, 4).Value
    If dUR_Woj = dUR_Woj3 Then
        With Worksheets("Woj").Range("a1:a100")
            Set vWynik = .Find(sNrW3, LookIn:=xlFormulas, LookAt:=xlWhole)
            If Not vWynik Is Nothing Then
                iNrWWoj = vWynik.Row
            End If
        End With
        sNrR3 = Worksheets("Woj").Cells(iNrWWoj, 3).Value
        sWojewodztwo3 = Worksheets("Woj").Cells(iNrWWoj, 2).Value
        dSr_PUR3 = Worksheets("Woj").Cells(iNrWWoj, 4).Value
        
        If dSr_PUR > dSr_PUR2 Then
            sNrR = sNrR2
            sWojewodztwo = sWojewodztwo2
            dSr_PUR = dSr_PUR2
        End If
        If dSr_PUR > dSr_PUR3 Then
            sNrR = sNrR3
            sWojewodztwo = sWojewodztwo3
            dSr_PUR = dSr_PUR3
        End If
    Else
        If dSr_PUR > dSr_PUR2 Then
            sNrR = sNrR2
            sWojewodztwo = sWojewodztwo2
        End If
    End If
End If


dUR_Pow = 0
dUR_Pow2 = 0
dUR_Pow3 = 0
sNrPPPow = ""
sNrPPPow2 = ""
sNrPPPow3 = ""
For iNrPPow = 1 To iIlPPow
    If TabUR_Pow(iNrPPow) >= dUR_Pow Then
        dUR_Pow3 = dUR_Pow2
        sNrPPPow3 = sNrPPPow2
        dUR_Pow2 = dUR_Pow
        sNrPPPow2 = sNrPPPow
        dUR_Pow = TabUR_Pow(iNrPPow)
        sNrPPPow = TabPow(iNrPPow)
    End If
Next

With Worksheets("Pow").Range("a1:a1000")
    Set vWynik = .Find(sNrPPPow, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrPPow = vWynik.Row
    End If
End With
sPPPow = Worksheets("Pow").Cells(iNrPPow, 2).Value

If dUR_Pow2 = dUR_Pow Then
    With Worksheets("Pow").Range("a1:a1000")
        Set vWynik = .Find(sNrPPPow2, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrPPow = vWynik.Row
        End If
    End With
    sPPPow = sPPPow & " lub " & Worksheets("Pow").Cells(iNrPPow, 2).Value
End If

If dUR_Pow3 = dUR_Pow Then
    With Worksheets("Pow").Range("a1:a1000")
        Set vWynik = .Find(sNrPPPow3, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrPPow = vWynik.Row
        End If
    End With
    sPPPow = sPPPow & " lub " & Worksheets("Pow").Cells(iNrPPow, 2).Value
End If

If RTrim(LTrim(sPPPow)) = "lub  lub" Then
    sPPPow = ""
End If

Worksheets("Info").Unprotect Password:=sPassS
Worksheets("Info").Range("NrR").Value = sNrR
Worksheets("Info").Range("Powiat_ARiMR").Value = sPPPow
Worksheets("Info").Range("Wojewodztwo").Value = sWojewodztwo
Worksheets("Info").Range("Sr_PUR4Woj").Value = Application.WorksheetFunction.Min(dSr_PUR, Worksheets("Woj").Range("Sr_PUR_PL").Value)
Worksheets("Info").Protect Password:=sPassS

End Sub
Attribute VB_Name = "D_040"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_Dw").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 6 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4Uprawy sArk
    LP4Uprawy sArk
    Formula4Uprawy sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk, sTP, sItem As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

If iNrW > 6 Then
    Select Case iNrK
        Case 2
            If UF_SO.CB_SO.ListCount > 0 Then
                For iNrP = 1 To UF_SO.CB_SO.ListCount
                    UF_SO.CB_SO.RemoveItem 0
                Next
            End If
            For iNrP = 2 To 1000
                If Worksheets("SO").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                If Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" Then
                    UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
                End If
            Next
            UF_SO.Show
        Case 4, 8
            If UF_TP.CB_TP.ListCount > 0 Then
                For iNrP = 1 To UF_TP.CB_TP.ListCount
                    UF_TP.CB_TP.RemoveItem 0
                Next
            End If
            sTP = ""
            For iNrP = 2 To 1000
                If Worksheets("Tytul_prawny").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                sItem = Worksheets("Tytul_prawny").Cells(iNrP, 4).Value
                If InStr(sTP, sItem) = 0 And sItem <> "-" Then
                    UF_TP.CB_TP.AddItem sItem
                    sTP = sTP & sItem
                End If
            Next
            UF_TP.Show
    End Select
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Usuw4Uprawy sArk
LP4Uprawy sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk, sTP, sItem As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

'to z selection_change
'If vWartosc <> "" Then
'    Exit Sub
'End If

If iNrW > 6 Then
    Select Case iNrK
        Case 2
            If UF_SO.CB_SO.ListCount > 0 Then
                For iNrP = 1 To UF_SO.CB_SO.ListCount
                    UF_SO.CB_SO.RemoveItem 0
                Next
            End If
            For iNrP = 2 To 1000
                If Worksheets("SO").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                If Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" Then
                    UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
                End If
            Next
            UF_SO.Show
        Case 4, 8
            If UF_TP.CB_TP.ListCount > 0 Then
                For iNrP = 1 To UF_TP.CB_TP.ListCount
                    UF_TP.CB_TP.RemoveItem 0
                Next
            End If
            sTP = ""
            For iNrP = 2 To 1000
                If Worksheets("Tytul_prawny").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                sItem = Worksheets("Tytul_prawny").Cells(iNrP, 4).Value
                If InStr(sTP, sItem) = 0 And sItem <> "-" Then
                    UF_TP.CB_TP.AddItem sItem
                    sTP = sTP & sItem
                End If
            Next
            UF_TP.Show
    End Select
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Usuw4Uprawy sArk
LP4Uprawy sArk
Formula4Uprawy sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Select Case iNrK
    Case 2, 4, 8
        Cancel = True
    Case Else
        Cancel = False
End Select

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
Dim sArk As String

sArk = Target.Worksheet.Name

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Uprawy sArk
Formula4Uprawy sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Cancel = True

End Sub

Private Sub Usuw4Uprawy(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 7 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 11
        sAdres = Chr(iNrKK + 96) & iNrWW
        If iNrKK <> 3 And iNrKK <> 5 And iNrKK <> 9 Then
            If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
                Select Case iNrKK
                    Case 6, 7
                        If Worksheets(pArk).Cells(iNrWW, 4).Value = "BRAK UPRAWY" And Worksheets(pArk).Cells(iNrWW, iNrKK).Value > 0 Then
                            Wal.SetKolor pArk, sAdres, 3, "-"
                        Else
                            bCosJest = True
                            Wal.SetKolor pArk, sAdres, xlNone, "-"
                        End If
                    Case 10, 11
                        If Worksheets(pArk).Cells(iNrWW, 8).Value = "BRAK UPRAWY" And Worksheets(pArk).Cells(iNrWW, iNrKK).Value > 0 Then
                            Wal.SetKolor pArk, sAdres, 3, "-"
                        Else
                            bCosJest = True
                            Wal.SetKolor pArk, sAdres, xlNone, "-"
                        End If
                    Case Else
                        bCosJest = True
                        Wal.SetKolor pArk, sAdres, xlNone, "-"
                End Select
            Else
                Wal.SetKolor pArk, sAdres, 3, "-"
            End If
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 392 To 386 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4Uprawy(pArk)
Dim iNrWW As Double

For iNrWW = 7 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 6 & "."
Next

End Sub

Private Sub Formula4Uprawy(pArk)
Dim iNrWW As Integer
Dim dUR_Uprawy_rb, dUR_Uprawy_rd, dDzielnik As Double

dUR_Uprawy_rb = 0
dUR_Uprawy_rd = 0
For iNrWW = 7 To 303
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    If Worksheets(pArk).Cells(iNrWW, 3).Value = "ha" Then
        dDzielnik = 1
    Else
        dDzielnik = 10000
    End If
    dUR_Uprawy_rb = dUR_Uprawy_rb + Worksheets(pArk).Cells(iNrWW, 6).Value / dDzielnik
    dUR_Uprawy_rd = dUR_Uprawy_rd + Worksheets(pArk).Cells(iNrWW, 10).Value / dDzielnik

    'Wal
    If (Cells(iNrWW, 104).Value = 0 And Cells(iNrWW, 5).Value = "Tak") Or _
        (InStr("SPT", Cells(iNrWW, 123).Value) > 0 And Cells(iNrWW, 5).Value = "Nie") Then
        Wal.SetKolor pArk, "e" & iNrWW, 6, "Nieprawid|fffd|owe dane"
    End If
    If (Cells(iNrWW, 104).Value = 0 And Cells(iNrWW, 9).Value = "Tak") Or _
        (InStr("SPT", Cells(iNrWW, 123).Value) > 0 And Cells(iNrWW, 9).Value = "Nie") Then
        Wal.SetKolor pArk, "i" & iNrWW, 6, "Nieprawid|fffd|owe dane"
    End If
Next

Worksheets(pArk).Range("UR_Uprawy_rb").Value = dUR_Uprawy_rb
Worksheets(pArk).Range("UR_Uprawy_rd").Value = dUR_Uprawy_rd
    
End Sub
Attribute VB_Name = "D_045"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private sDzialka, sUprawa, sDzialka_P, sUprawa_P As String

Private Sub Worksheet_Activate()
Dim iNrW, iLiW As Integer
Dim sTERC, sNrObrebu, sNrArkusza, sNrDzialki, sIdDzialki, sTxt, sArk As String
Dim bJest_Dz, bJest_U, bJest_P, bDo_usu As Boolean
Dim Tab_Tmp

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_Przyp").Value Then
    MsgBox UF_Przypisanie.L_Porada.Caption, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_Przyp").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

sArk = ActiveSheet.Name

sTxt = ""
iNrDzialki = 0
bJest_Dz = False
For iNrW = 17 To 1000
    If Worksheets("Dzialki").Rows(iNrW).EntireRow.Hidden Then
        Exit For
    End If
    sTERC = Worksheets("Dzialki").Cells(iNrW, 6).Value
    sNrObrebu = Worksheets("Dzialki").Cells(iNrW, 7).Value
    sNrArkusza = Worksheets("Dzialki").Cells(iNrW, 8).Value
    sNrDzialki = Worksheets("Dzialki").Cells(iNrW, 9).Value
    If Worksheets("Dzialki").Cells(iNrW, 11).Value > 0 And sTERC <> "" And sNrObrebu <> "" And sNrDzialki <> "" Then
        sIdDzialki = sTERC & "." & sNrObrebu & IIf(sNrArkusza <> "", "." & sNrArkusza, "") & "-" & sNrDzialki
        If InStr(sTxt, ";" & sIdDzialki & ";") = 0 Then
            iNrDzialki = iNrDzialki + 1
            ReDim Preserve Tab_Dzialki(iNrDzialki)
            Tab_Dzialki(iNrDzialki) = sIdDzialki
            sTxt = sTxt & ";" & Tab_Dzialki(iNrDzialki) & ";"
            bJest_Dz = True
        Else
            MsgBox "Ostrze|fffd|enie: w arkuszu 'Dzia|fffd|ki'!" & Chr(13) & "Dzia|fffd|ka o Id. " & sIdDzialki & " wyst|fffd|puje wi|fffd|cej ni|fffd| raz w arkuszu 'Dzialki'!", vbCritical, "Kontrola jako|fffd|ci danych..."
        End If
    End If
Next

If bJest_Dz Then
    iIlDzialki = UBound(Tab_Dzialki)
    Sort4Array Tab_Dzialki
Else
    iIlDzialki = 0
End If

If iIlDzialki = 0 Then
    MsgBox "Brak dzia|fffd|ek w arkuszu 'Dzialki'!" & Chr(13) & "Prosz|fffd| dopisa|fffd| dzia|fffd|ki lub uzupe|fffd|ni|fffd| brakuj|fffd|ce dane w arkuszu 'Dzialki'!", vbCritical, "Przypisywanie..."
    
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Worksheets(sArk).Unprotect Password:=sPassS

    iLiW = Worksheets(sArk).UsedRange.Rows.Count

    If iLiW > 1 Then
        Worksheets(sArk).Rows("2:" & iLiW).Delete Shift:=xlUp
    End If

    Worksheets(sArk).Protect Password:=sPassS
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    Exit Sub
End If
'---------------------------------------------------------------
sTxt = ""
iNrUprawy = 0
bJest_U = False
For iNrW = 7 To 1000
    If Worksheets("Uprawy").Rows(iNrW).EntireRow.Hidden Then
        Exit For
    End If
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa <> "" And Worksheets("Uprawy").Cells(iNrW, 6).Value > 0 Then
        If InStr(sTxt, ";" & sUprawa & ";") = 0 Then
            iNrUprawy = iNrUprawy + 1
            ReDim Preserve Tab_Uprawy(iNrUprawy)
            Tab_Uprawy(iNrUprawy) = sUprawa
            sTxt = sTxt & ";" & Tab_Uprawy(iNrUprawy) & ";"
            bJest_U = True
        End If
    End If
Next

If bJest_U Then
    iIlUprawy = UBound(Tab_Uprawy)
    Sort4Array Tab_Uprawy
Else
    iIlUprawy = 0
End If

If iIlUprawy = 0 Then
    MsgBox "Brak upraw w arkuszu 'Uprawy'!" & Chr(13) & "Prosz|fffd| dopisa|fffd| uprawy (plantacje wieloletnie, TUZ sady) lub uzupe|fffd|ni|fffd| brakuj|fffd|ce dane w arkuszu 'Uprawy'!", vbCritical, "Przypisywanie..."
    
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Worksheets(sArk).Unprotect Password:=sPassS

    iLiW = Worksheets(sArk).UsedRange.Rows.Count

    If iLiW > 1 Then
        Worksheets(sArk).Rows("2:" & iLiW).Delete Shift:=xlUp
    End If

    Worksheets(sArk).Protect Password:=sPassS
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    Exit Sub
End If
'---------------------------------------------------------------
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS
    
For iNrW = 2 To 10000
    Worksheets(sArk).Rows(iNrW).EntireRow.Hidden = False
    sDzialka = Worksheets(sArk).Cells(iNrW, 1).Value
    sUprawa = Worksheets(sArk).Cells(iNrW, 2).Value
    If sDzialka = "" Then
        Exit For
    End If
    Tab_Tmp = Filter(Tab_Dzialki, sDzialka)
    bDo_usu = False
    If UBound(Tab_Tmp) < 0 Then
        bDo_usu = True
    End If
    Tab_Tmp = Filter(Tab_Uprawy, sUprawa)
    If bDo_usu Or UBound(Tab_Tmp) < 0 Then
        Worksheets(sArk).Rows(iNrW).Delete Shift:=xlUp
        iNrW = iNrW - 1
    End If
Next
Worksheets(sArk).Rows(iNrW).EntireRow.Hidden = True

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True
'---------------------------------------------------------------
iNrPrzypisania = 0
bJest_P = False
For iNrW = 2 To 10000
    sDzialka = Worksheets(sArk).Cells(iNrW, 1).Value
    If sDzialka = "" Then
        Exit For
    End If
    sUprawa = Worksheets(sArk).Cells(iNrW, 2).Value
    If sUprawa <> "" Then
        iNrPrzypisania = iNrPrzypisania + 1
        Tab_Przypisania = ReDimPreserve(Tab_Przypisania, iNrPrzypisania, 2)
        Tab_Przypisania(iNrPrzypisania, 1) = sDzialka
        Tab_Przypisania(iNrPrzypisania, 2) = sUprawa
        bJest_P = True
    End If
Next

If bJest_P Then
    iIlPrzypisania = UBound(Tab_Przypisania)
    Sort4mArray Tab_Przypisania, 1
Else
    iIlPrzypisania = 0
End If

'=============================================================
If UF_Przypisanie.LB_Dzialki.ListCount > 0 Then
'    For iNrDzialki = 1 To UF_Przypisanie.LB_Dzialki.ListCount
'        UF_Przypisanie.LB_Dzialki.RemoveItem 0
'    Next
    UF_Przypisanie.LB_Dzialki.Clear
End If
'For iNrDzialki = 1 To iIlDzialki
'    UF_Przypisanie.LB_Dzialki.AddItem Tab_Dzialki(iNrDzialki)
'Next
UF_Przypisanie.LB_Dzialki.List = Tab_Dzialki

'---------------------------------------------------------------
If UF_Przypisanie.LB_Uprawy.ListCount > 0 Then
'    For iNrUprawy = 1 To UF_Przypisanie.LB_Uprawy.ListCount
'        UF_Przypisanie.LB_Uprawy.RemoveItem 0
'    Next
    UF_Przypisanie.LB_Uprawy.Clear
End If
'For iNrUprawy = 1 To iIlUprawy
'    UF_Przypisanie.LB_Uprawy.AddItem Tab_Uprawy(iNrUprawy)
'Next
UF_Przypisanie.LB_Uprawy.List = Tab_Uprawy

'---------------------------------------------------------------
If UF_Przypisanie.LB_Przypisania.ListCount > 0 Then
'    For iNrPrzypisania = 1 To UF_Przypisanie.LB_Przypisania.ListCount
'        UF_Przypisanie.LB_Przypisania.RemoveItem 0
'    Next
    UF_Przypisanie.LB_Przypisania.Clear
End If
For iNrPrzypisania = 1 To iIlPrzypisania
    UF_Przypisanie.LB_Przypisania.AddItem
    With UF_Przypisanie.LB_Przypisania
        .List(iNrPrzypisania - 1, 0) = Tab_Przypisania(iNrPrzypisania, 1)
        .List(iNrPrzypisania - 1, 1) = Tab_Przypisania(iNrPrzypisania, 2)
    End With
Next

UF_Przypisanie.Show

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iIlW As Integer
Dim sArk, sTP, sItem, sSortOrder, sKolumna As String
Dim vWartosc, vWynik
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

iIlW = 1
With Worksheets(sArk).Range("a1:a10000")
    Set vWynik = .Find("", LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iIlW = vWynik.Row - 1
    End If
End With

sKolumna = Chr(iNrK + 96)

If iNrW = 1 And iNrK <= 2 Then
    If IsEmpty(sPassS) Then
        Application.Run "Auto.Ini4Pub"
    End If
    
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Worksheets(sArk).Unprotect Password:=sPassS
    
    sSortOrder = Right(vWartosc, 1)

    If Asc(sSortOrder) <> 161 Then
        Worksheets(sArk).Range("A1:D" & iIlW).Sort Key1:=Range(sKolumna & "2"), Order1:=xlAscending, Header:= _
        xlYes, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, _
        DataOption1:=xlSortNormal
        If iNrK = 1 Then
            Worksheets(sArk).Cells(iNrW, iNrK).Value = "Id. dzia|fffd|ki " & ChrW(&H2193)
            Worksheets(sArk).Cells(iNrW, iNrK + 1).Value = "Uprawa "
        Else
            Worksheets(sArk).Cells(iNrW, iNrK - 1).Value = "Id. dzia|fffd|ki "
            Worksheets(sArk).Cells(iNrW, iNrK).Value = "Uprawa " & ChrW(&H2193)
        End If
    Else
        Worksheets(sArk).Range("A1:D" & iIlW).Sort Key1:=Range(sKolumna & "2"), Order1:=xlDescending, Header:= _
        xlYes, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, _
        DataOption1:=xlSortNormal
        If iNrK = 1 Then
            Worksheets(sArk).Cells(iNrW, iNrK).Value = "Id. dzia|fffd|ki " & ChrW(&H2191)
            Worksheets(sArk).Cells(iNrW, iNrK + 1).Value = "Uprawa "
        Else
            Worksheets(sArk).Cells(iNrW, iNrK - 1).Value = "Id. dzia|fffd|ki "
            Worksheets(sArk).Cells(iNrW, iNrK).Value = "Uprawa " & ChrW(&H2191)
        End If
    End If
    
    Worksheets(sArk).Protect Password:=sPassS
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End If

End Sub

Private Function ReDimPreserve(pArray, pIlW, pIlK)
Dim Array_Tmp()
Dim iNrW, iNrK, iIlW, iIlK As Integer

ReDimPreserve = False

If IsArray(pArray) Then
    ReDim Array_Tmp(pIlW, pIlK)
    If pIlW <> 1 Then
        iIlW = UBound(pArray, 1)
        iIlK = UBound(pArray, 2)
        For iNrW = LBound(pArray, 1) To pIlW
            For iNrK = LBound(pArray, 2) To pIlK
                If iIlW >= iNrW And iIlK >= iNrK Then
                    Array_Tmp(iNrW, iNrK) = pArray(iNrW, iNrK)
                End If
            Next
        Next
    End If
    If IsArray(Array_Tmp) Then
        ReDimPreserve = Array_Tmp
    End If
End If

End Function

Private Function Sort4Array(pArray As Variant)
Dim vMax As Variant
Dim iMaxIndex As Integer
Dim iW, iWW As Integer

For iW = UBound(pArray) To 1 Step -1
    vMax = pArray(iW)
    iMaxIndex = iW
    
    For iWW = 1 To iW
        If pArray(iWW) > vMax Then
            vMax = pArray(iWW)
            iMaxIndex = iWW
        End If
    Next
    
    If iMaxIndex < iW Then
        pArray(iMaxIndex) = pArray(iW)
        pArray(iW) = vMax
    End If
Next

End Function

Private Function Sort4mArray(pArray As Variant, pK As Integer)
Dim vMax, vMax_ As Variant
Dim iMaxIndex As Integer
Dim iW, iWW, iK As Integer

iK = IIf(pK = 1, 2, 1)

For iW = UBound(pArray) To 1 Step -1
    vMax = pArray(iW, pK)
    vMax_ = pArray(iW, iK)
    
    iMaxIndex = iW
    
    For iWW = 1 To iW
        If pArray(iWW, pK) > vMax Then
            vMax = pArray(iWW, pK)
            vMax_ = pArray(iWW, iK)
            iMaxIndex = iWW
        End If
    Next
    
    If iMaxIndex < iW Then
        pArray(iMaxIndex, pK) = pArray(iW, pK)
        pArray(iMaxIndex, iK) = pArray(iW, iK)
        pArray(iW, pK) = vMax
        pArray(iW, iK) = vMax_
    End If
Next

End Function

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_050"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_Dw").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 6 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4Poplony sArk
    LP4Poplony sArk
    Formula4Poplony sArk
End If
    
Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk, sTP, sItem As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

If iNrW > 6 Then
    Select Case iNrK
        Case 2
            If UF_SO.CB_SO.ListCount > 0 Then
                For iNrP = 1 To UF_SO.CB_SO.ListCount
                    UF_SO.CB_SO.RemoveItem 0
                Next
            End If
            For iNrP = 2 To 1000
                If Worksheets("SO").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                If Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" And _
                Worksheets("SO").Cells(iNrP, 25).Value = 1 Then
                    UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
                End If
            Next
            UF_SO.Show
        Case 4, 8
            If UF_TP.CB_TP.ListCount > 0 Then
                For iNrP = 1 To UF_TP.CB_TP.ListCount
                    UF_TP.CB_TP.RemoveItem 0
                Next
            End If
            sTP = ""
            For iNrP = 2 To 1000
                If Worksheets("Tytul_prawny").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                sItem = Worksheets("Tytul_prawny").Cells(iNrP, 4).Value
                If InStr(sTP, sItem) = 0 And sItem <> "-" Then
                    UF_TP.CB_TP.AddItem sItem
                    sTP = sTP & sItem
                End If
            Next
            UF_TP.Show
    End Select
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Usuw4Poplony sArk
LP4Poplony sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk, sTP, sItem As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

'to z selection_change
'If vWartosc <> "" Then
'    Exit Sub
'End If

If iNrW > 6 Then
    Select Case iNrK
        Case 2
            If UF_SO.CB_SO.ListCount > 0 Then
                For iNrP = 1 To UF_SO.CB_SO.ListCount
                    UF_SO.CB_SO.RemoveItem 0
                Next
            End If
            For iNrP = 2 To 1000
                If Worksheets("SO").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                If Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" And _
                Worksheets("SO").Cells(iNrP, 25).Value = 1 Then
                    UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
                End If
            Next
            UF_SO.Show
        Case 4, 8
            If UF_TP.CB_TP.ListCount > 0 Then
                For iNrP = 1 To UF_TP.CB_TP.ListCount
                    UF_TP.CB_TP.RemoveItem 0
                Next
            End If
            sTP = ""
            For iNrP = 2 To 1000
                If Worksheets("Tytul_prawny").Cells(iNrP, 1).Value = "" Then
                    Exit For
                End If
                sItem = Worksheets("Tytul_prawny").Cells(iNrP, 4).Value
                If InStr(sTP, sItem) = 0 And sItem <> "-" Then
                    UF_TP.CB_TP.AddItem sItem
                    sTP = sTP & sItem
                End If
            Next
            UF_TP.Show
    End Select
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Usuw4Poplony sArk
LP4Poplony sArk
Formula4Poplony sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Select Case iNrK
    Case 2, 4, 8
        Cancel = True
    Case Else
        Cancel = False
End Select

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
Dim sArk As String

sArk = Target.Worksheet.Name

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Poplony sArk
Formula4Poplony sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Cancel = True

End Sub

Private Sub Usuw4Poplony(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 7 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 11
        sAdres = Chr(iNrKK + 96) & iNrWW
        If iNrKK <> 3 And iNrKK <> 5 And iNrKK <> 9 Then
            If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
                bCosJest = True
                Wal.SetKolor pArk, sAdres, xlNone, "-"
            Else
                Wal.SetKolor pArk, sAdres, 3, "-"
            End If
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 1883 To 1877 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4Poplony(pArk)
Dim iNrWW As Double

For iNrWW = 7 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 6 & "."
Next

End Sub

Private Sub Formula4Poplony(pArk)
Dim iNrWW As Integer
Dim dUR_Uprawy_rb, dUR_Uprawy_rd, dDzielnik As Double

dUR_Uprawy_rb = 0
dUR_Uprawy_rd = 0

For iNrWW = 7 To 303
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    If Worksheets(pArk).Cells(iNrWW, 3).Value = "ha" Then
        dDzielnik = 1
    Else
        dDzielnik = 10000
    End If
    dUR_Uprawy_rb = dUR_Uprawy_rb + Worksheets(pArk).Cells(iNrWW, 6).Value / dDzielnik
    dUR_Uprawy_rd = dUR_Uprawy_rd + Worksheets(pArk).Cells(iNrWW, 10).Value / dDzielnik
Next

Worksheets(pArk).Range("UR_Uprawy_rb").Value = dUR_Uprawy_rb
Worksheets(pArk).Range("UR_Uprawy_rd").Value = dUR_Uprawy_rd

End Sub
Attribute VB_Name = "D_060"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4All.Nal4All"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If Not bMultiTarget Then
    Select Case iNrW
        Case 8 To 13
            'Walidacja
            Wal.Wal sArk, "c" & iNrW, sArk, "d" & iNrW, "Brak danych"
        Case 14
            'Walidacja
            If vWartosc = "" Then
                Wal.SetKolor sArk, "e14", 3, "Brak danych"
            Else
                Wal.SetKolor sArk, "e14", xlNone, "-"
            End If
    End Select
Else
    For iNrP = 8 To 14
        Select Case iNrP
            Case 8 To 13
                'Walidacja
                Wal.Wal sArk, "c" & iNrP, sArk, "d" & iNrP, "Brak danych"
            Case 14
                'Walidacja
                If Worksheets(sArk).Range("e14").Value = "" Then
                    Wal.SetKolor sArk, "e14", 3, "Brak danych"
                Else
                    Wal.SetKolor sArk, "e14", xlNone, "-"
                End If
        End Select
    Next
End If

For iNrP = 8 To 13
    Worksheets(sArk).Cells(iNrP, 5).Value = Worksheets(sArk).Cells(iNrP, 3).Value + _
    Worksheets(sArk).Cells(iNrP, 4).Value
Next

For iNrP = 3 To 5
    Worksheets(sArk).Cells(7, iNrP).Value = Worksheets(sArk).Cells(8, iNrP).Value + _
    Worksheets(sArk).Cells(9, iNrP).Value + Worksheets(sArk).Cells(10, iNrP).Value + _
    Worksheets(sArk).Cells(11, iNrP).Value + Worksheets(sArk).Cells(12, iNrP).Value + _
    Worksheets(sArk).Cells(13, iNrP).Value
    
    Worksheets(sArk).Cells(6, iNrP).Value = Worksheets(sArk).Cells(7, iNrP).Value + _
    Worksheets(sArk).Cells(14, iNrP).Value
Next

Application.Run "Nal4Str_r_rb.Nal4Str_r_rb"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_070"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4All.Nal4All"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If Not bMultiTarget Then
    Select Case iNrW
        Case 8 To 13
            'Walidacja
            Wal.Wal sArk, "c" & iNrW, sArk, "d" & iNrW, "Brak danych"
        Case 14
            'Walidacja
            If vWartosc = "" Then
                Wal.SetKolor sArk, "e14", 3, "Brak danych"
            Else
                Wal.SetKolor sArk, "e14", xlNone, "-"
            End If
    End Select
Else
    For iNrP = 8 To 14
        Select Case iNrP
            Case 8 To 13
                'Walidacja
                Wal.Wal sArk, "c" & iNrP, sArk, "d" & iNrP, "Brak danych"
            Case 14
                'Walidacja
                If Worksheets(sArk).Range("e14").Value = "" Then
                    Wal.SetKolor sArk, "e14", 3, "Brak danych"
                Else
                    Wal.SetKolor sArk, "e14", xlNone, "-"
                End If
        End Select
    Next
End If

For iNrP = 8 To 13
    Worksheets(sArk).Cells(iNrP, 5).Value = Worksheets(sArk).Cells(iNrP, 3).Value + _
    Worksheets(sArk).Cells(iNrP, 4).Value
Next

For iNrP = 3 To 5
    Worksheets(sArk).Cells(7, iNrP).Value = Worksheets(sArk).Cells(8, iNrP).Value + _
    Worksheets(sArk).Cells(9, iNrP).Value + Worksheets(sArk).Cells(10, iNrP).Value + _
    Worksheets(sArk).Cells(11, iNrP).Value + Worksheets(sArk).Cells(12, iNrP).Value + _
    Worksheets(sArk).Cells(13, iNrP).Value
    
    Worksheets(sArk).Cells(6, iNrP).Value = Worksheets(sArk).Cells(7, iNrP).Value + _
    Worksheets(sArk).Cells(14, iNrP).Value
Next

Application.Run "Nal4Str_r_rd.Nal4Str_r_rd"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_080"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK, iNrP As Integer
Dim vWynik, vPKol
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.Run "Nal4All.Nal4All"

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_085"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4All.Nal4All"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP As Integer
Dim sArk As String
Dim vWartosc
Dim bMultiTarget As Boolean
Dim dPowierzchnia As Double

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If Not bMultiTarget Then
    Select Case iNrK
        Case 3
            'Walidacja
            If vWartosc = "" Then
                Wal.SetKolor sArk, "c" & iNrW, 3, "Brak danych"
            Else
                Wal.SetKolor sArk, "c" & iNrW, xlNone, "-"
            End If
    End Select
Else
    For iNrP = 7 To 12
        Select Case iNrP
            Case 14
                'Walidacja
                If Worksheets(sArk).Range("c" & iNrP).Value = "" Then
                    Wal.SetKolor sArk, "c" & iNrP, 3, "Brak danych"
                Else
                    Wal.SetKolor sArk, "c" & iNrP, xlNone, "-"
                End If
        End Select
    Next
End If

dPowierzchnia = 0
For iNrP = 7 To 12
    dPowierzchnia = dPowierzchnia + Worksheets(sArk).Cells(iNrP, 3).Value
Next
Worksheets(sArk).Cells(6, 3).Value = dPowierzchnia

Application.Run "Nal4Str_w_rd.Nal4Str_w_rd"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_090"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"
If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK, iPozSpac As Integer
Dim sArk, sKod As String
Dim vWartosc, vWynik, vCell
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW = 3 And iNrK = 2 Then
    Worksheets(sArk).Range("a5:n63").ClearComments
    iPozSpac = InStr(vWartosc, " ")
    If vWartosc = "trzoda chlewna" Then
        vWartosc = "trzoda"
    End If
    For iNrWW = 5 To 63
        Select Case vWartosc
            Case "wszystkie"
                Worksheets(sArk).Rows(iNrWW).EntireRow.Hidden = False
            Case Else
                If Worksheets(sArk).Cells(iNrWW, 1).Value = vWartosc Then
                    Worksheets(sArk).Rows(iNrWW).EntireRow.Hidden = False
                Else
                    Worksheets(sArk).Rows(iNrWW).EntireRow.Hidden = True
                End If
        End Select
    Next
End If

If iNrW > 5 Then
    If Application.WorksheetFunction.Sum(Range("d" & iNrW & ":j" & iNrW)) = 0 Then
'        For iNrP = 100 To 150
'            Cells(iNrW, iNrP).Value = ""
'        Next
        Range(Cells(iNrW, 100), Cells(iNrW, 150)).ClearContents
    Else
        sKod = Worksheets(sArk).Cells(iNrW, 19).Value
        With Worksheets("SO").Range("a1:a1000")
            Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
            If Not vWynik Is Nothing Then
                iNrWW = vWynik.Row
            End If
        End With
        
        Cells(iNrW, 101).Value = iNrWW
    
        Select Case Worksheets("Info").Range("NrR")
            Case "A"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 5).Value
            Case "B"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 6).Value
            Case "C"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 7).Value
            Case "D"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 8).Value
        End Select
        '103 pusta na wart
        For iNrP = 9 To 30
            Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWW, iNrP).Value
        Next
    End If
End If

'Formuly
Worksheets(sArk).Cells(8, 7).Value = Worksheets(sArk).Cells(12, 10).Value
Worksheets(sArk).Cells(18, 7).Value = Worksheets(sArk).Cells(19, 10).Value
Worksheets(sArk).Cells(51, 7).Value = Worksheets(sArk).Cells(52, 10).Value
Worksheets(sArk).Cells(56, 7).Value = Worksheets(sArk).Cells(57, 10).Value
Worksheets(sArk).Cells(57, 7).Value = Worksheets(sArk).Cells(58, 10).Value
For iNrWW = 5 To 63
    Select Case iNrWW
        Case 6 To 14, 16 To 19, 21 To 32, 34 To 45, 47 To 49, 51 To 52, 54 To 58, 60 To 61, 63
            Worksheets(sArk).Cells(iNrWW, 11).Value = Worksheets(sArk).Cells(iNrWW, 4).Value + _
            Worksheets(sArk).Cells(iNrWW, 5).Value + Worksheets(sArk).Cells(iNrWW, 6).Value + _
            Worksheets(sArk).Cells(iNrWW, 7).Value - _
            Worksheets(sArk).Cells(iNrWW, 8).Value - Worksheets(sArk).Cells(iNrWW, 9).Value - _
            Worksheets(sArk).Cells(iNrWW, 10).Value

            Worksheets(sArk).Cells(iNrWW, 18).Value = IIf(Worksheets(sArk).Cells(iNrWW, 17).Value = 12, _
            (Worksheets(sArk).Cells(iNrWW, 4).Value + Worksheets(sArk).Cells(iNrWW, 11).Value) / 2, _
            IIf((Worksheets(sArk).Cells(iNrWW, 11).Value - Worksheets(sArk).Cells(iNrWW, 4).Value) < 0, _
            Worksheets(sArk).Cells(iNrWW, 9).Value + Worksheets(sArk).Cells(iNrWW, 10).Value + _
            Worksheets(sArk).Cells(iNrWW, 8).Value / 2 - (Worksheets(sArk).Cells(iNrWW, 4).Value - _
            Worksheets(sArk).Cells(iNrWW, 11).Value) / 2, _
            Worksheets(sArk).Cells(iNrWW, 9).Value + Worksheets(sArk).Cells(iNrWW, 10).Value + _
            Worksheets(sArk).Cells(iNrWW, 8).Value / 2 + _
            (Worksheets(sArk).Cells(iNrWW, 11).Value - Worksheets(sArk).Cells(iNrWW, 4).Value) / 2))
            
            Worksheets(sArk).Cells(iNrWW, 12).Value = Round((Worksheets(sArk).Cells(iNrWW, 18).Value * _
            Worksheets(sArk).Cells(iNrWW, 17).Value / 12), 2)
            If iNrWW <> 63 Then
                Worksheets(sArk).Cells(iNrWW, 14).Value = Worksheets(sArk).Cells(iNrWW, 12).Value - _
                Worksheets(sArk).Cells(iNrWW, 13).Value
            End If
    End Select
Next

'Kontrola jako|fffd|ci
For iNrWW = 5 To 61
    If Cells(iNrWW, 12).Value <> 0 And Cells(iNrWW, 13).Value = "" Then
        Wal.SetKolor sArk, "m" & iNrWW, 3, "Brak danych"
    Else
        Wal.SetKolor sArk, "m" & iNrWW, xlNone, "-"
    End If
    If Application.WorksheetFunction.Sum(Range("d" & iNrWW & ":n" & iNrWW)) > 0 And Cells(iNrWW, 15).Value = "" Then
        Wal.SetKolor sArk, "o" & iNrWW, 3, "Brak danych"
    Else
        Wal.SetKolor sArk, "o" & iNrWW, xlNone, "-"
    End If
    
    If Cells(iNrWW, 11).Value < 0 Then
        Wal.SetKolor sArk, "k" & iNrWW, 3, "Ilo|fffd||fffd| musi by|fffd| > 0!"
    Else
        Wal.SetKolor sArk, "k" & iNrWW, 15, "-"
    End If
    
    If Cells(iNrWW, 14).Value < 0 Then
        Wal.SetKolor sArk, "n" & iNrWW, 3, "Ilo|fffd||fffd| musi by|fffd| > 0!"
    Else
        Wal.SetKolor sArk, "n" & iNrWW, 15, "-"
    End If
    Select Case iNrWW
        Case 13, 17, 23, 25, 27, 29, 36, 38, 40, 42, 61
            If Cells(iNrWW, 4).Value > 0 And Cells(iNrWW, 8).Value + Cells(iNrWW, 9).Value = 0 Then
                Wal.SetKolor sArk, "d" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|)=0"
                Wal.SetKolor sArk, "h" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|)=0"
                Wal.SetKolor sArk, "i" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|)=0"
            Else
                Wal.SetKolor sArk, "d" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "h" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "i" & iNrWW, xlNone, "-"
            End If
        Case 18, 19
            If Cells(iNrWW, 4).Value > 0 And Cells(iNrWW, 8).Value + Cells(iNrWW, 9).Value + Cells(iNrWW, 10).Value = 0 Then
                Wal.SetKolor sArk, "d" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
                Wal.SetKolor sArk, "h" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
                Wal.SetKolor sArk, "i" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
                Wal.SetKolor sArk, "j" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
            Else
                Wal.SetKolor sArk, "d" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "h" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "i" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "j" & iNrWW, xlNone, "-"
            End If
    End Select
    
Next
'krowy<>jalowki
With Range("g6,g7,j9")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g6").Value + Range("g7").Value <> Range("j9").Value Then
    For Each vCell In Range("g6,g7,j9")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| kr|fffd|w z przeklasowania musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci ja|fffd||fffd|wek na przeklasowanie!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g6,g7,j9").Interior.ColorIndex = 3
End If
'jalowki<>jalowki
With Range("g9,g10,j11")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g9").Value + Range("g10").Value <> Range("j11").Value Then
    For Each vCell In Range("g9,g10,j11")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| ja|fffd||fffd|wek w w. 2 lat i w. z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci ja|fffd||fffd|wek w w. 1-2 lata na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g9,g10,j11").Interior.ColorIndex = 3
End If
'jalowki+byczki<>byczki+jalowki
With Range("g11,g12,j14")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g11").Value + Range("g12").Value <> Range("j14").Value Then
    For Each vCell In Range("g11,g12,j14")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| ja|fffd||fffd|wek i byczk|fffd|w w w. 1-2 lat z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci byczk|fffd|w i ja|fffd||fffd|wek poni|fffd|ej 1 roku na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g11,g12,j14").Interior.ColorIndex = 3
End If
'lochy+tuczniki<>warchlaki
With Range("g16,g17,j18")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g16").Value + Range("g17").Value <> Range("j18").Value Then
    For Each vCell In Range("g16,g17,j18")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| loch i tucznik|fffd|w z przeklasowanie musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci warchlak|fffd|w na przeklasowanie!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g16,g17,j18").Interior.ColorIndex = 3
End If
'owce<>jagnieta
With Range("g47,g48,j49")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g47").Value + Range("g48").Value <> Range("j49").Value Then
    For Each vCell In Range("g47,g48,j49")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| maciorek i skop|fffd|w z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci jagni|fffd|t na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g47,g48,j49").Interior.ColorIndex = 3
End If
'klacze+ogiery+walachy<>zrebaki
With Range("g54,g55,j56")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g54").Value + Range("g55").Value <> Range("j56").Value Then
    For Each vCell In Range("g54,g55,j56")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| klaczy, ogier|fffd|w i wa|fffd|ach|fffd|w z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci |fffd|rebak|fffd|w w w. 2 lata i w. na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g54,g55,j56").Interior.ColorIndex = 3
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_100"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"
If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK, iPozSpac As Integer
Dim sArk, sKod As String
Dim vWartosc, vWynik, vCell
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW = 3 And iNrK = 2 Then
    Worksheets(sArk).Range("a5:n63").ClearComments
    iPozSpac = InStr(vWartosc, " ")
    If vWartosc = "trzoda chlewna" Then
        vWartosc = "trzoda"
    End If
    For iNrWW = 5 To 63
        Select Case vWartosc
            Case "wszystkie"
                Worksheets(sArk).Rows(iNrWW).EntireRow.Hidden = False
            Case Else
                If Worksheets(sArk).Cells(iNrWW, 1).Value = vWartosc Then
                    Worksheets(sArk).Rows(iNrWW).EntireRow.Hidden = False
                Else
                    Worksheets(sArk).Rows(iNrWW).EntireRow.Hidden = True
                End If
        End Select
    Next
End If

If iNrW > 5 Then
    If Application.WorksheetFunction.Sum(Range("d" & iNrW & ":j" & iNrW)) = 0 Then
'        For iNrP = 100 To 150
'            Cells(iNrW, iNrP).Value = ""
'        Next
        Range(Cells(iNrW, 100), Cells(iNrW, 150)).ClearContents
    Else
        sKod = Worksheets(sArk).Cells(iNrW, 19).Value
        With Worksheets("SO").Range("a1:a1000")
            Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
            If Not vWynik Is Nothing Then
                iNrWW = vWynik.Row
            End If
        End With
        
        Cells(iNrW, 101).Value = iNrWW
    
        Select Case Worksheets("Info").Range("NrR")
            Case "A"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 5).Value
            Case "B"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 6).Value
            Case "C"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 7).Value
            Case "D"
                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 8).Value
        End Select
        '103 pusta na wart
        For iNrP = 9 To 30
            Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWW, iNrP).Value
        Next
    End If
End If

'Formuly
Worksheets(sArk).Cells(8, 7).Value = Worksheets(sArk).Cells(12, 10).Value
Worksheets(sArk).Cells(18, 7).Value = Worksheets(sArk).Cells(19, 10).Value
Worksheets(sArk).Cells(51, 7).Value = Worksheets(sArk).Cells(52, 10).Value
Worksheets(sArk).Cells(56, 7).Value = Worksheets(sArk).Cells(57, 10).Value
Worksheets(sArk).Cells(57, 7).Value = Worksheets(sArk).Cells(58, 10).Value
For iNrWW = 5 To 63
    Select Case iNrWW
        Case 6 To 14, 16 To 19, 21 To 32, 34 To 45, 47 To 49, 51 To 52, 54 To 58, 60 To 61, 63
            Worksheets(sArk).Cells(iNrWW, 11).Value = Worksheets(sArk).Cells(iNrWW, 4).Value + _
            Worksheets(sArk).Cells(iNrWW, 5).Value + Worksheets(sArk).Cells(iNrWW, 6).Value + _
            Worksheets(sArk).Cells(iNrWW, 7).Value - _
            Worksheets(sArk).Cells(iNrWW, 8).Value - Worksheets(sArk).Cells(iNrWW, 9).Value - _
            Worksheets(sArk).Cells(iNrWW, 10).Value
            
            Worksheets(sArk).Cells(iNrWW, 18).Value = IIf(Worksheets(sArk).Cells(iNrWW, 17).Value = 12, _
            (Worksheets(sArk).Cells(iNrWW, 4).Value + Worksheets(sArk).Cells(iNrWW, 11).Value) / 2, _
            IIf((Worksheets(sArk).Cells(iNrWW, 11).Value - Worksheets(sArk).Cells(iNrWW, 4).Value) < 0, _
            Worksheets(sArk).Cells(iNrWW, 9).Value + Worksheets(sArk).Cells(iNrWW, 10).Value + _
            Worksheets(sArk).Cells(iNrWW, 8).Value / 2 - (Worksheets(sArk).Cells(iNrWW, 4).Value - _
            Worksheets(sArk).Cells(iNrWW, 11).Value) / 2, _
            Worksheets(sArk).Cells(iNrWW, 9).Value + Worksheets(sArk).Cells(iNrWW, 10).Value + _
            Worksheets(sArk).Cells(iNrWW, 8).Value / 2 + _
            (Worksheets(sArk).Cells(iNrWW, 11).Value - Worksheets(sArk).Cells(iNrWW, 4).Value) / 2))
            
            Worksheets(sArk).Cells(iNrWW, 12).Value = Round((Worksheets(sArk).Cells(iNrWW, 18).Value * _
            Worksheets(sArk).Cells(iNrWW, 17).Value / 12), 2)
            If iNrWW <> 63 Then
                Worksheets(sArk).Cells(iNrWW, 14).Value = Worksheets(sArk).Cells(iNrWW, 12).Value - _
                Worksheets(sArk).Cells(iNrWW, 13).Value
            End If
    End Select
Next

'Kontrola jako|fffd|ci
For iNrWW = 5 To 61
    If Cells(iNrWW, 12).Value <> 0 And Cells(iNrWW, 13).Value = "" Then
        Wal.SetKolor sArk, "m" & iNrWW, 3, "Brak danych"
    Else
        Wal.SetKolor sArk, "m" & iNrWW, xlNone, "-"
    End If
    If Application.WorksheetFunction.Sum(Range("d" & iNrWW & ":n" & iNrWW)) > 0 And Cells(iNrWW, 15).Value = "" Then
        Wal.SetKolor sArk, "o" & iNrWW, 3, "Brak danych"
    Else
        Wal.SetKolor sArk, "o" & iNrWW, xlNone, "-"
    End If
    
    If Cells(iNrWW, 11).Value < 0 Then
        Wal.SetKolor sArk, "k" & iNrWW, 3, "Ilo|fffd||fffd| musi by|fffd| > 0!"
    Else
        Wal.SetKolor sArk, "k" & iNrWW, 15, "-"
    End If
    
    If Cells(iNrWW, 14).Value < 0 Then
        Wal.SetKolor sArk, "n" & iNrWW, 3, "Ilo|fffd||fffd| musi by|fffd| > 0!"
    Else
        Wal.SetKolor sArk, "n" & iNrWW, 15, "-"
    End If
    Select Case iNrWW
        Case 13, 17, 23, 25, 27, 29, 36, 38, 40, 42, 61
            If Cells(iNrWW, 4).Value > 0 And Cells(iNrWW, 8).Value + Cells(iNrWW, 9).Value = 0 Then
                Wal.SetKolor sArk, "d" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|)=0"
                Wal.SetKolor sArk, "h" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|)=0"
                Wal.SetKolor sArk, "i" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|)=0"
            Else
                Wal.SetKolor sArk, "d" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "h" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "i" & iNrWW, xlNone, "-"
            End If
        Case 18, 19
            If Cells(iNrWW, 4).Value > 0 And Cells(iNrWW, 8).Value + Cells(iNrWW, 9).Value + Cells(iNrWW, 10).Value = 0 Then
                Wal.SetKolor sArk, "d" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
                Wal.SetKolor sArk, "h" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
                Wal.SetKolor sArk, "i" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
                Wal.SetKolor sArk, "j" & iNrWW, 3, "St.pocz.>0, a (upadki+sprzeda|fffd|+na przeklasowanie)=0"
            Else
                Wal.SetKolor sArk, "d" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "h" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "i" & iNrWW, xlNone, "-"
                Wal.SetKolor sArk, "j" & iNrWW, xlNone, "-"
            End If
    End Select
    
Next
'krowy<>jalowki
With Range("g6,g7,j9")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g6").Value + Range("g7").Value <> Range("j9").Value Then
    For Each vCell In Range("g6,g7,j9")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| kr|fffd|w z przeklasowania musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci ja|fffd||fffd|wek na przeklasowanie!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g6,g7,j9").Interior.ColorIndex = 3
End If
'jalowki<>jalowki
With Range("g9,g10,j11")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g9").Value + Range("g10").Value <> Range("j11").Value Then
    For Each vCell In Range("g9,g10,j11")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| ja|fffd||fffd|wek w w. 2 lat i w. z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci ja|fffd||fffd|wek w w. 1-2 lata na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g9,g10,j11").Interior.ColorIndex = 3
End If
'jalowki+byczki<>byczki+jalowki
With Range("g11,g12,j14")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g11").Value + Range("g12").Value <> Range("j14").Value Then
    For Each vCell In Range("g11,g12,j14")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| ja|fffd||fffd|wek i byczk|fffd|w w w. 1-2 lat z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci byczk|fffd|w i ja|fffd||fffd|wek poni|fffd|ej 1 roku na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g11,g12,j14").Interior.ColorIndex = 3
End If
'lochy+tuczniki<>warchlaki
With Range("g16,g17,j18")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g16").Value + Range("g17").Value <> Range("j18").Value Then
    For Each vCell In Range("g16,g17,j18")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| loch i tucznik|fffd|w z przeklasowanie musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci warchlak|fffd|w na przeklasowanie!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g16,g17,j18").Interior.ColorIndex = 3
End If
'owce<>jagnieta
With Range("g47,g48,j49")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g47").Value + Range("g48").Value <> Range("j49").Value Then
    For Each vCell In Range("g47,g48,j49")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| maciorek i skop|fffd|w z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci jagni|fffd|t na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g47,g48,j49").Interior.ColorIndex = 3
End If
'klacze+ogiery+walachy<>zrebaki
With Range("g54,g55,j56")
    .ClearComments
    .Interior.ColorIndex = xlNone
End With
If Range("g54").Value + Range("g55").Value <> Range("j56").Value Then
    For Each vCell In Range("g54,g55,j56")
        vCell.AddComment
        With vCell.Comment
            .Visible = False
            .Text Text:="Ilo|fffd||fffd| klaczy, ogier|fffd|w i wa|fffd|ach|fffd|w z przeklas. musi si|fffd| r|fffd|wna|fffd| ilo|fffd|ci |fffd|rebak|fffd|w w w. 2 lata i w. na przeklas.!"
            .Shape.TextFrame.AutoSize = True
        End With
    Next
    Range("g54,g55,j56").Interior.ColorIndex = 3
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_110"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sKod As String
Dim vWartosc, vWynik
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If Not bMultiTarget Then
    Select Case iNrW
        Case 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 21, 22, 23, 24, 25, 26, 37
            Select Case iNrK
                Case 5, 7
                    Wal.Wal sArk, "e" & iNrW, sArk, "g" & iNrW, "Brak danych"
                    If (Worksheets(sArk).Cells(iNrW, 5).Value = "" Or Worksheets(sArk).Cells(iNrW, 5).Value = 0) And _
                    (Worksheets(sArk).Cells(iNrW, 7).Value = "" Or Worksheets(sArk).Cells(iNrW, 7).Value = 0) Then
'                        For iNrP = 100 To 150
'                            Cells(iNrW, iNrP).Value = ""
'                        Next
                        Range(Cells(iNrW, 100), Cells(iNrW, 150)).ClearContents
                    Else
                        sKod = Worksheets(sArk).Cells(iNrW, 10).Value
                        With Worksheets("SO").Range("a1:a1000")
                            Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
                            If Not vWynik Is Nothing Then
                                iNrWW = vWynik.Row
                            End If
                        End With
                        
                        Cells(iNrW, 101).Value = iNrWW
    
                        Select Case Worksheets("Info").Range("NrR")
                            Case "A"
                                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 5).Value
                            Case "B"
                                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 6).Value
                            Case "C"
                                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 7).Value
                            Case "D"
                                Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWW, 8).Value
                        End Select
                        '103 pusta na wart
                        For iNrP = 9 To 30
                            Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWW, iNrP).Value
                        Next
                    End If
                End Select
    End Select
Else
    For iNrP = 5 To 37
        Select Case iNrP
            Case 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 21, 22, 23, 24, 25, 26, 37
                Wal.Wal sArk, "e" & iNrP, sArk, "g" & iNrP, "Brak danych"
        End Select
    Next
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_120"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_DW").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 3 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4Sr_tran sArk
    LP4Sr_tran sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim sArk As String

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

'Usuw4Sr_tran sArk
LP4Sr_tran sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Cancel = True

End Sub

Private Sub Usuw4Sr_tran(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 4 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 5
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 705 To 699 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4Sr_tran(pArk)
Dim iNrWW As Double

For iNrWW = 4 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 3 & "."
Next

End Sub

Attribute VB_Name = "D_130"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_DW").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 3 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4M_i_U sArk
    LP4M_i_U sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim sArk As String

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

'Usuw4M_i_U sArk
LP4M_i_U sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Cancel = True

End Sub

Private Sub Usuw4M_i_U(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 4 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 5
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 705 To 699 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4M_i_U(pArk)
Dim iNrWW As Double

For iNrWW = 4 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 3 & "."
Next

End Sub


Attribute VB_Name = "D_140"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_DW").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 3 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4B_i_B sArk
    LP4B_i_B sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim sArk As String

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

'Usuw4B_i_B sArk
LP4B_i_B sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Cancel = True

End Sub

Private Sub Usuw4B_i_B(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 4 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 5
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 705 To 699 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4B_i_B(pArk)
Dim iNrWW As Double

For iNrWW = 4 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 3 & "."
Next

End Sub


Attribute VB_Name = "D_150"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

sArk = ActiveSheet.Name

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_DW").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Check4Roki pArk:=sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 4 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4I_M_w sArk
    LP4I_M_w sArk
    Formula4I_M_w sArk
    Check4Roki sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

If iNrW > 4 Then
    Select Case iNrK
        Case 2
            If UF_InwM.CB_InwM.ListCount > 0 Then
                For iNrP = 1 To UF_InwM.CB_InwM.ListCount
                    UF_InwM.CB_InwM.RemoveItem 0
                Next
            End If
            For iNrP = 2 To 1000
                If Worksheets("Inwestycje_M").Cells(iNrP, 2).Value = "" Then
                    Exit For
                End If
                If InStr(Worksheets("Inwestycje_M").Cells(iNrP, 4).Value, sNrT) > 0 Then
                    UF_InwM.CB_InwM.AddItem Worksheets("Inwestycje_M").Cells(iNrP, 2).Value
                End If
            Next
            UF_InwM.Show
'        Case 6
'            UF_TN.Show
    End Select
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

'Usuw4I_M_w sArk
LP4I_M_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If iNrW > 4 Then
    Select Case iNrK
        Case 2
            If UF_InwM.CB_InwM.ListCount > 0 Then
                For iNrP = 1 To UF_InwM.CB_InwM.ListCount
                    UF_InwM.CB_InwM.RemoveItem 0
                Next
            End If
            For iNrP = 2 To 1000
                If Worksheets("Inwestycje_M").Cells(iNrP, 2).Value = "" Then
                    Exit For
                End If
                If InStr(Worksheets("Inwestycje_M").Cells(iNrP, 4).Value, sNrT) > 0 Then
                    UF_InwM.CB_InwM.AddItem Worksheets("Inwestycje_M").Cells(iNrP, 2).Value
                End If
            Next
            UF_InwM.Show
'        Case 6
'            UF_TN.Show
    End Select
End If


If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

'Usuw4I_M_w sArk
LP4I_M_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Select Case iNrK
    Case 2
        Cancel = True
    Case Else
        Cancel = False
End Select

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
Dim sArk As String

sArk = Target.Worksheet.Name

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4I_M_w sArk
Formula4I_M_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Cancel = True

End Sub

Private Sub Usuw4I_M_w(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 5 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 5 '6
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 705 To 699 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4I_M_w(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 5 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 4 & "."
    For iNrKK = 2 To 5 '6
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
'            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Worksheets(pArk).Cells(iNrWW, 2).Value = "" Then
        Wal.SetKolor pArk, "b" & iNrWW, 3, "Nie wybrano inwestycji!"
    Else
        If Worksheets(pArk).Cells(iNrWW, 101).Value < 1 Then
            Wal.SetKolor pArk, "b" & iNrWW, 3, "Nie zaznaczono wyposa|fffd|enia dodatkowego!"
        Else
            Wal.SetKolor pArk, "b" & iNrWW, xlNone, "-"
        End If
    End If
Next

End Sub

Private Sub Formula4I_M_w(pArk)
Dim iNrWW As Integer
Dim dRazem_PKB, dTemp As Double

dRazem_PKB = 0
'formula
dTemp = 0
For iNrWW = 5 To 701
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    dRazem_PKB = dRazem_PKB + Worksheets(pArk).Cells(iNrWW, 4).Value
    dTemp = dTemp + Worksheets(pArk).Cells(iNrWW, 101).Value
Next

Worksheets(pArk).Cells(4, 4).Value = dRazem_PKB
Worksheets(pArk).Cells(1, 101).Value = dTemp

End Sub

Private Sub Check4Rok(pArk, pRange)
Dim vRok

vRok = Worksheets(pArk).Range(pRange).Value

If vRok <> "" Then
    If vRok < Worksheets("Strona_tytulowa").Range("RokBazowy").Value Or _
    vRok > Worksheets("Strona_tytulowa").Range("RokDocelowy").Value Then
        Wal.SetKolor pArk, pRange, 3, "Rok poza okresem realizacji"
    Else
        Wal.SetKolor pArk, pRange, xlNone, "-"
    End If
End If

End Sub

Private Sub Check4Roki(pArk)
Dim iNrWW As Double

For iNrWW = 5 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Check4Rok pArk:=pArk, pRange:="c" & iNrWW
Next

End Sub

Attribute VB_Name = "D_160"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

sArk = ActiveSheet.Name

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_DW").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Check4Roki sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 4 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4I_NM_w sArk
    LP4I_NM_w sArk
    Formula4I_NM_w sArk
    Check4Roki sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

'If iNrW > 4 Then
'    Select Case iNrK
'        Case 6
'            UF_TN.Show
'    End Select
'End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

'Usuw4I_NM_w sArk
LP4I_NM_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

'If iNrW > 4 Then
'    Select Case iNrK
'        Case 6
'            UF_TN.Show
'    End Select
'End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

'Usuw4I_NM_w sArk
LP4I_NM_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Cancel = False

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
Dim sArk As String

sArk = Target.Worksheet.Name

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4I_NM_w sArk
Formula4I_NM_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True
Cancel = True

End Sub

Private Sub Usuw4I_NM_w(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 5 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 5 '6
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 705 To 699 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4I_NM_w(pArk)
Dim iNrWW As Double

For iNrWW = 5 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 4 & "."
Next

End Sub

Private Sub Formula4I_NM_w(pArk)
Dim iNrWW As Integer
Dim dRazem_PKB As Double

dRazem_PKB = 0
For iNrWW = 5 To 701
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    dRazem_PKB = dRazem_PKB + Worksheets(pArk).Cells(iNrWW, 4).Value
Next

Worksheets(pArk).Cells(4, 4).Value = dRazem_PKB

End Sub

Private Sub Check4Rok(pArk, pRange)
Dim vRok

vRok = Worksheets(pArk).Range(pRange).Value

If vRok <> "" Then
    If vRok < Worksheets("Strona_tytulowa").Range("RokBazowy").Value Or _
    vRok > Worksheets("Strona_tytulowa").Range("RokDocelowy").Value Then
        Wal.SetKolor pArk, pRange, 3, "Rok poza okresem realizacji"
    Else
        Wal.SetKolor pArk, pRange, xlNone, "-"
    End If
End If

End Sub

Private Sub Check4Roki(pArk)
Dim iNrWW As Double

For iNrWW = 5 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Check4Rok pArk:=pArk, pRange:="c" & iNrWW
Next

End Sub

Attribute VB_Name = "D_170"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean
Dim dRazem As Double

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

dRazem = 0
For iNrP = 7 To 17
    dRazem = dRazem + Worksheets(sArk).Cells(iNrP, 6).Value
Next
Worksheets(sArk).Cells(6, 6).Value = dRazem
dRazem = 0
For iNrP = 20 To 30
    dRazem = dRazem + Worksheets(sArk).Cells(iNrP, 6).Value
Next
Worksheets(sArk).Cells(19, 6).Value = dRazem
dRazem = 0
For iNrP = 32 To 42
    dRazem = dRazem + Worksheets(sArk).Cells(iNrP, 6).Value
Next
Worksheets(sArk).Cells(31, 6).Value = dRazem

dRazem = Worksheets(sArk).Cells(6, 6).Value
For iNrP = 6 To 17
    If dRazem <> 0 Then
        Worksheets(sArk).Cells(iNrP, 7).Value = Round(Worksheets(sArk).Cells(iNrP, 6).Value * 100 / dRazem, 2)
    Else
        Worksheets(sArk).Cells(iNrP, 7).Value = "-"
    End If
Next
dRazem = Worksheets(sArk).Cells(19, 6).Value

For iNrP = 19 To 30
    If dRazem <> 0 Then
        Worksheets(sArk).Cells(iNrP, 7).Value = Round(Worksheets(sArk).Cells(iNrP, 6).Value * 100 / dRazem, 2)
    Else
        Worksheets(sArk).Cells(iNrP, 7).Value = "-"
    End If
Next
dRazem = Worksheets(sArk).Cells(31, 6).Value
For iNrP = 31 To 42
    If dRazem <> 0 Then
        Worksheets(sArk).Cells(iNrP, 7).Value = Round(Worksheets(sArk).Cells(iNrP, 6).Value * 100 / dRazem, 2)
    Else
        Worksheets(sArk).Cells(iNrP, 7).Value = "-"
    End If
Next

If Not bMultiTarget Then
    Select Case iNrW
        Case 17, 30, 41
            Check4Kolor.Check4Kolor sArk, iNrW, iNrK
            Select Case iNrK
                Case 2, 6
                    If vWartosc <> "" Then
                        If Worksheets(sArk).Cells(iNrW, 2).Value = "Pozosta|fffd|e (JAKIE?)" Then
                            If vWartosc <> 0 Then
                                Wal.SetKolor sArk, "b" & iNrW, 3, "Brak danych"
                            Else
                                Wal.SetKolor sArk, "b" & iNrW, xlNone, "-"
                            End If
                        Else
                            Wal.SetKolor sArk, "b" & iNrW, xlNone, "-"
                        End If
                    End If
            End Select
        Case Else
            Check4Kolor.Check4Kolor sArk, iNrW, iNrK
    End Select
Else
    For iNrP = 7 To 42
        Select Case iNrP
            Case 7 To 17, 20 To 30, 32 To 42
                Check4Kolor.Check4Kolor sArk, iNrP, 6
        End Select
    Next
End If

'formula
Worksheets(sArk).Cells(18, 6).Value = Worksheets(sArk).Cells(19, 6).Value + Worksheets(sArk).Cells(31, 6).Value
Worksheets(sArk).Cells(5, 6).Value = Worksheets(sArk).Cells(6, 6).Value + Worksheets(sArk).Cells(18, 6).Value

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_180"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrK = 4 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_200"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrK = 4 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_220"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrP, iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

Application.ScreenUpdating = False
Application.EnableEvents = False

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

sArk = ActiveSheet.Name

Worksheets(sArk).Unprotect Password:=sPassS

For iNrP = 5 To 9
    If iNrP <> 5 Then
        Worksheets(sArk).Cells(iNrP, 4).Value = Worksheets("Struktura_rodz_rd").Cells(iNrP + 2, 5).Value
    End If
    If Worksheets(sArk).Cells(iNrP, 4).Value <> 0 Then
        Worksheets(sArk).Cells(iNrP, 5).Value = Worksheets(sArk).Cells(iNrP, 3).Value / Worksheets(sArk).Cells(iNrP, 4).Value
    Else
        Worksheets(sArk).Cells(iNrP, 5).Value = "-"
    End If
Next

'Formula
Worksheets(sArk).Cells(5, 4).Value = Worksheets(sArk).Cells(6, 4).Value + _
Worksheets(sArk).Cells(7, 4).Value + Worksheets(sArk).Cells(8, 4).Value + _
Worksheets(sArk).Cells(9, 4).Value

Worksheets(sArk).Cells(5, 3).Value = Worksheets(sArk).Cells(6, 3).Value + _
Worksheets(sArk).Cells(7, 3).Value + Worksheets(sArk).Cells(8, 3).Value + _
Worksheets(sArk).Cells(9, 3).Value

'walidacja
For iNrP = 6 To 9
    If Worksheets(sArk).Range("c" & iNrP).Value = "" Then
        Wal.SetKolor sArk, "c" & iNrP, 3, "Brak danych"
    Else
        If Worksheets(sArk).Range("c" & iNrP).Value <> 0 And Worksheets(sArk).Range("d" & iNrP).Value = 0 Then
            Wal.SetKolor sArk, "c" & iNrP, 3, "B|fffd||fffd|dne dane"
        Else
            Wal.SetKolor sArk, "c" & iNrP, xlNone, "-"
        End If
    End If
Next

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK, iDlTekstu, iKrotnosc As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

For iNrP = 5 To 9
    If iNrP <> 5 Then
        Worksheets(sArk).Cells(iNrP, 4).Value = Worksheets("Struktura_rodz_rd").Cells(iNrP + 2, 5).Value
    End If
    If Worksheets(sArk).Cells(iNrP, 4).Value <> 0 Then
        Worksheets(sArk).Cells(iNrP, 5).Value = Worksheets(sArk).Cells(iNrP, 3).Value / Worksheets(sArk).Cells(iNrP, 4).Value
    Else
        Worksheets(sArk).Cells(iNrP, 5).Value = "-"
    End If
Next

'Formula
Worksheets(sArk).Cells(5, 4).Value = Worksheets(sArk).Cells(6, 4).Value + _
Worksheets(sArk).Cells(7, 4).Value + Worksheets(sArk).Cells(8, 4).Value + _
Worksheets(sArk).Cells(9, 4).Value

Worksheets(sArk).Cells(5, 3).Value = Worksheets(sArk).Cells(6, 3).Value + _
Worksheets(sArk).Cells(7, 3).Value + Worksheets(sArk).Cells(8, 3).Value + _
Worksheets(sArk).Cells(9, 3).Value

'walidacja
For iNrP = 6 To 9
    If Worksheets(sArk).Range("c" & iNrP).Value = "" Then
        Wal.SetKolor sArk, "c" & iNrP, 3, "Brak danych"
    Else
        If Worksheets(sArk).Range("c" & iNrP).Value <> 0 And Worksheets(sArk).Range("d" & iNrP).Value = 0 Then
            Wal.SetKolor sArk, "c" & iNrP, 3, "B|fffd||fffd|dne dane"
        Else
            Wal.SetKolor sArk, "c" & iNrP, xlNone, "-"
        End If
    End If
Next

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub



Attribute VB_Name = "D_230"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

Application.ScreenUpdating = False
Application.EnableEvents = False
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If
Worksheets(sArk).Unprotect Password:=sPassS

Wal4Sposoby sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

If Not Worksheets("Info").Range("Porada").Value Then
    MsgBox sPorada, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK, iDlTekstu, iKrotnosc As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean
Dim dRowHeight As Double

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

Wal4Sposoby sArk

iDlTekstu = Len(vWartosc)
iKrotnosc = Int(iDlTekstu / 100) + 1

If iKrotnosc = 0 Then
    iKrotnosc = 1
End If

dRowHeight = 14 * iKrotnosc
If dRowHeight > 405 Then
    dRowHeight = 405
End If

Worksheets(sArk).Rows(iNrW).RowHeight = dRowHeight

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    If Target.AddressLocal <> "$A$6:$E$6" And Target.AddressLocal <> "$A$7:$E$7" Then
        Exit Sub
    End If
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

If iNrW = 6 And iNrK = 1 Then
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    If IsEmpty(sPassS) Then
        Application.Run "Auto.Ini4Pub"
    End If
    Worksheets(sArk).Unprotect Password:=sPassS
    Wal.SetKolor sArk, "a7", xlNone
    Worksheets(sArk).Protect Password:=sPassS
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    
    UF_TN.Show
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    If Worksheets(sArk).Range("a6").Value = "Tak" Then
        UF_InwNaDzialce.Show
        If Worksheets(sArk).Range("a7").Value = "" Then
            If IsEmpty(sPassS) Then
                Application.Run "Auto.Ini4Pub"
            End If
            Worksheets(sArk).Unprotect Password:=sPassS
            Wal.SetKolor sArk, "a7", 3, "-"
            Worksheets(sArk).Protect Password:=sPassS
        Else
            Worksheets(sArk).Unprotect Password:=sPassS
            Wal.SetKolor sArk, "a7", xlNone
            Worksheets(sArk).Protect Password:=sPassS
        End If
    Else
        Worksheets(sArk).Unprotect Password:=sPassS
        Wal.SetKolor sArk, "a7", xlNone
        Worksheets(sArk).Range("a7").Value = ""
        Worksheets(sArk).Protect Password:=sPassS
    End If
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    
End If

End Sub

Private Sub Wal4Sposoby(pArk)

If Worksheets(pArk).Range("a2").Value = "" Then
    Wal.SetKolor pArk, "a2", 3, "-"
Else
    Wal.SetKolor pArk, "a2", xlNone
End If

If Worksheets(pArk).Range("a4").Value = "" Then
    Wal.SetKolor pArk, "a4", 3, "-"
Else
    Wal.SetKolor pArk, "a4", xlNone
End If

If Worksheets(pArk).Range("a6").Value = "" Then
    Wal.SetKolor pArk, "a6", 3, "-"
Else
    Wal.SetKolor pArk, "a6", xlNone
End If

If Worksheets(pArk).Range("a9").Value = "" Then
    Wal.SetKolor pArk, "a9", 3, "-"
Else
    Wal.SetKolor pArk, "a9", xlNone
End If

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    If Target.AddressLocal <> "$A$6:$E$6" And Target.AddressLocal <> "$A$7:$E$7" Then
        Exit Sub
    End If
End If

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Exit Sub
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

If iNrW = 6 And iNrK = 1 Then
    UF_TN.Show
    If Worksheets(sArk).Range("a6").Value = "Tak" Then
        If Worksheets(sArk).Range("a7").Value = "" Then
            Worksheets(sArk).Unprotect Password:=sPassS
            Wal.SetKolor sArk, "a7", 3, "-"
            Worksheets(sArk).Protect Password:=sPassS
        Else
            Worksheets(sArk).Unprotect Password:=sPassS
            Wal.SetKolor sArk, "a7", xlNone, "-"
            Worksheets(sArk).Protect Password:=sPassS
        End If
    Else
        Application.ScreenUpdating = False
        Application.EnableEvents = False
        Worksheets(sArk).Unprotect Password:=sPassS
        Worksheets(sArk).Range("a7").Value = ""
        Wal.SetKolor sArk, "a7", xlNone, "-"
        Worksheets(sArk).Protect Password:=sPassS
        Application.EnableEvents = True
        Application.ScreenUpdating = True
    End If
End If

If iNrW = 7 And iNrK = 1 Then
    If Worksheets(sArk).Range("a6").Value = "Tak" Then
        UF_InwNaDzialce.Show
        Worksheets(sArk).Unprotect Password:=sPassS
        If Worksheets(sArk).Range("a7").Value = "" Then
            Wal.SetKolor sArk, "a7", 3, "-"
        Else
            Wal.SetKolor sArk, "a7", xlNone, "-"
        End If
        Worksheets(sArk).Protect Password:=sPassS
    Else
        Application.ScreenUpdating = False
        Application.EnableEvents = False
        Worksheets(sArk).Unprotect Password:=sPassS
        Worksheets(sArk).Range("a7").Value = ""
        Wal.SetKolor sArk, "a7", xlNone, "-"
        Worksheets(sArk).Protect Password:=sPassS
        Application.EnableEvents = True
        Application.ScreenUpdating = True
    End If
End If

Cancel = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_400"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

Application.ScreenUpdating = False
Application.EnableEvents = False
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4Obl_rb.Nal4Obl_rb"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Attribute VB_Name = "D_500"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

Application.ScreenUpdating = False
Application.EnableEvents = False
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4Obl_rd.Nal4Obl_rd"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub
Attribute VB_Name = "D_600"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

Application.ScreenUpdating = False
Application.EnableEvents = False
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If
Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4BSO.Nal4BSO"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub
Attribute VB_Name = "D_700"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

Application.ScreenUpdating = False
Application.EnableEvents = False
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If
Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4All.Nal4All"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_800"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

Application.ScreenUpdating = False
Application.EnableEvents = False
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If
Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4All.Nal4All"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_900"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim sArk As String

Application.Run "M_Select.De_M_Select"

sArk = ActiveSheet.Name

Application.ScreenUpdating = False
Application.EnableEvents = False
If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If
Worksheets(sArk).Unprotect Password:=sPassS

Application.Run "Nal4All.Nal4All"

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)

Cancel = True

End Sub

Attribute VB_Name = "D_910"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

sArk = ActiveSheet.Name

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_DW").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 4 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4Sp_p_w sArk
    LP4Sp_p_w sArk
    Formula4Sp_p_w sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Sp_p_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Sp_p_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Cancel = False

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
Dim sArk As String

sArk = Target.Worksheet.Name

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Sp_p_w sArk
Formula4Sp_p_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True
Cancel = True

End Sub

Private Sub Usuw4Sp_p_w(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 5 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 7
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 705 To 699 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4Sp_p_w(pArk)
Dim iNrWW As Double

For iNrWW = 5 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 4 & "."
Next

End Sub

Private Sub Formula4Sp_p_w(pArk)
Dim iNrWW As Integer
Dim dWartosc, dRazem As Double

dRazem = 0
dWartosc = 0
For iNrWW = 5 To 701
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    dWartosc = Worksheets(pArk).Cells(iNrWW, 4).Value * Worksheets(pArk).Cells(iNrWW, 5).Value
    Worksheets(pArk).Cells(iNrWW, 6).Value = dWartosc
    dRazem = dRazem + Worksheets(pArk).Cells(iNrWW, 6).Value
Next

Worksheets(pArk).Cells(4, 6).Value = dRazem

End Sub
Attribute VB_Name = "D_911"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Worksheet_Activate()
Dim iNrWT, iNrK As Integer
Dim vWynik, vPKol
Dim sArk As String

sArk = ActiveSheet.Name

Application.Run "M_Select.De_M_Select"

If Not Worksheets("Info").Range("Porada_DW").Value Then
    MsgBox sPorada_DW, vbInformation, "Porada..."
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Porada_DW").Value = True
    Worksheets("Info").Protect Password:=sPassS
    Application.ScreenUpdating = True
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

Application.ScreenUpdating = False
Application.EnableEvents = False

On Error GoTo ErrH:

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column

If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Or Worksheets(sArk).Columns(iNrK).EntireColumn.Hidden Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Application.Undo
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    On Error GoTo 0
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS

If iNrW > 4 Then
    If vWartosc <> "" Then
        Wal.SetKolor sArk, sAdres, xlNone, "-"
    Else
        Wal.SetKolor sArk, sAdres, 3, "-"
    End If
    'Usuwanie pustego wiersza
    Usuw4Sp_p_w sArk
    LP4Sp_p_w sArk
    Formula4Sp_p_w sArk
End If

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Exit Sub
ErrH:
MsgBox "Wyst|fffd|pi|fffd| b|fffd||fffd|d. Nast|fffd|pi zamkni|fffd|cie MS Excel BEZ zapisywania zmian w skoroszycie!", vbCritical, "Kontrola jako|fffd|ci danych..."
bBlad = True
Application.DisplayAlerts = False
Application.Quit

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk, sAdres As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If vWartosc <> "" Then
    Exit Sub
End If

sAdres = Chr(iNrK + 96) & iNrW

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Sp_p_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub

Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
Dim iNrW, iNrK, iNrP, iNrWW, iNrKK As Integer
Dim sArk As String
Dim vWartosc
Dim bCosJest, bMultiTarget As Boolean

Application.Run "M_Select.Check4M_Select"

sArk = Target.Worksheet.Name
iNrW = Target.Row
iNrK = Target.Column
vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value

If Target.Cells.Count > 1 Then
    bMultiTarget = True
Else
    bMultiTarget = False
End If

If bMultiTarget Then
    Exit Sub
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Sp_p_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True

Cancel = False

End Sub

Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
Dim sArk As String

sArk = Target.Worksheet.Name

Application.Run "M_Select.Check4M_Select"

Application.Run "MPopUpM_M.CreateDisplayPopUpMenu"

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

LP4Sp_p_w sArk
Formula4Sp_p_w sArk

Worksheets(sArk).Protect Password:=sPassS
Application.EnableEvents = True
Application.ScreenUpdating = True
Cancel = True

End Sub

Private Sub Usuw4Sp_p_w(pArk)
Dim iNrWW, iNrKK As Double
Dim bCosJest As Boolean
Dim vWynik
Dim sAdres As String

For iNrWW = 5 To 2100
    bCosJest = False
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    For iNrKK = 2 To 6
        sAdres = Chr(iNrKK + 96) & iNrWW
        If VarType(Worksheets(pArk).Cells(iNrWW, iNrKK).Value) > 1 Then
            bCosJest = True
            Wal.SetKolor pArk, sAdres, xlNone, "-"
        Else
            Wal.SetKolor pArk, sAdres, 3, "-"
        End If
    Next
    If Not bCosJest Then
        Worksheets(pArk).Rows(iNrWW).Delete Shift:=xlUp
        iNrWW = iNrWW - 1
    End If
Next
For iNrWW = 705 To 699 Step -1
    vWynik = Worksheets(pArk).Cells(iNrWW - 1, 1).Value
    If vWynik <> "" Then
        Exit For
    End If
    If Not Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(pArk).Cells(iNrWW, iNrKK).Value = ""
'        Next
        Worksheets(pArk).Range(Worksheets(pArk).Cells(iNrWW, 1), Worksheets(pArk).Cells(iNrWW, 200)).ClearContents
        Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden = True
    End If
Next

End Sub

Private Sub LP4Sp_p_w(pArk)
Dim iNrWW As Double

For iNrWW = 5 To 2100
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 4 & "."
Next

End Sub

Private Sub Formula4Sp_p_w(pArk)
Dim iNrWW As Integer
Dim dWartosc, dRazem As Double

dRazem = 0
dWartosc = 0
For iNrWW = 5 To 701
    If Worksheets(pArk).Rows(iNrWW).EntireRow.Hidden Then
        Exit For
    End If
    dWartosc = Worksheets(pArk).Cells(iNrWW, 4).Value * Worksheets(pArk).Cells(iNrWW, 5).Value
    Worksheets(pArk).Cells(iNrWW, 6).Value = dWartosc
    dRazem = dRazem + Worksheets(pArk).Cells(iNrWW, 6).Value
Next

Worksheets(pArk).Cells(4, 6).Value = dRazem

End Sub
Attribute VB_Name = "D_999"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Info_A"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Info_I"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Info_P"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Infor_O"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "MPopUpM_M"
Option Explicit
Option Base 1

Private Sub DeletePopUpMenu()
    On Error Resume Next
    Application.CommandBars(MPopUpM).Delete
    On Error GoTo 0
End Sub

Private Sub CreateDisplayPopUpMenu()
    DeletePopUpMenu

    MojePopUPMenu

    On Error Resume Next
    Application.CommandBars(MPopUpM).ShowPopup
    On Error GoTo 0
End Sub

Private Sub MojePopUPMenu()
Dim MenuItem As CommandBarPopup
Dim sArk As String
Dim iNrW As Double

sArk = ActiveSheet.Name
iNrW = ActiveCell.Row

With Application.CommandBars.Add(Name:=MPopUpM, Position:=msoBarPopup, _
     MenuBar:=False, Temporary:=True)

    With .Controls.Add(Type:=msoControlButton)
        .Caption = "Dodaj pusty wiersz"
        .FaceId = 137
        .OnAction = "'" & ThisWorkbook.Name & "'!" & "Dodaj_wiersz"
    End With
    
    If sArk = "Dzialki" Then
        If iNrW > 16 Then
            With .Controls.Add(Type:=msoControlButton)
                .Caption = "Dodaj wiersz z bie|fffd||fffd|cego"
                .FaceId = 2134
                .OnAction = "'" & ThisWorkbook.Name & "'!" & "Dodaj_z_biezacego"
            End With
        End If
    End If

    If (sArk = "Dzialki" And iNrW > 16) Or _
    ((sArk = "Uprawy" Or sArk = "Poplony") And iNrW > 6) Or _
    ((sArk = "Srodki_transportowe" Or sArk = "Maszyny_i_urzadzenia" Or sArk = "Budynki_i_budowle") And iNrW > 3) Or _
    ((sArk = "Inwestycje_w_ochrone_srod" Or sArk = "Inwestycje_POZOSTALE" Or sArk = "Sprzedaz_przed_wnioskiem" Or sArk = "Sprzedaz_rd") And iNrW > 4) Then
        With .Controls.Add(Type:=msoControlButton)
            .BeginGroup = True
            .Caption = "Usu|fffd| wiersz"
            .FaceId = 3265
            .OnAction = "'" & ThisWorkbook.Name & "'!" & "Usun_wiersz"
        End With
    End If
End With

End Sub

Private Sub Dodaj_wiersz()
Dim sArk, sZakres As String
Dim dNrW, dNrWRC, dNrKRC As Double
Dim bCosJest As Boolean

DeletePopUpMenu

sArk = ActiveSheet.Name
dNrWRC = ActiveCell.Row

Select Case sArk
    Case "Dzialki"
        If dNrWRC <= 16 Then
            dNrWRC = 17
        End If
        sZakres = "h#nrw:i#nrw, k#nrw:l#nrw"
    Case "Uprawy", "Poplony"
        If dNrWRC <= 6 Then
            dNrWRC = 7
        End If
        sZakres = "f#nrw:g#nrw, j#nrw:k#nrw, ax#nrw:gr#nrw"
    Case "Srodki_transportowe", "Maszyny_i_urzadzenia", "Budynki_i_budowle"
        If dNrWRC <= 3 Then
            dNrWRC = 4
        End If
        sZakres = "b#nrw:e#nrw, ax#nrw:gr#nrw"
    Case "Inwestycje_w_ochrone_srod"
        If dNrWRC <= 4 Then
            dNrWRC = 5
        End If
'        sZakres = "c#nrw:g#nrw, e#nrw:k#nrw, ax#nrw:gr#nrw"
        sZakres = "c#nrw:e#nrw, ax#nrw:gr#nrw"
    Case "Inwestycje_POZOSTALE"
        If dNrWRC <= 4 Then
            dNrWRC = 5
        End If
'        sZakres = "b#nrw:g#nrw, e#nrw:k#nrw, ax#nrw:gr#nrw"
        sZakres = "b#nrw:e#nrw, ax#nrw:gr#nrw"
    Case "Sprzedaz_przed_wnioskiem"
        If dNrWRC <= 4 Then
            dNrWRC = 5
        End If
'        sZakres = "b#nrw:g#nrw, e#nrw:k#nrw, ax#nrw:gr#nrw"
        sZakres = "b#nrw:e#nrw, g#nrw:g#nrw"
    Case "Sprzedaz_rd"
        If dNrWRC <= 4 Then
            dNrWRC = 5
        End If
'        sZakres = "b#nrw:g#nrw, e#nrw:k#nrw, ax#nrw:gr#nrw"
        sZakres = "b#nrw:e#nrw"
End Select

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

For dNrW = dNrWRC To 1000
    If Worksheets(sArk).Rows(dNrW).EntireRow.Hidden Then
        Worksheets(sArk).Rows(dNrW).EntireRow.Hidden = False
        sZakres = Replace(sZakres, "#nrw", dNrW)
        Worksheets(sArk).Range(sZakres).Locked = False
        Exit For
    End If
Next

Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

Application.EnableEvents = True
Application.ScreenUpdating = True

Select Case sArk
    Case "Dzialki", "Uprawy", "Poplony", "Inwestycje_w_ochrone_srod", "Sprzedaz_przed_wnioskiem", "Sprzedaz_rd"
        Worksheets(sArk).Cells(dNrW, 2).Select
End Select

End Sub

Private Sub Dodaj_z_biezacego()
Dim sArk, sZakres As String
Dim dNrW, dNrWRC As Double

DeletePopUpMenu

sArk = ActiveSheet.Name
dNrWRC = ActiveCell.Row

Select Case sArk
    Case "Dzialki"
        sZakres = "h#nrw:i#nrw, k#nrw:l#nrw"
End Select

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

For dNrW = dNrWRC To 1000
    If Worksheets(sArk).Rows(dNrW).EntireRow.Hidden Then
        Worksheets(sArk).Rows(dNrW).EntireRow.Hidden = False
        sZakres = Replace(sZakres, "#nrw", dNrW)
        Worksheets(sArk).Range(sZakres).Locked = False
        Exit For
    End If
Next

Worksheets(sArk).Cells(dNrW, 2).Value = _
Worksheets(sArk).Cells(dNrWRC, 2).Value
Worksheets(sArk).Cells(dNrW, 3).Value = _
Worksheets(sArk).Cells(dNrWRC, 3).Value
Worksheets(sArk).Cells(dNrW, 4).Value = _
Worksheets(sArk).Cells(dNrWRC, 4).Value
Worksheets(sArk).Cells(dNrW, 6).Value = _
Worksheets(sArk).Cells(dNrWRC, 6).Value

Worksheets(sArk).Cells(dNrW, 101).Value = _
Worksheets(sArk).Cells(dNrWRC, 101).Value
Worksheets(sArk).Cells(dNrW, 102).Value = _
Worksheets(sArk).Cells(dNrWRC, 102).Value
Worksheets(sArk).Cells(dNrW, 103).Value = _
Worksheets(sArk).Cells(dNrWRC, 103).Value

Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

Application.EnableEvents = True
Application.ScreenUpdating = True

Worksheets(sArk).Cells(dNrW, 2).Select

End Sub

Private Sub Usun_wiersz()
Dim sArk As String
Dim iNrW, iNrWRC, iNrKRC, iNrKK, dMaxW, dMaxW_6 As Double
Dim vWartosc

DeletePopUpMenu

sArk = ActiveSheet.Name
iNrWRC = ActiveCell.Row
iNrKRC = ActiveCell.Column

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

Worksheets(sArk).Cells.ClearComments

Worksheets(sArk).Rows(iNrWRC).Delete Shift:=xlUp

Select Case sArk
    Case "Dzialki"
        dMaxW = 65536
        dMaxW_6 = dMaxW - 6
    Case "Uprawy"
        dMaxW = 392
        dMaxW_6 = dMaxW - 6
    Case "Poplony"
        dMaxW = 1881
        dMaxW_6 = dMaxW - 6
    Case "Srodki_transportowe", "Maszyny_i_urzadzenia", "Budynki_i_budowle"
        dMaxW = 705
        dMaxW_6 = dMaxW - 6
    Case "Inwestycje_w_ochrone_srod", "Inwestycje_POZOSTALE", "Sprzedaz_przed_wnioskiem", "Sprzedaz_rd"
        dMaxW = 705
        dMaxW_6 = dMaxW - 6
End Select

For iNrW = dMaxW To dMaxW_6 Step -1
    vWartosc = Worksheets(sArk).Cells(iNrW, 1).Value
    If vWartosc <> "" Then
        Exit For
    End If
    If Not Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Then
'        For iNrKK = 1 To 200
'            Worksheets(sArk).Cells(iNrW, iNrKK).Value = ""
'        Next
        Worksheets(sArk).Range(Worksheets(sArk).Cells(iNrW, 1), Worksheets(sArk).Cells(iNrW, 200)).ClearContents
        Worksheets(sArk).Rows(iNrW).EntireRow.Hidden = True
    End If
Next

Worksheets(sArk).Cells(iNrWRC - 1, iNrKRC).Select

Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub
Attribute VB_Name = "M_Select"
Option Explicit
Option Base 1

Private Sub Check4M_Select()

If ActiveWindow.SelectedSheets.Count > 1 Then
    MsgBox "Uwaga! Ze wzgl|fffd|du na zaznaczeniu wielu arkuszy nast|fffd|pi zamkni|fffd|cie skoroszytu BEZ zapisywania!", vbCritical, "Kontrola jako|fffd|ci danych..."
    ActiveWorkbook.Close SaveChanges:=False
End If

End Sub

Private Sub De_M_Select()

If ActiveWindow.SelectedSheets.Count > 1 Then
    ActiveSheet.Select
End If

End Sub
Attribute VB_Name = "Nal4All"
Option Explicit
Option Base 1

Private Sub Nal4All()
Dim sArk As String

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False

sArk = "Struktura_rodz_rb"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Str_r_rb.Nal4Str_r_rb"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Struktura_rodz_rd"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Str_r_rd.Nal4Str_r_rd"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Struktura_wlas_rb"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Str_w_rb.Nal4Str_w_rb"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Struktura_wlas_rd"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Str_w_rd.Nal4Str_w_rd"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Obliczenia_rb"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Obl_rb.Nal4Obl_rb"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Obliczenia_rd"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Obl_rd.Nal4Obl_rd"
Worksheets(sArk).Protect Password:=sPassS

sArk = "BSO_oraz_SN_rd"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4BSO.Nal4BSO"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Zestawienie"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Pods.Nal4Pods"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Kryteria_dostepu"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Kryt_d.Nal4Kryt_d"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Kryteria_pkt"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Kryt_pkt.Nal4Kryt_pkt"
Worksheets(sArk).Protect Password:=sPassS

sArk = "Zestawienie"
Worksheets(sArk).Unprotect Password:=sPassS
Application.Run "Nal4Pods.Nal4SK"
Worksheets(sArk).Protect Password:=sPassS

Application.EnableEvents = True
Application.ScreenUpdating = True

End Sub
Attribute VB_Name = "Nal4BSO"
Option Explicit
Option Base 1

Private Sub Nal4BSO()
Dim iNrW, iIlW, iNrWA, iNrKA As Integer
Dim sFormula As String

iIlW = Worksheets("Formula4BSO").UsedRange.Rows.Count

'formula
For iNrW = 2 To iIlW
    With Worksheets("Formula4BSO")
        iNrWA = .Cells(iNrW, 1).Value
        iNrKA = .Cells(iNrW, 2).Value
        sFormula = Replace(.Cells(iNrW, 3).Value, "'", "")
    End With
    Worksheets("BSO_Oraz_SN_rd").Cells(iNrWA, iNrKA).Formula = sFormula
Next

Worksheets("BSO_Oraz_SN_rd").Range("d4:e14").ClearContents
Worksheets("BSO_Oraz_SN_rd").Range("d18:e40").ClearContents
Worksheets("BSO_Oraz_SN_rd").Range("d43:d48").ClearContents
Worksheets("BSO_Oraz_SN_rd").Range("r51").ClearContents

OdczytZUprawy_BSO

OdczytZPoplony_BSO

OdczytZeZwierzat_BSO

OdczytZRozchodow

OdczytZPrzychodow

OdczytZNawozenia

'formula
For iNrW = 2 To iIlW
    With Worksheets("Formula4BSO")
        iNrWA = .Cells(iNrW, 1).Value
        iNrKA = .Cells(iNrW, 2).Value
    End With
    Worksheets("BSO_Oraz_SN_rd").Cells(iNrWA, iNrKA).Value = Worksheets("BSO_Oraz_SN_rd").Cells(iNrWA, iNrKA).Value
Next

End Sub

Private Sub OdczytZUprawy_BSO()
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sUprawa, sKod, sJM As String
Dim dIlosc, dPlon As Double
Dim vWartosc, vWynik

For iNrW = 7 To 303
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa = "" Then
        Exit For
    End If
    sKod = Worksheets("Uprawy").Cells(iNrW, 112).Value
    iPlon = Worksheets("Uprawy").Cells(iNrW, 113).Value
    sJM = Worksheets("Uprawy").Cells(iNrW, 3).Value
    dIlosc = Worksheets("Uprawy").Cells(iNrW, 10).Value
    
    dPlon = Worksheets("Uprawy").Cells(iNrW, 11).Value
    If sJM <> "ha" Then
        dIlosc = dIlosc / 10000
        dPlon = dPlon * 10000
    End If
    'zbior
    dPlon = dIlosc * dPlon / 10
    
    With Worksheets("BSO_oraz_SN_rd").Range("a1:A10000")
        Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWW = vWynik.Row
        Else
            iNrWW = 0
        End If
    End With
    If iNrWW >= 4 Then
        Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 4).Value = Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 4).Value + dIlosc
        If iPlon = 1 Then
            Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 5).Value = Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 5).Value + dPlon
        End If
    End If
Next
'plon
For iNrWW = 4 To 13
    dIlosc = Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 4).Value
    dPlon = Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 5).Value
    If dIlosc <> 0 Then
        Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 5).Value = dPlon / dIlosc
    Else
        Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 5).Value = 0
    End If
Next

End Sub

Private Sub OdczytZPoplony_BSO()
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sUprawa, sKod, sJM As String
Dim dIlosc, dPlon As Double
Dim vWartosc, vWynik

Worksheets("BSO_oraz_SN_rd").Range("d14").Value = Worksheets("Poplony").Range("UR_Uprawy_rd").Value

End Sub

Private Sub OdczytZeZwierzat_BSO()
Dim iNrW, iNrP, iNrWW As Integer
Dim sKod As String
Dim dSS, dSS_o, dSS_g As Double
Dim vWartosc, vWynik

For iNrW = 6 To 303
    dSS = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 12).Value
    If dSS <> 0 Then
        sKod = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 112).Value

        dSS_o = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 13).Value
        dSS_g = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 14).Value

        With Worksheets("BSO_oraz_SN_rd").Range("a1:A10000")
            Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
            If Not vWynik Is Nothing Then
                iNrWW = vWynik.Row
            Else
                iNrWW = 0
            End If
        End With
        If iNrWW > 4 Then
            Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 4).Value = Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 4).Value + dSS_o
            Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 5).Value = Worksheets("BSO_Oraz_SN_rd").Cells(iNrWW, 5).Value + dSS_g
        End If
    End If
Next

End Sub

Private Sub OdczytZRozchodow()

Worksheets("BSO_Oraz_SN_rd").Range("d43").Value = Worksheets("Planowane_ZAKUPY_NO_i_S_rd").Range("Zakup_S").Value
Worksheets("BSO_Oraz_SN_rd").Range("d45").Value = Worksheets("Planowane_ZAKUPY_NO_i_S_rd").Range("Zakup_O").Value
Worksheets("BSO_Oraz_SN_rd").Range("d47").Value = Worksheets("Planowane_ZAKUPY_NO_i_S_rd").Range("Zakup_G").Value

End Sub

Private Sub OdczytZPrzychodow()

Worksheets("BSO_Oraz_SN_rd").Range("d44").Value = Worksheets("Planowane_SPRZEDAZE_NO_i_S_rd").Range("Sprzedaz_S").Value
Worksheets("BSO_Oraz_SN_rd").Range("d46").Value = Worksheets("Planowane_SPRZEDAZE_NO_i_S_rd").Range("Sprzedaz_O").Value
Worksheets("BSO_Oraz_SN_rd").Range("d48").Value = Worksheets("Planowane_SPRZEDAZE_NO_i_S_rd").Range("Sprzedaz_G").Value

End Sub

Private Sub OdczytZNawozenia()

Worksheets("BSO_Oraz_SN_rd").Range("r51").Value = Worksheets("Nawozenie_rd").Range("Nawozenie_N").Value

End Sub



Attribute VB_Name = "Nal4Kryt_d"
Option Explicit
Option Base 1

Private Sub Nal4Kryt_d()
Dim dSK, dDPD_rb, dDPD_rd, dDK_rb, dDK_rd, dPUp_I As Double
Dim vWartosc, vWynik
Dim sSK, sWartosc, sZ, sKod As String
Dim iNrW, iNrK, iDl, iNr, iNrWW As Integer
Dim bJestFind As Boolean

'Odczyt WE_rb
Worksheets("Kryteria_dostepu").Cells(4, 4).Value = Worksheets("Obliczenia_rb").Range("WE").Value
'Odczyt WE_rd
Worksheets("Kryteria_dostepu").Cells(5, 4).Value = Worksheets("Obliczenia_rd").Range("WE").Value

'formula
If Worksheets("Kryteria_dostepu").Cells(5, 4).Value > Worksheets("Kryteria_dostepu").Cells(4, 4).Value Then
    If Worksheets("Kryteria_dostepu").Cells(4, 4).Value <> 0 Then
        Worksheets("Kryteria_dostepu").Cells(6, 4).Value = Round((Worksheets("Kryteria_dostepu").Cells(5, 4).Value - Worksheets("Kryteria_dostepu").Cells(4, 4).Value) * 100 / Worksheets("Kryteria_dostepu").Cells(4, 4).Value, 2)
    Else
        Worksheets("Kryteria_dostepu").Cells(6, 4).Value = 0
    End If
Else
    Worksheets("Kryteria_dostepu").Cells(6, 4).Value = 0
End If

For iNrW = 7 To 15
    sKod = Worksheets("Struktura_wlas_rb").Cells(iNrW, 10).Value
    If sKod = "" Then
        Exit For
    End If
    If sKod = "DPD" Then
        dDPD_rb = Worksheets("Struktura_wlas_rb").Cells(iNrW, 6).Value
    End If
    If sKod = "DK" Then
        dDK_rb = Worksheets("Struktura_wlas_rb").Cells(iNrW, 6).Value
    End If
Next
dPUp_I = 0
For iNrW = 7 To 15
    sKod = Worksheets("Struktura_wlas_rd").Cells(iNrW, 10).Value
    If sKod = "" Then
        Exit For
    End If
    If sKod = "DPD" Then
        dDPD_rd = Worksheets("Struktura_wlas_rd").Cells(iNrW, 6).Value
    End If
    If sKod = "DK" Then
        dDK_rd = Worksheets("Struktura_wlas_rd").Cells(iNrW, 6).Value
    End If
    If sKod <> "I" Then
        dPUp_I = dPUp_I + Worksheets("Struktura_wlas_rd").Cells(iNrW, 6).Value
    End If
Next

If dDPD_rd > dDPD_rb And dDK_rd > dDK_rb Then
    Worksheets("Kryteria_dostepu").Cells(5, 4).Value = "-"
    Wal.SetKolor "Kryteria_dostepu", "d5", 3, "Pow. dzier|fffd|aw d|fffd|.term. oraz kr.term. w okresie docelowym > pow. w okresie wyj|fffd|ciowym."
    Worksheets("Kryteria_dostepu").Cells(6, 4).Value = "-"
Else
    If dDPD_rd > dDPD_rb Then
        Worksheets("Kryteria_dostepu").Cells(5, 4).Value = "-"
        Wal.SetKolor "Kryteria_dostepu", "d5", 3, "Pow. dzier|fffd|awy d|fffd|.term. w okresie docelowym > pow. w okresie wyj|fffd|ciowym."
        Worksheets("Kryteria_dostepu").Cells(6, 4).Value = "-"
    Else
        If dDK_rd > dDK_rb Then
            Worksheets("Kryteria_dostepu").Cells(5, 4).Value = "-"
            Wal.SetKolor "Kryteria_dostepu", "d5", 3, "Pow. dzier|fffd|awy kr.term. w okresie docelowym > pow. w okresie wyj|fffd|ciowym."
            Worksheets("Kryteria_dostepu").Cells(6, 4).Value = "-"
        Else
            Wal.SetKolor "Kryteria_dostepu", "d5", 15, "-"
        End If
    End If
End If

'odczyt pow. RD
vWartosc = 0

sKod = "W"
bJestFind = False
With Worksheets("Struktura_wlas_rd").Range("j7:j12")
    Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrWW = vWynik.Row
        bJestFind = True
    End If
End With
If bJestFind Then
    vWartosc = vWartosc + Worksheets("Struktura_wlas_rd").Cells(iNrWW, 6).Value
End If

sKod = "UW"
bJestFind = False
With Worksheets("Struktura_wlas_rd").Range("j7:j12")
    Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrWW = vWynik.Row
        bJestFind = True
    End If
End With

If bJestFind Then
    vWartosc = vWartosc + Worksheets("Struktura_wlas_rd").Cells(iNrWW, 6).Value
End If
sKod = "DD"
bJestFind = False
With Worksheets("Struktura_wlas_rd").Range("j7:j12")
    Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrWW = vWynik.Row
        bJestFind = True
    End If
End With
If bJestFind Then
    vWartosc = vWartosc + Worksheets("Struktura_wlas_rd").Cells(iNrWW, 6).Value
End If
Worksheets("Kryteria_dostepu").Cells(7, 4).Value = vWartosc

'Odczyt ur
Worksheets("Kryteria_dostepu").Cells(8, 4).Value = dPUp_I

'Obliczenie udzialu
If Worksheets("Kryteria_dostepu").Cells(8, 4).Value <> 0 Then
    Worksheets("Kryteria_dostepu").Cells(9, 4).Value = Round((Worksheets("Kryteria_dostepu").Cells(7, 4).Value) * 100 / _
    Worksheets("Kryteria_dostepu").Cells(8, 4).Value, 2)
Else
    Worksheets("Kryteria_dostepu").Cells(9, 4).Value = "-"
End If
'Odczyt udz. inw.
Worksheets("Kryteria_dostepu").Cells(10, 4).Value = Worksheets("Zestawienie").Range("Udzial_Inw").Value

'Obliczenie relacji wydatkow
If Worksheets("Zestawienie").Cells(9, 4).Value <> 0 Then
    Worksheets("Kryteria_dostepu").Cells(11, 4).Value = Round((Worksheets("Zestawienie").Cells(8, 4).Value + Worksheets("Zestawienie").Cells(6, 4).Value + Worksheets("Zestawienie").Cells(7, 4).Value) * 100 / _
    Worksheets("Zestawienie").Cells(9, 4).Value, 2)
Else
    Worksheets("Kryteria_dostepu").Cells(11, 4).Value = "-"
End If

If Left(Worksheets("Zestawienie").Cells(17, 4).Value, 4) = "Brak" Then
    Worksheets("Kryteria_dostepu").Cells(4, 4).Value = 0
    Worksheets("Kryteria_dostepu").Cells(5, 4).Value = 0
End If

'Suma kontrolna
iNrW = 13
dSK = 0
iNrK = 4
For iNrW = 4 To 100
    If Worksheets("Kryteria_dostepu").Cells(iNrW, 1).Value = "" Then
        Exit For
    End If
    vWartosc = Worksheets("Kryteria_dostepu").Cells(iNrW, iNrK).Value
    If VarType(vWartosc) <> vbString Then
        sWartosc = CStr(vWartosc)
    Else
        sWartosc = vWartosc
    End If
    iDl = Len(sWartosc)
    For iNr = 1 To iDl
        sZ = Mid(sWartosc, iNr, 1)
        dSK = dSK + iNrW * iNrK * iNr * Asc(sZ)
    Next
Next
Worksheets("Kryteria_dostepu").Cells(iNrW, iNrK).Value = dSK

End Sub

Attribute VB_Name = "Nal4Kryt_pkt"
Option Explicit
Option Base 1

Private Sub Nal4Kryt_pkt()
Dim dSK, dZasiewy, dPremia, dPkt_, dO_, dU_, dM_ As Double
Dim vWartosc
Dim sSK, sWartosc, sZ As String
Dim iNrW, iNrK, iDl, iNr As Integer
Dim bJestInw_bud As Boolean

'Odczyt WE_rd
Worksheets("Kryteria_pkt").Cells(4, 4).Value = Worksheets("Kryteria_dostepu").Cells(5, 4).Value
'Odczyt uczestnictwa sys. jako.
Worksheets("Kryteria_pkt").Cells(5, 4).Value = Left(Worksheets("Cele").Range("Uczestnictwo").Value, 1)
'Odczyt uczestnictwa sys. eko.
Worksheets("Kryteria_pkt").Cells(6, 4).Value = Left(Worksheets("Cele").Range("Uczestnictwo_eko").Value, 1)
'Odczyt wysokobia|fffd|kowych
If Worksheets("Obliczenia_rd").Range("Wysokobialkowe").Value >= 1 Then
    Worksheets("Kryteria_pkt").Cells(7, 4).Value = "T"
Else
    Worksheets("Kryteria_pkt").Cells(7, 4).Value = "N"
End If
'Odczyt inwestycji bud.
bJestInw_bud = False
'For iNrW = 5 To 1000
'    vWartosc = Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 1).Value
'    If vWartosc = "" Then
'        Exit For
'    End If
'    If Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 6).Value = "Tak" Then
'        bJestInw_bud = True
'        Exit For
'    End If
'Next
'If Not bJestInw_bud Then
'    For iNrW = 5 To 1000
'        vWartosc = Worksheets("Inwestycje_POZOSTALE").Cells(iNrW, 1).Value
'        If vWartosc = "" Then
'            Exit For
'        End If
'        If Worksheets("Inwestycje_POZOSTALE").Cells(iNrW, 6).Value = "Tak" Then
'            bJestInw_bud = True
'            Exit For
'        End If
'    Next
'End If
If Worksheets("Pozostale_informacje").Range("a6") = "Tak" Then
    bJestInw_bud = True
End If

If bJestInw_bud Then
    Worksheets("Kryteria_pkt").Cells(8, 4).Value = "T"
Else
    Worksheets("Kryteria_pkt").Cells(8, 4).Value = "N"
End If
'Odczyt udz. w szk.
vWartosc = 0
If Worksheets("Cele").Cells(27, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(29, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(31, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(33, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
Worksheets("Kryteria_pkt").Cells(9, 4).Value = vWartosc
'Odczyt korzystania z ud
vWartosc = 0
If Worksheets("Cele").Cells(36, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(38, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(40, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(42, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
Worksheets("Kryteria_pkt").Cells(10, 4).Value = vWartosc
'Odczyt udzia|fffd| we wsp
Worksheets("Kryteria_pkt").Cells(11, 4).Value = Left(Worksheets("Cele").Range("Udzial_we_wsp").Value, 1)
'Odczyt przyg
Worksheets("Kryteria_pkt").Cells(12, 4).Value = Left(Worksheets("Cele").Range("Prowadzenie_przyg").Value, 1)
'Odczyt przet
Worksheets("Kryteria_pkt").Cells(13, 4).Value = Left(Worksheets("Cele").Range("Prowadzenie_przet").Value, 1)
'Odczyt udz. zboz
dZasiewy = Worksheets("Struktura_rodz_rd").Range("GOO").Value
If dZasiewy <> 0 Then
    Worksheets("Kryteria_pkt").Cells(14, 4).Value = _
    Round(Worksheets("Obliczenia_rd").Range("Zboza").Value * 100 / dZasiewy, 2)
Else
    Worksheets("Kryteria_pkt").Cells(14, 4).Value = 0
End If
'Odczyt planu nawozowego
Worksheets("Kryteria_pkt").Cells(15, 4).Value = _
Left(Worksheets("Cele").Range("Plan_nawozowy").Value, 1)
'obliczenie pkt
dPremia = Worksheets("Zestawienie").Range("Premia").Value
dPkt_ = 0
dM_ = Application.WorksheetFunction.Max(Worksheets("Inwestycje_M").Range("c2:c1000"))
For iNrW = 5 To 1000
    vWartosc = Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 1).Value
    If vWartosc = "" Then
        Exit For
    End If
    dO_ = Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 101).Value
    If dPremia <> 0 Then
        dU_ = Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 4).Value / dPremia
        If dU_ > 1 Then
            dU_ = 1
        End If
    Else
        dU_ = 0
    End If
    dPkt_ = dPkt_ + (dO_ * dU_ * 15) / dM_
Next
Worksheets("Kryteria_pkt").Cells(16, 4).Value = Round(dPkt_, 2)
'Odczyt postepu biol.
Worksheets("Kryteria_pkt").Cells(17, 4).Value = _
Left(Worksheets("Cele").Range("Postep_biologiczny").Value, 1)
'Odczyt org. prod.
Worksheets("Kryteria_pkt").Cells(18, 4).Value = _
Left(Worksheets("Cele").Range("Organizacja_produkcji").Value, 1)
'Odczyt nowoczesnych technologii
Worksheets("Kryteria_pkt").Cells(19, 4).Value = _
Left(Worksheets("Cele").Range("Nowoczesne_technologie").Value, 1)
'Odczyt innowacyjnego prod.
Worksheets("Kryteria_pkt").Cells(20, 4).Value = _
Left(Worksheets("Cele").Range("Innowacyjny_produkt").Value, 1)
'Odczyt wojewodztwa
Worksheets("Kryteria_pkt").Cells(21, 4).Value = _
Worksheets("Info").Range("Wojewodztwo").Value
'Zaplanowano zmiane produkcji
Worksheets("Kryteria_pkt").Cells(22, 4).Value = _
Left(Worksheets("Zestawienie").Range("D32").Value, 1)

If Left(Worksheets("Zestawienie").Cells(17, 4).Value, 4) = "Brak" Then
    Worksheets("Kryteria_pkt").Cells(4, 4).Value = 0
End If

'Suma kontrolna
iNrW = 23
dSK = 0
iNrK = 4
For iNrW = 4 To 100
    If Worksheets("Kryteria_pkt").Cells(iNrW, 1).Value = "" Then
        Exit For
    End If
    vWartosc = Worksheets("Kryteria_pkt").Cells(iNrW, iNrK).Value
    If VarType(vWartosc) <> vbString Then
        sWartosc = CStr(vWartosc)
    Else
        sWartosc = vWartosc
    End If
    iDl = Len(sWartosc)
    For iNr = 1 To iDl
        sZ = Mid(sWartosc, iNr, 1)
        dSK = dSK + iNrW * iNrK * iNr * Asc(sZ)
    Next
Next
Worksheets("Kryteria_pkt").Cells(iNrW, iNrK).Value = dSK

End Sub


Attribute VB_Name = "Nal4Obl_rb"
Option Explicit
Option Base 1

Private iNrWW As Integer

Private Sub Nal4Obl_rb()
Dim sArk As String

sArk = "Obliczenia_rb"

With Worksheets(sArk).Range("a3:ai404")
    .ClearContents
    .ClearComments
End With

iNrWW = 3

OdczytZUprawy sArk

OdczytZeZwierzat sArk

OdczytZPozostalej sArk

Application.Run "TF4Pods.TF4Pods", sArk, iNrWW

End Sub

Private Sub OdczytZUprawy(pArk)
Dim iNrW, iNrWWW, iNrP As Integer
Dim sUprawa, sOkrywa As String
Dim dIlosc, dOkrywa As Double
Dim vWartosc, vWynik

For iNrW = 7 To 303
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa = "" Then
        Exit For
    End If
    
    With Worksheets("SO").Range("b1:b1000")
        Set vWynik = .Find(sUprawa, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWWW = vWynik.Row
        End If
    End With
    
    Worksheets("Uprawy").Cells(iNrW, 101).Value = iNrWWW
    
    Select Case Worksheets("Info").Range("NrR")
        Case "A"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 5).Value
        Case "B"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 6).Value
        Case "C"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 7).Value
        Case "D"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 8).Value
    End Select
    '103 pusta na wart
    For iNrP = 9 To 30
        Worksheets("Uprawy").Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWWW, iNrP).Value
    Next
    
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 2 & "."
    Worksheets(pArk).Cells(iNrWW, 2).Value = "Uprawy"
    Worksheets(pArk).Cells(iNrWW, 3).Value = Worksheets("Uprawy").Cells(iNrW, 1).Value
    Worksheets(pArk).Cells(iNrWW, 4).Value = sUprawa
    Worksheets(pArk).Cells(iNrWW, 5).Value = Worksheets("Uprawy").Cells(iNrW, 3).Value
    Worksheets(pArk).Cells(iNrWW, 6).Value = Worksheets("Uprawy").Cells(iNrW, 128).Value
    dIlosc = Worksheets("Uprawy").Cells(iNrW, 6).Value
    If InStr("B;I", Worksheets("Uprawy").Cells(iNrW, 128).Value) = 0 Then
        Worksheets(pArk).Cells(iNrWW, 7).Value = dIlosc
    Else
        Worksheets(pArk).Cells(iNrWW, 7).Value = 0
    End If
    If Worksheets("Uprawy").Cells(iNrW, 5).Value = "Tak" Then
        dOkrywa = dIlosc
    Else
        dOkrywa = 0
    End If
    For iNrP = 8 To 48
        If iNrP <> 9 Then
            Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets("Uprawy").Cells(iNrW, iNrP + 94).Value
        Else
            Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets(pArk).Cells(iNrWW, iNrP - 2).Value * Worksheets(pArk).Cells(iNrWW, iNrP - 1).Value
        End If
        Select Case iNrP
            Case 10
                Worksheets(pArk).Cells(iNrWW, iNrP).Value = dOkrywa
            Case 11, 12, 13
                If Worksheets(pArk).Cells(iNrWW, iNrP).Value = 1 Then
                    If iNrP = 12 Then
                        If Worksheets(pArk).Cells(iNrWW, 5).Value <> "ha" Then
                            Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc / 10000
                        Else
                            Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc
                        End If
                    Else
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc
                    End If
                End If
        End Select
    Next
    
    iNrWW = iNrWW + 1
Next

End Sub

Private Sub OdczytZeZwierzat(pArk)
Dim iNrW, iNrWWW, iNrP, iNrPW, iNrOW As Integer
Dim sZwierze, sKod As String
Dim dIlosc, d30201a, d30201b, d30201, d302, d3030101, d3030201, d30402 As Double
Dim vWartosc, vWynik
Dim bZmiana As Boolean

d30201a = 0
d30201b = 0
d30201 = 0
d302 = 0
d3030101 = 0
d3030201 = 0
d30402 = 0

iNrPW = iNrWW

For iNrW = 5 To 63
    dIlosc = Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 12).Value
    If dIlosc > 0 Then
        sZwierze = Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 2).Value
        Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 2 & "."
        Worksheets(pArk).Cells(iNrWW, 2).Value = "Zwierz|fffd|ta"
        sKod = Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 19).Value
        Worksheets(pArk).Cells(iNrWW, 3).Value = sKod
        Worksheets(pArk).Cells(iNrWW, 4).Value = sZwierze
        Worksheets(pArk).Cells(iNrWW, 5).Value = "szt."
        Worksheets(pArk).Cells(iNrWW, 7).Value = dIlosc
        
        With Worksheets("SO").Range("a1:a1000")
            Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
            If Not vWynik Is Nothing Then
                iNrWWW = vWynik.Row
            End If
        End With
        
        Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 101).Value = iNrWWW
    
        Select Case Worksheets("Info").Range("NrR")
            Case "A"
                Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 5).Value
            Case "B"
                Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 6).Value
            Case "C"
                Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 7).Value
            Case "D"
                Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 8).Value
        End Select
        '103 pusta na wart
        For iNrP = 9 To 30
            Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWWW, iNrP).Value
        Next
        
        Select Case sKod
            Case "3.02.01_a"
                d30201a = d30201a + dIlosc
            Case "3.02.01_b"
                d30201b = d30201b + dIlosc
            Case "3.02.06", "3.02.99"
                d302 = d302 + dIlosc
            Case "3.03.01.01"
                d3030101 = d3030101 + dIlosc
            Case "3.03.02.01"
                d3030201 = d3030201 + dIlosc
            Case "3.04.02"
                d30402 = d30402 + dIlosc
        End Select
        For iNrP = 8 To 48
            If iNrP <> 9 Then
                Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets("Roczne_obroty_zwierzat_rb").Cells(iNrW, iNrP + 94).Value
            Else
                Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets(pArk).Cells(iNrWW, iNrP - 2).Value * Worksheets(pArk).Cells(iNrWW, iNrP - 1).Value
            End If
            Select Case iNrP
                Case 14, 15
                    If Worksheets(pArk).Cells(iNrWW, iNrP).Value > 0 Then
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc * Worksheets(pArk).Cells(iNrWW, iNrP).Value
                    End If
            End Select
        Next
        
        iNrWW = iNrWW + 1
    End If
Next

iNrOW = iNrWW - 1

'przypadki specjalne
d30201 = d30201a + d30201b
If d30201 > d302 Then
    If d30201a > 0 Then
        If d30201 <> 0 Then
            d30201a = d30201a * (d30201 - d302) / d30201
        Else
            d30201a = 0
        End If
        d30201b = (d30201 - d302) - d30201a
    Else
        If d30201 <> 0 Then
            d30201b = d30201b * (d30201 - d302) / d30201
        Else
            d30201b = 0
        End If
        d30201a = (d30201 - d302) - d30201b
    End If
Else
    d30201a = 0
    d30201b = 0
End If

For iNrWW = iNrPW To iNrOW
    sKod = Worksheets(pArk).Cells(iNrWW, 3).Value
    Worksheets(pArk).Cells(iNrWW, 7).ClearComments
    
    Select Case sKod
        Case "3.02.01_a"
            If Worksheets(pArk).Cells(iNrWW, 7).Value <> d30201a Then
                bZmiana = True
            Else
                bZmiana = False
            End If
            Worksheets(pArk).Cells(iNrWW, 7).Value = d30201a
            If bZmiana Then
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With
            End If
        Case "3.02.01_b"
            If Worksheets(pArk).Cells(iNrWW, 7).Value <> d30201b Then
                bZmiana = True
            Else
                bZmiana = False
            End If
            Worksheets(pArk).Cells(iNrWW, 7).Value = d30201b
            If bZmiana Then
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With
            End If
        Case "3.03.01.99_a", "3.03.01.99_b"
            If d3030101 > 0 Then
                Worksheets(pArk).Cells(iNrWW, 7).Value = 0
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With
            End If
        Case "3.03.02.99"
            If d3030201 > 0 Then
                Worksheets(pArk).Cells(iNrWW, 7).Value = 0
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With

            End If
        Case "3.04.01"
            If d30402 > 0 Then
                Worksheets(pArk).Cells(iNrWW, 7).Value = 0
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With

            End If
    End Select
    Worksheets(pArk).Cells(iNrWW, 9).Value = Worksheets(pArk).Cells(iNrWW, 7).Value * _
    Worksheets(pArk).Cells(iNrWW, 8).Value
Next

End Sub

Private Sub OdczytZPozostalej(pArk)
Dim iNrW, iNrWWW, iNrP As Integer
Dim sPozostala, sDod, sKod As String
Dim dIlosc As Double
Dim vWartosc, vWynik

For iNrW = 5 To 50
    Select Case iNrW
        Case 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 21, 22, 23, 24, 25, 26, 37
            sPozostala = Worksheets("Pozostala_produkcja").Cells(iNrW, 2).Value
            
            sKod = Worksheets("Pozostala_produkcja").Cells(iNrW, 10).Value
            With Worksheets("SO").Range("a1:a1000")
                Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
                If Not vWynik Is Nothing Then
                    iNrWWW = vWynik.Row
                End If
            End With
            
            Worksheets("Pozostala_produkcja").Cells(iNrW, 101).Value = iNrWWW

            Select Case Worksheets("Info").Range("NrR")
                Case "A"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 5).Value
                Case "B"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 6).Value
                Case "C"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 7).Value
                Case "D"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 8).Value
            End Select
            '103 pusta na wart
            For iNrP = 9 To 30
                Worksheets("Pozostala_produkcja").Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWWW, iNrP).Value
            Next
            
            dIlosc = Worksheets("Pozostala_produkcja").Cells(iNrW, 5).Value
            If dIlosc <> 0 Then
                Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 2 & "."
                Select Case iNrW
                    Case 5 To 18
                        sDod = "dzs"
                    Case 20 To 26
                        sDod = "poz"
'                        sDod = "sta"
                    Case 29
                        sDod = "tue"
                End Select
                Worksheets(pArk).Cells(iNrWW, 2).Value = "Poz_prod_" & sDod
                Worksheets(pArk).Cells(iNrWW, 3).Value = Worksheets("Pozostala_produkcja").Cells(iNrW, 1).Value
                Worksheets(pArk).Cells(iNrWW, 4).Value = sPozostala
                Worksheets(pArk).Cells(iNrWW, 5).Value = Worksheets("Pozostala_produkcja").Cells(iNrW, 3).Value
                Worksheets(pArk).Cells(iNrWW, 7).Value = dIlosc
                For iNrP = 8 To 48
                    If iNrP <> 9 Then
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets("Pozostala_produkcja").Cells(iNrW, iNrP + 94).Value
                    Else
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets(pArk).Cells(iNrWW, iNrP - 2).Value * Worksheets(pArk).Cells(iNrWW, iNrP - 1).Value
                    End If
                    Select Case iNrP
                        Case 14, 15
                            If Worksheets(pArk).Cells(iNrWW, iNrP).Value > 0 Then
                                Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc * Worksheets(pArk).Cells(iNrWW, iNrP).Value
                            End If
                    End Select
                Next
                
                iNrWW = iNrWW + 1
            End If
    End Select
Next

End Sub
Attribute VB_Name = "Nal4Obl_rd"
Option Explicit
Option Base 1

Private iNrWW As Integer

Private Sub Nal4Obl_rd()
Dim sArk As String

sArk = "Obliczenia_rd"

Worksheets(sArk).Unprotect Password:=sPassS

With Worksheets(sArk).Range("a3:ai404")
    .ClearContents
    .ClearComments
End With

iNrWW = 3

OdczytZUprawy sArk

OdczytZeZwierzat sArk

OdczytZPozostalej sArk

Application.Run "TF4Pods.TF4Pods", sArk, iNrWW

End Sub

Private Sub OdczytZUprawy(pArk)
Dim iNrW, iNrWWW, iNrP As Integer
Dim sUprawa, sOkrywa As String
Dim dIlosc, dOkrywa As Double
Dim vWartosc, vWynik

For iNrW = 7 To 303
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa = "" Then
        Exit For
    End If
    
    With Worksheets("SO").Range("b1:b1000")
        Set vWynik = .Find(sUprawa, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWWW = vWynik.Row
        End If
    End With
    
    Worksheets("Uprawy").Cells(iNrW, 101).Value = iNrWWW
    
    Select Case Worksheets("Info").Range("NrR")
        Case "A"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 5).Value
        Case "B"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 6).Value
        Case "C"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 7).Value
        Case "D"
            Worksheets("Uprawy").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 8).Value
    End Select
    '103 pusta na wart
    For iNrP = 9 To 30
        Worksheets("Uprawy").Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWWW, iNrP).Value
    Next
    
    Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 2 & "."
    Worksheets(pArk).Cells(iNrWW, 2).Value = "Uprawy"
    Worksheets(pArk).Cells(iNrWW, 3).Value = Worksheets("Uprawy").Cells(iNrW, 1).Value
    Worksheets(pArk).Cells(iNrWW, 4).Value = sUprawa
    Worksheets(pArk).Cells(iNrWW, 5).Value = Worksheets("Uprawy").Cells(iNrW, 3).Value
    Worksheets(pArk).Cells(iNrWW, 6).Value = Worksheets("Uprawy").Cells(iNrW, 129).Value
    dIlosc = Worksheets("Uprawy").Cells(iNrW, 10).Value
    If InStr("B;I", Worksheets("Uprawy").Cells(iNrW, 129).Value) = 0 Then
        Worksheets(pArk).Cells(iNrWW, 7).Value = dIlosc
    Else
        Worksheets(pArk).Cells(iNrWW, 7).Value = 0
    End If
    If Worksheets("Uprawy").Cells(iNrW, 9).Value = "Tak" Then
        dOkrywa = dIlosc
    Else
        dOkrywa = 0
    End If
    For iNrP = 8 To 48
        If iNrP <> 9 Then
            Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets("Uprawy").Cells(iNrW, iNrP + 94).Value
        Else
            Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets(pArk).Cells(iNrWW, iNrP - 2).Value * Worksheets(pArk).Cells(iNrWW, iNrP - 1).Value
        End If
        Select Case iNrP
            Case 10
                Worksheets(pArk).Cells(iNrWW, iNrP).Value = dOkrywa
            Case 11, 12, 13
                If Worksheets(pArk).Cells(iNrWW, iNrP).Value = 1 Then
                    If iNrP = 12 Then
                        If Worksheets(pArk).Cells(iNrWW, 5).Value <> "ha" Then
                            Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc / 10000
                        Else
                            Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc
                        End If
                    Else
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc
                    End If
                End If
        End Select
    Next
    
    iNrWW = iNrWW + 1
Next

End Sub

Private Sub OdczytZeZwierzat(pArk)
Dim iNrW, iNrWWW, iNrP, iNrPW, iNrOW As Integer
Dim sZwierze, sKod As String
Dim dIlosc, d30201a, d30201b, d30201, d302, d3030101, d3030201, d30402 As Double
Dim vWartosc, vWynik
Dim bZmiana As Boolean

d30201a = 0
d30201b = 0
d30201 = 0
d302 = 0
d3030101 = 0
d3030201 = 0
d30402 = 0

iNrPW = iNrWW

For iNrW = 5 To 63
    dIlosc = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 12).Value
    If dIlosc > 0 Then
        sZwierze = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 2).Value
        Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 2 & "."
        Worksheets(pArk).Cells(iNrWW, 2).Value = "Zwierz|fffd|ta"
        sKod = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 19).Value
        Worksheets(pArk).Cells(iNrWW, 3).Value = sKod
        Worksheets(pArk).Cells(iNrWW, 4).Value = sZwierze
        Worksheets(pArk).Cells(iNrWW, 5).Value = "szt."
        Worksheets(pArk).Cells(iNrWW, 7).Value = dIlosc
        
        With Worksheets("SO").Range("a1:a1000")
            Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
            If Not vWynik Is Nothing Then
                iNrWWW = vWynik.Row
            End If
        End With
    
        Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 101).Value = iNrWWW
    
        Select Case Worksheets("Info").Range("NrR")
            Case "A"
                Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 5).Value
            Case "B"
                Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 6).Value
            Case "C"
                Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 7).Value
            Case "D"
                Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 8).Value
        End Select
        '103 pusta na wart
        For iNrP = 9 To 30
            Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWWW, iNrP).Value
        Next
        
        Select Case sKod
            Case "3.02.01_a"
                d30201a = d30201a + dIlosc
            Case "3.02.01_b"
                d30201b = d30201b + dIlosc
            Case "3.02.06", "3.02.99"
                d302 = d302 + dIlosc
            Case "3.03.01.01"
                d3030101 = d3030101 + dIlosc
            Case "3.03.02.01"
                d3030201 = d3030201 + dIlosc
            Case "3.04.02"
                d30402 = d30402 + dIlosc
        End Select
        For iNrP = 8 To 48
            If iNrP <> 9 Then
                Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets("Roczne_obroty_zwierzat_rd").Cells(iNrW, iNrP + 94).Value
            Else
                Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets(pArk).Cells(iNrWW, iNrP - 2).Value * Worksheets(pArk).Cells(iNrWW, iNrP - 1).Value
            End If
            Select Case iNrP
                Case 14, 15
                    If Worksheets(pArk).Cells(iNrWW, iNrP).Value > 0 Then
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc * Worksheets(pArk).Cells(iNrWW, iNrP).Value
                    End If
            End Select
        Next
        
        iNrWW = iNrWW + 1
    End If
Next

iNrOW = iNrWW - 1

'przypadki specjalne
d30201 = d30201a + d30201b
If d30201 > d302 Then
    If d30201a > 0 Then
        If d30201 <> 0 Then
            d30201a = d30201a * (d30201 - d302) / d30201
        Else
            d30201a = 0
        End If
        d30201b = (d30201 - d302) - d30201a
    Else
        If d30201 <> 0 Then
            d30201b = d30201b * (d30201 - d302) / d30201
        Else
            d30201b = 0
        End If
        d30201a = (d30201 - d302) - d30201b
    End If
Else
    d30201a = 0
    d30201b = 0
End If

For iNrWW = iNrPW To iNrOW
    sKod = Worksheets(pArk).Cells(iNrWW, 3).Value
    Worksheets(pArk).Cells(iNrWW, 7).ClearComments
    
    Select Case sKod
        Case "3.02.01_a"
            If Worksheets(pArk).Cells(iNrWW, 7).Value <> d30201a Then
                bZmiana = True
            Else
                bZmiana = False
            End If
            Worksheets(pArk).Cells(iNrWW, 7).Value = d30201a
            If bZmiana Then
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With
            End If
        Case "3.02.01_b"
            If Worksheets(pArk).Cells(iNrWW, 7).Value <> d30201b Then
                bZmiana = True
            Else
                bZmiana = False
            End If
            Worksheets(pArk).Cells(iNrWW, 7).Value = d30201b
            If bZmiana Then
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With
            End If
        Case "3.03.01.99_a", "3.03.01.99_b"
            If d3030101 > 0 Then
                Worksheets(pArk).Cells(iNrWW, 7).Value = 0
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With
            End If
        Case "3.03.02.99"
            If d3030201 > 0 Then
                Worksheets(pArk).Cells(iNrWW, 7).Value = 0
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With

            End If
        Case "3.04.01"
            If d30402 > 0 Then
                Worksheets(pArk).Cells(iNrWW, 7).Value = 0
                Worksheets(pArk).Cells(iNrWW, 7).AddComment
                With Worksheets(pArk).Cells(iNrWW, 7).Comment
                    .Visible = False
                    .Text Text:="Korekta ilo|fffd|ci ze wzgl|fffd|du na 'przypadek specjalny'."
                    .Shape.TextFrame.AutoSize = True
                End With

            End If
    End Select
    Worksheets(pArk).Cells(iNrWW, 9).Value = Worksheets(pArk).Cells(iNrWW, 7).Value * _
    Worksheets(pArk).Cells(iNrWW, 8).Value
Next

End Sub

Private Sub OdczytZPozostalej(pArk)
Dim iNrW, iNrWWW, iNrP As Integer
Dim sPozostala, sDod, sKod As String
Dim dIlosc As Double
Dim vWartosc, vWynik

For iNrW = 5 To 50
    Select Case iNrW
        Case 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 20, 21, 22, 23, 24, 25, 26, 37
            sPozostala = Worksheets("Pozostala_produkcja").Cells(iNrW, 2).Value
            
            sKod = Worksheets("Pozostala_produkcja").Cells(iNrW, 10).Value
            With Worksheets("SO").Range("a1:a1000")
                Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
                If Not vWynik Is Nothing Then
                    iNrWWW = vWynik.Row
                End If
            End With
            
            Worksheets("Pozostala_produkcja").Cells(iNrW, 101).Value = iNrWWW

            Select Case Worksheets("Info").Range("NrR")
                Case "A"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 5).Value
                Case "B"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 6).Value
                Case "C"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 7).Value
                Case "D"
                    Worksheets("Pozostala_produkcja").Cells(iNrW, 102).Value = Worksheets("SO").Cells(iNrWWW, 8).Value
            End Select
            '103 pusta na wart
            For iNrP = 9 To 30
                Worksheets("Pozostala_produkcja").Cells(iNrW, 95 + iNrP).Value = Worksheets("SO").Cells(iNrWWW, iNrP).Value
            Next
            
            dIlosc = Worksheets("Pozostala_produkcja").Cells(iNrW, 7).Value
            If dIlosc <> 0 Then
                Worksheets(pArk).Cells(iNrWW, 1).Value = iNrWW - 2 & "."
                Select Case iNrW
                    Case 5 To 18
                        sDod = "dzs"
                    Case 20 To 26
                        sDod = "poz"
'                        sDod = "sta"
                    Case 29
                        sDod = "tue"
                End Select
                Worksheets(pArk).Cells(iNrWW, 2).Value = "Poz_prod_" & sDod
                Worksheets(pArk).Cells(iNrWW, 3).Value = Worksheets("Pozostala_produkcja").Cells(iNrW, 1).Value
                Worksheets(pArk).Cells(iNrWW, 4).Value = sPozostala
                Worksheets(pArk).Cells(iNrWW, 5).Value = Worksheets("Pozostala_produkcja").Cells(iNrW, 3).Value
                Worksheets(pArk).Cells(iNrWW, 7).Value = dIlosc
                For iNrP = 8 To 48
                    If iNrP <> 9 Then
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets("Pozostala_produkcja").Cells(iNrW, iNrP + 94).Value
                    Else
                        Worksheets(pArk).Cells(iNrWW, iNrP).Value = Worksheets(pArk).Cells(iNrWW, iNrP - 2).Value * Worksheets(pArk).Cells(iNrWW, iNrP - 1).Value
                    End If
                    Select Case iNrP
                        Case 14, 15
                            If Worksheets(pArk).Cells(iNrWW, iNrP).Value > 0 Then
                                Worksheets(pArk).Cells(iNrWW, iNrP).Value = dIlosc * Worksheets(pArk).Cells(iNrWW, iNrP).Value
                            End If
                    End Select
                Next
                
                iNrWW = iNrWW + 1
            End If
    End Select
Next

End Sub
Attribute VB_Name = "Nal4Pods"
Option Explicit
Option Base 1

Private Sub Nal4Pods()
Dim dSK As Double
Dim vWartosc, vMin, vMax, vWynik
Dim sSK, sWartosc, sZ, sKod As String
Dim iNrW, iNrK, iDl, iNr, iNrWW As Integer
Dim bJestFind As Boolean

iNrK = 4

'Formula
Worksheets("Zestawienie").Cells(9, 4).Value = Worksheets("Parametry").Range("Premia").Value

'Odczyt BSO
iNrW = 4
vWartosc = Worksheets("BSO_oraz_SN_rd").Range("BSO").Value

vMin = Worksheets("Zestawienie").Cells(iNrW, 6).Value
vMax = Worksheets("Zestawienie").Cells(iNrW, 7).Value
If VarType(vWartosc) < 2 Or VarType(vWartosc) > 6 Then
    vWartosc = 0
End If

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc

Select Case vWartosc
    Case Is < vMin
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|<Min"
            .Font.ColorIndex = 3
        End With
        If vMin <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vMin - vWartosc) * 100 / vMin, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Is > vMax
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|>Max"
            .Font.ColorIndex = 3
        End With
        If vMax <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vWartosc - vMax) * 100 / vMax, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Else
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd| w zakresie"
            .Font.ColorIndex = 10
        End With
        Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
End Select
'Odczyt SN
iNrW = 5
vWartosc = Worksheets("BSO_oraz_SN_rd").Range("SN").Value
vMin = Worksheets("Zestawienie").Cells(iNrW, 6).Value
vMax = Worksheets("Zestawienie").Cells(iNrW, 7).Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
If VarType(vWartosc) < 2 Or VarType(vWartosc) > 6 Then
    vWartosc = 0
End If

Select Case vWartosc
    Case Is < vMin
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|<Min"
            .Font.ColorIndex = 3
        End With
        If vMin <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vMin - vWartosc) * 100 / vMin, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Is > vMax
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|>Max"
            .Font.ColorIndex = 3
        End With
        If vMax <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vWartosc - vMax) * 100 / vMax, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Else
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd| w zakresie"
            .Font.ColorIndex = 10
        End With
        Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
End Select
'Odczyt Inw_Ma_Wp
iNrW = 6
vWartosc = Worksheets("Inwestycje_w_ochrone_srod").Range("Inw_Ma_Wp").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt Inw_NMa_Wp
iNrW = 7
vWartosc = Worksheets("Inwestycje_POZOSTALE").Range("Inw_NMa_Wp").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt planowanych zakupow
iNrW = 8
vWartosc = Worksheets("Planowane_zakupy").Range("Planowane_zakupy").Value

'formula
Worksheets("Zestawienie").Cells(iNrW, 6).Value = Worksheets("Zestawienie").Cells(9, 4).Value - _
Worksheets("Zestawienie").Cells(6, 4).Value - Worksheets("Zestawienie").Cells(7, 4).Value

vMin = Worksheets("Zestawienie").Cells(iNrW, 6).Value
vMax = Worksheets("Zestawienie").Cells(iNrW, 7).Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc

Select Case vWartosc
    Case Is < vMin
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|<Min"
            .Font.ColorIndex = 3
        End With
        If vMin <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vMin - vWartosc) * 100 / vMin, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Is > vMax
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|>Max"
            .Font.ColorIndex = 3
        End With
        If vMax <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vWartosc - vMax) * 100 / vMax, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Else
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd| w zakresie"
            .Font.ColorIndex = 10
        End With
        Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
End Select

If Worksheets("Zestawienie").Cells(6, iNrK).Value + _
Worksheets("Zestawienie").Cells(7, iNrK).Value + _
Worksheets("Zestawienie").Cells(8, iNrK).Value < _
Worksheets("Zestawienie").Cells(9, iNrK).Value Then
    Wal.SetKolor "Zestawienie", "d6", 3, "Planowane inwestycje oraz zakupy obrotowych |fffd|rodk|fffd|w produkcji s|fffd| mniejsze ni|fffd| kwota pomocy."
    Wal.SetKolor "Zestawienie", "d7", 3, "Planowane inwestycje oraz zakupy obrotowych |fffd|rodk|fffd|w produkcji s|fffd| mniejsze ni|fffd| kwota pomocy."
    Wal.SetKolor "Zestawienie", "d8", 3, "Planowane inwestycje oraz zakupy obrotowych |fffd|rodk|fffd|w produkcji s|fffd| mniejsze ni|fffd| kwota pomocy."
Else
    Wal.SetKolor "Zestawienie", "d6", 15, "-"
    Wal.SetKolor "Zestawienie", "d7", 15, "-"
    Wal.SetKolor "Zestawienie", "d8", 15, "-"
End If

'Obliczenie udzialu Inw.
iNrW = 10

'formula
If Worksheets("Zestawienie").Cells(9, 4).Value <> 0 Then
    Worksheets("Zestawienie").Cells(iNrW, 4).Value = Round((Worksheets("Zestawienie").Cells(6, 4).Value + Worksheets("Zestawienie").Cells(7, 4).Value) * 100 / Worksheets("Zestawienie").Cells(9, 4).Value, 2)
Else
    Worksheets("Zestawienie").Cells(iNrW, 4).Value = 0
End If

If Worksheets("Zestawienie").Cells(iNrW, iNrK).Value < 80 Then
    Wal.SetKolor "Zestawienie", "d10", 3, "Udzia|fffd| planowanych inwestycji poni|fffd|ej wymaganego poziomu 80%."
Else
    Wal.SetKolor "Zestawienie", "d10", 15, "-"
End If

vWartosc = Worksheets("Zestawienie").Cells(iNrW, iNrK).Value
vMin = Worksheets("Zestawienie").Cells(iNrW, 6).Value
vMax = Worksheets("Zestawienie").Cells(iNrW, 7).Value

If VarType(vWartosc) < 2 Or VarType(vWartosc) > 6 Then
    vWartosc = 0
End If

Select Case vWartosc
    Case Is < vMin
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|<Min"
            .Font.ColorIndex = 3
        End With
        If vMin <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vMin - vWartosc) * 100 / vMin, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Is > vMax
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd|>Max"
            .Font.ColorIndex = 3
        End With
        If vMax <> 0 Then
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = Round((vWartosc - vMax) * 100 / vMax, 2)
        Else
            Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
        End If
    Case Else
        With Worksheets("Zestawienie").Cells(iNrW, 8)
            .Value = "Warto|fffd||fffd| w zakresie"
            .Font.ColorIndex = 10
        End With
        Worksheets("Zestawienie").Cells(iNrW, 9).Value = "-"
End Select
'odczyt pow. TUZ RD
iNrW = 11
vWartosc = 0

sKod = "T"
bJestFind = False
With Worksheets("Struktura_rodz_rd").Range("k7:k12")
    Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrWW = vWynik.Row
        bJestFind = True
    End If
End With

If bJestFind Then
    vWartosc = Worksheets("Struktura_rodz_rd").Cells(iNrWW, 7).Value
    If vWartosc = vbEmpty Then
        vWartosc = 0
    End If
Else
    vWartosc = 0
End If
Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc

iNrW = 12
vWartosc = Worksheets("Struktura_wlas_rd").Range("UR_Wlas").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc

iNrW = 13

'formula
If Worksheets("Zestawienie").Cells(12, 4).Value <> 0 Then
    Worksheets("Zestawienie").Cells(iNrW, 4).Value = Round(Worksheets("Zestawienie").Cells(11, 4).Value * 100 / Worksheets("Zestawienie").Cells(12, 4).Value, 2)
Else
    Worksheets("Zestawienie").Cells(iNrW, 4).Value = 0
End If

If Worksheets("Zestawienie").Cells(iNrW, 4).Value > 100 Then
    Wal.SetKolor "Zestawienie", "d" & iNrW, 3, "B|fffd||fffd|dne dane w tab. Dzia|fffd|ki lub Uprawy"
Else
    Wal.SetKolor "Zestawienie", "d" & iNrW, 15, "-"
End If

'odczyt pow. lepszych RD
iNrW = 14
vWartosc = 0

vWartosc = Worksheets("Struktura_rodz_rb").Range("Gleby_l").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc

iNrW = 15
vWartosc = Worksheets("Dzialki").Range("UR_Dzialki").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc

iNrW = 16

'formula
If Worksheets("Zestawienie").Cells(15, 4).Value <> 0 Then
    Worksheets("Zestawienie").Cells(iNrW, 4).Value = Round(Worksheets("Zestawienie").Cells(14, 4).Value * 100 / Worksheets("Zestawienie").Cells(15, 4).Value, 2)

Else
    Worksheets("Zestawienie").Cells(iNrW, 4).Value = 0
End If

If Worksheets("Zestawienie").Cells(iNrW, iNrK).Value > 100 Then
    Wal.SetKolor "Zestawienie", "d" & iNrW, 3, "B|fffd||fffd|dne dane w tab. Uprawy lub Str. rodzajowa"
Else
    Wal.SetKolor "Zestawienie", "d" & iNrW, 15, "-"
End If
'Odczyt region so
iNrW = 17
vWartosc = Worksheets("Info").Range("NrR").Value

If vWartosc = "" Then
    vWartosc = "Brak dzia|fffd|ek do wyznaczenia regionu SO"
End If

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt woj.
iNrW = 18
vWartosc = Worksheets("Info").Range("Wojewodztwo").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt wybranych celow
iNrW = 19

vWartosc = 0
If Worksheets("Cele").Cells(12, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(14, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(16, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(18, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(20, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If
If Worksheets("Cele").Cells(22, 6).Value = "Tak" Then
    vWartosc = vWartosc + 1
End If

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'If Worksheets("Zestawienie").Cells(iNrW, 4).Value < 1 Then
'    Wal.SetKolor "Zestawienie", "d" & iNrW, 3, "Wybrano za ma|fffd|o cel|fffd|w ko|fffd|cowych"
'Else
'    Wal.SetKolor "Zestawienie", "d" & iNrW, 15, "-"
'End If
'Odczyt TF8 rb
iNrW = 21
vWartosc = Worksheets("Info").Range("TF8_n_rb").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt TF8 rd
iNrW = 22
vWartosc = Worksheets("Info").Range("TF8_n_rd").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt TF rb
iNrW = 24
vWartosc = Worksheets("Info").Range("TF_n_rb").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt TF rd
iNrW = 25
vWartosc = Worksheets("Info").Range("TF_n_rd").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt pow. upraw rb
iNrW = 27
vWartosc = Worksheets("Uprawy").Range("UR_Uprawy_rb").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt pow. upraw rd
iNrW = 28
vWartosc = Worksheets("Uprawy").Range("UR_Uprawy_rd").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt lsu_gus rb
iNrW = 30
vWartosc = Worksheets("Obliczenia_rb").Range("O2").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Odczyt lsu_gus rd
iNrW = 31
vWartosc = Worksheets("Obliczenia_rd").Range("O2").Value

Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = vWartosc
'Zmiana profilu
iNrW = 32
If Worksheets("Info").Range("TF_n_rb").Value <> Worksheets("Info").Range("TF_n_rd").Value Then
    Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = "Tak"
Else
    Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = "Nie"
End If
'Zwiekszenie pow. upraw
iNrW = 34
If Worksheets("Uprawy").Range("UR_Uprawy_rd").Value > Worksheets("Uprawy").Range("UR_Uprawy_rb").Value Then
    Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = "Tak"
Else
    Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = "Nie"
End If
'Zwiekszenie lsu_gus
iNrW = 35
If Worksheets("Obliczenia_rd").Range("O2").Value > Worksheets("Obliczenia_rb").Range("O2").Value Then
    Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = "Tak"
Else
    Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = "Nie"
End If

If Left(Worksheets("Zestawienie").Cells(17, iNrK).Value, 4) = "Brak" Then
    Worksheets("Zestawienie").Cells(21, iNrK).Value = "-"
    Worksheets("Zestawienie").Cells(22, iNrK).Value = "-"
    Worksheets("Zestawienie").Cells(24, iNrK).Value = "-"
    Worksheets("Zestawienie").Cells(25, iNrK).Value = "-"
End If

'Suma kontrolna
iNrW = 36
dSK = 0
For iNrW = 4 To 100
    If Worksheets("Zestawienie").Cells(iNrW, 1).Value = "" Then
        Exit For
    End If
    vWartosc = Worksheets("Zestawienie").Cells(iNrW, iNrK).Value
    If VarType(vWartosc) <> vbString Then
        sWartosc = CStr(vWartosc)
    Else
        sWartosc = vWartosc
    End If
    iDl = Len(sWartosc)
    For iNr = 1 To iDl
        sZ = Mid(sWartosc, iNr, 1)
        dSK = dSK + iNrW * iNrK * iNr * Asc(sZ)
    Next
Next
Worksheets("Zestawienie").Cells(iNrW, iNrK).Value = dSK

End Sub

Private Sub Nal4SK()
Dim dSK As Double
Dim iNrA, iNrW, iNrK, iDl, iNr As Integer
Dim sArk, sKiPWD, sPArk, sRange, sWartosc, sZ As String
Dim rCell As Range
Dim vWartosc

dSK = 0
sKiPWD = "Tak"
sPArk = ""
For iNrA = 2 To 100
    sArk = Worksheets("Arkusze").Cells(iNrA, 1).Value
    If sArk = "" Then
        Exit For
    End If
    If Worksheets("Arkusze").Cells(iNrA, 4).Value Then
        If False Then
            'sArk = "Uproszczone_zestawienie_rz-f" And InStr(Worksheets("Info").Range("Sposob").Value, "cz|fffd|onek") > 0
            'nie liczy do SK i KiP
        Else
            If Worksheets("Arkusze").Cells(iNrA, 5).Value Or Worksheets("Arkusze").Cells(iNrA, 6).Value > 0 Then
                For iNrW = Worksheets("Arkusze").Cells(iNrA, 6).Value To 1000
                   If Worksheets(sArk).Rows(iNrW).EntireRow.Hidden Then
                       Exit For
                   End If
                   For iNrK = 1 To 100
                       If Worksheets(sArk).Columns(iNrK).EntireRow.Hidden Then
                           Exit For
                       End If
                       vWartosc = Worksheets(sArk).Cells(iNrW, iNrK).Value
                       If VarType(vWartosc) <> vbString Then
                           sWartosc = CStr(vWartosc)
                       Else
                           sWartosc = vWartosc
                       End If
                       iDl = Len(sWartosc)
                       For iNr = 1 To iDl
                           sZ = Mid(sWartosc, iNr, 1)
                           dSK = dSK + iNrA * iNrW * iNrK * iNr * Asc(sZ)
                       Next
                       If Worksheets("Arkusze").Cells(iNrA, 8).Value Then
                            If Worksheets(sArk).Cells(iNrW, iNrK).Interior.ColorIndex = 3 Then
                                sKiPWD = "Nie"
                                If sPArk = "" Then
                                    sPArk = sArk
                                End If
                            End If
                       End If
                   Next
                Next
            End If
            If Not Worksheets("Arkusze").Cells(iNrA, 5).Value Then
                iNrW = 1
                iNrK = 1
                sRange = Worksheets("Arkusze").Cells(iNrA, 7).Value
                For Each rCell In Worksheets(sArk).Range(sRange)
                    vWartosc = rCell.Value
                    If VarType(vWartosc) <> vbString Then
                        sWartosc = CStr(vWartosc)
                    Else
                        sWartosc = vWartosc
                    End If
                    iDl = Len(sWartosc)
                    For iNr = 1 To iDl
                        sZ = Mid(sWartosc, iNr, 1)
                        dSK = dSK + iNrA * iNrW * iNrK * iNr * Asc(sZ)
                    Next
                    If Worksheets("Arkusze").Cells(iNrA, 8).Value Then
                        If rCell.Interior.ColorIndex = 3 Then
                            sKiPWD = "Nie"
                            If sPArk = "" Then
                                sPArk = sArk
                            End If
                        End If
                    End If
                Next
            End If
        End If
    End If
Next

Worksheets("Zestawienie").Cells(38, 4).Value = dSK
Worksheets("Zestawienie").Cells(39, 4).Value = sKiPWD
If sKiPWD = "Nie" Then
    Wal.SetKolor "Zestawienie", "d39", 3, "Pierwszy arkusz z niekompletnymi lub z niepoprawnymi danymi: " & sPArk
Else
    Wal.SetKolor "Zestawienie", "d39", 15, "-"
End If

End Sub

Attribute VB_Name = "Nal4Str_r_rb"
Option Explicit
Option Base 1

Private Sub Nal4Str_r_rb()
Dim sArk As String
Dim dTemp As Double
Dim iNrP As Integer

sArk = "Struktura_rodz_rb"

OdczytZUprawy_S_UR_rb sArk

'formula
dTemp = 0
For iNrP = 8 To 12
    dTemp = dTemp + Worksheets(sArk).Cells(iNrP, 7).Value
Next
Worksheets(sArk).Cells(7, 7).Value = dTemp
For iNrP = 7 To 12
    Worksheets(sArk).Cells(iNrP, 8).Value = Worksheets(sArk).Cells(iNrP, 5).Value - _
    Worksheets(sArk).Cells(iNrP, 7).Value
    If Worksheets(sArk).Cells(7, 7).Value <> 0 Then
        Worksheets(sArk).Cells(iNrP, 9).Value = Worksheets(sArk).Cells(iNrP, 7).Value * 100 / _
        Worksheets(sArk).Cells(7, 7).Value
    Else
        Worksheets(sArk).Cells(iNrP, 9).Value = "'-"
    End If
Next

End Sub

Private Sub OdczytZUprawy_S_UR_rb(pArk)
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sUprawa, sKod, sJM As String
Dim dIlosc, dRodz, dUprawa, dRoznica As Double
Dim vWartosc, vWynik

Worksheets(pArk).Range("g8:g12").ClearContents
Worksheets(pArk).Range("f8:f12").ClearContents

For iNrW = 7 To 303
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa = "" Then
        Exit For
    End If
    sKod = Worksheets("Uprawy").Cells(iNrW, 123).Value
    sJM = Worksheets("Uprawy").Cells(iNrW, 3).Value
    dIlosc = Worksheets("Uprawy").Cells(iNrW, 6).Value

    If sJM <> "ha" Then
        dIlosc = dIlosc / 10000
    End If
    iNrWW = 0
    
    With Worksheets("Struktura_rodz_rb").Range("k7:k12")
        Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWW = vWynik.Row
        End If
    End With
    If iNrWW > 7 Then
        Worksheets("Struktura_rodz_rb").Cells(iNrWW, 7).Value = Worksheets("Struktura_rodz_rb").Cells(iNrWW, 7).Value + Round(dIlosc, 4)
    End If
Next

For iNrWW = 8 To 12
    dRodz = Worksheets("Struktura_rodz_rb").Cells(iNrWW, 5).Value
    dUprawa = Worksheets("Struktura_rodz_rb").Cells(iNrWW, 7).Value
    dRoznica = Round(dRodz - dUprawa, 6)
    Select Case dRoznica
        Case Is < 0
            With Worksheets("Struktura_rodz_rb").Cells(iNrWW, 6)
                .Value = "<"
                .Font.ColorIndex = 3
            End With
        Case Is > 0
            With Worksheets("Struktura_rodz_rb").Cells(iNrWW, 6)
                .Value = ">"
                .Font.ColorIndex = 3
            End With
        Case Else
            With Worksheets("Struktura_rodz_rb").Cells(iNrWW, 6)
                .Value = "="
                .Font.ColorIndex = 10
            End With
    End Select
    If dRoznica <> 0 Then
        Wal.SetKolor "Struktura_rodz_rb", "h" & iNrWW, 3, "Nieprawid|fffd|owe dane"
    Else
        Wal.SetKolor "Struktura_rodz_rb", "h" & iNrWW, 15, "-"
    End If
Next

End Sub


Attribute VB_Name = "Nal4Str_r_rd"
Option Explicit
Option Base 1

Private Sub Nal4Str_r_rd()
Dim sArk As String
Dim dTemp As Double
Dim iNrP As Integer

sArk = "Struktura_rodz_rd"

OdczytZUprawy_S_UR_rd sArk

'formula
dTemp = 0
For iNrP = 8 To 12
    dTemp = dTemp + Worksheets(sArk).Cells(iNrP, 7).Value
Next
Worksheets(sArk).Cells(7, 7).Value = dTemp
For iNrP = 7 To 12
    Worksheets(sArk).Cells(iNrP, 8).Value = Worksheets(sArk).Cells(iNrP, 5).Value - _
    Worksheets(sArk).Cells(iNrP, 7).Value
    If Worksheets(sArk).Cells(7, 7).Value <> 0 Then
        Worksheets(sArk).Cells(iNrP, 9).Value = Worksheets(sArk).Cells(iNrP, 7).Value * 100 / _
        Worksheets(sArk).Cells(7, 7).Value
    Else
        Worksheets(sArk).Cells(iNrP, 9).Value = "'-"
    End If
Next

End Sub

Private Sub OdczytZUprawy_S_UR_rd(pArk)
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sUprawa, sKod, sJM As String
Dim dIlosc, dRodz, dUprawa, dRoznica As Double
Dim vWartosc, vWynik

Worksheets(pArk).Range("g8:g12").ClearContents
Worksheets(pArk).Range("f8:f12").ClearContents

For iNrW = 7 To 303
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa = "" Then
        Exit For
    End If
    sKod = Worksheets("Uprawy").Cells(iNrW, 123).Value
    sJM = Worksheets("Uprawy").Cells(iNrW, 3).Value
    dIlosc = Worksheets("Uprawy").Cells(iNrW, 10).Value

    If sJM <> "ha" Then
        dIlosc = dIlosc / 10000
    End If
    iNrWW = 0
    
    With Worksheets("Struktura_rodz_rd").Range("k7:k12")
        Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWW = vWynik.Row
        End If
    End With
    If iNrWW > 7 Then
        Worksheets("Struktura_rodz_rd").Cells(iNrWW, 7).Value = Worksheets("Struktura_rodz_rd").Cells(iNrWW, 7).Value + Round(dIlosc, 4)
    End If
Next

For iNrWW = 8 To 12
    dRodz = Worksheets("Struktura_rodz_rd").Cells(iNrWW, 5).Value
    dUprawa = Worksheets("Struktura_rodz_rd").Cells(iNrWW, 7).Value
    dRoznica = Round(dRodz - dUprawa, 6)
    Select Case dRoznica
        Case Is < 0
            With Worksheets("Struktura_rodz_rd").Cells(iNrWW, 6)
                .Value = "<"
                .Font.ColorIndex = 3
            End With
        Case Is > 0
            With Worksheets("Struktura_rodz_rd").Cells(iNrWW, 6)
                .Value = ">"
                .Font.ColorIndex = 3
            End With
        Case Else
            With Worksheets("Struktura_rodz_rd").Cells(iNrWW, 6)
                .Value = "="
                .Font.ColorIndex = 10
            End With
    End Select
    If dRoznica <> 0 Then
        Wal.SetKolor "Struktura_rodz_rd", "h" & iNrWW, 3, "Nieprawid|fffd|owe dane"
    Else
        Wal.SetKolor "Struktura_rodz_rd", "h" & iNrWW, 15, "-"
    End If
Next

End Sub

Attribute VB_Name = "Nal4Str_w_rb"
Option Explicit
Option Base 1

Private Sub Nal4Str_w_rb()
Dim sArk As String
Dim dTemp1, dTemp2 As Double
Dim iNrP As Integer

sArk = "Struktura_wlas_rb"

OdczytZDzialek sArk

OdczytZUpraw sArk

'formula
dTemp1 = 0
dTemp2 = 0
For iNrP = 7 To 12
    dTemp1 = dTemp1 + Worksheets(sArk).Cells(iNrP, 3).Value
    dTemp2 = dTemp2 + Worksheets(sArk).Cells(iNrP, 6).Value
Next
Worksheets(sArk).Cells(6, 3).Value = dTemp1
Worksheets(sArk).Cells(6, 6).Value = dTemp2
For iNrP = 6 To 12
    If iNrP <> 6 Then
        Worksheets(sArk).Cells(iNrP, 7).Value = Worksheets(sArk).Cells(iNrP, 3).Value - _
        Worksheets(sArk).Cells(iNrP, 6).Value
    End If
    If Worksheets(sArk).Cells(6, 6).Value <> 0 Then
        Worksheets(sArk).Cells(iNrP, 8).Value = Worksheets(sArk).Cells(iNrP, 6).Value * 100 / Worksheets(sArk).Cells(6, 6).Value
    Else
        Worksheets(sArk).Cells(iNrP, 8).Value = "'-"
    End If
Next

End Sub

Private Sub OdczytZDzialek(pArk)
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sWoj, sKod, sTytul As String
Dim dIlosc, dDzialka, dUprawa, dRoznica As Double
Dim vWartosc, vWynik

Worksheets(pArk).Range("b7:c12").ClearContents

For iNrW = 17 To 1185
    sWoj = Worksheets("Dzialki").Cells(iNrW, 2).Value
    If sWoj = "" Then
        Exit For
    End If
    sKod = Worksheets("Dzialki").Cells(iNrW, 128).Value
    sTytul = OdczytZTytul_prawny(sKod, 2)
    dIlosc = Worksheets("Dzialki").Cells(iNrW, 11).Value
    
    iNrWW = 0
    
    With Worksheets("Struktura_wlas_rb").Range("j7:j12")
        Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWW = vWynik.Row
        End If
    End With
    If iNrWW >= 7 Then
        Worksheets("Struktura_wlas_rb").Cells(iNrWW, 2).Value = sTytul
        Worksheets("Struktura_wlas_rb").Cells(iNrWW, 3).Value = Worksheets("Struktura_wlas_rb").Cells(iNrWW, 3).Value + Round(dIlosc, 4)
        dDzialka = Worksheets("Struktura_wlas_rb").Cells(iNrWW, 3).Value
        dUprawa = Worksheets("Struktura_wlas_rb").Cells(iNrWW, 6).Value
        dRoznica = Round(dDzialka - dUprawa, 6)
        Select Case dRoznica
            Case Is < 0
                With Worksheets("Struktura_wlas_rb").Cells(iNrWW, 4)
                    .Value = "<"
                    .Font.ColorIndex = 3
                End With
            Case Is > 0
                With Worksheets("Struktura_wlas_rb").Cells(iNrWW, 4)
                    .Value = ">"
                    .Font.ColorIndex = 10
                End With
            Case Else
                With Worksheets("Struktura_wlas_rb").Cells(iNrWW, 4)
                    .Value = "="
                    .Font.ColorIndex = 10
                End With
        End Select
        If dRoznica < 0 Then
            Wal.SetKolor "Struktura_wlas_rb", "g" & iNrWW, 3, "Nieprawid|fffd|owe dane"
        Else
            Wal.SetKolor "Struktura_wlas_rb", "g" & iNrWW, 15, "-"
        End If
    End If
Next

End Sub

Private Sub OdczytZUpraw(pArk)
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sUprawa, sKod, sTytul, sJM As String
Dim dIlosc, dDzialka, dUprawa, dRoznica As Double
Dim vWartosc, vWynik

Worksheets(pArk).Range("d7:d12").ClearContents
Worksheets(pArk).Range("e7:f12").ClearContents

For iNrW = 7 To 303
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa = "" Then
        Exit For
    End If
    sKod = Worksheets("Uprawy").Cells(iNrW, 128).Value
    sJM = Worksheets("Uprawy").Cells(iNrW, 3).Value
    sTytul = OdczytZTytul_prawny(sKod, 4)
    dIlosc = Worksheets("Uprawy").Cells(iNrW, 6).Value
    
    If sJM <> "ha" Then
        dIlosc = dIlosc / 10000
    End If
    
    iNrWW = 0
    
    With Worksheets("Struktura_wlas_rb").Range("j7:j12")
        Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWW = vWynik.Row
        End If
    End With
    If iNrWW >= 7 Then
        Worksheets("Struktura_wlas_rb").Cells(iNrWW, 5).Value = sTytul
        Worksheets("Struktura_wlas_rb").Cells(iNrWW, 6).Value = Worksheets("Struktura_wlas_rb").Cells(iNrWW, 6).Value + Round(dIlosc, 4)
    End If
Next
For iNrWW = 7 To 12
    dDzialka = Worksheets("Struktura_wlas_rb").Cells(iNrWW, 3).Value
    dUprawa = Worksheets("Struktura_wlas_rb").Cells(iNrWW, 6).Value
    dRoznica = Round(dDzialka - dUprawa, 6)
    Select Case dRoznica
        Case Is < 0
            With Worksheets("Struktura_wlas_rb").Cells(iNrWW, 4)
                .Value = "<"
                .Font.ColorIndex = 3
            End With
        Case Is > 0
            With Worksheets("Struktura_wlas_rb").Cells(iNrWW, 4)
                .Value = ">"
                .Font.ColorIndex = 10
            End With
        Case Else
            With Worksheets("Struktura_wlas_rb").Cells(iNrWW, 4)
                .Value = "="
                .Font.ColorIndex = 10
            End With
    End Select
    If dRoznica < 0 Then
        Wal.SetKolor "Struktura_wlas_rb", "g" & iNrWW, 3, "Nieprawid|fffd|owe dane"
    Else
        Wal.SetKolor "Struktura_wlas_rb", "g" & iNrWW, 15, "-"
    End If
Next

End Sub

Private Function OdczytZTytul_prawny(pKod, pKol)
Dim vWynik
Dim iNrW As Integer

OdczytZTytul_prawny = ""

With Worksheets("Tytul_prawny").Range("a1:a100")
    Set vWynik = .Find(pKod, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With

OdczytZTytul_prawny = Worksheets("Tytul_prawny").Cells(iNrW, pKol).Value

End Function
Attribute VB_Name = "Nal4Str_w_rd"
Option Explicit
Option Base 1

Private Sub Nal4Str_w_rd()
Dim sArk As String
Dim dTemp1, dTemp2 As Double
Dim iNrP As Integer

sArk = "Struktura_wlas_rd"

OdczytZDzialek "Struktura_wlas_rd"

OdczytZUpraw "Struktura_wlas_rd"

'formula
dTemp1 = 0
dTemp2 = 0
For iNrP = 7 To 12
    dTemp1 = dTemp1 + Worksheets(sArk).Cells(iNrP, 3).Value
    dTemp2 = dTemp2 + Worksheets(sArk).Cells(iNrP, 6).Value
Next
Worksheets(sArk).Cells(6, 3).Value = dTemp1
Worksheets(sArk).Cells(6, 6).Value = dTemp2
For iNrP = 6 To 12
    If iNrP <> 6 Then
        Worksheets(sArk).Cells(iNrP, 7).Value = Worksheets(sArk).Cells(iNrP, 3).Value - _
        Worksheets(sArk).Cells(iNrP, 6).Value
    End If
    If Worksheets(sArk).Cells(6, 6).Value <> 0 Then
        Worksheets(sArk).Cells(iNrP, 8).Value = Worksheets(sArk).Cells(iNrP, 6).Value * 100 / Worksheets(sArk).Cells(6, 6).Value
    Else
        Worksheets(sArk).Cells(iNrP, 8).Value = "'-"
    End If
Next

End Sub

Private Sub OdczytZDzialek(pArk)
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sWoj, sKod, sTytul As String
Dim dIlosc, dDzialka, dUprawa, dRoznica As Double
Dim vWartosc, vWynik

For iNrW = 7 To 12
    dDzialka = Worksheets("Struktura_wlas_rd").Cells(iNrW, 3).Value
    dUprawa = Worksheets("Struktura_wlas_rd").Cells(iNrW, 6).Value
    dRoznica = Round(dDzialka - dUprawa, 6)
    Select Case dRoznica
        Case Is < 0
            With Worksheets("Struktura_wlas_rd").Cells(iNrW, 4)
                .Value = "<"
                .Font.ColorIndex = 3
            End With
        Case Is > 0
            With Worksheets("Struktura_wlas_rd").Cells(iNrW, 4)
                .Value = ">"
                .Font.ColorIndex = 3
            End With
        Case Else
            With Worksheets("Struktura_wlas_rd").Cells(iNrW, 4)
                .Value = "="
                .Font.ColorIndex = 10
            End With
    End Select
    If dRoznica < 0 Then
        Wal.SetKolor "Struktura_wlas_rd", "g" & iNrW, 3, "Nieprawid|fffd|owe dane"
    Else
        Wal.SetKolor "Struktura_wlas_rd", "g" & iNrW, 15, "-"
    End If
Next

End Sub

Private Sub OdczytZUpraw(pArk)
Dim iNrW, iNrP, iPlon, iNrWW As Integer
Dim sUprawa, sKod, sTytul, sJM As String
Dim dIlosc, dDzialka, dUprawa, dRoznica As Double
Dim vWartosc, vWynik

'Worksheets(pArk).Range("d7:d12").ClearContents
Worksheets(pArk).Range("e7:f12").ClearContents

For iNrW = 7 To 303
    sUprawa = Worksheets("Uprawy").Cells(iNrW, 2).Value
    If sUprawa = "" Then
        Exit For
    End If
    sKod = Worksheets("Uprawy").Cells(iNrW, 129).Value
    sJM = Worksheets("Uprawy").Cells(iNrW, 3).Value
    sTytul = OdczytZTytul_prawny(sKod, 4)
    dIlosc = Worksheets("Uprawy").Cells(iNrW, 10).Value
    
    If sJM <> "ha" Then
        dIlosc = dIlosc / 10000
    End If
    
    iNrWW = 0
    
    With Worksheets("Struktura_wlas_rd").Range("j7:j12")
        Set vWynik = .Find(sKod, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrWW = vWynik.Row
        End If
    End With
    If iNrWW >= 7 Then
        Worksheets("Struktura_wlas_rd").Cells(iNrWW, 5).Value = sTytul
        Worksheets("Struktura_wlas_rd").Cells(iNrWW, 6).Value = Worksheets("Struktura_wlas_rd").Cells(iNrWW, 6).Value + Round(dIlosc, 4)
    End If
Next
For iNrWW = 7 To 12
    dDzialka = Worksheets("Struktura_wlas_rd").Cells(iNrWW, 3).Value
    dUprawa = Worksheets("Struktura_wlas_rd").Cells(iNrWW, 6).Value
    dRoznica = Round(dDzialka - dUprawa, 6)
    Select Case dRoznica
        Case Is < 0
            With Worksheets("Struktura_wlas_rd").Cells(iNrWW, 4)
                .Value = "<"
                .Font.ColorIndex = 3
            End With
        Case Is > 0
            With Worksheets("Struktura_wlas_rd").Cells(iNrWW, 4)
                .Value = ">"
                .Font.ColorIndex = 10
            End With
        Case Else
            With Worksheets("Struktura_wlas_rd").Cells(iNrWW, 4)
                .Value = "="
                .Font.ColorIndex = 10
            End With
    End Select
    If dRoznica < 0 Then
        Wal.SetKolor "Struktura_wlas_rd", "g" & iNrWW, 3, "Nieprawid|fffd|owe dane"
    Else
        Wal.SetKolor "Struktura_wlas_rd", "g" & iNrWW, 15, "-"
    End If
Next

End Sub

Private Function OdczytZTytul_prawny(pKod, pKol)
Dim vWynik
Dim iNrW As Integer

OdczytZTytul_prawny = ""

With Worksheets("Tytul_prawny").Range("a1:a100")
    Set vWynik = .Find(pKod, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With

OdczytZTytul_prawny = Worksheets("Tytul_prawny").Cells(iNrW, pKol).Value

End Function

Attribute VB_Name = "TF4Pods"
Option Explicit
Option Base 1

Private Sub TF4Pods(pArk, pNrWW)
Dim iNrW As Integer
Dim sKod As String
Dim dWartosc, d2010101, d2010103, d2010104, d2010105, d2010106, d2010199, d20102, d20103, d20104, d20105, _
d2010601, d2010602, d2010604, d2010605, d2010608, d2010612, d2010699, d201070101, d201070102, d2010702, _
d2010801, d2010802, d20109, d2010901, d2010902, d201090201, d201090202, d201090299, d20110, d20111, d2011201, d20301, d20302, _
d20303, d20401, d204010101, d2040102, d2040103, d20404, d20405, d20406, d2040601, d2040602, d20601, d2zagajnik, d301, d30201, d30202, d30203, _
d30204, d30205, d30206, d30299, d30301, d3030101, d3030199, d30302, d3030201, d3030299, d30401, d30402, d30499, d30501, _
d30502, d30503, d3050301, d3050302, d3050303, d3050304, d3050399, d306, d306_a, d307, _
ddzdzownice, denerg_poza_UR, dentomofagi, dfuterkowe, din_vitro, dkarp, dkot, dmysz_lab, dpies, dpstrag, _
dryby_akwariowe, dszczur_lab, dslimaki, draki, dzaby, dalpaki, djelenie, ddaniele, dosly, djedwabniki As Double
Dim dP45, dP46, dGL, dFCP1, dFCP4, dP17, dP151, dP15, dP16, dP51, dP52, dP1, dP2, dP3, dP4, dP5, dP9 As Double
Dim dSO, d2_3SO, d1_3SO, d1_3GL, d1_10GL, d2_3GL, d3_4GL, d1_3P4, d1_10P4, d1_2P45 As Double
Dim sTF8, sTF As String
Dim sTF8_n, sTF_n As String
Dim vWynik
Dim sRx As String
Dim TabSum(21) As Double
Dim iNrP As Integer

For iNrP = 1 To 21
    TabSum(iNrP) = 0
Next

sRx = Right(pArk, 2)

d2010101 = 0
d2010103 = 0
d2010104 = 0
d2010105 = 0
d2010106 = 0
d2010199 = 0
d20102 = 0
d20103 = 0
d20104 = 0
d20105 = 0
d2010601 = 0
d2010602 = 0
d2010604 = 0
d2010605 = 0
d2010608 = 0
d2010612 = 0
d2010699 = 0
d201070101 = 0
d201070102 = 0
d2010702 = 0
d2010801 = 0
d2010802 = 0
d20109 = 0
d2010901 = 0
d2010902 = 0
d201090201 = 0
d201090202 = 0
d201090299 = 0
d20110 = 0
d20111 = 0
d2011201 = 0
d20301 = 0
d20302 = 0
d20303 = 0
d20401 = 0
d204010101 = 0
d2040102 = 0
d2040103 = 0
d20404 = 0
d20405 = 0
d20406 = 0
d2040601 = 0
d2040602 = 0
d20601 = 0
d2zagajnik = 0
d301 = 0
d30201 = 0
d30202 = 0
d30203 = 0
d30204 = 0
d30205 = 0
d30206 = 0
d30299 = 0
d30301 = 0
d3030101 = 0
d3030199 = 0
d30302 = 0
d3030201 = 0
d3030299 = 0
d30401 = 0
d30402 = 0
d30499 = 0
d30501 = 0
d30502 = 0
d30503 = 0
d3050301 = 0
d3050302 = 0
d3050303 = 0
d3050304 = 0
d3050399 = 0
d306 = 0
d306_a = 0
d307 = 0
ddzdzownice = 0
denerg_poza_UR = 0
dentomofagi = 0
dfuterkowe = 0
din_vitro = 0
dkarp = 0
dkot = 0
dmysz_lab = 0
dpies = 0
dpstrag = 0
dryby_akwariowe = 0
dszczur_lab = 0
dslimaki = 0
draki = 0
dzaby = 0
dalpaki = 0
djelenie = 0
ddaniele = 0
dosly = 0
djedwabniki = 0

For iNrW = 3 To pNrWW - 1
    'formula
    For iNrP = 9 To 21
        If iNrP <> 18 Then
            TabSum(iNrP) = TabSum(iNrP) + Worksheets(pArk).Cells(iNrW, iNrP).Value
        End If
    Next
    sKod = Worksheets(pArk).Cells(iNrW, 22).Value
    dWartosc = Worksheets(pArk).Cells(iNrW, 9).Value
    
    Select Case sKod
        Case "2.01.01.01."
            d2010101 = d2010101 + dWartosc
        Case "2.01.01.03."
            d2010103 = d2010103 + dWartosc
        Case "2.01.01.04."
            d2010104 = d2010104 + dWartosc
        Case "2.01.01.05."
            d2010105 = d2010105 + dWartosc
        Case "2.01.01.06."
            d2010106 = d2010106 + dWartosc
        Case "2.01.01.99."
            d2010199 = d2010199 + dWartosc
        Case "2.01.02."
            d20102 = d20102 + dWartosc
        Case "2.01.03."
            d20103 = d20103 + dWartosc
        Case "2.01.04."
            d20104 = d20104 + dWartosc
        Case "2.01.05."
            d20105 = d20105 + dWartosc
        Case "2.01.06.01."
            d2010601 = d2010601 + dWartosc
        Case "2.01.06.02."
            d2010602 = d2010602 + dWartosc
        Case "2.01.06.04."
            d2010604 = d2010604 + dWartosc
        Case "2.01.06.05."
            d2010605 = d2010605 + dWartosc
        Case "2.01.06.08."
            d2010608 = d2010608 + dWartosc
        Case "2.01.06.12."
            d2010612 = d2010612 + dWartosc
        Case "2.01.06.99."
            d2010699 = d2010699 + dWartosc
        Case "2.01.07.01.01."
            d201070101 = d201070101 + dWartosc
        Case "2.01.07.01.02."
            d201070102 = d201070102 + dWartosc
        Case "2.01.07.02."
            d2010702 = d2010702 + dWartosc
        Case "2.01.08.01."
            d2010801 = d2010801 + dWartosc
        Case "2.01.08.02."
            d2010802 = d2010802 + dWartosc
        Case "2.01.09.01."
            d2010901 = d2010901 + dWartosc
        Case "2.01.09.02.01."
            d201090201 = d201090201 + dWartosc
        Case "2.01.09.02.02."
            d201090202 = d201090202 + dWartosc
        Case "2.01.09.02.99."
            d201090299 = d201090299 + dWartosc
        Case "2.01.10."
            d20110 = d20110 + dWartosc
        Case "2.01.11."
            d20111 = d20111 + dWartosc
        Case "2.01.12.01."
            d2011201 = d2011201 + dWartosc
        Case "2.03.01."
            d20301 = d20301 + dWartosc
        Case "2.03.02."
            d20302 = d20302 + dWartosc
        Case "2.03.03."
            d20303 = d20303 + dWartosc
        Case "2.04.01."
            d20401 = d20401 + dWartosc
        Case "2.04.01.01.01."
            d204010101 = d204010101 + dWartosc
        Case "2.04.01.02."
            d2040102 = d2040102 + dWartosc
        Case "2.04.01.03."
            d2040103 = d2040103 + dWartosc
        Case "2.04.04."
            d20404 = d20404 + dWartosc
        Case "2.04.05."
            d20405 = d20405 + dWartosc
        Case "2.04.06.01."
            d2040601 = d2040601 + dWartosc
        Case "2.04.06.02."
            d2040602 = d2040602 + dWartosc
        Case "2.06.01."
            d20601 = d20601 + dWartosc
        Case "2.zagajnik"
            d2zagajnik = d2zagajnik + dWartosc
        Case "3.01."
            d301 = d301 + dWartosc
        Case "3.02.01."
            d30201 = d30201 + dWartosc
        Case "3.02.02."
            d30202 = d30202 + dWartosc
        Case "3.02.03."
            d30203 = d30203 + dWartosc
        Case "3.02.04."
            d30204 = d30204 + dWartosc
        Case "3.02.05."
            d30205 = d30205 + dWartosc
        Case "3.02.06."
            d30206 = d30206 + dWartosc
        Case "3.02.99."
            d30299 = d30299 + dWartosc
        Case "3.03.01.01."
            d3030101 = d3030101 + dWartosc
        Case "3.03.01.99."
            d3030199 = d3030199 + dWartosc
        Case "3.03.02.01."
            d3030201 = d3030201 + dWartosc
        Case "3.03.02.99."
            d3030299 = d3030299 + dWartosc
        Case "3.04.01."
            d30401 = d30401 + dWartosc
        Case "3.04.02."
            d30402 = d30402 + dWartosc
        Case "3.04.99."
            d30499 = d30499 + dWartosc
        Case "3.05.01."
            d30501 = d30501 + dWartosc
        Case "3.05.02."
            d30502 = d30502 + dWartosc
        Case "3.05.03.01."
            d3050301 = d3050301 + dWartosc
        Case "3.05.03.02."
            d3050302 = d3050302 + dWartosc
        Case "3.05.03.03."
            d3050303 = d3050303 + dWartosc
        Case "3.05.03.04."
            d3050304 = d3050304 + dWartosc
        Case "3.05.03.99."
            d3050399 = d3050399 + dWartosc
        Case "3.06."
            d306 = d306 + dWartosc
        Case "3.06._a"
            d306_a = d306_a + dWartosc
        Case "3.07."
            d307 = d307 + dWartosc
        Case "dzdzownice"
            ddzdzownice = ddzdzownice + dWartosc
        Case "energ_poza_UR"
            denerg_poza_UR = denerg_poza_UR + dWartosc
        Case "entomofagi"
            dentomofagi = dentomofagi + dWartosc
        Case "futerkowe"
            dfuterkowe = dfuterkowe + dWartosc
        Case "in_vitro"
            din_vitro = din_vitro + dWartosc
        Case "karp"
            dkarp = dkarp + dWartosc
        Case "kot"
            dkot = dkot + dWartosc
        Case "mysz_lab"
            dmysz_lab = dmysz_lab + dWartosc
        Case "pies"
            dpies = dpies + dWartosc
        Case "pstrag"
            dpstrag = dpstrag + dWartosc
        Case "ryby_akwariowe"
            dryby_akwariowe = dryby_akwariowe + dWartosc
        Case "szczur_lab"
            dszczur_lab = dszczur_lab + dWartosc
        Case "slimaki"
            dslimaki = dslimaki + dWartosc
        Case "raki"
            draki = draki + dWartosc
        Case "zaby"
            dzaby = dzaby + dWartosc
        Case "alpaki"
            dalpaki = dalpaki + dWartosc
        Case "jelenie"
            djelenie = djelenie + dWartosc
        Case "daniele"
            ddaniele = ddaniele + dWartosc
        Case "osly"
            dosly = dosly + dWartosc
        Case "jedwabniki"
            djedwabniki = djedwabniki + dWartosc
    End Select
Next

'formula
Worksheets(pArk).Cells(2, 9).Value = Round(TabSum(9), 2)
For iNrP = 10 To 21
    Worksheets(pArk).Cells(2, iNrP).Value = TabSum(iNrP)
Next

d30503 = d3050301 + d3050302 + d3050303 + d3050304 + d3050399
d20406 = d2040601 + d2040602
d2010902 = d201090201 + d201090202 + d201090299
d20109 = d2010901 + d2010902
d30301 = d3030101 + d3030199
d30302 = d3030201 + d3030299
d20401 = d20401 + d204010101 + d2040103 + d2040102

dP45 = d30201 + d30203 + d30205 + d30206
dP46 = dP45 + d30202 + d30204 + d30299
dGL = d301 + dP46 + d3030101 + d3030199 + d3030201 + d3030299
If dGL = 0 Then
    dFCP1 = d20105 + d20109 + d20301 + d20302
    dFCP4 = 0
    dP17 = d20103 + d20104 + d20105
End If
If dGL > 0 Then
    dFCP1 = 0
    dFCP4 = d20105 + d20109 + d20301 + d20302
    dP17 = d20103 + d20104
End If
dP151 = d2010101 + d2010103 + d2010104 + d2010105 + d2010106 + d2010199 '+ d2010102
dP15 = dP151 '+ d2010107
dP16 = d2010604 + d2010605 + d2010608 '+ d2010606 + d2010607
dP51 = d30401 + d30402 + d30499
dP52 = d30501 + d30502 + d30503
dP1 = dP15 + d20102 + d20103 + d20104 + d2010601 + d2010602 + dP16 + d2010612 + d2010699 + d201070101 + _
d20110 + d20111 + d2011201 + dFCP1   '+ d2010603+ d2010609 + d2010610 + d2010611
dP2 = d201070102 + d2010702 + d2010801 + d2010802 + d20601 + d20405
dP3 = d20401 + d20404 + d20406 '+ d20407 + d20402 + d20403
dP4 = dGL + dFCP4
dP5 = dP51 + dP52 + d306

dP9 = ddzdzownice + denerg_poza_UR + dentomofagi + dfuterkowe + din_vitro + dkot + dmysz_lab + dpies + _
dryby_akwariowe + dszczur_lab + dslimaki + draki + dzaby + dalpaki + djelenie + ddaniele + dosly + djedwabniki

dSO = dP1 + dP2 + dP3 + dP4 + dP5 + d307 + dP9
d2_3SO = dSO * 2 / 3
d1_3SO = dSO * 1 / 3
d1_3GL = dGL * 1 / 3
d1_10GL = dGL * 1 / 10
d2_3GL = dGL * 2 / 3
d3_4GL = dGL * 3 / 4
d1_3P4 = dP4 * 1 / 3
d1_10P4 = dP4 * 1 / 10
d1_2P45 = dP45 * 1 / 2

sTF8 = ""
sTF = ""

If dP1 > d2_3SO Then
    sTF8 = "1"
    If (dP15 + dP16 + d20102) > d2_3SO Then
        If (dP151 + dP16 + d20102) > d2_3SO Then
            sTF = "151"
        Else
            sTF = "153"
        End If
    Else
        If dP17 > d2_3SO Then
            sTF = "161"
        Else
            If (dP15 + dP16 + d20102) > d1_3SO And dP17 > d1_3SO Then
                sTF = "162"
            Else
                If d201070101 > d2_3SO Then
                    sTF = "163"
                Else
                    If d2010601 > d2_3SO Then
                        sTF = "164"
                    Else
                        sTF = "166"
                    End If
                End If
            End If
        End If
    End If
Else
    If dP2 > d2_3SO Then
        sTF8 = "2"
        If (d2010702 + d2010802) > d2_3SO Then
            If d2010702 > d2_3SO Then
                sTF = "211"
            Else
                If d2010802 > d2_3SO Then
                    sTF = "212"
                Else
                    sTF = "213"
                End If
            End If
        Else
            If (d201070102 + d2010801) > d2_3SO Then
                If d201070102 > d2_3SO Then
                    sTF = "221"
                Else
                    If d2010801 > d2_3SO Then
                        sTF = "222"
                    Else
                        sTF = "223"
                    End If
                End If
            Else
                If d20601 > d2_3SO Then
                    sTF = "231"
                Else
                    If d20405 > d2_3SO Then
                        sTF = "232"
                    Else
                        sTF = "233"
                    End If
                End If
            End If
        End If
    Else
        If dP3 > d2_3SO Then
            If d20404 > d2_3SO Then
                sTF8 = "3"
                sTF = "354"
            Else
                sTF8 = "4"
                If d20401 > d2_3SO Then '+d20402
                    If (d204010101 + d2040102) > d2_3SO Then
                        sTF = "361"
                    Else
                        If d2040103 > d2_3SO Then
                            sTF = "363"
                        Else
                            sTF = "365"
                        End If
                    End If
                Else
                    sTF = "380"
                End If
            End If
        Else
            If dP4 > d2_3SO Then
                If d30206 > d3_4GL And dGL > d1_10P4 Then
                    sTF8 = "5"
                    sTF = "450"
                Else
                    sTF8 = "6"
                    If dP46 > d2_3GL And d30206 <= d1_10GL And dGL > d1_10P4 Then
                        sTF = "460"
                    Else
                        If dP46 > d2_3GL And d30206 > d1_10GL And dGL > d1_10P4 Then
                            sTF = "470"
                        Else
                            If d30301 > d2_3GL And dGL > d1_10P4 Then
                                sTF = "481"
                            Else
                                If dP46 > d1_3GL And d30301 > d1_3GL And dGL > d1_10P4 Then
                                    sTF = "482"
                                Else
                                    If d30302 > d2_3GL And dGL > d1_10P4 Then
                                        sTF = "483"
                                    Else
                                        sTF = "484"
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            Else
                If dP5 > d2_3SO Then
                    If dP51 > d2_3SO Then
                        sTF8 = "7a"
                        If d30402 > d2_3SO Then
                            sTF = "511"
                        Else
                            If (d30401 + d30499) > d2_3SO Then
                                sTF = "512"
                            Else
                                sTF = "513"
                            End If
                        End If
                    Else
                        sTF8 = "7b"
                        If dP52 > d2_3SO Then
                            If d30502 > d2_3SO Then
                                sTF = "521"
                            Else
                                If (d30501 + d30503) > d2_3SO Then
                                    sTF = "522"
                                Else
                                    sTF = "523"
                                End If
                            End If
                        Else
                            sTF = "530"
                        End If
                    End If
                Else
                    If (dP1 + dP2 + dP3) > d2_3SO Then
                        sTF8 = "8"
                        If dP2 > d1_3SO And dP3 > d1_3SO Then
                            sTF = "611"
                        Else
                            If dP1 > d1_3SO And dP2 > d1_3SO Then
                                sTF = "612"
                            Else
                                If dP1 > d1_3SO And d20404 > d1_3SO Then
                                    sTF = "613"
                                Else
                                    If dP1 > d1_3SO And dP3 > d1_3SO And d20404 <= d1_3SO Then
                                        sTF = "614"
                                    Else
                                        If dP1 > d1_3SO And dP2 <= d1_3SO And dP3 <= d1_3SO Then
                                            sTF = "615"
                                        Else
                                            sTF = "616"
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    Else
                        If (dP4 + dP5) > d2_3SO Then
                            sTF8 = "8"
                            If dP4 > dP5 Then
                                If dP45 > d1_3GL And d30206 > d1_2P45 Then
                                    sTF = "731"
                                Else
                                    sTF = "732"
                                End If
                            Else
                                If dP45 > d1_3GL And dP5 > d1_3SO And d30206 > d1_2P45 Then
                                    sTF = "741"
                                Else
                                    sTF = "742"
                                End If
                            End If
                        Else
                            If dP9 > d2_3SO Then
                                sTF8 = "9"
                                If ddzdzownice > d2_3SO Then
                                    sTF = "9dz"
                                Else
                                    If denerg_poza_UR > d2_3SO Then
                                        sTF = "9en"
                                    Else
                                        If dentomofagi > d2_3SO Then
                                            sTF = "9et"
                                        Else
                                          If dfuterkowe > d2_3SO Then
                                                sTF = "9fu"
                                            Else
                                                If din_vitro > d2_3SO Then
                                                    sTF = "9iv"
                                                Else
                                                    If dkot > d2_3SO Then
                                                        sTF = "9kt"
                                                    Else
                                                        If dmysz_lab > d2_3SO Then
                                                            sTF = "9ml"
                                                        Else
                                                            If dpies > d2_3SO Then
                                                                sTF = "9ps"
                                                            Else
                                                                If dryby_akwariowe > d2_3SO Then
                                                                    sTF = "9ra"
                                                                Else
                                                                    If dszczur_lab > d2_3SO Then
                                                                        sTF = "9sl"
                                                                    Else
                                                                        If dslimaki > d2_3SO Then
                                                                            sTF = "9si"
                                                                        Else
                                                                            If draki > d2_3SO Then
                                                                                sTF = "9ri"
                                                                            Else
                                                                                If dzaby > d2_3SO Then
                                                                                    sTF = "9zy"
                                                                                Else
                                                                                    If dalpaki > d2_3SO Then
                                                                                        sTF = "9ai"
                                                                                    Else
                                                                                        If djelenie > d2_3SO Then
                                                                                            sTF = "9je"
                                                                                        Else
                                                                                            If ddaniele > d2_3SO Then
                                                                                                sTF = "9de"
                                                                                            Else
                                                                                                If dosly > d2_3SO Then
                                                                                                    sTF = "9oy"
                                                                                                Else
                                                                                                    If djedwabniki > d2_3SO Then
                                                                                                        sTF = "9ji"
                                                                                                    Else
                                                                                                        sTF = "9mi"
                                                                                                    End If
                                                                                                End If
                                                                                            End If
                                                                                        End If
                                                                                    End If
                                                                                End If
                                                                            End If
                                                                        End If
                                                                    End If
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            Else
                                sTF8 = "8"
                                If dP1 > d1_3SO And dP4 > d1_3SO Then
                                    If dP45 > d1_3GL And d30206 > d1_2P45 And dP45 < dP1 Then
                                        sTF = "831"
                                    Else
                                        If dP45 > d1_3GL And d30206 > d1_2P45 And dP45 >= dP1 Then
                                            sTF = "832"
                                        Else
                                            If dP1 > dP4 Then
                                                sTF = "833"
                                            Else
                                                sTF = "834"
                                            End If
                                        End If
                                    End If
                                Else
                                    If dP1 > d1_3SO And dP5 > d1_3SO Then
                                        sTF = "841"
                                    Else
                                        If dP3 > d1_3SO And dP4 > d1_3SO Then
                                            sTF = "842"
                                        Else
                                            If d307 > d2_3SO Then
                                                sTF = "843"
                                            Else
                                                sTF = "844"
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
End If

If dSO > 0 Then
    iNrW = 0
    sTF8_n = ""
    With Worksheets("TF8").Range("a1:a100")
        Set vWynik = .Find(sTF8, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrW = vWynik.Row
        End If
    End With
    
    If iNrW > 0 Then
        sTF8_n = Worksheets("TF8").Cells(iNrW, 2).Value
    End If
    
    iNrW = 0
    sTF_n = ""
    With Worksheets("TF").Range("a1:a100")
        Set vWynik = .Find(sTF, LookIn:=xlFormulas, LookAt:=xlWhole)
        If Not vWynik Is Nothing Then
            iNrW = vWynik.Row
        End If
    End With
    
    If iNrW > 0 Then
        sTF_n = Worksheets("TF").Cells(iNrW, 2).Value
    End If
Else
    sTF8 = "Brak"
    sTF = "Brak"
    sTF8_n = "Brak upraw i zwierz|fffd|t"
    sTF_n = "Brak upraw i zwierz|fffd|t"
End If

Worksheets("Info").Unprotect Password:=sPassS
Worksheets("Info").Range("TF8_" & sRx).Value = sTF8
Worksheets("Info").Range("TF_" & sRx).Value = sTF
Worksheets("Info").Range("TF8_n_" & sRx).Value = sTF8_n
Worksheets("Info").Range("TF_n_" & sRx).Value = sTF_n
Worksheets("Info").Protect Password:=sPassS

End Sub

Attribute VB_Name = "Ten_skoroszyt"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Option Base 1

Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As Boolean)

If IsEmpty(bOrgSkoroszyt) Then
    Application.Run "Auto.Ini4Pub"
End If

If bBlad Then
    Cancel = True
    Exit Sub
End If

If bOrgSkoroszyt Then
    MsgBox "Zapisanie skoroszytu '" & sSkoroszyt & "' zosta|fffd|o zablokowane!" & Chr(13) & _
    "Zapis zostanie wykonany automatycznie po wpisniu imienia i nazwiska lub identyfikatora Wnioskodawcy!", vbCritical, "Informacja..."
    Cancel = True
    Exit Sub
End If

If Not bSkoroszytSaved Then
    Application.Run "Nal4All.Nal4All"
End If

End Sub

Private Sub Workbook_BeforePrint(Cancel As Boolean)
Dim bScreenUpdating, bEnableEvents As Boolean

If ActiveWindow.SelectedSheets.Count > 1 Then
    MsgBox "Uwaga! Ze wzgl|fffd|du na zaznaczeniu wielu arkuszy wydruk nie jest mo|fffd|liwy!", vbCritical, "Drukowanie..."
    Cancel = True
    Exit Sub
End If

Application.Run "Nal4All.Nal4All"

If ActiveWorkbook.Saved = False Then
    If MsgBox("Przed wydrukowaniem konieczne jest zapisanie skoroszytu!" & Chr(13) & Chr(13) & "Czy zapisa|fffd| skoroszyt?", vbYesNo, "Zapisywanie skoroszytu...") = vbYes Then
        bScreenUpdating = Application.ScreenUpdating
        bEnableEvents = Application.EnableEvents
        
        Application.ScreenUpdating = False
        Application.EnableEvents = False
        
        ActiveWorkbook.Save
        
        Application.EnableEvents = bEnableEvents
        Application.ScreenUpdating = bScreenUpdating
    Else
        Cancel = True
    End If
End If

End Sub

Private Sub SetbOrgSkoroszyt()

bOrgSkoroszyt = False

End Sub

Private Sub Workbook_Activate()

Application.Run "M_Select.De_M_Select"

End Sub

Private Sub Workbook_Open()

Application.Run "M_Select.De_M_Select"

End Sub

Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)
Dim bScreenUpdating, bEnableEvents As Boolean

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

bScreenUpdating = Application.ScreenUpdating
bEnableEvents = Application.EnableEvents
Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets("Zestawienie").Unprotect Password:=sPassS

Worksheets("Zestawienie").Range("Modyfikacja").Value = Now

Worksheets("Zestawienie").Protect Password:=sPassS

Application.EnableEvents = bEnableEvents
Application.ScreenUpdating = bScreenUpdating

End Sub

Private Sub Workbook_WindowActivate(ByVal Wn As Window)

Application.Run "M_Select.De_M_Select"

End Sub
Attribute VB_Name = "UF_Asenizac"
Attribute VB_Base = "0{F2320F2A-0B9D-40F2-9C64-1825FB16B936}{DD226742-7AA5-49E2-BCAC-BBC98C148F92}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit
Option Base 1

Private Sub CB_Ok_Click()

iPkt0_p = 0
iPkt1_p = 0
iPkt2_p = 0
iPkt3_p = 0
iPkt4_p = 0

sInwM0_p = ""

iPkt0_p = iPkt_p
sInwM0_p = sInwM_p

If UF_Asenizac.ChB_1.Value Then
    iPkt1_p = 4
    iPkt0_p = iPkt0_p + iPkt1_p
    sInwM0_p = sInwM0_p & " + " & UF_Asenizac.ChB_1.Caption
End If
If UF_Asenizac.Chb_2.Value Then
    iPkt2_p = 8
    iPkt0_p = iPkt0_p + iPkt2_p
    sInwM0_p = sInwM0_p & " + " & UF_Asenizac.Chb_2.Caption
End If
If UF_Asenizac.Chb_3.Value Then
    iPkt3_p = 8
    iPkt0_p = iPkt0_p + iPkt3_p
    sInwM0_p = sInwM0_p & " + " & UF_Asenizac.Chb_3.Caption
End If
If UF_Asenizac.Chb_4.Value Then
    iPkt4_p = 5
    iPkt0_p = iPkt0_p + iPkt4_p
    sInwM0_p = sInwM0_p & " + " & UF_Asenizac.Chb_4.Caption
End If

UF_Asenizac.Hide

End Sub

Private Sub UserForm_Activate()

If iPkt1_p <> 0 Then
    UF_Asenizac.ChB_1.Value = True
Else
    UF_Asenizac.ChB_1.Value = False
End If
If iPkt2_p <> 0 Then
    UF_Asenizac.Chb_2.Value = True
Else
    UF_Asenizac.Chb_2.Value = False
End If
If iPkt3_p <> 0 Then
    UF_Asenizac.Chb_3.Value = True
Else
    UF_Asenizac.Chb_3.Value = False
End If
If iPkt4_p <> 0 Then
    UF_Asenizac.Chb_4.Value = True
Else
    UF_Asenizac.Chb_4.Value = False
End If

End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)

Cancel = True

End Sub
Attribute VB_Name = "UF_Cel"
Attribute VB_Base = "0{47696D8F-CB33-45C2-8156-DCA93EA2194D}{FDBCA605-3C55-4AA8-9932-5F4280019B82}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_Cel.CB_Cel.Visible = True
UF_Cel.CB_Cel.SetFocus
UF_Cel.CB_Cel.Value = ""
UF_Cel.CB_Cel.DropDown

End Sub

Private Sub CB_Cel_Click()

If iNacisnietaMysz = 1 Then
    WyborCel
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_Cel_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborCel
    Case 27
        UF_Cel.CB_Cel.Visible = False
        UF_Cel.Hide
End Select

End Sub

Private Sub CB_Cel_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborCel()
Dim sArk As String

sArk = ActiveSheet.Name

Application.EnableEvents = False

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
ActiveCell.Value = UF_Cel.CB_Cel.Text
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_Cel.CB_Cel.Visible = False
UF_Cel.Hide

Application.EnableEvents = True

End Sub

Attribute VB_Name = "UF_Gmi"
Attribute VB_Base = "0{3DD11774-131B-456D-AE9A-17976D7EEC76}{9B25A49F-429A-4BE3-AE44-B0AB98A67320}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_Gmi.CB_Gmi.Visible = True
UF_Gmi.CB_Gmi.SetFocus
UF_Gmi.CB_Gmi.Value = ""
UF_Gmi.CB_Gmi.DropDown

End Sub

Private Sub CB_Gmi_Click()

If iNacisnietaMysz = 1 Then
    WyborGmi
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_Gmi_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborGmi
    Case 27
        UF_Gmi.CB_Gmi.Visible = False
        UF_Gmi.Hide
End Select

End Sub

Private Sub CB_Gmi_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborGmi()
Dim sArk As String
Dim vWynik
Dim iNrW As Integer

Application.EnableEvents = False

With Worksheets("Gmi").Range("a1:a10000")
    Set vWynik = .Find(UF_Gmi.CB_Gmi.Text, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With

sNrWPGR = Left(Worksheets("Gmi").Cells(iNrW, 1).Value, 8)

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If
Worksheets(sArk).Unprotect Password:=sPassS
Select Case sArk
    Case "Dzialki"
        ActiveCell.Value = Mid(UF_Gmi.CB_Gmi.Text, 10)
        Cells(ActiveCell.Row, ActiveCell.Column + 1).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 2).Value = sNrWPGR
        Cells(ActiveCell.Row, ActiveCell.Column + 3).Value = ""
        Cells(ActiveCell.Row, 103).Value = sNrWPGR
        Cells(ActiveCell.Row, 104).Value = ""
        Cells(ActiveCell.Row, 105).Value = ""
End Select
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_Gmi.CB_Gmi.Visible = False
UF_Gmi.Hide

Application.EnableEvents = True

End Sub
Attribute VB_Name = "UF_INI"
Attribute VB_Base = "0{0DC2DE05-FCAB-4A00-A515-DD7F87A9A05B}{E1492429-C4D1-4ED4-B5A7-68E961C2E42E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1

Private Sub CB_Ok_Click()
Dim FSO As Object
Dim bCzyZapis As Boolean

Worksheets("Strona_tytulowa").Cells(8, 4).Value = UF_INI.TB_Imiona.Text
Worksheets("Strona_tytulowa").Cells(8, 4).Interior.ColorIndex = xlNone
Worksheets("Strona_tytulowa").Cells(8, 4).ClearComments

Worksheets("Strona_tytulowa").Cells(9, 4).Value = UF_INI.TB_Nazwisko.Text
Worksheets("Strona_tytulowa").Cells(9, 4).Interior.ColorIndex = xlNone
Worksheets("Strona_tytulowa").Cells(9, 4).ClearComments

Worksheets("Strona_tytulowa").Cells(15, 1).Value = UF_INI.CB_RIdent.Text & ":"
Worksheets("Strona_tytulowa").Cells(15, 1).ClearComments

Worksheets("Strona_tytulowa").Cells(15, 4).Value = UF_INI.TB_Identyfikator.Text
Worksheets("Strona_tytulowa").Cells(15, 4).Interior.ColorIndex = xlNone
Worksheets("Strona_tytulowa").Cells(15, 4).ClearComments

If UF_INI.CB_RIdent.Text <> "brak identyfikatora" Then
    sSkoroszyt = Kor4Skoroszyt(UF_INI.TB_Identyfikator.Text)
Else
    Randomize
    sSkoroszyt = Kor4Skoroszyt(UF_INI.TB_Nazwisko.Text & UF_INI.TB_Imiona.Text) & "-" & Int((9999 * Rnd) + 1000)
End If

sSkoroszyt = "BP_" & Worksheets("Info").Range("NrT") & "-" & sNabor & "_" & sWersja & "-" & sSkoroszyt & ".xls"

Set FSO = CreateObject("scripting.filesystemobject")
bCzyZapis = False
If FSO.FileExists(sKatalog & sSkoroszyt) Then
    MsgBox "Skoroszyt " & sSkoroszyt & " ju|fffd| istnieje w folderze" & Chr(13) & sKatalog & "." & Chr(13) & "Usu|fffd| skoroszyt i pon|fffd|w pr|fffd|b|fffd| zapisu poprzez edycj|fffd| imienia, nazwiska lub identyfikatora!", vbCritical, "Kontrola jako|fffd|ci danych..."
Else
    bCzyZapis = True
End If

If bCzyZapis Then
    UF_INI.Hide
    ActiveWorkbook.BuiltinDocumentProperties("Author").Value = sUzytkownik
    ActiveWorkbook.BuiltinDocumentProperties("Title").Value = sSkoroszyt
    If IsEmpty(sPassS) Then
        Application.Run "Auto.Ini4Pub"
    End If
    Worksheets("Info").Unprotect Password:=sPassS
    Worksheets("Info").Range("Skoroszyt").Value = sSkoroszyt
    Worksheets("Info").Protect Password:=sPassS
    ActiveWorkbook.SaveAs sKatalog & sSkoroszyt
    bOrgSkoroszyt = False
    UF_Zapisany.L_Folder = sKatalog
    UF_Zapisany.L_Skoroszyt = sSkoroszyt
    
    Application.Run "WB_SheetChange.WB_SheetChange"
    
    UF_Zapisany.Show
End If

End Sub

Private Sub UserForm_Activate()
Dim iNrP As Integer

If UF_INI.CB_RIdent.ListCount > 0 Then
    For iNrP = 1 To UF_INI.CB_RIdent.ListCount
        UF_INI.CB_RIdent.RemoveItem 0
    Next
End If
For iNrP = 2 To 1000
    If Worksheets("Identyfikator").Cells(iNrP, 1).Value = "" Then
        Exit For
    End If
    If InStr(Worksheets("Identyfikator").Cells(iNrP, 2).Value, sNrT) > 0 Then
        UF_INI.CB_RIdent.AddItem Worksheets("Identyfikator").Cells(iNrP, 1).Value
    End If
Next

UF_INI.TB_Imiona.BackColor = &HFF&
UF_INI.TB_Nazwisko.BackColor = &HFF&
UF_INI.CB_RIdent.BackColor = &HFF&

UF_INI.CB_Ok.Enabled = False

UF_INI.Caption = Worksheets("Parametry").Range("Szablon").Value & ". Nab|fffd|r: " & Worksheets("Parametry").Range("Nabor").Value & ". Wersja: " & Worksheets("Parametry").Range("Wersja").Value & ". Dane identyfikacyjne WNIOSKODAWCY niezb|fffd|dne do zapisania skoroszytu..."

End Sub

Private Sub TB_Imiona_Change()

If Check4ID(UF_INI.TB_Imiona.Text) Then
    UF_INI.TB_Imiona.BackColor = &H80000005
Else
    UF_INI.TB_Imiona.BackColor = &HFF&
End If

If Check4Ok(UF_INI.TB_Imiona.Text, UF_INI.TB_Nazwisko.Text, UF_INI.CB_RIdent.Text, UF_INI.TB_Identyfikator.Text) Then
    UF_INI.CB_Ok.Enabled = True
Else
    UF_INI.CB_Ok.Enabled = False
End If

End Sub

Private Sub TB_Nazwisko_Change()

If Check4ID(UF_INI.TB_Nazwisko) Then
    UF_INI.TB_Nazwisko.BackColor = &H80000005
Else
    UF_INI.TB_Nazwisko.BackColor = &HFF&
End If

If Check4Ok(UF_INI.TB_Imiona.Text, UF_INI.TB_Nazwisko.Text, UF_INI.CB_RIdent.Text, UF_INI.TB_Identyfikator.Text) Then
    UF_INI.CB_Ok.Enabled = True
Else
    UF_INI.CB_Ok.Enabled = False
End If

End Sub

Private Sub CB_RIdent_Change()

UF_INI.CB_RIdent.BackColor = &H80000005

If UF_INI.CB_RIdent.Text = "brak identyfikatora" Then
    UF_INI.L_Ident.Enabled = False
    UF_INI.TB_Identyfikator.Enabled = False
    UF_INI.TB_Identyfikator.Text = "-"
    UF_INI.TB_Identyfikator.BackColor = &H80000005
Else
    UF_INI.L_Ident.Enabled = True
    UF_INI.TB_Identyfikator.Enabled = True
    If UF_INI.CB_RIdent.Text = "Inny identyfikator" Then
        UF_INI.TB_Identyfikator.BackColor = &H80000005
    Else
        UF_INI.TB_Identyfikator.BackColor = &HFF&
    End If
    UF_INI.TB_Identyfikator.SetFocus
End If

If Check4Ok(UF_INI.TB_Imiona.Text, UF_INI.TB_Nazwisko.Text, UF_INI.CB_RIdent.Text, UF_INI.TB_Identyfikator.Text) Then
    UF_INI.CB_Ok.Enabled = True
Else
    UF_INI.CB_Ok.Enabled = False
End If

End Sub

Private Sub TB_Identyfikator_Change()
Dim bPoprawnyId
Dim sID As String

UF_INI.TB_Identyfikator.BackColor = &H80000005

bPoprawnyId = False
sID = UF_INI.TB_Identyfikator.Text

Select Case UF_INI.CB_RIdent.Text
    Case "PESEL"
        bPoprawnyId = Chk4PESEL(sID)
    Case "NIP"
        bPoprawnyId = Chk4NIP(sID)
    Case "REGON"
        bPoprawnyId = Chk4Regon(sID)
    Case "Nr identyfikacyjny EP"
        bPoprawnyId = Chk4Nr_EP(sID)
    Case Else
        bPoprawnyId = Check4ID(sID)
End Select

If Not bPoprawnyId Then
    UF_INI.TB_Identyfikator.BackColor = &HFF&
End If

If Check4Ok(UF_INI.TB_Imiona.Text, UF_INI.TB_Nazwisko.Text, UF_INI.CB_RIdent.Text, UF_INI.TB_Identyfikator.Text) Then
    UF_INI.CB_Ok.Enabled = True
Else
    UF_INI.CB_Ok.Enabled = False
End If

End Sub

Private Sub UserForm_Terminate()

UF_INI.Hide

MsgBox "U|fffd|ytkownik zrezygnowa|fffd| z utworzenia nazwy i zapisania skoroszytu." & Chr(13) & "Nast|fffd|pi zamkni|fffd|cie skoroszytu!", vbInformation, "Kontrola jako|fffd|ci danych..."

ActiveWorkbook.Close SaveChanges:=False

End Sub

Private Sub CB_Anuluj_Click()

UF_INI.Hide

MsgBox "U|fffd|ytkownik zrezygnowa|fffd| z utworzenia nazwy i zapisania skoroszytu." & Chr(13) & "Nast|fffd|pi zamkni|fffd|cie skoroszytu!", vbInformation, "Kontrola jako|fffd|ci danych..."

ActiveWorkbook.Close SaveChanges:=False

End Sub

Private Function Chk4NIP(ByVal pNIP As String) As Boolean
 
Dim TabWag()
Dim lNIP As String
Dim lSK As Integer
Dim lNrZ As Integer
 
Chk4NIP = False
 
lSK = 0
 
TabWag = Array(6, 5, 7, 2, 3, 4, 5, 6, 7)
 
lNIP = LTrim(RTrim(pNIP))
lNIP = Replace(lNIP, " ", "")
lNIP = Replace(lNIP, "-", "")

If Len(lNIP) = 10 And IsNumeric(lNIP) Then
    lNrZ = 0
    For lNrZ = 1 To 9
        lSK = lSK + (Mid(lNIP, lNrZ, 1) * CInt(TabWag(lNrZ)))
    Next
    If lSK Mod 11 = Mid(lNIP, 10, 1) Then
        Chk4NIP = True
    End If
End If
 
End Function

Private Function Chk4PESEL(ByVal pPesel As String) As Boolean
 
Dim TabWag()
Dim lPESEL As String
Dim lSK As Integer
Dim lNrZ As Integer
 
Chk4PESEL = False
 
lSK = 0
 
TabWag = Array(1, 3, 7, 9, 1, 3, 7, 9, 1, 3, 1)
 
lPESEL = LTrim(RTrim(pPesel))
 
If Len(lPESEL) = 11 And IsNumeric(lPESEL) Then
    lNrZ = 0
    For lNrZ = 1 To 11
        lSK = lSK + (Mid(lPESEL, lNrZ, 1) * CInt(TabWag(lNrZ)))
    Next
    If lSK Mod 10 = 0 Then
        Chk4PESEL = True
    End If
End If
 
End Function

Private Function Chk4Regon(ByVal pRegon As String) As Boolean
Dim iDlRegon, iNrR, iDlR, iNrWag9, iIlWag9, iWag9, iNrWag14, iIlWag14, iWag14 As Integer
Dim sRs, sREGON As String
Dim dR, dSK As Double
Dim TabWag9(), TabWag14()
Dim bChk4Regon As Boolean

Chk4Regon = False
bChk4Regon = False

TabWag9 = Array(8, 9, 2, 3, 4, 5, 6, 7)
TabWag14 = Array(2, 4, 8, 5, 0, 9, 7, 3, 6, 1, 2, 4, 8)

sREGON = LTrim(RTrim(pRegon))
sREGON = Replace(sREGON, " ", "")
sREGON = Replace(sREGON, "-", "")
iDlRegon = Len(sREGON)

Select Case iDlRegon
    Case Is <= 9
        iDlR = 9
    Case Is <= 14
        iDlR = 14
End Select

sREGON = Left(sREGON & String(iDlR, "0"), iDlR)

iDlRegon = Len(sREGON)

If iDlRegon = 9 Or iDlRegon = 14 Then
    For iNrR = 1 To 8
        iWag9 = TabWag9(iNrR)
        sRs = Mid(sREGON, iNrR, 1)
        If IsNumeric(sRs) Then
            dR = Val(sRs)
            dSK = dSK + dR * iWag9
        Else
            Exit For
        End If
    Next
    dSK = dSK Mod 11
    If dSK = 10 Then
        dSK = 0
    End If
    sRs = Mid(sREGON, 9, 1)
    If IsNumeric(sRs) Then
        dR = Val(sRs)
        If dR = dSK Then
            bChk4Regon = True
        End If
    End If
End If

If bChk4Regon And iDlRegon = 14 Then
    bChk4Regon = False
    dSK = 0
    For iNrR = 1 To 13
        iWag14 = TabWag14(iNrR)
        sRs = Mid(sREGON, iNrR, 1)
        If IsNumeric(sRs) Then
            dR = Val(sRs)
            dSK = dSK + dR * iWag14
        Else
            Exit For
        End If
    Next
    dSK = dSK Mod 11
    If dSK = 10 Then
        dSK = 0
    End If
    sRs = Mid(sREGON, 14, 1)
    If IsNumeric(sRs) Then
        dR = Val(sRs)
        If dR = dSK Then
            bChk4Regon = True
        End If
    End If

End If

Chk4Regon = bChk4Regon

End Function

Private Function Chk4Nr_EP(ByVal pNr_EP As String) As Boolean
Dim iLp, iSn, iSp, iSuma, iCK, iCK_, iV As Integer
Dim iDlNr_EP, iNr As Integer
Dim sZ, sP, sZ_ As String

sP = "02468"

Chk4Nr_EP = False

iDlNr_EP = Len(pNr_EP) - 1

If iDlNr_EP <> 8 Then
    Exit Function
End If

iCK_ = Val(Right(pNr_EP, 1))

iLp = 0

For iNr = 1 To iDlNr_EP
    sZ = Mid(pNr_EP, iNr, 1)
    If iNr < iDlNr_EP Then
        sZ_ = Mid(pNr_EP, iNr + 1, 1)
        If sZ = sZ_ Then
            Exit Function
        End If
    End If
    iV = Val(sZ)
    If InStr(sP, sZ) > 0 Then
        iLp = iLp + 1
        iSp = iSp + iV
    Else
        iSn = iSn + iV
    End If
Next

iCK = (23 * iSp + 17 * iSn + iLp) Mod 7

If iCK = iCK_ Then
    Chk4Nr_EP = True
End If

End Function

Private Function Check4ID(pID) As Boolean
Dim sDozwoloneZnaki, sZ As String
Dim iNrZ, iIlZ As Integer

sDozwoloneZnaki = " a|fffd|bc|fffd|de|fffd|fghijkl|fffd|mn|fffd|o|fffd|pqrs|fffd|tuwvxyz|fffd||fffd|A|fffd|BC|fffd|DE|fffd|FGHIJKL|fffd|MN|fffd|O|fffd|PQRS|fffd|TUWVXYZ|fffd||fffd|-+=*_&,.;/:()[]{}<>'`" & Chr(9) & Chr(10) & Chr(11) & Chr(12) & Chr(13) & Chr(14) & Chr(15) & Chr(34) & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|0123456789"

Check4ID = False

iIlZ = Len(pID)

If iIlZ > 0 Then
    Check4ID = True
    For iNrZ = 1 To iIlZ
        sZ = Mid(pID, iNrZ, 1)
        If InStr(sDozwoloneZnaki, sZ) = 0 Then
            Check4ID = False
            MsgBox "B|fffd||fffd|d! Nieprawid|fffd|owy znak '" & sZ & "' w imieniu lub nazwisku '" & pID & "'!", vbCritical, "Kontrola poprawno|fffd|ci danych..."
        End If
    Next
End If

End Function

Private Function Check4Ok(pImiona, pNazwisko, pRIdent, pIdentyfikator) As Boolean
Dim bPoprawnyId As Boolean

Check4Ok = True

If Check4ID(pImiona) Then
    If Check4ID(pNazwisko) Then
        If pRIdent <> "" Then
            If pRIdent = "brak identyfikatora" Then
                Check4Ok = True
            Else
                Select Case pRIdent
                    Case "PESEL"
                        bPoprawnyId = Chk4PESEL(pIdentyfikator)
                    Case "NIP"
                        bPoprawnyId = Chk4NIP(pIdentyfikator)
                    Case "REGON"
                        bPoprawnyId = Chk4Regon(pIdentyfikator)
                    Case "Nr identyfikacyjny EP"
                        bPoprawnyId = Chk4Nr_EP(pIdentyfikator)
                    Case Else
                        bPoprawnyId = Check4ID(pIdentyfikator)
                End Select
                    Check4Ok = bPoprawnyId
            End If
        Else
            Check4Ok = False
        End If
    Else
        Check4Ok = False
    End If
Else
    Check4Ok = False
End If

End Function

Function Kor4Skoroszyt(pID) As String
Dim sDozwoloneZnaki, sZ, sPlZ, sWinZ, sPlZ_, sWinZ_ As String
Dim iNrZ, iIlZ As Integer

sPlZ = "|fffd||fffd||fffd||fffd||dcfdf||fffd||fffd||2a3||fffd||4cc||fffd||fffd|"
sWinZ = "acelnoszzACELNOSZZ"

iIlZ = Len(sPlZ)
For iNrZ = 1 To iIlZ
    sPlZ_ = Mid(sPlZ, iNrZ, 1)
    sWinZ_ = Mid(sWinZ, iNrZ, 1)
    pID = Replace(pID, sPlZ_, sWinZ_)
Next

sDozwoloneZnaki = "-abcdefghijklmnopqrstuwvxyzABCDEFGHIJKLMNOPQRSTUWVXYZ0123456789"

Kor4Skoroszyt = ""

iIlZ = Len(pID)
For iNrZ = 1 To iIlZ
    sZ = Mid(pID, iNrZ, 1)
    If InStr(sDozwoloneZnaki, sZ) = 0 Then
        sZ = "_"
    End If
    Kor4Skoroszyt = Kor4Skoroszyt & sZ
Next

End Function
Attribute VB_Name = "UF_InwM"
Attribute VB_Base = "0{22EDB712-AE3D-496E-A48D-728B73E85BB7}{AA97436F-924D-4F4C-ADAE-D311D3099411}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_InwM.CB_InwM.Visible = True
UF_InwM.CB_InwM.SetFocus
UF_InwM.CB_InwM.Value = ""
UF_InwM.CB_InwM.DropDown

End Sub

Private Sub CB_InwM_Click()

If iNacisnietaMysz = 1 Then
    WyborInwM
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_InwM_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborInwM
    Case 27
        UF_InwM.CB_InwM.Visible = False
        UF_InwM.Hide
End Select

End Sub

Private Sub CB_InwM_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborInwM()
Dim vWynik
Dim iNrW As Integer
Dim sArk As String
Dim bJestOprys, bJestRozrzut As Boolean

Application.EnableEvents = False

With Worksheets("Inwestycje_M").Range("b1:b10000")
    Set vWynik = .Find(UF_InwM.CB_InwM.Text, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With

iPkt0_p = 0
iPkt1_p = 0
iPkt2_p = 0
iPkt3_p = 0
iPkt4_p = 0
iPkt5_p = 0
sInwM0_p = ""

sInwM_p = UF_InwM.CB_InwM.Text

If sInwM_p = vbEmpty Or sInwM_p = "" Then
    Application.EnableEvents = True
    Exit Sub
End If

iPkt_p = Worksheets("Inwestycje_M").Cells(iNrW, 3).Value

sArk = ActiveSheet.Name

iNrWW_p = ActiveCell.Row

If InStr("RMG0540RMG0550RMG0560RMG0570RMG0580", Left(sInwM_p, 7)) > 0 Then
'opryskiwacz
    iPkt1_p = Cells(iNrWW_p, 102).Value
    iPkt2_p = Cells(iNrWW_p, 103).Value
    iPkt3_p = Cells(iNrWW_p, 104).Value
    iPkt4_p = Cells(iNrWW_p, 105).Value
    iPkt5_p = Cells(iNrWW_p, 106).Value
    UF_Oprys.Show
End If

If InStr("RMG0631RMG0632RMG0640", Left(sInwM_p, 7)) > 0 Then
'rozrzutnik
    iPkt1_p = Cells(iNrWW_p, 102).Value
    iPkt2_p = Cells(iNrWW_p, 103).Value
    UF_Rozrzut.Show
End If

If InStr("RMG0620", Left(sInwM_p, 7)) > 0 Then
'woz asenizacyjny
    iPkt1_p = Cells(iNrWW_p, 102).Value
    iPkt2_p = Cells(iNrWW_p, 103).Value
    UF_Asenizac.Show
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
ActiveCell.Value = sInwM_p
Cells(iNrWW_p, 101).Value = iPkt_p
If InStr("RMG0540RMG0550RMG0560RMG0570RMG0580", Left(sInwM_p, 7)) > 0 Then
    ActiveCell.Value = sInwM0_p
    Cells(iNrWW_p, 101).Value = iPkt0_p

    Cells(iNrWW_p, 102).Value = iPkt1_p
    Cells(iNrWW_p, 103).Value = iPkt2_p
    Cells(iNrWW_p, 104).Value = iPkt3_p
    Cells(iNrWW_p, 105).Value = iPkt4_p
    Cells(iNrWW_p, 106).Value = iPkt5_p
End If

If InStr("RMG0631RMG0632RMG0640", Left(sInwM_p, 7)) > 0 Then
    ActiveCell.Value = sInwM0_p
    Cells(iNrWW_p, 101).Value = iPkt0_p

    Cells(iNrWW_p, 102).Value = iPkt1_p
    Cells(iNrWW_p, 103).Value = iPkt2_p
End If

If InStr("RMG0620", Left(sInwM_p, 7)) > 0 Then
    ActiveCell.Value = sInwM0_p
    Cells(iNrWW_p, 101).Value = iPkt0_p

    Cells(iNrWW_p, 102).Value = iPkt1_p
    Cells(iNrWW_p, 103).Value = iPkt2_p
    Cells(iNrWW_p, 104).Value = iPkt3_p
    Cells(iNrWW_p, 105).Value = iPkt4_p
End If

If InStr("RMG0540RMG0550RMG0560RMG0570RMG0580", Left(sInwM_p, 7)) = 0 And _
InStr("RMG0631RMG0632RMG0640", Left(sInwM_p, 7)) = 0 And _
InStr("RMG0620", Left(sInwM_p, 7)) = 0 Then
    Cells(iNrWW_p, 102).Value = 0
    Cells(iNrWW_p, 103).Value = 0
    Cells(iNrWW_p, 104).Value = 0
    Cells(iNrWW_p, 105).Value = 0
    Cells(iNrWW_p, 106).Value = 0
End If

Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_InwM.CB_InwM.Visible = False
UF_InwM.Hide

Application.EnableEvents = True

End Sub

Attribute VB_Name = "UF_InwNaDzialce"
Attribute VB_Base = "0{2642C02C-61DC-455D-AF7A-07F825400C9C}{260FB83E-AB7E-45D7-AF1E-7BAD4A49E33D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1

Private Sub CB_Ok_Click()
Dim iNrList As Integer
Dim sInwNaDzialce, sArk As String

sInwNaDzialce = _
"Inwestycja budowlana [" & UF_InwNaDzialce.LB_Inw.Text & "] planowana jest na dzia|fffd|kach ["

For iNrList = 0 To UF_InwNaDzialce.LB_Dzialki.ListCount - 1
    If UF_InwNaDzialce.LB_Dzialki.Selected(iNrList) Then
        sInwNaDzialce = sInwNaDzialce & UF_InwNaDzialce.LB_Dzialki.List(iNrList) & ", "
    End If
Next

If Right(sInwNaDzialce, 2) = ", " Then
    sInwNaDzialce = Left(sInwNaDzialce, Len(sInwNaDzialce) - 2)
End If

sInwNaDzialce = sInwNaDzialce & "]."

Application.EnableEvents = False

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

sArk = "Pozostale_informacje"
Worksheets(sArk).Unprotect Password:=sPassS

Worksheets(sArk).Range("InwNaDzialce").Value = sInwNaDzialce

Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

Application.EnableEvents = True

UF_InwNaDzialce.Hide

End Sub

Private Sub LB_Dzialki_Change()
Dim iNrList As Integer
Dim bJestDzialka As Boolean

bJestDzialka = False

For iNrList = 0 To UF_InwNaDzialce.LB_Dzialki.ListCount - 1
    If UF_InwNaDzialce.LB_Dzialki.Selected(iNrList) Then
        bJestDzialka = True
        Exit For
    End If
Next

If UF_InwNaDzialce.LB_Inw.Value <> "" And bJestDzialka Then
    UF_InwNaDzialce.CB_Ok.Enabled = True
Else
    UF_InwNaDzialce.CB_Ok.Enabled = False
End If

End Sub

Private Sub LB_Inw_Change()
Dim iNrList As Integer
Dim bJestDzialka As Boolean

bJestDzialka = False

For iNrList = 0 To UF_InwNaDzialce.LB_Dzialki.ListCount - 1
    If UF_InwNaDzialce.LB_Dzialki.Selected(iNrList) Then
        bJestDzialka = True
        Exit For
    End If
Next

If UF_InwNaDzialce.LB_Inw.Value <> "" And bJestDzialka Then
    UF_InwNaDzialce.CB_Ok.Enabled = True
Else
    UF_InwNaDzialce.CB_Ok.Enabled = False
End If

End Sub

Private Sub UserForm_Activate()
Dim iNrW As Integer
Dim sTERC, sNrObrebu, sNrArkusza, sNrDzialki, sIdDzialki, sTxt, sArk As String
Dim bJest_Dz, bJest_I, bJest_P, bDo_usu As Boolean
Dim Tab_Tmp, Tab_Inw()
Dim iNrInw, iIlInw As Integer
Dim sInw As String

UF_InwNaDzialce.CB_Ok.Enabled = False

sArk = ActiveSheet.Name

sTxt = ""
iNrDzialki = 0
bJest_Dz = False
For iNrW = 17 To 1000
    If Worksheets("Dzialki").Rows(iNrW).EntireRow.Hidden Then
        Exit For
    End If
    sTERC = Worksheets("Dzialki").Cells(iNrW, 6).Value
    sNrObrebu = Worksheets("Dzialki").Cells(iNrW, 7).Value
    sNrArkusza = Worksheets("Dzialki").Cells(iNrW, 8).Value
    sNrDzialki = Worksheets("Dzialki").Cells(iNrW, 9).Value
    If sTERC <> "" And sNrObrebu <> "" And sNrDzialki <> "" Then
        sIdDzialki = sTERC & "." & sNrObrebu & IIf(sNrArkusza <> "", "." & sNrArkusza, "") & "-" & sNrDzialki & " | " & Worksheets("Dzialki").Cells(iNrW, 13).Value
        If InStr(sTxt, ";" & sIdDzialki & ";") = 0 Then
            iNrDzialki = iNrDzialki + 1
            ReDim Preserve Tab_Dzialki(iNrDzialki)
            Tab_Dzialki(iNrDzialki) = sIdDzialki
            sTxt = sTxt & ";" & Tab_Dzialki(iNrDzialki) & ";"
            bJest_Dz = True
        Else
            MsgBox "Ostrze|fffd|enie: w arkuszu 'Dzia|fffd|ki'!" & Chr(13) & "Dzia|fffd|ka o Id. " & sIdDzialki & " wyst|fffd|puje wi|fffd|cej ni|fffd| raz w arkuszu 'Dzialki'!", vbCritical, "Kontrola jako|fffd|ci danych..."
        End If
    End If
Next

If bJest_Dz Then
    iIlDzialki = UBound(Tab_Dzialki)
Else
    iIlDzialki = 0
End If

If iIlDzialki = 0 Then
    MsgBox "Brak dzia|fffd|ek w arkuszu 'Dzialki'!" & Chr(13) & "Prosz|fffd| dopisa|fffd| dzia|fffd|ki w arkuszu 'Dzialki'!", vbCritical, "Inwestycje na dzia|fffd|kach..."
    UF_InwNaDzialce.Hide
    
    Application.EnableEvents = False
    
    If IsEmpty(sPassS) Then
        Application.Run "Auto.Ini4Pub"
    End If
    
    sArk = "Pozostale_informacje"
    Worksheets(sArk).Unprotect Password:=sPassS
    
    Worksheets(sArk).Range("InwNaDzialce").Value = ""
    
    Worksheets(sArk).Protect Password:=sPassS
    
    Application.Run "WB_SheetChange.WB_SheetChange"
    
    Application.EnableEvents = True
    
    Exit Sub
End If
'---------------------------------------------------------------

sTxt = ""
iNrInw = 0
bJest_I = False
For iNrW = 5 To 1000
    If Worksheets("Inwestycje_w_ochrone_srod").Rows(iNrW).EntireRow.Hidden Then
        Exit For
    End If
    sInw = Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 2).Value & " | " & _
    Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 3).Value & " | " & _
    Worksheets("Inwestycje_w_ochrone_srod").Cells(iNrW, 5).Value
    If sInw <> "" Then
            iNrInw = iNrInw + 1
            ReDim Preserve Tab_Inw(iNrInw)
            Tab_Inw(iNrInw) = sInw
            bJest_I = True
    End If
Next

For iNrW = 5 To 1000
    If Worksheets("Inwestycje_pozostale").Rows(iNrW).EntireRow.Hidden Then
        Exit For
    End If
    sInw = Worksheets("Inwestycje_pozostale").Cells(iNrW, 2).Value & " | " & _
    Worksheets("Inwestycje_pozostale").Cells(iNrW, 3).Value & " | " & _
    Worksheets("Inwestycje_pozostale").Cells(iNrW, 5).Value
    If sInw <> "" Then
            iNrInw = iNrInw + 1
            ReDim Preserve Tab_Inw(iNrInw)
            Tab_Inw(iNrInw) = sInw
            bJest_I = True
    End If
Next

If bJest_I Then
    iIlInw = UBound(Tab_Inw)
Else
    iIlInw = 0
End If

If iIlInw = 0 Then
    MsgBox "Brak inwestycji w arkuszach 'Planowane inwestycje_w_ochrone_srod' oraz 'Planowane inwestycje_pozostale'!" & Chr(13) & "Prosz|fffd| dopisa|fffd| inwestycje w arkuszu 'Planowane inwestycje_w_ochrone_srod' lub 'Planowane inwestycje_pozostale'!", vbCritical, "Planowane inwestycje na dzia|fffd|kach..."
     UF_InwNaDzialce.Hide
     
     Application.EnableEvents = False
    
    If IsEmpty(sPassS) Then
        Application.Run "Auto.Ini4Pub"
    End If
    
    sArk = "Pozostale_informacje"
    Worksheets(sArk).Unprotect Password:=sPassS
    
    Worksheets(sArk).Range("InwNaDzialce").Value = ""
    
    Worksheets(sArk).Protect Password:=sPassS
    
    Application.Run "WB_SheetChange.WB_SheetChange"
    
    Application.EnableEvents = True
    Exit Sub
End If
'---------------------------------------------------------------

If UF_InwNaDzialce.LB_Dzialki.ListCount > 0 Then
'    For iNrDzialki = 1 To UF_InwNaDzialce.LB_Dzialki.ListCount
'        UF_InwNaDzialce.LB_Dzialki.RemoveItem 0
'    Next
    UF_InwNaDzialce.LB_Dzialki.Clear
End If
'For iNrDzialki = 1 To iIlDzialki
'    UF_InwNaDzialce.LB_Dzialki.AddItem Tab_Dzialki(iNrDzialki)
'Next
UF_InwNaDzialce.LB_Dzialki.List = Tab_Dzialki

'---------------------------------------------------------------
If UF_InwNaDzialce.LB_Inw.ListCount > 0 Then
'    For iNrInw = 1 To UF_InwNaDzialce.LB_Inw.ListCount
'        UF_InwNaDzialce.LB_Inw.RemoveItem 0
'    Next
    UF_InwNaDzialce.LB_Inw.Clear
End If
'For iNrInw = 1 To iIlInw
'    UF_InwNaDzialce.LB_Inw.AddItem Tab_Inw(iNrInw)
'Next
UF_InwNaDzialce.LB_Inw.List = Tab_Inw

End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)

Cancel = True

End Sub
Attribute VB_Name = "UF_Nie_wolno"
Attribute VB_Base = "0{ED6A1A53-A241-43DA-A9A3-8BD010BE932B}{766B0775-1D90-4C9E-A91A-22E491883AB0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub ChB_Form_Change()

If UF_Nie_wolno.ChB_Form.Value And UF_Nie_wolno.ChB_Wstaw.Value And UF_Nie_wolno.ChB_Wyk.Value And UF_Nie_wolno.ChB_Wkop.Value Then
    UF_Nie_wolno.CB_RiA.Enabled = True
Else
    UF_Nie_wolno.CB_RiA.Enabled = False
End If

End Sub

Private Sub CB_Anuluj_Click()

UF_Nie_wolno.Hide

End Sub

Private Sub CB_RiA_Click()

bNie_wolno = True

UF_Nie_wolno.Hide

End Sub

Private Sub ChB_Wkop_Change()

If UF_Nie_wolno.ChB_Form.Value And UF_Nie_wolno.ChB_Wstaw.Value And UF_Nie_wolno.ChB_Wyk.Value And UF_Nie_wolno.ChB_Wkop.Value Then
    UF_Nie_wolno.CB_RiA.Enabled = True
Else
    UF_Nie_wolno.CB_RiA.Enabled = False
End If

End Sub

Private Sub ChB_Wstaw_Change()

If UF_Nie_wolno.ChB_Form.Value And UF_Nie_wolno.ChB_Wstaw.Value And UF_Nie_wolno.ChB_Wyk.Value And UF_Nie_wolno.ChB_Wkop.Value Then
    UF_Nie_wolno.CB_RiA.Enabled = True
Else
    UF_Nie_wolno.CB_RiA.Enabled = False
End If

End Sub

Private Sub ChB_Wyk_Change()

If UF_Nie_wolno.ChB_Form.Value And UF_Nie_wolno.ChB_Wstaw.Value And UF_Nie_wolno.ChB_Wyk.Value And UF_Nie_wolno.ChB_Wkop.Value Then
    UF_Nie_wolno.CB_RiA.Enabled = True
Else
    UF_Nie_wolno.CB_RiA.Enabled = False
End If

End Sub

Private Sub UserForm_Activate()

UF_Nie_wolno.Caption = Worksheets("Parametry").Range("Szablon").Value & ". Nab|fffd|r: " & Worksheets("Parametry").Range("Nabor").Value & ". Wersja: " & Worksheets("Parametry").Range("Wersja").Value & ". Kontrola jako|fffd|ci danych..."

End Sub

Attribute VB_Name = "UF_Obreb"
Attribute VB_Base = "0{18403829-67E7-4739-AFC9-058EA5FD4F00}{E0169310-6A1A-4C10-98A1-DDE83762B9CA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_Obreb.CB_Obreb.Visible = True
UF_Obreb.CB_Obreb.SetFocus
UF_Obreb.CB_Obreb.Value = ""
UF_Obreb.CB_Obreb.DropDown

End Sub

Private Sub CB_Obreb_Click()

If iNacisnietaMysz = 1 Then
    WyborObreb
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_Obreb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborObreb
    Case 27
        UF_Obreb.CB_Obreb.Visible = False
        UF_Obreb.Hide
End Select

End Sub

Private Sub CB_Obreb_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborObreb()
Dim sArk As String
Dim vWynik
Dim iNrW As Double

Application.EnableEvents = False

With Worksheets("Obreb").Range("a1:a65000")
    Set vWynik = .Find(UF_Obreb.CB_Obreb.Text, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With

sNrO = Left(Worksheets("Obreb").Cells(iNrW, 1).Value, 4)

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
Select Case sArk
    Case "Dzialki"
        ActiveCell.Value = Mid(UF_Obreb.CB_Obreb.Text, 6)
        Cells(ActiveCell.Row, ActiveCell.Column + 2).Value = sNrO
        Cells(ActiveCell.Row, 104).Value = sNrO
End Select
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_Obreb.CB_Obreb.Visible = False
UF_Obreb.Hide

Application.EnableEvents = True

End Sub
Attribute VB_Name = "UF_Oprys"
Attribute VB_Base = "0{700A6AA7-DF49-4ED9-9D9C-51B0FFA2FFB5}{6D2CFF12-2600-48AB-8A2D-A6C1C7CA2C3D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1

Private Sub CB_Ok_Click()

iPkt0_p = 0
iPkt1_p = 0
iPkt2_p = 0
iPkt3_p = 0
iPkt4_p = 0
iPkt5_p = 0
sInwM0_p = ""

iPkt0_p = iPkt_p
sInwM0_p = sInwM_p

If UF_Oprys.ChB_1.Value Then
    iPkt1_p = 6
    iPkt0_p = iPkt0_p + iPkt1_p
    sInwM0_p = sInwM0_p & " + " & UF_Oprys.ChB_1.Caption
End If
If UF_Oprys.Chb_2.Value Then
    iPkt2_p = 12
    iPkt0_p = iPkt0_p + iPkt2_p
    sInwM0_p = sInwM0_p & " + " & UF_Oprys.Chb_2.Caption
End If
If UF_Oprys.Chb_3.Value Then
    iPkt3_p = 6
    iPkt0_p = iPkt0_p + iPkt3_p
    sInwM0_p = sInwM0_p & " + " & UF_Oprys.Chb_3.Caption
End If
If UF_Oprys.Chb_4.Value Then
    iPkt4_p = 6
    iPkt0_p = iPkt0_p + iPkt4_p
    sInwM0_p = sInwM0_p & " + " & UF_Oprys.Chb_4.Caption
End If
If UF_Oprys.ChB_5.Value Then
    iPkt5_p = 3
    iPkt0_p = iPkt0_p + iPkt5_p
    sInwM0_p = sInwM0_p & " + " & UF_Oprys.ChB_5.Caption
End If

If iPkt0_p > 17 Then
    iPkt0_p = 17
End If

UF_Oprys.Hide

End Sub

Private Sub UserForm_Activate()

If iPkt1_p <> 0 Then
    UF_Oprys.ChB_1.Value = True
Else
    UF_Oprys.ChB_1.Value = False
End If
If iPkt2_p <> 0 Then
    UF_Oprys.Chb_2.Value = True
Else
    UF_Oprys.Chb_2.Value = False
End If
If iPkt3_p <> 0 Then
    UF_Oprys.Chb_3.Value = True
Else
    UF_Oprys.Chb_3.Value = False
End If
If iPkt4_p <> 0 Then
    UF_Oprys.Chb_4.Value = True
Else
    UF_Oprys.Chb_4.Value = False
End If
If iPkt5_p <> 0 Then
    UF_Oprys.ChB_5.Value = True
Else
    UF_Oprys.ChB_5.Value = False
End If

End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)

Cancel = True

End Sub
Attribute VB_Name = "UF_PCz"
Attribute VB_Base = "0{92A4B562-380C-4B18-BDC8-93F547600B11}{532CC061-38DD-409D-B555-F0B913FD876D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_Activate()

UF_PCz.Repaint

End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)

Cancel = True

End Sub
Attribute VB_Name = "UF_Pow"
Attribute VB_Base = "0{A7CA90E4-33C1-49CD-9947-AB3D2F04FF32}{D616F3C9-962F-41B1-AC16-EA3B3C9DED9F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_Pow.CB_Pow.Visible = True
UF_Pow.CB_Pow.SetFocus
UF_Pow.CB_Pow.Value = ""
UF_Pow.CB_Pow.DropDown

End Sub

Private Sub CB_Pow_Click()

If iNacisnietaMysz = 1 Then
    WyborPow
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_Pow_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborPow
    Case 27
        UF_Pow.CB_Pow.Visible = False
        UF_Pow.Hide
End Select

End Sub

Private Sub CB_Pow_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborPow()
Dim sArk As String
Dim vWynik
Dim iNrW As Integer

Application.EnableEvents = False

With Worksheets("Pow").Range("b1:b1000")
    Set vWynik = .Find(UF_Pow.CB_Pow.Text, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With

sNrWP = Worksheets("Pow").Cells(iNrW, 1).Value

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
Select Case sArk
    Case "Dzialki"
        ActiveCell.Value = UF_Pow.CB_Pow.Text
        Cells(ActiveCell.Row, 102).Value = sNrWP
        Cells(ActiveCell.Row, ActiveCell.Column + 1).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 2).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 3).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 4).Value = ""
        Cells(ActiveCell.Row, 103).Value = ""
        Cells(ActiveCell.Row, 104).Value = ""
        Cells(ActiveCell.Row, 105).Value = ""
End Select
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_Pow.CB_Pow.Visible = False
UF_Pow.Hide

Application.EnableEvents = True

End Sub

Attribute VB_Name = "UF_Przypisanie"
Attribute VB_Base = "0{1AA07329-080E-4C00-95D3-F530FBE3B1B4}{5943B350-E8C7-4D00-967D-31C8671F69CB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1

Private Tab_Dz(), Tab_U() As String

Private Sub CB_Koniec_Click()

UF_Przypisanie.Hide

End Sub

Private Sub CB_Przypisz_Click()
Dim iNr_Dz, iNr_U, iIl_Dz, iIl_U, iIl_P, iNrW As Integer
Dim sDzialka, sUprawa, sPrzypisanie, sArk As String
Dim vWynik

sArk = "Przypisanie_upraw_do_dzialek"

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

iIl_Dz = UF_Przypisanie.LB_Dzialki.ListCount - 1
iIl_U = UF_Przypisanie.LB_Uprawy.ListCount - 1
iIl_P = UF_Przypisanie.LB_Przypisania.ListCount - 1

For iNr_Dz = 0 To iIl_Dz
    If UF_Przypisanie.LB_Dzialki.Selected(iNr_Dz) Then
        sDzialka = UF_Przypisanie.LB_Dzialki.List(iNr_Dz)
        For iNr_U = 0 To iIl_U
            If UF_Przypisanie.LB_Uprawy.Selected(iNr_U) Then
                sUprawa = UF_Przypisanie.LB_Uprawy.List(iNr_U)
                sPrzypisanie = sDzialka & sUprawa
               
                iNrW = 0
                With Worksheets(sArk).Range("d2:d10000")
                    Set vWynik = .Find(sPrzypisanie, LookIn:=xlFormulas, LookAt:=xlWhole)
                    If Not vWynik Is Nothing Then
                        iNrW = vWynik.Row
                    End If
                End With
                If iNrW = 0 Then
                    With Worksheets(sArk).Range("d1:d10000")
                        Set vWynik = .Find("", LookIn:=xlFormulas, LookAt:=xlWhole)
                        If Not vWynik Is Nothing Then
                            iNrW = vWynik.Row
                        End If
                    End With
                    Worksheets(sArk).Cells(iNrW, 1).Value = sDzialka
                    Worksheets(sArk).Cells(iNrW, 2).Value = sUprawa
                    Worksheets(sArk).Cells(iNrW, 4).Value = sPrzypisanie
                    Worksheets(sArk).Rows(iNrW).EntireRow.Hidden = False
                    Worksheets(sArk).Rows(iNrW + 1).EntireRow.Hidden = True
                    iIl_P = iIl_P + 1
                    UF_Przypisanie.LB_Przypisania.AddItem
                    With UF_Przypisanie.LB_Przypisania
                        .List(iIl_P, 0) = sDzialka
                        .List(iIl_P, 1) = sUprawa
                    End With
                End If
            End If
        Next
    End If
Next

For iNr_Dz = 0 To iIl_Dz
    UF_Przypisanie.LB_Dzialki.Selected(iNr_Dz) = False
Next
For iNr_U = 0 To iIl_U
    UF_Przypisanie.LB_Uprawy.Selected(iNr_U) = False
Next

Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

Application.EnableEvents = True
Application.ScreenUpdating = True

UF_Przypisanie.CB_Przypisz.Enabled = False
UF_Przypisanie.CB_Przypisz.BackColor = &H8000000F

UF_Przypisanie.ChB_Dzialki.Value = False
UF_Przypisanie.ChB_Uprawy.Value = False

End Sub

Private Sub CB_Usun_Click()
Dim iNrP, iIlP, iNrW As Integer
Dim sPrzypisanie, sArk As String
Dim vWynik

sArk = "Przypisanie_upraw_do_dzialek"

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets(sArk).Unprotect Password:=sPassS

iIlP = UF_Przypisanie.LB_Przypisania.ListCount - 1
For iNrP = iIlP To 0 Step -1
    If UF_Przypisanie.LB_Przypisania.Selected(iNrP) Then
        sPrzypisanie = UF_Przypisanie.LB_Przypisania.List(iNrP, 0) & UF_Przypisanie.LB_Przypisania.List(iNrP, 1)
        iNrW = 0
        With Worksheets(sArk).Range("d2:d10000")
            Set vWynik = .Find(sPrzypisanie, LookIn:=xlFormulas, LookAt:=xlWhole)
            If Not vWynik Is Nothing Then
                iNrW = vWynik.Row
            End If
        End With
        If iNrW <> 0 Then
            Worksheets(sArk).Rows(iNrW).Delete Shift:=xlUp
        End If
        UF_Przypisanie.LB_Przypisania.RemoveItem (iNrP)
    End If
Next

Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

Application.EnableEvents = True
Application.ScreenUpdating = True

UF_Przypisanie.CB_Usun.Enabled = False
UF_Przypisanie.CB_Usun.BackColor = &H8000000F

End Sub

Private Sub ChB_Dzialki_Click()
Dim bJest_Dz As Boolean

If UF_Przypisanie.ChB_Dzialki = True Then
    If UF_Przypisanie.LB_Dzialki.ListCount > 0 Then
        For iNrDzialki = (UF_Przypisanie.LB_Dzialki.ListCount - 1) To 0 Step -1
            bJest_Dz = False
            For iNrPrzypisania = 0 To (UF_Przypisanie.LB_Przypisania.ListCount - 1)
                If UF_Przypisanie.LB_Dzialki.List(iNrDzialki) = UF_Przypisanie.LB_Przypisania.List(iNrPrzypisania, 0) Then
                    bJest_Dz = True
                    Exit For
                End If
            Next
            If bJest_Dz Then
                UF_Przypisanie.LB_Dzialki.RemoveItem (iNrDzialki)
            End If
        Next
    End If
    
    If UF_Przypisanie.ChB_Uprawy Then
        If UF_Przypisanie.LB_Uprawy.ListCount > 0 Then
'            For iNrUprawy = 1 To UF_Przypisanie.LB_Uprawy.ListCount
'                UF_Przypisanie.LB_Uprawy.RemoveItem 0
'            Next
            UF_Przypisanie.LB_Uprawy.Clear
        End If
'        For iNrUprawy = 1 To iIlUprawy
'            UF_Przypisanie.LB_Uprawy.AddItem Tab_Uprawy(iNrUprawy)
'        Next
        UF_Przypisanie.LB_Uprawy.List = Tab_Uprawy
        
        UF_Przypisanie.ChB_Uprawy = False
    End If
Else
    If UF_Przypisanie.LB_Dzialki.ListCount > 0 Then
'        For iNrDzialki = 1 To UF_Przypisanie.LB_Dzialki.ListCount
'            UF_Przypisanie.LB_Dzialki.RemoveItem 0
'        Next
        UF_Przypisanie.LB_Dzialki.Clear
    End If
'    For iNrDzialki = 1 To iIlDzialki
'        UF_Przypisanie.LB_Dzialki.AddItem Tab_Dzialki(iNrDzialki)
'    Next
    UF_Przypisanie.LB_Dzialki.List = Tab_Dzialki
End If

UF_Przypisanie.CB_Przypisz.Enabled = False
UF_Przypisanie.CB_Przypisz.BackColor = &H8000000F

End Sub

Private Sub ChB_Uprawy_Click()
Dim bJest_U As Boolean

If UF_Przypisanie.ChB_Uprawy = True Then
    If UF_Przypisanie.LB_Uprawy.ListCount > 0 Then
        For iNrUprawy = (UF_Przypisanie.LB_Uprawy.ListCount - 1) To 0 Step -1
            bJest_U = False
            For iNrPrzypisania = 0 To (UF_Przypisanie.LB_Przypisania.ListCount - 1)
                If UF_Przypisanie.LB_Uprawy.List(iNrUprawy) = UF_Przypisanie.LB_Przypisania.List(iNrPrzypisania, 1) Then
                    bJest_U = True
                    Exit For
                End If
            Next
            If bJest_U Then
                UF_Przypisanie.LB_Uprawy.RemoveItem (iNrUprawy)
            End If
        Next
    End If
    
    If UF_Przypisanie.ChB_Dzialki Then
        If UF_Przypisanie.LB_Dzialki.ListCount > 0 Then
'            For iNrDzialki = 1 To UF_Przypisanie.LB_Dzialki.ListCount
'                UF_Przypisanie.LB_Dzialki.RemoveItem 0
'            Next
            UF_Przypisanie.LB_Dzialki.Clear
        End If
'        For iNrDzialki = 1 To iIlDzialki
'            UF_Przypisanie.LB_Dzialki.AddItem Tab_Dzialki(iNrDzialki)
'        Next
        UF_Przypisanie.LB_Dzialki.List = Tab_Dzialki
        
        UF_Przypisanie.ChB_Dzialki = False
    End If
Else
    If UF_Przypisanie.LB_Uprawy.ListCount > 0 Then
'        For iNrUprawy = 1 To UF_Przypisanie.LB_Uprawy.ListCount
'            UF_Przypisanie.LB_Uprawy.RemoveItem 0
'        Next
        UF_Przypisanie.LB_Uprawy.Clear
    End If
'    For iNrUprawy = 1 To iIlUprawy
'        UF_Przypisanie.LB_Uprawy.AddItem Tab_Uprawy(iNrUprawy)
'    Next
    UF_Przypisanie.LB_Uprawy.List = Tab_Uprawy
End If

UF_Przypisanie.CB_Przypisz.Enabled = False
UF_Przypisanie.CB_Przypisz.BackColor = &H8000000F

End Sub

Private Sub L_Dzialki_P_Click()
Dim iNr_P, iIl_P As Integer
Dim Tab_Tmp() As Variant

iIl_P = UF_Przypisanie.LB_Przypisania.ListCount - 1

If iIl_P < 0 Then
    Exit Sub
End If

For iNr_P = 0 To iIl_P
    Tab_Tmp = ReDimPreserve(Tab_Tmp, iNr_P + 1, 2)
    Tab_Tmp(iNr_P + 1, 1) = UF_Przypisanie.LB_Przypisania.List(iNr_P, 0)
    Tab_Tmp(iNr_P + 1, 2) = UF_Przypisanie.LB_Przypisania.List(iNr_P, 1)
Next

Sort4mArray Tab_Tmp, 1

If UF_Przypisanie.LB_Przypisania.ListCount > 0 Then
    For iNr_P = 0 To iIl_P
        UF_Przypisanie.LB_Przypisania.RemoveItem 0
    Next
End If
For iNr_P = 1 To (iIl_P + 1)
    UF_Przypisanie.LB_Przypisania.AddItem
    With UF_Przypisanie.LB_Przypisania
        .List(iNr_P - 1, 0) = Tab_Tmp(iNr_P, 1)
        .List(iNr_P - 1, 1) = Tab_Tmp(iNr_P, 2)
    End With
Next

UF_Przypisanie.L_Dzialki_P.Caption = "Dzia|fffd|ki " & ChrW(&H2193)
UF_Przypisanie.L_Uprawy_P.Caption = "Uprawy"

End Sub

Private Sub L_Uprawy_P_Click()
Dim iNr_P, iIl_P As Integer
Dim Tab_Tmp() As Variant

iIl_P = UF_Przypisanie.LB_Przypisania.ListCount - 1

If iIl_P < 0 Then
    Exit Sub
End If

For iNr_P = 0 To iIl_P
    Tab_Tmp = ReDimPreserve(Tab_Tmp, iNr_P + 1, 2)
    Tab_Tmp(iNr_P + 1, 1) = UF_Przypisanie.LB_Przypisania.List(iNr_P, 0)
    Tab_Tmp(iNr_P + 1, 2) = UF_Przypisanie.LB_Przypisania.List(iNr_P, 1)
Next

Sort4mArray Tab_Tmp, 2

If UF_Przypisanie.LB_Przypisania.ListCount > 0 Then
    For iNr_P = 0 To iIl_P
        UF_Przypisanie.LB_Przypisania.RemoveItem 0
    Next
End If
For iNr_P = 1 To (iIl_P + 1)
    UF_Przypisanie.LB_Przypisania.AddItem
    With UF_Przypisanie.LB_Przypisania
        .List(iNr_P - 1, 0) = Tab_Tmp(iNr_P, 1)
        .List(iNr_P - 1, 1) = Tab_Tmp(iNr_P, 2)
    End With
Next

UF_Przypisanie.L_Dzialki_P.Caption = "Dzia|fffd|ki"
UF_Przypisanie.L_Uprawy_P.Caption = "Uprawy " & ChrW(&H2193)

End Sub

Private Sub LB_Dzialki_Change()
Dim iNrP, iIlP, iIl_Dz, iIl_U As Integer
Dim sArk As String

sArk = "Przypisanie_upraw_do_dzialek"

iIl_Dz = 0
iIlP = UF_Przypisanie.LB_Dzialki.ListCount - 1
For iNrP = 0 To iIlP
    If UF_Przypisanie.LB_Dzialki.Selected(iNrP) Then
        iIl_Dz = iIl_Dz + 1
    End If
Next

iIl_U = 0
iIlP = UF_Przypisanie.LB_Uprawy.ListCount - 1
For iNrP = 0 To iIlP
    If UF_Przypisanie.LB_Uprawy.Selected(iNrP) Then
        iIl_U = iIl_U + 1
    End If
Next

If (iIl_Dz = 1 And iIl_U >= 1) Or (iIl_Dz >= 1 And iIl_U = 1) Then
    UF_Przypisanie.CB_Przypisz.Enabled = True
    UF_Przypisanie.CB_Przypisz.BackColor = &HFFFF&
Else
    UF_Przypisanie.CB_Przypisz.Enabled = False
    UF_Przypisanie.CB_Przypisz.BackColor = &H8000000F
End If

End Sub

Private Sub LB_Przypisania_Change()

UF_Przypisanie.CB_Usun.Enabled = True
UF_Przypisanie.CB_Usun.BackColor = &HFFFF&

End Sub

Private Sub LB_Uprawy_Change()
Dim iNrP, iIlP, iIl_Dz, iIl_U As Integer
Dim sArk As String

sArk = "Przypisanie_upraw_do_dzialek"

iIl_Dz = 0
iIlP = UF_Przypisanie.LB_Dzialki.ListCount - 1
For iNrP = 0 To iIlP
    If UF_Przypisanie.LB_Dzialki.Selected(iNrP) Then
        iIl_Dz = iIl_Dz + 1
    End If
Next

iIl_U = 0
iIlP = UF_Przypisanie.LB_Uprawy.ListCount - 1
For iNrP = 0 To iIlP
    If UF_Przypisanie.LB_Uprawy.Selected(iNrP) Then
        iIl_U = iIl_U + 1
    End If
Next

If (iIl_Dz = 1 And iIl_U >= 1) Or (iIl_Dz >= 1 And iIl_U = 1) Then
    UF_Przypisanie.CB_Przypisz.Enabled = True
    UF_Przypisanie.CB_Przypisz.BackColor = &HFFFF&
Else
    UF_Przypisanie.CB_Przypisz.Enabled = False
    UF_Przypisanie.CB_Przypisz.BackColor = &H8000000F
End If

End Sub

Private Sub UserForm_Activate()

UF_Przypisanie.ChB_Dzialki.Value = False
UF_Przypisanie.ChB_Uprawy.Value = False

UF_Przypisanie.CB_Przypisz.Enabled = False
UF_Przypisanie.CB_Przypisz.BackColor = &H8000000F

UF_Przypisanie.CB_Usun.Enabled = False
UF_Przypisanie.CB_Usun.BackColor = &H8000000F

End Sub

Private Function ReDimPreserve(pArray, pIlW, pIlK)
Dim Array_Tmp()
Dim iNrW, iNrK, iIlW, iIlK As Integer

ReDimPreserve = False

If IsArray(pArray) Then
    ReDim Array_Tmp(pIlW, pIlK)
    If pIlW <> 1 Then
        iIlW = UBound(pArray, 1)
        iIlK = UBound(pArray, 2)
        For iNrW = LBound(pArray, 1) To pIlW
            For iNrK = LBound(pArray, 2) To pIlK
                If iIlW >= iNrW And iIlK >= iNrK Then
                    Array_Tmp(iNrW, iNrK) = pArray(iNrW, iNrK)
                End If
            Next
        Next
    End If
    If IsArray(Array_Tmp) Then
        ReDimPreserve = Array_Tmp
    End If
End If

End Function

Private Function Sort4mArray(pArray As Variant, pK As Integer)
Dim vMax, vMax_ As Variant
Dim iMaxIndex As Integer
Dim iW, iWW, iK As Integer

iK = IIf(pK = 1, 2, 1)

For iW = UBound(pArray) To 1 Step -1
    vMax = pArray(iW, pK)
    vMax_ = pArray(iW, iK)
    
    iMaxIndex = iW
    
    For iWW = 1 To iW
        If pArray(iWW, pK) > vMax Then
            vMax = pArray(iWW, pK)
            vMax_ = pArray(iWW, iK)
            iMaxIndex = iWW
        End If
    Next
    
    If iMaxIndex < iW Then
        pArray(iMaxIndex, pK) = pArray(iW, pK)
        pArray(iMaxIndex, iK) = pArray(iW, iK)
        pArray(iW, pK) = vMax
        pArray(iW, iK) = vMax_
    End If
Next

End Function
Attribute VB_Name = "UF_Rozrzut"
Attribute VB_Base = "0{FE632EC4-242A-4D52-9382-E8EEF7014C18}{2737D3DE-380B-4059-8E49-7F98F14CEDBB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1

Private Sub CB_Ok_Click()

iPkt0_p = 0
iPkt1_p = 0
iPkt2_p = 0
sInwM0_p = ""

iPkt0_p = iPkt_p
sInwM0_p = sInwM_p

If UF_Rozrzut.ChB_1.Value Then
    iPkt1_p = 2
    iPkt0_p = iPkt0_p + iPkt1_p
    sInwM0_p = sInwM0_p & " + " & UF_Rozrzut.ChB_1.Caption
End If
If UF_Rozrzut.Chb_2.Value Then
    iPkt2_p = 2
    iPkt0_p = iPkt0_p + iPkt2_p
    sInwM0_p = sInwM0_p & " + " & UF_Rozrzut.Chb_2.Caption
End If

UF_Rozrzut.Hide

End Sub

Private Sub UserForm_Activate()

If iPkt1_p <> 0 Then
    UF_Rozrzut.ChB_1.Value = True
Else
    UF_Rozrzut.ChB_1.Value = False
End If
If iPkt2_p <> 0 Then
    UF_Rozrzut.Chb_2.Value = True
Else
    UF_Rozrzut.Chb_2.Value = False
End If

End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)

Cancel = True

End Sub

Attribute VB_Name = "UF_SO"
Attribute VB_Base = "0{9BCBA8D9-61C6-4E8D-A606-9A286528AA1F}{C6858848-853F-44A8-9EC1-DE8DD3095165}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub CB_SO_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
KeyAscii = 0
End Sub

Private Sub TB_SO_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
iNacisnietaMysz = 0

UF_SO.CB_SO.Visible = True
UF_SO.TB_SO.SetFocus
UF_SO.TB_SO.Value = ""
UF_SO.CB_SO.DropDown

End Sub

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_SO.CB_SO.Visible = True
UF_SO.TB_SO.SetFocus
UF_SO.CB_SO.DropDown

UF_SO.CB_SO.ListIndex = -1

UF_SO.CB_SO.TopIndex = 0

UF_SO.TB_SO.Text = ""

End Sub

Private Sub CB_SO_Click()

If iNacisnietaMysz = 1 Then
    WyborSO
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_SO_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborSO
    Case 27
        UF_SO.CB_SO.Visible = False
        UF_SO.Hide
End Select

End Sub

Private Sub CB_SO_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborSO()
Dim sJM, sKomentarz, sOkrywa, sArk As String
Dim vWynik
Dim iNrW, iNrP As Integer

Application.EnableEvents = False

sArk = ActiveSheet.Name

With Worksheets("SO").Range("b1:b1000")
    Set vWynik = .Find(UF_SO.CB_SO.Text, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With

sKomentarz = Worksheets("SO").Cells(iNrW, 3).Value
sJM = Worksheets("SO").Cells(iNrW, 4).Value
If Worksheets("SO").Cells(iNrW, 9).Value = 1 Then
    sOkrywa = "Tak"
Else
    sOkrywa = "Nie"
End If

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
With ActiveCell
    .Value = UF_SO.CB_SO.Text
    .ClearComments
End With
If sKomentarz <> "" Then
    ActiveCell.AddComment
    With ActiveCell.Comment
        .Visible = False
        .Text Text:=sKomentarz
        .Shape.TextFrame.AutoSize = True
    End With
End If

Cells(ActiveCell.Row, ActiveCell.Column + 1).Value = sJM

'Cells(ActiveCell.Row, ActiveCell.Column + 3).Value = sOkrywa
'Cells(ActiveCell.Row, ActiveCell.Column + 7).Value = sOkrywa

Cells(ActiveCell.Row, 101).Value = iNrW

Select Case Worksheets("Info").Range("NrR")
    Case "A"
        Cells(ActiveCell.Row, 102).Value = Worksheets("SO").Cells(iNrW, 5).Value
    Case "B"
        Cells(ActiveCell.Row, 102).Value = Worksheets("SO").Cells(iNrW, 6).Value
    Case "C"
        Cells(ActiveCell.Row, 102).Value = Worksheets("SO").Cells(iNrW, 7).Value
    Case "D"
        Cells(ActiveCell.Row, 102).Value = Worksheets("SO").Cells(iNrW, 8).Value
End Select
'103 pusta na wart
For iNrP = 9 To 30
    Cells(ActiveCell.Row, 95 + iNrP).Value = Worksheets("SO").Cells(iNrW, iNrP).Value
Next
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_SO.CB_SO.Visible = False
UF_SO.Hide

Application.EnableEvents = True

End Sub

Private Sub TB_SO_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 9, 38, 40
        KeyCode = 0
    Case 27
        UF_SO.CB_SO.SetFocus
        UF_SO.CB_SO.Visible = False
        UF_SO.Hide
End Select

End Sub

Private Sub TB_SO_Change()
Dim iNrP As Integer
Dim sTB_SO As String
Dim sArk As String

Application.EnableEvents = False

sTB_SO = LCase(LTrim(RTrim(UF_SO.TB_SO.Text)))

sArk = ActiveCell.Worksheet.Name

For iNrP = 1 To UF_SO.CB_SO.ListCount
    UF_SO.CB_SO.RemoveItem 0
Next

If sTB_SO <> "" Then
    For iNrP = 2 To 1000
        If Worksheets("SO").Cells(iNrP, 1).Value = "" Then
            Exit For
        End If
        If sArk = "Uprawy" Then
            If InStr(LCase(Worksheets("SO").Cells(iNrP, 2).Value), sTB_SO) > 0 And _
            Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" Then
                UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
            End If
        Else
            If InStr(LCase(Worksheets("SO").Cells(iNrP, 2).Value), sTB_SO) > 0 And _
            Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" And _
            Worksheets("SO").Cells(iNrP, 25).Value = 1 Then
                UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
            End If
        End If
    Next
Else
    For iNrP = 2 To 1000
        If Worksheets("SO").Cells(iNrP, 1).Value = "" Then
            Exit For
        End If
        If sArk = "Uprawy" Then
            If Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" Then
                UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
            End If
        Else
            If Left(Worksheets("SO").Cells(iNrP, 1).Value, 1) = "2" And _
            Worksheets("SO").Cells(iNrP, 25).Value = 1 Then
                UF_SO.CB_SO.AddItem Worksheets("SO").Cells(iNrP, 2).Value
            End If
        End If
    Next
End If

UF_SO.CB_SO.SetFocus

UF_SO.TB_SO.SetFocus

UF_SO.CB_SO.DropDown

Application.EnableEvents = True

End Sub

Attribute VB_Name = "UF_TN"
Attribute VB_Base = "0{43AE49AB-CBB8-4288-88B7-BAF78E85121F}{26B1F14F-555A-482A-82F9-D81E475405D1}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_TN.CB_TN.Visible = True
UF_TN.CB_TN.SetFocus
UF_TN.CB_TN.Value = ""
UF_TN.CB_TN.DropDown

End Sub

Private Sub CB_TN_Click()

If iNacisnietaMysz = 1 Then
    WyborTN
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_TN_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborTN
    'Case 27
    '    UF_TN.CB_TN.Visible = False
    '    UF_TN.Hide
End Select

End Sub

Private Sub CB_TN_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborTN()
Dim sArk, sAdres As String
Dim iNrW, iNrK As Integer

sArk = ActiveSheet.Name
iNrW = ActiveCell.Row
iNrK = ActiveCell.Column

sAdres = Chr(iNrK + 96) & iNrW

Application.EnableEvents = False

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
ActiveCell.Value = UF_TN.CB_TN.Text

Wal.SetKolor sArk, sAdres, xlNone, "-"

If sArk = "Cele" Then
    If UF_TN.CB_TN.Text = "Tak" Then
        ActiveSheet.Rows(ActiveCell.Row + 1).EntireRow.Hidden = False
        ActiveSheet.Cells(ActiveCell.Row + 1, 12).Value = False
    Else
        ActiveSheet.Rows(ActiveCell.Row + 1).EntireRow.Hidden = True
        ActiveSheet.Cells(ActiveCell.Row + 1, 12).Value = True
    End If
End If
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_TN.CB_TN.Visible = False
UF_TN.Hide

Application.EnableEvents = True

End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)

Cancel = True

End Sub
Attribute VB_Name = "UF_TP"
Attribute VB_Base = "0{3649EE23-4624-47E7-8BEF-EFFE43CAD0A1}{0EB48EFA-3C20-4133-94AB-74678CBEB479}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_TP.CB_TP.Visible = True
UF_TP.CB_TP.SetFocus
UF_TP.CB_TP.Value = ""
UF_TP.CB_TP.DropDown

End Sub

Private Sub CB_TP_Click()

If iNacisnietaMysz = 1 Then
    WyborTP
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_TP_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborTP
    Case 27
        UF_TP.CB_TP.Visible = False
        UF_TP.Hide
End Select

End Sub

Private Sub CB_TP_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborTP()
Dim sArk, sNrTP As String
Dim vWynik
Dim iNrW, iNrK As Integer

Application.EnableEvents = False

With Worksheets("Tytul_prawny").Range("b1:d10000")
    Set vWynik = .Find(UF_TP.CB_TP.Text, LookIn:=xlFormulas, LookAt:=xlWhole)
    If Not vWynik Is Nothing Then
        iNrW = vWynik.Row
    End If
End With
sNrTP = Worksheets("Tytul_prawny").Cells(iNrW, 1).Value

sArk = ActiveSheet.Name
iNrW = ActiveCell.Row
iNrK = ActiveCell.Column

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
ActiveCell.Value = UF_TP.CB_TP.Text

Select Case sArk
    Case "Dzialki"
        Cells(iNrW, 128).Value = sNrTP
        If iNrK = 13 Then
            If ActiveCell.Value = "BRAK" Then
                With Cells(iNrW, iNrK + 1)
                    With .Borders(xlDiagonalDown)
                        .LineStyle = xlContinuous
                        .ColorIndex = xlAutomatic
                        .Weight = xlHairline
                    End With
                    With .Borders(xlDiagonalUp)
                        .LineStyle = xlContinuous
                        .ColorIndex = xlAutomatic
                        .Weight = xlHairline
                    End With
                    .Interior.ColorIndex = 15
                    .Locked = True
                    .ClearContents
'                    .Value = ""
                End With
            Else
                With Cells(iNrW, iNrK + 1)
                    .Borders(xlDiagonalDown).LineStyle = xlNone
                    .Borders(xlDiagonalUp).LineStyle = xlNone
                    .Locked = False
                    .Interior.ColorIndex = 3
                End With
            End If
        End If
    Case "Uprawy"
        If iNrK = 4 Then
            Cells(iNrW, 128).Value = sNrTP
        Else
            Cells(iNrW, 129).Value = sNrTP
        End If
End Select
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_TP.CB_TP.Visible = False
UF_TP.Hide

Application.EnableEvents = True

End Sub


Attribute VB_Name = "UF_Woj"
Attribute VB_Base = "0{7403A376-6C27-41C9-BA8A-27CB98A8C7C6}{C4110F0F-E951-460C-B858-64C39DE87BB1}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Option Base 1
Private iNacisnietaMysz As Integer

Private Sub UserForm_Activate()

iNacisnietaMysz = 0

UF_Woj.CB_Woj.Visible = True
UF_Woj.CB_Woj.SetFocus
UF_Woj.CB_Woj.Value = ""
UF_Woj.CB_Woj.DropDown

End Sub

Private Sub CB_Woj_Click()

If iNacisnietaMysz = 1 Then
    WyborWoj
    iNacisnietaMysz = 0
End If

End Sub

Private Sub CB_Woj_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)

Select Case KeyCode
    Case 13
        WyborWoj
    Case 27
        UF_Woj.CB_Woj.Visible = False
        UF_Woj.Hide
End Select

End Sub

Private Sub CB_Woj_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

iNacisnietaMysz = Button

End Sub

Private Sub WyborWoj()
Dim sArk As String
Dim iNrW, iNrK As Integer

Application.EnableEvents = False

sNrW = Worksheets("Woj").Cells(UF_Woj.CB_Woj.ListIndex + 2, 1).Value

sArk = ActiveSheet.Name

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

Worksheets(sArk).Unprotect Password:=sPassS
Select Case sArk
    Case "Dzialki"
        ActiveCell.Value = UF_Woj.CB_Woj.Text
        
        Cells(ActiveCell.Row, 101).Value = sNrW
        Cells(ActiveCell.Row, ActiveCell.Column + 1).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 2).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 3).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 4).Value = ""
        Cells(ActiveCell.Row, ActiveCell.Column + 5).Value = ""
        Cells(ActiveCell.Row, 102).Value = ""
        Cells(ActiveCell.Row, 103).Value = ""
        Cells(ActiveCell.Row, 104).Value = ""
        Cells(ActiveCell.Row, 105).Value = ""
End Select
Worksheets(sArk).Protect Password:=sPassS

Application.Run "WB_SheetChange.WB_SheetChange"

UF_Woj.CB_Woj.Visible = False
UF_Woj.Hide

Application.EnableEvents = True

End Sub

Attribute VB_Name = "UF_Zapisany"
Attribute VB_Base = "0{E68ADFF2-419C-4E2E-9D4D-7159426350CC}{D5E2CD82-22D3-4AEE-90F7-3B824D0A16C5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CB_Ok_Click()

UF_Zapisany.Hide

End Sub
Attribute VB_Name = "WB_SheetChange"
Option Explicit
Option Base 1

Private Sub WB_SheetChange()
Dim bScreenUpdating, bEnableEvents As Boolean

If IsEmpty(sPassS) Then
    Application.Run "Auto.Ini4Pub"
End If

bScreenUpdating = Application.ScreenUpdating
bEnableEvents = Application.EnableEvents
Application.ScreenUpdating = False
Application.EnableEvents = False
Worksheets("Zestawienie").Unprotect Password:=sPassS

Worksheets("Zestawienie").Range("Modyfikacja").Value = Now

Worksheets("Zestawienie").Protect Password:=sPassS

Application.EnableEvents = bEnableEvents
Application.ScreenUpdating = bScreenUpdating

End Sub
Attribute VB_Name = "Wal"
Option Explicit
Option Base 1

Sub Wal(pArkuszZ, pAdresZ, pArkuszDo, pAdresDo, pKom)

Worksheets(pArkuszZ).Range(pAdresZ).ClearComments
Worksheets(pArkuszDo).Range(pAdresDo).ClearComments

If Worksheets(pArkuszZ).Range(pAdresZ).Value <> "" Then
    SetKolor pArkuszZ, pAdresZ, xlNone
    If Worksheets(pArkuszDo).Range(pAdresDo).Value <> "" Then
        SetKolor pArkuszDo, pAdresDo, xlNone
    Else
        SetKolor pArkuszDo, pAdresDo, 3
        If pKom <> "-" Then
            Worksheets(pArkuszDo).Range(pAdresDo).AddComment
            With Worksheets(pArkuszDo).Range(pAdresDo).Comment
                .Visible = False
                .Text Text:=pKom
                .Shape.TextFrame.AutoSize = True
            End With
        End If
    End If
Else
    SetKolor pArkuszZ, pAdresZ, 3
    If pKom <> "-" Then
        Worksheets(pArkuszZ).Range(pAdresZ).AddComment
        With Worksheets(pArkuszZ).Range(pAdresZ).Comment
            .Visible = False
            .Text Text:=pKom
            .Shape.TextFrame.AutoSize = True
        End With
    End If
End If

End Sub

Sub Wal_0(pArkuszZ, pAdresZ, pArkuszDo, pAdresDo)
Dim sKom As String

Worksheets(pArkuszDo).Range(pAdresDo).ClearComments

If Worksheets(pArkuszZ).Range(pAdresZ).Value <> 0 Then
    If Worksheets(pArkuszDo).Range(pAdresDo).Value <> "" Then
        SetKolor pArkuszDo, pAdresDo, xlNone
    Else
        sKom = "Brak danych"
        SetKolor pArkuszDo, pAdresDo, 3
        Worksheets(pArkuszDo).Range(pAdresDo).AddComment
        With Worksheets(pArkuszDo).Range(pAdresDo).Comment
            .Visible = False
            .Text Text:=sKom
            .Shape.TextFrame.AutoSize = True
        End With
    End If
Else
    If Worksheets(pArkuszDo).Range(pAdresDo).Value <> 0 Then
        sKom = "Dane nieprawid|fffd|owe"
        SetKolor pArkuszDo, pAdresDo, 3
        Worksheets(pArkuszDo).Range(pAdresDo).AddComment
        With Worksheets(pArkuszDo).Range(pAdresDo).Comment
            .Visible = False
            .Text Text:=sKom
            .Shape.TextFrame.AutoSize = True
        End With
    Else
        SetKolor pArkuszDo, pAdresDo, xlNone
    End If
End If

End Sub

Sub Wal_TN(pArkuszZ, pAdresZ, pKom)

Worksheets(pArkuszZ).Range(pAdresZ).ClearComments

If Worksheets(pArkuszZ).Range(pAdresZ).Value <> "" Then
    SetKolor pArkuszZ, pAdresZ, xlNone
Else
    SetKolor pArkuszZ, pAdresZ, 3
    If pKom <> "-" Then
        Worksheets(pArkuszZ).Range(pAdresZ).AddComment
        With Worksheets(pArkuszZ).Range(pAdresZ).Comment
            .Visible = False
            .Text Text:=pKom
            .Shape.TextFrame.AutoSize = True
        End With
    End If
End If

End Sub

Sub Wal_T(pArkuszZ, pAdresZ, pArkuszDo, pAdresDo, pKom)

Worksheets(pArkuszZ).Range(pAdresZ).ClearComments
Worksheets(pArkuszDo).Range(pAdresDo).ClearComments

If Worksheets(pArkuszZ).Range(pAdresZ).Value = "Tak" Then
    SetKolor pArkuszZ, pAdresZ, xlNone
    If Worksheets(pArkuszDo).Range(pAdresDo).Value <> "" Then
        SetKolor pArkuszDo, pAdresDo, xlNone
    Else
        SetKolor pArkuszDo, pAdresDo, 3
        If pKom <> "-" Then
            Worksheets(pArkuszDo).Range(pAdresDo).AddComment
            With Worksheets(pArkuszDo).Range(pAdresDo).Comment
                .Visible = False
                .Text Text:=pKom
                .Shape.TextFrame.AutoSize = True
            End With
        End If
    End If
Else
    SetKolor pArkuszDo, pAdresDo, xlNone
End If

End Sub

Sub SetKolor(pArkusz, pAdres, pKolor, Optional pKom)

With Worksheets(pArkusz).Range(pAdres).Interior
    .ColorIndex = pKolor
    .Pattern = xlSolid
End With

Worksheets(pArkusz).Range(pAdres).ClearComments

If Not IsMissing(pKom) Then
    If pKom <> "-" Then
        Worksheets(pArkusz).Range(pAdres).AddComment
        With Worksheets(pArkusz).Range(pAdres).Comment
            .Visible = False
            .Text Text:=pKom
            .Shape.TextFrame.AutoSize = True = True
        End With
    End If
End If

End Sub


INQUEST-PP=macro
