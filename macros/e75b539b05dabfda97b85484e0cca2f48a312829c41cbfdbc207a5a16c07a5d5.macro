Attribute VB_Name = "DatiSquadre"
Sub DATI_SQUADRE()

Dim url1 As String
Dim Text1 As String
Dim http1 As Object
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim sSquadra1 As String
Dim Posiz1 As Long, Posiz2 As Long, Posiz3 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Sheets("DATI").Select

Range("J3:L1000").ClearContents
Range("AQ3:AS1000").ClearContents
Range("dz3:eb1000").ClearContents
'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"
      
f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=7100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText

 nRigaInizio = i
 nColonnaInizio = 0
    
    sStanding = "nowrap title=Standing>"
    
    sSquadra1 = Range("F" & i).Value
    sSquadra2 = Range("G" & i).Value
    
    sControllo1 = "popup.asp?lang=en&tp=9011&idt="
    sLen1 = Len(sControllo1)
    
    sControllo2 = "&tqt="
       
    sControllo3 = "_txt>"
    sLen3 = Len(sControllo3)
    
    sControllo4 = "</a>"
    
      
   '<td align="center" bgcolor="#ececf2" style="padding: 2px 2px"><span class="tbl_black_txt">
   
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   'Text1 = Replace(Text1, "</a> </span></td>", "</a></span></td>")
   
       
    If InStr(1, Text1, sStanding) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 10).Value = "-"
        Cells(i, nColonnaInizio + 11).Value = "-"
        Cells(i, nColonnaInizio + 12).Value = "-"
        Cells(i, nColonnaInizio + 43).Value = "-"
        Cells(i, nColonnaInizio + 44).Value = "-"
        Cells(i, nColonnaInizio + 45).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

On Error Resume Next
        
        'calcola dati squadra home
        Posiz1 = InStr(1, Text1, sSquadra1) + 5
        Posiz2 = InStr(Posiz1, Text1, sSquadra1)
        Posiz3 = InStr(Posiz2, Text1, sControllo1) + sLen1
        Posiz4 = InStr(Posiz3, Text1, sControllo2)
        
        Posiz5 = InStr(Posiz4, Text1, sControllo3) + sLen3
        Posiz6 = InStr(Posiz5, Text1, sControllo4)
        
        Posiz7 = InStr(Posiz2 - 125, Text1, sControllo3) + sLen3
        Posiz8 = InStr(Posiz6, Text1, sControllo3) + sLen3 'punti
        Posiz9 = InStr(Posiz8, Text1, sControllo3) + sLen3 'vinte
        Posiz10 = InStr(Posiz9, Text1, sControllo3) + sLen3 'pareggiate
        Posiz11 = InStr(Posiz10, Text1, sControllo3) + sLen3 'perse
        Posiz12 = InStr(Posiz11, Text1, sControllo3) + sLen3 'Under
        Posiz13 = InStr(Posiz12, Text1, sControllo3) + sLen3 'Over
        Posiz14 = InStr(Posiz13, Text1, sControllo3) + sLen3 'gol fatti
        Posiz15 = InStr(Posiz14, Text1, sControllo3) + sLen3 'gol subiti
        Posiz16 = InStr(Posiz15, Text1, sControllo3) + sLen3 'differenza
        Posiz17 = InStr(Posiz16, Text1, sControllo3) + sLen3 'vuota
        Posiz18 = InStr(Posiz17, Text1, sControllo3) + sLen3 'giocate in casa da sq Home
        Posiz19 = InStr(Posiz18, Text1, sControllo3) + sLen3 'Punti fatti in casa
        Posiz20 = InStr(Posiz19, Text1, sControllo3) + sLen3 'vinte in casa
        Posiz21 = InStr(Posiz20, Text1, sControllo3) + sLen3 'pareggiate in casa
        Posiz22 = InStr(Posiz21, Text1, sControllo3) + sLen3 'perse in casa
        Posiz23 = InStr(Posiz22, Text1, sControllo3) + sLen3 'Under casa
        Posiz24 = InStr(Posiz23, Text1, sControllo3) + sLen3 'Over casa
        Posiz25 = InStr(Posiz24, Text1, sControllo3) + sLen3 'gol fatti casa
        Posiz26 = InStr(Posiz25, Text1, sControllo3) + sLen3 'gol subiti casa
        Posiz27 = InStr(Posiz26, Text1, sControllo3) + sLen3 'differnza reti in casa
        Posiz28 = InStr(Posiz27, Text1, sControllo3) + sLen3 'vuoto
        Posiz29 = InStr(Posiz28, Text1, sControllo3) + sLen3 'partite giocate fuori
        Posiz30 = InStr(Posiz29, Text1, sControllo3) + sLen3 'Punti fatti fuori casa
        Posiz31 = InStr(Posiz30, Text1, sControllo3) + sLen3 'vinte fuori casa
        Posiz32 = InStr(Posiz31, Text1, sControllo3) + sLen3 'perse fuori casa
        Posiz33 = InStr(Posiz32, Text1, sControllo3) + sLen3 'Under fuori casa
        Posiz34 = InStr(Posiz33, Text1, sControllo3) + sLen3 'Over fuori casa
        Posiz35 = InStr(Posiz34, Text1, sControllo3) + sLen3 'Gol fatti fuori casa
        Posiz36 = InStr(Posiz35, Text1, sControllo3) + sLen3 'Gol subiti fuori casa
        Posiz37 = InStr(Posiz36, Text1, sControllo3) + sLen3 'partite giocate fuori
        
        'calcola dati squadra away
        Posiz1a = InStr(1, Text1, sSquadra2) + 5
        Posiz2a = InStr(Posiz1a, Text1, sSquadra2)
        Posiz3a = InStr(Posiz2a, Text1, sControllo1) + sLen1
        Posiz4a = InStr(Posiz3a, Text1, sControllo2)
        
        Posiz5a = InStr(Posiz4a, Text1, sControllo3) + sLen3
        Posiz6a = InStr(Posiz5a, Text1, sControllo4)
        
        Posiz7a = InStr(Posiz2a - 125, Text1, sControllo3) + sLen3
        Posiz8a = InStr(Posiz6a, Text1, sControllo3) + sLen3 'punti
        Posiz9a = InStr(Posiz8a, Text1, sControllo3) + sLen3 'vinte
        Posiz10a = InStr(Posiz9a, Text1, sControllo3) + sLen3 'pareggiate
        Posiz11a = InStr(Posiz10a, Text1, sControllo3) + sLen3 'perse
        Posiz12a = InStr(Posiz11a, Text1, sControllo3) + sLen3 'Under
        Posiz13a = InStr(Posiz12a, Text1, sControllo3) + sLen3 'Over
        Posiz14a = InStr(Posiz13a, Text1, sControllo3) + sLen3 'gol fatti
        Posiz15a = InStr(Posiz14a, Text1, sControllo3) + sLen3 'gol subiti
        Posiz16a = InStr(Posiz15a, Text1, sControllo3) + sLen3 'differenza
        Posiz17a = InStr(Posiz16a, Text1, sControllo3) + sLen3 'vuota
        Posiz18a = InStr(Posiz17a, Text1, sControllo3) + sLen3 'giocate in casa da sq Away
        Posiz19a = InStr(Posiz18a, Text1, sControllo3) + sLen3 'Punti fatti in casa a
        Posiz20a = InStr(Posiz19a, Text1, sControllo3) + sLen3 'vinte in casa a
        Posiz21a = InStr(Posiz20a, Text1, sControllo3) + sLen3 'pareggiate in casa a
        Posiz22a = InStr(Posiz21a, Text1, sControllo3) + sLen3 'perse in casa a
        Posiz23a = InStr(Posiz22a, Text1, sControllo3) + sLen3 'Under casa a
        Posiz24a = InStr(Posiz23a, Text1, sControllo3) + sLen3 'Over casa a
        Posiz25a = InStr(Posiz24a, Text1, sControllo3) + sLen3 'gol fatti casa a
        Posiz26a = InStr(Posiz25a, Text1, sControllo3) + sLen3 'gol subiti casa a
        Posiz27a = InStr(Posiz26a, Text1, sControllo3) + sLen3 'differnza reti in casa a
        Posiz28a = InStr(Posiz27a, Text1, sControllo3) + sLen3 'vuoto
        Posiz29a = InStr(Posiz28a, Text1, sControllo3) + sLen3 'partite giocate fuori a
        Posiz30a = InStr(Posiz29a, Text1, sControllo3) + sLen3 'Punti fatti fuori casa a
        Posiz31a = InStr(Posiz30a, Text1, sControllo3) + sLen3 'vinte fuori casa a
        Posiz32a = InStr(Posiz31a, Text1, sControllo3) + sLen3 'perse fuori casa a
        Posiz33a = InStr(Posiz32a, Text1, sControllo3) + sLen3 'Under fuori casa a
        Posiz34a = InStr(Posiz33a, Text1, sControllo3) + sLen3 'Over fuori casa a
        Posiz35a = InStr(Posiz34a, Text1, sControllo3) + sLen3 'Gol fatti fuori casa a
        Posiz36a = InStr(Posiz35a, Text1, sControllo3) + sLen3 'Gol subiti fuori casa a
        Posiz37a = InStr(Posiz36a, Text1, sControllo3) + sLen3 'partite giocate fuori a
        
        sIDH = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3)) * 1
        sGiocateH = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5)) * 1
        sPosizioneH = Trim(Mid(Text1, Posiz7, 2)) * 1
        spuntiH = Trim(Mid(Text1, Posiz8, 2)) * 1
        SvinteH = Trim(Mid(Text1, Posiz9, 2)) * 1
        SpareggiateH = Trim(Mid(Text1, Posiz10, 2)) * 1
        SperseH = Trim(Mid(Text1, Posiz11, 2)) * 1
        SUnderH = Trim(Mid(Text1, Posiz12, 2)) * 1
        SOverH = Trim(Mid(Text1, Posiz13, 2)) * 1
        SgolfH = Trim(Mid(Text1, Posiz14, 2)) * 1
        SgolSH = Trim(Mid(Text1, Posiz15, 2)) * 1
        SvinteHH = Trim(Mid(Text1, Posiz20, 2)) * 1
        SpareggiateHH = Trim(Mid(Text1, Posiz21, 2)) * 1
        SperseHH = Trim(Mid(Text1, Posiz22, 2)) * 1
        SUnderHH = Trim(Mid(Text1, Posiz23, 2)) * 1
        SOverHH = Trim(Mid(Text1, Posiz24, 2)) * 1
        SgolfHH = Trim(Mid(Text1, Posiz25, 2)) * 1
        SgolsHH = Trim(Mid(Text1, Posiz26, 2)) * 1
        SvinteHf = Trim(Mid(Text1, Posiz31, 2)) * 1
        SpareggiatefH = Trim(Mid(Text1, Posiz32, 2)) * 1
        SpersefH = Trim(Mid(Text1, Posiz33, 2)) * 1
        SUnderfH = Trim(Mid(Text1, Posiz34, 2)) * 1
        SOverfH = Trim(Mid(Text1, Posiz35, 2)) * 1
        SgolfattifH = Trim(Mid(Text1, Posiz36, 2)) * 1
        SgolsubitifH = Trim(Mid(Text1, Posiz37, 2)) * 1
        'squadra Away
        
        sIDA = Trim(Mid(Text1, Posiz3a, Posiz4a - Posiz3a)) * 1
        sGiocateA = Trim(Mid(Text1, Posiz5a, Posiz6a - Posiz5a)) * 1
        sPosizioneA = Trim(Mid(Text1, Posiz7a, 2)) * 1
         spuntiA = Trim(Mid(Text1, Posiz8a, 2)) * 1
        SvinteA = Trim(Mid(Text1, Posiz9a, 2)) * 1
        SpareggiateA = Trim(Mid(Text1, Posiz10a, 2)) * 1
        SperseA = Trim(Mid(Text1, Posiz11a, 2)) * 1
        SUnderA = Trim(Mid(Text1, Posiz12a, 2)) * 1
        SOverA = Trim(Mid(Text1, Posiz13a, 2)) * 1
        SgolfA = Trim(Mid(Text1, Posiz14a, 2)) * 1
        SgolSA = Trim(Mid(Text1, Posiz15a, 2)) * 1
        SvinteHA = Trim(Mid(Text1, Posiz20a, 2)) * 1
        SpareggiateHA = Trim(Mid(Text1, Posiz21a, 2)) * 1
        SperseHA = Trim(Mid(Text1, Posiz22a, 2)) * 1
        SUnderHA = Trim(Mid(Text1, Posiz23a, 2)) * 1
        SOverHA = Trim(Mid(Text1, Posiz24a, 2)) * 1
        SgolfHA = Trim(Mid(Text1, Posiz25a, 2)) * 1
        SgolsHA = Trim(Mid(Text1, Posiz26a, 2)) * 1
        SvinteAf = Trim(Mid(Text1, Posiz31a, 2)) * 1
        SpareggiatefA = Trim(Mid(Text1, Posiz32a, 2)) * 1
        SpersefA = Trim(Mid(Text1, Posiz33a, 2)) * 1
        SUnderfA = Trim(Mid(Text1, Posiz34a, 2)) * 1
        SOverfA = Trim(Mid(Text1, Posiz35a, 2)) * 1
        SgolfattifA = Trim(Mid(Text1, Posiz36a, 2)) * 1
        SgolsubitifA = Trim(Mid(Text1, Posiz37a, 2)) * 1
        
' ------------------------------------------------

'Salta:

Cells(i, nColonnaInizio + 10).Value = sPosizioneH
Cells(i, nColonnaInizio + 11).Value = sIDH
Cells(i, nColonnaInizio + 12).Value = sGiocateH
Cells(i, nColonnaInizio + 20).Value = spuntiH
Cells(i, nColonnaInizio + 21).Value = SvinteH
Cells(i, nColonnaInizio + 22).Value = SpareggiateH
Cells(i, nColonnaInizio + 23).Value = SperseH
Cells(i, nColonnaInizio + 24).Value = SUnderH
Cells(i, nColonnaInizio + 25).Value = SOverH
Cells(i, nColonnaInizio + 26).Value = SgolfH
Cells(i, nColonnaInizio + 27).Value = SgolSH
Cells(i, nColonnaInizio + 28).Value = SvinteHH
Cells(i, nColonnaInizio + 29).Value = SpareggiateHH
Cells(i, nColonnaInizio + 30).Value = SperseHH
Cells(i, nColonnaInizio + 31).Value = SUnderHH
Cells(i, nColonnaInizio + 32).Value = SOverHH
Cells(i, nColonnaInizio + 33).Value = SgolfHH
Cells(i, nColonnaInizio + 34).Value = SgolsHH
Cells(i, nColonnaInizio + 35).Value = SvinteHf
Cells(i, nColonnaInizio + 36).Value = SpareggiatefH
Cells(i, nColonnaInizio + 37).Value = SpersefH
Cells(i, nColonnaInizio + 38).Value = SUnderfH
Cells(i, nColonnaInizio + 39).Value = SOverfH
Cells(i, nColonnaInizio + 40).Value = SgolfattifH
Cells(i, nColonnaInizio + 41).Value = SgolsubitifH

'squadra a
Cells(i, nColonnaInizio + 43).Value = sPosizioneA
Cells(i, nColonnaInizio + 44).Value = sIDA
Cells(i, nColonnaInizio + 45).Value = sGiocateA
Cells(i, nColonnaInizio + 53).Value = spuntiA
Cells(i, nColonnaInizio + 54).Value = SvinteA
Cells(i, nColonnaInizio + 55).Value = SpareggiateA
Cells(i, nColonnaInizio + 56).Value = SperseA
Cells(i, nColonnaInizio + 57).Value = SUnderA
Cells(i, nColonnaInizio + 58).Value = SOverA
Cells(i, nColonnaInizio + 59).Value = SgolfA
Cells(i, nColonnaInizio + 60).Value = SgolSA
Cells(i, nColonnaInizio + 61).Value = SvinteHA
Cells(i, nColonnaInizio + 62).Value = SpareggiateHA
Cells(i, nColonnaInizio + 63).Value = SperseHA
Cells(i, nColonnaInizio + 64).Value = SUnderHA
Cells(i, nColonnaInizio + 65).Value = SOverHA
Cells(i, nColonnaInizio + 66).Value = SgolfHA
Cells(i, nColonnaInizio + 67).Value = SgolsHA
Cells(i, nColonnaInizio + 68).Value = SvinteAf
Cells(i, nColonnaInizio + 69).Value = SpareggiatefA
Cells(i, nColonnaInizio + 70).Value = SpersefA
Cells(i, nColonnaInizio + 71).Value = SUnderfA
Cells(i, nColonnaInizio + 72).Value = SOverfA
Cells(i, nColonnaInizio + 73).Value = SgolfattifA
Cells(i, nColonnaInizio + 74).Value = SgolsubitifA
Salta:

Next i

    Application.CutCopyMode = False
    
    Range("A1").Select
    
 
 
'Call DATI_SQUADRA2


Application.ScreenUpdating = False
   
Sheets("DATI").Select

Range("A1").Select


End Sub

Attribute VB_Name = "Foglio1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
'Private Sub Worksheet_Change(ByVal Target As Range)
'Application.EnableEvents = False
'If Target.Address = "$F$1" Then DATI_classifica
'Application.EnableEvents = True
'End Sub

Attribute VB_Name = "Foglio3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Forma_team1_U6_H_A"
Sub FORMA_TEAM_1()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Call DATI_SQUADRE

'Sheets("INDEX").Select

Range("l3:S1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

f = Foglio2.Range("K65536").End(xlUp).Row

For i = 3 To f

If Range("K" & i).Value = "-" Then
        Cells(i, 13).Value = "-"
        Cells(i, 14).Value = "-"
        Cells(i, 15).Value = "-"
        Cells(i, 16).Value = "-"
        Cells(i, 17).Value = "-"
        Cells(i, 18).Value = "-"
        Cells(i, 19).Value = "-"
GoTo Salta
End If

If Range("L" & i).Value >= Range("E1").Value Then
sNumeroGareHome = Range("E1").Value
Else
sNumeroGareHome = Range("E1").Value
'sNumeroGareHome = Range("L" & i).Value
End If

url1 = "http://www.betonews.com/popup.asp?lang=en&tp=9011&idt=" & Range("K" & i) & "&tqw=1&tqc=-1&tqy=0&tqt=" & sNumeroGareHome & ""

' link he comprende tutto
'url1 = "http://www.betonews.com/popup.asp?lang=en&tp=9011&idt=" & Range("K" & i) & "&tqw=1&tqc=0&tqy=0&tqt=" & Range("E1") & ""

'On Error GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText

    sControllo0 = "nowrap style=padding: 2px 5px><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
   
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>99-99 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 0
        
    Posiz1 = 1
    
sGf = 0
sGs = 0
sPuntiHOME = 0
sGG = 0
sNG = 0
sOV = 0
sUN = 0
SHvinte = 0
sAvinte = 0
sHPareggiate = 0
sAPareggiate = 0
sHperse = 0
sgHfatti = 0
sgHsubiti = 0
segnatocasa = 0
subitocasa = 0
Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Do
        End If
        
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
        
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
                

'sDate_Time = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sCompetiz = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'sAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))
sRisultato = Trim(Mid(Text1, Posiz9, Posiz10 - Posiz9))

'Dim sRisultato As String
'Dim sGf As Single
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    sPrimo = Trim(divide(0))
    sSecondo = Trim(divide(1))

If sPrimo = "99" And sSecondo = "99" Then

' ============================================

If Range("L" & i).Value >= Range("E1").Value Then
sNumeroGareHome = Range("E1").Value + 1
Else
sNumeroGareHome = Range("L" & i).Value + 1
End If

url2 = "http://www.betonews.com/popup.asp?lang=en&tp=9011&idt=" & Range("K" & i) & "&tqw=1&tqc=-1&tqy=0&tqt=" & sNumeroGareHome & ""

On Error Resume Next

Set http2 = CreateObject("MSXML2.XMLHTTP")
http2.Open "POST", url2, False
http2.send
Text2 = http2.responseText

  
' verifico che la stinga contenga i dati richiesti
    
   Text2 = Replace(Text2, Chr(34), "")
   Text2 = Replace(Text2, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
       
    Posiz1a = 1
    
sGf1 = 0
sGs1 = 0
sPuntiHOME1 = -1
sGG1 = 0
sNG1 = 0
sOV1 = 0
sUN1 = -1
SHvinte = 0
sAvinte = 0
sgHfatti = 0
sgHsubiti = 0
segnatocasa = 0
subitocasa = 0
Do

'-------------------------------------------------------------

     Posiz1a = InStr(Posiz1a, Text2, sControllo0)
     
        If Posiz1a = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Do
        End If
        
        Posiz1a = InStr(Posiz1a, Text2, sControllo0) + sLen0
        Posiz2a = InStr(Posiz1a, Text2, sControllo1)
        
        Posiz3a = InStr(Posiz2a, Text2, sControllo0) + sLen0
        Posiz4a = InStr(Posiz3a, Text2, sControllo1)
        
        Posiz5a = InStr(Posiz4a, Text2, sControllo0) + sLen0
        Posiz6a = InStr(Posiz5a, Text2, sControllo1)
        
        Posiz7a = InStr(Posiz6a, Text2, sControllo0) + sLen0
        Posiz8a = InStr(Posiz7a, Text2, sControllo1)
        
        Posiz9a = InStr(Posiz8a, Text2, sControllo0) + sLen0
        Posiz10a = InStr(Posiz9a, Text2, sControllo1)
                

'sDate_Time = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sCompetiz = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sHome1 = Trim(Mid(Text2, Posiz5a, Posiz6a - Posiz5a))
'sAway1 = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))
sRisultato1 = Trim(Mid(Text2, Posiz9a, Posiz10a - Posiz9a))

'Dim sRisultato As String
'Dim sGf As Single
Dim sPrimo1 As Single
Dim sSecondo1 As Single


    divide1 = Split(sRisultato1, "-")
    
    sPrimo1 = Trim(divide1(0))
    sSecondo1 = Trim(divide1(1))


'On Error Resume Next

If sHome1 = Range("F" & i).Value Then
sGf1 = sGf1 + sPrimo1
If sPrimo1 > 0 Then
segnatocasa = segnatocasa + 1
If sSecondo1 = 0 Then
subitocasa = subitocasa + 1
End If
End If
Else
sGf1 = sGf1 + sSecondo1
If sSecondo1 > 0 Then
segnatocasa = segnatocasa + 1
If sPrimo1 > 0 Then
subitocasa = subitocasa + 1

End If
End If
End If


If sHome1 <> Range("F" & i).Value Then
sGs1 = sGs1 + sPrimo1
Else
sGs1 = sGs1 + sSecondo1
End If

' ===============================================

 If sPrimo1 = sSecondo1 Then
 sPuntiHOME1 = sPuntiHOME1 + 1
 End If
 
 If sHome1 = Range("F" & i).Value And sPrimo1 > sSecondo1 Then
 sPuntiHOME1 = sPuntiHOME1 + 3
 End If

 If sHome1 <> Range("F" & i).Value And sPrimo1 < sSecondo1 Then
 sPuntiHOME1 = sPuntiHOME1 + 3
 End If

'=====================================

If sPrimo1 > 0 And sSecondo1 > 0 Then
sGG1 = sGG1 + 1
Else
sNG1 = sNG1 + 1
End If

If (sPrimo1 + sSecondo1) > 2 Then
sOV1 = sOV1 + 1
Else
sUN1 = sUN1 + 1
End If

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sDate_Time
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sCompetiz
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 4).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 5).Value = sSecondo
Cells(i, nColonnaInizio + 13).Value = sGf1
Cells(i, nColonnaInizio + 14).Value = sGs1
Cells(i, nColonnaInizio + 15).Value = sPuntiHOME1
Cells(i, nColonnaInizio + 76).Value = sGG1
Cells(i, nColonnaInizio + 77).Value = sNG1
Cells(i, nColonnaInizio + 18).Value = sUN1
Cells(i, nColonnaInizio + 19).Value = sOV1
Cells(i, nColonnaInizio + 20).Value = (segnatocasa * 20 + subitocasa * 20) / 2
'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

Posiz1a = Posiz10a + 1

Loop

' ============================================
GoTo Salta

End If

'On Error Resume Next

If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
If sPrimo > 0 Then
segnatocasa = segnatocasa + 1
If sSecondo = 0 Then
subitocasa = subitocasa + 1
End If
End If
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
If sSecondo > 0 Then
segnatocasa = segnatocasa + 1
If sPrimo = 0 Then
subitocasa = subitocasa + 1

End If
End If
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
If sPrimo > 0 Then
segnatocasa = segnatocasa + 1
If sSecondo = 0 Then
subitocasa = subitocasa + 1
End If
End If
End If
If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If

' ===============================================

 If sPrimo = sSecondo Then
 sPuntiHOME = sPuntiHOME + 1
 sHPareggiate = sHPareggiate + 1
 
 End If
 
 If sHome = Range("F" & i).Value And sPrimo > sSecondo Then
 sPuntiHOME = sPuntiHOME + 3
 SHvinte = SHvinte + 1
 
 End If

 If sHome <> Range("F" & i).Value And sPrimo < sSecondo Then
 sPuntiHOME = sPuntiHOME + 3
 SHvinte = SHvinte + 1
 End If
 If sHome = Range("F" & i).Value And sPrimo < sSecondo Then
 sHperse = sHperse + 1
 End If
 If sHome <> Range("F" & i).Value And sPrimo > sSecondo Then
 sHperse = sHperse + 1
 End If
'===============================================
If sPrimo > 0 And sSecondo > 0 Then
sGG = sGG + 1
Else
sNG = sNG + 1
End If
If sHome = Range("F" & i).Value Then
sgHfatti = sgHfatti + sPrimo
sgHsubiti = sgHsubiti + sSecondo
Else
sgHfatti = sgHfatti + sSecondo
sgHsubiti = sgHsubiti + sPrimo
End If
If (sPrimo + sSecondo) > 2 Then
sOV = sOV + 1
Else
sUN = sUN + 1
End If

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sDate_Time
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sCompetiz
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 4).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 5).Value = sSecondo
Cells(i, nColonnaInizio + 12).Value = SHvinte
Cells(i, nColonnaInizio + 13).Value = sHPareggiate
Cells(i, nColonnaInizio + 14).Value = sHperse
Cells(i, nColonnaInizio + 15).Value = sUN
Cells(i, nColonnaInizio + 16).Value = sOV
Cells(i, nColonnaInizio + 17).Value = sgHfatti
Cells(i, nColonnaInizio + 18).Value = sgHsubiti
Cells(i, nColonnaInizio + 19).Value = (segnatocasa * 20 + subitocasa * 20) / 2
Cells(i, nColonnaInizio + 76).Value = sGG
Cells(i, nColonnaInizio + 77).Value = sNG
'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz10 + 1

Loop

Salta:

Next i

Linea1:
   
'Sheets("DATI").Select

Call FORMA_TEAM_2

Call NumeroSquadre
Call PRONOSTICO_KALOSG_I
Call PRONOSTICO_KALOSG_II
Range("A1").Select

End Sub
Attribute VB_Name = "Forma_team2_U6_H_A"
Sub FORMA_TEAM_2()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("AT3:AZ1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("AR65536").End(xlUp).Row

For i = 3 To f

If Range("AR" & i).Value = "-" Then
        Cells(i, 46).Value = "-"
        Cells(i, 47).Value = "-"
        Cells(i, 48).Value = "-"
        Cells(i, 49).Value = "-"
        Cells(i, 50).Value = "-"
        Cells(i, 51).Value = "-"
        Cells(i, 52).Value = "-"
GoTo Salta
End If


If Range("AS" & i).Value >= Range("E1").Value Then
sNumeroGareAway = Range("E1").Value
Else
sNumeroGareAway = Range("E1").Value
'sNumeroGareAway = Range("AS" & i).Value
End If

url1 = "http://www.betonews.com/popup.asp?lang=en&tp=9011&idt=" & Range("AR" & i) & "&tqw=1&tqc=-1&tqy=0&tqt=" & sNumeroGareAway & ""

' link he comprende tutto
'url1 = "http://www.betonews.com/popup.asp?lang=en&tp=9011&idt=" & Range("AR" & i) & "&tqw=1&tqc=0&tqy=0&tqt=" & Range("E1") & ""

On Error Resume Next

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText

        
    sControllo0 = "nowrap style=padding: 2px 5px><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
   
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>99-99</span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
   
' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 0
        
    Posiz1 = 1
    
sGf = 0
sGs = 0
sPuntiAWAY = 0
sGG = 0
sNG = 0
sOV = 0
sUN = 0
sAvinte = 0
sAPareggiate = 0
sAperse = 0
sgAfatti = 0
sgAsubiti = 0
segnatoOspite = 0
subitoOspite = 0
Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Do
        End If
        
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
        
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
                

'sDate_Time = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sCompetiz = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'sAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))
sRisultato = Trim(Mid(Text1, Posiz9, Posiz10 - Posiz9))

'Dim sRisultato As String
'Dim sGf As Single
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    sPrimo = Trim(divide(0))
    sSecondo = Trim(divide(1))

If sPrimo = "99" And sSecondo = "99" Then
GoTo 10:

' ============================================

If Range("AS" & i).Value >= Range("E1").Value Then
sNumeroGareAway = Range("E1").Value + 1
Else
sNumeroGareAway = Range("AS" & i).Value + 1
End If

url2 = "http://www.betonews.com/popup.asp?lang=en&tp=9011&idt=" & Range("AR" & i) & "&tqw=1&tqc=-1&tqy=0&tqt=" & sNumeroGareAway & ""

On Error Resume Next

Set http2 = CreateObject("MSXML2.XMLHTTP")
http2.Open "POST", url2, False
http2.send
Text2 = http2.responseText

  
' verifico che la stinga contenga i dati richiesti
    
   Text2 = Replace(Text2, Chr(34), "")
   Text2 = Replace(Text2, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
       
    Posiz1a = 1
    
sGf1 = 0
sGs1 = 0
sPuntiAWAY1 = -1
sGG1 = 0
sNG1 = 0
sOV1 = 0
sUN1 = 0
segnatoOspite = 0
subitoOspite = 0
Do

'-------------------------------------------------------------

     Posiz1a = InStr(Posiz1a, Text2, sControllo0)
     
        If Posiz1a = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Do
        End If
        
        Posiz1a = InStr(Posiz1a, Text2, sControllo0) + sLen0
        Posiz2a = InStr(Posiz1a, Text2, sControllo1)
        
        Posiz3a = InStr(Posiz2a, Text2, sControllo0) + sLen0
        Posiz4a = InStr(Posiz3a, Text2, sControllo1)
        
        Posiz5a = InStr(Posiz4a, Text2, sControllo0) + sLen0
        Posiz6a = InStr(Posiz5a, Text2, sControllo1)
        
        Posiz7a = InStr(Posiz6a, Text2, sControllo0) + sLen0
        Posiz8a = InStr(Posiz7a, Text2, sControllo1)
        
        Posiz9a = InStr(Posiz8a, Text2, sControllo0) + sLen0
        Posiz10a = InStr(Posiz9a, Text2, sControllo1)
                

'sDate_Time = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sCompetiz = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sHome1 = Trim(Mid(Text2, Posiz5a, Posiz6a - Posiz5a))
sAway1 = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))
sRisultato1 = Trim(Mid(Text2, Posiz9a, Posiz10a - Posiz9a))

'Dim sRisultato As String
'Dim sGf As Single
Dim sPrimo1 As Single
Dim sSecondo1 As Single


    divide1 = Split(sRisultato1, "-")
    
    sPrimo1 = Trim(divide1(0))
    sSecondo1 = Trim(divide1(1))


'On Error Resume Next

If sHome1 = Range("G" & i).Value Then
sGf1 = sGf1 + sPrimo1
If sPrimo1 > 0 Then
segnatoOspite = segnatoOspite + 1
If sSecondo1 = 0 Then
subitoOspite = subitoOspite + 1
End If
End If
Else
sGf1 = sGf1 + sSecondo1
If sSecondo1 > 0 Then
segnatoOspite = segnatoOspite + 1
If sPrimo1 = 0 Then
subitoOspite = subitoOspite + 1
End If
End If
End If


If sHome1 <> Range("G" & i).Value Then
sGs1 = sGs1 + sPrimo1
Else
sGs1 = sGs1 + sSecondo1
End If

' ===============================================

 If sPrimo1 = sSecondo1 Then
 sPuntiAWAY1 = sPuntiAWAY1 + 1
 End If
 
 If sAway1 = Range("G" & i).Value And sPrimo1 < sSecondo1 Then
 sPuntiAWAY1 = sPuntiAWAY1 + 3
 End If

 If sAway1 = Range("F" & i).Value And sPrimo1 > sSecondo1 Then
 sPuntiAWAY1 = sPuntiAWAY1 + 3
 End If

'============================================

If sPrimo1 > 0 And sSecondo1 > 0 Then
sGG1 = sGG1 + 1
Else
sNG1 = sNG1 + 1
End If

If (sPrimo1 + sSecondo1) > 2 Then
sOV1 = sOV1 + 1
Else
sUN1 = sUN1 + 1
End If

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sDate_Time
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sCompetiz
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 4).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 5).Value = sSecondo
Cells(i, nColonnaInizio + 46).Value = sGf1
Cells(i, nColonnaInizio + 47).Value = sGs1
Cells(i, nColonnaInizio + 48).Value = sPuntiAWAY1
Cells(i, nColonnaInizio + 78).Value = sGG1
Cells(i, nColonnaInizio + 79).Value = sNG1
Cells(i, nColonnaInizio + 51).Value = sUN1
Cells(i, nColonnaInizio + 52).Value = sOV1
Cells(i, nColonnaInizio + 53).Value = (segnatoOspite * 20 + subitoOspite * 20) / 2

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1
10:
Posiz1a = Posiz10a + 1

Loop

' ============================================
GoTo Salta

End If

'On Error Resume Next

If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
If sPrimo > 0 Then
segnatoOspite = segnatoOspite + 1
If sSecondo = 0 Then
subitoOspite = subitoOspite + 1
End If
End If
Else
If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
If sSecondo > 0 Then
segnatoOspite = segnatoOspite + 1
If sPrimo = 0 Then
subitoOspite = subitoOspite + 1
End If
End If
End If
End If

If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If

' ===============================================

 If sPrimo = sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 1
 sAPareggiate = sAPareggiate + 1
 End If
 
 If sHome = Range("G" & i).Value And sPrimo > sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 3
 sAvinte = sAvinte + 1
 End If

 If sHome <> Range("G" & i).Value And sPrimo < sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 3
 sAvinte = sAvinte + 1
 End If
If sHome = Range("G" & i).Value And sPrimo < sSecondo Then
 sAperse = sAperse + 1
 End If
 If sHome <> Range("G" & i).Value And sPrimo > sSecondo Then
 sAperse = sAperse + 1
 End If
'============================================

If sPrimo > 0 And sSecondo > 0 Then
sGG = sGG + 1
Else
sNG = sNG + 1
End If
If sHome = Range("G" & i).Value Then
sgAfatti = sgAfatti + sPrimo
sgAsubiti = sgAsubiti + sSecondo
Else
sgAfatti = sgAfatti + sSecondo
sgAsubiti = sgAsubiti + sPrimo
End If

If (sPrimo + sSecondo) > 2 Then
sOV = sOV + 1
Else
sUN = sUN + 1
End If


'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sDate_Time
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sCompetiz
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 4).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 5).Value = sSecondo
Cells(i, nColonnaInizio + 45).Value = sAvinte
Cells(i, nColonnaInizio + 46).Value = sAPareggiate
Cells(i, nColonnaInizio + 47).Value = sAperse
Cells(i, nColonnaInizio + 48).Value = sUN
Cells(i, nColonnaInizio + 49).Value = sOV
Cells(i, nColonnaInizio + 50).Value = sgAfatti
Cells(i, nColonnaInizio + 51).Value = sgAsubiti
Cells(i, nColonnaInizio + 52).Value = (segnatoOspite * 20 + subitoOspite * 20) / 2
Cells(i, nColonnaInizio + 78).Value = sGG
Cells(i, nColonnaInizio + 79).Value = sNG
'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz10 + 1

Loop

Salta:

Next i
   
'Sheets("INDEX").Select

Range("A1").Select

End Sub
Attribute VB_Name = "KalosG_I"
Sub PRONOSTICO_KALOSG_I()


Application.ScreenUpdating = False

Sheets("KalosG1").Select

Range("A3:M1000").ClearContents

f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

If Range("DATI!Q" & i) = "-" Then
Sheets("KalosG1").Select
Cells(i, 1).Value = "-"
Cells(i, 2).Value = "-"
Cells(i, 3).Value = "-"
Cells(i, 4).Value = "-"
Cells(i, 5).Value = "-"
Cells(i, 6).Value = "-"
Cells(i, 7).Value = "-"
Cells(i, 8).Value = "-"
Cells(i, 9).Value = "-"
Cells(i, 10).Value = "-"
Cells(i, 11).Value = "-"
Cells(i, 12).Value = "-"
Cells(i, 13).Value = "-"

GoTo Salta
End If


Cells(i, 1).Value = Range("DATI!A" & i)
Cells(i, 2).Value = Range("DATI!B" & i)
Cells(i, 3).Value = Range("DATI!C" & i)
Cells(i, 4).Value = Range("DATI!D" & i)
Cells(i, 5).Value = Range("DATI!E" & i)
Cells(i, 6).Value = Range("DATI!F" & i)
Cells(i, 7).Value = Range("DATI!G" & i)
Cells(i, 8).Value = Range("DATI!Q" & i)
Cells(i, 9).Value = Range("DATI!R" & i)
Cells(i, 10).Value = Range("DATI!AX" & i)
Cells(i, 11).Value = Range("DATI!AY" & i)
Cells(i, 12).Value = ((Range("DATI!Q" & i) + Range("DATI!R" & i) + Range("DATI!AX" & i) + Range("DATI!AY" & i)) - (4 * Range("DATI!E1")))
Cells(i, 13).Value = "NoBet"

If Range("DATI!Q" & i) > Range("KalosG1!E1") And Range("DATI!R" & i) > Range("KalosG1!E1") Then
  If Range("DATI!AX" & i) > Range("KalosG1!E1") And Range("DATI!AY" & i) > Range("KalosG1!E1") Then
    If (Range("DATI!U" & i) + Range("DATI!V" & i) + Range("DATI!W" & i)) >= Range("KalosG1!E1") And (Range("DATI!BB" & i) + Range("DATI!BC" & i) + Range("DATI!BD" & i)) >= Range("KalosG1!E1") Then

Sheets("KalosG1").Select

Cells(i, 1).Value = Range("DATI!A" & i)
Cells(i, 2).Value = Range("DATI!B" & i)
Cells(i, 3).Value = Range("DATI!C" & i)
Cells(i, 4).Value = Range("DATI!D" & i)
Cells(i, 5).Value = Range("DATI!E" & i)
Cells(i, 6).Value = Range("DATI!F" & i)
Cells(i, 7).Value = Range("DATI!G" & i)
Cells(i, 8).Value = Range("DATI!Q" & i)
Cells(i, 9).Value = Range("DATI!R" & i)
Cells(i, 10).Value = Range("DATI!AX" & i)
Cells(i, 11).Value = Range("DATI!AY" & i)
Cells(i, 12).Value = ((Range("DATI!Q" & i) + Range("DATI!R" & i) + Range("DATI!AX" & i) + Range("DATI!AY" & i)) - (4 * Range("DATI!E1")))
Cells(i, 13).Value = "Over 1,5"
    End If
  End If
End If

If Range("DATI!Q" & i) < Range("KalosG1!E1") And Range("DATI!R" & i) < Range("KalosG1!E1") Then
  If Range("DATI!AX" & i) < Range("KalosG1!E1") And Range("DATI!AY" & i) < Range("KalosG1!E1") Then
    If (Range("DATI!U" & i) + Range("DATI!V" & i) + Range("DATI!W" & i)) >= Range("KalosG1!E1") And (Range("DATI!BB" & i) + Range("DATI!BC" & i) + Range("DATI!BD" & i)) >= Range("KalosG1!E1") Then

Sheets("KalosG1").Select

Cells(i, 1).Value = Range("DATI!A" & i)
Cells(i, 2).Value = Range("DATI!B" & i)
Cells(i, 3).Value = Range("DATI!C" & i)
Cells(i, 4).Value = Range("DATI!D" & i)
Cells(i, 5).Value = Range("DATI!E" & i)
Cells(i, 6).Value = Range("DATI!F" & i)
Cells(i, 7).Value = Range("DATI!G" & i)
Cells(i, 8).Value = Range("DATI!Q" & i)
Cells(i, 9).Value = Range("DATI!R" & i)
Cells(i, 10).Value = Range("DATI!AX" & i)
Cells(i, 11).Value = Range("DATI!AY" & i)
Cells(i, 12).Value = ((Range("DATI!Q" & i) + Range("DATI!R" & i) + Range("DATI!AX" & i) + Range("DATI!AY" & i)) - (4 * Range("DATI!E1")))
Cells(i, 13).Value = "Under 3,5"
    
    End If
  End If
End If

Salta:
  
Next i

Application.ScreenUpdating = False
   

Range("A1").Select
End Sub

Sub Risultati_Finali_KALOSG_I()

Dim url1 As String
Dim Text2 As String
Dim sText3 As String
Dim sText4 As String
Dim sResult  As String
Dim sDate As String
Dim sStage, sStage1, stagemenu As String
Dim date1, text1a As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim Text2a As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Sheets("DATI").Select

'Range("CC3:CE1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

fine = Foglio2.Range("H65536").End(xlUp).Row
inizio = Foglio2.Range("CC65536").End(xlUp).Row


For i = inizio To fine

If Range("H" & i).Value = "" Then
GoTo Linea1
End If

url1 = "http://www.betonews.com/popup.asp?tp=1100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "Orario"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
    sControllo2 = "Squadra1"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "Squadra2"
    sLen3 = Len(sControllo3)
    
    sControllo4 = ">FT"
    sLen4 = Len(sControllo4)
    
    sControllo5 = "Risultato"
    sLen5 = Len(sControllo5)
    
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, Chr(35), "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Orario")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=right nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra1")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra2")
   'Text1 = Replace(Text1, "<td bgcolor=cecf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
  
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>", "Risultato")
  
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Stringa non presente ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 81
        
    Posiz1 = 1
    
    Do
            
     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        Posiz5 = InStr(Posiz4, Text1, sControllo2) + sLen2
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        Posiz7 = InStr(Posiz6, Text1, sControllo3) + sLen3
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
       
       
        Posiz9 = InStr(Posiz8, Text1, sControllo4)
     
        If Posiz9 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz10 = InStr(Posiz9, Text1, sControllo5) + sLen5
        Posiz11 = InStr(Posiz10, Text1, sControllo1)
        
        Posiz12 = InStr(Posiz11, Text1, sControllo5) + sLen5
        Posiz13 = InStr(Posiz12, Text1, sControllo1)
        
        Posiz14 = InStr(Posiz13, Text1, sControllo5) + sLen5
        Posiz15 = InStr(Posiz14, Text1, sControllo1)
        
        
'sOra = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sComp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
'sHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'sAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

sRis1 = Trim(Mid(Text1, Posiz10, Posiz11 - Posiz10))
sRis = Trim(Mid(Text1, Posiz12, Posiz13 - Posiz12))
sRis2 = Trim(Mid(Text1, Posiz14, Posiz15 - Posiz14))
 

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sOra
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sComp
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway

Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sRis1
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sRis
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sRis2

'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz15 + 1

'If nRigaTabella > nMaxRigheImport Then
           ' MsgBox " troppe righe (>" + Str$(nMaxRigheImport) + ") interrompo elaborazione"
           ' Exit Do
      '  End If
Loop
    
Text1 = ""

Linea1:

Next i


 Application.ScreenUpdating = True
  Set http1 = Nothing
  Set Text1 = Nothing
  
  Text1 = ""
Sheets("KalosG1").Select
Range("A1").Select

End Sub
Attribute VB_Name = "KalosG_II"
Sub PRONOSTICO_KALOSG_II()


Application.ScreenUpdating = False

Sheets("KalosG2").Select

Range("A3:M1000").ClearContents

f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

If Range("DATI!M" & i) = "-" Then

Sheets("KalosG2").Select
Cells(i, 1).Value = "-"
Cells(i, 2).Value = "-"
Cells(i, 3).Value = "-"
Cells(i, 4).Value = "-"
Cells(i, 5).Value = "-"
Cells(i, 6).Value = "-"
Cells(i, 7).Value = "-"
Cells(i, 8).Value = "-"
Cells(i, 9).Value = "-"
Cells(i, 10).Value = "-"

GoTo Salta
End If


Cells(i, 1).Value = Range("DATI!A" & i)
Cells(i, 2).Value = Range("DATI!B" & i)
Cells(i, 3).Value = Range("DATI!C" & i)
Cells(i, 4).Value = Range("DATI!D" & i)
Cells(i, 5).Value = Range("DATI!E" & i)
Cells(i, 6).Value = Range("DATI!F" & i)
Cells(i, 7).Value = Range("DATI!G" & i)
Cells(i, 8).Value = Range("DATI!J" & i)
Cells(i, 9).Value = (Range("DATI!L" & i) * 3) + Range("DATI!M" & i)
Cells(i, 10).Value = Range("DATI!AQ" & i)
Cells(i, 11).Value = (Range("DATI!AS" & i) * 3) + Range("DATI!AT" & i)
Cells(i, 12).Value = Abs((Range("DATI!AQ" & i) - Range("DATI!J" & i)) * 100 / (Range("DATI!BW" & i) - 1))
Cells(i, 13).Value = "NoBet"


If ((Range("DATI!L" & i) * 3) + Range("DATI!M" & i) - (Range("DATI!AS" & i) * 3) + Range("DATI!AT" & i)) > Range("KalosG2!E1") And Range("DATI!J" & i) < Range("DATI!AQ" & i) Then
 
Sheets("KalosG2").Select

Cells(i, 1).Value = Range("DATI!A" & i)
Cells(i, 2).Value = Range("DATI!B" & i)
Cells(i, 3).Value = Range("DATI!C" & i)
Cells(i, 4).Value = Range("DATI!D" & i)
Cells(i, 5).Value = Range("DATI!E" & i)
Cells(i, 6).Value = Range("DATI!F" & i)
Cells(i, 7).Value = Range("DATI!G" & i)
Cells(i, 8).Value = Range("DATI!J" & i)
Cells(i, 9).Value = (Range("DATI!L" & i) * 3) + Range("DATI!M" & i)
Cells(i, 10).Value = Range("DATI!AQ" & i)
Cells(i, 11).Value = (Range("DATI!AS" & i) * 3) + Range("DATI!AT" & i)
Cells(i, 12).Value = Abs((Range("DATI!J" & i) - Range("DATI!AQ" & i)) * 100 / (Range("DATI!BW" & i) - 1))
Cells(i, 13).Value = "1X"
 
End If


Salta1:

If ((Range("DATI!L" & i) * 3) + Range("DATI!M" & i) - (Range("DATI!AS" & i) * 3) + Range("DATI!AT" & i)) < -(Range("KalosG2!E1")) And Range("DATI!J" & i) > Range("DATI!AQ" & i) Then

Sheets("KalosG2").Select
Cells(i, 1).Value = Range("DATI!A" & i)
Cells(i, 2).Value = Range("DATI!B" & i)
Cells(i, 3).Value = Range("DATI!C" & i)
Cells(i, 4).Value = Range("DATI!D" & i)
Cells(i, 5).Value = Range("DATI!E" & i)
Cells(i, 6).Value = Range("DATI!F" & i)
Cells(i, 7).Value = Range("DATI!G" & i)
Cells(i, 8).Value = Range("DATI!J" & i)
Cells(i, 9).Value = (Range("DATI!L" & i) * 3) + Range("DATI!M" & i)
Cells(i, 10).Value = Range("DATI!AQ" & i)
Cells(i, 11).Value = (Range("DATI!AS" & i) * 3) + Range("DATI!AT" & i)
Cells(i, 12).Value = Abs((Range("DATI!AQ" & i) - Range("DATI!J" & i)) * 100 / (Range("DATI!BW" & i) - 1))
Cells(i, 13).Value = "X2"

End If

Salta:
  
Next i

Application.ScreenUpdating = False

    

    Range("A1").Select
End Sub


Sub Risultati_Finali_KALOSG_II()

Dim url1 As String
Dim Text2 As String
Dim sText3 As String
Dim sText4 As String
Dim sResult  As String
Dim sDate As String
Dim sStage, sStage1, stagemenu As String
Dim date1, text1a As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim Text2a As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Sheets("DATI").Select

'Range("CC3:CE1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

fine = Foglio2.Range("H65536").End(xlUp).Row
inizio = Foglio2.Range("CC65536").End(xlUp).Row


For i = inizio To fine

If Range("H" & i).Value = "" Then
GoTo Linea1
End If

url1 = "http://www.betonews.com/popup.asp?tp=1100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "Orario"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
    sControllo2 = "Squadra1"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "Squadra2"
    sLen3 = Len(sControllo3)
    
    sControllo4 = ">FT"
    sLen4 = Len(sControllo4)
    
    sControllo5 = "Risultato"
    sLen5 = Len(sControllo5)
    
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, Chr(35), "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Orario")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=right nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra1")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra2")
   'Text1 = Replace(Text1, "<td bgcolor=cecf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
  
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>", "Risultato")
  
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Stringa non presente ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 81
        
    Posiz1 = 1
    
    Do
            
     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        Posiz5 = InStr(Posiz4, Text1, sControllo2) + sLen2
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        Posiz7 = InStr(Posiz6, Text1, sControllo3) + sLen3
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
       
       
        Posiz9 = InStr(Posiz8, Text1, sControllo4)
     
        If Posiz9 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz10 = InStr(Posiz9, Text1, sControllo5) + sLen5
        Posiz11 = InStr(Posiz10, Text1, sControllo1)
        
        Posiz12 = InStr(Posiz11, Text1, sControllo5) + sLen5
        Posiz13 = InStr(Posiz12, Text1, sControllo1)
        
        Posiz14 = InStr(Posiz13, Text1, sControllo5) + sLen5
        Posiz15 = InStr(Posiz14, Text1, sControllo1)
        
        
'sOra = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sComp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
'sHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'sAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

sRis1 = Trim(Mid(Text1, Posiz10, Posiz11 - Posiz10))
sRis = Trim(Mid(Text1, Posiz12, Posiz13 - Posiz12))
sRis2 = Trim(Mid(Text1, Posiz14, Posiz15 - Posiz14))
 

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sOra
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sComp
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway

Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sRis1
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sRis
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sRis2

'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz15 + 1

'If nRigaTabella > nMaxRigheImport Then
           ' MsgBox " troppe righe (>" + Str$(nMaxRigheImport) + ") interrompo elaborazione"
           ' Exit Do
      '  End If
Loop
    
Text1 = ""

Linea1:

Next i


 Application.ScreenUpdating = True
  Set http1 = Nothing
  Set Text1 = Nothing
  
  Text1 = ""
Sheets("KalosG2").Select
Range("A1").Select

End Sub
Attribute VB_Name = "Modulo1"
Sub Macro1()
Attribute Macro1.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Macro1 Macro
'

'
    Sheets("DATI").Select
    ActiveWindow.SmallScroll Down:=-61
    Range("A3:AQ87").Select
    Selection.Copy
    Sheets("stat").Select
    ActiveWindow.SmallScroll Down:=396
    Range("A738").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets("DATI").Select
    ActiveWindow.SmallScroll Down:=-63
    Range("CR3:CX87").Select
    Application.CutCopyMode = False
    Selection.Copy
    Sheets("stat").Select
    Range("CE738").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets("Prono").Select
    Range("T3:Z87").Select
    Application.CutCopyMode = False
    Selection.Copy
    Sheets("stat").Select
    Range("CL738").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets("Prono").Select
    ActiveWindow.SmallScroll Down:=-7
    ActiveWindow.LargeScroll Down:=-1
    ActiveWindow.SmallScroll Down:=-49
    Range("R3:S87,S87").Select
    Range("S87").Activate
    Application.CutCopyMode = False
    ActiveWindow.SmallScroll Down:=-73
    Range("S10").Select
    ActiveCell.FormulaR1C1 = "=CONCATENATE(DATI!RC[65],DATI!RC[66],DATI!RC[67])"
    Range("R3:S87").Select
    Selection.Copy
    Sheets("stat").Select
    Range("CC738").Select
    Selection.PasteSpecial Paste:=xlPasteAllUsingSourceTheme, Operation:=xlNone _
        , SkipBlanks:=False, Transpose:=False
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
End Sub
Attribute VB_Name = "Numero_Squadre"
Sub NumeroSquadre()

Dim url1 As String
Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("BW3:BW1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

If Range("J" & i).Value = "-" Then
Cells(i, nColonnaInizio + 75).Value = "-"
GoTo Salta
End If

url1 = "http://www.betonews.com/popup.asp?tp=7100&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText

    sControllo0 = "<td align=center bgcolor=#ececf2 style=padding: 2px 2px><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
 
    sStanding = "nowrap title=Standing>"
 
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, "d8d8f2", "ececf2")
  

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 0
        
    Posiz1 = 1
    
Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Salta
        End If
        
       
        'trova n|fffd| squadre campionato
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        
    
sNumeroTeam = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))

Cells(i, nColonnaInizio + 75).Value = sNumeroTeam

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz2 + 1

Loop

Salta:

Next i
  
'Sheets("INDEX").Select

Range("A1").Select

End Sub
Attribute VB_Name = "PROVA"
Sub PROVA_FORMA_TEAM_1_NEW()

Dim url1 As String
Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Call DATI_SQUADRA1

Range("BX3:BY1000").ClearContents
Range("DH3:DH1000").ClearContents


Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText

sLast1 = "Last 12 Matches"
sLenLast1 = Len(sLast1)
sLast2 = "Last 6 Matches"
sLenLast2 = Len(sLast2)

    sControllo0 = "nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)

   Text1 = Replace(Text1, Chr(34), "")

   sUscita = "</table></td>"
   
' verifico che la stinga contenga i dati richiesti
    
    sInizio = InStr(1, Text1, sLast1)
    sInizio1 = InStr(sInizio + 5, Text1, sUscita)
    
    sFine = InStr(sInizio1 + 5, Text1, sUscita)
    
    Text1 = Mid(Text1, sInizio1, sFine - sInizio1)
       
            
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Exit Sub
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 0
        
    Posiz1 = 1
    
sGf = 0
sGs = 0
sConta = 1

sPuntiHOME = 0

Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Salta
        End If
        
       
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              

    'If InStr(Posiz8, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
     '   Cells(i, nColonnaInizio + 0).Value = "-"
      '  Cells(i, nColonnaInizio + 1).Value = "-"
       ' GoTo Salta
    'Else
        'MsgBox "La stringa |fffd| presente"
    'End If

sHome = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sAway = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
sRisultato = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

'Dim sRisultato As String
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = Trim((divide(0)))
    sSecondo = Trim((divide(1)))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

' ===============================================
 If sHome = Range("F" & i).Value And sPrimo > sSecondo Then
 sPuntiHOME = sPuntiHOME + 3
 End If

 If sHome = Range("F" & i).Value And sPrimo < sSecondo Then
 sPuntiHOME = sPuntiHOME + 0
 End If

 If sHome = Range("F" & i).Value And sPrimo = sSecondo Then
 sPuntiHOME = sPuntiHOME + 1
 End If

 If sHome <> Range("F" & i).Value And sPrimo < sSecondo Then
 sPuntiHOME = sPuntiHOME + 3
 End If

 If sHome <> Range("F" & i).Value And sPrimo > sSecondo Then
 sPuntiHOME = sPuntiHOME + 0
 End If

 If sHome <> Range("F" & i).Value And sPrimo = sSecondo Then
 sPuntiHOME = sPuntiHOME + 1
 End If
 
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo

Cells(i, nColonnaInizio + 76).Value = sGf
Cells(i, nColonnaInizio + 77).Value = sGs
Cells(i, nColonnaInizio + 12).Value = sConta

Cells(i, nColonnaInizio + 112).Value = sPuntiHOME

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz8 + 1
sConta = sConta + 1

If sConta > Range("E1").Value Then
GoTo Salta
End If

Loop

Salta:

Next i

Linea1:
 
  
'Sheets("INDEX").Select

Call PROVA_FORMA_TEAM_2_NEW

Range("A1").Select

End Sub


Sub PROVA_FORMA_TEAM_2_NEW()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("BZ3:CA1000").ClearContents
Range("DI3:DI1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText

sLast1 = "Last 12 Matches"
sLenLast1 = Len(sLast1)
sLast2 = "Last 6 Matches"
sLenLast2 = Len(sLast2)

    sControllo0 = "nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)

   Text1 = Replace(Text1, Chr(34), "")

   sUscita = "</table></td>"
   
' verifico che la stinga contenga i dati richiesti
    
    sInizio = InStr(1, Text1, sLast1)
    sInizio1 = InStr(sInizio + 5, Text1, sUscita)
    sInizio2 = InStr(sInizio1 + 5, Text1, sUscita)
    
    sFine = InStr(sInizio2 + 5, Text1, sUscita)
    
    Text1 = Mid(Text1, sInizio2, sFine - sInizio2)
       
            
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Exit Sub
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 0
        
    Posiz1 = 1
    
sGf = 0
sGs = 0
sConta = 1

sPuntiAWAY = 0

Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Salta
        End If
        
       
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              

    'If InStr(Posiz8, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
     '   Cells(i, nColonnaInizio + 0).Value = "-"
      '  Cells(i, nColonnaInizio + 1).Value = "-"
       ' GoTo Salta
    'Else
        'MsgBox "La stringa |fffd| presente"
    'End If

sHome = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sAway = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
sRisultato = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

'Dim sRisultato As String
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

' ===============================================
If sAway = Range("G" & i).Value And sPrimo < sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 3
 End If

If sAway = Range("G" & i).Value And sPrimo > sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 0
 End If

If sAway = Range("G" & i).Value And sPrimo = sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 1
 End If

If sAway <> Range("G" & i).Value And sPrimo > sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 3
 End If

If sAway <> Range("G" & i).Value And sPrimo < sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 0
 End If

If sAway <> Range("G" & i).Value And sPrimo = sSecondo Then
 sPuntiAWAY = sPuntiAWAY + 1
 End If
 
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo

Cells(i, nColonnaInizio + 78).Value = sGf
Cells(i, nColonnaInizio + 79).Value = sGs
Cells(i, nColonnaInizio + 45).Value = sConta

Cells(i, nColonnaInizio + 113).Value = sPuntiAWAY

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz8 + 1
sConta = sConta + 1

If sConta > Range("E1").Value Then
GoTo Salta
End If

Loop

Salta:

Next i

Linea1:
 
 Call NumeroSquadre
'Sheets("INDEX").Select

Range("A1").Select

End Sub

Attribute VB_Name = "Palinsesto"

Sub Palinsesto_BETO_livescore()

Dim url1 As String
Dim Text1 As String
Dim http1 As Object
Dim sControllo1 As String, sControllo2 As String, sControllo3 As String, sControllo_ID As String
Dim sLen1 As String, sLen2 As String, sLen3 As String, sLenID As String
Dim Posiz1 As Long, Posiz2 As Long, Posiz3 As Long, Posiz4 As Long, Posiz5 As Long
Dim Posiz6 As Long, Posiz7 As Long, Posiz8 As Long, Posiz9 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer
Dim IRange As Range

Application.ScreenUpdating = False

Sheets("DATI").Select

Range("A3:H1000").ClearContents
Range("J3:AO1000").ClearContents
Range("AQ3:BV1000").ClearContents
Range("CC3:CH1000").ClearContents
Range("CT3:CX1000").ClearContents
Range("BW3:ca1000").ClearContents

Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "http://www.betonews.com/table.asp?tp=1001&lang=en&dd=" & Range("A1") & "&dm=" & Range("B1") & "&dy=" & Range("C1") & "&df=" & Range("D1") & "&dw=1"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo1 = "nowrap>"
    sLen1 = Len(sControllo1)
     
    sControllo2 = "</td>"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "popup.asp?tp=1050&lang=en&idm="
    sLen3 = Len(sControllo3)
      
    sControllo_ID = "http://www.betonews.com/img/SportId1.gif"
    sLenID = Len(sControllo_ID)
    
  Text1 = Replace(Text1, Chr(34), "")
    
' verifico che la stinga contenga i dati richiesti
    
    
    If InStr(1, Text1, sControllo_ID) = 0 Then
        MsgBox "la stringa non |fffd| presente nel file txt"
        Exit Sub
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

   
        nRigaInizio = 3
        nColonnaInizio = 1
        
    Posiz1 = 1
        
 Do
                
        If InStr(Posiz1, Text1, sControllo_ID) = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Do
        End If
        
        'crea l'array
        Dim arraysquadre(3 To 1000, 1 To 8) As Variant
        
        Posiz1 = InStr(Posiz1, Text1, sControllo_ID) - 100
        
        Posiz2 = InStr(Posiz1, Text1, sControllo1) + sLen1
        
        Posiz3 = InStr(Posiz2, Text1, sControllo1) + sLen1
        Posiz4 = InStr(Posiz3, Text1, sControllo2)
        
        
        Posiz5 = InStr(Posiz4, Text1, sControllo1) + sLen1
        Posiz6 = InStr(Posiz5, Text1, sControllo2)
        
        Posiz7 = InStr(Posiz6, Text1, sControllo1) + sLen1
        Posiz8 = InStr(Posiz7, Text1, sControllo2)
        
        
        Posiz9 = InStr(Posiz8, Text1, sControllo3) + sLen3
      

'ExchangeName = Split(Split(Text1, "script>showDate(", , vbTextCompare)(1), ")</script>")(0)


kk = Foglio2.Range("CY65536").End(xlUp).Row

   
sGiorno = Replace(Mid(Text1, Posiz2, 2), "<", "")
sMese = Replace(Mid(Text1, Posiz2 + 3, 2), "<", "")
sAnno = Replace(Mid(Text1, Posiz2 + 6, 2), "<", "")
sOra = Replace(Mid(Text1, Posiz2 + 9, 5), "<", "")

Comp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))

sID = Mid(Text1, Posiz9, 7)

SquadraHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
SquadraAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))


For k = 3 To kk

If Comp = Range("CY" & k).Value Then

arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 0) = sGiorno
arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 1) = sMese
arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 2) = sAnno
arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 3) = sOra

arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 4) = Comp
arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 5) = SquadraHome
arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 6) = SquadraAway
arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 7) = sID

nRigaTabella = nRigaTabella + 1

Else
GoTo Salta:
End If
Salta:

Next k

Linea3:

Posiz1 = Posiz9 + 1

Loop

'scrive l'array sul foglio
Set IRange = Range(Cells(3, 1), Cells(1000, 8))
    IRange = arraysquadre

Application.CutCopyMode = False
Range("A1").Select
    
End Sub

Sub Prova_Quote()


Dim url1 As String
Dim Text2 As String
Dim sText3 As String
Dim sText4 As String
Dim sResult  As String
Dim sDate As String
Dim sStage, sStage1, stagemenu As String
Dim date1, text1a As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim Text2a As String
Dim sControllo1 As String
Dim sPartenza As String
Dim sPartenza1 As String
Dim sLen1 As String
Dim Squadra1, Squadra2 As String
Dim Quota1, QuotaX, Quota2 As String
Dim Posiz1 As Long
Dim Posiz2 As Long
Dim Posiz3 As Long
Dim Posiz4 As Long
Dim Posiz5 As Long
Dim Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer


Application.ScreenUpdating = False

Sheets("DATI").Select

Range("CT3:CX1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

w = Foglio2.Range("H65536").End(xlUp).Row

For x = 3 To w

url1 = "http://www.betonews.com/popup.asp?tp=2100&lang=en&idm=" & Range("H" & x) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText

Text1 = Replace(Text1, Chr(34), "")
Text1 = Replace(Text1, "<span class=tbl_red_txt", "Quote Aggiornate")
Text1 = Replace(Text1, "<span class=tbl_white_txt", "Quote Aggiornate")
Text1 = Replace(Text1, "<span class=tbl_black_txt", "Quote Aggiornate")
Text1 = Replace(Text1, "<span class=tbl_green_txt", "Quote Aggiornate")
Text1 = Replace(Text1, "<span class=tbl_blue_txt", "Quote Aggiornate")
Text1 = Replace(Text1, ">Quote Aggiornate>&nbsp;", "Quote Aggiornate>0.00 ")


    sPartenza = ">Last Price<"
    sPartenza1 = ">Volume<"
    sControllo1 = "Quote Aggiornate>"
    sLen1 = Len(sControllo1)
    sControllo2 = " </span></td>"
    
    
    ' verifico che la stinga contenga i dati richiesti
    
    y = InStr(1, Text1, sPartenza)
    j = InStr(1, Text1, sPartenza1)
    
    If InStr(y, Text1, sControllo1) = 0 Then
        'MsgBox "la stringa non |fffd| presente nel file txt"
        
        'On Error Resume Next
        'Exit Sub
    Else
        'MsgBox "La stringa |fffd| presente"
    End If


        nRigaInizio = x
        nColonnaInizio = 98


Posiz1 = InStr(y, Text1, sPartenza)
    
    'Do
            
        Posiz1 = InStr(Posiz1, Text1, sControllo1) + sLen1
        Posiz2 = InStr(Posiz1 + sLen1, Text1, sControllo1) + sLen1
        Posiz3 = InStr(Posiz2 + sLen1, Text1, sControllo1) + sLen1
        
        Posiz4 = InStr(Posiz3 + sLen1, Text1, sControllo1) + sLen1
        Posiz5 = InStr(Posiz4 + sLen1, Text1, sControllo1) + sLen1
        
        
        'Posiz4 = InStr(j, Text1, sControllo1) + sLen1
        'Posiz4a = InStr(Posiz4, Text1, sControllo2)
        'Posiz5 = InStr(Posiz4 + sLen1, Text1, sControllo1) + sLen1
        'Posiz5a = InStr(Posiz5, Text1, sControllo2)
        'Posiz6 = InStr(Posiz5 + sLen1, Text1, sControllo1) + sLen1
        'Posiz6a = InStr(Posiz6, Text1, sControllo2)
        
        If Posiz1 = 0 Then
            MsgBox "non ci solo altri dati"
            'Exit Do
        End If


Quota1 = Replace(Mid(Text1, Posiz1, 5), ",", ".")
QuotaX = Replace(Mid(Text1, Posiz2, 5), ",", ".")
Quota2 = Replace(Mid(Text1, Posiz3, 5), ",", ".")

QuotaU = Replace(Mid(Text1, Posiz4, 5), ",", ".")
QuotaO = Replace(Mid(Text1, Posiz5, 5), ",", ".")

'Vol1 = Trim(Replace(Mid(Text1, Posiz4, Posiz4a - Posiz4), ".", ""))
'VolX = Trim(Replace(Mid(Text1, Posiz5, Posiz5a - Posiz5), ".", ""))
'Vol2 = Trim(Replace(Mid(Text1, Posiz6, Posiz6a - Posiz6), ".", ""))

Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = Quota1
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = QuotaX
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = Quota2
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = QuotaU
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 4).Value = QuotaO

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = Vol1
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 4).Value = VolX
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 5).Value = Vol2

'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz6a + 1

If nRigaTabella > 500 Then
            'MsgBox " troppe righe (>250) interrompo elaborazione"
            'Exit Do
        End If
            
'Loop
nRigaInizio = nRigaInizio + 1

Text1 = ""

Next x

Application.CutCopyMode = False
Range("A1").Select

End Sub


Attribute VB_Name = "Quote_Pinnacle_varie"
Sub Quote_Pinnacle_H()


Dim url1 As String
Dim Text2 As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim sControllo1 As String
Dim sPartenza As String
Dim sPartenza1 As String
Dim sLen1 As String
Dim Posiz1 As Long
Dim Posiz2 As Long
Dim Posiz3 As Long
Dim Posiz4 As Long
Dim Posiz5 As Long
Dim Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer


Application.ScreenUpdating = False

Sheets("DATI").Select

Range("CT3:CX1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=3100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text2 = http1.responseText

'book_bet365_h.jpg

    sPartenza = "www.betonews.com/img/book_pinnacle_h"
    sControllo1 = "Quote Aggiornate>"
    sLen1 = Len(sControllo1)
    sControllo2 = "</span></td>"
    
  On Error Resume Next
sElimina = Mid(Text2, 1, (InStr(1, Text2, sPartenza)) - 1)

On Error Resume Next

Text2 = Replace(Text2, sElimina, "")
 
Text2 = Replace(Text2, Chr(34), "")
Text2 = Replace(Text2, "<span class=tbl_green_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_red_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_white_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_black_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_blue_txt", "Quote Aggiornate")
Text2 = Replace(Text2, ">Quote Aggiornate>&nbsp;", "Quote Aggiornate>0.00 ")
 
   
    ' verifico che la stinga contenga i dati richiesti
      
    If InStr(1, Text2, sPartenza) = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            Cells(i, nColonnaInizio + 101).Value = "-"
            Cells(i, nColonnaInizio + 102).Value = "-"
        'MsgBox "la stringa non |fffd| presente nel file txt"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If


        nRigaInizio = i
        nColonnaInizio = 0

    Posiz1 = 1
    
   ' Do
           
    Posiz1 = InStr(Posiz1, Text2, sPartenza)
    
            If Posiz1 = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
            
        End If
            
            
        Posiz1 = InStr(Posiz1, Text2, sControllo1) + sLen1
        Posiz2 = InStr(Posiz1, Text2, sControllo2)
        Posiz3i = InStr(Posiz2, Text2, sControllo1) + sLen1
        Posiz4i = InStr(Posiz3i, Text2, sControllo2)
        Posiz3 = InStr(Posiz2, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz4 = InStr(Posiz3, Text2, sControllo1) + sLen1
        Posiz5 = InStr(Posiz4, Text2, sControllo2)
        Posiz6i = InStr(Posiz5, Text2, sControllo1) + sLen1
        Posiz7i = InStr(Posiz6i, Text2, sControllo2)
        Posiz6 = InStr(Posiz5, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz7 = InStr(Posiz6, Text2, sControllo1) + sLen1
        Posiz8 = InStr(Posiz7, Text2, sControllo2)
        Posiz9i = InStr(Posiz8, Text2, sControllo1) + sLen1
        Posiz10i = InStr(Posiz9i, Text2, sControllo2)
        Posiz9 = InStr(Posiz8, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz10 = InStr(Posiz9, Text2, sPartenza)
        
        Posiz11 = InStr(Posiz10, Text2, sControllo1) + sLen1
        Posiz12 = InStr(Posiz11, Text2, sControllo2)
        
        Posiz13 = InStr(Posiz12, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz14 = InStr(Posiz13, Text2, sControllo1) + sLen1
        Posiz15 = InStr(Posiz14, Text2, sControllo2)
        
              
sAct1 = Trim(Replace(Mid(Text2, Posiz1, Posiz2 - Posiz1), ",", "."))
sini1 = Trim(Replace(Mid(Text2, Posiz3i, Posiz4i - Posiz3i), ",", "."))
sActX = Trim(Replace(Mid(Text2, Posiz4, Posiz5 - Posiz4), ",", "."))
siniX = Trim(Replace(Mid(Text2, Posiz6i, Posiz7i - Posiz6i), ",", "."))
sAct2 = Trim(Replace(Mid(Text2, Posiz7, Posiz8 - Posiz7), ",", "."))
sini2 = Trim(Replace(Mid(Text2, Posiz9i, Posiz10i - Posiz9i), ",", "."))
sActU = Trim(Replace(Mid(Text2, Posiz11, Posiz12 - Posiz11), ",", "."))
sActO = Trim(Replace(Mid(Text2, Posiz14, Posiz15 - Posiz14), ",", "."))


Cells(i, nColonnaInizio + 98).Value = sAct1
Cells(i, nColonnaInizio + 130).Value = sini1
Cells(i, nColonnaInizio + 99).Value = sActX
Cells(i, nColonnaInizio + 131).Value = siniX
Cells(i, nColonnaInizio + 100).Value = sAct2
Cells(i, nColonnaInizio + 132).Value = sini2
Cells(i, nColonnaInizio + 101).Value = sActU
Cells(i, nColonnaInizio + 102).Value = sActO
Cells(i, nColonnaInizio + 102).Value = sActO

'nRigaTabella = nRigaTabella + 1
       
'Loop

Linea1:

Posiz1 = 1

Next i

End Sub

Sub Quote_Bet365_H()


Dim url1 As String
Dim Text2 As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim sControllo1 As String
Dim sPartenza As String
Dim sPartenza1 As String
Dim sLen1 As String
Dim Posiz1 As Long
Dim Posiz2 As Long
Dim Posiz3 As Long
Dim Posiz4 As Long
Dim Posiz5 As Long
Dim Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer


Application.ScreenUpdating = False

Sheets("DATI").Select

Range("CT3:CX1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=3100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text2 = http1.responseText


    sPartenza = "www.betonews.com/img/book_bet365_h"
    sControllo1 = "Quote Aggiornate>"
    sLen1 = Len(sControllo1)
    sControllo2 = "</span></td>"
On Error Resume Next
   
sElimina = Mid(Text2, 1, (InStr(1, Text2, sPartenza)) - 1)

On Error Resume Next

Text2 = Replace(Text2, sElimina, "")
 
Text2 = Replace(Text2, Chr(34), "")
Text2 = Replace(Text2, "<span class=tbl_green_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_red_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_white_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_black_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_blue_txt", "Quote Aggiornate")
Text2 = Replace(Text2, ">Quote Aggiornate>&nbsp;", "Quote Aggiornate>0.00 ")
 
   
    ' verifico che la stinga contenga i dati richiesti
      
    If InStr(1, Text2, sPartenza) = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            Cells(i, nColonnaInizio + 101).Value = "-"
            Cells(i, nColonnaInizio + 102).Value = "-"
        'MsgBox "la stringa non |fffd| presente nel file txt"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If


        nRigaInizio = i
        nColonnaInizio = 0

    Posiz1 = 1
    
   ' Do
           
    Posiz1 = InStr(Posiz1, Text2, sPartenza)
    
            If Posiz1 = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
            
        End If
            
            
        Posiz1 = InStr(Posiz1, Text2, sControllo1) + sLen1
        Posiz2 = InStr(Posiz1, Text2, sControllo2)
        Posiz3i = InStr(Posiz2, Text2, sControllo1) + sLen1
        Posiz4i = InStr(Posiz3i, Text2, sControllo2)
        Posiz3 = InStr(Posiz2, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz4 = InStr(Posiz3, Text2, sControllo1) + sLen1
        Posiz5 = InStr(Posiz4, Text2, sControllo2)
        Posiz6i = InStr(Posiz5, Text2, sControllo1) + sLen1
        Posiz7i = InStr(Posiz6i, Text2, sControllo2)
        Posiz6 = InStr(Posiz5, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz7 = InStr(Posiz6, Text2, sControllo1) + sLen1
        Posiz8 = InStr(Posiz7, Text2, sControllo2)
        Posiz9i = InStr(Posiz8, Text2, sControllo1) + sLen1
        Posiz10i = InStr(Posiz9i, Text2, sControllo2)
        Posiz9 = InStr(Posiz8, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz10 = InStr(Posiz9, Text2, sPartenza)
        
        Posiz11 = InStr(Posiz10, Text2, sControllo1) + sLen1
        Posiz12 = InStr(Posiz11, Text2, sControllo2)
        
        Posiz13 = InStr(Posiz12, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz14 = InStr(Posiz13, Text2, sControllo1) + sLen1
        Posiz15 = InStr(Posiz14, Text2, sControllo2)
        
              
sAct1 = Trim(Replace(Mid(Text2, Posiz1, Posiz2 - Posiz1), ",", "."))
sini1 = Trim(Replace(Mid(Text2, Posiz3i, Posiz4i - Posiz3i), ",", "."))
sActX = Trim(Replace(Mid(Text2, Posiz4, Posiz5 - Posiz4), ",", "."))
siniX = Trim(Replace(Mid(Text2, Posiz6i, Posiz7i - Posiz6i), ",", "."))
sAct2 = Trim(Replace(Mid(Text2, Posiz7, Posiz8 - Posiz7), ",", "."))
sini2 = Trim(Replace(Mid(Text2, Posiz9i, Posiz10i - Posiz9i), ",", "."))
sActU = Trim(Replace(Mid(Text2, Posiz11, Posiz12 - Posiz11), ",", "."))
sActO = Trim(Replace(Mid(Text2, Posiz14, Posiz15 - Posiz14), ",", "."))


Cells(i, nColonnaInizio + 98).Value = sAct1
Cells(i, nColonnaInizio + 130).Value = sini1
Cells(i, nColonnaInizio + 99).Value = sActX
Cells(i, nColonnaInizio + 131).Value = siniX
Cells(i, nColonnaInizio + 100).Value = sAct2
Cells(i, nColonnaInizio + 132).Value = sini2
Cells(i, nColonnaInizio + 101).Value = sActU
Cells(i, nColonnaInizio + 102).Value = sActO

'nRigaTabella = nRigaTabella + 1
       
'Loop

Linea1:

Posiz1 = 1

Next i

End Sub
Sub Quote_willhill_h()


Dim url1 As String
Dim Text2 As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim sControllo1 As String
Dim sPartenza As String
Dim sPartenza1 As String
Dim sLen1 As String
Dim Posiz1 As Long
Dim Posiz2 As Long
Dim Posiz3 As Long
Dim Posiz4 As Long
Dim Posiz5 As Long
Dim Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer


Application.ScreenUpdating = False

Sheets("DATI").Select

Range("CT3:CX1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=3100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text2 = http1.responseText

'book_bet365_h.jpg

    sPartenza = "www.betonews.com/img/book_willhill_h.jpg"
    sControllo1 = "Quote Aggiornate>"
    sLen1 = Len(sControllo1)
    sControllo2 = "</span></td>"
    
   On Error Resume Next
sElimina = Mid(Text2, 1, (InStr(1, Text2, sPartenza)) - 1)

On Error Resume Next

Text2 = Replace(Text2, sElimina, "")
 
Text2 = Replace(Text2, Chr(34), "")
Text2 = Replace(Text2, "<span class=tbl_green_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_red_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_white_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_black_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_blue_txt", "Quote Aggiornate")
Text2 = Replace(Text2, ">Quote Aggiornate>&nbsp;", "Quote Aggiornate>0.00 ")
 
   
    ' verifico che la stinga contenga i dati richiesti
      
    If InStr(1, Text2, sPartenza) = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            Cells(i, nColonnaInizio + 101).Value = "-"
            Cells(i, nColonnaInizio + 102).Value = "-"
        'MsgBox "la stringa non |fffd| presente nel file txt"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If


        nRigaInizio = i
        nColonnaInizio = 0

    Posiz1 = 1
    
   ' Do
           
    Posiz1 = InStr(Posiz1, Text2, sPartenza)
    
            If Posiz1 = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
            
        End If
            
            
        Posiz1 = InStr(Posiz1, Text2, sControllo1) + sLen1
        Posiz2 = InStr(Posiz1, Text2, sControllo2)
        Posiz3i = InStr(Posiz2, Text2, sControllo1) + sLen1
        Posiz4i = InStr(Posiz3i, Text2, sControllo2)
        Posiz3 = InStr(Posiz2, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz4 = InStr(Posiz3, Text2, sControllo1) + sLen1
        Posiz5 = InStr(Posiz4, Text2, sControllo2)
        Posiz6i = InStr(Posiz5, Text2, sControllo1) + sLen1
        Posiz7i = InStr(Posiz6i, Text2, sControllo2)
        Posiz6 = InStr(Posiz5, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz7 = InStr(Posiz6, Text2, sControllo1) + sLen1
        Posiz8 = InStr(Posiz7, Text2, sControllo2)
        Posiz9i = InStr(Posiz8, Text2, sControllo1) + sLen1
        Posiz10i = InStr(Posiz9i, Text2, sControllo2)
        Posiz9 = InStr(Posiz8, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz10 = InStr(Posiz9, Text2, sPartenza)
        
        Posiz11 = InStr(Posiz10, Text2, sControllo1) + sLen1
        Posiz12 = InStr(Posiz11, Text2, sControllo2)
        
        Posiz13 = InStr(Posiz12, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz14 = InStr(Posiz13, Text2, sControllo1) + sLen1
        Posiz15 = InStr(Posiz14, Text2, sControllo2)
        
              
sAct1 = Trim(Replace(Mid(Text2, Posiz1, Posiz2 - Posiz1), ",", "."))
sini1 = Trim(Replace(Mid(Text2, Posiz3i, Posiz4i - Posiz3i), ",", "."))
sActX = Trim(Replace(Mid(Text2, Posiz4, Posiz5 - Posiz4), ",", "."))
siniX = Trim(Replace(Mid(Text2, Posiz6i, Posiz7i - Posiz6i), ",", "."))
sAct2 = Trim(Replace(Mid(Text2, Posiz7, Posiz8 - Posiz7), ",", "."))
sini2 = Trim(Replace(Mid(Text2, Posiz9i, Posiz10i - Posiz9i), ",", "."))
sActU = Trim(Replace(Mid(Text2, Posiz11, Posiz12 - Posiz11), ",", "."))
sActO = Trim(Replace(Mid(Text2, Posiz14, Posiz15 - Posiz14), ",", "."))


Cells(i, nColonnaInizio + 98).Value = sAct1
Cells(i, nColonnaInizio + 130).Value = sini1
Cells(i, nColonnaInizio + 99).Value = sActX
Cells(i, nColonnaInizio + 131).Value = siniX
Cells(i, nColonnaInizio + 100).Value = sAct2
Cells(i, nColonnaInizio + 132).Value = sini2
Cells(i, nColonnaInizio + 101).Value = sActU
Cells(i, nColonnaInizio + 102).Value = sActO

'nRigaTabella = nRigaTabella + 1
       
'Loop

Linea1:

Posiz1 = 1

Next i

End Sub

Sub iniziali()


Dim url1 As String
Dim Text2 As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim sControllo1 As String
Dim sPartenza As String
Dim sPartenza1 As String
Dim sLen1 As String
Dim Posiz1 As Long
Dim Posiz2 As Long
Dim Posiz3 As Long
Dim Posiz4 As Long
Dim Posiz5 As Long
Dim Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer


Application.ScreenUpdating = False

Sheets("DATI").Select

Range("CT3:CX1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=3100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text2 = http1.responseText

'book_bet365_h.jpg

    sPartenza = "www.betonews.com/img/book_willhill_h.jpg"
    sControllo1 = "Quote Aggiornate>"
    sLen1 = Len(sControllo1)
    sControllo2 = "</span></td>"
    
   On Error Resume Next
sElimina = Mid(Text2, 1, (InStr(1, Text2, sPartenza)) - 1)

On Error Resume Next

Text2 = Replace(Text2, sElimina, "")
 
Text2 = Replace(Text2, Chr(34), "")
Text2 = Replace(Text2, "<span class=tbl_green_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_red_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_white_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_black_txt", "Quote Aggiornate")
Text2 = Replace(Text2, "<span class=tbl_blue_txt", "Quote Aggiornate")
Text2 = Replace(Text2, ">Quote Aggiornate>&nbsp;", "Quote Aggiornate>0.00 ")
 
   
    ' verifico che la stinga contenga i dati richiesti
      
    If InStr(1, Text2, sPartenza) = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            Cells(i, nColonnaInizio + 101).Value = "-"
            Cells(i, nColonnaInizio + 102).Value = "-"
        'MsgBox "la stringa non |fffd| presente nel file txt"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If


        nRigaInizio = i
        nColonnaInizio = 0

    Posiz1 = 1
    
   ' Do
           
    Posiz1 = InStr(Posiz1, Text2, sPartenza)
    
            If Posiz1 = 0 Then
            Cells(i, nColonnaInizio + 98).Value = "-"
            Cells(i, nColonnaInizio + 99).Value = "-"
            Cells(i, nColonnaInizio + 100).Value = "-"
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
            
        End If
            
            
        Posiz1 = InStr(Posiz1, Text2, sControllo1) + sLen1
        Posiz2 = InStr(Posiz1, Text2, sControllo2)
        
        Posiz3 = InStr(Posiz2, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz4 = InStr(Posiz3, Text2, sControllo1) + sLen1
        Posiz5 = InStr(Posiz4, Text2, sControllo2)
        
        Posiz6 = InStr(Posiz5, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz7 = InStr(Posiz6, Text2, sControllo1) + sLen1
        Posiz8 = InStr(Posiz7, Text2, sControllo2)
        
        Posiz9 = InStr(Posiz8, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz10 = InStr(Posiz9, Text2, sPartenza)
        
        Posiz11 = InStr(Posiz10, Text2, sControllo1) + sLen1
        Posiz12 = InStr(Posiz11, Text2, sControllo2)
        
        Posiz13 = InStr(Posiz12, Text2, sControllo1) + sLen1 + 1 'salto
        
        Posiz14 = InStr(Posiz13, Text2, sControllo1) + sLen1
        Posiz15 = InStr(Posiz14, Text2, sControllo2)
        
              
sAct1 = Trim(Replace(Mid(Text2, Posiz1, Posiz2 - Posiz1), ",", "."))
sActX = Trim(Replace(Mid(Text2, Posiz4, Posiz5 - Posiz4), ",", "."))
sAct2 = Trim(Replace(Mid(Text2, Posiz7, Posiz8 - Posiz7), ",", "."))

sActU = Trim(Replace(Mid(Text2, Posiz11, Posiz12 - Posiz11), ",", "."))
sActO = Trim(Replace(Mid(Text2, Posiz14, Posiz15 - Posiz14), ",", "."))


Cells(i, nColonnaInizio + 98).Value = sAct1
Cells(i, nColonnaInizio + 99).Value = sActX
Cells(i, nColonnaInizio + 100).Value = sAct2
Cells(i, nColonnaInizio + 101).Value = sActU
Cells(i, nColonnaInizio + 102).Value = sActO

'nRigaTabella = nRigaTabella + 1
       
'Loop

Linea1:

Posiz1 = 1

Next i

End Sub


Attribute VB_Name = "Risultati"
Sub Risultati_Finali()

Dim url1 As String
Dim Text2 As String
Dim sText3 As String
Dim sText4 As String
Dim sResult  As String
Dim sDate As String
Dim sStage, sStage1, stagemenu As String
Dim date1, text1a As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim Text2a As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Sheets("DATI").Select

'Range("CC3:CE1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

fine = Foglio2.Range("H65536").End(xlUp).Row
inizio = Foglio2.Range("CC65536").End(xlUp).Row


For i = inizio To fine

If Range("H" & i).Value = "" Then
GoTo Linea1
End If

url1 = "http://www.betonews.com/popup.asp?tp=1100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "Orario"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
    sControllo2 = "Squadra1"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "Squadra2"
    sLen3 = Len(sControllo3)
    
    sControllo4 = ">FT"
    sLen4 = Len(sControllo4)
    
    sControllo5 = "Risultato"
    sLen5 = Len(sControllo5)
    
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, Chr(35), "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Orario")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=right nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra1")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra2")
   'Text1 = Replace(Text1, "<td bgcolor=cecf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
  
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>", "Risultato")
  
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Stringa non presente ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 81
        
    Posiz1 = 1
    
    Do
            
     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        Posiz5 = InStr(Posiz4, Text1, sControllo2) + sLen2
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        Posiz7 = InStr(Posiz6, Text1, sControllo3) + sLen3
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
       
       
        Posiz9 = InStr(Posiz8, Text1, sControllo4)
     
        If Posiz9 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz10 = InStr(Posiz9, Text1, sControllo5) + sLen5
        Posiz11 = InStr(Posiz10, Text1, sControllo1)
        
        Posiz12 = InStr(Posiz11, Text1, sControllo5) + sLen5
        Posiz13 = InStr(Posiz12, Text1, sControllo1)
        
        Posiz14 = InStr(Posiz13, Text1, sControllo5) + sLen5
        Posiz15 = InStr(Posiz14, Text1, sControllo1)
        
        
'sOra = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sComp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
'sHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'sAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

sRis1 = Trim(Mid(Text1, Posiz10, Posiz11 - Posiz10))
sRis = Trim(Mid(Text1, Posiz12, Posiz13 - Posiz12))
sRis2 = Trim(Mid(Text1, Posiz14, Posiz15 - Posiz14))
 

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sOra
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sComp
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway

Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sRis1
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sRis
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sRis2

'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz15 + 1

'If nRigaTabella > nMaxRigheImport Then
           ' MsgBox " troppe righe (>" + Str$(nMaxRigheImport) + ") interrompo elaborazione"
           ' Exit Do
      '  End If
Loop
    
Text1 = ""

Linea1:

Next i


 Application.ScreenUpdating = True
  Set http1 = Nothing
  Set Text1 = Nothing
  
  Text1 = ""
Range("A1").Select

End Sub

Sub Risultati_Finali_prono()

Dim url1 As String
Dim Text2 As String
Dim sText3 As String
Dim sText4 As String
Dim sResult  As String
Dim sDate As String
Dim sStage, sStage1, stagemenu As String
Dim date1, text1a As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim Text2a As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Sheets("DATI").Select

Range("cc3:ch1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

fine = Foglio2.Range("H65536").End(xlUp).Row
inizio = Foglio2.Range("CC65536").End(xlUp).Row


For i = inizio To fine

If Range("H" & i).Value = "" Then
GoTo Linea1
End If

url1 = "http://www.betonews.com/popup.asp?tp=1100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "Orario"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
    sControllo2 = "Squadra1"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "Squadra2"
    sLen3 = Len(sControllo3)
    
    sControllo4 = ">FT"
    sLen4 = Len(sControllo4)
    
    sControllo5 = "Risultato"
    sLen5 = Len(sControllo5)
    
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, Chr(35), "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Orario")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=right nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra1")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra2")
   'Text1 = Replace(Text1, "<td bgcolor=cecf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
  
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>", "Risultato")
  
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Stringa non presente ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 81
        
    Posiz1 = 1
    
    Do
            
     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        Posiz5 = InStr(Posiz4, Text1, sControllo2) + sLen2
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        Posiz7 = InStr(Posiz6, Text1, sControllo3) + sLen3
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
       
       
        Posiz9 = InStr(Posiz8, Text1, sControllo4)
     
        If Posiz9 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz10 = InStr(Posiz9, Text1, sControllo5) + sLen5
        Posiz11 = InStr(Posiz10, Text1, sControllo1)
        
        Posiz12 = InStr(Posiz11, Text1, sControllo5) + sLen5
        Posiz13 = InStr(Posiz12, Text1, sControllo1)
        
        Posiz14 = InStr(Posiz13, Text1, sControllo5) + sLen5
        Posiz15 = InStr(Posiz14, Text1, sControllo1)
        
        
'sOra = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sComp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
'sHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'sAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

sRis1 = Trim(Mid(Text1, Posiz10, Posiz11 - Posiz10))
sRis = Trim(Mid(Text1, Posiz12, Posiz13 - Posiz12))
sRis2 = Trim(Mid(Text1, Posiz14, Posiz15 - Posiz14))
 

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sOra
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sComp
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway

Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sRis1
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sRis
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sRis2

'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz15 + 1

'If nRigaTabella > nMaxRigheImport Then
           ' MsgBox " troppe righe (>" + Str$(nMaxRigheImport) + ") interrompo elaborazione"
           ' Exit Do
      '  End If
Loop
    
Text1 = ""

Linea1:

Next i


 Application.ScreenUpdating = True
  Set http1 = Nothing
  Set Text1 = Nothing
  
  Text1 = ""
  Sheets("Prono").Select

Range("A1").Select

End Sub




Sub Risultati_livescore()

Dim url1 As String
Dim Text1 As String
Dim http1 As Object
Dim sControllo1 As String, sControllo2 As String, sControllo3 As String, sControllo_ID As String
Dim sLen1 As String, sLen2 As String, sLen3 As String, sLenID As String
Dim Posiz1 As Long, Posiz2 As Long, Posiz3 As Long, Posiz4 As Long, Posiz5 As Long
Dim Posiz6 As Long, Posiz7 As Long, Posiz8 As Long, Posiz9 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer
'Dim IRange As Range

Application.ScreenUpdating = False

Sheets("KalosG").Select

Range("CC3:CH1000").ClearContents
      
Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "http://www.betonews.com/table.asp?tp=1001&lang=en&dd=" & Range("A1") & "&dm=" & Range("B1") & "&dy=" & Range("C1") & "&df=" & Range("D1") & "&dw=1"


Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo1 = "nowrap>"
    sLen1 = Len(sControllo1)
     
    sControllo2 = "</td>"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "popup.asp?tp=1050&lang=en&idm="
    sLen3 = Len(sControllo3)
      
    sControllo_ID = "http://www.betonews.com/img/SportId1.gif"
    sLenID = Len(sControllo_ID)
    
  Text1 = Replace(Text1, Chr(34), "")
  'Text1 = Replace(Text1, "nowrap>-</td>", "nowrap>99-99</td>")
    
' verifico che la stinga contenga i dati richiesti
    
    
    If InStr(1, Text1, sControllo_ID) = 0 Then
        MsgBox "la stringa non |fffd| presente nel file txt"
        Exit Sub
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

   
        
        
    Posiz1 = 1
        
 Do
                
        If InStr(Posiz1, Text1, sControllo_ID) = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Do
        End If
        
        'crea l'array
        'Dim arraysquadre(3 To 1000, 1 To 10) As Variant
        
        Posiz1 = InStr(Posiz1, Text1, sControllo_ID) - 100
        
        Posiz2 = InStr(Posiz1, Text1, sControllo1) + sLen1
        
        Posiz3 = InStr(Posiz2, Text1, sControllo1) + sLen1
        Posiz4 = InStr(Posiz3, Text1, sControllo2)
        
        
        Posiz5 = InStr(Posiz4, Text1, sControllo1) + sLen1
        Posiz6 = InStr(Posiz5, Text1, sControllo2)
        
        Posiz7 = InStr(Posiz6, Text1, sControllo1) + sLen1
        Posiz8 = InStr(Posiz7, Text1, sControllo2)
        
        Posiz9 = InStr(Posiz8, Text1, sControllo1) + sLen1 ' salto
        
        Posiz10 = InStr(Posiz9, Text1, sControllo1) + sLen1 ' salto
        
        Posiz11 = InStr(Posiz10, Text1, sControllo1) + sLen1
        Posiz12 = InStr(Posiz11, Text1, sControllo2)
        
        Posiz13 = InStr(Posiz12, Text1, sControllo1) + sLen1
        Posiz14 = InStr(Posiz13, Text1, sControllo2)
        
        Posiz15 = InStr(Posiz14, Text1, sControllo3) + sLen3
      

'ExchangeName = Split(Split(Text1, "script>showDate(", , vbTextCompare)(1), ")</script>")(0)

kk = Foglio2.Range("CY65536").End(xlUp).Row
 
'sGiorno = Replace(Mid(Text1, Posiz2, 2), "<", "")
'sMese = Replace(Mid(Text1, Posiz2 + 3, 2), "<", "")
'sAnno = Replace(Mid(Text1, Posiz2 + 6, 2), "<", "")
'sOra = Replace(Mid(Text1, Posiz2 + 9, 5), "<", "")

Comp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))

For k = 3 To kk

        nRigaInizio = k
        nColonnaInizio = 81
        
If Comp = Range("CY" & k).Value Then

'SquadraHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'SquadraAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

sFT = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sHT = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))


'Dim sRisultato As String
'Dim sFTPrimo As Single
'Dim sFTSecondo As Single
'Dim sHTPrimo As Single
'Dim sHTSecondo As Single


If sFT = "-" And sHT = "-" Then
GoTo Salta
End If

'==================================================

If sFT <> "-" And sHT = "-" Then

divideFT = Split(sFT, "-")
    
    'On Error Resume Next
    
    sFTPrimo = (divideFT(0))
    sFTSecondo = (divideFT(1))
    
Cells(nRigaInizio, nColonnaInizio + 0) = sFTPrimo
Cells(nRigaInizio, nColonnaInizio + 1) = "-"
Cells(nRigaInizio, nColonnaInizio + 2) = sFTSecondo

sHT = " - "

divideHT = Split(sHT, "-")
    
    'On Error Resume Next
    
    sHTPrimo = (divideHT(0))
    sHTSecondo = (divideHT(1))

Cells(nRigaInizio, nColonnaInizio + 3) = sHTPrimo
Cells(nRigaInizio, nColonnaInizio + 4) = "-"
Cells(nRigaInizio, nColonnaInizio + 5) = sHTSecondo

End If

'===========================================



'sID = Mid(Text1, Posiz15, 7)

'On Error Resume Next



'arraysquadre(nRigaInizio , nColonnaInizio + 0) = sGiorno
'arraysquadre(nRigaInizio , nColonnaInizio + 1) = sMese
'arraysquadre(nRigaInizio , nColonnaInizio + 2) = sAnno
'arraysquadre(nRigaInizio , nColonnaInizio + 3) = sOra

'arraysquadre(nRigaInizio , nColonnaInizio + 4) = Comp
'arraysquadre(nRigaInizio , nColonnaInizio + 5) = SquadraHome
'arraysquadre(nRigaInizio , nColonnaInizio + 6) = SquadraAway
'arraysquadre(nRigaInizio , nColonnaInizio + 7) = sID

'Cells(nRigaInizio , nColonnaInizio + 0) = sFTPrimo
'Cells(nRigaInizio , nColonnaInizio + 1) = "-"
'Cells(nRigaInizio , nColonnaInizio + 2) = sFTSecondo

'Cells(nRigaInizio , nColonnaInizio + 3) = sHTPrimo
'Cells(nRigaInizio , nColonnaInizio + 4) = "-"
'Cells(nRigaInizio , nColonnaInizio + 5) = sHTSecondo

'nRigaTabella = nRigaTabella + 1

Else
GoTo Salta:
End If
Salta:

Next k

Linea3:

Posiz1 = Posiz14 + 1

Loop

'scrive l'array sul foglio
'Set IRange = Range(Cells(3, 1), Cells(1000, 10))
'    IRange = arraysquadre

'Call DATI_SQUADRA1

Application.CutCopyMode = False
Range("A1").Select
    
End Sub


Sub BETO_livescore()

Dim url1 As String
Dim Text1 As String
Dim http1 As Object
Dim sControllo1 As String, sControllo2 As String, sControllo3 As String, sControllo_ID As String
Dim sLen1 As String, sLen2 As String, sLen3 As String, sLenID As String
Dim Posiz1 As Long, Posiz2 As Long, Posiz3 As Long, Posiz4 As Long, Posiz5 As Long
Dim Posiz6 As Long, Posiz7 As Long, Posiz8 As Long, Posiz9 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer
'Dim IRange As Range
Dim sFT As String, sHT As String

Application.ScreenUpdating = False

Sheets("KalosG").Select

Range("CC3:CH1000").ClearContents

'q = Foglio2.Range("A65536").End(xlUp).Row + 1

    'Range("A3:I" & q).ClearContents
   
    'Range("A1").Select
    
Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "http://www.betonews.com/table.asp?tp=1001&lang=en&dd=" & Range("KalosG!A1") & "&dm=" & Range("KalosG!B1") & "&dy=" & Range("KalosG!C1") & "&df=" & Range("KalosG!D1") & "&dw=1"


Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo1 = "nowrap>"
    sLen1 = Len(sControllo1)
     
    sControllo2 = "</td>"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "popup.asp?tp=1050&lang=en&idm="
    sLen3 = Len(sControllo3)
      
    sControllo_ID = "http://www.betonews.com/img/SportId1.gif"
    sLenID = Len(sControllo_ID)
    
  Text1 = Replace(Text1, Chr(34), "")
    
' verifico che la stinga contenga i dati richiesti
    
    
    If InStr(1, Text1, sControllo_ID) = 0 Then
        MsgBox "la stringa non |fffd| presente nel file txt"
        Exit Sub
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

   
        nRigaInizio = 3
        nColonnaInizio = 81
        
    Posiz1 = 1
        
 Do
                
        If InStr(Posiz1, Text1, sControllo_ID) = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Do
        End If
        
        'crea l'array
        'Dim arraysquadre(3 To 1000, 1 To 13) As Variant
        
        Posiz1 = InStr(Posiz1, Text1, sControllo_ID) - 100
        
        Posiz2 = InStr(Posiz1, Text1, sControllo1) + sLen1
        
        Posiz3 = InStr(Posiz2, Text1, sControllo1) + sLen1
        Posiz4 = InStr(Posiz3, Text1, sControllo2)
        
        
        Posiz5 = InStr(Posiz4, Text1, sControllo1) + sLen1
        Posiz6 = InStr(Posiz5, Text1, sControllo2)
        
        Posiz7 = InStr(Posiz6, Text1, sControllo1) + sLen1
        Posiz8 = InStr(Posiz7, Text1, sControllo2)
        
        Posiz9 = InStr(Posiz8, Text1, sControllo1) + sLen1 ' salto
        
        Posiz10 = InStr(Posiz9, Text1, sControllo1) + sLen1 ' salto
        
        Posiz11 = InStr(Posiz10, Text1, sControllo1) + sLen1
        Posiz12 = InStr(Posiz11, Text1, sControllo2)
        
        Posiz13 = InStr(Posiz12, Text1, sControllo1) + sLen1
        Posiz14 = InStr(Posiz13, Text1, sControllo2)

'ExchangeName = Split(Split(Text1, "script>showDate(", , vbTextCompare)(1), ")</script>")(0)


kk = Foglio2.Range("CY65536").End(xlUp).Row

   
sGiorno = Replace(Mid(Text1, Posiz2, 2), "<", "")
sMese = Replace(Mid(Text1, Posiz2 + 3, 2), "<", "")
sAnno = Replace(Mid(Text1, Posiz2 + 6, 2), "<", "")
sOra = Replace(Mid(Text1, Posiz2 + 9, 5), "<", "")

Comp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))

'sID = Mid(Text1, Posiz15, 7)

SquadraHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
SquadraAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

sFT = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sHT = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))

divideFT = Split(sFT, "-")
    
    
    sFTPrimo = (divideFT(0))
    sFTSecondo = (divideFT(1))
    

divideHT = Split(sHT, "-")
    
    
    sHTPrimo = (divideHT(0))
    sHTSecondo = (divideHT(1))


For k = 3 To kk

If Comp = Range("KalosG!CY" & k).Value Then

'arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 0) = sGiorno
'arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 1) = sMese
'arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 2) = sAnno
'arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 3) = sOra

'arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 4) = Comp
'arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 5) = SquadraHome
'arraysquadre(nRigaInizio + nRigaTabella, nColonnaInizio + 6) = SquadraAway
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0) = sFTPrimo
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1) = "-"
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2) = sFTSecondo
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3) = sHTPrimo
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 4) = "-"
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 5) = sHTSecondo


nRigaTabella = nRigaTabella + 1

Else
GoTo Salta:
End If
Salta:

Next k

Linea3:

Posiz1 = Posiz14 + 1

Loop

'scrive l'array sul foglio
'Set IRange = Range(Cells(3, 1), Cells(1000, 13))
 '   IRange = arraysquadre

Application.CutCopyMode = False
Range("A1").Select
    
End Sub
Sub Risultati_Finali_pronounificati()

Dim url1 As String
Dim Text2 As String
Dim sText3 As String
Dim sText4 As String
Dim sResult  As String
Dim sDate As String
Dim sStage, sStage1, stagemenu As String
Dim date1, text1a As String
Dim http1 As Object
Dim start1, start2, start3 As Long
Dim length1, len1, nValue As Long
Dim Text2a As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Sheets("DATI").Select

'Range("CC3:CE1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

fine = Foglio2.Range("H65536").End(xlUp).Row
inizio = Foglio2.Range("CC65536").End(xlUp).Row


For i = inizio To fine

If Range("H" & i).Value = "" Then
GoTo Linea1
End If

url1 = "http://www.betonews.com/popup.asp?tp=1100&lang=en&idm=" & Range("H" & i) & ""

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "Orario"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
    sControllo2 = "Squadra1"
    sLen2 = Len(sControllo2)
    
    sControllo3 = "Squadra2"
    sLen3 = Len(sControllo3)
    
    sControllo4 = ">FT"
    sLen4 = Len(sControllo4)
    
    sControllo5 = "Risultato"
    sLen5 = Len(sControllo5)
    
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   Text1 = Replace(Text1, Chr(35), "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Orario")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=right nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra1")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 nowrap style=padding: 2px 5px><span class=tbl_black_txt>", "Squadra2")
   'Text1 = Replace(Text1, "<td bgcolor=cecf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
  
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>&nbsp;</span></td>", "")
   Text1 = Replace(Text1, "<td bgcolor=ececf2 align=center style=padding: 2px 5px><span class=tbl_black_txt>", "Risultato")
  
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Stringa non presente ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 81
        
    Posiz1 = 1
    
    Do
            
     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        Posiz5 = InStr(Posiz4, Text1, sControllo2) + sLen2
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        Posiz7 = InStr(Posiz6, Text1, sControllo3) + sLen3
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
       
       
        Posiz9 = InStr(Posiz8, Text1, sControllo4)
     
        If Posiz9 = 0 Then
            'MsgBox "non ci solo altri dati"
            GoTo Linea1
        End If
        
        Posiz10 = InStr(Posiz9, Text1, sControllo5) + sLen5
        Posiz11 = InStr(Posiz10, Text1, sControllo1)
        
        Posiz12 = InStr(Posiz11, Text1, sControllo5) + sLen5
        Posiz13 = InStr(Posiz12, Text1, sControllo1)
        
        Posiz14 = InStr(Posiz13, Text1, sControllo5) + sLen5
        Posiz15 = InStr(Posiz14, Text1, sControllo1)
        
        
'sOra = Trim(Mid(Text1, Posiz1, Posiz2 - Posiz1))
'sComp = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
'sHome = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
'sAway = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

sRis1 = Trim(Mid(Text1, Posiz10, Posiz11 - Posiz10))
sRis = Trim(Mid(Text1, Posiz12, Posiz13 - Posiz12))
sRis2 = Trim(Mid(Text1, Posiz14, Posiz15 - Posiz14))
 

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio).Value = sOra
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sComp
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sAway

Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sRis1
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sRis
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sRis2

'nRigaTabella = nRigaTabella + 1

Posiz1 = Posiz15 + 1

'If nRigaTabella > nMaxRigheImport Then
           ' MsgBox " troppe righe (>" + Str$(nMaxRigheImport) + ") interrompo elaborazione"
           ' Exit Do
      '  End If
Loop
    
Text1 = ""

Linea1:

Next i


 Application.ScreenUpdating = True
  Set http1 = Nothing
  Set Text1 = Nothing
  
  Text1 = ""
  Sheets("Prono unificati").Select

Range("A1").Select

End Sub
Attribute VB_Name = "Squadra_2_code_old"
Sub DATI_SQUADRA2()

Dim url1 As String
Dim Text1 As String
Dim http1 As Object
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim sSquadra1 As String
Dim Posiz1 As Long, Posiz2 As Long, Posiz3 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

Sheets("DATI").Select

Range("AQ3:AQ1000").ClearContents
Range("AR3:AR1000").ClearContents
Range("AS3:AS1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"
      
f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f


url1 = "http://www.betonews.com/popup.asp?tp=7100&lang=en&idm=" & Range("H" & i) & ""

'http://www.betonews.com/popup.asp?tp=2110&lang=en&idm=466228


Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Text1 = http1.responseText

 nRigaInizio = i
 nColonnaInizio = 44
    
    sStanding = "Standing"
    sSquadra2 = Range("G" & i).Value
       
    sControllo1 = "popup.asp?lang=en&tp=9011&idt="
    sLen1 = Len(sControllo1)
    
    sControllo2 = "&tqt="
   
    sControllo3 = "_txt>"
    sLen3 = Len(sControllo3)
    
    sControllo4 = "</a>"
   
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   'Text1 = Replace(Text1, "</a> </span></td>", "</a></span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sStanding) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(nRigaInizio, nColonnaInizio).Value = "-"
        Cells(nRigaInizio, nColonnaInizio + 1).Value = "-"
        Cells(i, nColonnaInizio - 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

On Error Resume Next

        Posiz1 = InStr(1, Text1, sSquadra2) + 5
        Posiz2 = InStr(Posiz1, Text1, sSquadra2)
        Posiz3 = InStr(Posiz2, Text1, sControllo1) + sLen1
        Posiz4 = InStr(Posiz3, Text1, sControllo2)
       
        Posiz5 = InStr(Posiz4, Text1, sControllo3) + sLen3
        Posiz6 = InStr(Posiz5, Text1, sControllo4)
        
        Posiz7 = InStr(Posiz2 - 125, Text1, sControllo3) + sLen3
        
        sID = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3)) * 1
        sGiocate = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5)) * 1
        
        sPosizione = Trim(Mid(Text1, Posiz7, 2)) * 1
        
        
' ------------------------------------------------



Cells(nRigaInizio, nColonnaInizio).Value = sID
Cells(nRigaInizio, nColonnaInizio + 1).Value = sGiocate
Cells(i, nColonnaInizio - 1).Value = sPosizione

Application.ScreenUpdating = True
  Set http1 = Nothing
  'Set Text1 = Nothing
 
Salta:

Next i

    Application.CutCopyMode = False
    
    Range("A1").Select
    
 
 
'DATI_SQUADRA2

' -----------------------------------

'Call FORMA_TEAM_1_HOME

'Call FORMA_TEAM_1_AWAY

'Call FORMA_TEAM_2_HOME

'Call FORMA_TEAM_2_AWAY

' -----------------------------------

'Call FORMA_TEAM_1_HOME_U6

'Call FORMA_TEAM_1_AWAY_U6

''Call FORMA_TEAM_2_HOME_U6

'Call FORMA_TEAM_2_AWAY_U6

'----------------------------------

'Call DATI_DWL_TOTALE_HOME_6
'Call DATI_DWL_TOTALE_AWAY_6


Application.ScreenUpdating = False
   
Sheets("DATI").Select

Range("A1").Select

'http://www.betonews.com/popup.asp?lang=en&tp=9011&idt=463&tqt=12&tqw=1&tqc=-1&tqy=0

Linea1:

End Sub


Attribute VB_Name = "Storico"
Sub archivio()

Application.ScreenUpdating = False
 
  Dim Anno As Long
  Dim Mese As Byte, Gior As Byte
  Dim sOra As Integer, sMin As Integer
  Dim sDate_Time As Date, sDate_Time_a As Date
   
w = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To w
   
Mese = Range("B" & i).Value
Gior = Range("A" & i).Value
Anno = Range("C" & i).Value
sOra = Range("D" & i).Value
'sMin = Range("D" & i).Value
' -------------------------------------------------

  
  sDate_Time = DateSerial(Anno, Mese, Gior) + Range("D" & i).Value 'TimeSerial(sOra, sMin, 0)
  
  'sDate_Time_a = DateSerial(Anno, Gior, Mese)
  
  'Range("G4").Value = sDate_Time
  
  'Cells(3, 104).Value = sDate_Time

  If sDate_Time > Now Then
    'MsgBox "data maggiore"
    
    Call FORMA_TEAM_1a
    Call FORMA_TEAM_2a
    
    Else
    
    Call FORMA_TEAM_1b
    Call FORMA_TEAM_2b
    
    'GoTo Linea1
    
  End If
  
  Next i
  
End Sub

Attribute VB_Name = "Team1_Team2_new"
Sub FORMA_TEAM_1_NEW()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("BX3:BY1000").ClearContents

Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText

sLast1 = "Last 12 Matches"
sLenLast1 = Len(sLast1)
sLast2 = "Last 6 Matches"
sLenLast2 = Len(sLast2)

    sControllo0 = "nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)

   Text1 = Replace(Text1, Chr(34), "")

   sUscita = "</table></td>"
    
' verifico che la stinga contenga i dati richiesti
    
    sInizio = InStr(1, Text1, sLast1)
    sFine = InStr(1, Text1, sLast2) + sLenLast2
    
    Text1 = Mid(Text1, sInizio, sFine - sInizio)
       
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 76
        
    Posiz1 = 1
    
sGf = 0
sGs = 0

'Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Sub
        End If
        
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              

    If InStr(Posiz8, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

sHome = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sAway = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
sRisultato = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

'Dim sRisultato As String
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
        'trova home
        Posiz11 = InStr(Posiz10, Text1, sControllo0) + sLen0
        Posiz12 = InStr(Posiz11, Text1, sControllo1)
        'trova Away
        Posiz13 = InStr(Posiz12, Text1, sControllo0) + sLen0
        Posiz14 = InStr(Posiz13, Text1, sControllo1)
        'trova risultato
        Posiz15 = InStr(Posiz14, Text1, sControllo0) + sLen0
        Posiz16 = InStr(Posiz15, Text1, sControllo1)
        
     
    If InStr(Posiz16, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
    
sHome = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sAway = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))
sRisultato = Trim(Mid(Text1, Posiz15, Posiz16 - Posiz15))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz17 = InStr(Posiz16, Text1, sControllo0) + sLen0
        Posiz18 = InStr(Posiz17, Text1, sControllo1)
        'trova home
        Posiz19 = InStr(Posiz18, Text1, sControllo0) + sLen0
        Posiz20 = InStr(Posiz19, Text1, sControllo1)
        'trova Away
        Posiz21 = InStr(Posiz20, Text1, sControllo0) + sLen0
        Posiz22 = InStr(Posiz21, Text1, sControllo1)
        'trova risultato
        Posiz23 = InStr(Posiz22, Text1, sControllo0) + sLen0
        Posiz24 = InStr(Posiz23, Text1, sControllo1)
        
      
    If InStr(Posiz24, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
    
sHome = Trim(Mid(Text1, Posiz19, Posiz20 - Posiz19))
sAway = Trim(Mid(Text1, Posiz21, Posiz22 - Posiz21))
sRisultato = Trim(Mid(Text1, Posiz23, Posiz24 - Posiz23))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

' ======================================================================

        'trova data
        Posiz25 = InStr(Posiz24, Text1, sControllo0) + sLen0
        Posiz26 = InStr(Posiz25, Text1, sControllo1)
        'trova home
        Posiz27 = InStr(Posiz26, Text1, sControllo0) + sLen0
        Posiz28 = InStr(Posiz27, Text1, sControllo1)
        'trova Away
        Posiz29 = InStr(Posiz28, Text1, sControllo0) + sLen0
        Posiz30 = InStr(Posiz29, Text1, sControllo1)
        'trova risultato
        Posiz31 = InStr(Posiz30, Text1, sControllo0) + sLen0
        Posiz32 = InStr(Posiz31, Text1, sControllo1)
       
    If InStr(Posiz32, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
      
sHome = Trim(Mid(Text1, Posiz27, Posiz28 - Posiz27))
sAway = Trim(Mid(Text1, Posiz29, Posiz30 - Posiz29))
sRisultato = Trim(Mid(Text1, Posiz31, Posiz32 - Posiz31))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

' ======================================================================

        'trova data
        Posiz33 = InStr(Posiz32, Text1, sControllo0) + sLen0
        Posiz34 = InStr(Posiz33, Text1, sControllo1)
        'trova home
        Posiz35 = InStr(Posiz34, Text1, sControllo0) + sLen0
        Posiz36 = InStr(Posiz35, Text1, sControllo1)
        'trova Away
        Posiz37 = InStr(Posiz36, Text1, sControllo0) + sLen0
        Posiz38 = InStr(Posiz37, Text1, sControllo1)
        'trova risultato
        Posiz39 = InStr(Posiz38, Text1, sControllo0) + sLen0
        Posiz40 = InStr(Posiz39, Text1, sControllo1)
        
    If InStr(Posiz40, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
    
sHome = Trim(Mid(Text1, Posiz35, Posiz36 - Posiz35))
sAway = Trim(Mid(Text1, Posiz37, Posiz38 - Posiz37))
sRisultato = Trim(Mid(Text1, Posiz39, Posiz40 - Posiz39))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo
Cells(i, nColonnaInizio + 0).Value = sGf
Cells(i, nColonnaInizio + 1).Value = sGs

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz8 + 1

'Loop

Salta:

Next i

Linea1:
   
'Sheets("INDEX").Select

Call FORMA_TEAM_2_NEW

Range("A1").Select

End Sub



Sub FORMA_TEAM_2_NEW()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("BZ3:CAB1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText

sLast1 = "Last 12 Matches"
sLenLast1 = Len(sLast1)
sLast2 = "Last 6 Matches"
sLenLast2 = Len(sLast2)

    sControllo0 = "nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)

   Text1 = Replace(Text1, Chr(34), "")

   sUscita = "</table></td>"
    
' verifico che la stinga contenga i dati richiesti
    
    sInizio = InStr(1, Text1, sLast1) + 200
    sFine = InStr(1, Text1, sLast2) + sLenLast2
       
    Text1 = Mid(Text1, sInizio, sFine - sInizio)
    
    sInizio1 = InStr(1, Text1, sUscita)
    sFine1 = InStr(1, Text1, sLast2) + sLenLast2
    
    Text1 = Mid(Text1, sInizio1, sFine1 - sInizio1)
   
   
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 78
        
    Posiz1 = 1
    
sGf = 0
sGs = 0

'Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Sub
        End If
        
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              

    If InStr(Posiz8, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

sHome = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sAway = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
sRisultato = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

'Dim sRisultato As String
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sAway = Range("G" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sAway <> Range("G" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
        'trova home
        Posiz11 = InStr(Posiz10, Text1, sControllo0) + sLen0
        Posiz12 = InStr(Posiz11, Text1, sControllo1)
        'trova Away
        Posiz13 = InStr(Posiz12, Text1, sControllo0) + sLen0
        Posiz14 = InStr(Posiz13, Text1, sControllo1)
        'trova risultato
        Posiz15 = InStr(Posiz14, Text1, sControllo0) + sLen0
        Posiz16 = InStr(Posiz15, Text1, sControllo1)
        
     
    If InStr(Posiz16, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
    
sHome = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sAway = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))
sRisultato = Trim(Mid(Text1, Posiz15, Posiz16 - Posiz15))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sAway = Range("G" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sAway <> Range("G" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz17 = InStr(Posiz16, Text1, sControllo0) + sLen0
        Posiz18 = InStr(Posiz17, Text1, sControllo1)
        'trova home
        Posiz19 = InStr(Posiz18, Text1, sControllo0) + sLen0
        Posiz20 = InStr(Posiz19, Text1, sControllo1)
        'trova Away
        Posiz21 = InStr(Posiz20, Text1, sControllo0) + sLen0
        Posiz22 = InStr(Posiz21, Text1, sControllo1)
        'trova risultato
        Posiz23 = InStr(Posiz22, Text1, sControllo0) + sLen0
        Posiz24 = InStr(Posiz23, Text1, sControllo1)
        
      
    If InStr(Posiz24, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
    
sHome = Trim(Mid(Text1, Posiz19, Posiz20 - Posiz19))
sAway = Trim(Mid(Text1, Posiz21, Posiz22 - Posiz21))
sRisultato = Trim(Mid(Text1, Posiz23, Posiz24 - Posiz23))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sAway = Range("G" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sAway <> Range("G" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

' ======================================================================

        'trova data
        Posiz25 = InStr(Posiz24, Text1, sControllo0) + sLen0
        Posiz26 = InStr(Posiz25, Text1, sControllo1)
        'trova home
        Posiz27 = InStr(Posiz26, Text1, sControllo0) + sLen0
        Posiz28 = InStr(Posiz27, Text1, sControllo1)
        'trova Away
        Posiz29 = InStr(Posiz28, Text1, sControllo0) + sLen0
        Posiz30 = InStr(Posiz29, Text1, sControllo1)
        'trova risultato
        Posiz31 = InStr(Posiz30, Text1, sControllo0) + sLen0
        Posiz32 = InStr(Posiz31, Text1, sControllo1)
       
    If InStr(Posiz32, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
      
sHome = Trim(Mid(Text1, Posiz27, Posiz28 - Posiz27))
sAway = Trim(Mid(Text1, Posiz29, Posiz30 - Posiz29))
sRisultato = Trim(Mid(Text1, Posiz31, Posiz32 - Posiz31))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sAway = Range("G" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sAway <> Range("G" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

' ======================================================================

        'trova data
        Posiz33 = InStr(Posiz32, Text1, sControllo0) + sLen0
        Posiz34 = InStr(Posiz33, Text1, sControllo1)
        'trova home
        Posiz35 = InStr(Posiz34, Text1, sControllo0) + sLen0
        Posiz36 = InStr(Posiz35, Text1, sControllo1)
        'trova Away
        Posiz37 = InStr(Posiz36, Text1, sControllo0) + sLen0
        Posiz38 = InStr(Posiz37, Text1, sControllo1)
        'trova risultato
        Posiz39 = InStr(Posiz38, Text1, sControllo0) + sLen0
        Posiz40 = InStr(Posiz39, Text1, sControllo1)
        
    If InStr(Posiz40, Text1, sUscita) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        Cells(i, nColonnaInizio + 0).Value = "-"
        Cells(i, nColonnaInizio + 1).Value = "-"
        GoTo Salta
    Else
        'MsgBox "La stringa |fffd| presente"
    End If
    
sHome = Trim(Mid(Text1, Posiz35, Posiz36 - Posiz35))
sAway = Trim(Mid(Text1, Posiz37, Posiz38 - Posiz37))
sRisultato = Trim(Mid(Text1, Posiz39, Posiz40 - Posiz39))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sAway = Range("G" & i).Value Then
sGf = sGf + sPrimo
Else
sGf = sGf + sSecondo
End If

If sAway <> Range("G" & i).Value Then
sGs = sGs + sPrimo
Else
sGs = sGs + sSecondo
End If

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo
Cells(i, nColonnaInizio + 0).Value = sGs
Cells(i, nColonnaInizio + 1).Value = sGf

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz8 + 1

'Loop

Salta:

Next i

Linea1:
   
'Sheets("INDEX").Select

Range("A1").Select

End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Totale_Away_5"
Sub FORMA_TEAM_2a()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("CA3:CB1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "<td bgcolor=#ececf2 align=center style=padding: 2px 5px nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)

   Text1 = Replace(Text1, Chr(34), "")

   sControllo2 = "<td align=center style=padding: 5px 5px bgcolor=#ececf2><strong> &nbsp; </strong></td>"
    
' verifico che la stinga contenga i dati richiesti
    
    Elimina1 = InStr(Posiz1, Text1, sControllo2)
   
    Elimina2 = Mid(Text1, 1, Elimina1 - 1)
   
   Text1 = Replace(Text1, Elimina2, "")
   
   
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 79
        
    Posiz1 = 1
    
sGf = 0
sGs = 0

'Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Sub
        End If
        
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              


sHome = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sAway = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
sRisultato = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

'Dim sRisultato As String
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
        'trova home
        Posiz11 = InStr(Posiz10, Text1, sControllo0) + sLen0
        Posiz12 = InStr(Posiz11, Text1, sControllo1)
        'trova Away
        Posiz13 = InStr(Posiz12, Text1, sControllo0) + sLen0
        Posiz14 = InStr(Posiz13, Text1, sControllo1)
        'trova risultato
        Posiz15 = InStr(Posiz14, Text1, sControllo0) + sLen0
        Posiz16 = InStr(Posiz15, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sAway = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))
sRisultato = Trim(Mid(Text1, Posiz15, Posiz16 - Posiz15))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz17 = InStr(Posiz16, Text1, sControllo0) + sLen0
        Posiz18 = InStr(Posiz17, Text1, sControllo1)
        'trova home
        Posiz19 = InStr(Posiz18, Text1, sControllo0) + sLen0
        Posiz20 = InStr(Posiz19, Text1, sControllo1)
        'trova Away
        Posiz21 = InStr(Posiz20, Text1, sControllo0) + sLen0
        Posiz22 = InStr(Posiz21, Text1, sControllo1)
        'trova risultato
        Posiz23 = InStr(Posiz22, Text1, sControllo0) + sLen0
        Posiz24 = InStr(Posiz23, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz19, Posiz20 - Posiz19))
sAway = Trim(Mid(Text1, Posiz21, Posiz22 - Posiz21))
sRisultato = Trim(Mid(Text1, Posiz23, Posiz24 - Posiz23))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz25 = InStr(Posiz24, Text1, sControllo0) + sLen0
        Posiz26 = InStr(Posiz25, Text1, sControllo1)
        'trova home
        Posiz27 = InStr(Posiz26, Text1, sControllo0) + sLen0
        Posiz28 = InStr(Posiz27, Text1, sControllo1)
        'trova Away
        Posiz29 = InStr(Posiz28, Text1, sControllo0) + sLen0
        Posiz30 = InStr(Posiz29, Text1, sControllo1)
        'trova risultato
        Posiz31 = InStr(Posiz30, Text1, sControllo0) + sLen0
        Posiz32 = InStr(Posiz31, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz27, Posiz28 - Posiz27))
sAway = Trim(Mid(Text1, Posiz29, Posiz30 - Posiz29))
sRisultato = Trim(Mid(Text1, Posiz31, Posiz32 - Posiz31))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz33 = InStr(Posiz32, Text1, sControllo0) + sLen0
        Posiz34 = InStr(Posiz33, Text1, sControllo1)
        'trova home
        Posiz35 = InStr(Posiz34, Text1, sControllo0) + sLen0
        Posiz36 = InStr(Posiz35, Text1, sControllo1)
        'trova Away
        Posiz37 = InStr(Posiz36, Text1, sControllo0) + sLen0
        Posiz38 = InStr(Posiz37, Text1, sControllo1)
        'trova risultato
        Posiz39 = InStr(Posiz38, Text1, sControllo0) + sLen0
        Posiz40 = InStr(Posiz39, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz35, Posiz36 - Posiz35))
sAway = Trim(Mid(Text1, Posiz37, Posiz38 - Posiz37))
sRisultato = Trim(Mid(Text1, Posiz39, Posiz40 - Posiz39))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If


'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sGf
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sGs

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz8 + 1

'Loop

Next i

Linea1:
   
'Sheets("INDEX").Select

Range("A1").Select

End Sub


Sub FORMA_TEAM_2b()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("CA3:CB1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "<td bgcolor=#ececf2 align=center style=padding: 2px 5px nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)

   Text1 = Replace(Text1, Chr(34), "")

   sControllo2 = "<td align=center style=padding: 5px 5px bgcolor=#ececf2><strong> &nbsp; </strong></td>"
    
' verifico che la stinga contenga i dati richiesti
    
    Elimina1 = InStr(Posiz1, Text1, sControllo2)
   
    Elimina2 = Mid(Text1, 1, Elimina1 - 1)
   
   Text1 = Replace(Text1, Elimina2, "")
   
   
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 79
        
    Posiz1 = 1
    
sGf = 0
sGs = 0

'Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Sub
        End If
        
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              

' ======================================================================

        'trova data
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
        'trova home
        Posiz11 = InStr(Posiz10, Text1, sControllo0) + sLen0
        Posiz12 = InStr(Posiz11, Text1, sControllo1)
        'trova Away
        Posiz13 = InStr(Posiz12, Text1, sControllo0) + sLen0
        Posiz14 = InStr(Posiz13, Text1, sControllo1)
        'trova risultato
        Posiz15 = InStr(Posiz14, Text1, sControllo0) + sLen0
        Posiz16 = InStr(Posiz15, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sAway = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))
sRisultato = Trim(Mid(Text1, Posiz15, Posiz16 - Posiz15))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz17 = InStr(Posiz16, Text1, sControllo0) + sLen0
        Posiz18 = InStr(Posiz17, Text1, sControllo1)
        'trova home
        Posiz19 = InStr(Posiz18, Text1, sControllo0) + sLen0
        Posiz20 = InStr(Posiz19, Text1, sControllo1)
        'trova Away
        Posiz21 = InStr(Posiz20, Text1, sControllo0) + sLen0
        Posiz22 = InStr(Posiz21, Text1, sControllo1)
        'trova risultato
        Posiz23 = InStr(Posiz22, Text1, sControllo0) + sLen0
        Posiz24 = InStr(Posiz23, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz19, Posiz20 - Posiz19))
sAway = Trim(Mid(Text1, Posiz21, Posiz22 - Posiz21))
sRisultato = Trim(Mid(Text1, Posiz23, Posiz24 - Posiz23))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz25 = InStr(Posiz24, Text1, sControllo0) + sLen0
        Posiz26 = InStr(Posiz25, Text1, sControllo1)
        'trova home
        Posiz27 = InStr(Posiz26, Text1, sControllo0) + sLen0
        Posiz28 = InStr(Posiz27, Text1, sControllo1)
        'trova Away
        Posiz29 = InStr(Posiz28, Text1, sControllo0) + sLen0
        Posiz30 = InStr(Posiz29, Text1, sControllo1)
        'trova risultato
        Posiz31 = InStr(Posiz30, Text1, sControllo0) + sLen0
        Posiz32 = InStr(Posiz31, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz27, Posiz28 - Posiz27))
sAway = Trim(Mid(Text1, Posiz29, Posiz30 - Posiz29))
sRisultato = Trim(Mid(Text1, Posiz31, Posiz32 - Posiz31))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz33 = InStr(Posiz32, Text1, sControllo0) + sLen0
        Posiz34 = InStr(Posiz33, Text1, sControllo1)
        'trova home
        Posiz35 = InStr(Posiz34, Text1, sControllo0) + sLen0
        Posiz36 = InStr(Posiz35, Text1, sControllo1)
        'trova Away
        Posiz37 = InStr(Posiz36, Text1, sControllo0) + sLen0
        Posiz38 = InStr(Posiz37, Text1, sControllo1)
        'trova risultato
        Posiz39 = InStr(Posiz38, Text1, sControllo0) + sLen0
        Posiz40 = InStr(Posiz39, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz35, Posiz36 - Posiz35))
sAway = Trim(Mid(Text1, Posiz37, Posiz38 - Posiz37))
sRisultato = Trim(Mid(Text1, Posiz39, Posiz40 - Posiz39))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If

' ======================================================================

        'trova data
        Posiz41 = InStr(Posiz40, Text1, sControllo0) + sLen0
        Posiz42 = InStr(Posiz41, Text1, sControllo1)
        'trova home
        Posiz43 = InStr(Posiz42, Text1, sControllo0) + sLen0
        Posiz44 = InStr(Posiz43, Text1, sControllo1)
        'trova Away
        Posiz45 = InStr(Posiz44, Text1, sControllo0) + sLen0
        Posiz46 = InStr(Posiz45, Text1, sControllo1)
        'trova risultato
        Posiz47 = InStr(Posiz46, Text1, sControllo0) + sLen0
        Posiz48 = InStr(Posiz47, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz43, Posiz44 - Posiz43))
sAway = Trim(Mid(Text1, Posiz45, Posiz46 - Posiz45))
sRisultato = Trim(Mid(Text1, Posiz47, Posiz48 - Posiz47))

divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("G" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("G" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("G" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("G" & i).Value Then
sGs = sGs + sSecondo
End If

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sGf
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sGs

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz8 + 1

'Loop

Next i

Linea1:
   
'Sheets("INDEX").Select

Range("A1").Select

End Sub

Attribute VB_Name = "Totale_Home_5"
Sub FORMA_TEAM_1a()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("BX3:BY1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "<td bgcolor=#ececf2 align=center style=padding: 2px 5px nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
   
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 76
        
    Posiz1 = 1
    
sGf = 0
sGs = 0

'Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Sub
        End If
        
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              


sHome = Trim(Mid(Text1, Posiz3, Posiz4 - Posiz3))
sAway = Trim(Mid(Text1, Posiz5, Posiz6 - Posiz5))
sRisultato = Trim(Mid(Text1, Posiz7, Posiz8 - Posiz7))

'Dim sRisultato As String
Dim sPrimo As Single
Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
        'trova home
        Posiz11 = InStr(Posiz10, Text1, sControllo0) + sLen0
        Posiz12 = InStr(Posiz11, Text1, sControllo1)
        'trova Away
        Posiz13 = InStr(Posiz12, Text1, sControllo0) + sLen0
        Posiz14 = InStr(Posiz13, Text1, sControllo1)
        'trova risultato
        Posiz15 = InStr(Posiz14, Text1, sControllo0) + sLen0
        Posiz16 = InStr(Posiz15, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sAway = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))
sRisultato = Trim(Mid(Text1, Posiz15, Posiz16 - Posiz15))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz17 = InStr(Posiz16, Text1, sControllo0) + sLen0
        Posiz18 = InStr(Posiz17, Text1, sControllo1)
        'trova home
        Posiz19 = InStr(Posiz18, Text1, sControllo0) + sLen0
        Posiz20 = InStr(Posiz19, Text1, sControllo1)
        'trova Away
        Posiz21 = InStr(Posiz20, Text1, sControllo0) + sLen0
        Posiz22 = InStr(Posiz21, Text1, sControllo1)
        'trova risultato
        Posiz23 = InStr(Posiz22, Text1, sControllo0) + sLen0
        Posiz24 = InStr(Posiz23, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz19, Posiz20 - Posiz19))
sAway = Trim(Mid(Text1, Posiz21, Posiz22 - Posiz21))
sRisultato = Trim(Mid(Text1, Posiz23, Posiz24 - Posiz23))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz25 = InStr(Posiz24, Text1, sControllo0) + sLen0
        Posiz26 = InStr(Posiz25, Text1, sControllo1)
        'trova home
        Posiz27 = InStr(Posiz26, Text1, sControllo0) + sLen0
        Posiz28 = InStr(Posiz27, Text1, sControllo1)
        'trova Away
        Posiz29 = InStr(Posiz28, Text1, sControllo0) + sLen0
        Posiz30 = InStr(Posiz29, Text1, sControllo1)
        'trova risultato
        Posiz31 = InStr(Posiz30, Text1, sControllo0) + sLen0
        Posiz32 = InStr(Posiz31, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz27, Posiz28 - Posiz27))
sAway = Trim(Mid(Text1, Posiz29, Posiz30 - Posiz29))
sRisultato = Trim(Mid(Text1, Posiz31, Posiz32 - Posiz31))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz33 = InStr(Posiz32, Text1, sControllo0) + sLen0
        Posiz34 = InStr(Posiz33, Text1, sControllo1)
        'trova home
        Posiz35 = InStr(Posiz34, Text1, sControllo0) + sLen0
        Posiz36 = InStr(Posiz35, Text1, sControllo1)
        'trova Away
        Posiz37 = InStr(Posiz36, Text1, sControllo0) + sLen0
        Posiz38 = InStr(Posiz37, Text1, sControllo1)
        'trova risultato
        Posiz39 = InStr(Posiz38, Text1, sControllo0) + sLen0
        Posiz40 = InStr(Posiz39, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz35, Posiz36 - Posiz35))
sAway = Trim(Mid(Text1, Posiz37, Posiz38 - Posiz37))
sRisultato = Trim(Mid(Text1, Posiz39, Posiz40 - Posiz39))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If


'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sGf
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sGs

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz8 + 1

'Loop

Next i

Linea1:
   
'Sheets("INDEX").Select

Range("A1").Select

End Sub

Sub FORMA_TEAM_1b()

Dim url1 As String

Dim http1 As Object
Dim Text1 As String
Dim sControllo1, sControllo2, sControllo3, sControllo4, sControllo5, sControllo6 As String
Dim sLen1, sLen2, sLen3, sLen4, sLen5, sLen6 As String
Dim Squadra1, Squadra2 As String
Dim Open1, OpenX, Open2 As String
Dim Posiz1, Posiz2, Posiz3, Posiz4, Posiz5, Posiz6 As Long
Dim nRigaInizio As Integer
Dim nColonnaInizio As Integer
Dim nRigaTabella As Integer

Application.ScreenUpdating = False

'Sheets("INDEX").Select

Range("BX3:BY1000").ClearContents

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"


f = Foglio2.Range("H65536").End(xlUp).Row

For i = 3 To f

url1 = "http://www.betonews.com/popup.asp?tp=1050&lang=en&idm=" & Range("H" & i) & ""

On Error Resume Next 'GoTo Linea1

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "GET", url1, False
http1.send
Text1 = http1.responseText


    sControllo0 = "<td bgcolor=#ececf2 align=center style=padding: 2px 5px nowrap><span class=tbl_black_txt>"
    sLen0 = Len(sControllo0)
    
    sControllo1 = "</span></td>"
    sLen1 = Len(sControllo1)
    
   
    
' verifico che la stinga contenga i dati richiesti
    
   Text1 = Replace(Text1, Chr(34), "")
   'Text1 = Replace(Text1, "<span class=tbl_black_txt>- </span></td>", "<span class=tbl_black_txt>0-0 </span></td>")
   'Text1 = Replace(Text1, "&tq", "      ")
       
    If InStr(1, Text1, sControllo0) = 0 Then
        'MsgBox "Squadra non presente  ...!!"
        GoTo Linea1
    Else
        'MsgBox "La stringa |fffd| presente"
    End If

' imposto il numero massimo di righe da importare
    'nMaxRigheImport = 300
    'nMaxRigheImport = InputBox("Limite Righe da importare", ActiveSheet.Name, nMaxRigheImport)
    
        nRigaInizio = i
        nColonnaInizio = 76
        
    Posiz1 = 1
    
sGf = 0
sGs = 0

'Do

'-------------------------------------------------------------

     Posiz1 = InStr(Posiz1, Text1, sControllo0)
     
        If Posiz1 = 0 Then
            'MsgBox "non ci solo altri dati"
            Exit Sub
        End If
        
        'trova data
        Posiz1 = InStr(Posiz1, Text1, sControllo0) + sLen0
        Posiz2 = InStr(Posiz1, Text1, sControllo1)
        'trova home
        Posiz3 = InStr(Posiz2, Text1, sControllo0) + sLen0
        Posiz4 = InStr(Posiz3, Text1, sControllo1)
        'trova Away
        Posiz5 = InStr(Posiz4, Text1, sControllo0) + sLen0
        Posiz6 = InStr(Posiz5, Text1, sControllo1)
        'trova risultato
        Posiz7 = InStr(Posiz6, Text1, sControllo0) + sLen0
        Posiz8 = InStr(Posiz7, Text1, sControllo1)
              


' ======================================================================

        'trova data
        Posiz9 = InStr(Posiz8, Text1, sControllo0) + sLen0
        Posiz10 = InStr(Posiz9, Text1, sControllo1)
        'trova home
        Posiz11 = InStr(Posiz10, Text1, sControllo0) + sLen0
        Posiz12 = InStr(Posiz11, Text1, sControllo1)
        'trova Away
        Posiz13 = InStr(Posiz12, Text1, sControllo0) + sLen0
        Posiz14 = InStr(Posiz13, Text1, sControllo1)
        'trova risultato
        Posiz15 = InStr(Posiz14, Text1, sControllo0) + sLen0
        Posiz16 = InStr(Posiz15, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz11, Posiz12 - Posiz11))
sAway = Trim(Mid(Text1, Posiz13, Posiz14 - Posiz13))
sRisultato = Trim(Mid(Text1, Posiz15, Posiz16 - Posiz15))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz17 = InStr(Posiz16, Text1, sControllo0) + sLen0
        Posiz18 = InStr(Posiz17, Text1, sControllo1)
        'trova home
        Posiz19 = InStr(Posiz18, Text1, sControllo0) + sLen0
        Posiz20 = InStr(Posiz19, Text1, sControllo1)
        'trova Away
        Posiz21 = InStr(Posiz20, Text1, sControllo0) + sLen0
        Posiz22 = InStr(Posiz21, Text1, sControllo1)
        'trova risultato
        Posiz23 = InStr(Posiz22, Text1, sControllo0) + sLen0
        Posiz24 = InStr(Posiz23, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz19, Posiz20 - Posiz19))
sAway = Trim(Mid(Text1, Posiz21, Posiz22 - Posiz21))
sRisultato = Trim(Mid(Text1, Posiz23, Posiz24 - Posiz23))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If



' ======================================================================

        'trova data
        Posiz25 = InStr(Posiz24, Text1, sControllo0) + sLen0
        Posiz26 = InStr(Posiz25, Text1, sControllo1)
        'trova home
        Posiz27 = InStr(Posiz26, Text1, sControllo0) + sLen0
        Posiz28 = InStr(Posiz27, Text1, sControllo1)
        'trova Away
        Posiz29 = InStr(Posiz28, Text1, sControllo0) + sLen0
        Posiz30 = InStr(Posiz29, Text1, sControllo1)
        'trova risultato
        Posiz31 = InStr(Posiz30, Text1, sControllo0) + sLen0
        Posiz32 = InStr(Posiz31, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz27, Posiz28 - Posiz27))
sAway = Trim(Mid(Text1, Posiz29, Posiz30 - Posiz29))
sRisultato = Trim(Mid(Text1, Posiz31, Posiz32 - Posiz31))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz33 = InStr(Posiz32, Text1, sControllo0) + sLen0
        Posiz34 = InStr(Posiz33, Text1, sControllo1)
        'trova home
        Posiz35 = InStr(Posiz34, Text1, sControllo0) + sLen0
        Posiz36 = InStr(Posiz35, Text1, sControllo1)
        'trova Away
        Posiz37 = InStr(Posiz36, Text1, sControllo0) + sLen0
        Posiz38 = InStr(Posiz37, Text1, sControllo1)
        'trova risultato
        Posiz39 = InStr(Posiz38, Text1, sControllo0) + sLen0
        Posiz40 = InStr(Posiz39, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz35, Posiz36 - Posiz35))
sAway = Trim(Mid(Text1, Posiz37, Posiz38 - Posiz37))
sRisultato = Trim(Mid(Text1, Posiz39, Posiz40 - Posiz39))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If


' ======================================================================

        'trova data
        Posiz41 = InStr(Posiz40, Text1, sControllo0) + sLen0
        Posiz42 = InStr(Posiz41, Text1, sControllo1)
        'trova home
        Posiz43 = InStr(Posiz42, Text1, sControllo0) + sLen0
        Posiz44 = InStr(Posiz43, Text1, sControllo1)
        'trova Away
        Posiz45 = InStr(Posiz44, Text1, sControllo0) + sLen0
        Posiz46 = InStr(Posiz45, Text1, sControllo1)
        'trova risultato
        Posiz47 = InStr(Posiz46, Text1, sControllo0) + sLen0
        Posiz48 = InStr(Posiz47, Text1, sControllo1)
        
      
sHome = Trim(Mid(Text1, Posiz43, Posiz44 - Posiz43))
sAway = Trim(Mid(Text1, Posiz45, Posiz46 - Posiz45))
sRisultato = Trim(Mid(Text1, Posiz47, Posiz48 - Posiz47))

'Dim sRisultato As String
'Dim sPrimo As Single
'Dim sSecondo As Single


    divide = Split(sRisultato, "-")
    
    'On Error Resume Next
    
    sPrimo = (divide(0))
    sSecondo = (divide(1))


If sHome = Range("F" & i).Value Then
sGf = sGf + sPrimo
End If

If sHome <> Range("F" & i).Value Then
sGf = sGf + sSecondo
End If


If sHome <> Range("F" & i).Value Then
sGs = sGs + sPrimo
End If

If sHome = Range("F" & i).Value Then
sGs = sGs + sSecondo
End If

'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sHome
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sAway
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 2).Value = sPrimo
'Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 3).Value = sSecondo
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 0).Value = sGf
Cells(nRigaInizio + nRigaTabella, nColonnaInizio + 1).Value = sGs

'nColonnaInizio = nColonnaInizio + 3
'nRigaTabella = nRigaTabella + 1

'Posiz1 = Posiz8 + 1

'Loop

Next i

Linea1:
   
'Sheets("INDEX").Select

Range("A1").Select

End Sub



INQUEST-PP=macro
