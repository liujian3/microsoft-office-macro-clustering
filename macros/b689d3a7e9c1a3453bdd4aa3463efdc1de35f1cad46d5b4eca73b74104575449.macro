Attribute VB_Name = "DieseArbeitsmappe"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Form_Abfrage_GK"
Attribute VB_Base = "0{B88BE091-A122-9B43-A3FC-C18D6B8024F8}{5EA3BAC0-1211-5846-AC77-918076290B31}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub Label1_Click()

End Sub

Private Sub CheckBox1_Click()

End Sub

Private Sub CommandButton1_Click()

End Sub

Private Sub button_ok_Click()

End Sub

Private Sub button_Abfrage_GK_Click()
    'Call Abfrage_GK
    Form_Abfrage_GK.Hide
End Sub

Private Sub Gemeinkostenpauschale_Click()

End Sub

Private Sub MK_Click()

End Sub

Private Sub ok_Click()

End Sub

Private Sub PK_Click()

End Sub

Private Sub UserForm_Click()

End Sub
Attribute VB_Name = "Modul1"
Sub Stammdaten_1() 'Button (4)
  
'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Stammdaten_1"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

'Abfrage Berechtigung
    wert = InputBox("Bitte Kennwort eingeben", "Berechtigung", , 5500, 6700)
  
    sll = BIN(wert)

    If sll = "0100101101101001011001010110110000110000001101000011001100110001" Then


'Makro-Logfile
        Sheets("Stammdaten").Unprotect "WTSHEA"
        Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
        Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


'Kontrolle, dass das Makro nur einmal ausgef|fffd|hrt wird
'(auch nicht |fffd|ber das Kontextmenu von Excel ein zweites Mal
        Sheets("Stammdaten").Select
        If (Range("AH2") = "nein" And Range("AH3") = "nein" And Range("AH4") = "nein") Then
  
            If Range("Q7") = "nein" Then
        'Schaltfl|fffd|che Fehler
                Fehler1 = "* (WTSH-)Antragsnummer ist nicht ausgef|fffd|llt"
                Fehler2 = "* (WTSH-)Antragsnummer ist nicht plausibel. Die Kennung ist keinem Programm zugeordnet."
                Fehler3 = "* ProNord-Nummer ist nicht ausgef|fffd|llt"
                Fehler4 = "* ProNord-Nummer ist nicht plausibel"
                Fehler5 = "* Datum ZWB ist nicht ausgef|fffd|llt"
                Fehler6 = "* Datum ZWB ist kein korrektes Datumsformat"
                Fehler7 = "* Die Angaben zum Zuwendungsempf|fffd|nger fehlen"
                Fehler8 = "* Der Projekttitel ist nicht angegeben"
                Fehler9 = "* Datum zum Bewilligungsbeginn ist nicht ausgef|fffd|llt"
                Fehler10 = "* Datum zum Bewilligungsbeginn ist kein korrektes Datumsformat"
                Fehler11 = "* Datum zum Bewilligungsende ist nicht ausgef|fffd|llt"
                Fehler12 = "* Datum zum Bewilligungsende ist kein korrektes Datumsformat"
                Fehler13 = "**** Das Handlungsfeld der ProNord-Nummer stimmt nicht zur WTSH-Antragsnummer"
                Fehler14 = "**** Die ProNord-Nummer endet nicht mit einer Ziffer"
                Fehler15 = "**** Die abschliessende Ziffer der ProNord-Nummer ist nicht plausibel"
                Fehler16 = "**** Die Schreibweise der ProNord-Nummer ist fehlerhaft (Syntax)"
                Fehler17 = "* Bewilligunganfang liegt nach Bewilligungsende"
                Fehler18 = "* Datum zur Vorlage des Nachweis zur Publizit|fffd|tsverpflichtung ist nicht ausgef|fffd|llt"
                Fehler19 = "* Datum zur Vorlage des Nachweis zur Publizit|fffd|tsverpflichtung ist kein korrektes Datumsformat"
                Fehler20 = "* Datum zur Vorlage des Nachweis zur Publizit|fffd|tsverpflichtung liegt nicht innerhalb eines plausiblen Zeitraums"
     
                Fehlermeldung = ""
                If Range("R7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler1
                End If
                If Range("S7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler2
                End If
                If Range("T7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler3
                End If
                If Range("U7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler4
                End If
                If Range("U9") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler13
                End If
                If Range("V9") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler14
                End If
                If Range("W9") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler15
                End If
                If Range("X9") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler16
                End If
                If Range("V7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler5
                End If
                If Range("W7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler6
                End If
                If Range("x7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler7
                End If
                If Range("Y7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler8
                End If
                If Range("Z7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler9
                End If
                If Range("AA7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler10
                End If
                If Range("AB7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler11
                End If
                If Range("AC7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler12
                End If
                If Range("AD7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler17
                End If
                If Range("AE7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler18
                End If
                If Range("AF7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler19
                End If
                If Range("AG7") = "n" Then
                    Fehlermeldung = Fehlermeldung & Chr(10) & Fehler20
                End If
        
                MsgBox "Achtung die Eingabe der Daten" & Chr(10) & _
                        "ist fehlerbehaftet oder unvollst|fffd|ndig" & Chr(10) & Chr(10) & _
                        "Bitte die Eingaben |fffd|berpr|fffd|fen!" & Chr(10) & Fehlermeldung, vbExclamation
 
            Else
    
                ActiveSheet.Unprotect "WTSHEA"
                ActiveWorkbook.Unprotect "WTSHEA"

            'Reihen mit Ausgabenarten einblenden
                Rows("22:42").Select
                Selection.EntireRow.Hidden = False
    
            'Block mit signifikaten Ausgabenarten (je nach Programm) nach vorne kopieren
                Select Case Range("O3")
                
                    Case Is = Range("Q20") 'Ausgabenarten FIT
                        Range("P22:R42").Select
                        Selection.Copy
                        Range("B22").Select
                        ActiveSheet.Paste
                    Case Is = Range("U20") 'Ausgabenarten BFEI
                        Range("T22:V42").Select
                        Selection.Copy
                        Range("B22").Select
                        ActiveSheet.Paste
                    Case Is = Range("Y20") 'Ausgabenarten POI
                        Range("X22:Z42").Select
                        Selection.Copy
                        Range("B22").Select
                        ActiveSheet.Paste
                    Case Is = Range("AC20") 'Ausgabenarten EUI
                        Range("AB22:AD42").Select
                        Selection.Copy
                        Range("B22").Select
                        ActiveSheet.Paste
                    Case Is = Range("AG20") 'Ausgabenarten TSD
                        Range("AF22:AH42").Select
                        Selection.Copy
                        Range("B22").Select
                        ActiveSheet.Paste
                    Case Is = Range("AK20") 'Ausgabenarten INT
                        Range("AJ22:AL42").Select
                        Selection.Copy
                        Range("B22").Select
                        ActiveSheet.Paste
                        
                  End Select
    
            'Stammdaten1 sch|fffd|tzen
    
            'Farbe Sand
                Range("D3").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("F3").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("H3").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("D5:H5").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("D7:H7").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("D10").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("F10").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("H10").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

            ' Ehemalige Eingabefelder sch|fffd|tzen
                Range("D3").Select
                Selection.Locked = True
                Selection.FormulaHidden = False

                Range("F3").Select
                Selection.Locked = True
                Selection.FormulaHidden = False

                Range("H3").Select
                Selection.Locked = True
                Selection.FormulaHidden = False

                Range("D5:H5").Select
                Selection.Locked = True
                Selection.FormulaHidden = False

                Range("D7:H7").Select
                Selection.Locked = True
                Selection.FormulaHidden = False
    
                Range("D10").Select
                Selection.Locked = True
                Selection.FormulaHidden = False
        
                Range("F10").Select
                Selection.Locked = True
                Selection.FormulaHidden = False
    
                Range("H10").Select
                Selection.Locked = True
                Selection.FormulaHidden = False


            'Tabellenblatt Versionierung
                Sheets("Versionierung").Visible = False
    
        
            'Button Stammdaten_1 ausbenden, Button Stammdaten2 einblenden
                ActiveSheet.Shapes("Button 4").Visible = False
                ActiveSheet.Shapes("Button 7").Visible = True
    
                Range("AH2") = "ja"
                ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                ActiveWorkbook.Protect "WTSHEA"

            End If
    
        Else

    'Makro war bereits aufgerufen
            MsgBox "Achtung! Das Makro wurde" & Chr(10) & _
                    "bereits einmal ausgef|fffd|hrt." & Chr(10) & Chr(10) & _
                    "Die wiederholte Ausf|fffd|hrung kann zu Fehlern" & Chr(10) & _
                    "f|fffd|hren und wurde daher unterbunden.", vbExclamation
        End If
   
    Else

   'Passworteingabe war falsch
        MsgBox "Achtung! Das Kennwort ist nicht korrekt." & Chr(10) & _
                "Die Stammdaten wurden nicht gespeichert." & Chr(10) & Chr(10) & _
                "Bitte das Makro erneut starten und" & Chr(10) & _
                "korrektes Kennwort eingeben", vbExclamation
   
    End If 'Beendet die Berechtigungsabfrage

End Sub

Attribute VB_Name = "Modul10"
Sub Korrektur_Projektstatus() 'Button (10)

'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Korrektur Projektstatus"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


'Abfrage

    If MsgBox("Wollen Sie Ihre Eingabe zum Projektstatus korrigieren?", vbQuestion + vbYesNo, "Korrektur Projektstatus") = vbYes Then

    'Makro-Logfile
        Sheets("Stammdaten").Unprotect "WTSHEA"
        Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
        Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


        Sheets("Stammdaten").Select
        ActiveSheet.Unprotect "WTSHEA"
   
        Alter_Status = Range("H15")
        Neuer_Status = InputBox("Bitte geben Sie den aktuellen Projektstatus ein.", "Korrektur Projektstatus", , 5500, 6700)
        Range("AD18") = Neuer_Status
   
        Range("AE18").Select
        Selection.Copy
        Range("H15").Select
        Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
            False, Transpose:=False

      
        If Range("V18") = "n" Then
            MsgBox "Ihre Statuseingabe entspricht keinen g|fffd|ltigen Zahlenformat" & Chr(10) & Chr(10) & _
                    "Ihre Korrektur wurde nicht angenommen", vbExclamation
      
            Range("H15") = Alter_Status
        End If
        If (Range("W18") = "n" And Range("V18") <> "n") Then
            MsgBox "Ihre Statuseingabe ist nicht plausibel. Der Wert muss zwischen 0 - 100 liegen." & Chr(10) & Chr(10) & _
                    "Ihre Korrektur wurde nicht angenommen", vbExclamation
            Range("H15") = Alter_Status
        End If
  
    'Cursorposition
        Range("F19").Select

        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
   
    End If

End Sub

Attribute VB_Name = "Modul11"

Sub TimeOut(Duration)

    StartTimer = Timer
    Do While Timer - StartTimer < Duration
        X = DoEvents()
    Loop
    
End Sub

Attribute VB_Name = "Modul12"
Function BIN(PW)

    TW = ""
    For i = 1 To Len(PW)
        Dec = Asc(Mid(PW, i, 1))
   
        For a = 7 To 0 Step -1
            Bit = Int(Dec / 2 ^ a)
            Dec = Dec - Bit * 2 ^ a
            TW = TW & CStr(Bit)
        Next a
    Next i

    BIN = TW

End Function
Attribute VB_Name = "Modul13"
Sub Instanz_Testprojekt()

' Erstellt am 15.02.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen eines Test-Projekts in den Stammdaten zum Testen der Makros
Sheets("Stammdaten").Range("D3") = "123 16 001"
Sheets("Stammdaten").Range("F3") = "LPW-E/1.1.1/1"
Sheets("Stammdaten").Range("H3") = #1/1/2016#
Sheets("Stammdaten").Range("D5") = "Forschungs- und Entwicklungszentrum f|fffd|r Kompetenzbildung und -sicherung"
Sheets("Stammdaten").Range("D7") = "Kompetenzzentrum Kompetenzerweiterung f|fffd|r Innovation und Technologie"
Sheets("Stammdaten").Range("D10") = #1/1/2016#
Sheets("Stammdaten").Range("F10") = #12/31/2018#
Sheets("Stammdaten").Range("H10") = #1/31/2016#


End Sub




Attribute VB_Name = "Modul14"
Sub Pruefung_100()

' Erstellt 13.11.2011 von Martin Eckhard
' Das Makro dient zur Erweiterung des Stichprobenumfangs bei der Rechnungsbelegpr|fffd|fung

'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Pr|fffd|fung_100"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

'Makro nur zu bet|fffd|tigen, wenn zuvor bereits ber Pr|fffd|fungsteil bei WTSH-Check eine Stichprobenpr|fffd|fung ausgew|fffd|hlt wurde
'Feld E69 wird |fffd|ber das Makro WTSH-Chekc gesetzt

    Sheets("Gesamtausgaben").Select
    If Range("E69") = "x" Then


'Abfrage Berechtigung
        wert = InputBox("Bitte Kennwort eingeben", "Berechtigung", , 5500, 6700)
  
        sll = BIN(wert)

        If sll = "0100101101101001011001010110110000110000001101000011001100110001" Then

     'Makro-Logfile erg|fffd|nzen
            Sheets("Stammdaten").Unprotect "WTSHEA"
            Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
            Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

            ActiveWorkbook.Unprotect "WTSHEA"

            Sheets("Gesamtausgaben").Select
            Sheets("Gesamtausgaben").Unprotect "WTSHEA"
           
            ActiveSheet.Shapes("Button 143").Visible = False
            Rows("82:82").Select
            Selection.EntireRow.Hidden = True
            Rows("83:83").Select
            Selection.EntireRow.Hidden = False
            Range("E83") = "x"
            Range("F83") = ""

    'In Stichprobentabelle alle ausw|fffd|hlen, neue mit O
            Sheets("Stichprobentabelle").Select
            Sheets("Stichprobentabelle").Unprotect "WTSHEA"
            For j = 14 To Range("E4") + 13
                If Range("N" & j) = "" Then
                    Range("N" & j) = "O"
                End If
            Next j
            Sheets("Stichprobentabelle").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

    'auf allen Ausgabenbl|fffd|ttern vorne Linien setzen
            Sheets("Stammdaten").Select
 
            For i = 1 To Range("O45") ' f|fffd|r jede Ausgabenart
                NameAusg = Range("C" & (21 + i))
          
                Sheets(NameAusg).Select
                Sheets(NameAusg).Unprotect "WTSHEA"
                    For m = 14 To Range("A13")
                        
                        If Range("B" & m) <> "" Then 'Linien zeichnen bei den Feldern zur Auswahl
                            Range("B" & m).Select
                            If m = 14 Then 'oberste Zeile oben dicke Linie
                                ' Selection.Borders(xlDiagonalDown).LineStyle = xlNone
                                ' Selection.Borders(xlDiagonalUp).LineStyle = xlNone
                                ' Selection.Borders(xlEdgeLeft).LineStyle = xlNone
                                With Selection.Borders(xlEdgeTop)
                                    .LineStyle = xlContinuous
                                    .ColorIndex = xlAutomatic
                                    .TintAndShade = 0
                                    .Weight = xlMedium
                                End With
                                With Selection.Borders(xlEdgeBottom)
                                    .LineStyle = xlContinuous
                                    .ColorIndex = xlAutomatic
                                    .TintAndShade = 0
                                    .Weight = xlThin
                                End With
                                ' Selection.Borders(xlEdgeRight).LineStyle = xlNone
                                ' Selection.Borders(xlInsideVertical).LineStyle = xlNone
                                ' Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
                            Else 'sonst oben und unten d|fffd|nne Linie
                                ' Selection.Borders(xlDiagonalDown).LineStyle = xlNone
                                ' Selection.Borders(xlDiagonalUp).LineStyle = xlNone
                                ' Selection.Borders(xlEdgeLeft).LineStyle = xlNone
                                With Selection.Borders(xlEdgeTop)
                                    .LineStyle = xlContinuous
                                    .ColorIndex = xlAutomatic
                                    .TintAndShade = 0
                                    .Weight = xlThin
                                End With
                                With Selection.Borders(xlEdgeBottom)
                                    .LineStyle = xlContinuous
                                    .ColorIndex = xlAutomatic
                                    .TintAndShade = 0
                                    .Weight = xlThin
                                End With
                                ' Selection.Borders(xlEdgeRight).LineStyle = xlNone
                                ' Selection.Borders(xlInsideVertical).LineStyle = xlNone
                                ' Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
                           End If
                        End If
                    
                    Next m
                ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("Stammdaten").Select
            Next i
        End If
            
            Sheets("Gesamtausgaben").Select
            Range("F8").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

    End If

End Sub

Attribute VB_Name = "Modul15"
Sub Instanz_Test_EA()

' Erstellt am 16.02.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen eines Test-EAs in den Stammdaten zum Testen der Makros
Sheets("Stammdaten").Range("D13") = #4/15/2016#
Sheets("Stammdaten").Range("H13") = 1
Sheets("Stammdaten").Range("D15") = "bis Ende M|fffd|rz 2016"
Sheets("Stammdaten").Range("H15") = 0.1
Sheets("Stammdaten").Range("D17") = "siehe oben"

End Sub
Attribute VB_Name = "Modul16"
Sub Instanz_Test_Materialkosten()

' Erstellt am 16.02.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen eines Beleges in den Materialkosten zum Testen der Makros
Sheets("Materialkosten").Range("D14") = "OR 1"
Sheets("Materialkosten").Range("E14") = "BC 1"
Sheets("Materialkosten").Range("F14") = "Rechnung 1"
Sheets("Materialkosten").Range("G14") = 1
Sheets("Materialkosten").Range("H14") = 500
Sheets("Materialkosten").Range("I14") = 400
Sheets("Materialkosten").Range("J14") = #1/14/2016#
Sheets("Materialkosten").Range("K14") = #1/20/2016#
Sheets("Materialkosten").Range("L14") = "Lieferant A"
Sheets("Materialkosten").Range("M14") = 1

End Sub
Attribute VB_Name = "Modul17"
Sub Show_Button()

' Erstellt 19.02.2015 von Philipp Freese
' Das Makro dient zum Ein- oder Ausblenden eines (bestimmten) Buttons
      
ActiveWorkbook.Unprotect "WTSHEA"
Sheets("Gesamtausgaben").Select

ActiveSheet.Shapes("Button 5").Visible = True

End Sub
Attribute VB_Name = "Modul18"
Sub Instanz_Test_Personalkosten_nachgewiesen()

' Erstellt am 26.02.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen eines Beleges in den nachgewiesenen Personalkosten zum Testen der Makros
Sheets("Personalkosten (nachgewiesen)").Range("D14") = "OR 1"
Sheets("Personalkosten (nachgewiesen)").Range("E14") = "BC 1"
Sheets("Personalkosten (nachgewiesen)").Range("F14") = 2000
Sheets("Personalkosten (nachgewiesen)").Range("G14") = 500
Sheets("Personalkosten (nachgewiesen)").Range("H14") = 0.5
Sheets("Personalkosten (nachgewiesen)").Range("J14") = #1/14/2016#
Sheets("Personalkosten (nachgewiesen)").Range("K14") = "Vorname Nachname Januar 2016"

End Sub

Attribute VB_Name = "Modul19"
Sub Instanz_Test_Gemeinkosten_nachgewiesen()

' Erstellt am 17.03.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen eines Beleges in den nachgewiesenen Gemeinkosten zum Testen der Makros
Sheets("Gemeinkosten (nachgewiesen)").Range("D14") = "OR 2"
Sheets("Gemeinkosten (nachgewiesen)").Range("E14") = "BC 2"
Sheets("Gemeinkosten (nachgewiesen)").Range("F14") = "Strom Januar 2016"
Sheets("Gemeinkosten (nachgewiesen)").Range("G14") = 80
Sheets("Gemeinkosten (nachgewiesen)").Range("H14") = 0.3
Sheets("Gemeinkosten (nachgewiesen)").Range("J14") = #1/20/2016#
Sheets("Gemeinkosten (nachgewiesen)").Range("K14") = #1/25/2016#
Sheets("Gemeinkosten (nachgewiesen)").Range("L14") = "Stadwerke A"

End Sub

Attribute VB_Name = "Modul2"
'Das Makro erlaubt die Auswahl der relevanten Ausgabenarten
'Schaltfl|fffd|che (7)
Sub Stammdaten_2()
  
'Definition von Variablen
    Dim NameAusg As String
    Dim gk15case As String
       
'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Stammdaten_2"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

 
       
'Kontrolle, dass das Makro nur einmal ausgef|fffd|hrt wird
'(auch nicht |fffd|ber das Kontextmenu von Excel ein zweites Mal
  
    Sheets("Stammdaten").Select
    If (Range("AH2") = "ja" And Range("AH3") = "nein" And Range("AH4") = "nein") Then
  
  
  'Abfrage, wenn noch ein Fehler existiert in der Eingabe, wird das Makro nicht ausgel|fffd|st
        If Range("K21") = "nein" Then
     
     'Schaltfl|fffd|che Fehler
            MsgBox "Achtung die Eingabe der Daten" & Chr(10) & _
                    "ist fehlerbehaftet oder unvollst|fffd|ndig" & Chr(10) & Chr(10) & _
                    "Bitte die Eingaben |fffd|berpr|fffd|fen!" & Chr(10) & Chr(10) & Fehlermeldung, vbExclamation
 
        Else
     
        'Schutz aufheben
            ActiveSheet.Unprotect "WTSHEA"
            ActiveWorkbook.Unprotect "WTSHEA"
    
        'Anzahl ausgew|fffd|hlter Ausgabenarten
            AnzAusg = Range("O45")
    
        'Die ausgew|fffd|hlten Ausgabenarten in sortieter Reihenfolge nach vorne kopieren
            Range("M22:O42").Select
            Selection.Copy
            Range("B22").Select
            Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
                False, Transpose:=False
    
        'Den Rest mit blauen Leerzeilen ausf|fffd|llen
            Range("B43:D43").Select
            Selection.Copy
            For i = 22 + AnzAusg To 42
                Range("B" & i).Select
                ActiveSheet.Paste
            Next i
    
        'Ausgabenarten in Farbe sand und sch|fffd|tzen
            Range("B22:D" & 21 + AnzAusg).Select
            With Selection.Interior
                .ColorIndex = 40
                .Pattern = xlSolid
            End With
            Selection.Locked = True
            Selection.FormulaHidden = False
    
        'Einblenden der Felder f|fffd|r ZE
            Rows("13:18").Select
            Selection.EntireRow.Hidden = False
            Range("F20").Select
           
        'Button Stammdaten_2 ausblenden, Button Kunde einblenden
            ActiveSheet.Shapes("Button 7").Visible = False
            ActiveSheet.Shapes("Button 8").Visible = True
        
        'Zu den ausgew|fffd|hlten Ausgabenarten die Kostenartentabellenbl|fffd|tter einblenden
        'und in die gew|fffd|hlte Reihenfolge bringen
            For i = 1 To AnzAusg
                Dummy_copy = 0
                NameAusg = Range("C" & (21 + i))
                For j = 5 To 40
                     If Range("BC" & j) = NameAusg Then
                        Dummy_copy = 1
                        If Range("BF" & j) = "MK" Then
                            Sheets("MK Dummy").Visible = True
                            Sheets("MK Dummy").Unprotect "WTSHEA"
                            Sheets("MK Dummy").Copy after:=Sheets("MK Dummy")
                            ActiveSheet.Name = NameAusg
                            Sheets(NameAusg).Range("AI2") = Sheets("Stammdaten").Range("BC" & j)
                            Sheets(NameAusg).Range("C5") = Sheets("Stammdaten").Range("BD" & j)
                            Sheets(NameAusg).Range("C6") = Sheets("Stammdaten").Range("BE" & j)
                            Sheets(NameAusg).Range("AI8") = Sheets("Stammdaten").Range("BG" & j)
                            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Sheets("Stammdaten").Range("BI" & j) = "Tabellenblatt erstellt"
                            Sheets("Stammdaten").Select
                        End If
                        If Range("BF" & j) = "PK-2" Then
                            Sheets("PK-2 Dummy").Visible = True
                            Sheets("PK-2 Dummy").Unprotect "WTSHEA"
                            Sheets("PK-2 Dummy").Copy after:=Sheets("PK-2 Dummy")
                            ActiveSheet.Name = NameAusg
                            Sheets(NameAusg).Range("AI2") = Sheets("Stammdaten").Range("BC" & j)
                            Sheets(NameAusg).Range("C5") = Sheets("Stammdaten").Range("BD" & j)
                            Sheets(NameAusg).Range("AI8") = Sheets("Stammdaten").Range("BG" & j)
                            Sheets(NameAusg).Range("AI10") = Sheets("Stammdaten").Range("BH" & j)
                            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Sheets("Stammdaten").Range("BI" & j) = "Tabellenblatt erstellt"
                            Sheets("Stammdaten").Select
                            gk15case = "Unternehmen" 'wichtig f|fffd|r die 15%-Pauschale
                        End If
                        If Range("BF" & j) = "PK-1" Then
                            Sheets("Personalkosten (nachgewiesen)").Visible = True
                            Sheets("Personalkosten (nachgewiesen)").Unprotect "WTSHEA"
                            Sheets("Personalkosten (nachgewiesen)").Copy after:=Sheets("Personalkosten (nachgewiesen)")
                            ActiveSheet.Name = NameAusg
                            Sheets(NameAusg).Range("AI2") = Sheets("Stammdaten").Range("BC" & j)
                            Sheets(NameAusg).Range("C5") = Sheets("Stammdaten").Range("BD" & j)
                            Sheets(NameAusg).Range("C6") = Sheets("Stammdaten").Range("BE" & j)
                            Sheets(NameAusg).Range("AI8") = Sheets("Stammdaten").Range("BG" & j)
                            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Sheets("Stammdaten").Range("BI" & j) = "Tabellenblatt erstellt"
                            Sheets("Stammdaten").Select
                        End If
                        If Range("BF" & j) = "GK" Then
                            Sheets("Gemeinkosten (nachgewiesen)").Visible = True
                            Sheets("Gemeinkosten (nachgewiesen)").Unprotect "WTSHEA"
                            Sheets("Gemeinkosten (nachgewiesen)").Copy after:=Sheets("Gemeinkosten (nachgewiesen)")
                            ActiveSheet.Name = NameAusg
                            Sheets(NameAusg).Range("AI2") = Sheets("Stammdaten").Range("BC" & j)
                            Sheets(NameAusg).Range("C5") = Sheets("Stammdaten").Range("BD" & j)
                            Sheets(NameAusg).Range("C6") = Sheets("Stammdaten").Range("BE" & j)
                            Sheets(NameAusg).Range("AI8") = Sheets("Stammdaten").Range("BG" & j)
                            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Sheets("Stammdaten").Range("BI" & j) = "Tabellenblatt erstellt"
                            Sheets("Stammdaten").Select
                        End If
                    End If
                Next j
                'Falls Kostenart nicht zu Dummy geh|fffd|rt, existiert sie bereits und muss nur noch
                'angezeigt werden
                If Dummy_copy = 0 Then
                    Sheets(NameAusg).Visible = True
                    If NameAusg = "Personalkosten (nachgewiesen)" Then
                        gk15case = "Forschungseinrichtung" 'wichtig f|fffd|r die 15%-Pauschale
                    End If
                End If
            Next i
            'Sheets("Stammdaten").Range("BI4") = Z  'for debugging
            
        'Falls Gemeinkosten ausgew|fffd|hlt, auf den Tabellenbl|fffd|ttern die Formeln zur Berechnung einf|fffd|gen
            Sheets("Stammdaten").Select
            For i = 1 To AnzAusg
                NameAusg = Range("C" & (21 + i))
                Sheets(NameAusg).Select
                ActiveSheet.Unprotect "WTSHEA"
                               
'                If NameAusg = "Gemeinkosten (15%-Pauschale)" Then
'                    GKFormel = "=SUMME("
'                    For j = 1 To 4
'                        If Sheets("Stammdaten").Range("BI" & (j + 14)) = "Tabellenblatt erstellt" Then
'                            GKFormel = GKFormel & "'Personalkosten LG" & j & "'!I13;"
'                        End If
'                    Next j
'                    GKFormel = GKFormel & "0)"
'                    Sheets("Gemeinkosten (15%-Pauschale)").Range("D14").FormulaLocal = GKFormel
'                End If

'               Die 15%-Gemeinkostenpauschale ist sowohl f|fffd|r Unternehmen auf die standardisierten Einheitskosten als auch
'               f|fffd|r Forschungseinrichtungen auf die nachgewiesenen Personalkosten m|fffd|glich.
                If NameAusg = "Gemeinkosten (15%-Pauschale)" Then
                    Select Case gk15case
                        Case "Unternehmen"
                            GKFormel = "=SUMME("
                            For j = 1 To 4
                                If Sheets("Stammdaten").Range("BI" & (j + 14)) = "Tabellenblatt erstellt" Then
                                    GKFormel = GKFormel & "'Personalkosten LG" & j & "'!I13;"
                                End If
                            Next j
                            GKFormel = GKFormel & "0)"
                            Sheets("Gemeinkosten (15%-Pauschale)").Range("D14").FormulaLocal = GKFormel
                        Case "Forschungseinrichtung"
                            GKFormel = "='Personalkosten (nachgewiesen)'!I13"
                            Sheets("Gemeinkosten (15%-Pauschale)").Range("D14").FormulaLocal = GKFormel
                            Sheets("Gemeinkosten (15%-Pauschale)").Range("C6") = "(15%-Pauschalsatz auf die nachgewiesenen Personalkosten)"
                    End Select
                End If
                
                If NameAusg = "Gemeinkosten (25%-Pauschale)" Then
                    GK = Array("PK", "MK", "FL", "IuA", "IK", "RK")
                    GK_counter = 0
                    
                    ' Zeige Auswahlform f|fffd|r die Gemeinkosten an
                    Unload Form_Abfrage_GK
                    Form_Abfrage_GK.Show
                    
                    For j = 0 To UBound(GK)
                        If Form_Abfrage_GK.Controls("checkbox_" & GK(j)).Value = True Then
                            'GK_check(i) = True
                            GK_counter = GK_counter + 1
                            ActiveSheet.Rows(13 + GK_counter).EntireRow.Hidden = False
                            Select Case GK(j)
                                Case "PK"
                                   ActiveSheet.Range("D1" & 3 + GK_counter).FormulaLocal = "='Personalkosten (nachgewiesen)'!I13"
                                   ActiveSheet.Range("J1" & 3 + GK_counter) = "Personalkosten (nachgewiesen)"
                                Case "MK"
                                   ActiveSheet.Range("D1" & 3 + GK_counter).FormulaLocal = "='Materialkosten'!I13"
                                   ActiveSheet.Range("J1" & 3 + GK_counter) = "Materialkosten"
                                Case "FL"
                                   ActiveSheet.Range("D1" & 3 + GK_counter).FormulaLocal = "='Kosten f|fffd|r Fremdleistungen'!I13"
                                   ActiveSheet.Range("J1" & 3 + GK_counter) = "Kosten f|fffd|r Fremdleistungen"
                                Case "IuA"
                                   ActiveSheet.Range("D1" & 3 + GK_counter).FormulaLocal = "='Anteilige Kosten f|fffd|r I&A'!I13"
                                   ActiveSheet.Range("J1" & 3 + GK_counter) = "Anteilige Kosten f|fffd|r Instrumente und Ausr|fffd|stungen"
                                Case "IK"
                                   ActiveSheet.Range("D1" & 3 + GK_counter).FormulaLocal = "='Investitionskosten'!I13"
                                   ActiveSheet.Range("J1" & 3 + GK_counter) = "Investitionskosten"
                                Case "RK"
                                   ActiveSheet.Range("D1" & 3 + GK_counter).FormulaLocal = "='Reisekosten'!I13"
                                   ActiveSheet.Range("J1" & 3 + GK_counter) = "Reisekosten"
                            End Select
                        End If
                    Next j
                                        
                End If
                ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("Stammdaten").Select
            Next i
            
            
            
            'Dummys l|fffd|schen
            Sheets("Stammdaten").Select
            Application.DisplayAlerts = False
            Sheets("MK Dummy").Delete
            Sheets("PK-2 Dummy").Delete
            Application.DisplayAlerts = True
                        
            Sheets("Gesamtausgaben").Visible = True
            Sheets("Fehlermeldungen").Visible = True
            Sheets("Fehlermeldungen").Move Before:=Sheets(1)
            'Im Tabellenblatt "Fehlermeldungen" f|fffd|r die relevanten Kostenarten
            'die entsprechenden Zeilen einblenden
            Sheets("Fehlermeldungen").Select
            Sheets("Fehlermeldungen").Unprotect "WTSHEA"
            For k = AnzAusg To 1 Step -1
                NameAusg = Sheets("Stammdaten").Range("C" & (21 + k))
                Select Case NameAusg
                    Case "Personalkosten (nachgewiesen)"
                        Rows("11:24").EntireRow.Hidden = False
                    Case "Personalkosten LG1", "Personalkosten LG2", "Personalkosten LG3", "Personalkosten LG4"
                        Rows("26:33").EntireRow.Hidden = False
                    Case "Gemeinkosten (nachgewiesen)"
                        Rows("35:49").EntireRow.Hidden = False
                    Case "Gemeinkosten (15%-Pauschale)", "Gemeinkosten (25%-Pauschale)"
                    Case Else
                        Rows("51:66").EntireRow.Hidden = False
                End Select
            Next k
            Range("A2").Select
            Sheets("Fehlermeldungen").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Sheets("Gesamtausgaben").Move Before:=Sheets(1)
            Sheets("Stammdaten").Select

            For k = AnzAusg To 1 Step -1
                NameAusg = Range("C" & (21 + k))
                Sheets(NameAusg).Move Before:=Sheets(1)
                Sheets("Stammdaten").Select
            Next k
            
            Sheets("Stammdaten").Move Before:=Sheets(1)
            Sheets("Information").Move Before:=Sheets(1)
            Sheets("Stammdaten").Select

        'Im Tabellenblatt Gesamtausgaben die Zeilen f|fffd|r die relevanten Kostenarten einblenden
            Sheets("Gesamtausgaben").Select
            ActiveSheet.Unprotect "WTSHEA"
            Rows("14:" & 14 + AnzAusg - 1).Select
            Selection.EntireRow.Hidden = False
            For i = 1 To AnzAusg
                Sheets("Gesamtausgaben").Range("G" & (13 + i)) = Sheets("Stammdaten").Range("D" & (21 + i))
            Next i
            Range("F8").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
        
        'Tabellenblatt Fehlermeldungen zun|fffd|chst wieder ausblenden
            Sheets("Fehlermeldungen").Visible = False
            Sheets("Stammdaten").Select
    
        'Cursorposition festlegen
            Range("F20").Select
       
        'Kontrollfeld f|fffd|r das Makro
            Range("AH3") = "ja"
   
        'Nicht ben|fffd|tigte / ausgew|fffd|hlte Ausgabenarten die Tabellenbl|fffd|tter l|fffd|schen
        'verringert den Speicherumfang deutlich
            For i = 1 To Range("ch5")
                NameNoAusg = Range("CK" & (8 + i))
                If (NameNoAusg = "Personalkosten (nachgewiesen)" Or NameNoAusg = "Gemeinkosten (15%-Pauschale)" Or NameNoAusg = "Gemeinkosten (25%-Pauschale)" Or NameNoAusg = "Gemeinkosten (nachgewiesen)") Then
                Sheets(NameNoAusg).Visible = True
                Sheets("Stammdaten").Select
                Application.DisplayAlerts = False
                Sheets(NameNoAusg).Delete
                Application.DisplayAlerts = True
                End If
            Next i
   
        'Blatt sch|fffd|tzen
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            ActiveWorkbook.Protect "WTSHEA"
       
        'Hinweis
            MsgBox "Die Eingabe der Stammdaten seitens der WTSH ist hiermit abgeschlossen." & Chr(10) & _
                    "Das Tool ist f|fffd|r das Projekt" & Chr(10) & Chr(10) & _
                    "Antragsnummer: " & Range("D3") & Chr(10) & _
                    "Zuwendungsempf|fffd|nger: " & Range("D5") & Chr(10) & Chr(10) & _
                    "individualisiert." & Chr(10) & Chr(10) & _
                    "Bitte diese Datei im Projektverzeichnis speichern und" & Chr(10) & _
                    "dem Zuwendungsempf|fffd|nger elektronisch aush|fffd|ndigen", vbExclamation
          
        End If
    
    Else

   'Makro war bereits aufgerufen
        MsgBox "Achtung! Das Makro wurde" & Chr(10) & _
                "bereits einmal ausgef|fffd|hrt" & Chr(10) & Chr(10) & _
                "Die wiederholte Ausf|fffd|hrung kann zu Fehlern" & Chr(10) & _
                "f|fffd|hren und wurde daher unterbunden", vbExclamation
    End If

End Sub

Attribute VB_Name = "Modul20"
Sub Instanz_Test_Personalkosten_Leistungsgruppe_1()

' Erstellt am 30.03.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen eines Beleges in den standardisierten Einheitskosten zum Testen der Makros
Sheets("Personalkosten LG1").Range("D14") = "BC 1"
Sheets("Personalkosten LG1").Range("E14") = #1/1/2016#
Sheets("Personalkosten LG1").Range("G14") = 10
Sheets("Personalkosten LG1").Range("J14") = #1/20/2016#
Sheets("Personalkosten LG1").Range("K14") = "John Doe"



End Sub

Attribute VB_Name = "Modul21"
Sub Instanz_Test_Kostenarten_Anlegen()

' Erstellt am 08.04.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen von Belegen in mehreren Kostenartem zum Testen der Makros

    Sheets("Stammdaten").Select
    
    ActiveSheet.Range("B30") = 1 'Materialkosten
    ActiveSheet.Range("D30") = 10000
    ActiveSheet.Range("B36") = 2 'Reisekosten
    ActiveSheet.Range("D36") = 2000
    ActiveSheet.Range("B26") = 3 'Personalkosten (nachgewiesen)
    ActiveSheet.Range("D26") = 50000
    ActiveSheet.Range("B28") = 4 'Gemeinkosten (25%)
    ActiveSheet.Range("D28") = 12500
    ActiveSheet.Range("B29") = 5 'Gemeinkosten (nachgewiesen)
    ActiveSheet.Range("D29") = 20000
    ActiveSheet.Range("B22") = 6 'Personalkosten (Stundens|fffd|tze)
    ActiveSheet.Range("D22") = 40000
    ActiveSheet.Range("B24") = 7 'Personalkosten (Stundens|fffd|tze)
    ActiveSheet.Range("D24") = 40000
    ActiveSheet.Range("B25") = 8 'Personalkosten (Stundens|fffd|tze)
    ActiveSheet.Range("D25") = 20000
    ActiveSheet.Range("B27") = 9 'Gemeinkosten (15%)
    ActiveSheet.Range("D27") = 15000
    ActiveSheet.Range("B41") = 10 'Sachleistungen (Inv)
    ActiveSheet.Range("D41") = 50000
    ActiveSheet.Range("B42") = 11 'Einnahmen
    ActiveSheet.Range("D42") = -2000
    
End Sub
Attribute VB_Name = "Modul22"
Sub Instanz_Test_Mehrere_Kosten()

' Erstellt am 08.04.2016 von Philipp Freese
' Das Makro dient zum Vorbelegen von Belegen in mehreren Kostenartem zum Testen der Makros

    'Materialkosten
    Sheets("Materialkosten").Select
    ActiveSheet.Range("D14") = "OR 1"
    ActiveSheet.Range("E14") = "BC 1"
    ActiveSheet.Range("F14") = "Rechnung 1"
    ActiveSheet.Range("G14") = 1
    ActiveSheet.Range("H14") = 500
    ActiveSheet.Range("I14") = 400
    ActiveSheet.Range("J14") = #1/14/2016#
    ActiveSheet.Range("K14") = #1/20/2016#
    ActiveSheet.Range("L14") = "Lieferant A"
    ActiveSheet.Range("M14") = 1
    
    Sheets("Materialkosten").Select
    ActiveSheet.Range("D15") = "OR 2"
    ActiveSheet.Range("E15") = "BC 2"
    ActiveSheet.Range("F15") = "Rechnung 2"
    ActiveSheet.Range("G15") = ""
    ActiveSheet.Range("H15") = 1000
    ActiveSheet.Range("I15") = 850
    ActiveSheet.Range("J15") = #2/27/2016#
    ActiveSheet.Range("K15") = #3/2/2016#
    ActiveSheet.Range("L15") = "Lieferant B"
    ActiveSheet.Range("M15") = ""
    
    Sheets("Materialkosten").Select
    ActiveSheet.Range("D18") = "OR 3"
    ActiveSheet.Range("E18") = "BC 3"
    ActiveSheet.Range("F18") = "Rechnung 3"
    ActiveSheet.Range("G18") = ""
    ActiveSheet.Range("H18") = 150
    ActiveSheet.Range("I18") = 150
    ActiveSheet.Range("J18") = #1/2/2016#
    ActiveSheet.Range("K18") = #2/2/2016#
    ActiveSheet.Range("L18") = "Lieferant C"
    ActiveSheet.Range("M18") = "5"
    
    Sheets("Reisekosten").Select
    ActiveSheet.Range("D18") = "OR 4"
    ActiveSheet.Range("E18") = "BC 4"
    ActiveSheet.Range("F18") = "Rechnung 4"
    ActiveSheet.Range("G18") = ""
    ActiveSheet.Range("H18") = 20
    ActiveSheet.Range("I18") = 20
    ActiveSheet.Range("J18") = #2/10/2016#
    ActiveSheet.Range("K18") = #3/30/2016#
    ActiveSheet.Range("L18") = "Lieferant D"
    ActiveSheet.Range("M18") = ""
    
    'Personalkosten (nachgewiesen)
    Sheets("Personalkosten (nachgewiesen)").Select
    ActiveSheet.Range("D14") = "OR 5"
    ActiveSheet.Range("E14") = "BC 5"
    ActiveSheet.Range("F14") = 2000
    ActiveSheet.Range("G14") = 500
    ActiveSheet.Range("H14") = 0.5
    ActiveSheet.Range("J14") = #1/14/2016#
    ActiveSheet.Range("K14") = "Vorname Nachname Januar 2016"
    
    'Gemeinkosten (nachgewiesen)
    Sheets("Gemeinkosten (nachgewiesen)").Select
    ActiveSheet.Range("D14") = "OR 6"
    ActiveSheet.Range("E14") = "BC 6"
    ActiveSheet.Range("F14") = "Strom Januar 2016"
    ActiveSheet.Range("G14") = 80
    ActiveSheet.Range("H14") = 0.2
    ActiveSheet.Range("J14") = #1/20/2016#
    ActiveSheet.Range("K14") = #1/25/2016#
    ActiveSheet.Range("L14") = "Stadwerke A"
    
    'Personalkosten (Stundens|fffd|tze)
    Sheets("Personalkosten LG1").Select
    ActiveSheet.Range("D14") = "BC 7"
    ActiveSheet.Range("E14") = #1/1/2016#
    ActiveSheet.Range("G14") = 10
    ActiveSheet.Range("J14") = #1/20/2016#
    ActiveSheet.Range("K14") = "John Doe"
    
    Sheets("Personalkosten LG3").Select
    ActiveSheet.Range("D14") = "BC 8"
    ActiveSheet.Range("E14") = #1/2/2016#
    ActiveSheet.Range("G14") = 2
    ActiveSheet.Range("J14") = #1/22/2016#
    ActiveSheet.Range("K14") = "N N"
    
    Sheets("Personalkosten LG4").Select
    ActiveSheet.Range("D14") = "BC 9"
    ActiveSheet.Range("E14") = #2/2/2016#
    ActiveSheet.Range("G14") = 5
    ActiveSheet.Range("J14") = #2/22/2016#
    ActiveSheet.Range("K14") = "K A"
    
    'Sachleistungen (Investitionen)
    Sheets("Investitionsk. (Sachleistungen)").Select
    ActiveSheet.Range("D14") = "OR 10"
    ActiveSheet.Range("E14") = "BC 10"
    ActiveSheet.Range("F14") = "Rechnung 10"
    ActiveSheet.Range("G14") = 7
    ActiveSheet.Range("H14") = 20000
    ActiveSheet.Range("I14") = 18000
    ActiveSheet.Range("J14") = #3/14/2016#
    ActiveSheet.Range("K14") = #3/20/2016#
    ActiveSheet.Range("L14") = "Lieferant X"
    ActiveSheet.Range("M14") = 10
    
    'Einnahmen
    Sheets("Einnahmen").Select
    ActiveSheet.Range("D14") = "OR 11"
    ActiveSheet.Range("E14") = "BC 11"
    ActiveSheet.Range("F14") = "Rechnung 11"
    ActiveSheet.Range("G14") = 10
    ActiveSheet.Range("H14") = 1000
    ActiveSheet.Range("I14") = 1000
    ActiveSheet.Range("J14") = #3/10/2016#
    ActiveSheet.Range("K14") = #3/25/2016#
    ActiveSheet.Range("L14") = "Partner H"

End Sub

Attribute VB_Name = "Modul23"
' Makro zum Anzeigen einer Form
Sub Anzeige_Abfrage_GK()

    GK = Array("PK", "MK", "FL", "IuA", "IK", "RK")
    'Dim GK_check(6)
    GK_counter = 0
    
'    For i = 0 To UBound(GK)
'        GK_check(i) = False
'    Next i
    
    Sheets("Gemeinkosten (25%-Pauschale)").Select
    ActiveSheet.Unprotect "WTSHEA"
    
    Unload Form_Abfrage_GK
    Form_Abfrage_GK.Show

    For i = 0 To UBound(GK)
        If Form_Abfrage_GK.Controls("checkbox_" & GK(i)).Value = True Then
            'GK_check(i) = True
            GK_counter = GK_counter + 1
'            If GK_counter > 1 Then
'                Rows("14").Select
'                Selection.Copy
'                Rows("1" & 4 + GK_counter).Select
'                ActiveSheet.Paste
'            End If
            Select Case GK(i)
                Case "PK"
                   ' ActiveSheet.Range("D1" & 4 + GK_counter - 1) = "hajabubu"
                   '    Range("e2").FormulaLocal = "=Summe(B2:C5)"
                   ActiveSheet.Rows(13 + GK_counter).EntireRow.Hidden = False
                    ActiveSheet.Range("D1" & 3 + GK_counter).FormulaLocal = "='Personalkosten (nachgewiesen)'!I13"
              ActiveSheet.Range("J1" & 3 + GK_counter) = "Personalkosten (nachgewiesen)"
                   
                   
               ' Case "MK"
                
            End Select
        End If
    Next i
    
End Sub

Sub Modifikation_GKP()
    
    Sheets("Gemeinkosten (25%-Pauschale)").Select
    ActiveSheet.Unprotect "WTSHEA"
   ' ActiveSheet.Range("D14") = "hajabubu"
    
    ' D14=WENN(D3<>"";'Personalkosten (nachgewiesen)'!I13;"")
    ' H14=WENN(D14<>"";0,25;"")
    ' I14=WENN(ODER(I11="";I11=0);I9;I9-I11)
    ' Sheets(monat(i)).Range("AK2") = monat(i)
    
    GK_counter = 3
    For i = 1 To GK_counter
        If i > 1 Then
            Rows("14").Select
            Selection.Copy
            Rows("1" & 4 + i - 1).Select
            ActiveSheet.Paste
        End If
    Next i
        
    'Cursorpostion festlegen
    Range("D14").Select
    ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

End Sub
Attribute VB_Name = "Modul3"
'Makro zur Erfassung der Stammdaten zum EA durch den ZE
Sub EA_Daten_ZE()
  
    Dim Bereich1, Bereich2, Bereich3, NameAusg As String
    Dim antn As String 'Antragskurznummer aus Buchstabe Proramm, Jahr einstellig, lfd Nr zweistellig
    Dim antnr As String
    Dim GKFormel As String
       
'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Stammdaten_3"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

'Kontrolle, dass das Makro nur einmal ausgef|fffd|hrt wird
'(auch nicht |fffd|ber das Kontextmenu von Excel ein zweites Mal
  
    Sheets("Stammdaten").Select
    If (Range("AH2") = "ja" And Range("AH3") = "ja" And Range("AH4") = "nein") Then
  
        If Range("Q18") = "nein" Then
        'Schaltfl|fffd|che Fehler
            Fehler1 = "* Das Datumsfeld (D13) ist nicht ausgef|fffd|llt."
            Fehler2 = "* Das Datumsformat (D13) ist nicht korrekt."
            Fehler3 = "* Das Feld f|fffd|r die lfd. Nummer des Erstattungsantrags (H13) ist nicht ausgef|fffd|llt."
            Fehler4 = "* Der Projektstatus (H15) ist nicht angegeben."
            Fehler5 = "* Die Angabe des Projektstatus (H15) ist fehlerhaft (kein Zahlenwert)."
            Fehler6 = "* Die Angabe des Projektstatus (H15) muss zwischen 0 und 100 liegen."
            Fehler7 = "* Das Feld f|fffd|r den Aufbewahrungsort (D17) ist nicht ausgef|fffd|llt."
            Fehler8 = "* Das Datum (D13) f|fffd|r den Erstattungsantrag ist in Bezug auf den Bewilligungszeitraum nicht plausibel."
     
            n = 0
            Fehlermeldung = ""
     
            For k = 82 To 89
                n = n + 1
                If Range(Chr(k) & "18") = "n" Then
                    If Fehlermeldung = "" Then
                        Select Case k
                            Case Is = 82
                                Fehlermeldung = Fehler1
                            Case Is = 83
                                Fehlermeldung = Fehler2
                            Case Is = 89
                                Fehlermeldung = Fehler8
                            Case Is = 84
                                Fehlermeldung = Fehler3
                            Case Is = 85
                                Fehlermeldung = Fehler4
                            Case Is = 86
                                Fehlermeldung = Fehler5
                            Case Is = 87
                                Fehlermeldung = Fehler6
                            Case Is = 88
                                Fehlermeldung = Fehler7
                        End Select
                    Else
                        Select Case k
                            Case Is = 82
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler1
                            Case Is = 83
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler2
                            Case Is = 89
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler8
                            Case Is = 84
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler3
                            Case Is = 85
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler4
                            Case Is = 86
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler5
                            Case Is = 87
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler6
                            Case Is = 88
                                Fehlermeldung = Fehlermeldung & Chr(10) & Fehler7
                        End Select
                    End If
                End If
            Next k
     
            MsgBox "Achtung die Eingabe der Daten" & Chr(10) & _
                    "ist fehlerbehaftet oder unvollst|fffd|ndig." & Chr(10) & Chr(10) & _
                    "Bitte die Eingaben |fffd|berpr|fffd|fen!" & Chr(10) & Chr(10) & Fehlermeldung, vbExclamation
 
        Else
    
        'Abfrage, ob Publizit|fffd|tsverpflichtung erf|fffd|llt
            If Date >= Range("H10") Then
                wertpub = MsgBox("Gem|fffd||fffd| Ihrem Zuwendungsbescheid sind Sie verpflichtet, die F|fffd|rderung" & Chr(10) & _
                            "zeitnah und hinreichend zu publizieren. Hierzu hatten wir Sie" & Chr(10) & _
                            "entsprechend informiert." & Chr(10) & Chr(10) & _
                            "Bitte best|fffd|tigen Sie ('ok'), dass Sie dieser Verpflichtung bereits" & Chr(10) & _
                            "nachgekommen sind." & Chr(10) & Chr(10) & _
                            "Stellen Sie uns bitte die entsprechenden Nachweise" & Chr(10) & _
                            "(z.B. Internet-Link, Print-Dokument, Vortragsunterlagen) mit dem" & Chr(10) & _
                            "Einreichen des Erstattungsantrags zur Verf|fffd|gung (bereits eingereichte" & Chr(10) & _
                            "Nachweise m|fffd|ssen nicht erneut vorgelegt werden.)", vbOKCancel, "Publizit|fffd|tsnachweis")
            End If
    
            If Date < Range("h10") Or wertpub = vbOK Then
    
                ActiveSheet.Unprotect "WTSHEA"
                ActiveWorkbook.Unprotect "WTSHEA"

            'Best|fffd|tigungstext Publizit|fffd|t erzeugen
                Bestaetigung = "Mit Eingabe der spezifischen Daten zum vorliegenden Erstattungsantrag " & _
                                "wurde seitens des Zuwendungsempf|fffd|ngers am " & Date & " aktiv best|fffd|tigt, " & _
                                "der im Zuwendungsbescheid verankerten Auflage zur Publizit|fffd|t nachgekommen zu sein."

                Range("AT7:AV11") = Bestaetigung
           
            'Identnummer erzeugen
    
                antnr = Range("D3")
                antk = Trim(antnr) 'Antragsnummer ohne vor- oder nachgestellte Leerzeichen
                antk = Chr(Mid(antk, 1, 2) + 65) & antk 'Buchstabe f|fffd|r das Programm voranstellen
                antn = ""
                For i = 1 To Len(antk) 'Leerzeichen innerhalb der Antragsnummer werden gel|fffd|scht
                    If Mid(antk, i, 1) <> " " Then
                        antn = antn & Mid(antk, i, 1)
                    End If
                Next i
    
                antn = Mid(antn, 1, 1) & Mid(antn, 6, 1) & Mid(antn, 8, 2) 'Antragskurznummer
      
                zeit = Hour(Time) * 3600 + Minute(Time) * 60 + Second(Time)
   
                Randomize
                zufa = Int(Rnd() * 89) + 10
    
                Select Case zeit 'Immer eine f|fffd|nfstellige Ziffer, ggf. vorne mit Nullen auff|fffd|llen
                    Case Is > 9999
                        ident = antn & "-" & zeit & "-" & zufa
                    Case 1000 To 9999
                        ident = antn & "-0" & zeit & "-" & zufa
                    Case 100 To 999
                        ident = antn & "-00" & zeit & "-" & zufa
                    Case 10 To 99
                        ident = antn & "-000" & zeit & "-" & zufa
                    Case 1 To 9
                        ident = antn & "-0000" & zeit & "-" & zufa
                End Select
    
                Range("N16") = ident
       
            'Identnummer nach vorne kopieren
                Range("M16:N16").Select
                Selection.Copy
                Range("E15:F15").Select
                ActiveSheet.Paste
       
            'EA-Stammdaten Farbe Sand
                Range("D13").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("H13").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("D15").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("H15").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

                Range("D17:H17").Select
                With Selection.Interior
                    .ColorIndex = 40
                    .Pattern = xlSolid
                End With

            ' Ehemalige Eingabefelder sch|fffd|tzen
                Range("D13:H17").Select
                Selection.Locked = True
                Selection.FormulaHidden = False

            'Button EA-Stammdaten ausblenden
                ActiveSheet.Shapes("Button 8").Visible = False
    
            'Auf den relevanten Ausgabenseiten werden die Eingabefelder entsperrt
            'und die Sperrung f|fffd|r Zeilenmakro herausgenommen
                For i = 1 To Range("O45")
                    NameAusg = Range("C" & (21 + i))
                    Sheets(NameAusg).Select
          
                    ActiveSheet.Unprotect "WTSHEA"
          
                    If Range("AI4") = "PK-1" Then
                        Range("I11").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14:H33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("J14:M33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14").Select
                    End If
          
                    If Range("AI4") = "PK-2" Then
                        Range("I11").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14:E33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("G14:H33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("J14:M33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14").Select
                    End If
          
                    If Range("AI4") = "MK" Then
                        Range("I11").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14:M33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14").Select
                    End If
                    
                    If Range("AI4") = "GK" Then
                        Range("I11").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14:H33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("J14:M33").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14").Select
                    End If
                    
                    If Range("AI4") = "GKP" Then
                        Range("I11").Select
                        Selection.Locked = False
                        Selection.FormulaHidden = False
                        Range("D14").Select
                    End If
                  
                    Range("AI6") = "ja"
          
                'Blendet Hinweis auf "nicht freigeschaltet" aus
                    Range("AP1:AR1").Select
                    Selection.Copy
                    Range("H1:J1").Select
                    ActiveSheet.Paste
                    
                'JETZT IN MAKRO 2
                    'F|fffd|gt im Tabellenblatt "Gemeinkosten (15%-Pauschale)" die Formel zur Berechnung
                    'in das Feld D14
'                    If NameAusg = "Gemeinkosten (15%-Pauschale)" Then
'                        GKFormel = "=SUMME("
'                        For j = 1 To 4
'                            If Sheets("Stammdaten").Range("BI" & (j + 14)) = "Tabellenblatt erstellt" Then
'                                GKFormel = GKFormel & "'Personalkosten LG" & j & "'!I13;"
'                            End If
'                        Next j
'                        GKFormel = GKFormel & "0)"
'                        Sheets("Gemeinkosten (15%-Pauschale)").Range("D14").FormulaLocal = GKFormel
'                     End If
          
                    ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Sheets("Stammdaten").Select
                    
                Next i

                Sheets("Fehlermeldungen").Visible = True
    
            'Kontrollfeld f|fffd|r das Makro
                Range("AH4") = "ja"

            'Cursorposition
                Range("F19").Select
            
            'Hinweis
                MsgBox "Die Eingabe der Grunddaten zu Ihrem Erstattungsantrag ist erfolgreich abgeschlossen." & Chr(10) & Chr(10) & _
                        "Sie k|fffd|nnen nun Ihre Ausgabenbelege unter Zuordnung zu den im" & Chr(10) & _
                        "Zuwendungsbescheid festgelegten Ausgabenarten aus den nachfolgenden Tabellenbl|fffd|ttern erfassen.", vbExclamation
    
            'Button Korrektur Datum einblenden
                ActiveSheet.Shapes("Button 9").Visible = True
    
            'Button Korrektur Status einblenden
                ActiveSheet.Shapes("Button 10").Visible = True
             
            'Publizit|fffd|t: Hinweis einblenden
                If wertpub = vbOK Then
                    Range("AT7:AV11").Select
                    Selection.Copy
                    Range("F24:H28").Select
                    ActiveSheet.Paste
                End If
          
                Range("E19").Select
         
                ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                ActiveWorkbook.Protect "WTSHEA"

            End If
        
        End If
    
    Else

   'Makro war bereits aufgerufen
        MsgBox "Achtung! Das Makro wurde" & Chr(10) & _
                "bereits einmal ausgef|fffd|hrt" & Chr(10) & Chr(10) & _
                "Die wiederholte Ausf|fffd|hrung kann zu Fehlern" & Chr(10) & _
                "f|fffd|hren und wurde daher unterbunden", vbExclamation
    End If
    
End Sub

Attribute VB_Name = "Modul4"
Sub Neue_Zeilen()
'
' Makro am 10.03.2010 von Martin Eckhard aufgezeichnet
' modifiziert von Philipp Freese am 05.04.2016

'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Neue_Zeilen"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Aktiv"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

    'Makro nur vom Tabellenblatt einer Kostenart ausf|fffd|hrbar, nicht durch Makromenu von einer anderen Seite
    If Range("AI3") = "Vorlagentyp" Then
    
        'nur durch erfolgreiches Startmakro freigeschaltete Seiten
        If Range("AI6") = "ja" Then

            ActiveSheet.Unprotect "WTSHEA"
            ActiveWorkbook.Unprotect "WTSHEA"
    
            'Abfrage, wieviele neue Zeilen eingef|fffd|gt werden sollen
            NZ = InputBox("Wie viele neue Zeilen (max. 100) m|fffd|chten Sie einf|fffd|gen?" & Chr(10) & Chr(10) & _
                            "Bitte beachten Sie, dass diese Auswahl nicht" & Chr(10) & _
                            "r|fffd|ckg|fffd|ngig gemacht werden kann", "Neue Zeilen einf|fffd|gen", , 5500, 6700)
    
            'Pr|fffd|fen, ob Eingabe ein Integer
            If IsNumeric(NZ) Then
                If NZ <= 100 Then
       
                    lzalt = Range("A13") 'lzalt bedeutet "letzte belegte Zeile vor Auf|fffd|hrung des Makro"
    
                    'Neue Zeilen, wenn Vorlagentyp Personalausgaben (nachgewiesen) (PK-1)
                    If Range("AI4") = "PK-1" Then
                        For i = 1 To NZ
                            lZPK = Range("A13") 'lzPK bedeutet "letzte nutzbare Zeile f|fffd|r Personalkosten"
                            Rows(lZPK & ":" & lZPK).Select
                            Selection.Copy
                            Range("A" & lZPK + 1).Select
                            ActiveSheet.Paste
                            Range("D" & lZPK + 1 & ":H" & lZPK + 1).Select
                            Selection.ClearContents
                            Range("J" & lZPK + 1 & ":M" & lZPK + 1).Select
                            Selection.ClearContents
                        Next i
                    End If
    
                    'Neue Zeilen, wenn Vorlagentyp Personalausgaben (Stundens|fffd|tze) (PK-2)
                    If Range("AI4") = "PK-2" Then
                        For i = 1 To NZ
                            lZPK = Range("A13") 'lzPK bedeutet "letzte nutzbare Zeile f|fffd|r Personalkosten"
                            Rows(lZPK & ":" & lZPK).Select
                            Selection.Copy
                            Range("A" & lZPK + 1).Select
                            ActiveSheet.Paste
                            Range("D" & lZPK + 1 & ":E" & lZPK + 1).Select
                            Selection.ClearContents
                            Range("G" & lZPK + 1 & ":H" & lZPK + 1).Select
                            Selection.ClearContents
                            Range("J" & lZPK + 1 & ":M" & lZPK + 1).Select
                            Selection.ClearContents
                        Next i
                    End If
       
                    'Neue Zeilen, wenn Vorlagentyp Gemeinkosten (nachgewiesen) (GK)
                    If Range("AI4") = "GK" Then
                        For i = 1 To NZ
                            lZGK = Range("A13") 'lzGK bedeutet "letzte nutzbare Zeile f|fffd|r Gemeinkosten"
                            Rows(lZGK & ":" & lZGK).Select
                            Selection.Copy
                            Range("A" & lZGK + 1).Select
                            ActiveSheet.Paste
                            Range("D" & lZGK + 1 & ":H" & lZGK + 1).Select
                            Selection.ClearContents
                            Range("J" & lZGK + 1 & ":M" & lZGK + 1).Select
                            Selection.ClearContents
                        Next i
                    End If
       
                    'Neue Zeilen, wenn Vorlagentyp Materialkosten (MK)
                    If Range("AI4") = "MK" Then
                        For i = 1 To NZ
                            lZK = Range("A13") 'lZK bedeutet "letzte Nutzbare Zeile f|fffd|r Kostenart
                            Rows(lZK & ":" & lZK).Select
                            Selection.Copy
                            Range("A" & lZK + 1).Select
                            ActiveSheet.Paste
                            Range("D" & lZK + 1 & ":M" & lZK + 1).Select
                            Selection.ClearContents
                        Next i
                    End If
    
                    'Cursorpostion festlegen
                    Range("D" & lzalt + 1).Select
       
                    ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                    ActiveWorkbook.Protect "WTSHEA"
     
                Else
                    MsgBox "Achtung! Bitte nur ganzzahlige " & Chr(10) & _
                            "Werte eingeben", vbExclamation
                End If
     
            Else
                MsgBox "Achtung! Bitte nur ganzzahlige " & Chr(10) & _
                        "Werte eingeben", vbExclamation
            End If

        Else

        'Schaltfl|fffd|che Fehler
            MsgBox "Achtung! Die Seite ist noch " & Chr(10) & _
                    "nicht freigeschaltet" & Chr(10) & Chr(10) & _
                    "Bitte erst auf dem Tabellenblatt 'Stammdaten'" & Chr(10) & _
                    "die Eingabe abschliessen und das Makro ausf|fffd|hren!", vbExclamation

        End If

    Else
    'Schaltfl|fffd|che Fehler
        MsgBox "Achtung! Das Makro kann nur von" & Chr(10) & _
                "einem Tabellenblatt mit einer" & Chr(10) & Chr(10) & _
                "Ausgabenart aufgerufen werden!", vbExclamation

    End If

End Sub

Attribute VB_Name = "Modul5"
Sub WTSH_Check()

' Erstellt 12.03.2010 von Martin Eckhard,
' modifiziert von Philipp Freese am 07.04.2016
' Das Makro dient zum Einblenden der WTSH-Check Spalte
' Dieses sind kritische Werte bei den Rechnungs- und Zahlungsdaten

    Dim Zufall(1 To 10000) As Integer
    Dim Ausgaben(1 To 10000) As String
    Dim Vergleich As Boolean
    Dim Stichprobe As String
    
    Dim i As Integer 'Z|fffd|hlvariable
    Dim Anz_Fehlermeldungen As Integer 'Z|fffd|hlt die Fehler durch ZE


'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "WTSH-Check"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


'Abfrage Berechtigung
    wert = InputBox("Bitte Kennwort eingeben", "Berechtigung", , 5500, 6700)
    sll = BIN(wert)
    If sll = "0100101101101001011001010110110000110000001101000011001100110001" Then

    'Makro-Logfile anpassen
        Sheets("Stammdaten").Unprotect "WTSHEA"
        Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
        Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

     'Anzahl der korekten Eintr|fffd|ge z|fffd|hlen
        Anz_korrekte_Eintraege = 0 'Parameter, der die korrekten Eintr|fffd|ge z|fffd|hlt,
                                   'Problem wenn >10.000, da dann Array in diesem Makro zu klein und im
                                   'Tabellenblatt Stichprobentabelle Feld K13
        Sheets("Stammdaten").Select
        For i = 1 To Range("O45")
            NameAusg = Range("C" & (21 + i))
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Anz_korrekte_Eintraege = Anz_korrekte_Eintraege + Range("AM5")
            Sheets("Stammdaten").Select
        Next i
     
        If Anz_korrekte_Eintraege > 10000 Then
            Sheets("Gesamtausgaben").Select
            MsgBox "Achtung!!!!" & Chr(10) & Chr(10) & _
                   "Es liegen mehr als 10.000 Belege zur Pr|fffd|fung vor." & Chr(10) & _
                   "Eine derarige Menge kann das Tool in dieser Form nicht verarbeiten." & Chr(10) & _
                   "Bitte teilen Sie die Ausgaben in mehrere Erstattungsantr|fffd|ge auf.", vbExclamation
        Else
     
        'Fehlermeldungen z|fffd|hlen
            Anz_Fehlermeldungen = 0 'Parameter, der die Fehlermeldungen durch Falscheintr|fffd|ge des ZE z|fffd|hlt
            Sheets("Stammdaten").Select
            For i = 1 To Range("O45")
                NameAusg = Range("C" & (21 + i))
                Sheets(NameAusg).Select
                ActiveSheet.Unprotect "WTSHEA"
                
                Anz_Fehlermeldungen = Anz_Fehlermeldungen + Range("Q6")

                Sheets("Stammdaten").Select
            Next i
            Sheets("Gesamtausgaben").Select
    
        'Abfrage, ob weiter, wenn Fehlermeldungen vorliegen
            If Anz_Fehlermeldungen > 0 Then
                Antwort = MsgBox("Achtung! Es liegen fehlerhafte Eintr|fffd|ge" & Chr(10) & _
                          "seitens des ZE vor. " & Chr(10) & Chr(10) & _
                          "Diese Belege k|fffd|nnen nach Weiterf|fffd|hrung dieses Makros " & Chr(10) & _
                          "nicht mehr korrigiert werden." & Chr(10) & Chr(10) & _
                          "Sollen diese Belege noch korrigiert werden? (Abbruch des Makros)", vbYesNo)
            Else
                Antwort = vbNo
            End If
    
    
            If Antwort = vbNo Then 'Weiter nur, wenn keine Korrekturen gew|fffd|nscht oder notwendig (0 Fehler)
            
                ActiveWorkbook.Unprotect "WTSHEA"

                ActiveSheet.Shapes("Button 5").Visible = False 'WTSH-Check
                ActiveSheet.Shapes("Button 4").Visible = True   'Import-Tabelle


            'Tabellenblatt Fehlermeldungen
                Sheets("Fehlermeldungen").Visible = True
                Sheets("Fehlermeldungen").Select
                ActiveSheet.Unprotect "WTSHEA"
                Rows("3:9").Select
                Selection.EntireRow.Hidden = False
                Range("A2").Select
                ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

                Sheets("Stammdaten").Select
                ActiveSheet.Shapes("Button 9").Visible = False
                ActiveSheet.Shapes("Button 10").Visible = False

                ' Kopiere in jeder Kostenart Spalte "WTSH Check" in Spalte N
                For i = 1 To Range("O45")
                    NameAusg = Range("C" & (21 + i))
                    Sheets(NameAusg).Select
                    
                    'Nicht notwendig bei Gemeinkostenpauschale, da hier keine Eintr|fffd|ge vom ZE erfasst werden
                    'oder bei Einnahmen
                    If (ActiveSheet.Range("AI4") <> "GKP" And NameAusg <> "Einnahmen") Then
                        ActiveSheet.Unprotect "WTSHEA"
          
                        letztezeile = Range("A13")
                        Range("AZ8:AZ" & letztezeile).Select
                        Selection.Copy
                    
                        Range("N8:N" & letztezeile).Select
                        ActiveSheet.Paste
                        Range("D14").Select
    
                        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                        
                     End If
                     Sheets("Stammdaten").Select
                Next i
       
'------------------------------------------------------------------------------------------------------------------
'F|fffd|r Stichprobenziehung der Belege
'------------------------------------------------------------------------------------------------------------------

        'Alle Eintr|fffd|ge in Stichprobentabelle f|fffd|r Ziehung
                Sheets("Stichprobentabelle").Visible = True
                Sheets("Stichprobentabelle").Select
                ActiveSheet.Unprotect "WTSHEA"
     
                Stichprobe = "nein" 'Parameter, ob eine Stichprobe oder 100% gepr|fffd|ft wird. Basiswert 100% = nein
     
            'fehlerhafte Eintr|fffd|ge Schreibschutz und Farbe Sand
             
                If Anz_Fehlermeldungen > 0 Then
     
                    Sheets("Stammdaten").Select
                    For i = 1 To Range("O45")
                        NameAusg = Range("C" & (21 + i))
                        Sheets(NameAusg).Select
                        ActiveSheet.Unprotect "WTSHEA"
                        Select Case Range("AI4")
                        
                            Case Is = "PK-1"
                                For j = 14 To Range("A13")
                                    If Range("C" & j) <> "" Then
                                        Range("D" & j & ":H" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("D" & j & ":H" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                        Range("J" & j & ":M" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("J" & j & ":M" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                    End If
                                Next j
                                
                            Case Is = "PK-2"
                                For j = 14 To Range("A13")
                                    If Range("C" & j) <> "" Then
                                        Range("D" & j & ":E" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("D" & j & ":E" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                        Range("G" & j & ":H" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("G" & j & ":H" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                        Range("J" & j & ":M" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("J" & j & ":M" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                    End If
                                Next j

                            Case Is = "MK"
                                For j = 14 To Range("A13")
                                    If Range("C" & j) <> "" Then
                                        Range("D" & j & ":M" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("D" & j & ":M" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                    End If
                                Next j
                                
                            Case Is = "GK"
                                For j = 14 To Range("A13")
                                    If Range("C" & j) <> "" Then
                                        Range("D" & j & ":H" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("D" & j & ":H" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                        Range("J" & j & ":M" & j).Select
                                        With Selection.Interior
                                            .ColorIndex = 40
                                            .Pattern = xlSolid
                                        End With
                                        Range("J" & j & ":M" & j).Select
                                        Selection.Locked = True
                                        Selection.FormulaHidden = False
                                    End If
                                Next j
                                
                        End Select
                        Sheets("Stammdaten").Select
                    Next i
    
                End If
         
            'WTSH-Nummer zu jedem korrekten Beleg vergeben (wird der Belegnummer hinzugef|fffd|gt) in Schriftgr|fffd||fffd|e 6 grau
 
                WTSH_Nr = 1 'Startwert
                Sheets("Stammdaten").Select
    
                For i = 1 To Range("O45")
                    NameAusg = Range("C" & (21 + i))
                    Sheets(NameAusg).Select
                    
                    'Nicht notwendig bei Gemeinkostenpauschale, da hier keine Eintr|fffd|ge vom ZE erfasst werden
                    'oder bei Einnahmen
                    If (ActiveSheet.Range("AI4") <> "GKP" And NameAusg <> "Einnahmen") Then
                        ActiveSheet.Unprotect "WTSHEA"
                            
                        For j = 14 To Range("A13")
                            If Range("C" & j) = "" And Range("D" & j) <> "" Then
                                laengealt = Len(Range("D" & j)) 'L|fffd|nge des Strings vor dem Anf|fffd|gen
                                Range("D" & j) = Range("D" & j) & " [|fffd|" & WTSH_Nr & "|fffd|]"
                                
                                Range("D" & j).Select
                                ActiveCell.FormulaR1C1 = Range("D" & j)
                                With ActiveCell.Characters(Start:=1, Length:=laengealt).Font
                                    .Name = "Arial"
                                    .FontStyle = "Standard"
                                    .Size = 10
                                    .Strikethrough = False
                                    .Superscript = False
                                    .Subscript = False
                                    .OutlineFont = False
                                    .Shadow = False
                                    .Underline = xlUnderlineStyleNone
                                    .ThemeColor = xlThemeColorLight1
                                    .TintAndShade = 0
                                    .ThemeFont = xlThemeFontNone
                                End With
                                With ActiveCell.Characters(Start:=laengealt + 1, Length:=Len(Range("D" & j)) - laengealt).Font
                                    .Name = "Arial"
                                    .FontStyle = "Standard"
                                    .Size = 6
                                    .Strikethrough = False
                                    .Superscript = False
                                    .Subscript = False
                                    .OutlineFont = False
                                    .Shadow = False
                                    .Underline = xlUnderlineStyleNone
                                    .Color = -5066062
                                    .TintAndShade = 0
                                    .ThemeFont = xlThemeFontNone
                                End With
                            
                            
                                WTSH_Nr = WTSH_Nr + 1
                            End If
                        
                        Next j
                        Range("D14").Select
                        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                        
                    End If
                    Sheets("Stammdaten").Select
                Next i
     
                'Tabellenblatt "Stichprobentabelle" wird f|fffd|r die sp|fffd|tere Stichprobe mit allen
                'Belegen gef|fffd|llt (bis Spalte H)
                Sheets("Stammdaten").Select
                Einfuegezeile = 14 'Zeile in Stichproben-Tabelle f|fffd|r ersten Datensatz
    
                For i = 1 To Range("O45")
                    NameAusg = Range("C" & (21 + i))
                    Sheets(NameAusg).Select
                    
                    'Nicht notwendig bei Gemeinkostenpauschale, da hier keine Eintr|fffd|ge vom ZE erfasst werden
                    'oder bei Einnahmen
                    If (ActiveSheet.Range("AI4") <> "GKP" And NameAusg <> "Einnahmen") Then
                        ActiveSheet.Unprotect "WTSHEA"
          
                        If Range("AM5") > 0 Then
                            Range("BO14:BV" & 13 + Range("AM5")).Select
                            Application.CutCopyMode = False
                            Selection.Copy
                            Sheets("Stichprobentabelle").Select
                            Range("A" & Einfuegezeile).Select
                            Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
                                    :=False, Transpose:=False
                            Sheets(NameAusg).Select
                        End If
          
                        Einfuegezeile = Einfuegezeile + Range("AM5")
          
                        Range("D14").Select
                        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                    End If
                    Sheets("Stammdaten").Select
                Next i

            'Anzahl der Gesamteintr|fffd|ge in Stichprobentabelle
                Sheets("Stichprobentabelle").Select
                Range("E4") = Einfuegezeile - 14
       
            'Format kopieren
                Range("L15:O15").Select
                Application.CutCopyMode = False
                Selection.Copy
                Range("L15:O" & Einfuegezeile - 1).Select
                Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
                    SkipBlanks:=False, Transpose:=False

                Range("A15:H15").Select
                Application.CutCopyMode = False
                Selection.Copy
                Range("A15:H" & Einfuegezeile - 1).Select
                Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
                    SkipBlanks:=False, Transpose:=False
                Range("A14").Select
              
            'wenn nur wenig Belege (<15), dann keine Stichprobe ziehen, sondern alle Belege pr|fffd|fen
                If Range("E4") <= Range("J5") Then
                    For i = 14 To 14 + Range("E4") - 1
                        Range("N" & i) = "X"
                    Next i
                    Pruef100 = 1
                
                'Gesamtsumme der zu pr|fffd|fenden Kosten bestimmen
                    summe = 0
                    For i = 1 To Range("E4")
                        summe = summe + Range("E" & i + 13)
                    Next i
                    Range("E13") = summe
                
                'Berechnungen kopieren
                    Range("I15:K15").Select
                    Selection.AutoFill Destination:=Range("I15:K" & Einfuegezeile - 1), Type:=xlFillDefault
                    Range("P15:R15").Select
                    Selection.AutoFill Destination:=Range("P15:R" & Einfuegezeile - 1), Type:=xlFillDefault
                    Range("B4").Select
                                
                Else
      
            'Bei einer Belegzahl ab 15: Abfrage ob anteilig oder zu 100% gepr|fffd|ft werden soll
                    Sheets("Gesamtausgaben").Select
                    If MsgBox("Soll eine 100%-Belegpr|fffd|fung durchgef|fffd|hrt werden?", vbQuestion + vbYesNo, "Umfang der Stichprobe") = vbYes Then
                        Sheets("Stichprobentabelle").Select
                        For i = 14 To 14 + Range("E4") - 1
                            Range("N" & i) = "X"
                        Next i
                        Pruef100 = 2
                    
                    'Gesamtsumme der zu pr|fffd|fenden Kosten bestimmen
                        summe = 0
                        For i = 1 To Range("E4")
                            summe = summe + Range("E" & i + 13)
                        Next i
                        Range("E13") = summe
                
                    'Berechnungen kopieren
                        Range("I15:K15").Select
                        Selection.AutoFill Destination:=Range("I15:K" & Einfuegezeile - 1), Type:=xlFillDefault
                        Range("P15:R15").Select
                        Selection.AutoFill Destination:=Range("P15:R" & Einfuegezeile - 1), Type:=xlFillDefault
                        Range("B4").Select
    
                    Else
 
                    'Eintr|fffd|ge nach H|fffd|he des Betrags sortieren
                        Sheets("Stichprobentabelle").Select
                        Range("A14:H" & Einfuegezeile - 1).Select
                        ActiveWorkbook.Worksheets("Stichprobentabelle").Sort.SortFields.Clear
                        ActiveWorkbook.Worksheets("Stichprobentabelle").Sort.SortFields.Add Key:= _
                            Range("E14:E" & Einfuegezeile - 1), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption _
                            :=xlSortNormal
                        With ActiveWorkbook.Worksheets("Stichprobentabelle").Sort
                            .SetRange Range("A14:H" & Einfuegezeile - 1)
                            .Header = xlGuess
                            .MatchCase = False
                            .Orientation = xlTopToBottom
                            .SortMethod = xlPinYin
                            .Apply
                        End With

                    'Gesamtsumme der zu pr|fffd|fenden Kosten bestimmen
                        summe = 0
                        For i = 1 To Range("E4")
                            summe = summe + Range("E" & i + 13)
                        Next i
                        Range("E13") = summe
    
                    'Berechnungen kopieren
                        Range("I15:K15").Select
                        Selection.AutoFill Destination:=Range("I15:K" & Einfuegezeile - 1), Type:=xlFillDefault
                        Range("P15:R15").Select
                        Selection.AutoFill Destination:=Range("P15:R" & Einfuegezeile - 1), Type:=xlFillDefault
    
                    '100% Pr|fffd|fung, wenn nicht Mindestanzahl an Belegen |fffd|brig bleiben
                        If Range("E4") - Range("K13") < Range("J1") Then
                            For i = 14 To 14 + Range("E4") - 1
                                Range("N" & i) = "X"
                            Next i
                            Pruef100 = 3
                        Else

                    '65% der Gr|fffd||fffd|ten |fffd|bertragen
                            GR_Menge = Range("K13")
                            Range("K14:K" & GR_Menge + 13).Select
                            Selection.Copy
                            Range("N14").Select
                            Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
                                    :=False, Transpose:=False
                    'erreichter Ausgabenbetrag
                            Betrag = 0
                            For i = 1 To GR_Menge
                                Betrag = Betrag + Range("E" & i + 13)
                            Next i
           
                    'Echte Stichprobenziehung
                            Menge = Range("E4") - Range("K13") 'Gr|fffd||fffd|e der Auswahlmenge
                            Randomize
                            For zz = 1 To Range("J3") - 1 'Mindestmenge ziehen, einmal wird nachfolgende Do schleife durchlaufen
                                Do
                                    Vergleich = False
                                    Zufall(zz) = 1 + Int(Rnd * Menge)
   
                                    For zy = 1 To zz - 1
                                        If Zufall(zy) = Zufall(zz) Then
                                            Vergleich = True
                                        Exit For
                                        End If
                                    Next zy
                                Loop Until Not Vergleich
                                Range("N" & Zufall(zz) + GR_Menge + 14) = "X"
                                Betrag = Betrag + Range("E" & Zufall(zz) + GR_Menge + 14)
                            Next zz
        
                            Do '1x f|fffd|r Mindestmenge ziehen, dann sooft, bis Grenzbetrag |fffd|berschritten
                                Do
                                    zz = zz + 1
                                    Vergleich = False
                                    Zufall(zz) = 1 + Int(Rnd * Menge)
   
                                    For zy = 1 To zz - 1
                                        If Zufall(zy) = Zufall(zz) Then
                                            Vergleich = True
                                            Exit For
                                        End If
                                    Next zy
                                Loop Until Not Vergleich
                                Range("N" & Zufall(zz) + GR_Menge + 14) = "X"
                                Betrag = Betrag + Range("E" & Zufall(zz) + GR_Menge + 14)
                            Loop While Betrag < Range("K4")
     
                        'Alle mit WTSH-Check Hinweis werden auch |fffd|berpr|fffd|ft
                            For i = 14 To 14 + Range("E4") - 1
                                If Range("A" & i) = "!" Then Range("N" & i) = "X"
                            Next i
                      
                            Stichprobe = "ja"
                        End If
                        Range("B4").Select

                    End If
                End If 'Ende der Stichprobenberechnung


            '|fffd|bertragen der Auswahlergebnisse auf die Ausgaben-Tabellenbl|fffd|tter
            '     Kennzeichnung der zu pr|fffd|fenden Zeilen mit "X" und leichter T|fffd|nung
    
                Sheets("Stammdaten").Select
    
                For i = 1 To Range("O45") ' f|fffd|r jede Ausgabenart
                    NameAusg = Range("C" & (21 + i))
          
                    Sheets(NameAusg).Select
                    'Nicht notwendig bei Gemeinkostenpauschale, da hier keine Eintr|fffd|ge vom ZE erfasst werden
                    'oder bei Einnahmen
                    If (ActiveSheet.Range("AI4") <> "GKP" And NameAusg <> "Einnahmen") Then
                        Sheets(NameAusg).Unprotect "WTSHEA"
                                     
                        Range("CA7:CA13").Select 'Kopfzeile kopieren
                        Selection.Copy
                        Range("B7").Select
                        ActiveSheet.Paste
                
                        'Jeder Beleg wird markiert
                        For m = 14 To Range("A13")
                            
                            If Range("B" & m) <> "" Then 'Linien zeichnen bei den Feldern zur Auswahl
                                Range("B" & m).Select
                                If m = 14 Then 'oberste Zeile oben dicke Linie
                                    ' Selection.Borders(xlDiagonalDown).LineStyle = xlNone
                                    ' Selection.Borders(xlDiagonalUp).LineStyle = xlNone
                                    ' Selection.Borders(xlEdgeLeft).LineStyle = xlNone
                                    With Selection.Borders(xlEdgeTop)
                                        .LineStyle = xlContinuous
                                        .ColorIndex = xlAutomatic
                                        .TintAndShade = 0
                                        .Weight = xlMedium
                                    End With
                                    With Selection.Borders(xlEdgeBottom)
                                        .LineStyle = xlContinuous
                                        .ColorIndex = xlAutomatic
                                        .TintAndShade = 0
                                        .Weight = xlThin
                                    End With
                                    ' Selection.Borders(xlEdgeRight).LineStyle = xlNone
                                    ' Selection.Borders(xlInsideVertical).LineStyle = xlNone
                                    ' Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
                                Else 'sonst oben und unten d|fffd|nne Linie
                                    ' Selection.Borders(xlDiagonalDown).LineStyle = xlNone
                                    ' Selection.Borders(xlDiagonalUp).LineStyle = xlNone
                                    ' Selection.Borders(xlEdgeLeft).LineStyle = xlNone
                                    With Selection.Borders(xlEdgeTop)
                                        .LineStyle = xlContinuous
                                        .ColorIndex = xlAutomatic
                                        .TintAndShade = 0
                                        .Weight = xlThin
                                    End With
                                    With Selection.Borders(xlEdgeBottom)
                                        .LineStyle = xlContinuous
                                        .ColorIndex = xlAutomatic
                                        .TintAndShade = 0
                                        .Weight = xlThin
                                    End With
                                    ' Selection.Borders(xlEdgeRight).LineStyle = xlNone
                                    ' Selection.Borders(xlInsideVertical).LineStyle = xlNone
                                    ' Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
                               End If
                            End If
                        
                            If Range("B" & m) = "X" Then 'Farbliche Hervorhebung
                                Select Case Range("AI4")
                                
                                    Case Is = "PK-1"
                                        Range("D" & m & ":H" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
                                        Range("J" & m & ":M" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
                                        
                                    Case Is = "PK-2"
                                        Range("D" & m & ":E" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
                                        Range("G" & m & ":H" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
                                        Range("J" & m & ":M" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
    
                                    Case Is = "MK"
                                        Range("D" & m & ":M" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
                                        
                                    Case Is = "GK"
                                        Range("D" & m & ":H" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
                                        Range("J" & m & ":M" & m).Select
                                        With Selection.Interior
                                            .Color = 15071487
                                            .Pattern = xlSolid
                                        End With
                                        
                                End Select
                            End If
                        Next m
              
                        Range("B14:B" & Range("A13")).Select
                        Selection.Font.Bold = True
                        With Selection.Font
                            .Color = -16776961 'rot
                            .TintAndShade = 0
                        End With
    
                        With Selection
                            .HorizontalAlignment = xlCenter
                            .VerticalAlignment = xlCenter
                            .WrapText = False
                            .Orientation = 0
                            .AddIndent = False
                            .IndentLevel = 0
                            .ShrinkToFit = False
                            .ReadingOrder = xlContext
                            .MergeCells = False
                        End With
    
                        Range("D14").Select
                        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                    
                    End If
                    Sheets("Stammdaten").Select
                Next i
    
            'Auswertung in Gesamtausgaben anzeigen
                Sheets("Gesamtausgaben").Select
                Sheets("Gesamtausgaben").Unprotect "WTSHEA"
            
                If Stichprobe = "ja" Then
                    Range("E70") = "x"
                    ActiveSheet.Shapes("Button 143").Visible = True
                    Rows("68:83").Select
                    Selection.EntireRow.Hidden = False
                    Rows("86:86").Select
                    Selection.EntireRow.Hidden = True
                Else
                    Range("F70") = "x"
                    Rows("68:79").Select
                    Selection.EntireRow.Hidden = False
                    Rows("86:86").Select
                    Selection.EntireRow.Hidden = False

                End If
    
                Select Case Pruef100
                    Case Is = 1
                        Range("C86") = Range("J88")
                        Range("F69") = Range("J69")
                    Case Is = 2
                        Range("C86") = Range("J87")
                        Range("F69") = Range("J69")
                    Case Is = 3
                        Range("C86") = Range("J86")
                        Range("F69") = Range("J69")
                End Select
                
                
                Rows("88:121").Select
                Selection.EntireRow.Hidden = False
                    
                Range("F8").Select
                ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
    
            End If 'Abfrage zum Abbruch des Makros, wenn Falscheintr|fffd|ge des ZE vorliegen
    
        End If 'Abbruch des Makros bei mehr als 10.000 Belegen

    End If 'Passwort richtig eingegeben

ActiveWorkbook.Unprotect "WTSHEA"

End Sub

Attribute VB_Name = "Modul6"
Sub Import_Tabelle()

' Erstellt 10.03.2010 von Martin Eckhard,
' modifziert am 08.04.2016 von Philipp Freese
' Das Makro dient der automatischen Erstellung der Import-Tablle zum Einlesen der
' Beleglisten in ProNord

'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Import Tabelle"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

'Nur ausf|fffd|hrbar, wenn nicht Stichprobenumfang erweitert werden muss
    Sheets("Gesamtausgaben").Select
    If (Range("F70") = "x" Or Range("F83") = "x" Or Range("E84") = "x") Then

'Abfrage Berechntigung
        wert = InputBox("Bitte Kennwort eingeben", "Berechtigung", , 5500, 6700)
        sll = BIN(wert)
        If sll = "0100101101101001011001010110110000110000001101000011001100110001" Then

        'Makro-Logfile
            Sheets("Stammdaten").Unprotect "WTSHEA"
            Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
            Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

            ActiveWorkbook.Unprotect "WTSHEA"

            'Import-Button wird ausgeblendet
            ActiveSheet.Shapes("Button 4").Visible = False

            Sheets("Stammdaten").Select
            Projekttraeger = Range("D5")
            Projektnr = Range("F3")
            Aufbewahrungsort = Range("D17")

            Sheets("Tabelle1").Visible = True
            Sheets("Tabelle1").Select
            ActiveSheet.Unprotect "WTSHEA"
      
            Range("C5:D5") = Projekttraeger
            Range("C8:D8") = Projektnr
            Range("C16:D16") = Aufbewahrungsort

            Sheets("Stammdaten").Select
 
            Einfuegezeile = 21 'Zeile in IB-Tabelle f|fffd|r ersten Datensatz

            For i = 1 To Range("O45")
                NameAusg = Range("C" & (21 + i))
                Sheets(NameAusg).Select
                
                'Nicht notwendig bei Gemeinkostenpauschale, da hier keine Eintr|fffd|ge vom ZE erfasst werden
                If ActiveSheet.Range("AI4") <> "GKP" Then
                    ActiveSheet.Unprotect "WTSHEA"
          
                    If Range("AM5") > 0 Then
                        Range("AN14:AW" & 13 + Range("AM5")).Select
                        Application.CutCopyMode = False
                        Selection.Copy
                        Sheets("Tabelle1").Select
                        Range("A" & Einfuegezeile).Select
                        Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
                            :=False, Transpose:=False
                        Sheets(NameAusg).Select
                    End If
          
                    Einfuegezeile = Einfuegezeile + Range("AM5")
          
                    Cells.Select
                    Selection.Locked = True
                    Selection.FormulaHidden = True
                    Range("D14").Select

                    ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
                End If
                Sheets("Stammdaten").Select
            Next i
       
        ' Gesamtsumme der zuwendungsf|fffd|higen Ausgaben bilden
            Sheets("Tabelle1").Select
            Gesamtsumme = 0
            For i = 21 To Einfuegezeile
                Gesamtsumme = Gesamtsumme + Range("E" & i)
            Next i
            Range("G15") = Gesamtsumme
              
        ' Tabellenblatt auf Position 1 stellen
            Sheets("Tabelle1").Move Before:=Sheets(1)
            Sheets("Tabelle1").Select
            Range("A5").Select
            ActiveWorkbook.Protect "WTSHEA"

        End If
    End If
End Sub







Attribute VB_Name = "Modul7"
Sub Tool_Start_Install()
'
' Makro
' Makro am 09.03.2010 von Martin Eckhard aufgezeichnet
' Makro dient dem Einblenden aller Zeilen, Tabellenbl|fffd|tter und Kn|fffd|pfe
' ist wichtig f|fffd|r die Tool Entwicklung
'

'
    Dim letztezeile As Integer
 
'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Start_Install"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


'Abfrage Berechtigung
    wert = InputBox("Bitte Kennwort eingeben", "Berechtigung", , 5500, 6700)
 
    sll = BIN(wert)
 
    If sll = "010101110101010001010011010010000100010101000001" Then

    'Makro-Logfile
        Sheets("Stammdaten").Unprotect "WTSHEA"
        Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
        Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

        ActiveSheet.Unprotect "WTSHEA"
        ActiveWorkbook.Unprotect "WTSHEA"
    
        Sheets("Stammdaten").Select
    
    'Zun|fffd|chst alle Felder sch|fffd|tzen
        Cells.Select 'Alles markieren
        Selection.Locked = True
        Selection.FormulaHidden = False
    
    'Eingabefelder auf Blanko setzen und ungesch|fffd|tzt
        Range("D3").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
            
        Range("F3").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
   
        Range("H3").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
            
        Range("D5:H5").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
            
        Range("D7:H7").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
            
        Range("D10").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
            
        Range("F10").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
            
        Range("B22:D42").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone

        Range("D13").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
        
        Range("H13").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
       
        Range("D15").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
       
        Range("H15").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
        
        Range("D17:H17").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False

        Range("H10").Select
        Selection.ClearContents
        Selection.Interior.ColorIndex = xlNone
        Selection.Locked = False
        Selection.FormulaHidden = False
    
    'Feld f|fffd|r Identnummer verdecken
        Range("E14:F14").Select
        Selection.Copy
        Range("E15:F15").Select
        ActiveSheet.Paste
   
    'Kontrollfelder f|fffd|r einmal aktivierte Makros ungesch|fffd|tzt und r|fffd|cksetzen
        Range("AH2:AH4").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AH2") = "nein"
        Range("AH3") = "nein"
        Range("AH4") = "nein"
   
    'Nur den ersten Button sichtbar
        ActiveSheet.Shapes("Button 4").Visible = True
        ActiveSheet.Shapes("Button 7").Visible = False
        ActiveSheet.Shapes("Button 8").Visible = False
        ActiveSheet.Shapes("Button 9").Visible = False
        ActiveSheet.Shapes("Button 10").Visible = False
    
    'Alle Tabellenbl|fffd|tter f|fffd|r die Ausgabenarten
               'einblenden, alle Zellen auf gesch|fffd|tzt, Versteckte Spalten ausblenden, Blatt sch|fffd|tzen, ausblenden
       'FET-Ausgabenarten
        For i = 22 To 41
            NameAusg = Range("Q" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Cells.Select 'Alles markieren
            Selection.Locked = True
            Selection.FormulaHidden = True
            Range("AF6") = "nein"
             
            'Blendet die versteckten Spalten aus
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Columns("L:BZ").Select
                Case Is = "PK-2"
                    Columns("M:BZ").Select
                Case Is = "PK-3"
                    Columns("Q:BZ").Select
                Case Is = "MK"
                    Columns("M:BZ").Select
                Case Is = "GK"
                    Columns("N:BZ").Select
                    Range("AE4") = "nein"
                Case Is = "SL"
                    Columns("L:BZ").Select
             End Select
             Selection.EntireColumn.Hidden = True
             Columns("A:A").Select
             Selection.EntireColumn.Hidden = True

             'Felder von vorhandenen Eintr|fffd|ge l|fffd|schen, GK zur|fffd|cksetzen bzgl. autom. Mitwirken
             Select Case Range("AF4")
                Case Is = "PK-1"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-2"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                 Case Is = "PK-3"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("M14:N33").Select
                    Selection.ClearContents
                    Range("L11").Select
                    Selection.ClearContents
                    Columns("O:O").Select
                    Selection.ClearContents
               Case Is = "MK"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                Case Is = "GK"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("J14:L33").Select
                    Selection.ClearContents
                    Range("I11").Select
                    Selection.ClearContents
                    Range("H7").Select
                    Selection.ClearContents
                    Columns("M:M").Select
                    Selection.ClearContents
                    Range("BJ7:BK33").Select
                    Selection.Copy
                    Range("G7:H33").Select
                    ActiveSheet.Paste
                Case Is = "SL"
                    Range("D14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
            End Select
             
        'Blendet Hinweis auf "nicht freigeschaltet" ein
            Range("AL1:AN1").Select
            Selection.Copy
            Range("G1:I1").Select
            ActiveSheet.Paste
                      
        'Zeilen nach Standardwert f|fffd|r letzte Zeile 33 l|fffd|schen
            letztezeile = Range("A13")
            If Range("A13") > 33 Then
                Rows("34:" & letztezeile).Select
                Selection.Delete Shift:=xlUp
            End If
             
        'Corsurpostion festlegen
            Range("D35").Select
             
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
            Sheets(NameAusg).Visible = False
        Next i
          
    'BFEI-Ausgabenarten
        For i = 22 To 29
            NameAusg = Range("U" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Cells.Select
            Selection.Locked = True
            Selection.FormulaHidden = True
            Range("AF6") = "nein"
             
            'Blendet die versteckten Spalten aus
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Columns("L:BZ").Select
                Case Is = "PK-2"
                    Columns("M:BZ").Select
                Case Is = "PK-3"
                    Columns("Q:BZ").Select
                Case Is = "MK"
                    Columns("M:BZ").Select
                Case Is = "GK"
                    Columns("N:BZ").Select
                    Range("AE4") = "nein"
                Case Is = "SL"
                    Columns("L:BZ").Select
            End Select
            Selection.EntireColumn.Hidden = True
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = True
             
            'Felder von vorhandenen Eintr|fffd|ge l|fffd|schen, GK zur|fffd|cksetzen bzgl. autom. Mitwirken
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-2"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-3"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("M14:N33").Select
                    Selection.ClearContents
                    Range("L11").Select
                    Selection.ClearContents
                    Columns("O:O").Select
                    Selection.ClearContents
                Case Is = "MK"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                Case Is = "GK"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("J14:L33").Select
                    Selection.ClearContents
                    Range("H7").Select
                    Selection.ClearContents
                    Range("I11").Select
                    Selection.ClearContents
                    Columns("M:M").Select
                    Selection.ClearContents
                    Range("BJ7:BK33").Select
                    Selection.Copy
                    Range("G7:H33").Select
                    ActiveSheet.Paste
                Case Is = "SL"
                    Range("D14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
            End Select
             
        'Blendet Hinweis auf "nicht freigeschaltet" ein
            Range("AL1:AN1").Select
            Selection.Copy
            Range("G1:I1").Select
            ActiveSheet.Paste
                      
        'Zeilen nach Standardwert f|fffd|r letzte Zeile 33 l|fffd|schen
            letztezeile = Range("A13")
            If letztezeile > 33 Then
                Rows("34 :" & letztezeile).Select
                Selection.Delete Shift:=xlUp
            End If
             
            Range("D35").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
            Sheets(NameAusg).Visible = False
        Next i
       
    'BI-BI-Ausgabenarten
        For i = 22 To 26
            NameAusg = Range("Y" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Cells.Select
            Selection.Locked = True
            Selection.FormulaHidden = True
            Range("AF6") = "nein"
             
            'Blendet die versteckten Spalten aus
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Columns("L:BZ").Select
                Case Is = "PK-2"
                    Columns("M:BZ").Select
                Case Is = "PK-3"
                    Columns("Q:BZ").Select
                Case Is = "MK"
                    Columns("M:BZ").Select
                Case Is = "GK"
                    Columns("N:BZ").Select
                    Range("AE4") = "nein"
                Case Is = "SL"
                    Columns("L:BZ").Select
            End Select
            Selection.EntireColumn.Hidden = True
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = True
             
            'Felder von vorhandenen Eintr|fffd|ge l|fffd|schen, GK zur|fffd|cksetzen bzgl. autom. Mitwirken
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-2"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-3"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("M14:N33").Select
                    Selection.ClearContents
                    Range("L11").Select
                    Selection.ClearContents
                    Columns("O:O").Select
                    Selection.ClearContents
                Case Is = "MK"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                Case Is = "GK"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("J14:L33").Select
                    Selection.ClearContents
                    Range("H7").Select
                    Selection.ClearContents
                    Range("I11").Select
                    Selection.ClearContents
                    Columns("M:M").Select
                    Selection.ClearContents
                    Range("BJ7:BK33").Select
                    Selection.Copy
                    Range("G7:H33").Select
                    ActiveSheet.Paste
                Case Is = "SL"
                    Range("D14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
            End Select
             
        'Blendet Hinweis auf "nicht freigeschaltet" ein
            Range("AL1:AN1").Select
            Selection.Copy
            Range("G1:I1").Select
            ActiveSheet.Paste
                      
        'Zeilen nach Standardwert f|fffd|r letzte Zeile 33 l|fffd|schen
            letztezeile = Range("A13")
            If letztezeile > 33 Then
                Rows("34 :" & letztezeile).Select
                Selection.Delete Shift:=xlUp
            End If
             
        'm|fffd|gliche kopierte Formeln f|fffd|r IB-Tabelle l|fffd|schen
            Range("AK34:AS34").Select
            Selection.AutoFill Destination:=Range("AK15:AS34"), Type:=xlFillDefault
            Range("AK15:AS34").Select
             
            Range("D35").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
            Sheets(NameAusg).Visible = False
        Next i
       
    'BFEI-KMU-Ausgabenarten
        For i = 22 To 28
            NameAusg = Range("AC" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Cells.Select
            Selection.Locked = True
            Selection.FormulaHidden = True
            Range("AF6") = "nein"
             
        'Blendet die versteckten Spalten aus
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Columns("L:BZ").Select
                Case Is = "PK-2"
                    Columns("M:BZ").Select
                Case Is = "PK-3"
                    Columns("Q:BZ").Select
                Case Is = "MK"
                    Columns("M:BZ").Select
                Case Is = "GK"
                    Columns("N:BZ").Select
                    Range("AE4") = "nein"
                Case Is = "SL"
                    Columns("L:BZ").Select
            End Select
            Selection.EntireColumn.Hidden = True
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = True
             
        'Felder von vorhandenen Eintr|fffd|ge l|fffd|schen, GK zur|fffd|cksetzen bzgl. autom. Mitwirken
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-2"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-3"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("M14:N33").Select
                    Selection.ClearContents
                    Range("L11").Select
                    Selection.ClearContents
                    Columns("O:O").Select
                    Selection.ClearContents
                Case Is = "MK"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                Case Is = "GK"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("J14:L33").Select
                    Selection.ClearContents
                    Range("H7").Select
                    Selection.ClearContents
                    Range("I11").Select
                    Selection.ClearContents
                    Columns("M:M").Select
                    Selection.ClearContents
                    Range("BJ7:BK33").Select
                    Selection.Copy
                    Range("G7:H33").Select
                    ActiveSheet.Paste
                Case Is = "SL"
                    Range("D14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
            End Select
             
        'Blendet Hinweis auf "nicht freigeschaltet" ein
            Range("AL1:AN1").Select
            Selection.Copy
            Range("G1:I1").Select
            ActiveSheet.Paste
                      
        'Zeilen nach Standardwert f|fffd|r letzte Zeile 33 l|fffd|schen
            letztezeile = Range("A13")
            If letztezeile > 33 Then
                Rows("34 :" & letztezeile).Select
                Selection.Delete Shift:=xlUp
            End If
             
            Range("D35").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
            Sheets(NameAusg).Visible = False
        Next i
       
    'EEGP-Ausgabenarten
        For i = 22 To 26
            NameAusg = Range("AG" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Cells.Select
            Selection.Locked = True
            Selection.FormulaHidden = True
            Range("AF6") = "nein"
             
        'Blendet die versteckten Spalten aus
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Columns("L:BZ").Select
                Case Is = "PK-2"
                    Columns("M:BZ").Select
                Case Is = "PK-3"
                    Columns("Q:BZ").Select
                Case Is = "MK"
                    Columns("M:BZ").Select
                Case Is = "GK"
                    Columns("N:BZ").Select
                    Range("AE4") = "nein"
                Case Is = "SL"
                    Columns("L:BZ").Select
            End Select
            Selection.EntireColumn.Hidden = True
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = True
             
        'Felder von vorhandenen Eintr|fffd|ge l|fffd|schen, GK zur|fffd|cksetzen bzgl. autom. Mitwirken
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-2"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-3"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("M14:N33").Select
                    Selection.ClearContents
                    Range("L11").Select
                    Selection.ClearContents
                    Columns("O:O").Select
                    Selection.ClearContents
                Case Is = "MK"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                Case Is = "GK"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("J14:L33").Select
                    Selection.ClearContents
                    Range("H7").Select
                    Selection.ClearContents
                    Range("I11").Select
                    Selection.ClearContents
                    Columns("M:M").Select
                    Selection.ClearContents
                    Range("BJ7:BK33").Select
                    Selection.Copy
                    Range("G7:H33").Select
                    ActiveSheet.Paste
                Case Is = "SL"
                    Range("D14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
            End Select
             
        'Blendet Hinweis auf "nicht freigeschaltet" ein
            Range("AL1:AN1").Select
            Selection.Copy
            Range("G1:I1").Select
            ActiveSheet.Paste
                      
        'Zeilen nach Standardwert f|fffd|r letzte Zeile 33 l|fffd|schen
            letztezeile = Range("A13")
            If letztezeile > 33 Then
                Rows("34 :" & letztezeile).Select
                Selection.Delete Shift:=xlUp
            End If
             
            Range("D35").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
            Sheets(NameAusg).Visible = False
        Next i

    'B2B-Ausgabenarten
        For i = 22 To 24
            NameAusg = Range("AK" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Cells.Select
            Selection.Locked = True
            Selection.FormulaHidden = True
            Range("AF6") = "nein"
             
            'Blendet die versteckten Spalten aus
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Columns("L:BZ").Select
                Case Is = "PK-2"
                    Columns("M:BZ").Select
                Case Is = "PK-3"
                    Columns("Q:BZ").Select
                Case Is = "MK"
                    Columns("M:BZ").Select
                Case Is = "GK"
                    Columns("N:BZ").Select
                    Range("AE4") = "nein"
                Case Is = "SL"
                    Columns("L:BZ").Select
            End Select
            Selection.EntireColumn.Hidden = True
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = True
             
            'Felder von vorhandenen Eintr|fffd|ge l|fffd|schen, GK zur|fffd|cksetzen bzgl. autom. Mitwirken
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-2"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-3"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("M14:N33").Select
                    Selection.ClearContents
                    Range("L11").Select
                    Selection.ClearContents
                    Columns("O:O").Select
                    Selection.ClearContents
                Case Is = "MK"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                Case Is = "GK"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("J14:L33").Select
                    Selection.ClearContents
                    Range("H7").Select
                    Selection.ClearContents
                    Range("I11").Select
                    Selection.ClearContents
                    Columns("M:M").Select
                    Selection.ClearContents
                    Range("BJ7:BK33").Select
                    Selection.Copy
                    Range("G7:H33").Select
                    ActiveSheet.Paste
                Case Is = "SL"
                    Range("D14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
            End Select
             
        'Blendet Hinweis auf "nicht freigeschaltet" ein
            Range("AL1:AN1").Select
            Selection.Copy
            Range("G1:I1").Select
            ActiveSheet.Paste
                      
        'Zeilen nach Standardwert f|fffd|r letzte Zeile 33 l|fffd|schen
            letztezeile = Range("A13")
            If letztezeile > 33 Then
                Rows("34 :" & letztezeile).Select
                Selection.Delete Shift:=xlUp
            End If
             
            Range("D35").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
            Sheets(NameAusg).Visible = False
        Next i
       
    'UI-Ausgabenarten
        For i = 22 To 30
            NameAusg = Range("AO" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            ActiveSheet.Unprotect "WTSHEA"
            Cells.Select
            Selection.Locked = True
            Selection.FormulaHidden = True
            Range("AF6") = "nein"
             
            'Blendet die versteckten Spalten aus
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Columns("L:BZ").Select
                Case Is = "PK-2"
                    Columns("M:BZ").Select
                Case Is = "PK-3"
                    Columns("Q:BZ").Select
                Case Is = "MK"
                    Columns("M:BZ").Select
                Case Is = "GK"
                    Columns("N:BZ").Select
                    Range("AE4") = "nein"
                Case Is = "SL"
                    Columns("L:BZ").Select
            End Select
            Selection.EntireColumn.Hidden = True
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = True
             
            'Felder von vorhandenen Eintr|fffd|ge l|fffd|schen, GK zur|fffd|cksetzen bzgl. autom. Mitwirken
            Select Case Range("AF4")
                Case Is = "PK-1"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-2"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("I14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                    Range("AB8:AC10").Select
                    Selection.Copy
                    Range("F7:G9").Select
                    ActiveSheet.Paste
                Case Is = "PK-3"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("M14:N33").Select
                    Selection.ClearContents
                    Range("L11").Select
                    Selection.ClearContents
                    Columns("O:O").Select
                    Selection.ClearContents
                Case Is = "MK"
                    Range("D14:K33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("L:L").Select
                    Selection.ClearContents
                Case Is = "GK"
                    Range("D14:G33").Select
                    Selection.ClearContents
                    Range("J14:L33").Select
                    Selection.ClearContents
                    Range("H7").Select
                    Selection.ClearContents
                    Range("I11").Select
                    Selection.ClearContents
                    Columns("M:M").Select
                    Selection.ClearContents
                    Range("BJ7:BK33").Select
                    Selection.Copy
                    Range("G7:H33").Select
                    ActiveSheet.Paste
                Case Is = "SL"
                    Range("D14:J33").Select
                    Selection.ClearContents
                    Range("H11").Select
                    Selection.ClearContents
                    Columns("K:K").Select
                    Selection.ClearContents
            End Select
             
        'Blendet Hinweis auf "nicht freigeschaltet" ein
            Range("AL1:AN1").Select
            Selection.Copy
            Range("G1:I1").Select
            ActiveSheet.Paste
                      
        'Zeilen nach Standardwert f|fffd|r letzte Zeile 33 l|fffd|schen
            letztezeile = Range("A13")
            If letztezeile > 33 Then
                Rows("34 :" & letztezeile).Select
                Selection.Delete Shift:=xlUp
            End If
             
            Range("D35").Select
            ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("Stammdaten").Select
            Sheets(NameAusg).Visible = False
        Next i
       
    'Tabellenblatt Gesamtausgaben
        Sheets("Gesamtausgaben").Visible = True
        Sheets("Gesamtausgaben").Select
        ActiveSheet.Unprotect "WTSHEA"
        ActiveSheet.Shapes("Button 5").Visible = True
        ActiveSheet.Shapes("Button 4").Visible = False
        ActiveSheet.Shapes("Button 143").Visible = False
        Cells.Select
        Selection.Locked = True
        Range("E69") = ""
        Range("E70") = ""
        Range("E83") = ""
        Range("F83") = "x"
        Selection.FormulaHidden = True
        Rows("13:56").Select
        Selection.EntireRow.Hidden = False
        Rows("67:120").Select
        Selection.EntireRow.Hidden = True
        Columns("I:N").Select
        Selection.EntireColumn.Hidden = True

                   
        Range("F8").Select
        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("Gesamtausgaben").Visible = False
       
    'Tabellenblatt IB-Tabelle
        Sheets("Tabelle1").Visible = True
        Sheets("Tabelle1").Select
        ActiveSheet.Unprotect "WTSHEA"
       
        Range("C5:D5").Select
        Selection.ClearContents
        Range("C8:D8").Select
        Selection.ClearContents
        Range("C11:D11").Select
        Selection.ClearContents
        Range("C16:D16").Select
        Selection.ClearContents
        Range("G15").Select
        Selection.ClearContents
        Range("A21:I12500").Select
        Selection.ClearContents
      
        Range("F8").Select
        Cells.Select
        Selection.Locked = True
        Selection.FormulaHidden = True
        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("Tabelle1").Visible = False
      
    'Tabellenblatt Information
        Sheets("Information").Select
        ActiveSheet.Unprotect "WTSHEA"
        Cells.Select
        Selection.Locked = True
        Selection.FormulaHidden = True
        Range("K4").Select
        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("Information").Visible = True
       
    'Tabellenblatt Fehlermeldungen
        Sheets("Fehlermeldungen").Visible = True
        Sheets("Fehlermeldungen").Select
        ActiveSheet.Unprotect "WTSHEA"
        Cells.Select
        Selection.Locked = True
        Selection.FormulaHidden = True
        Rows("59:67").Select
        Selection.EntireRow.Hidden = True
          
        Range("F1").Select
        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("Stammdaten").Select
        Sheets("Fehlermeldungen").Visible = False
     
    'Tabellenblatt Versionierung
        Sheets("Versionierung").Visible = True
        Sheets("Versionierung").Select
        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("Stammdaten").Select


    'Tabellenblatt Stichprobentabelle
        Sheets("Stichprobentabelle").Visible = True
        Sheets("Stichprobentabelle").Select
        ActiveSheet.Unprotect "WTSHEA"
        Cells.Select
        Selection.Locked = True
        Selection.FormulaHidden = True
          
        Range("A1").Select
        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("Stammdaten").Select
        Sheets("Stichprobentabelle").Visible = False


    'Versteckte Spalten ausblenden
        Columns("J:CZ").Select
        Selection.EntireColumn.Hidden = True
       
    'Schutz bei den Ausgabearten f|fffd|r lfd. Nr. und Betrag aufheben
        Range("P22:P41").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("R22:R41").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("T22:T29").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("V22:V29").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("X22:X26").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("Z22:Z26").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AB22:AB28").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AD22:AD28").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AF22:AF26").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AH22:AH26").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AJ22:AJ24").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AL22:AL24").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AN22:AN30").Select
        Selection.Locked = False
        Selection.FormulaHidden = False
        Range("AP22:AP30").Select
        Selection.Locked = False
        Selection.FormulaHidden = False

    'Reihen mit Ausgabenarten und f|fffd|r Reihen f|fffd|r ZE ausblenden
    'Es bleiben nur die Reihen mit den Kopfdaten stehen
        Rows("13:18").Select
        Selection.EntireRow.Hidden = True
      
        Rows("22:42").Select
        Selection.EntireRow.Hidden = True
      
    'Reihenfolge der Tabellenbl|fffd|tter
        Sheets("Versionierung").Move Before:=Sheets(1)
        Sheets("Stammdaten").Move Before:=Sheets(1)
        Sheets("Information").Move Before:=Sheets(1)
    
    'Hinweis zu Publizit|fffd|t entfernen
        Sheets("Stammdaten").Select
        Range("AT13:AV17").Select
        Selection.Copy
        Range("F24:H28").Select
        ActiveSheet.Paste
    
    'Cursor Position
        Sheets("Stammdaten").Select
        Range("G19").Select
        
        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
        ActiveWorkbook.Protect "WTSHEA"
    End If
End Sub
Attribute VB_Name = "Modul8"
Sub Tool_Entwicklung()
'
' Makro
' Makro am 09.03.2010 von Martin Eckhard aufgezeichnet
' Makro dient dem Einblenden aller Zeilen, Tabellenbl|fffd|tter und Kn|fffd|pfe
' ist wichtig f|fffd|r die Tool Entwicklung
'

'
 'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Entwicklung"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


'Abfrage Berechtigung
    wert = InputBox("Bitte Kennwort eingeben", "Berechtigung", , 5500, 6700)
 
    sll = BIN(wert)
 
    If sll = "010101110101010001010011010010000100010101000001" Then

    'Makro-Logfile erg|fffd|nzen
        Sheets("Stammdaten").Unprotect "WTSHEA"
        Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
        Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

        Sheets("Stammdaten").Select
        ActiveSheet.Unprotect "WTSHEA"
        ActiveWorkbook.Unprotect "WTSHEA"
    
        ActiveSheet.Shapes("Button 4").Visible = True
        ActiveSheet.Shapes("Button 7").Visible = True
        ActiveSheet.Shapes("Button 8").Visible = True
        ActiveSheet.Shapes("Button 9").Visible = True
        ActiveSheet.Shapes("Button 10").Visible = True
  
        Rows("13:42").Select
        Selection.EntireRow.Hidden = False
   
    'Einblenden der FET-Ausgabenarten
        For i = 22 To 41
            NameAusg = Range("Q" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            Sheets(NameAusg).Unprotect "WTSHEA"
            Columns("L:BZ").Select
            Selection.EntireColumn.Hidden = False
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = False
            Sheets("Stammdaten").Select
        Next i
       
    'Einblenden der BFEI-Ausgabenarten
        For i = 22 To 28
            NameAusg = Range("U" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            Sheets(NameAusg).Unprotect "WTSHEA"
            Columns("L:BZ").Select
            Selection.EntireColumn.Hidden = False
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = False
            Sheets("Stammdaten").Select
        Next i
       
    'Einblenden der BI-BI-Ausgabenarten
        For i = 22 To 26
            NameAusg = Range("Y" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            Sheets(NameAusg).Unprotect "WTSHEA"
            Columns("L:BZ").Select
            Selection.EntireColumn.Hidden = False
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = False
            Sheets("Stammdaten").Select
        Next i
       
    'Einblenden der BFEI-KMU-Ausgabenarten
        For i = 22 To 28
            NameAusg = Range("AC" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            Sheets(NameAusg).Unprotect "WTSHEA"
            Columns("L:BZ").Select
            Selection.EntireColumn.Hidden = False
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = False
            Sheets("Stammdaten").Select
        Next i
       
    'Einblenden der EEGP-Ausgabenarten
        For i = 22 To 25
            NameAusg = Range("AG" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            Sheets(NameAusg).Unprotect "WTSHEA"
            Columns("L:BZ").Select
            Selection.EntireColumn.Hidden = False
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = False
            Sheets("Stammdaten").Select
        Next i
       
    'Einblenden der B2B_Ausgabenarten
        For i = 22 To 24
            NameAusg = Range("AK" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            Sheets(NameAusg).Unprotect "WTSHEA"
            Columns("L:BZ").Select
            Selection.EntireColumn.Hidden = False
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = False
            Sheets("Stammdaten").Select
        Next i
       
    'Einblenden der UI-Ausgabenarten
        For i = 22 To 29
            NameAusg = Range("AO" & i)
            Sheets(NameAusg).Visible = True
            Sheets(NameAusg).Select
            Sheets(NameAusg).Unprotect "WTSHEA"
            Columns("L:BZ").Select
            Selection.EntireColumn.Hidden = False
            Columns("A:A").Select
            Selection.EntireColumn.Hidden = False
            Sheets("Stammdaten").Select
        Next i

    'Hinweis zu Publizit|fffd|t entfernen
        Sheets("Stammdaten").Select
        Range("AT13:AV17").Select
        Selection.Copy
        Range("F24:H28").Select
        ActiveSheet.Paste
      
    'Tabellenblatt Gesamtausgaben
        Sheets("Gesamtausgaben").Visible = True
        Sheets("Gesamtausgabe").Select
        Rows("66:120").Select
        Selection.EntireRow.Hidden = False
        ActiveSheet.Shapes("Button 143").Visible = True
        Columns("I:M").Select
        Selection.EntireColumn.Hidden = False
        Sheets("Stammdaten").Select

       
        Sheets("Versionierung").Visible = True
        Sheets("Fehlermeldungen").Visible = True
        Sheets("Stichprobentabelle").Visible = True

    'ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True
    'ActiveWorkbook.Protect "WTSHEA"

    End If
End Sub
Attribute VB_Name = "Modul9"
Sub Korrektur_Datum() 'Button (9)

'Makro-Logfile
    Sheets("Stammdaten").Unprotect "WTSHEA"
    logs = Sheets("Stammdaten").Range("CO7")
    Sheets("Stammdaten").Range("CO" & 9 + logs).Value = "Korrektur EA-Datum"
    Sheets("Stammdaten").Range("CP" & 9 + logs).Value = (Environ("Username"))
    Sheets("Stammdaten").Range("CQ" & 9 + logs).Value = (Environ("Computername"))
    Sheets("Stammdaten").Range("CR" & 9 + logs).Value = Date
    Sheets("Stammdaten").Range("CS" & 9 + logs).Value = Time
    Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Abgebrochen"
    Sheets("Stammdaten").Range("CO7").Value = logs + 1
    Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


'Abfrage
    If MsgBox("Wollen Sie Ihre Datumeingabe korrigieren?", vbQuestion + vbYesNo, "Korrektur Datum") = vbYes Then

    'Makro-Logfile erg|fffd|nzen
        Sheets("Stammdaten").Unprotect "WTSHEA"
        Sheets("Stammdaten").Range("CT" & 9 + logs).Value = "Weiter"
        Sheets("Stammdaten").Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True


        Sheets("Stammdaten").Select
        ActiveSheet.Unprotect "WTSHEA"
   
        Altes_Datum = Range("D13")
        Neues_Datum = InputBox("Bitte geben Sie das Datum ein.", "Korrektur Datum", , 5500, 6700)
        Range("AA18") = Neues_Datum
   
        Range("AB18").Select
        Selection.Copy
        Range("D13").Select
        Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
            False, Transpose:=False

        If Range("S18") = "n" Then
            MsgBox "Ihre Eingabe besitzt kein g|fffd|ltiges Datumsformat" & Chr(10) & Chr(10) & _
                    "Ihre Korrektur wurde nicht |fffd|bernommen!", vbExclamation
            Range("D13") = Altes_Datum
        End If
        If (Range("Y18") = "n" And Range("S18") <> "n") Then
            MsgBox "Ihre Datumseingabe liegt ausserhalb eines plausiblen Zeitraums" & Chr(10) & _
                    "(vor Bewilligung, nach Vorlage Verwendungsnachweis)" & Chr(10) & Chr(10) & _
                    "Ihre Korrektur wurde nicht |fffd|bernommen!", vbExclamation
            Range("D13") = Altes_Datum
        End If
    
    'Cursorposition
        Range("F19").Select

        ActiveSheet.Protect "WTSHEA", DrawingObjects:=True, Contents:=True, Scenarios:=True

    End If

End Sub
  

  
Attribute VB_Name = "Tabelle1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle36"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle43"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


INQUEST-PP=macro
