Attribute VB_Name = "List1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "List2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "List21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "Modul 1"
Option Explicit

Function exist(ByVal popis As String) As Long
Dim existuje As Long
    existuje = 0
    On Error Resume Next
    Application.Sheets(popis).Select
    If Err.Number <> 9 Then
      existuje = 1
    End If
    On Error GoTo 0
    exist = existuje
End Function

Sub novy(ByVal popis As String)
    Sheets.Add
    ActiveSheet.Name = popis
    Sheets(popis).Move After:=Sheets(ThisWorkbook.jm)
    Sheets(ThisWorkbook.jm).Select
    Range("A1").Select
    Cells.Copy
    Sheets(popis).Select
    Range("A1").Activate
    ActiveSheet.Paste
    Rows("2:2").Select
    ActiveWindow.FreezePanes = True
    Range("A1").Select
    nastav_hp

'    j = ThisWorkbook.jm
'    Sheets(j).Select
'    Sheets(j).Copy Before:=Sheets(2)
'    ActiveSheet.Name = popis
'    Rows("2:2").Select
'    ActiveWindow.FreezePanes = True
'    Range("A1").Select
End Sub
Sub nastav_hp()
Dim PROSTREDI As String

    On Error Resume Next
    PROSTREDI = "prostredi"
    With ActiveSheet.PageSetup
        .PrintTitleRows = "$1:$1"
    End With
    ActiveSheet.PageSetup.PrintArea = ""
    With ActiveSheet.PageSetup
        .LeftFooter = "&8Datum: &D"
        .CenterFooter = "&8Autor: " & Sheets(PROSTREDI).Cells(5, 2).Value
        .RightFooter = "&8Sestava: " & ThisWorkbook.jm
        .LeftHeader = "&8" & Sheets(PROSTREDI).Cells(3, 2).Value & Chr(10) & Sheets(PROSTREDI).Cells(8, 2).Value
        .CenterHeader = "&B&8" & Sheets(PROSTREDI).Cells(7, 2).Value
        .RightHeader = "&8List &P z &N"
        .Orientation = xlLandscape
        .PrintGridlines = True
    End With
    On Error GoTo 0
End Sub

Sub souhrn(ByVal sl1 As String)
Dim cissl1 As Long
Dim r As Long
Dim i As Long
Dim n As String
Dim c
Dim FirstAddress
' presunuti sloupce dopredu a vytvoreni mezisouctu ceny
'    Cells.Select
    cissl1 = Range(sl1).Column
' kdyz sloupec co sel dopredu byl za cenou, musi se to soupnout
' neni to obecny, ale nevim jak jinak
    If Columns(cissl1).Range("A1").Value <> "Cena zv|fffd||fffd|en|fffd|" Then
      cissl1 = cissl1 + 1
    End If
    
    Range("A1").Select
    r = Selection.CurrentRegion.Rows.Count
    For i = 2 To r
      If Cells(i, 1).Value = "" Then
        Cells(i, 1).Value = "(pr|fffd|zdn|fffd|)"
      End If
    Next
    Columns(1).Select
    Selection.Columns.AutoFit
    Range("A1").Select
    Selection.Subtotal GroupBy:=1, Function:=xlSum, TotalList:=Array(cissl1, cissl1 + 1, cissl1 + 2), _
        Replace:=True, PageBreaks:=False, SummaryBelowData:=True
    Range("A1").Select
    Set c = Cells.Find(What:="subtotal", After:=ActiveCell, LookIn:=xlFormulas, _
        LookAt:=xlPart, SearchOrder:=xlByRows, SearchDirection:=xlNext, _
        MatchCase:=False)
    FirstAddress = c.Address
    Do
      c.Font.Bold = True
      Set c = Cells.FindNext(c)
    Loop While c.Address <> FirstAddress
    
    Columns(cissl1).Select
    Selection.Columns.AutoFit
    n = ActiveSheet.Name
    Sheets(ThisWorkbook.jm).Select
    Range("A1").Select
    Sheets(n).Select
    
    'vlozil marek
    Cells.Select
    Cells.EntireColumn.AutoFit

    
    Range("A1").Select
End Sub

Sub prehod(ByVal sl As String)
Dim cislo As Long

    Range(Range(sl).Range("A1").Address).EntireColumn.Copy
    cislo = Range(sl).Range("A1").Column + 1
    Columns("A:A").Select
    Selection.Insert Shift:=xlToRight
    Selection.Copy
    Columns("A:A").Select
    Selection.PasteSpecial Paste:=xlAll, Operation:=xlNone, SkipBlanks:=False _
        , Transpose:=False
    Columns(cislo).Select
    Selection.Delete Shift:=xlToLeft
    Range("A1").Select
End Sub

Sub sort3(ByVal k1 As String, Optional ByVal o As Long)

  If o = 0 Then
    o = xlAscending
  End If
  Selection.Sort Key1:=Range(Range(k1).Range("A2").Address), Order1:=o, Key2:=Range(Range("M|fffd|sto").Range("A2").Address) _
    , Order2:=xlAscending, Key3:=Range(Range("|fffd||fffd|slo").Range("A2").Address), Order3:=xlAscending, Header:= _
    xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
End Sub

Sub sort4(ByVal hlav As String, ByVal formula As String, ByVal col As String, ByVal s1 As String)
Dim r As Long
Dim i As Long
Dim cis As Long

    cis = Columns(col).Range("A1").Column

    ' setrizeni podle 4 sloupcu
    ' nejdriv se druh a kod spoji do jednoho
    Range("A1").Select
    Selection.Copy
    Columns(col).Range("A1").Select
    Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Columns(col).Range("A1").Select
    ActiveCell.Value = hlav
    Columns(col).Range("A2").Select
    ActiveCell.FormulaR1C1 = formula
    Selection.Copy
    Range("A1").Select
    r = ActiveCell.CurrentRegion.Rows.Count
    Range(Selection.Cells(3, cis), Selection.Cells(r, cis)).Select
    Selection.PasteSpecial Paste:=xlPasteFormulas, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False

    
    Range("A1").Select
    Application.CutCopyMode = False
    Selection.Sort Key1:=Columns(col).Range("A2"), Order1:=xlAscending, Key2:=Range("A2") _
        , Order2:=xlAscending, Key3:=Range("B2"), Order3:=xlAscending, Header:= _
        xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    
    Columns("A:A").Select
    Selection.Insert Shift:=xlToRight
    Columns(cis + 1).Select
    Selection.Copy
    Columns("A:A").Select
    Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Columns(cis + 1).Range("A1").Select
    Application.CutCopyMode = False
    Selection.Copy
    Range("A1").Select
    Selection.PasteSpecial
    Application.CutCopyMode = False
    Columns(s1).Select
    Selection.Delete Shift:=xlToLeft
    Columns(s1).Select
    Selection.Delete Shift:=xlToLeft
    Columns(cis - 1).Select
    Selection.Delete Shift:=xlToLeft
    Columns("A:A").Select
    Selection.Columns.AutoFit
End Sub

Sub TMC()
'
' MC - t|fffd||fffd|zen|fffd| podle m|fffd|sto |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String

    Application.ScreenUpdating = False
    popis = "M|fffd|sto,|fffd||fffd|slo_t"
    oldjm = ThisWorkbook.jm

    If exist(popis) = 0 Then
    novy popis
    Selection.Sort Key1:=Range(Range("M|fffd|sto").Range("A2").Address), Order1:=xlAscending, Key2:=Range(Range("|fffd||fffd|slo").Range("A2").Address) _
        , Order2:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("M|fffd|sto, |fffd||fffd|slo").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub Tnazev()
'
' NMC Makro - t|fffd||fffd|zen|fffd| podle n|fffd|zev, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    
    Application.ScreenUpdating = False
    popis = "N|fffd|zev_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "N|fffd|zev"
    prehod "N|fffd|zev"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("N|fffd|zev").FaceId = id
    Application.ScreenUpdating = True
End Sub

Sub TCena()
'
' t|fffd||fffd|zen|fffd| podle Cena, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    
    Application.ScreenUpdating = False
    popis = "Cena_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Cena", xlDescending
    prehod "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Cena zv|fffd||fffd|en|fffd|").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TDatum()
'
' t|fffd||fffd|zen|fffd| podle datum, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    
    Application.ScreenUpdating = False
    popis = "Datum_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "Datum"
    prehod "Datum"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Datum za|fffd|azen|fffd|").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TRok()
'
' t|fffd||fffd|zen|fffd| podle Rok, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Rok_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "Rok"
    prehod "Rok"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Rok").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TRokMesic()
'
' t|fffd||fffd|zen|fffd| podle Rok, m|fffd|s|fffd|c, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Rok+m|fffd|s|fffd|c_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort4 "Rok+m|fffd|s|fffd|c", "=CONCATENATE(RC[-27],""+"", if(len(RC[-26])=2,"""", if(len(RC[-26])=0,"""",""0"")),RC[-26])", _
    "AI:AI", "I:I"
    
    Range("B1").Select
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Rok+m|fffd|s|fffd|c").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TTrida()
'
' t|fffd||fffd|zen|fffd| podle T|fffd||fffd|da, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "T|fffd||fffd|da_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "T|fffd||fffd|da"
    prehod "T|fffd||fffd|da"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("T|fffd||fffd|da").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TKategorie()
'
' t|fffd||fffd|zen|fffd| podle Kategorie, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Kategorie_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "Kategorie"
    prehod "Kategorie"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Typ").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TObor()
'
' t|fffd||fffd|zen|fffd| podle Obor, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Obor_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Obor"
    prehod "Obor"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Obor").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TDruh()
'
' t|fffd||fffd|zen|fffd| podle Druh, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Druh_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Druh"
    prehod "Druh"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Druh").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TDruhKod()
'
' t|fffd||fffd|zen|fffd| podle Druh, kod, misto, cislo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Druh+k|fffd|d_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort4 "Druh+k|fffd|d", "=CONCATENATE(RC[-22],""+"",RC[-21])", _
    "AI:AI", "N:N"
    
    Range("B1").Select
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Druh+k|fffd|d").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TSkupina()
'
' t|fffd||fffd|zen|fffd| podle Skupina, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Skupina_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "Skupina"
    prehod "Skupina"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Skupina").FaceId = id
    Application.ScreenUpdating = True
End Sub

Sub TSkp()
'
' t|fffd||fffd|zen|fffd| podle SKP, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "SKP_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Skp"
    prehod "Skp"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("SKP").FaceId = id
    Application.ScreenUpdating = True
End Sub

Sub TUcet()
'
' tr|fffd|d|fffd|n|fffd| |fffd||fffd|et, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "|fffd|cet po|fffd||fffd|zen|fffd|_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "|fffd||fffd|et"
    prehod "|fffd||fffd|et"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("|fffd||fffd|et po|fffd||fffd|zen|fffd|").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TUcetMaj()
'
' t|fffd||fffd|zen|fffd| podle |fffd||fffd|et majkov|fffd|, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "|fffd||fffd|et majetkov|fffd|_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "|fffd||fffd|et_majetkov|fffd|"
    prehod "|fffd||fffd|et_majetkov|fffd|"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("|fffd||fffd|et majetkov|fffd|").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TUcetOpr()
'
' t|fffd||fffd|zen|fffd| podle |fffd||fffd|et opr|fffd|vek, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "|fffd||fffd|et opr|fffd|vek_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "|fffd||fffd|et_opr|fffd|vek"
    prehod "|fffd||fffd|et_opr|fffd|vek"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("|fffd||fffd|et opr|fffd|vek").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TUcetOdpUc()
'
' t|fffd||fffd|zen|fffd| podle |fffd||fffd|et odp. |fffd||fffd|., m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "|fffd||fffd|et odp. |fffd||fffd|._t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "|fffd||fffd|et_odp._|fffd||fffd|."
    prehod "|fffd||fffd|et_odp._|fffd||fffd|."
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("|fffd||fffd|et odp. |fffd||fffd|.").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TUcetOdpDan()
'
' t|fffd||fffd|zen|fffd| podle |fffd||fffd|et odp. da|fffd|, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "|fffd||fffd|et odp. da|fffd|._t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    sort3 "|fffd||fffd|et_odp._da|fffd|."
    prehod "|fffd||fffd|et_odp._da|fffd|."
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("|fffd||fffd|et odp. da|fffd|.").FaceId = id
    Application.ScreenUpdating = True
End Sub

Sub TStredisko()
'
' tr|fffd|d|fffd|n|fffd| st|fffd|edisko, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "S|fffd|edisko_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "St|fffd|edisko"
    prehod "St|fffd|edisko"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("St|fffd|edisko").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TZakazka()
'
' tr|fffd|d|fffd|n|fffd| zakazka, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Zak|fffd|zka_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Zak|fffd|zka"
    prehod "Zak|fffd|zka"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Zak|fffd|zka").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TCinnost()
'
' tr|fffd|d|fffd|n|fffd| |fffd|innost, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "|fffd|innost_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "|fffd|innost"
    prehod "|fffd|innost"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("|fffd|innost").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TUsek()
'
' tr|fffd|d|fffd|n|fffd| |fffd|sek, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "|fffd|sek_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "|fffd|sek"
    prehod "|fffd|sek"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("|fffd|sek").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TBudova()
'
' tr|fffd|d|fffd|n|fffd| budova, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Budova_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Budova"
    prehod "Budova"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Budova").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TBudMis()
'
' t|fffd||fffd|zen|fffd| podle Budova, mistnost, misto, cislo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Budova+m|fffd|stnost_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort4 "Budova+m|fffd|stnost", "=CONCATENATE(RC[-8],""+"",RC[-7])", _
    "AI:AI", "AB:AB"
    Range("B1").Select
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Budova+m|fffd|stnost").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TOsoba()
'
' tr|fffd|d|fffd|n|fffd| osoba, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Osoba_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Osoba"
    prehod "Osoba"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Osoba").FaceId = id
    Application.ScreenUpdating = True
End Sub
Sub TInv()
'
' tr|fffd|d|fffd|n|fffd| inv. c, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Inv.|fffd|.p|fffd|v._t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Inv._|fffd|._p|fffd|vodn|fffd|"
    prehod "Inv._|fffd|._p|fffd|vodn|fffd|"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Inv. |fffd|. p|fffd|vodn|fffd|").FaceId = id
    Application.ScreenUpdating = True
End Sub


Sub TDodavatel()
'
' tr|fffd|d|fffd|n|fffd| osoba, m|fffd|sto, |fffd||fffd|slo
'

'
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Dodavatel_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Dodavatel"
    prehod "Dodavatel"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Dodavatel").FaceId = id
    Application.ScreenUpdating = True
End Sub


Sub TStav()
Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Stav_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Stav"
    prehod "Stav"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Stav").FaceId = id
    Application.ScreenUpdating = True
End Sub


Sub TZOu()

Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "ZOu_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "ZOu"
    prehod "ZOu"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("ZO |fffd||fffd|etn|fffd|").FaceId = id
    Application.ScreenUpdating = True
End Sub

Sub TZOd()

Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "ZOd_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "ZOd"
    prehod "ZOd"
    souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("ZO da|fffd|ov|fffd|").FaceId = id
    Application.ScreenUpdating = True
End Sub

Sub TDoklad()

Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "Doklad_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "Doklad"
    prehod "Doklad"
    'souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Doklad").FaceId = id
    Application.ScreenUpdating = True
End Sub

Sub TCPA()

Dim popis As String
Dim oldjm As String
    Application.ScreenUpdating = False
    popis = "CPA_t"
    oldjm = ThisWorkbook.jm
    If exist(popis) = 0 Then
    novy popis
    
    sort3 "CPA"
    prehod "CPA"
    'souhrn "Cena"
    ThisWorkbook.jm = oldjm
    End If
    cbrMenuRazeni.Controls("Doklad").FaceId = id
    Application.ScreenUpdating = True
End Sub

Attribute VB_Name = "Modul 2"
Option Explicit

Sub GroupX(ByVal jmeno As String, ByVal nazev As String)
'
'
' sum(cena) group by X
'

'
Dim jm As String
Dim t As Long
Dim l As Long
Dim r As Long
Dim sel As Range
Dim x As Range
Dim pomchart
Dim i As Long
Dim c As Long

    Application.ScreenUpdating = False
    Application.Windows(ThisWorkbook.sablona).Activate
    On Error Resume Next
    Application.Sheets(jmeno).Select
    If Err.Number <> 9 Then
    Else
    On Error GoTo 0
    jm = jmeno
    Sheets(ThisWorkbook.jm).Select
    Range("A1").Select
    ActiveCell.CurrentRegion.Select
    
    ActiveSheet.PivotTableWizard _
        TableDestination:="", TableName:= _
        jm
    ActiveSheet.PivotTables(jm).AddFields RowFields:=Array( _
        jm, "Data")
    With ActiveSheet.PivotTables(jm).PivotFields( _
        "Cena zv|fffd||fffd|en|fffd|")
        .Orientation = xlDataField
        .Position = 1
    End With
    With ActiveSheet.PivotTables(jm).PivotFields("ZC |fffd||fffd|etn|fffd|")
        .Orientation = xlDataField
        .Position = 2
    End With
    ActiveSheet.PivotTables(jm).PivotFields("ZC da|fffd|ov|fffd|"). _
        Orientation = xlDataField
    ActiveSheet.PivotTables(jm).PivotSelect "Data[V|fffd|e]", _
        xlLabelOnly
    With ActiveSheet.PivotTables(jm).PivotFields("Data")
        .Orientation = xlColumnField
        .Position = 1
    End With
    ActiveSheet.PivotTables(jm).PivotSelect "", xlOrigin
    
    ActiveSheet.PivotTables(jm).PivotFields("Data").PivotItems( _
        "sou|fffd|et z Cena zv|fffd||fffd|en|fffd|").Name = " Cena zv|fffd||fffd|en|fffd|"
    ActiveSheet.PivotTables(jm).PivotFields("Data").PivotItems( _
        "sou|fffd|et z ZC |fffd||fffd|etn|fffd|").Name = " ZC |fffd||fffd|etn|fffd|"
    ActiveSheet.PivotTables(jm).PivotFields("Data").PivotItems( _
        "sou|fffd|et z ZC da|fffd|ov|fffd|").Name = " ZC da|fffd|ov|fffd|"
    
    ActiveSheet.Name = jm
    Sheets(jm).Select
    Sheets(jm).Move After:=Sheets(2)
    ActiveSheet.PageSetup.Orientation = xlLandscape
    ActiveSheet.Range("A2").Select
    r = ActiveCell.CurrentRegion.Rows.Count
    c = ActiveCell.CurrentRegion.Columns.Count
    Range(Selection.Cells(r + 2, 2), Selection.Cells(r + 2, 4)).Select
    t = ActiveCell.Top
    l = (Range("A1").Top + ActiveCell.Left) / 2
    ActiveSheet.Range("A2").Select
    Set sel = Range(Selection.Cells(1, 2), Selection.Cells(r - 2, 4))
    Set x = Range(Selection.Cells(2, 1), Selection.Cells(r - 2, 1))
    
    Application.CommandBars("PivotTable").Visible = False
' aby se ve 2000 neudelal kontingenci graf
    Range("AA11").Select
    Charts.Add
    ActiveChart.ChartType = xlColumnClustered
    ActiveChart.SetSourceData Source:=Sheets(jm).Range("AA11")
    For i = 1 To c - 1
      ActiveChart.SeriesCollection.NewSeries
      ActiveChart.SeriesCollection(i).Values = "='" & jm & "'!R3C" & i + 1 & ":R" & r - 1 & "C" & i + 1
      ActiveChart.SeriesCollection(i).Name = "='" & jm & "'!R2C" & i + 1
    Next
    ' nastaveni popisek osy x
    ActiveChart.SeriesCollection(1).XValues = "='" & jm & "'!R3C1:R" & r - 1 & "C1"
    
    ActiveChart.Location Where:=xlLocationAsObject, Name:=jm
    With ActiveChart
        .HasTitle = True
        .ChartTitle.Characters.Text = nazev
        .Axes(xlCategory, xlPrimary).HasTitle = True
        .Axes(xlCategory, xlPrimary).AxisTitle.Characters.Text = jm
    End With
    
    ActiveChart.Axes(xlCategory).Select
    Selection.TickLabels.AutoScaleFont = False
    ActiveChart.ChartTitle.Select
    Selection.AutoScaleFont = False
    With Selection.Font
        .ColorIndex = 3
        .Size = 22
    End With

    ActiveChart.Axes(xlCategory).AxisTitle.Select
    Selection.AutoScaleFont = False
    With Selection.Font
        .Size = 12
    End With
    
    ActiveChart.Axes(xlValue).Select
    Selection.TickLabels.AutoScaleFont = False
    With Selection.TickLabels.Font
        .Size = 12
    End With
    
    ActiveChart.Legend.Select
    Selection.AutoScaleFont = False
    With Selection.Font
        .Size = 12
    End With
    
    ActiveChart.ChartArea.Select
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Top = t
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Left = l
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Width = Range("J22").Width * 10
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Height = Range("J22").Height * 23
    
    ActiveSheet.ChartObjects(1).Activate
    ActiveChart.ChartArea.Select
   
    ActiveSheet.Range("A3").Select
    Sheets(ThisWorkbook.jm).Select
    Range("A1").Select
    Sheets(jm).Select
    End If
  On Error GoTo 0
  cbrMenuGrafy.Controls(jmeno).FaceId = id
  Application.ScreenUpdating = True
End Sub
Sub spoj(ByVal hlav As String, ByVal sl1 As String, ByVal sl2 As String, Optional ByVal formula As String)
Dim c As Long
Dim r As Long
Dim cis As Long
Dim i As Long

    c = Range("A1").CurrentRegion.Columns.Count
    c = c + 1
    r = Range("A1").CurrentRegion.Rows.Count
    If formula = "" Then
      Columns(c + 1).Range("A1").Value = "+"
    End If
    
    ' vlozeni formatu
    Range("A1").Copy
    Columns(c).Range("A1").PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    ' vlozeni hlavicky
    Columns(c).Range("A1").Select
    ActiveCell.Value = hlav
    
    Range("A1").Activate
    If formula = "" Then
      For i = 2 To r
        Cells(i, c).formula = "=" & Range(sl1).Range("A" & i).Address & "&" _
                               & Columns(c + 1).Range("A1").Address & "&" _
                               & Range(sl2).Range("A" & i).Address
      Next
      Columns(c).Copy
      Columns(c).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
          False, Transpose:=False
      Columns(c + 1).Range("A1").Delete
    Else
      For i = 2 To r
        Cells(i, c).formula = formula
      Next
    End If
End Sub
Sub GroupMisto()
'
'
' sum(cena) group by misto
'

'
    GroupX "M|fffd|sto", "DM dle m|fffd|sta"
End Sub

Sub GroupRok()
'
'
' sum(cena) group by Rok
'

'
    GroupX "Rok", "DM dle roku"
End Sub

Sub GroupRokMesic()
'
'
' sum(cena) group by roku a mesice
'

'
Dim jmeno As String
Dim temp As String

    Application.ScreenUpdating = False
    jmeno = "Rok+m|fffd|s|fffd|c"
    Application.Windows(ThisWorkbook.sablona).Activate
    On Error Resume Next
    Application.Sheets(jmeno).Select
    If Err.Number <> 9 Then
    Else
    On Error GoTo 0
    Sheets(ThisWorkbook.jm).Select
    temp = "AI:AI"
    spoj "Rok+m|fffd|s|fffd|c", "Rok", "M|fffd|s|fffd|c", "=CONCATENATE(RC[-27],""+"", if(len(RC[-26])=2,"""", if(len(RC[-26])=0,"""",""0"")),RC[-26])"
    GroupX jmeno, "DM dle Rok+m|fffd|s|fffd|c"
    Application.ScreenUpdating = False
    Sheets(ThisWorkbook.jm).Select
    Columns(temp).Select
    Selection.Delete Shift:=xlToLeft
    Range("A1").Activate
    Sheets(jmeno).Select
    End If
    Application.ScreenUpdating = True

End Sub


Sub GroupTrida()
'
'
' sum(cena) group by Trida
'

'
    GroupX "T|fffd||fffd|da", "DM dle t|fffd||fffd|dy"
End Sub
Sub GroupKategorie()
'
'
' sum(cena) group by kategorie
'

'
    GroupX "Typ", "DM dle typu"
End Sub


Sub GroupObor()
'
'
' sum(cena) group by obor
'

'
    GroupX "Obor", "DM dle oboru"
End Sub

Sub GroupDruhKod()
'
'
' sum(cena) group by druh, kod
'

'
Dim jmeno As String
Dim temp As String

    Application.ScreenUpdating = False
    jmeno = "Druh+k|fffd|d"
    Application.Windows(ThisWorkbook.sablona).Activate
    On Error Resume Next
    Application.Sheets(jmeno).Select
    If Err.Number <> 9 Then
    Else
    On Error GoTo 0
    Sheets(ThisWorkbook.jm).Select
    temp = "AI:AI"
    spoj jmeno, "Druh", "K|fffd|d"
    GroupX jmeno, "DM dle Druh+k|fffd|d"
    Application.ScreenUpdating = False
    Sheets(ThisWorkbook.jm).Select
    Columns(temp).Select
    Selection.Delete Shift:=xlToLeft
    Range("A1").Select
    Sheets(jmeno).Select
    End If
    Application.ScreenUpdating = True
End Sub
Sub GroupSkupina()
'
'
' sum(cena) group by skupina
'

'
    GroupX "Skupina", "DM dle skupiny"
End Sub

Sub GroupSKP()
'
'
' sum(cena) group by SKP
'

'
    GroupX "SKP", "DM dle SKP"
End Sub

Sub GroupUcet()
'
'
' sum(cena) group by ucet
'

'
    GroupX "|fffd||fffd|et po|fffd||fffd|zen|fffd|", "DM dle |fffd||fffd|tu po|fffd||fffd|zen|fffd|"
End Sub
Sub GroupUcetMaj()
'
'
' sum(cena) group by ucet
'

'
    GroupX "|fffd||fffd|et majetkov|fffd|", "DM dle majetkov|fffd|ho |fffd||fffd|tu"
End Sub
Sub GroupUcetOpr()
'
'
' sum(cena) group by ucet
'

'
    GroupX "|fffd||fffd|et opr|fffd|vek", "DM dle |fffd||fffd|tu opr|fffd|vek"
End Sub
Sub GroupUcetOdpUc()
'
'
' sum(cena) group by ucet
'

'
    GroupX "|fffd||fffd|et odp. |fffd||fffd|.", "DM dle |fffd||fffd|tu odp. |fffd||fffd|."
End Sub
Sub GroupUcetOdpDan()
'
'
' sum(cena) group by ucet
'

'
    GroupX "|fffd||fffd|et odp. da|fffd|.", "DM dle |fffd||fffd|tu odp. da|fffd|."
End Sub
Sub GroupStredisko()
'
'
' sum(cena) group by stredisko
'

'
    GroupX "St|fffd|edisko", "DM dle st|fffd|ediska"
End Sub
Sub GroupZakazka()
'
'
' sum(cena) group by zakazka
'

'
    GroupX "Zak|fffd|zka", "DM dle zak|fffd|zky"
End Sub
Sub GroupCinnost()
'
'
' sum(cena) group by cinnost
'

'
    GroupX "|fffd|innost", "DM dle |fffd|innosti"
End Sub


Sub GroupUsek()
'
'
' sum(cena) group by usek
'

'
    GroupX "|fffd|sek", "DM dle invent|fffd|rn|fffd|ho |fffd|seku"
End Sub
Sub GroupBM()
'
'
' sum(cena) group by Budova, mistnost
'

'
Dim jmeno As String
Dim temp As String

    Application.ScreenUpdating = False
    jmeno = "Budova+m|fffd|stnost"
    Application.Windows(ThisWorkbook.sablona).Activate
    On Error Resume Next
    Application.Sheets(jmeno).Select
    If Err.Number <> 9 Then
    Else
    On Error GoTo 0
    Sheets(ThisWorkbook.jm).Select
    temp = "AI:AI"
    spoj "Budova+m|fffd|stnost", "Budova", "M|fffd|stnost"
    GroupX jmeno, "DM dle Budova+m|fffd|stnost"
    Application.ScreenUpdating = False
    Sheets(ThisWorkbook.jm).Select
    Columns(temp).Select
    Selection.Delete Shift:=xlToLeft
    Range("A1").Activate
    Sheets(jmeno).Select
    End If
    Application.ScreenUpdating = True
End Sub
Sub GroupOsoba()
'
'
' sum(cena) group by osoba
'

'
    GroupX "Osoba", "DM dle osoby"
End Sub


Sub GroupDruh()
'
'
' sum(cena) group by druh
'

'
    GroupX "Druh", "DM dle druhu"
End Sub
Sub GroupBudova()
'
'
' sum(cena) group by budova
'

'
    GroupX "Budova", "DM dle budovy"
End Sub


Sub GroupDodavatel()
    GroupX "Dodavatel", "DM dle dodavatele"
End Sub

Sub GroupStav()
    GroupX "Stav", "DM dle stavu"
End Sub


Sub GroupZOu()
    GroupX "ZO |fffd||fffd|etn|fffd|", "DM dle ZO |fffd||fffd|etn|fffd|ho"
End Sub

Sub GroupTkl()
    GroupX "TKl", "DM dle tech.klasifikace"
End Sub
Sub GroupCPA()
    GroupX "CPA", "DM dle CPA"
End Sub


Attribute VB_Name = "Modul 3"
Option Explicit
Public cbrMenu As CommandBarPopup
Public cbrMenuRazeni As CommandBarPopup
Public cbrMenuGrafy As CommandBarPopup
Public id As Long
Public MenuX
Public MenuY
Public MenuZ
Public Menu3D
Public Y As String
Public x As String
Public Z As String
Public Xnad As String
Public Ynad As String
Public Znad As String

Sub MenuSloupce()
Dim i As Long
Dim cbrButton As CommandBarButton
Dim cap As String

' menu skryvani sloupcu
cap = "SLOUPCE"
On Error Resume Next
Application.CommandBars("Worksheet Menu Bar").Controls(cap).Visible = True
If Err.Number <> 5 Then
  Application.ScreenUpdating = True
Else
On Error GoTo 0

Set cbrMenu = Application.CommandBars("Worksheet Menu Bar").Controls.Add(Type:=msoControlPopup, temporary:=True)
cbrMenu.Caption = cap
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "M|fffd|sto"
cbrButton.OnAction = "ZSMisto"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|slo"
cbrButton.OnAction = "ZSCislo"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "N|fffd|zev"
cbrButton.OnAction = "ZSNazev"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Cena zv|fffd||fffd|en|fffd|"
cbrButton.OnAction = "ZSCena"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "ZC |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "ZSZCUcetni"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "ZC da|fffd|ov|fffd|"
cbrButton.OnAction = "ZSZCDanova"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Datum za|fffd|azen|fffd|"
cbrButton.OnAction = "ZSDatum"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok"
cbrButton.OnAction = "ZSRok"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "M|fffd|s|fffd|c"
cbrButton.OnAction = "ZSMesic"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "T|fffd||fffd|da"
cbrButton.OnAction = "ZSTrida"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Typ"
cbrButton.OnAction = "ZSKategorie"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Obor"
cbrButton.OnAction = "ZSObor"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh"
cbrButton.OnAction = "ZSDruh"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "K|fffd|d"
cbrButton.OnAction = "ZSKod"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Skupina"
cbrButton.OnAction = "ZSSkupina"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Po|fffd|ad|fffd|"
cbrButton.OnAction = "ZSPoradi"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "SKP"
cbrButton.OnAction = "ZSSKP"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et po|fffd||fffd|zen|fffd|"
cbrButton.OnAction = "ZSUcet"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et majetkov|fffd|"
cbrButton.OnAction = "ZSUcetMaj"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et opr|fffd|vek"
cbrButton.OnAction = "ZSUcetOpr"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. |fffd||fffd|."
cbrButton.OnAction = "ZSUcetOdpUc"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. da|fffd|."
cbrButton.OnAction = "ZSUcetOdpDan"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "St|fffd|edisko"
cbrButton.OnAction = "ZSStredisko"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Zak|fffd|zka"
cbrButton.OnAction = "ZSZakazka"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|innost"
cbrButton.OnAction = "ZSCinnost"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|sek"
cbrButton.OnAction = "ZSUsek"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova"
cbrButton.OnAction = "ZSBudova"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "M|fffd|stnost"
cbrButton.OnAction = "ZSMistnost"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Osoba"
cbrButton.OnAction = "ZSOsoba"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok v|fffd|roby"
cbrButton.OnAction = "ZSRokVyroby"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "V|fffd|robn|fffd| |fffd||fffd|slo"
cbrButton.OnAction = "ZSVyrobniCislo"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Inv. |fffd|. p|fffd|vodn|fffd|"
cbrButton.OnAction = "ZSInv"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Datum inventury"
cbrButton.OnAction = "ZSDatumInventury"
Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Pozn|fffd|mka"
cbrButton.OnAction = "ZSPoznamka"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Dodavatel"
cbrButton.OnAction = "ZSDodavatel"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "ZSZOu"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO da|fffd|ov|fffd|"
cbrButton.OnAction = "ZSZOd"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "DO |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "ZSDOu"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "DO da|fffd|ov|fffd|"
cbrButton.OnAction = "ZSDOd"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Stav"
cbrButton.OnAction = "ZSStav"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "Doklad"
cbrButton.OnAction = "ZSDoklad"

Set cbrButton = cbrMenu.Controls.Add(msoControlButton)
cbrButton.Caption = "CPA"
cbrButton.OnAction = "ZSCPA"


For i = 1 To cbrMenu.Controls.Count
  cbrMenu.Controls(i).State = msoButtonDown
Next
End If
End Sub

Sub ZS(ByVal index As String, ByVal cname As String)
  On Error Resume Next
  Application.ScreenUpdating = False
  Application.Sheets(ThisWorkbook.jm).Select
  If cbrMenu.Controls(index).State = msoButtonDown Then
    cbrMenu.Controls(index).State = msoButtonUp
    ActiveSheet.Range(cname).EntireColumn.Hidden = True
  Else
    cbrMenu.Controls(index).State = msoButtonDown
    ActiveSheet.Range(cname).EntireColumn.Hidden = False
  End If
  Application.ScreenUpdating = True
End Sub
Sub ZSMisto()
  ZS "M|fffd|sto", "M|fffd|sto"
End Sub
Sub ZSCislo()
  ZS "|fffd||fffd|slo", "|fffd||fffd|slo"
  
End Sub
Sub ZSNazev()
  ZS "N|fffd|zev", "N|fffd|zev"
End Sub
Sub ZSCena()
  ZS "Cena zv|fffd||fffd|en|fffd|", "Cena"
End Sub
Sub ZSZCUcetni()
  ZS "ZC |fffd||fffd|etn|fffd|", "ZC_|fffd||fffd|etn|fffd|"
End Sub
Sub ZSZCDanova()
  ZS "ZC da|fffd|ov|fffd|", "ZC_da|fffd|ov|fffd|"
End Sub
Sub ZSRok()
  ZS "Rok", "Rok"
End Sub
Sub ZSMesic()
  ZS "M|fffd|s|fffd|c", "M|fffd|s|fffd|c"
End Sub
Sub ZSDatum()
  ZS "Datum za|fffd|azen|fffd|", "Datum"
End Sub
Sub ZSTrida()
  ZS "T|fffd||fffd|da", "T|fffd||fffd|da"
End Sub
Sub ZSKategorie()
  ZS "Typ", "Kategorie"
End Sub
Sub ZSObor()
  ZS "Obor", "Obor"
End Sub
Sub ZSDruh()
  ZS "Druh", "Druh"
End Sub
Sub ZSKod()
  ZS "K|fffd|d", "K|fffd|d"
End Sub
Sub ZSSkupina()
  ZS "Skupina", "Skupina"
End Sub
Sub ZSPoradi()
  ZS "Po|fffd|ad|fffd|", "Po|fffd|ad|fffd|"
End Sub
Sub ZSSKP()
  ZS "SKP", "SKP"
End Sub
Sub ZSUcet()
  ZS "|fffd||fffd|et po|fffd||fffd|zen|fffd|", "|fffd||fffd|et"
End Sub
Sub ZSUcetMaj()
  ZS "|fffd||fffd|et majetkov|fffd|", "|fffd||fffd|et_majetkov|fffd|"
End Sub
Sub ZSUcetOpr()
  ZS "|fffd||fffd|et opr|fffd|vek", "|fffd||fffd|et_opr|fffd|vek"
End Sub
Sub ZSUcetOdpUc()
  ZS "|fffd||fffd|et odp. |fffd||fffd|.", "|fffd||fffd|et_odp._|fffd||fffd|."
End Sub
Sub ZSUcetOdpDan()
  ZS "|fffd||fffd|et odp. da|fffd|.", "|fffd||fffd|et_odp._da|fffd|."
End Sub
Sub ZSStredisko()
  ZS "St|fffd|edisko", "St|fffd|edisko"
End Sub
Sub ZSZakazka()
  ZS "Zak|fffd|zka", "Zak|fffd|zka"
End Sub
Sub ZSCinnost()
  ZS "|fffd|innost", "|fffd|innost"
End Sub
Sub ZSUsek()
  ZS "|fffd|sek", "|fffd|sek"
End Sub
Sub ZSBudova()
  ZS "Budova", "Budova"
End Sub
Sub ZSMistnost()
  ZS "M|fffd|stnost", "M|fffd|stnost"
End Sub
Sub ZSOsoba()
  ZS "Osoba", "Osoba"
End Sub
Sub ZSRokVyroby()
  ZS "Rok v|fffd|roby", "Rok_v|fffd|roby"
End Sub
Sub ZSVyrobniCislo()
  ZS "V|fffd|robn|fffd| |fffd||fffd|slo", "V|fffd|robn|fffd|_|fffd||fffd|slo"
End Sub
Sub ZSInv()
  ZS "Inv. |fffd|. p|fffd|vodn|fffd|", "Inv._|fffd|._p|fffd|vodn|fffd|"
End Sub
Sub ZSDatumInventury()
  ZS "Datum inventury", "Datum_inventury"
End Sub
Sub ZSPoznamka()
  ZS "Pozn|fffd|mka", "Pozn|fffd|mka"
End Sub

Sub ZSDodavatel()
  ZS "Dodavatel", "Dodavatel"
End Sub

Sub ZSStav()
  ZS "Stav", "Stav"
End Sub

Sub ZSZOu()
  ZS "ZO |fffd||fffd|etn|fffd|", "ZOu"
End Sub


Sub ZSZOd()
  ZS "ZO da|fffd|ov|fffd|", "ZOd"
End Sub


Sub ZSDOu()
  ZS "DO |fffd||fffd|etn|fffd|", "DOu"
End Sub


Sub ZSDOd()
  ZS "DO da|fffd|ov|fffd|", "DOd"
End Sub


Sub ZSDoklad()
  ZS "Doklad", "Doklad"
End Sub

Sub ZSCPA()
  ZS "CPA", "CPA"
End Sub


Sub MenuRazeni()
Dim cap As String
Dim cbrButton As CommandBarButton

' menu na t|fffd||fffd|zen|fffd|
cap = "|fffd|AZEN|fffd|"
On Error Resume Next
Application.CommandBars("Worksheet Menu Bar").Controls(cap).Visible = True
If Err.Number <> 5 Then
  Application.ScreenUpdating = True
Else
On Error GoTo 0
Set cbrMenuRazeni = Application.CommandBars("Worksheet Menu Bar").Controls.Add(Type:=msoControlPopup, temporary:=True)

cbrMenuRazeni.Caption = cap
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "M|fffd|sto, |fffd||fffd|slo"
cbrButton.OnAction = "TMC"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "N|fffd|zev"
cbrButton.OnAction = "TNazev"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Cena zv|fffd||fffd|en|fffd|"
cbrButton.OnAction = "TCena"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Datum za|fffd|azen|fffd|"
cbrButton.OnAction = "TDatum"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok"
cbrButton.OnAction = "TRok"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok+m|fffd|s|fffd|c"
cbrButton.OnAction = "TRokMesic"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "T|fffd||fffd|da"
cbrButton.OnAction = "TTrida"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Typ"
cbrButton.OnAction = "TKategorie"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Obor"
cbrButton.OnAction = "TObor"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh"
cbrButton.OnAction = "TDruh"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh+k|fffd|d"
cbrButton.OnAction = "TDruhKod"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Skupina"
cbrButton.OnAction = "TSkupina"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "SKP"
cbrButton.OnAction = "TSkp"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et po|fffd||fffd|zen|fffd|"
cbrButton.OnAction = "TUcet"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et majetkov|fffd|"
cbrButton.OnAction = "TUcetMaj"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et opr|fffd|vek"
cbrButton.OnAction = "TUcetOpr"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. |fffd||fffd|."
cbrButton.OnAction = "TUcetOdpUc"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. da|fffd|."
cbrButton.OnAction = "TUcetOdpDan"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "St|fffd|edisko"
cbrButton.OnAction = "TStredisko"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Zak|fffd|zka"
cbrButton.OnAction = "TZakazka"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|innost"
cbrButton.OnAction = "TCinnost"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|sek"
cbrButton.OnAction = "TUsek"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova"
cbrButton.OnAction = "TBudova"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova+m|fffd|stnost"
cbrButton.OnAction = "TBudMis"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Osoba"
cbrButton.OnAction = "TOsoba"
Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Inv. |fffd|. p|fffd|vodn|fffd|"
cbrButton.OnAction = "TInv"

Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Dodavatel"
cbrButton.OnAction = "TDodavatel"

Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "TZOu"

Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO da|fffd|ov|fffd|"
cbrButton.OnAction = "TZOd"

Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Stav"
cbrButton.OnAction = "TStav"

Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "Doklad"
cbrButton.OnAction = "TDoklad"

Set cbrButton = cbrMenuRazeni.Controls.Add(msoControlButton)
cbrButton.Caption = "CPA"
cbrButton.OnAction = "TCPA"


End If
id = 1885
End Sub

Sub Menu2DGrafy()
Dim cap As String
Dim cbrButton As CommandBarButton

' menu na na grupovani
cap = "2D"
On Error Resume Next
Application.CommandBars("Worksheet Menu Bar").Controls(cap).Visible = True
If Err.Number <> 5 Then
  Application.ScreenUpdating = True
Else
On Error GoTo 0
Set cbrMenuGrafy = Application.CommandBars("Worksheet Menu Bar").Controls.Add(Type:=msoControlPopup, temporary:=True)

cbrMenuGrafy.Caption = cap
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "M|fffd|sto"
cbrButton.OnAction = "GroupMisto"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok"
cbrButton.OnAction = "GroupRok"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok+m|fffd|s|fffd|c"
cbrButton.OnAction = "GroupRokMesic"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "T|fffd||fffd|da"
cbrButton.OnAction = "GroupTrida"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Typ"
cbrButton.OnAction = "GroupKategorie"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Obor"
cbrButton.OnAction = "GroupObor"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh"
cbrButton.OnAction = "GroupDruh"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh+k|fffd|d"
cbrButton.OnAction = "GroupDruhKod"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Skupina"
cbrButton.OnAction = "GroupSkupina"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "SKP"
cbrButton.OnAction = "GroupSkp"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et po|fffd||fffd|zen|fffd|"
cbrButton.OnAction = "GroupUcet"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et majetkov|fffd|"
cbrButton.OnAction = "GroupUcetMaj"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et opr|fffd|vek"
cbrButton.OnAction = "GroupUcetOpr"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. |fffd||fffd|."
cbrButton.OnAction = "GroupUcetOdpUc"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. da|fffd|."
cbrButton.OnAction = "GroupUcetOdpDan"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "St|fffd|edisko"
cbrButton.OnAction = "GroupStredisko"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Zak|fffd|zka"
cbrButton.OnAction = "GroupZakazka"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|innost"
cbrButton.OnAction = "GroupCinnost"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|sek"
cbrButton.OnAction = "GroupUsek"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova"
cbrButton.OnAction = "GroupBudova"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova+m|fffd|stnost"
cbrButton.OnAction = "GroupBM"
Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Osoba"
cbrButton.OnAction = "GroupOsoba"

Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Dodavatel"
cbrButton.OnAction = "GroupDodavatel"

Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "GroupZOu"

Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO da|fffd|ov|fffd|"
cbrButton.OnAction = "GroupZOd"

Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "Stav"
cbrButton.OnAction = "GroupStav"

Set cbrButton = cbrMenuGrafy.Controls.Add(msoControlButton)
cbrButton.Caption = "CPA"
cbrButton.OnAction = "GroupCPA"


End If
id = 1885
End Sub

Sub Menu3DGrafy()
Dim cbrButton As CommandBarButton
Dim cap As String
cap = "3D"
On Error Resume Next
Application.CommandBars("Worksheet Menu Bar").Controls(cap).Visible = True
If Err.Number <> 5 Then
  Application.ScreenUpdating = True
Else
On Error GoTo 0
' menu na na grupovani
Set Menu3D = Application.CommandBars("Worksheet Menu Bar").Controls.Add(Type:=msoControlPopup, temporary:=True)
Menu3D.Caption = cap

Set MenuX = Menu3D.Controls.Add(Type:=msoControlPopup, temporary:=True)
    MenuX.Caption = "Osa X"
Set MenuY = Menu3D.Controls.Add(Type:=msoControlPopup, temporary:=True)
    MenuY.Caption = "Osa Y"
Set MenuZ = Menu3D.Controls.Add(Type:=msoControlPopup, temporary:=True)
    MenuZ.Caption = "Osa Z"

' osa X
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "M|fffd|sto"
cbrButton.OnAction = "SetXMisto"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok"
cbrButton.OnAction = "SetXRok"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok+m|fffd|s|fffd|c"
cbrButton.OnAction = "SetXRM"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "T|fffd||fffd|da"
cbrButton.OnAction = "SetXTrida"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Typ"
cbrButton.OnAction = "SetXKategorie"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Obor"
cbrButton.OnAction = "SetXObor"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh"
cbrButton.OnAction = "SetXDruh"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh+k|fffd|d"
cbrButton.OnAction = "SetXDruhKod"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Skupina"
cbrButton.OnAction = "SetXSkupina"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "SKP"
cbrButton.OnAction = "SetXSKP"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et po|fffd||fffd|zen|fffd|"
cbrButton.OnAction = "SetXUP"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et majetkov|fffd|"
cbrButton.OnAction = "SetXUM"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et opr|fffd|vek"
cbrButton.OnAction = "SetXUO"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. |fffd||fffd|."
cbrButton.OnAction = "SetXUOU"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. da|fffd|."
cbrButton.OnAction = "SetXUOD"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "St|fffd|edisko"
cbrButton.OnAction = "SetXStredisko"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Zak|fffd|zka"
cbrButton.OnAction = "SetXZakazka"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|innost"
cbrButton.OnAction = "SetXCinnost"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|sek"
cbrButton.OnAction = "SetXUsek"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova"
cbrButton.OnAction = "SetXBudova"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova+m|fffd|stnost"
cbrButton.OnAction = "SetXBM"
Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Osoba"
cbrButton.OnAction = "SetXOsoba"

Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Dodavatel"
cbrButton.OnAction = "SetXDodavatel"

Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "SetXZOu"

Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO da|fffd|ov|fffd|"
cbrButton.OnAction = "SetXZOd"

Set cbrButton = MenuX.Controls.Add(msoControlButton)
cbrButton.Caption = "Stav"
cbrButton.OnAction = "SetXStav"


MenuX.Controls(1).State = msoButtonDown
x = "M|fffd|sto"
Xnad = "m|fffd|sta"

' osa Y
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "M|fffd|sto"
cbrButton.OnAction = "SetYMisto"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Rok"
cbrButton.OnAction = "SetYRok"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "T|fffd||fffd|da"
cbrButton.OnAction = "SetYTrida"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Typ"
cbrButton.OnAction = "SetYKategorie"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Obor"
cbrButton.OnAction = "SetYObor"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Druh"
cbrButton.OnAction = "SetYDruh"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Skupina"
cbrButton.OnAction = "SetYSkupina"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "SKP"
cbrButton.OnAction = "SetYSKP"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et po|fffd||fffd|zen|fffd|"
cbrButton.OnAction = "SetYUP"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et majetkov|fffd|"
cbrButton.OnAction = "SetYUM"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et opr|fffd|vek"
cbrButton.OnAction = "SetYUO"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. |fffd||fffd|."
cbrButton.OnAction = "SetYUOU"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd||fffd|et odp. da|fffd|."
cbrButton.OnAction = "SetYUOD"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "St|fffd|edisko"
cbrButton.OnAction = "SetYStredisko"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Zak|fffd|zka"
cbrButton.OnAction = "SetYZakazka"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|innost"
cbrButton.OnAction = "SetYCinnost"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "|fffd|sek"
cbrButton.OnAction = "SetYUsek"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Budova"
cbrButton.OnAction = "SetYBudova"
Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Osoba"
cbrButton.OnAction = "SetYOsoba"

Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Dodavatel"
cbrButton.OnAction = "SetYDodavatel"

Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "SetYZOu"

Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "ZO da|fffd|ov|fffd|"
cbrButton.OnAction = "SetYZOd"

Set cbrButton = MenuY.Controls.Add(msoControlButton)
cbrButton.Caption = "Stav"
cbrButton.OnAction = "SetYStav"



MenuY.Controls(2).State = msoButtonDown
Y = "Rok"
Ynad = "roku"

' osa Z
Set cbrButton = MenuZ.Controls.Add(msoControlButton)
cbrButton.Caption = "Cena zv|fffd||fffd|en|fffd|"
cbrButton.OnAction = "SetZCena"
Set cbrButton = MenuZ.Controls.Add(msoControlButton)
cbrButton.Caption = "ZC |fffd||fffd|etn|fffd|"
cbrButton.OnAction = "SetZUct"
Set cbrButton = MenuZ.Controls.Add(msoControlButton)
cbrButton.Caption = "ZC da|fffd|ov|fffd|"
cbrButton.OnAction = "SetZDan"


MenuZ.Controls(1).State = msoButtonDown
Z = "Cena zv|fffd||fffd|en|fffd|"
Znad = "Cena zv|fffd||fffd|en|fffd|"

Set cbrButton = Menu3D.Controls.Add(msoControlButton)
cbrButton.Caption = "Zobrazit"
cbrButton.OnAction = "Graf3D"

End If
id = 1885
End Sub

Sub SetX(ByVal popis As String, Optional ByVal NadpisX As String)
    If NadpisX = "" Then
      NadpisX = popis
    End If
    MenuX.Controls(x).State = msoButtonUp
    MenuX.Controls(popis).State = msoButtonDown
    x = popis
    Xnad = NadpisX
End Sub


Sub SetXMisto()
  SetX "M|fffd|sto", "m|fffd|sta"
End Sub
Sub SetXRok()
  SetX "Rok", "roku"
End Sub
Sub SetXRM()
  SetX "Rok+m|fffd|s|fffd|c", "Rok+m|fffd|s|fffd|c"
End Sub
Sub SetXTrida()
  SetX "T|fffd||fffd|da", "t|fffd||fffd|dy"
End Sub
Sub SetXKategorie()
  SetX "Typ", "typu"
End Sub
Sub SetXObor()
  SetX "Obor", "oboru"
End Sub
Sub SetXDruh()
  SetX "Druh", "druhu"
End Sub
Sub SetXDruhKod()
  SetX "Druh+k|fffd|d", "druh+k|fffd|d"
End Sub
Sub SetXSkupina()
  SetX "Skupina", "skupiny"
End Sub
Sub SetXSKP()
  SetX "SKP"
End Sub
Sub SetXUP()
  SetX "|fffd||fffd|et po|fffd||fffd|zen|fffd|", "|fffd||fffd|tu po|fffd||fffd|zen|fffd|"
End Sub
Sub SetXUM()
  SetX "|fffd||fffd|et majetkov|fffd|", "|fffd||fffd|tu majetkov|fffd|ho"
End Sub
Sub SetXUO()
  SetX "|fffd||fffd|et opr|fffd|vek", "|fffd||fffd|tu opr|fffd|vek"
End Sub
Sub SetXUOU()
  SetX "|fffd||fffd|et odp. |fffd||fffd|.", "|fffd||fffd|tu odp. |fffd||fffd|."
End Sub
Sub SetXUOD()
  SetX "|fffd||fffd|et odp. da|fffd|.", "|fffd||fffd|tu odp. da|fffd|."
End Sub
Sub SetXStredisko()
  SetX "St|fffd|edisko", "st|fffd|ediska"
End Sub
Sub SetXZakazka()
  SetX "Zak|fffd|zka", "zak|fffd|zky"
End Sub
Sub SetXCinnost()
  SetX "|fffd|innost", "|fffd|innosti"
End Sub
Sub SetXUsek()
  SetX "|fffd|sek", "|fffd|seku"
End Sub
Sub SetXBudova()
  SetX "Budova", "budovy"
End Sub
Sub SetXBM()
  SetX "Budova+m|fffd|stnost", "budova+m|fffd|stnost"
End Sub
Sub SetXOsoba()
  SetX "Osoba", "osoby"
End Sub


Sub SetXDodavatel()
  SetX "Dodavatel", "dodavatele"
End Sub
Sub SetYDodavatel()
  SetY "Dodavatel", "dodavatele"
End Sub

Sub SetXStav()
  SetX "Stav", "stavu"
End Sub
Sub SetYStav()
  SetY "Stav", "stavu"
End Sub


Sub SetXZOu()
  SetX "ZO |fffd||fffd|etn|fffd|", "ZO |fffd||fffd|etn|fffd|ho"
End Sub
Sub SetYZOu()
  SetY "ZO |fffd||fffd|etn|fffd|", "ZO |fffd||fffd|etn|fffd|ho"
End Sub

Sub SetXZOd()
  SetX "ZO da|fffd|ov|fffd|", "ZO da|fffd|ov|fffd|ho"
End Sub
Sub SetYZOd()
  SetY "ZO da|fffd|ov|fffd|", "ZO da|fffd|ov|fffd|ho"
End Sub


Sub SetY(ByVal popis As String, Optional ByVal NadpisY As String)
    If NadpisY = "" Then
      NadpisY = popis
    End If
    MenuY.Controls(Y).State = msoButtonUp
    MenuY.Controls(popis).State = msoButtonDown
    Y = popis
    Ynad = NadpisY
End Sub


Sub SetYMisto()
  SetY "M|fffd|sto", "m|fffd|sta"
End Sub
Sub SetYRok()
  SetY "Rok", "roku"
End Sub
Sub SetYTrida()
  SetY "T|fffd||fffd|da", "t|fffd||fffd|dy"
End Sub
Sub SetYKategorie()
  SetY "Typ", "typu"
End Sub
Sub SetYObor()
  SetY "Obor", "oboru"
End Sub
Sub SetYDruh()
  SetY "Druh", "druhu"
End Sub
Sub SetYSkupina()
  SetY "Skupina", "skupiny"
End Sub
Sub SetYSKP()
  SetY "SKP"
End Sub
Sub SetYUP()
  SetY "|fffd||fffd|et po|fffd||fffd|zen|fffd|", "|fffd||fffd|tu po|fffd||fffd|zen|fffd|"
End Sub
Sub SetYUM()
  SetY "|fffd||fffd|et majetkov|fffd|", "|fffd||fffd|tu majetkov|fffd|ho"
End Sub
Sub SetYUO()
  SetY "|fffd||fffd|et opr|fffd|vek", "|fffd||fffd|tu opr|fffd|vek"
End Sub
Sub SetYUOU()
  SetY "|fffd||fffd|et odp. |fffd||fffd|.", "|fffd||fffd|tu odp. |fffd||fffd|."
End Sub
Sub SetYUOD()
  SetY "|fffd||fffd|et odp. da|fffd|.", "|fffd||fffd|tu odp. da|fffd|."
End Sub
Sub SetYStredisko()
  SetY "St|fffd|edisko", "st|fffd|ediska"
End Sub
Sub SetYZakazka()
  SetY "Zak|fffd|zka", "zak|fffd|zky"
End Sub
Sub SetYCinnost()
  SetY "|fffd|innost", "|fffd|innosti"
End Sub
Sub SetYUsek()
  SetY "|fffd|sek", "|fffd|seku"
End Sub
Sub SetYBudova()
  SetY "Budova", "budovy"
End Sub
Sub SetYOsoba()
  SetY "Osoba", "osoby"
End Sub

Sub SetZ(ByVal popis As String, Optional ByVal NadpisZ As String)
    If NadpisZ = "" Then
      NadpisZ = popis
    End If
    MenuZ.Controls(Z).State = msoButtonUp
    MenuZ.Controls(popis).State = msoButtonDown
    Z = popis
    Znad = NadpisZ
End Sub

Sub SetZCena()
  SetZ "Cena zv|fffd||fffd|en|fffd|", "Cena zv|fffd||fffd|en|fffd|"
End Sub
Sub SetZUct()
  SetZ "ZC |fffd||fffd|etn|fffd|", "ZC |fffd||fffd|etn|fffd|"
End Sub
Sub SetZDan()
  SetZ "ZC da|fffd|ov|fffd|", "ZC da|fffd|ov|fffd|"
End Sub
Sub SetCPA()
  SetZ "CPA", "CPA"
End Sub


Sub Graf3D()
Dim tname As String
Dim r As Long
Dim s As Long
Dim t As Long
Dim l As Long
Dim nazev As String
Dim sel As Range
Dim xx As Range
Dim pomchart
Dim pomser
Dim str As String
Dim i As Long

Application.ScreenUpdating = False

If x = Y Then
    MsgBox "Nelze vyn|fffd|st stejnou veli|fffd|inu na osu X i Y !!!"
    Exit Sub
End If

nazev = "N|fffd|zev 3D Grafu"
tname = "Graf3d" & x & Y & MenuZ.Controls(Z).index

'vlozil marek
If (x = "|fffd||fffd|et opr|fffd|vek" And Y = "|fffd||fffd|et odp. |fffd||fffd|.") Or (Y = "|fffd||fffd|et opr|fffd|vek" And x = "|fffd||fffd|et odp. |fffd||fffd|.") Then tname = "Graf3d Opr.Odp." & MenuZ.Controls(Z).index

If exist(tname) = 1 Then
  Exit Sub
End If
  
  Sheets(ThisWorkbook.jm).Select
  
  If x = "Druh+k|fffd|d" Then
    spoj "Druh+k|fffd|d", "Druh", "K|fffd|d", "=CONCATENATE(RC[-22],""+"",RC[-21])"
  End If
  
  If x = "Rok+m|fffd|s|fffd|c" Then
    spoj "Rok+m|fffd|s|fffd|c", "Rok", "M|fffd|s|fffd|c", "=CONCATENATE(RC[-27],""+"", if(len(RC[-26])=2,"""", if(len(RC[-26])=0,"""",""0"")),RC[-26])"
  End If
  
  If x = "Budova+m|fffd|stnost" Then
    spoj "Budova+m|fffd|stnost", "Budova", "M|fffd|stnost", "=CONCATENATE(RC[-8],""+"",RC[-7])"
  End If
  
  Range("A1").Select
  
  ActiveSheet.PivotTableWizard TableDestination:="", TableName:=tname
  ActiveSheet.PivotTables(tname).AddFields RowFields:= _
      x, ColumnFields:=Y
  ActiveSheet.PivotTables(tname).PivotFields(Z). _
      Orientation = xlDataField
  ActiveSheet.Name = tname
    
    Sheets(tname).Move After:=Sheets(2)
    ActiveSheet.PageSetup.Orientation = xlLandscape
    ActiveSheet.Range("A2").Select
    r = ActiveCell.CurrentRegion.Rows.Count
    s = ActiveCell.CurrentRegion.Columns.Count
    Range(Selection.Cells(r + 2, 2), Selection.Cells(r + 2, 2)).Select
    t = ActiveCell.Top
    l = (Range("A1").Top + ActiveCell.Left) / 2
    ActiveSheet.Range("A2").Select
        
    Application.CommandBars("PivotTable").Visible = False

    Set sel = Range(Selection.Cells(2, 1), Selection.Cells(r - 2, s - 1))
    Set xx = Range(Selection.Cells(2, 1), Selection.Cells(r - 2, 1))
    
    Range("AA11").Select
    Charts.Add
    
    ActiveChart.ChartType = xl3DColumn
    
    ActiveChart.SetSourceData Source:=Sheets(tname).Range("AA11")
    For i = 1 To s - 2
      ActiveChart.SeriesCollection.NewSeries
      ActiveChart.SeriesCollection(i).Values = "='" & tname & "'!R3C" & i + 1 & ":R" & r - 1 & "C" & i + 1
      ActiveChart.SeriesCollection(i).Name = "='" & tname & "'!R2C" & i + 1
    Next
    ' nastaveni popisek osy x
    ActiveChart.SeriesCollection(1).XValues = "='" & tname & "'!R3C1:R" & r - 1 & "C1"
    
    ActiveChart.Location Where:=xlLocationAsObject, Name:=tname
    
    With ActiveChart
        .HasTitle = True
        .ChartTitle.Characters.Text = "DM - " & Znad & " dle " & Xnad & " a " & Ynad
        .Axes(xlCategory).HasTitle = True
        .Axes(xlCategory).AxisTitle.Characters.Text = x
        .Axes(xlSeries).HasTitle = True
        .Axes(xlSeries).AxisTitle.Characters.Text = Y
        .Axes(xlValue).HasTitle = True
        .Axes(xlValue).AxisTitle.Characters.Text = Z
    End With
    
    ActiveChart.Axes(xlCategory).Select
    Selection.TickLabels.AutoScaleFont = False
    ActiveChart.ChartTitle.Select
    Selection.AutoScaleFont = False
    With Selection.Font
        .ColorIndex = 3
        .Size = 16
    End With

    ActiveChart.Axes(xlCategory).AxisTitle.Select
    Selection.AutoScaleFont = False
    With Selection.Font
        .Size = 12
    End With
    
    ActiveChart.Axes(xlValue).AxisTitle.Select
    With Selection
        .Orientation = xlUpward
    End With
    
    ActiveChart.Axes(xlValue).Select
    Selection.TickLabels.AutoScaleFont = False
    With Selection.TickLabels.Font
        .Size = 12
    End With
    ActiveChart.Axes(xlSeries).AxisTitle.Select
    Selection.AutoScaleFont = False
    With Selection.Font
        .Size = 12
    End With
    ActiveChart.Axes(xlValue).AxisTitle.Select
    Selection.AutoScaleFont = False
    With Selection.Font
        .Size = 12
    End With
    
    ActiveChart.Axes(xlSeries).Select
    Selection.TickLabels.AutoScaleFont = False
    With Selection.TickLabels.Font
        .Size = 10
    End With
    
    ActiveChart.Legend.Select
    Selection.Delete
    ActiveChart.PlotArea.Select
    With ActiveChart
        .Rotation = 40
    End With
    
    ActiveChart.Axes(xlCategory).Select
    Selection.TickLabels.Orientation = 65
    
    ActiveChart.Axes(xlSeries).Select
    Selection.TickLabels.Orientation = -45
    
    ActiveChart.ChartArea.Select
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Top = t
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Left = l
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Width = Range("IT22").Width * 10
    ActiveSheet.Shapes(ActiveSheet.Shapes.Count).Height = Range("IT22").Height * 23
    
' jinak se nepresunul nazev os na spravne misto ;-((
Application.ScreenUpdating = True
    
    ActiveChart.Axes(xlCategory).AxisTitle.Left = 150
    ActiveChart.Axes(xlCategory).AxisTitle.Top = 261
    
    ActiveChart.Axes(xlSeries).AxisTitle.Left = 350
    ActiveChart.Axes(xlSeries).AxisTitle.Top = 261

    Range("A1").Select

Application.ScreenUpdating = False
    
    Sheets(ThisWorkbook.jm).Select
    If x = "Druh+k|fffd|d" Or x = "Budova+m|fffd|stnost" Or x = "Rok+m|fffd|s|fffd|c" Then
      Columns(Range("A1").CurrentRegion.Columns.Count).Select
      Selection.Delete Shift:=xlToLeft
      Range("A1").Select
    End If
    Sheets(tname).Select
Application.ScreenUpdating = True
    
End Sub


Attribute VB_Name = "Module1"
Public stav_menu

'vytvori menu a vrati objekt menu (Marek)
Function vytvor_menu(ByVal menu_text As String, ByVal menu_pole As Variant, ByVal id_pole As Variant) As Object

Dim mujButton As CommandBarButton
Dim cbrMenu As CommandBarPopup
Dim j As Integer
Dim chyba As Integer
Dim m_text As String
    
    'kopie hodnoty promenne
    m_text = menu_text
    chyba = 1
    On Error Resume Next
    
line1:

    'test zda je vytvorene menu
    Application.CommandBars("Worksheet Menu Bar").Controls(m_text).Visible = True
    If Err.Number = 5 Then
        'neni dosud vytvorene
        Set cbrMenu = Application.CommandBars("Worksheet Menu Bar").Controls.Add(Type:=msoControlPopup, temporary:=True)
        cbrMenu.Caption = m_text
    Else
        chyba = chyba + 1
        m_text = menu_text & "(" & chyba & ")"
        'skoc nahoru a zkus to znova
        GoTo line1:
    End If
    
    'uz je vytvorene menu
    On Error GoTo 0
    
    For j = 0 To UBound(menu_pole) Step 2
        Set mujButton = cbrMenu.Controls.Add(msoControlButton)
        mujButton.Caption = menu_pole(j)
        mujButton.OnAction = menu_pole(j + 1)
    Next j
    
    Set vytvor_menu = cbrMenu
    'nastaveni vlajecky
    id = 1885
    'zmena nazvu
    If chyba > 1 Then
        chybova_hlaska 1
    End If
    
    'nastaveni vlajek pri rekonstrukci
    Application.ScreenUpdating = False
    m_text = ActiveSheet.Name
    
    For j = 0 To UBound(id_pole)
        If list_exist(id_pole(j)) Then cbrMenu.Controls(j + 1).FaceId = id
    Next j
    
    Sheets(m_text).Select
    Application.ScreenUpdating = True
    
    Set vytvor_menu = cbrMenu
End Function

Sub zrus_menu(ByVal moje_menu As Variant)

Dim mujButton As CommandBarButton
Dim cbrMenu As CommandBar
Dim i As Integer
Dim m_text As String

    On Error Resume Next
    For i = 0 To UBound(moje_menu)
        'existuje menu?
        Application.CommandBars("Worksheet Menu Bar").Controls(moje_menu(i)).Visible = True
        If Err.Number = 0 Then
            Set cbrMenu = Application.CommandBars("Worksheet Menu Bar")
            cbrMenu.Controls(moje_menu(i)).Delete
        End If
    Next i
    On Error GoTo 0
End Sub

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Option Explicit

Public sablona As String
Public jm As String

Private Sub Workbook_Activate()

    If stav_menu < 100 Then
        MenuSloupce
        MenuRazeni
        Menu2DGrafy
        Menu3DGrafy
    End If

End Sub

Private Sub Workbook_Deactivate()
    If stav_menu < 100 Then zrus_menu Array("SLOUPCE", "|fffd|AZEN|fffd|", "2D", "3D")
End Sub



Private Sub Workbook_Open()
Dim pos As Long
Dim SecondFileName As String
Dim Calc As String
Dim r As Integer
Dim i As Integer
Dim cbrMyMenu
Dim cbrButton As CommandBarButton

On Error Resume Next
stav_menu = 100

Application.ScreenUpdating = False
jm = "MAJ_ISI"
pos = InStr(Name, ".")
sablona = Name
If pos > 0 Then
  pos = InStr(Name, jm)
  SecondFileName = Path & "\" & "calc" & Mid(Name, Len(jm) + 1)
End If
    Application.Workbooks.OpenText SecondFileName, Origin:= _
        xlWindows, StartRow:=1, DataType:=xlDelimited, TextQualifier:= _
        xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, _
        Comma:=False, Space:=False, Other:=False, FieldInfo:=Array(Array(1, 1), _
        Array(2, 2), Array(3, 1), Array(4, 1), Array(5, 1), Array(6, 1), Array(7, 1), Array(8, 1), _
        Array(9, 1), Array(10, 1), Array(11, 2), Array(12, 2), Array(13, 2), Array(14, 2), Array(15 _
        , 2), Array(16, 1), Array(17, 1), Array(18, 2), Array(19, 2), Array(20, 2), Array(21, 2), _
        Array(22, 2), Array(23, 2), Array(24, 2), Array(25, 2), Array(26, 2), Array(27, 2), Array( _
        28, 2), Array(29, 2), Array(30, 2), Array(31, 1), Array(32, 2), Array(33, 2), Array(34, 1), _
        Array(35, 2), Array(36, 1), Array(37, 1), Array(38, 1), Array(39, 1))

If Err Then
Else
On Error GoTo 0
Calc = "calc" & Mid(Name, Len(jm) + 1)
jm = "IM"

' prekopirovani do listu data_SUMO a prostredi
    Range("A3").Select
    ActiveCell.CurrentRegion.Select
    r = Selection.Columns.Count
    Selection.Copy
    Windows(sablona).Activate
    Sheets("data_SUMO").Select
    ActiveSheet.Paste
    Range("A1").Select
    Application.Windows(Calc).Activate
    Rows("1:1").Select
    Selection.Copy
    Application.Windows(sablona).Activate
    Sheets("prostredi").Select
    Range("B1").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=True
    Columns("B:B").Select
    Selection.Columns.AutoFit
    Range("A1").Select
    Application.CutCopyMode = False
    Sheets("data_SUMO").Select
    Cells.Font.Name = "Tahoma"
    For i = 1 To r
      Columns(i).Select
      Selection.Columns.AutoFit
    Next
    Range("A1").Select
    Sheets(jm).Name = Sheets("prostredi").Cells(1, 2).Value
    jm = Sheets("prostredi").Cells(1, 2).Value
    Sheets(jm).Select
    Range("A1").Select
    
' odstraneni prvniho sloupce (jen datoveho)
    Application.Windows(Calc).Activate
    Range("A1").Select
    ActiveCell.CurrentRegion.Select
    Selection.Copy
    Range("B1").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Columns("A:A").Select
    Selection.Delete Shift:=xlToLeft
    
' proste zkopirovani dat
    Application.Windows(Calc).Activate
    Range("A3").Select
    ActiveCell.CurrentRegion.Select
    Selection.Copy
    Windows(sablona).Activate
    Range("A2").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Range("A1").Select

' odstraneni hlavicky
    Rows("2:2").Select
    Selection.Delete Shift:=xlUp

' roztazeni sirky sloupcu podle dat
    For i = 1 To r
      Columns(i).Select
      Selection.Columns.AutoFit
    Next
    
    Range("A1").Select
    nastav_hp
    
    Application.Windows(Calc).Close (False)
End If

'MenuSloupce
'MenuRazeni
'Menu2DGrafy
'Menu3DGrafy
'ActiveWorkbook.Save
Application.ScreenUpdating = True
stav_menu = 0
End Sub



INQUEST-PP=macro
