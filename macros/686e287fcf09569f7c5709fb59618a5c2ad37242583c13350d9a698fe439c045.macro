Attribute VB_Name = "List1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Private Sub Worksheet_Change(ByVal Target As Range)
  If Selection.Rows.Count > 1 Then Exit Sub
  If Selection.Columns.Count > 1 Then Exit Sub
  If flagSkrytRekapitulace = True Then
    flagSkrytRekapitulace = False
    Exit Sub
  End If
  If flagBylFormular = True Then
    flagBylFormular = False
    Exit Sub
  End If
  soubor = ActiveWorkbook.Name
  r = Target.Row
  s = Target.Column
  k = Range("A11").End(xlDown).Row
  If r > 11 And r <= k And s = 2 Then
    'zapis ostatn|fffd| sloupce
    X = Target.Value
    Z = Sheets("List2").Range("A5").End(xlDown).Row
    For i = 6 To Z
      If UCase(X) = UCase(Sheets("List2").Cells(i, 1)) Then
        If Range("A4") = "Nab|fffd|dka" Then
          'popis cz
          flagBylFormular = True
          Sheets("List1").Cells(r, 3) = Sheets("List2").Cells(i, 2)
          'Jcena Kc
          flagBylFormular = True
          Sheets("List1").Cells(r, 5) = Sheets("List2").Cells(i, 6)
          'nakupka Kc
          flagBylFormular = True
          Sheets("List1").Cells(r, 9) = Sheets("List2").Cells(i, 3)
        ElseIf Range("A4") = "Offer" Then
          'popis en
          flagBylFormular = True
          Sheets("List1").Cells(r, 3) = Sheets("List2").Cells(i, 9)
          'Jcena Eur
          flagBylFormular = True
          Sheets("List1").Cells(r, 5) = Sheets("List2").Cells(i, 7)
          'nakupka Eur
          flagBylFormular = True
          Sheets("List1").Cells(r, 9) = Sheets("List2").Cells(i, 12)
        ElseIf Range("A4") = "Ponuka" Then
          flagBylFormular = True
          Sheets("List1").Cells(r, 3) = Sheets("List2").Cells(i, 11)
          flagBylFormular = True
          Sheets("List1").Cells(r, 5) = Sheets("List2").Cells(i, 7)
          flagBylFormular = True
          Sheets("List1").Cells(r, 9) = Sheets("List2").Cells(i, 12)
        End If
        'skupina
        flagBylFormular = True
        Sheets("List1").Cells(r, 7) = Sheets("List2").Cells(i, 4)
        'vzorec sl F
        flagBylFormular = True
        Sheets("List1").Cells(r, 6).FormulaR1C1 = "=RC[-1]*RC[-2]"
        'vzorec sl J
        flagBylFormular = True
        Sheets("List1").Cells(r, 10).FormulaR1C1 = "=RC[-1]*RC[-6]"
        'obarvi cervene sl 9 a 10
        Sheets("List1").Cells(r, 9).Font.ColorIndex = 3
        Sheets("List1").Cells(r, 10).Font.ColorIndex = 3
        Exit Sub
      End If
    Next i
  End If
End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
  If Selection.Rows.Count > 1 Then Exit Sub
  r = Target.Row
  s = Target.Column
  k = Range("A11").End(xlDown).Row
  If r = 6 And s = 2 Then
    Application.OnKey "{TAB}", "TestTAB"
    radek = r
  ElseIf r > 11 And r <= k And s = 2 Then
    'aktivuj klavesu TAB pro zobrazeni formulare zbozi
    Application.OnKey "{TAB}", "TestTAB"
    radek = r
    'frmZbozi.Show
  Else
    Application.OnKey "{TAB}"
  End If
End Sub
Attribute VB_Name = "Module1"
Public scest, n, cesta, soubor, radek, cesta0, flagBylFormular, flagZmenaIndexu, flagSkrytRekapitulace
Public puvNazev 'puvodni nazev souboru pri zmene
Public akce1, zakaznik1, poznamka1, krukam1
Public vyska, sirka, zleva, nad

Sub VypracovalPodepsal()
  If Sheets("list1").Range("F8") <> "" Then Exit Sub
  'cesta
  cesta = ActiveWorkbook.Path
  Do Until Right(cesta, 1) = ":"
    cesta = Left(cesta, Len(cesta) - 1)
  Loop
  f = FreeFile
  If Dir(cesta & "cfg.txt") <> "cfg.txt" Then
    Open cesta & "cfg.txt" For Output As #f
    Print #f, cesta
    Print #f, "Michal |fffd|eda"
    Print #f, "Michal |fffd|eda"
    Close #f
  End If
  Open cesta & "cfg.txt" For Input As #f
  Input #f, cesta0
  Input #f, vypracoval
  Input #f, podepsal
  Close #f
  Sheets(1).Range("F8") = vypracoval
  For i = 10000 To 11 Step -1
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  Sheets(1).Cells(i + 28, 5) = podepsal
End Sub
Sub NactiZboziDoListu2()
esta = ActiveWorkbook.Path
  soubor = ActiveWorkbook.Name
  If Not (soubor = "Nab_cz.xls" Or soubor = "Nab_en.xls" Or soubor = " Nab_sk.xls") Then
    Exit Sub
  End If
  'nacist zbozi
  s = ActiveWorkbook.Path & ":Zbozi.xlsx"
  Workbooks.Open Filename:=s, UpdateLinks:=0
  n = ActiveWorkbook.Name
  euro = Sheets(2).Range("F3")
  Windows("Nab_cz.xls").Activate
  Windows(soubor).Activate
  r = Workbooks(n).Sheets("List1").Range("A65535").End(xlUp).Row
  Workbooks(soubor).Sheets("List2").Range("A5:N20000").ClearContents
  'DB zacina na A5
  'DB zacina na A5
  Workbooks(n).Sheets("List1").Range("A1:N" & r).Copy
  Workbooks(soubor).Sheets("List2").Select
  Range("A5").Select
  Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
  'Workbooks(n).Sheets("List1").Range("A1:L" & r).Copy Workbooks(soubor).Sheets("List2").Range("A5")
  Application.CutCopyMode = False
  Workbooks(n).Close savechanges:=False
  'zapis kurz eura
  Sheets("List2").Range("F3") = euro
  'odstranit prazdne radky
  For i = r + 4 To 5 Step -1
    If Sheets("List2").Cells(i, 1) = "" Or Sheets("List2").Cells(i, 2) = "" Then
      Sheets("List2").Cells(i, 1).EntireRow.Delete
      i = i + 1
    End If
  Next i
  'seradit podle 1. sloupce
  ActiveWorkbook.Worksheets("List2").Select
  Range("A5").Select
  r = ActiveWorkbook.Sheets("List2").Range("A5").End(xlDown).Row
  ActiveWorkbook.Worksheets("List1").Select
  ActiveWorkbook.Worksheets("List2").Sort.SortFields.Clear
  ActiveWorkbook.Worksheets("List2").Sort.SortFields.Add Key:=Range("A7:A" & r) _
     , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
  With ActiveWorkbook.Worksheets("List2").Sort
        .SetRange Range("A5:N" & r)
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
  End With
End Sub
Sub NaplnLstZbozi()
  r = Sheets("List2").Range("A5").End(xlDown).Row
  frmZbozi.lstZbozi.Clear
  frmZbozi.lstPopis.Clear
  frmZbozi.lstJC.Clear
  frmZbozi.lstSkupina.Clear
  frmZbozi.lstNakupka.Clear
  
  frmZbozi.lstDbRs.Clear
  frmZbozi.lstDbIrc.Clear
  
  soubor = ActiveWorkbook.Name
  For i = 6 To r
      'zbozi
      frmZbozi.lstZbozi.AddItem Sheets("List2").Cells(i, 1)
      If Range("A4") = "Nab|fffd|dka" Then
        'popis cz
        frmZbozi.lstPopis.AddItem Sheets("List2").Cells(i, 2)
        'Jcena Kc
        frmZbozi.lstJC.AddItem Sheets("List2").Cells(i, 6)
        'nakupka Kc
        frmZbozi.lstNakupka.AddItem Sheets("List2").Cells(i, 3)
      ElseIf Range("A4") = "Nab|fffd|dka" Then
        'popis en
        frmZbozi.lstPopis.AddItem Sheets("List2").Cells(i, 9)
        'Jcena Eur
        frmZbozi.lstJC.AddItem Sheets("List2").Cells(i, 7)
        'nakupka Eur
        frmZbozi.lstNakupka.AddItem Sheets("List2").Cells(i, 12)
      ElseIf Range("A4") = "n|fffd|mecky" Then
        frmZbozi.lstPopis.AddItem Sheets("List2").Cells(i, 10)
        frmZbozi.lstJC.AddItem Sheets("List2").Cells(i, 7)
        frmZbozi.lstNakupka.AddItem Sheets("List2").Cells(i, 12)
      ElseIf Range("A4") = "Ponuka" Then
        frmZbozi.lstPopis.AddItem Sheets("List2").Cells(i, 11)
        frmZbozi.lstJC.AddItem Sheets("List2").Cells(i, 7)
        frmZbozi.lstNakupka.AddItem Sheets("List2").Cells(i, 12)
      End If
      frmZbozi.lstSkupina.AddItem Sheets("List2").Cells(i, 4)
      'DB RS
      frmZbozi.lstDbRs.AddItem Sheets("List2").Cells(i, 13)
      'DB IRC
      frmZbozi.lstDbIrc.AddItem Sheets("List2").Cells(i, 14)
  Next i
End Sub

Sub NaplnLstZakaznik()
  'nacist zakazniky
  
  scest = ActiveWorkbook.Name
  s = ActiveWorkbook.Path & ":kontakty_SM.xls"
  Workbooks.Open Filename:=s, UpdateLinks:=0
  n = ActiveWorkbook.Name
  r = Workbooks(n).Sheets(1).Range("A65536").End(xlUp).Row
  frmZakaznik.lstZakaznici.Clear
  For i = 2 To r
    frmZakaznik.lstZakaznici.AddItem Sheets(1).Cells(i, 1) & " = " & Sheets(1).Cells(i, 3) & _
       " " & Sheets(1).Cells(i, 4) & " = " & Sheets(1).Cells(i, 9)
  Next i
  
  
  
End Sub

Sub UlozitVse()
  'test jestli neukladam vzor
  soubor = ActiveWorkbook.Name
  'If Not (soubor = "Nab_cz.xlsm" Or soubor = "Nab_en.xlsm" Or soubor = "Nab_sk.xlsm") Then
    'soubor = ActiveWorkbook.Name
    'Workbooks.Open Filename:=cesta0 & "\Nab|fffd|dkov|fffd| SW.xlsm"
    'Workbooks(soubor).Close savechanges:=True
  'End If
  'test vyplneni Akce
  If Sheets("List1").Range("B5") = "" Then
    MsgBox "Nen|fffd| vyplnena akce"
    Exit Sub
  End If
  'ulozi Nab. do Nabidky zdroj, Nab upravenou do Nabidky k odeslani, zapise do Prehled_KV
  h = MsgBox("Opravdu ulozit dokoncenou nabidku?", vbYesNo)
  If h = vbNo Then Exit Sub
  'puvodni soubor pri zmene
  puvNazev = Left(soubor, Len(soubor) - 4)
  'pamatuj cestu k aktualnimu souboru
  ces = ActiveWorkbook.Path
  'akce
  akce0 = Sheets("List1").Range("B5")
  If akce0 = "" Then akce0 = "-"
  'odstranit mezery
  d = Len(akce0)
  akce = ""
  For i = 1 To d
    zn = Mid(akce0, i, 1)
    If zn <> " " Then
      akce = akce & zn
    End If
  Next i
  d = Len(akce)
  If d > 8 Then akce = Left(akce, 8)
  'If d < 8 Then akce = akce & String(8 - d, "-")
  'zakaznik
  zakaznik0 = Sheets("List1").Range("B6")
  If zakaznik0 = "" Then zakaznik0 = "-"
  'If Left(zakaznik0, 3) = "---" Then zakaznik0 = Range("B7")
  'odstranit mezery
  d = Len(zakaznik0)
  zakaznik = ""
  For i = 1 To d
    zn = Mid(zakaznik0, i, 1)
    If zn <> " " Then
      zakaznik = zakaznik & zn
    End If
  Next i
  d = Len(zakaznik)
  If d > 8 Then zakaznik = Left(zakaznik, 8)
  'If d < 8 Then zakaznik = akce & String(8 - d, "-")
  'poznamka
  poznamka0 = Sheets("List1").Range("F6")
  If poznamka0 = "" Then poznamka0 = "-"
  'odstranit mezery
  d = Len(poznamka0)
  poznamka = ""
  For i = 1 To d
    zn = Mid(poznamka0, i, 1)
    If zn <> " " Then
      poznamka = poznamka & zn
    End If
  Next i
  d = Len(poznamka)
  If d > 4 Then poznamka = Left(poznamka, 4)
  'If d < 4 Then poznamka = poznamka & String(4 - d, "-")
  'k rukam
  krukam0 = Sheets("List1").Range("B7")
  If krukam0 = "" Then krukam0 = "-"
  'datum nabidky
  datumNabidky0 = Sheets("List1").Range("F7")
  'autor
  autor0 = Sheets("List1").Range("F8")
  'cena
  rc = Sheets("List1").Range("A65635").End(xlUp).Row
opet:
  If Left(Sheets("List1").Cells(rc, 1), 17) = "Celkem za dod|fffd|vku" Then
    cena0 = Sheets("List1").Cells(rc, 6)
  Else
    rc = rc - 1
    GoTo opet
  End If
  'nazev souboru nabidky
  soubor = ActiveWorkbook.Name
  If Range("A4") = "Nab|fffd|dka" Then
    zacNazev = "Nab"
  ElseIf Range("A4") = "Ponuka" Then
    zacNazev = "Pon"
  ElseIf Range("A4") = "Offer" Then
    zacNazev = "Bid"
  Else
    MsgBox "Spatny n|fffd|zev vzorov|fffd|ho souboru - mus|fffd| byt Nab_cz.xls, Nab_en.xls, Nab_sk.xls!"
    Exit Sub
  End If
  nazev = zacNazev & "_" & Format(Date, "yymmdd") _
    & "_" & akce & "_" & zakaznik & "_" & poznamka
  If puvNazev = nazev Then
    'je to zmena a datum, akce, zakaznik, poznamka se nezmenily
    GoTo pokracuj
  Else
    'je to nova nabidka nebo zmena a datum, akce, zakaznik, poznamka se zmenily
    puvNazevP = puvNazev & ".xls"
    If Not (puvNazevP = "Nab_cz.xls" Or puvNazevP = "Nab_en.xls" Or puvNazevP = "Nab_sk.xls") Then
      'je to nova nabidka
      h = MsgBox("ZMENA: Puvodn|fffd| n|fffd|zev souboru se zmenil" & _
        vbCrLf & "z duvodu zmen datumu, akce, z|fffd|kaznika nebo pozn|fffd|mky." & _
        vbCrLf & vbCrLf & "Chcete ulozit zmenu s novym n|fffd|zvem (Ano)?" & _
        vbCrLf & "Ulozit jako novy soubor (ne)?" & _
        vbCrLf & "Nebo zrusit ukl|fffd|d|fffd|n|fffd| (storno)?", vbYesNoCancel)
      If h = vbCancel Then Exit Sub
      If h = vbNo Then GoTo pokracuj
      'musim odstranit radek v Prehled_KV.xlsx, mazat puvodni soubory
      'uloz s novym nazvem
      cesta = ActiveWorkbook.Path
      Do Until Right(cesta, 1) = ":"
        cesta = Left(cesta, Len(cesta) - 1)
      Loop
      f = FreeFile
      Open cesta & "cfg.txt" For Input As #f
      Input #f, cesta0
      Close #f
      'ulozit Nab_cz ... do Nabidky zdroj
      ces = ActiveWorkbook.Path
      ChDir cesta0 & ":Nabidky zdroj"
      Application.DisplayAlerts = False
      ActiveWorkbook.SaveAs nazev & ".xls"
      On Error Resume Next
      Kill puvNazev & ".xls"
      On Error GoTo 0
      ChDir cesta0 & ":Nabidky k odeslani"
      Kill puvNazev & ".xlsx"
      ChDir ces
      Application.DisplayAlerts = True
      'zapis do Prehled_KV.xlsx kdyz tam neni
      Workbooks.Open Filename:=cesta0 & ":Zdroje dat:Prehled_KV.xlsx"
      cestaKontakty = ActiveWorkbook.FullName
      r = Range("B3").End(xlDown).Row
      If r > 1000000 Then r = 3
      'hledej jestli uz tam zakazka neni, kdy|fffd| ano tak ji jen prepis, jinak ji uloz nove
      For i = 4 To r
        If Cells(i, 2) = akce1 And Cells(i, 3) = zakaznik1 And Cells(i, 4) = krukam1 Then
          r = i - 1
          Exit For
        End If
      Next i
      Cells(i, 2).EntireRow.Delete
      'precislovat polozky v Prehled_KV.xlsx
      r = Range("B3").End(xlDown).Row
      If r > 1000000 Then r = 3
      For i = 4 To r
        Cells(i, 1) = i - 3
      Next i
      'ulozit Prehled_KV.xlsx
      ActiveWorkbook.Close savechanges:=True
    Else
      'je to zmena a nazev se zmenil
      GoTo pokracuj
    End If
  End If
pokracuj:
  'cesta
  cesta = ActiveWorkbook.Path
  Do Until Right(cesta, 1) = ":"
    cesta = Left(cesta, Len(cesta) - 1)
  Loop
  f = FreeFile
  Open cesta & "cfg.txt" For Input As #f
  Input #f, cesta0
  Close #f
  'ulozit Nab_cz ... do Nabidky zdroj
  ces = ActiveWorkbook.Path
  ChDir cesta0 & ":Nabidky zdroj"
  Application.DisplayAlerts = False
  ActiveWorkbook.SaveAs nazev & ".xls"
  ChDir ces
  Application.DisplayAlerts = True
  'zapis do Prehled_KV.xlsx kdyz tam neni
  Workbooks.Open Filename:=cesta0 & ":Zdroje dat:Prehled_KV.xlsx"
  cestaKontakty = ActiveWorkbook.FullName
  r = Range("B3").End(xlDown).Row
  If r > 1000000 Then r = 3
  'hledej jestli uz tam zakazka neni, kdy|fffd| ano tak ji jen prepis, jinak ji uloz nove
  For i = 4 To r
    If Cells(i, 2) = akce0 And Cells(i, 3) = zakaznik0 And Cells(i, 4) = krukam0 Then
      r = i - 1
      Exit For
    End If
  Next i
  If r = 3 Then
    Cells(r + 1, 1) = 1
  Else
    Cells(r + 1, 1) = Cells(r, 1) + 1
  End If
  Cells(r + 1, 2) = akce0
  Cells(r + 1, 3) = zakaznik0
  Cells(r + 1, 4) = krukam0
  Cells(r + 1, 6) = cena0
  Cells(r + 1, 7) = datumNabidky0
  'autor
  Cells(r + 1, 5) = autor0
  'poznamka
  Cells(r + 1, 8) = poznamka0
  'soubor
  Cells(r + 1, 10) = nazev & ".xlsx"
  'vzorec pro prepocet ceny na Kc
  Cells(r + 1, 9) = "=IF(LEFT(RC[1],3)=""Nab"",RC[-3],RC[-3]*R1C7)"
  ActiveWorkbook.Close savechanges:=True
  'ulozit Nab_cz upraveny bez vzorcu bez kalkulace
  
  'jmeno stareho sesitu
  s0 = ActiveWorkbook.Name
  'novy sesit a umravnit listy
  Set s = Workbooks.Add
  pocListu = s.Sheets.Count
  s.Sheets(1).Name = "List" & pocListu + 1
  s.Sheets(1).Move After:=Sheets(pocListu)
  Windows(s0).Activate
  Sheets("List1").Copy Before:=Workbooks(s.Name).Sheets(1)
  'maz kalkulaci dole
  rc = Range("A65535").End(xlUp).Row + 6
  Range("A" & rc - 2 & ":A" & rc + 30).EntireRow.Delete
  'maz kalkulaci vpravo
  Columns("H:AA").Delete Shift:=xlToLeft
  'nahradit vzorce hodnotou
  Range("A1:AA" & rc).Select
  Selection.Copy
  Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
  Application.CutCopyMode = False
  Range("A1:E2").Select
  'Sheets(1).Protect Password:="54321", DrawingObjects:=True, Contents:=True, Scenarios:=True
  Workbooks(s0).Activate
  'ulozit nabidku k odeslani
  ChDir cesta0 & ":Nabidky k odeslani"
  Application.DisplayAlerts = False
  Workbooks(s.Name).SaveAs nazev & ".xlsx"
  ChDir ces
  Application.DisplayAlerts = True
  'otevrit Nab|fffd|dkov|fffd| SW.xlsm
  Workbooks.Open Filename:=cesta0 & ":Apple nab SW.xls"
  'zavri nabidku k odeslani
  Workbooks(nazev & ".xlsx").Close savechanges:=True
  'zavri nabidku s kalkulaci
  Workbooks(nazev & ".xls").Close savechanges:=True
End Sub
Sub TestTAB()
  'kdyz je vybrana spravna bunka a stisknu TAB
  k = Sheets("List1").Range("A11").End(xlDown).Row
  r = ActiveCell.Row
  s = ActiveCell.Column
  If r > 11 And r <= k And s = 2 Then
    radek = r
    frmZbozi.Show
    flagBylFormular = True
  End If
  If r = 6 And s = 2 Then
    radek = r
    frmZakaznik.Show
    flagBylFormular = True
  End If
End Sub
Sub TestSipkaDolu()
  If frmZbozi.lstZbozi.ListIndex < frmZbozi.lstZbozi.ListCount Then
    frmZbozi.lstZbozi.ListIndex = frmZbozi.lstZbozi.ListIndex + 1
  End If
End Sub
Sub TestSipkaNahoru()
  If frmZbozi.lstZbozi.ListIndex > 0 Then
    frmZbozi.lstZbozi.ListIndex = frmZbozi.lstZbozi.ListIndex - 1
  End If
End Sub

Sub TestDatumu()
  If DateValue(Date) > DateValue("2.6.2010") Then
    MsgBox "Pou|fffd|v|fffd|te neopr|fffd|vn|fffd|n|fffd| tento SW"
    Application.DisplayAlerts = False
    ActiveWorkbook.Close True
    Application.Quit
  End If
End Sub

Sub PrepisVzorceSloupceK()
  'hledej ve sloupci C text "Sleva pro skupinu"
  For i = 12 To 500
    If Left(Cells(i, 1), 17) = "Sleva pro skupinu" Then
      kSloupceK = i
      Exit For
    End If
  Next i
  'prepis v cyklu sloupce, kdyz je ve sloupci A cislo a neni prazdna bunka
  For i = 12 To kSloupceK - 3
    If IsNumeric(Cells(i, 1)) And Cells(i, 1) <> "" Then
      Cells(i, 11) = "=RC[-6]*(1-IF(RC[-4]=1,R" & kSloupceK & "C4,IF(RC[-4]=2,R" & (kSloupceK + 1) & "C4,IF(RC[-4]=3,R" & (kSloupceK + 2) & "C4,0))))"
    End If
  Next i
End Sub
Sub PrepisVzorceSloupceJ()
  'hledej ve sloupci C text "Sleva pro skupinu"
  For i = 12 To 500
    If Left(Cells(i, 1), 17) = "Sleva pro skupinu" Then
      kSloupceK = i
      Exit For
    End If
  Next i
  'prepis v cyklu sloupce, kdyz je ve sloupci A cislo a neni prazdna bunka
  For i = 12 To kSloupceK - 3
    If IsNumeric(Cells(i, 1)) And Cells(i, 1) <> "" Then
      Cells(i, 10) = "=RC[-1]*RC[-6]"
    End If
  Next i
End Sub
Sub PrepisVzorecSloupceF()
  'hledej konec 1. tabulky
  For i = 12 To 500
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  konRadek = i - 3
  For i = 12 To konRadek
    Cells(i, 6) = "=RC[-1]*RC[-2]"
  Next i
End Sub
Sub UpravitMezisoucet()
  'hledej ve sloupci I text "Mezisou|fffd|et:" jen 3x a zapis do nej vzorec SUM
  pMezis = 0
  For i = 12 To 500
    If Trim(Cells(i, 9)) = "Mezisoucet:" Then
      pMezis = pMezis + 1
      'hledej radek nad i kde ve sl. 1 je jednicka
      For j = i To 12 Step -1
        If Cells(j, 1) = 1 Then
          Cells(i, 10) = "=SUM(R" & j & "C:R" & (i - 1) & "C)"
          Cells(i, 6) = "=SUM(R" & j & "C:R" & (i - 1) & "C)"
          GoTo za
        End If
      Next j
za:
      Doramuj j, i - 1
      If pMezis = 3 Then Exit Sub
    End If
  Next i
End Sub
Sub VytvoritNabidkovyList()
  'test jestli neukladam vzor
  soubor = ActiveWorkbook.Name
  'If Not (soubor = "Nab_cz.xlsm" Or soubor = "Nab_en.xlsm" Or soubor = "Nab_sk.xlsm") Then
    'soubor = ActiveWorkbook.Name
    'Workbooks.Open Filename:=cesta0 & "\Nab|fffd|dkov|fffd| SW.xlsm"
    'Workbooks(soubor).Close savechanges:=True
  'End If
  'test vyplneni Akce
  If Sheets("List1").Range("B5") = "" Then
    MsgBox "Nen|fffd| vypln|fffd|na akce"
    Exit Sub
  End If
  'ulozi Nab. do Nabidky zdroj, Nab upravenou do Kalkulacni list, zapise do Prehled_KV
  h = MsgBox("Opravdu vytvo|fffd|it kalkula|fffd|n|fffd| list?", vbYesNo)
  If h = vbNo Then Exit Sub
  'puvodni soubor pri zmene
  puvNazev = Left(soubor, Len(soubor) - 5)
  'pamatuj cestu k aktualnimu souboru
  ces = ActiveWorkbook.Path
  'akce
  akce0 = Sheets("List1").Range("B5")
  If akce0 = "" Then akce0 = "-"
  'odstranit mezery
  d = Len(akce0)
  akce = ""
  For i = 1 To d
    zn = Mid(akce0, i, 1)
    If zn <> " " Then
      akce = akce & zn
    End If
  Next i
  d = Len(akce)
  If d > 8 Then akce = Left(akce, 8)
  'If d < 8 Then akce = akce & String(8 - d, "-")
  'zakaznik
  zakaznik0 = Sheets("List1").Range("B6")
  If zakaznik0 = "" Then zakaznik0 = "-"
  'If Left(zakaznik0, 3) = "---" Then zakaznik0 = Range("B7")
  'odstranit mezery
  d = Len(zakaznik0)
  zakaznik = ""
  For i = 1 To d
    zn = Mid(zakaznik0, i, 1)
    If zn <> " " Then
      zakaznik = zakaznik & zn
    End If
  Next i
  d = Len(zakaznik)
  If d > 8 Then zakaznik = Left(zakaznik, 8)
  'If d < 8 Then zakaznik = akce & String(8 - d, "-")
  'poznamka
  poznamka0 = Sheets("List1").Range("F6")
  If poznamka0 = "" Then poznamka0 = "-"
  'odstranit mezery
  d = Len(poznamka0)
  poznamka = ""
  For i = 1 To d
    zn = Mid(poznamka0, i, 1)
    If zn <> " " Then
      poznamka = poznamka & zn
    End If
  Next i
  d = Len(poznamka)
  If d > 4 Then poznamka = Left(poznamka, 4)
  'If d < 4 Then poznamka = poznamka & String(4 - d, "-")
  'k rukam
  krukam0 = Sheets("List1").Range("B7")
  'datum nabidky
  datumNabidky0 = Sheets("List1").Range("F7")
  'cena
  rc = Sheets("List1").Range("A65635").End(xlUp).End(xlUp).End(xlUp).Row
  cena0 = Sheets("List1").Cells(rc, 6)
  'nazev souboru nabidky
  soubor = ActiveWorkbook.Name
  If Range("A4") = "Nab|fffd|dka" Then
    zacNazev = "Nab"
  ElseIf Range("A4") = "Ponuka" Then
    zacNazev = "Pon"
  ElseIf Range("A4") = "Offer" Then
    zacNazev = "Bid"
  Else
    MsgBox "Spatny n|fffd|zev vzorov|fffd|ho souboru - mus|fffd| byt Nab_cz.xls, Nab_en.xls, Nab_sk.xls !"
    Exit Sub
  End If
  
  nazev = zacNazev & "_" & Format(Date, "yymmdd") _
    & "_" & akce & "_" & zakaznik & "_" & poznamka
    
    GoTo pokracuj
    
    
    
    
  'Else
    'je to nova nabidka nebo zmena a datum, akce, zakaznik, poznamka se zmenily
    puvNazevP = puvNazev & ".xls"
    If Not (puvNazevP = "Nab_cz.xls" Or puvNazevP = "Nab_en.xls" Or puvNazevP = "Nab_sk.xls") Then
      'je to nova nabidka
      h = MsgBox("ZMENA: Puvodn|fffd| n|fffd|zev souboru se zmenil" & _
        vbCrLf & "Z duvodu zmen datumu, akce, z|fffd|kaznika nebo pozn|fffd|mky." & _
        vbCrLf & vbCrLf & "Chcete ulozit zmenu s novym n|fffd|zvem (Ano)?" & _
        vbCrLf & "Ulozit jako novy soubor (ne)?" & _
        vbCrLf & "Nebo zrusit ukl|fffd|d|fffd|n|fffd| (storno)?", vbYesNoCancel)
      If h = vbCancel Then Exit Sub
      If h = vbNo Then GoTo pokracuj
      'musim odstranit radek v Prehled_KV.xlsx, mazat puvodni soubory
      'uloz s novym nazvem
      cesta = ActiveWorkbook.Path
      Do Until Right(cesta, 1) = "\"
        cesta = Left(cesta, Len(cesta) - 1)
      Loop
      f = FreeFile
      Open cesta & "cfg.txt" For Input As #f
      Input #f, cesta0
      Close #f
      'ulozit Nab_cz ... do Nabidky zdroj
      ces = ActiveWorkbook.Path
      ChDir cesta0 & "\Nabidky zdroj"
      Application.DisplayAlerts = False
      ActiveWorkbook.SaveAs nazev & ".xlsm"
      Kill puvNazev & ".xlsm"
      ChDir cesta0 & "\Kalkulacni list"
      Kill puvNazev & ".xlsx"
      ChDir ces
      Application.DisplayAlerts = True
      'zapis do Prehled_KV.xlsx kdyz tam neni
      Workbooks.Open Filename:=cesta0 & "\Zdroje dat\Prehled_KV.xlsx"
      cestaKontakty = ActiveWorkbook.FullName
      r = Range("B3").End(xlDown).Row
      If r > 1000000 Then r = 3
      'hledej jestli uz tam zakazka neni, kdy|fffd| ano tak ji jen prepis, jinak ji uloz nove
      For i = 4 To r
        If Cells(i, 2) = akce1 And Cells(i, 3) = zakaznik1 And Cells(i, 4) = krukam1 Then
          r = i - 1
          Exit For
        End If
      Next i
      Cells(i, 2).EntireRow.Delete
      'precislovat polozky v Prehled_KV.xlsx
      r = Range("B3").End(xlDown).Row
      If r > 1000000 Then r = 3
      For i = 4 To r
        Cells(i, 1) = i - 3
      Next i
      'ulozit Prehled_KV.xlsx
      ActiveWorkbook.Close savechanges:=True
    Else
      'je to zmena a nazev se zmenil
      GoTo pokracuj
    End If
  'End If
  
  
  
  
pokracuj:
  'cesta
  cesta = ActiveWorkbook.Path
  Do Until Right(cesta, 1) = "\"
    cesta = Left(cesta, Len(cesta) - 1)
  Loop
  f = FreeFile
  Open cesta & "cfg.txt" For Input As #f
  Input #f, cesta0
  Close #f
  'ulozit Nab_cz ... do Nabidky zdroj
  ces = ActiveWorkbook.Path
  ChDir cesta0 & "\Nabidky zdroj"
  Application.DisplayAlerts = False
  ActiveWorkbook.SaveAs nazev & ".xlsm"
  ChDir ces
  Application.DisplayAlerts = True
  GoTo pokracuj1
  
  
  
  'zapis do Prehled_KV.xlsx kdyz tam neni
  Workbooks.Open Filename:=cesta0 & ":Zdroje dat:Prehled_KV.xlsx"
  cestaKontakty = ActiveWorkbook.FullName
  r = Range("B3").End(xlDown).Row
  If r > 1000000 Then r = 3
  'hledej jestli uz tam zakazka neni, kdy|fffd| ano tak ji jen prepis, jinak ji uloz nove
  For i = 4 To r
    If Cells(i, 2) = akce0 And Cells(i, 3) = zakaznik0 And Cells(i, 4) = krukam0 Then
      r = i - 1
      Exit For
    End If
  Next i
  If r = 3 Then
    Cells(r + 1, 1) = 1
  Else
    Cells(r + 1, 1) = Cells(r, 1) + 1
  End If
  Cells(r + 1, 2) = akce0
  Cells(r + 1, 3) = zakaznik0
  Cells(r + 1, 4) = krukam0
  Cells(r + 1, 10) = cena0
  Cells(r + 1, 12) = datumNabidky0
  'vzorec sl P
  Cells(r + 1, 16) = "=+RC[-1]*RC[-2]"
  'vzorec sl Q
  Cells(r + 1, 17) = "=+RC[-5]*RC[-1]"
  'poznamka
  Cells(r + 1, 18) = poznamka0
  ActiveWorkbook.Close savechanges:=True
  'ulozit Nab_cz upraveny bez vzorcu bez kalkulace
  
  
pokracuj1:
  'jmeno stareho sesitu
  s0 = ActiveWorkbook.Name
  'novy sesit a umravnit listy
  Set s = Workbooks.Add
  pocListu = s.Sheets.Count
  s.Sheets(1).Name = "List" & pocListu + 1
  s.Sheets(1).Move After:=Sheets(pocListu)
  Windows(s0).Activate
  Sheets("List1").Copy Before:=Workbooks(s.Name).Sheets(1)
  'maz kalkulaci dole
  rc = Range("A65535").End(xlUp).Row + 17
  'Range("A" & rc & ":A" & rc + 20).EntireRow.Delete
  'maz kalkulaci vpravo
  'Columns("I:K").Delete Shift:=xlToLeft
  'nahradit vzorce hodnotou
  Range("A1:N" & rc).Select
  Selection.Copy
  Selection.PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
  Application.CutCopyMode = False
  Range("A1:E2").Select
  'odstranit tlacitka
  ActiveSheet.Shapes("cmdUlozit").Delete
  ActiveSheet.Shapes("cmdStorno").Delete
  ActiveSheet.Shapes("cmdPridatRadek").Delete
  ActiveSheet.Shapes("cmdPridat5Radku").Delete
  ActiveSheet.Shapes("cmdOdstranitVybrane").Delete
  ActiveSheet.Shapes("cmdOdstranitPrazdneRadky").Delete
  ActiveSheet.Shapes("cmdVlozitRadek").Delete
  ActiveSheet.Shapes("cmdVyplnitZeSeznamu").Delete
  ActiveSheet.Shapes("cmdVytvoritNabidkovyList").Delete
  ActiveSheet.Shapes("cmdPridatXRadku").Delete
  ActiveSheet.Shapes("cmdNacistDataPrehled").Delete
  ActiveSheet.Shapes("chkSkrytSWaSluzby").Delete
  ActiveSheet.Shapes("chkSkrytRozvadeceAMontazniPrace").Delete
  ActiveSheet.Shapes("chkSkrytRekapitulace").Delete
  ActiveSheet.Shapes("chkSkrytSlevu").Delete
  'Sheets(1).Protect Password:="54321", DrawingObjects:=True, Contents:=True, Scenarios:=True
  Workbooks(s0).Activate
  'ulozit nabidku Kal
  ChDir cesta0 & "\Kalkulacni list"
  Application.DisplayAlerts = False
  nazev2 = "Kal" & Right(nazev, Len(nazev) - 3)
  Workbooks(s.Name).SaveAs nazev2 & ".xlsx"
  ChDir ces
  Application.DisplayAlerts = True
  'zavri nabidku Kal
  Workbooks(nazev2 & ".xlsx").Close savechanges:=True
End Sub
Sub Doramuj(pRadek, kRadek)
    Set o = Range("A" & (pRadek - 1) & ":G" & kRadek)
    o.Borders(xlDiagonalDown).LineStyle = xlNone
    o.Borders(xlDiagonalUp).LineStyle = xlNone
    'With o.Borders(xlEdgeLeft)
       ' .LineStyle = xlContinuous
       ' .ColorIndex = 6
       ' .TintAndShade = 0
       ' .Weight = xlThin
    'End With
    'With o.Borders(xlEdgeTop)
      '  .LineStyle = xlContinuous
      '  .ColorIndex = 1
      '  .TintAndShade = 0
      '  .Weight = xlThin
    'End With
  '  With o.Borders(xlEdgeBottom)
   '     .LineStyle = xlContinuous
   '     .ColorIndex = 1
   '     .TintAndShade = 0
    '    .Weight = xlThin
  '  End With
  '  With o.Borders(xlEdgeRight)
   '     .LineStyle = xlContinuous
   '     .ColorIndex = 1
   '     .TintAndShade = 0
   '     .Weight = xlThin
  '  End With
'    With o.Borders(xlInsideVertical)
 '       .LineStyle = xlNone
 '       .ColorIndex = 1
 '       .TintAndShade = 0
 '       .Weight = xlThin
 '   End With
 '   With o.Borders(xlInsideHorizontal)
 '       .LineStyle = xlContinuous
 '       .ColorIndex = 1
 '       .TintAndShade = 0
 '       .Weight = xlThin
 '   End With
o.Borders(xlDiagonalDown).LineStyle = xlNone
o.Borders(xlDiagonalUp).LineStyle = xlNone
With o.Borders(xlEdgeLeft)
       .LineStyle = xlContinuous
        .ColorIndex = 2
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With o.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 2
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With o.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 2
        .TintAndShade = 0
        .Weight = xlMedium
    End With
    With o.Borders(xlEdgeRight)
       .LineStyle = xlContinuous
        .ColorIndex = 2
        .TintAndShade = 0
        .Weight = xlMedium
    End With
   With o.Borders(xlInsideVertical)
        .LineStyle = xlNone
        .ColorIndex = 2
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With o.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 2
        .TintAndShade = 0
        .Weight = xlThin
    End With
    
    Set o = Range("I" & (pRadek) & ":J" & kRadek)
    o.Borders(xlInsideVertical).LineStyle = xlNone
    o.Borders(xlDiagonalDown).LineStyle = xlNone
    o.Borders(xlDiagonalUp).LineStyle = xlNone
    o.Borders(xlEdgeLeft).LineStyle = xlNone
    o.Borders(xlEdgeTop).LineStyle = xlNone
    o.Borders(xlEdgeBottom).LineStyle = xlNone
    o.Borders(xlEdgeRight).LineStyle = xlNone
    o.Borders(xlInsideVertical).LineStyle = xlNone
    o.Borders(xlInsideHorizontal).LineStyle = xlNone
    o.Borders(xlDiagonalDown).LineStyle = xlNone
    o.Borders(xlDiagonalUp).LineStyle = xlNone
    With o.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With o.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With o.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With o.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    o.Borders(xlInsideVertical).LineStyle = xlNone
    o.Borders(xlInsideHorizontal).LineStyle = xlNone
    Set o = Nothing
End Sub
Sub VlozitVzorecSleva()
  'hledej ve sloupci C text "Sleva pro skupinu"
  For i = 12 To 500
    If Left(Cells(i, 1), 17) = "Sleva pro skupinu" Then
      sleva = i
      Exit For
    End If
  Next i
  pocZapisu = 0
  'hledej ve sloupci A text Pos. (zacatek tabulky)
  For i = 11 To 500
    If Trim(Cells(i, 1)) = "Pos." Then
      zac = i + 1
      GoTo za1
    End If
  Next i
  'hledej ve sloupci I text Mesisoucet: (konec tabulky)
za1:
  For i = zac + 1 To 500
    If Trim(Cells(i, 9)) = "Mezisoucet:" Then
      kon = i - 1
      GoTo za2
    End If
  Next i
za2:
  'zapis vzorce sleva pro skupinu
  Cells(sleva, 6) = "=RC[-2]*SUMIF(R" & zac & "C[1]:R" & kon & "C[1],1,R" & zac & "C:R" & kon & "C)"
  Cells(sleva + 1, 6) = "=RC[-2]*SUMIF(R" & zac & "C[1]:R" & kon & "C[1],2,R" & zac & "C:R" & kon & "C)"
  Cells(sleva + 2, 6) = "=RC[-2]*SUMIF(R" & zac & "C[1]:R" & kon & "C[1],3,R" & zac & "C:R" & kon & "C)"
End Sub
Sub SipkaDolu0()
  On Error Resume Next
  ActiveCell.Offset(1, 0).Range("A1").Select
End Sub
Sub SipkaNahoru0()
  On Error Resume Next
  ActiveCell.Offset(-1, 0).Range("A1").Select
End Sub
Sub NacistDataPrehledKV()
  h = MsgBox("Opravdu vymazat neobnoviteln|fffd| soubor P|fffd|ehled_KV.xlsx a " & _
       "na|fffd||fffd|st ho ze v|fffd|ech soubor|fffd| ze slo|fffd|ky Nab|fffd|dky zdroj" & vbCrLf _
       & vbCrLf & "Operace trv|fffd| d|fffd|le a je z|fffd|visl|fffd| na po|fffd|tu soubor|fffd| ve slo|fffd|ce Nab|fffd|dky zdroj", vbYesNo)
  If h = vbNo Then Exit Sub
  'VypracovalPodepsal
  Workbooks.Open Filename:=cesta0 & "\Zdroje dat\Prehled_KV.xlsx"
  Sheets(1).Range("A4:J1000000").ClearContents
  ChDir cesta0 & "\Nabidky zdroj"
  sou = Dir(cesta0 & "\Nabidky zdroj\*.xlsm")
  r = 4
  Do Until sou = ""
    soubor0 = sou
    Workbooks.Open sou
    akce0 = Sheets("List1").Range("B5")
    If akce0 = "" Then akce0 = "-"
    zakaznik0 = Sheets("List1").Range("B6")
    If zakaznik0 = "" Then zakaznik0 = "-"
    poznamka0 = Sheets("List1").Range("F6")
    If poznamka0 = "" Then poznamka0 = "-"
    krukam0 = Sheets("List1").Range("B7")
    If krukam0 = "" Then krukam0 = "-"
    autor0 = Sheets("List1").Range("F8")
    'cena
    rc = Sheets("List1").Range("A65635").End(xlUp).Row
    If Left(soubor0, 3) = "Pon" Then
opet1:
      If Left(Sheets("List1").Cells(rc, 1), 23) = "Celkom za dod|fffd|vku v EUR" Then
        cena0 = Sheets("List1").Cells(rc, 6)
      Else
        rc = rc - 1
        GoTo opet1
      End If
    End If
    If Left(soubor0, 3) = "Bid" Then
opet2:
      If Left(Sheets("List1").Cells(rc, 1), 9) = "Total for" Then
        cena0 = Sheets("List1").Cells(rc, 6)
      Else
        rc = rc - 1
        GoTo opet2
      End If
    End If
    If Left(soubor0, 3) = "Nab" Then
opet3:
      If Left(Sheets("List1").Cells(rc, 1), 22) = "Celkem za dod|fffd|vku v K|fffd|" Then
        cena0 = Sheets("List1").Cells(rc, 6)
      Else
        rc = rc - 1
        GoTo opet3
      End If
    End If
    Workbooks(sou).Close False
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 1) = r - 3
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 2) = akce0
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 3) = zakaznik0
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 4) = krukam0
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 6) = cena0
    'datum z nazvu souboru
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 7) = CDate(Mid(sou, 9, 2) & "." & Mid(sou, 7, 2) & "." & Mid(sou, 5, 2))
    'autor
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 5) = autor0
    'poznamka
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 8) = poznamka0
    'soubor
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 10) = soubor0
    'vzorec pro prepocet na Kc
    Workbooks("Prehled_KV.xlsx").Sheets(1).Cells(r, 9) = "=IF(LEFT(RC[1],3)=""Nab"",RC[-3],RC[-3]*R1C7)"
    r = r + 1
    sou = Dir
  Loop
  'setridit dle datumu
  Windows("Prehled_KV.xlsx").Activate
  Range("A3").Select
  ActiveWorkbook.Worksheets("Nabidky_CZ").Sort.SortFields.Clear
  pocRadku = Range("A3").End(xlDown).Row
  ActiveWorkbook.Worksheets("Nabidky_CZ").Sort.SortFields.Add Key:=Range("G4:G" & pocRadku), _
     SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
  'precislovat 1 sloupec
  pocRadku = Range("A3").End(xlDown).Row
  Range("A4:A" & pocRadku).ClearContents
  For i = 4 To pocRadku
    Cells(i, 1) = i - 3
  Next i
  Workbooks("Prehled_KV.xlsx").Close True
End Sub


Private Sub cmdNacistDataPrehled_Click()
  NacistDataPrehledKV
End Sub

Sub cmdOdstranitPrazdneRadky_Click()
  
  If Cells(12, 2) = "" Then
    MsgBox "Nevypln|fffd|na 1. polo|fffd|ka, nelze odstranit pr|fffd|zdn|fffd| |787|dky"
    Exit Sub
  End If
zas:
  'hledej konec 1. tabulky
  For i = 12 To 500
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  rk = i - 3
  'rk = Range("A11").End(xlDown).Offset(1, 0).Range("A1").Row - 1
  For i = 12 To rk
    If Cells(i, 2) = "" And Cells(i, 3) = "" Then
      Cells(i, 1).EntireRow.Delete
      GoTo zas
    End If
  Next i
  'hledej konec 1. tabulky
  For i = 12 To 500
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  rk = i - 3
  'rk = Range("A11").End(xlDown).Offset(1, 0).Range("A1").Row - 1
  For i = 12 To rk
    Cells(i, 1) = i - 11
  Next i
  PrepisVzorceSloupceJ
  PrepisVzorceSloupceK
  UpravitMezisoucet
  VlozitVzorecSleva
  Range("A11").Select

End Sub

Sub cmdOdstranitVybrane_Click()
  
  rp = Selection.Rows.Count
  r1 = Selection.Row
  rk = Range("A11").End(xlDown).Offset(1, 0).Range("A1").Row
  If r1 < 12 Or r1 + rp > rk Then Exit Sub
  Range("A" & r1 & ":A" & r1 + rp - 1).EntireRow.Delete
  'hledej konec 1. tabulky
  For i = 12 To 500
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  rk = i - 3
  'rk = Range("A11").End(xlDown).Offset(1, 0).Range("A1").Row - 1
  For i = 12 To rk
    Cells(i, 1) = i - 11
  Next i
  PrepisVzorceSloupceJ
  PrepisVzorceSloupceK
  UpravitMezisoucet
  VlozitVzorecSleva
  Range("A11").Select
  End Sub

Sub cmdPridat5Radku_Click()
  rk = Range("A11").End(xlDown).Offset(1, 0).Range("A1").Row
  Cells(rk, 1).EntireRow.Insert
  Cells(rk, 1).EntireRow.Insert
  Cells(rk, 1).EntireRow.Insert
  Cells(rk, 1).EntireRow.Insert
  Cells(rk, 1).EntireRow.Insert
  'hledej konec 1. tabulky
  For i = 11 To 500
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  rk = i - 3
  For i = 12 To rk
    Cells(i, 1) = i - 11
    Cells(i, 11) = "=RC[-6]*(1-IF(RC[-4]=1,R" & 36 + 5 & "C4,IF(RC[-4]=2,R" & 37 + 5 & "C4,IF(RC[-4]=3,R" & 38 + 5 & "C4,0))))"
  Next i
  PrepisVzorceSloupceJ
  PrepisVzorceSloupceK
  PrepisVzorecSloupceF
  UpravitMezisoucet
  VlozitVzorecSleva
  End Sub

Sub cmdPridatRadek_Click()
  
  rk = Range("A11").End(xlDown).Offset(1, 0).Range("A1").Row
  Cells(rk, 1).EntireRow.Insert
  'hledej konec 1. tabulky
  For i = 11 To 500
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  rk = i - 3
  For i = 12 To rk
    Cells(i, 1) = i - 11
    Cells(i, 11) = "=RC[-6]*(1-IF(RC[-4]=1,R" & 36 + 1 & "C4,IF(RC[-4]=2,R" & 37 + 15 & "C4,IF(RC[-4]=3,R" & 38 + 1 & "C4,0))))"
  Next i
  PrepisVzorceSloupceJ
  PrepisVzorceSloupceK
  PrepisVzorecSloupceF
  UpravitMezisoucet
  VlozitVzorecSleva

End Sub

Sub cmdPridatXRadku_Click()
  pocNovychRadku = InputBox("Kolik novych radku vlozit?", vbOKCancel)
  If pocNovychRadku = "" Or pocNovychRadku = 0 Then Exit Sub
  If Not IsNumeric(pocNovychRadku) Then
    MsgBox "Pocet vlozenych radku musi byt cele kladne cislo"
    Exit Sub
  End If
  If CInt(pocNovychRadku) <= 0 Then
    MsgBox "Pocet vlozenych radku musi byt cele kladne cislo"
    Exit Sub
  End If
  
  rk = Range("A11").End(xlDown).Offset(1, 0).Range("A1").Row
  For i = 1 To CInt(pocNovychRadku)
    Cells(rk, 1).EntireRow.Insert
  Next i
  'hledej konec 1. tabulky
  For i = 11 To 500
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  rk = i - 3
  For i = 12 To rk
    Cells(i, 1) = i - 11
    Cells(i, 11) = "=RC[-6]*(1-IF(RC[-4]=1,R" & 36 + 5 & "C4,IF(RC[-4]=2,R" & 37 + 5 & "C4,IF(RC[-4]=3,R" & 38 + 5 & "C4,0))))"
  Next i
  PrepisVzorceSloupceJ
  PrepisVzorceSloupceK
  PrepisVzorecSloupceF
  UpravitMezisoucet
  VlozitVzorecSleva
  End Sub

Sub cmdStorno_Click()
  h = MsgBox("Opravdu stornovat rozpracovanou nab|fffd|dku a vr|fffd|tit se k Nab|fffd|dkov|fffd|mu SW?", vbYesNo)
  If h = vbNo Then Exit Sub
  soubor = ActiveWorkbook.Name
  For i = Len(cesta) To 1 Step -1
    If Mid(cesta, i, 1) = ":" Then
      cesta0 = Left(cesta, i)
      Exit For
    End If
  Next i
  Workbooks.Open Filename:=cesta0 & "Apple nab SW.xls"
  Workbooks(soubor).Close savechanges:=False
 
End Sub

Private Sub cmdUlozit_Click()
  'cist rozmery
  vyska = cmdUlozit.Height
  sirka = cmdUlozit.Width
  zleva = cmdUlozit.Left
  nad = cmdUlozit.Top
  UlozitVse
  'nastavit rozmery
  cmdUlozit.Height = vyska
  cmdUlozit.Width = sirka
  cmdUlozit.Left = zleva
  cmdUlozit.Top = nad
End Sub

Sub cmdVlozitRadek_Click()
  r = ActiveCell.Row
  rk = Cells(12, 1).End(xlDown).Row
  If r < 13 Or r > rk Then
    MsgBox "Nelze vlozit radek!"
    Exit Sub
  End If
  ActiveCell.EntireRow.Insert
  For i = 12 To rk + 1
    Cells(i, 1) = i - 11
    Cells(i, 11) = "=RC[-6]*(1-IF(RC[-4]=1,R" & 36 + 1 & "C4,IF(RC[-4]=2,R" & 37 + 1 & "C4,IF(RC[-4]=3,R" & 38 + 1 & "C4,0))))"
  Next i
  Cells(i, 1) = ""
  Sheets(1).Select
  PrepisVzorceSloupceJ
  PrepisVzorceSloupceK
  PrepisVzorecSloupceF
  UpravitMezisoucet
  VlozitVzorecSleva
  
End Sub

Sub cmdVyplnitZeSeznamu_Click()
  If Cells(12, 2) = "" Then
    MsgBox "Nevypln|fffd|na 1. polo|fffd|ka, nelze plnit ze seznamu"
    Exit Sub
  End If
  rk = Cells(11, 2).End(xlDown).Row
 
  pZbozi = Sheets("List2").Cells(5, 1).End(xlDown).Row
  For i = 12 To rk
    For j = 2 To pZbozi
      If Sheets("List2").Cells(j, 1) = Sheets("List1").Cells(i, 2) Then
        'typ
        'flagBylFormular = True
        'Sheets("List1").Cells(i, 2) = Sheets("List2").Cells(j, 1)
        'popis
        flagBylFormular = True
        Sheets("List1").Cells(i, 3) = Sheets("List2").Cells(j, 2)
        'jc pro CZ
        flagBylFormular = True
        Sheets("List1").Cells(i, 5) = Sheets("List2").Cells(j, 6)
        'sk
        flagBylFormular = True
        Sheets("List1").Cells(i, 7) = Sheets("List2").Cells(j, 4)
        'vzorec sl F
        flagBylFormular = True
        Sheets("List1").Cells(i, 6).FormulaR1C1 = "=RC[-1]*RC[-2]"
        'nakupka
        flagBylFormular = True
        Sheets("List1").Cells(i, 9) = Sheets("List2").Cells(j, 3)
        'vzorec sl J
        flagBylFormular = True
        Sheets("List1").Cells(i, 10).FormulaR1C1 = "=RC[-1]*RC[-6]"
        'DB RS sl M
        flagBylFormular = True
        Sheets("List1").Cells(i, 13).FormulaR1C1 = Sheets("List2").Cells(j, 13)
        'DB IRC sl N
        flagBylFormular = True
        Sheets("List1").Cells(i, 14).FormulaR1C1 = Sheets("List2").Cells(j, 14)
      End If
    Next j
  Next i
  
End Sub

Private Sub cmdVytvoritNabidkovyList_Click()
  'cist rozmery
  vyska = cmdVytvoritNabidkovyList.Height
  sirka = cmdVytvoritNabidkovyList.Width
  zleva = cmdVytvoritNabidkovyList.Left
  nad = cmdVytvoritNabidkovyList.Top
  VytvoritNabidkovyList
  cmdVytvoritNabidkovyList.Height = vyska
  cmdVytvoritNabidkovyList.Width = sirka
  cmdVytvoritNabidkovyList.Left = zleva
  cmdVytvoritNabidkovyList.Top = nad
End Sub

Sub chkSkrytRekapitulace_Click()
'skryti/zobrazeni rekapitulace
  'najde radek i pro sedivy Celkem za dodavky odspodu
  For i = 10000 To 11 Step -1
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  
  'nastaveno skryt rekapitulace
  If Sheets("List1").Range("T3") = True Then
    'skryt rekapitulace
    Rows(i + 12 & ":" & i + 15).EntireRow.Hidden = True
    'do dodaci lhuta: do 14 dni od objednavky
    flagSkrytRekapitulace = True
    Cells(i + 5, 3) = Sheets("List2").Range("P3")
    'do Platebni podminky" faktura splatna do 30 dni ...
    flagSkrytRekapitulace = True
    Cells(i + 6, 3) = Sheets("List2").Range("P4")
  End If
  
  'nastaveno neskryt rekapitulace
  If Sheets("List1").Range("T3") = False Then
    'zobrazit rekapitulace
    Rows(i + 12 & ":" & i + 15).EntireRow.Hidden = False
    'do dodaci lhuta: dodavky prizpusobime ...
    flagSkrytRekapitulace = True
    Cells(i + 5, 3) = Sheets("List2").Range("O3")
    'do Platebni podminky" stanoveny dohodou ...
    flagSkrytRekapitulace = True
    Cells(i + 6, 3) = Sheets("List2").Range("O4")
  End If
  
  'kdyz nastaveno skryt SW
  If Sheets("List1").Range("T1") = True Then
    'skryt zarucni doba na sluzby
    Cells(i + 4, 1).EntireRow.Hidden = True
  Else
    'kdyz nenastaveno skryt SW
    'zobrazit zarucni doba na sluzby
    Cells(i + 4, 1).EntireRow.Hidden = False
  End If
  
  'kdyz nastaveno skryt Rozvadece
  If Sheets("List1").Range("T2") = True Then
    'skryt zarucni doba na material
    Cells(i + 3, 1).EntireRow.Hidden = True
  Else
    'kdyz nenastaveno skryt Rozvadece
    'zobrazit zarucni doba na material
    Cells(i + 3, 1).EntireRow.Hidden = False
  End If
  'volat chkSkrytSlevu
  'chkSkrytSlevu_Click
End Sub

Sub chkSkrytRozvadeceAMontazniPrace_Click()
  zac = 11: flagNaselSoftware = False
zas:
  For i = zac + 1 To 10000
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  If zac = 11 Then
    zac = i
    GoTo zas
  End If
  For j = i + 1 To 10000
    If Cells(j, 1).Interior.ColorIndex = 15 Then Exit For
  Next j
  If Sheets("List1").Range("T2") = True Then
    'skryt rozvadece
    Rows(i & ":" & i + 7).EntireRow.Hidden = True
  End If
  If Sheets("List1").Range("T2") = False Then
    'zobrazit rozvadece
    Rows(i & ":" & i + 7).EntireRow.Hidden = False
  End If
End Sub

Sub chkSkrytSlevu_Click()
  'If chkSkrytRekapitulace = True Then Exit Sub
  'skryti/zobrazeni slevy
  'najde radek i pro sedivy Celkem za dodavky odspodu
  For i = 10000 To 11 Step -1
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  'najde radek i pro sedivy Sleva za dodavky odspodu
  For j = i - 1 To i - 2 Step -1
    If Cells(j, 1).Interior.ColorIndex = 15 Then Exit For
  Next j
  'nastaveno skryt slevu
  If Sheets("List1").Range("T4") = True Then
    'skryt rekapitulace
    Rows(i + 16).EntireRow.Hidden = True
  End If
  'nastaveno zobrazit slevu slevu
  If Sheets("List1").Range("T4") = False Then
    'skryt rekapitulace
    Rows(i + 16).EntireRow.Hidden = False
  End If
End Sub

Sub chkSkrytSWaSluzby_Click()
  For i = 11 To 10000
    If Cells(i, 1).Interior.ColorIndex = 15 Then Exit For
  Next i
  For j = i + 1 To 10000
    If Cells(j, 1).Interior.ColorIndex = 15 Then Exit For
  Next j
  
  If Sheets("List1").Range("T1") = True Then
    'skryt software
    Rows(i & ":" & i + 7).EntireRow.Hidden = True
  End If
  If Sheets("List1").Range("T1") = False Then
    'zobrazit software
    Rows(i & ":" & i + 7).EntireRow.Hidden = False
  End If
End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Workbook_Open()
  'TestDatumu
  cesta = ActiveWorkbook.Path
  soubor = ActiveWorkbook.Name
  flagBylFormular = False
  VypracovalPodepsal
  'NactiZboziDoListu2
  Range("A1").Select
  akce1 = Range("C5")
  zakaznik1 = Range("B6")
  poznamka1 = Range("F6")
  krukam1 = Range("B7")
  If akce1 = "" Then akce1 = "-"
  If zakaznik1 = "" Then zakaznik1 = "-"
  If poznamka1 = "" Then poznamka1 = "-"
  If krukam1 = "" Then krukam1 = "-"
End Sub
Attribute VB_Name = "frmZakaznik"
Attribute VB_Base = "0{F688AEDF-CE92-5C4C-8331-76AA874C73BD}{3D7F7F22-47B2-3B49-A582-A0009846F43C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub cmdOK_Click()
  
  
  

    
  X = frmZakaznik.lstZakaznici.Text
  x1 = InStr(X, " = ")
  x2 = InStr(x1 + 1, X, " = ")
  Workbooks(scest).Sheets(1).Range("B6") = Left(X, x1 - 1)
  Workbooks(scest).Sheets(1).Range("B7") = Mid(X, x1 + 3, x2 - x1 - 3)
  Workbooks(scest).Sheets(1).Range("B8") = Right(X, Len(X) - x2 - 2)

  Unload Me
  
  Workbooks(n).Save
  Workbooks(n).Close
  
  
End Sub

Private Sub cmdStorno_Click()
  Unload Me
  Workbooks(n).Save
  Workbooks(n).Close
End Sub

Private Sub lstZakaznici_Click()

End Sub

Private Sub lstZakaznici_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
  cmdOK_Click
End Sub

Private Sub txtZakaznik_Change()
  If flagZmenaIndexu = True Then Exit Sub
  X = UCase(txtZakaznik)
  d = Len(X)
  For i = 0 To lstZakaznici.ListCount - 1
    If X = UCase(Left(lstZakaznici.List(i), d)) Then
      lstZakaznici.ListIndex = i
      On Error Resume Next
      lstZakaznici.ListIndex = i + 10
      On Error GoTo 0
      lstZakaznici.ListIndex = i
      Exit For
    End If
  Next i
End Sub

Private Sub UserForm_Activate()
  txtZakaznik = ActiveCell
  NaplnLstZakaznik
  Application.OnKey "{DOWN}", "SipkaDolu"
  Application.OnKey "{UP}", "SipkaNahoru"
  txtZakaznik_Change
  txtZakaznik.SetFocus
End Sub





Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
  Application.OnKey "{DOWN}", "SipkaDolu0"
  Application.OnKey "{UP}", "SipkaNahoru0"
End Sub

Private Sub UserForm_Resize()
  
End Sub
Attribute VB_Name = "frmZbozi"
Attribute VB_Base = "0{D9C42324-9402-3A47-B828-5416DABA36CA}{E7CE811D-F3E6-7C4E-B2DE-4D0DBCB32977}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim vybrana
Private Sub cmdNajitDalsi_Click()
  pol = lstPopis.ListCount
  For i = vybrana + 1 To pol - 1
    If InStr(1, lstPopis.List(i), txtHledej, 1) > 0 Then
      lstPopis.ListIndex = i
      Exit For
    End If
  Next i
  vybrana = i
End Sub

Private Sub cmdNajitPredchozi_Click()
  pol = lstPopis.ListCount
  For i = pol - 1 To vybrana - 1 Step -1
    If InStr(1, lstPopis.List(i), txtHledej, 1) > 0 Then
      lstPopis.ListIndex = i
      Exit For
    End If
  Next i
  vybrana = i
End Sub

Private Sub cmdOK_Click()
  li = frmZbozi.lstZbozi.ListIndex
  flagBylFormular = True
  'typ
  flagBylFormular = True
  Cells(radek, 2) = frmZbozi.lstZbozi.List(li)
  'popis
  flagBylFormular = True
  Cells(radek, 3) = frmZbozi.lstPopis.List(li)
  'test desetine tecky, nahrada za carku
  tecka = InStr(frmZbozi.lstJC.List(li), ".")
  If tecka > 0 Then
    cislo = Left(frmZbozi.lstJC.List(li), tecka - 1) & "," & Right(frmZbozi.lstJC.List(li), Len(frmZbozi.lstJC.List(li)) - tecka)
    frmZbozi.lstJC.List(li) = cislo
  End If
  'jc
  flagBylFormular = True
  On Error Resume Next
  Cells(radek, 5) = ""
  Cells(radek, 5) = CLng(frmZbozi.lstJC.List(li))
  On Error GoTo 0
  'popis
  flagBylFormular = True
  Cells(radek, 7) = frmZbozi.lstSkupina.List(li)
  'vzorec sl F
  flagBylFormular = True
  Cells(radek, 6).FormulaR1C1 = "=RC[-1]*RC[-2]"
  'nakupka
  flagBylFormular = True
  Cells(radek, 9) = frmZbozi.lstNakupka.List(li)
  'vzorec sl J
  flagBylFormular = True
  Cells(radek, 10).FormulaR1C1 = "=RC[-1]*RC[-6]"
  'DB RS sl M
  flagBylFormular = True
  Cells(radek, 13).FormulaR1C1 = frmZbozi.lstDbRs.List(li)
  'DB IRC sl N
  flagBylFormular = True
  Cells(radek, 14).FormulaR1C1 = frmZbozi.lstDbIrc.List(li)
  Unload Me
  Unload Me
End Sub

Private Sub cmdStorno_Click()
  flagBylFormular = True
  rad = ActiveCell.Row
  Range("B" & rad & ":J" & rad).ClearContents
  Unload Me
End Sub

Private Sub cmdVybratPrvni_Click()
  On Error Resume Next
  lstZbozi.ListIndex = 0
  vybrana = -1
End Sub

Private Sub cmdZapisTextu_Click()
  flagBylFormular = True
  ActiveCell = txtZbozi
  Unload Me
End Sub

Private Sub lstPopis_Click()
  lstZbozi.ListIndex = lstPopis.ListIndex
End Sub

Private Sub lstZbozi_Click()
  lstPopis.ListIndex = lstZbozi.ListIndex
End Sub

Private Sub lstZbozi_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
  flagZmenaIndexu = True
  txtZbozi = lstZbozi.Text
  flagZmenaIndexu = False
End Sub

Private Sub txtHledej_Change()

End Sub

Private Sub txtZbozi_Change()
  If flagZmenaIndexu = True Then Exit Sub
  X = UCase(txtZbozi)
  d = Len(X)
  For i = 0 To lstZbozi.ListCount - 1
    If X = UCase(Left(lstZbozi.List(i), d)) Then
      lstZbozi.ListIndex = i
      On Error Resume Next
      lstZbozi.ListIndex = i + 26
      On Error GoTo 0
      lstZbozi.ListIndex = i
      Exit For
    End If
  Next i
End Sub

Private Sub txtZbozi_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

End Sub

Private Sub UserForm_Activate()
  txtZbozi = ActiveCell
  NaplnLstZbozi
  vybrana = -1
  Application.OnKey "{DOWN}", "SipkaDolu"
  Application.OnKey "{UP}", "SipkaNahoru"
  txtZbozi_Change
  txtZbozi.SetFocus
End Sub

Private Sub UserForm_Click()
  
End Sub

Private Sub UserForm_Deactivate()
  
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
  Application.OnKey "{DOWN}", "SipkaDolu0"
  Application.OnKey "{UP}", "SipkaNahoru0"
End Sub

' InQuest injected base64 decoded content
' rgNv

INQUEST-PP=macro
