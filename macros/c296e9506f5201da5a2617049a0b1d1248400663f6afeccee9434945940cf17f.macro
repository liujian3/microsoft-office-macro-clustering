Attribute VB_Name = "DieseArbeitsmappe"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Modul1"
Attribute VB_Name = "Modul2"
Sub Makro1()
Attribute Makro1.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Makro1 Makro
'

'
End Sub
Attribute VB_Name = "Tabelle2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "UserForm1"
Attribute VB_Base = "0{D9F7A163-B424-4DE6-8051-EE0C40555C87}{7EC966EF-C94C-4C15-AF12-6BC655D1EB28}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CheckBox1_Click()
If CheckBox1.Value = True Then
   On Error Resume Next
   Sheets("KB-Liste 2019").Delete
   CheckBox1.Value = False
   End If
 Sheets("Buttons").Select
End Sub

Private Sub CheckBox2_Click()
If CheckBox2.Value = True Then
   On Error Resume Next
   Sheets("Matriste 2020").Delete
   CheckBox2.Value = False
 End If
 Sheets("Buttons").Select
End Sub

Private Sub CheckBox3_Click()
If CheckBox3.Value = True Then
On Error Resume Next
   Sheets("Status 2019").Delete
   CheckBox3.Value = False
    End If
 Sheets("Buttons").Select
End Sub

Private Sub CheckBox4_Click()
If CheckBox4.Value = True Then
On Error Resume Next
   Sheets("Bibel 2020").Delete
   CheckBox4.Value = False
 End If
 Sheets("Buttons").Select
End Sub

Sub CheckBox5_Click()
If CheckBox5.Value = True Then
   CheckBox5.Value = False
   On Error Resume Next
   Sheets("Validierung").Delete
   Sheets("Validierung2").Delete
   CheckBox5.Value = False
   End If
 Sheets("Buttons").Select
End Sub

Private Sub CheckBox6_Click()
If CheckBox6.Value = True Then
If Worksheets("Sortiment 2020").Range("C7").Value = 0 Then GoTo fehler
Dim ziel As Workbook
Set ziel = ThisWorkbook 'f|fffd|r Excel Zwischenspeicherung
Application.Dialogs(xlDialogOpen).Show '|fffd|ffne Quelldatei
If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   Z = ActiveSheet.UsedRange.Rows.Count
   Range("C1:O" & Z).Select
   Selection.Copy
   ziel.Worksheets("Preisliste 2020").Activate 'wechselt zur Zieldatei zur|fffd|ck
   ziel.Worksheets("Preisliste 2020").Range("C1").Select
   ActiveSheet.Paste
   Range("D1:N" & Z).Delete
   Application.CutCopyMode = False 'setzt Zwischenablage in Datei ein
Sheets("Sortiment 2020").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
   Range("Q6").Select
    ActiveCell.FormulaR1C1 = _
        "=VLOOKUP(RC[-14],'Preisliste 2020'!C[-14]:C[-13],2,0)"
   Selection.Copy
   ActiveSheet.Range("Q7:Q" & Z).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("R6").Select
   ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(Q6)" & ";" & "J6" & ";" & "wenn(Q6=0" & ";" & "J6" & ";" & "Q6))"
   Selection.Copy
   ActiveSheet.Range("R7:R" & Z).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ActiveSheet.Range("R6:R" & Z).Select
   Selection.Copy
   ActiveSheet.Range("N6:N" & Z).PasteSpecial Paste:=xlPasteValues
   Application.CutCopyMode = False
   Range("Q6:R" & Z).Delete
   Range("C7").Select
Sheets("delisted Artikel").Select
   If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   Z = ActiveSheet.UsedRange.Rows.Count
      Range("R3").Select
      ActiveCell.FormulaR1C1 = _
        "=IF(OR(RC[-7]="""",RC[-7]=0),"""",VLOOKUP(RC[-10],'Preisliste 2020'!C[-15]:C[-14],2,0))"
      Selection.Copy
      ActiveSheet.Range("R3:R" & Z).Select
      ActiveSheet.Paste
      Application.CutCopyMode = False
      ActiveSheet.Range("R3:R" & Z).Select
      Selection.Copy
      ActiveSheet.Range("K3:K" & Z).PasteSpecial Paste:=xlPasteValues
      Application.CutCopyMode = False
   Range("R3").Select
  ' ActiveCell.FormulaR1C1 = _
        "=VLOOKUP(RC[-10],'Preisliste 2020'!C[-15]:C[-14],2,0)"
        'ActiveCell.FormulaR1C1 = _
        "=IF(RC[-7]<>"""",IF(RC[-7]=0,VLOOKUP(RC[-7],'Matriste 2015'!C[-10]:C[-9],2,0),IF(ISERROR(VLOOKUP(RC[-7],'Bibel 2020'!C[-10],1,0)),VLOOKUP(RC[-7],'KB-Liste 2019'!C[-10]:C[-7],4,0),VLOOKUP(RC[-7],'Bibel 2020'!C[-10]:C[2],13,0))),"""")"
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-10]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-10],'Preisliste 2020'!C[-15]:C[-14],2,0)),VLOOKUP(RC[-10],'Bibel 2020'!C[-17]:C[5],23,0),VLOOKUP(RC[-10],'Preisliste 2020'!C[-14]:C[-15],2,0)))"
   Selection.Copy
   ActiveSheet.Range("R4:R" & Z).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   'Range("S3").Select
   'ActiveCell.FormulaR1C1 = _
        "=IF(RC[-8]="""",IF(ISERROR(VLOOKUP(RC[-8],'Preisliste 2020'!C[-15]:C[-14],1,0)),VLOOKUP(RC[-8],'Bibel 2020'!C[-17]:C[5],23,0),VLOOKUP(RC[-8],'Preisliste 2020'!C[-15]:C[-14],2,0)))"
   'Selection.Copy
   'ActiveSheet.Range("S4:S" & Z).Select
   'ActiveSheet.Paste
   'Application.CutCopyMode = False
   'Range("T3").Select
   'ActiveCell.FormulaR1C1 = "=IF(RC[-12]=""keine"","""",RC[-1])"
   'Selection.Copy
   'ActiveSheet.Range("T4:T" & Z).Select
   'ActiveSheet.Paste
   'Application.CutCopyMode = False
   'ActiveSheet.Range("T3:T" & Z).Select
   'Selection.Copy
   'ActiveSheet.Range("K3:K" & Z).PasteSpecial Paste:=xlPasteValues
   'Application.CutCopyMode = False
   Range("R3:T" & Z).ClearContents
   y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
   Range("K" & y + 1 & ":R" & y + 1).Select
   Selection.Delete
   y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
   Range("R3").Select
   Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
        ActiveCell.FormulaR1C1 = _
        "=IF(RC[-10]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-10],'Preisliste 2020'!C[-17]:C[-16],1,0)),VLOOKUP(RC[-10],'Bibel 2020'!C[-17]:C[5],23,0),VLOOKUP(RC[-10],'Preisliste 2020'!C[-17]:C[-16],2,0)))"
    Selection.Copy
    Range("R3:R" & y).Select
    ActiveSheet.Paste
   Range("C4").Select
Sheets("Alternativsortiment").Select
  If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   Z = ActiveSheet.UsedRange.Rows.Count
   Range("R4").Select
'    ActiveCell.FormulaR1C1 = _
        "=VLOOKUP(RC[-10],'Preisliste 2020'!C[-14]:C[-13],2,0)"
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Preisliste 2020'!C[-15]:C[-14],2,0)),RC[-7],VLOOKUP(RC[-10],'Preisliste 2020'!C[-15]:C[-14],2,0))"
   Selection.Copy
   ActiveSheet.Range("R5:R" & Z).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
 '  Range("S4").Select
  ' ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(R4)" & ";" & "SVERWEIS(A4" & ";" & "'Sortiment 2020'!C5:J" & Z & ";" & "8" & ";0)*1,03" & ";" & "WENN(R4=0" & ";" & "SVERWEIS(A4" & ";" & "'Sortiment 2020'!C5:J" & Z & ";" & "8" & ";0)" & ";R4))"
   'Selection.Copy
   'ActiveSheet.Range("S5:S" & Z).Select
   'ActiveSheet.Paste
   'Application.CutCopyMode = False
   'Range("T4").Select
   'ActiveCell.FormulaR1C1 = "=IF(RC[-12]=""keine"","""",RC[-1])"
   'Selection.Copy
   'ActiveSheet.Range("T5:T" & Z).Select
   'ActiveSheet.Paste
   'Application.CutCopyMode = False
   ActiveSheet.Range("R4:R" & Z).Select
   Selection.Copy
   ActiveSheet.Range("K4:K" & Z).PasteSpecial Paste:=xlPasteValues
   Application.CutCopyMode = False
   Range("R4:T" & Z).ClearContents
   y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
   Range("K" & y + 1 & ":R" & y + 1).Delete
   Range("C5").Select
   
Sheets("Alternativsortiment").Select     ' PL und Katalogseite einf|fffd|gen in Alternativsortiment
        Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("R4").Select
        ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],Verbrauchsdaten!C[-17]:C[-15],3,0)"
        Range("S4").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-11],'Bibel 2020'!C[-18]:C[-10],9,0)),VLOOKUP(RC[-11],'KB-Liste 2019'!C[-18]:C[-16],3,0),VLOOKUP(RC[-11],'Bibel 2020'!C[-18]:C[-10],9,0))"
        Range("T4").Select
         ActiveCell.FormulaR1C1 = _
        "=IF(RC[-12]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-12],'Preisliste 2020'!C[-19]:C[-18],1,0)),VLOOKUP(RC[-12],'KB-Liste 2019'!C[-19]:C[-6],14,0),VLOOKUP(RC[-12],'Preisliste 2020'!C[-19]:C[-18],2,0)))"
        Range("R4:T4").Select
        Selection.Copy
        Range("R4:T" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        
Sheets("Sortiment 2020").Select
   Range("Q6:R6").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
        Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("Q6").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-14],'Preisliste 2020'!C[-16]:C[-15],1,0)),VLOOKUP(RC[-14],'KB-Liste 2019'!C[-16]:C[-3],14,0),VLOOKUP(RC[-14],'Preisliste 2020'!C[-16]:C[-15],2,0))"
        Range("R6").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-15],'Bibel 2020'!C[-17]:C[-9],9,0)),VLOOKUP(RC[-15],'KB-Liste 2019'!C[-17]:C[-15],3,0),VLOOKUP(RC[-15],'Bibel 2020'!C[-17]:C[-9],9,0))"
        Range("Q6:R6").Select
        Selection.Copy
        Range("Q6:R" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
    Sheets("Buttons").Select
   MsgBox "KB-Preise im vorliegenden Sortiment aktualisiert"
   
   Exit Sub
fehler:
   MsgBox "Bibel kann nur bei bereits erstellten Sortimenten aktualisiert werden"
   End If
   CheckBox6.Value = False
      Exit Sub
   End Sub



Sub Farben()
Sheets("Bibel 2020").Select                            ' Farben einspielen
If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
    Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("G1").Select
        Selection.Sort key1:=Range("G1"), Order1:=xlDescending, Header:=xlGuess
        For i = 1 To Z Step 1000
    Range("AS" & i).Select
    'ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "Alternativsortiment!$H$3:L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "'delisted Artikel'!$H$2:L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "'Sortiment 2020'!$C$6:$L" & "$" & Z & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A2" & ";" & "'Sortiment 2020'!$C$6:L" & "$" & Z & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "'delisted Artikel'!$H$2:$L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "Alternativsortiment!$H$3:$L" & "$" & Z & ";" & "5" & ";" & "0))"
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "Alternativsortiment!H:L" & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "Alternativsortiment!H:L" & ";" & "5" & ";" & "0))"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-44],Alternativsortiment!R[1]C[-37]:R[62348]C[-33],5,0)),VLOOKUP(RC[-44],'Preisliste 2020'!C[-44]:C[-43],2,0),VLOOKUP(RC[-44],Alternativsortiment!R[1]C[-37]:R[62348]C[-33],5,0))"
    Range("AS" & i).Select
    Selection.Copy
    Range("AS" & i + 1 & ":AS" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AS" & i + 1 & ":AS" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AS" & i + 1 & ":AS" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Next i
    Range("AS" & Z + 1 & ":AS" & Z + 1000).ClearContents
    For i = 1 To Z Step 1000
    Range("AT" & i).Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "'delisted Artikel'!H:L" & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "'delisted Artikel'!H:L" & ";" & "5" & ";" & "0))"
    ' ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-45],'delisted Artikel'!RC[-38]:R[62348]C[-34],5,0)),VLOOKUP(RC[-45],'Preisliste 2020'!C[-45]:C[-44],2,0),VLOOKUP(RC[-45],'delisted Artikel'!RC[-38]:R[62348]C[-34],5,0))"
    Range("AT" & i).Select
    Selection.Copy
    Range("AT" & i + 1 & ":AT" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AT" & i & ":AT" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AT" & i & ":AT" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Next i
    Application.CutCopyMode = False
    Range("AT" & Z + 1 & ":AT" & Z + 1000).ClearContents
    For i = 1 To Z Step 1000
    Range("AU" & i).Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "'Sortiment 2020'!C:L" & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "'Sortiment 2020'!C:L" & ";" & "10" & ";" & "0))"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-46],'Sortiment 2020'!R[3]C[-44]:R[62348]C[-35],10,0)),VLOOKUP(RC[-46],'Preisliste 2020'!C[-46]:C[-45],2,0),VLOOKUP(RC[-46],'Sortiment 2020'!R[3]C[-44]:R[62348]C[-35],10,0))"
    Range("AU" & i).Select
    Selection.Copy
    Range("AU" & i + 1 & ":AU" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AU" & i & ":AU" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AU" & i & ":AU" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    Range("AU" & Z + 1 & ":AU" & Z + 1000).ClearContents
    Range("AV2").Select
    ActiveCell.FormulaLocal = "=MIN(AS2:AU2)"
    Range("AV2").Select
    Selection.Copy
    Range("AV3:AV" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AV2:AV" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AV2:AV" & Z).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("AV2:AV" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AS2:AS" & Z).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("AT2:AV" & Z).ClearContents
       For i = 1 To 30
    Range("AT2").Select
    ActiveCell.FormulaR1C1 = _
        "=MIN(IF(AND(LEFT(RC[-39],7)=LEFT(R[1]C[-39],7),RIGHT(RC[-39],5)<>RIGHT(R[1]C[-39],5),RC[-33]=R[1]C[-33],LEFT(R[-1]C[-39],7)=LEFT(RC[-39],7),RIGHT(R[-1]C[-39],5)<>RIGHT(RC[-39],5),R[-1]C[-33]=RC[-33]),MIN(R[-1]C[-1]:R[1]C[-1]),RC[-1]),IF(AND(LEFT(RC[-39],7)=LEFT(R[1]C[-39],7),RIGHT(RC[-39],5)<>RIGHT(R[1]C[-39],5),RC[-33]=R[1]C[-33]),MIN(RC[-1],R[1]C[-1]),RC[-1]),IF(AND(LEFT(R[-1]C[-39],7)=LEFT(RC[-39],7),RIGHT(R[-1]C[-39],5)<>RIGHT(RC[-39],5),R[-1]C[-33]=RC[-33]),MIN(R[-1]C[-1]:RC[-1]),RC[-1]))"
    Range("AT2").Select
    Selection.Copy
    Range("AT2:AT" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AT2:AT" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AS2:AS" & Z).PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    For i = 1 To Z Step 1000
    Range("AU" & i).Select
    'ActiveCell.FormulaR1C1 = _
        "=IF(RC[-2]<VLOOKUP(RC[-46],'Preisliste 2020'!C[-46]:C[-45],2,0),""Kern"",""Rand"")"
    ActiveCell.FormulaLocal = "=WENN(AS" & i & "<SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & """Kern""" & ";" & """Rand""" & ")"
    Range("AU" & i).Select
    Selection.Copy
    Range("AU" & i & ":AU" & i + 1000).Select
    ActiveSheet.Paste
    Range("AU" & i & ":AU" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AU" & i & ":AU" & i + 1000).Select
    'Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    Range("AU" & Z + 1 & ":AU" & Z + 1000).ClearContents
    Range("AT1:AU" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AT1:AU" & Z).PasteSpecial Paste:=xlValues
    Range("A1:AU1").Select
        Selection.AutoFilter
        ActiveSheet.Range("A1:AU" & Z).AutoFilter Field:=47, Criteria1:="Kern"
         Range("A2:A" & Z).Select
        Range("A2:A" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        'Z = ActiveSheet.UsedRange.Rows.Count
        y = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
        Range("B" & y + 1).Select
        Selection.PasteSpecial Paste:=xlValues
quelle.Sheets("Bibel 2020").Activate
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("G2:G" & Z).Select
        Range("G2:G" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("C" & y + 1).Select
        Selection.PasteSpecial Paste:=xlValues
quelle.Sheets("Bibel 2020").Activate
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("AS2:AS" & Z).Select
        Range("AS2:AS" & Z).SpecialCells(xlCellTypeVisible).Select
ziel.Activate
        y = ActiveSheet.Cells(Rows.Count, 6).End(xlUp).Row
        Range("F" & y + 1).Select
        Selection.PasteSpecial Paste:=xlValues
        CheckBox7.Value = False
End Sub

Private Sub CheckBox7_Click()
'Call Farben
End Sub

    Private Sub ComboBox1_Enter()
ComboBox1.Clear
    ComboBox1.AddItem "PP"
    ComboBox1.AddItem "0"
    ComboBox1.AddItem "1"
    ComboBox1.AddItem "2"
    ComboBox1.AddItem "4"
    ComboBox1.AddItem "6"
    ComboBox1.AddItem "8"
    ComboBox1.AddItem "A"
    ComboBox1.AddItem "B"
    ComboBox1.AddItem "C"
    ComboBox1.AddItem "D"
    ComboBox1.AddItem "E"
    End Sub

Private Sub ComboBox1_Click()
Dim vorhanden As Boolean, n As Worksheet
For Each n In ThisWorkbook.Worksheets
    If n.Name = "Verbrauchsdaten" Then
        vorhanden = True
        Call Makro1
        Exit For
    End If
Next n
If vorhanden = False Then MsgBox "keine Statistik eingespielt"
End Sub
        
    
Sub Makro1()
Sheets("KB-Liste 2019").Select
Z = ActiveSheet.UsedRange.Rows.Count
Range("N1:N" & Z).Select
Selection.Copy
ActiveSheet.Range("AF1:AF" & Z).Select
ActiveSheet.Paste
Application.CutCopyMode = False
value_selected = ComboBox1.List(ComboBox1.ListIndex)
Select Case ComboBox1.Value
    Case "PP"
     Sheets("KB-Liste 2019").Range("AE2").Value = InputBox("Bitte Rabatt f|fffd|r 2019 eintragen:", "", "Bitte nur den Wert eintragen")
     Sheets("KB-Liste 2019").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AE2").Select
     Selection.Copy
     Range("AE2:AE" & Z).Select
     ActiveSheet.Paste
     Range("AF2").Select
     ActiveCell.FormulaLocal = "=WENN(AD2=" & """b""" & ";" & "RUNDEN(N2*(1-AE2%)" & ";" & "2)" & ";" & "N2)"
     Range("AF2").Select
     Selection.Copy
     Range("AF2:AF" & Z).Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    ' value_selected = ComboBox1.List(ComboBox1.ListIndex) '
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:[-15],14,0)"
     ActiveCell.FormulaR1C1 = _
         "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[22],32,0)),RC[-5]/RC[-7],IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[22],32,0)=0,RC[-5]/RC[-7],VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[22],32,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
    
    Exit Sub
    
    Case "0"
    value_selected = ComboBox1.List(ComboBox1.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],15,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],15,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],15,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],15,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'Range("AO2").Select
    'ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    'Range("AO2").Select
    'Selection.Copy
    'ActiveSheet.Range("AO3:AO" & Z).Select
    'ActiveSheet.Paste
    'Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & Z).Select
    'Selection.Copy
    'ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "1"
   ' value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],16,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],16,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],16,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],16,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "2"
   ' value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],17,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],17,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],17,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],17,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "4"
    'value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],18,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],18,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],18,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],18,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-27],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "6"
   ' value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],19,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],19,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],19,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],19,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "8"
   ' value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],20,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],20,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],20,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],20,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "A"
   ' value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],21,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],21,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],21,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],21,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "B"
   ' value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],22,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],22,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],22,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],22,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "C"
    'value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],23,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],23,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],23,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],23,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "D"
    'value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],24,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],24,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],24,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],24,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
     Exit Sub
    Case "E"
   ' value_selected = ComboBox1.List(ComboBox1.ListIndex)'
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("J2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[-15],25,0)"
     ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],25,0)),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),IF(VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],25,0)=0,VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[4],14,0),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[241],25,0)))"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-31],2)"
    Range("AO2").Select
    Selection.Copy
    ActiveSheet.Range("AO3:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
    Exit Sub
        End Select
    Sheets("Buttons").Select
    MsgBox "Preisliste 2019 ausgew|fffd|hlt"
    
    End Sub


Private Sub ComboBox2_Enter()
ComboBox2.Clear
    ComboBox2.AddItem "PP"
    ComboBox2.AddItem "0"
    ComboBox2.AddItem "1"
    ComboBox2.AddItem "2"
    ComboBox2.AddItem "4"
    ComboBox2.AddItem "6"
    ComboBox2.AddItem "8"
    ComboBox2.AddItem "A"
    ComboBox2.AddItem "B"
    ComboBox2.AddItem "C"
    ComboBox2.AddItem "D"
    ComboBox2.AddItem "E"
End Sub

Private Sub ComboBox2_Click()
'If Worksheets("Verbrauchsdaten").Range("R2").Value = 0 Then GoTo fehler
Dim vorhanden As Boolean, n As Worksheet
For Each n In ThisWorkbook.Worksheets
    If n.Name = "Verbrauchsdaten" Then
        vorhanden = True
        Call Makro2
        Exit For
    End If
Next n
If vorhanden = False Then MsgBox "keine Statistik eingespielt"
End Sub

Sub Makro2()
Sheets("Bibel 2020").Select
Z = ActiveSheet.UsedRange.Rows.Count
Range("W1:W" & Z).Select
Selection.Copy
ActiveSheet.Range("AQ1:AQ" & Z).Select
ActiveSheet.Paste
Application.CutCopyMode = False
value_selected = ComboBox2.List(ComboBox2.ListIndex)
Select Case ComboBox2.Value
    Case "PP"
    Sheets("Bibel 2020").Range("AP2").Value = InputBox("Bitte Rabatt f|fffd|r 2020 eintragen:", "", "Bitte nur den Wert eintragen")
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AP2").Select
     Selection.Copy
     Range("AP2:AP" & Z).Select
     ActiveSheet.Paste
     Range("AQ2").Select
     ActiveCell.FormulaLocal = "=WENN(AO2=" & """b""" & ";" & "RUNDEN(W2*(1-AP2%)" & ";" & "2)" & ";" & "W2)"
     Range("AQ2").Select
     Selection.Copy
     Range("AQ2:AQ" & Z).Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AQ1:AQ" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Range("B1").PasteSpecial Paste:=xlValues
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],23,0)"
    ActiveCell.FormulaR1C1 = _
         "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[32],43,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[32],43,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[32],43,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[34],43,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    ActiveCell.FormulaR1C1 = _
          "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[22],32,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
    Exit Sub
    Case "0"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("X1:X" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],24,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],24,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],24,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],24,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],24,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";15" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],15,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "1"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("Y1:Y" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],25,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],25,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],25,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],25,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],25,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";16" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],16,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "2"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("Z1:Z" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],26,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],26,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],26,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],26,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],26,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";17" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],17,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "4"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AA1:AA" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],27,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],27,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],27,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],27,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],27,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";18" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],18,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "6"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AB1:AB" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],28,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],28,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],28,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],28,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],28,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";19" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],19,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "8"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AC1:AC" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],29,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],29,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],29,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],29,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],29,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";20" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],20,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "A"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AD1:AD" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],30,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],30,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],30,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],30,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],30,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";21" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],21,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "B"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AE1:AE" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],31,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],31,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],31,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],31,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],31,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";22" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],22,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "C"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AF1:AF" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],32,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],32,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],32,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],32,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],32,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";23" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],23,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "D"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AG1:AG" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],33,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],33,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],33,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],33,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],33,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";24" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],24,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
     Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
     Exit Sub
    Case "E"
    Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("A1:A" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Sheets("Bibel 2020").Select
     Z = ActiveSheet.UsedRange.Rows.Count
     Range("AH1:AH" & Z).Select
     Selection.Copy
     Sheets("Preisliste 2020").Select
     Range("B1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
    value_selected = ComboBox2.List(ComboBox2.ListIndex)
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveSheet.Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],34,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],34,0)),RC[-1],IF(VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],34,0)=0,RC[-1],VLOOKUP(RC[-10],'Bibel 2020'!C[-10]:C[23],34,0)))"
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AQ2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-32],2)"
    Range("AQ2").Select
    Selection.Copy
    ActiveSheet.Range("AQ3:AQ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AQ2:AQ" & Z).Select
    Selection.Copy
    ActiveSheet.Range("K2:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Sheets("cmc").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[25],34,0)"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Range("J1").Select
    Range("J1").FormulaLocal = "=WENN(ODER(ISTFEHLER(I1)" & ";SVERWEIS(A1" & " ;'KB-Liste 2019'!A:Y" & ";25" & ";0)=0)" & ";SVERWEIS(A1" & ";'KB-Liste 2019'!A:Y" & ";14" & ";0)" & ";I1)"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-1]),VLOOKUP(RC[-9],'KB-Liste 2019'!C[-9]:C[15],25,0),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("J2:J" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AQ2:AQ" & z).Delete
    Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
    Exit Sub
        End Select
        Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
    Exit Sub
fehler:
   MsgBox "Bitte zuerst Kriterien f|fffd|r Sortiment festlegen"
   Exit Sub
    Sheets("Buttons").Select
    MsgBox " Preisliste 2020 ausgew|fffd|hlt"
End Sub

Private Sub CommandButton1_Click()
On Error Resume Next
Sheets("Verbrauchsdaten").Select
Sheets("Verbrauchsdaten").Delete
anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Verbrauchsdaten"

Dim ziel As Workbook
Set ziel = ThisWorkbook 'f|fffd|r Excel Zwischenspeicherung

Application.Dialogs(xlDialogOpen).Show '|fffd|ffne Quelldatei

Worksheets(1).Range("1:90000").Copy 'kopiere alles zur Zieldatei

ziel.Worksheets("Verbrauchsdaten").Activate 'wechselt zur Zieldatei zur|fffd|ck
ziel.Worksheets("Verbrauchsdaten").Range("1:90000").PasteSpecial _
Paste:=xlPasteValues
Application.CutCopyMode = False 'setzt Zwischenablage in Datei ein

Worksheets(1).Cells(1, 1).Select 'zeigt Zieldatei wieder an
Sheets("Verbrauchsdaten").Select
ActiveSheet.Columns("C:H").Delete
'ActiveSheet.Columns("D").Delete'
ActiveSheet.Columns("E").Delete '
Sheets("Verbrauchsdaten").Move After:=Sheets(anzahl + 1)
Sheets("Buttons").Select
MsgBox "Verbrauchsstatistik ist eingespielt"
End Sub

Private Sub CommandButton10_Click()
Dim vorhanden As Boolean, n As Worksheet
For Each n In ThisWorkbook.Worksheets
    If n.Name = "Verbrauchsdaten" Then
        vorhanden = True
        Call Makro4
        Exit For
    End If
Next n
If vorhanden = False Then MsgBox "keine Statistik eingespielt"
End Sub
Sub Makro4()
If Worksheets("Verbrauchsdaten").Range("G1").Value = 0 Then GoTo fehler Else
Sheets("Verbrauchsdaten").Select
    ActiveSheet.Range("R1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Kern 2019"
    ActiveSheet.Range("R2").Select ' Betrachtung Umsatz und Verbrauch
    Selection.Font.Bold = False
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveCell.FormulaR1C1 = _
    "=IF(RC[-12]= ""0""  ,""Rand"",""Kern"")"
    Selection.Copy
    ActiveSheet.Range("R2:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Sheets("Buttons").Select
    MsgBox "aktuelles cmc |fffd|bernommen"
    Exit Sub
fehler:
   Sheets("Buttons").Select
    MsgBox "Bitte Preise einspielen"
   Exit Sub
End Sub

Private Sub CommandButton11_Click()
'If CheckBox1.Value = True Then
'   Sheets("KB-Liste 2019").Select
'   ActiveWindow.SelectedSheets.Delete
' End If
anzahl = Sheets.Count
Sheets.Add
On Error Resume Next
ActiveSheet.Name = "KB-Liste 2019"
Sheets("KB-Liste 2019").Select
Dim ziel As Workbook
Set ziel = ThisWorkbook 'f|fffd|r Excel Zwischenspeicherung
Application.Dialogs(xlDialogOpen).Show '|fffd|ffne Quelldatei
Worksheets(1).Range("1:65535").Copy 'kopiere alles zur Zieldatei
ziel.Worksheets(1).Activate 'wechselt zur Zieldatei zur|fffd|ck
ziel.Worksheets(1).Range("1:65535").PasteSpecial _
Paste:=xlPasteValues
Application.CutCopyMode = False 'setzt Zwischenablage in Datei ein

Worksheets(1).Cells(1, 1).Select 'zeigt Zieldatei wieder an
Sheets("KB-Liste 2019").Select
Z = ActiveSheet.UsedRange.Rows.Count
Range("N1:N" & Z).Select
Selection.Copy
ActiveSheet.Range("AF1:AF" & Z).Select
ActiveSheet.Paste
Application.CutCopyMode = False
Sheets("KB-Liste 2019").Move After:=Sheets(anzahl + 1)
Sheets("Buttons").Select
MsgBox "KB-Liste eingespielt"
End Sub

Private Sub CommandButton12_Click()
anzahl = Sheets.Count
Sheets.Add
On Error Resume Next
ActiveSheet.Name = "Matriste 2020"
Sheets("Matriste 2020").Select
Dim ziel As Workbook
Set ziel = ThisWorkbook 'f|fffd|r Excel Zwischenspeicherung

Application.Dialogs(xlDialogOpen).Show '|fffd|ffne Quelldatei

Worksheets(1).Range("1:90000").Copy 'kopiere alles zur Zieldatei

ziel.Worksheets(1).Activate 'wechselt zur Zieldatei zur|fffd|ck
ziel.Worksheets(1).Range("1:90000").PasteSpecial _
Paste:=xlPasteValues
Application.CutCopyMode = False 'setzt Zwischenablage in Datei ein

Worksheets(1).Cells(1, 1).Select 'zeigt Zieldatei wieder an
Sheets("Matriste 2020").Select
ActiveSheet.Columns("A:B").Delete
 If ActiveSheet.AutoFilterMode Then
    Selection.AutoFilter
 End If
     y = ActiveSheet.UsedRange.Rows.Count
    'Range("L2").Select
    'ActiveCell.FormulaR1C1 = "=IF(RC[-5]>0,RC[-5],0)"
    'Selection.Copy
    'ActiveSheet.Range("L2: L" & y).Select
    'ActiveSheet.Paste
    Range("A1:L1").Select
    Selection.AutoFilter
    Selection.AutoFilter Field:=7, Criteria1:="="
    'Range("J1:J" & Y).Select
    ActiveSheet.Range("G2:G" & y).SpecialCells(xlCellTypeVisible).Select
    'For i = 2 To 10
    'ActiveSheet.Range("G2:G" & i).SpecialCells(xlCellTypeVisible).Select
    'Range("G" & i).Select
    Range("G2") = "0"
    Range("G2").Select
    Selection.Copy
    ActiveSheet.Range("G2:G" & y).SpecialCells(xlCellTypeVisible).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    If ActiveSheet.AutoFilterMode Then
    Selection.AutoFilter
    End If
    'Next
    Sheets("Matriste 2020").Move After:=Sheets(anzahl + 1)
Sheets("Buttons").Select
MsgBox "Matriste 2020 ist eingespielt"
End Sub

Private Sub CommandButton13_Click()
    anzahl = Sheets.Count
Sheets.Add
On Error Resume Next
ActiveSheet.Name = "Status 2019"
Sheets("Status 2019").Select
Dim ziel As Workbook
Set ziel = ThisWorkbook 'f|fffd|r Excel Zwischenspeicherung

Application.Dialogs(xlDialogOpen).Show '|fffd|ffne Quelldatei
If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
Range("F3").Delete
Worksheets(2).Select
If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
  Z = ActiveSheet.UsedRange.Rows.Count
  Range("A1:D" & Z).Select
  Selection.Copy
  Worksheets(1).Select
  y = ActiveSheet.UsedRange.Rows.Count
  Range("A" & y + 1).Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
Worksheets(1).Range("1:90000").Copy 'kopiere alles zur Zieldatei

ziel.Worksheets(1).Activate 'wechselt zur Zieldatei zur|fffd|ck
ziel.Worksheets(1).Range("1:90000").PasteSpecial _
Paste:=xlPasteValues
Application.CutCopyMode = False 'setzt Zwischenablage in Datei ein

Worksheets(1).Cells(1, 1).Select 'zeigt Zieldatei wieder an
Sheets("Status 2019").Select
Sheets("Status 2019").Move After:=Sheets(anzahl + 1)
Sheets("Buttons").Select
MsgBox "Statusartikel sind eingespielt"
End Sub

Private Sub CommandButton14_Click()
anzahl = Sheets.Count
Sheets.Add
On Error Resume Next
ActiveSheet.Name = "Bibel 2020"
Sheets("Bibel 2020").Select
Dim ziel As Workbook
Set ziel = ThisWorkbook 'f|fffd|r Excel Zwischenspeicherung

Application.Dialogs(xlDialogOpen).Show '|fffd|ffne Quelldatei

Worksheets(1).Range("1:65535").Copy 'kopiere alles zur Zieldatei

ziel.Worksheets(1).Activate 'wechselt zur Zieldatei zur|fffd|ck
ziel.Worksheets(1).Range("1:65535").PasteSpecial _
Paste:=xlPasteValues
Application.CutCopyMode = False 'setzt Zwischenablage in Datei ein

Worksheets(1).Cells(1, 1).Select 'zeigt Zieldatei wieder an
Sheets("Bibel 2020").Select
ActiveSheet.Columns("A:B").Delete
Z = ActiveSheet.UsedRange.Rows.Count
Range("W1:W" & Z).Select
Selection.Copy
ActiveSheet.Range("AQ1:AQ" & Z).Select
ActiveSheet.Paste
Application.CutCopyMode = False
Sheets("Bibel 2020").Move After:=Sheets(anzahl + 1)
Sheets("Buttons").Select
MsgBox "VertriebsBibel 2020 ist eingespielt"
End Sub

Private Sub CommandButton15_Click()
If Worksheets("Sortiment 2020").Range("C7").Value = 0 Then GoTo fehler Else
anzahl = Sheets.Count
    On Error Resume Next
    Sheets("Validierung2").Select
    Sheets("Validierung2").Delete
    Sheets.Add
    ActiveSheet.Name = "Validierung2"
    Sheets("delisted Artikel").Select
    Cells.Copy
    Sheets("Validierung2").Select
    Range("A1").PasteSpecial _
    Paste:=xlPasteValues
    Range("A1").PasteSpecial _
    Paste:=xlPasteFormats
    y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("F1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[1])"
    Range("L1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[1])"
    Range("M3").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(RC[-5]=""keine"","""",((RC[-8]*RC[-9])/RC[-3])*RC[-1])"
    Range("M3").Copy
    Range("M3:M" & y).PasteSpecial
    Range("N3").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-6]=""keine"","""",(RC[-2]-RC[-3])/RC[-2])"
    Range("N3").Copy
    Range("N3:N" & y).PasteSpecial
        Range("P3").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-8]=""keine"","""",RC[-3]*RC[-2])"
    Range("P3").Copy
    Range("P3:P" & y).PasteSpecial
    Application.CutCopyMode = False
    Sheets("Validierung2").Move After:=Sheets("Gesamt|fffd|bersicht")
anzahl = Sheets.Count
On Error Resume Next
Sheets("Validierung").Select
Sheets("Validierung").Delete
Sheets.Add
ActiveSheet.Name = "Validierung"
Sheets("Sortiment 2020").Select
Cells.Copy
Sheets("Validierung").Select
Range("A1").PasteSpecial _
Paste:=xlPasteValues
Range("A1").PasteSpecial _
Paste:=xlPasteFormats
Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("D1").Select
    ActiveCell.FormulaR1C1 = "=R[1]C[11]-RC[4]"
    Range("E1").Select
    ActiveCell.FormulaR1C1 = "=RC[-1]/R[1]C[10]"
    Range("H1").Select
    ActiveCell.FormulaR1C1 = "=SUMIF(R4C5:R[745]C[-3],""Kern"",R4C15:R[745]C[7])"
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=RC[-1]/R[1]C[6]"
    Range("K2").Select
    ActiveCell.FormulaR1C1 = "=SUM(R4C11:R[1244]C)"
    Range("L2").Select
    ActiveCell.FormulaR1C1 = "=(1/RC[-1])*(RC[3]-RC[-1])"
    Range("P2").Select
    ActiveCell.FormulaR1C1 = "=R[-1]C[-1]-R[-1]C[-5]"
   Range("K1").Select
   ActiveCell.FormulaLocal = "=(1/K2)*SUMME(A6:A" & Z & ")"
   Range("O1").Select
   Range("O1").FormulaLocal = "=(1/O2)*(SUMME(B6:B" & Z & ")-((SUMME('Validierung2'!Q3:Q" & Z & ")-SUMME('Validierung2'!P3:P" & Z & "))))"
   Range("H2").Select
   ActiveCell.FormulaR1C1 = "=(RC[7]/0.8225)"
   Range("K2").Select
   ActiveCell.FormulaLocal = "=SUMME($K$6:K" & Z & ")"
   Range("O2").Select
   ActiveCell.FormulaLocal = "=SUMME($O$6:O" & Z & ")"
   Range("E3").Select
   ActiveCell.FormulaLocal = "=SUMMEWENN($G$6:G" & Z & ";" & "5" & ";" & "$O$6:O" & Z & ")"
   Range("E4").Select
   ActiveCell.FormulaLocal = "=E3/O2"
   Range("F4").Select
   ActiveCell.FormulaLocal = "=(1/E3)*SUMMEWENN($G$6:G" & Z & ";5;$B$6:B" & Z & ")"
   Range("I3").Select
   ActiveCell.FormulaLocal = "=SUMMEWENN($G$6:G" & Z & ";" & "8" & ";" & "$O$6:O" & Z & ")"
   Range("I4").Select
   ActiveCell.FormulaLocal = "=I3/O2"
   Range("J4").Select
   ActiveCell.FormulaLocal = "=(1/I3)*SUMMEWENN($G$6:G" & Z & ";" & "8" & ";" & "$B$6:B" & Z & ")"
   Range("L3").Select
   ActiveCell.FormulaLocal = "=O2-I3-E3"
   Range("L4").Select
   ActiveCell.FormulaLocal = "=L3/O2"
   Range("M4").Select
   ActiveCell.FormulaLocal = "=(1/L3)*(SUMME($B$6:B" & Z & ")" & "-" & "(SUMMEWENN($G$6:G" & Z & ";" & "5" & ";" & "$B$6:B" & Z & ")" & "+" & "SUMMEWENN($G$6:G" & Z & ";" & "8" & ";" & "$B$6:B" & Z & ")))"
   'ActiveCell.FormulaLocal = "=(1/L3)*(SUMME($B$6:B" & Z & ")" & "-" & "SUMMEWENN($G$6:G" & Z & ";" & "4" & "," & "7" & ";" & "$B$6:B" & Z & "))"
    Range("H1").Select
    ActiveCell.FormulaLocal = "=SUMMEWENN($E$6:E" & Z & ";""Kern"";$O$6:O" & Z & ")"
    Range("O3").FormulaLocal = "=(1/SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$K$6:K" & Z & "))" & "*SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$A$6:A" & Z & ")"
    'ActiveCell.FormulaLocal = "=(1/H1)*SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$A$6:A" & Z & ")"
    Range("Q3").FormulaLocal = "=(1/SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$K$6:K" & Z & "))" & "*SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$A$6:A" & Z & ")"
    'ActiveCell.FormulaLocal = "=(1/D1)*SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$A$6:A" & Z & ")"
    Range("O4").Select
    ActiveCell.FormulaLocal = "=(1/H1)*SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$B$6:B" & Z & ")"
    Range("Q4").Select
    ActiveCell.FormulaLocal = "=(1/D1)*SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$B$6:B" & Z & ")"
   Range("A6").Select
   ActiveCell.FormulaLocal = "=(I6-J6)*H6"
   Range("B6").Select
   ActiveCell.FormulaLocal = "=(L6-N6)*H6"
   Range("A6:B6").Select
   Selection.Copy
    ActiveSheet.Range("A7:B" & Z).Select
    ActiveSheet.Paste
    Range("K6").Select
    ActiveCell.FormulaR1C1 = "=RC[-2]*RC[-3]"
    Range("K6").Select
    Selection.Copy
    ActiveSheet.Range("K7: K" & Z).Select
    ActiveSheet.Paste
    Range("M6").Select
    ActiveCell.FormulaR1C1 = "=(RC[-1]-RC[1])/RC[-1]"
    Range("M6").Select
    Selection.Copy
    ActiveSheet.Range("M7:M" & Z).Select
    ActiveSheet.Paste
    Range("O6").Select
    ActiveCell.FormulaR1C1 = "=RC[-3]*RC[-7]"
    Range("O6").Select
    Selection.Copy
    ActiveSheet.Range("O7:O" & Z).Select
    ActiveSheet.Paste
    Sheets("Validierung").Move After:=Sheets("Gesamt|fffd|bersicht")
    Application.CutCopyMode = False
    Sheets("Buttons").Select
    MsgBox "Validierungsdatei erstellt"
    Exit Sub
fehler:
  MsgBox "kein bearbeitetes Sortiment vorhanden"
  Exit Sub
End Sub

Private Sub CommandButton16_Click()
If Worksheets("Sortiment 2020").Range("C7").Value = 0 Then GoTo fehler Else
anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Kunden|fffd|bersicht1"            ' Kundenzusammenfassung Hauptseite
Sheets("Gesamt|fffd|bersicht").Select
Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
Cells.Copy
Sheets("Kunden|fffd|bersicht1").Select
Range("A1").PasteSpecial _
Paste:=xlPasteValues
Range("A1").PasteSpecial _
Paste:=xlPasteFormats


    anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Kunden|fffd|bersicht2"            ' Kundenzusammenfassung Sortiment 2020
Sheets("Sortiment 2020").Select
Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
Cells.Copy
Sheets("Kunden|fffd|bersicht2").Select
Range("A1").PasteSpecial _
Paste:=xlPasteValues
Range("A1").PasteSpecial _
Paste:=xlPasteFormats
'Selection.Columns.Ungroup
ActiveSheet.Range("P1:P" & Z).Delete
ActiveSheet.Range("A1:B" & Z).Delete
ActiveSheet.Range("H4:H" & Z).Select
Selection.Delete Shift:=xlToLeft
ActiveSheet.Range("J4:K" & Z).Select
Selection.Delete Shift:=xlToLeft
ActiveSheet.Range("A1:G1").Select
Selection.Delete Shift:=xlToLeft
Range("A1:F1").ClearContents
Range("H3").Select
Selection.Delete Shift:=xlToLeft
Range("L2:M2").Select
Selection.Cut Destination:=Range("H1")
Range("K2").Select
Selection.Cut Destination:=Range("G1")
Range("K3").Select
Selection.Cut Destination:=Range("J1")
Range("K1:L" & Z).Select
Selection.Delete Shift:=xlToLeft
Range("D3:D4").ClearContents
Range("J2:J3").ClearContents
Range("A1:J4").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    Selection.Borders(xlEdgeTop).LineStyle = xlNone
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    Range("K1:M3").Delete
    Range("J1:J4").ClearContents
Range("A:J").Select
ActiveCell.Columns("A:J").EntireColumn.EntireColumn.AutoFit
Cells.FormatConditions.Delete

  anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Kunden|fffd|bersicht3"          ' Kunden|fffd|bersicht delisted Artikel
Sheets("delisted Artikel").Select
Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
Cells.Copy
Sheets("Kunden|fffd|bersicht3").Select
Range("A1").PasteSpecial _
Paste:=xlPasteValues
Range("A1").PasteSpecial _
Paste:=xlPasteFormats

Range("A1").Select
Range("N:Q").Delete
Selection.Delete Shift:=xlToLeft
Range("K2:K" & Z).Delete
Selection.Delete Shift:=xlToLeft
Range("C:C").Delete
Selection.Delete Shift:=xlToLeft
Range("I1").Copy
Range("J1:K1").Select
Range("J1:M1").PasteSpecial Paste:=xlPasteFormats
Cells.FormatConditions.Delete
Range("A1:K1").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    Selection.Borders(xlEdgeTop).LineStyle = xlNone
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone

anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Kunden|fffd|bersicht4"          ' Kunden|fffd|bersicht Alternativsortiment
Sheets("Alternativsortiment").Select
Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
Cells.Copy
Sheets("Kunden|fffd|bersicht4").Select
Range("A1").PasteSpecial _
Paste:=xlPasteValues
Range("A1").PasteSpecial _
Paste:=xlPasteFormats

Range("N:Q").Select
Range("N:Q").Delete
Selection.Delete Shift:=xlToLeft
Range("K3:K" & Z).Delete
Selection.Delete Shift:=xlToLeft
Range("I1:J1").ClearContents
Range("M:M").Delete

Cells.FormatConditions.Delete
Range("A1").Select
anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Bildauswertung 1"          ' Grafik Core Split
Sheets("Grafik Split").Select
Dim picDiaObjekt1 As Picture
    ActiveSheet.ChartObjects(1).Copy
    Sheets("Bildauswertung 1").Select
    Set picDiaObjekt1 = ActiveSheet.Pictures.Paste

anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Bildauswertung 2"          ' Grafik Einsparungen durch switch
Sheets("Grafik Einsparungen").Select
Dim picDiaObjekt2 As Picture
    ActiveSheet.ChartObjects(1).Copy
    Sheets("Bildauswertung 2").Select
    Set picDiaObjekt2 = ActiveSheet.Pictures.Paste

anzahl = Sheets.Count
Sheets.Add
ActiveSheet.Name = "Bildauswertung 3"          ' Grafik Verteilung Umsatz
Sheets("Grafik Umsatzverteilung").Select
Dim picDiaObjekt3 As Picture
    ActiveSheet.ChartObjects(1).Copy
    Sheets("Bildauswertung 3").Select
    Set picDiaObjekt3 = ActiveSheet.Pictures.Paste
    Sheets("Grafik Umsatzverteilung").Select
Dim picDiaObjekt4 As Picture
    ActiveSheet.ChartObjects(2).Copy
    Sheets("Bildauswertung 3").Select
    Range("K1").Select
    Set picDiaObjekt4 = ActiveSheet.Pictures.Paste
Sheets("Buttons").Select
    MsgBox "Bitte die erstellten Kundenbl|fffd|tter in eine neue Datei verschieben"
    Exit Sub
fehler:
  MsgBox "kein bearbeitetes Sortiment vorhanden"
  Exit Sub
End Sub

Sub Sortiment_pr|fffd|fen()
If Worksheets("Sortiment 2020").Range("C7").Value = 0 Then GoTo fehler Else
If Worksheets("Preisliste 2020").Range("B2").Value = 0 Then GoTo fehler1 Else
Sheets("Alternativsortiment").Select
   If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   If Range("A4").Value = 0 Then GoTo sprungmarke2
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("L4:L" & Z).Select
    Selection.Copy
    With Worksheets("Alternativsortiment").Range("L4:L" & Z)
    .PasteSpecial Paste:=xlValues
   Application.CutCopyMode = False
   End With
    Range("R4").Select
    'ActiveCell.FormulaR1C1 = _
        "=ROUND(RC[-6]*(1/VLOOKUP(RC[-10],'KB-Liste 2019'!C[-17]:C[-11],7,0)),2)*VLOOKUP(RC[-10],'KB-Liste 2019'!C[-17]:C[-11],7,0)"
    Range("R4").FormulaLocal = "=RUNDEN(L4*(1/SVERWEIS(H4" & ";'Bibel 2020'!A:T" & ";" & "20" & ";0))" & ";2)*SVERWEIS(H4" & ";'Bibel 2020'!A:T" & ";20" & ";0)"
   ActiveSheet.Range("R4").Select
    Selection.Copy
    ActiveSheet.Range("R5:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("R4:R" & Z).Select
   Selection.Copy
    With Worksheets("Alternativsortiment").Range("L4:L" & Z)
    .PasteSpecial Paste:=xlValues
   Application.CutCopyMode = False
   End With
   Selection.AutoFilter
   ActiveSheet.Range("R4:R" & Z).ClearContents
   Application.CutCopyMode = False
sprungmarke2:
   Range("C4").Select
Sheets("Sortiment 2020").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("L6:L" & Z).Select
    Selection.Copy
    With Worksheets("Sortiment 2020").Range("L6:L" & Z)
    .PasteSpecial Paste:=xlValues
    End With
    Range("Q6").Select
    Range("Q6").FormulaLocal = "=SVERWEIS(C6" & ";Alternativsortiment!$H$4:L" & Z & ";5" & ";0)"
    Range("R6").Select
    Range("R6").FormulaLocal = "=WENN(ISTFEHLER(Q6)" & ";" & "L6" & ";Q6)"
    Range("S6").Select
    Range("S6").FormulaLocal = "=WENN(R6<SVERWEIS(C6;Farbpr|fffd|fung;11;0)" & ";" & """Kern""" & ";" & """Rand"")"
    Range("Q6").Select
    Range("T6").Select
    Range("T6").FormulaLocal = "=WENN(ISTFEHLER(S6)" & ";" & "WENN(R6<SVERWEIS(C6" & ";cmc!A:J" & ";10" & ";0)" & ";" & """Kern""" & ";" & """Rand"")" & ";S6)"
    Range("U6").Select
    ActiveCell.FormulaR1C1 = _
         "=IF(RC[-1]=""Rand"",IF(AND(ISERROR(VLOOKUP(RC[-18],'Preisliste 2020'!C[-20]:C[-19],1,0)),ISERROR(VLOOKUP(RC[-18],'Bibel 2020'!C[-20]:C[22],43,0))),RC[-9],IF(ISERROR(VLOOKUP(RC[-18],'Preisliste 2020'!C[-20]:C[-19],1,0)),VLOOKUP(RC[-18],'Bibel 2020'!C[-20]:C[22],43,0),VLOOKUP(RC[-18],'Preisliste 2020'!C[-20]:C[-19],2,0))),RC[-3])"
    Range("V6").Select
    ActiveCell.FormulaR1C1 = "=IF(AND(RC[-2]=""Rand"",RC[-1]=0),""Kern"",RC[-2])"
    Range("W6").Select
    ActiveCell.FormulaR1C1 = "=IF(RC[-2]=0,RC[-11],RC[-2])"
    ActiveSheet.Range("Q6:W6").Select
    Selection.Copy
    ActiveSheet.Range("Q6:W" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("V6:W" & Z).Select
    Selection.Copy
    With Worksheets("Sortiment 2020").Range("V6:W" & Z)
    .PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    End With
    ActiveSheet.Range("V6:V" & Z).Select
    Selection.Copy
    With Worksheets("Sortiment 2020").Range("E6:E" & Z)
    .PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    End With
    ActiveSheet.Range("W6:W" & Z).Select
    Selection.Copy
    With Worksheets("Sortiment 2020").Range("L6:L" & Z)
    .PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    End With
    Range("C6").Select
Sheets("Alternativsortiment").Select
    If ActiveSheet.AutoFilterMode Then
    Selection.AutoFilter
   End If
   If Range("A4").Value = 0 Then GoTo sprungmarke3
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("R4").Select
    Range("R4").FormulaLocal = "=SVERWEIS(A4" & ";" & "'Sortiment 2020'!$C$6:E" & Z & " ;3;0)"
    Range("R4").Select
    Selection.Copy
    ActiveSheet.Range("R5:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("A3:T3").Select
        Selection.AutoFilter
        ActiveSheet.Range("A3:T3").AutoFilter Field:=18, Criteria1:="Rand"
        Range("R3:R" & Z).Select
        On Error GoTo weiter
        Range("A4:T" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Delete
    
weiter:
        
        Selection.AutoFilter
        Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("R4").Select
        Range("R4").FormulaLocal = "=WENN(L4>T4;T4;L4)"
        Range("R4").Select
        Selection.Copy
        ActiveSheet.Range("R5:R" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        ActiveSheet.Range("R4:R" & Z).Select
        Selection.Copy
        With Worksheets("Alternativsortiment").Range("L4:L" & Z)
        .PasteSpecial Paste:=xlValues
        Application.CutCopyMode = False
       End With
        Range("R4:R" & Z).ClearContents
        Range("R4").Select
        ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],Verbrauchsdaten!C[-17]:C[-15],3,0)"
        Range("S4").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-11],'Bibel 2020'!C[-18]:C[-10],9,0)),VLOOKUP(RC[-11],'KB-Liste 2019'!C[-18]:C[-16],3,0),VLOOKUP(RC[-11],'Bibel 2020'!C[-18]:C[-10],9,0))"
        Range("T4").Select
         ActiveCell.FormulaR1C1 = _
        "=IF(RC[-12]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-12],'Preisliste 2020'!C[-19]:C[-18],1,0)),VLOOKUP(RC[-12],'KB-Liste 2019'!C[-19]:C[12],32,0),VLOOKUP(RC[-12],'Preisliste 2020'!C[-19]:C[-18],2,0)))"
        Range("R4:T4").Select
        Selection.Copy
        Range("R4:T" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        'Selection.Delete
sprungmarke3:
        Range("C3").Select
        
Sheets("Sortiment 2020").Select
    If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("Q6:W" & Z).ClearContents
    'Selection.Delete
    Range("Q6").Select
    Range("Q6").FormulaLocal = "=RUNDEN(L6*(1/SVERWEIS(C6" & ";'Bibel 2020'!A:T" & ";" & "20" & ";0))" & ";2)*SVERWEIS(C6" & ";'Bibel 2020'!A:T" & ";20" & ";0)"
   ActiveSheet.Range("Q6").Select
    Selection.Copy
    ActiveSheet.Range("Q7:Q" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("Q6:Q" & Z).Select
   Selection.Copy
    With Worksheets("Sortiment 2020").Range("L6:L" & Z)
    .PasteSpecial Paste:=xlValues
   Application.CutCopyMode = False
   End With
   ActiveSheet.Range("Q6:Q" & Z).ClearContents
   Application.CutCopyMode = False
   
'sprung:
 '       Selection.AutoFilter
  '      Application.CutCopyMode = False
   '     Exit Sub
   Range("Q6:R6").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
        Range("Q6").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-14],'Preisliste 2020'!C[-16]:C[-15],1,0)),VLOOKUP(RC[-14],'KB-Liste 2019'!C[-16]:C[15],32,0),VLOOKUP(RC[-14],'Preisliste 2020'!C[-16]:C[-15],2,0))"
        Range("R6").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-15],'Bibel 2020'!C[-17]:C[-9],9,0)),VLOOKUP(RC[-15],'KB-Liste 2019'!C[-17]:C[-15],3,0),VLOOKUP(RC[-15],'Bibel 2020'!C[-17]:C[-9],9,0))"
        Range("Q6:R6").Select
        Selection.Copy
        Range("Q6:R" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Sheets("Buttons").Select
        MsgBox "Preise bei Z|fffd|hlerartikeln wurden angepasst sowie Sortiment aktualisiert"
        Exit Sub
fehler:
  MsgBox "kein bearbeitetes Sortiment vorhanden"
  Exit Sub
fehler1:
   MsgBox "Bitte noch einmal die PL 2020 ausw|fffd|hlen"
   Exit Sub
  Exit Sub
  Range("C6").Select
End Sub

Private Sub CommandButton17_Click()
Call Sortiment_pr|fffd|fen
End Sub

Private Sub CommandButton18_Click()
If Worksheets("Sortiment 2020").Range("C7").Value = 0 Then GoTo fehler Else
    Dim quelle As Workbook
    Dim ziel, wks As Worksheet
    Set quelle = ActiveWorkbook
    ziel = Application.GetOpenFilename("Microsoft Excel-Dateien (*.*), *.*")
    Set wks = Workbooks.Open(ziel).Sheets(1)
    Set ziel = wks
    'quelle.Sheets("Sortiment 2020").Activate
    'ziel.Sheets(1).Activate
quelle.Sheets("Sortiment 2020").Activate                 'Hauptsortiment in NAS-319 einspielen
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A5:P5").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=16, Criteria1:=Array( _
        "SPE/SPX", "C", "N", "N/A", "0"), Operator:=xlFilterValues
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=5, Criteria1:="Kern"
         Range("C6:C" & y).Select
        Range("C6:C" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        
        Range("B27").Select
        Selection.PasteSpecial Paste:=xlValues
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
 quelle.Sheets("Sortiment 2020").Activate
  Range("D6:D" & y).Select
        Range("D6:D" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        
        Range("C27").Select
        Selection.PasteSpecial Paste:=xlValues
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        
quelle.Sheets("Sortiment 2020").Activate
        Range("L6:L" & y).Select
        'On Error GoTo marke
        Range("L6:L" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
marke:
ziel.Activate
        Range("F27").Select
        Selection.PasteSpecial Paste:=xlValues
quelle.Activate
        Selection.AutoFilter
        Application.CutCopyMode = False
        Range("C6").Select
Sheets("delisted Artikel").Select                        ' delisted Artikel in NAS-319 einspielen
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A2:Q2").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$2:Q" & y).AutoFilter Field:=8, Criteria1:="<>keine"
        Range("A3:A" & y).Select
        If ActiveSheet.Rows(8).Find("keine") Is Nothing Then GoTo sprung
        Range("H3:I" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        'Z = ActiveSheet.UsedRange.Rows.Count
        Z = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
        Range("B" & Z + 1).Select
        Selection.PasteSpecial Paste:=xlValues
quelle.Sheets("delisted Artikel").Activate
        Range("L3:L" & y).Select
        Range("L3:L" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        Range("F" & Z + 1).Select
        Selection.PasteSpecial Paste:=xlValues
sprung:
quelle.Activate
        Selection.AutoFilter
        Application.CutCopyMode = False
        Range("A1").Select
        
Sheets("Alternativsortiment").Select                        ' Alternativen in NAS-319 einspielen
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("H4:I" & y).Select
        If Range("H4").Value = 0 Then GoTo weiter
        Selection.Copy
ziel.Activate
        'Z = ActiveSheet.UsedRange.Rows.Count
        Z = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
        Range("B" & Z + 1).Select
        Selection.PasteSpecial Paste:=xlValues
quelle.Sheets("Alternativsortiment").Activate
        Range("L4:L" & y).Select
        Selection.Copy
ziel.Activate
        Range("F" & Z + 1).Select
        Selection.PasteSpecial Paste:=xlValues
quelle.Activate
weiter:
        Selection.AutoFilter
        Application.CutCopyMode = False
        Range("A1").Select
If CheckBox7.Value = True Then
Sheets("Bibel 2020").Select                            ' Farben einspielen
If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
    Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("A1:AA1").Select
        Selection.Sort key1:=Range("G1"), Order1:=xlDescending, Header:=xlYes
        For i = 1 To Z Step 1000
    Range("AS" & i).Select
    'ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "Alternativsortiment!$H$3:L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "'delisted Artikel'!$H$2:L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "'Sortiment 2020'!$C$6:$L" & "$" & Z & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A2" & ";" & "'Sortiment 2020'!$C$6:L" & "$" & Z & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "'delisted Artikel'!$H$2:$L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "Alternativsortiment!$H$3:$L" & "$" & Z & ";" & "5" & ";" & "0))"
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "Alternativsortiment!H:L" & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "Alternativsortiment!H:L" & ";" & "5" & ";" & "0))"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-44],Alternativsortiment!R[1]C[-37]:R[62348]C[-33],5,0)),VLOOKUP(RC[-44],'Preisliste 2020'!C[-44]:C[-43],2,0),VLOOKUP(RC[-44],Alternativsortiment!R[1]C[-37]:R[62348]C[-33],5,0))"
    Range("AS" & i).Select
    Selection.Copy
    Range("AS" & i + 1 & ":AS" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AS" & i + 1 & ":AS" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AS" & i + 1 & ":AS" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Next i
    Range("AS" & Z + 1 & ":AS" & Z + 1000).ClearContents
    For i = 1 To Z Step 1000
    Range("AT" & i).Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "'delisted Artikel'!H:L" & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "'delisted Artikel'!H:L" & ";" & "5" & ";" & "0))"
    ' ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-45],'delisted Artikel'!RC[-38]:R[62348]C[-34],5,0)),VLOOKUP(RC[-45],'Preisliste 2020'!C[-45]:C[-44],2,0),VLOOKUP(RC[-45],'delisted Artikel'!RC[-38]:R[62348]C[-34],5,0))"
    Range("AT" & i).Select
    Selection.Copy
    Range("AT" & i + 1 & ":AT" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AT" & i & ":AT" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AT" & i & ":AT" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Next i
    Application.CutCopyMode = False
    Range("AT" & Z + 1 & ":AT" & Z + 1000).ClearContents
    For i = 1 To Z Step 1000
    Range("AU" & i).Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "'Sortiment 2020'!C:L" & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "'Sortiment 2020'!C:L" & ";" & "10" & ";" & "0))"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-46],'Sortiment 2020'!R[3]C[-44]:R[62348]C[-35],10,0)),VLOOKUP(RC[-46],'Preisliste 2020'!C[-46]:C[-45],2,0),VLOOKUP(RC[-46],'Sortiment 2020'!R[3]C[-44]:R[62348]C[-35],10,0))"
    Range("AU" & i).Select
    Selection.Copy
    Range("AU" & i + 1 & ":AU" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AU" & i & ":AU" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AU" & i & ":AU" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    Range("AU" & Z + 1 & ":AU" & Z + 1000).ClearContents
    Range("AV2").Select
    ActiveCell.FormulaLocal = "=MIN(AS2:AU2)"
    Range("AV2").Select
    Selection.Copy
    Range("AV3:AV" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AV2:AV" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AV2:AV" & Z).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("AV2:AV" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AS2:AS" & Z).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("AT2:AV" & Z).ClearContents
       For i = 1 To 30
    Range("AT2").Select
    ActiveCell.FormulaR1C1 = _
        "=MIN(IF(AND(LEFT(RC[-39],20)=LEFT(R[1]C[-39],20),RIGHT(RC[-39],15)<>RIGHT(R[1]C[-39],15),RC[-33]=R[1]C[-33],LEFT(R[-1]C[-39],20)=LEFT(RC[-39],20),RIGHT(R[-1]C[-39],15)<>RIGHT(RC[-39],15),R[-1]C[-33]=RC[-33]),MIN(R[-1]C[-1]:R[1]C[-1]),RC[-1]),IF(AND(LEFT(RC[-39],20)=LEFT(R[1]C[-39],20),RIGHT(RC[-39],15)<>RIGHT(R[1]C[-39],15),RC[-33]=R[1]C[-33]),MIN(RC[-1],R[1]C[-1]),RC[-1]),IF(AND(LEFT(R[-1]C[-39],10)=LEFT(RC[-39],10),RIGHT(R[-1]C[-39],15)<>RIGHT(RC[-39],15),R[-1]C[-33]=RC[-33]),MIN(R[-1]C[-1]:RC[-1]),RC[-1]))"
    Range("AT2").Select
    Selection.Copy
    Range("AT2:AT" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AT2:AT" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AS2:AS" & Z).PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    For i = 1 To Z Step 1000
    Range("AU" & i).Select
    'ActiveCell.FormulaR1C1 = _
        "=IF(RC[-2]<VLOOKUP(RC[-46],'Preisliste 2020'!C[-46]:C[-45],2,0),""Kern"",""Rand"")"
    ActiveCell.FormulaLocal = "=WENN(AS" & i & "<SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & """Kern""" & ";" & """Rand""" & ")"
    Range("AU" & i).Select
    Selection.Copy
    Range("AU" & i & ":AU" & i + 1000).Select
    ActiveSheet.Paste
    Range("AU" & i & ":AU" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AU" & i & ":AU" & i + 1000).Select
    'Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    Range("AU" & Z + 1 & ":AU" & Z + 1000).ClearContents
    Range("AT1:AU" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AT1:AU" & Z).PasteSpecial Paste:=xlValues
    Range("A1:AU1").Select
        Selection.AutoFilter
        ActiveSheet.Range("A1:AU" & Z).AutoFilter Field:=47, Criteria1:="Kern"
         Range("A2:A" & Z).Select
        Range("A2:A" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        'Z = ActiveSheet.UsedRange.Rows.Count
        y = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
        Range("B" & y + 1).Select
        Selection.PasteSpecial Paste:=xlValues
        Application.CutCopyMode = False
quelle.Sheets("Bibel 2020").Activate
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("G2:G" & Z).Select
        Range("G2:G" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("C" & y + 1).Select
        Selection.PasteSpecial Paste:=xlValues
        Application.CutCopyMode = False
quelle.Sheets("Bibel 2020").Activate
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("AS2:AS" & Z).Select
        Range("AS2:AS" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
ziel.Activate
        y = ActiveSheet.Cells(Rows.Count, 6).End(xlUp).Row
        Range("F" & y + 1).Select
        Selection.PasteSpecial Paste:=xlValues
        Application.CutCopyMode = False
quelle.Sheets("Bibel 2020").Activate
        Selection.AutoFilter
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("AS1:AU" & Z).ClearContents
        Range("A2").Select
        CheckBox7.Value = False
        End If
ziel.Activate                                             'l|fffd|schen von Doppel
        Z = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
        Range("B27:G" & Z).Select
        Selection.Sort key1:=Range("B27"), Order1:=xlDescending
        For i = 1 To 7
        Range("H27").Select
        ActiveCell.FormulaLocal = "=wenn(B27=B28" & ";" & """Doppel""" & ";" & """OK""" & ")"
        Range("H27").Copy
        Range("H28:H" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("B26:H26").Select
        Selection.AutoFilter
        ActiveSheet.Range("B26:H26").AutoFilter Field:=7, Criteria1:="Doppel"
        'Range("B27:B" & Z).Select
        'If ActiveSheet.Rows(8).Find("Doppel") Is Nothing Then GoTo sprung1
        Range("A27:H" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Delete Shift:=xlUp
        Application.CutCopyMode = False
        
sprung1:
       Next i
        Selection.AutoFilter
        Range("H26:H" & Z).ClearContents
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        y = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
        Range("A" & Z & ":" & "A" & Z).Select
        Selection.Copy
        ActiveSheet.Range("A" & Z + 1 & ":" & "A" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("B" & Z & ":" & "B" & Z).Select
        Selection.Copy
        ActiveSheet.Range("B" & Z + 1 & ":" & "B" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("C" & Z & ":" & "C" & Z).Select
        Selection.Copy
        ActiveSheet.Range("C" & Z + 1 & ":" & "C" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("D" & Z & ":" & "D" & Z).Select
        Selection.Copy
        ActiveSheet.Range("D" & Z + 1 & ":" & "D" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("E" & Z & ":" & "E" & Z).Select
        Selection.Copy
        ActiveSheet.Range("E" & Z + 1 & ":" & "E" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("F" & Z & ":" & "F" & Z).Select
        Selection.Copy
        ActiveSheet.Range("F" & Z + 1 & ":" & "F" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("G" & Z & ":" & "G" & Z).Select
        Selection.Copy
        ActiveSheet.Range("G" & Z + 1 & ":" & "G" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("C17").Select
        
 quelle.Sheets("Alternativsortiment").Activate
        Selection.AutoFilter
        Application.CutCopyMode = False
        Range("A4").Select
        Sheets("Buttons").Select
        MsgBox "Bitte NAS-319 speichern"
        Exit Sub
fehler:
  MsgBox "kein bearbeitetes Sortiment vorhanden"
  Exit Sub
End Sub

Private Sub CommandButton19_Click()
If MsgBox("Ist die Datei bereits gespeichert worden?", vbYesNo) = vbYes Then
Call CommandButton7_Click
Call CommandButton4_Click
CheckBox5.Value = True
Call CheckBox5_Click
Sheets("Buttons").Select
MsgBox "alle Daten zur|fffd|ckgesetzt"
Else
Sheets("Buttons").Select
MsgBox "Vorgang abgebrochen"
Exit Sub
End If
End Sub

Private Sub CommandButton2_Click()
Dim vorhanden As Boolean, n As Worksheet
For Each n In ThisWorkbook.Worksheets
    If n.Name = "Verbrauchsdaten" Then
        vorhanden = True
        Call Makro5
        Exit For
    End If
Next n
If vorhanden = False Then MsgBox "keine Statistik eingespielt"
End Sub

Sub Makro5()
anzahl = Sheets.Count
On Error Resume Next
Sheets("CMC").Delete
Sheets("CMC").Select
Sheets("Buttons").Select
Sheets.Add
ActiveSheet.Name = "CMC"
Set ziel = ThisWorkbook 'f|fffd|r Excel Zwischenspeicherung
'Sheets("CMC").Move after:=Sheets(anzahl + 1)
Application.Dialogs(xlDialogOpen).Show '|fffd|ffne Quelldatei

Worksheets(1).Range("1:90000").Copy 'kopiere alles zur Zieldatei

ziel.Worksheets(1).Activate 'wechselt zur Zieldatei zur|fffd|ck
ziel.Worksheets(1).Range("1:90000").PasteSpecial _
Paste:=xlPasteValues
Sheets("CMC").Move After:=Sheets("Matriste 2020")
On Error GoTo fehler
Sheets("CMC").Move After:=Sheets("Verbrauchsdaten")
Application.CutCopyMode = False 'setzt Zwischenablage in Datei ein
Worksheets("CMC").Cells(1, 1).Select 'zeigt Zieldatei wieder an
Sheets("CMC").Select
    Range("A1:G10").Select                                 ' Zusatz neue cmc Struktur
    Selection.Delete Shift:=xlUp
    Z = ActiveSheet.UsedRange.Rows.Count
        Columns("E:E").Insert Shift:=xlToRight
    Range("E2").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-4],'KB-Liste 2019'!C1:C7,7,0)),1,VLOOKUP(RC[-4],'KB-Liste 2019'!C1:C7,7,0))"
    Selection.Copy
    Range("E3:E" & Z).Select
    ActiveSheet.Paste                                    ' Zusatz neue cmc Struktur Ende
    Range("D2").Select
    Range("D2").FormulaLocal = "=F2*E2"
    Selection.Copy
    Range("D3:D" & Z).Select
    ActiveSheet.Paste
    Range("D2:D" & Z).Select
    Selection.Copy
    Range("F2:F" & Z).PasteSpecial Paste:=xlPasteValues
    Range("E2:E" & Z).Select
    Selection.Copy
    Range("E2:E" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
   Range("D1:D" & Z).Delete
   ActiveSheet.Range("G1").Select
   ActiveCell.FormulaR1C1 = "Verbrauch"
   ActiveSheet.Range("G1").Select ' Verbrauch im CMC
   Selection.Font.Bold = False
   If Worksheets("Verbrauchsdaten").Range("C2").Text = "#NV" Then GoTo weiter Else
   If Worksheets("Verbrauchsdaten").Range("C2").Value = 0 Then GoTo fehler3 Else
weiter:
   ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-6],Verbrauchsdaten!C[-6]:C[-4],3,0)"
   Selection.Copy
   ActiveSheet.Range("G2:G" & Z).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Z = ActiveSheet.UsedRange.Rows.Count
    Range("K1").Select
    On Error GoTo fehler1
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],'Matriste 2020'!C[-10]:C[-4],7,0)"
    Sheets("Verbrauchsdaten").Select
    Z = ActiveSheet.UsedRange.Rows.Count
    Sheets("cmc").Select
    Range("L1").Select
    On Error GoTo fehler2
    'Range("L1").FormulaLocal = "=SVERWEIS(A1 & " & ";" & "'Bibel 2020'!A1:L" & Z & ";14" & ";0)"
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-11],'Bibel 2020'!C[-11]:C[2],14,0)"
    Z = ActiveSheet.UsedRange.Rows.Count
    Range("M1").Select
    ActiveCell.FormulaR1C1 = "=IF(ISERROR(RC[-2]),""keine"",RC[-2])"
    Range("N1").Select
    ActiveCell.FormulaR1C1 = "=IF(OR(RC[-1]=""keine"",RC[-1]=0),""keine"",RC[-1])"
    Range("O1").Select
    ActiveCell.FormulaR1C1 = "=IF(ISERROR(RC[-3]),""keine"",RC[-3])"
    Range("P1").Select
    ActiveCell.FormulaR1C1 = "=IF(OR(RC[-1]=""keine"",RC[-1]=0),""keine"",RC[-1])"
    Range("Q1").Select
    ActiveCell.FormulaR1C1 = "=IF(RC[-3]<>""keine"",RC[-3],RC[-1])"
    ActiveSheet.Range("K1:Q1").Select
    Selection.Copy
    ActiveSheet.Range("K2:Q" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    
    
    'anzahl = Sheets.Count
    'Sheets("CMC").Move after:=Sheets(anzahl + 1)
    
    Call CommandButton3_Click
    Exit Sub
GoTo ende
fehler:
    'MsgBox "fehler"
    MsgBox "bitte erst Statistik einspielen"
Sheets("CMC").Delete
Exit Sub
GoTo ende
fehler1:
    'MsgBox "fehler1"
    MsgBox "bitte Matriste einspielen"
    Sheets("CMC").Delete
    Sheets("Verbrauchsdaten").Delete
    Exit Sub
GoTo ende
fehler2:
    'MsgBox "fehler2"
    MsgBox "bitte Vertriebsbibel einspielen"
    Sheets("CMC").Delete
    Sheets("Verbrauchsdaten").Delete
    Exit Sub
GoTo ende
fehler3:
     'MsgBox "fehler3"
    MsgBox "erst Verbrauchsdaten und dann cmc einspielen!!!"
    Sheets("cmc").Delete
    Sheets("Verbrauchsdaten").Delete
    Exit Sub
ende:
Exit Sub
End Sub

Sub CommandButton3_Click()
Dim vorhanden As Boolean, n As Worksheet
For Each n In ThisWorkbook.Worksheets
    If n.Name = "Verbrauchsdaten" Then
        vorhanden = True
        Call Makro6
        Exit For
    End If
Next n
If vorhanden = False Then MsgBox "keine Statistik eingespielt"
End Sub

Sub Makro6()
'Sheets("Strukturvorgabe").Select
    'ActiveSheet.Range("A1:AI1").Select
    'Selection.Copy
'Sheets("Verbrauchsdaten").Select
    'ActiveSheet.Range("A1").Select
    'ActiveSheet.Paste
    'Sheets("Strukturvorgabe").Select
    'ActiveSheet.Range("G2:AI2").Select
    'Application.CutCopyMode = False
    'Selection.Copy
    On Error GoTo fehler1
Sheets("Verbrauchsdaten").Select
    ActiveSheet.Range("A1:E1").Select
    Selection.Font.Bold = True
    ActiveSheet.Range("J1").Select
    ActiveCell.FormulaR1C1 = "PL 2019"
    Selection.Font.Bold = True
    ActiveSheet.Range("K1").Select
    ActiveCell.FormulaR1C1 = "PL 2020"
    Selection.Font.Bold = True
    Z = ActiveSheet.UsedRange.Rows.Count 'Kontrakt 2015
    ActiveSheet.Range("F1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Kontrakt"
    ActiveSheet.Range("F2").Select
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=IF(ISERROR(RC[7]),""0"",""1"")"
    Selection.Copy
    ActiveSheet.Range("F2:F" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("G1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "WG"
    ActiveSheet.Range("G2").Select ' Warengruppe
    Selection.Font.Bold = False
    On Error GoTo fehler2
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-6],'KB-Liste 2019'!C[-6]:C[5],12,0)"
    Range("G2").Select
    Selection.Copy
    ActiveSheet.Range("G2:G" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("H1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "KB 2019"
    ActiveSheet.Range("H2").Select ' KB 2015
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-7],'KB-Liste 2019'!C[-7]:C[-4],4,0)"
    Selection.Copy
    ActiveSheet.Range("H2:H" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("I1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "KB 2020"""
    ActiveSheet.Range("I2").Select ' KB 2015
    Selection.Font.Bold = False
    On Error GoTo fehler3
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[4],13,0)),RC[-1],IF(VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[4],13,0)=0,RC[-1],VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[4],13,0)))"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[4],13,0)"
    'ActiveCell.FormulaR1C1 = _
     '   "=IF(ISERROR(VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[4],13,0)),RC[-1]*1,03,IF(VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[4],13,0)=0,RC[-1]*1,03,VLOOKUP(RC[-8],'Bibel 2020'!C[-8]:C[4],13,0)))"
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AO2").Select
    ActiveCell.FormulaLocal = "=Runden(I2" & ";" & "2)"
    Selection.Copy
    ActiveSheet.Range("AO2:AO" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).Select
    Selection.Copy
    ActiveSheet.Range("I2:I" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    ActiveSheet.Range("AO2:AO" & Z).ClearContents
    ActiveSheet.Range("L1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "delisted"
    ActiveSheet.Range("L2").Select ' Delisted 2015
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-11],'Bibel 2020'!C[-11]:C,12,0)"
    Selection.Copy
    ActiveSheet.Range("L2:L" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("M1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "cmc 2019"
    ActiveSheet.Range("M2").Select ' cmc 2015
    Selection.Font.Bold = False
    On Error GoTo fehler4
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-12],CMC!C[-12]:C[-7],5,0)"
    Selection.Copy
    ActiveSheet.Range("M2:M" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("N1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "VK 2019"
    ActiveSheet.Range("N2").Select ' VK 2019
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = _
    "=IF(ISERROR(RC[-1]),IF(ISERROR(RC[-4]),RC[-9]/RC[-11],IF(RC[-4]=0,RC[-9]/RC[-11],RC[-4])),RC[-1])"
    Selection.Copy
    ActiveSheet.Range("N2:N" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("O1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "VK 2020"
    ActiveSheet.Range("O2").Select ' VK 2020
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[3]=""Rand"",RC[-4],IF(RC[-7]<RC[-6],((1/RC[-7])*(RC[-6]-RC[-7])+1)*RC[-1],RC[-1]))"
    Selection.Copy
    ActiveSheet.Range("O2:O" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AP2").Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-27],2)"
    Range("AP2").Select
    Selection.Copy
    ActiveSheet.Range("AP3:AP" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("AP2:AP" & z).Select
    'Selection.Copy
    'ActiveSheet.Range("O2:O" & z).PasteSpecial Paste:=xlPasteValues
    'Application.CutCopyMode = False
    'ActiveSheet.Range("AO2:AO" & z).Delete
    ActiveSheet.Range("P1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Marge 2019"
    ActiveSheet.Range("P2").Select ' Marge 2019
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00%"
    ActiveCell.FormulaR1C1 = "=(RC[-2]-RC[-8])/RC[-2]"
    Selection.Copy
    ActiveSheet.Range("P2:P" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("Q1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Marge 2020"
    ActiveSheet.Range("Q2").Select ' Marge 2020
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00%"
    ActiveCell.FormulaR1C1 = "=(RC[-2]-RC[-8])/RC[-2]"
    Selection.Copy
    ActiveSheet.Range("Q2:Q" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("R2").Select ' Betrachtung Umsatz und Verbrauch
    'Umsatz = CInt(TextBox1.Text)
    'Verbrauch = CInt(TextBox2.Text)
    'ActiveCell.FormulaR1C1 = _
    '"=IF(RC[-13]>" & Umsatz & ",""Kern"",IF(RC[-15]>" & Verbrauch & ",""Kern"",""Rand""))"
    'Selection.Copy
    'ActiveSheet.Range("R2:R" & z).Select
    'ActiveSheet.Paste
    'Application.CutCopyMode = False
    ActiveSheet.Range("S1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Summe 2019"
    ActiveSheet.Range("S2").Select ' Summe 2019
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = "=IF(RC[-5]<>0,RC[-5]*RC[-16],RC[-14])"
    Selection.Copy
    ActiveSheet.Range("S2:S" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("T1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Summe 2020"
    ActiveSheet.Range("T2").Select ' Summe 2020
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = "=RC[-5]*RC[-17]"
    Selection.Copy
    ActiveSheet.Range("T2:T" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("U1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Wareneinsatz"
    ActiveSheet.Range("U2").Select ' Wareneinsatz
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = "=RC[-12]*RC[-18]"
    Selection.Copy
    ActiveSheet.Range("U2:U" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("V1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "|fffd|Marge 2019"
    ActiveSheet.Range("V2").Select ' CashMarge 2019
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = "=RC[-6]*RC[-3]"
    Selection.Copy
    ActiveSheet.Range("V2:V" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("W1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "|fffd|Marge 2020"
    ActiveSheet.Range("W2").Select ' CashMarge 2020
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = "=RC[-6]*RC[-3]"
    Selection.Copy
    ActiveSheet.Range("W2:W" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("X1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Alternative"
    ActiveSheet.Range("X2").Select ' Alternative Bibel 2020
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-23],'Bibel 2020'!C[-23]:C[-10],14,0)"
    Selection.Copy
    ActiveSheet.Range("X2:X" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("Y1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Bezeichnung"
    ActiveSheet.Range("Y2").Select ' Bezeichnung Alternative Bibel 2020
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],'Bibel 2020'!C[-24]:C[-18],7,0)"
    Selection.Copy
    ActiveSheet.Range("Y2:Y" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("Z1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "KB 2019"
    ActiveSheet.Range("Z2").Select ' KB ALternative Bibel 2020
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-2],'Bibel 2020'!C[-25]:C[-13],13,0)"
    Selection.Copy
    ActiveSheet.Range("Z2:Z" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AA1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "VK"
    ActiveSheet.Range("AA2").Select ' Preis Alternative im CMC
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-3],C[-26]:C[-14],13,0)"
    Selection.Copy
    ActiveSheet.Range("AA2:AA" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AB1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Marge"
    ActiveSheet.Range("AB2").Select ' Marge Alternative
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00%"
    ActiveCell.FormulaR1C1 = "=(RC[-1]-RC[-2])/RC[-1]"
    Selection.Copy
    ActiveSheet.Range("AB2:AB" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AC1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "UOM Original"
    ActiveSheet.Range("AC2").Select ' VE Original
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-28],'KB-Liste 2019'!C[-28]:C[5],10,0)"
    Selection.Copy
    ActiveSheet.Range("AC2:AC" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AD1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "UOM Alternative"
    ActiveSheet.Range("AD2").Select ' VE Alternative Bibel 2020
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-6],'KB-Liste 2019'!C[-29]:C[4],10,0)"
    Selection.Copy
    ActiveSheet.Range("AD2:AD" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AE1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Matriste"
    ActiveSheet.Range("AE2").Select ' Alternative Matriste 2020
    Selection.Font.Bold = False
    On Error GoTo fehler5
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-30],'Matriste 2020'!C[-30]:C[-24],7,0)"
    Selection.Copy
    ActiveSheet.Range("AE2:AE" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AF1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Bezeichnung"
    ActiveSheet.Range("AF2").Select ' Bezeichnung Alternative Matriste 2015
    Selection.Font.Bold = False
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],'Matriste 2015'!C[-31]:C[-25],2,0)"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],'Matriste 2015'!C[-26]:C[-25],2,0)"
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],'Matriste 2020'!C[-25]:C[-24],2,0)"
    Selection.Copy
    ActiveSheet.Range("AF2:AF" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AG1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "KB"
    ActiveSheet.Range("AG2").Select ' KB Alternative Matriste 2015
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-2],'Bibel 2020'!C[-32]:C[-20],13,0)"
    Selection.Copy
    ActiveSheet.Range("AG2:AG" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AH1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "VK"
    ActiveSheet.Range("AH2").Select ' VK aus cmc 2015
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-3],C[-33]:C[-19],15,0)"
    Selection.Copy
    ActiveSheet.Range("AH2:AH" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AI1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "VE"
    ActiveSheet.Range("AI2").Select ' VE Alternative Matriste
    Selection.Font.Bold = False
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-4],'KB-Liste 2019'!C[-34]:C[-1],10,0)"
    Selection.Copy
    ActiveSheet.Range("AI2:AI" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AJ1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Status"
    ActiveSheet.Range("AJ2").Select ' Artikel mit Status
    Selection.Font.Bold = False
    On Error GoTo fehler6
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-35],'Status 2019'!C[-35]:C[-32],3,0)"
    Selection.Copy
    ActiveSheet.Range("AJ2:AJ" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AK1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Alternative"
    ActiveSheet.Range("AK2").Select ' Artikel mit Status
    Selection.Font.Bold = False
    'ActiveCell.FormulaR1C1 = _
    '"=IF(ISERROR(RC[-12]),IF(ISERROR(RC[-5]),RC[-36],RC[-6]),RC[-13])"
    'ActiveCell.FormulaR1C1 = _
     '   "=IF(ISERROR(RC[-12]),IF(ISERROR(RC[-4]),RC[-36],RC[-6]),RC[-13])"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-12]),IF(ISERROR(RC[-5]),RC[-36],RC[-6]),RC[-13])"
    Selection.Copy
    ActiveSheet.Range("AK2:AK" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AL1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Bezeichnung"
    ActiveSheet.Range("AL2").Select ' Bezeichnung verf|fffd|gbare Alternative
    Selection.Font.Bold = False
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],'KB-Liste 2019'!C[-37]:C[-31],2,0)"
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-1],'KB-Liste 2019'!C[-37]:C[-31],2,0)),VLOOKUP(RC[-1],'Matriste 2020'!C[-32]:C[-31],2,0),VLOOKUP(RC[-1],'KB-Liste 2019'!C[-37]:C[-31],2,0))"
    Selection.Copy
    ActiveSheet.Range("AL2:AL" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AM1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "VK"
    ActiveSheet.Range("AM2").Select ' VK verf|fffd|gbare Alternative
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = _
    "=IF(ISERROR(RC[-14]),IF(ISERROR(RC[-7]),RC[-24],RC[-5]),RC[-12])"
    Selection.Copy
    ActiveSheet.Range("AM2:AM" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Range("AN1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Umsatz 2019"
    ActiveSheet.Range("AN2").Select ' Umsatz Alternativsortiment
    Selection.Font.Bold = False
    Selection.NumberFormat = "0.00"
    ActiveCell.FormulaR1C1 = _
    "=IF(ISERROR(RC[-15]),IF(ISERROR(RC[-8]),RC[-1]*RC[-37],((RC[-11]*RC[-37])/RC[-5])*RC[-6]),((RC[-11]*RC[-37])/RC[-10])*RC[-13])"
    Selection.Copy
    ActiveSheet.Range("AN2:AN" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
       Z = ActiveSheet.UsedRange.Rows.Count
    Range("A2:AQ" & Z).Select
    Selection.Sort key1:=Range("T2"), Order1:=xlDescending
    If IsError(Sheets("Verbrauchsdaten").Range("T2")) Then
    Range("AR2").Select
    ActiveCell.FormulaR1C1 = "0"
    Else
   
    Range("AR2").Select
    ActiveCell.FormulaR1C1 = "=RC[-24]"
    End If
    Range("AR3").Select
    ActiveCell.FormulaR1C1 = "=SUM(RC[-24],R[-1]C)"
    Selection.Copy
    Range("AR3:AR" & Z).Select
    ActiveSheet.Paste
    Range("AR2:AR" & Z).Select
    Selection.Copy
    Range("AR2:AR" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Range("A1:M" & Z).Select                        'l|fffd|schen sverweise Verbrauchsdaten
    Selection.Copy
    Range("A1:M" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
  
    'Range("P1:Q" & Z).Select
    'Selection.Copy
    'Range("P1:Q" & Z).PasteSpecial Paste:=xlPasteValues
    'Application.CutCopyMode = False
    'Range("U1:Z" & Z).Select
    'Selection.Copy
    'Range("U1:Z" & Z).PasteSpecial Paste:=xlPasteValues
    'Application.CutCopyMode = False
    'Range("AB1:AG" & Z).Select
    'Selection.Copy
    'Range("AB1:AG" & Z).PasteSpecial Paste:=xlPasteValues
    'Application.CutCopyMode = False
    'Range("AI1:AL" & Z).Select
    'Selection.Copy
    'Range("AI1:AL" & Z).PasteSpecial Paste:=xlPasteValues
    'Application.CutCopyMode = False
    'Range("AO1:AQ" & Z).Select
    'Selection.Copy
    'Range("AO1:AQ" & Z).PasteSpecial Paste:=xlPasteValues
    'Application.CutCopyMode = False
    Sheets("Buttons").Select
    MsgBox " CMC wurde eingespielt. Bitte Auswahl f|fffd|r Sortiment treffen"
    Exit Sub
fehler1:
    MsgBox "Bitte erst Statistik einspielen"
    Sheets("Verbrauchsdaten").Delete
    Exit Sub
fehler2:
    MsgBox "keine KB-Liste eingspielt"
    Exit Sub
fehler3:
    MsgBox "keine Vertriebsbibel eingespielt"
    Exit Sub
fehler4:
    MsgBox "kein cmc eingespielt"
    Exit Sub
fehler5:
    MsgBox "keine Matriste eingespielt"
fehler6:
    MsgBox "keine Statusartikel eingespielt"
    Exit Sub

End Sub

Sub CommandButton4_Click()
On Error Resume Next
   Sheets("cmc").Select
   Sheets("cmc").Delete
    On Error Resume Next
    Sheets("Verbrauchsdaten").Select
    Sheets("Verbrauchsdaten").Delete
    ActiveWorkbook.Names("Farbpr|fffd|fung").Delete
   ActiveWorkbook.Names("cmc").Delete
   Sheets("Preisliste 2020").Select
   Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
   Range("A1:C" & Z).ClearContents
Sheets("Buttons").Select
MsgBox "Statistik 14e und cmc wurden gel|fffd|scht"
End Sub


Private Sub CommandButton20_Click()
Sheets("Alternativsortiment").Select
If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        'Selection.AutoFilter
        If Range("A4").Value = 0 Then GoTo sprungmarke
        For i = 1 To 20
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A4:T4").Select
        Selection.Sort key1:=Range("I4"), Order1:=xlDescending, Header:=xlGuess
    Range("U4").Select
    ActiveCell.FormulaR1C1 = _
       "=MIN(IF(AND(LEFT(RC[-12],10)=LEFT(R[1]C[-12],10),RIGHT(RC[-12],10)<>RIGHT(R[1]C[-12],10),RC[-10]=R[1]C[-10],LEFT(R[-1]C[-12],10)=LEFT(RC[-12],10),RIGHT(R[-1]C[-12],10)<>RIGHT(RC[-12],10),R[-1]C[-10]=RC[-10]),MIN(R[-1]C[-9]:R[1]C[-9]),RC[-9]),IF(AND(LEFT(RC[-12],10)=LEFT(R[1]C[-12],10),RIGHT(RC[-12],10)<>RIGHT(R[1]C[-12],10),RC[-10]=R[1]C[-10]),MIN(RC[-9],R[1]C[-9]),RC[-9]),IF(AND(LEFT(R[-1]C[-12],10)=LEFT(RC[-12],10),RIGHT(R[-1]C[-12],10)<>RIGHT(RC[-12],10),R[-1]C[-10]=RC[-10]),MIN(R[-1]C[-9]:RC[-9]),RC[-9]))"
     Range("U4").Select
     Selection.Copy
     Range("U4:U" & Z).Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     ActiveSheet.Range("U4:U" & Z).Select
    Selection.Copy
    ActiveSheet.Range("L4:L" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Next i
    Range("M4").Select
    Selection.Sort key1:=Range("M4"), Order2:=xlDescending, Header:=xlGuess
    Range("U4:U" & Z).ClearContents
sprungmarke:
    Range("C4").Select
Sheets("delisted Artikel").Select
If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        'Selection.AutoFilter
        If Range("A3").Value = 0 Then GoTo sprungmarke1
        For i = 1 To 20
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("A3:S3").Select
    Selection.Sort key1:=Range("I3"), Order1:=xlDescending, Header:=xlGuess
    Range("T3").Select
        ActiveCell.FormulaR1C1 = _
        "=ROUND(MIN(IF(AND(LEFT(RC[-11],10)=LEFT(R[1]C[-11],10),RIGHT(RC[-11],10)<>RIGHT(R[1]C[-11],10),RC[-9]=R[1]C[-9],LEFT(R[-1]C[-11],10)=LEFT(RC[-11],10),RIGHT(R[-1]C[-11],10)<>RIGHT(RC[-11],10),R[-1]C[-9]=RC[-9]),MIN(R[-1]C[-8]:R[1]C[-8]),RC[-8]),IF(AND(LEFT(RC[-11],10)=LEFT(R[1]C[-11],10),RIGHT(RC[-11],10)<>RIGHT(R[1]C[-11],10),RC[-9]=R[1]C[-9]),MIN(RC[-8],R[1]C[-8]),RC[-8]),IF(AND(LEFT(R[-1]C[-11],10)=LEFT(RC[-11],10),RIGHT(R[-1]C[-11],10)<>RIGHT(RC[-11],10),R[-1]C[-9]=RC[-9]),MIN(R[-1]C[-8]:RC[-8]),RC[-8])),2)"
   Selection.Copy
     Range("T3:T" & Z).Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     ActiveSheet.Range("T3:T" & Z).Select
    Selection.Copy
    ActiveSheet.Range("L3:L" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Next i
    Range("M3").Select
    Selection.Sort key1:=Range("M3"), Order2:=xlDescending, Header:=xlGuess
    Range("T3:T" & Z).ClearContents
sprungmarke1:
    Range("C3").Select
Sheets("Sortiment 2020").Select
If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        'Selection.AutoFilter
   For i = 1 To 25
   Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
   Range("A6:R6").Select
   Selection.Sort key1:=Range("D6"), Order1:=xlDescending, Header:=xlGuess
    Range("T6").Select
    ActiveCell.FormulaR1C1 = _
        "=MIN(IF(AND(LEFT(RC[-16],10)=LEFT(R[1]C[-16],10),RIGHT(RC[-16],10)<>RIGHT(R[1]C[-16],10),RC[-6]=R[1]C[-6],LEFT(R[-1]C[-16],10)=LEFT(RC[-16],10),RIGHT(R[-1]C[-16],10)<>RIGHT(RC[-16],10),R[-1]C[-6]=RC[-6]),MIN(R[-1]C[-8]:R[1]C[-8]),RC[-8]),IF(AND(LEFT(RC[-16],10)=LEFT(R[1]C[-16],10),RIGHT(RC[-16],10)<>RIGHT(R[1]C[-16],10),RC[-6]=R[1]C[-6]),MIN(RC[-8],R[1]C[-8]),RC[-8]),IF(AND(LEFT(R[-1]C[-16],10)=LEFT(RC[-16],10),RIGHT(R[-1]C[-16],10)<>RIGHT(RC[-16],10),R[-1]C[-6]=RC[-6]),MIN(R[-1]C[-8]:RC[-8]),RC[-8]))"
    Range("T6").Select
     Selection.Copy
     Range("T6:T" & Z).Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     ActiveSheet.Range("T6:T" & Z).Select
    Selection.Copy
    ActiveSheet.Range("L6:L" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Next i
    Range("T6:T" & Z).ClearContents
    Range("K6").Select
    Selection.Sort key1:=Range("K6"), Order1:=xlDescending, Header:=xlGuess
    Call Sortiment_pr|fffd|fen
End Sub

Private Sub CommandButton21_Click()
If Worksheets("Sortiment 2020").Range("C7").Value = 0 Then GoTo fehler Else
anzahl = Sheets.Count
    On Error Resume Next
    Sheets("CRT Upload").Select
    Sheets("CRT Upload").Delete
    Sheets.Add
    ActiveSheet.Name = "CRT Upload"
    Sheets("Sortiment 2020").Select                'Hauptsortiment CRT Uplaod kopieren
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A5:P5").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=16, Criteria1:=Array( _
        "SPE/SPX", "C", "N", "N/A", "0"), Operator:=xlFilterValues
       ' ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=5, Criteria1:="Kern"
        Range("C6:C" & y).Select
        Range("C6:C" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
    Sheets("CRT Uplaod").Select
    With Worksheets("CRT Upload").Range("A1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Sortiment 2020").Select
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A5:P5").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=16, Criteria1:=Array( _
        "SPE/SPX", "C", "N", "N/A", "0"), Operator:=xlFilterValues
       ' ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=5, Criteria1:="Kern"
         Range("L6:L" & y).Select
        Range("L6:L" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("CRT Uplaod").Select
        With Worksheets("CRT Upload").Range("D1")
       .PasteSpecial Paste:=xlValues
        End With
        Application.CutCopyMode = False
        Sheets("Sortiment 2020").Select
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A5:P5").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=16, Criteria1:=Array( _
        "SPE/SPX", "C", "N", "N/A", "0"), Operator:=xlFilterValues
       ' ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=5, Criteria1:="Kern"
         Range("E6:E" & y).Select
        Range("E6:E" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("CRT Uplaod").Select
        With Worksheets("CRT Upload").Range("I1")
       .PasteSpecial Paste:=xlValues
        End With
        Application.CutCopyMode = False
     '   Sheets("Sortiment 2020").Select
      '  If ActiveSheet.AutoFilterMode Then
       ' Selection.AutoFilter
        'End If
        'y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        'Range("A5:P5").Select
        'Selection.AutoFilter
        'ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=16, Criteria1:=Array( _
        '"SPE/SPX", "C", "N", "N/A", "0"), Operator:=xlFilterValues
       ' ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=5, Criteria1:="Kern"
         'Range("H6:H" & y).Select
        'Range("H6:H" & y).SpecialCells(xlCellTypeVisible).Select
        'Selection.Copy
'Sheets("CRT Uplaod").Select
 '       With Worksheets("CRT Upload").Range("E1")
  '     .PasteSpecial Paste:=xlValues
   '     End With
    '    Application.CutCopyMode = False
Sheets("delisted Artikel").Select                        ' delisted Artikel in CRT Uplaod einspielen
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A2:Q2").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$2:Q" & y).AutoFilter Field:=8, Criteria1:="<>keine"
        Range("A3:A" & y).Select
       ' If ActiveSheet.Rows(8).Find("keine") Is Nothing Then GoTo sprung
        Range("A3:A" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("CRT Upload").Select
        'Z = ActiveSheet.UsedRange.Rows.Count
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        With Worksheets("CRT Upload").Range("A" & Z + 1)
        .PasteSpecial Paste:=xlFormats
        .PasteSpecial Paste:=xlPasteValues
        End With
        Application.CutCopyMode = False
Sheets("delisted Artikel").Select
        Range("L3:L" & y).Select
        Range("L3:L" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("CRT Upload").Select
        With Worksheets("CRT Upload").Range("D" & Z + 1)
        .PasteSpecial Paste:=xlFormats
        .PasteSpecial Paste:=xlPasteValues
        End With
Sheets("delisted Artikel").Select
        Range("H3:H" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("CRT Upload").Select
        With Worksheets("CRT Upload").Range("F" & Z + 1)
        .PasteSpecial Paste:=xlValues
        End With
'Sheets("delisted Artikel").Select
 '        Range("E3:E" & y).SpecialCells(xlCellTypeVisible).Select
  '      Selection.Copy
'Sheets("CRT Upload").Select
 '       With Worksheets("CRT Upload").Range("E" & Z + 1)
  '      .PasteSpecial Paste:=xlValues
   '     End With
        w = ActiveSheet.Cells(Rows.Count, 6).End(xlUp).Row
        Range("J" & Z + 1).Select
        ActiveCell.FormulaR1C1 = _
        "=IF(VLOOKUP(RC[-4],'Bibel 2020'!C[-9]:C[15],20,0)=1,0,VLOOKUP(RC[-4],'Bibel 2020'!C[-9]:C[15],20,0))"
        Selection.Copy
        ActiveSheet.Range("J" & Z + 1 & ":J" & w).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("G" & Z + 1).Select
        ActiveCell.FormulaLocal = "=WENN(J1<>0;""BX"";""ST"")"
        Selection.Copy
        ActiveSheet.Range("G" & Z + 1 & ":G" & w).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
sprung:
Sheets("delisted Artikel").Select
        Selection.AutoFilter
        Application.CutCopyMode = False
        Range("A1").Select
        
Sheets("Alternativsortiment").Select                        ' Alternativen in CRT Upload einspielen
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("H4:H" & y).Select
        If Range("H4").Value = 0 Then GoTo weiter
        Selection.Copy
Sheets("CRT Upload").Select
        'Z = ActiveSheet.UsedRange.Rows.Count
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        With Worksheets("CRT Upload").Range("A" & Z + 1)
        .PasteSpecial Paste:=xlValues
        End With
Sheets("Alternativsortiment").Select
        Range("L4:L" & y).Select
        Selection.Copy
Sheets("CRT Upload").Select
        With Worksheets("CRT Upload").Range("D" & Z + 1)
        .PasteSpecial Paste:=xlValues
        End With
'Sheets("Alternativsortiment").Select
 '       Range("D4:D" & y).Select
  '      Selection.Copy
'Sheets("CRT Upload").Select
 '       With Worksheets("CRT Upload").Range("E" & Z + 1)
  '      .PasteSpecial Paste:=xlValues
   '     .PasteSpecial Paste:=xlFormats
    '    End With
        
weiter:
        Selection.AutoFilter
        Application.CutCopyMode = False
        Range("A1").Select
If CheckBox7.Value = True Then
Sheets("Bibel 2020").Select                            ' Farben einspielen
If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
    Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("A1:AA1").Select
        Selection.Sort key1:=Range("G1"), Order1:=xlDescending, Header:=xlYes
        For i = 1 To Z Step 1000
    Range("AS" & i).Select
    'ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "Alternativsortiment!$H$3:L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "'delisted Artikel'!$H$2:L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "WENN(ISTFEHLER(SVERWEIS(A2" & ";" & "'Sortiment 2020'!$C$6:$L" & "$" & Z & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A2" & ";" & "'Sortiment 2020'!$C$6:L" & "$" & Z & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "'delisted Artikel'!$H$2:$L" & "$" & Z & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A2" & ";" & "Alternativsortiment!$H$3:$L" & "$" & Z & ";" & "5" & ";" & "0))"
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "Alternativsortiment!H:L" & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "Alternativsortiment!H:L" & ";" & "5" & ";" & "0))"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-44],Alternativsortiment!R[1]C[-37]:R[62348]C[-33],5,0)),VLOOKUP(RC[-44],'Preisliste 2020'!C[-44]:C[-43],2,0),VLOOKUP(RC[-44],Alternativsortiment!R[1]C[-37]:R[62348]C[-33],5,0))"
    Range("AS" & i).Select
    Selection.Copy
    Range("AS" & i + 1 & ":AS" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AS" & i + 1 & ":AS" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AS" & i + 1 & ":AS" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Next i
    Range("AS" & Z + 1 & ":AS" & Z + 1000).ClearContents
    For i = 1 To Z Step 1000
    Range("AT" & i).Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "'delisted Artikel'!H:L" & ";" & "5" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "'delisted Artikel'!H:L" & ";" & "5" & ";" & "0))"
    ' ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-45],'delisted Artikel'!RC[-38]:R[62348]C[-34],5,0)),VLOOKUP(RC[-45],'Preisliste 2020'!C[-45]:C[-44],2,0),VLOOKUP(RC[-45],'delisted Artikel'!RC[-38]:R[62348]C[-34],5,0))"
    Range("AT" & i).Select
    Selection.Copy
    Range("AT" & i + 1 & ":AT" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AT" & i & ":AT" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AT" & i & ":AT" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Next i
    Application.CutCopyMode = False
    Range("AT" & Z + 1 & ":AT" & Z + 1000).ClearContents
    For i = 1 To Z Step 1000
    Range("AU" & i).Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A" & i & ";" & "'Sortiment 2020'!C:L" & ";" & "10" & ";" & "0))" & ";" & "SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & "SVERWEIS(A" & i & ";" & "'Sortiment 2020'!C:L" & ";" & "10" & ";" & "0))"
    'ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-46],'Sortiment 2020'!R[3]C[-44]:R[62348]C[-35],10,0)),VLOOKUP(RC[-46],'Preisliste 2020'!C[-46]:C[-45],2,0),VLOOKUP(RC[-46],'Sortiment 2020'!R[3]C[-44]:R[62348]C[-35],10,0))"
    Range("AU" & i).Select
    Selection.Copy
    Range("AU" & i + 1 & ":AU" & i + 1000).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AU" & i & ":AU" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AU" & i & ":AU" & i + 1000).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    Range("AU" & Z + 1 & ":AU" & Z + 1000).ClearContents
    Range("AV2").Select
    ActiveCell.FormulaLocal = "=MIN(AS2:AU2)"
    Range("AV2").Select
    Selection.Copy
    Range("AV3:AV" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AV2:AV" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AV2:AV" & Z).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("AV2:AV" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AS2:AS" & Z).Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("AT2:AV" & Z).ClearContents
       For i = 1 To 30
    Range("AT2").Select
    ActiveCell.FormulaR1C1 = _
        "=MIN(IF(AND(LEFT(RC[-39],20)=LEFT(R[1]C[-39],20),RIGHT(RC[-39],15)<>RIGHT(R[1]C[-39],15),RC[-33]=R[1]C[-33],LEFT(R[-1]C[-39],20)=LEFT(RC[-39],20),RIGHT(R[-1]C[-39],15)<>RIGHT(RC[-39],15),R[-1]C[-33]=RC[-33]),MIN(R[-1]C[-1]:R[1]C[-1]),RC[-1]),IF(AND(LEFT(RC[-39],20)=LEFT(R[1]C[-39],20),RIGHT(RC[-39],15)<>RIGHT(R[1]C[-39],15),RC[-33]=R[1]C[-33]),MIN(RC[-1],R[1]C[-1]),RC[-1]),IF(AND(LEFT(R[-1]C[-39],10)=LEFT(RC[-39],10),RIGHT(R[-1]C[-39],15)<>RIGHT(RC[-39],15),R[-1]C[-33]=RC[-33]),MIN(R[-1]C[-1]:RC[-1]),RC[-1]))"
    Range("AT2").Select
    Selection.Copy
    Range("AT2:AT" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("AT2:AT" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AS2:AS" & Z).PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    For i = 1 To Z Step 1000
    Range("AU" & i).Select
    'ActiveCell.FormulaR1C1 = _
        "=IF(RC[-2]<VLOOKUP(RC[-46],'Preisliste 2020'!C[-46]:C[-45],2,0),""Kern"",""Rand"")"
    ActiveCell.FormulaLocal = "=WENN(AS" & i & "<SVERWEIS(A" & i & ";" & "'Preisliste 2020'!A:B" & ";" & "2" & ";" & "0)" & ";" & """Kern""" & ";" & """Rand""" & ")"
    Range("AU" & i).Select
    Selection.Copy
    Range("AU" & i & ":AU" & i + 1000).Select
    ActiveSheet.Paste
    Range("AU" & i & ":AU" & i + 1000).Select
    Selection.Copy
    ActiveSheet.Range("AU" & i & ":AU" & i + 1000).Select
    'Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Next i
    Range("AU" & Z + 1 & ":AU" & Z + 1000).ClearContents
    Range("AT1:AU" & Z).Select
    Selection.Copy
    ActiveSheet.Range("AT1:AU" & Z).PasteSpecial Paste:=xlValues
    Range("A1:AU1").Select
        Selection.AutoFilter
        ActiveSheet.Range("A1:AU" & Z).AutoFilter Field:=47, Criteria1:="Kern"
         Range("A2:A" & Z).Select
        Range("A2:A" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("CRT Upload").Select
        'Z = ActiveSheet.UsedRange.Rows.Count
        y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        With Worksheets("CRT Upload").Range("A" & y + 1)
        .PasteSpecial Paste:=xlValues
        End With
        Application.CutCopyMode = False
Sheets("Bibel 2020").Select
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("AS2:AS" & Z).Select
        Range("AS2:AS" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("CRT Upload").Select
        y = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        With Worksheets("CRT Upload").Range("C" & y + 1)
        .PasteSpecial Paste:=xlValues
        End With
        Application.CutCopyMode = False
Sheets("Bibel 2020").Select
        Selection.AutoFilter
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("AS1:AU" & Z).ClearContents
        Range("A2").Select
        CheckBox7.Value = False
        End If
        Sheets("CRT Upload").Select                     'l|fffd|schen von Doppel
        Range("A1:J1").Select
        Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
        Range("A1").Select
        ActiveCell.FormulaR1C1 = "SAP Code"
        Range("B1").Select
        ActiveCell.FormulaR1C1 = "Sales Unit"
        Range("C1").Select
        ActiveCell.FormulaR1C1 = "Scale"
        Range("D1").Select
        ActiveCell.FormulaR1C1 = "Preis"
        Range("E1").Select
        ActiveCell.FormulaR1C1 = "Menge"
        Range("F1").Select
        ActiveCell.FormulaR1C1 = "SAP Code Ersetzung"
        Range("G1").Select
        ActiveCell.FormulaR1C1 = "Sales Unit"
        Range("H1").Select
        ActiveCell.FormulaR1C1 = "CL to NCL"
        Range("I1").Select
        ActiveCell.FormulaR1C1 = "Umgebung"
        Range("J1").Select
        ActiveCell.FormulaR1C1 = "Variable"
        If ActiveSheet.AutoFilterMode = False Then
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("A1:J" & Z).Select
        Range("A1:J" & Z).AutoFilter
        End If
        ActiveWorkbook.Worksheets("CRT Upload").AutoFilter.Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("CRT Upload").AutoFilter.Sort.SortFields.Add Key:= _
        Range("A1"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
        xlSortNormal
    With ActiveWorkbook.Worksheets("CRT Upload").AutoFilter.Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
        ActiveSheet.Range("A1:J1").Select
        Selection.Delete Shift:=xlUp
            Range("A2:A" & Z).Select
            ActiveSheet.Range("A2:A" & Z).EntireRow.RemoveDuplicates Columns:=Array(1)
sprung1:
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        Range("H1:H" & Z).ClearContents
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        y = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
        Range("A" & Z & ":" & "A" & Z).Select
        Selection.Copy
        ActiveSheet.Range("A" & Z + 1 & ":" & "A" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("J1").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(VLOOKUP(RC[-9],'Bibel 2020'!C[-9]:C[15],20,0)=1,0,VLOOKUP(RC[-9],'Bibel 2020'!C[-9]:C[15],20,0))"
         '"=IF(VLOOKUP(RC[-3],'Bibel 2020'!C[-3]:C[16],20,0)=1,0,VLOOKUP(RC[-3],'Bibel 2020'!C[-3]:C[16],20,0))"
        Z = ActiveSheet.UsedRange.Rows.Count
        Range("B1").Select
        Selection.Copy
        ActiveSheet.Range("B1:B" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("B1:B" & Z).Select
        Selection.Copy
        ActiveSheet.Range("B1:B" & Z).PasteSpecial Paste:=xlPasteValues
         Application.CutCopyMode = False
        Range("D" & Z & ":" & "D" & Z).Select
        Selection.Copy
        ActiveSheet.Range("D" & Z + 1 & ":" & "D" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("B1").Select
        ActiveCell.FormulaLocal = "=WENN(J1<>0;""BX"";""ST"")"
        Z = ActiveSheet.UsedRange.Rows.Count
        Range("B1").Select
        Selection.Copy
        ActiveSheet.Range("B1:B" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("B1:B" & Z).Select
        Selection.Copy
        ActiveSheet.Range("B1:B" & Z).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        'If ActiveSheet.AutoFilterMode Then
        'Selection.AutoFilter
        'End If
        'y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        'Range("A:G1").Select
        'Selection.AutoFilter
        'ActiveSheet.Range("$A$1:G" & y).AutoFilter Field:=7, Criteria1:="<>"
        'Range("G1:G" & y).Select
        'If ActiveSheet.Rows(8).Find("keine") Is Nothing Then GoTo sprung
        'Range("G2").SpecialCells(xlCellTypeVisible).Select
        'Dim w As Long
        'For w = 1 To Cells.SpecialCells(xlCellTypeLastCell).Row
        'If Rows(w).Hidden = False Then
        'Cells(w, 7).Select
        'ActiveCell.FormulaLocal = "=B" & w
        'Exit For
        'End If
        'Next w
        'Selection.Copy
        'ActiveSheet.Range("G1:G" & Z).Paste
        Range("C1").Select
        ActiveCell.FormulaLocal = 0
        Z = ActiveSheet.UsedRange.Rows.Count
        Range("C1").Select
        Selection.Copy
        ActiveSheet.Range("C1:C" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("C" & Z & ":" & "C" & Z).Select
        Selection.Copy
        ActiveSheet.Range("C" & Z + 1 & ":" & "C" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("E" & Z & ":" & "E" & Z).Select
        Selection.Copy
        ActiveSheet.Range("E" & Z + 1 & ":" & "E" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("F" & Z & ":" & "F" & Z).Select
        Selection.Copy
        ActiveSheet.Range("F" & Z + 1 & ":" & "F" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        Range("G" & Z & ":" & "G" & Z).Select
        Selection.Copy
        ActiveSheet.Range("G" & Z + 1 & ":" & "G" & y).PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        ActiveSheet.Range("G" & Z + 1 & ":" & "G" & y).Select
        Selection.Copy
        ActiveSheet.Range("G" & Z + 1 & ":" & "G" & y).PasteSpecial Paste:=xlPasteValues
        Range("A1").Select
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("H1").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[1]<>""Rand"","""",""x"")"
        Range("H1").Select
        Selection.Copy
        ActiveSheet.Range("H1:H" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("H1:H" & Z).Select
        Selection.Copy
        ActiveSheet.Range("H1:H" & Z).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        Application.CutCopyMode = False
        Range("J1").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-5]="""","""",RC[-5]/10*12)"
        Range("J1").Select
        Selection.Copy
        ActiveSheet.Range("J1:J" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("J1:J" & Z).Select
        Selection.Copy
        ActiveSheet.Range("J1:J" & Z).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        ActiveSheet.Range("J1:J" & Z).Select
        Selection.Copy
        ActiveSheet.Range("E1").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("I1").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-1]=""x"","""",RC[-5])"
        Range("I1").Select
        Selection.Copy
        ActiveSheet.Range("I1:I" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("I1:I" & Z).Select
        Selection.Copy
        ActiveSheet.Range("I1:I" & Z).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        ActiveSheet.Range("I1:I" & Z).Select
        Selection.Copy
        ActiveSheet.Range("D1").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("I1").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-5]="""","""",ROUND(RC[-5],2))"
        Range("I1").Select
        Selection.Copy
        ActiveSheet.Range("I1:I" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("I1:I" & Z).Select
        Selection.Copy
        ActiveSheet.Range("I1:I" & Z).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        ActiveSheet.Range("I1:I" & Z).Select
        Selection.Copy
        ActiveSheet.Range("D1").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("I1").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-4]="""","""",ROUND(RC[-4],0))"
        Range("I1").Select
        Selection.Copy
        ActiveSheet.Range("I1:I" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("I1:I" & Z).Select
        Selection.Copy
        ActiveSheet.Range("I1:I" & Z).PasteSpecial Paste:=xlPasteValues
        Application.CutCopyMode = False
        ActiveSheet.Range("I1:I" & Z).Select
        Selection.Copy
        ActiveSheet.Range("E1").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Range("I1:J" & Z).Delete
        Range("A1:H1").Select                                             ' Doppel l|fffd|schen die zweite
        Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
         Range("A1").Select
        ActiveCell.FormulaR1C1 = "SAP Code"
        Range("B1").Select
        ActiveCell.FormulaR1C1 = "Sales Uinit"
        Range("C1").Select
        ActiveCell.FormulaR1C1 = "Preis"
        Range("D1").Select
        ActiveCell.FormulaR1C1 = "Scale"
        Range("E1").Select
        ActiveCell.FormulaR1C1 = "Menge"
        Range("F1").Select
        ActiveCell.FormulaR1C1 = "SAP Code Ersetzung"
        Range("G1").Select
        ActiveCell.FormulaR1C1 = "Preis Alternative"
        Range("H1").Select
        ActiveCell.FormulaR1C1 = "Pr|fffd|fung"
        If ActiveSheet.AutoFilterMode = False Then
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("A1:H" & Z).Select
        Range("A1:H" & Z).AutoFilter
        End If
        ActiveWorkbook.Worksheets("CRT Upload").AutoFilter.Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("CRT Upload").AutoFilter.Sort.SortFields.Add Key:= _
        Range("A1"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
        xlSortNormal
    With ActiveWorkbook.Worksheets("CRT Upload").AutoFilter.Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
      
        ActiveSheet.Range("A1:H1").Select
        Selection.Delete Shift:=xlUp
            Range("A2:A" & Z).Select
            ActiveSheet.Range("A2:A" & Z).EntireRow.RemoveDuplicates Columns:=Array(1)
        
Sheets("Alternativsortiment").Select
        If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
        Application.CutCopyMode = False
        Range("A4").Select
        Sheets("Buttons").Select
        MsgBox "CRT-Uploaddatei erstellt"
        Exit Sub
fehler:
  MsgBox "kein bearbeitetes Sortiment vorhanden"
  Exit Sub

End Sub



Private Sub CommandButton5_Click()
Unload Me
Sheets("Buttons").Select
End Sub

Private Sub CommandButton6_Click()
Dim vorhanden As Boolean, n As Worksheet
For Each n In ThisWorkbook.Worksheets
    If n.Name = "Verbrauchsdaten" Then
        vorhanden = True
        Call Makro7
        Exit For
    End If
Next n
If vorhanden = False Then MsgBox "keine Statistik eingespielt"
End Sub

Sub Makro7()
If Worksheets("Verbrauchsdaten").Range("J2").Text = "#NV" Then GoTo weiter Else
If Worksheets("Verbrauchsdaten").Range("J2").Value = 0 Then GoTo fehler Else
weiter:
If Worksheets("Verbrauchsdaten").Range("K2").Text = "#NV" Then GoTo weiter1 Else
If Worksheets("Preisliste 2020").Range("B1").Value = 0 Then GoTo fehler1 Else
weiter1:
Sheets("Sortiment 2020").Select
If Worksheets("Sortiment 2020").Range("C7").Value <> 0 Then GoTo fehler2 Else
    anzahl = Sheets.Count
On Error Resume Next
Sheets("KernSortiment 2020").Select
Sheets("KernSortiment 2020").Delete
Sheets.Add
ActiveSheet.Name = "KernSortiment 2020"
Sheets("KernSortiment 2020").Move After:=Sheets(anzahl + 1)
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("A1:C" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("A1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("F1:F" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("D1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("G1:G" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("E1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("N1:N" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("F1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("AP1:AP" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("G1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("R1:R" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("H1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("S1:T1" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("I1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
Sheets("Verbrauchsdaten").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("AK1:AN" & Z).Select
   Selection.Copy
Sheets("KernSortiment 2020").Select
   With Worksheets("KernSortiment 2020").Range("K1")
   .PasteSpecial Paste:=xlValues
   End With
   Application.CutCopyMode = False
   ActiveSheet.Range("F2:F" & Z).Select
   Selection.NumberFormat = "0.00"
   ActiveSheet.Range("G2:G" & Z).Select
   Selection.NumberFormat = "0.00"
   ActiveSheet.Range("I2:I" & Z).Select
   Selection.NumberFormat = "0.00"
   ActiveSheet.Range("J2:J" & Z).Select
   Selection.NumberFormat = "0.00"
   ActiveSheet.Range("M2:M" & Z).Select
   Selection.NumberFormat = "0.00"
   ActiveSheet.Range("N2:N" & Z).Select
   Selection.NumberFormat = "0.00"
   Range("O2").Select
   ActiveCell.FormulaR1C1 = "=IF(OR(RC[-4]=0,RC[-4]=RC[-14]),""keine"",RC[-4])"
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("O2").Select
   Selection.Copy
   ActiveSheet.Range("O3:O" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Sheets("KernSortiment 2020").Select
   Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
   ActiveSheet.Range("A2:A" & Z).Select
   Selection.Copy
   Sheets("Sortiment 2020").Select                   'Sortiment 2020
   'ActiveWorkbook.Names("Farbpr|fffd|fung").Delete
   'ActiveWorkbook.Names("cmc").Delete
   ActiveWorkbook.Names.Add Name:="Farbpr|fffd|fung", RefersToR1C1:=Worksheets("Verbrauchsdaten").Range("A1:K90000")
    ActiveWorkbook.Names.Add Name:="cmc", RefersToR1C1:=Worksheets("CMC").Range("A1:J90000")
   With Worksheets("Sortiment 2020").Range("C6")
   .PasteSpecial Paste:=xlValues
   End With
   Range("L4").Select
    
   Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
   Range("K1").Select
   ActiveCell.FormulaLocal = "=(1/K2)*SUMME(A6:A" & Z & ")"
   'Range("O1").Select
   'ActiveCell.FormulaR1C1 = _
        "=(1/R[1]C)*(SUM(R[5]C[-13]:R[z]C[-13])-(SUM('delisted Artikel'!R[2]C[2]:R[z]C[2])-SUM('delisted Artikel'!R[2]C[1]:R[z]C[1])))"
   'ActiveCell.FormulaLocal = "=(1/O2)*SUMME(B6:B" & Z & ")"
   Range("K2").Select
   ActiveCell.FormulaLocal = "=SUMME($K$6:K" & Z & ")"
   Range("O2").Select
   ActiveCell.FormulaLocal = "=SUMME($O$6:O" & Z & ")"
   Range("A6").Select
   ActiveCell.FormulaLocal = "=(I6-J6)*H6"
   Range("B6").Select
   ActiveCell.FormulaLocal = "=(L6-N6)*H6"
   Range("A6:B6").Select
   Selection.Copy
    ActiveSheet.Range("A7:B" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("D6").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],'KernSortiment 2020'!C[-3]:C[-2],2,0)"
    Range("E6").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-2],Verbrauchsdaten!C[-4]:C[13],18,0)"
    Range("F6").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-3],'Bibel 2020'!C[-5]:C[11],17,0)),VLOOKUP(RC[-3],'KB-Liste 2019'!C[-5]:C[4],10,0),VLOOKUP(RC[-3],'Bibel 2020'!C[-5]:C[11],17,0))"
    Range("G6").Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(C6;'Bibel 2020'!A:B;2;0));SVERWEIS(C6;'KB-Liste 2019'!A:L;12;0);SVERWEIS(C6;'Bibel 2020'!A:B;2;0))"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-4],'Bibel 2020'!C[-6]:C[-5],2,0)"
    Range("H6").Select
    ActiveCell.FormulaR1C1 = _
        "=VLOOKUP(RC[-5],'KernSortiment 2020'!C[-7]:C[-5],3,0)"
    Range("I6").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-6],Verbrauchsdaten!C[-8]:C[5],14,0)"
    Range("L6").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-7]=""Kern"",VLOOKUP(RC[-9],Verbrauchsdaten!C[-11]:C[30],42,0),VLOOKUP(RC[-9],Farbpr|fffd|fung,11,0))"
         Range("J6").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-7],Verbrauchsdaten!C[-9]:C[-2],8,0)"
    Range("N6").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-11],Verbrauchsdaten!C[-13]:C[-5],9,0)"
    Range("P6").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-13],Verbrauchsdaten!C[-15]:C[-4],12,0)"
    Range("D6:P6").Select
   Selection.Copy
    ActiveSheet.Range("D7:P" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("Q6").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-14],'Status 2019'!C[-16]:C[-14],3,0)"
    Range("R6").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-2]),IF(ISERROR(RC[-1]),RC[-2],RC[-1]),(RC[-2]))"
    Range("Q6:R6").Select
    Selection.Copy
    ActiveSheet.Range("Q7:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("R6:R" & Z).Select
    Selection.Copy
    Range("P6:P" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Range("Q6:R" & Z).Delete
    Range("Q6").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-3]),RC[-7],IF(RC[-3]=0,RC[-7],RC[-3]))"
        Range("Q6").Select
        Selection.Copy
    ActiveSheet.Range("Q7:Q" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("Q6:Q" & Z).Select
    Selection.Copy
    Range("N6:N" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    Range("Q6:Q" & Z).Delete
    Range("H1").Select
    ActiveCell.FormulaLocal = "=SUMMEWENN($E$6:E" & Z & ";""Kern"";$O$6:O" & Z & ")"
    Range("A6:P" & Z).Select
    Selection.Sort key1:=Range("O6"), Order1:=xlDescending
    Range("A6").Select
Sheets("CMC").Select                                       'cmc einspielung ohne Verbrauch
    If ActiveSheet.AutoFilterMode Then
    Selection.AutoFilter
    End If
    y = ActiveSheet.UsedRange.Rows.Count
    Range("H1").Select
    ActiveCell.FormulaR1C1 = "=IF(ISERROR(RC[-1]),0,RC[-1])"
    Selection.Copy
    Range("H2:H" & y).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("A1:H1").Select
    Selection.AutoFilter
    Selection.AutoFilter Field:=8, Criteria1:="0"
    Range("A1:A" & y).Select
    Range("A2:A" & y).SpecialCells(xlCellTypeVisible).Select
    Selection.Copy
    Sheets("Sortiment 2020").Select
         Z = ActiveSheet.UsedRange.Rows.Count
     y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
     Range("C" & y + 1).Select
     ActiveSheet.Paste
     Range("D" & y, "P" & y).Select
     Selection.Copy
     Range("D" & y + 1, "P" & y + 1).Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     ActiveSheet.UsedRange
      Z = ActiveSheet.UsedRange.Rows.Count
      y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
    Range("D" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],CMC!C[-3]:C[-2],2,0)"
    Range("E" & y + 1).Select
    ActiveCell.FormulaR1C1 = "Kern"
    Range("F" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-3],'KB-Liste 2019'!C[-5]:C[4],10,0)"
    Range("G" & y + 1).Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-4],'Bibel 2020'!C[-6]:C[-5],2,0)),VLOOKUP(RC[-4],'KB-Liste 2019'!C[-6]:C[5],12,0),VLOOKUP(RC[-4],'Bibel 2020'!C[-6]:C[-5],2,0))"
    'ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(C4;'Bibel 2020'!A:B;2;0));SVERWEIS(C4;'KB-Liste 2019'!A:L;12;0);SVERWEIS(C4;'Bibel 2020'!A:B;2;0))"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-4],'Bibel 2020'!C[-6]:C[-5],2,0)"
    Range("H" & y + 1).Select
    ActiveCell.FormulaR1C1 = "0"
    Range("I" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-6],CMC!C[-8]:C[-4],5,0)"
    Range("J" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-7],'KB-Liste 2019'!C[-9]:C[-6],4,0)"
    Range("K" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=RC[-3]*RC[-2]"
    Range("L" & y + 1).Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-2]<RC[2],((1/RC[-2])*(RC[2]-RC[-2])+1)*RC[-3],RC[-3])"
    Range("M" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=(1/RC[-1])*(RC[-1]-RC[1])"
    Range("N" & y + 1).Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-11],'Bibel 2020'!C[-13]:C[-1],13,0)),RC[-4],IF(VLOOKUP(RC[-11],'Bibel 2020'!C[-13]:C[-1],13,0)=0,RC[-4],VLOOKUP(RC[-11],'Bibel 2020'!C[-13]:C[-1],13,0)))"
    Range("O" & y + 1).Select
        ActiveCell.FormulaR1C1 = "=RC[-7]*RC[-3]"
    Range("P" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-13],'Bibel 2020'!C[-15]:C[-4],12,0)"
    Range("D" & y + 1, "P" & y + 1).Select
    Selection.Copy
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    For i = 1 To Z Step 100
    d = ActiveSheet.Cells(Rows.Count, 4).End(xlUp).Row
    Range("D" & d, "P" & d + 100).Select
    ActiveSheet.Paste
    Next i
    Range("A" & Z + 1 & ":Q" & Z + 10000).Select
    Selection.Delete Shift:=xlUp
    Range("Q" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-14],'Status 2019'!C[-16]:C[-14],3,0)"
    Range("R" & y + 1).Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(RC[-2]),IF(ISERROR(RC[-1]),RC[-2],RC[-1]),(RC[-2]))"
    Range("Q" & y + 1, "R" & y + 1).Select
    Selection.Copy
    ActiveSheet.Range("Q" & y + 2, "R" & Z).Select
    ActiveSheet.Paste
    Range("R" & y + 1, "R" & Z).Select
    Selection.Copy
    Range("P" & y + 1, "P" & Z).PasteSpecial Paste:=xlPasteValues
    Range("Q" & y + 1, "R" & Z).Delete
    Range("Q" & y + 1).Select
    ActiveCell.FormulaR1C1 = "=ROUND(RC[-5],2)"
    Range("Q" & y + 1).Select
    Selection.Copy
    ActiveSheet.Range("Q" & y + 2, "Q" & Z).Select
    ActiveSheet.Paste
    Range("Q" & y + 1, "Q" & Z).Select
    Selection.Copy
    Range("L" & y + 1, "L" & Z).PasteSpecial Paste:=xlPasteValues
    Range("Q" & y + 1, "Q" & Z).Delete
    Application.CutCopyMode = False
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("A6:B6").Select
    Selection.Copy
    ActiveSheet.Range("A7:B" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
Sheets("CMC").Select                       'l|fffd|scht sverweise aus cmc
    Selection.AutoFilter
    Range("A1:K" & Z).Copy
    Range("A1:K" & Z).PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
Sheets("Sortiment 2020").Select
    Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
    Range("D1").Select
    ActiveCell.FormulaR1C1 = "=R[1]C[11]-RC[4]"
    Range("E1").Select
    ActiveCell.FormulaR1C1 = "=RC[-1]/R[1]C[10]"
    'Range("H1").Select
    'ActiveCell.FormulaR1C1 = "=SUMIF(R4C5:R[745]C[-3],""Kern"",R4C15:R[745]C[7])"
       Range("E3").Select
   ActiveCell.FormulaLocal = "=SUMMEWENN($G$6:G" & Z & ";" & "5" & ";" & "$O$6:O" & Z & ")"
   Range("E4").Select
   ActiveCell.FormulaLocal = "=E3/O2"
   Range("F4").Select
   ActiveCell.FormulaLocal = "=(1/E3)*SUMMEWENN($G$6:G" & Z & ";5;$B$6:B" & Z & ")"
   Range("I3").Select
   ActiveCell.FormulaLocal = "=SUMMEWENN($G$6:G" & Z & ";" & "8" & ";" & "$O$6:O" & Z & ")"
   Range("I4").Select
   ActiveCell.FormulaLocal = "=I3/O2"
   Range("J4").Select
   ActiveCell.FormulaLocal = "=(1/I3)*SUMMEWENN($G$6:G" & Z & ";" & "8" & ";" & "$B$6:B" & Z & ")"
   Range("L3").Select
   ActiveCell.FormulaLocal = "=O2-I3-E3"
   Range("L4").Select
   ActiveCell.FormulaLocal = "=L3/O2"
   Range("M4").Select
   ActiveCell.FormulaLocal = "=(1/L3)*(SUMME($B$6:B" & Z & ")" & "-" & "(SUMMEWENN($G$6:G" & Z & ";" & "5" & ";" & "$B$6:B" & Z & ")" & "+" & "SUMMEWENN($G$6:G" & Z & ";" & "8" & ";" & "$B$6:B" & Z & ")))"
   'ActiveCell.FormulaLocal = "=(1/L3)*(SUMME($B$6:B" & Z & ")" & "-" & "SUMMEWENN($G$6:G" & Z & ";" & "4" & "," & "7" & ";" & "$B$6:B" & Z & "))"
    Range("H1").Select
    ActiveCell.FormulaLocal = "=SUMMEWENN($E$6:E" & Z & ";""Kern"";$O$6:O" & Z & ")"
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "=RC[-1]/R[1]C[6]"
    'Range("K2").Select
    'ActiveCell.FormulaR1C1 = "=SUM(R4C11:R[z]C)"
    Range("L2").Select
    ActiveCell.FormulaR1C1 = "=(1/RC[-1])*(RC[3]-RC[-1])"
    Range("P2").Select
    ActiveCell.FormulaR1C1 = "=R[-1]C[-1]-R[-1]C[-5]"
    Range("K1").Select
    ActiveCell.FormulaLocal = "=(1/K2)*SUMME(A6:A" & Z & ")"
    Range("O1").Select
    'ActiveCell.FormulaR1C1 = _
       "=(1/R[1]C)*(SUM(R[5]C[-13]:R[& z]C[-13])-(SUM('delisted Artikel'!R[2]C[2]:R[&z]C[2])-SUM('delisted Artikel'!R[2]C[1]:R[&z]C[1])))"
    'Range("O1").Select
    'ActiveCell.FormulaLocal = "=(1/O2)*SUMME(B6:B" & Z & ")"
    Range("O1").FormulaLocal = "=(1/O2)*(SUMME(B6:B" & Z & ")-((SUMME('delisted Artikel'!Q3:Q" & Z & ")-SUMME('delisted Artikel'!P3:P" & Z & "))))"
    Range("H2").Select
    ActiveCell.FormulaR1C1 = "=(RC[7]/0.8225)"
    Range("K2").Select
    ActiveCell.FormulaLocal = "=SUMME($K$6:K" & Z & ")"
    Range("O2").Select
    ActiveCell.FormulaLocal = "=SUMME($O$6:O" & Z & ")"
    Range("O3").FormulaLocal = "=(1/SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$K$6:K" & Z & "))" & "*SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$A$6:A" & Z & ")"
    'ActiveCell.FormulaLocal = "=(1/H1)*SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$A$6:A" & Z & ")"
    Range("O4").Select
    ActiveCell.FormulaLocal = "=(1/H1)*SUMMEWENN($E$6:E" & Z & ";" & """Kern""" & ";" & "$B$6:B" & Z & ")"
    Range("Q3").FormulaLocal = "=(1/SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$K$6:K" & Z & "))" & "*SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$A$6:A" & Z & ")"
    'ActiveCell.FormulaLocal = "=(1/D1)*SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$A$6:A" & Z & ")"
    Range("Q4").Select
    ActiveCell.FormulaLocal = "=(1/D1)*SUMMEWENN($E$6:E" & Z & ";" & """Rand""" & ";" & "$B$6:B" & Z & ")"
    Application.CutCopyMode = False
Sheets("delisted Artikel").Select                                          'delisted Artikel
    ActiveWorkbook.Names.Add Name:="Margenpr|fffd|fung", RefersToR1C1:= _
        "='Sortiment 2020'!C3:C13"
    Range("F1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[1])"
    Range("L1").Select
    ActiveCell.FormulaR1C1 = "=SUM(C[1])"
    Range("B3").Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A3;'KernSortiment 2020'!A:B;2;0));SVERWEIS(A3;CMC!A:B;2;0);SVERWEIS(A3;'KernSortiment 2020'!A:B;2;0))"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-1],'KernSortiment 2020'!C[-1]:C,2,0)"
    Range("C3").Select
    ActiveCell.FormulaLocal = "=SVERWEIS(A3;'Sortiment 2020'!C:P;14;0)"
    'ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A3;Verbrauchsdaten!A:L;12;0));SVERWEIS(A3;'Status 2019'!A:C;3;0);SVERWEIS(A3;Verbrauchsdaten!A:L;12;0))"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-2],Verbrauchsdaten!C[-2]:C[9],12,0)"
    Range("D3").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-3],'KB-Liste 2019'!C[-3]:C[6],10,0)"
    Range("E3").Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A3;Verbrauchsdaten!A:C;3;0));0;SVERWEIS(A3;Verbrauchsdaten!A:C;3;0))"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-4],Verbrauchsdaten!C[-4]:C[-2],3,0)"
    Range("F3").Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A3;Verbrauchsdaten!A:N;14;0));SVERWEIS(A3;Margenpr|fffd|fung;7;0);SVERWEIS(A3;Verbrauchsdaten!A:N;14;0))"
    'ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-5],Verbrauchsdaten!C[-5]:C[8],14,0)"
    Range("G3").Select
    ActiveCell.FormulaR1C1 = "=RC[-1]*RC[-2]"
    Range("H3").Select
    ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A3;'KernSortiment 2020'!A:A;1;0));SVERWEIS(A3;CMC!A:Q;17;0);SVERWEIS(A3;'KernSortiment 2020'!A:O;15;0))"
    Range("I3").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-1]<>""keine"",IF(RC[-1]=0,VLOOKUP(RC[-1],'Matriste 2020'!C[-8]:C[-7],2,0),IF(ISERROR(VLOOKUP(RC[-1],'Bibel 2020'!C[-8],1,0)),VLOOKUP(RC[-1],'KB-Liste 2019'!C[-8]:C[-7],2,0),VLOOKUP(RC[-1],'Bibel 2020'!C[-8]:C[-2],7,0))),"""")"
    'activcell.HasFormula = "=WENN(H3<>""keine"";WENN(H3=0;SVERWEIS(H3;'Matriste 2015'!A:B;2;0);WENN(ISTFEHLER(SVERWEIS(H3;'Bibel 2020'!A:A;1;0));SVERWEIS(H3;'KB-Liste 2019'!A:B;2;0);SVERWEIS(H3;'Bibel 2020'!A:G;7;0)));"")"
    Range("J3").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-2]=""keine"","""",VLOOKUP(RC[-2],'Bibel 2020'!C[-9]:C[7],17,0))"
    Range("K3").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-3]<>""keine"",IF(RC[-3]=0,VLOOKUP(RC[-3],'Matriste 2020'!C[-10]:C[-9],2,0),IF(ISERROR(VLOOKUP(RC[-3],'Bibel 2020'!C[-10],1,0)),VLOOKUP(RC[-3],'KB-Liste 2019'!C[-10]:C[-7],4,0),VLOOKUP(RC[-3],'Bibel 2020'!C[-10]:C[2],13,0))),"""")"
    'ActiveCell.HasFormula = "=WENN(H3<>""keine"";WENN(H3=0;SVERWEIS(H3;'Matriste 2015'!A:B;2;0);WENN(ISTFEHLER(SVERWEIS(H3;'Bibel 2020'!A:A;1;0));SVERWEIS(H3;'KB-Liste 2019'!A:D;4;0);SVERWEIS(H3;'Bibel 2020'!A:M;13;0)));"")"
    'ActiveCell.FormulaR1C1Local = "=WENN(H3<>""keine"";WENN(H3=0;SVERWEIS(H3;'Matriste 2015'!A:B;2;0);WENN(ISTFEHLER(SVERWEIS(H3;'Bibel 2020'!A:A;1;0));SVERWEIS(H3;'KB-Liste 2019'!A:D;4;0);SVERWEIS(H3;'Bibel 2020'!A:M;13;0)));"")"
     Range("L3").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(RC[-4]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-4],'Sortiment 2020'!C[-9]:C,10,0)),VLOOKUP(RC[-4],Farbpr|fffd|fung,11,0),VLOOKUP(RC[-4],'Sortiment 2020'!C[-9]:C,10,0)))"
     'ActiveCell.HasFormula = "=WENN(H3=""keine"";"";WENN(ISTFEHLER(SVERWEIS(H3;'Sortiment 2020'!C:L;10;0));SVERWEIS(H3;Farbpr|fffd|fung;11;0);SVERWEIS(H3;'Sortiment 2020'!C:L;10;0)))"
        'ActiveCell.FormulaR1C1 = _
        '"=IF(RC[-4]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-4],'Sortiment 2020'!C[-9]:C,10,0)),RC[-6]*1.04,VLOOKUP(RC[-4],'Sortiment 2020'!C[-9]:C,10,0)))"
     'Range("N3").Select
      'ActiveCell.FormulaR1C1 = "=(RC[-2]-RC[-3])/RC[-2]"
     Range("M3").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(RC[-5]=""keine"","""",((RC[-8]*RC[-9])/RC[-3])*RC[-1])"
        Range("N3").Select
        'ActiveCell.FormulaLocal = "=WENN(H4=""keine"";"";(L4-K4)/L4)"
        ActiveCell.FormulaR1C1 = "=IF(RC[-6]=""keine"","""",(RC[-2]-RC[-3])/RC[-2])"
        Range("O3").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(RC[-7]=""keine"","""",VLOOKUP(RC[-14],Margenpr|fffd|fung,11,0))"
        Range("P3").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-8]=""keine"","""",RC[-3]*RC[-2])"
        Range("Q3").Select
        ActiveCell.FormulaR1C1 = "=IF(RC[-9]=""keine"","""",RC[-2]*RC[-10])"
        Range("R3").Select
        ActiveCell.FormulaR1C1 = _
          "=IF(RC[-10]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-10],'Preisliste 2020'!C[-17]:C[-16],1,0)),VLOOKUP(RC[-10],'Bibel 2020'!C[-17]:C[14],32,0),VLOOKUP(RC[-10],'Preisliste 2020'!C[-17]:C[-16],2,0)))"
        Range("S3").Select
        ActiveCell.FormulaR1C1 = _
           "=VLOOKUP(RC[-11],'Sortiment 2020'!R6C[-16]:R[1567]C[-11],6,0)"
        
Sheets("Alternativsortiment").Select                                            'Alternativsortiment
    ActiveWorkbook.Names.Add Name:="Margenpr|fffd|fung", RefersToR1C1:= _
        "='Sortiment 2020'!C3:C13"
    Range("E1").Select
    ActiveCell.FormulaLocal = "=SUMME(F:F)"
    Range("L1").Select
    ActiveCell.FormulaLocal = "=SUMME(M:M)"
    Range("B4").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-1],'Matriste 2020'!C[-1]:C,2,0)),VLOOKUP(RC[-1],'KB-Liste 2019'!C[-1]:C,2,0),VLOOKUP(RC[-1],'Matriste 2020'!C[-1]:C,2,0))"
     Range("C4").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-2],'KB-Liste 2019'!C[-2]:C[7],10,0)"
    Range("D4").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-3],Verbrauchsdaten!C[-3]:C[-1],3,0)),0,VLOOKUP(RC[-3],Verbrauchsdaten!C[-3]:C[-1],3,0))"
       Range("E4").Select
    ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-4],'Sortiment 2020'!C[-2]:C[7],10,0)"
    Range("F4").Select
    ActiveCell.FormulaR1C1 = "=RC[-1]*RC[-2]"
    Range("G4").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[1]=""keine"","""",IF(RC[-1]>RC[6],""Vorteil"",""Nachteil""))"
    Range("H4").Select
     ActiveCell.FormulaLocal = "=WENN(ISTFEHLER(SVERWEIS(A4;'KernSortiment 2020'!A:A;1;0));SVERWEIS(A4;CMC!A:Q;17;0);SVERWEIS(A4;'KernSortiment 2020'!A:O;15;0))"
    Range("I4").Select
    ActiveCell.FormulaLocal = "=WENN(H4<>""keine"";WENN(H4=0;SVERWEIS(H4;'Matriste 2020'!A:B;2;0);WENN(ISTFEHLER(SVERWEIS(H4;'Bibel 2020'!A:A;1;0));SVERWEIS(H4;'KB-Liste 2019'!A:B;2;0);SVERWEIS(H4;'Bibel 2020'!A:G;7;0)));"""")"
        Range("J4").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-2]=""keine"","""",VLOOKUP(RC[-2],'Bibel 2020'!C[-9]:C[7],17,0))"
    Range("K4").Select
    ActiveCell.FormulaLocal = "=WENN(H4<>""keine"";WENN(H4=0;SVERWEIS(H4;'Matriste 2020'!A:B;2;0);WENN(ISTFEHLER(SVERWEIS(H4;'Bibel 2020'!A:A;1;0));SVERWEIS(H4;'KB-Liste 2019'!A:D;4;0);SVERWEIS(H4;'Bibel 2020'!A:M;13;0)));"""")"
       Range("L4").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-4]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-4],'Sortiment 2020'!C[-9]:C,10,0)),VLOOKUP(RC[-4],Farbpr|fffd|fung,11,0),VLOOKUP(RC[-4],'Sortiment 2020'!C[-9]:C,10,0)))"
    Range("M4").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-5]=""keine"","""",((RC[-10]*RC[-9])/RC[-3])*RC[-1])"
        Range("N4").Select
        'ActiveCell.FormulaLocal = "=WENN(H4=""keine"";"";(L4-K4)/L4)"
        ActiveCell.FormulaR1C1 = "=IF(RC[-6]=""keine"","""",(RC[-2]-RC[-3])/RC[-2])"
        Range("O4").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(RC[-7]=""keine"","""",VLOOKUP(RC[-14],Margenpr|fffd|fung,11,0))"
        Range("P4").Select
        ActiveCell.FormulaLocal = "=O4*F4"
        Range("Q4").Select
        ActiveCell.FormulaLocal = "=N4*M4"
Sheets("Sortiment 2020").Select                                     ' Filter f|fffd|r Sortimentbearbeitung
    If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
    End If
        y = ActiveSheet.UsedRange.Rows.Count
        Range("A5:P5").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=5, Criteria1:="Kern"
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=16, Criteria1:=Array( _
        "98", "99", "D"), Operator:=xlFilterValues
        'Selection.AutoFilter Field:=16, Criteria1:="=98", _
        'Operator:=xlOr, Criteria2:="=D" ' , _
        'Operator:=xlOr, Criteria3:="=99"
        Range("C6:C" & y).Select
        Range("C6:C" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("delisted Artikel").Select
        Range("A3").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("B3:S3").Select
        Selection.Copy
        Range("B4:S" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
Sheets("Sortiment 2020").Select
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        y = ActiveSheet.UsedRange.Rows.Count
        Range("A5:P5").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=16, Criteria1:=Array( _
        "SPE/SPX", "C", "N", "N/A", "0"), Operator:=xlFilterValues
        ActiveSheet.Range("$A$5:P" & y).AutoFilter Field:=5, Criteria1:="Kern"
        Range("C6:C" & y).Select
        Range("C6:C" & y).SpecialCells(xlCellTypeVisible).Select
        Selection.Copy
Sheets("Alternativsortiment").Select
        Range("A4").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        For i = 4 To Z Step 50
        Range("B4:T4").Select
        Selection.Copy
        Range("B" & i + 1 & ":T" & i + 50).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Next i
        Range("A" & Z + 1 & ":T" & Z + 1000).Select
        Selection.Delete Shift:=xlUp
        ' Range("A" & Z + 1 & ":T" & Z + 1000).ClearContents
        If ActiveSheet.AutoFilterMode Then
        Selection.AutoFilter
        End If
        Range("A3:T3").Select
        Selection.AutoFilter
        ActiveSheet.Range("$A$4:T" & Z).AutoFilter Field:=8, Criteria1:="keine"
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        If Z < 4 Then GoTo sprung
        Range("A4:T" & Z).SpecialCells(xlCellTypeVisible).Select
        Selection.Delete
sprung:
        Selection.AutoFilter
        Range("A4:T" & Z).Select
        Selection.Sort key1:=Range("F4"), Order1:=xlDescending
        'Selection.AutoFilter
        Application.CutCopyMode = False
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("H1").Select
        ActiveCell.FormulaR1C1 = _
        "=('Sortiment 2020'!R[1]C[7]-Alternativsortiment!RC[-3]+Alternativsortiment!RC[4])"
Sheets("Sortiment 2020").Select
        Selection.AutoFilter
        y = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Sheets("Alternativsortiment").Select
        Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
        Range("J1").Select
        Range("J1").FormulaLocal = "=(1/H1)*(SUMME('Sortiment 2020'!B6:B" & y & ")-SUMME(Alternativsortiment!P4:P" & Z & ")+SUMME(Alternativsortiment!Q4:Q" & Z & "))"
        Application.CutCopyMode = False
        Sheets("Sortiment 2020").Select
        Selection.AutoFilter
        Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("A4").Select
        Sheets("Basisdaten Grafik").Select     ' Daten f|fffd|r Grafik
        Range("B7").Select
        Range("B7").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!F2:F" & Z & ";0" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B8").Select
        Range("B8").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!F2:F" & Z & ";1" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B17").Select
        Range("B17").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";1" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B18").Select
        Range("B18").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";2" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B19").Select
        Range("B19").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";3" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B20").Select
        Range("B20").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";4" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B21").Select
        Range("B21").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";5" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B22").Select
        Range("B22").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";6" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B23").Select
        Range("B23").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";7" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B24").Select
        Range("B24").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";8" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B25").Select
        Range("B25").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";9" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B26").Select
        Range("B26").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";10" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B27").Select
        Range("B27").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";11" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B28").Select
        Range("B28").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";12" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B29").Select
        Range("B29").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";13" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B30").Select
        Range("B30").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";14" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("B31").Select
        Range("B31").FormulaLocal = "=SUMMEWENN(Verbrauchsdaten!G2:G" & Z & ";15" & ";Verbrauchsdaten!S2:S" & Z & ")"
        Range("C7").Select
        Range("C7").FormulaLocal = "=SUMMEWENN('Sortiment2015'!E6:E" & Z & ";""Rand" & ";'Sortiment2015'!O6:O" & Z & ")"
        Range("C8").Select
        Range("C8").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!E6:E" & Z & ";""Kern" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C17").Select
        'ActiveCell.FormulaR1C1 = _
        ' "=SUMIF('Sortiment 2020'!R[-11]C[4]:R[692]C[4],1,'Sortiment 2020'!R[-12]C[12]:R[1700]C" & Z & ")"
        Range("C17").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";1" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C18").Select
        Range("C18").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";2" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C19").Select
        Range("C19").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";3" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C20").Select
        Range("C20").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";4" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C21").Select
        Range("C21").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";5" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C22").Select
        Range("C22").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";6" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C23").Select
        Range("C23").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";7" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C24").Select
        Range("C24").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";8" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C25").Select
        Range("C25").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";9" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C26").Select
        Range("C26").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";10" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C27").Select
        Range("C27").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";11" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C28").Select
        Range("C28").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";12" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C29").Select
        Range("C29").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";13" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C30").Select
        Range("C30").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";14" & ";'Sortiment 2020'!O6:O" & Z & ")"
        Range("C31").Select
        Range("C31").FormulaLocal = "=SUMMEWENN('Sortiment 2020'!G6:G" & Z & ";15" & ";'Sortiment 2020'!O6:O" & Z & ")"
        
Sheets("Alternativsortiment").Select     ' PL und Katalogseite einf|fffd|gen in Alternativsortiment
        Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("R4").Select
        ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-10],Verbrauchsdaten!C[-17]:C[-15],3,0)"
        Range("S4").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-11],'Bibel 2020'!C[-18]:C[-10],9,0)),VLOOKUP(RC[-11],'KB-Liste 2019'!C[-18]:C[-16],3,0),VLOOKUP(RC[-11],'Bibel 2020'!C[-18]:C[-10],9,0))"
        Range("T4").Select
         ActiveCell.FormulaR1C1 = _
        "=IF(RC[-12]=""keine"","""",IF(ISERROR(VLOOKUP(RC[-12],'Preisliste 2020'!C[-19]:C[-18],1,0)),VLOOKUP(RC[-12],'KB-Liste 2019'!C[-19]:C[12],32,0),VLOOKUP(RC[-12],'Preisliste 2020'!C[-19]:C[-18],2,0)))"
        Range("R4:T4").Select
        Selection.Copy
        Range("R4:T" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        
Sheets("Sortiment 2020").Select
        Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
        Range("Q6:R6").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
        Range("Q6").Select
        ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-14],'Preisliste 2020'!C[-16]:C[-15],1,0)),VLOOKUP(RC[-14],'KB-Liste 2019'!C[-16]:C[15],32,0),VLOOKUP(RC[-14],'Preisliste 2020'!C[-16]:C[-15],2,0))"
        Range("R6").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(ISERROR(VLOOKUP(RC[-15],'Bibel 2020'!C[-17]:C[-9],9,0)),VLOOKUP(RC[-15],'KB-Liste 2019'!C[-17]:C[-15],3,0),VLOOKUP(RC[-15],'Bibel 2020'!C[-17]:C[-9],9,0))"
        Range("Q6:R6").Select
        Selection.Copy
        Range("Q6:R" & Z).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        
        Sheets("Buttons").Select
        MsgBox "Sortiment erstellt"
        Exit Sub
fehler:
        MsgBox "Bitte Preisliste 2019 ausw|fffd|hlen"
        Exit Sub
fehler1:
        MsgBox "Bitte Preisliste 2020 ausw|fffd|hlen"
        Exit Sub
fehler2:
        MsgBox "Es ist bereits ein Sortiment erstellt worden"
        Exit Sub
End Sub

Sub CommandButton7_Click()
If Worksheets("Sortiment 2020").Range("C7").Value = 0 Then GoTo fehler Else
On Error Resume Next
Sheets("KernSortiment 2020").Select
   Sheets("KernSortiment 2020").Delete
   Sheets("Sortiment 2020").Select
   If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   Z = ActiveSheet.Cells(Rows.Count, 3).End(xlUp).Row
   If Z > 7 Then
   Range("A7:R" & Z).Delete
   Else
   End If
   Application.CutCopyMode = False
Sheets("delisted Artikel").Select
   If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
   If Z > 3 Then
   ActiveSheet.Range("A4:S" & Z).Delete
   Else
   End If
   'Range("A4:O" & Z).Delete
   Application.CutCopyMode = False
Sheets("Alternativsortiment").Select
   If ActiveSheet.AutoFilterMode Then
   Selection.AutoFilter
   End If
   Z = ActiveSheet.Cells(Rows.Count, 2).End(xlUp).Row
   If Z > 4 Then
   ActiveSheet.Range("A5:T" & Z).Select
   Selection.Delete Shift:=xlToLeft
   Else
   End If
   Application.CutCopyMode = False
Sheets("Preisliste 2020").Select
   Z = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
   Range("A1:D" & Z).ClearContents
   Sheets("Preisliste 2020").Range("F2:Y2").Copy
   Sheets("Alternativsortiment").Range("A4").PasteSpecial _
   Paste:=xlPasteFormats, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
   Application.CutCopyMode = False
   Sheets("Preisliste 2020").Range("F4:X4").Copy
   Sheets("delisted Artikel").Range("A3").PasteSpecial _
   Paste:=xlPasteFormats
   Application.CutCopyMode = False
   Sheets("Preisliste 2020").Range("F6:Y6").Copy
   Sheets("Sortiment 2020").Range("A6").PasteSpecial _
   Paste:=xlPasteFormats
   Application.CutCopyMode = False
   Sheets("Buttons").Select
   MsgBox "Sortiment wurde wieder gel|fffd|scht"""
   Exit Sub
fehler:
  MsgBox "kein bearbeitetes Sortiment vorhanden"
  Exit Sub
End Sub

Private Sub CommandButton8_Click()
Sheets("CMC").Select
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveSheet.Range("G1").Select
   Selection.Font.Bold = True
   ActiveCell.FormulaR1C1 = "Verbrauch"
   ActiveSheet.Range("G2").Select ' Verbrauch im CMC
   Selection.Font.Bold = False
   ActiveCell.FormulaR1C1 = "=VLOOKUP(RC[-6],Verbrauchsdaten!C[-6]:C[-4],3,0)"
   Selection.Copy
   ActiveSheet.Range("G2:G" & Z).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
End Sub

Private Sub CommandButton9_Click()
Dim vorhanden As Boolean, n As Worksheet
For Each n In ThisWorkbook.Worksheets
    If n.Name = "Verbrauchsdaten" Then
        vorhanden = True
        Call Makro3
        Exit For
    End If
Next n
If vorhanden = False Then MsgBox "keine Statistik eingespielt"
End Sub

Sub Makro3()
If Worksheets("Verbrauchsdaten").Range("G1").Value = 0 Then GoTo fehler Else
Sheets("Verbrauchsdaten").Select
    ActiveSheet.Range("R1").Select
    Selection.Font.Bold = True
    ActiveCell.FormulaR1C1 = "Kern 2019"
    ActiveSheet.Range("R2").Select ' Betrachtung Umsatz und Verbrauch
    Selection.Font.Bold = False
    Z = ActiveSheet.UsedRange.Rows.Count
Coresplitformel:
    If TextBox3.Text = "" Then GoTo weiter
    Coresplit = CInt(TextBox3.Text)
    If IsError(Sheets("Verbrauchsdaten").Range("K3")) Then GoTo weiter1
    If Sheets("Preisliste 2020").Range("B2").Value = 0 Then GoTo ende2
weiter1:

 ActiveCell.FormulaLocal = "=wenn(AR2<=($AR" & "$" & Z & "*" & Coresplit & "%" & ");""Kern"";""Rand"")"
    Selection.Copy
    ActiveSheet.Range("R2:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'ActiveSheet.Range("O2").Select ' VK 2020
    'Selection.Font.Bold = False
    'Selection.NumberFormat = "0.00"
    'ActiveCell.FormulaR1C1 = _
        "=IF(RC[3]=""Rand"",RC[-4],IF(RC[-7]<RC[-6],((1/RC[-7])*(RC[-6]-RC[-7])+1)*RC[-1],RC[-1]))"
    'Selection.Copy
    'ActiveSheet.Range("O2:O" & Z).Select
    'ActiveSheet.Paste
    'Application.CutCopyMode = False
    'ActiveSheet.Range("T2").Select ' Summe 2020
    'Selection.Font.Bold = False
    'Selection.NumberFormat = "0.00"
    'ActiveCell.FormulaR1C1 = "=RC[-5]*RC[-17]"
    'Selection.Copy
    'ActiveSheet.Range("T2:T" & Z).Select
    'ActiveSheet.Paste
    'Application.CutCopyMode = False
    GoTo ende1
    Exit Sub
weiter:
    'On Error GoTo Verbrauchsformel
    If TextBox1.Text = "" Then GoTo Verbrauchsformel
    Umsatz = CInt(TextBox1.Text)
    If TextBox2.Text = "" Then GoTo Umsatzformel
    'On Error GoTo Umsatzformel
    Verbrauch = CInt(TextBox2.Text)
     'If Verbrauch.Value = "" Then GoTo Umsatzformel
    ActiveCell.FormulaR1C1 = _
    "=IF(RC[-15]>" & Verbrauch & ",""Kern"",IF(RC[-13]>" & Umsatz & ",""Kern"",""Rand""))"
    Selection.Copy
    ActiveSheet.Range("R2:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    GoTo ende1
    Exit Sub
Verbrauchsformel:
    If TextBox2.Text = "" Then GoTo ende
   Verbrauch = CInt(TextBox2.Text)
   Z = ActiveSheet.UsedRange.Rows.Count
   ActiveCell.FormulaR1C1 = _
    "=IF(RC[-15]>" & Verbrauch & ",""Kern"",""Rand"")"
    Selection.Copy
    ActiveSheet.Range("R2:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    'Resume Next
    GoTo ende1
    Exit Sub
Umsatzformel:
    If TextBox1.Text = "" Then GoTo ende
    Umsatz = CInt(TextBox1.Text)
    Z = ActiveSheet.UsedRange.Rows.Count
    ActiveCell.FormulaR1C1 = _
    "=IF(RC[-13]>" & Umsatz & ",""Kern"",""Rand"")"
    Selection.Copy
    ActiveSheet.Range("R2:R" & Z).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    GoTo ende1
    Exit Sub
    'Resume Next
ende1:
    Sheets("Buttons").Select
    MsgBox " Auswahl |fffd|bertragen"
    Exit Sub
ende2:
    Sheets("Buttons").Select
    MsgBox "Bitte f|fffd|r diese Auswahl erst beide Preislisten einspielen"
    Exit Sub
ende:
    Sheets("Buttons").Select
    MsgBox "keine Kriterien festgelegt"
    Exit Sub
fehler:
   Sheets("Buttons").Select
    MsgBox "Bitte Preise einspielen"
   Exit Sub
End Sub

Private Sub Label19_Click()

End Sub

Private Sub TextBox1_Change()
On Error GoTo fehler
Dim Umsatz As Integer
Umsatz = CInt(TextBox1.Text)
Exit Sub
fehler:
MsgBox " Falsche Eingabe! "

End Sub

Private Sub TextBox2_Change()
On Error GoTo fehler
Dim Verbrauch As Integer
Verbrauch = CInt(TextBox2.Text)
Exit Sub
fehler:
MsgBox " Falsche Eingabe! "

End Sub


Private Sub TextBox3_Change()

On Error GoTo fehler
Dim Coresplit As Integer
Coresplit = CInt(TextBox3.Text)
Exit Sub
fehler:
MsgBox " Falsche Eingabe! "
Exit Sub
End Sub



INQUEST-PP=macro
