Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "modImport"
Option Explicit
Dim objImport As Excel.Application
Dim strImport As String
Dim strCurrent As String
Dim objEQ As String
Dim y As Boolean

Sub Import()
    Dim msgResp As String
    
    msgResp = MsgBox("Include alternate schedules", vbYesNo, "Decay schedules")
    
    If msgResp = vbNo Then
        Call ImportOrig
        Call SaveFile
    Else
        Call ImportOrig
        Call ImportAltS
        Call ImportAltR
        Call SaveFile
    End If
End Sub

Private Sub ImportOrig()
    Dim x As Integer
    Dim z As Integer
    Dim aa As Integer
    Dim counter As Integer
    Dim marker As Integer
    Dim ab As Integer
    
    On Error GoTo ImportFiles_err
    
    Application.StatusBar = "Loading EQ data.........."
    
    Set objImport = New Excel.Application
    
    strCurrent = ActiveWorkbook.Name
    objEQ = Application.GetOpenFilename("Excel Files (*.xlsm), *.xlsm", , "EQ")
    
    If objEQ <> "" And objEQ <> "False" Then
        objImport.Workbooks.Open objEQ
        strImport = objImport.ActiveWorkbook.Name
        y = True
    Else
        Exit Sub
    End If
    
    objImport.Range("v_altscenario") = 1
    objImport.Run "ScenarioChange"
    Application.Calculation = xlCalculationManual
    
    'Project specs
    Sheet6.Select
    Range("Institution") = objImport.Range("Home")
    Range("City_State") = objImport.Range("control_city") & ", " & objImport.Range("control_state")
    Range("Prepared") = "Report Date: " & Format(Now(), "mmmm dd, yyyy")
    Range("Underlying") = "Data as of: " & Format(objImport.Range("ControlDate"), "mmmm dd, yyyy")
         
    '%Runoff inputs
    Sheet2.Select
    x = 3
    z = 2
    aa = 2
    counter = 1
    Do Until x = 93
        For counter = 1 To 10
            If objImport.Sheets("Control").Cells(counter + 17, 13) = True Then Sheet2.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa) Else Sheet2.Cells(z, aa - 1) = 0
                If Left(Sheet2.Cells(z, aa - 1), 1) = "0" And z < 22 And _
                        Left(Sheet2.Cells(z - 1, aa - 1), 1) <> "0" Then
                    marker = z
                End If
                If counter = 10 And marker = 0 Then
                    marker = z + 1
                End If
                Do Until aa = 22
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" And _
                            objImport.Sheets("Control").Cells(counter + 17, 13) = True Then
                        Sheet2.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 162 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Repricing
    Sheet5.Select
    x = 279
    z = 2
    aa = 2
    counter = 1
    Do Until x = 369
        For counter = 1 To 10
            Sheet5.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                Do Until aa = 26
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" Then
                        Sheet5.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 162 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Change formula references to CD PV worksheets
    objImport.Sheets("DecayRates").Cells.Replace What:="_cr", Replacement:="_cd", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    objImport.Calculate
            
    '%Runoff inputs
    Sheet2.Select
    x = 3
    z = marker
    aa = 2
    counter = 1
    Do Until x = 93
        For counter = 1 To 10
            If objImport.Sheets("Control").Cells(counter + 28, 13) = True Then Sheet2.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa) Else Sheet2.Cells(z, aa - 1) = 0
                Do Until aa = 22
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" And _
                            objImport.Sheets("Control").Cells(counter + 28, 13) = True Then
                        Sheet2.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 172 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Repricing
    Sheet5.Select
    x = 371
    z = marker
    aa = 2
    counter = 1
    Do Until x = 461
        For counter = 1 To 10
            Sheet5.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                Do Until aa = 26
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" Then
                        Sheet5.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 172 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Delete repricing
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet5.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete % Runoff Surge rows
    Sheet13.Select
    Sheet13.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet13.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete $ Runoff Surge rows
    Sheet3.Select
    Sheet3.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet3.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete Decay rows
    Sheet4.Select
    Sheet4.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet4.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete % Runoff rows
    Sheet2.Select
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet2.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    objImport.Sheets("DecayRates").Cells.Replace What:="_cd", Replacement:="_cr", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    objImport.Calculate
    
    Exit Sub
    
ImportFiles_err:
    MsgBox "Error loading file!", vbInformation + vbOKOnly, "Import Error"
    Application.Cursor = xlDefault
    Application.StatusBar = "Ready"
    If y = True Then
        objImport.ActiveWorkbook.Close (False)
    End If
    objImport.Quit
    Set objImport = Nothing
    Exit Sub
       
End Sub

Private Sub ImportAltS()
    Dim x As Integer
    Dim z As Integer
    Dim aa As Integer
    Dim counter As Integer
    Dim marker As Integer
    Dim ab As Integer
    
    On Error GoTo ImportFiles2_err
    
    Sheet7.Visible = xlSheetVisible
    Sheet8.Visible = xlSheetVisible
    Sheet9.Visible = xlSheetVisible
    Sheet14.Visible = xlSheetVisible
    
    objImport.Range("v_altscenario") = 2
    objImport.Run "ScenarioChange"
    Application.Calculation = xlCalculationManual
    
    '%Runoff inputs
    Sheet8.Select
    x = 3
    z = 2
    aa = 2
    counter = 1
    Do Until x = 93
        For counter = 1 To 10
            If objImport.Sheets("Control").Cells(counter + 17, 13) = True Then Sheet8.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa) Else Sheet8.Cells(z, aa - 1) = 0
                If Left(Sheet8.Cells(z, aa - 1), 1) = "0" And z < 22 And _
                        Left(Sheet8.Cells(z - 1, aa - 1), 1) <> "0" Then
                    marker = z
                End If
                If counter = 10 And marker = 0 Then
                    marker = z + 1
                End If
                Do Until aa = 22
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" And _
                            objImport.Sheets("Control").Cells(counter + 17, 13) = True Then
                        Sheet8.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 162 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Change formula references to CD PV worksheets
    objImport.Sheets("DecayRates").Cells.Replace What:="_cr", Replacement:="_cd", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    objImport.Calculate
        
    '%Runoff inputs
    Sheet8.Select
    x = 3
    z = marker
    aa = 2
    counter = 1
    Do Until x = 93
        For counter = 1 To 10
            If objImport.Sheets("Control").Cells(counter + 28, 13) = True Then Sheet8.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa) Else Sheet8.Cells(z, aa - 1) = 0
                Do Until aa = 22
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" And _
                            objImport.Sheets("Control").Cells(counter + 28, 13) = True Then
                        Sheet8.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 172 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Delete Alt-S % Runoff Surge rows
    Sheet14.Select
    Sheet14.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet14.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete Alt-S $ Runoff Surge rows
    Sheet9.Select
    Sheet9.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet9.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete Alt-S Decay rows
    Sheet7.Select
    Sheet7.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet7.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete Alt-S % Runoff rows
    Sheet8.Select
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet8.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
        
    objImport.Sheets("DecayRates").Cells.Replace What:="_cd", Replacement:="_cr", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    objImport.Calculate
    
    Exit Sub
    
ImportFiles2_err:
    MsgBox "Error loading file!", vbInformation + vbOKOnly, "Import Error"
    Application.Cursor = xlDefault
    Application.StatusBar = "Ready"
    If y = True Then
        objImport.ActiveWorkbook.Close (False)
    End If
    objImport.Quit
    Set objImport = Nothing
    Exit Sub
       
End Sub

Private Sub ImportAltR()
    Dim x As Integer
    Dim z As Integer
    Dim aa As Integer
    Dim counter As Integer
    Dim marker As Integer
    Dim ab As Integer
    
    On Error GoTo ImportFiles3_err
    
    Sheet10.Visible = xlSheetVisible
    Sheet11.Visible = xlSheetVisible
    Sheet1.Visible = xlSheetVisible
    Sheet12.Visible = xlSheetVisible
    
    objImport.Range("v_altscenario") = 3
    objImport.Run "ScenarioChange"
    Application.Calculation = xlCalculationManual
    
    '%Runoff inputs
    Sheet11.Select
    x = 3
    z = 2
    aa = 2
    counter = 1
    Do Until x = 93
        For counter = 1 To 10
            If objImport.Sheets("Control").Cells(counter + 17, 13) = True Then Sheet11.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa) Else Sheet11.Cells(z, aa - 1) = 0
                If Left(Sheet11.Cells(z, aa - 1), 1) = "0" And z < 22 And _
                        Left(Sheet11.Cells(z - 1, aa - 1), 1) <> "0" Then
                    marker = z
                End If
                If counter = 10 And marker = 0 Then
                    marker = z + 1
                End If
                Do Until aa = 22
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" And _
                            objImport.Sheets("Control").Cells(counter + 17, 13) = True Then
                        Sheet11.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 162 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Change formula references to CD PV worksheets
    objImport.Sheets("DecayRates").Cells.Replace What:="_cr", Replacement:="_cd", LookAt:=xlPart, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    objImport.Calculate
        
    '%Runoff inputs
    Sheet11.Select
    x = 3
    z = marker
    aa = 2
    counter = 1
    Do Until x = 93
        For counter = 1 To 10
            If objImport.Sheets("Control").Cells(counter + 28, 13) = True Then Sheet11.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa) Else Sheet11.Cells(z, aa - 1) = 0
                Do Until aa = 22
                    aa = aa + 1
                    If objImport.Sheets("DecayRates").Cells(x, aa) <> "" And _
                            objImport.Sheets("Control").Cells(counter + 28, 13) = True Then
                        Sheet11.Cells(z, aa - 1) = objImport.Sheets("DecayRates").Cells(x, aa)
                    End If
                Loop
                aa = 2
                x = x + 1
                z = z + 1
                If counter = 10 And z < 172 Then
                    z = z + 10
                    counter = 0
                End If
        Next counter
    Loop
    
    'Delete Alt-R % Runoff Surge rows
    Sheet12.Select
    Sheet12.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet12.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete Alt-R $ Runoff Surge rows
    Sheet1.Select
    Sheet1.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet1.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete Alt-R Decay rows
    Sheet10.Select
    Sheet10.Calculate
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet10.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    'Delete Alt-R % Runoff rows
    Sheet11.Select
    Range("a2").Select
    For ab = 2 To 181
        If Selection.Value = "" Or Left(Selection.Value, 3) = "0 (" Or Left(Selection.Value, 1) = " " _
                Or Selection.Offset(0, 1) = "" Or Selection.Value = 0 Then
            Selection.EntireRow.Delete
        Else
            Selection.Offset(1, 0).Select
        End If
    Next
    Sheet11.Cells.Columns.AutoFit
    Range("B2").Select
    Range("A1").Select
    
    Exit Sub
    
ImportFiles3_err:
    MsgBox "Error loading file!", vbInformation + vbOKOnly, "Import Error"
    Application.Cursor = xlDefault
    Application.StatusBar = "Ready"
    If y = True Then
        objImport.ActiveWorkbook.Close (False)
    End If
    objImport.Quit
    Set objImport = Nothing
    Exit Sub
       
End Sub

Private Sub SaveFile()
    Dim rge As Range
    
    On Error GoTo SaveFile_err
    Dim sFilename As String
    
    'Paste values from EQ
    Sheet15.Select
    Range("summ_balances").Select
    For Each rge In objImport.Range("control_balance")
        If rge <> 0 Then
            Selection = rge
            Selection.Offset(0, 1) = rge.Offset(0, 17)
            Selection.Offset(24, 1) = rge.Offset(0, 18)
            Selection.Offset(48, 1) = rge.Offset(0, 19)
            Selection.Offset(1, 0).Select
        End If
    Next rge
    
    'Format worksheets
    Sheet6.Select
    Application.Calculation = xlCalculationAutomatic
    ActiveSheet.Shapes("Button 1").Visible = False
    Range("Instructions").Clear
    Application.Cursor = xlDefault
    Application.StatusBar = "Ready"
    Range("a1").Select
    Range("Home").Select
    
    'Close EQ object
    objImport.ActiveWorkbook.Close (False)
    objImport.Quit
    Set objImport = Nothing
    y = False
    
    sFilename = Application.GetSaveAsFilename(Range("Institution") & " MPS Decay Rates " & _
        Format(Right(Range("Underlying"), Len(Range("Underlying")) - InStr(Range("Underlying"), ":")), "mmddyy"), _
        "Excel Files (*.xlsm), *.xlsm")
    
    If sFilename = "" Or sFilename = "False" Or sFilename = Empty Then
        Exit Sub
    Else
        ActiveWorkbook.SaveAs sFilename, FileFormat:=xlOpenXMLWorkbookMacroEnabled
    End If
    
    Exit Sub
    
SaveFile_err:
    MsgBox "File was not saved or action was cancelled" & vbCr & _
        vbCr & "If the file you are trying to save is already open," & vbCr & _
        "please close the file before saving", vbOKOnly, "Status"
        ActiveWorkbook.Close (False)
        
End Sub
Attribute VB_Name = "modUtilities"
Option Explicit

Sub RunOffPercentages()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo RunOffPercentages_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet2.Select
    Range("PercRunoff").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "StandardRunoff(%)_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Standard Runoff(%)_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
RunOffPercentages_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub RunOffPercentagesAltS()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo RunOffPercentages2_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet8.Select
    Range("PercRunoffAltS").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "Alt-SRunoff(%)_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Alt-S Runoff(%)_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
RunOffPercentages2_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub RunOffPercentagesAltR()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo RunOffPercentages3_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet11.Select
    Range("PercRunoffAltR").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "Alt-RRunoff(%)_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Alt-R Runoff(%)_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
RunOffPercentages3_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub RunOffDollars()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo RunOffDollars_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet2.Select
    Range("DollarRunoff").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "StandardRunoff($)_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Standard Runoff($)_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
RunOffDollars_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub RunOffDollarsAltS()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo RunOffDollars2_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet9.Select
    Range("DollarRunoffAltS").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "Alt-SRunoff($)_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Alt-S Runoff($)_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
RunOffDollars2_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub RunOffDollarsAltR()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo RunOffDollars3_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet1.Select
    Range("DollarRunoffAltR").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "Alt-RRunoff($)_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Alt-R Runoff($)_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
RunOffDollars3_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub DecayRates()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo FarinDecay_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet2.Select
    Range("FarinDecay").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "StandardDecay_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Standard Decay_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
FarinDecay_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub DecayRatesAltS()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo FarinDecay2_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet7.Select
    Range("FarinDecayAltS").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "Alt-SDecay_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Alt-S Decay_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
FarinDecay2_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

Sub DecayRatesAltR()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo FarinDecay3_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet10.Select
    Range("FarinDecayAltR").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "Alt-RDecay_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Alt-R Decay_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
FarinDecay3_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub
Sub Repricing()

    Dim FromName As String
    Dim FromPath As String
    
    On Error GoTo Repricing_err
    
    Application.ScreenUpdating = False
    
    FromName = ActiveWorkbook.Name
    FromPath = ActiveWorkbook.Path

    Sheet5.Select
    Range("Repricing").Copy
    Workbooks.Add
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveWorkbook.SaveAs Filename:= _
        FromPath & "\" & "Repricing_" & _
        Format(Now(), "yyyymmdd"), _
        FileFormat:=xlCSV, CreateBackup:=False
    ActiveWorkbook.Close (False)
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select

    Application.ScreenUpdating = True
    
    MsgBox "A comma-delimited file named" & vbCr & _
        "Repricing_" & Format(Now(), "yyyymmdd") & vbCr & _
        "was saved and stored in the same" & vbCr & _
        "directory as this file.", vbInformation + vbOKOnly, _
        "Comma-delimited File"
        
    Exit Sub
    
Repricing_err:
    Application.ScreenUpdating = True
    MsgBox "Error creating file, please save the main file (" & FromName & ")" & vbCr & _
        "to a local drive before trying to create a comma delimited text file." & vbCr & vbCr & _
        "Once this file is saved to a local directory, please click the desired" & vbCr & _
        "button again.", _
        vbInformation + vbOKOnly, "Cancel"
    Windows(FromName).Activate
    Sheet6.Select
    Range("Home").Select
    Application.CutCopyMode = False

End Sub

'Sub Clear()
'    Range("FarinDecay").ClearContents
'    Range("PercRunoff").ClearContents
'    Range("DollarRunoff").ClearContents
'    Range("Institution") = "INSTITUTION"
'    Range("Prepared") = "Prepared date:"
'    Range("Underlying") = "Underlying data as of:"
'    sheet6.Select
'    Range("Home").Select
'    ActiveSheet.Shapes("Button 5").Visible = True
'End Sub


INQUEST-PP=macro
