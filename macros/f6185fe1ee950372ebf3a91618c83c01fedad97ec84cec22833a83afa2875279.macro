Attribute VB_Name = "Code"
'###############################################
'# Version        :Excel Lagerverwaltung 1.44  #
'# Entwicklung                                 #
'# und Design     :Marcel Kusche               #
'# Stand          :Juli 2019                   #
'# Sprache        :German                      #
'# Das Ver|fffd|ffentlichen oder Ver|fffd|ndern des      #
'# Quellcodes ist untersagt und bedarf         #
'# meines Einverst|fffd|ndnisses!                   #
'###############################################
Option Explicit

Sub Button_Update(control As IRibbonControl)
    On Error Resume Next
    Application.StatusBar = "Es wird nach einem Update gepr|fffd|ft - einen Moment Geduld bitte."
    With Application
        .ScreenUpdating = False
        .EnableEvents = False
        .Calculation = xlCalculationManual
    End With
    Sheets("Daten").Activate
    ActiveSheet.Columns("O:O").Delete
    With ActiveSheet.QueryTables.Add(Connection:= _
        "URL;https://blickwinkel178.blogspot.de/p/versionsnummer.html", Destination:=Range( _
        "$O$1"))
        .Name = "forum_1"
        .FieldNames = True
        .RowNumbers = False
        .FillAdjacentFormulas = False
        .PreserveFormatting = True
        .RefreshOnFileOpen = False
        .BackgroundQuery = True
        .RefreshStyle = xlInsertDeleteCells
        .SavePassword = False
        .SaveData = True
        .AdjustColumnWidth = True
        .RefreshPeriod = 0
        .WebSelectionType = xlSpecifiedTables
        .WebFormatting = xlWebFormattingNone
        .WebTables = "1"
        .WebPreFormattedTextToColumns = True
        .WebConsecutiveDelimitersAsOne = True
        .WebSingleBlockTextImport = False
        .WebDisableDateRecognition = False
        .WebDisableRedirections = False
        .Refresh BackgroundQuery:=False
    End With
    Sheets("Center").Activate
    If CDbl(Sheets("Daten").Range("B8").Value) < CDbl(Sheets("Daten").Range("O2").Value) Then
        MsgBox "Eine neue Version ist Verf|fffd|gbar! Version (" + Sheets("Daten").Range("O1").Value + ")" & vbLf & vbLf & "Ihre Version: " & Sheets("Daten").Range("B8").Value, , "Neue Version!"
    ElseIf CDbl(Sheets("Daten").Range("B8").Value) > CDbl(Sheets("Daten").Range("O2").Value) Then
        MsgBox "Sie nutzen eine Betaversion!", , "Hinweis"
        Exit Sub
    Else
        If Sheets("Daten").Range("B45").Value = Sheets("Daten").Range("O1").Value Then
            MsgBox "Gl|fffd|ckwunsch, ihre Version ist auf dem neuesten Stand!", , "Kein Update Verf|fffd|gbar!"
        Else
            MsgBox "Eine Update ist Verf|fffd|gbar! Version: (" + Sheets("Daten").Range("O1").Value + ")" & vbLf & vbLf & "Ihre Version: " & Sheets("Daten").Range("B45").Value, , "Update"
        End If
    End If
    With Application
        .ScreenUpdating = True
        .EnableEvents = True
        .Calculation = xlCalculationAutomatic
    End With
    Application.StatusBar = False
End Sub

Sub Button_Settings(control As IRibbonControl)
    access.Setings
End Sub

Sub Button_Exit(control As IRibbonControl)
    Call LagerExit
End Sub

Sub Button_AN(control As IRibbonControl)
    frmInfoAuf.Angebot
    frmInfoAuf.Caption = "Alle aktiven Angebote!"
    frmInfoAuf.Show
    frmKasse.Show
End Sub

Sub Button_JR1(control As IRibbonControl)
    frmBericht.Show
    frmBericht.MultiPage1.Value = 4
End Sub

Sub Button_JR4(control As IRibbonControl)
    frmBericht.Show
    frmBericht.MultiPage1.Value = 5
End Sub

Sub Button_JR2(control As IRibbonControl)
    frmBericht.Show
    frmBericht.MultiPage1.Value = 7
End Sub

Sub Button_JR3(control As IRibbonControl)
    frmBericht.Show
    frmBericht.MultiPage1.Value = 0
End Sub

Sub Button_Lieferanten(control As IRibbonControl)
    frmLieferanten.Show
End Sub

Sub Button_WE(control As IRibbonControl)
    Dim lngMsg As Long
    lngMsg = MsgBox("Liegt eine Bestellung vor?", vbYesNo + vbQuestion, "Wareneingang")
    If lngMsg = vbYes Then
        frmEingang.Show
    Else
        frmWareneingangoB.Show
    End If
End Sub
Sub Login_Admin(control As IRibbonControl)
    If ThisWorkbook.Sheets("Daten").Range("B7").Value = "Admin" Then
        MsgBox "Sie sind bereits angemeldet!", , "Hinweis"
        Exit Sub
    Else
        frmPW.Show
    End If
End Sub

Sub Button_Kunden(control As IRibbonControl)
    frmKunden.Show
End Sub

Sub Button_LG(control As IRibbonControl)
    Call Lager
End Sub
Sub Button_Version(control As IRibbonControl)
    frmInfo.Show
End Sub

Sub Button_Auftrag(control As IRibbonControl)
    frmInfoAuf.Auftrag
    frmInfoAuf.Show
    frmKasse.Show
End Sub

Sub Button_Backup(control As IRibbonControl)
    Dim Datei, Phad As String
    On Error Resume Next
    
    Application.ScreenUpdating = False
    Datei = ThisWorkbook.Name
    Phad = ThisWorkbook.Path
    Kill Phad & "\" & Format(Now, "MM-DD-YY") & "_" & Format(Time, "HHMMSS") & "Backup.XLSM"
    ActiveWorkbook.SaveCopyAs Filename:=Phad & "\" & Format(Now, "MM-DD-YY") & "_" & Format(Time, "HHMMSS") & "Backup.XLSM"
    Sheets("Daten").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = Format(Date, "DD.MM.YYYY")
    ActiveCell.Offset(0, 1).Value = "Ein Backup wurde erfolgreich erstellt!"
    ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
    Sheets("Center").Activate
    MsgBox "Backup wurde erstellt!", vbOKOnly, "Backup"
    Application.ScreenUpdating = True
End Sub

Function xFind(xWorkbook, xSheet, xSearch, xRange)
    On Error GoTo ErrorHandler
    xFind = Workbooks(xWorkbook).Sheets(xSheet).Range(xRange).Find(what:=xSearch).Row
    Exit Function
ErrorHandler:
    xFind = False
End Function

Function Open_URL(xLink)
    Dim WshShell As Object
    On Error Resume Next
    Set WshShell = CreateObject("WScript.Shell")
    WshShell.Run xLink
    Set WshShell = Nothing
End Function

Sub UpdateCheck()
    On Error Resume Next
    MsgBox "Es wird nach einem Update gepr|fffd|ft . . .", vbOKOnly, "Excel Lagerverwaltung"
    Application.StatusBar = "Es wird nach einem Update gepr|fffd|ft - einen Moment Geduld bitte."
    With Application
        .ScreenUpdating = False
        .EnableEvents = False
        .Calculation = xlCalculationManual
    End With
    Sheets("Daten").Activate
    ActiveSheet.Columns("O:O").Delete
    With ActiveSheet.QueryTables.Add(Connection:= _
        "URL;https://blickwinkel178.blogspot.de/p/versionsnummer.html", Destination:=Range( _
        "$O$1"))
        .Name = "forum_1"
        .FieldNames = True
        .RowNumbers = False
        .FillAdjacentFormulas = False
        .PreserveFormatting = True
        .RefreshOnFileOpen = False
        .BackgroundQuery = True
        .RefreshStyle = xlInsertDeleteCells
        .SavePassword = False
        .SaveData = True
        .AdjustColumnWidth = True
        .RefreshPeriod = 0
        .WebSelectionType = xlSpecifiedTables
        .WebFormatting = xlWebFormattingNone
        .WebTables = "1"
        .WebPreFormattedTextToColumns = True
        .WebConsecutiveDelimitersAsOne = True
        .WebSingleBlockTextImport = False
        .WebDisableDateRecognition = False
        .WebDisableRedirections = False
        .Refresh BackgroundQuery:=False
    End With
    Sheets("Center").Activate
    If CDbl(Sheets("Daten").Range("B8").Value) < CDbl(Sheets("Daten").Range("O2").Value) Then
        MsgBox "Eine neue Version ist Verf|fffd|gbar! Version (" + Sheets("Daten").Range("O1").Value + ")" & vbLf & vbLf & "Ihre Version: " & Sheets("Daten").Range("B8").Value, , "Neue Version!"
    ElseIf CDbl(Sheets("Daten").Range("B8").Value) > CDbl(Sheets("Daten").Range("O2").Value) Then
        MsgBox "Sie nutzen eine Betaversion!", , "Hinweis"
        GoTo weiter
    Else
        If Sheets("Daten").Range("B45").Value = Sheets("Daten").Range("O1").Value Then
            GoTo weiter
        Else
            MsgBox "Eine Update ist Verf|fffd|gbar! Version: (" + Sheets("Daten").Range("O1").Value + ")" & vbLf & vbLf & "Ihre Version: " & Sheets("Daten").Range("B45").Value, , "Update"
        End If
    End If
weiter:
    If Sheets("Daten").Range("B46").Value = "T" Then
        Sheets("Daten").Range("B47").Value = Format(Date, "DD.MM.YYYY")
    ElseIf Sheets("Daten").Range("B46").Value = "M" Then
        Sheets("Daten").Range("B47").Value = Format(Date + 30, "DD.MM.YYYY")
    ElseIf Sheets("Daten").Range("B46").Value = "W" Then
        Sheets("Daten").Range("B47").Value = Format(Date + 7, "DD.MM.YYYY")
    Else
        Sheets("Daten").Range("B47").Value = ""
    End If
    With Application
        .ScreenUpdating = True
        .EnableEvents = True
        .Calculation = xlCalculationAutomatic
    End With
    Application.StatusBar = False
End Sub

Sub Hochkomma_setzen()
    Dim Zelle   As Range
    Dim Bereich As Range
    With Sheets("Lager")
        Set Bereich = .Range("C1:D" & .Cells(Rows.Count, 1).End(xlUp).Row)
            For Each Zelle In Bereich
            Zelle.Value = "'" & Zelle.Value
        Next
    End With
    With Sheets("Lager")
        Set Bereich = .Range("A1:A" & .Cells(Rows.Count, 1).End(xlUp).Row)
            For Each Zelle In Bereich
            Zelle.Value = "'" & Zelle.Value
        Next
    End With
    Set Bereich = Nothing
End Sub

Sub Lager()
    ThisWorkbook.Activate
    If Sheets("Daten").Range("B5").Value = "True" Then
        If ThisWorkbook.Sheets("Daten").Range("B7").Value = "Admin" Then
            frmLager.Show
        Else
            If Not ThisWorkbook.Sheets("Daten").Range("B24").Value = "" Then
                frmLager.Show
            Else
                If Application.Version Like "16*" Then
                    If Sheets("Daten").Range("B21").Value = "Gast" Then
                        frmAnmelden.Height = 256
                        frmAnmelden.cmd_GastAN.Visible = True
                    Else
                        frmAnmelden.Height = 233
                        frmAnmelden.cmd_GastAN.Visible = False
                    End If
                Else
                    If Sheets("Daten").Range("B21").Value = "Gast" Then
                        frmAnmelden.Height = 249
                        frmAnmelden.cmd_GastAN.Visible = True
                    Else
                        frmAnmelden.Height = 226
                        frmAnmelden.cmd_GastAN.Visible = False
                    End If
                End If
                frmAnmelden.Show
            End If
        End If
    Else
        frmLager.Show
    End If
    frmLager.txt_Admin.Value = AdminN
    frmLager.txt_item.SetFocus
End Sub

Private Sub Settings() '1.33
    Call access.Setings
End Sub

Sub Help()
    frmHelp.Show
End Sub

Sub LagerExit()
    Dim Ename   As String
    Dim Eanzahl As Integer
    On Error Resume Next
    Eanzahl = Workbooks.Count
    ThisWorkbook.Sheets("Daten").Range("B1").Value = ActiveWorkbook.Name
    Ename = Sheets("Daten").Range("B1")
    If Eanzahl > 1 Then
        Workbooks(Ename).Close savechanges:=True
    Else
        Application.DisplayAlerts = False
        Application.EnableEvents = False
        ActiveWorkbook.Save
        Application.Quit
    End If
End Sub

Private Sub Pass()
    If ThisWorkbook.Sheets("Daten").Range("B7").Value = "Admin" Then
        MsgBox "Sie sind bereits angemeldet!", , "Hinweis"
        Exit Sub
    Else
        frmPW.Show
    End If
End Sub

Function SystemFontExists(sFontFileName As String) As Boolean
    Dim SystemFont As New StdFont
    SystemFont.Name = sFontFileName
    SystemFontExists = IIf(sFontFileName = SystemFont.Name, True, False)
End Function

Sub AnsichtLager()
    With Worksheets("Ansicht_Lager")
        If .FilterMode Then .ShowAllData
    End With
    Worksheets("Lager").UsedRange.COPY Destination:=Worksheets("Ansicht_Lager").Range(Worksheets("Lager").UsedRange.Address)
End Sub

Function IDS()
    Dim lngID, lngA, wert, n, lngx, zeile As Long
    Dim oDic As Object, ArrayData()
    Dim strZ As String
    On Error Resume Next
    wert = 0
    Application.ScreenUpdating = False
    lngID = WorksheetFunction.CountA(Sheets("Lager").Range("A:A")) - 1
    lngA = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1
    If lngID = lngA Then
        Sheets("Daten").Range("B34").Value = "Status ok!"
    Else
        Sheets("Daten").Range("B34").Value = ""
        Sheets("Daten").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = Date
        ActiveCell.Offset(0, 1).Value = "#IDs FEHLEN/UNVOLLSTAENDIG!# Bitte pr|fffd|fen!"
        ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
        wert = 1
        Sheets("Center").Activate
    End If
    If Not wert = 1 Then
        Set oDic = CreateObject("Scripting.Dictionary")
        Sheets("Lager").Activate
        lngx = 0
        With ThisWorkbook.Sheets("Lager") 'Tabelle anpassen
            zeile = .Cells(Rows.Count, 1).End(xlUp).Row
            strZ = "A" & zeile
            ArrayData = .Range("A2:" & strZ).Value2 'Zellbereich anpassen
            ReDim ArrayAusgabe(1 To UBound(ArrayData), 1 To 1)
            For n = 1 To UBound(ArrayData)
                If Not ArrayData(n, 1) = "" Then
                    oDic(ArrayData(n, 1)) = oDic(ArrayData(n, 1)) + 1
                End If
            Next n
            For n = 1 To UBound(ArrayData)
                If oDic(ArrayData(n, 1)) > 1 Then
                    lngx = lngx + 1
                End If
            Next n
        End With
        If lngx > 1 Then
            Sheets("Daten").Range("B34").Value = "#Fehler ID!"
        Else
            Sheets("Daten").Range("B34").Value = "Status ok!"
        End If
    End If
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Function

Function Neu()
    If Sheets("Daten").Range("B33").Value = "" Then
        frmArtikel.lbl_LArtikelNr.Caption = ""
    Else
        frmArtikel.lbl_LArtikelNr.Caption = "Letzte Artikel Nr.: " & Sheets("Daten").Range("B33").Value
    End If
    frmArtikel.Psuche.Visible = False
    frmArtikel.Frame_Normal.Top = 4
    frmArtikel.txt_Bestand.Value = "0"
    frmArtikel.Psuche.Visible = False
    frmArtikel.cmdaendern.Visible = False
    frmArtikel.txt_Bestand.Enabled = False
    frmArtikel.cmdNArtikel.Visible = False
    frmArtikel.Show
End Function

Sub DatenAll2()
    Dim i, intZ As Long
    Dim oDict As Object
    On Error Resume Next
    Application.ScreenUpdating = False
    Sheets("Daten").Activate
    Range("Daten!H2:M50000").Clear
    
    Set oDict = CreateObject("scripting.dictionary") 'Warengruppe
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 16).End(xlUp).Row
            If Len(Trim(.Cells(i, 16))) Then oDict(.Cells(i, 16).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 8).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Kategorie
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 41).End(xlUp).Row
            If Len(Trim(.Cells(i, 41))) Then oDict(.Cells(i, 41).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 9).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Hersteller
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 7).End(xlUp).Row
            If Len(Trim(.Cells(i, 7))) Then oDict(.Cells(i, 7).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 10).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Einheit
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 12).End(xlUp).Row
            If Len(Trim(.Cells(i, 12))) Then oDict(.Cells(i, 12).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 11).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Lagerorte
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 13).End(xlUp).Row
            If Len(Trim(.Cells(i, 13))) Then oDict(.Cells(i, 13).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 12).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    If Sheets("Daten").Range("D20").Value = "" Then
        If Not Sheets("Daten").Range("D20").Value = Format(Date, "YYYY") Then
            Set oDict = CreateObject("scripting.dictionary")
            intZ = 2
            With Worksheets("Warenausgang")
                For i = 7 To .Cells(Rows.Count, 13).End(xlUp).Row
                    If Len(Trim(.Cells(i, 12))) Then oDict(.Cells(i, 12).Text) = ""
                Next i
            End With
            Worksheets("Daten").Cells(intZ, 13).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
            Set oDict = Nothing
        End If
    End If
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call sortieren
End Sub

Sub DatenAll()
    Dim i, intZ As Long
    Dim oDict As Object
    On Error Resume Next
    Application.ScreenUpdating = False
    Sheets("Daten").Activate
    Range("Daten!H2:M50000").Clear
    
    Set oDict = CreateObject("scripting.dictionary") 'Warengruppe
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 16).End(xlUp).Row
            If Len(Trim(.Cells(i, 16))) Then oDict(.Cells(i, 16).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 8).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Kategorie
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 41).End(xlUp).Row
            If Len(Trim(.Cells(i, 41))) Then oDict(.Cells(i, 41).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 9).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Hersteller
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 7).End(xlUp).Row
            If Len(Trim(.Cells(i, 7))) Then oDict(.Cells(i, 7).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 10).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Einheit
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 12).End(xlUp).Row
            If Len(Trim(.Cells(i, 12))) Then oDict(.Cells(i, 12).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 11).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Lagerorte
    intZ = 2
    With Worksheets("Lager")
        For i = 2 To .Cells(Rows.Count, 13).End(xlUp).Row
            If Len(Trim(.Cells(i, 13))) Then oDict(.Cells(i, 13).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 12).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    Set oDict = CreateObject("scripting.dictionary") 'Jahr
    intZ = 2
    With Worksheets("Warenausgang")
        For i = 7 To .Cells(Rows.Count, 12).End(xlUp).Row
            If Len(Trim(.Cells(i, 12))) Then oDict(.Cells(i, 12).Text) = ""
        Next i
    End With
    Worksheets("Daten").Cells(intZ, 13).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
    Set oDict = Nothing
    If Sheets("Daten").Range("D20").Value = "" Then
        If Not Sheets("Daten").Range("D20").Value = Format(Date, "YYYY") Then
            Set oDict = CreateObject("scripting.dictionary")
            intZ = 2
            With Worksheets("Warenausgang")
                For i = 7 To .Cells(Rows.Count, 13).End(xlUp).Row
                    If Len(Trim(.Cells(i, 12))) Then oDict(.Cells(i, 12).Text) = ""
                Next i
            End With
            Worksheets("Daten").Cells(intZ, 13).Resize(oDict.Count, 1) = Application.Transpose(oDict.keys)
            Set oDict = Nothing
        End If
    End If
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call sortieren
End Sub

Sub sortieren()
    On Error Resume Next
    With Worksheets("Daten")
        .Columns("H:H").Sort Key1:=.Range("H1"), Order1:=xlAscending, Header:=xlGuess, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
        .Columns("I:I").Sort Key1:=.Range("I1"), Order1:=xlAscending, Header:=xlGuess, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
        .Columns("J:J").Sort Key1:=.Range("J1"), Order1:=xlAscending, Header:=xlGuess, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
        .Columns("K:K").Sort Key1:=.Range("K1"), Order1:=xlAscending, Header:=xlGuess, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
        .Columns("L:L").Sort Key1:=.Range("L1"), Order1:=xlAscending, Header:=xlGuess, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    End With
End Sub
Attribute VB_Name = "Daten"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "DieseArbeitsmappe"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
'###############################################
'# Version        :Excel Lagerverwaltung 1.44  #
'# Entwicklung                                 #
'# und Design     :Marcel Kusche               #
'# Stand          :Juli 2019                   #
'# Sprache        :German                      #
'# Das Ver|fffd|ffentlichen oder Ver|fffd|ndern des      #
'# Quellcodes ist untersagt und bedarf         #
'# meines Einverst|fffd|ndnisses!                   #
'###############################################
Option Explicit
Private Sub Workbook_Open()
    On Error Resume Next
    Application.ScreenUpdating = False
    ThisWorkbook.Sheets("Daten").Range("B22").Value = ""
    Call VBASchutz
    If Sheets("Daten").Range("B46").Value = "Nein" Then
        GoTo weiter
    ElseIf Sheets("Daten").Range("B46").Value = "T" And CDate(Sheets("Daten").Range("B47").Value) < CDate(Date) Then
        Call UpdateCheck
    ElseIf Sheets("Daten").Range("B46").Value = "W" And CDate(Sheets("Daten").Range("B47").Value) < CDate(Date) Then
        Call UpdateCheck
    ElseIf Sheets("Daten").Range("B46").Value = "M" And CDate(Sheets("Daten").Range("B47").Value) < CDate(Date) Then
        Call UpdateCheck
    Else
        GoTo weiter
    End If
weiter:
    If Sheets("Daten").Range("D19").Value = "Ja" Then
        Call DatenAll
    End If
    Sheets("Center").Unprotect
    Sheets("Center").ScrollArea = "A2:T45"
    ThisWorkbook.Sheets("Daten").Range("B1").Value = ActiveWorkbook.Name
    ThisWorkbook.Sheets("Center").Range("I5").Value = Format(Date, "DDDD, DD.MM.YYYY")
    ThisWorkbook.Sheets("Daten").Range("B7").Value = ""
    ThisWorkbook.Sheets("Daten").Range("B24").Value = ""
    ThisWorkbook.Sheets("Center").Range("L15").Value = ThisWorkbook.Sheets("Daten").Range("B2").Value
    ThisWorkbook.Sheets("Center").Range("L16").Value = ThisWorkbook.Sheets("Daten").Range("B3").Value
    Worksheets("Center").Range("D12").Value = Sheets("Daten").Range("B9").Text
    Worksheets("Center").Range("D13").Value = Sheets("Daten").Range("B10").Text
    Worksheets("Center").Range("D14").Value = Sheets("Daten").Range("B11").Text
    Worksheets("Center").Range("D15").Value = Sheets("Daten").Range("B12").Text
    Worksheets("Center").Range("D16").Value = Sheets("Daten").Range("B13").Text
    Worksheets("Center").Range("D17").Value = Sheets("Daten").Range("B14").Text
    Worksheets("Center").Range("D18").Value = Sheets("Daten").Range("B15").Text
    Worksheets("Center").Range("D19").Value = Sheets("Daten").Range("B16").Text
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    ThisWorkbook.Sheets("Daten").Visible = xlVeryHidden
    Sheets("Center").Protect
    If Sheets("Daten").Range("B17").Value = "Import" Then
        frmLaden.Label1.Caption = "Bitte warten Sie, Daten werden |fffd|bernommen!"
        frmLaden.Show
        DoEvents
        ThisWorkbook.Sheets("Lager").Range("A:AO").NumberFormat = "@"
        ThisWorkbook.Sheets("Lager").Range("Q:Q").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Lager").Range("AN:AO").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Lager").Range("W:W").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Lager").Range("B:B").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Lager").Range("J:K").NumberFormat = "0.00"
        ThisWorkbook.Sheets("Lager").Range("H:H").NumberFormat = "0.00"
        ThisWorkbook.Sheets("Lager").Range("N:0").NumberFormat = "0.00"
        ThisWorkbook.Sheets("Lager").Range("Y:Y").NumberFormat = "0.00"
        ThisWorkbook.Sheets("Lager").Range("AA:AB").NumberFormat = ""
        ThisWorkbook.Sheets("Lager").Range("X:X").NumberFormat = "[$-F400]h:mm:ss AM/PM"
        ThisWorkbook.Sheets("Mitarbeiter").Range("A:J").NumberFormat = "@"
        ThisWorkbook.Sheets("Kostenstellen").Range("A:B").NumberFormat = "@"
        ThisWorkbook.Sheets("Lagerorte").Range("A:D").NumberFormat = "@"
        ThisWorkbook.Sheets("Barcode").Range("A:J").NumberFormat = "@"
        ThisWorkbook.Sheets("Gruppen").Range("A:J").NumberFormat = "@"
        ThisWorkbook.Sheets("Warenausgang").Range("A:W").NumberFormat = "@"
        ThisWorkbook.Sheets("Warenausgang").Range("I:I").NumberFormat = "[$-F400]h:mm:ss AM/PM"
        ThisWorkbook.Sheets("Warenausgang").Range("A1").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Warenausgang").Range("H:H").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Warenausgang").Range("L:L").NumberFormat = "0"
        ThisWorkbook.Sheets("Wareneingang").Range("Q:Q").NumberFormat = "0"
        ThisWorkbook.Sheets("Wareneingang").Range("A:R").NumberFormat = "@"
        ThisWorkbook.Sheets("Warenausgang").Range("M:M").NumberFormat = "0.00"
        ThisWorkbook.Sheets("Warenausgang").Range("G:G").NumberFormat = "0.00"
        ThisWorkbook.Sheets("Wareneingang").Range("P:P").NumberFormat = "0.00"
        ThisWorkbook.Sheets("Wareneingang").Range("G:H").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Leistungen").Range("A:I").NumberFormat = "@"
        ThisWorkbook.Sheets("Bestellung").Range("A:N").NumberFormat = "@"
        ThisWorkbook.Sheets("Bestellung").Range("H:H").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Bestellung").Range("K:K").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Daten").Range("A:L").NumberFormat = "@"
        ThisWorkbook.Sheets("Daten").Range("A50:A500").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Daten").Range("C50:C500").NumberFormat = "[$-F400]h:mm:ss AM/PM"
        ThisWorkbook.Sheets("Kunden").Range("A:AG").NumberFormat = "@"
        ThisWorkbook.Sheets("Wareneingang").Range("H:H").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Wareneingang").Range("I:I").NumberFormat = "[$-F400]h:mm:ss AM/PM"
        ThisWorkbook.Sheets("Kunden").Range("B:B").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Kunden").Range("N:N").NumberFormat = "DD.MM.YYYY"
        ThisWorkbook.Sheets("Druckvorlage").Range("E4").NumberFormat = "DD.MM.YYYY"
        Sheets("Daten").Range("B17").Value = ""
        ThisWorkbook.Sheets("Kassendaten").Range("N1").Value = "Gewicht"
        ThisWorkbook.Sheets("Kassendaten").Range("O1").Value = "frei"
        ThisWorkbook.Sheets("Reservierungen").Range("N1").Value = "Gewicht"
        ThisWorkbook.Sheets("Reservierungen").Range("O1").Value = "'RN Druck"
        ThisWorkbook.Sheets("Reservierungen").Range("P1").Value = "'LS Druck"
        ThisWorkbook.Sheets("Druckvorlage").Range("A1") = Sheets("Daten").Range("B9").Value & " - " & Sheets("Daten").Range("B10").Value & " - " & Sheets("Daten").Range("B11").Value
        ThisWorkbook.Sheets("Daten").Range("B31").Value = "Y"
        ThisWorkbook.Sheets("Daten").Range("E30").Value = "Anlegen / Beleg:"
        Call Hochkomma_setzen
        Call DatenAll
        Call Logo
        ThisWorkbook.Sheets("Daten").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = Date
        ActiveCell.Offset(0, 1).Value = "Datenimport erfolgreich abgeschlossen!"
        ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
        Sheets("Center").Activate
        frmLaden.Label1.Caption = "Datenimport ist abgeschlossen!"
        Call frmLaden.LadenClose
    End If
    If ThisWorkbook.Sheets("Daten").Range("B4").Text = "info" Then
        Application.ScreenUpdating = True
        frmWillkommen.Show
        ThisWorkbook.Sheets("Center").Activate
    Else
        If Sheets("Daten").Range("B5").Value = "True" Then
            Application.ScreenUpdating = True
            frmAnmelden.Show
            Application.ScreenUpdating = True
            Exit Sub
        End If
    End If
    Call IDS
    Application.ScreenUpdating = True
    Sheets("Center").Activate
End Sub

Sub Logo()
    If Not Sheets("Daten").Range("D47").Value = "" Then
        With Sheets("Druckvorlage").PageSetup
            .RightHeaderPicture.Filename = CStr(Sheets("Daten").Range("D47").Value)
            .RightHeader = "&G"
        End With
    End If
End Sub

Private Sub VBASchutz()
    With ActiveWorkbook
        If .ReadOnly Then
            MsgBox "Arbeitsmappe " & .Name & " ist schreibgesch|fffd|tzt und kann nicht gespeichert werden!", , "Hinweis Schreibschutz"
        End If
    End With
End Sub
Attribute VB_Name = "TB_Lager"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle24"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "access"
Option Explicit
Public Name As String
Public AdminN As String
Public ZeitN As Date

Private Sub Admin()
    If Sheets("Daten").Range("B5").Value = "True" Then
        If AdminN = "Admin" Then
            frmSettings.Show
        Else
            MsgBox "Bitte Melden Sie sich als Admin an!", , "Hinweis"
            Exit Sub
        End If
    Else
        frmSettings.Show
    End If
End Sub

Sub Setings()
    If Not Sheets("Daten").Range("B5").Value = "False" Then
        If Sheets("Daten").Range("B7").Value = "Admin" Then
            frmSettings.Show
        Else
            MsgBox "Bitte Melden Sie sich als Admin an!", , "Hinweis"
            Exit Sub
        End If
    Else
        frmSettings.Show
    End If
End Sub

Function mzeit()
    On Error Resume Next
    If Not AdminN = "" Then
        MsgBox Name & vbLf & AdminN & vbLf & "Angemeldet seit: " & Format(ZeitN, "hh:nn") & " Uhr" & " (" & FormatDateTime(Time - ZeitN, vbLongTime) & ")", , "Info / Angemeldet"
    Else
        MsgBox Name & vbLf & frmLager.lbl_Benutzer & vbLf & "Angemeldet seit: " & Format(ZeitN, "hh:nn") & " Uhr" & " (" & FormatDateTime(Time - ZeitN, vbLongTime) & ")", , "Info / Angemeldet"
    End If
End Function
Attribute VB_Name = "calendar"
Option Explicit
Public kLabel() As New clsDate
Public DateNow As Date

Function KWoche(Datum As Date)
    Dim T As Long
    T = DateSerial(Year(Datum + (8 - Weekday(Datum)) Mod 7 - 3), 1, 1)
    KWoche = ((Datum - T - 3 + (Weekday(T) + 1) Mod 7)) \ 7 + 1
End Function

Function KWFirst(KW As Integer, Year As Integer) As Double
    Dim ETag As Double
    If Month(DateNow) = 1 And KW > 51 Then Year = Year - 1
    ETag = DateSerial(Year, 1, 1)
    
    Do Until DatePart("WW", ETag, 2, 2) = 2
        ETag = ETag + 1
    Loop
    KWFirst = DateAdd("WW", KW - 2, ETag)
End Function

Function Kfuellen()
    Dim ListB As control
    Dim LabelCount1, DataCounter, KWz As Integer
    Dim DayCounter As Date

    frmKalender.lbl_MonatJahr.Caption = Format(DateNow, "mmmm yyyy")
    DayCounter = KWFirst(KWoche(DateSerial(Year(DateNow), Month(DateNow), 1)), Year(DateNow))
    KWz = 1
    For DataCounter = 1 To 6
        frmKalender.Controls("lbl_KW" & DataCounter).Caption = KWoche(DateSerial(Year(DateNow), Month(DateNow), KWz))
        KWz = KWz + 7
    Next DataCounter
    For DataCounter = 1 To 37
        With frmKalender.Controls("lbl_Data" & DataCounter)
            .Tag = DayCounter
            .Caption = Format(DayCounter, "DD")
            .ForeColor = IIf(Month(DayCounter) <> Month(DateNow), &HC0C0C0, IIf(Weekday(DayCounter, 2) > 5, &HFF&, &H0&))
            .BackColor = IIf(DayCounter = Date, &HFFFF&, &HFFFFFF)
        End With
        DayCounter = DayCounter + 1
    Next DataCounter
End Function

Sub Start()
    frmKalender.Show
End Sub
Attribute VB_Name = "clsDate"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Public WithEvents lbl_Data As MSForms.Label
Attribute lbl_Data.VB_VarHelpID = -1

Private Sub lbl_Data_Click()
    On Error Resume Next
    If frmKalender.txt_UID.Value = "info" Then Exit Sub
    With frmKalender
        frmKalender.cmd_Datum.Caption = CDate(lbl_Data.Tag)
    End With
End Sub

Private Sub lbl_Data_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    If frmKalender.txt_UID.Value = "info" Then Exit Sub
    With frmKalender
        frmKalender.cmd_Datum.Caption = CDate(lbl_Data.Tag)
    End With
    Call FCalender
    Unload frmKalender
End Sub

Private Sub FCalender()
    If frmKalender.txt_UID.Value = "info" Then Exit Sub
    If frmKalender.txt_UID.Value = "JR_RA" Then Call frmKalender.JRRA
    If frmKalender.txt_UID.Value = "JR_WA" Then Call frmKalender.JRWA
    If frmKalender.txt_UID.Value = "BSTLD" Then Call frmKalender.BSTLD
    If frmKalender.txt_UID.Value = "KDID" Then Call frmKalender.KDSU
    If frmKalender.txt_UID.Value = "AFAE" Then Call frmKalender.AFaellig
    If frmKalender.txt_UID.Value = "WADA" Then Call frmKalender.WADA
    If frmKalender.txt_UID.Value = "VMVO" Then Call frmKalender.VMVO
    If frmKalender.txt_UID.Value = "VMBI" Then Call frmKalender.VMBI
    If frmKalender.txt_UID.Value = "VMEL" Then Call frmKalender.VMEL
    If frmKalender.txt_UID.Value = "VERW" Then Call frmKalender.VERW
End Sub
Attribute VB_Name = "frmAnmelden"
Attribute VB_Base = "0{60B3D5D5-EC72-40D2-BE64-1224828F32F7}{C24A9820-DB9E-46F9-BEBB-1C260ADFE5DA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim i As Long
    Dim sngTop, sngLeft As Single
    Dim FDate As String
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    Application.ScreenUpdating = True
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    lbl_Date.Caption = Format(Date, FDate)
    If Application.Version Like "16*" Then
        If Sheets("Daten").Range("B21").Value = "Gast" Then
            frmAnmelden.Height = 256
            frmAnmelden.cmd_GastAN.Visible = True
        Else
            frmAnmelden.Height = 233
            frmAnmelden.cmd_GastAN.Visible = False
        End If
    Else
        If Sheets("Daten").Range("B21").Value = "Gast" Then
            frmAnmelden.Height = 249
            frmAnmelden.cmd_GastAN.Visible = True
        Else
            frmAnmelden.Height = 226
            frmAnmelden.cmd_GastAN.Visible = False
        End If
    End If
    txt_username.Value = Environ("Username")
    Call FuellenMitA
End Sub

Private Sub cbo_MitAuswahl_Change()
    If cbo_MitAuswahl = "" Then
        txt_PassA.Enabled = False
    Else
        txt_PassA.Enabled = True
    End If
End Sub

Private Sub cmd_GastAN_Click()
    Dim strMsg As String
    Application.ScreenUpdating = False
    strMsg = InputBox("Bitte geben Sie Ihren Namen ein!" & vbLf & "(Vornamen & Nachnamen)" & vbLf & vbLf & "Hinweis: Gast-Anmeldungen haben immer ein beschr|fffd|nkten Zugriff auf die Lagerverwaltung!", "Gast-Anmeldung")
    If strMsg = "" Then Exit Sub
    Sheets("Daten").Range("B24").Value = strMsg
    Sheets("Daten").Range("B7").Value = ""
    Sheets("Daten").Range("B22").Value = strMsg
    Sheets("Daten").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = "'" & Date
    ActiveCell.Offset(0, 1).Value = "Gastanmeldung / " & strMsg
    ActiveCell.Offset(0, 2).Value = "'" & Format(Now, "HH:MM:SS")
    Worksheets("Center").Activate
    Application.ScreenUpdating = True
    Me.lbl_Gast.Visible = True
    lbl_ANamen.Caption = strMsg
    Frm_Willcome.Left = 0
    Application.Wait (Now + TimeValue("00:00:01"))
    lbl_1.BackColor = &HFF&
    lbl_1.Height = 6
    lbl_1.Width = 6
    lbl_1.Top = 130
    lbl_1.Left = 85
    Me.Repaint
    Application.Wait (Now + TimeValue("00:00:01"))
    lbl_2.BackColor = &HFF&
    lbl_2.Height = 6
    lbl_2.Width = 6
    lbl_2.Top = 130
    lbl_2.Left = 97
    Me.Repaint
    Application.Wait (Now + TimeValue("00:00:01"))
    lbl_3.BackColor = &HFF&
    lbl_3.Height = 6
    lbl_3.Width = 6
    lbl_3.Top = 130
    lbl_3.Left = 109
    Me.Repaint
    Application.Wait (Now + TimeValue("00:00:01"))
    lbl_4.BackColor = &HFF&
    lbl_4.Height = 6
    lbl_4.Width = 6
    lbl_4.Top = 130
    lbl_4.Left = 121
    Me.Repaint
    Unload frmAnmelden
    frmLager.Show
End Sub

Private Sub cmd_PAnzeigen_Click()
    txt_PassA.PasswordChar = ""
    Application.Wait Now + TimeSerial(0, 0, 2) '2 sekunden Pause
    Call PWCH
End Sub

Sub PWCH()
    txt_PassA.PasswordChar = "*"
    txt_PassA.SetFocus
End Sub

Private Sub txt_PassA_Change()
    lbl_status.Visible = False
End Sub

Private Sub txt_PassA_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If Not txt_PassA = "" Then
        If KeyCode = 13 Then
            Call Pcheck
        End If
    End If
End Sub

Sub FuellenMitA()
    Dim aRow, i As Long
    cbo_MitAuswahl.Clear
    aRow = Sheets("Mitarbeiter").[A100].End(xlUp).Row
    cbo_MitAuswahl.AddItem "Admin"
    Application.ScreenUpdating = False
    For i = 2 To aRow
        If Sheets("Mitarbeiter").Cells(i, 3) = "" Then
            cbo_MitAuswahl.AddItem Sheets("Mitarbeiter").Cells(i, 2)
        Else
            cbo_MitAuswahl.AddItem Sheets("Mitarbeiter").Cells(i, 2) & ", " & Sheets("Mitarbeiter").Cells(i, 3)
        End If
    Next i
    Application.ScreenUpdating = True
    Call Usernamen
End Sub

Sub Anmeldung()
    access.Name = frmAnmelden.cbo_MitAuswahl.Value
    ZeitN = Format(Now, "hh:nn")
    If frmAnmelden.txt_Admin.Value = "Admin" Then
        access.AdminN = "Admin"
    Else
        access.AdminN = ""
    End If
End Sub

Private Sub cbo_MitAuswahl_Click()
    On Error Resume Next
    If cbo_MitAuswahl = "" Then Exit Sub
    If cbo_MitAuswahl = "Admin" Then
        txt_pass.Value = Sheets("Daten").Range("B6").Value
        txt_PassA.SetFocus
        lbl_LAnmeldung.Caption = ""
    Else
        txt_MID.Value = Sheets("Mitarbeiter").Cells(cbo_MitAuswahl.ListIndex + 1, 1)
        txt_pass.Value = Sheets("Mitarbeiter").Cells(cbo_MitAuswahl.ListIndex + 1, 8)
        txt_zeile.Value = Sheets("Mitarbeiter").Cells(cbo_MitAuswahl.ListIndex + 1, 1).Row
        txt_Admin.Value = Sheets("Mitarbeiter").Cells(cbo_MitAuswahl.ListIndex + 1, 9)
        lbl_LAnmeldung.Caption = Sheets("Mitarbeiter").Cells(cbo_MitAuswahl.ListIndex + 1, 11) & " Uhr"
        txt_PassA.SetFocus
    End If
    Call Pass
End Sub

Private Sub cmd_abbrechenA_Click()
    Dim Ename As String
    Dim Eanzahl As Integer
    On Error Resume Next
    Eanzahl = Workbooks.Count
    ThisWorkbook.Sheets("Daten").Range("B1").Value = ActiveWorkbook.Name
    Ename = Sheets("Daten").Range("B1")
    Application.Visible = True
    If Eanzahl > 1 Then
        Workbooks(Ename).Close savechanges:=True
    Else
        Application.DisplayAlerts = False
        Application.EnableEvents = False
        ActiveWorkbook.Save
        Application.Quit
    End If
End Sub

Private Sub cmd_pass_Click()
    Call Pcheck
End Sub

Private Sub cmd_PassM_Click()
    If cbo_MitAuswahl = "" Then Exit Sub
    If txt_pass = "" Then
        Call PassMO
    Else
        Call PassM
    End If
End Sub

Sub PassM()
    Dim PW, NPW1, NPW2 As String
    Dim zeile As Long
    On Error Resume Next
    Worksheets("Mitarbeiter").Active
    zeile = txt_zeile
    PW = InputBox("Bitte geben Sie das alte Passwort ein!", cbo_MitAuswahl)
    If PW = "" Then Exit Sub
    If cbo_MitAuswahl = "Admin" Then
        If PW = "ExCeLvBa@2018" Then
            Sheets("Mitarbeiter").Cells(zeile, 8) = "0000"
            Sheets("Daten").Range("B6").Value = "0000"
            txt_pass.Value = "0000"
            lbl_status.Caption = "Passwort wurde zur|fffd|ckgesetzt"
            lbl_status.Visible = True
            lbl_status.BackColor = &HC000&
            lbl_status.BorderStyle = &HC000&
            Exit Sub
        End If
    End If
    If PW = txt_pass.Text Then
        NPW1 = InputBox("Bitte geben Sie ein neues Passwort ein!", cbo_MitAuswahl)
            If NPW1 = "" Then
                MsgBox "Das Passwort sollte mindestens 1 Zeichen haben!" & vbLf & vbLf & "Optimal sind mindestens 8 Zeichen!", , "Hinweis"
                Exit Sub
            End If
            If Not NPW1 = "" Then
                NPW2 = InputBox("Bitte wiederholen Sie das neue Passwort ein!", cbo_MitAuswahl)
                If NPW1 = NPW2 Then
                    With Worksheets("Mitarbeiter")
                    If cbo_MitAuswahl = "Admin" Then
                        Sheets("Daten").Range("B6").Value = NPW2
                        txt_PassA.Value = NPW2
                        Sheets("Mitarbeiter").Cells(zeile, 8) = "'" & NPW2
                        cmd_pass.SetFocus
                    Else
                        Sheets("Mitarbeiter").Cells(zeile, 8) = "'" & NPW2
                    End If
                    txt_PassA.Value = NPW2
                    txt_pass.Value = NPW2
                    cmd_pass.SetFocus
                    Sheets("Daten").Activate
                    Range("A65536").End(xlUp).Offset(1, 0).Select
                    ActiveCell.Offset(0, 0).Value = Format(Date, "DD.MM.YYYY")
                    ActiveCell.Offset(0, 1).Value = "Passwort wurde ge|fffd|ndert! / " & cbo_MitAuswahl
                    ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
                    Sheets("Center").Activate
                    ActiveWorkbook.Save
                    MsgBox "Passwort wurde erfolgreich gespeichert!", , "Hinweis"
                    Call Pass
                    Exit Sub
                    End With
                Else
                    MsgBox "Passwort stimmt nicht |fffd|berein!", , "Hinweis"
                    Exit Sub
                End If
            Else
                Exit Sub
            End If
    Else
        lbl_status.Caption = "Passwort ist Falsch!"
        lbl_status.Visible = True
    End If
End Sub

Sub PassMO()
    Dim PW, NPW1, NPW2 As String
    Dim zeile As Long
    On Error Resume Next
    Worksheets("Mitarbeiter").Active
    zeile = txt_zeile
    If PW = txt_pass.Text Then
        NPW1 = InputBox("Bitte geben Sie ein neues Passwort ein!", cbo_MitAuswahl)
            If NPW1 = "" Then Exit Sub
            If Not NPW1 = "" Then
                NPW2 = InputBox("Bitte wiederholen Sie das neue Passwort ein!", cbo_MitAuswahl)
                If NPW1 = NPW2 Then
                    With Worksheets("Mitarbeiter")
                    If cbo_MitAuswahl = "Admin" Then
                        Sheets("Daten").Range("B6").Value = NPW2
                        txt_PassA.Value = NPW2
                        Sheets("Mitarbeiter").Cells(zeile, 8) = "'" & NPW2
                        cmd_pass.SetFocus
                    Else
                        Sheets("Mitarbeiter").Cells(zeile, 8) = "'" & NPW2
                    End If
                    txt_PassA.Value = NPW2
                    txt_pass.Value = NPW2
                    cmd_pass.SetFocus
                    Sheets("Daten").Activate
                    Range("A65536").End(xlUp).Offset(1, 0).Select
                    ActiveCell.Offset(0, 0).Value = Format(Date, "DD.MM.YYYY")
                    ActiveCell.Offset(0, 1).Value = "Passwort wurde vergeben! / " & cbo_MitAuswahl
                    ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
                    Sheets("Center").Activate
                    ActiveWorkbook.Save
                    MsgBox "Passwort wurde erfolgreich gespeichert!", , "Hinweis"
                    Call Pass
                    Exit Sub
                    End With
                Else
                    MsgBox "Passwort stimmt nicht |fffd|berein!", , "Hinweis"
                    Exit Sub
                End If
            Else
                Exit Sub
            End If
    Else
        lbl_status.Caption = "Passwort ist Falsch!"
        lbl_status.Visible = True
    End If
End Sub

Sub Usernamen()
    Dim i As Long
    txt_username.Value = Environ("Username")
    Application.ScreenUpdating = False
    With Sheets("Mitarbeiter")
        For i = 2 To Sheets("Mitarbeiter").[A100].End(xlUp).Row
            If .Cells(i, 10).Text = Environ("Username") Then
                cbo_MitAuswahl = Sheets("Mitarbeiter").Cells(i, 2) & ", " & Sheets("Mitarbeiter").Cells(i, 3)
                txt_pass.Value = Sheets("Mitarbeiter").Cells(i, 8)
                txt_zeile.Value = Sheets("Mitarbeiter").Cells(i, 2).Row
                txt_Admin.Value = Sheets("Mitarbeiter").Cells(i, 9)
                txt_PassA.SetFocus
            End If
        Next i
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte melden Sie sich an!", vbInformation, "Hinweis"
        Cancel = True
        cbo_MitAuswahl.SetFocus
    End If
End Sub

Sub Pass()
    If txt_pass.Value = "" Then
        lbl_info.Visible = True
        lbl_info.Caption = "Bitte zuerst ein Passwort vergeben!"
        cmd_PassM.Caption = "Passwort vergeben"
    Else
        lbl_info.Visible = False
        cmd_PassM.Caption = "Passwort |fffd|ndern"
    End If
End Sub

Sub Pcheck()
    Dim Alng, lngZeile As Long
    On Error Resume Next
    If txt_PassA.Value = "" Then Exit Sub
    If cbo_MitAuswahl = "" And txt_PassA.Value = "" Then Exit Sub
    lbl_ANamen.Caption = Me.cbo_MitAuswahl
    Application.ScreenUpdating = False
    If txt_pass.Value = txt_PassA.Text Then
        If cbo_MitAuswahl = "Admin" Then
            frmLager.lbl_Benutzer.Caption = cbo_MitAuswahl.Text
            Sheets("Daten").Range("B24").Value = "Admin"
            Sheets("Daten").Range("B7").Value = "Admin"
            Sheets("Daten").Range("B22").Value = ""
            txt_Admin.Value = "Admin"
            frmLager.cmdLogOut.Visible = True
            frmLager.cmd_Abmelden.Visible = False
            Call Anmeldung
            Application.ScreenUpdating = True
            Unload frmAnmelden
            Worksheets("Center").Activate
            frmLager.txt_Admin.Value = "admin"
            frmLager.Show
        Else
            Sheets("Daten").Range("B7") = txt_Admin.Value
            frmLager.lbl_Benutzer.Caption = cbo_MitAuswahl.Text
            Sheets("Daten").Range("B23").Value = Format(Now, "hh:nn")
            Sheets("Daten").Range("B24").Value = cbo_MitAuswahl.Text
            If Chk_Windowsnamen = True Then
                For Alng = 2 To ThisWorkbook.Worksheets("Mitarbeiter").UsedRange.Rows.Count
                    If Sheets("Mitarbeiter").Cells(Alng, 10).Value = CStr(Environ("Username")) Then
                        Sheets("Mitarbeiter").Cells(Alng, 10).Value = ""
                    End If
                Next Alng
                Sheets("Mitarbeiter").Cells(CDbl(txt_zeile.Value), 10) = Environ("Username")
            ElseIf Sheets("Mitarbeiter").Cells(CDbl(txt_zeile.Value), 10) = "" Then
                For Alng = 2 To ThisWorkbook.Worksheets("Mitarbeiter").UsedRange.Rows.Count
                    If Sheets("Mitarbeiter").Cells(Alng, 10).Value = CStr(Environ("Username")) Then
                        Sheets("Mitarbeiter").Cells(Alng, 10).Value = ""
                    End If
                Next Alng
                Sheets("Mitarbeiter").Cells(CDbl(txt_zeile.Value), 10) = Environ("Username")
            End If
            Sheets("Mitarbeiter").Cells(CDbl(txt_zeile.Value), 11) = Now
            Call Anmeldung
            Application.ScreenUpdating = True
            Frm_Willcome.Left = 0
            Application.Wait (Now + TimeValue("00:00:01"))
            lbl_1.BackColor = &H80FF80
            lbl_1.Height = 6
            lbl_1.Width = 6
            lbl_1.Top = 130
            lbl_1.Left = 85
            Me.Repaint
            Application.Wait (Now + TimeValue("00:00:01"))
            lbl_2.BackColor = &H80FF80
            lbl_2.Height = 6
            lbl_2.Width = 6
            lbl_2.Top = 130
            lbl_2.Left = 97
            Me.Repaint
            Application.Wait (Now + TimeValue("00:00:01"))
            lbl_3.BackColor = &H80FF80
            lbl_3.Height = 6
            lbl_3.Width = 6
            lbl_3.Top = 130
            lbl_3.Left = 109
            Me.Repaint
            Application.Wait (Now + TimeValue("00:00:01"))
            lbl_4.BackColor = &H80FF80
            lbl_4.Height = 6
            lbl_4.Width = 6
            lbl_4.Top = 130
            lbl_4.Left = 121
            Me.Repaint
            Application.ScreenUpdating = True
            Unload frmAnmelden
            Worksheets("Center").Activate
            If txt_Admin.Value = "Admin" Then
                frmLager.txt_Admin.Value = "admin"
            End If
            txt_PassA.BorderColor = &HC000&
            frmLager.Show
        End If
    Else
        txt_PassA.BorderColor = &HFF&
        Sheets("Daten").Activate
        lngZeile = Worksheets("Daten").Cells(Rows.Count, 1).End(xlUp).Row + 1
        Worksheets("Daten").Cells(lngZeile, 1).Value = Format(Date, "DD.MM.YYYY")
        Worksheets("Daten").Cells(lngZeile, 2).Value = "Falsches Passwort / " & cbo_MitAuswahl
        Worksheets("Daten").Cells(lngZeile, 3).Value = Format(Now, "HH:MM:SS")
        Sheets("Center").Activate
        frmAnmelden.txt_PassA.Value = ""
        lbl_status.Caption = "Passwort ist Falsch!"
        lbl_status.Visible = True
    End If
    ThisWorkbook.Sheets("Mitarbeiter").Visible = xlVeryHidden
    Application.ScreenUpdating = True
    frmAnmelden.txt_PassA.SetFocus
End Sub
Attribute VB_Name = "frmArtikel"
Attribute VB_Base = "0{B62D561C-ED07-4EF5-B10C-E98F06748970}{A8FF3167-0DFB-455C-8419-13B0F681C265}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Private Aenderung As Boolean
Dim WertDB1, WertDB2 As Long

Private Sub cmd_Beleg_Click()
    Application.ScreenUpdating = False
    Worksheets("Druckvorlage").PrintOut
    Sheets("Center").Activate
    WertDB2 = 1
    Application.ScreenUpdating = True
End Sub

Private Sub CommandButton6_Click()
    MsgBox WertDB1 & vbLf & WertDB2
End Sub

Private Sub UserForm_Initialize()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim sngTop, sngLeft As Single
    
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    Worksheets("Lager").Columns("U:U").NumberFormat = "0.0%"
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    cmd_EtikettB.Caption = "Eigenes" & vbLf & "Etikett drucken"
    cmd_InfoKat.ControlTipText = "(" & Me.lbl_cboKat & ")" & " Name |fffd|ndern?"
    lbl_cboKat.Caption = CStr(Sheets("Lager").Range("AO1"))
    WertDB1 = 0
    WertDB2 = 0
    If Sheets("Daten").Range("F30").Value = "Ja" Then
        Me.chk_WEDruck.Value = True
    End If
    If Sheets("Daten").Range("B42").Value = "Nein" Then
        Psuche.Visible = False
        Frame_Normal.Top = 4
    End If
    op_Brutto.Value = True
    If Sheets("Lager").Cells(1, 5) = "" Then
        txt_Frei.Locked = True
        txt_Frei.BackColor = &H80000004
        cmd_InfoFrei.Visible = True
    Else
        txt_Frei.Locked = False
        txt_Frei.BackColor = &H80000005
        lblFrei.Caption = Sheets("Lager").Cells(1, 5)
    End If
    Call WarengruppeCombo
    Call KategorieCombo
    Call HerstellerCombo
    Call LagerortCombo
    Call EinheitCombo
    If cboLieferant.ListIndex = -1 Then txtLNr.Value = "Kein Lieferant vorhanden"
    ALetzte = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
    Application.ScreenUpdating = False
    Set DIC = CreateObject("scripting.dictionary")
    For irow = 2 To ALetzte
        If Not IsEmpty(Sheets("Lieferanten").Cells(irow, 2)) Then
            xKey = VBA.Replace(CStr(Sheets("Lieferanten").Cells(irow, 2).Value), Chr$(13) & Chr$(10), " ")
            DIC(xKey) = 0
        End If
    Next
    For Each xKey In DIC
        cboLieferant.AddItem xKey
        cbo_VPLieferant.AddItem xKey
        cbo_WLieferant.AddItem xKey
    Next
    DIC.RemoveAll
    Set DIC = Nothing
    cboLieferant.ListIndex = -1
    With cbo_VerpackEinheit
        .AddItem "Karton"
        .AddItem "Kiste"
        .AddItem "Palette"
        .AddItem "Paket"
        .AddItem "Pack"
        .AddItem "Beh|fffd|lter"
    End With
    With cbo_VerpackEinheit2
        .AddItem "Karton"
        .AddItem "Kiste"
        .AddItem "Palette"
        .AddItem "Paket"
        .AddItem "Pack"
        .AddItem "Beh|fffd|lter"
    End With
    With cbo_VP_Gew
        .AddItem "g"
        .AddItem "kg"
    End With
    With cbo_VP_Gew2
        .AddItem "g"
        .AddItem "kg"
    End With
    With cboUMST
        .AddItem Format(CDbl(Sheets("Daten").Cells(2, 2) * 100), "0.0") & "%"
        .AddItem Format(CDbl(Sheets("Daten").Cells(3, 2) * 100), "0.0") & "%"
        .AddItem "ohne"
    End With
    With cbo_ASerienNr
        .AddItem "Nein"
        .AddItem "Ja"
        .ListIndex = 0
    End With
    With cbo_VErDatum
        .AddItem "Tag(e)"
        .AddItem "Woche(n)"
    End With
    With cbo_gewicht
        .AddItem "g"
        .AddItem "kg"
    End With
    With cbo_masse
        .AddItem "mm"
        .AddItem "cm"
        .AddItem "m"
        .AddItem "zoll"
    End With
    cboUMST.ListIndex = 0
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    Dim strMsg As String
    On Error Resume Next
    If CloseMode = vbFormControlMenu And Not Me.txtID.Value = "" Then
        strMsg = MsgBox("Ohne Speichern beenden?", vbCritical Or vbYesNo, "Hinweis")
        If strMsg = vbYes Then
            frmArtikel.Hide
            frmLager.Show
            Exit Sub
        Else
            lbl_save.Visible = True
            Application.Wait (Now + TimeValue("00:00:01"))
            Call Aendern
            frmArtikel.Hide
        End If
    End If
End Sub

Private Sub cbo_VErDatum_Change()
    Call VerwDatum
End Sub

Private Sub cbo_VerpackEinheit_Change()
    If Not cbo_VerpackEinheit = "" Then
        If txt_Einheiten.Value = "" Then
            lbl_VPinfo.Caption = "1 " & cbo_VerpackEinheit & " enth|fffd|lt wieviel Einheiten?:"
        Else
            lbl_VPinfo = "1 " & cbo_VerpackEinheit & " enth|fffd|lt:"
        End If
        Me.lbl_VPEArtikel.Caption = cbo_einheit
        txt_Einheiten.Visible = True
    End If
End Sub

Private Sub cbo_VerpackEinheit_Click()
    txt_Einheiten.SetFocus
End Sub

Private Sub cbo_VerpackEinheit2_Change()
    If Not cbo_VerpackEinheit2 = "" Then
        If txt_Einheiten2.Value = "" Then
            lbl_VPinfo2.Caption = "1 " & cbo_VerpackEinheit & " enth|fffd|lt wieviel Einheiten?:"
        Else
            lbl_VPinfo2 = "1 " & cbo_VerpackEinheit & " enth|fffd|lt:"
        End If
        Me.lbl_VPEArtikel2.Caption = cbo_einheit
        txt_Einheiten2.Visible = True
        Me.txt_Einheiten2.SetFocus
    End If
End Sub

Private Sub cbo_VPLieferant_Change()
    Dim arrTmpA, arrTmpB, i As Long
    Dim n As String, Last_Row As Long
    On Error Resume Next
    If cbo_VPLieferant = "" Then Exit Sub
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lieferanten")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And CStr(VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ")) Like cbo_VPLieferant.Text Then
                n = arrTmpA(i, 1)
            End If
       Next i
       txt_VPLieferant.Value = n
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_WLieferant_Change()
    Dim arrTmpA, arrTmpB, i As Long
    Dim n As String, Last_Row As Long
    On Error Resume Next
    
    If cbo_WLieferant = "" Then Exit Sub
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lieferanten")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And CStr(VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ")) Like cbo_WLieferant.Text Then
                n = arrTmpA(i, 1)
            End If
       Next i
       txt_WLieferant.Value = n
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_DateVerw_Click()
    frmKalender.txt_UID = "VERW"
    frmKalender.Show
End Sub

Private Sub cmd_EtikettB_Click()
    On Error Resume Next
    If Not txtID.Value = "" Then
        frmEtikett.txt_type.Value = "BE"
        frmEtikett.txt_Tabellblatt.Value = Sheets("Daten").Range("D1")
        frmEtikett.cbo_Auswahl1 = Sheets("Daten").Range("D2")
        frmEtikett.cbo_Auswahl2 = Sheets("Daten").Range("D3")
        frmEtikett.cbo_Auswahl3 = Sheets("Daten").Range("D4")
        frmEtikett.cbo_Auswahl4 = Sheets("Daten").Range("D5")
        frmEtikett.cbo_Auswahl5 = Sheets("Daten").Range("D6")
        frmEtikett.txt_Zeile1.Value = Sheets("Daten").Range("E2")
        frmEtikett.txt_Zeile2.Value = Sheets("Daten").Range("E3")
        frmEtikett.txt_Zeile3.Value = Sheets("Daten").Range("E4")
        frmEtikett.txt_Zeile4.Value = Sheets("Daten").Range("E5")
        frmEtikett.txt_Zeile5.Value = Sheets("Daten").Range("E6")
        frmEtikett.txt_DBvon.Value = Sheets("Daten").Range("D7")
        frmEtikett.txt_DBbis.Value = Sheets("Daten").Range("D8")
        If Sheets("Daten").Range("D9").Value = "ja" Then
            frmEtikett.chk_Auswahl1.Value = True
        End If
        If Sheets("Daten").Range("D10").Value = "ja" Then
            frmEtikett.chk_Auswahl2.Value = True
        End If
        If Sheets("Daten").Range("D11").Value = "ja" Then
            frmEtikett.chk_Auswahl3.Value = True
        End If
        If Sheets("Daten").Range("D12").Value = "ja" Then
            frmEtikett.chk_Auswahl4.Value = True
        End If
        If Sheets("Daten").Range("D13").Value = "ja" Then
            frmEtikett.chk_Auswahl5.Value = True
        End If
        frmEtikett.suchenEtikettB
        frmEtikett.Show
    End If
End Sub

Private Sub cmd_google_Click()
    Dim link As String
    If txt_Hnr = "" Then
        link = "https://www.google.de/search?site=&source=hp&q=" & Replace(txt_Bezeichnung.Value, " ", "+")
    Else
        link = "https://www.google.de/search?site=&source=hp&q=" & Replace(txt_Bezeichnung.Value, " ", "+") & "+" & txt_Hnr
    End If
    Open_URL (link)
End Sub

Private Sub cmd_InfoFrei_Click()
    MsgBox "Vergeben Sie eine Bezeichnung (z.B. Seriennummer, Zustand, Baujahr, Baureihe ... usw.) f|fffd|r dieses Textfeld. Sie k|fffd|nnen unter den Button Einstellungen (Tabellenblatt Center) einen Namen, f|fffd|r dieses Textfeld, vergeben! Nach dem Sie eine Bezeichnung vergeben haben, k|fffd|nnen Sie dieses Textfeld verwenden.", vbOKOnly, "Textfeld frei definieren"
End Sub

Private Sub cmd_InfoItem_Click()
    MsgBox "Bitte geben Sie eine Artikelnummer an! Eine eindeutige ID wird dann automatisch vergeben!", , "Primaerschluessel/ ID"
End Sub

Private Sub cmd_InfoKat_Click()
    Dim lng As Long
    Dim lngMsg As String
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    lng = MsgBox("M|fffd|chen Sie die Bezeichnung: (" & lbl_cboKat.Caption & ") |fffd|ndern?", vbYesNo, "Hinweis")
    If lng = vbNo Then
        Exit Sub
    Else
        lngMsg = InputBox("Geben Sie eine andere Bezeichnng ein!", "Bezeichnung |fffd|ndern", lbl_cboKat.Caption)
        If lngMsg = "" Then
            Exit Sub
        Else
            Sheets("Lager").Range("AO1").Value = CStr(lngMsg)
            lbl_cboKat.Caption = CStr(lngMsg)
        End If
    End If
End Sub

Private Sub cmd_Lplaetze_Click()
    On Error Resume Next
    Dim strID As String
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row, lngID As Long
    On Error Resume Next
    strID = txtID.Value
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strID) Then
                lngID = i
            End If
        Next i
    End With
    Application.ScreenUpdating = True
    If Sheets("Lager").Cells(lngID, 13).Value = "" Then
        frmLagerorte.lbl_LagerInfo.Caption = "Noch kein Hauptlagerplatz!"
        frmLagerorte.txt_info.Value = "HH"
    Else
        frmLagerorte.txt_info.Value = ""
    End If
    If txtID.Value = "" Then Exit Sub
    frmLagerorte.lbl_Artikelnummer.Caption = txt_Artikelnummer.Value
    frmLagerorte.lbl_bezeichnung.Caption = txt_Bezeichnung
    frmLagerorte.lbl_Artikelnummer2.Caption = txt_Artikelnummer.Value
    frmLagerorte.txt_Bezeichnung2.Value = txt_Bezeichnung
    frmLagerorte.lbl_ID.Caption = txtID.Value
    Call frmLagerorte.suchenIDNeu
    frmLagerorte.Show
End Sub

Private Sub cmd_Verlauf_Click()
    frmVerlauf.lbl_Bezeichung.Caption = txt_Bezeichnung.Value
    frmVerlauf.Verlauf
    frmVerlauf.Show
End Sub

Private Sub cmd_Amazon_Click()
    Dim link As String
    If txt_Hnr = "" Then
        link = "https://www.amazon.de/s/Daps&field-keywords=" & Replace(txt_Bezeichnung.Value, " ", "+")
    Else
        link = "https://www.amazon.de/s/Daps&field-keywords=" & Replace(txt_Hnr.Value, " ", "+")
    End If
    Open_URL (link)
End Sub

Private Sub cmd_idealo_Click()
    Dim link As String
    If txt_Hnr = "" Then
        link = "https://www.idealo.de/preisvergleich/MainSearchProductCategory.html?q=" & Replace(txt_Bezeichnung.Value, " ", "+")
    Else
        link = "https://www.idealo.de/preisvergleich/MainSearchProductCategory.html?q=" & Replace(txt_Bezeichnung.Value, " ", "+") & "+" & txt_Hnr
    End If
    Open_URL (link)
End Sub

Private Sub cmd_VPHinzu_Click()
    Dim MaxID, z, zeile, LRow, letztezeile As Long
    Dim strMsg As String
    On Error Resume Next
    If txt_Einheiten.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    Sheets("Lagerorte").Activate
    LRow = CLng(Sheets("VPEinheit").Cells(Rows.Count, 1).End(xlUp).Row) + 1
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    MaxID = 0
    If cbo_VPLieferant = "" Then
        strMsg = MsgBox("M|fffd|chten Sie ohne Lieferant fortsetzen?", vbYesNo, "Hinweis")
        If strMsg = vbNo Then
            cbo_VPLieferant.SetFocus
            Sheets("Center").Activate
            Application.ScreenUpdating = True
            Exit Sub
        End If
    End If
    For z = 2 To letztezeile
        If CDbl(Cells(z, 1)) > MaxID Then
            MaxID = CDbl(Cells(z, 1))
        End If
    Next
    If Sheets("Daten").Cells(43, 4) = "" Or Sheets("Daten").Cells(43, 4) = 0 Then
        If CDbl(MaxID) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(43, 4).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(MaxID) > CDbl(Sheets("Daten").Cells(43, 4).Value) Then
            zeile = CDbl(MaxID) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(MaxID) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
        End If
    End If
    Sheets("VPEinheit").Cells(LRow, 1) = "'" & CStr(zeile) 'VP-ID
    Sheets("VPEinheit").Cells(LRow, 2) = "'" & CStr(Me.txtID)
    Sheets("VPEinheit").Cells(LRow, 3) = CDbl(Me.txt_Einheiten)
    Sheets("VPEinheit").Cells(LRow, 4) = "'" & CStr(Me.lbl_VPEArtikel)
    If Not cbo_VerpackEinheit = "" Then
        Sheets("VPEinheit").Cells(LRow, 5) = CStr(Me.cbo_VerpackEinheit)
    End If
    Sheets("VPEinheit").Cells(LRow, 6) = CDbl(Me.txt_VP_Gewicht)
    If Not cbo_VP_Gew = "" Then
        Sheets("VPEinheit").Cells(LRow, 7) = CStr(Me.cbo_VP_Gew)
    End If
    Sheets("VPEinheit").Cells(LRow, 8) = CStr(Me.txt_VPZusatz)
    Sheets("VPEinheit").Cells(LRow, 9) = "'" & CStr(Me.txt_ANrLieferant)
    Sheets("VPEinheit").Cells(LRow, 10) = "'" & CStr(txt_VPLieferant)
    Sheets("VPEinheit").Cells(LRow, 11) = "'" & CStr(cbo_VPLieferant)
    Sheets("VPEinheit").Cells(LRow, 12) = CDbl(Me.txt_VPPreis)
    Sheets("VPEinheit").Cells(LRow, 13) = CDbl(Me.txt_VPPreis) / CDbl(Me.txt_Einheiten)
    Sheets("VPEinheit").Cells(LRow, 14) = "VP-LB"
    Sheets("VPEinheit").Cells(LRow, 16) = CStr(Sheets("Daten").Cells(24, 2))
    txt_VPZusatz.Value = ""
    txt_ANrLieferant.Value = ""
    txt_Einheiten.Value = ""
    cbo_VerpackEinheit.ListIndex = -1
    txt_VP_Gewicht.Value = ""
    cbo_VP_Gew.ListIndex = -1
    lbl_VPArtikelnummer.Caption = ""
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call frmArtikel.suchenVPID
End Sub

Private Sub cmd_VPHinzu2_Click()
    Dim MaxID, z, zeile, LRow, letztezeile As Long
    On Error Resume Next
    If txt_Einheiten2.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    Sheets("Lagerorte").Activate
    LRow = CLng(Sheets("VPEinheit").Cells(Rows.Count, 1).End(xlUp).Row) + 1
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    MaxID = 0
    For z = 2 To letztezeile
        If CDbl(Cells(z, 1)) > MaxID Then
            MaxID = CDbl(Cells(z, 1))
        End If
    Next
    If Sheets("Daten").Cells(43, 4) = "" Or Sheets("Daten").Cells(43, 4) = 0 Then
        If CDbl(MaxID) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(43, 4).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(MaxID) > CDbl(Sheets("Daten").Cells(43, 4).Value) Then
            zeile = CDbl(MaxID) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(MaxID) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
        End If
    End If
    Sheets("VPEinheit").Cells(LRow, 1) = "'" & CStr(zeile) 'VP-ID
    Sheets("VPEinheit").Cells(LRow, 2) = "'" & CStr(Me.txtID)
    Sheets("VPEinheit").Cells(LRow, 3) = CDbl(Me.txt_Einheiten2)
    Sheets("VPEinheit").Cells(LRow, 4) = "'" & CStr(Me.lbl_VPEArtikel2)
    Sheets("VPEinheit").Cells(LRow, 5) = CStr(Me.cbo_VerpackEinheit2)
    Sheets("VPEinheit").Cells(LRow, 6) = CDbl(Me.txt_VP_Gewicht2)
    If Not cbo_VP_Gew2 = "" Then
        Sheets("VPEinheit").Cells(LRow, 7) = CStr(Me.cbo_VP_Gew2)
    End If
    If txt_VPPreis2 = "" Then
        Sheets("VPEinheit").Cells(LRow, 12) = 0
        Sheets("VPEinheit").Cells(LRow, 13) = 0
    Else
        Sheets("VPEinheit").Cells(LRow, 12) = CDbl(Me.txt_VPPreis2)
        Sheets("VPEinheit").Cells(LRow, 13) = CDbl(Me.txt_VPPreis2) / CDbl(Me.txt_Einheiten2)
    End If
    Sheets("VPEinheit").Cells(LRow, 8) = CStr(Me.txt_VPZusatz2)
    Sheets("VPEinheit").Cells(LRow, 14) = "VP-VK"
    Sheets("VPEinheit").Cells(LRow, 16) = CStr(Sheets("Daten").Cells(24, 2))
    txt_VPZusatz2.Value = ""
    txt_Einheiten2.Value = ""
    cbo_VerpackEinheit2.ListIndex = -1
    txt_VP_Gewicht2.Value = ""
    cbo_VP_Gew2.ListIndex = -1
    lbl_VPArtikelnummer2.Caption = ""
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call frmArtikel.suchenVPID2
End Sub

Private Sub cmd_WLieferant_Click()
    Dim MaxID, z, zeile, LRow, letztezeile As Long
    If txt_WLEKPreis.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    Sheets("Lagerorte").Activate
    LRow = CLng(Sheets("VPEinheit").Cells(Rows.Count, 1).End(xlUp).Row) + 1
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    MaxID = 0
    For z = 2 To letztezeile
        If CDbl(Cells(z, 1)) > MaxID Then
            MaxID = CDbl(Cells(z, 1))
        End If
    Next
    If Sheets("Daten").Cells(43, 4) = "" Or Sheets("Daten").Cells(43, 4) = 0 Then
        If CDbl(MaxID) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(43, 4).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(MaxID) > CDbl(Sheets("Daten").Cells(43, 4).Value) Then
            zeile = CDbl(MaxID) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(MaxID) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
        End If
    End If
    Sheets("VPEinheit").Cells(LRow, 1) = "'" & CStr(zeile) 'VP-ID
    Sheets("VPEinheit").Cells(LRow, 2) = "'" & CStr(Me.txtID)
    Sheets("VPEinheit").Cells(LRow, 3) = 1
    Sheets("VPEinheit").Cells(LRow, 4) = "'" & CStr(Me.lbl_VPEArtikel)
    Sheets("VPEinheit").Cells(LRow, 5) = CStr(cbo_einheit)
    Sheets("VPEinheit").Cells(LRow, 6) = ""
    Sheets("VPEinheit").Cells(LRow, 7) = ""
    Sheets("VPEinheit").Cells(LRow, 8) = CStr(txt_WZusatz)
    Sheets("VPEinheit").Cells(LRow, 9) = "'" & CStr(txt_WALieferant)
    Sheets("VPEinheit").Cells(LRow, 10) = "'" & CStr(txt_WLieferant)
    Sheets("VPEinheit").Cells(LRow, 11) = "'" & CStr(cbo_WLieferant)
    Sheets("VPEinheit").Cells(LRow, 12) = "-"
    Sheets("VPEinheit").Cells(LRow, 13) = CDbl(txt_WLEKPreis)
    Sheets("VPEinheit").Cells(LRow, 14) = "VP-WL"
    Sheets("VPEinheit").Cells(LRow, 16) = CStr(Sheets("Daten").Cells(24, 2))
    txt_VPZusatz.Value = ""
    txt_ANrLieferant.Value = ""
    txt_Einheiten.Value = ""
    cbo_VerpackEinheit.ListIndex = -1
    txt_VP_Gewicht.Value = ""
    cbo_VP_Gew.ListIndex = -1
    lbl_VPArtikelnummer.Caption = ""
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call frmArtikel.suchenVPWL
End Sub

Private Sub CommandButton1_Click()
    Dim lngrow As Long
    Dim strName, strF As String
    On Error Resume Next
    strName = list_Verpack.Column(0)
    strF = MsgBox("M|fffd|chten Sie wirklich (" & strName & ") l|fffd|schen?", vbYesNo + vbQuestion, "Best|fffd|ttigen")
    If strF = vbYes Then
        lngrow = list_Verpack.Column(4)
        Sheets("VPEinheit").Rows(lngrow).Delete
        Call suchenVPID
        lbl_save.Visible = True
        lbl_save.Caption = "VP-Einheit: " & strName & " wurde entfernt!"
    End If
End Sub

Private Sub CommandButton3_Click()
    Dim lngrow As Long
    Dim strName, strF As String
    On Error Resume Next
    strName = list_Verpack2.Column(0)
    strF = MsgBox("M|fffd|chten Sie wirklich (" & strName & ") l|fffd|schen?", vbYesNo + vbQuestion, "Best|fffd|ttigen")
    If strF = vbYes Then
        lngrow = list_Verpack2.Column(4)
        Sheets("VPEinheit").Rows(lngrow).Delete
        Call suchenVPID2
        lbl_save.Visible = True
        lbl_save.Caption = "VP-Einheit: " & strName & " wurde entfernt!"
    End If
End Sub

Private Sub CommandButton5_Click()
    Dim lngrow As Long
    Dim strName, strF As String
    On Error Resume Next
    strName = list_SWLieferanten.Column(1)
    strF = MsgBox("M|fffd|chten Sie wirklich " & strName & " l|fffd|schen?", vbYesNo + vbQuestion, "Best|fffd|ttigen")
    If strF = vbYes Then
        lngrow = list_SWLieferanten.Column(4)
        Sheets("VPEinheit").Rows(lngrow).Delete
        Call suchenVPWL
        lbl_save.Visible = True
        lbl_save.Caption = "Lieferant: " & strName & " wurde entfernt!"
    End If
End Sub

Private Sub cmd_PreisWL_Click()
    Dim strP, strL As String
    Dim xrow As Long
    
    strL = list_SWLieferanten.Column(1)
    xrow = list_SWLieferanten.Column(4)
    If txtID = "" Then Exit Sub
    strP = InputBox("Bitte geben Sie den neuen Preis an!" & vbLf & vbLf & "Lieferant: " & strL, "EK-Preis |fffd|ndern", Format(CDbl(Sheets("VPEinheit").Cells(xrow, 13)), "0.00"))
    If strP = "" Then
        Exit Sub
    Else
        Sheets("VPEinheit").Cells(xrow, 13) = CDbl(strP)
        Sheets("VPEinheit").Cells(xrow, 15) = Format(Date, "DD.MM.YYYY")
    End If
    Call suchenVPWL
End Sub

Private Sub txt_WLEKPreis_Change()
    If Not txt_WLEKPreis.Value = "" And Not txtID.Value = "" Then
        cmd_WLieferant.Enabled = True
    Else
        cmd_WLieferant.Enabled = False
    End If
End Sub

Private Sub txt_Artikelnummer_AfterUpdate() 'v 1.44
    Dim arrTmpA, arrTmpB, Last_Row As Long
    Dim lngID, i As Long
    Dim strMsg As String
    On Error Resume Next
    If Not txt_Artikelnummer = "" Then
        If txtID.Value = "" Then
            Application.ScreenUpdating = False
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 3) = "" And LCase(CStr(arrTmpA(i, 3))) = LCase(CStr(txt_Artikelnummer)) Then
                        lngID = i
                    End If
                Next i
            End With
            Application.ScreenUpdating = True
            If lngID > 0 Then
                strMsg = MsgBox("Die Artikelnummer " + (frmArtikel.txt_Artikelnummer) + " wurde bereits erfasst! M|fffd|chten Sie fortfahren?", vbYesNo, "Anlegen")
                If strMsg = vbNo Then
                    txt_Artikelnummer.Value = ""
                    txt_Artikelnummer.SetFocus
                    Exit Sub
                End If
            End If
        End If
    End If
End Sub

Private Sub txt_Artikelnummer_Change()
    If Not txt_Artikelnummer = "" Then
        txt_Artikelnummer.BorderColor = &H8000000A
        lbl_itemWL.Caption = txt_Artikelnummer
    Else
        txt_Artikelnummer.BorderColor = &HFF&
    End If
End Sub

Private Sub txt_Bezeichnung_Change()
    If Not txt_Bezeichnung = "" Then
        txt_Bezeichnung.BorderColor = &H8000000A
    Else
        txt_Bezeichnung.BorderColor = &HFF&
    End If
End Sub

Private Sub txt_Bestand_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If Not txt_Bestand = "" Then
        txt_Bestand.BorderColor = &H8000000A
    Else
        txt_Bestand.BorderColor = &HFF&
    End If
End Sub

Private Sub txt_Einheiten_Change()
    On Error Resume Next
    If Not Me.txtID = "" Then
        If Not txt_Einheiten = "" Then
            lbl_VPArtikelnummer.Caption = txt_Artikelnummer & "-1" & txt_Einheiten
            txt_Einheiten.BorderColor = &HC000&
            cmd_VPHinzu.Enabled = True
            If Not Me.cboLieferant = "" Then
                cbo_VPLieferant.Text = cboLieferant
                txt_VPLieferant.Value = txtLNr
            End If
            Me.txt_VPPreis = Format(CDbl(txtEKPreis) * CDbl(txt_Einheiten), "currency")
            lbl_VPinfo = "1 " & cbo_VerpackEinheit & " enth|fffd|lt:"
            If Not txt_Gewicht = "" Then
                txt_VP_Gewicht = CDbl(txt_Einheiten) * (txt_Gewicht)
                cbo_VP_Gew = cbo_gewicht
                txt_ANrLieferant.Value = Me.txt_Hnr
            End If
        Else
            lbl_VPArtikelnummer.Caption = txt_Artikelnummer
            txt_VP_Gewicht = ""
            cbo_gewicht = ""
            cbo_VPLieferant.ListIndex = -1
            txt_VPPreis.Value = ""
            txt_ANrLieferant.Value = ""
            cmd_VPHinzu.Enabled = False
            lbl_VPinfo = "1 " & cbo_VerpackEinheit & " enth|fffd|lt wieviel Einheiten?:"
            txt_Einheiten.BorderColor = &HFF&
        End If
    End If
End Sub

Private Sub txt_Einheiten2_Change()
    On Error Resume Next
    If Not Me.txtID = "" Then
        If Not txt_Einheiten2 = "" Then
            lbl_VPArtikelnummer2.Caption = txt_Artikelnummer & "-2" & txt_Einheiten2
            txt_Einheiten2.BorderColor = &HC000&
            If Not txt_Gewicht = "" Then
                txt_VP_Gewicht2 = CDbl(txt_Einheiten2) * (txt_Gewicht)
                cbo_VP_Gew2 = cbo_gewicht
            End If
            Me.txt_VPPreis2 = Format(CDbl(txtEKPreis) * CDbl(txt_Einheiten2), "currency")
            lbl_VPinfo2 = "1 " & cbo_VerpackEinheit2 & " enth|fffd|lt:"
            cmd_VPHinzu2.Enabled = True
        Else
            lbl_VPArtikelnummer2.Caption = txt_Artikelnummer
            txt_VP_Gewicht2 = ""
            txt_VPPreis2.Value = ""
            cmd_VPHinzu2.Enabled = False
            lbl_VPinfo2 = "1 " & cbo_VerpackEinheit & " enth|fffd|lt wieviel Einheiten?:"
            txt_Einheiten2.BorderColor = &HFF&
        End If
    End If
End Sub

Private Sub txtbestandmin_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If Not txtbestandmin = "" Then
        txtbestandmin.BorderColor = &H808080
    Else
        txtbestandmin.BorderColor = &HFF&
    End If
End Sub

Sub pruefenleer()
    If txt_Bestand.Value = "" Or cbo_einheit = "" Or txtbestandmin.Value = "" Or txtMeldeBestand.Value = "" Then
        If Not txt_Artikelnummer = "" Then
            txt_Artikelnummer.BorderColor = &H8000000A
        Else
            txt_Artikelnummer.BorderColor = &HFF&
        End If
        If Not txt_Bestand = "" Then
            txt_Bestand.BorderColor = &H8000000A
        Else
            txt_Bestand.BorderColor = &HFF&
        End If
        If Not cbo_einheit = "" Then
            cbo_einheit.BorderColor = &H8000000A
        Else
            cbo_einheit.BorderColor = &HFF&
        End If
        If Not txtbestandmin = "" Then
            txtbestandmin.BorderColor = &H8000000A
        Else
            txtbestandmin.BorderColor = &HFF&
        End If
        If Not txtMeldeBestand = "" Then
            txtMeldeBestand.BorderColor = &H8000000A
        Else
            txtMeldeBestand.BorderColor = &HFF&
        End If
        If Not txt_Bezeichnung = "" Then
            txt_Bezeichnung.BorderColor = &H8000000A
        Else
            txt_Bezeichnung.BorderColor = &HFF&
        End If
    End If
End Sub

Private Sub txt_Barcode_Change()
    If Not txt_Barcode.Value = "" Then
        lbl_Strich.Caption = "*" & txt_Barcode.Value & "*"
    Else
        lbl_Strich.Caption = ""
    End If
End Sub

Private Sub txt_breite_Change()
    If txt_breite.Value = "" And txt_laenge.Value = "" And txt_durchmesser.Value = "" And txt_tiefe.Value = "" Then
        cbo_masse.ListIndex = -1
    End If
End Sub

Private Sub txt_durchmesser_Change()
    If txt_breite.Value = "" And txt_laenge.Value = "" And txt_durchmesser.Value = "" And txt_tiefe.Value = "" Then
        cbo_masse.ListIndex = -1
    End If
End Sub

Private Sub txt_Gewicht_Change()
    If Not txt_Gewicht.Value = "" And cbo_gewicht = "" Then
        cbo_gewicht.BorderColor = &HFF&
    Else
        cbo_gewicht.ListIndex = -1
        cbo_gewicht.BorderColor = &H808080
    End If
End Sub

Private Sub cbo_gewicht_Click()
    If Not txt_Gewicht.Value = "" And cbo_gewicht = "" Then
        cbo_gewicht.BorderColor = &HFF&
    Else
        cbo_gewicht.BorderColor = &H808080
    End If
End Sub

Private Sub txt_laenge_Change()
    If txt_breite.Value = "" And txt_laenge.Value = "" And txt_durchmesser.Value = "" And txt_tiefe.Value = "" Then
        cbo_masse.ListIndex = -1
    End If
End Sub

Private Sub txt_tiefe_Change()
    If txt_breite.Value = "" And txt_laenge.Value = "" And txt_durchmesser.Value = "" And txt_tiefe.Value = "" Then
        cbo_masse.ListIndex = -1
    End If
End Sub

Private Sub txt_Verwendbar_Change()
    If txt_Verwendbar = "" Then
        txt_VerwendbarEr.Value = ""
    End If
    Call VerwDatum
End Sub

Private Sub txt_VerWert_Change()
    Call VerwDatum
End Sub

Sub VerwDatum()
    On Error Resume Next
    If Not txt_VerWert.Value = "" And IsDate(txt_Verwendbar.Value) And Not cbo_VErDatum = "" Then
        If cbo_VErDatum = "Tag(e)" Then
            txt_VerwendbarEr = DateAdd("d", -CDbl(txt_VerWert), CDate(txt_Verwendbar))
        Else
            txt_VerwendbarEr = DateAdd("d", -CDbl(txt_VerWert * 7), CDate(txt_Verwendbar))
        End If
    End If
End Sub

Private Sub txtID_Change()
    If Not txtID = "" Then
        frmArtikel.MultiPage1.Pages(1).Enabled = True
        frmArtikel.MultiPage1.Pages(2).Enabled = True
        Call suchenVPID
        Call suchenVPID2
        Call suchenVPWL
    End If
End Sub

Sub suchenVPWL() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    On Error Resume Next
    list_SWLieferanten.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(Me.txtID) And CStr(arrTmpA(i, 14)) = "VP-WL" Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 9)
                arrTmpB(2, n) = arrTmpA(i, 11) & " (" & arrTmpA(i, 10) & ")"
                arrTmpB(3, n) = arrTmpA(i, 6) & " " & arrTmpA(i, 7)
                arrTmpB(4, n) = arrTmpA(i, 8)
                arrTmpB(5, n) = i
                If CDbl(txtEKPreis) < CDbl(arrTmpA(i, 13)) Then
                    arrTmpB(6, n) = Format(arrTmpA(i, 13), "currency") & " (+ " & Format(CDbl(arrTmpA(i, 13)) * 100 / CDbl(txtEKPreis) - 100, "0.0") & "%)"
                Else
                    arrTmpB(6, n) = Format(arrTmpA(i, 13), "currency") & " (- " & Format(100 - (CDbl(arrTmpA(i, 13)) * 100 / CDbl(txtEKPreis)), "0.0") & "%)"
                End If
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 6)
        For i = 1 To 6
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With list_SWLieferanten
           .ColumnCount = 6
           .ColumnWidths = "120;180;0;140;0,100"
           .List = arrTmpA
        End With
    End If
    Application.ScreenUpdating = True
End Sub

Sub suchenVPID2() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    On Error Resume Next
    list_Verpack2.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(Me.txtID) And CStr(arrTmpA(i, 14)) = "VP-VK" Then
                n = n + 1
                arrTmpB(1, n) = txt_Artikelnummer & "-2" & arrTmpA(i, 3)
                arrTmpB(2, n) = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ")"
                arrTmpB(3, n) = arrTmpA(i, 6) & " " & arrTmpA(i, 7)
                arrTmpB(4, n) = arrTmpA(i, 8)
                arrTmpB(5, n) = i
                arrTmpB(6, n) = Format(arrTmpA(i, 12), "currency") & " (" & Format(arrTmpA(i, 13), "currency") & ")"
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 6)
        For i = 1 To 6
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With list_Verpack2
           .ColumnCount = 6
           .ColumnWidths = "120;90;50;190;0,60"
           .List = arrTmpA
        End With
    End If
    Application.ScreenUpdating = True
End Sub

Sub suchenVPID() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    On Error Resume Next
    list_Verpack.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(Me.txtID) And CStr(arrTmpA(i, 14)) = "VP-LB" Then
                n = n + 1
                arrTmpB(1, n) = txt_Artikelnummer & "-1" & arrTmpA(i, 3)
                arrTmpB(2, n) = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ")"
                arrTmpB(3, n) = arrTmpA(i, 6) & " " & arrTmpA(i, 7)
                arrTmpB(4, n) = "(" & arrTmpA(i, 10) & ") " & arrTmpA(i, 11)
                arrTmpB(5, n) = i
                arrTmpB(6, n) = Format(arrTmpA(i, 12), "currency") & " (" & Format(arrTmpA(i, 13), "currency") & ")"
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 6)
        For i = 1 To 6
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With list_Verpack
           .ColumnCount = 6
           .ColumnWidths = "120;90;50;190;0;60"
           .List = arrTmpA
        End With
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_close_Click()
    Dim msgstr As Integer
    On Error Resume Next
    If Not frmArtikel.txt_Artikelnummer.Value = "" And Not frmArtikel.txtID.Value = "" Then
        frmLager.cboArtikelnummer = frmArtikel.txt_Artikelnummer.Value
    End If
    If txt_Verleih.Value = "Verleih" Then
    Unload frmArtikel
    ElseIf txt_Verleih.Value = "Kasse" Then
    Unload frmArtikel
    ElseIf txt_Verleih.Value = "BestO" Then
    Unload frmArtikel
    ElseIf txt_Verleih.Value = "Best" Then
    Unload frmArtikel
    ElseIf txt_Verleih.Value = "Grup" Then
    Unload frmArtikel
    Else
        If WertDB1 > 0 Then
            If WertDB2 = 0 Then
                msgstr = MsgBox("M|fffd|chten Sie noch einen Beleg Ausdrucken?", vbYesNo, "Hindweis")
                If msgstr = vbYes Then
                    Application.ScreenUpdating = False
                    Worksheets("Druckvorlage").PrintOut
                    Sheets("Center").Activate
                    Application.ScreenUpdating = True
                    Unload frmArtikel
                    frmLager.Show
                Else
                    GoTo weiter
                End If
            Else
                GoTo weiter
            End If
        Else
weiter:
            Unload frmArtikel
            frmLager.Show
        End If
    End If
End Sub

Private Sub cmd_EtikettA_Click()
    Dim strFontFileName As String
    strFontFileName = "Bar-Code 39"
    If SystemFontExists(strFontFileName) = False Then
        MsgBox "Bitte installieren Sie die Schriftart (Bar-Code 39)!" & vbLf & "Weitere Informationen finden Sie auch im Benutzerhandbuch!", vbInformation, "Schriftart (Bar-Code 39) ist nicht installiert!"
        Exit Sub
    End If
    If txt_Artikelnummer.Value = "" Then Exit Sub
    frmEtikett.Frame_Artikel.Top = 6
    frmEtikett.Frame_Artikel.Left = 6
    'Etikett1
    frmEtikett.txt_ArtikelAnE.Value = txt_Artikelnummer.Value
    frmEtikett.txt_ArtikelLaE.Value = cboLagerort
    frmEtikett.txt_LieferantE.Value = cboLieferant
    'Etikett2
    frmEtikett.txt_ArtikelAnET2.Value = txt_Artikelnummer.Value
    frmEtikett.txt_ArtikelLaET2.Value = cboLagerort
    'Etikett3
    frmEtikett.txt_ArtikelAnET3.Value = txt_Artikelnummer.Value
    frmEtikett.txt_BezeichnungET3.Value = txt_Bezeichnung.Value
    frmEtikett.txt_ArtikelLaET3.Value = cboLagerort
    frmEtikett.txt_LieferantET3.Value = cboLieferant
    frmEtikett.txt_LieferantNrET3.Value = txtLNr.Value
    frmEtikett.fra_BeEtikett.Visible = False
    frmEtikett.Ch_T1 = True
    If Worksheets("Daten").Range("B36") = "AN" Then
        frmEtikett.Check_HerstellerNr = False
        frmEtikett.Check_ArtikelNr.Value = True
        frmEtikett.Check_Barcode.Value = False
        frmEtikett.txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        frmEtikett.txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        frmEtikett.txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        frmEtikett.lbl_BarArtikelAnE.Caption = frmArtikel.txt_Artikelnummer.Value
    ElseIf Worksheets("Daten").Range("B36") = "HN" Then
        frmEtikett.Check_ArtikelNr.Value = False
        frmEtikett.Check_Barcode.Value = False
        frmEtikett.Check_HerstellerNr = True
        frmEtikett.txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        frmEtikett.txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        frmEtikett.txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        frmEtikett.lbl_BarArtikelAnE.Caption = frmArtikel.txt_Hnr.Value
    Else
        frmEtikett.Check_Barcode.Value = True
        frmEtikett.Check_ArtikelNr.Value = False
        frmEtikett.Check_HerstellerNr = False
        frmEtikett.txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
        frmEtikett.txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
        frmEtikett.txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
        frmEtikett.lbl_BarArtikelAnE.Caption = frmArtikel.txt_Barcode.Value
    End If
    frmEtikett.Show
End Sub

Private Sub op_Netto_Click()
    If op_Netto.Value = True Then op_Brutto.Value = False
    If op_Brutto.Value = True Then op_Netto.Value = False
End Sub

Private Sub cbo_Hersteller_Click()
    On Error Resume Next
    If cbo_Hersteller = "" Then Exit Sub
    txt_Bestand.SetFocus
End Sub

Private Sub cboLagerort_Click()
    If cboLagerort = "" Then Exit Sub
End Sub

Private Sub cboWarengruppe_AfterUpdate()
    If cboWarengruppe = "" Then Exit Sub
    txtEKPreis.SetFocus
End Sub

Private Sub cmdNartikel_Click() 'v1.44
    Dim objControl As control
    Dim astxt, strEinheit, strB As String
    Dim Last_Row, arrTmpA, arrTmpB, i, xrow, irow, lng, zeTB, WertDB2 As Long
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2, xrow2 As Long
    On Error Resume Next
    If txt_Artikelnummer.Value = "" Then
        MsgBox "Sie m|fffd|ssen eine Artikelnummer angeben!", vbOKOnly, "Anlegen"
        txt_Artikelnummer.SetFocus
        Call pruefenleer
        Exit Sub
    End If
    strEinheit = cbo_einheit
    If txt_Bezeichnung.Value = "" And Not txt_Artikelnummer.Value = "" Then
        MsgBox "Sie m|fffd|ssen zum Artikel " + txt_Artikelnummer + " eine Bezeichnung angeben!", , "Artikel anlegen"
        txt_Bezeichnung.SetFocus
        Call pruefenleer
        Exit Sub
    End If
    astxt = txt_Artikelnummer.Value
    strB = WertDB1
    lbl_save.Visible = True
    lbl_save.Caption = "Artikel (" + txt_Bezeichnung.Value + ") wird angelegt!"
    lbl_save.BackColor = &HC000&
    lbl_save.BorderColor = &HC000&
    Application.ScreenUpdating = False
    If chk_WEDruck = True And WertDB1 < 1 Then
        If txt_Bestand.Value = "" Then
            txt_Bestand.Value = 0
        End If
        If Not cboLieferant = "" And CDbl(txt_Bestand) > 0 Then
            WertDB1 = 1
            cmd_Beleg.Visible = True
            With ThisWorkbook.Sheets("Lieferanten")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtLNr) Then
                        xrow = i
                    End If
                Next i
            End With
            If xrow > 0 Then
                irow = CLng(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
                ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & irow).Delete
                Range("Druckvorlage!E4").Value = Format(Date, "DD.MM.YYYY")
                Range("Druckvorlage!E2").Value = ""
                Range("Druckvorlage!E5").Value = ""
                Range("Druckvorlage!E6").Value = ""
                Range("Druckvorlage!E7").Value = ""
                Range("Druckvorlage!E16").Value = ""
                Range("Druckvorlage!F16").Value = ""
                Range("Druckvorlage!A3").Value = "Lieferant"
                Range("Druckvorlage!D3") = "Lieferdatum:"
                Range("Druckvorlage!D5") = "Lieferanten-Nr.:"
                Range("Druckvorlage!D6") = "Meine Kunden Nr.:"
                If Not Sheets("Daten").Range("B24") = "" Then
                    With ThisWorkbook.Sheets("Mitarbeiter")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 2) & ", " & arrTmpA2(i2, 3) = CStr(Sheets("Daten").Range("B24")) Then
                                xrow2 = i2
                            End If
                        Next i2
                    End With
                    Range("Druckvorlage!C11") = CStr(Sheets("Daten").Range("B24"))
                    Range("Druckvorlage!C12") = "'" & Worksheets("Mitarbeiter").Cells(CLng(xrow2), 5)
                    Range("Druckvorlage!C13") = "'" & Worksheets("Mitarbeiter").Cells(CLng(xrow2), 6)
                    Range("Druckvorlage!C14") = "'" & Worksheets("Mitarbeiter").Cells(CLng(xrow2), 4)
                Else
                    Range("Druckvorlage!C11") = ""
                    Range("Druckvorlage!C12") = ""
                    Range("Druckvorlage!C13") = ""
                    Range("Druckvorlage!C14") = ""
                End If
                Range("Druckvorlage!E11").Value = "Wareneingang (Neue(r) Artikel)"
                Sheets("Druckvorlage").Range("A4") = VBA.Replace(CStr(Worksheets("Lieferanten").Cells(CLng(xrow), 2)), Chr$(13) & Chr$(10), " ")
                Sheets("Druckvorlage").Range("A4").WrapText = False
                Sheets("Druckvorlage").Range("A5") = Worksheets("Lieferanten").Cells(CLng(xrow), 3).Text
                Sheets("Druckvorlage").Range("A6") = "'" & Worksheets("Lieferanten").Cells(CLng(xrow), 4)
                Sheets("Druckvorlage").Range("E5") = "'" & Worksheets("Lieferanten").Cells(CLng(xrow), 1)
                Sheets("Druckvorlage").Range("E6") = "'" & Worksheets("Lieferanten").Cells(CLng(xrow), 24)
                Sheets("Druckvorlage").Range("E7") = CStr(Worksheets("Lieferanten").Cells(CLng(xrow), 12))
                Sheets("Druckvorlage").Cells(17, 1) = 1
                Sheets("Druckvorlage").Cells(17, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(17, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(17, 1).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(17, 2) = "'" & Me.txt_Artikelnummer
                Sheets("Druckvorlage").Cells(17, 2).WrapText = True
                Sheets("Druckvorlage").Cells(17, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(17, 3) = "'" & Me.txt_Bezeichnung
                Sheets("Druckvorlage").Cells(17, 3).WrapText = True
                Sheets("Druckvorlage").Cells(17, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(17, 4) = Me.txt_Bestand & " " & Me.cbo_einheit
                Sheets("Druckvorlage").Cells(17, 4).HorizontalAlignment = xlRight
            End If
        End If
    ElseIf chk_WEDruck = True And WertDB1 > 0 Then
        If WertDB1 > 0 Then
            lng = WertDB1
            zeTB = lng + 17
            WertDB1 = lng + 1
            Sheets("Druckvorlage").Cells(zeTB, 1) = WertDB1
            Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
            Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
            Sheets("Druckvorlage").Cells(zeTB, 1).NumberFormat = "@"
            Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & Me.txt_Artikelnummer
            Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
            Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
            Sheets("Druckvorlage").Cells(zeTB, 3) = "'" & Me.txt_Bezeichnung
            Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
            Sheets("Druckvorlage").Cells(zeTB, 3).VerticalAlignment = xlTop
            Sheets("Druckvorlage").Cells(zeTB, 4) = Me.txt_Bestand & " " & Me.cbo_einheit
            Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
        End If
    End If
    Application.Wait (Now + TimeValue("00:00:01"))
    Application.ScreenUpdating = True
    Call Anlegen
    For Each objControl In Controls
        Select Case TypeName(objControl)
           Case "TextBox"
              objControl.Text = ""
           Case "ComboBox"
              objControl.ListIndex = -1
        End Select
    Next
    cboUMST.ListIndex = 0
    cbo_gewicht.ListIndex = -1
    cbo_ASerienNr.ListIndex = 0
    Call WarengruppeCombo
    Call KategorieCombo
    Call HerstellerCombo
    Call LagerortCombo
    Call EinheitCombo
    Set frmArtikel.Image1.Picture = Nothing
    Sheets("center").Activate
    frmArtikel.lbl_LArtikelNr.Caption = "Letzte Artikel Nr.: " & astxt
    cbo_einheit = strEinheit
    txt_Artikelnummer.SetFocus
End Sub
   
Private Sub txt_Bestand_Change()
    If txt_Bestand.Value = "" Then Exit Sub
    If Not IsNumeric(txt_Bestand.Value) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        txt_Bestand.Value = ""
        txt_Bestand.SetFocus
    End If
    If CDbl(txt_Bestand) > 0 And Me.chk_WEDruck = True Then
        Me.cmd_Beleg.Visible = True
    ElseIf WertDB1 > 0 Then
        If CDbl(WertDB1) > 0 Then
            Me.cmd_Beleg.Visible = True
        End If
    Else
        Me.cmd_Beleg.Visible = False
    End If
End Sub

Private Sub txtbestandmin_Change()
    If txtbestandmin.Value = "" Then Exit Sub
    If Not IsNumeric(txtbestandmin.Value) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        txtbestandmin.Value = ""
        txtbestandmin.SetFocus
    End If
End Sub

Private Sub txteinheit_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If Not cbo_einheit = "" Then
        cbo_einheit.BorderColor = &H8000000A
    Else
        cbo_einheit.BorderColor = &HFF&
    End If
End Sub

Private Sub txtEKPreis_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If Not txtEKPreis = "" Then
        txtEKPreis.BorderColor = &H8000000A
    Else
        txtEKPreis.BorderColor = &HFF&
    End If
    If Not txtEKPreis.Value = "" Then
        On Error GoTo weiter
        txtEKPreis2.Value = txtEKPreis.Value
        txtEKPreis.Value = Format(CDbl(txtEKPreis2.Value), "currency")
    End If
    Exit Sub
weiter:
    MsgBox "Fehler im Waehrungsformat!", , "Hinweis"
    txtEKPreis.Value = ""
    txtEKPreis.SetFocus
End Sub

Private Sub txtMeldeBestand_Change()
    If txtMeldeBestand.Value = "" Then Exit Sub
    If Not IsNumeric(txtMeldeBestand.Value) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        txtMeldeBestand.Value = ""
        txtMeldeBestand.SetFocus
    End If
End Sub

Private Sub txtMeldeBestand_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    Call pruefenleer
End Sub

Private Sub txtVKPreis_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    If Not txtVKPreis.Value = "" Then
        txtVKPreis.BorderColor = &H8000000A
    Else
        txtVKPreis.BorderColor = &HFF&
    End If
    If Not txtVKPreis.Value = "" Then
        On Error GoTo weiter
        txtVKPreis2.Value = txtVKPreis.Value
        txtVKPreis.Value = Format(CDbl(txtVKPreis2.Value), "currency")
    End If
    Exit Sub
weiter:
    MsgBox "Fehler im Waehrungsformat!", , "Hinweis"
    txtVKPreis.Value = ""
    txtVKPreis.SetFocus
End Sub

Sub Aendern()
    Dim xzeile, lngZeile As Long
    Dim Palt, Preis As Double
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If txt_Artikelnummer.Value = "" Then
        txt_Artikelnummer.SetFocus
        Exit Sub
    End If
    If txt_Bezeichnung.Value = "" And Not txt_Artikelnummer.Value = "" Then
        MsgBox "Sie m|fffd|ssen zum Artikel " + txt_Artikelnummer + " eine Bezeichnung angeben!", , "Artikel anlegen"
        txt_Bezeichnung.SetFocus
        Call pruefenleer
        Exit Sub
    End If
    If Not txt_Gewicht.Value = "" And cbo_gewicht = "" Then
        cbo_gewicht.BackColor = &H8080FF
        MsgBox "Beim Gewicht fehlt die Einheit", , "Hinweis"
        txt_Gewicht.SetFocus
        Exit Sub
    End If
    Application.ScreenUpdating = False
    xzeile = CDbl(txtAS)
    txtEKPreis2.Value = CDbl(txtEKPreis.Value)
    txtVKPreis2.Value = CDbl(txtVKPreis.Value)
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If Not txt_Gewicht.Value = "" Then
        If IsNumeric(txt_Gewicht.Value) = True Then
            If cbo_gewicht = "gr" Or cbo_gewicht = "g" Then
                Sheets("Lager").Cells(xzeile, 32) = (CDbl(txt_Gewicht.Value / 1000))
                Sheets("Lager").Cells(xzeile, 33) = cbo_gewicht
            Else
                Sheets("Lager").Cells(xzeile, 32) = CDbl(txt_Gewicht)
                Sheets("Lager").Cells(xzeile, 33) = cbo_gewicht
            End If
        Else
            MsgBox "Bitte geben Sie mur Zahlen an!", , "Hinweis: Formatierung Gewicht"
            txt_Gewicht.SetFocus
            Exit Sub
        End If
    Else
        Sheets("Lager").Cells(xzeile, 32) = ""
        Sheets("Lager").Cells(xzeile, 33) = ""
    End If
    If Not IsNumeric(txt_Artikelnummer) Then
        Sheets("Lager").Cells(xzeile, 3) = txt_Artikelnummer.Value
    Else
        Sheets("Lager").Cells(xzeile, 3) = "'" & txt_Artikelnummer.Text
    End If
    If Not IsNumeric(txt_Hnr) Then
        Sheets("Lager").Cells(xzeile, 4) = txt_Hnr.Value
    Else
        Sheets("Lager").Cells(xzeile, 4) = "'" & txt_Hnr.Text
    End If
    If Not IsNumeric(txt_Frei) Then
        Sheets("Lager").Cells(xzeile, 5) = txt_Frei.Value
    Else
        Sheets("Lager").Cells(xzeile, 5) = "'" & txt_Frei.Text
    End If
    Sheets("Lager").Cells(xzeile, 6) = txt_Bezeichnung.Value
    Sheets("Lager").Cells(xzeile, 7) = cbo_Hersteller.Value
    Sheets("Lager").Cells(xzeile, 8) = txt_Bestand.Value
    Sheets("Lager").Cells(xzeile, 10) = txtbestandmin.Value
    Sheets("Lager").Cells(xzeile, 11) = txtMeldeBestand.Value
    Sheets("Lager").Cells(xzeile, 12) = cbo_einheit.Text
    Sheets("Lager").Cells(xzeile, 13) = cboLagerort.Text
    If Not txtEKPreis.Value = "" Then
        If Not CDbl(Sheets("Lager").Cells(xzeile, 14)) = CDbl(txtEKPreis.Value) Then
            lngZeile = Worksheets("Preisverlauf").Cells(Rows.Count, 1).End(xlUp).Row + 1
            Sheets("Preisverlauf").Activate
            Worksheets("Preisverlauf").Cells(lngZeile, 1).Value = txtID
            Worksheets("Preisverlauf").Cells(lngZeile, 2).Value = "'" & txt_Artikelnummer
            Worksheets("Preisverlauf").Cells(lngZeile, 3).Value = "EK"
            Worksheets("Preisverlauf").Cells(lngZeile, 4).Value = CDbl(Sheets("Lager").Cells(xzeile, 14))
            Worksheets("Preisverlauf").Cells(lngZeile, 5).Value = CDbl(txtEKPreis.Value)
            Worksheets("Preisverlauf").Cells(lngZeile, 6).Value = Format(Date, "DD.MM.YYYY")
            Worksheets("Preisverlauf").Cells(lngZeile, 7).Value = frmLager.lbl_Benutzer
            Sheets("Lager").Cells(xzeile, 14) = CDbl(txtEKPreis.Value)
        End If
    End If
    Sheets("Lager").Cells(xzeile, 16) = cboWarengruppe.Value
    Sheets("Lager").Cells(xzeile, 17) = Format(Date, "DD.MM.YYYY")
    If Not cboLieferant = "" Then
        Sheets("Lager").Cells(xzeile, 18) = "'" & txtLNr.Value
    End If
    Sheets("Lager").Cells(xzeile, 19) = "" 'Frei (war 2ter Lieferant)
    Sheets("Lager").Cells(xzeile, 20) = txtKommentar.Text
    If cboUMST.Value = "ohne" Then
        Sheets("Lager").Cells(xzeile, 21) = "0"
    Else
        Sheets("Lager").Cells(xzeile, 21) = CDbl(Format(cboUMST.Value, "#.#0,0"))
    End If
    If Len(txtPDF.Text) > 0 Then
        Sheets("Lager").Cells(xzeile, 27).FormulaLocal = "=HYPERLINK(" & _
        Chr(34) & "file:///" & txtPDF.Text & Chr(34) & ";" & _
        Chr(34) & StrReverse(Split(StrReverse(txtPDF.Text), "\")(0)) & Chr(34) & ")"
    End If
    If Len(txtjpg.Text) > 0 Then
        Sheets("Lager").Cells(xzeile, 28).FormulaLocal = "=HYPERLINK(" & _
        Chr(34) & "file:///" & txtjpg.Text & Chr(34) & ";" & _
        Chr(34) & StrReverse(Split(StrReverse(txtjpg.Text), "\")(0)) & Chr(34) & ")"
    End If
    
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Sheets("Lager").Cells(xzeile, 29).Value = Sheets("Daten").Range("B22").Value
    Else
        If Sheets("Daten").Range("B5").Value = "True" Then
            Sheets("Lager").Cells(xzeile, 29).Value = Sheets("Daten").Range("B24").Value
        End If
    End If
    If cbo_ASerienNr = "Nein" Or cbo_ASerienNr = "" Then
        Sheets("Lager").Cells(xzeile, 30) = "N"
    Else
        Sheets("Lager").Cells(xzeile, 30) = "Y"
    End If
    Sheets("Lager").Cells(xzeile, 31) = "'" & txt_Barcode.Value
    Sheets("Lager").Cells(xzeile, 34) = txt_laenge.Value
    Sheets("Lager").Cells(xzeile, 35) = txt_breite.Value
    Sheets("Lager").Cells(xzeile, 36) = txt_tiefe.Value
    Sheets("Lager").Cells(xzeile, 37) = txt_durchmesser.Value
    Sheets("Lager").Cells(xzeile, 38) = cbo_masse
    Sheets("Lager").Cells(xzeile, 39) = txt_Verwendbar.Value
    Sheets("Lager").Cells(xzeile, 40) = txt_VerwendbarEr.Value
    Sheets("Lager").Cells(xzeile, 41) = cbo_Kategorie
    If chk_ASperren.Value = True Then
        If Sheets("Lager").Cells(xzeile, 42) = "" Then
            Sheets("Lager").Cells(xzeile, 42) = Date
        End If
    Else
        Sheets("Lager").Cells(xzeile, 42) = ""
    End If
    If Not txtVKPreis.Value = "" Then
        Palt = Sheets("Lager").Cells(xzeile, 15).Value
        If op_Brutto.Value = True Then
            If txtVKPreis.Value = "" Then
                Sheets("Lager").Cells(xzeile, 15) = 0
            Else
                If cboUMST = "ohne" Then
                    Sheets("Lager").Cells(xzeile, 15).Value = CDbl(txtVKPreis.Value)
                    Sheets("Lager").Cells(xzeile, 22).Value = "B"
                    Preis = CDbl(txtVKPreis.Value)
                Else
                    Sheets("Lager").Cells(xzeile, 15).Value = CDbl(txtVKPreis.Value) * (100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100))
                    Sheets("Lager").Cells(xzeile, 22).Value = "B"
                    Preis = CDbl(txtVKPreis.Value) * (100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100))
                End If
            End If
        Else
            If txtVKPreis.Value = "" Then
                ActiveCell.Offset(0, 12).Value = "0"
            Else
                If cboUMST = "ohne" Then
                    Sheets("Lager").Cells(xzeile, 15).Value = CDbl(txtVKPreis.Value)
                    Sheets("Lager").Cells(xzeile, 22).Value = "N"
                    Preis = CDbl(txtVKPreis.Value)
                Else
                    Sheets("Lager").Cells(xzeile, 15).Value = CDbl(txtVKPreis.Value)
                    Sheets("Lager").Cells(xzeile, 22).Value = "N"
                    Preis = CDbl(txtVKPreis.Value)
                End If
            End If
        End If
        lngZeile = Worksheets("Preisverlauf").Cells(Rows.Count, 1).End(xlUp).Row + 1
        If Not CDbl(Palt) = CDbl(Preis) Then
            Sheets("Preisverlauf").Activate
            Worksheets("Preisverlauf").Cells(lngZeile, 1).Value = txtID
            Worksheets("Preisverlauf").Cells(lngZeile, 2).Value = "'" & txt_Artikelnummer
            Worksheets("Preisverlauf").Cells(lngZeile, 3).Value = "VK"
            Worksheets("Preisverlauf").Cells(lngZeile, 4).Value = CDbl(Palt)
            Worksheets("Preisverlauf").Cells(lngZeile, 5).Value = CDbl(Preis)
            Worksheets("Preisverlauf").Cells(lngZeile, 6).Value = Format(Date, "DD.MM.YYYY")
            Worksheets("Preisverlauf").Cells(lngZeile, 7).Value = frmLager.lbl_Benutzer
        End If
    End If
    Sheets("Center").Activate
    ActiveWorkbook.Save
    Application.ScreenUpdating = True
    frmLager.cboArtikelnummer.Value = txt_Artikelnummer.Value
    frmLager.cboArtikelnummer.Value = txt_Artikelnummer.Text
    Call frmLager.Asuchen
    Call frmLager.SuchenR
    Unload frmArtikel
    frmLager.Show
End Sub

Private Sub cmdaendern_Click()
    lbl_save.Visible = True
    Application.Wait (Now + TimeValue("00:00:01"))
    Call Aendern
End Sub

Sub Anlegen() '1.44
    Dim lngZeile, letztezeile, zeile, zeile2, z, MaxID, lngZ As Long
    Dim Dstr, DIstr, LSStr As String
    On Error Resume Next

    zeile = 0
    Call pruefenleer
    If Not txt_Gewicht.Value = "" And cbo_gewicht = "" Then
        cbo_gewicht.BackColor = &H8080FF
        MsgBox "Beim Gewicht fehlt die Einheit", , "Hinweis"
        txt_Gewicht.SetFocus
        Exit Sub
    Else
        cbo_gewicht.BackColor = &H8000000E
    End If
    Application.ScreenUpdating = False
    Sheets("Lager").Activate
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    MaxID = 0
    For z = 2 To letztezeile
        If CDbl(Cells(z, 1)) > MaxID Then
            MaxID = CDbl(Cells(z, 1))
        End If
    Next
    If Sheets("Daten").Cells(18, 2) = "" Or Sheets("Daten").Cells(18, 2) = 0 Then
        If CDbl(MaxID) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(18, 2).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(MaxID) > CDbl(Sheets("Daten").Cells(18, 2).Value) Then
            zeile = CDbl(MaxID) + 1
            Sheets("Daten").Cells(18, 2).Value = CDbl(MaxID) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(18, 2).Value) + 1
            Sheets("Daten").Cells(18, 2).Value = CDbl(Sheets("Daten").Cells(18, 2).Value) + 1
        End If
    End If
    zeile2 = CDbl(letztezeile)
    lngZeile = Worksheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row + 1
    Dstr = MsgBox("M|fffd|chten Sie das Erfassungsdatum von heute verwenden?", vbYesNo, "Erfasst am:")
    Sheets("Lager").Activate
    If Not txt_Gewicht.Value = "" Then
        If IsNumeric(txt_Gewicht.Value) = True Then
            If cbo_gewicht = "gr" Or cbo_gewicht = "g" Then
                Sheets("Lager").Cells(lngZeile, 32).Value = CDbl(txt_Gewicht / 1000)
            Else
                Sheets("Lager").Cells(lngZeile, 32).Value = CDbl(txt_Gewicht)
            End If
            Sheets("Lager").Cells(lngZeile, 33).Value = cbo_gewicht
        Else
            MsgBox "Bitte geben Sie mur Zahlen an!", , "Hinweis: Formatierung Gewicht"
            txt_Gewicht.SetFocus
            Exit Sub
            Application.ScreenUpdating = True
        End If
    Else
        Sheets("Lager").Cells(lngZeile, 32).Value = ""
        Sheets("Lager").Cells(lngZeile, 33).Value = ""
    End If
    Sheets("Lager").Cells(lngZeile, 1).Value = "'" & zeile
    If Dstr = vbYes Then
        Sheets("Lager").Cells(lngZeile, 2).Value = Format(Date, "dd.mm.yyyy")
        DIstr = Date
    ElseIf Dstr = vbNo Then
        DIstr = InputBox("Bitte geben Sie ein Datum ein!" & vbLf & "Format: DD.MM.YYYY", "Erfasst am:")
        If DIstr = "" Then
            If WertDB1 = 1 Then
                Range("Druckvorlage!E3").Value = Format(Date, "dd.mm.yyyy")
            End If
            Sheets("Lager").Cells(lngZeile, 2).Value = Format(Date, "dd.mm.yyyy")
            DIstr = Date
        Else
            Sheets("Lager").Cells(lngZeile, 2).Value = Format(CDate(DIstr), "DD.MM.YYYY")
        End If
    End If
    If Not IsNumeric(txt_Artikelnummer) Then
        Sheets("Lager").Cells(lngZeile, 3).Value = txt_Artikelnummer.Value
    Else
        Sheets("Lager").Cells(lngZeile, 3).Value = "'" + txt_Artikelnummer.Text
    End If
    If Not IsNumeric(txt_Hnr) Then
        Sheets("Lager").Cells(lngZeile, 4).Value = txt_Hnr.Value
    Else
        Sheets("Lager").Cells(lngZeile, 4).Value = "'" + txt_Hnr.Text
    End If
    If Not IsNumeric(txt_Frei) Then
        Sheets("Lager").Cells(lngZeile, 5).Value = txt_Frei.Value
    Else
        Sheets("Lager").Cells(lngZeile, 5).Value = "'" + txt_Frei.Text
    End If
    Sheets("Lager").Cells(lngZeile, 6).Value = txt_Bezeichnung.Value
    Sheets("Lager").Cells(lngZeile, 7).Value = cbo_Hersteller.Value
    If txt_Bestand.Value = "" Then
        Sheets("Lager").Cells(lngZeile, 8).Value = "0"
    Else
        Sheets("Lager").Cells(lngZeile, 8).Value = txt_Bestand.Value
    End If
    Sheets("Lager").Cells(lngZeile, 10).Value = txtbestandmin.Value
    Sheets("Lager").Cells(lngZeile, 11).Value = txtMeldeBestand.Value
    Sheets("Lager").Cells(lngZeile, 12).Value = cbo_einheit.Text
    Sheets("Lager").Cells(lngZeile, 13).Value = cboLagerort.Text
    If txtEKPreis.Value = "" Then
        Sheets("Lager").Cells(lngZeile, 14).Value = "0"
    Else
        Sheets("Lager").Cells(lngZeile, 14).Value = CDbl(txtEKPreis2.Value)
    End If
    If op_Brutto.Value = True Then
        If txtVKPreis2.Value = "" Then
            Sheets("Lager").Cells(lngZeile, 15).Value = "0"
        Else
            If cboUMST = "ohne" Then
                Sheets("Lager").Cells(lngZeile, 15).Value = CDbl(txtVKPreis2.Value)
                Sheets("Lager").Cells(lngZeile, 22).Value = "B"
                If txt_Verleih.Value = "Kasse" Then
                    frmKasse.lbl_VKPreisKasse.Caption = CDbl(txtVKPreis2.Value)
                End If
            Else
                Sheets("Lager").Cells(lngZeile, 15).Value = CDbl(txtVKPreis.Value) * (100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100))
                Sheets("Lager").Cells(lngZeile, 22).Value = "B"
                If txt_Verleih.Value = "Kasse" Then
                    frmKasse.lbl_VKPreisKasse.Caption = CDbl(txtVKPreis2.Value) * (100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100))
                End If
            End If
        End If
    Else
        If txtVKPreis2.Value = "" Then
            Sheets("Lager").Cells(lngZeile, 15).Value = "0"
        Else
            If cboUMST = "ohne" Then
                Sheets("Lager").Cells(lngZeile, 15).Value = CDbl(txtVKPreis2.Value)
                Sheets("Lager").Cells(lngZeile, 22).Value = "N"
                If txt_Verleih.Value = "Kasse" Then
                    frmKasse.lbl_VKPreisKasse.Caption = CDbl(txtVKPreis2.Value)
                End If
            Else
                Sheets("Lager").Cells(lngZeile, 15).Value = CDbl(txtVKPreis2.Value)
                Sheets("Lager").Cells(lngZeile, 22).Value = "N"
                If txt_Verleih.Value = "Kasse" Then
                    frmKasse.lbl_VKPreisKasse.Caption = CDbl(txtVKPreis2.Value)
                End If
            End If
        End If
    End If
    Sheets("Lager").Cells(lngZeile, 16).Value = cboWarengruppe.Value
    If Not cboLieferant = "" Then
        Sheets("Lager").Cells(lngZeile, 18).Value = "'" & txtLNr.Value
    End If
    Sheets("Lager").Cells(lngZeile, 20).Value = txtKommentar.Value
    If cboUMST = "ohne" Then
        Sheets("Lager").Cells(lngZeile, 21).Value = "0"
    Else
        Sheets("Lager").Cells(lngZeile, 21).Value = CDbl(Format(cboUMST.Value, "#.#0,0"))
    End If
    'PDF Hyperlink speichern
    If Len(txtPDF.Value) > 0 Then
        Sheets("Lager").Cells(lngZeile, 27).FormulaLocal = "=HYPERLINK(" & _
        Chr(34) & "file:///" & txtPDF.Text & Chr(34) & ";" & _
        Chr(34) & StrReverse(Split(StrReverse(txtPDF.Text), "\")(0)) & Chr(34) & ")"
    End If
    'Bild speichern
    If Len(txtjpg.Value) > 0 Then
        Sheets("Lager").Cells(lngZeile, 28).FormulaLocal = "=HYPERLINK(" & _
        Chr(34) & "file:///" & txtjpg.Text & Chr(34) & ";" & _
        Chr(34) & StrReverse(Split(StrReverse(txtjpg.Text), "\")(0)) & Chr(34) & ")"
    End If
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Sheets("Lager").Cells(lngZeile, 29).Value = Sheets("Daten").Range("B22").Value
    Else
        If Sheets("Daten").Range("B5").Value = "True" Then
            Sheets("Lager").Cells(lngZeile, 29).Value = Sheets("Daten").Range("B24").Value
        End If
    End If
    'Seriennummer
    If cbo_ASerienNr = "Nein" Or cbo_ASerienNr = "" Then
        Sheets("Lager").Cells(lngZeile, 30).Value = "N"
    Else
        Sheets("Lager").Cells(lngZeile, 30).Value = "Y"
    End If
    Sheets("Lager").Cells(lngZeile, 31).Value = "'" & txt_Barcode.Value
    If Not txt_laenge.Value = "" Then Sheets("Lager").Cells(lngZeile, 34).Value = CDbl(txt_laenge.Value)
    If Not txt_breite.Value = "" Then Sheets("Lager").Cells(lngZeile, 35).Value = CDbl(txt_breite.Value)
    If Not txt_tiefe.Value = "" Then Sheets("Lager").Cells(lngZeile, 36).Value = CDbl(txt_tiefe.Value)
    If Not txt_durchmesser.Value = "" Then Sheets("Lager").Cells(lngZeile, 37).Value = CDbl(txt_durchmesser.Value)
    Sheets("Lager").Cells(lngZeile, 38).Value = cbo_masse
    Sheets("Lager").Cells(lngZeile, 39).Value = txt_Verwendbar.Value
    Sheets("Lager").Cells(lngZeile, 40).Value = txt_VerwendbarEr.Value
    Sheets("Lager").Cells(lngZeile, 41).Value = cbo_Kategorie
    If Not Me.txt_Bestand = "" And CDbl(txt_Bestand) > 0 Then
        lngZ = Worksheets("Wareneingang").Cells(Rows.Count, 1).End(xlUp).Row + 1
        Worksheets("Wareneingang").Cells(lngZ, 1).Value = "#ID" & zeile & "_" & Format(Date, "DDMMYY")
        Worksheets("Wareneingang").Cells(lngZ, 2).Value = CStr(Me.cboLieferant)
        Worksheets("Wareneingang").Cells(lngZ, 3).Value = "'" & CStr(Me.txt_Artikelnummer)
        Worksheets("Wareneingang").Cells(lngZ, 4).Value = "'" & CStr(Me.txt_Hnr)
        Worksheets("Wareneingang").Cells(lngZ, 5).Value = CStr(Me.txt_Bezeichnung)
        Worksheets("Wareneingang").Cells(lngZ, 6).Value = CDbl(Me.txt_Bestand)
        Worksheets("Wareneingang").Cells(lngZ, 7).Value = "Neuer Artikel (mit Bestand)"
        Worksheets("Wareneingang").Cells(lngZ, 8).Value = Format(DIstr, "DD.MM.YYYY")
        Worksheets("Wareneingang").Cells(lngZ, 9).Value = Format(Time, "hh:mm:ss")
        If txtEKPreis.Value = "" Then
            Worksheets("Wareneingang").Cells(lngZ, 11).Value = 0
        Else
            Worksheets("Wareneingang").Cells(lngZ, 11).Value = CDbl(Me.txtEKPreis)
        End If
        Worksheets("Wareneingang").Cells(lngZ, 12).Value = "'" & zeile
        Worksheets("Wareneingang").Cells(lngZ, 13).Value = Sheets("Daten").Range("B24")
        LSStr = MsgBox("M|fffd|chten Sie eine Lieferscheinnummer erfassen?", vbYesNo, "Lieferscheinnummer")
        If LSStr = vbYes Then
            LSStr = InputBox("Bitte geben Sie eine Lieferscheinnummer an!", "Lieferscheinnummer")
            If Not LSStr = "" Then
                Worksheets("Wareneingang").Cells(lngZ, 19).Value = "'" & LSStr
                If WertDB1 = 1 And Me.chk_WEDruck.Value = True Then
                    Range("Druckvorlage!E2").Value = "'" & LSStr
                ElseIf Range("Druckvorlage!E2").Value = "" Then
                    Range("Druckvorlage!E2").Value = "'" & LSStr
                End If
            End If
        End If
        Worksheets("Wareneingang").Cells(lngZ, 16).Value = Format(DIstr, "MMMM")
        Worksheets("Wareneingang").Cells(lngZ, 17).Value = Format(DIstr, "YYYY")
        Worksheets("Wareneingang").Cells(lngZ, 18).Value = Me.cboLagerort
    End If
    'letzte Artikelnummer
    Sheets("Daten").Range("B33") = "'" & txt_Artikelnummer.Value
    If txt_Verleih.Value = "Verleih" Then
        frmVerleih.txt_VArtikelID.Value = zeile
        frmVerleih.lbl_VArtikelNr.Caption = txt_Artikelnummer.Text
        frmVerleih.lbl_VBezeichnung.Caption = txt_Bezeichnung.Value
        frmVerleih.lbl_VHersteller.Caption = cbo_Hersteller.Value
        frmVerleih.lbl_VHerstellerNR.Caption = txt_Hnr.Text
        frmVerleih.txt_Verfuegbar.Value = txt_Bestand.Value
        frmVerleih.lbl_Verfuegbar.Caption = "Verf|fffd|gbar: " & txt_Bestand.Value
        Call frmLager.ArtikelCombo
    ElseIf txt_Verleih.Value = "Kasse" Then
        Call frmLager.ArtikelCombo
        frmKasse.txtArtikelnummerSicherung.Value = txt_Artikelnummer.Text
        frmKasse.txtzeile.Value = zeile2
        frmKasse.txtID.Value = zeile
        frmKasse.lbl_ArtikelNR.Caption = txt_Artikelnummer.Text
        frmKasse.lbl_bezeichnung.Caption = txt_Bezeichnung.Value
        frmKasse.lbl_Hersteller.Caption = cbo_Hersteller.Value
        frmKasse.lbl_herstellerNr.Caption = txt_Hnr.Text
        frmKasse.lbl_UMST.Caption = cboUMST
        frmKasse.cmdletzterArtikel.Visible = True
    ElseIf txt_Verleih.Value = "BestO" Then
        Call frmWareneingangoB.ArtikelCombo
        frmWareneingangoB.cboArtikelNR = txt_Artikelnummer.Text
    ElseIf txt_Verleih.Value = "Best" Then
        Call frmBestellung.ArtikelCombo
        frmBestellung.cboLieferant.Text = cboLieferant
        frmBestellung.cboArtikelNR.Text = txt_Artikelnummer.Value
    ElseIf txt_Verleih.Value = "Grup" Then
        Call frmGruppenanlegen.ArtikelCombo
        frmGruppenanlegen.cboArtikelNR = txt_Artikelnummer.Value
    End If
    Sheets("center").Activate
    Call AnsichtLager
    Call DatenAll2
    ActiveWorkbook.Save
    frmLager.cboArtikelnummer.Value = txt_Artikelnummer.Value
    Application.ScreenUpdating = True
    lbl_save.Visible = False
End Sub

Private Sub cmdanlegen_Click()
    Dim Last_Row, arrTmpA, arrTmpB, i, xrow, irow, lng As Long
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2, xrow2 As Long
    Dim msgstr As Integer
    On Error Resume Next
    If txt_Artikelnummer.Value = "" Then
        MsgBox "Sie m|fffd|ssen eine Artikelnummer angeben!", vbOKOnly, "Anlegen"
        txt_Artikelnummer.SetFocus
        Call pruefenleer
        Exit Sub
    End If
    If txt_Bezeichnung.Value = "" And Not txt_Artikelnummer.Value = "" Then
        MsgBox "Sie m|fffd|ssen zum Artikel " + txt_Artikelnummer + " eine Bezeichnung angeben!", , "Artikel anlegen"
        txt_Bezeichnung.SetFocus
        Call pruefenleer
        Exit Sub
    End If
    lbl_save.Visible = True
    lbl_save.Caption = "Artikel (" + txt_Bezeichnung.Value + ") wird angelegt!"
    lbl_save.BackColor = &HC000&
    lbl_save.BorderColor = &HC000&
    Application.ScreenUpdating = False
    If chk_WEDruck = True And WertDB1 < 1 Then
        If txt_Bestand.Value = "" Then
            txt_Bestand.Value = 0
        End If
        If Not cboLieferant = "" And CDbl(txt_Bestand) > 0 Then
            WertDB1 = 1
            cmd_Beleg.Visible = True
            With ThisWorkbook.Sheets("Lieferanten")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtLNr) Then
                        xrow = i
                    End If
                Next i
            End With
            If xrow > 0 Then
                irow = CLng(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
                ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & irow).Delete
                Range("Druckvorlage!E4").Value = Format(Date, "DD.MM.YYYY")
                Range("Druckvorlage!E2").Value = ""
                Range("Druckvorlage!E5").Value = ""
                Range("Druckvorlage!E6").Value = ""
                Range("Druckvorlage!E7").Value = ""
                Range("Druckvorlage!E16").Value = ""
                Range("Druckvorlage!F16").Value = ""
                Range("Druckvorlage!A3").Value = "Lieferant"
                Range("Druckvorlage!D3") = "Lieferdatum:"
                Range("Druckvorlage!D5") = "Lieferanten-Nr.:"
                Range("Druckvorlage!D6") = "Meine Kunden Nr.:"
                Range("Druckvorlage!E11").Value = "Wareneingang (Neue(r) Artikel)"
                If Not Sheets("Daten").Range("B24") = "" Then
                    With ThisWorkbook.Sheets("Mitarbeiter")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 2) & ", " & arrTmpA2(i2, 3) = CStr(Sheets("Daten").Range("B24")) Then
                                xrow2 = i2
                            End If
                        Next i2
                    End With
                    Range("Druckvorlage!C11") = CStr(Sheets("Daten").Range("B24"))
                    Range("Druckvorlage!C12") = "'" & Worksheets("Mitarbeiter").Cells(CLng(xrow2), 5)
                    Range("Druckvorlage!C13") = "'" & Worksheets("Mitarbeiter").Cells(CLng(xrow2), 6)
                    Range("Druckvorlage!C14") = "'" & Worksheets("Mitarbeiter").Cells(CLng(xrow2), 4)
                Else
                    Range("Druckvorlage!C11") = ""
                    Range("Druckvorlage!C12") = ""
                    Range("Druckvorlage!C13") = ""
                    Range("Druckvorlage!C14") = ""
                End If
                Sheets("Druckvorlage").Range("A4") = VBA.Replace(CStr(Worksheets("Lieferanten").Cells(CLng(xrow), 2)), Chr$(13) & Chr$(10), " ")
                Sheets("Druckvorlage").Range("A4").WrapText = False
                Sheets("Druckvorlage").Range("A5") = Worksheets("Lieferanten").Cells(CLng(xrow), 3).Text
                Sheets("Druckvorlage").Range("A6") = "'" & Worksheets("Lieferanten").Cells(CLng(xrow), 4)
                Sheets("Druckvorlage").Range("E5") = "'" & Worksheets("Lieferanten").Cells(CLng(xrow), 1)
                Sheets("Druckvorlage").Range("E6") = "'" & Worksheets("Lieferanten").Cells(CLng(xrow), 24)
                Sheets("Druckvorlage").Range("E7") = CStr(Worksheets("Lieferanten").Cells(CLng(xrow), 12))
                Sheets("Druckvorlage").Cells(17, 1) = 1
                Sheets("Druckvorlage").Cells(17, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(17, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(17, 1).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(17, 2) = "'" & Me.txt_Artikelnummer
                Sheets("Druckvorlage").Cells(17, 2).WrapText = True
                Sheets("Druckvorlage").Cells(17, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(17, 3) = "'" & Me.txt_Bezeichnung
                Sheets("Druckvorlage").Cells(17, 3).WrapText = True
                Sheets("Druckvorlage").Cells(17, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(17, 4) = Me.txt_Bestand & " " & Me.cbo_einheit
                Sheets("Druckvorlage").Cells(17, 4).HorizontalAlignment = xlRight
            End If
        End If
    End If
    Application.Wait (Now + TimeValue("00:00:01"))
    Application.ScreenUpdating = True
    Call Anlegen
    Sheets("Daten").Range("B21").Value = frmArtikel.cbo_einheit
    If WertDB1 > 0 Then
        msgstr = MsgBox("M|fffd|chten Sie noch einen Beleg Ausdrucken?", vbYesNo, "Hindweis")
        If msgstr = vbYes Then
            Application.ScreenUpdating = False
            Worksheets("Druckvorlage").PrintOut
            Sheets("Center").Activate
            Application.ScreenUpdating = True
            GoTo weiter
        Else
            GoTo weiter
        End If
    End If
weiter:
    Unload frmArtikel
    If txt_Verleih.Value = "" Then
        frmLager.Show
        With frmLager
            UserForm_Initialize
        End With
    End If
End Sub

Private Sub cboLieferant_Change()
    Dim arrTmpA, arrTmpB, i As Long
    Dim SuchKriterium, n As String, Last_Row As Long
    On Error Resume Next
    
    If cboLieferant = "" Then
        lbl_HLieferant.Caption = "Kein Hauptlieferant vorhanden!"
        lbl_HLieferantEK.Caption = ""
        Exit Sub
    Else
        lbl_HLieferant.Caption = cboLieferant
        lbl_HLieferantEK.Caption = Format(CDbl(txtEKPreis), "currency")
    End If
    SuchKriterium = CStr(frmArtikel.cboLieferant)
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lieferanten")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And CStr(VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ")) Like SuchKriterium Then
                n = arrTmpA(i, 1)
            End If
       Next i
       frmArtikel.txtLNr.Value = n
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cmdBild_Click()
    Dim r As Variant
    On Error Resume Next
    r = Application.GetOpenFilename("Bilder / Fotos (*.jpg), *.jpg")
    If r <> False Then
        txtjpg.Text = CStr(r)
    End If
    Set frmArtikel.Image1.Picture = LoadPicture(txtjpg)
    lbl_bild.Visible = False
End Sub

Private Sub cmdchanel_Click()
    On Error Resume Next
    If Not txt_Verleih.Value = "Verleih" Then
        If txt_Artikelnummer.Value = "" Then
            Unload frmArtikel
            frmLager.ArtikelCombo
            frmLager.Show
            frmLager.txt_item.SetFocus
        Else
            frmLager.cboArtikelnummer.Value = txt_Artikelnummer.Value
            frmLager.ArtikelDrop
            Unload frmArtikel
            frmLager.Show
            frmLager.txt_item.SetFocus
        End If
    Else
        Unload frmArtikel
    End If
End Sub

Private Sub cmdpdf_Click()
    Dim pdfV As Variant
    On Error Resume Next
    pdfV = Application.GetOpenFilename("PDF-Dateien (*.pdf), *.pdf")
    If pdfV <> False Then
        txtPDF.Text = CStr(pdfV)
    End If
End Sub

Private Sub cmd_NewLiefer_Click()
    frmLieferanten.txtVerweisArtikel.Value = 1
    frmLieferanten.txtLNr.SetFocus
    frmLieferanten.Show
End Sub

Private Sub cmdPDFloeschen_Click()
    Dim lngMsg, lngZeile As Long
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If txtPDFa.Value = "" Then Exit Sub
    lngZeile = CDbl(txtAS)
    lngMsg = MsgBox("PDF - Datei l|fffd|schen?", vbYesNo, "Hinweis")
    If lngMsg = vbYes Then
        Sheets("Lager").Cells(lngZeile, 27) = ""
    Else
        Exit Sub
    End If
    txtPDFa.Value = "Keine PDF gespeichert"
    MsgBox "PDF wurde gel|fffd|scht", vbOKOnly, "Hinweis"
End Sub

Private Sub cmdkalk_Click()
    On Error Resume Next
    If txtEKPreis.Value = "" Then
        frmKalk.txtEKPreis.Value = Format(0, "currency")
        frmKalk.txtEKPreis.Value = Format(frmKalk.txtEKPreis.Value, "currency")
        frmKalk.cboLieferant = cboLieferant
        frmKalk.Show
        frmKalk.rechnenKalk
    Else
        frmKalk.txtEKPreis.Value = Format(CDbl(frmArtikel.txtEKPreis.Value), "currency")
        frmKalk.cboLieferant = cboLieferant
        frmKalk.Show
        frmKalk.rechnenKalk
    End If
End Sub

Private Sub cmdBildloeschen_Click()
    Dim lngZeile As Long
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If Not txtAS.Value = "" Then
        lngZeile = txtAS.Value
    Else
        Exit Sub
    End If
    If Sheets("Lager").Cells(lngZeile, 28) = "" Then Exit Sub
    Sheets("Lager").Cells(lngZeile, 28) = ""
    Call bild
    MsgBox "Bild wurde entfernt", vbOKOnly, "Hinweis"
End Sub

Sub WarengruppeCombo()
    Dim objDic  As Object
    Dim lngZ    As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 8).End(xlUp).Row
      objDic(Sheets("Daten").Cells(lngZ, 8).Value) = 0
    Next
    cboWarengruppe.List = objDic.keys
    Set objDic = Nothing
    Call SortierenWG
    Application.ScreenUpdating = True
End Sub

Sub SortierenWG()
    Dim i_Erster As Integer
    Dim i_Letzter As Integer
    Dim i_Aktuell As Integer
    Dim i_N|fffd|chster As Integer
    Dim s_buffer As String
    With frmArtikel.cboWarengruppe
        Application.ScreenUpdating = False
        i_Erster = 0
        i_Letzter = .ListCount - 1
        For i_Aktuell = i_Erster To i_Letzter
            For i_N|fffd|chster = i_Aktuell + 1 To i_Letzter
                If .List(i_Aktuell) > .List(i_N|fffd|chster) Then
                    s_buffer = .List(i_N|fffd|chster)
                    .List(i_N|fffd|chster) = .List(i_Aktuell)
                    .List(i_Aktuell) = s_buffer
                End If
            Next i_N|fffd|chster
        Next i_Aktuell
    End With
    Application.ScreenUpdating = True
End Sub

Sub KategorieCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 9).End(xlUp).Row
      objDic(Sheets("Daten").Cells(lngZ, 9).Value) = 0
    Next
    cbo_Kategorie.List = objDic.keys
    Set objDic = Nothing
    Call SortierenKG
    Application.ScreenUpdating = True
End Sub

Sub SortierenKG()
    Dim i_Erster As Integer
    Dim i_Letzter As Integer
    Dim i_Aktuell As Integer
    Dim i_N|fffd|chster As Integer
    Dim s_buffer As String
    Application.ScreenUpdating = False
    If cbo_Kategorie.ListCount = 0 Then Exit Sub
    With frmArtikel.cbo_Kategorie
        i_Erster = 0
        i_Letzter = .ListCount - 1
        For i_Aktuell = i_Erster To i_Letzter
            For i_N|fffd|chster = i_Aktuell + 1 To i_Letzter
                If .List(i_Aktuell) > .List(i_N|fffd|chster) Then
                    s_buffer = .List(i_N|fffd|chster)
                    .List(i_N|fffd|chster) = .List(i_Aktuell)
                    .List(i_Aktuell) = s_buffer
                End If
            Next i_N|fffd|chster
        Next i_Aktuell
    End With
    Application.ScreenUpdating = True
End Sub

Sub EinheitCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 11).End(xlUp).Row
      objDic(Sheets("Daten").Cells(lngZ, 11).Value) = 0
    Next
    cbo_einheit.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
End Sub

Sub bild()
    Dim lngLine As Long
    Dim strFile, strID As String
    Dim objLines, objItems As Collection
    Set objLines = New Collection
    Set objItems = New Collection
    On Error Resume Next
    strID = txtID.Value
    lngLine = txtAS
    If lngLine > 0 Then
        If Len(Sheets("Lager").Cells(lngLine, 28).Value) > 0 Then
            strFile = Sheets("Lager").Cells(lngLine, 28).Formula
            strFile = Split(strFile, "(" & Chr(34))(1)
            strFile = Split(strFile, Chr(34) & ",")(0)
            strFile = Replace(strFile, "file:///", "")
            Set frmArtikel.Image1.Picture = LoadPicture(strFile)
            lbl_bild.Visible = False
        Else
            Set frmArtikel.Image1.Picture = Nothing
            lbl_bild.Visible = True
        End If
    End If
    Set objLines = Nothing
    Set objItems = Nothing
End Sub

Sub HerstellerCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 10).End(xlUp).Row
      objDic(Sheets("Daten").Cells(lngZ, 10).Value) = 0
    Next
    cbo_Hersteller.List = objDic.keys
    Set objDic = Nothing
    Call SortierenHS
    Application.ScreenUpdating = True
End Sub

Sub SortierenHS()
    Dim i_Erster As Integer
    Dim i_Letzter As Integer
    Dim i_Aktuell As Integer
    Dim i_N|fffd|chster As Integer
    Dim s_buffer As String
    Application.ScreenUpdating = False
    If cbo_Hersteller.ListCount = 0 Then Exit Sub
    With frmArtikel.cbo_Hersteller
        If .ListCount = 0 Then Exit Sub
        i_Erster = 0
        i_Letzter = .ListCount - 1
        For i_Aktuell = i_Erster To i_Letzter
            For i_N|fffd|chster = i_Aktuell + 1 To i_Letzter
                If .List(i_Aktuell) > .List(i_N|fffd|chster) Then
                    s_buffer = .List(i_N|fffd|chster)
                    .List(i_N|fffd|chster) = .List(i_Aktuell)
                    .List(i_Aktuell) = s_buffer
                End If
            Next i_N|fffd|chster
        Next i_Aktuell
    End With
    Application.ScreenUpdating = True
End Sub

Sub LagerortCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 12).End(xlUp).Row
      objDic(Sheets("Daten").Cells(lngZ, 12).Value) = 0
    Next
    cboLagerort.List = objDic.keys
    Set objDic = Nothing
    Call SortierenComboboxLort
    Application.ScreenUpdating = True
End Sub

Sub SortierenComboboxLort()
    Dim i_Erster As Integer
    Dim i_Letzter As Integer
    Dim i_Aktuell As Integer
    Dim i_N|fffd|chster As Integer
    Dim s_buffer As String
    On Error Resume Next
    If cboLagerort.ListCount = 0 Then Exit Sub
    Application.ScreenUpdating = False
    With cboLagerort
        i_Erster = 0
        If CLng(.ListCount - 1) > 1000 Then
            Exit Sub
            Application.ScreenUpdating = True
        End If
        i_Letzter = .ListCount - 1
        For i_Aktuell = i_Erster To i_Letzter
            For i_N|fffd|chster = i_Aktuell + 1 To i_Letzter
                If .List(i_Aktuell) > .List(i_N|fffd|chster) Then
                    s_buffer = .List(i_N|fffd|chster)
                    .List(i_N|fffd|chster) = .List(i_Aktuell)
                    .List(i_Aktuell) = s_buffer
                End If
            Next i_N|fffd|chster
        Next i_Aktuell
    End With
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmAusw"
Attribute VB_Base = "0{D5D10113-5E5D-4E72-8E67-A46A608CE753}{4C2F2F1E-5718-45B1-9F18-FDBB4800A09D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub txt_typ_Change()
    Call DArtikel
    If txt_typ.Value = "ML" Then
        Call Lorte
    End If
End Sub

Private Sub txt_WLieferant_Change()
    If Not txt_WLieferant = "" Then
        Call frmAusw.WLieferant
    End If
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If Not txt_WLieferant = "" Then
        frmLager.lstmainmenu.Enabled = True
    Else
        frmBarcode.txt_Scan2.Value = ""
        frmBarcode.txt_Scan1.Value = ""
        frmBarcode.txt_Scan1.SetFocus
    End If
End Sub

Private Sub txt_ID_Change()
    If txt_typ.Value = "MF" Then
        Call Lplatz
    Else
        txt_wert.Value = ""
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
End Sub

Sub WLieferant()
    Dim Last_Row2, Last_Row, arrTmpA, arrTmpB, i, j, n, xrow, xrow2 As Long
    Dim SuchKriterium, strLNH, strLNA As String
    Dim strLNP As Double
    On Error Resume Next
    
    List_AuswBarcode.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmLager.txtID) Then
                xrow = i
            End If
        Next i
    End With
    strLNH = Sheets("Lager").Cells(xrow, 18)
    strLNP = Sheets("Lager").Cells(xrow, 14)
    With ThisWorkbook.Sheets("Lieferanten")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strLNH) Then
                xrow2 = i
            End If
        Next i
    End With
    strLNA = Sheets("Lieferanten").Cells(xrow2, 2)
    SuchKriterium = CStr(frmLager.txtID)
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AA" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        
        arrTmpB(1, 1) = strLNH & " (HL)"
        arrTmpB(2, 1) = strLNA
        arrTmpB(3, 1) = "HL"
        arrTmpB(4, 1) = Format(strLNP, "currency")
        n = n + 1
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 14) = "VP-WL" And arrTmpA(i, 2) Like SuchKriterium Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 9)
                arrTmpB(2, n) = "(" & arrTmpA(i, 10) & ") " & arrTmpA(i, 11)
                arrTmpB(3, n) = i
                arrTmpB(4, n) = Format(arrTmpA(i, 13), "currency")
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 6)
             For i = 1 To 6
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With List_AuswBarcode
                .ColumnCount = 4
                .ColumnWidths = "100;220;0;80"
                .List = arrTmpA
             End With
        End If
    End With
End Sub

Sub Lplatz()
    Dim lng, lngg As Long
    Dim lngS As Double
    lngS = 0
    lngg = 0
    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
        If Sheets("Lagerorte").Cells(lng, 2) = txt_ID.Text Then
            lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
            lngg = lngg + 1
        End If
    Next lng
    If lngg > 0 Then
        txt_wert.Value = lngg
    Else
        txt_wert.Value = 0
    End If
End Sub

Sub Lorte() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2, j2, n2 As Long
    Dim BoxListe As String
    On Error Resume Next
    frmAusw.Caption = "Auswahl Lagerplatz!"
    BoxListe = "Lagerorte"
    SuchKriterium = txt_ID.Text
    List_AuswBarcode.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AA" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 2) Like SuchKriterium Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 2)
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(SuchKriterium) Then
                            n2 = n2 + 1
                            arrTmpB(2, n) = arrTmpA2(i2, 3)
                            arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA2(i2, 6)), Chr$(13) & Chr$(10), " ")
                        End If
                    Next i2
                End With
                arrTmpB(4, n) = arrTmpA(i, 3)
                arrTmpB(5, n) = i
                arrTmpB(6, n) = arrTmpA(i, 1)
                
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 6)
             For i = 1 To 6
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With List_AuswBarcode
                .ColumnCount = 4
                .ColumnWidths = "40;100;160;100"
                .List = arrTmpA
             End With
        End If
    End With
    List_AuswBarcode.ListIndex = 0
    Call LorteMF
End Sub

Sub LorteMF() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, ListB, x, j, n, lng, lngS As Long
    Dim SuchKriterium As String
    On Error Resume Next
    ListB = List_AuswBarcode.ListCount
    List_AuswBarcode2.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 5, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txt_ID) Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 1)
                arrTmpB(2, n) = arrTmpA(i, 3)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 13)
                arrTmpB(5, n) = i
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 5)
            For i = 1 To 5
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With List_AuswBarcode2
               .ColumnCount = 4
               .ColumnWidths = "40;100;160;100"
               .List = arrTmpA
            End With
       End If
    End With
    Call ZusLO
End Sub

Sub ZusLO()
    Dim i, i2, lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    i2 = List_AuswBarcode.ListCount
    For lng = 1 To List_AuswBarcode2.ListCount
        List_AuswBarcode.AddItem List_AuswBarcode2.Column(0, i)
        List_AuswBarcode.Column(1, i2) = List_AuswBarcode2.Column(1, i)
        List_AuswBarcode.Column(2, i2) = List_AuswBarcode2.Column(2, i)
        List_AuswBarcode.Column(3, i2) = List_AuswBarcode2.Column(3, i)
        List_AuswBarcode.Column(4, i2) = List_AuswBarcode2.Column(4, i)
        List_AuswBarcode.Column(5, i2) = List_AuswBarcode2.Column(5, i)
        i2 = i2 + 1
        i = i + 1
    Next lng
    List_AuswBarcode2.Clear
    Application.ScreenUpdating = True
End Sub

Sub DArtikel() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    frmAusw.Caption = "Auswahl / Scan"
    If Not frmBarcode.txt_Scan1.Value = "" Then
        SuchKriterium = frmBarcode.txt_Scan1.Text
    Else
        SuchKriterium = frmBarcode.txt_Scan2.Text
    End If
    List_AuswBarcode.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 5, 1 To UBound(arrTmpA))
        If frmBarcode.Check_ArtikelNr.Value = True Then
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 3) Like SuchKriterium Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 1)
                    arrTmpB(2, n) = arrTmpA(i, 3)
                    arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(4, n) = arrTmpA(i, 13)
                    arrTmpB(5, n) = i
                End If
            Next i
        ElseIf frmBarcode.Check_HerstellerNr.Value = True Then
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 4) Like SuchKriterium Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 1)
                    arrTmpB(2, n) = arrTmpA(i, 3)
                    arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(4, n) = arrTmpA(i, 13)
                    arrTmpB(5, n) = i
                End If
            Next i
        Else
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 31) Like SuchKriterium Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 1)
                    arrTmpB(2, n) = arrTmpA(i, 3)
                    arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(4, n) = arrTmpA(i, 13)
                    arrTmpB(5, n) = i
                End If
            Next i
        End If
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 5)
             For i = 1 To 5
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With List_AuswBarcode
                .ColumnCount = 4
                .ColumnWidths = "40;100;160;100"
                .List = arrTmpA
             End With
        End If
    End With
    List_AuswBarcode.ListIndex = 0
End Sub

Private Sub List_AuswBarcode_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    If txt_WLieferant = "" Then
        txt_ID.Value = List_AuswBarcode.Column(0)
        txt_LPID.Value = List_AuswBarcode.Column(5)
        If txt_typ.Value = "ML" Then
            Call Artikel
        ElseIf CDbl(txt_wert.Value) > 0 And txt_typ.Value = "MF" And Not frmBarcode.check_HLager.Value = True Then
            Call Artikel
        End If
    Else
    Application.Wait (Now + TimeValue("00:00:01"))
    Unload frmAusw
    frmLager.lstmainmenu.Enabled = True
    End If
End Sub

Private Sub List_AuswBarcode_Click()
    Dim Last_Row2, xrow, Last_Row, arrTmpA, arrTmpB, i, j, n, xrow2, xrow3 As Long
    Dim SuchKriterium, strLNH, strLNA As String
    Dim strLNP As Double
    On Error Resume Next
    If Not txt_WLieferant = "" Then
        If frmLager.lstmainmenu.ListCount > 1 Then
'            Call frmLager.Asuchen
'            Call frmLager.SuchenBMenge
'            Call frmLager.SuchenR
        End If
        Application.ScreenUpdating = False
        If List_AuswBarcode.Column(2) = "HL" Then
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmLager.txtID) Then
                        xrow2 = i
                    End If
                Next i
            End With
            strLNH = Sheets("Lager").Cells(xrow2, 18)
            frmLager.txtHnr = Sheets("Lager").Cells(xrow2, 4)
            frmLager.txtLNr.Value = strLNH
            frmLager.txtLFirma.Value = List_AuswBarcode.Column(1)
            frmLager.lbl_EKPreis.Caption = List_AuswBarcode.Column(3)
            With ThisWorkbook.Sheets("Lieferanten")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strLNH) Then
                        xrow3 = i
                    End If
                Next i
            End With
            frmLager.txtLAnsprech.Value = Sheets("Lieferanten").Cells(xrow3, 5)
            frmLager.txtLphone.Value = Sheets("Lieferanten").Cells(xrow3, 8)
            frmLager.txt_Lemail.Value = Sheets("Lieferanten").Cells(xrow3, 12)
        Else
            frmLager.txtLNr.Value = Sheets("VPEinheit").Cells(CLng(List_AuswBarcode.Column(2)), 10)
            frmLager.txtLFirma.Value = Sheets("VPEinheit").Cells(CLng(List_AuswBarcode.Column(2)), 11)
            frmLager.txtHnr.Value = Sheets("VPEinheit").Cells(CLng(List_AuswBarcode.Column(2)), 9)
            frmLager.lbl_EKPreis.Caption = Format(Sheets("VPEinheit").Cells(CLng(List_AuswBarcode.Column(2)), 13), "currency")
            With frmLager
                xrow = xFind(ActiveWorkbook.Name, "Lieferanten", CStr(Sheets("VPEinheit").Cells(CLng(List_AuswBarcode.Column(2)), 10)), "A:A")
                .txtLAnsprech.Value = Sheets("Lieferanten").Cells(xrow, 5)
                .txtLphone.Value = Sheets("Lieferanten").Cells(xrow, 8)
                .txt_Lemail.Value = Sheets("Lieferanten").Cells(xrow, 12)
            End With
        End If
        Application.ScreenUpdating = True
    Else
        txt_LPID.Value = List_AuswBarcode.Column(5)
    End If
End Sub

Private Sub List_AuswBarcode_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    On Error Resume Next
    txt_ID.Value = List_AuswBarcode.Column(0)
    txt_LPID.Value = List_AuswBarcode.Column(5)
    
    If txt_typ.Value = "ML" Then
        Call Artikel
    ElseIf CDbl(txt_wert.Value) > 0 And txt_typ.Value = "MF" And Not frmBarcode.check_HLager.Value = True Then
        Call Artikel
    End If
End Sub

Sub Artikel() '1.42
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    Dim xrow, xrowL, xrowLO, menge, lngrow, lng As Long
    Dim stxt, stxtID, stxtLID, stxtw, stxtNr, strFile As String
    On Error Resume Next
    stxtID = List_AuswBarcode.Column(0)
    stxtLID = List_AuswBarcode.Column(5)
    If Not frmBarcode.txt_Scan1.Value = "" Then
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(stxtID) Then
                    xrow = i
                End If
            Next i
        End With
        xrowL = xFind(ActiveWorkbook.Name, ("Barcode"), stxtID, "A:A")
        If Not List_AuswBarcode.Column(5) = "" Then
            xrowLO = xFind(ActiveWorkbook.Name, ("Barcode"), stxtLID, "J:J")
        End If
        frmBarcode.lbl_ScanCode.Caption = frmBarcode.txt_Scan1.Value
        frmBarcode.lbl_ScanANr.Caption = frmBarcode.lbl_ScanCode.Caption
    ElseIf Not frmBarcode.txt_Scan2.Value = "" Then
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(stxtID) Then
                    xrow = i
                End If
            Next i
        End With
        xrowL = xFind(ActiveWorkbook.Name, ("Barcode"), stxtID, "A:A")
        If Not List_AuswBarcode.Column(5) = "" Then
            xrowLO = xFind(ActiveWorkbook.Name, ("Barcode"), stxtLID, "J:J")
        End If
        frmBarcode.lbl_ScanCode.Caption = frmBarcode.txt_Scan2.Value
        frmBarcode.lbl_ScanANr.Caption = frmBarcode.lbl_ScanCode.Caption
    End If
    If frmBarcode.txt_BarcodeArt.Value = "kasse" Then
        If frmBarcode.check_Menge.Value = True Then
            stxt = InputBox("Bitte geben Sie die Menge an!", "Scan", 1)
            If stxt = False Then Exit Sub
        Else
            stxt = CDbl("1")
        End If
    Else
        If frmBarcode.check_Menge.Value = True Then
            stxt = InputBox("Bitte geben Sie die auszubuchende Menge an!", "Scan", 1)
            If stxt = False Then Exit Sub
        Else
            stxt = CDbl("1")
        End If
    End If
    frmBarcode.txt_Scan2.Value = ""
    frmBarcode.txt_Scan1.Value = ""
    frmBarcode.txt_Scan1.SetFocus
    frmBarcode.txt_BVmenge.Value = 0
    Application.ScreenUpdating = False
    If CDbl(xrowL) > 0 Then
        If CDbl(xrowLO) > 0 Then
            If CDbl(stxt) > 1 Then
                Sheets("Barcode").Cells(xrowLO, 4) = Sheets("Barcode").Cells(xrowLO, 4) + CDbl(stxt)
                frmBarcode.txt_BVmenge.Value = Sheets("Barcode").Cells(xrowLO, 4) + CDbl(stxt)
            Else
                Sheets("Barcode").Cells(xrowLO, 4) = Sheets("Barcode").Cells(xrowLO, 4) + 1
                frmBarcode.txt_BVmenge.Value = Sheets("Barcode").Cells(xrowLO, 4) + 1
            End If
            Call frmBarcode.BCsuchen
            Sheets("Center").Activate
            Application.ScreenUpdating = True
            Unload frmAusw
            Exit Sub
        Else
            stxtw = List_AuswBarcode.Column(0)
            stxtNr = 0
            For lng = 2 To ThisWorkbook.Worksheets("Barcode").UsedRange.Rows.Count
                If Sheets("Barcode").Cells(lng, 1).Text = CStr(stxtw) And Sheets("Barcode").Cells(lng, 10) = CStr(txt_LPID) Then
                    If CDbl(stxt) > 1 Then
                        Sheets("Barcode").Cells(lng, 4) = Sheets("Barcode").Cells(lng, 4) + CDbl(stxt)
                        frmBarcode.txt_BVmenge.Value = Sheets("Barcode").Cells(lng, 4) + CDbl(stxt)
                    Else
                        Sheets("Barcode").Cells(lng, 4) = Sheets("Barcode").Cells(lng, 4) + 1
                        frmBarcode.txt_BVmenge.Value = Sheets("Barcode").Cells(lng, 4) + 1
                    End If
                    stxtNr = stxtNr + 1
                    Call frmBarcode.BCsuchen
                    Sheets("Center").Activate
                    Application.ScreenUpdating = True
                    Unload frmAusw
                    Exit Sub
                End If
            Next lng
            If stxtNr = 0 Then GoTo weiter
        End If
    Else
weiter:
        Sheets("Barcode").Activate
        Range("A1000").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = Sheets("Lager").Cells(xrow, 1)
        frmBarcode.txt_AID.Value = Sheets("Lager").Cells(xrow, 1)
        frmBarcode.txt_Bzeile.Value = ActiveCell.Offset(0, 0).Row
        ActiveCell.Offset(0, 1).Value = Sheets("Lager").Cells(xrow, 3)
        ActiveCell.Offset(0, 2).Value = Sheets("Lager").Cells(xrow, 6)
        If Len(Sheets("Lager").Cells(xrow, 28).Value) > 0 Then
            strFile = Sheets("Lager").Cells(xrow, 28).Formula
            strFile = Split(strFile, "(" & Chr(34))(1)
            strFile = Split(strFile, Chr(34) & ",")(0)
            strFile = Replace(strFile, "file:///", "")
            Set frmBarcode.Img_Barcode.Picture = LoadPicture(strFile)
            frmBarcode.lbl_Bbild.Visible = False
        Else
            Set frmBarcode.Img_Barcode.Picture = Nothing
            frmBarcode.lbl_Bbild.Visible = True
        End If
        ActiveCell.Offset(0, 3).Value = stxt
        frmBarcode.txt_BVmenge.Value = CDbl(stxt)
        ActiveCell.Offset(0, 4).Value = Sheets("Lager").Cells(xrow, 15) + Sheets("Lager").Cells(xrow, 15) * Sheets("Lager").Cells(xrow, 21)
        If frmEingang.txt_SacnEin.Value = "Eingang" Then
            ActiveCell.Offset(0, 5).Value = frmEingang.cboeingang
        End If
        ActiveCell.Offset(0, 6).Value = lngrow
        ActiveCell.Offset(0, 7).Value = Sheets("Lager").Cells(xrow, 4)
        ActiveCell.Offset(0, 8).Value = "'" & Sheets("Lager").Cells(xrow, 31)
        ActiveCell.Offset(0, 9).Value = txt_LPID.Value
        frmBarcode.txt_Scan1.Value = ""
        frmBarcode.txt_Scan2.Value = ""
        Call frmBarcode.BCsuchen
        Sheets("Center").Activate
        Application.ScreenUpdating = True
        Unload frmAusw
        Exit Sub
    End If
    Unload frmAusw
End Sub
Attribute VB_Name = "frmBarcode"
Attribute VB_Base = "0{3D6DA308-7E4F-48CF-A8BC-D0A193F5F0B0}{CBD1BD1C-28BF-4F77-B130-2F010B2611A8}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub check_HLager_Click()
    If check_HLager.Value = True Then
        lbl_HLager.Font.Bold = True
        Worksheets("Daten").Range("D14").Value = "HL"
    Else
        lbl_HLager.Font.Bold = False
        Worksheets("Daten").Range("D14").Value = ""
    End If
    txt_Scan1.SetFocus
    txt_Scan1.SetFocus
End Sub

Private Sub check_NBestand_Click()
    If check_NBestand.Value = True Then
        lbl_NBestand.Font.Bold = True
        Worksheets("Daten").Range("D15").Value = "NB"
    Else
        lbl_NBestand.Font.Bold = False
        Worksheets("Daten").Range("D15").Value = ""
    End If
    txt_Scan1.SetFocus
    txt_Scan1.SetFocus
End Sub

Private Sub UserForm_Initialize()
    Dim strFontFileName As String
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    strFontFileName = "Bar-Code 39"
    If SystemFontExists(strFontFileName) = False Then
        MsgBox "Bitte installieren Sie die Schriftart (Bar-Code 39)!" & vbLf & "Weitere Informationen finden Sie auch im Benutzerhandbuch!", vbInformation, "Schriftart (Bar-Code 39) ist nicht installiert!"
        Unload frmBarcode
        Exit Sub
    End If
    If Not frmBarcode.txt_BarcodeArt.Value = "verleih" Then
        If Application.Version Like "16*" Then
            If Sheets("Daten").Range("B35") = "Ja" And frmEingang.txt_SacnEin.Value = "" Then
                frmBarcode.Height = 438
                Frame2.Top = 374
                cbo_kostenBC.Visible = True
                Call Kostenstellen
            ElseIf Sheets("Daten").Range("B35") = "Ja" And frmEingang.txt_SacnEin.Value = "" And txt_BarcodeArt.Value = "verleih" Then
                Frame_Verleih.Top = 374
                frmBarcode.Height = 460
                Frame2.Top = 407
                cbo_kostenBC.Visible = True
                Call Kostenstellen
            Else
                frmBarcode.Height = 415
                Frame2.Top = 352
                cbo_kostenBC.Visible = False
            End If
        Else
             If Sheets("Daten").Range("B35") = "Ja" And frmEingang.txt_SacnEin.Value = "" And txt_BarcodeArt.Value = "" Then
                 frmBarcode.Height = 431
                 Frame2.Top = 374
                 cbo_kostenBC.Visible = True
                 Call Kostenstellen
             Else
                 frmBarcode.Height = 407
                 Frame2.Top = 350
                 cbo_kostenBC.Visible = False
             End If
        End If
    End If
    If Worksheets("Daten").Range("D14") = "HL" Then
        check_HLager.Value = True
        lbl_HLager.Font.Bold = True
    Else
        check_HLager.Value = False
        lbl_HLager.Font.Bold = False
    End If
    If Worksheets("Daten").Range("D15") = "NB" Then
        lbl_NBestand.Font.Bold = True
        check_NBestand.Value = True
    Else
        lbl_NBestand.Font.Bold = False
        check_NBestand.Value = False
    End If
    If Worksheets("Daten").Range("D16") = "MA" Then
        lbl_Menge.Font.Bold = True
        check_Menge.Value = True
    Else
        lbl_Menge.Font.Bold = False
        check_Menge.Value = False
    End If
    If Worksheets("Daten").Range("B36") = "AN" Then
        Check_HerstellerNr = False
        Check_ArtikelNr.Value = True
        Check_Barcode.Value = False
    ElseIf Worksheets("Daten").Range("B36") = "HN" Then
        Check_ArtikelNr.Value = False
        Check_Barcode.Value = False
        Check_HerstellerNr = True
    Else
        Check_Barcode.Value = True
        Check_ArtikelNr.Value = False
        Check_HerstellerNr = False
    End If
    Call BCsuchen
    txt_Scan1.SetFocus
    txt_VVdatum.Value = Format(Date, "DD.MM.YYYY")
End Sub

Private Sub Check_ArtikelNr_Click()
    If Check_ArtikelNr.Value = True Then
        Check_HerstellerNr = False
        Check_Barcode.Value = False
    End If
    If Check_HerstellerNr = False And Check_Barcode.Value = False Then
        Check_ArtikelNr.Value = True
    End If
    lbl_AN.Font.Bold = True
    lbl_HN.Font.Bold = False
    lbl_BC.Font.Bold = False
    Worksheets("Daten").Range("B36").Value = "AN"
    txt_Scan1.SetFocus
End Sub

Private Sub Check_HerstellerNr_Click()
    If Check_HerstellerNr.Value = True Then
        Check_ArtikelNr = False
        Check_Barcode.Value = False
    End If
    If Check_ArtikelNr = False And Check_Barcode = False Then
        Check_HerstellerNr.Value = True
    End If
    Worksheets("Daten").Range("B36").Value = "HN"
    lbl_HN.Font.Bold = True
    lbl_AN.Font.Bold = False
    lbl_BC.Font.Bold = False
    txt_Scan1.SetFocus
End Sub

Private Sub Check_Barcode_Click()
    If Check_Barcode.Value = True Then
        Check_ArtikelNr.Value = False
        Check_HerstellerNr.Value = False
    End If
    If Check_ArtikelNr.Value = False And Check_HerstellerNr.Value = False Then
        Check_Barcode.Value = True
    End If
    Worksheets("Daten").Range("B36").Value = "BC"
    lbl_BC.Font.Bold = True
    lbl_AN.Font.Bold = False
    lbl_HN.Font.Bold = False
    txt_Scan1.SetFocus
End Sub

Private Sub check_Menge_Click()
    If check_Menge.Value = True Then
        lbl_Menge.Font.Bold = True
        Worksheets("Daten").Range("D16").Value = "MA"
    Else
        lbl_Menge.Font.Bold = False
        Worksheets("Daten").Range("D16").Value = ""
    End If
    txt_Scan1.SetFocus
End Sub

Private Sub cmd_CodeAbbrechen_Click()
    Call BCloeschen
End Sub

Private Sub cmd_BCAusbuchen_Click()
    Dim lng As Long
    On Error Resume Next
    If txt_BarcodeArt.Value = "verleih" Then
        Call ScanVerleih
        Exit Sub
    ElseIf txt_BarcodeArt.Value = "bestellung" Then
        Call ScanBestellung
        Exit Sub
    ElseIf txt_BarcodeArt.Value = "verleihAus" Then
        Call ScanVerleihAus
        Exit Sub
    ElseIf txt_BarcodeArt.Value = "WEOH" Then
        Call ScanWEOH
        Exit Sub
    ElseIf txt_BarcodeArt2.Value = "Angebot" Or txt_BarcodeArt2.Value = "Auftrag" Then
        If frmKasse.lstKasse.ListCount = 0 Or frmKasse.txt_KDID = "" Then
            KuHiZu
        End If
        If lst_BarcodeWE.ListCount = 0 Then
            Exit Sub
        Else
            Call ScanAufAN
            Exit Sub
        End If
    ElseIf txt_BarcodeArt2.Value = "Barverkauf" Or txt_BarcodeArt2.Value = "Rechnung" Or txt_BarcodeArt2.Value = "Intern" Then
        Call ScanKasse
        Exit Sub
    End If
    If frmEingang.txt_SacnEin.Value = "Eingang" Then
        If lst_BarcodeWE.ListCount = 0 Then Exit Sub
        lng = MsgBox("M|fffd|chten Sie die jetzt Ware einbuchen?", vbYesNo, "Hinweis")
        If lng = vbYes Then
            ScanEingang
        End If
    Else
        If lst_BarcodeWE.ListCount = 0 Then Exit Sub
        lng = MsgBox("M|fffd|chten Sie die jetzt Ware ausbuchen?", vbYesNo, "Hinweis")
        If lng = vbYes Then
            ScanAusgang
        End If
    End If
End Sub

Private Sub cmd_BCloeschen_Click()
    Dim lngZeile  As Long
    On Error Resume Next
    lngZeile = lst_BarcodeWE.Column(5)
    Sheets("Barcode").Rows(lngZeile).Delete
    Call BCsuchen
    txt_Scan1.SetFocus
End Sub

Private Sub cmd_DateBI_Click()
    frmKalender.txt_UID = "VMBI"
    frmKalender.Show
    txt_Scan1.SetFocus
End Sub

Private Sub cmd_DateVO_Click()
    frmKalender.txt_UID = "VMVO"
    frmKalender.Show
    txt_Scan1.SetFocus
End Sub

Private Sub txt_Scan1_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    Call Barcode
    txt_Scan2.SetFocus
End Sub

Private Sub txt_Scan2_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    Call Barcode
    txt_Scan1.SetFocus
End Sub

Sub Barcode() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row, lngZeile As Long
    Dim xrow, xrowL, lngAID, z, lngrow, menge, lng, x, zeile, mengeL As Long
    Dim lngp, lngS, lngg, lngLID, LPID As Long
    Dim stxt, stxtID, strIDV, zeileID, strFile As String
    On Error Resume Next
    If txt_Scan1.Value = "" And txt_Scan2.Value = "" Then
        Exit Sub
        txt_Scan1.SetFocus
    End If
    zeile = 0
    xrow = 0
    zeileID = ""
    stxt = 0
    x = 0
    txt_AID.Value = ""
    txt_Bzeile.Value = ""
    stxtID = ""
    xrowL = 0
    If Check_HerstellerNr.Value = True Then
        For lng = 2 To ThisWorkbook.Worksheets("Lager").UsedRange.Rows.Count
            If Not txt_Scan1 = "" Then
                If Sheets("Lager").Cells(lng, 4).Text = txt_Scan1.Text Then
                    zeile = Sheets("Lager").Cells(lng, 4).Row
                    mengeL = Sheets("Lager").Cells(lng, 8)
                    zeileID = Sheets("Lager").Cells(lng, 1)
                    x = x + 1
                End If
            Else
                If Sheets("Lager").Cells(lng, 4).Text = txt_Scan2.Text Then
                    zeile = Sheets("Lager").Cells(lng, 4).Row
                    mengeL = Sheets("Lager").Cells(lng, 8)
                    zeileID = Sheets("Lager").Cells(lng, 1)
                    x = x + 1
                End If
            End If
        Next lng
    ElseIf Check_ArtikelNr.Value = True Then
        For lng = 2 To ThisWorkbook.Worksheets("Lager").UsedRange.Rows.Count
            If Not txt_Scan1 = "" Then
                If Sheets("Lager").Cells(lng, 3).Text = txt_Scan1.Text Then
                    zeile = Sheets("Lager").Cells(lng, 3).Row
                    mengeL = Sheets("Lager").Cells(lng, 8)
                    zeileID = Sheets("Lager").Cells(lng, 1)
                    x = x + 1
                End If
            Else
                If Sheets("Lager").Cells(lng, 3).Value = txt_Scan2.Text Then
                    zeile = Sheets("Lager").Cells(lng, 3).Row
                    mengeL = Sheets("Lager").Cells(lng, 8)
                    zeileID = Sheets("Lager").Cells(lng, 1)
                    x = x + 1
                End If
            End If
        Next lng
    Else
        For lng = 2 To ThisWorkbook.Worksheets("Lager").UsedRange.Rows.Count
            If Not txt_Scan1 = "" Then
                If CStr(Sheets("Lager").Cells(lng, 31)) = txt_Scan1.Text Then
                    zeile = Sheets("Lager").Cells(lng, 31).Row
                    mengeL = Sheets("Lager").Cells(lng, 8)
                    zeileID = Sheets("Lager").Cells(lng, 1).Value
                    txt_AID = zeileID
                    x = x + 1
                End If
            Else
                If Sheets("Lager").Cells(lng, 31) = txt_Scan2.Text Then
                    zeile = Sheets("Lager").Cells(lng, 31).Row
                    mengeL = Sheets("Lager").Cells(lng, 8)
                    zeileID = Sheets("Lager").Cells(lng, 1).Value
                    txt_AID = zeileID
                    x = x + 1
                End If
            End If
        Next lng
    End If
    If Not x > 1 Then
        If Not txt_Scan1.Value = "" Then
            xrow = zeile
            For lngAID = 2 To ThisWorkbook.Worksheets("Barcode").UsedRange.Rows.Count
                If Sheets("Barcode").Cells(lngAID, 1) = CStr(zeileID) Then
                    xrowL = Sheets("Barcode").Cells(lngAID, 1).Row
                End If
            Next lngAID
            lbl_ScanCode.Caption = txt_Scan1.Value
            lbl_ScanANr.Caption = lbl_ScanCode.Caption
        ElseIf Not txt_Scan2.Value = "" Then
            xrow = zeile
            For lngAID = 2 To ThisWorkbook.Worksheets("Barcode").UsedRange.Rows.Count
                If Sheets("Barcode").Cells(lngAID, 1) = CStr(zeileID) Then
                    xrowL = Sheets("Barcode").Cells(lngAID, 1).Row
                End If
            Next lngAID
            lbl_ScanCode.Caption = txt_Scan2.Value
            lbl_ScanANr.Caption = lbl_ScanCode.Caption
        End If
    Else
        frmAusw.Show
        GoTo weiter:
    End If
    If x = 0 Then
        MsgBox "Barcode / Artikel nicht gefunden", , "Scan"
        txt_Scan1.Value = ""
        txt_Scan2.Value = ""
        Set Img_Barcode.Picture = Nothing
        Exit Sub
    End If
    If Not check_HLager.Value = True And Not txt_BarcodeArt.Value = "verleihAus" And Not txt_BarcodeArt.Value = "Eingang" And Not txt_BarcodeArt.Value = "bestellung" Then
        lngS = 0
        lngg = 0
        With ThisWorkbook.Sheets("Lagerorte")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(zeileID) Then
                    lngS = lngS + CDbl(arrTmpA(i, 4))
                    lngg = lngg + 1
                End If
            Next i
        End With
        If CDbl(lngg) > 0 Then
            frmAusw.txt_ID.Value = zeileID
            frmAusw.txt_typ.Value = "ML"
            Call frmAusw.Lorte
            frmAusw.Show
            GoTo weiter:
        End If
    End If
    Application.ScreenUpdating = False
    If txt_BarcodeArt.Value = "kasse" Then
        If check_Menge.Value = True Then
scan1:
            stxt = InputBox("Bitte geben Sie die Menge an!", "Scan", 1)
            If CDbl(stxt) = 0 Then
                MsgBox "Die angegene Menge muss gr|fffd||fffd|er als 0 sein!", , "Hinweis"
                GoTo scan1
            End If
            If stxt = False Then
                Application.ScreenUpdating = True
                Exit Sub
            End If
        Else
            stxt = CDbl("1")
        End If
    Else
        If check_Menge.Value = True Then
scan2:
            stxt = InputBox("Bitte geben Sie die auszubuchende Menge an!", "Scan", 1)
            If CDbl(stxt) = 0 Then
                MsgBox "Die angegene Menge muss gr|fffd||fffd|er als 0 sein!", , "Hinweis"
                GoTo scan2
            End If
            If stxt = False Then
                Application.ScreenUpdating = True
                Exit Sub
            End If
        Else
            stxt = CDbl("1")
        End If
    End If
    txt_BVmenge.Value = 0
    If xrowL <= 0 Then
        If Not Sheets("Lager").Cells(xrow, 42) = "" Then
            MsgBox "Artikel ist gesperrt!", , "Hinweis"
            txt_Scan1.Value = ""
            txt_Scan2.Value = ""
            Application.ScreenUpdating = True
            Exit Sub
        End If
        Sheets("Barcode").Activate
        Range("A500").End(xlUp).Offset(1, 0).Select
        If check_NBestand = True Then
            If Not lbl_NBestand.Enabled = False Then
                If mengeL < CDbl(stxt) Then
                    MsgBox "Angegebener Bestand ist nicht Verf|fffd|gbar!", , "Bestand"
                    stxt = mengeL
                    txt_Scan1.Value = ""
                    txt_Scan2.Value = ""
                End If
            End If
        End If
        lngZeile = Worksheets("Barcode").Cells(Rows.Count, 1).End(xlUp).Row + 1
        Worksheets("Barcode").Cells(lngZeile, 1).Value = Sheets("Lager").Cells(xrow, 1)
        txt_AID.Value = Sheets("Lager").Cells(xrow, 1)
        Worksheets("Barcode").Cells(lngZeile, 2).Value = Sheets("Lager").Cells(xrow, 3)
        Worksheets("Barcode").Cells(lngZeile, 3).Value = VBA.Replace(CStr(Sheets("Lager").Cells(xrow, 6).Value), Chr$(13) & Chr$(10), " ")
        Worksheets("Barcode").Cells(lngZeile, 4).Value = CDbl(stxt)
        txt_BVmenge.Value = CDbl(stxt)
        Worksheets("Barcode").Cells(lngZeile, 5).Value = Sheets("Lager").Cells(xrow, 15) + Sheets("Lager").Cells(xrow, 15) * Sheets("Lager").Cells(xrow, 21)
        If frmEingang.txt_SacnEin.Value = "Eingang" Then
            Worksheets("Barcode").Cells(lngZeile, 6).Value = frmEingang.cboeingang
        End If
        Worksheets("Barcode").Cells(lngZeile, 7).Value = lngrow
        Worksheets("Barcode").Cells(lngZeile, 8).Value = Sheets("Lager").Cells(xrow, 4)
        Worksheets("Barcode").Cells(lngZeile, 9).Value = "'" & Sheets("Lager").Cells(xrow, 31)
        txt_Bzeile.Value = Worksheets("Barcode").Cells(lngZeile, 1).Row
        txt_Scan1.Value = ""
        txt_Scan2.Value = ""
        If Len(Sheets("Lager").Cells(xrow, 28).Value) > 0 Then
            strFile = Sheets("Lager").Cells(xrow, 28).Formula
            strFile = Split(strFile, "(" & Chr(34))(1)
            strFile = Split(strFile, Chr(34) & ",")(0)
            strFile = Replace(strFile, "file:///", "")
            Set Img_Barcode.Picture = LoadPicture(strFile)
            lbl_Bbild.Visible = False
        Else
            Set Img_Barcode.Picture = Nothing
            lbl_Bbild.Visible = True
        End If
        Call BCsuchen
        Sheets("Center").Activate
    Else
        txt_BVmenge.Value = 0
        If CDbl(stxt) > CDbl("1") Then
            If check_NBestand = True Then
                If Not lbl_NBestand.Enabled = False Then
                    If mengeL < CDbl(Sheets("Barcode").Cells(xrowL, 4) + CDbl(stxt)) Then
                        Sheets("Barcode").Cells(xrowL, 4) = CDbl(mengeL)
                        MsgBox "Angegebener Bestand ist nicht Verf|fffd|gbar!", , "Bestand"
                        txt_Scan1.Value = ""
                        txt_Scan2.Value = ""
                        Call BCsuchen
                        Exit Sub
                    End If
                End If
            End If
            Sheets("Barcode").Cells(xrowL, 4) = Sheets("Barcode").Cells(xrowL, 4) + CDbl(stxt)
            txt_BVmenge.Value = Sheets("Barcode").Cells(xrowL, 4) + CDbl(stxt)
        Else
            If check_NBestand = True Then
                If Not lbl_NBestand.Enabled = False Then
                    If mengeL < CDbl(Sheets("Barcode").Cells(xrowL, 4) + CDbl(1)) Then
                        Sheets("Barcode").Cells(xrowL, 4) = CDbl(mengeL)
                        MsgBox "Angegebener Bestand ist nicht Verf|fffd|gbar!", , "Bestand"
                        txt_Scan1.Value = ""
                        txt_Scan2.Value = ""
                        Call BCsuchen
                        Exit Sub
                    End If
                End If
            End If
            Sheets("Barcode").Cells(xrowL, 4) = Sheets("Barcode").Cells(xrowL, 4) + 1
            txt_BVmenge.Value = Sheets("Barcode").Cells(xrowL, 4) '+ 1
        End If
        txt_AID.Value = Sheets("Barcode").Cells(xrowL, 1)
        txt_Bzeile.Value = Sheets("Barcode").Cells(xrowL, 1).Row
        txt_Scan1.Value = ""
        txt_Scan2.Value = ""
        If Len(Sheets("Lager").Cells(xrow, 28).Value) > 0 Then
            strFile = Sheets("Lager").Cells(xrow, 28).Formula
            strFile = Split(strFile, "(" & Chr(34))(1)
            strFile = Split(strFile, Chr(34) & ",")(0)
            strFile = Replace(strFile, "file:///", "")
            Set Img_Barcode.Picture = LoadPicture(strFile)
            lbl_Bbild.Visible = False
        Else
            Set Img_Barcode.Picture = Nothing
            lbl_Bbild.Visible = True
        End If
        Call BCsuchen
        Sheets("Center").Activate
        Application.ScreenUpdating = True
    End If
weiter:
    '#####WEingang
    If txt_BarcodeArt.Value = "Eingang" Then
        z = 0
        menge = 0
        For lng = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count
            If Sheets("Bestellung").Cells(lng, 12).Text = txt_AID.Text And Sheets("Bestellung").Cells(lng, 1).Value = txt_KasseNr.Text Then
                z = z + 1
                menge = menge + CDbl(Sheets("Bestellung").Cells(lng, 6))
            End If
        Next lng
        For lngLID = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count
            If Sheets("Bestellung").Cells(lngLID, 12).Text = txt_AID.Text And Sheets("Bestellung").Cells(lngLID, 1).Value = txt_KasseNr.Text Then
                Sheets("Barcode").Cells(CDbl(txt_Bzeile.Text), 10) = Sheets("Bestellung").Cells(lngLID, 14).Value
            End If
        Next lngLID
        If z = 0 Then
            MsgBox "Artikel in aktueller Bestellung nicht gefunden!", , "Scan"
            Sheets("Barcode").Rows(CDbl(txt_Bzeile.Text)).Delete
            Call BCsuchen
            Exit Sub
        Else
            If CDbl(txt_BVmenge.Value) > CDbl(menge) Then
                MsgBox "Die angegebene Menge ist gr|fffd||fffd|er als die bestellte!", , "Hinweis"
                txt_BVmenge.Value = CDbl(menge)
                Sheets("Barcode").Cells(CDbl(txt_Bzeile.Text), 4) = CDbl(menge)
                Call BCsuchen
            End If
        End If
    End If
    '#####Verleih
    If txt_BarcodeArt.Value = "verleihAus" Then
        z = 0
        menge = 0
        strIDV = txt_AID.Text
        For lng = 2 To ThisWorkbook.Worksheets("Verleih").UsedRange.Rows.Count
            If Sheets("Verleih").Cells(lng, 4).Text = strIDV And Sheets("Verleih").Cells(lng, 1).Text = txt_KasseNr.Text Then
                z = z + 1
                menge = menge + CDbl(Sheets("Verleih").Cells(lng, 8))
            End If
        Next lng
        For lngLID = 2 To ThisWorkbook.Worksheets("Verleih").UsedRange.Rows.Count
            If Sheets("Verleih").Cells(lngLID, 4).Text = strIDV And Sheets("Verleih").Cells(lngLID, 1).Text = txt_KasseNr.Text Then
                Sheets("Barcode").Cells(CDbl(txt_Bzeile.Text), 10) = Sheets("Verleih").Cells(lngLID, 17).Value
            End If
        Next lngLID
        If z = 0 Then
            MsgBox "Artikel in aktuellem Verleih nicht gefunden!", vbCritical, "Scan"
            Sheets("Barcode").Rows(CDbl(txt_Bzeile.Text)).Delete
            Call BCsuchen
            Exit Sub
        Else
            If CDbl(txt_BVmenge.Value) > CDbl(menge) Then
                MsgBox "Die angegebene Menge ist gr|fffd||fffd|er als die Verleihende!", vbCritical, "Hinweis"
                txt_BVmenge.Value = CDbl(menge)
                Sheets("Barcode").Cells(CDbl(txt_Bzeile.Text), 4) = CDbl(menge)
                Call BCsuchen
            End If
        End If
    End If
    txt_AID.Value = ""
    txt_Bzeile.Value = ""
    txt_BVmenge.Value = ""
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Sub BCsuchen() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lngges, j, n As Long
    Dim lngGP As Double
    On Error Resume Next
    Application.ScreenUpdating = False
    lst_BarcodeWE.Clear
    lngGP = 0
    lngges = 0
    With ThisWorkbook.Sheets("Barcode")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" Then
                n = n + 1
                lngges = lngges + CDbl(arrTmpA(i, 4))
                If Int(arrTmpA(i, 4)) = CStr(arrTmpA(i, 4)) Then
                    arrTmpB(1, n) = arrTmpA(i, 4)
                ElseIf CStr(Format(arrTmpA(i, 4), "0.0")) = CStr(arrTmpA(i, 4)) Then
                    arrTmpB(1, n) = Format(arrTmpA(i, 4), "0.0")
                Else
                    arrTmpB(1, n) = Format(arrTmpA(i, 4), "0.00")
                End If
                arrTmpB(2, n) = arrTmpA(i, 2)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 3)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(arrTmpA(i, 5)), "currency")
                lngGP = CDbl(lngGP) + (CDbl(arrTmpA(i, 4)) * CDbl(arrTmpA(i, 5)))
                arrTmpB(5, n) = CStr(arrTmpA(i, 1))
                arrTmpB(6, n) = i
                arrTmpB(7, n) = arrTmpA(i, 7)
                arrTmpB(8, n) = arrTmpA(i, 10)
                arrTmpB(9, n) = arrTmpA(i, 6)
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 9)
            For i = 1 To 9
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lst_BarcodeWE
                .ColumnCount = 4
                .ColumnWidths = "30;80;177;50;"
                .List = arrTmpA
            End With
            txt_gesScan.Value = CDbl(lngges)
            txt_gesPreisSacn.Value = Format(CDbl(lngGP), "currency")
        Else
            txt_gesScan.Value = ""
            txt_gesPreisSacn.Value = ""
        End If
    End With
    Application.ScreenUpdating = True
End Sub

Sub Kostenstellen()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Kostenstellen").Cells(Rows.Count, 1).End(xlUp).Row
        objDic(Sheets("Kostenstellen").Cells(lngZ, 1).Value & " / " & Sheets("Kostenstellen").Cells(lngZ, 2).Value) = 0
    Next
    cbo_kostenBC.List = objDic.keys
    Set objDic = Nothing
End Sub

Private Sub ScanBestellung() 'v1.44 Bestellung
    Dim arrTmpA, arrTmpB, i, Last_Row, lngZeile As Long
    Dim strF, strNr As String
    Dim lng(1 To 3), lngIndex, lngID As Long
    On Error Resume Next

    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Bestellung")
        If .FilterMode Then .ShowAllData
    End With
    If Sheets("Daten").Range("B35") = "Ja" And cbo_kostenBC = "" Then
        MsgBox "Sie m|fffd|ssen eine Kostenstelle angeben", , "Kostenstelle"
        cbo_kostenBC.SetFocus
        Exit Sub
    End If
    Application.ScreenUpdating = False
    Sheets("Bestellung").Activate
    lngZeile = Worksheets("Bestellung").Cells(Rows.Count, 1).End(xlUp).Row
    With ThisWorkbook.Worksheets("Bestellung")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            For lng(1) = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count
                If Worksheets("Bestellung").Cells(lng(1), 1) = CStr(txt_KasseNr) And Worksheets("Bestellung").Cells(lng(1), 12) = CStr(lst_BarcodeWE.Column(4, lngIndex)) And Worksheets("Bestellung").Cells(lng(1), 14) = CStr(lst_BarcodeWE.Column(7, lngIndex)) Then
                    lng(2) = Worksheets("Bestellung").Cells(lng(1), 1).Row
                End If
            Next lng
            If lng(2) > 0 Then
                lng(3) = Worksheets("Bestellung").Cells(lng(2), 6) + CDbl(lst_BarcodeWE.Column(0, lngIndex))
                Worksheets("Bestellung").Cells(lng(2), 6) = CDbl(lng(3))
            Else
                If frmBestellung.lstBestellung.ListCount = 0 Then
                    strF = Sheets("Daten").Range("D42")
                    strNr = Sheets("Daten").Range("D41") + 1
                    If CStr(frmBestellung.txtBestellNR) = CStr((Sheets("Daten").Range("D40") & Format(CDbl(strNr), strF))) Then
                        If Sheets("Daten").Range("D39").Value = "Auswahl 1" Then
                            Sheets("Daten").Range("D41") = "'" & Format(CDbl(strNr), strF)
                        End If
                    End If
                End If
                lngZeile = lngZeile + 1
                Range("A500000").End(xlUp).Offset(1, 0).Select
                With ThisWorkbook.Sheets("Lager")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_BarcodeWE.Column(4, lngIndex)) Then
                            lngID = i
                        End If
                    Next i
                End With
                Worksheets("Bestellung").Cells(lngZeile, 1).Value = "'" & txt_KasseNr
                Worksheets("Bestellung").Cells(lngZeile, 2).Value = Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Sheets("Lager").Cells(CLng(lngID), 18).Text, LookIn:=xlValues, MatchCase:=True).Row, 2) 'Lieferant
                Worksheets("Bestellung").Cells(lngZeile, 3).Value = "'" & lst_BarcodeWE.Column(1, lngIndex) 'Artikelnummer
                Worksheets("Bestellung").Cells(lngZeile, 4).Value = "'" & Sheets("Lager").Cells(CDbl(lngID), 4) 'Herstellernummer
                Worksheets("Bestellung").Cells(lngZeile, 5).Value = lst_BarcodeWE.Column(2, lngIndex) 'Bezeichnung
                Worksheets("Bestellung").Cells(lngZeile, 6).Value = lst_BarcodeWE.Column(0, lngIndex) 'Menge
                Worksheets("Bestellung").Cells(lngZeile, 7).Value = Sheets("Lager").Cells(CDbl(lngID), 13) 'Lagerort
                Worksheets("Bestellung").Cells(lngZeile, 8).Value = Format(Date, "DD.MM.YYYY")
                Worksheets("Bestellung").Cells(lngZeile, 9).Value = CDbl(lst_BarcodeWE.Column(0, lngIndex)) * CDbl(Sheets("Lager").Cells(CDbl(lngID), 14)) 'Preis
                Worksheets("Bestellung").Cells(lngZeile, 10).Value = CDbl(Sheets("Lager").Cells(CDbl(lngID), 14))
                If frmBestellung.txtvdate.Value = "" Then
                    Worksheets("Bestellung").Cells(lngZeile, 11).Value = "k.A."
                Else
                    Worksheets("Bestellung").Cells(lngZeile, 11).Value = frmBestellung.txtvdate.Value
                End If
                Worksheets("Bestellung").Cells(lngZeile, 12).Value = lst_BarcodeWE.Column(4, lngIndex) 'ID
                Worksheets("Bestellung").Cells(lngZeile, 13).Value = "'" & Sheets("Lager").Cells(CDbl(lngID), 31) 'EAN
                Worksheets("Bestellung").Cells(lngZeile, 14).Value = lst_BarcodeWE.Column(7, lngIndex)
                frmBestellung.cboArtikelNR.Value = ""
                frmBestellung.lbl_bezeichnung.Caption = ""
                frmBestellung.txtstueck.Value = ""
                frmBestellung.lbl_herstellerNr.Caption = ""
                frmBestellung.lbl_lagerort.Caption = ""
                frmBestellung.lstArtikelID.Clear
            End If
        Next lngIndex
    End With
    Call frmBestellung.Bestellsum
    Call frmBestellung.SuchenBestellungNeu
    Call frmBestellung.Anzeigen
    Call frmBestellung.BeList
    Call BCloeschen
    Call AnsichtLager
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    Unload frmBarcode
End Sub

Private Sub ScanKasse() 'v1.44 Kasse
    Dim lng(1 To 3), lngIndex, lngID, lngZeile As Long
    Dim letztezeile, arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next

    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If Sheets("Daten").Range("B35") = "Ja" And cbo_kostenBC = "" Then
        MsgBox "Sie m|fffd|ssen eine Kostenstelle angeben", , "Kostenstelle"
        cbo_kostenBC.SetFocus
        Exit Sub
    End If
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Kassendaten").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Kassendaten").Activate
    With ThisWorkbook.Worksheets("Kassendaten")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            For lng(1) = 2 To ThisWorkbook.Worksheets("Kassendaten").UsedRange.Rows.Count
                If Worksheets("Kassendaten").Cells(lng(1), 17) = CStr(lst_BarcodeWE.Column(4, lngIndex)) And Worksheets("Kassendaten").Cells(lng(1), 20) = CStr(lst_BarcodeWE.Column(7, lngIndex)) Then
                    lng(2) = Worksheets("Kassendaten").Cells(lng(1), 1).Row
                End If
            Next lng
            If lng(2) > 0 Then
                lng(3) = Worksheets("Kassendaten").Cells(lng(2), 7) + CDbl(lst_BarcodeWE.Column(0, lngIndex))
                Worksheets("Kassendaten").Cells(lng(2), 7) = CDbl(lng(3))
            Else
                lngZeile = lngZeile + 1
                With ThisWorkbook.Sheets("Lager")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_BarcodeWE.Column(4, lngIndex)) Then
                            lngID = i
                        End If
                    Next i
                End With
                If txt_BarcodeArt2.Value = "Intern" Then
                    Worksheets("Kassendaten").Cells(lngZeile, 1) = "Intern" & Format(Date, "dd.mm.yy") & "/" & Format(Time, "hhmmss")
                ElseIf txt_BarcodeArt2.Value = "Barverkauf" Then
                    Worksheets("Kassendaten").Cells(lngZeile, 1) = "Bar" & Format(Date, "dd.mm.yy") & "/" & Format(Time, "hhmmss")
                Else
                    Worksheets("Kassendaten").Cells(lngZeile, 1).Value = "'" & txt_KasseNr 'Belegnummer
                End If
                Worksheets("Kassendaten").Cells(lngZeile, 2) = "'" & lst_BarcodeWE.Column(1, lngIndex)
                Worksheets("Kassendaten").Cells(lngZeile, 3) = Sheets("Lager").Cells(CDbl(lngID), 4) 'Herstellernummer
                Worksheets("Kassendaten").Cells(lngZeile, 4) = Sheets("Lager").Cells(CDbl(lngID), 7) 'Hersteller
                Worksheets("Kassendaten").Cells(lngZeile, 6) = lst_BarcodeWE.Column(2, lngIndex) 'Bezeichnung
                Worksheets("Kassendaten").Cells(lngZeile, 7) = lst_BarcodeWE.Column(0, lngIndex) 'Menge
                Worksheets("Kassendaten").Cells(lngZeile, 8) = Sheets("Lager").Cells(CDbl(lngID), 15) * lst_BarcodeWE.Column(0, lngIndex) 'Gesamt VK
                Worksheets("Kassendaten").Cells(lngZeile, 10) = Sheets("Lager").Cells(CDbl(lngID), 7).Row
                Worksheets("Kassendaten").Cells(lngZeile, 11) = txt_BarcodeArt2.Value
                Worksheets("Kassendaten").Cells(lngZeile, 12) = Sheets("Lager").Cells(CDbl(lngID), 21) 'MWST
                Worksheets("Kassendaten").Cells(lngZeile, 13) = Sheets("Lager").Cells(CDbl(lngID), 15)
                Worksheets("Kassendaten").Cells(lngZeile, 14) = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 32)) 'Gewicht
                Worksheets("Kassendaten").Cells(lngZeile, 15) = lst_BarcodeWE.Column(4, lngIndex) 'ID
                Worksheets("Kassendaten").Cells(lngZeile, 19) = frmKasse.txt_KDID.Value
            End If
        Next
    End With
    frmKasse.SuchenKasseV2
    Call BCloeschen
    Call AnsichtLager
     'Sortieren nach Nummer
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    ActiveSheet.UsedRange.Sort Key1:=Range(Cells(1, 1), Cells(letztezeile, 1)), Header:=xlYes
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    Unload frmBarcode
End Sub

Private Sub ScanVerleih() 'v1.44 Verleih
    Dim lngLine, lngIndex, lngLID, lngAID, letztezeile, arrTmpA, arrTmpB, i, Last_Row, lngZeile As Long
    Dim xwert As Double
    Dim strArticle, strLID As String
    Dim rng As Range
    Dim objLines, objItems As Collection
    Set objLines = New Collection
    Set objItems = New Collection
    On Error Resume Next

    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If Sheets("Daten").Range("B35") = "Ja" And cbo_kostenBC = "" Then
        MsgBox "Sie m|fffd|ssen eine Kostenstelle angeben", , "Kostenstelle"
        cbo_kostenBC.SetFocus
        Exit Sub
    End If
    With ThisWorkbook.Worksheets("Lager")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            strArticle = lst_BarcodeWE.List(lngIndex, 4)
            lngLine = 0
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strArticle) Then
                        lngLine = i
                    End If
                Next i
            End With
            If Not Worksheets("Barcode").Cells(lst_BarcodeWE.Column(5, lngIndex), 10) = "" Then
                strLID = Worksheets("Barcode").Cells(lst_BarcodeWE.Column(5, lngIndex), 10)
                Set rng = Worksheets("Lagerorte").Range("A:A").Find(strLID)
                lngLID = rng.Row
                With ThisWorkbook.Worksheets("Lagerorte")
                    .Cells(lngLID, 4).Value = .Cells(lngLID, 4).Value - CDbl(lst_BarcodeWE.Column(0, lngIndex))
                End With
            Else
                If lngLine > 0 Then
                    If Not lst_BarcodeWE.List(lngIndex, 2) = "" Then
                        .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value - _
                                                 CDbl(lst_BarcodeWE.List(lngIndex, 0))
                    End If
                    objLines.Add lst_BarcodeWE.List(lngIndex, 1)
                    objItems.Add CStr(lngIndex)
                End If
            End If
        Next lngIndex
    End With
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Verleih").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Verleih").Activate
    With ThisWorkbook.Worksheets("Verleih")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            lngZeile = lngZeile + 1
            For lngAID = 2 To ThisWorkbook.Worksheets("Verleih").UsedRange.Rows.Count
                If Sheets("Verleih").Cells(lngAID, 4) = CStr(lst_BarcodeWE.Column(4, lngIndex)) And Sheets("Verleih").Cells(lngAID, 1) = txt_KasseNr.Text Then
                    xwert = Sheets("Verleih").Cells(lngAID, 8)
                    Sheets("Verleih").Cells(lngAID, 8).Value = CDbl(xwert + lst_BarcodeWE.Column(0, lngIndex))
                    GoTo weiter
                End If
            Next lngAID
            Worksheets("Verleih").Cells(lngZeile, 1) = "'" & txt_KasseNr.Value 'Nummer
            Worksheets("Verleih").Cells(lngZeile, 2) = "'" & frmVerleih.txt_KDID.Value
            Worksheets("Verleih").Cells(lngZeile, 3) = "'" & frmVerleih.lbl_KDName.Caption
            Worksheets("Verleih").Cells(lngZeile, 4) = lst_BarcodeWE.Column(4, lngIndex) 'ID
            Worksheets("Verleih").Cells(lngZeile, 5) = "'" & lst_BarcodeWE.Column(1, lngIndex)
            Worksheets("Verleih").Cells(lngZeile, 6) = lst_BarcodeWE.Column(2, lngIndex) 'Bezeichnung
            Worksheets("Verleih").Cells(lngZeile, 8) = lst_BarcodeWE.Column(0, lngIndex) 'Menge
            If Check_umbegr.Value = False Then
                Worksheets("Verleih").Cells(lngZeile, 9).Value = CDate(frmBarcode.txt_VVdatum.Value)
                If txt_VBdatum.Value = "" Then
                    Worksheets("Verleih").Cells(lngZeile, 10).Value = "unbegrenzt"
                    Worksheets("Verleih").Cells(lngZeile, 11).Value = "unbegrenzt"
                Else
                    Worksheets("Verleih").Cells(lngZeile, 10).Value = CDate(frmBarcode.txt_VBdatum.Value)
                End If
            Else
                Worksheets("Verleih").Cells(lngZeile, 9).Value = CDate(frmBarcode.txt_VVdatum.Value)
                Worksheets("Verleih").Cells(lngZeile, 10).Value = "unbegrenzt"
                Worksheets("Verleih").Cells(lngZeile, 11).Value = "unbegrenzt"
            End If
            Worksheets("Verleih").Cells(lngZeile, 14) = Format(Date, "DD.MM.YYYY")
            Worksheets("Verleih").Cells(lngZeile, 15) = frmLager.lbl_Benutzer
            Worksheets("Verleih").Cells(lngZeile, 17) = lst_BarcodeWE.Column(7, lngIndex)
weiter:
        Next
    End With
    Set objLines = Nothing
    Set objItems = Nothing
    Call BCloeschen
    Call AnsichtLager
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    ActiveSheet.UsedRange.Sort Key1:=Range(Cells(1, 1), Cells(letztezeile, 1)), Header:=xlYes
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    If txt_BarcodeArt = "verleih" Then
        frmVerleih.suchenVerleihNr
        frmVerleih.suchenVerleihK
        frmVerleih.suchen
        frmVerleih.SuchenKunden
        frmVerleih.SuchenVNr
        frmVerleih.V2List
    End If
    frmVerleih.cbo_VNr = txt_KasseNr.Value
    Unload frmBarcode
End Sub

Private Sub ScanAufAN() 'v1.44 Auftrag/Angebot
    Dim lngIndex, lngAID, lngID, arrTmpA, arrTmpB, i, Last_Row, lngZeile As Long
    Dim xwert As Double
    On Error Resume Next

    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If Sheets("Daten").Range("B35") = "Ja" And cbo_kostenBC = "" Then
        MsgBox "Sie m|fffd|ssen eine Kostenstelle angeben", , "Kostenstelle"
        cbo_kostenBC.SetFocus
        Exit Sub
    End If
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Reservierungen").Activate
    With ThisWorkbook.Worksheets("Reservierungen")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            lngZeile = lngZeile + 1
            For lngAID = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
                If Sheets("Reservierungen").Cells(lngAID, 18) = CStr(lst_BarcodeWE.Column(4, lngIndex)) And Sheets("Reservierungen").Cells(lngAID, 1) = txt_KasseNr.Text And Sheets("Reservierungen").Cells(lngAID, 23) = lst_BarcodeWE.Column(7, lngIndex) Then
                    xwert = Sheets("Reservierungen").Cells(lngAID, 7)
                    Sheets("Reservierungen").Cells(lngAID, 7).Value = CDbl(xwert + lst_BarcodeWE.Column(0, lngIndex))
                    GoTo weiter
                End If
            Next lngAID
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_BarcodeWE.Column(4, lngIndex)) Then
                        lngID = i
                    End If
                Next i
            End With
            Worksheets("Reservierungen").Cells(lngZeile, 1) = txt_KasseNr.Value 'Nummer
            Worksheets("Reservierungen").Cells(lngZeile, 2) = "'" & lst_BarcodeWE.Column(1, lngIndex)
            Worksheets("Reservierungen").Cells(lngZeile, 3) = Sheets("Lager").Cells(CDbl(lngID), 4) 'Herstellernummer
            Worksheets("Reservierungen").Cells(lngZeile, 4) = Sheets("Lager").Cells(CDbl(lngID), 7) 'Hersteller
            Worksheets("Reservierungen").Cells(lngZeile, 6) = lst_BarcodeWE.Column(2, lngIndex) 'Bezeichnung
            Worksheets("Reservierungen").Cells(lngZeile, 7) = lst_BarcodeWE.Column(0, lngIndex) 'Menge
            Worksheets("Reservierungen").Cells(lngZeile, 8) = Sheets("Lager").Cells(CDbl(lngID), 15) * lst_BarcodeWE.Column(0, lngIndex) 'Gesamt VK
            Worksheets("Reservierungen").Cells(lngZeile, 10) = Sheets("Lager").Cells(CDbl(lngID), 7).Row
            Worksheets("Reservierungen").Cells(lngZeile, 11) = txt_BarcodeArt2.Value
            Worksheets("Reservierungen").Cells(lngZeile, 12) = Sheets("Lager").Cells(CDbl(lngID), 21) 'MWST
            Worksheets("Reservierungen").Cells(lngZeile, 14) = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 32))
            Worksheets("Reservierungen").Cells(lngZeile, 13) = Sheets("Lager").Cells(CDbl(lngID), 15)
            Worksheets("Reservierungen").Cells(lngZeile, 18) = lst_BarcodeWE.Column(4, lngIndex) 'ID
            Worksheets("Reservierungen").Cells(lngZeile, 19) = frmKasse.txt_KDID.Value
            Worksheets("Reservierungen").Cells(lngZeile, 21) = Format(Date, "DD.MM.YYYY")
            Worksheets("Reservierungen").Cells(lngZeile, 22) = frmLager.lbl_Benutzer
weiter:
        Next
    End With
    Call BCloeschen
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    If frmKasse.lstKasse.ListCount = 0 Then
        frmKasse.RAuftraege
        frmKasse.RAngebote
        If txt_BarcodeArt2 = "Auftrag" Then
            frmKasse.cboAuftragSuchen = txt_KasseNr
            frmKasse.SuchenAuftragV2
        ElseIf txt_BarcodeArt2 = "Angebot" Then
            frmKasse.cbo_Angebot = txt_KasseNr
            frmKasse.SuchenAngebotNeu
        End If
    End If
    If txt_BarcodeArt2 = "Auftrag" Then
        frmKasse.SuchenAuftragV2
    End If
    frmKasse.SumKasseV2
    Unload frmBarcode
End Sub

Private Sub ScanAusgang() 'v1.44
    Dim lngLine, lngIndex, lngID, arrTmpA, arrTmpB, i, Last_Row, lngZeile As Long
    Dim Verstr, stxt As String
    Dim objLines, objItems As Collection
    Set objLines = New Collection
    Set objItems = New Collection
    On Error Resume Next

    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Warenausgang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If Sheets("Daten").Range("B35") = "Ja" And cbo_kostenBC = "" Then
        MsgBox "Sie m|fffd|ssen eine Kostenstelle angeben", , "Kostenstelle"
        cbo_kostenBC.SetFocus
        Exit Sub
    End If
    stxt = "BC" & Format(Date, "yymmdd") & Format(Time, "hhmmss")
    Verstr = InputBox("M|fffd|chten Sie einen Verwendungszweck angeben?", "Verwendungszweck")
    With ThisWorkbook.Worksheets("Lager")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            lngLine = 0
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_BarcodeWE.List(lngIndex, 4)) Then
                        lngLine = i
                    End If
                Next i
            End With
            If lngLine > 0 Then
                If Not lst_BarcodeWE.List(lngIndex, 2) = "" Then
                    .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value - _
                                             CDbl(lst_BarcodeWE.List(lngIndex, 0))
                    .Cells(lngLine, 25).Value = .Cells(lngLine, 25).Value + _
                                             CDbl(lst_BarcodeWE.List(lngIndex, 0))
                    .Cells(lngLine, 23).Value = Format(Date, "DD.MM.YYYY")
                    .Cells(lngLine, 24).Value = Format(Time, "hh:mm:ss")
                End If
                objLines.Add lst_BarcodeWE.List(lngIndex, 1)
                objItems.Add CStr(lngIndex)
            End If
        Next
    End With
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Warenausgang").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Warenausgang").Activate
    With ThisWorkbook.Worksheets("Warenausgang")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            lngZeile = lngZeile + 1
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_BarcodeWE.Column(4, lngIndex)) Then
                        lngID = i
                    End If
                Next i
            End With
            Worksheets("Warenausgang").Cells(lngZeile, 1) = "Direkt buchen" 'Art
            Worksheets("Warenausgang").Cells(lngZeile, 2).Value = stxt
            Worksheets("Warenausgang").Cells(lngZeile, 3) = "'" & lst_BarcodeWE.Column(1, lngIndex)
            Worksheets("Warenausgang").Cells(lngZeile, 4) = lst_BarcodeWE.Column(2, lngIndex) 'Bezeichnung
            Worksheets("Warenausgang").Cells(lngZeile, 5) = lst_BarcodeWE.Column(0, lngIndex) 'Menge
            Worksheets("Warenausgang").Cells(lngZeile, 6) = CDbl(Sheets("Lager").Cells(CDbl(lngID), 21) * 100) & "%"
            Worksheets("Warenausgang").Cells(lngZeile, 7) = Sheets("Lager").Cells(CDbl(lngID), 15) * lst_BarcodeWE.Column(0, lngIndex) 'Gesamt VK
            Worksheets("Warenausgang").Cells(lngZeile, 8) = Format(Date, "DD.MM.YYYY") 'Datum
            Worksheets("Warenausgang").Cells(lngZeile, 9) = Format(Time, "hh:mm:ss")
            Worksheets("Warenausgang").Cells(lngZeile, 11) = Format(Date, "mmmm")
            Worksheets("Warenausgang").Cells(lngZeile, 12) = Format(Date, "yyyy")
            Worksheets("Warenausgang").Cells(lngZeile, 13) = Sheets("Lager").Cells(CDbl(lngID), 15)
            Worksheets("Warenausgang").Cells(lngZeile, 14) = lst_BarcodeWE.Column(4, lngIndex) 'ID
            Worksheets("Warenausgang").Cells(lngZeile, 15) = Verstr 'Zweck
            If Sheets("Lager").Cells(CDbl(lngID), 21) > 0 Then
                Worksheets("Warenausgang").Cells(lngZeile, 16).Value = (CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15) * lst_BarcodeWE.Column(0, lngIndex))) * Sheets("Lager").Cells(CDbl(lngID), 21)
            Else
                Worksheets("Warenausgang").Cells(lngZeile, 16).Value = 0
            End If
            If Sheets("Daten").Range("B5").Value = "True" Then
                Worksheets("Warenausgang").Cells(lngZeile, 18).Value = Sheets("Daten").Range("B24").Value
            End If
            If Sheets("Daten").Range("B35") = "Ja" Then
                Worksheets("Warenausgang").Cells(lngZeile, 19).Value = cbo_kostenBC
            End If
        Next
    End With
    Set objLines = Nothing
    Set objItems = Nothing
    Call BCloeschen
    Call AnsichtLager
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    If Sheets("Daten").Range("B5").Value = "True" Then
        MsgBox "Abgang wurde in Warenausgang gebucht!" & vbLf & "Beleg Nr.: " & stxt _
        & vbLf & "Ausgebucht von: " & Sheets("Daten").Range("B24").Value, , "Barcode Scan"
    Else
        MsgBox "Abgang wurde in Warenausgang gebucht!" & vbLf & "Beleg Nr.: " & stxt, , "Barcode Scan"
    End If
    Unload frmBarcode
End Sub

Private Sub ScanVerleihAus() 'v1.44
    Dim intF, intF2 As Long
    On Error Resume Next
    intF = MsgBox("Ein Beleg wurde gedruckt?", vbYesNo, "Hinweis")
    If intF = vbNo Then
        intF2 = MsgBox("M|fffd|chten sie trotzdem fordfahren?", vbYesNo, "Hinweis")
        If intF2 = vbYes Then
            GoTo weiter
        Else
            Exit Sub
        End If
    Else
        GoTo weiter
    End If
weiter:
    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Wareneingang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Verleih")
        If .FilterMode Then .ShowAllData
    End With
    Call AbgleichVer
    Call frmVInfo.suchenVerleihNr
    If frmVInfo.lst_VerleihI.ListCount = 0 Then
        Unload frmBarcode
        Unload frmVInfo
        frmVerleih.lst_VerleihK.Clear
        Call frmVerleih.suchen
        Call frmVerleih.SuchenKunden
        Call frmVerleih.SuchenVNr
    End If
    Unload frmBarcode
    MsgBox "Die Ware wurde wieder in den Lagerbestand gebucht!", , "Einlagern"
End Sub

Sub AbgleichVer()
    Dim lng, lngIndex As Long
    On Error Resume Next
    With ThisWorkbook.Worksheets("Verleih")
        For lng = 2 To .UsedRange.Rows.Count
            For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
                If CStr(Sheets("Verleih").Cells(lng, 4)) = CStr(lst_BarcodeWE.Column(4, lngIndex)) And CStr(Sheets("Verleih").Cells(lng, 1)) = txt_KasseNr.Text Then
                    Sheets("Verleih").Cells(lng, 8).Value = Sheets("Verleih").Cells(lng, 8).Value - CDbl(lst_BarcodeWE.Column(0, lngIndex))
                End If
            Next lngIndex
        Next lng
    End With
    Call VNuller
End Sub

Sub VNuller() '1.38
    Dim lng, lngIndex As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Verleih")
        For lng = 2 To .UsedRange.Rows.Count
            For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
                If CStr(Sheets("Verleih").Cells(lng, 1)) = txt_KasseNr.Text Then
                    If CDbl(Sheets("Verleih").Cells(lng, 8)) = 0 Then
                        .Rows(lng).Delete
                    End If
                End If
            Next lngIndex
        Next lng
    End With
    Application.ScreenUpdating = True
    Call VREinlagernScan
End Sub

Sub VREinlagernScan() 'v1.44
    Dim lngIndex, lng, lngID, arrTmpA, arrTmpB, i, Last_Row, lngZeile As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Verleih_Historie").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Verleih_Historie").Activate
    With ThisWorkbook.Worksheets("Verleih_Historie")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            lngZeile = lngZeile + 1
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_BarcodeWE.Column(4, lngIndex)) Then
                        lngID = i
                    End If
                Next i
            End With
            Worksheets("Verleih_Historie").Cells(lngZeile, 1) = "'" & frmVInfo.txt_VNr.Value
            Worksheets("Verleih_Historie").Cells(lngZeile, 2) = "'" & frmVInfo.txt_KID.Value
            Worksheets("Verleih_Historie").Cells(lngZeile, 3) = frmVInfo.txt_KDName
            Worksheets("Verleih_Historie").Cells(lngZeile, 4) = lst_BarcodeWE.Column(4, lngIndex) 'ID
            Worksheets("Verleih_Historie").Cells(lngZeile, 5) = lst_BarcodeWE.Column(1, lngIndex) 'Artikelnummer
            Worksheets("Verleih_Historie").Cells(lngZeile, 6) = Sheets("Lager").Cells(CLng(lngID), 4)
            Worksheets("Verleih_Historie").Cells(lngZeile, 7) = Sheets("Lager").Cells(CLng(lngID), 6)
            If Not frmBarcode.cbo_kostenBC = "" Then
                Worksheets("Verleih_Historie").Cells(lngZeile, 8) = frmBarcode.cbo_kostenBC
            End If
            For lng = 2 To ThisWorkbook.Worksheets("Verleih").UsedRange.Rows.Count
                If CStr(Sheets("Verleih").Cells(lng, 4)) = txt_AID.Text And CStr(Sheets("Verleih").Cells(lng, 1)) = txt_KasseNr.Text Then
                    If Sheets("Verleih").Cells(lng, 4) = lst_BarcodeWE.Column(4, lngIndex) Then
                        Worksheets("Verleih_Historie").Cells(lngZeile, 9) = Sheets("Verleih").Cells(lng, 7)
                        Worksheets("Verleih_Historie").Cells(lngZeile, 12) = Sheets("Verleih").Cells(lng, 12)
                        Worksheets("Verleih_Historie").Cells(lngZeile, 13) = Sheets("Verleih").Cells(lng, 9)
                        Worksheets("Verleih_Historie").Cells(lngZeile, 14) = Sheets("Verleih").Cells(lng, 10)
                        Worksheets("Verleih_Historie").Cells(lngZeile, 15) = Sheets("Verleih").Cells(lng, 16)
                    End If
                End If
            Next lng
            Worksheets("Verleih_Historie").Cells(lngZeile, 10) = lst_BarcodeWE.Column(0, lngIndex) 'Menge
            Worksheets("Verleih_Historie").Cells(lngZeile, 16) = CDate(Date)
            Worksheets("Verleih_Historie").Cells(lngZeile, 17) = Format(CDate(Date), "MMMM")
            Worksheets("Verleih_Historie").Cells(lngZeile, 18) = Format(CDate(Date), "YYYY")
            Worksheets("Verleih_Historie").Cells(lngZeile, 19) = frmLager.lbl_Benutzer
        Next lngIndex
    End With
    Call BarZU
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Private Sub ScanWEOH() '1.44
    Dim xrow, arrTmpA, arrTmpB, i, Last_Row, lngZ, lngIndex, lngZeile As Long
    On Error Resume Next

    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Wareneingang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Wareneingang").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Wareneingang").Activate
    With ThisWorkbook.Worksheets("Wareneingang")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            lngZeile = lngZeile + 1
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If arrTmpA(i, 1) = CStr(lst_BarcodeWE.Column(4, lngIndex)) Then
                        xrow = i
                    End If
                Next i
            End With
            Worksheets("Wareneingang").Cells(lngZeile, 1) = "'" & frmWareneingangoB.txtbeleg.Value 'Beleg
            Worksheets("Wareneingang").Cells(lngZeile, 2) = frmWareneingangoB.cbo_Lieferant 'Lieferant
            Worksheets("Wareneingang").Cells(lngZeile, 3) = "'" & lst_BarcodeWE.Column(1, lngIndex) 'Artikelnummer
            Worksheets("Wareneingang").Cells(lngZeile, 4) = "'" & Sheets("Lager").Cells(xrow, 4) 'HerstellerNr
            Worksheets("Wareneingang").Cells(lngZeile, 5) = lst_BarcodeWE.Column(2, lngIndex) 'Bezeichnung
            Worksheets("Wareneingang").Cells(lngZeile, 6) = lst_BarcodeWE.Column(0, lngIndex) 'Menge
            Worksheets("Wareneingang").Cells(lngZeile, 7) = "Manueller WE"
            Worksheets("Wareneingang").Cells(lngZeile, 8) = Format(Date, "DD.MM.YYYY") 'Datum
            Worksheets("Wareneingang").Cells(lngZeile, 9) = Format(Time, "hh:mm:ss")
            Worksheets("Wareneingang").Cells(lngZeile, 11) = Sheets("Lager").Cells(xrow, 14) 'EK-Preis /St|fffd|ck
            Worksheets("Wareneingang").Cells(lngZeile, 12) = lst_BarcodeWE.Column(4, lngIndex) 'ID
            If Sheets("Daten").Range("B5").Value = "True" Then
                Worksheets("Wareneingang").Cells(lngZeile, 13).Value = Sheets("Daten").Range("B24").Value
            End If
            Worksheets("Wareneingang").Cells(lngZeile, 16).Value = Format(Date, "MMMM")
            Worksheets("Wareneingang").Cells(lngZeile, 17).Value = Format(Date, "YYYY")
            Worksheets("Wareneingang").Cells(lngZeile, 18).Value = Sheets("Lager").Cells(xrow, 13)
        Next
    End With
    Call BarZU
    Call BCloeschen
    Application.ScreenUpdating = True
    Sheets("Center").Activate
    ActiveWorkbook.Save
    If Sheets("Daten").Range("B5").Value = "True" Then
        MsgBox "Eingabe(n) wurde gebucht!" & vbLf & "Beleg Nr.: " & frmWareneingangoB.txtbeleg.Value _
        & vbLf & "Eingebucht von: " & Sheets("Daten").Range("B24").Value, , "Barcode Scan"
    Else
        MsgBox "Eingang wurde gebucht!" & vbLf & "Beleg Nr.: " & frmWareneingangoB.txtbeleg.Value, , "Barcode Scan"
    End If
    Call frmWareneingangoB.SuchenBeleg
    Unload frmBarcode
End Sub

Private Sub ScanEingang() 'v1.44
    Dim lngIndex, lngZeile As Long
    Dim strBLS As String
    Dim Last_Row, arrTmpA, arrTmpB, i, lngLine, lngLGO As Long
    On Error Resume Next

    If lst_BarcodeWE.ListCount = 0 Then Exit Sub
    With Worksheets("Wareneingang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If Sheets("Daten").Range("F28").Value = "Ja" Then
        strBLS = InputBox("Bitte geben Sie die Lieferschein-Nr. ein!", "Lieferschein")
    End If
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Wareneingang").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Wareneingang").Activate
    With ThisWorkbook.Worksheets("Wareneingang")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            With ThisWorkbook.Sheets("Bestellung")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If arrTmpA(i, 1) = CStr(frmEingang.cboeingang) And arrTmpA(i, 12) = CStr(lst_BarcodeWE.List(lngIndex, 4)) Then
                        lngLine = i
                    End If
                Next i
            End With
            lngZeile = lngZeile + 1
            Worksheets("Wareneingang").Cells(lngZeile, 1) = frmEingang.cboeingang 'Beleg
            Worksheets("Wareneingang").Cells(lngZeile, 2) = Sheets("Bestellung").Cells(CLng(lngLine), 2) 'Lieferant
            Worksheets("Wareneingang").Cells(lngZeile, 3) = "'" & lst_BarcodeWE.Column(1, lngIndex) 'Artikelnummer
            Worksheets("Wareneingang").Cells(lngZeile, 4) = Sheets("Barcode").Cells(CLng(lst_BarcodeWE.Column(5, lngIndex)), 8) 'HerstellerNr
            Worksheets("Wareneingang").Cells(lngZeile, 5) = lst_BarcodeWE.Column(2, lngIndex) 'Bezeichnung
            Worksheets("Wareneingang").Cells(lngZeile, 6) = lst_BarcodeWE.Column(0, lngIndex) 'Menge
            Worksheets("Wareneingang").Cells(lngZeile, 7) = Sheets("Bestellung").Cells(CLng(lngLine), 8) 'Bestellt am
            Worksheets("Wareneingang").Cells(lngZeile, 8) = Format(Date, "DD.MM.YYYY") 'Datum
            Worksheets("Wareneingang").Cells(lngZeile, 9) = Format(Time, "hh:mm:ss")
            Worksheets("Wareneingang").Cells(lngZeile, 11) = Sheets("Barcode").Cells(CLng(lst_BarcodeWE.Column(5, lngIndex)), 5) 'EK-Preis /St|fffd|ck
            Worksheets("Wareneingang").Cells(lngZeile, 12) = Sheets("Barcode").Cells(CLng(lst_BarcodeWE.Column(5, lngIndex)), 1) 'ID
            If Sheets("Daten").Range("B5").Value = "True" Then
                Worksheets("Wareneingang").Cells(lngZeile, 13).Value = Sheets("Daten").Range("B24").Value
            End If
            Worksheets("Wareneingang").Cells(lngZeile, 16).Value = Format(Date, "MMMM")
            Worksheets("Wareneingang").Cells(lngZeile, 17).Value = Format(Date, "YYYY")
            If Sheets("Bestellung").Cells(CLng(lngLine), 15) = "" Then
                Worksheets("Wareneingang").Cells(lngZeile, 18).Value = Sheets("Bestellung").Cells(CLng(lngLine), 7) 'Lagerort
            Else
                With ThisWorkbook.Sheets("Lagerorte")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If arrTmpA(i, 1) = CStr(Sheets("Bestellung").Cells(CLng(lngLine), 14)) And arrTmpA(i, 2) = CStr(lst_BarcodeWE.List(lngIndex, 4)) Then
                            lngLGO = i
                        End If
                    Next i
                End With
                Worksheets("Wareneingang").Cells(lngZeile, 18).Value = Sheets("Lagerorte").Cells(CLng(lngLGO), 3)
            End If
            Worksheets("Wareneingang").Cells(lngZeile, 19).Value = strBLS
        Next
    End With
    Call AbgleichBsT
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    If Sheets("Daten").Range("B5").Value = "True" Then
        MsgBox "Wareneingang wurde gebucht!" & vbLf & "Beleg Nr.: " & frmEingang.cboeingang.Text _
        & vbLf & "Eingebucht von: " & Sheets("Daten").Range("B24").Value, , "Barcode Scan"
    Else
        MsgBox "Eingang wurde gebucht!" & vbLf & "Beleg Nr.: " & frmEingang.cboeingang.Text, , "Barcode Scan"
    End If
    Call frmEingang.TextClear
    Call frmEingang.SuchenEingang
    Call frmEingang.select_all
    Unload frmBarcode
End Sub

Sub AbgleichBsT()
    Dim lng, lngIndex As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Bestellung")
        For lng = 2 To .UsedRange.Rows.Count
            For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
                If Sheets("Bestellung").Cells(lng, 3) = lst_BarcodeWE.Column(1, lngIndex) And .Cells(lng, 1) = frmEingang.cboeingang Then
                    Sheets("Bestellung").Cells(lng, 6).Value = Sheets("Bestellung").Cells(lng, 6).Value - CDbl(lst_BarcodeWE.Column(0, lngIndex))
                End If
            Next lngIndex
        Next lng
    End With
    Application.ScreenUpdating = True
    Call BNuller
    Call BarZU
End Sub

Sub BNuller() '1.38
    Dim lng, lngIndex As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Bestellung")
        For lng = 2 To .UsedRange.Rows.Count
            For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
                 If CStr(.Cells(lng, 1)) = frmEingang.cboeingang Then
                    If CDbl(Sheets("Bestellung").Cells(lng, 6)) = 0 Then
                        .Rows(lng).Delete
                    End If
                End If
            Next lngIndex
        Next lng
    End With
    Application.ScreenUpdating = True
End Sub

Sub BarZU() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    Dim lngLine, lngIndex, lngLID As Long
    Dim strLID As String
    Dim objLines, objItems As Collection
    Set objLines = New Collection
    Set objItems = New Collection
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Lager")
        For lngIndex = 0 To lst_BarcodeWE.ListCount - 1
            lngLine = 0
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_BarcodeWE.List(lngIndex, 4)) Then
                        lngLine = i
                    End If
                Next i
            End With
            If Not Worksheets("Barcode").Cells(lst_BarcodeWE.Column(5, lngIndex), 10) = "" Then
                strLID = Worksheets("Barcode").Cells(lst_BarcodeWE.Column(5, lngIndex), 10)
                With ThisWorkbook.Sheets("Lagerorte")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strLID) Then
                            lngLID = i
                        End If
                    Next i
                End With
                With ThisWorkbook.Worksheets("Lagerorte")
                    .Cells(lngLID, 4).Value = .Cells(lngLID, 4).Value + CDbl(lst_BarcodeWE.Column(0, lngIndex))
                End With
            Else
                If lngLine > 0 Then
                    If Not lst_BarcodeWE.List(lngIndex, 2) = "" Then
                        .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value + CDbl(lst_BarcodeWE.List(lngIndex, 0))
                    End If
                    objLines.Add lst_BarcodeWE.List(lngIndex, 1)
                    objItems.Add CStr(lngIndex)
                End If
            End If
        Next lngIndex
    End With
    Application.ScreenUpdating = True
    Call BCloeschen
End Sub

Sub BCloeschen()
    Dim z, l As Long
    On Error Resume Next
    For z = lst_BarcodeWE.ListCount To 1 Step -1
        l = lst_BarcodeWE.Column(5, z - 1)
        Sheets("Barcode").Rows(l).Delete
    Next
    lst_BarcodeWE.Clear
    Unload frmBarcode
    frmLager.txt_item.SetFocus
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    Call BCloeschen
End Sub

Sub KuHiZu()
    Dim stxt As String
    If frmKasse.txt_KDID.Value = "" Then
        stxt = MsgBox("M|fffd|chten Sie einen Kunden ausw|fffd|hlen?", vbYesNo, "Kunde")
        If stxt = vbYes Then
            frmContact.txt_KDID2.Value = CDbl(Sheets("Daten").Range("B19")) + 1
            frmContact.cboAnsp.Visible = False
            frmContact.txtdate.Visible = False
            frmContact.lblinfo.Visible = False
            frmContact.comnext.Visible = False
            frmContact.cmd_invoiceprint.Visible = False
            frmContact.cmdnextL.Visible = False
            frmContact.lblMitarbeiter.Visible = False
            frmContact.cmd_KDsave.Visible = True
            frmContact.lblinfo2.Visible = False
            frmContact.Show
        End If
    End If
End Sub
Attribute VB_Name = "frmBericht"
Attribute VB_Base = "0{C27C40B7-559B-4CC7-94E1-AD12C7856CD5}{E4FC735C-B74B-4C99-BBE6-7B127C0D8B37}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub Check_WG_Change()
    On Error Resume Next
    If Check_WG.Value = True Then
        cbo_InWarengruppe.Enabled = True
        cbo_InWarengruppe.ListIndex = 0
    Else
        cbo_InWarengruppe.Enabled = False
        cbo_InWarengruppe.ListIndex = -1
    End If
End Sub

Private Sub cmd_AHBezeichnung_Click()
    Call BezeichnungS
End Sub

Private Sub cmd_Auftrag_Click()
    If Not txtRAuftragsNr = "" Then
        frmKasse.cboAuftragSuchen = txtRAuftragsNr
        Unload frmBericht
        frmKasse.Show
    End If
End Sub

Private Sub cmd_BAufNr_Click()
    Dim SNstr As String
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j, lng, lngID As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2, j2, n2, lng2, lngs2 As Long
    On Error Resume Next
    SNstr = InputBox("Bitte geben Sie die gesuchte Auftrags-Nr ein!", "Suche Auftrag")
    If SNstr = "" Then
        Exit Sub
    Else
        txt_Kunden.Visible = False
        lbl_Kunden.Visible = False
        lstWAout.Clear
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Warenausgang")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AO" & Last_Row)
           ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
           For i = 7 To UBound(arrTmpA)
                If Not arrTmpA(i, 23) = "" And LCase(arrTmpA(i, 23)) = LCase(SNstr) Then
                    n = n + 1
                    With ThisWorkbook.Sheets("Kunden")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 2, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 1) = CStr(arrTmpA(i, 17)) Then
                                lngID = i2
                            End If
                        Next i2
                    End With
                    arrTmpB(1, n) = arrTmpA(i, 2)
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 8)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(3, n) = arrTmpA(i, 3)
                    arrTmpB(4, n) = arrTmpA(i, 4)
                    arrTmpB(5, n) = arrTmpA(i, 5)
                    arrTmpB(6, n) = arrTmpA(i, 7)
                    arrTmpB(7, n) = i
                    If Not arrTmpA(i, 17) = "" Then
                        txt_Kunden.Visible = True
                        lbl_Kunden.Visible = True
                        If Worksheets("Kunden").Cells(CDbl(lngID), 4) = "Firma" Then
                            txt_Kunden.Value = "Firma " & Worksheets("Kunden").Cells(CDbl(lngID), 7)
                        Else
                            txt_Kunden.Value = Worksheets("Kunden").Cells(CDbl(lngID), 7) & ", " & Worksheets("Kunden").Cells(CDbl(lngID), 6)
                        End If
                    Else
                        txt_Kunden.Visible = False
                        lbl_Kunden.Visible = False
                    End If
                End If
           Next i
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 8)
                For i = 1 To 8
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With lstWAout
                   .ColumnCount = 6
                   .ColumnWidths = "120;60;120;250;50;40"
                   .List = arrTmpA
                End With
           End If
        End With
        If lstWAout.ListCount = 0 Then
            MsgBox "Zu Ihrer Suchabfrage ''" & _
            SNstr & "'' wurde kein Auftrag gefunden!", vbInformation, "Suchabfrage"
            Exit Sub
        End If
        Application.ScreenUpdating = True
        Call Datensaetze
    End If
End Sub

Private Sub cmd_BLSNr_Click()
    Dim SNstr As String
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j, lng, lngID As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2, j2, n2, lng2, lngs2 As Long
    On Error Resume Next
    SNstr = InputBox("Bitte geben Sie den gesuchten Lieferschein ein!", "Suche Lieferschein")
    If SNstr = "" Then
        Exit Sub
    Else
        txt_Kunden.Visible = False
        lbl_Kunden.Visible = False
        lstWAout.Clear
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Warenausgang")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AO" & Last_Row)
           ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
           For i = 7 To UBound(arrTmpA)
                If Not arrTmpA(i, 22) = "" And LCase(arrTmpA(i, 22)) = LCase(SNstr) Then
                    n = n + 1
                    With ThisWorkbook.Sheets("Kunden")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 2, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 1) = CStr(arrTmpA(i, 17)) Then
                                lngID = i2
                            End If
                        Next i2
                    End With
                    arrTmpB(1, n) = arrTmpA(i, 2)
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 8)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(3, n) = arrTmpA(i, 3)
                    arrTmpB(4, n) = arrTmpA(i, 4)
                    arrTmpB(5, n) = arrTmpA(i, 5)
                    arrTmpB(6, n) = arrTmpA(i, 7)
                    arrTmpB(7, n) = i
                    If Not arrTmpA(i, 17) = "" Then
                        txt_Kunden.Visible = True
                        lbl_Kunden.Visible = True
                        If Worksheets("Kunden").Cells(CDbl(lngID), 4) = "Firma" Then
                            txt_Kunden.Value = "Firma " & Worksheets("Kunden").Cells(CDbl(lngID), 7)
                        Else
                            txt_Kunden.Value = Worksheets("Kunden").Cells(CDbl(lngID), 7) & ", " & Worksheets("Kunden").Cells(CDbl(lngID), 6)
                        End If
                    Else
                        txt_Kunden.Visible = False
                        lbl_Kunden.Visible = False
                    End If
                End If
           Next i
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 8)
                For i = 1 To 8
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With lstWAout
                   .ColumnCount = 6
                   .ColumnWidths = "120;60;120;250;50;40"
                   .List = arrTmpA
                End With
           End If
        End With
        If lstWAout.ListCount = 0 Then
            MsgBox "Zu Ihrer Suchabfrage ''" & _
            SNstr & "'' wurde kein Lieferschein gefunden!", vbInformation, "Suchabfrage"
            Exit Sub
        End If
        Application.ScreenUpdating = True
        Call Datensaetze
    End If
End Sub

Private Sub lbl_EK_Click()
    If Not txtID = "" Then
        lbl_EK.FontBold = True
        lbl_VKEK.FontBold = False
        lstAhis.BackColor = &HC0E0FF
        lstAhis.BorderColor = &H40C0&
        lbl_EK.Top = 157
        lbl_VKEK.Top = 158
        Call AEink
    End If
End Sub

Private Sub lbl_VKEK_Click()
    If Not txtID = "" Then
        lbl_VKEK.BackColor = &H808080
        Call SuchenAhis
        lbl_EK.FontBold = False
        lbl_EK.Top = 158
        lbl_VKEK.Top = 157
        lbl_VKEK.FontBold = True
        lstAhis.BackColor = &HFFFFFF
        lstAhis.BorderColor = &H80000006
    End If
End Sub

Private Sub txt_Kunden2_Change()
    If Not txt_Kunden2 = "" Then
        cmd_Auftrag.Visible = True
    Else
        cmd_Auftrag.Visible = True
    End If
End Sub

Private Sub txtID_Change()
    If txtID = "" Then
        lbl_VKEK.Visible = False
        lbl_EK.Visible = False
        lbl_VKEK.FontBold = False
        lbl_EK.FontBold = False
        lstAhis.BackColor = &HFFFFFF
        lstAhis.BorderColor = &H80000006
        lbl_VKEK.Caption = "Verkauf"
        lbl_EK.Caption = "Einkauf"
    Else
        lbl_VKEK.Visible = True
        lbl_VKEK.Top = 157
        lbl_EK.Visible = True
        lbl_VKEK.FontBold = True
        lbl_EK.FontBold = False
        lstAhis.BackColor = &HFFFFFF
        lstAhis.BorderColor = &H80000006
        lbl_VKEK.Caption = "Verkauf (" & txtsumme & ")"
        lbl_EK.Caption = "Einkauf(" & txtsummeE & ")"
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim lngrow, lngZ As Long
    Dim objDic As Object
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    txt_Finfo.Value = ""
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    txtbeleg.SetFocus
    Application.ScreenUpdating = False
    cbo_InWarengruppe.AddItem "Alle anzeigen"
    Set objDic = CreateObject("Scripting.Dictionary")
        For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 8).End(xlUp).Row
          objDic(Sheets("Daten").Cells(lngZ, 8).Value) = 0
        Next
        cboWarengruppe.List = objDic.keys
        cbo_InWarengruppe.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
    Call LieferantCombo
    Call JahrCombo
    Call ArtikelCombo
    If lstMin.ListCount = 0 Then
        cbo_BstLieferant.Enabled = False
    Else
        cbo_BstLieferant.Enabled = True
    End If
    cbojahr.Value = Format(Date, "yyyy")
    Call InfoAlles
    tbDatumvon = CDate(Date) - 30
    tbDatumbis = CDate(Date)
    CheckBoxMin.Value = True
    Call SuchenBeleg3
End Sub

Sub InfoAlles() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row, lngS As Long
    Dim SuchKriterium As String
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2, j2 As Long
    Dim Wert1, Wert2 As Double
    On Error Resume Next
    Application.ScreenUpdating = False
    Wert1 = 0
    Wert2 = 0
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not LCase(arrTmpA(i, 1)) = "" Then
                lngS = 0
                Wert1 = Wert1 + arrTmpA(i, 8)
                Wert2 = Wert2 + (CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)))
                With ThisWorkbook.Sheets("Lagerorte")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If Not arrTmpA2(i2, 2) = "" And arrTmpA2(i2, 2) = CStr(arrTmpA(i, 1)) Then
                            Wert1 = Wert1 + CDbl(arrTmpA2(i2, 4))
                            Wert2 = Wert2 + (CDbl(arrTmpA2(i2, 4)) * CDbl(arrTmpA(i, 14)))
                        End If
                    Next i2
                End With
           End If
       Next i
    End With
    Application.ScreenUpdating = True
    txtALagerbestand = Wert1
    txtsumLager.Value = Format(Wert2, "currency")
End Sub

Sub LieferCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
        For lngZ = 0 To lstMin.ListCount
          objDic(lstMin.List(lngZ, 1)) = 0
        Next
        cbo_BstLieferant.List = objDic.keys
    Set objDic = Nothing
    Call SortierenBTLF
    Application.ScreenUpdating = True
End Sub

Sub SortierenBTLF()
    Dim i_Erster As Integer
    Dim i_Letzter As Integer
    Dim i_Aktuell As Integer
    Dim i_N|fffd|chster As Integer
    Dim s_buffer As String
    If cbo_BstLieferant.ListCount = 0 Then Exit Sub
    Application.ScreenUpdating = False
    With frmBericht.cbo_BstLieferant
        i_Erster = 0
        i_Letzter = .ListCount - 1
        For i_Aktuell = i_Erster To i_Letzter
            For i_N|fffd|chster = i_Aktuell + 1 To i_Letzter
                If .List(i_Aktuell) > .List(i_N|fffd|chster) Then
                    s_buffer = .List(i_N|fffd|chster)
                    .List(i_N|fffd|chster) = .List(i_Aktuell)
                    .List(i_Aktuell) = s_buffer
                End If
            Next i_N|fffd|chster
        Next i_Aktuell
    End With
    cbo_BstLieferant.ListIndex = -1
    If lstMin.ListCount = 0 Then
        cbo_BstLieferant.Enabled = False
    Else
        cbo_BstLieferant.Enabled = True
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_BstLieferant_Change()
    If lstMin.ListCount = 0 Then
        cbo_BstLieferant.Enabled = False
    Else
        cbo_BstLieferant.Enabled = True
    End If
End Sub

Private Sub cbo_BstLieferant_Click()
    If CheckBoxMin.Value = True Then
        Call SuchenMinL
    Else
        Call SuchenMeldeL
    End If
End Sub

Private Sub cmd_Vab_Click()
    txt_Finfo.Value = "ab"
    Call Vab
End Sub

Sub VBald()
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    Dim SuchKriterium As String
    On Error Resume Next
    SuchKriterium = txtdatum.Text
    list_Verwendbar.ForeColor = &H404040
    list_Verwendbar.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 39) = "" Then
                If Not CDate(arrTmpA(i, 39)) <= CDate(Date) And arrTmpA(i, 40) = "" Then
                    If Not CDate(arrTmpA(i, 39)) - 14 >= CDate(Date) Then
                         n = n + 1
                         arrTmpB(1, n) = arrTmpA(i, 3)
                         arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                         arrTmpB(3, n) = arrTmpA(i, 39)
                         arrTmpB(4, n) = "automatisch"
                         arrTmpB(5, n) = arrTmpA(i, 13)
                         arrTmpB(6, n) = arrTmpA(i, 1)
                         arrTmpB(7, n) = i
                     End If
                Else
                    If Not CDate(arrTmpA(i, 39)) <= CDate(Date) And CDate(arrTmpA(i, 40)) <= CDate(Date) Then
                         n = n + 1
                         arrTmpB(1, n) = arrTmpA(i, 3)
                         arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                         arrTmpB(3, n) = arrTmpA(i, 39)
                         arrTmpB(4, n) = arrTmpA(i, 40)
                         arrTmpB(5, n) = arrTmpA(i, 13)
                         arrTmpB(6, n) = arrTmpA(i, 1)
                         arrTmpB(7, n) = i
                     End If
                End If
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With list_Verwendbar
               .ColumnCount = 5
               .ColumnWidths = "100;250;70;70;150"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub

Sub Vab()
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    On Error Resume Next
    list_Verwendbar.ForeColor = &H404040
    list_Verwendbar.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not arrTmpA(i, 39) = "" Then
               If CDate(arrTmpA(i, 39)) <= CDate(Date) Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 3)
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(3, n) = arrTmpA(i, 39)
                    arrTmpB(4, n) = arrTmpA(i, 40)
                    arrTmpB(5, n) = arrTmpA(i, 13)
                    arrTmpB(6, n) = arrTmpA(i, 1)
                    arrTmpB(7, n) = i
                End If
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With list_Verwendbar
               .ColumnCount = 5
               .ColumnWidths = "100;250;70;70;150"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_Vbald_Click()
    Call VBald
End Sub

Private Sub CommandButton10_Click()
    Dim arrTmpA, arrTmpB, i, Last_Row, lngIndex, Farbe, lngID, lngZeile As Long
    On Error Resume Next
    If CDbl(list_Verwendbar.ListCount) = 0 Then Exit Sub
    Application.ScreenUpdating = False
    Sheets("Vorlage2").Visible = True
    Sheets("Vorlage2").Activate
    Sheets("Vorlage2").Range("A7:G300").Delete
    If txt_Finfo.Value = "ab" Then
        Sheets("Vorlage2").Range("A1") = "Verwendbarkeit abgelaufen"
    Else
        Sheets("Vorlage2").Range("A1") = "Verwendbarkeit l|fffd|uft bald ab"
    End If
    If cbo_BstLieferant = "" Then
        Sheets("Vorlage2").Range("A3") = ""
    Else
        Sheets("Vorlage2").Range("A3") = "Lieferant: " & cbo_BstLieferant.Text
    End If
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("B6") = "Artikel Nr."
    Sheets("Vorlage2").Range("G1") = Format(Date, "DD.MM.YYYY")
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = ""
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = "Verwendbar bis"
    lngZeile = Worksheets("Vorlage2").Cells(Rows.Count, 1).End(xlUp).Row
    For lngIndex = 0 To frmBericht.list_Verwendbar.ListCount - 1
        lngZeile = lngZeile + 1
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmBericht.list_Verwendbar.Column(5, lngIndex)) Then
                    lngID = i
                End If
            Next i
        End With
        Worksheets("Vorlage2").Cells(lngZeile, 1).Value = CDbl(lngIndex) + 1
        Worksheets("Vorlage2").Cells(lngZeile, 1).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 2).Value = "'" & frmBericht.list_Verwendbar.Column(0, lngIndex) 'Artikelnummer
        Worksheets("Vorlage2").Cells(lngZeile, 2).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 3).Value = Sheets("Lager").Cells(lngID, 4) 'Herstellernummer
        Worksheets("Vorlage2").Cells(lngZeile, 3).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 4).Value = frmBericht.list_Verwendbar.Column(1, lngIndex) 'Beschreibung
        Worksheets("Vorlage2").Cells(lngZeile, 4).WrapText = True
        Worksheets("Vorlage2").Cells(lngZeile, 4).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 6).Value = frmBericht.list_Verwendbar.Column(4, lngIndex) 'Lagerort
        Worksheets("Vorlage2").Cells(lngZeile, 6).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 7).Value = frmBericht.list_Verwendbar.Column(3, lngIndex) 'Sollbestand
        Worksheets("Vorlage2").Cells(lngZeile, 7).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 7).HorizontalAlignment = xlCenter
    Next
    Farbe = 0
    For lngIndex = 0 To frmBericht.list_Verwendbar.ListCount - 1
        If Farbe = 1 Then
            Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = -0.149998474074526
                .PatternTintAndShade = 0
            End With
            Farbe = 0
        Else
            Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
            Farbe = 1
        End If
    Next
    Worksheets("Vorlage2").PrintOut
    Application.ScreenUpdating = True
    Sheets("Center").Activate
    MsgBox "Ausdruck erfolgt!", vbOKOnly, "Drucken"
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Schlie|fffd|en"" beenden!", , "Hinweis"
        cmdexit.SetFocus
        Cancel = True
    End If
End Sub

Private Sub cmd_BSerienNr_Click()
    Dim SNstr As String
    Dim lng, lngID As Long
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2, j2, n2, lng2, lngs2 As Long
    On Error Resume Next
    SNstr = InputBox("Bitte geben Sie eine Seriennummer ein!", "Suche")
    If SNstr = "" Then
        Exit Sub
    Else
        txt_Kunden.Visible = False
        lbl_Kunden.Visible = False
        lstWAout.Clear
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Warenausgang")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AO" & Last_Row)
           ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
           For i = 7 To UBound(arrTmpA)
                If Not arrTmpA(i, 20) = "" And LCase(arrTmpA(i, 20)) = SNstr Then
                    n = n + 1
                    With ThisWorkbook.Sheets("Kunden")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 2, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 1) = CStr(arrTmpA(i, 17)) Then
                                lngID = i2
                            End If
                        Next i2
                    End With
                    arrTmpB(1, n) = arrTmpA(i, 2)
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 8)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(3, n) = arrTmpA(i, 3)
                    arrTmpB(4, n) = arrTmpA(i, 4)
                    arrTmpB(5, n) = arrTmpA(i, 5)
                    arrTmpB(6, n) = arrTmpA(i, 7)
                    arrTmpB(7, n) = i
                    If Not arrTmpA(i, 17) = "" Then
                        txt_Kunden.Visible = True
                        lbl_Kunden.Visible = True
                        If Worksheets("Kunden").Cells(CDbl(lngID), 4) = "Firma" Then
                            txt_Kunden.Value = "Firma " & Worksheets("Kunden").Cells(CDbl(lngID), 7)
                        Else
                            txt_Kunden.Value = Worksheets("Kunden").Cells(CDbl(lngID), 7) & ", " & Worksheets("Kunden").Cells(CDbl(lngID), 6)
                        End If
                    Else
                        txt_Kunden.Visible = False
                        lbl_Kunden.Visible = False
                    End If
                End If
           Next i
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 8)
                For i = 1 To 8
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With lstWAout
                   .ColumnCount = 6
                   .ColumnWidths = "120;60;120;250;50;40"
                   .List = arrTmpA
                End With
           End If
        End With
        If lstWAout.ListCount = 0 Then
            MsgBox "Zu Ihrer Suchabfrage ''" & _
            SNstr & "'' wurden keine Seriennummer gefunden.", vbInformation, "Suchabfrage"
            Exit Sub
        End If
        Application.ScreenUpdating = True
        Call Datensaetze
    End If
End Sub

Private Sub cmd_PosSBeleg_Click()
    If lstWAout.ListCount = 0 Then Exit Sub
    If lstWAout.ListCount = 1 Then
        Call Bstorno
    Else
        Call PosStorno
    End If
    If Not txtbeleg.Value = "" Then
        Call SuchenBeleg
    End If
End Sub

Private Sub txtbeleg_Change()
    If txtbeleg = "" Then
        cmd_SBeleg.Enabled = False
        cmd_PosSBeleg.Enabled = False
    Else
        cmd_SBeleg.Enabled = True
        cmd_PosSBeleg.Enabled = True
        Call SuchenBeleg
    End If
End Sub

Private Sub cbo_ArikelNrBeHist_Change()
    If cbo_ArikelNrBeHist = "" Then Exit Sub
    txt_ArikelNrBeHist.Value = ""
    lbl_Smenge.Visible = True
    lbl_smenge2.Visible = True
    Call SuchenLieferant2
    Call BerechnungL
    Call BerechnungLME
End Sub

Private Sub cmd_ArikelNrBeHist_Click()
    cbo_ArikelNrBeHist.ListIndex = -1
    If txt_ArikelNrBeHist.Value = "" Then
        txt_ArikelNrBeHist.SetFocus
        Exit Sub
    End If
    lbl_Smenge.Visible = True
    lbl_smenge2.Visible = True
    Call SuchenLieferant2
End Sub

Private Sub txt_ArikelNrBeHist_Click()
    cbo_ArikelNrBeHist.ListIndex = 0
End Sub

Private Sub ListWE_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    cbo_ArikelNrBeHist.Value = ListWE.Column(0)
End Sub

Private Sub cmd_SBeleg_Click()
    Call Bstorno
    If Not txtbeleg.Value = "" Then
        Call SuchenBeleg
    End If
End Sub

Sub Bstorno() '1.44
    Dim zlng, lngIndex, Stolng, i, lngID, lngZeile As Long
    Dim stxt, s2txt, s3txt As String
    Dim arrTmpA, arrTmpB, i2, Last_Row As Long
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    Call SuchenBeleg2
    Application.Cursor = xlWait
    Application.StatusBar = "Daten werden geladen.... Bitte warten!"
    Application.StatusBar = False
    Application.Cursor = xlDefault
    If txtbeleg.Value = "" Then Exit Sub
    If lstWAout.ListCount = 0 Then Exit Sub
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Warenausgang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) = CStr(txtbeleg) Then
                If InStr(1, LCase(arrTmpA(i, 15)), LCase("Umwandeln")) > 0 Then
                    MsgBox "F|fffd|r Umgewandelte Artikel nicht m|fffd|glich!", , "Hinweis"
                    Sheets("Center").Activate
                    Application.ScreenUpdating = True
                    Exit Sub
                End If
            End If
        Next i
    End With
    stxt = MsgBox("M|fffd|chten Sie den Beleg: " + txtbeleg + " stornieren?", vbYesNo + vbQuestion, "Beleg stornieren")
    If stxt = vbYes Then
        i = 0
        s2txt = MsgBox("M|fffd|chten Sie die Menge wieder ins Lager verbuchen?", vbYesNo, "Beleg stornieren")
        s3txt = InputBox("M|fffd|chten Sie einen Grund angeben? (z.B. Falsch Lieferung).", "Beleg stornieren")
        Stolng = 0
        Sheets("Warenausgang").Activate
        lngZeile = Worksheets("Warenausgang").Cells(Rows.Count, 1).End(xlUp).Row
        With ThisWorkbook.Worksheets("Warenausgang")
            For lngIndex = 0 To lstWAout.ListCount - 1
                If Not Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 1) = "Storno" Then
                    Stolng = Stolng + 1
                    With ThisWorkbook.Sheets("Lager")
                        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AO" & Last_Row)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i2 = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i2, 1) = "" And CStr(arrTmpA(i2, 1)) = CStr(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 14)) Then
                                lngID = i2
                            End If
                        Next i2
                    End With
                    lngZeile = lngZeile + 1
                    Worksheets("Warenausgang").Cells(lngZeile, 1) = "Storno" 'Art
                    Worksheets("Warenausgang").Cells(lngZeile, 2) = lstWAout.Column(0, lngIndex) 'StornoBeleg
                    Worksheets("Warenausgang").Cells(lngZeile, 3) = lstWAout.Column(2, lngIndex)
                    Worksheets("Warenausgang").Cells(lngZeile, 4) = lstWAout.Column(3, lngIndex) & " (Storno)" 'Bezeichnung
                    Worksheets("Warenausgang").Cells(lngZeile, 5) = Abs(lstWAout.Column(4, lngIndex)) * -1 'Menge
                    Worksheets("Warenausgang").Cells(lngZeile, 6) = Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 6)
                    Worksheets("Warenausgang").Cells(lngZeile, 7) = Abs(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 7)) * -1 'Preis
                    Worksheets("Warenausgang").Cells(lngZeile, 8) = Format(Date, "DD.MM.YYYY")
                    Worksheets("Warenausgang").Cells(lngZeile, 9) = Format(Time, "hh:mm:ss")
                    Worksheets("Warenausgang").Cells(lngZeile, 10) = "RE Datum: " & Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 8)
                    Worksheets("Warenausgang").Cells(lngZeile, 11) = Format(Date, "MMMM")
                    Worksheets("Warenausgang").Cells(lngZeile, 12) = Format(Date, "YYYY")
                    Worksheets("Warenausgang").Cells(lngZeile, 13) = Abs(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 13)) * -1
                    Worksheets("Warenausgang").Cells(lngZeile, 14) = CStr(lstWAout.Column(6, lngIndex)) 'Artikel ID
                    If s3txt = "" Then
                        Worksheets("Warenausgang").Cells(lngZeile, 15) = Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 15)
                    Else
                        Worksheets("Warenausgang").Cells(lngZeile, 15) = s3txt 'Grund
                    End If
                    If s2txt = vbYes Then
                        'Bestand Korrektur
                        If Not Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 26) = "" Then
                            If Not Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 21) = "" Then
                                Worksheets("Lagerorte").Cells((Worksheets("Lagerorte").Range("A:A").Find(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 21).Text, LookIn:=xlValues, MatchCase:=True).Row), 4) = _
                                Worksheets("Lagerorte").Cells((Worksheets("Lagerorte").Range("A:A").Find(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 21).Text, LookIn:=xlValues, MatchCase:=True).Row), 4) + CDbl(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 26))
                            Else
                                Worksheets("Lager").Cells(CDbl(lngID), 8) = _
                                Worksheets("Lager").Cells(CDbl(lngID), 8) + CDbl(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 26))
                            End If
                            Worksheets("Lager").Cells(CDbl(lngID), 25) = Worksheets("Lager").Cells(CDbl(lngID), 25) - CDbl(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 26))
                        Else
                            If Not Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 21) = "" Then
                                Worksheets("Lagerorte").Cells((Worksheets("Lagerorte").Range("A:A").Find(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 21).Text, LookIn:=xlValues, MatchCase:=True).Row), 4) = _
                                Worksheets("Lagerorte").Cells((Worksheets("Lagerorte").Range("A:A").Find(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 21).Text, LookIn:=xlValues, MatchCase:=True).Row), 4) + lstWAout.Column(4, lngIndex)
                            Else
                                Worksheets("Lager").Cells(CDbl(lngID), 8) = _
                                Worksheets("Lager").Cells(CDbl(lngID), 8) + lstWAout.Column(4, lngIndex)
                            End If
                            Worksheets("Lager").Cells(CDbl(lngID), 25) = Worksheets("Lager").Cells(CDbl(lngID), 25) - lstWAout.Column(4, lngIndex)
                        End If
                    End If
                    'Verkaufte Menge Korrektur
                    Worksheets("Warenausgang").Cells(lngZeile, 16) = Abs(Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 16)) * -1
                    Worksheets("Warenausgang").Cells(lngZeile, 17) = Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 17) 'KDID
                    Worksheets("Warenausgang").Cells(lngZeile, 18) = Sheets("Warenausgang").Cells(lstWAout.Column(7, lngIndex), 23) 'Auftragsnummer
                    If Sheets("Daten").Range("B5").Value = "True" Then
                        Worksheets("Warenausgang").Cells(lngZeile, 18).Value = Sheets("Daten").Range("B24").Value
                    End If
                End If
            Next lngIndex
        End With
    Else
        Application.ScreenUpdating = True
        Exit Sub
    End If
    If Stolng = 0 Then
        MsgBox "Es handelt sich schon um ein Storno - Beleg", vbInformation, "Info"
        Sheets("Center").Activate
        Application.ScreenUpdating = True
        Exit Sub
    End If
    For zlng = 7 To Worksheets("Warenausgang").Cells(Rows.Count, 1).End(xlUp).Row
        If Worksheets("Warenausgang").Cells(zlng, 2).Value = txtbeleg.Value Then
            Worksheets("Warenausgang").Cells(zlng, 10).Value = "Storniert am " & Format(Date, "DD.MM.YYYY")
            Worksheets("Warenausgang").Cells(zlng, 1).Value = "Storno"
            i = i + 1
        End If
    Next zlng
    ActiveWorkbook.Save
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    MsgBox "Beleg: " + txtbeleg + " wurde storniert!" & vbLf & vbLf & "Sie k|fffd|nnen nun auch beim Kunden eine Stornorechnung drucken!", vbInformation, "Hinweis"
End Sub

Sub PosStorno() '1.44
    Dim slng, lng, lngID, lngID2, lngZeile As Long
    Dim stxt, s2txt, s3txt As String
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    stxt = MsgBox("M|fffd|chten Sie die Position aus dem Beleg: " + txtbeleg + " stornieren?", vbYesNo, "Markierte Position stornieren")
    If stxt = vbNo Then Exit Sub
    If lstWAout.Column(4) < 0 Then
        MsgBox "Es handelt sich schon um ein Storno - Beleg", , "Info"
        Application.ScreenUpdating = True
        Exit Sub
    End If
    With ThisWorkbook.Sheets("Warenausgang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) = CStr(txtbeleg) Then
                If InStr(1, LCase(arrTmpA(i, 15)), LCase("Umwandeln")) > 0 Then
                    MsgBox "F|fffd|r Umgewandelte Artikel nicht m|fffd|glich!", , "Hinweis"
                    Sheets("Center").Activate
                    Application.ScreenUpdating = True
                    Exit Sub
                End If
            End If
        Next i
    End With
    s2txt = MsgBox("M|fffd|chten Sie die Menge wieder ins Lager verbuchen?", vbYesNo, "Pos. stornieren")
    s3txt = InputBox("M|fffd|chten Sie einen Grund angeben? (z.B. Falsch Lieferung).", "Pos. stornieren")
    Sheets("Warenausgang").Activate
    lng = lstWAout.Column(7)
    slng = CDbl(lstWAout.Column(5))
    Worksheets("Warenausgang").Cells(lng, 10).Value = "Storniert am " & Format(Date, "DD.MM.YYYY")
    Worksheets("Warenausgang").Cells(lng, 1).Value = "Storno"
    lngZeile = Worksheets("Warenausgang").Cells(Rows.Count, 1).End(xlUp).Row
    With ThisWorkbook.Worksheets("Warenausgang")
        lngZeile = lngZeile + 1
        Range("A65536").End(xlUp).Offset(1, 0).Select
        Worksheets("Warenausgang").Cells(lngZeile, 1) = "Storno" 'Art
        Worksheets("Warenausgang").Cells(lngZeile, 2) = txtbeleg 'StornoBeleg
        Worksheets("Warenausgang").Cells(lngZeile, 3) = lstWAout.Column(2)
        Worksheets("Warenausgang").Cells(lngZeile, 4) = lstWAout.Column(3) & " Storno" 'Bezeichnung
        Worksheets("Warenausgang").Cells(lngZeile, 5) = Abs(lstWAout.Column(4)) * -1 'Menge
        Worksheets("Warenausgang").Cells(lngZeile, 6) = Sheets("Warenausgang").Cells(lstWAout.Column(7), 6)
        Worksheets("Warenausgang").Cells(lngZeile, 7) = Abs(Sheets("Warenausgang").Cells(lstWAout.Column(7), 7)) * -1 'Preis
        Worksheets("Warenausgang").Cells(lngZeile, 8) = Format(Date, "DD.MM.YYYY")
        Worksheets("Warenausgang").Cells(lngZeile, 9) = Format(Time, "hh:mm:ss")
        Worksheets("Warenausgang").Cells(lngZeile, 10) = "RE Datum: " & Sheets("Warenausgang").Cells(lstWAout.Column(7), 8)
        Worksheets("Warenausgang").Cells(lngZeile, 11) = Format(Date, "MMMM")
        Worksheets("Warenausgang").Cells(lngZeile, 12) = Format(Date, "YYYY")
        Worksheets("Warenausgang").Cells(lngZeile, 13) = Abs(Sheets("Warenausgang").Cells(lstWAout.Column(7), 13)) * -1
        Worksheets("Warenausgang").Cells(lngZeile, 14) = Sheets("Warenausgang").Cells(lstWAout.Column(7), 14) 'Artikel ID
        If s3txt = "" Then
            Worksheets("Warenausgang").Cells(lngZeile, 15) = Sheets("Warenausgang").Cells(lstWAout.Column(7), 15)
        Else
            Worksheets("Warenausgang").Cells(lngZeile, 15) = s3txt 'Grund
        End If
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(Sheets("Warenausgang").Cells(lstWAout.Column(7), 14).Text) Then
                    lngID = i
                End If
            Next i
        End With
        lngID2 = Worksheets("Lagerorte").Range("A:A").Find(Sheets("Warenausgang").Cells(lstWAout.Column(7), 21).Text, LookIn:=xlValues, MatchCase:=True).Row
        If s2txt = vbYes Then
            'Bestand Korrektur
            If Not Sheets("Warenausgang").Cells(lstWAout.Column(7), 26) = "" Then
                If Not Sheets("Warenausgang").Cells(lstWAout.Column(7), 21) = "" Then
                    Worksheets("Lagerorte").Cells(CLng(lngID2), 8) = _
                    Worksheets("Lagerorte").Cells(CLng(lngID2), 8) + CDbl(Sheets("Warenausgang").Cells(lstWAout.Column(7), 26))
                Else
                    Worksheets("Lager").Cells(CLng(lngID), 8) = _
                    Worksheets("Lager").Cells(CLng(lngID), 8) + CDbl(Sheets("Warenausgang").Cells(lstWAout.Column(7), 26))
                End If
                Worksheets("Lager").Cells(CDbl(lngID), 25) = Worksheets("Lager").Cells(CDbl(lngID), 25) - CDbl(Sheets("Warenausgang").Cells(lstWAout.Column(7), 26))
            Else
                If Not Sheets("Warenausgang").Cells(lstWAout.Column(7), 21) = "" Then
                    Worksheets("Lagerorte").Cells(CLng(lngID2), 8) = _
                    Worksheets("Lagerorte").Cells(CLng(lngID2), 8) + lstWAout.Column(4)
                Else
                    Worksheets("Lager").Cells(CLng(lngID), 8) = _
                    Worksheets("Lager").Cells(CLng(lngID), 8) + lstWAout.Column(4)
                End If
                Worksheets("Lager").Cells(CDbl(lngID), 25) = Worksheets("Lager").Cells(CDbl(lngID), 25) - CDbl(lstWAout.Column(4))
            End If
        End If
        'Verkaufte Menge Korrektur
        Worksheets("Warenausgang").Cells(lngZeile, 16) = Abs(Sheets("Warenausgang").Cells(lstWAout.Column(7), 16)) * -1
        Worksheets("Warenausgang").Cells(lngZeile, 17) = Sheets("Warenausgang").Cells(lstWAout.Column(7), 17) 'KDID
        Worksheets("Warenausgang").Cells(lngZeile, 23) = Sheets("Warenausgang").Cells(lstWAout.Column(7), 23) 'Auftragsnummer
        If Sheets("Daten").Range("B5").Value = "True" Then
            Worksheets("Warenausgang").Cells(lngZeile, 18).Value = Sheets("Daten").Range("B24").Value
        End If
    End With
    MsgBox lstWAout.Column(2) & " wurde storniert!" & vbLf & vbLf & "Sie k|fffd|nnen nun auch beim Kunden eine Stornorechnung drucken!", vbInformation, "Storno"
    Sheets("Center").Activate
End Sub

Private Sub cboArtikelNR_Change()
    Dim lng As Long
    Dim strArticle As String
    On Error Resume Next
    strArticle = cboArtikelNR.Value
    lng = 0
    lng = WorksheetFunction.Match(strArticle, Sheets("Lager").Range("C:C"), 0)
    If lng > 0 Then
        frmBericht.txtBezeichnung.Value = Sheets("Lager").Cells(lng, 6).Value
        frmBericht.txtID.Value = Sheets("Lager").Cells(lng, 1).Value
    Else
        frmBericht.txtBezeichnung.Value = ""
    End If
    lbl_VKEK.Caption = "Verkauf"
    lbl_VKEK.BackColor = &H808080
    Call suchenTArtikel
    Call Jahr2
    Call JahrE2
    Call SuchenAhis
End Sub

Private Sub cboJahr_Change()
    Call Jahr2
    Call JahrE2
    If Not Me.txtID = "" Then
        Me.lbl_VKEK.FontBold = True
        Me.lbl_EK.FontBold = False
        Me.lstAhis.BackColor = &HFFFFFF
        Me.lstAhis.BorderColor = &H808080
        Call SuchenAhis
    End If
End Sub

Private Sub cmdasuche_Click()
    Call ArtikelNrS
End Sub

Sub ArtikelNrS() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    On Error Resume Next
    If txtartikelnr.Value = "" Then Exit Sub
    lstArtikelID.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 3) = "" And InStr(1, LCase(arrTmpA(i, 3)), LCase(txtartikelnr.Text)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(2, n) = i
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 2)
        For i = 1 To 2
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With lstArtikelID
           .ColumnCount = 2
           .ColumnWidths = "100;0"
           .List = arrTmpA
        End With
    Else
        MsgBox "Suchbegriff: " + txtartikelnr.Value + " nicht gefunden!", vbOKOnly, "Suchabfrage"
        txt_AHBezeichnung.SetFocus
    End If
    Call SuchenAhis
End Sub

Private Sub BezeichnungS() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    On Error Resume Next
    If txt_AHBezeichnung.Value = "" Then Exit Sub
    lstArtikelID.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 6) = "" And InStr(1, LCase(arrTmpA(i, 6)), LCase(txt_AHBezeichnung.Text)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(2, n) = i
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 2)
        For i = 1 To 2
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With lstArtikelID
           .ColumnCount = 2
           .ColumnWidths = "100;0"
           .List = arrTmpA
        End With
    Else
        MsgBox "Suchbegriff: " + txt_AHBezeichnung.Value + " nicht gefunden!", vbOKOnly, "Suchabfrage"
        txt_AHBezeichnung.SetFocus
    End If
End Sub

Private Sub cmdInventurpdf_Click()
    txt_OpInventur.Value = "PDF"
    Call SaveInventur
    Call InventurOutput
End Sub

Private Sub cmdInventurprint_Click()
    txt_OpInventur.Value = "Print"
    Call SaveInventur
    Call InventurOutput
End Sub

Sub InventurOutput() '1.42
    Dim pdfName, pdfDatei, strwert As String
    Dim Kopien As Variant
    On Error GoTo weiter
    If Worksheets("Inventur").Visible = xlSheetVeryHidden Then
        Worksheets("Inventur").Visible = xlSheetVisible
        strwert = 1
    Else
        strwert = 0
    End If
    If txt_OpInventur.Value = "PDF" Then
        pdfDatei = "Inventur_" & Date
        pdfName = Application.GetSaveAsFilename(Environ("USERPROFILE") & "\Desktop\" & pdfDatei & ".pdf", "PDF-Dateien (*.pdf), *.pdf")
        pdfDatei = "Inventur_" & Date
        Worksheets("Inventur").ExportAsFixedFormat Type:=xlTypePDF, Filename:=pdfName, _
                              Quality:=xlQualityStandard, IncludeDocProperties:=False, IgnorePrintAreas:=False, _
                              OpenAfterPublish:=True
    Else
        Kopien = Application.InputBox("Anzahl Kopien", "Inventur drucken", 1)
        Worksheets("Inventur").PrintOut Copies:=CLng(Kopien)
        If Kopien = False Then
            Application.ScreenUpdating = True
            If strwert = 1 Then
                Worksheets("Inventur").Visible = xlSheetVeryHidden
            End If
            Exit Sub
        End If
    End If
    Application.ScreenUpdating = True
    If txt_OpInventur.Value = "PDF" Then
        MsgBox "Inventur wurde als PDF gespeichert", , "Inventur"
    Else
        MsgBox "Inventur wird gedruckt!", , "Drucken"
    End If
    txt_OpInventur.Value = ""
    If strwert = 1 Then
        Worksheets("Inventur").Visible = xlSheetVeryHidden
    End If
    Exit Sub
weiter:
    MsgBox "Es ist leider ein Fehler passiert!", , "Sorry"
End Sub

Private Sub lstArtikelID_Click()
    Dim lngZeile As Long
    lngZeile = lstArtikelID.Column(1)
    txtBezeichnung.Value = Sheets("Lager").Cells(lngZeile, 6).Value
    txtartikelnr.Value = Sheets("Lager").Cells(lngZeile, 3).Value
    txtID.Value = Sheets("Lager").Cells(lngZeile, 1).Value
    Call Jahr2
    Call JahrE2
    Call SuchenAhis
End Sub

Private Sub txtInventursave_Click() '1.41
    Dim zeLB, zeTB, spLB, Farbe, Last_Row As Long
    Dim stxt As String
    Dim allesDrucken As Boolean
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If ListInventur.ListCount > CDbl("100") Then
        stxt = MsgBox("Das Speichern kann unter umst|fffd|nden etwas l|fffd|nger dauern!", vbYesNo, "Hinweis")
        If stxt = vbNo Then Exit Sub
    End If
    Application.ScreenUpdating = False
    If ListInventur.ListCount = 0 Then Exit Sub
    Sheets("Inventur").Activate
    Last_Row = CDbl(Sheets("Inventur").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Inventur").Rows("2:" & Last_Row).Delete
    Farbe = 1
    zeTB = 1
    For zeLB = 0 To frmBericht.ListInventur.ListCount - 1
        zeTB = zeTB + 1
        If Farbe = 1 Then
            For spLB = 0 To frmBericht.ListInventur.ColumnCount - 1
                Sheets("Inventur").Cells(zeTB, 1) = "'" & frmBericht.ListInventur.List(zeLB, 0)
                Sheets("Inventur").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Inventur").Cells(zeTB, 2) = frmBericht.ListInventur.List(zeLB, 1)
                Sheets("Inventur").Cells(zeTB, 2).WrapText = True
                Sheets("Inventur").Cells(zeTB, 3) = frmBericht.ListInventur.List(zeLB, 2)
                Sheets("Inventur").Cells(zeTB, 4) = frmBericht.ListInventur.List(zeLB, 3)
                Sheets("Inventur").Cells(zeTB, 5) = frmBericht.ListInventur.List(zeLB, 4)
                Sheets("Inventur").Cells(zeTB, 5).WrapText = True
                Sheets("Inventur").Cells(zeTB, 6) = frmBericht.ListInventur.List(zeLB, 5)
                Sheets("Inventur").Cells(zeTB, 7) = frmBericht.ListInventur.List(zeLB, 7)
            Next spLB
            If Sheets("Daten").Range("D17").Value = "Ja" Then
                Sheets("Inventur").Range("A" & zeTB & ":G" & zeTB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            End If
        Else
            For spLB = 0 To frmBericht.ListInventur.ColumnCount - 1
                Sheets("Inventur").Cells(zeTB, 1) = "'" & frmBericht.ListInventur.List(zeLB, 0)
                Sheets("Inventur").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Inventur").Cells(zeTB, 2) = frmBericht.ListInventur.List(zeLB, 1)
                Sheets("Inventur").Cells(zeTB, 2).WrapText = True
                Sheets("Inventur").Cells(zeTB, 3) = frmBericht.ListInventur.List(zeLB, 2)
                Sheets("Inventur").Cells(zeTB, 4) = frmBericht.ListInventur.List(zeLB, 3)
                Sheets("Inventur").Cells(zeTB, 5) = frmBericht.ListInventur.List(zeLB, 4)
                Sheets("Inventur").Cells(zeTB, 5).WrapText = True
                Sheets("Inventur").Cells(zeTB, 6) = frmBericht.ListInventur.List(zeLB, 5)
                Sheets("Inventur").Cells(zeTB, 7) = frmBericht.ListInventur.List(zeLB, 7)
            Next spLB
            Farbe = 1
        End If
    Next
    Sheets("Inventur").Cells(zeTB + 2, 5) = "Gesamtsumme:"
    Sheets("Inventur").Cells(zeTB + 2, 7) = Format(frmBericht.txtsumLager.Value, "currency")
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    MsgBox "Inventur gespeichert", , "Inventur"
End Sub

Private Sub txt_InventursaveNew_Click()
    Call SaveInventur
    MsgBox "Inventur wurde gespeichert!", , "Inventur"
End Sub

Sub SaveInventur() '1.42
    Dim i, Last_Row As Long
    Dim wert, Wert2 As Double
    On Error Resume Next
    Last_Row = CDbl(Sheets("Inventur").Cells(Rows.Count, 1).End(xlUp).Row) + 4
    ThisWorkbook.Sheets("Inventur").Rows("2:" & Last_Row).Delete
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    wert = 0
    Wert2 = 0
    Application.ScreenUpdating = False
    For i = 0 To ListInventur.ListCount - 1
        ThisWorkbook.Sheets("Inventur").Cells(i + 2, 1) = "'" & ListInventur.List(i, 0)
        ThisWorkbook.Sheets("Inventur").Cells(i + 2, 2) = ListInventur.List(i, 1)
        ThisWorkbook.Sheets("Inventur").Cells(i + 2, 3) = ListInventur.List(i, 2)
        ThisWorkbook.Sheets("Inventur").Cells(i + 2, 4) = ListInventur.List(i, 3)
        ThisWorkbook.Sheets("Inventur").Cells(i + 2, 5) = ListInventur.List(i, 4)
        ThisWorkbook.Sheets("Inventur").Cells(i + 2, 6) = ListInventur.List(i, 5)
        ThisWorkbook.Sheets("Inventur").Cells(i + 2, 7) = ListInventur.List(i, 7)
        wert = wert + CDbl(ListInventur.List(i, 7))
    Next
        ThisWorkbook.Sheets("Inventur").Cells((i + 1) + 2, 7) = Format(wert, "currency")
        ThisWorkbook.Sheets("Inventur").Cells((i + 1) + 2, 6) = "Summe:"
    Application.ScreenUpdating = True
End Sub

Private Sub txtInventur_Click()
    If Check_WG.Value = True Then
        If Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row > 5000 Then
            frmLaden.Label1.Caption = "Bitte warten Sie, Daten werden gesucht und ausgewertet!"
            frmLaden.Show
            DoEvents
            Call InventurWG
            frmLaden.Label1.Caption = "Fertig!" & vbLf & "Gefundene Daten: " & ListInventur.ListCount
            Call frmLaden.LadenClose
        Else
            Call InventurWG
        End If
    Else
        If Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row > 5000 Then
            frmLaden.Label1.Caption = "Bitte warten Sie, Daten werden gesucht und ausgewertet!"
            frmLaden.Show
            Application.ScreenUpdating = False
            DoEvents
            Call Inventur
            Application.ScreenUpdating = True
            frmLaden.Label1.Caption = "Fertig!" & vbLf & "Gefundene Daten: " & ListInventur.ListCount
            Call frmLaden.LadenClose
        Else
            Call Inventur
        End If
    End If
End Sub

Private Sub txtinventurall_Click()
    If Check_WG.Value = True Then
        If Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row > 5000 Then
            frmLaden.Label1.Caption = "Bitte warten Sie, Daten werden gesucht und ausgewertet!"
            frmLaden.Show
            DoEvents
            Call InventurallWG
            frmLaden.Label1.Caption = "Fertig!" & vbLf & "Gefundene Daten: " & ListInventur.ListCount
            Call frmLaden.LadenClose
        Else
            Call InventurallWG
        End If
    Else
        If Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row > 5000 Then
            frmLaden.Label1.Caption = "Bitte warten Sie, Daten werden gesucht und ausgewertet!"
            frmLaden.Show
            DoEvents
            Call Inventurall
            frmLaden.Label1.Caption = "Fertig!" & vbLf & "Gefundene Daten: " & ListInventur.ListCount
            Call frmLaden.LadenClose
        Else
            Call Inventurall
        End If
    End If
End Sub

Sub InventurallWG() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lngKID, n, j, lng As Long
    Dim strID As String
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:Q" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 16) = CStr(cbo_InWarengruppe) Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = arrTmpA(i, 16)
                arrTmpB(4, n) = Format(arrTmpA(i, 14), "currency")
                strID = CStr(arrTmpA(i, 1))
                arrTmpB(5, n) = arrTmpA(i, 13)
                arrTmpB(6, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                arrTmpB(7, n) = arrTmpA(i, 12)
                arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency") 'gesamt Preis
                arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency")
                arrTmpB(10, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call Inventurall2WG
End Sub

Sub Inventurall2WG() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, Last_Row2, lngKID, n, j, lng As Long
    Dim strID As String
    Dim arr As Variant
    Dim irow As Integer
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur2.Clear
    With ThisWorkbook.Sheets("Lagerorte")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:E" & Last_Row)
        Last_Row2 = Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
        arr = Sheets("Lager").Range("A1:A" & Last_Row2)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" Then
                irow = Application.Match(CStr(arrTmpA(i, 2)), arr, 1)
                If Sheets("Lager").Cells(irow, 16).Value = CStr(cbo_InWarengruppe) Then
                    n = n + 1
                    arrTmpB(1, n) = Sheets("Lager").Cells(irow, 3).Value
                    arrTmpB(2, n) = VBA.Replace(CStr(Sheets("Lager").Cells(irow, 6).Value), Chr$(13) & Chr$(10), " ") 'Benennung
                    arrTmpB(3, n) = Sheets("Lager").Cells(irow, 16).Value 'WG
                    arrTmpB(4, n) = Format(Sheets("Lager").Cells(irow, 14).Value, "currency")
                    arrTmpB(5, n) = arrTmpA(i, 3)
                    arrTmpB(6, n) = arrTmpA(i, 4) & " " & Sheets("Lager").Cells(irow, 12).Value
                    arrTmpB(7, n) = Sheets("Lager").Cells(irow, 12).Value
                    arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(irow, 14).Value)), "currency")
                    arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(irow, 14).Value)), "currency")
                    arrTmpB(10, n) = i
                End If
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur2
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = False
    Call InvAllZus
End Sub

Sub InventurWG() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row, lngKID, n, j, lng As Long
    Dim strID As String
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:Q" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 16) = CStr(cbo_InWarengruppe) Then
                If CDbl(arrTmpA(i, 8)) > 0 Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 3)
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(3, n) = arrTmpA(i, 16)
                    arrTmpB(4, n) = Format(arrTmpA(i, 14), "currency")
                    strID = CStr(arrTmpA(i, 1))
                    arrTmpB(5, n) = arrTmpA(i, 13)
                    arrTmpB(6, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                    arrTmpB(7, n) = arrTmpA(i, 12)
                    arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency") 'gesamt Preis
                    arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency")
                    arrTmpB(10, n) = i
                End If
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call InventurWG2
End Sub

Sub InventurWG2() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row, Last_Row2, lngKID, n, j, lng As Long
    Dim strID As String
    Dim arr As Variant
    Dim irow As Integer
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur2.Clear
    With ThisWorkbook.Sheets("Lagerorte")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:E" & Last_Row)
        Last_Row2 = Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
        arr = Sheets("Lager").Range("A1:A" & Last_Row2)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 4) = "" And arrTmpA(i, 4) > 0 Then
                irow = Application.Match(CStr(arrTmpA(i, 2)), arr, 1)
                If Sheets("Lager").Cells(irow, 16).Value = CStr(cbo_InWarengruppe) Then
                    n = n + 1
                    arrTmpB(1, n) = Sheets("Lager").Cells(irow, 3).Value
                    arrTmpB(2, n) = VBA.Replace(CStr(Sheets("Lager").Cells(irow, 6).Value), Chr$(13) & Chr$(10), " ") 'Benennung
                    arrTmpB(3, n) = Sheets("Lager").Cells(irow, 16).Value 'WG
                    arrTmpB(4, n) = Format(Sheets("Lager").Cells(irow, 14).Value, "currency")
                    arrTmpB(5, n) = arrTmpA(i, 3)
                    arrTmpB(6, n) = arrTmpA(i, 4) & " " & Sheets("Lager").Cells(irow, 12).Value
                    arrTmpB(7, n) = Sheets("Lager").Cells(irow, 12).Value
                    arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(irow, 14).Value)), "currency")
                    arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(irow, 14).Value)), "currency")
                    arrTmpB(10, n) = i
                End If
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur2
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = False
    Call InvAllZus
End Sub

Sub Inventurall() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lngKID, n, j, lng As Long
    Dim strID As String
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:Q" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = arrTmpA(i, 16)
                arrTmpB(4, n) = Format(arrTmpA(i, 14), "currency")
                strID = CStr(arrTmpA(i, 1))
                arrTmpB(5, n) = arrTmpA(i, 13)
                arrTmpB(6, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                arrTmpB(7, n) = arrTmpA(i, 12)
                arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency") 'gesamt Preis
                arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency")
                arrTmpB(10, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call Inventurall2
End Sub

Sub Inventurall2() '1.44
    Dim irow, arrTmpA, arrTmpB, i, Last_Row, Last_Row2, lngKID, n, j, lng As Long
    Dim strID As String
    Dim arr As Variant
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur2.Clear
    With ThisWorkbook.Sheets("Lagerorte")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:E" & Last_Row)
        Last_Row2 = Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
        arr = Sheets("Lager").Range("A1:A" & Last_Row2)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" Then
                n = n + 1
                irow = Application.Match(CStr(arrTmpA(i, 2)), arr, 1)
                arrTmpB(1, n) = Sheets("Lager").Cells(irow, 3).Value
                arrTmpB(2, n) = VBA.Replace(CStr(Sheets("Lager").Cells(irow, 6).Value), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = Sheets("Lager").Cells(irow, 16).Value 'WG
                arrTmpB(4, n) = Format(Sheets("Lager").Cells(irow, 14).Value, "currency")
                arrTmpB(5, n) = arrTmpA(i, 3)
                arrTmpB(6, n) = arrTmpA(i, 4) & " " & Sheets("Lager").Cells(irow, 12).Value
                arrTmpB(7, n) = Sheets("Lager").Cells(irow, 12).Value
                arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(irow, 14).Value)), "currency")
                arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(irow, 14).Value)), "currency")
                arrTmpB(10, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur2
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = False
    Call InvAllZus
End Sub

Sub InvAllZus()
    Dim i, i2, lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    i2 = ListInventur.ListCount
    For lng = 1 To ListInventur2.ListCount
        ListInventur.AddItem ListInventur2.Column(0, i)
        ListInventur.Column(1, i2) = ListInventur2.Column(1, i)
        ListInventur.Column(2, i2) = ListInventur2.Column(2, i)
        ListInventur.Column(3, i2) = ListInventur2.Column(3, i)
        ListInventur.Column(4, i2) = ListInventur2.Column(4, i)
        ListInventur.Column(5, i2) = ListInventur2.Column(5, i)
        ListInventur.Column(6, i2) = ListInventur2.Column(6, i)
        ListInventur.Column(7, i2) = ListInventur2.Column(7, i)
        ListInventur.Column(8, i2) = ListInventur2.Column(8, i)
        ListInventur.Column(9, i2) = ListInventur2.Column(9, i)
        i2 = i2 + 1
        i = i + 1
    Next lng
    ListInventur2.Clear
    Application.ScreenUpdating = True
End Sub

Sub Inventur() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lngKID, n, j, lng As Long
    Dim strID As String
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 8) = "" And arrTmpA(i, 8) > 0 Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = arrTmpA(i, 16)
                arrTmpB(4, n) = Format(arrTmpA(i, 14), "currency")
                strID = CStr(arrTmpA(i, 1))
                arrTmpB(5, n) = arrTmpA(i, 13)
                arrTmpB(6, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                arrTmpB(7, n) = arrTmpA(i, 12)
                arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency") 'gesamt Preis
                arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)), "currency")
                arrTmpB(10, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    Application.ScreenUpdating = True
    Call Inventur2
End Sub

Sub Inventur2() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lngKID, n, j, lng As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2 As Long
    Dim strID As String
    On Error Resume Next
    Application.ScreenUpdating = False
    ListInventur2.Clear
    With ThisWorkbook.Sheets("Lagerorte")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 4) = "" And arrTmpA(i, 4) > 0 Then
                n = n + 1
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(arrTmpA(i, 2)) Then
                            lngKID = i2
                        End If
                    Next i2
                End With
                arrTmpB(1, n) = Sheets("Lager").Cells(lngKID, 3).Value
                arrTmpB(2, n) = VBA.Replace(CStr(Sheets("Lager").Cells(lngKID, 6).Value), Chr$(13) & Chr$(10), " ") 'Benennung
                arrTmpB(3, n) = Sheets("Lager").Cells(lngKID, 16).Value 'WG
                arrTmpB(4, n) = Format(Sheets("Lager").Cells(lngKID, 14).Value, "currency")
                arrTmpB(5, n) = arrTmpA(i, 3)
                arrTmpB(6, n) = arrTmpA(i, 4) & " " & Sheets("Lager").Cells(lngKID, 12).Value
                arrTmpB(7, n) = Sheets("Lager").Cells(lngKID, 12).Value
                arrTmpB(8, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(lngKID, 14).Value)), "currency")
                arrTmpB(9, n) = Format(CDbl(arrTmpA(i, 4)) * CDbl(CDbl(Sheets("Lager").Cells(lngKID, 14).Value)), "currency")
                arrTmpB(10, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With ListInventur2
                .ColumnCount = 8
                .ColumnWidths = "130;200;100;60;100;60;0;50"
                .List = arrTmpA
            End With
        End If
    End With
    Application.ScreenUpdating = True
    Call InvZus
End Sub

Sub InvZus()
    Dim i, i2, lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    i2 = ListInventur.ListCount
    For lng = 1 To ListInventur2.ListCount
        ListInventur.AddItem ListInventur2.Column(0, i)
        ListInventur.Column(1, i2) = ListInventur2.Column(1, i)
        ListInventur.Column(2, i2) = ListInventur2.Column(2, i)
        ListInventur.Column(3, i2) = ListInventur2.Column(3, i)
        ListInventur.Column(4, i2) = ListInventur2.Column(4, i)
        ListInventur.Column(5, i2) = ListInventur2.Column(5, i)
        ListInventur.Column(6, i2) = ListInventur2.Column(6, i)
        ListInventur.Column(7, i2) = ListInventur2.Column(7, i)
        ListInventur.Column(8, i2) = ListInventur2.Column(8, i)
        ListInventur.Column(9, i2) = ListInventur2.Column(9, i)
        i2 = i2 + 1
        i = i + 1
    Next lng
    Application.ScreenUpdating = True
    ListInventur2.Clear
End Sub

Private Sub suchenTArtikel() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    On Error Resume Next
    lstArtikelID.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 3) = "" And InStr(1, LCase(arrTmpA(i, 3)), LCase(cboArtikelNR.Text)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(2, n) = i
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 2)
        For i = 1 To 2
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With lstArtikelID
           .ColumnCount = 2
           .ColumnWidths = "100;0"
           .List = arrTmpA
        End With
    End If
    Application.ScreenUpdating = True
End Sub

Sub ArtikelCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
        objDic(Sheets("Lager").Cells(lngZ, 3).Value) = 0
    Next
    cboArtikelNR.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
End Sub

Sub JahrCombo()
    Dim objDic  As Object
    Dim lngZ    As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 13).End(xlUp).Row
        objDic(Sheets("Daten").Cells(lngZ, 13).Value) = 0
    Next
    cbojahr.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
End Sub

Private Sub cmdaktu_Click()
    If cboLieferant = "" Then Exit Sub
    txt_ArikelNrBeHist = ""
    cbo_ArikelNrBeHist.Clear
    Call SuchenLieferant
    Call BeHiAr
    Call BerechnungL
    Call BerechnungLME
End Sub

Sub SuchenLieferant() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    Dim SuchKriterium As String
    On Error Resume Next
    SuchKriterium = ComLieferant2.Text
    ListWE.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Wareneingang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) = SuchKriterium And CDate(arrTmpA(i, 8)) >= CDate(tbDatumvon.Value) And CDate(arrTmpA(i, 8)) <= CDate(tbDatumbis.Value) Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 3)
               arrTmpB(2, n) = arrTmpA(i, 4)
               arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 5)), Chr$(13) & Chr$(10), " ")
               arrTmpB(4, n) = arrTmpA(i, 6)
               arrTmpB(5, n) = CDate(arrTmpA(i, 8))
               arrTmpB(6, n) = arrTmpA(i, 6)
               arrTmpB(7, n) = Format(arrTmpA(i, 6) * arrTmpA(i, 11), "currency")
               arrTmpB(8, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 8)
            For i = 1 To 8
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With ListWE
               .ColumnCount = 7
               .ColumnWidths = "110;110;270;50;60;0;50"
               .List = arrTmpA
            End With
       Else
           MsgBox "Zu Ihrer Suchabfrage ''" & _
           ComLieferant2 & "'' wurden kein Beleg gefunden.", vbInformation, "Suchabfrage"
           ComLieferant2.SetFocus
       End If
    End With
    Application.ScreenUpdating = True
    Call BerechnungL
End Sub

Sub SuchenLieferant2()
    Dim lng, i As Long
    Dim Astr As String
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Wareneingang")
        ListWE.Clear
        ListWE.ColumnCount = 7
        ListWE.ColumnWidths = "110;110;270;50;60;0;50"
        ListWE.TextAlign = fmTextAlignLeft
        ListWE.Clear
        i = 0
        If txt_ArikelNrBeHist.Value = "" Then
            Astr = cbo_ArikelNrBeHist.Text
        Else
            Astr = txt_ArikelNrBeHist.Text
        End If
        For lng = 2 To ThisWorkbook.Worksheets("Wareneingang").UsedRange.Rows.Count
            If .Cells(lng, 2).Value = ComLieferant2.Text And .Cells(lng, 3).Value = Astr And _
                                            CDate(.Cells(lng, 8).Value) >= CDate(tbDatumvon.Value) And _
                                            CDate(.Cells(lng, 8).Value) <= CDate(tbDatumbis.Value) Then
                    ListWE.AddItem .Cells(lng, 3).Value
                    ListWE.Column(1, i) = .Cells(lng, 4).Value
                    ListWE.Column(2, i) = .Cells(lng, 5).Value
                    ListWE.Column(3, i) = .Cells(lng, 6).Value
                    ListWE.Column(4, i) = CDate(.Cells(lng, 8).Value)
                    ListWE.Column(5, i) = CDbl(.Cells(lng, 6).Value) * WorksheetFunction.VLookup(.Cells(lng, 3).Value, Worksheets("Lager").Range("B:V"), 21, False)
                    ListWE.Column(6, i) = Format(CDbl(.Cells(lng, 6).Value) * CDbl(.Cells(lng, 11).Value), "currency")
                    ListWE.Column(7, i) = .Cells(lng, 16).Row
                    i = i + 1
            End If
        Next lng
        If ListWE.ListCount = 0 Then MsgBox "Zu Ihrer Suchabfrage ''" & _
            ComLieferant2.Value & " / Artikelnummer: " & txt_ArikelNrBeHist.Value & "'' wurden keine Bestellung gefunden.", vbInformation, "Suchabfrage"
    End With
    Application.ScreenUpdating = True
    Call BerechnungLME
End Sub
Private Sub BerechnungL()
    Dim i As Single
    Dim wert As Double
    On Error Resume Next
    For i = 0 To ListWE.ListCount - 1
        wert = wert + ListWE.List(i, 6)
    Next i
    lbl_summe.Caption = Format((wert), "currency")
End Sub

Private Sub BerechnungLME()
    Dim i As Single
    Dim wert As Double
    On Error Resume Next
    For i = 0 To ListWE.ListCount - 1
        wert = wert + ListWE.List(i, 3)
    Next i
    lbl_smenge2.Caption = wert
End Sub

Private Sub cmdheute_Click()
    Call SuchenAuftragdatum
End Sub

Private Sub cmdsuchensate_Click()
    frmKalender.txt_UID = "JR_RA"
    frmKalender.Show
End Sub

Private Sub cmdwoche_Click()
    Call SuchenAuftragdatumWoche
End Sub

Private Sub ComLieferant2_Change()
    If Not ComLieferant2 = "" Then
        cbo_ArikelNrBeHist.Visible = True
        txt_ArikelNrBeHist.Visible = True
        cmd_ArikelNrBeHist.Visible = True
        lbl_BHistArtikelnummer.Visible = True
        lbl_Smenge.Visible = False
        lbl_smenge2.Visible = False
    End If
    Call SuchenLieferant
    Call BeHiAr
    cbo_ArikelNrBeHist.ListIndex = -1
End Sub

Private Sub cboLieferant_Click()
    Call Lieferantrechnen
End Sub

Private Sub cboWarengruppe_Change()
    Call Warengrupperechen
End Sub

Private Sub comDruckRAuftrag_Click() 'v1.44
    Dim lngIndex, Farbe, lngID, lngZeile As Long
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    If txtRAuftragsNr.Value = "" Then
        MsgBox "Bitte w|fffd|hlen Sie ein Aufrag aus!"
        Exit Sub
    End If
    Application.ScreenUpdating = False
    Sheets("Vorlage2").Visible = True
    lngZeile = Worksheets("Vorlage2").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Vorlage2").Activate
    Sheets("Vorlage2").Range("A7:G500").Delete
    Sheets("Vorlage2").Range("A1") = ("Ausdruck Reservierter Auftrag " + txtRAuftragsNr.Text + "")
    If Not txt_Kunden2.Value = "" Then
        Sheets("Vorlage2").Range("A3") = "Kunde: " & txt_Kunden2.Value
    Else
        Sheets("Vorlage2").Range("A3") = ""
    End If
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("A5") = ""
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("B6") = "Artikel Nr."
    Sheets("Vorlage2").Range("G1") = Format(Date, "DD.MM.YYYY")
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = "Preis (Brutto)"
    For lngIndex = 0 To frmBericht.lstAuftrag.ListCount - 1
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(Sheets("Reservierungen").Cells(frmBericht.lstAuftrag.Column(7, lngIndex), 18).Text) Then
                    lngID = i
                End If
            Next i
        End With
        lngZeile = lngZeile + 1
        Worksheets("Vorlage2").Cells(lngZeile, 1).Value = CDbl(lngIndex) + 1
        Worksheets("Vorlage2").Cells(lngZeile, 1).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 2).Value = "'" & frmBericht.lstAuftrag.Column(1, lngIndex) 'Artikelnummer
        Worksheets("Vorlage2").Cells(lngZeile, 2).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 3).Value = Sheets("Lager").Cells(CLng(lngID), 4) 'Herstellernummer
        Worksheets("Vorlage2").Cells(lngZeile, 3).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 4).Value = frmBericht.lstAuftrag.Column(3, lngIndex) 'Beschreibung
        Worksheets("Vorlage2").Cells(lngZeile, 4).WrapText = True
        Worksheets("Vorlage2").Cells(lngZeile, 4).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 5).Value = frmBericht.lstAuftrag.Column(2, lngIndex) 'Menge
        Worksheets("Vorlage2").Cells(lngZeile, 5).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 6).Value = Sheets("Lager").Cells(CLng(lngID), 13) 'Lagerort
        Worksheets("Vorlage2").Cells(lngZeile, 6).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 7).Value = Format(frmBericht.lstAuftrag.Column(4, lngIndex), "currency") 'Preis
        Worksheets("Vorlage2").Cells(lngZeile, 7).VerticalAlignment = xlTop
    Next
    Farbe = 0
    For lngIndex = 0 To frmBericht.lstAuftrag.ListCount - 1
        If Farbe = 1 Then
            Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = -0.149998474074526
                .PatternTintAndShade = 0
            End With
            Farbe = 0
        Else
            Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
            Farbe = 1
        End If
    Next
    Worksheets("Vorlage2").PrintOut
    Application.ScreenUpdating = True
    Sheets("Center").Activate
    MsgBox "Ausdruck erfolgt!", vbOKOnly, "Drucken"
End Sub

Private Sub cmd_DurckWA_Click()
    Dim lngIndex, Farbe, lngID, lngZeile As Long
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    If txtbeleg.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Vorlage2").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Vorlage2").Visible = True
    Sheets("Vorlage2").Activate
    Sheets("Vorlage2").Range("A7:G500").Delete
    Sheets("Vorlage2").Range("A1") = ("Ausdruck Beleg " + txtbeleg.Text + "")
    If Not txt_Kunden.Value = "" Then
        Sheets("Vorlage2").Range("A3") = "Kunde: " & txt_Kunden.Value
    Else
        Sheets("Vorlage2").Range("A3") = ""
    End If
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("B6") = "Artikel Nr."
    Sheets("Vorlage2").Range("G1") = Format(Date, "DD.MM.YYYY")
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = "Preis (Brutto)"
    Farbe = 1
    For lngIndex = 0 To frmBericht.lstWAout.ListCount - 1
        lngZeile = lngZeile + 1
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lstWAout.Column(6, lngIndex)) Then
                    lngID = i
                End If
            Next i
        End With
        Worksheets("Vorlage2").Cells(lngZeile, 1).Value = "'" & CDbl(lngIndex) + 1
        Worksheets("Vorlage2").Cells(lngZeile, 2).Value = "'" & frmBericht.lstWAout.Column(2, lngIndex) 'Artikelnummer
        Worksheets("Vorlage2").Cells(lngZeile, 2).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 3).Value = Sheets("Lager").Cells(CDbl(lngID), 4) 'Herstellernummer
        Worksheets("Vorlage2").Cells(lngZeile, 3).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 4).Value = frmBericht.lstWAout.Column(3, lngIndex) 'Beschreibung
        Worksheets("Vorlage2").Cells(lngZeile, 4).WrapText = True
        Worksheets("Vorlage2").Cells(lngZeile, 4).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 5).Value = frmBericht.lstWAout.Column(4, lngIndex) & " " & Sheets("Lager").Cells(CDbl(lngID), 12) 'Herstellernummer 'Menge& Einheit
        Worksheets("Vorlage2").Cells(lngZeile, 5).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 6).Value = Sheets("Lager").Cells(CDbl(lngID), 13) 'Lagerort
        Worksheets("Vorlage2").Cells(lngZeile, 6).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 7).Value = Format(frmBericht.lstWAout.Column(5, lngIndex), "currency") 'Preis
        Worksheets("Vorlage2").Cells(lngZeile, 7).VerticalAlignment = xlTop
    Next
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For lngIndex = 0 To frmBericht.lstWAout.ListCount - 1
            If Farbe = 1 Then
                Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
                Farbe = 1
            End If
        Next
    End If
    Worksheets("Vorlage2").PrintOut
    Application.ScreenUpdating = True
    Sheets("Center").Activate
    MsgBox "Ausdruck erfolgt!", vbOKOnly, "Drucken"
End Sub

Private Sub cmd_DruckBestand_Click()
    Dim lngIndex, Farbe, lngID, lngZeile As Long
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    If CDbl(lstMin.ListCount) = 0 Then Exit Sub
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Vorlage2").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Vorlage2").Visible = True
    Sheets("Vorlage2").Activate
    Sheets("Vorlage2").Range("A7:G300").Clear
    If CheckBoxMin.Value = True Then
        Sheets("Vorlage2").Range("A1") = "Bestell-Liste / Mindestbestand erreicht"
    Else
        Sheets("Vorlage2").Range("A1") = "Bestell-Liste / Meldebestand erreicht"
    End If
    If cbo_BstLieferant = "" Then
        Sheets("Vorlage2").Range("A3") = ""
    Else
        Sheets("Vorlage2").Range("A3") = "Lieferant: " & cbo_BstLieferant.Text
    End If
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("B6") = "Artikel Nr."
    Sheets("Vorlage2").Range("G1") = Format(Date, "DD.MM.YYYY")
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = "Soll Bestand"
    For lngIndex = 0 To frmBericht.lstMin.ListCount - 1
        lngZeile = lngZeile + 1
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmBericht.lstMin.Column(8, lngIndex)) Then
                    lngID = i
                End If
            Next i
        End With
        Worksheets("Vorlage2").Cells(lngZeile, 1).Value = "'" & CDbl(lngIndex) + 1
        Worksheets("Vorlage2").Cells(lngZeile, 1).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 2).Value = "'" & frmBericht.lstMin.Column(0, lngIndex) 'Artikelnummer
        Worksheets("Vorlage2").Cells(lngZeile, 2).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 3).Value = Sheets("Lager").Cells(lngID, 4) 'Herstellernummer
        Worksheets("Vorlage2").Cells(lngZeile, 3).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 4).Value = frmBericht.lstMin.Column(2, lngIndex) 'Beschreibung
        Worksheets("Vorlage2").Cells(lngZeile, 4).WrapText = True
        Worksheets("Vorlage2").Cells(lngZeile, 5).Value = frmBericht.lstMin.Column(3, lngIndex) 'Menge
        Worksheets("Vorlage2").Cells(lngZeile, 5).HorizontalAlignment = xlCenter
        Worksheets("Vorlage2").Cells(lngZeile, 5).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 6).Value = frmBericht.lstMin.Column(5, lngIndex) 'Lagerort
        Worksheets("Vorlage2").Cells(lngZeile, 6).VerticalAlignment = xlTop
        Worksheets("Vorlage2").Cells(lngZeile, 7).Value = frmBericht.lstMin.Column(6, lngIndex) 'Sollbestand
        Worksheets("Vorlage2").Cells(lngZeile, 7).HorizontalAlignment = xlCenter
        Worksheets("Vorlage2").Cells(lngZeile, 7).VerticalAlignment = xlTop
    Next
    Farbe = 0
    For lngIndex = 0 To frmBericht.lstMin.ListCount - 1
        If Farbe = 1 Then
            Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = -0.149998474074526
                .PatternTintAndShade = 0
            End With
            Farbe = 0
        Else
            Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
            Farbe = 1
        End If
    Next
    Worksheets("Vorlage2").PrintOut
    Application.ScreenUpdating = True
    Sheets("Center").Activate
    MsgBox "Ausdruck erfolgt!", vbOKOnly, "Drucken"
End Sub

Private Sub cmdsuchenBest_Click()
    Call SuchenBestellungFirst
End Sub

Private Sub cmdshow2_Click()
    Call Lieferantrechnen
End Sub

Private Sub CommandButton9_Click()
    Call SuchenAuftrag
End Sub

Private Sub lstAuftrag_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Dim lng, i, lngID As Long
    On Error Resume Next
    txtRAuftragsNr.Value = lstAuftrag.Column(0)
    lstAuftrag.Clear
    lstAuftrag.ColumnCount = 8
    lstAuftrag.ColumnWidths = "120;120;50;250;80;0;60;0"
    lstAuftrag.TextAlign = fmTextAlignLeft
    lstAuftrag.Clear
    txt_Kunden2.Visible = False
    lbl_Kunden2.Visible = False
    i = 0
    For lng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
        If Worksheets("Reservierungen").Cells(lng, 1).Value = CStr(txtRAuftragsNr.Value) Then
            lstAuftrag.AddItem Worksheets("Reservierungen").Cells(lng, 1).Value
            lstAuftrag.Column(1, i) = Worksheets("Reservierungen").Cells(lng, 2).Value
            lstAuftrag.Column(2, i) = Worksheets("Reservierungen").Cells(lng, 7).Value
            lstAuftrag.Column(3, i) = Worksheets("Reservierungen").Cells(lng, 6).Value
            lstAuftrag.Column(4, i) = Format(Worksheets("Reservierungen").Cells(lng, 8).Value, "currency")
            lstAuftrag.Column(5, i) = Worksheets("Reservierungen").Cells(lng, 4).Value
            lstAuftrag.Column(6, i) = Worksheets("Reservierungen").Cells(lng, 17).Value
            lstAuftrag.Column(8, i) = Worksheets("Reservierungen").Cells(lng, 18).Value
            lstAuftrag.Column(7, i) = Worksheets("Reservierungen").Cells(lng, 2).Row
            lngID = Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(Worksheets("Reservierungen").Cells(lng, 19).Value, LookIn:=xlValues, MatchCase:=True).Row, 4).Row
            If Not Worksheets("Reservierungen").Cells(lng, 19).Value = "" Then
                txt_Kunden2.Visible = True
                lbl_Kunden2.Visible = True
                If Worksheets("Kunden").Cells(CLng(lngID), 4) = "Firma" Then
                    txt_Kunden2.Value = "Firma " & Worksheets("Kunden").Cells(CLng(lngID), 7)
                Else
                    txt_Kunden2.Value = Worksheets("Kunden").Cells(CLng(lngID), 7) & ", " & Worksheets("Kunden").Cells(CLng(lngID), 6)
                End If
            Else
                txt_Kunden2.Visible = False
                lbl_Kunden2.Visible = False
            End If
            i = i + 1
        End If
    Next lng
    If lstAuftrag.ListCount = 0 Then MsgBox "Zu Ihrer Suchabfrage ''" & _
        txtRAuftragsNr.Value & "'' wurde keine Bestellung gefunden.", vbInformation, "Suchabfrage"
End Sub

Private Sub lstBestellungen_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    txtBestellNR.Value = lstBestellungen.Column(0)
End Sub

Private Sub lstWAout_Click()
    Dim listenwert As Long
    Dim blnMarkiert As Boolean
    On Error Resume Next
    
    For listenwert = 0 To lstWAout.ListCount - 1
        If lstWAout.Selected(listenwert) Then
            If Not txtbeleg = "" Then
                blnMarkiert = True
                cmd_PosSBeleg.Enabled = True
            End If
            Exit For
        Else
            cmd_PosSBeleg.Enabled = False
        End If
    Next listenwert
End Sub

Private Sub lstMin_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    frmLager.txt_item.Value = frmBericht.lstMin.Column(0)
    Call frmLager.Asuchen
    Call frmLager.Datensaetze
    Unload frmBericht
    frmLager.Show
End Sub

Private Sub cmdexit_Click()
    Unload frmBericht
    frmLager.Show
End Sub
  
Private Sub CheckBoxMelde_Click()
    If CheckBoxMelde.Value = True Then
        CheckBoxMin.Value = False
    Else
        If CheckBoxMin.Value = False Then
            CheckBoxMelde.Value = True
        End If
    End If
End Sub

Private Sub CheckBoxMin_Click()
   If CheckBoxMin.Value = True Then
        CheckBoxMelde.Value = False
    Else
        If CheckBoxMelde.Value = False Then
            CheckBoxMin.Value = True
        End If
    End If
End Sub

Sub Datensaetze()
    On Error Resume Next
    If CDbl(lstWAout.ListCount) = 0 Then
        lbldatensaetze.Caption = "Kein Datensatz gefunden"
    ElseIf CDbl(lstWAout.ListCount) > 1 Then
        lbldatensaetze.Caption = lstWAout.ListCount & " Datens|fffd|tze gefunden"
    Else
        lbldatensaetze.Caption = lstWAout.ListCount & " Datensatz gefunden"
    End If
End Sub

Private Sub cmd_LBCheck_Click()
    If CheckBoxMin.Value = True Then
        Call SuchenMin
        Label11.Caption = "Mindest-Bestand"
    ElseIf CheckBoxMelde.Value = True Then
        Call SuchenMelde
        Label11.Caption = "Melde-Bestand"
    End If
    Call LieferCombo
End Sub

Sub SuchenMin() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lngKID, n, j, lng As Long
    Dim lngIndex, lngCount, Alng, lngg, lngBS, lngS, Alngs, lngBA As Long
    Dim strmin, T As Double
    Dim strID, stxtL As String
    On Error Resume Next
    T = Timer
    Application.ScreenUpdating = False
    lstMin.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AA" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 10) = "" Then
                strmin = 0
            Else
                strmin = CDbl(arrTmpA(i, 10))
            End If
            strID = arrTmpA(i, 1)
            lngg = 0
            lngS = 0
            Alngs = 0
            lngBA = 0
            For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                If Sheets("Lagerorte").Cells(lng, 2).Value = CDbl(strID) Then
                    lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                    stxtL = stxtL & ", " & Sheets("Lagerorte").Cells(lng, 3).Value 'Lagerort
                    lngg = lngg + 1
                End If
            Next lng
            If CheckBoxAuf.Value = True Then
                For Alng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count + 1
                    If Sheets("Reservierungen").Cells(Alng, 18).Value = CDbl(strID) And Sheets("Reservierungen").Cells(Alng, 11).Value = "Auftrag" Then
                        Alngs = Alngs + CDbl(Sheets("Reservierungen").Cells(Alng, 7).Value)
                    End If
                Next Alng
            End If
            For lngBS = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count + 1
                If Sheets("Bestellung").Cells(lngBS, 12).Value = CDbl(strID) Then
                    lngBA = lngBA + CDbl(Sheets("Bestellung").Cells(lngBS, 6).Value)
                End If
            Next lngBS
            If CDbl(((arrTmpA(i, 8) + lngS) - CDbl(Alngs)) <= CDbl(strmin)) And CDbl(strmin) > 0 Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = VBA.Replace(CStr(Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(arrTmpA(i, 18), LookIn:=xlValues, MatchCase:=True).Row, 2)), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = CDbl((arrTmpA(i, 8) + lngS) - Alngs)
                arrTmpB(5, n) = CDbl(lngBA)
                If lngg > 0 Then
                    arrTmpB(6, n) = arrTmpA(i, 13) & stxtL '" (Hauptlager)"
                Else
                    arrTmpB(6, n) = arrTmpA(i, 13)
                End If
                arrTmpB(7, n) = arrTmpA(i, 10)
                arrTmpB(8, n) = CDbl(strmin)
                arrTmpB(9, n) = arrTmpA(i, 1)
                arrTmpB(10, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lstMin
                .ColumnCount = 7
                .ColumnWidths = "90;120;250;40;40;140;40;0;0"
                .List = arrTmpA
            End With
        End If
    End With
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = True
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub SuchenMinL() 'v.1.39
    Dim lngIndex, lngCount, lng, Alng, lngg, lngBS, i As Long
    Dim Alngs, lngS, lngBA As Double
    Dim strID, stxtL, stxtL2, stxtLP As String
    On Error Resume Next
    lstMin.Clear
    lstMin.ColumnCount = 7
    lstMin.ColumnWidths = "90;120;250;40;40;140;40;0;0"
    lngCount = ThisWorkbook.Worksheets("Lager").UsedRange.Rows.Count
    Label11.Caption = "Mindest- Bestand"
    stxtL2 = cbo_BstLieferant
    i = 0
    Application.ScreenUpdating = False
    For lngIndex = 2 To lngCount
        stxtL = VBA.Replace(CStr(Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Worksheets("Lager").Cells(lngIndex, 18), LookIn:=xlValues, MatchCase:=True).Row, 2)), Chr$(13) & Chr$(10), " ")
        strID = Worksheets("Lager").Cells(lngIndex, 1).Value
        lngg = 0
        lngS = 0
        Alngs = 0
        lngBA = 0
        If stxtL = stxtL2 Then
            For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                If Sheets("Lagerorte").Cells(lng, 2).Value = CDbl(strID) Then
                    lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                    stxtLP = stxtLP & ", " & Sheets("Lagerorte").Cells(lng, 3).Value 'Lagerort
                    lngg = lngg + 1
                End If
            Next lng
            If CheckBoxAuf.Value = True Then
                For Alng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count + 1
                    If Sheets("Reservierungen").Cells(Alng, 18).Value = CDbl(strID) And Sheets("Reservierungen").Cells(Alng, 11).Value = "Auftrag" Then
                        Alngs = Alngs + CDbl(Sheets("Reservierungen").Cells(Alng, 7).Value)
                    End If
                Next Alng
            End If
            For lngBS = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count + 1
                If Sheets("Bestellung").Cells(lngBS, 12).Value = CDbl(strID) Then
                    lngBA = lngBA + CDbl(Sheets("Bestellung").Cells(lngBS, 6).Value)
                End If
            Next lngBS
            If Not Worksheets("Lager").Cells(lngIndex, 10).Value = "" And CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - CDbl(Alngs)) <= CDbl(Worksheets("Lager").Cells(lngIndex, 10).Value) And CDbl(Worksheets("Lager").Cells(lngIndex, 10).Value) > 0 Then
                lstMin.AddItem
                lstMin.List(i, 0) = Worksheets("Lager").Cells(lngIndex, 3).Value
                lstMin.List(i, 1) = VBA.Replace(CStr(Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Worksheets("Lager").Cells(lngIndex, 18), LookIn:=xlValues, MatchCase:=True).Row, 2)), Chr$(13) & Chr$(10), " ")
                lstMin.List(i, 2) = VBA.Replace(CStr(Sheets("Lager").Cells(lngIndex, 6).Value), Chr$(13) & Chr$(10), " ")
                lstMin.List(i, 3) = CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - Alngs)
                lstMin.List(i, 4) = CDbl(lngBA)
                If lngg > 0 Then
                    lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value & stxtLP
                Else
                    lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value
                End If
                lstMin.List(i, 6) = Worksheets("Lager").Cells(lngIndex, 10).Value
                lstMin.List(i, 7) = CStr(lngIndex)
                lstMin.List(i, 8) = Worksheets("Lager").Cells(lngIndex, 1).Value
                lstMin.List(i, 9) = Worksheets("Lager").Cells(lngIndex, 18).Value
                i = i + 1
            End If
        End If
    Next
    For lngIndex = 2 To lngCount
        If Not Worksheets("Lager").Cells(lngIndex, 10) = "" Then
            stxtL = Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Worksheets("Lager").Cells(lngIndex, 18).Text, LookIn:=xlValues, MatchCase:=True).Row, 2)
            strID = Worksheets("Lager").Cells(lngIndex, 1).Value
            lngg = 0
            lngS = 0
            Alngs = 0
            lngBA = 0
            If stxtL = stxtL2 Then
                For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                    If Sheets("Lagerorte").Cells(lng, 2).Value = CDbl(strID) Then
                        lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                        stxtLP = stxtLP & ", " & Sheets("Lagerorte").Cells(lng, 3).Value 'Lagerort
                        lngg = lngg + 1
                    End If
                Next lng
                If CheckBoxAuf.Value = True Then
                    For Alng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count + 1
                        If Sheets("Reservierungen").Cells(Alng, 18).Value = CDbl(strID) And Sheets("Reservierungen").Cells(Alng, 11).Value = "Auftrag" Then
                            Alngs = Alngs + CDbl(Sheets("Reservierungen").Cells(Alng, 7).Value)
                        End If
                    Next Alng
                End If
                For lngBS = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count + 1
                    If Sheets("Bestellung").Cells(lngBS, 12).Value = CDbl(strID) Then
                        lngBA = lngBA + CDbl(Sheets("Bestellung").Cells(lngBS, 6).Value)
                    End If
                Next lngBS
                If CDbl(Worksheets("Lager").Cells(lngIndex, 10).Value) = 0 And CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - CDbl(Alngs)) < 0 Then
                    lstMin.AddItem
                    lstMin.List(i, 0) = Worksheets("Lager").Cells(lngIndex, 3).Value
                    lstMin.List(i, 1) = VBA.Replace(CStr(Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Worksheets("Lager").Cells(lngIndex, 18), LookIn:=xlValues, MatchCase:=True).Row, 2)), Chr$(13) & Chr$(10), " ")
                    lstMin.List(i, 2) = VBA.Replace(CStr(Sheets("Lager").Cells(lngIndex, 6).Value), Chr$(13) & Chr$(10), " ")
                    lstMin.List(i, 3) = CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - Alngs)
                    lstMin.List(i, 4) = CDbl(lngBA)
                    If lngg > 0 Then
                        lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value & stxtL '" (Hauptlager)"
                    Else
                        lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value
                    End If
                    lstMin.List(i, 6) = Worksheets("Lager").Cells(lngIndex, 10).Value
                    lstMin.List(i, 7) = CStr(lngIndex)
                    lstMin.List(i, 8) = Worksheets("Lager").Cells(lngIndex, 1).Value
                    lstMin.List(i, 9) = Worksheets("Lager").Cells(lngIndex, 18).Value
                    i = i + 1
                End If
            End If
        End If
    Next
    Application.ScreenUpdating = True
End Sub

Sub SuchenMelde() 'v1.39
    Dim lngIndex, lngCount, lng, Alng, lngg, lngBS, i As Long
    Dim Alngs, lngS, lngBA As Double
    Dim strID, stxtL As String
    On Error Resume Next
    lstMin.Clear
    lstMin.ColumnCount = 7
    lstMin.ColumnWidths = "90;120;250;40;40;140;40;0;0"
    lngCount = ThisWorkbook.Worksheets("Lager").UsedRange.Rows.Count
    Label11.Caption = "Melde- Bestand"
    Application.ScreenUpdating = False
    For lngIndex = 2 To lngCount
        lngg = 0
        lngS = 0
        Alngs = 0
        lngBA = 0
        strID = Worksheets("Lager").Cells(lngIndex, 1).Value
        If Not Worksheets("Lager").Cells(lngIndex, 11) = "" Then
            For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                If Sheets("Lagerorte").Cells(lng, 2).Value = CDbl(strID) Then
                    lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                    stxtL = stxtL & ", " & Sheets("Lagerorte").Cells(lng, 3).Value 'Lagerort
                    lngg = lngg + 1
                End If
            Next lng
            If CheckBoxAuf.Value = True Then
                For Alng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count + 1
                    If Sheets("Reservierungen").Cells(Alng, 18).Value = CDbl(strID) And Not Sheets("Reservierungen").Cells(Alng, 11).Value = "Angebot" Then
                        Alngs = Alngs + CDbl(Sheets("Reservierungen").Cells(Alng, 7).Value)
                    End If
                Next Alng
            End If
            For lngBS = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count + 1
                If Sheets("Bestellung").Cells(lngBS, 12).Value = CDbl(strID) Then
                    lngBA = lngBA + CDbl(Sheets("Bestellung").Cells(lngBS, 6).Value)
                End If
            Next lngBS
            If CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - CDbl(Alngs)) <= CDbl(Worksheets("Lager").Cells(lngIndex, 11).Value) And CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - CDbl(Alngs)) > CDbl(Worksheets("Lager").Cells(lngIndex, 10).Value) Then
                lstMin.AddItem
                lstMin.List(i, 0) = Worksheets("Lager").Cells(lngIndex, 3).Value
                lstMin.List(i, 1) = VBA.Replace(CStr(Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Worksheets("Lager").Cells(lngIndex, 18), LookIn:=xlValues, MatchCase:=True).Row, 2)), Chr$(13) & Chr$(10), " ")
                lstMin.List(i, 2) = VBA.Replace(CStr(Sheets("Lager").Cells(lngIndex, 6).Value), Chr$(13) & Chr$(10), " ")
                lstMin.List(i, 3) = CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - Alngs)
                lstMin.List(i, 4) = CDbl(lngBA)
                If lngg > 0 Then
                    lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value & stxtL
                Else
                    lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value
                End If
                lstMin.List(i, 6) = Worksheets("Lager").Cells(lngIndex, 11).Value
                lstMin.List(i, 7) = CStr(lngIndex)
                lstMin.List(i, 8) = Worksheets("Lager").Cells(lngIndex, 1).Value
                lstMin.List(i, 9) = Worksheets("Lager").Cells(lngIndex, 18).Value
                i = i + 1
            End If
        End If
    Next
    Application.ScreenUpdating = True
End Sub

Sub SuchenMeldeL() 'v1.38
    Dim lngIndex, lngCount, lng, Alng, lngS, lngg, Alngs, lngBS, lngBA, i, lngZ As Long
    Dim strID, stxtL, stxtL2, stxtL3, stxtLP As String
    On Error Resume Next
    lstMin.Clear
    lstMin.ColumnCount = 7
    lstMin.ColumnWidths = "90;120;250;40;40;140;40;0;0"
    lngCount = ThisWorkbook.Worksheets("Lager").UsedRange.Rows.Count
    Label11.Caption = "Melde- Bestand"
    stxtL2 = cbo_BstLieferant
    i = 0
    Application.ScreenUpdating = False
    For lngIndex = 2 To lngCount
        lngg = 0
        lngS = 0
        Alngs = 0
        lngBA = 0
        strID = Worksheets("Lager").Cells(lngIndex, 1).Value
        stxtL3 = Worksheets("Lager").Cells(lngIndex, 18).Value
        stxtL = Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(stxtL3, LookIn:=xlValues, MatchCase:=True).Row, 2)
        If stxtL = stxtL2 Then
             If Not Worksheets("Lager").Cells(lngIndex, 11) = "" Then
                For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                    If Sheets("Lagerorte").Cells(lng, 2).Value = CDbl(strID) Then
                        lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                        stxtLP = stxtLP & ", " & Sheets("Lagerorte").Cells(lng, 3).Value 'Lagerort
                        lngg = lngg + 1
                    End If
                Next lng
                If CheckBoxAuf.Value = True Then
                    For Alng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count + 1
                        If Sheets("Reservierungen").Cells(Alng, 18).Value = CDbl(strID) And Sheets("Reservierungen").Cells(Alng, 11).Value = "Auftrag" Then
                            Alngs = Alngs + CDbl(Sheets("Reservierungen").Cells(Alng, 7).Value)
                        End If
                    Next Alng
                End If
                For lngBS = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count + 1
                    If Sheets("Bestellung").Cells(lngBS, 12).Value = CDbl(strID) Then
                        lngBA = lngBA + CDbl(Sheets("Bestellung").Cells(lngBS, 6).Value)
                    End If
                Next lngBS
                If CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - CDbl(Alngs)) <= CDbl(Worksheets("Lager").Cells(lngIndex, 11).Value) And CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - CDbl(Alngs)) > CDbl(Worksheets("Lager").Cells(lngIndex, 10).Value) Then
                    lstMin.AddItem
                    lstMin.List(i, 0) = Worksheets("Lager").Cells(lngIndex, 3).Value
                    lstMin.List(i, 1) = VBA.Replace(CStr(Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Worksheets("Lager").Cells(lngIndex, 18), LookIn:=xlValues, MatchCase:=True).Row, 2)), Chr$(13) & Chr$(10), " ")
                    lstMin.List(i, 2) = VBA.Replace(CStr(Sheets("Lager").Cells(lngIndex, 6).Value), Chr$(13) & Chr$(10), " ")
                    lstMin.List(i, 3) = CDbl((Worksheets("Lager").Cells(lngIndex, 8).Value + lngS) - Alngs)
                    lstMin.List(i, 4) = CDbl(lngBA)
                    If lngg > 0 Then
                        lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value & stxtLP
                    Else
                        lstMin.List(i, 5) = Worksheets("Lager").Cells(lngIndex, 13).Value
                    End If
                    lstMin.List(i, 6) = Worksheets("Lager").Cells(lngIndex, 11).Value
                    lstMin.List(i, 7) = CStr(lngIndex)
                    lstMin.List(i, 8) = Worksheets("Lager").Cells(lngIndex, 1).Value
                    lstMin.List(i, 9) = Worksheets("Lager").Cells(lngIndex, 18).Value
                    i = i + 1
                End If
            End If
        End If
    Next
    Application.ScreenUpdating = True
End Sub

Sub SuchenBeleg3()
    Dim arrTmpA, arrTmpB, i, Last_Row, j, n, i2, lng2 As Long
    Dim SuchKriterium, lngID As String
    On Error Resume Next
    If Worksheets("Warenausgang").Range("A26") = "" Then Exit Sub
    SuchKriterium = LCase(txtbeleg.Text)
    lstWAout.Clear
    i2 = 0
    With ThisWorkbook.Sheets("Warenausgang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
        For i = 0 To 19
            If Not arrTmpA(i, 2) = "" And InStr(1, LCase(arrTmpA(i, 2)), LCase(SuchKriterium)) > 0 Then
                lng2 = CDbl(ThisWorkbook.Worksheets("Warenausgang").UsedRange.Rows.Count) - i2
                n = n + 1
                arrTmpB(1, n) = arrTmpA(lng2, 2)
                arrTmpB(2, n) = CDate(arrTmpA(lng2, 8))
                arrTmpB(3, n) = arrTmpA(lng2, 3)
                arrTmpB(4, n) = arrTmpA(lng2, 4)
                If Int(arrTmpA(lng2, 5)) = arrTmpA(lng2, 5) Then
                    arrTmpB(5, n) = arrTmpA(lng2, 5)
                ElseIf CStr(Format(arrTmpA(lng2, 5), "0.0")) = arrTmpA(lng2, 5) Then
                    arrTmpB(5, n) = Format(arrTmpA(lng2, 5), "0.0")
                Else
                    arrTmpB(5, n) = Format(arrTmpA(lng2, 5), "0.00")
                End If
                arrTmpB(6, n) = Format(arrTmpA(lng2, 7) + arrTmpA(lng2, 16), "currency")
                arrTmpB(7, n) = arrTmpA(lng2, 14)
                arrTmpB(8, n) = i
                lngID = Worksheets("Kunden").Range("A:A").Find(Worksheets("Warenausgang").Cells(lng2, 17).Value, LookIn:=xlValues, MatchCase:=True).Row
                If Not Worksheets("Warenausgang").Cells(i, 17).Value = "" Then
                     txt_Kunden.Visible = True
                     lbl_Kunden.Visible = True
                     If Worksheets("Kunden").Cells(CLng(lngID), 4) = "Firma" Then
                         txt_Kunden.Value = "Firma " & Worksheets("Kunden").Cells(CLng(lngID), 7)
                     Else
                         txt_Kunden.Value = Worksheets("Kunden").Cells(CLng(lngID), 7) & ", " & Worksheets("Kunden").Cells(CLng(lngID), 6)
                     End If
                 Else
                     txt_Kunden.Visible = False
                     lbl_Kunden.Visible = False
                 End If
            End If
            i2 = i2 + 1
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lstWAout
                .ColumnCount = 6
                .ColumnWidths = "120;60;120;250;50;40"
                .List = arrTmpA
            End With
        Else
            MsgBox "Zu Ihrer Suchabfrage ''" & _
            txtbeleg.Value & "'' wurden kein Beleg gefunden.", vbInformation, "Suchabfrage"
            txtbeleg.SetFocus
        End If
    End With
    txt_Kunden.Value = ""
    lbldatensaetze.Caption = "Die letzten akt. 20 Datens|fffd|tze!"
End Sub

Private Sub lstWAout_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    If CDbl(lstWAout.ListCount) = 0 Then Exit Sub
    txtbeleg.Value = lstWAout.Column(0)
End Sub

Sub SuchenBeleg() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2 As Long
    On Error Resume Next
    If txtbeleg.Value = "" Then Exit Sub
    SuchKriterium = LCase(txtbeleg.Text)
    lstWAout.Clear
    txt_Kunden.Visible = True
    lbl_Kunden.Visible = True
    txt_Kunden.Value = ""
    With ThisWorkbook.Sheets("Warenausgang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 7 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And InStr(1, LCase(arrTmpA(i, 2)), LCase(SuchKriterium)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 2)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 8)), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = arrTmpA(i, 3)
                arrTmpB(4, n) = arrTmpA(i, 4)
                arrTmpB(5, n) = arrTmpA(i, 5)
                arrTmpB(6, n) = Format(arrTmpA(i, 7) + arrTmpA(i, 16), "currency")
                arrTmpB(7, n) = arrTmpA(i, 14)
                arrTmpB(8, n) = i
                With ThisWorkbook.Sheets("Kunden")
                   Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                   arrTmpA2 = .Range("A1:AO" & Last_Row2)
                   ReDim arrTmpB2(1 To 8, 1 To UBound(arrTmpA2))
                   For i2 = 2 To UBound(arrTmpA2)
                       If Not arrTmpA2(i2, 1) = "" And CStr(arrTmpA2(i2, 1)) = CStr(arrTmpA(i, 17)) Then
                            If Not arrTmpA2(i2, 4) = "Firma" Then
                                txt_Kunden.Value = arrTmpA2(i2, 7) & ", " & arrTmpA2(i2, 6)
                            Else
                                txt_Kunden.Value = "Firma " & arrTmpA2(i2, 7)
                            End If
                       End If
                   Next i2
                End With
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 8)
            For i = 1 To 8
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstWAout
               .ColumnCount = 6
               .ColumnWidths = "120;60;120;250;30;40"
               .List = arrTmpA
            End With
       Else
           MsgBox "Zu Ihrer Suchabfrage ''" & _
           txtbeleg.Value & "'' wurden kein Beleg gefunden.", vbInformation, "Suchabfrage"
           txtbeleg.SetFocus
       End If
    End With
    Call Datensaetze
End Sub

Sub SuchenBeleg2()
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    If txtbeleg.Value = "" Then Exit Sub
    SuchKriterium = LCase(txtbeleg.Text)
    lstWAout.Clear
    txt_Kunden.Visible = False
    lbl_Kunden.Visible = False
    With ThisWorkbook.Sheets("Warenausgang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 7 To UBound(arrTmpA)
           If Not arrTmpA(i, 2) = "" And InStr(1, LCase(arrTmpA(i, 2)), LCase(SuchKriterium)) > 0 Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 2)
               arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 8)), Chr$(13) & Chr$(10), " ")
               arrTmpB(3, n) = arrTmpA(i, 3)
               arrTmpB(4, n) = arrTmpA(i, 4)
               If Int(arrTmpA(i, 5)) = arrTmpA(i, 5) Then
                    arrTmpB(5, n) = arrTmpA(i, 5)
               ElseIf CStr(Format(arrTmpA(i, 5), "0.0")) = arrTmpA(i, 5) Then
                    arrTmpB(5, n) = Format(arrTmpA(i, 5), "0.0")
               Else
                    arrTmpB(5, n) = Format(arrTmpA(i, 5), "0.00")
               End If
               arrTmpB(6, n) = Format(arrTmpA(i, 7) + arrTmpA(i, 16), "currency")
               arrTmpB(7, n) = arrTmpA(i, 14)
               arrTmpB(8, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 8)
            For i = 1 To 8
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstWAout
               .ColumnCount = 6
               .ColumnWidths = "120;60;120;250;50;40"
               .List = arrTmpA
            End With
       Else
           MsgBox "Zu Ihrer Suchabfrage ''" & _
           txtbeleg.Value & "'' wurden kein Beleg gefunden.", vbInformation, "Suchabfrage"
           txtbeleg.SetFocus
       End If
    End With
    Call Datensaetze
End Sub

Sub SuchenDatum()
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    If txtdatum.Value = "" Then Exit Sub
    SuchKriterium = txtdatum.Text
    lstWAout.Clear
    With ThisWorkbook.Sheets("Warenausgang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 7 To UBound(arrTmpA)
           If Not arrTmpA(i, 8) = "" And CDate(arrTmpA(i, 8)) = CDate(SuchKriterium) Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 2)
               arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 8)), Chr$(13) & Chr$(10), " ")
               arrTmpB(3, n) = arrTmpA(i, 3)
               arrTmpB(4, n) = arrTmpA(i, 4)
               If Int(arrTmpA(i, 5)) = arrTmpA(i, 5) Then
                    arrTmpB(5, n) = arrTmpA(i, 5)
               ElseIf CStr(Format(arrTmpA(i, 5), "0.0")) = arrTmpA(i, 5) Then
                    arrTmpB(5, n) = Format(arrTmpA(i, 5), "0.0")
               Else
                    arrTmpB(5, n) = Format(arrTmpA(i, 5), "0.00")
               End If
               arrTmpB(6, n) = Format(arrTmpA(i, 7) + arrTmpA(i, 16), "currency")
               arrTmpB(7, n) = arrTmpA(i, 14)
               arrTmpB(8, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 8)
            For i = 1 To 8
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstWAout
               .ColumnCount = 6
               .ColumnWidths = "120;60;120;250;50;40"
               .List = arrTmpA
            End With
       Else
           MsgBox "Zu Ihrer Suchabfrage ''" & _
           txtbeleg.Value & "'' wurden kein Beleg gefunden.", vbInformation, "Suchabfrage"
           txtbeleg.SetFocus
       End If
    End With
    Call Datensaetze
End Sub

Private Sub cmdsuchBelegDate_Click()
    txt_Kunden.Visible = False
    lbl_Kunden.Visible = False
    If txtdatum.Value = "" Then
        frmKalender.txt_UID.Value = "JR_WA"
        frmKalender.Show
        Application.Cursor = xlWait
        Application.StatusBar = "Daten werden geladen.... Bitte warten!"
        Call SuchenDatum
        Application.StatusBar = False
        Application.Cursor = xlDefault
        Exit Sub
    End If
    If Not IsDate(txtdatum) Then
        MsgBox "Bitte geben Sie ein g|fffd|ltiges Datum an!", , "Datum pr|fffd|fen"
        txtdatum.SetFocus
        Exit Sub
    End If
    Application.Cursor = xlWait
    Application.StatusBar = "Daten werden geladen.... Bitte warten!"
    Call SuchenDatum
    Application.StatusBar = False
    Application.Cursor = xlDefault
End Sub

Sub Warengrupperechen() '1.40
    Dim arrTmpA, arrTmpB, i As Long, lngS As Long
    Dim Last_Row As Long
    Dim arrTmpA2, arrTmpB2, i2 As Long, lngs2 As Long
    Dim Last_Row2 As Long
    Dim Wert2 As Double
    On Error Resume Next
    Application.ScreenUpdating = False
    Wert2 = 0
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not arrTmpA(i, 1) = "" And arrTmpA(i, 16) = CStr(cboWarengruppe) Then
                lngS = 0
                Wert2 = Wert2 + (CDbl(arrTmpA(i, 8)) * CDbl(arrTmpA(i, 14)))
                With ThisWorkbook.Sheets("Lagerorte")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If Not arrTmpA2(i2, 2) = "" And arrTmpA2(i2, 2) = CStr(arrTmpA(i, 1)) Then
                            Wert2 = Wert2 + (CDbl(arrTmpA2(i2, 4)) * CDbl(arrTmpA(i, 14)))
                        End If
                    Next i2
                End With
           End If
       Next i
    End With
    Application.ScreenUpdating = True
    txtsumLagerMaterial.Value = Format(Wert2, "currency")
End Sub

Sub LieferantCombo()
    Dim aRow, irow As Long
    Dim DIC As Object
    Dim xKey As Variant
    aRow = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
    Set DIC = CreateObject("scripting.dictionary")
    For irow = 2 To aRow
        If Not IsEmpty(Sheets("Lieferanten").Cells(irow, 2)) Then
            xKey = VBA.Replace(CStr(Sheets("Lieferanten").Cells(irow, 2).Value), Chr$(13) & Chr$(10), " ")
            DIC(xKey) = 0
        End If
    Next
    For Each xKey In DIC
        ComLieferant2.AddItem xKey
        cboLieferant.AddItem xKey
    Next
End Sub

Sub BeHiAr()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 0 To ListWE.ListCount
        objDic(ListWE.Column(0, lngZ)) = 1
    Next
    cbo_ArikelNrBeHist.List = objDic.keys
    Set objDic = Nothing
End Sub

Sub Lieferantrechnen()
    Dim dblSumme, dblGesamt As Double
    Dim lngrow As Long
    On Error Resume Next
    dblSumme = 0
    dblGesamt = 0
    For lngrow = 1 To Worksheets("Wareneingang").Cells(Rows.Count, 1).End(xlUp).Row
        If Worksheets("Wareneingang").Cells(lngrow, 2).Value = cboLieferant.Text Then
            dblSumme = dblSumme + Worksheets("Wareneingang").Cells(lngrow, 6) * Worksheets("Wareneingang").Cells(lngrow, 11)
        End If
    Next
    dblGesamt = CDbl(dblSumme)
    txtsumLieferant.Value = dblGesamt
    txtsumLieferant.Value = Format(dblGesamt, "currency")
End Sub

Sub SuchenBestellung() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    SuchKriterium = LCase(txtBestellNR.Text)
    lstBestellungen.Clear
    With ThisWorkbook.Sheets("Bestellung")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not arrTmpA(i, 1) = "" And Not LCase(arrTmpA(i, 1)) Like SuchKriterium Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 1)
               arrTmpB(2, n) = arrTmpA(i, 3)
               arrTmpB(3, n) = arrTmpA(i, 4)
               arrTmpB(4, n) = arrTmpA(i, 5)
               arrTmpB(5, n) = arrTmpA(i, 6)
               arrTmpB(6, n) = arrTmpA(i, 8)
               arrTmpB(7, n) = Format(arrTmpA(i, 9), "currency")
               arrTmpB(8, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 8)
            For i = 1 To 8
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstBestellungen
               .ColumnCount = 7
               .ColumnWidths = "100;120;100;250;30;60;50;0;0"
               .List = arrTmpA
            End With
        Else
            MsgBox "Zu Ihrer Suchabfrage ''" & _
            txtBestellNR.Value & "'' wurde keine Bestellung gefunden.", vbInformation, "Suchabfrage"
       End If
    End With
    Call berechnungBestellung
End Sub

Sub SuchenBestellungFirst() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    SuchKriterium = CStr(txtBestellNR.Text)
    lstBestellungen.Clear
    With ThisWorkbook.Sheets("Bestellung")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = SuchKriterium Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 1)
               arrTmpB(2, n) = arrTmpA(i, 3)
               arrTmpB(3, n) = arrTmpA(i, 4)
               arrTmpB(4, n) = arrTmpA(i, 5)
               arrTmpB(5, n) = arrTmpA(i, 6)
               arrTmpB(6, n) = arrTmpA(i, 8)
               arrTmpB(7, n) = Format(arrTmpA(i, 9), "currency")
               arrTmpB(8, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 8)
            For i = 1 To 8
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstBestellungen
               .ColumnCount = 7
               .ColumnWidths = "100;120;100;250;30;60;50;0;0"
               .List = arrTmpA
            End With
       End If
    End With
    Call berechnungBestellung
    If lstBestellungen.ListCount = 0 Then
        Call SuchenBestellung
    End If
End Sub

Sub SuchenAuftrag()
    Dim lng, i, lngID As Long
    On Error Resume Next
    lstAuftrag.Clear
    lstAuftrag.ColumnCount = 8
    lstAuftrag.ColumnWidths = "120;120;50;250;80;0;60;0"
    lstAuftrag.TextAlign = fmTextAlignLeft
    lstAuftrag.Clear
    txt_Kunden2.Visible = False
    lbl_Kunden2.Visible = False
    i = 0
    For lng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
        If InStr(LCase(Worksheets("Reservierungen").Cells(lng, 1).Value), LCase(txtRAuftragsNr.Value)) > 0 Then
            lstAuftrag.AddItem Worksheets("Reservierungen").Cells(lng, 1).Value
            lstAuftrag.Column(1, i) = Worksheets("Reservierungen").Cells(lng, 2).Value
            lstAuftrag.Column(2, i) = Worksheets("Reservierungen").Cells(lng, 7).Value
            lstAuftrag.Column(3, i) = Worksheets("Reservierungen").Cells(lng, 6).Value
            lstAuftrag.Column(4, i) = Format(Worksheets("Reservierungen").Cells(lng, 8).Value, "currency")
            lstAuftrag.Column(5, i) = Worksheets("Reservierungen").Cells(lng, 4).Value
            lstAuftrag.Column(6, i) = Worksheets("Reservierungen").Cells(lng, 17).Value
            lstAuftrag.Column(8, i) = Worksheets("Reservierungen").Cells(lng, 18).Value
            lstAuftrag.Column(7, i) = Worksheets("Reservierungen").Cells(lng, 2).Row
            lngID = Worksheets("Kunden").Range("A:A").Find(Worksheets("Reservierungen").Cells(lng, 19).Value, LookIn:=xlValues, MatchCase:=True).Row
            If Not Worksheets("Reservierungen").Cells(lng, 19).Value = "" Then
                txt_Kunden2.Visible = True
                lbl_Kunden2.Visible = True
                If Worksheets("Kunden").Cells(CLng(lngID), 4) = "Firma" Then
                    txt_Kunden2.Value = "Firma " & Worksheets("Kunden").Cells(CLng(lngID), 7)
                Else
                    txt_Kunden2.Value = Worksheets("Kunden").Cells(CLng(lngID), 7) & ", " & Worksheets("Kunden").Cells(CLng(lngID), 6)
                End If
            Else
                txt_Kunden2.Visible = False
                lbl_Kunden2.Visible = False
            End If
            i = i + 1
        End If
    Next lng
    If lstAuftrag.ListCount = 0 Then MsgBox "Zu Ihrer Suchabfrage ''" & _
        txtRAuftragsNr.Value & "'' wurde keine Bestellung gefunden.", vbInformation, "Suchabfrage"
End Sub

Sub SuchenAuftragdatum()
    Dim lng, i As Long
    On Error Resume Next
    lstAuftrag.Clear
    lstAuftrag.ColumnCount = 8
    lstAuftrag.ColumnWidths = "120;120;50;250;80;0;60;0"
    lstAuftrag.TextAlign = fmTextAlignLeft
    lstAuftrag.Clear
    i = 0
    For lng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
        If InStr(LCase(Worksheets("Reservierungen").Cells(lng, 17).Value), LCase(Date)) > 0 Then
            lstAuftrag.AddItem Worksheets("Reservierungen").Cells(lng, 1).Value
            lstAuftrag.Column(1, i) = Worksheets("Reservierungen").Cells(lng, 2).Value
            lstAuftrag.Column(2, i) = Worksheets("Reservierungen").Cells(lng, 7).Value
            lstAuftrag.Column(3, i) = Worksheets("Reservierungen").Cells(lng, 6).Value
            lstAuftrag.Column(4, i) = Format(Worksheets("Reservierungen").Cells(lng, 8).Value, "currency")
            lstAuftrag.Column(5, i) = Worksheets("Reservierungen").Cells(lng, 4).Value
            lstAuftrag.Column(6, i) = Worksheets("Reservierungen").Cells(lng, 17).Value
            lstAuftrag.Column(8, i) = Worksheets("Reservierungen").Cells(lng, 18).Value
            lstAuftrag.Column(7, i) = Worksheets("Reservierungen").Cells(lng, 2).Row
            i = i + 1
        End If
    Next lng
    If lstAuftrag.ListCount = 0 Then MsgBox "F|fffd|r heute liegen keine Auftr|fffd|ge vor!", vbInformation, "Suchabfrage"
End Sub

Sub SuchenAhis() '1.44
    Dim Last_Row, lngID, arrTmpA, arrTmpB, i, lngS, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    SuchKriterium = txtID
    lstAhis.Clear
    With ThisWorkbook.Sheets("Warenausgang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:T" & Last_Row)
        ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
        For i = 7 To UBound(arrTmpA)
            If Not arrTmpA(i, 14) = "" And arrTmpA(i, 14) = SuchKriterium And Format(arrTmpA(i, 8), "YYYY") = cbojahr Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 8)
                arrTmpB(2, n) = arrTmpA(i, 2)
                arrTmpB(3, n) = arrTmpA(i, 11)
                arrTmpB(4, n) = arrTmpA(i, 5)
                arrTmpB(5, n) = arrTmpA(i, 15)
                lngID = Worksheets("Kunden").Range("A:A").Find(arrTmpA(i, 17), LookIn:=xlValues, MatchCase:=True).Row
                If Not arrTmpA(i, 17) = "" Then
                    If Worksheets("Kunden").Cells(CLng(lngID), 4) = "Firma" Then
                        arrTmpB(6, n) = "Firma " & Worksheets("Kunden").Cells(CLng(lngID), 7)
                    Else
                         arrTmpB(6, n) = Worksheets("Kunden").Cells(CLng(lngID), 7) & ", " & Worksheets("Kunden").Cells(CLng(lngID), 6)
                    End If
                End If
                arrTmpB(7, n) = i
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstAhis
               .ColumnCount = 7
               .ColumnWidths = "60;120;60;30;90;0"
               .List = arrTmpA
            End With
       End If
    End With
End Sub

Sub AEink()
    Dim Last_Row, lngID, arrTmpA, arrTmpB, i, lngS, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    SuchKriterium = txtID
    lstAhis.Clear
    With ThisWorkbook.Sheets("Wareneingang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:T" & Last_Row)
        ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 12) = "" And arrTmpA(i, 12) = SuchKriterium And Format(arrTmpA(i, 8), "YYYY") = cbojahr Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 8)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = arrTmpA(i, 6)
                arrTmpB(4, n) = arrTmpA(i, 1)
                arrTmpB(5, n) = arrTmpA(i, 13)
                lngID = Worksheets("Kunden").Range("A:A").Find(arrTmpA(i, 17), LookIn:=xlValues, MatchCase:=True).Row
                If Not arrTmpA(i, 17) = "" Then
                    If Worksheets("Kunden").Cells(CLng(lngID), 4) = "Firma" Then
                        arrTmpB(6, n) = "Firma " & Worksheets("Kunden").Cells(CLng(lngID), 7)
                    Else
                         arrTmpB(6, n) = Worksheets("Kunden").Cells(CLng(lngID), 7) & ", " & Worksheets("Kunden").Cells(CLng(lngID), 6)
                    End If
                End If
                arrTmpB(7, n) = i
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstAhis
               .ColumnCount = 7
               .ColumnWidths = "60;180;40;120;70;0"
               .List = arrTmpA
            End With
       End If
    End With
End Sub

Sub SuchenAuftragdatumWoche()
    Dim lng, i, lngZahl As Long
    On Error Resume Next
    lstAuftrag.Clear
    lstAuftrag.ColumnCount = 8
    lstAuftrag.ColumnWidths = "120;120;50;250;80;0;60;0"
    lstAuftrag.TextAlign = fmTextAlignLeft
    lstAuftrag.Clear
    If lbl_dayfull = "Montag" Then
        lngZahl = 6
    ElseIf lbl_dayfull = "Dienstag" Then
        lngZahl = 5
    ElseIf lbl_dayfull = "Mittwoch" Then
        lngZahl = 4
    ElseIf lbl_dayfull = "Donnerstag" Then
        lngZahl = 3
    ElseIf lbl_dayfull = "Freitag" Then
        lngZahl = 2
    ElseIf lbl_dayfull = "Samstag" Then
        lngZahl = 1
    Else
        lngZahl = 0
    End If
    i = 0
    For lng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
        If CLng(Worksheets("Reservierungen").Cells(lng, 17).Value) > 0 And CLng(Worksheets("Reservierungen").Cells(lng, 17).Value) < CLng(CDate(Date)) + lngZahl _
        And CLng(Worksheets("Reservierungen").Cells(lng, 17).Value) > CDate(Date - lngZahl) Then
            lstAuftrag.AddItem Worksheets("Reservierungen").Cells(lng, 1).Value
            lstAuftrag.Column(1, i) = Worksheets("Reservierungen").Cells(lng, 2).Value
            lstAuftrag.Column(2, i) = Worksheets("Reservierungen").Cells(lng, 7).Value
            lstAuftrag.Column(3, i) = Worksheets("Reservierungen").Cells(lng, 6).Value
            lstAuftrag.Column(4, i) = Format(Worksheets("Reservierungen").Cells(lng, 8).Value, "currency")
            lstAuftrag.Column(5, i) = Worksheets("Reservierungen").Cells(lng, 4).Value
            lstAuftrag.Column(6, i) = Worksheets("Reservierungen").Cells(lng, 17).Value
            lstAuftrag.Column(8, i) = Worksheets("Reservierungen").Cells(lng, 18).Value
            lstAuftrag.Column(7, i) = Worksheets("Reservierungen").Cells(lng, 2).Row
            i = i + 1
        End If
    Next lng
    If lstAuftrag.ListCount = 0 Then MsgBox "F|fffd|r diese Woche liegen keine Auftr|fffd|ge vor!", vbInformation, "Suchabfrage"
End Sub

Private Sub berechnungBestellung()
    Dim wert As Double
    Dim Sgl As Single
    On Error Resume Next
    For Sgl = 0 To lstBestellungen.ListCount - 1
        wert = wert + lstBestellungen.List(Sgl, 6)
    Next Sgl
    txtsum2.Value = Format((wert), "currency")
    lbl_sum.Caption = Format(txtsum2.Value, "currency")
End Sub

Sub Jahr2()
    Dim Last_Row, lngID, arrTmpA, arrTmpB, i, lngS, j, n As Long
    Dim SuchKriterium As String
    Dim Mo(1 To 12) As Double
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    SuchKriterium = CStr(txtID)
    txtJan.Value = 0
    txtFeb.Value = 0
    txtMrz.Value = 0
    txtApr.Value = 0
    txtMai.Value = 0
    txtJun.Value = 0
    txtJul.Value = 0
    txtAug.Value = 0
    txtSep.Value = 0
    txtOkt.Value = 0
    txtNov.Value = 0
    txtDez.Value = 0
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Warenausgang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:T" & Last_Row)
        ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
        For i = 7 To UBound(arrTmpA)
            If Not arrTmpA(i, 14) = "" And arrTmpA(i, 14) = SuchKriterium And Format(arrTmpA(i, 8), "YYYY") = cbojahr Then
                If Format(arrTmpA(i, 8), "M") = 1 Then
                    Mo(1) = Mo(1) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 2 Then
                    Mo(2) = Mo(2) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 3 Then
                    Mo(3) = Mo(3) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 4 Then
                    Mo(4) = Mo(4) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 5 Then
                    Mo(5) = Mo(5) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 6 Then
                    Mo(6) = Mo(6) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 7 Then
                    Mo(7) = Mo(7) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 8 Then
                    Mo(8) = Mo(8) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 9 Then
                    Mo(9) = Mo(9) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 10 Then
                    Mo(10) = Mo(10) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 11 Then
                    Mo(11) = Mo(11) + CDbl(arrTmpA(i, 5))
                ElseIf Format(arrTmpA(i, 8), "M") = 12 Then
                    Mo(12) = Mo(12) + CDbl(arrTmpA(i, 5))
                End If
            End If
       Next i
    End With
    txtJan.Value = Mo(1)
    txtFeb.Value = Mo(2)
    txtMrz.Value = Mo(3)
    txtApr.Value = Mo(4)
    txtMai.Value = Mo(5)
    txtJun.Value = Mo(6)
    txtJul.Value = Mo(7)
    txtAug.Value = Mo(8)
    txtSep.Value = Mo(9)
    txtOkt.Value = Mo(10)
    txtNov.Value = Mo(11)
    txtDez.Value = Mo(12)
    txtQ1.Value = CDbl(txtJan.Value) + CDbl(txtFeb.Value) + CDbl(txtMrz.Value)
    txtQ2.Value = CDbl(txtApr.Value) + CDbl(txtMai.Value) + CDbl(txtJun.Value)
    txtQ3.Value = CDbl(txtJul.Value) + CDbl(txtAug.Value) + CDbl(txtSep.Value)
    txtQ4.Value = CDbl(txtOkt.Value) + CDbl(txtNov.Value) + CDbl(txtDez.Value)
    txtsumme.Value = CDbl(txtQ1.Value) + CDbl(txtQ2.Value) + CDbl(txtQ3.Value) + CDbl(txtQ4.Value)
    If txtJan.Value > 0 Then
        txtJan.BackColor = &HC0FFC0
    Else
        txtJan.BackColor = &HC0FFFF
    End If
    If txtFeb.Value > 0 Then
        txtFeb.BackColor = &HC0FFC0
    Else
        txtFeb.BackColor = &HC0FFFF
    End If
    If txtMrz.Value > 0 Then
        txtMrz.BackColor = &HC0FFC0
    Else
        txtMrz.BackColor = &HC0FFFF
    End If
    If txtApr.Value > 0 Then
        txtApr.BackColor = &HC0FFC0
    Else
        txtApr.BackColor = &HC0FFFF
    End If
    If txtMai.Value > 0 Then
        txtMai.BackColor = &HC0FFC0
    Else
        txtMai.BackColor = &HC0FFFF
    End If
    If txtJun.Value > 0 Then
        txtJun.BackColor = &HC0FFC0
    Else
        txtJun.BackColor = &HC0FFFF
    End If
    If txtJul.Value > 0 Then
        txtJulE.BackColor = &HC0FFC0
    Else
        txtJul.BackColor = &HC0FFFF
    End If
    If txtAug.Value > 0 Then
        txtAug.BackColor = &HC0FFC0
    Else
        txtAug.BackColor = &HC0FFFF
    End If
    If txtSep.Value > 0 Then
        txtSep.BackColor = &HC0FFC0
    Else
        txtSep.BackColor = &HC0FFFF
    End If
    If txtOkt.Value > 0 Then
        txtOkt.BackColor = &HC0FFC0
    Else
        txtOkt.BackColor = &HC0FFFF
    End If
    If txtNov.Value > 0 Then
        txtNov.BackColor = &HC0FFC0
    Else
        txtNov.BackColor = &HC0FFFF
    End If
    If txtDez.Value > 0 Then
        txtDez.BackColor = &HC0FFC0
    Else
        txtDez.BackColor = &HC0FFFF
    End If
    If txtsumme.Value > 0 Then
        txtsumme.BackColor = &H80C0FF
    Else
        txtsumme.BackColor = &HFFFFFF
    End If
    Application.ScreenUpdating = False
    lbl_VKEK.Caption = "Verkauf (" & txtsumme & ")"
End Sub

Sub JahrE2()
    Dim Last_Row, lngID, arrTmpA, arrTmpB, i, lngS, j, n As Long
    Dim SuchKriterium As String
    Dim Mo(1 To 12) As Double
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    SuchKriterium = CStr(txtID)
    Mo(1) = 0
    Mo(2) = 0
    Mo(3) = 0
    Mo(4) = 0
    Mo(5) = 0
    Mo(6) = 0
    Mo(7) = 0
    Mo(8) = 0
    Mo(9) = 0
    Mo(10) = 0
    Mo(11) = 0
    Mo(12) = 0
    With ThisWorkbook.Sheets("Wareneingang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:T" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 7 To UBound(arrTmpA)
            If Not arrTmpA(i, 12) = "" And arrTmpA(i, 12) = SuchKriterium And Format(arrTmpA(i, 8), "YYYY") = cbojahr Then
                If Format(arrTmpA(i, 8), "M") = 1 Then
                    Mo(1) = Mo(1) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 2 Then
                    Mo(2) = Mo(2) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 3 Then
                    Mo(3) = Mo(3) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 4 Then
                    Mo(4) = Mo(4) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 5 Then
                    Mo(5) = Mo(5) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 6 Then
                    Mo(6) = Mo(6) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 7 Then
                    Mo(7) = Mo(7) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 8 Then
                    Mo(8) = Mo(8) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 9 Then
                    Mo(9) = Mo(9) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 10 Then
                    Mo(10) = Mo(10) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 11 Then
                    Mo(11) = Mo(11) + CDbl(arrTmpA(i, 6))
                ElseIf Format(arrTmpA(i, 8), "M") = 12 Then
                    Mo(12) = Mo(12) + CDbl(arrTmpA(i, 6))
                End If
            End If
       Next i
    End With
    txtJanE.Value = Mo(1)
    txtFebE.Value = Mo(2)
    txtMrzE.Value = Mo(3)
    txtAprE.Value = Mo(4)
    txtMaiE.Value = Mo(5)
    txtJunE.Value = Mo(6)
    txtJulE.Value = Mo(7)
    txtAugE.Value = Mo(8)
    txtSepE.Value = Mo(9)
    txtOktE.Value = Mo(10)
    txtNovE.Value = Mo(11)
    txtDezE.Value = Mo(12)
    txtQ1E.Value = CDbl(txtJanE.Value) + CDbl(txtFebE.Value) + CDbl(txtMrzE.Value)
    txtQ2E.Value = CDbl(txtAprE.Value) + CDbl(txtMaiE.Value) + CDbl(txtJunE.Value)
    txtQ3E.Value = CDbl(txtJulE.Value) + CDbl(txtAugE.Value) + CDbl(txtSepE.Value)
    txtQ4E.Value = CDbl(txtOktE.Value) + CDbl(txtNovE.Value) + CDbl(txtDezE.Value)
    txtsummeE.Value = CDbl(txtQ1E.Value) + CDbl(txtQ2E.Value) + CDbl(txtQ3E.Value) + CDbl(txtQ4E.Value)
    If txtJanE.Value > 0 Then
        txtJanE.BackColor = &HC0FFC0
    Else
        txtJanE.BackColor = &HC0FFFF
    End If
    If txtFebE.Value > 0 Then
        txtFebE.BackColor = &HC0FFC0
    Else
        txtFebE.BackColor = &HC0FFFF
    End If
    If txtMrzE.Value > 0 Then
        txtMrzE.BackColor = &HC0FFC0
    Else
        txtMrzE.BackColor = &HC0FFFF
    End If
    If txtAprE.Value > 0 Then
        txtAprE.BackColor = &HC0FFC0
    Else
        txtAprE.BackColor = &HC0FFFF
    End If
    If txtMaiE.Value > 0 Then
        txtMaiE.BackColor = &HC0FFC0
    Else
        txtMaiE.BackColor = &HC0FFFF
    End If
    If txtJunE.Value > 0 Then
        txtJunE.BackColor = &HC0FFC0
    Else
        txtJunE.BackColor = &HC0FFFF
    End If
    If txtJulE.Value > 0 Then
        txtJulE.BackColor = &HC0FFC0
    Else
        txtJulE.BackColor = &HC0FFFF
    End If
    If txtAugE.Value > 0 Then
        txtAugE.BackColor = &HC0FFC0
    Else
        txtAugE.BackColor = &HC0FFFF
    End If
    If txtSepE.Value > 0 Then
        txtSepE.BackColor = &HC0FFC0
    Else
        txtSepE.BackColor = &HC0FFFF
    End If
    If txtOktE.Value > 0 Then
        txtOktE.BackColor = &HC0FFC0
    Else
        txtOktE.BackColor = &HC0FFFF
    End If
    If txtNovE.Value > 0 Then
        txtNovE.BackColor = &HC0FFC0
    Else
        txtNovE.BackColor = &HC0FFFF
    End If
    If txtDezE.Value > 0 Then
        txtDezE.BackColor = &HC0FFC0
    Else
        txtDezE.BackColor = &HC0FFFF
    End If
    If txtsummeE.Value > 0 Then
        txtsummeE.BackColor = &H80C0FF
    Else
        txtsummeE.BackColor = &HFFFFFF
    End If
    lbl_EK.Caption = "Einkauf (" & txtsummeE & ")"
End Sub
Attribute VB_Name = "frmBestellung"
Attribute VB_Base = "0{5DD05C49-4DD2-4B45-9DD6-03AACAC3BC42}{3332D44B-7E4E-415F-B7AA-ECB6A6328982}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    If Not Sheets("Daten").Range("D39").Value = "Nein" Then
        cmd_BENR.Visible = True
        txtBestellNR.Width = 132
    Else
        txtBestellNR.Width = 156
    End If
    Call LieferCombo
    Call BeList
    Call ArtikelCombo
End Sub

Private Sub cbo_LVerfuegbar_Change()
    Dim xrow As Long
    On Error Resume Next
    lbl_status.Visible = False
    Application.ScreenUpdating = False
    If Not cbo_LVerfuegbar = "" And cbo_Lieferant = "Alle anzeigen" Then
        xrow = xFind(ActiveWorkbook.Name, "Lieferanten", CStr(cbo_LVerfuegbar), "B:B")
        txt_LVerfuegbar.Value = CStr(Sheets("Lieferanten").Cells(xrow, 1))
        If lstBestellung.ListCount = 0 Then
            cboLieferant = cbo_LVerfuegbar
        End If
    Else
        txt_LVerfuegbar.Value = ""
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_LVerfuegbar_DropButtonClick()
    Dim xrow, xrow2, lngg, lng, lngZeile2, lngL As Long
    Dim arrTmpA, arrTmpB, i, n, Last_Row As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:P" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = CStr(txtID) Then
                xrow = i
            End If
        Next i
    End With
    If cbo_Lieferant = "Alle anzeigen" Then
        If Sheets("Lager").Cells(xrow, 18).Value = "" Then
            txt_BEK.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
        ElseIf CStr(Sheets("Lager").Cells(xrow, 18)) = CStr(txt_LVerfuegbar) Then
            txt_BEK.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
        Else
            With ThisWorkbook.Sheets("VPEinheit")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:P" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If arrTmpA(i, 2) = CStr(Me.txtID) And arrTmpA(i, 10) = CStr(txt_LVerfuegbar) And arrTmpA(i, 14) = "VP-WL" Then
                        xrow2 = i
                    End If
                Next i
            End With
            txt_BEK.Value = Format(Sheets("VPEinheit").Cells(xrow2, 13), "currency")
            txtpreis.Value = Sheets("VPEinheit").Cells(xrow2, 13)
        End If
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cboArtikelNR_Change()
    If cboArtikelNR = "" Then Exit Sub
    Call suchenTArtikel
    If Not Me.lstArtikelID.ListCount > 1 Then
        Call Klickliste
    End If
End Sub

Sub Klickliste()
    Dim xrow, xrow2, lngg, lng, lngZeile2, lngL As Long
    Dim arrTmpA, arrTmpB, i, n, Last_Row As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next

    Call suchenTArtikel
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:N" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 3) = CStr(frmBestellung.cboArtikelNR) Then
                xrow = i
            End If
        Next i
    End With
    lbl_itemnumber.Caption = Sheets("Lager").Cells(xrow, 3)
    If lstArtikelID.Column(2) = "VP" Then
        lngZeile2 = lstArtikelID.Column(1)
        lbl_itemnumber.Caption = Sheets("Lager").Cells(xrow, 3).Value & "-1" & Sheets("VPEinheit").Cells(lngZeile2, 3).Value
    End If
    lbl_bezeichnung.Caption = Sheets("Lager").Cells(xrow, 6)
    lbl_herstellerNr.Caption = Sheets("Lager").Cells(xrow, 4)
    lbl_lagerort.Caption = Sheets("Lager").Cells(xrow, 13)
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    txt_BarcodeBst.Value = Sheets("Lager").Cells(xrow, 31)
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    txt_LArt.Value = "HL"
    txt_zeile = xrow
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        cbo_Lagerplatz.Enabled = True
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        frmKasse.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        For Each xKey In DIC
            cbo_Lagerplatz.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_Lagerplatz.ListIndex = 0
    Else
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.Enabled = False
    End If
    If cbo_Lieferant = "Alle anzeigen" Then
        txt_BEK.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
        txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
    Else
        If Sheets("Lager").Cells(xrow, 18).Value = "" Then
            txt_BEK.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
        ElseIf CStr(Sheets("Lager").Cells(xrow, 18)) = CStr(txt_LNr2) Then
            txt_BEK.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
        Else
            With ThisWorkbook.Sheets("VPEinheit")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:N" & Last_Row)
                ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If arrTmpA(i, 2) = CStr(Me.txtID) And arrTmpA(i, 10) = CStr(txt_LNr2) And arrTmpA(i, 14) = "VP-WL" Then
                        xrow2 = i
                    End If
                Next i
            End With
            txt_BEK.Value = Format(Sheets("VPEinheit").Cells(xrow2, 13), "currency")
            txtpreis.Value = Sheets("VPEinheit").Cells(xrow2, 13)
        End If
    End If
    If lbl_lagerort = "" Then
        lbl_lagerort.Caption = "Kein Lagerort zugewiesen!"
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cboArtikelNR_DropButtonClick()
   Call Klickliste
   Call VPzusam
End Sub

Sub SuchenVP()
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j, lngL As Long
    On Error Resume Next
    lstArtikelID2.Clear
    lngL = 0
    Application.ScreenUpdating = False
    If Not cbo_Lieferant = "Alle anzeigen" Then
        lngL = 1
        With ThisWorkbook.Sheets("VPEinheit")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:R" & Last_Row)
           ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If arrTmpA(i, 2) = CStr(Me.txtID) And CStr(arrTmpA(i, 14)) = "VP-LB" Then
                   n = n + 1
                   arrTmpB(1, n) = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ") " & lbl_bezeichnung
                   arrTmpB(2, n) = i
                   arrTmpB(3, n) = "VP"
               End If
           Next i
        End With
    Else
        With ThisWorkbook.Sheets("VPEinheit")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:P" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 2) = CStr(Me.txtID) And CStr(arrTmpA(i, 14)) = "VP-LB" Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ") " & lbl_bezeichnung
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = "VP"
                End If
            Next i
        End With
    End If
    Erase arrTmpA
    ReDim arrTmpA(1 To n, 1 To 3)
    For i = 1 To 3
       For j = 1 To n
           arrTmpA(j, i) = arrTmpB(i, j)
       Next
    Next
    With lstArtikelID2
       .ColumnCount = 3
       .ColumnWidths = "180;0;0"
       .List = arrTmpA
    End With
    Application.ScreenUpdating = True
End Sub

Sub VPzusam()
    Dim i, i2, lng As Long
    On Error Resume Next
    If lstArtikelID2.ListCount = 0 Then Exit Sub
    Application.ScreenUpdating = False
    i2 = lstArtikelID.ListCount
    For lng = 1 To lstArtikelID2.ListCount
        lstArtikelID.AddItem lstArtikelID2.Column(0, i)
        lstArtikelID.Column(1, i2) = lstArtikelID2.Column(1, i)
        lstArtikelID.Column(2, i2) = lstArtikelID2.Column(2, i)
        lstArtikelID.Column(3, i2) = lstArtikelID2.Column(3, i)
        lstArtikelID.Column(4, i2) = lstArtikelID2.Column(4, i)
        i2 = i2 + 1
        i = i + 1
    Next lng
    lstArtikelID2.Clear
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_BEKchange_Click() '1.44
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2, lngL2, wert, Wert2, xrow As Long
    Dim strP, strL, FDate As String
    Dim Palt As Double
    On Error Resume Next
    If cbo_Lieferant = "Alle anziegen" Then
        strL = cbo_LVerfuegbar
    Else
        strL = cbo_Lieferant
    End If
    If txtID = "" Then Exit Sub
    If Not txt_LArt.Value = "VP" Then
        If Not txt_BEK = "" Then
            strP = InputBox("Bitte geben Sie den neuen Preis an!" & vbLf & vbLf & "Achtung, Preis wird auch beim Lieferant (" & strL & ") ge|fffd|ndert!", "EK-Preis |fffd|ndern", Format(CDbl(txt_BEK.Value), "0.00"))
        Else
            strP = InputBox("Bitte geben Sie den neuen Preis an!" & vbLf & vbLf & "Achtung, Preis wird auch beim Lieferant (" & strL & ") ge|fffd|ndert!", "EK-Preis |fffd|ndern", "0.00")
        End If
    Else
        If Not txt_BEK = "" Then
            strP = InputBox("Bitte geben Sie den neuen Preis an!" & vbLf & vbLf & "Achtung, Preis wird automatisch gespeichert!", "EK-Preis |fffd|ndern", Format(CDbl(txt_BEK.Value), "0.00"))
        Else
            strP = InputBox("Bitte geben Sie den neuen Preis an!" & vbLf & vbLf & "Achtung, Preis wird automatisch gespeichert!", "EK-Preis |fffd|ndern", "0.00")
        End If
    End If
    If strP = "" Then
        Exit Sub
    Else
        txt_BEK.Value = Format(CDbl(strP), "currency")
        txtpreis.Value = CDbl(strP)
    End If
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    wert = 0
    Wert2 = 0
    Application.ScreenUpdating = False
    If Not txt_LNr2.Value = "" Then
        With ThisWorkbook.Sheets("Lager")
            Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA2 = .Range("A1:AA" & Last_Row2)
            ReDim arrTmpB2(1 To 5, 1 To UBound(arrTmpA2))
            For i2 = 2 To UBound(arrTmpA2)
                If CStr(arrTmpA2(i2, 1)) = CStr(txtID) And CStr(arrTmpA2(i2, 18)) = CStr(txt_LNr2) Then
                   wert = wert + 1
                   xrow = i2
                End If
            Next i2
        End With
    Else
        With ThisWorkbook.Sheets("Lager")
            Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA2 = .Range("A1:AA" & Last_Row2)
            ReDim arrTmpB2(1 To 5, 1 To UBound(arrTmpA2))
            For i2 = 2 To UBound(arrTmpA2)
                If CStr(arrTmpA2(i2, 1)) = CStr(txtID) And CStr(arrTmpA2(i2, 18)) = CStr(txt_LVerfuegbar) Then
                   wert = wert + 1
                   xrow = i2
                End If
            Next i2
        End With
    End If
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA2 = .Range("A1:P" & Last_Row2)
        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
        For i2 = 2 To UBound(arrTmpA2)
            If arrTmpA2(i2, 2) = Me.txtID And arrTmpA2(i2, 10) = CStr(txt_LVerfuegbar) And arrTmpA2(i2, 14) = "VP-WL" Then
                Wert2 = Wert2 + 1
                xrow = i2
            End If
        Next i2
    End With
    If wert + Wert2 = 0 Then Exit Sub
    If Not txt_LArt.Value = "VP" Then
        If wert > 0 Then
            Palt = Format(CDbl(Sheets("Lager").Cells(xrow, 14).Value), "#.##")
            Sheets("Lager").Cells(xrow, 14).Value = CDbl(strP)
            Sheets("Lager").Cells(xrow, 17).Value = Format(Date, FDate)
            If Not CDbl(Palt) = Format(CDbl(strP), "#.##") Then
                With Sheets("Preisverlauf").Activate
                    Sheets("Preisverlauf").Range("A65536").End(xlUp).Offset(1, 0).Select
                    ActiveCell.Offset(0, 0).Value = txtID
                    ActiveCell.Offset(0, 1).Value = "'" & lbl_itemnumber
                    ActiveCell.Offset(0, 2).Value = "EK"
                    ActiveCell.Offset(0, 3).Value = CDbl(Palt)
                    ActiveCell.Offset(0, 4).Value = CDbl(strP)
                    ActiveCell.Offset(0, 5).Value = Format(Date, "DD.MM.YYYY")
                    ActiveCell.Offset(0, 6).Value = frmLager.lbl_Benutzer
                End With
            End If
        Else
            Sheets("VPEinheit").Cells(xrow, 13).Value = CDbl(strP)
            Sheets("VPEinheit").Cells(xrow, 15).Value = Format(Date, FDate)
        End If
    Else
        Sheets("VPEinheit").Cells(CLng(xrow), 13).Value = CDbl(strP)
        Sheets("VPEinheit").Cells(CLng(xrow), 15).Value = Format(Date, FDate)
    End If
    ThisWorkbook.Sheets("Center").Activate
    Application.ScreenUpdating = True
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    lbl_status.Caption = "Artikel: " & Me.lbl_itemnumber & " / Preis wurde f|fffd|r den Lieferanten (" & strL & ") ge|fffd|ndert! / Neuer EK-Preis: " & Format(CDbl(strP), "currency")
    lbl_status.Visible = True
    txtstueck.SetFocus
End Sub

Private Sub cmd_BENR_Click()
    Dim strF As String
    If Sheets("Daten").Range("D39").Value = "Auswahl 2" Then
        txtBestellNR.Value = "BE" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
    Else
        cboVAuftrag.ListIndex = 0
        lstBestellung.Clear
        strF = Sheets("Daten").Range("D42")
        txtBestellNR.Value = Sheets("Daten").Range("D40") & Format((Sheets("Daten").Range("D41") + 1), strF)
    End If
End Sub

Private Sub cmd_NeuLieferant_Click()
    frmLieferanten.txtVerweisArtikel.Value = 1
    frmLieferanten.txt_Art.Value = "Bestellung"
    frmLieferanten.txtLNr.SetFocus
    frmLieferanten.Show
End Sub

Private Sub lstArtikelID_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    If Not lstArtikelID.Column(2) = "VP" Then
        Me.cboArtikelNR = Me.lbl_itemnumber
        If lstArtikelID2.ListCount > 0 Then
            Call VPzusam
        End If
    End If
    txtstueck.SetFocus
End Sub

Private Sub txt_BEK_Change()
    On Error Resume Next
    txtpreis.Value = CDbl(txt_BEK)
End Sub

Private Sub txt_Mzuschlag_Change()
    Call BPreis
End Sub

Private Sub txt_versandK_Change()
    Call BPreis
End Sub

Private Sub txtBsum_Change()
    Call BPreis
End Sub

Sub BPreis()
    On Error Resume Next
    If txt_versandK = "" Then
        txt_versandK = 0
    End If
    If txt_Mzuschlag = "" Then
        txt_Mzuschlag = 0
    End If
    If lstBestellung.ListCount = 0 Then Exit Sub
    If txtBsum = "" Or txtBsum = "," Then txtBsum = 0
    If Not txtBsum = "" Then
        Me.lbl_Betrag.Caption = Format(CDbl(txtBsum.Value) + CDbl(txt_versandK) + CDbl(txt_Mzuschlag), "currency")
    Else
        Me.lbl_Betrag.Caption = Format(CDbl(0), "currency")
    End If
End Sub

Private Sub txtID_Change()
    lbl_status.Visible = False
    If Not txtID = "" Then
        Call LVerfuegbar
        Call SuchenVP
    End If
End Sub

Private Sub txtstueck_AfterUpdate()
    If txtstueck.Value = "" Then Exit Sub
    If txtstueck.Value <= 0 Then
        txtstueck.Value = ""
        txtstueck.SetFocus
        Exit Sub
    End If
    If Not IsNumeric(txtstueck.Value) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        txtstueck.Value = ""
        txtstueck.SetFocus
    End If
End Sub

Sub LieferCombo()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    cboLieferant.Clear
    cbo_Lieferant.Clear
    Application.ScreenUpdating = False
    With cboLieferant
       If cboLieferant.ListIndex = -1 Then cboLieferant = "Keine Auswahl"
       ALetzte = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
       Set DIC = CreateObject("scripting.dictionary")
       For irow = 2 To ALetzte
           If Not IsEmpty(Sheets("Lieferanten").Cells(irow, 2)) Then
               xKey = VBA.Replace(CStr(Sheets("Lieferanten").Cells(irow, 2).Value), Chr$(13) & Chr$(10), " ")
               DIC(xKey) = 0
           End If
       Next
       cboLieferant.AddItem "Keine Auswahl"
       cbo_Lieferant.AddItem "Alle anzeigen"
       For Each xKey In DIC
           cboLieferant.AddItem xKey
           cbo_Lieferant.AddItem xKey
       Next
       DIC.RemoveAll
       Set DIC = Nothing
       cboLieferant.ListIndex = -1
       cbo_Lieferant.ListIndex = 0
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_Lagerplatz_Change() 'V1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lng, lngID As Long
    Dim strID As String
    On Error Resume Next
    strID = txtID.Value
    Application.ScreenUpdating = False
    If cbo_Lagerplatz = "Hauptlagerplatz" Then
        txt_LPID.Value = ""
        With ThisWorkbook.Sheets("Lager")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AO" & Last_Row)
           ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 1) = CStr(txtID) Then
                    lngID = i
                End If
           Next i
        End With
        lbl_lagerort.Caption = Sheets("Lager").Cells(lngID, 13)
    Else
        For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
            If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz.Text Then
                lbl_lagerort.Caption = ""
                txt_LPID.Value = Sheets("Lagerorte").Cells(lng, 1)
            End If
        Next lng
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_Lieferant_Change()
    On Error Resume Next
    If Not cbo_Lieferant = "Alle anzeigen" Then
        txt_LNr2.Value = Sheets("Lieferanten").Cells(cbo_Lieferant.ListIndex + 1, 1)
        cbo_LVerfuegbar.Visible = False
        lbl_LVerfuegbar.Visible = False
        If lstBestellung.ListCount = 0 Then
            cboLieferant.ListIndex = 0
        End If
    End If
End Sub

Private Sub cboLieferant_Change()
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    If Me.cboLieferant = "Keine Auswahl" Then
        cmd_ShowLieferant.Enabled = False
    Else
        cmd_ShowLieferant.Enabled = True
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Lieferanten")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:D" & Last_Row)
            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ") Like CStr(cboLieferant) Then
                    txt_LNr.Value = arrTmpA(i, 1)
                End If
            Next i
        End With
        Application.ScreenUpdating = True
        Call Liefrei
    End If
End Sub

Private Sub cmd_NeuArtikelBest_Click()
    frmArtikel.txt_Verleih.Value = "Best"
    Call Neu
End Sub

Private Sub cmd_ScanHinZu_Click()
    If txtBestellNR = "" Then
        txtBestellNR.SetFocus
        Exit Sub
    End If
    frmBarcode.txt_BarcodeArt.Value = "bestellung"
    frmBarcode.txt_KasseNr = txtBestellNR.Value
    If Not txtBestellNR = "" Then
        frmBarcode.Caption = "Bestellung" & " (" & txtBestellNR.Value & " ) / Artikel hinzuf|fffd|gen"
    Else
        frmBarcode.Caption = "Bestellung" & " / Artikel hinzuf|fffd|gen"
    End If
    If lstBestellung.ListCount = 0 Then
        frmBarcode.cmd_BCAusbuchen.Caption = "Bestellung" & " erstellen!"
    Else
        frmBarcode.cmd_BCAusbuchen.Caption = "Zur Bestellung" & " / hinzuf|fffd|gen!"
    End If
    frmBarcode.check_HLager.Enabled = False
    frmBarcode.lbl_HLager.Enabled = False
    frmBarcode.check_NBestand.Enabled = False
    frmBarcode.lbl_NBestand.Enabled = False
    frmBarcode.Show
End Sub

Private Sub cmd_ShowLieferant_Click()
    Dim strID, strName As String
    On Error Resume Next
    If Not cboLieferant = "Keine Auswahl" Then
        strID = txt_LNr.Value
        strName = Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(strID, LookIn:=xlValues, MatchCase:=True).Row, 1) & ", " & _
        Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(strID, LookIn:=xlValues, MatchCase:=True).Row, 2)
        frmLieferanten.cboLNr = VBA.Replace(CStr(strName), Chr$(13) & Chr$(10), " ")
        frmLieferanten.Show
    End If
End Sub

Private Sub cmd_Textzeile_Click()
    Dim strMsg As String
    On Error Resume Next
    
    If txtBestellNR.Value = "" Then
        MsgBox "Sie m|fffd|ssen eine Bestellnummer angeben!", vbOKOnly, "Bestellnummer"
        frmBestellung.txtBestellNR.SetFocus
        Exit Sub
    End If
    If lstBestellung.ListCount = 0 Then Exit Sub
    strMsg = InputBox("Geben Sie Ihren Text ein!", "Textzeile hinzuf|fffd|gen")
    If strMsg = "" Then Exit Sub
    Application.ScreenUpdating = False
    With Worksheets("Bestellung")
        If .FilterMode Then .ShowAllData
    End With
    Worksheets("Bestellung").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = "'" & txtBestellNR.Text
    ActiveCell.Offset(0, 1).Value = cboLieferant
    ActiveCell.Offset(0, 2).Value = "TEXT"
    ActiveCell.Offset(0, 3).Value = "-"
    ActiveCell.Offset(0, 4).Value = strMsg
    ActiveCell.Offset(0, 5).Value = ""
    ActiveCell.Offset(0, 7).Value = Date
    ActiveCell.Offset(0, 8).Value = "-"
    ActiveCell.Offset(0, 9).Value = "-"
    If txtvdate.Value = "" Then
        ActiveCell.Offset(0, 10).Value = "k.A."
    Else
        ActiveCell.Offset(0, 10).Value = Format(txtvdate.Value, "DD.MM.YYYY")
    End If
    ActiveCell.Offset(0, 11).Value = txtID
    cboArtikelNR.Value = ""
    lbl_bezeichnung.Caption = ""
    txtstueck.Value = ""
    lbl_herstellerNr.Caption = ""
    lbl_lagerort.Caption = ""
    lstArtikelID.Clear
    Call Bestellsum
    Call SuchenBestellungNeu
    Call Anzeigen
    lstArtikelID.Clear
    MsgBox "Artikel wurde zur Bestellung " + txtBestellNR + " hinzugef|fffd|gt!", vbOKOnly, "Hinweis"
    cboArtikelNR.SetFocus
    Worksheets("Center").Activate
    lbl_status.Visible = False
    Application.ScreenUpdating = True
End Sub

Sub SuchenBegriff() '1.43
    Dim arrTmpA, arrTmpB, i, Last_Row, lngL, n, j As Long
    On Error Resume Next
    lstArtikelID.Clear
    lngL = 0
    Application.ScreenUpdating = False
    If Not cbo_Lieferant = "Alle anzeigen" Then
        lngL = 1
        With ThisWorkbook.Sheets("Lager")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:R" & Last_Row)
           ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If InStr(1, LCase(arrTmpA(i, 6)), LCase(txt_Begriff.Text)) > 0 And arrTmpA(i, 18) = CStr(txt_LNr2.Text) Then
                   n = n + 1
                   arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                   arrTmpB(2, n) = i
                   arrTmpB(3, n) = "HL"
               End If
           Next i
        End With
    Else
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:N" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If InStr(1, LCase(arrTmpA(i, 6)), LCase(txt_Begriff.Text)) > 0 Then
                    n = n + 1
                    arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = "HL"
                End If
            Next i
        End With
    End If
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 3)
        For i = 1 To 3
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With lstArtikelID
           .ColumnCount = 3
           .ColumnWidths = "100;0;0"
           .List = arrTmpA
        End With
    Else
        If lngL = 1 Then
            MsgBox "Suchbegriff: (" + txt_Begriff.Value + ") f|fffd|r den Lieferanten (" & cbo_Lieferant & ") nicht gefunden!", vbOKOnly, "Suchabfrage"
        Else
            MsgBox "Suchbegriff: (" + txt_Begriff.Value + ") nicht gefunden!", vbOKOnly, "Suchabfrage"
        End If
        txt_Begriff.SetFocus
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub list_AlleBest_Click()
    cboVAuftrag = list_AlleBest
    lbl_status.Visible = False
End Sub

Sub Liefrei() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, lngID, irow As Long
    Dim strID As String
    On Error Resume Next
    Application.ScreenUpdating = False
    lbl_Betrag.Caption = Format(CDbl(0#), "currency")
    If cbo_Lieferant = "Alle anzeigen" Then
        strID = CStr(txt_LNr.Value)
    Else
        strID = CStr(txt_LVerfuegbar.Value)
    End If
    With ThisWorkbook.Sheets("Lieferanten")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(strID) Then
                lngID = i
            End If
        Next i
    End With
    If cboLieferant = "Keine Auswahl" Or cboLieferant = "" Then
        lbl_Versand.Caption = ""
        lbl_Versand2.Caption = ""
        txt_versandK.Value = ""
        lbl_MZuschlag.Caption = ""
        txt_Mzuschlag.Value = ""
        Application.ScreenUpdating = True
        Exit Sub
    End If
    If txt_LNr.Value = "" Then Exit Sub
    If lstBestellung.ListCount = 0 Then
        If Not Sheets("Lieferanten").Cells(CDbl(lngID), 22) = "" Then
            lbl_Versand.Visible = True
            lbl_Versand.Caption = "Versandkosten frei ab: " & Sheets("Lieferanten").Cells(CDbl(lngID), 22)
            lbl_Versand.ForeColor = &H8000&
        Else
            lbl_Versand.Visible = False
        End If
        If Not Sheets("Lieferanten").Cells(CDbl(lngID), 21) = "" Then
            lbl_Versand2.Visible = True
            lbl_Versand2.Caption = "Versandkosten: " & Sheets("Lieferanten").Cells(CDbl(lngID), 21)
            lbl_Versand2.ForeColor = &HFF&
        Else
            lbl_Versand2.Visible = False
        End If
        If Not Sheets("Lieferanten").Cells(CDbl(lngID), 27) = "" Then
            lbl_MZuschlag.Visible = True
            lbl_MZuschlag.Caption = "Mindermengenzuschlag: " & Format(Sheets("Lieferanten").Cells(CDbl(lngID), 28), "currency") & " (Frei ab: " & Format(Sheets("Lieferanten").Cells(CDbl(lngID), 27), "currency") & ")"
            txt_Mzuschlag.Value = Sheets("Lieferanten").Cells(CDbl(lngID), 28)
            lbl_MZuschlag.ForeColor = &HFF&
        Else
            lbl_MZuschlag.Visible = False
            txt_Mzuschlag.Value = ""
        End If
        GoTo weiter2:
    End If
    If lstBestellung.ListCount > 0 Then
        lbl_Versand.Caption = "Versandkosten frei ab: " & Sheets("Lieferanten").Cells(CDbl(lngID), 22)
        lbl_Versand2.Caption = "Versandkosten: " & Sheets("Lieferanten").Cells(CDbl(lngID), 21)
        lbl_Versand.ForeColor = &HFF&
        lbl_Versand2.ForeColor = &HFF&
    End If
    txt_versandK.Value = ""
    txt_Mzuschlag.Value = ""
    If Not Sheets("Lieferanten").Cells(CDbl(lngID), 22) = "" Then
        If CDbl(txtBsum.Value) >= CDbl(Sheets("Lieferanten").Cells(CDbl(lngID), 22)) Then
            lbl_Versand.Caption = "Versandkosten frei ab: " & Sheets("Lieferanten").Cells(CDbl(lngID), 22)
            lbl_Versand.ForeColor = &H8000&
            lbl_Versand2.Caption = "Versandkosten: " & Format(0, "currency")
            lbl_Versand2.ForeColor = &H8000&
        Else
            lbl_Versand.Caption = "Versandkosten frei ab: " & Sheets("Lieferanten").Cells(CDbl(lngID), 22)
            lbl_Versand.ForeColor = &HFF&
            If Not Sheets("Lieferanten").Cells(CDbl(lngID), 21) = "" Then
                lbl_Versand2.Caption = "Versandkosten: " & Sheets("Lieferanten").Cells(CDbl(lngID), 21)
                lbl_Versand2.ForeColor = &HFF&
                txt_versandK.Value = CDbl(Sheets("Lieferanten").Cells(CDbl(lngID), 21))
            Else
                lbl_Versand2.Caption = ""
                txt_versandK.Value = ""
            End If
        End If
        GoTo weiter:
    Else
        lbl_Versand.Caption = ""
        txt_versandK.Value = ""
    End If
    If Not Sheets("Lieferanten").Cells(CDbl(lngID), 21) = "" Then
        lbl_Versand2.Caption = "Versandkosten: " & Sheets("Lieferanten").Cells(CDbl(lngID), 21)
        lbl_Versand2.ForeColor = &HFF&
        txt_versandK.Value = CDbl(Sheets("Lieferanten").Cells(CDbl(lngID), 21))
    Else
        lbl_Versand2.Caption = ""
        txt_versandK.Value = ""
    End If
weiter:
    If Not Sheets("Lieferanten").Cells(CDbl(lngID), 27) = "" Then
        If CDbl(txtBsum.Value) >= CDbl(Sheets("Lieferanten").Cells(CDbl(lngID), 27)) Then
            lbl_MZuschlag.Caption = ""
            txt_Mzuschlag.Value = ""
        Else
            lbl_MZuschlag.Caption = "Mindermengenzuschlag: " & Format(Sheets("Lieferanten").Cells(CDbl(lngID), 28), "currency") & " (Frei ab: " & Format(Sheets("Lieferanten").Cells(CDbl(lngID), 27), "currency") & ")"
            txt_Mzuschlag.Value = Sheets("Lieferanten").Cells(CDbl(lngID), 28)
            lbl_MZuschlag.ForeColor = &HFF&
        End If
    Else
        lbl_MZuschlag.Caption = ""
        txt_Mzuschlag.Value = ""
    End If
weiter2:
    Application.ScreenUpdating = True
End Sub

Private Sub txt_Begriff_Change()
    If Not txt_Begriff = "" Then
        If txt_Begriff.TextLength > 2 Then
            Call SuchenBegriff
        Else
            lstArtikelID.Clear
        End If
    End If
End Sub

Sub BeList()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    cboVAuftrag.Clear
    list_AlleBest.Clear
    With cboVAuftrag
        If cboVAuftrag.ListIndex = -1 Then cboVAuftrag.Value = "Keine vorhanden"
        ALetzte = Sheets("Bestellung").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not IsEmpty(Sheets("Bestellung").Cells(irow, 1)) Then
                xKey = Sheets("Bestellung").Cells(irow, 1).Value
                DIC(xKey) = 0
            End If
        Next
        cboVAuftrag.AddItem ""
        For Each xKey In DIC
            cboVAuftrag.AddItem xKey
            list_AlleBest.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cboVAuftrag.ListIndex = -1
    End With
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Schlie|fffd|en"" beenden!", , "Hinweis"
        cmdBeenden.SetFocus
        Cancel = True
    End If
End Sub

Sub ArtikelCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    
    cboArtikelNR.Clear
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
      objDic(Sheets("Lager").Cells(lngZ, 3).Value) = 0
    Next
    cboArtikelNR.List = objDic.keys
    Set objDic = Nothing
End Sub
        
Private Sub txtBestellNr_Change()
    If txtBestellNR = "" Then
        txtvdate.Value = ""
        lstBestellung.Clear
        cmdAEMenge.Enabled = False
        cmdloeschen.Enabled = False
        lbl_status.Visible = False
        Call Anzeigen
        Call BPreis
    End If
End Sub

Private Sub cbo_Lieferant_DropButtonClick()
    Dim irow, ALetzte, ALetzte2, xrow As Long
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    If Not cbo_Lieferant = "Alle anzeigen" Then
        txt_LNr2.Value = Sheets("Lieferanten").Cells(cbo_Lieferant.ListIndex + 1, 1)
    Else
        txt_LNr2.Value = ""
    End If
    cboArtikelNR.Clear
    Application.ScreenUpdating = False
    If Not cbo_Lieferant = "Alle anzeigen" Then
        With cboArtikelNR
            If cboArtikelNR.ListIndex = -1 Then cboArtikelNR.Value = "Kein Artikel vorhanden"
            ALetzte = Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
            Set DIC = CreateObject("scripting.dictionary")
            For irow = 2 To ALetzte
                If Not IsEmpty(Sheets("Lager").Cells(irow, 3)) Then
                    If cbo_Lieferant = "Alle anzeigen" Then
                        xKey = Sheets("Lager").Cells(irow, 3)
                        DIC(xKey) = 0
                    ElseIf Sheets("Lager").Cells(irow, 18) = CStr(txt_LNr2) Then
                        xKey = Sheets("Lager").Cells(irow, 3)
                        DIC(xKey) = 0
                    End If
                End If
            Next
            ALetzte2 = Sheets("VPEinheit").Cells(Rows.Count, 1).End(xlUp).Row
            For irow = 2 To ALetzte2
                If Not IsEmpty(Sheets("VPEinheit").Cells(irow, 3)) Then
                    If Sheets("VPEinheit").Cells(irow, 10) = CStr(txt_LNr2) Then
                        With ThisWorkbook.Sheets("Lager")
                            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                            arrTmpA = .Range("A1:N" & Last_Row)
                            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
                            For i = 2 To UBound(arrTmpA)
                                If arrTmpA(i, 1) = Sheets("VPEinheit").Cells(irow, 2) Then
                                    xrow = i
                                End If
                            Next i
                        End With
                        xKey = Sheets("Lager").Cells(xrow, 3)
                        DIC(xKey) = 0
                    End If
                End If
            Next
            For Each xKey In DIC
                cboArtikelNR.AddItem xKey
            Next
            DIC.RemoveAll
            Set DIC = Nothing
            cboArtikelNR.ListIndex = -1
        End With
    Else
        Call ArtikelCombo
    End If
    Application.ScreenUpdating = True
End Sub

Sub LVerfuegbar() '1.44
    Dim irow, ALetzte, xrow, arrTmpA, arrTmpB, i, Last_Row, lngL, n, j As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    If Not cbo_Lieferant = "Alle anzeigen" Then Exit Sub
    cbo_LVerfuegbar.Visible = True
    lbl_LVerfuegbar.Visible = True
    cbo_LVerfuegbar.Clear
    Application.ScreenUpdating = False
    With cbo_LVerfuegbar
        ALetzte = Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not Sheets("Lager").Cells(irow, 1) = "" And Sheets("Lager").Cells(irow, 1) = CStr(txtID) Then
                xrow = xFind(ActiveWorkbook.Name, "Lieferanten", CStr(Sheets("Lager").Cells(irow, 18)), "A:A")
                xKey = VBA.Replace(CStr(Sheets("Lieferanten").Cells(xrow, 2)), Chr$(13) & Chr$(10), " ")
                DIC(xKey) = 0
            End If
        Next
        With ThisWorkbook.Sheets("VPEinheit")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:O" & Last_Row)
            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) Like CStr(txtID) And arrTmpA(i, 14) = "VP-WL" Then
                    xKey = arrTmpA(i, 11)
                    DIC(xKey) = 0
                End If
            Next i
        End With
        For Each xKey In DIC
            cbo_LVerfuegbar.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_LVerfuegbar.ListIndex = 0
        If cbo_LVerfuegbar = "" Then
            cbo_LVerfuegbar.Visible = False
            lbl_LVerfuegbar.Visible = False
        End If
    End With
    Application.ScreenUpdating = True
End Sub

Sub Anzeigen()
    Dim listenwert As Long
    Dim blnMarkiert As Boolean
    On Error Resume Next
    For listenwert = 0 To lstBestellung.ListCount - 1
        If lstBestellung.Selected(listenwert) Then
            blnMarkiert = True
            cmdloeschen.Enabled = True
            cmdAEMenge.Enabled = True
            Exit For
        Else
            cmdloeschen.Enabled = False
            cmdAEMenge.Enabled = False
        End If
    Next listenwert
    If txtBestellNR.Value = "" Then
        cmdBSpeichernDrucken.Enabled = False
        cmdBstorno.Enabled = False
        cmdPDFsave.Enabled = False
        cmdLieferdatum.Enabled = False
    Else
        cmdBSpeichernDrucken.Enabled = True
        cmdBstorno.Enabled = True
        cmdPDFsave.Enabled = True
        cmdLieferdatum.Enabled = True
    End If
End Sub

Private Sub lstArtikelID_Click() '1.44
    Dim lngZeile, lng, lngg, lngZeile2, xrow As Long
    Dim arrTmpA, arrTmpB, i, Last_Row, lngL As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    Application.ScreenUpdating = False
    lngZeile = lstArtikelID.Column(1)
    txt_LArt.Value = lstArtikelID.Column(2)
    If lstArtikelID.Column(2) = "VP" Then
        lngZeile2 = lstArtikelID.Column(1)
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:N" & Last_Row)
            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 1) = CStr(Me.txtID) Then
                    xrow = i
                End If
            Next i
        End With
        lbl_itemnumber.Caption = Sheets("Lager").Cells(xrow, 3).Value & "-1" & Sheets("VPEinheit").Cells(lngZeile2, 3).Value
        lbl_bezeichnung.Caption = lstArtikelID.Column(0)
        lbl_herstellerNr.Caption = Sheets("VPEinheit").Cells(lngZeile2, 9).Value
        txt_LNr2.Value = Sheets("Lager").Cells(xrow, 18).Value
        lbl_Einheit = Sheets("VPEinheit").Cells(lngZeile2, 5).Value
        If Not Sheets("VPEinheit").Cells(lngZeile2, 12).Value = "" Then
            txt_BEK.Value = Format(Sheets("VPEinheit").Cells(lngZeile2, 12).Value, "currency")
        Else
            txt_BEK.Value = ""
        End If
        txtpreis.Value = CDbl(Sheets("VPEinheit").Cells(lngZeile, 13).Value) * CDbl(Sheets("VPEinheit").Cells(lngZeile2, 3).Value)
        txt_zeile = lngZeile2
        txt_VPMenge = Sheets("VPEinheit").Cells(lngZeile2, 3).Value
    Else
        lbl_itemnumber.Caption = Sheets("Lager").Cells(lngZeile, 3).Value
        lbl_bezeichnung.Caption = Sheets("Lager").Cells(lngZeile, 6).Value
        lbl_herstellerNr.Caption = Sheets("Lager").Cells(lngZeile, 4).Value
        lbl_Einheit.Caption = Sheets("Lager").Cells(lngZeile, 12).Value
        lbl_lagerort.Caption = Sheets("Lager").Cells(lngZeile, 13).Value
        txt_LNr2.Value = Sheets("Lager").Cells(lngZeile, 18).Value
        If cbo_Lieferant = "Alle anzeigen" Then
            txt_BEK.Value = Format(Sheets("Lager").Cells(lngZeile, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(lngZeile, 14).Value
        Else
            If Sheets("Lager").Cells(lngZeile, 18).Value = "" Then
                txt_BEK.Value = Format(Sheets("Lager").Cells(lngZeile, 14).Value, "currency")
                txtpreis.Value = Sheets("Lager").Cells(lngZeile, 14).Value
            ElseIf CStr(Sheets("Lager").Cells(lngZeile, 18)) = CStr(txt_LNr2) Then
                txt_BEK.Value = Format(Sheets("Lager").Cells(lngZeile, 14).Value, "currency")
                txtpreis.Value = Sheets("Lager").Cells(lngZeile, 14).Value
            Else
                With ThisWorkbook.Sheets("VPEinheit")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:N" & Last_Row)
                    ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If arrTmpA(i, 2) = CStr(Me.txtID) And arrTmpA(i, 10) = CStr(txt_LNr2) And arrTmpA(i, 14) = "VP-WL" Then
                            xrow = i
                        End If
                    Next i
                End With
                If xrow > 0 Then
                    txt_BEK.Value = Format(Sheets("VPEinheit").Cells(xrow, 14), "currency")
                    txtpreis.Value = Sheets("VPEinheit").Cells(xrow, 14)
                End If
            End If
        End If
        txtID.Value = Sheets("Lager").Cells(lngZeile, 1).Value
        txt_zeile = lngZeile
        txt_VPMenge = ""
    End If
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        cbo_Lagerplatz.Enabled = True
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        For Each xKey In DIC
            cbo_Lagerplatz.AddItem xKey
        Next
        cbo_Lagerplatz.ListIndex = 0
        DIC.RemoveAll
        Set DIC = Nothing
    Else
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.Enabled = False
    End If
    txt_BarcodeBst.Value = Sheets("Lager").Cells(lngZeile, 31).Value
    txt_zeile = lngZeile
    If lbl_lagerort = "" Then
        lbl_lagerort.Caption = "Kein Lagerort zugewiesen!"
    End If
    Application.ScreenUpdating = True
    txtstueck.SetFocus
End Sub

Private Sub lstBestellung_Click()
    On Error Resume Next
    If lstBestellung.Column(0) = "TEXT" Then Exit Sub
    txtIDBup.Value = lstBestellung.Column(8)
    If Not IsNumeric(lstBestellung.Column(3)) Then
        txtMBup.Value = CDbl(Left(lstBestellung.Column(3), InStr(lstBestellung.Column(3), " ") - 1))
    Else
        txtMBup.Value = CDbl(lstBestellung.Column(3))
    End If
    Call Anzeigen
End Sub

Private Sub cmdLieferdatum_Click()
    On Error Resume Next
    If txtBestellNR.Value = "" Then Exit Sub
    If lstBestellung.ListCount = 0 Then
        MsgBox "Es befindet sich keine Bestellung in der Liste!", , "Hinweis"
        Exit Sub
    End If
    frmKalender.txt_UID.Value = "BSTLD"
    frmKalender.Show
End Sub

Private Sub cmdAEMenge_Click()
    Dim lng, listenwert As Long
    Dim blnMarkiert As Boolean
    Dim lngMsg As String
    Dim sWert, sWert1 As Double
    On Error Resume Next
    lng = lstBestellung.Column(7) 'Zeileninfo
    If Sheets("Bestellung").Cells(lng, 3).Value = "TEXT" Then Exit Sub
    For listenwert = 0 To lstBestellung.ListCount - 1
        If lstBestellung.Selected(listenwert) Then
            blnMarkiert = True
            Exit For
        End If
    Next listenwert
    If blnMarkiert = False Then
        MsgBox "Es wurde kein Artikel in der Liste makiert!", _
        vbExclamation, "Achtung!"
        Exit Sub
    End If
    lngMsg = InputBox("Bitte geben Sie eine neue Menge an!", "Bestellmenge |fffd|ndern")
    If lngMsg = "" Then Exit Sub
    If Not IsNumeric(lngMsg) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        Exit Sub
    End If
    lbl_status.Visible = True
    lbl_status.Caption = "Die Menge wurde auf: (" & lngMsg & ") ge|fffd|ndert: " & Me.txtBestellNR
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    Application.Wait (Now + TimeValue("00:00:01"))
    lng = lstBestellung.Column(7) 'Zeileninfo
    If Not Sheets("Bestellung").Cells(lng, 16) = "" Then
        sWert = CDbl(Sheets("Bestellung").Cells(lng, 17) / Sheets("Bestellung").Cells(lng, 6))
        sWert1 = CDbl(Sheets("Bestellung").Cells(lng, 6))
        Sheets("Bestellung").Cells(lng, 17).Value = CDbl(sWert * lngMsg)
        Sheets("Bestellung").Cells(lng, 6).Value = CDbl(lngMsg)
        Sheets("Bestellung").Cells(lng, 9).Value = CDbl(lngMsg * Sheets("Bestellung").Cells(lng, 10).Value)
    Else
        Sheets("Bestellung").Cells(lng, 6).Value = lngMsg
        Sheets("Bestellung").Cells(lng, 9).Value = CDbl(lngMsg) * Sheets("Bestellung").Cells(lng, 10)
    End If
    Call Bestellsum
    Call SuchenBestellungNeu
    Call Liefrei
    Application.Wait (Now + TimeValue("00:00:01"))
    lbl_status.Visible = False
End Sub

Private Sub cmdPDFsave_Click()
    lbl_status.Caption = "Bestellung: " & txtBestellNR & " als PDF - Dokument speichern!"
    lbl_status.Visible = True
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    txt_OpBestellung.Value = "PDF"
    frmMitarbeiter.comDrucken.Caption = "Speichern (.pdf)"
    Call DBestellung
End Sub

Private Sub cmdBSpeichernDrucken_Click()
    lbl_status.Caption = "Bestellung: " & txtBestellNR & " wird gedruckt!"
    lbl_status.Visible = True
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    txt_OpBestellung.Value = "Print"
    frmMitarbeiter.comMitarbeiter = frmLager.lbl_Benutzer
    frmMitarbeiter.comDrucken.Caption = "Drucken"
    Call DBestellung
End Sub

Function DBestellung() 'v1.39
    If ThisWorkbook.Sheets("Bestellung").Visible = xlSheetVisible Then
        If txtBestellNR.Value = "" Then
            MsgBox "Sie m|fffd|ssen eine Bestellnummer eingeben!", vbOKOnly, "PDF speichern"
            frmBestellung.cboVAuftrag.SetFocus
            Exit Function
        Else
            frmMitarbeiter.Show
        End If
    Else
        ThisWorkbook.Sheets("Bestellung").Visible = xlSheetVisible
        If txtBestellNR.Value = "" Then
            MsgBox "Sie m|fffd|ssen eine Bestellnummer eingeben!", vbOKOnly, "PDF speichern"
            frmBestellung.cboVAuftrag.SetFocus
            Exit Function
        Else
            frmMitarbeiter.Show
        End If
        ThisWorkbook.Sheets("Bestellung").Visible = xlSheetVeryHidden
    End If
End Function

Private Sub cmdBstorno_Click() 'V1.30
    Dim lngIndex, lngLine, plng, pRow, z, lngrow As Long
    Dim objLines, objItems As Collection
    Dim strArticle, i As String
    Dim dblAnzahl As Double
    Dim arrTmpA, arrTmpB, i2, Last_Row As Long
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If txtBestellNR.Value = "" Then
        MsgBox "Sie m|fffd|ssen erst eine Bestellung ausw|fffd|hlen!", vbOKOnly, "Bestellung stornieren"
        cboVAuftrag.SetFocus
        Exit Sub
    End If
    With Worksheets("Bestellung")
        If .FilterMode Then .ShowAllData
    End With
    i = MsgBox("M|fffd|chten Sie die Bestellung (" + txtBestellNR.Text + ") wirklich l|fffd|schen?", vbYesNo + vbQuestion, "Info")
    If i = vbYes Then
        Application.ScreenUpdating = False
        Set objLines = New Collection
        Set objItems = New Collection
        With ThisWorkbook.Worksheets("Lager")
            For lngIndex = 0 To lstBestellung.ListCount - 1
                strArticle = lstBestellung.List(lngIndex, 8)
                dblAnzahl = 0
                lngLine = 0
                plng = 0
                With ThisWorkbook.Sheets("Lager")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i2 = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i2, 1) = "" And arrTmpA(i2, 1) = CStr(strArticle) Then
                            lngLine = i2
                        End If
                    Next i2
                End With
                If lngLine > 0 Then
                    plng = lstBestellung.Column(7, lngIndex)
                    For lngrow = 2 To Worksheets("Bestellung").Cells(Rows.Count, 6).End(xlUp).Row
                        If Worksheets("Bestellung").Cells(lngrow, 12).Text = Worksheets("Lager").Cells(lngLine, 1).Text Then
                            dblAnzahl = CDbl(dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 6))
                        End If
                    Next lngrow
                    If dblAnzahl - CDbl(Worksheets("Bestellung").Cells(plng, 6)) = 0 Then
                        Worksheets("Lager").Cells(lngLine, 9).Value = ""
                    End If
                    objLines.Add lstBestellung.List(lngIndex, 1)
                    objItems.Add CStr(lngIndex)
                End If
            Next
        End With
        For z = lstBestellung.ListCount To 1 Step -1
            pRow = lstBestellung.Column(7, z - 1)
            Sheets("Bestellung").Rows(pRow).Delete
        Next
        lstBestellung.Clear
        txtvdate.Value = ""
        txtBestellNR.Value = ""
        cboVAuftrag.Clear
        list_AlleBest.Clear
        UserForm_Initialize
        Set objLines = Nothing
        Set objItems = Nothing
        Application.ScreenUpdating = True
    Else
        Exit Sub
    End If
End Sub

Private Sub cmdloeschen_Click() '1.44
    Dim lng, xrow, listenwert, lngrow, n As Long
    Dim blnMarkiert  As Boolean
    Dim dblAnzahl As Double
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    Dim SuchKriterium As String
    Dim strgBez As String
    On Error Resume Next
    For listenwert = 0 To lstBestellung.ListCount - 1
        If lstBestellung.Selected(listenwert) Then
            blnMarkiert = True
            Exit For
        End If
    Next listenwert
    If blnMarkiert = False Then
        MsgBox "Es wurde kein Artikel in der Liste makiert!", vbExclamation, "Hinweis!"
        Exit Sub
    End If
    With Worksheets("Bestellung")
        If .FilterMode Then .ShowAllData
    End With
    If txtBestellNR.Value = "" Then Exit Sub
    strgBez = lstBestellung.Column(2)
    Application.ScreenUpdating = False
    dblAnzahl = 0
    SuchKriterium = CStr(lstBestellung.Column(8))
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:N" & Last_Row)
       ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If LCase(arrTmpA(i, 1)) Like SuchKriterium Then
               xrow = i
           End If
       Next i
    End With
    For lngrow = 1 To Worksheets("Bestellung").Cells(Rows.Count, 6).End(xlUp).Row
        If Worksheets("Bestellung").Cells(lngrow, 12).Text = Worksheets("Lager").Cells(xrow, 1).Text Then
            dblAnzahl = dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 6)
        End If
    Next
    If dblAnzahl - txtMBup.Value = 0 Then
        Worksheets("Lager").Cells(xrow, 9) = ""
    End If
    Application.ScreenUpdating = True
    lng = lstBestellung.Column(7)
    Sheets("Bestellung").Rows(lng).Delete
    Call Bestellsum
    Call SuchenBestellungNeu
    Call Liefrei
    lbl_status.Caption = "Artikel: (" & strgBez & ") wurde aus der Bestellung: " & Me.txtBestellNR & " gel|fffd|scht!"
    lbl_status.BackColor = &HC0&
    lbl_status.BorderColor = &HC0&
    lbl_status.Visible = True
End Sub

Private Sub cboVAuftrag_Click()
    If cboVAuftrag = "" Then
        cboLieferant.ListIndex = 0
    End If
    Call uebernehmen
    Call Bestellsum
    Call Anzeigen
End Sub

Private Sub cmdhinzu_Click() 'v1.44
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2, lngL2, wert, Wert2 As Long
    Dim arrTmpA, arrTmpB, i, lngS, Last_Row, lng As Long
    Dim stxt, strL, strNr, strF, strM As String
    Dim sWert, sWert2, sWert3 As Double
    Dim lng2, xrow, rz As Long
    On Error Resume Next
    If txtBestellNR.Value = "" Then
        MsgBox "Sie m|fffd|ssen eine Bestellnummer angeben!", vbOKOnly, "Bestellnummer"
        frmBestellung.txtBestellNR.SetFocus
        Exit Sub
    End If
    If txtstueck.Value = "" Then
        MsgBox "Sie m|fffd|ssen eine Menge angeben!", vbOKOnly, "Menge"
        frmBestellung.txtstueck.SetFocus
        Exit Sub
    End If
    If Not IsNumeric(txtstueck.Value) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        txtstueck.Value = ""
        txtstueck.SetFocus
        Exit Sub
    End If
    wert = 0
    Wert2 = 0
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA2 = .Range("A1:AA" & Last_Row2)
        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
        For i2 = 2 To UBound(arrTmpA2)
            If CStr(arrTmpA2(i2, 1)) = CStr(txtID) And arrTmpA2(i2, 18) = CStr(txt_LNr) Then
               wert = wert + 1
            End If
        Next i2
    End With
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA2 = .Range("A1:P" & Last_Row2)
        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
        For i2 = 2 To UBound(arrTmpA2)
            If arrTmpA2(i2, 2) = Me.txtID And arrTmpA2(i2, 10) = CStr(txt_LNr) And arrTmpA2(i2, 14) = "VP-WL" Then
                Wert2 = Wert2 + 1
            End If
        Next i2
    End With
    If wert + Wert2 = 0 And Not cboLieferant = "Keine Auswahl" Then
        If Not cbo_Lieferant = "Alle anzeigen" Then
            If Not cboLieferant = cbo_LVerfuegbar Then
                strM = MsgBox("M|fffd|chten den Lieferanten (" & cboLieferant & ") dem Artikel: " & lbl_itemnumber & " zuordnen?", vbYesNo, "Weiterer Lieferant")
                If strM = vbYes Then
                    Call BWLieferant
                End If
            End If
        Else
            strM = MsgBox("M|fffd|chten den Lieferanten (" & cboLieferant & ") dem Artikel hinzuf|fffd|gen?", vbYesNo, "Weiterer Lieferant")
            If strM = vbYes Then
                Call BWLieferant
            End If
        End If
    End If
    If txt_zeile = "" Then
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AP" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) And Not arrTmpA(i, 42) = "" Then
                    MsgBox "Artikel ist gesperrt!", , "Hinweis"
                    Application.ScreenUpdating = False
                    Exit Sub
                End If
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                    xrow = i
                End If
            Next i
        End With
    Else
        xrow = CLng(txt_zeile.Value)
        If Not Worksheets("Lager").Cells(xrow, 42) = "" Then
            MsgBox "Artikel ist gesperrt!", , "Hinweis"
            Application.ScreenUpdating = False
            Exit Sub
        End If
    End If
    Worksheets("Lager").Cells(xrow, 9).Font.ColorIndex = 10
    Worksheets("Lager").Cells(xrow, 9) = "Bestellt"
    If cboLieferant = "Keine Auswahl" Or cboLieferant = "" Then
        If Not cbo_Lieferant = "Alle anzeigen" Then
            If Not Worksheets("Lager").Cells(xrow, 18) = "" Then
                strL = MsgBox("M|fffd|chten Sie bei " & cbo_Lieferant & " bestellen?", vbYesNo, "Hinweis")
                If strL = vbNo Then
                    GoTo weiter:
                Else
                    cboLieferant = cbo_Lieferant
                End If
            End If
        Else
            If Not cbo_LVerfuegbar = "" Then
                strL = MsgBox("M|fffd|chten Sie bei " & cbo_LVerfuegbar & " bestellen?", vbYesNo, "Hinweis")
                If strL = vbNo Then
                    GoTo weiter:
                Else
                    cboLieferant = cbo_LVerfuegbar
                End If
            End If
        End If
    End If
weiter:
    Application.ScreenUpdating = True
    If xrow = False Then
        MsgBox "Artikel nicht gefunden!", vbInformation, "Hinweis"
        Exit Sub
    End If
    With Worksheets("Bestellung")
        If .FilterMode Then .ShowAllData
    End With
    If frmBestellung.lstBestellung.ListCount = 0 Then
        If Sheets("Daten").Range("D39") = "Auswahl 1" Then
            strF = Sheets("Daten").Range("D42")
            strNr = Sheets("Daten").Range("D41") + 1
            If CStr(frmBestellung.txtBestellNR) = CStr((Sheets("Daten").Range("D40") & Format(CDbl(strNr), strF))) Then
                If Sheets("Daten").Range("D39").Value = "Auswahl 1" Then
                    Sheets("Daten").Range("D41") = "'" & Format(CDbl(strNr), strF)
                End If
            End If
        End If
    End If
    For lng2 = 2 To Sheets("Bestellung").UsedRange.Rows.Count
        If Sheets("Bestellung").Cells(lng2, 12) = LCase(txtID) And Sheets("Bestellung").Cells(lng2, 1) = txtBestellNR.Value And CStr(lbl_itemnumber) = CStr(Sheets("Bestellung").Cells(lng2, 3)) Then
            rz = Sheets("Bestellung").Cells(lng2, 12).Row
            stxt = MsgBox("Artikel wurde bereits hinzugef|fffd|gt. M|fffd|chten Sie die Menge |fffd|ndern?", vbYesNo, "Hinweis")
            If stxt = vbNo Then
                Exit Sub
            Else
                sWert = InputBox("Bitte geben Sie die neue Gesamtbestellmenge an!", "Bestellmenge |fffd|ndern", CDbl(txtstueck + Sheets("Bestellung").Cells(lng2, 6)))
                If Not sWert = "" Then
                    If Not Me.txt_VPMenge = "" Then
                        sWert2 = CDbl(Sheets("Bestellung").Cells(CLng(rz), 17) / Sheets("Bestellung").Cells(CLng(rz), 6))
                        sWert3 = CDbl(Sheets("Bestellung").Cells(CLng(rz), 6))
                        Sheets("Bestellung").Cells(CLng(rz), 6).Value = sWert
                        Sheets("Bestellung").Cells(CLng(rz), 9).Value = Sheets("Bestellung").Cells(CLng(rz), 10).Value * sWert
                        Sheets("Bestellung").Cells(CLng(rz), 17).Value = CDbl(sWert2 * sWert)
                    Else
                        Sheets("Bestellung").Cells(CLng(rz), 6).Value = sWert
                        Sheets("Bestellung").Cells(CLng(rz), 9).Value = CDbl(sWert) * Sheets("Bestellung").Cells(CLng(rz), 10)
                    End If
                    Call Bestellsum
                    Call SuchenBestellungNeu
                    Exit Sub
                Else
                    Exit Sub
                End If
            End If
        End If
    Next lng2
    Application.ScreenUpdating = False
    Worksheets("Bestellung").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = "'" + txtBestellNR.Text
    ActiveCell.Offset(0, 1).Value = cboLieferant.Text
    ActiveCell.Offset(0, 3).Value = "'" + lbl_herstellerNr.Caption
    ActiveCell.Offset(0, 2).Value = "'" + lbl_itemnumber
    ActiveCell.Offset(0, 4).Value = lbl_bezeichnung.Caption
    ActiveCell.Offset(0, 5).Value = txtstueck.Value
    ActiveCell.Offset(0, 6).Value = lbl_lagerort.Caption
    ActiveCell.Offset(0, 7).Value = Date
    If Not Me.txt_VPMenge = "" Then
        ActiveCell.Offset(0, 8).Value = (CDbl(txtstueck.Value) * CDbl(Me.txt_VPMenge)) * CStr(Worksheets("VPEinheit").Cells(lstArtikelID.Column(1), 13))
        ActiveCell.Offset(0, 14).Value = lbl_Einheit
        ActiveCell.Offset(0, 15).Value = CStr(Worksheets("VPEinheit").Cells(lstArtikelID.Column(1), 1))
        ActiveCell.Offset(0, 16).Value = CDbl(txtstueck.Value) * CDbl(Me.txt_VPMenge)
    Else
        ActiveCell.Offset(0, 8).Value = CDbl(txtstueck.Value) * CDbl(txtpreis)
        ActiveCell.Offset(0, 14).Value = Worksheets("Lager").Cells(xrow, 12)
    End If
    ActiveCell.Offset(0, 9).Value = CDbl(txtpreis)
    If txtvdate.Value = "" Then
        ActiveCell.Offset(0, 10).Value = "k.A."
    Else
        ActiveCell.Offset(0, 10).Value = txtvdate.Value
    End If
    ActiveCell.Offset(0, 11).Value = txtID
    ActiveCell.Offset(0, 12).Value = "'" & txt_BarcodeBst.Value
    ActiveCell.Offset(0, 13).Value = txt_LPID.Value
    ActiveCell.Offset(0, 15).Value = CStr(Worksheets("VPEinheit").Cells(lstArtikelID.Column(1), 1))
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    lbl_status.Caption = "Artikel (" & lbl_bezeichnung & ") wurde zur Bestellung " + txtBestellNR + " hinzugef|fffd|gt!"
    lbl_status.Visible = True
    cboArtikelNR.Value = ""
    lbl_bezeichnung.Caption = ""
    lbl_itemnumber.Caption = ""
    txtstueck.Value = ""
    txt_Begriff.Value = ""
    lbl_herstellerNr.Caption = ""
    lbl_lagerort.Caption = ""
    txt_BEK.Value = ""
    cbo_LVerfuegbar.Clear
    cbo_LVerfuegbar.Visible = False
    lbl_LVerfuegbar.Visible = False
    lstArtikelID.Clear
    lstArtikelID.Clear
    Call SuchenBestellungNeu
    Call Anzeigen
    Call Liefrei
    Call BeList
    txt_zeile.Value = ""
    cboArtikelNR.SetFocus
    Worksheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Sub BWLieferant()
    Dim MaxID, z, zeile, LRow, letztezeile, wert, xrow As Long
    On Error Resume Next
    If txt_BEK.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    Sheets("Lagerorte").Activate
    LRow = CLng(Sheets("VPEinheit").Cells(Rows.Count, 1).End(xlUp).Row) + 1
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    MaxID = 0
    For z = 2 To letztezeile
        If CDbl(Cells(z, 1)) > MaxID Then
            MaxID = CDbl(Cells(z, 1))
        End If
    Next
    If Sheets("Daten").Cells(43, 4) = "" Or Sheets("Daten").Cells(43, 4) = 0 Then
        If CDbl(MaxID) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(43, 4).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(MaxID) > CDbl(Sheets("Daten").Cells(43, 4).Value) Then
            zeile = CDbl(MaxID) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(MaxID) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
        End If
    End If
    Sheets("VPEinheit").Cells(LRow, 1) = "'" & CStr(zeile) 'VP-ID
    Sheets("VPEinheit").Cells(LRow, 2) = "'" & CStr(txtID)
    Sheets("VPEinheit").Cells(LRow, 3) = 1
    Sheets("VPEinheit").Cells(LRow, 4) = "'" & CStr(lbl_Einheit)
    Sheets("VPEinheit").Cells(LRow, 5) = CStr(lbl_Einheit)
    Sheets("VPEinheit").Cells(LRow, 6) = ""
    Sheets("VPEinheit").Cells(LRow, 7) = ""
    Sheets("VPEinheit").Cells(LRow, 8) = ""
    Sheets("VPEinheit").Cells(LRow, 9) = "'" & CStr(lbl_herstellerNr)
    Sheets("VPEinheit").Cells(LRow, 10) = "'" & CStr(txt_LNr)
    Sheets("VPEinheit").Cells(LRow, 11) = "'" & CStr(cboLieferant)
    Sheets("VPEinheit").Cells(LRow, 12) = "-"
    Sheets("VPEinheit").Cells(LRow, 13) = CDbl(txt_BEK)
    Sheets("VPEinheit").Cells(LRow, 14) = "VP-WL"
    Sheets("VPEinheit").Cells(LRow, 16) = CStr(Sheets("Daten").Cells(24, 2))
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Private Sub cmdBeenden_Click()
    On Error GoTo weiter:
    If txt_Eingang.Value = "Eingang" Then
        frmEingang.cboeingang = frmBestellung.cboVAuftrag
        Call frmEingang.SuchenEingang
        Call frmEingang.select_all
        Unload frmBestellung
    Else
        frmLager.txt_item.Value = tbABackup.Value
        Unload frmBestellung
        frmLager.Show
        Sheets("center").Activate
    End If
    Exit Sub
weiter:
    With frmEingang
        frmEingang.cboeingang = ""
        frmEingang.lstWAimput.Clear
        UserForm_Initialize
    End With
    Unload frmBestellung
End Sub

Private Sub cmdchanel_Click()
    If txt_Eingang.Value = "Eingang" Then
        Unload frmBestellung
        frmLager.txt_item.SetFocus
    Else
        If tbABackup.Value = "" Then
            frmLager.txt_item.SetFocus
        Else
            frmLager.cboArtikelnummer.Value = tbABackup.Value
        End If
        Unload frmBestellung
        frmLager.txt_item.SetFocus
        frmLager.Show
        Exit Sub
    End If
End Sub

Private Sub uebernehmen()
    If frmBestellung.cboVAuftrag.Value = "" Then
        frmBestellung.txtBestellNR.Value = ""
        frmBestellung.lstBestellung.Clear
    Else
        frmBestellung.txtBestellNR = frmBestellung.cboVAuftrag
        frmBestellung.cboVAuftrag.Value = ""
        Call SuchenBestellungNeu
    End If
End Sub

Sub SuchenBestellungNeu() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    On Error Resume Next
    lstBestellung.Clear
    Application.ScreenUpdating = False
     With ThisWorkbook.Sheets("Bestellung")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:O" & Last_Row)
        ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If LCase(arrTmpA(i, 1)) Like LCase(txtBestellNR.Text) Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = arrTmpA(i, 4)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 5)), Chr$(13) & Chr$(10), " ")
                If Int(CDbl(arrTmpA(i, 6))) = CDbl(arrTmpA(i, 6)) Then
                    arrTmpB(4, n) = arrTmpA(i, 6) & " " & arrTmpA(i, 15) 'Menge
                ElseIf CDbl(Format(arrTmpA(i, 6), "0.0")) = CDbl(arrTmpA(i, 6)) Then
                    arrTmpB(4, n) = Format(arrTmpA(i, 6), "0.0") & " " & arrTmpA(i, 15)
                Else
                    arrTmpB(4, n) = Format(arrTmpA(i, 6), "0.00") & " " & arrTmpA(i, 15)
                End If
                arrTmpB(5, n) = VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ")
                arrTmpB(6, n) = arrTmpA(i, 10)
                arrTmpB(7, n) = Format(arrTmpA(i, 9), "currency")
                arrTmpB(8, n) = i
                arrTmpB(9, n) = arrTmpA(i, 12)
                txtvdate.Value = arrTmpA(i, 11)
                cboLieferant = arrTmpA(i, 2)
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 9)
             For i = 1 To 9
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstBestellung
                .ColumnCount = 8
                .ColumnWidths = "110;80;220;70;160;0;55;0"
                .List = arrTmpA
             End With
        End If
     End With
     Application.ScreenUpdating = True
     Call Bestellsum
End Sub

Sub suchenTArtikel() '1.44
    Dim arrTmpA, arrTmpB, i, Last_Row, n, w, j As Long
    Dim SuchKriterium As String
    On Error Resume Next
    txtID.Value = ""
    Application.ScreenUpdating = False
    SuchKriterium = LCase(cboArtikelNR.Text)
    lstArtikelID.Clear
     With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:R" & Last_Row)
        ReDim arrTmpB(1 To 3, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            w = 0
            If cbo_Lieferant = "" Or cbo_Lieferant = "Alle anzeigen" Then
                If LCase(arrTmpA(i, 3)) Like SuchKriterium Then
                    w = w + 1
                    n = n + 1
                    arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = "HL"
                End If
            Else
                w = 0
                If LCase(arrTmpA(i, 3)) Like SuchKriterium And arrTmpA(i, 18) Like txt_LNr2 Then
                    n = n + 1
                    w = w + 1
                    arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = "HL"
                End If
            End If
            If w = 0 Then
                If LCase(arrTmpA(i, 3)) Like SuchKriterium Then
                    n = n + 1
                    arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = "HL"
                End If
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 3)
             For i = 1 To 3
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstArtikelID
                .ColumnCount = 3
                .ColumnWidths = "180;0;0"
                .List = arrTmpA
             End With
        End If
     End With
     Application.ScreenUpdating = True
End Sub

Sub Bestellsum() '1.44
    Dim wert, Wert2, DouZahl As Double
    Dim sText, stext2 As String
    Dim i, intLeerPos As Long
    On Error Resume Next
    
    wert = 0
    Application.ScreenUpdating = False
    For i = 0 To lstBestellung.ListCount - 1
        If Not frmBestellung.lstBestellung.List(i, 3) = "" And Not frmBestellung.lstBestellung.List(i, 6) = "-" Then
            intLeerPos = InStr(frmBestellung.lstBestellung.List(i, 3) & " ", " ")
            sText = frmBestellung.lstBestellung.List(i, 6) '* DouZahl 'List
            wert = wert + CDbl(sText)
        End If
    Next i
    Wert2 = 0
    For i = 0 To lstBestellung.ListCount - 1
        If Not frmBestellung.lstBestellung.List(i, 3) = "" And Not frmBestellung.lstBestellung.List(i, 5) = "-" Then
            intLeerPos = InStr(frmBestellung.lstBestellung.List(i, 3) & " ", " ")
            stext2 = Left(frmBestellung.lstBestellung.List(i, 3), intLeerPos - 1)
            Wert2 = Wert2 + CDbl(stext2)
        End If
    Next i
    txtBsum.Value = Format(CDbl(wert), "#.##")
    txtBMsum.Value = Format(CDbl(Wert2), "#.##")
    Application.ScreenUpdating = True
    Call Liefrei
End Sub
Attribute VB_Name = "frmContact"
Attribute VB_Base = "0{A63CA7FA-1445-4799-9A7B-E4DA45D6ED7D}{51E71CCD-44A1-4652-A9B0-9BD90D1439F5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim aRow, lng, Ki, KRow As Long
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    KRow = Sheets("Kunden").Cells(Rows.Count, 1).End(xlUp).Row
    cboKDNr.AddItem "neuer Kunde"
    For Ki = 2 To KRow
        If Sheets("Kunden").Cells(Ki, 4) = "Firma" Then
            cboKDNr.AddItem Sheets("Kunden").Cells(Ki, 4) & " " & Sheets("Kunden").Cells(Ki, 7)
        Else
            cboKDNr.AddItem Sheets("Kunden").Cells(Ki, 7) & ", " & Sheets("Kunden").Cells(Ki, 6)
        End If
    Next Ki
    cboKDNr.ListIndex = 0
    txtdate.Value = Date + 14
    aRow = Sheets("Mitarbeiter").Cells(Rows.Count, 1).End(xlUp).Row
    If Not Sheets("Daten").Range("B22").Value = "" Then
        cboAnsp.Visible = False
        txt_Gast.Value = Sheets("Daten").Range("B22").Value
        txt_Gast.Visible = True
    Else
        For lng = 2 To aRow
            cboAnsp.AddItem Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3)
        Next lng
        If Not Sheets("Daten").Range("B24").Value = "" Then
            cboAnsp = Sheets("Daten").Range("B24").Value
        End If
    End If
    With cboanrede
        .AddItem "Firma"
        .AddItem "Frau"
        .AddItem "Herr"
    End With
    txt_Snachnamen.SetFocus
End Sub

Private Sub txt_KDID_Change()
    If Not txt_KDID = "" Then
        If Not cboanrede = "Firma" Then
            lbl_Namen.Caption = "Vorname / Nachname"
            lbl_Namen.ForeColor = &H404040
        Else
            lbl_Namen.Caption = "Firma"
            lbl_Namen.ForeColor = &H404040
        End If
    Else
        If cboKDNr = "neuer Kunde" And Not cboanrede = "Firma" Then
            lbl_Namen.Caption = "Namen bitte ohne Titel (Prof., Dr., usw) eingeben!"
            lbl_Namen.ForeColor = &HFF&
        End If
    End If
End Sub

Private Sub cboAnrede_Change()
    If cboanrede = "" Then Exit Sub
    If cboKDNr = "neuer Kunde" And Not cboanrede = "Firma" Then
        lbl_Namen.Caption = "Namen bitte ohne Titel (Prof., Dr., usw) eingeben!"
        lbl_Namen.ForeColor = &HFF&
    ElseIf Not cboanrede = "Firma" Then
        lbl_Namen.Caption = "Vorname / Nachname"
        lbl_Namen.ForeColor = &H404040
    Else
        lbl_Namen.Caption = "Firma"
        lbl_Namen.ForeColor = &H404040
    End If
End Sub

Private Sub txt_Snachnamen_Change()
    If Not txt_Snachnamen.Value = "" Then
        Call KASuchen2
    End If
End Sub

Private Sub lblinfo2_Click()
    MsgBox "Geben Sie dem Angebot eine Frist (Standardgem|fffd||fffd| heutiges Datum + 14 Tage)!", , "Hinweis"
End Sub

Private Sub cboKDNr_click()
    Dim zeile As Long
    On Error Resume Next
    
    If Sheets("Daten").Cells(19, 2) = "" Or Sheets("Daten").Cells(19, 2) = 0 Then
        If CDbl(WorksheetFunction.CountA(Sheets("Kunden").Range("A:A"))) > 1 Then
            GoTo weiter
        End If
        zeile = 1
    Else
weiter:
        If CDbl(Sheets("Kunden").Cells(Sheets("Kunden").Cells(1048576, 1).End(xlUp).Row, 1)) > CDbl(Sheets("Daten").Cells(19, 2).Value) Then
            zeile = CDbl(Sheets("Kunden").Cells(Sheets("Kunden").Cells(1048576, 1).End(xlUp).Row, 1)) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(19, 2).Value) + 1
        End If
    End If
    If cboKDNr = "neuer Kunde" Then
        txt_KDID.Value = ""
        cboanrede = ""
        txtName.Value = ""
        txtadress.Value = ""
        txtPLZ.Value = ""
        txt_KDID.Value = ""
        txt_KDID2.Value = zeile
        lblinfoKunde.Visible = True
    End If
    If cboKDNr.ListIndex <> 0 Then
        If Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 28) = "ja" Then
            MsgBox "Kunde ist gesperrt!", , "Hinweis"
            Exit Sub
        End If
        cboanrede = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 4)
        If cboanrede = "Firma" Then
            txtName.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 7)
        Else
            If Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 5) = "" Then
                txtName.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 6) & " " & Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 7)
            Else
                txtName.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 5) & " " & Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 6) & " " & Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 7)
            End If
        End If
        txtadress.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 8)
        txtPLZ.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 9) & " " & Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 10)
        txt_KDID.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 1)
        txt_KDNr.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 1, 3)
        lblinfoKunde.Visible = False
        txt_KDID2.Value = ""
    End If
    txt_Snachnamen.Value = ""
End Sub

Private Sub cmd_invoiceprint_Click()
    Dim lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Range("Druckvorlage!A2").Value = ""
    Range("Druckvorlage!A3").Value = ""
    Range("Druckvorlage!A4").Value = ""
    Range("Druckvorlage!A5").Value = ""
    Range("Druckvorlage!A6").Value = ""
    If frmKasseWA.Check_PrintKostenstelle.Value = True Then
        Range("Druckvorlage!D3").Value = "Kostenstelle:"
        Range("Druckvorlage!E3").Value = "'" & frmKasseWA.cbo_kosten
    Else
        Range("Druckvorlage!D3").Value = ""
        Range("Druckvorlage!E3").Value = ""
    End If
    Range("Druckvorlage!E5").Value = ""
    Range("Druckvorlage!E6").Value = ""
    Range("Druckvorlage!E7").Value = ""
    Range("Druckvorlage!A3") = cboanrede.Text
    Range("Druckvorlage!A4") = txtName.Value
    Range("Druckvorlage!A5") = txtadress.Value
    Range("Druckvorlage!A6") = txtPLZ.Value
    Range("Druckvorlage!A9") = ""
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Range("Druckvorlage!C11").Value = txt_Gast.Value
        Range("Druckvorlage!C12").Value = "'" & Sheets("Daten").Range("B13").Value
        Range("Druckvorlage!C13").Value = "'" & Sheets("Daten").Range("B14").Value
        Range("Druckvorlage!C14").Value = "'" & Sheets("Daten").Range("B15").Value
    Else
        If cboAnsp = "" Then
            Range("Druckvorlage!C11").Value = ""
            Range("Druckvorlage!C12").Value = ""
            Range("Druckvorlage!C13").Value = ""
            Range("Druckvorlage!C14").Value = ""
        Else
            If txtindex.Value = "" Then
                GoTo weiter
            Else
                lng = CDbl(txtindex.Value)
            End If
            If Not Sheets("Mitarbeiter").Cells(lng, 7) = "" Then
                Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3) & " / " & Sheets("Mitarbeiter").Cells(lng, 7)
            Else
                 Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3)
            End If
            Range("Druckvorlage!C12").Value = "'" & Sheets("Mitarbeiter").Cells(lng, 5)
            Range("Druckvorlage!C13").Value = Sheets("Mitarbeiter").Cells(lng, 6)
            Range("Druckvorlage!C14").Value = Sheets("Mitarbeiter").Cells(lng, 4)
        End If
    End If
weiter:
    Call KDpruefen
    If txt_IDART.Value = "APDF" Or txt_IDART.Value = "APRI" Then
        Call Auftrag
    Else
        Call Rechnung
    End If
    Application.ScreenUpdating = True
    Unload frmContact
End Sub

Private Sub cmd_KDsave_Click()
    Dim lng, i As Long
    On Error Resume Next
    Call KDpruefen
    If Not txt_Nummer.Value = "" Then
        For lng = 1 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
            If Worksheets("Reservierungen").Cells(lng, 1) = txt_Nummer Then
                Worksheets("Reservierungen").Cells(lng, 19).Value = CStr(txt_KDID)
                i = i + 1
            End If
        Next lng
        MsgBox "Kunde wurde aktualisiert!"
        frmKasse.txt_KDID.Value = CStr(frmContact.txt_KDID.Value)
        Unload frmContact
        Unload frmInfoKasse
    Else
        If frmContact.txt_IDART.Value = "WAG" Then
            frmWarenentnahmeschein.txt_KDID.Value = frmContact.txt_KDID.Value
        Else
            frmKasse.txt_KDID.Value = frmContact.txt_KDID.Value
        End If
        Unload frmContact
    End If
End Sub

Sub KDpruefen() '1.44
    Dim arrPLZ As Variant
    Dim strVorname, strNachname, KName As String
    Dim intLeerPos As Long
    On Error Resume Next

    If frmContact.txt_KDID.Value = "" Then
        If txtName.Value = "" Then Exit Sub
        Application.ScreenUpdating = False
        Sheets("Kunden").Activate
        With Worksheets("Kunden")
            If .FilterMode Then .ShowAllData
        End With
        Range("A65536").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0) = frmContact.txt_KDID2.Value
        ActiveCell.Offset(0, 1) = Format(Date, "DD.MM.YYYY")
        ActiveCell.Offset(0, 3).Value = cboanrede.Text
        If Not cboanrede = "Firma" Then
            KName = CStr(txtName)
            intLeerPos = InStr(txtName & " ", " ")
            strVorname = Left(txtName, intLeerPos - 1)
            strNachname = Mid(KName, InStr(KName, " ") + 1)
            ActiveCell.Offset(0, 5).Value = strVorname
            ActiveCell.Offset(0, 6).Value = strNachname
        Else
            ActiveCell.Offset(0, 6).Value = txtName.Value
        End If
        ActiveCell.Offset(0, 7).Value = txtadress.Value
        arrPLZ = Split(txtPLZ.Text, " ")
        ActiveCell.Offset(0, 8).Value = arrPLZ(0)
        ActiveCell.Offset(0, 9).Value = arrPLZ(1)
        Sheets("Daten").Cells(19, 2).Value = frmContact.txt_KDID2.Value
        Sheets("Center").Activate
        Application.ScreenUpdating = True
    End If
    If frmContact.txt_KDID.Value = "" Then
        frmContact.txt_KDID.Value = frmContact.txt_KDID2.Value
    End If
    Call Fusszeile
End Sub

Private Sub cmd_Ksuchen_Click()
    Call KASuchen
End Sub

Sub KASuchen()
    Dim zlng, i, Alng, xrow As Long
    Dim andoubl As Double
    On Error Resume Next

    If txt_Snachnamen.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    andoubl = 0
    For Alng = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
        If InStr(1, LCase(Sheets("Kunden").Cells(Alng, 7).Value), LCase(txt_Snachnamen.Text)) > 0 Then
            andoubl = andoubl + 1
            i = i + 1
        End If
    Next Alng
    If andoubl >= 1 Then
        lst_Auswahl.BackColor = &H80000005
        lst_Auswahl.Clear
        lst_Auswahl.ColumnCount = 2
        lst_Auswahl.ColumnWidths = "100;0"
        i = 0
        For zlng = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
            If InStr(1, LCase(Sheets("Kunden").Cells(zlng, 7).Value), LCase(txt_Snachnamen.Text)) > 0 Then
                lst_Auswahl.AddItem "ID " & Sheets("Kunden").Cells(zlng, 1).Value & " " & Sheets("Kunden").Cells(zlng, 7).Value & ", " & Sheets("Kunden").Cells(zlng, 6).Value
                lst_Auswahl.Column(1, i) = Sheets("Kunden").Cells(zlng, 17).Row
                lst_Auswahl.Column(2, i) = Sheets("Kunden").Cells(zlng, 1).Text
                i = i + 1
            End If
        Next zlng
        cboanrede = ""
        txtName.Value = ""
        txtadress.Value = ""
        txtPLZ.Value = ""
        txt_KDNr.Value = ""
        lst_Auswahl.SetFocus
    Else
        lst_Auswahl.Clear
        lst_Auswahl.BackColor = &H80000004
        xrow = xFind(ActiveWorkbook.Name, ("Kunden"), txt_Snachnamen.Value, "G:G")
        If xrow = False Then
            cboanrede = ""
            txtName.Value = ""
            txtadress.Value = ""
            txtPLZ.Value = ""
            txt_KDNr.Value = ""
            MsgBox "Es ist kein Kunde mit dem Namen " + txt_Snachnamen + " vorhanden", , "Hinweis"
            txt_Snachnamen.SetFocus
            Exit Sub
            Application.ScreenUpdating = True
        End If
        cboanrede = Sheets("Kunden").Cells(xrow, 4)
        If cboanrede = "Firma" Then
            txtName.Value = Sheets("Kunden").Cells(xrow, 7)
        Else
            txtName.Value = Sheets("Kunden").Cells(xrow, 6) & " " & Sheets("Kunden").Cells(xrow, 7)
        End If
        txtadress.Value = Sheets("Kunden").Cells(xrow, 8)
        txtPLZ.Value = Sheets("Kunden").Cells(xrow, 9) & " " & Sheets("Kunden").Cells(xrow, 10)
        If Sheets("Kunden").Cells(xrow, 4) = "Firma" Then
            cboKDNr = Sheets("Kunden").Cells(xrow, 4) & " " & Sheets("Kunden").Cells(xrow, 7)
        Else
            cboKDNr = Sheets("Kunden").Cells(xrow, 7) & ", " & Sheets("Kunden").Cells(xrow, 6)
        End If
        txt_KDID.Value = Sheets("Kunden").Cells(xrow, 1)
        txt_KDNr.Value = Sheets("Kunden").Cells(xrow, 3)
        txt_Snachnamen.SetFocus
        txt_KDID2.Value = ""
    End If
    Application.ScreenUpdating = True
End Sub

Sub KASuchen2()
    Dim zlng, i, Alng, xrow As Long
    Dim andoubl As Double
    On Error Resume Next

    If txt_Snachnamen.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    andoubl = 0
    For Alng = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
        If InStr(1, LCase(Sheets("Kunden").Cells(Alng, 7).Value), LCase(txt_Snachnamen.Text)) > 0 Then
            andoubl = andoubl + 1
            i = i + 1
        End If
    Next Alng
    If andoubl >= 1 Then
        lst_Auswahl.BackColor = &H80000005
        lst_Auswahl.Clear
        lst_Auswahl.ColumnCount = 2
        lst_Auswahl.ColumnWidths = "100;0"
        i = 0
        For zlng = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
            If InStr(1, LCase(Sheets("Kunden").Cells(zlng, 7).Value), LCase(txt_Snachnamen.Text)) > 0 Then
                lst_Auswahl.AddItem "ID " & Sheets("Kunden").Cells(zlng, 1).Value & " " & Sheets("Kunden").Cells(zlng, 7).Value & ", " & Sheets("Kunden").Cells(zlng, 6).Value
                lst_Auswahl.Column(1, i) = Sheets("Kunden").Cells(zlng, 17).Row
                lst_Auswahl.Column(2, i) = Sheets("Kunden").Cells(zlng, 1).Text
                i = i + 1
            End If
        Next zlng
        cboanrede = ""
        txtName.Value = ""
        txtadress.Value = ""
        txtPLZ.Value = ""
        txt_KDNr.Value = ""
    Else
        lst_Auswahl.Clear
        lst_Auswahl.BackColor = &H80000004
        xrow = xFind(ActiveWorkbook.Name, ("Kunden"), txt_Snachnamen.Value, "G:G")
        If xrow = False Then
            cboanrede = ""
            txtName.Value = ""
            txtadress.Value = ""
            txtPLZ.Value = ""
            txt_KDNr.Value = ""
            MsgBox "Es ist kein Kunde mit dem Namen " + txt_Snachnamen + " vorhanden", , "Hinweis"
            txt_Snachnamen.SetFocus
            Exit Sub
            Application.ScreenUpdating = True
        End If
        cboanrede = Sheets("Kunden").Cells(xrow, 4)
        If cboanrede = "Firma" Then
            txtName.Value = Sheets("Kunden").Cells(xrow, 7)
        Else
            txtName.Value = Sheets("Kunden").Cells(xrow, 6) & " " & Sheets("Kunden").Cells(xrow, 7)
        End If
        txtadress.Value = Sheets("Kunden").Cells(xrow, 8)
        txtPLZ.Value = Sheets("Kunden").Cells(xrow, 9) & " " & Sheets("Kunden").Cells(xrow, 10)
        If Sheets("Kunden").Cells(xrow, 4) = "Firma" Then
            cboKDNr = Sheets("Kunden").Cells(xrow, 4) & " " & Sheets("Kunden").Cells(xrow, 7)
        Else
            cboKDNr = Sheets("Kunden").Cells(xrow, 7) & ", " & Sheets("Kunden").Cells(xrow, 6)
        End If
        txt_KDID.Value = Sheets("Kunden").Cells(xrow, 1)
        txt_KDNr.Value = Sheets("Kunden").Cells(xrow, 3)
        txt_Snachnamen.SetFocus
        txt_KDID2.Value = ""
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub lst_Auswahl_Click()
    Dim zlng As Long
    On Error Resume Next
    
    zlng = lst_Auswahl.Column(1)
    If Sheets("Kunden").Cells(zlng, 28) = "ja" Then
        MsgBox "Kunde ist gesperrt!", , "Hinweis"
        Exit Sub
    End If
    cboanrede = Sheets("Kunden").Cells(zlng, 4)
    If cboanrede = "Firma" Then
        txtName.Value = Sheets("Kunden").Cells(zlng, 7)
    Else
        txtName.Value = Sheets("Kunden").Cells(zlng, 6) & " " & Sheets("Kunden").Cells(zlng, 7)
    End If
    txtadress.Value = Sheets("Kunden").Cells(zlng, 8)
    txtPLZ.Value = Sheets("Kunden").Cells(zlng, 9) & " " & Sheets("Kunden").Cells(zlng, 10)
    txt_KDID.Value = Sheets("Kunden").Cells(zlng, 1)
    cboKDNr = Sheets("Kunden").Cells(zlng, 7) & ", " & Sheets("Kunden").Cells(zlng, 6)
End Sub

Private Sub cboAnsp_Change()
    txtindex.Value = CDbl(cboAnsp.ListIndex + 2)
End Sub

Private Sub cmdchanel_Click()
    frmKasse.txt_OpLieferschein.Value = ""
    frmKasse.txt_OpRechnung.Value = ""
    frmKasse.txt_OpAngebot.Value = ""
    Unload frmContact
End Sub

Sub Fusszeile()
    Dim lngID As Long
    On Error Resume Next
    lngID = Worksheets("Kunden").Range("A:A").Find(CStr(txt_KDID), LookIn:=xlValues, MatchCase:=True).Row
    If Worksheets("Kunden").Cells(CDbl(lngID), 29) = "" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & Sheets("Daten").Range("B26").Value
    ElseIf Worksheets("Kunden").Cells(CDbl(lngID), 29) = "benf" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & Worksheets("Kunden").Cells(CDbl(lngID), 33)
    ElseIf Worksheets("Kunden").Cells(CDbl(lngID), 29) = "ja" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Worksheets("Kunden").Cells(CDbl(lngID), 33)
    ElseIf Worksheets("Kunden").Cells(CDbl(lngID), 29) = "Sofort" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Worksheets("Kunden").Cells(CDbl(lngID), 33)
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & Sheets("Daten").Range("B26").Value
    End If
End Sub

Private Sub cmdnextL_Click()
    Dim lng, lngID As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Range("Druckvorlage!A2").Value = ""
    Range("Druckvorlage!A3").Value = ""
    Range("Druckvorlage!A4").Value = ""
    Range("Druckvorlage!A5").Value = ""
    Range("Druckvorlage!A6").Value = ""
    If frmKasseWA.Check_PrintKostenstelle.Value = True Then
        Range("Druckvorlage!D3").Value = "Kostenstelle:"
        Range("Druckvorlage!E3").Value = "'" & frmKasseWA.cbo_kosten
    Else
        Range("Druckvorlage!D3").Value = ""
        Range("Druckvorlage!E3").Value = ""
    End If
    Range("Druckvorlage!E5").Value = ""
    Range("Druckvorlage!E6").Value = ""
    Range("Druckvorlage!E7").Value = ""
    Range("Druckvorlage!E16").Value = ""
    Range("Druckvorlage!F16").Value = ""
    Range("Druckvorlage!A3").Value = cboanrede
    Range("Druckvorlage!A4").Value = txtName.Value
    Range("Druckvorlage!A5").Value = txtadress.Value
    Range("Druckvorlage!A6").Value = txtPLZ.Value
    lngID = Worksheets("Kunden").Range("A:A").Find(CStr(txt_KDID), LookIn:=xlValues, MatchCase:=True).Row
    If Not Worksheets("Kunden").Cells(CDbl(lngID), 11) = "" Then
        If Not Worksheets("Kunden").Cells(CDbl(lngID), 12) = "" Then
            Range("Druckvorlage!A9").Value = "Tel: " & Worksheets("Kunden").Cells(CDbl(lngID), 11) & " oder " & Worksheets("Kunden").Cells(CDbl(lngID), 12)
        Else
            Range("Druckvorlage!A9").Value = "Tel: " & Worksheets("Kunden").Cells(CDbl(lngID), 11)
        End If
    Else
        Range("Druckvorlage!A9").Value = ""
    End If
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Range("Druckvorlage!C11").Value = txt_Gast.Value
        Range("Druckvorlage!C12").Value = "'" & Sheets("Daten").Range("B13").Value
        Range("Druckvorlage!C13").Value = "'" & Sheets("Daten").Range("B14").Value
        Range("Druckvorlage!C14").Value = "'" & Sheets("Daten").Range("B15").Value
    Else
        If cboAnsp = "" Then
            Range("Druckvorlage!C11").Value = ""
            Range("Druckvorlage!C12").Value = ""
            Range("Druckvorlage!C13").Value = ""
            Range("Druckvorlage!C14").Value = ""
        Else
            If txtindex.Value = "" Then
                GoTo weiter
            Else
                lng = CDbl(txtindex.Value)
            End If
            If Not Sheets("Mitarbeiter").Cells(lng, 7) = "" Then
                Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3) & " / " & Sheets("Mitarbeiter").Cells(lng, 7)
            Else
                 Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3)
            End If
            Range("Druckvorlage!C12").Value = "'" & Sheets("Mitarbeiter").Cells(lng, 5)
            Range("Druckvorlage!C13").Value = Sheets("Mitarbeiter").Cells(lng, 6)
            Range("Druckvorlage!C14").Value = Sheets("Mitarbeiter").Cells(lng, 4)
        End If
    End If
weiter:
    Call KDpruefen
    Call Lieferschein
    Application.ScreenUpdating = True
    Unload frmContact
End Sub

Private Sub cmdnextPDF_Click()
    Dim lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Range("Druckvorlage!A2").Value = ""
    Range("Druckvorlage!A3").Value = ""
    Range("Druckvorlage!A4").Value = ""
    Range("Druckvorlage!A5").Value = ""
    Range("Druckvorlage!A6").Value = ""
    If frmKasseWA.Check_PrintKostenstelle.Value = True Then
        Range("Druckvorlage!D3").Value = "Kostenstelle:"
        Range("Druckvorlage!E3").Value = "'" & frmKasseWA.cbo_kosten
    Else
        Range("Druckvorlage!D3").Value = ""
        Range("Druckvorlage!E3").Value = ""
    End If
    Range("Druckvorlage!E5").Value = ""
    Range("Druckvorlage!E6").Value = ""
    Range("Druckvorlage!E7").Value = ""
    Range("Druckvorlage!A3").Value = cboanrede.Text
    Range("Druckvorlage!A4").Value = txtName.Value
    Range("Druckvorlage!A5").Value = txtadress.Value
    Range("Druckvorlage!A6").Value = txtPLZ.Value
    Range("Druckvorlage!A9").Value = ""
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Range("Druckvorlage!C11").Value = txt_Gast.Value
        Range("Druckvorlage!C12").Value = "'" & Sheets("Daten").Range("B13").Value
        Range("Druckvorlage!C13").Value = "'" & Sheets("Daten").Range("B14").Value
        Range("Druckvorlage!C14").Value = "'" & Sheets("Daten").Range("B15").Value
    Else
        If cboAnsp = "" Then
            Range("Druckvorlage!C11").Value = ""
            Range("Druckvorlage!C12").Value = ""
            Range("Druckvorlage!C13").Value = ""
            Range("Druckvorlage!C14").Value = ""
        Else
            If txtindex.Value = "" Then
                GoTo weiter
            Else
                lng = CDbl(txtindex.Value)
            End If
            If Not Sheets("Mitarbeiter").Cells(lng, 7) = "" Then
                Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3) & " / " & Sheets("Mitarbeiter").Cells(lng, 7)
            Else
                 Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3)
            End If
            Range("Druckvorlage!C12").Value = "'" & Sheets("Mitarbeiter").Cells(lng, 5)
            Range("Druckvorlage!C13").Value = Sheets("Mitarbeiter").Cells(lng, 6)
            Range("Druckvorlage!C14").Value = Sheets("Mitarbeiter").Cells(lng, 4)
        End If
    End If
weiter:
    Call KDpruefen
    Call Angebot
    Application.ScreenUpdating = True
    Unload frmContact
End Sub

Private Sub comnext_Click()
    Dim lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Range("Druckvorlage!A2").Value = ""
    Range("Druckvorlage!A3").Value = ""
    Range("Druckvorlage!A4").Value = ""
    Range("Druckvorlage!A5").Value = ""
    Range("Druckvorlage!A6").Value = ""
    If frmKasseWA.Check_PrintKostenstelle.Value = True Then
        Range("Druckvorlage!D3").Value = "Kostenstelle:"
        Range("Druckvorlage!E3").Value = "'" & frmKasseWA.cbo_kosten
    Else
        Range("Druckvorlage!D3").Value = ""
        Range("Druckvorlage!E3").Value = ""
    End If
    Range("Druckvorlage!E5").Value = ""
    Range("Druckvorlage!E6").Value = ""
    Range("Druckvorlage!E7").Value = ""
    Range("Druckvorlage!A3") = cboanrede.Text
    Range("Druckvorlage!A4") = txtName.Value
    Range("Druckvorlage!A5") = txtadress.Value
    Range("Druckvorlage!A6") = txtPLZ.Value
    Range("Druckvorlage!A9").Value = ""
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Range("Druckvorlage!C11").Value = txt_Gast.Value
        Range("Druckvorlage!C12").Value = "'" & Sheets("Daten").Range("B13").Value
        Range("Druckvorlage!C13").Value = "'" & Sheets("Daten").Range("B14").Value
        Range("Druckvorlage!C14").Value = "'" & Sheets("Daten").Range("B15").Value
    Else
        If cboAnsp = "" Then
            Range("Druckvorlage!C11").Value = ""
            Range("Druckvorlage!C12").Value = ""
            Range("Druckvorlage!C13").Value = ""
            Range("Druckvorlage!C14").Value = ""
        Else
            If txtindex.Value = "" Then
                GoTo weiter
            Else
                lng = CDbl(txtindex.Value)
            End If
            If Not Sheets("Mitarbeiter").Cells(lng, 7) = "" Then
                Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3) & " / " & Sheets("Mitarbeiter").Cells(lng, 7)
            Else
                 Range("Druckvorlage!C11").Value = Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3)
            End If
            Range("Druckvorlage!C12").Value = "'" & Sheets("Mitarbeiter").Cells(lng, 5)
            Range("Druckvorlage!C13").Value = Sheets("Mitarbeiter").Cells(lng, 6)
            Range("Druckvorlage!C14").Value = Sheets("Mitarbeiter").Cells(lng, 4)
        End If
    End If
weiter:
    Call Angebot
    Call KDpruefen
    Application.ScreenUpdating = True
    Unload frmContact
End Sub

Sub Angebot() 'v1.44
    Dim zeLB, zeTB, spTB, spLB, KIDlng, Farbe, Pos, lngID, Last_Row, lng, lngKDID As Long
    Dim pdfName, pdfDatei, FDate As String
    Dim arrTmpA, arrTmpB, i, xrow As Long
    Dim Last_Row2 As Long
    Dim ZahlMwsT1, ZahlMwsT2 As Double
    Dim Kopien As Variant
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    Application.ScreenUpdating = False
    Sheets("Druckvorlage").Visible = True
    Sheets("Druckvorlage").Activate
    If frmKasse.txt_OpAngebot.Value = "PDF" Then
        pdfDatei = frmKasse.txtRnr.Value
        pdfName = Application.GetSaveAsFilename(Environ("USERPROFILE") & "\Desktop\" & pdfDatei & ".pdf", "PDF-Dateien (*.pdf), *.pdf")
    End If
    Last_Row = CDbl(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & Last_Row).Delete
    lng = CLng(frmKasse.lstKasse.ListCount) + 24
    Range("Druckvorlage!A17:F" & lng).Font.Size = 9
    Range("Druckvorlage!A8") = ""
    Range("Druckvorlage!E11") = "Angebot"
    Range("Druckvorlage!E11").Font.Size = 14
    Range("Druckvorlage!D2") = "Angebot:"
    Range("Druckvorlage!D5") = "Kundennummer:"
    Range("Druckvorlage!D6") = ""
    Range("Druckvorlage!E6") = ""
    Range("Druckvorlage!E2") = "'" & frmKasse.txtRnr.Value
    Range("Druckvorlage!E5") = "'" & txt_KDNr.Value
    lngKDID = Worksheets("Kunden").Range("A:A").Find(frmContact.txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row
    Range("Druckvorlage!E6") = Sheets("Kunden").Cells(lngKDID, 24)
    Range("Druckvorlage!E7") = Sheets("Kunden").Cells(lngKDID, 13)
    Range("Druckvorlage!F14") = ""
    Range("Druckvorlage!E16") = "Preis"
    Range("Druckvorlage!F16") = "Betrag"
    If Not txtdate.Value = "" Then
        Range("Druckvorlage!D3") = "Angebot g|fffd|ltig bis:"
        Range("Druckvorlage!E3") = "'" & Format(txtdate.Value, FDate)
    Else
        Range("Druckvorlage!D3") = ""
        Range("Druckvorlage!E3") = ""
    End If
    Range("Druckvorlage!E4") = Format(Date, "DD.MM.YYYY")
    Worksheets("Druckvorlage").PageSetup.RightFooter = "&8" & "Seite &P von &N"
    zeTB = 17
    Pos = 1
    '--- selektierte Listboxeintraege in Zellen schreiben
    For zeLB = 0 To frmKasse.lstKasse.ListCount - 1
        For spLB = 0 To frmKasse.lstKasse.ColumnCount - 1
            With ThisWorkbook.Sheets("Lager")
                Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row2)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.lstKasse.List(zeLB, 6)) Then
                        lngID = i
                    End If
                Next i
            End With
            Sheets("Druckvorlage").Cells(zeTB, 1) = Pos
            Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
            Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
            Sheets("Druckvorlage").Cells(zeTB, 1).NumberFormat = "@"
            Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmKasse.lstKasse.List(zeLB, 0)
            Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
            Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
            If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                If Not Sheets("Lager").Cells(CDbl(lngID), 32) = "" Then
                    If Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                    ElseIf Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                    ElseIf frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                    Else
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                    End If
                Else
                    If Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt"
                    ElseIf Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt"
                    ElseIf frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")"
                    Else
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
                    End If
                End If
            Else
                Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
            End If
            Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
            Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
            If Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                With ThisWorkbook.Sheets("Leistungen")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 2)) Then
                            xrow = i
                        End If
                    Next i
                End With
                Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Leistungen").Cells(CDbl(xrow), 8)
            Else
                Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Lager").Cells(CDbl(lngID), 12)
            End If
            Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
            Sheets("Druckvorlage").Cells(zeTB, 4).NumberFormat = "@"
            Sheets("Druckvorlage").Cells(zeTB, 5) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4)), "currency")
            Sheets("Druckvorlage").Cells(zeTB, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB, 5).VerticalAlignment = xlTop
            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4) * frmKasse.lstKasse.List(zeLB, 2)), "currency")
            Sheets("Druckvorlage").Cells(zeTB, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB, 6).VerticalAlignment = xlTop
        Next
        Pos = Pos + 1
        zeTB = zeTB + 1
    Next
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To frmKasse.lstKasse.ListCount - 1
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    If Worksheets("Daten").Range("B3").Value = Worksheets("Daten").Range("B2").Value Then
        Sheets("Druckvorlage").Cells(zeTB + 2, 5) = "Zwischensumme:"
        Sheets("Druckvorlage").Cells(zeTB + 2, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 2, 6) = Format(CDbl(frmKasse.lbl_sum12), "currency")
        Sheets("Druckvorlage").Cells(zeTB + 2, 6).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %"
        Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 3, 6) = frmKasse.txt_MWSTV2.Value
        Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "Gesamtsumme:"
        Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 4, 6) = Format(CDbl(frmKasse.lbl_sum22), "currency")
        Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 7, 1) = "Mit freundlichem Gru|fffd|"
        Sheets("Druckvorlage").Cells(zeTB + 10, 1) = Worksheets("Daten").Range("B9")
    Else
        Sheets("Druckvorlage").Cells(zeTB + 2, 5) = "Zwischensumme:"
        Sheets("Druckvorlage").Cells(zeTB + 2, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 2, 6) = Format(CDbl(frmKasse.lbl_sum12), "currency")
        Sheets("Druckvorlage").Cells(zeTB + 2, 6).HorizontalAlignment = xlRight
        If CDbl(frmKasse.lbl_Rabatt.Caption) > 0 Then
            If Not CDbl(frmKasse.txt_MWSTG2.Value) > 0 Or frmKasse.txt_MWSTG2.Value = "" Then
                Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "Rabatt:"
                Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 3, 6) = "-" & Format(CDbl(frmKasse.lbl_Rabatt), "currency")
                Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
                Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 6) = frmKasse.txt_MWSTV2.Value
                Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 5, 5) = "Gesamtsumme:"
                Sheets("Druckvorlage").Cells(zeTB + 5, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 5, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
                Sheets("Druckvorlage").Cells(zeTB + 5, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 7, 1) = "Mit freundlichem Gru|fffd|"
                Sheets("Druckvorlage").Cells(zeTB + 7, 1).Font.Size = 11
                If Not Sheets("Daten").Range("B22").Value = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1) = "'" & Sheets("Daten").Range("B22").Value
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                Else
                    If frmContact.cboAnsp = "" Then
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1) = Worksheets("Daten").Range("B9")
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                    Else
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1) = frmContact.cboAnsp.Text
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                    End If
                End If
            Else
                Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "Rabatt:"
                Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 3, 6) = "-" & Format(CDbl(frmKasse.lbl_Rabatt), "currency")
                Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B3") * 100) & " %:"
                Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 6) = frmKasse.txt_MWSTG2.Value
                Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 5, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
                Sheets("Druckvorlage").Cells(zeTB + 5, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 5, 6) = frmKasse.txt_MWSTV2.Value
                Sheets("Druckvorlage").Cells(zeTB + 5, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 6, 5) = "Gesamtsumme:"
                Sheets("Druckvorlage").Cells(zeTB + 6, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 6, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
                Sheets("Druckvorlage").Cells(zeTB + 6, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 8, 1) = "Mit freundlichem Gru|fffd|"
                Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
                If Not Sheets("Daten").Range("B22").Value = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 10, 1) = "'" & Sheets("Daten").Range("B22").Value
                    Sheets("Druckvorlage").Cells(zeTB + 10, 1).Font.Size = 11
                Else
                    If frmContact.cboAnsp = "" Then
                        Sheets("Druckvorlage").Cells(zeTB + 10, 1) = Worksheets("Daten").Range("B9")
                        Sheets("Druckvorlage").Cells(zeTB + 10, 1).Font.Size = 11
                    Else
                        Sheets("Druckvorlage").Cells(zeTB + 10, 1) = frmContact.cboAnsp.Text
                        Sheets("Druckvorlage").Cells(zeTB + 10, 1).Font.Size = 11
                    End If
                End If
            End If
        Else
            If Worksheets("Daten").Range("F36") = "Ja" Then
                ZahlMwsT1 = CLng(frmKasse.txt_MWSTG.Value / 0.05) * 0.05
                ZahlMwsT2 = CLng(frmKasse.txt_MWSTV.Value / 0.05) * 0.05
            Else
                ZahlMwsT1 = CLng(frmKasse.txt_MWSTG.Value)
                ZahlMwsT2 = CLng(frmKasse.txt_MWSTV.Value)
            End If

            If Not CDbl(frmKasse.txt_MWSTG2.Value) > 0 Or frmKasse.txt_MWSTG2.Value = "" Then
                Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
                Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 3, 6) = Format(ZahlMwsT2, "currency")
                Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "Gesamtsumme:"
                Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
                Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 6, 1) = "Mit freundlichem Gru|fffd|"
                Sheets("Druckvorlage").Cells(zeTB + 6, 1).Font.Size = 11
                If Not Sheets("Daten").Range("B22").Value = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 8, 1) = "'" & Sheets("Daten").Range("B22").Value
                    Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
                Else
                    If frmContact.cboAnsp = "" Then
                        Sheets("Druckvorlage").Cells(zeTB + 8, 1) = Worksheets("Daten").Range("B9")
                        Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
                    Else
                        Sheets("Druckvorlage").Cells(zeTB + 8, 1) = frmContact.cboAnsp.Text
                        Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
                    End If
                End If

            Else
                Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B3") * 100) & " %:"
                Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 3, 6) = Format(ZahlMwsT1, "currency")
                Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
                Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 4, 6) = Format(ZahlMwsT2, "currency")
                Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 5, 5) = "Gesamtsumme:"
                Sheets("Druckvorlage").Cells(zeTB + 5, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 5, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
                Sheets("Druckvorlage").Cells(zeTB + 5, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB + 7, 1) = "Mit freundlichem Gru|fffd|"
                Sheets("Druckvorlage").Cells(zeTB + 7, 1).Font.Size = 11
                If Not Sheets("Daten").Range("B22").Value = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1) = "'" & Sheets("Daten").Range("B22").Value
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                Else
                    If frmContact.cboAnsp = "" Then
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1) = Worksheets("Daten").Range("B9")
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                    Else
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1) = frmContact.cboAnsp.Text
                        Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                    End If
                End If
            End If
        End If
    End If
    If frmKasse.txt_OpAngebot.Value = "Print" Then
        Kopien = Application.InputBox("Anzahl Kopien", "Angebot drucken", 1)
        If Kopien = False Then
            Exit Sub
            Application.ScreenUpdating = True
        End If
        Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
    Else
        pdfDatei = frmKasse.txtRnr.Text
        Sheets("Druckvorlage").ExportAsFixedFormat Type:=xlTypePDF, Filename:=pdfName, _
                          Quality:=xlQualityStandard, IncludeDocProperties:=False, IgnorePrintAreas:=False, _
                          OpenAfterPublish:=True
    End If
    If frmKasse.cboAuftragSuchen = "" And frmKasse.cbo_Angebot = "" Then
        For KIDlng = 0 To frmKasse.lstKasse.ColumnCount - 1
            Sheets("Kassendaten").Cells(frmKasse.lstKasse.List(KIDlng, 7), 18) = frmContact.txt_KDID.Value
        Next
    Else
        For KIDlng = 0 To frmKasse.lstKasse.ColumnCount - 1
            Sheets("Reservierungen").Cells(frmKasse.lstKasse.List(KIDlng, 7), 19) = frmContact.txt_KDID.Value
        Next
    End If
    frmKasse.txt_KDID.Value = txt_KDID.Value
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    If frmKasse.txt_OpAngebot.Value = "Print" Then
        MsgBox "Angebot wurde gedruckt!", , "Angebot!"
    Else
        MsgBox "Angebot wird als PDF gespeichert!", , "Angebot!"
    End If
    frmKasse.txt_OpAngebot.Value = ""
End Sub

Sub Lieferschein() 'v1.44
    Dim zeLB, zeTB, spTB, spLB, Pos, lngID, Farbe, Last_Row, lng, lngR, lngNr As Long
    Dim nSelCount, l, lngCount As Long
    Dim pdfName, pdfDatei, strLS, FDate As String
    Dim arrTmpA, arrTmpB, i, xrow As Long
    Dim Last_Row2 As Long
    Dim Kopien As Variant
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    Application.ScreenUpdating = False
    lngCount = frmKasse.lstKasse.ListCount
    With frmKasse.lstKasse
        For l = 0 To .ListCount - 1
          If .Selected(l) Then
            nSelCount = nSelCount + 1
          End If
        Next
    End With
    If frmKasse.txt_OpLieferschein.Value = "PDF" Then
        pdfDatei = frmKasseWA.txt_LSNr
        pdfName = Application.GetSaveAsFilename(Environ("USERPROFILE") & "\Desktop\" & pdfDatei & ".pdf", "PDF-Dateien (*.pdf), *.pdf")
    End If
    Sheets("Druckvorlage").Activate
    Sheets("Druckvorlage").Visible = True
    Last_Row = CDbl(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & Last_Row).Delete
    lng = CLng(frmKasse.lstKasse.ListCount) + 24
    Range("Druckvorlage!A17:F" & lng).Font.Size = 9
    Range("Druckvorlage!D2") = "Lieferschein:"
    Range("Druckvorlage!E2") = "'" & frmKasseWA.txt_LSNr
    Range("Druckvorlage!E5") = "'" & txt_KDNr.Value
    Range("Druckvorlage!E11") = "Lieferschein"
    Range("Druckvorlage!E11").Font.Size = 14
    Range("Druckvorlage!D5") = "Kundennummer:"
    Range("Druckvorlage!D6") = "Auftrags-Nr.:"
    Range("Druckvorlage!E6") = frmKasse.cboAuftragSuchen
    Range("Druckvorlage!E4") = Format(Date, FDate)
    Range("Druckvorlage!E7") = Sheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(frmContact.txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 13)
    Range("Druckvorlage!E16") = ""
    Range("Druckvorlage!F16") = ""
    If nSelCount < lngCount Then
        Range("Druckvorlage!F14") = "Teillieferung"
    Else
        Range("Druckvorlage!F14") = ""
    End If
    Worksheets("Druckvorlage").PageSetup.RightFooter = "&8" & "Seite &P von &N"
    zeTB = 17
    Pos = 1
    If frmKasse.txt_LSNr = "" Then 'And Not Sheets("Daten").Range("F23") = "Auswahl 2" Then
        lngR = CDbl(Sheets("Daten").Range("F25")) + 1
        strLS = Sheets("Daten").Range("F26")
        If CStr(frmKasseWA.txt_LSNr) = CStr(Sheets("Daten").Range("F24") & Format(CDbl(lngR), strLS)) Then
            Sheets("Daten").Range("F25") = "'" & Format(lngR, strLS)
            For lngNr = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
                If Worksheets("Reservierungen").Cells(lngNr, 1) = CStr(frmKasse.cboAuftragSuchen) Then
                    If Sheets("Daten").Range("F23") = "Nein" Then
                        Worksheets("Reservierungen").Cells(lngNr, 26).Value = "'" & frmKasseWA.txt_LSNr
                        Worksheets("Reservierungen").Cells(lngNr, 16).Value = 1
                    Else
                        Worksheets("Reservierungen").Cells(lngNr, 26).Value = "'" & Sheets("Daten").Range("F24") & Format(lngR, strLS)
                        Worksheets("Reservierungen").Cells(lngNr, 16).Value = 1
                    End If
                End If
            Next lngNr
        Else
            For lngNr = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
                If CStr(Worksheets("Reservierungen").Cells(lngNr, 1)) = CStr(frmKasse.cboAuftragSuchen) Then
                    Worksheets("Reservierungen").Cells(lngNr, 26).Value = "'" & frmKasseWA.txt_LSNr
                    Worksheets("Reservierungen").Cells(lngNr, 16).Value = 1
                End If
            Next lngNr
        End If
    End If
    With frmKasse.lstKasse
        For zeLB = 0 To .ListCount - 1
            If .Selected(zeLB) Then
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.lstKasse.List(zeLB, 6)) Then
                            lngID = i
                        End If
                    Next i
                End With
                Sheets("Druckvorlage").Cells(zeTB, 1) = Pos
                Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 1).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmKasse.lstKasse.List(zeLB, 0)
                Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
                If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                    If Not Sheets("Lager").Cells(CDbl(lngID), 32) = "" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & Sheets("Druckvorlage").Cells(zeTB, 3) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                    ElseIf Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" And Sheets("Lager").Cells(CDbl(lngID), 32) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")"
                    ElseIf Sheets("Lager").Cells(CDbl(lngID), 4) = "" And Not Sheets("Lager").Cells(CDbl(lngID), 32) = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                    Else
                        Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
                    End If
                Else
                    Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
                End If
                Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
                If Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                    With ThisWorkbook.Sheets("Leistungen")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 2)) Then
                                xrow = i
                            End If
                        Next i
                    End With
                    Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Leistungen").Cells(CDbl(xrow), 8)
                Else
                    If Not Worksheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 28).Value = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 30).Value
                    Else
                        Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Lager").Cells(CDbl(lngID), 12)
                    End If
                End If
                Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 4).NumberFormat = "@"
                
                zeTB = zeTB + 1
                Pos = Pos + 1
            End If
        Next zeLB
    End With
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To CDbl(Pos) - 1
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    Sheets("Druckvorlage").Cells(zeTB + 2, 1) = "Datum"
    Sheets("Druckvorlage").Cells(zeTB + 2, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeTB + 4, 1) = ". . . . . . . . ."
    Sheets("Druckvorlage").Cells(zeTB + 5, 1) = "Ware erhalten / in Empfang genommen"
    Sheets("Druckvorlage").Cells(zeTB + 5, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeTB + 8, 1) = ". . . . . . . . . . . . . . . . . . "
    Sheets("Druckvorlage").Cells(zeTB + 10, 1) = "Mit freundlichem Gru|fffd|"
    Sheets("Druckvorlage").Cells(zeTB + 10, 1).Font.Size = 11
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Sheets("Druckvorlage").Cells(zeTB + 12, 1) = "'" & Sheets("Daten").Range("B22").Value
        Sheets("Druckvorlage").Cells(zeTB + 12, 1).Font.Size = 11
    Else
        If frmContact.cboAnsp = "" Then
            Sheets("Druckvorlage").Cells(zeTB + 12, 1) = Worksheets("Daten").Range("B9")
            Sheets("Druckvorlage").Cells(zeTB + 12, 1).Font.Size = 11
        Else
            Sheets("Druckvorlage").Cells(zeTB + 12, 1) = frmContact.cboAnsp.Text
            Sheets("Druckvorlage").Cells(zeTB + 12, 1).Font.Size = 11
        End If
    End If
    If frmKasse.txt_OpLieferschein.Value = "Print" Then
        If frmKasse.txt_PrintLS.Value = "WA" Or txt_RL = "RL" Then
            Worksheets("Druckvorlage").PrintOut
        Else
            Kopien = Application.InputBox("Anzahl Kopien", "Lieferschein drucken", 1)
            If Kopien = False Then
                Exit Sub
                Application.ScreenUpdating = True
            End If
            Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
        End If
    Else
        pdfDatei = frmKasse.txtRnr.Text
        Sheets("Druckvorlage").ExportAsFixedFormat Type:=xlTypePDF, Filename:=pdfName, _
                              Quality:=xlQualityStandard, IncludeDocProperties:=False, IgnorePrintAreas:=False, _
                              OpenAfterPublish:=True
    End If
    frmKasse.txt_LSNr.Value = CStr(frmKasseWA.txt_LSNr)
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    If frmKasseWA.txt_RL = "RL" Then
        MsgBox "Rechnung und Lieferschein werden gedruckt!", , "Ausdruck"
        frmKasse.txt_OpLieferschein.Value = ""
        frmKasse.txt_OpRechnung.Value = ""
        frmKasse.txt_PrintRE.Value = ""
        Exit Sub
    Else
        If frmKasse.txt_OpLieferschein.Value = "Print" Then
            MsgBox "Lieferschein wird gedruckt!", , "Lieferschein drucken"
        Else
            MsgBox "Lieferschein wird als PDF gespeichert!", , "Lieferschein als PDF"
        End If
    End If
    frmKasse.txt_OpLieferschein.Value = ""
End Sub

Sub Rechnung() 'v1.44
    Dim zeLB, zeTB, KIDlng, Pos, lngID, Farbe, spLB, lngKID, lng, lngR, lngNr As Long
    Dim nSelCount, l, lngCount, Last_Row, xrow As Long
    Dim pdfName, pdfDatei, strRE, FDate As String
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row2 As Long
    Dim ZahlMwsT1, ZahlMwsT2 As Double
    Dim Kopien As Variant
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    lngCount = frmKasse.lstKasse.ListCount
    With frmKasse.lstKasse
        For l = 0 To .ListCount - 1
          If .Selected(l) Then
            nSelCount = nSelCount + 1
          End If
        Next
    End With
    Application.ScreenUpdating = False
    Sheets("Druckvorlage").Activate
    If frmKasse.txt_OpRechnung.Value = "PDF" Then
        pdfDatei = frmKasseWA.txt_Nummer
        pdfName = Application.GetSaveAsFilename(Environ("USERPROFILE") & "\Desktop\" & pdfDatei & ".pdf", "PDF-Dateien (*.pdf), *.pdf")
    End If
    Last_Row = CDbl(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & Last_Row).Delete
    lng = CLng(frmKasse.lstKasse.ListCount) + 24
    Range("Druckvorlage!A17:F" & lng).Font.Size = 9
    Sheets("Druckvorlage").Visible = True
    Range("Druckvorlage!D2") = "RE - Nummer:"
    Range("Druckvorlage!E2") = "'" & frmKasseWA.txt_Nummer
    lngKID = Worksheets("Kunden").Range("A:A").Find(frmContact.txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row
    If frmKasse.cboart2 = "Barverkauf" Then
        Range("Druckvorlage!E11") = "Barverkauf"
    Else
        Range("Druckvorlage!E11") = "Rechnung"
    End If
    Range("Druckvorlage!E11").Font.Size = 14
    Range("Druckvorlage!D5") = "Kundennummer:"
    Range("Druckvorlage!E4") = Format(Date, FDate)
    Range("Druckvorlage!E5") = "'" & txt_KDNr.Value
    If Not frmKasse.cboAuftragSuchen = "" Then
        Range("Druckvorlage!D6") = "Auftrags-Nr:"
        Range("Druckvorlage!E6") = frmKasse.cboAuftragSuchen
    Else
        Range("Druckvorlage!D6") = ""
        Range("Druckvorlage!E6") = ""
    End If
    Range("Druckvorlage!E7") = Sheets("Kunden").Cells(CDbl(lngKID), 13)
    Range("Druckvorlage!E16") = "Preis"
    Range("Druckvorlage!F16") = "Betrag"
    If nSelCount < lngCount Then
        Range("Druckvorlage!F14") = "Teilrechnung"
    Else
        Range("Druckvorlage!F14") = ""
    End If
    Worksheets("Druckvorlage").PageSetup.RightFooter = "&8" & "Seite &P von &N"
    zeTB = 17
    Pos = 1
    Application.ScreenUpdating = False
    If frmKasse.txt_RENr = "" Then 'And Not Sheets("Daten").Range("D23") = "Auswahl 2" Then
        lngR = CDbl(Sheets("Daten").Range("D25")) + 1
        strRE = Sheets("Daten").Range("D26")
        If CStr(frmKasseWA.txt_Nummer) = CStr(Sheets("Daten").Range("D24") & Format(CDbl(lngR), strRE)) Then
            Sheets("Daten").Range("D25") = "'" & Format(lngR, strRE)
            For lngNr = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
                If Worksheets("Reservierungen").Cells(lngNr, 1) = CStr(frmKasse.cboAuftragSuchen) Then
                    If Sheets("Daten").Range("D23") = "Nein" Then
                        Worksheets("Reservierungen").Cells(lngNr, 25).Value = "'" & frmKasseWA.txt_Nummer
                        Worksheets("Reservierungen").Cells(lngNr, 15).Value = 1
                    Else
                        Worksheets("Reservierungen").Cells(lngNr, 25).Value = "'" & Sheets("Daten").Range("D24") & Format(lngR, strRE)
                        Worksheets("Reservierungen").Cells(lngNr, 15).Value = 1
                    End If
                End If
            Next lngNr
        Else
            For lngNr = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
                If Worksheets("Reservierungen").Cells(lngNr, 1) = CStr(frmKasse.cboAuftragSuchen) Then
                    Worksheets("Reservierungen").Cells(lngNr, 25).Value = "'" & frmKasseWA.txt_Nummer
                    Worksheets("Reservierungen").Cells(lngNr, 15).Value = 1
                End If
            Next lngNr
        End If
    End If
    With frmKasse.lstKasse
        For zeLB = 0 To .ListCount - 1
            If .Selected(zeLB) Then
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.lstKasse.List(zeLB, 6)) Then
                            lngID = i
                        End If
                    Next i
                End With
                Sheets("Druckvorlage").Cells(zeTB, 1) = Pos
                Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 1).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmKasse.lstKasse.List(zeLB, 0)
                Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
                If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                    If Not Sheets("Lager").Cells(CDbl(lngID), 32) = "" Then
                        If Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        ElseIf Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        ElseIf frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        End If
                    Else
                        If Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt"
                        ElseIf Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt"
                        ElseIf frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")"
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
                        End If
                    End If
                Else
                    Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
                End If
                Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
                If Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                    With ThisWorkbook.Sheets("Leistungen")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 2)) Then
                                xrow = i
                            End If
                        Next i
                    End With
                    Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Leistungen").Cells(CDbl(xrow), 8)
                Else
                    If Not Worksheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 28).Value = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 30).Value
                    Else
                        Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Lager").Cells(CDbl(lngID), 12)
                    End If
                End If
                Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 4).NumberFormat = "@"
                If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 28) = "" Then
                    Sheets("Druckvorlage").Cells(zeTB, 5) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4) / Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 29)), "currency")
                Else
                    Sheets("Druckvorlage").Cells(zeTB, 5) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4)), "currency")
                End If
                Sheets("Druckvorlage").Cells(zeTB, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 5).VerticalAlignment = xlTop
                If Not frmKasse.cboAuftragSuchen = "" Then
                    If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 28) = "" Then
                        If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl((Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13) - CDbl((Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13) * Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9))))) * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 29)), "currency")
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4)), "currency") '* Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 29)), "currency")
                        End If
                    Else
                        If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl((Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13) - CDbl((Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13) * Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9))))) * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 7)), "currency")
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4) * Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 7)), "currency")
                        End If
                    End If
                Else
                    If Not Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 21) = "" Then
                        If Not Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl((Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13)) - (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13)) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9)))) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 22)), "currency")
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4) * Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 22)), "currency")
                        End If
                    Else
                        If Not Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl((Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13)) - (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 13)) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 9)))) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 7)), "currency")
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl(frmKasse.lstKasse.List(zeLB, 4) * Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 7)), "currency")
                        End If
                    End If
                End If
                Sheets("Druckvorlage").Cells(zeTB, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 6).VerticalAlignment = xlTop
                zeTB = zeTB + 1
                Pos = Pos + 1
            End If
        Next
    End With
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To CDbl(Pos) - 1
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    Sheets("Druckvorlage").Cells(zeTB + 2, 5) = "Zwischensumme:"
    Sheets("Druckvorlage").Cells(zeTB + 2, 5).HorizontalAlignment = xlRight
    Sheets("Druckvorlage").Cells(zeTB + 2, 6) = Format(CDbl(frmKasse.lbl_sum12), "currency")
    Sheets("Druckvorlage").Cells(zeTB + 2, 6).HorizontalAlignment = xlRight
    If CDbl(frmKasse.lbl_Rabatt.Caption) > 0 Then
        If Not CDbl(frmKasse.txt_MWSTG2.Value) > 0 Or frmKasse.txt_MWSTG2.Value = "" Then
            Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "Rabatt:"
            Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 3, 6) = "-" & Format(CDbl(frmKasse.lbl_Rabatt), "currency")
            Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
            Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 6) = frmKasse.txt_MWSTV2.Value
            Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 5, 5) = "Gesamtsumme:"
            Sheets("Druckvorlage").Cells(zeTB + 5, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 5, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
            Sheets("Druckvorlage").Cells(zeTB + 5, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 7, 1) = "Mit freundlichem Gru|fffd|"
            Sheets("Druckvorlage").Cells(zeTB + 7, 1).Font.Size = 11
            If Not Sheets("Daten").Range("B22").Value = "" Then
                Sheets("Druckvorlage").Cells(zeTB + 9, 1) = "'" & Sheets("Daten").Range("B22").Value
                Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
            Else
                If frmContact.cboAnsp = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1) = Worksheets("Daten").Range("B9")
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                Else
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1) = frmContact.cboAnsp.Text
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                End If
            End If
        Else
            Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "Rabatt:"
            Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 3, 6) = "-" & Format(CDbl(frmKasse.lbl_Rabatt), "currency")
            Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B3") * 100) & " %:"
            Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 6) = frmKasse.txt_MWSTG2.Value
            Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 5, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
            Sheets("Druckvorlage").Cells(zeTB + 5, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 5, 6) = frmKasse.txt_MWSTV2.Value
            Sheets("Druckvorlage").Cells(zeTB + 5, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 6, 5) = "Gesamtsumme:"
            Sheets("Druckvorlage").Cells(zeTB + 6, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 6, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
            Sheets("Druckvorlage").Cells(zeTB + 6, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 8, 1) = "Mit freundlichem Gru|fffd|"
            Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
            If Not Sheets("Daten").Range("B22").Value = "" Then
                Sheets("Druckvorlage").Cells(zeTB + 10, 1) = "'" & Sheets("Daten").Range("B22").Value
                Sheets("Druckvorlage").Cells(zeTB + 10, 1).Font.Size = 11
            Else
                If frmContact.cboAnsp = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 10, 1) = Worksheets("Daten").Range("B9")
                    Sheets("Druckvorlage").Cells(zeTB + 10, 1).Font.Size = 11
                Else
                    Sheets("Druckvorlage").Cells(zeTB + 10, 1) = frmContact.cboAnsp.Text
                    Sheets("Druckvorlage").Cells(zeTB + 10, 1).Font.Size = 11
                End If
            End If
        End If
    Else
        If Worksheets("Daten").Range("F36") = "Ja" Then
            ZahlMwsT1 = CLng(frmKasse.txt_MWSTG.Value / 0.05) * 0.05
            ZahlMwsT2 = CLng(frmKasse.txt_MWSTV.Value / 0.05) * 0.05
        Else
            ZahlMwsT1 = CLng(frmKasse.txt_MWSTG.Value)
            ZahlMwsT2 = CLng(frmKasse.txt_MWSTV.Value)
        End If
        If Not CDbl(frmKasse.txt_MWSTG2.Value) > 0 Or frmKasse.txt_MWSTG2.Value = "" Then
            Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
            Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 3, 6) = Format(ZahlMwsT2, "currency")
            Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "Gesamtsumme:"
            Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
            Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 6, 1) = "Mit freundlichem Gru|fffd|"
            Sheets("Druckvorlage").Cells(zeTB + 6, 1).Font.Size = 11
            If Not Sheets("Daten").Range("B22").Value = "" Then
                Sheets("Druckvorlage").Cells(zeTB + 8, 1) = "'" & Sheets("Daten").Range("B22").Value
                Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
            Else
                If frmContact.cboAnsp = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 8, 1) = Worksheets("Daten").Range("B9")
                    Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
                Else
                    Sheets("Druckvorlage").Cells(zeTB + 8, 1) = frmContact.cboAnsp.Text
                    Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
                End If
            End If
        Else
            Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B3") * 100) & " %:"
            Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 3, 6) = Format(ZahlMwsT1, "currency")
            Sheets("Druckvorlage").Cells(zeTB + 3, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
            Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 4, 6) = Format(ZahlMwsT2, "currency")
            Sheets("Druckvorlage").Cells(zeTB + 4, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 5, 5) = "Gesamtsumme:"
            Sheets("Druckvorlage").Cells(zeTB + 5, 5).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 5, 6) = Format(CDbl(Format(frmKasse.lbl_sum22)), "currency")
            Sheets("Druckvorlage").Cells(zeTB + 5, 6).HorizontalAlignment = xlRight
            Sheets("Druckvorlage").Cells(zeTB + 7, 1) = "Mit freundlichem Gru|fffd|"
            Sheets("Druckvorlage").Cells(zeTB + 7, 1).Font.Size = 11
            If Not Sheets("Daten").Range("B22").Value = "" Then
                Sheets("Druckvorlage").Cells(zeTB + 9, 1) = "'" & Sheets("Daten").Range("B22").Value
                Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
            Else
                If frmContact.cboAnsp = "" Then
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1) = Worksheets("Daten").Range("B9")
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                Else
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1) = frmContact.cboAnsp.Text
                    Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
                End If
            End If
        End If
    End If
    If Not frmKasseWA.txt_Art = "REPDF" Then
        If frmKasse.txt_PrintRE.Value = "WA" Or txt_RL = "RL" Then
            Worksheets("Druckvorlage").PrintOut
        Else
            Kopien = Application.InputBox("Anzahl Kopien", "Rechnung drucken", 1)
            If Kopien = False Then
                Exit Sub
                Application.ScreenUpdating = True
            End If
            Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
        End If
    Else
        pdfDatei = frmKasse.txtRnr.Text
        Sheets("Druckvorlage").ExportAsFixedFormat Type:=xlTypePDF, Filename:=pdfName, _
                              Quality:=xlQualityStandard, IncludeDocProperties:=False, IgnorePrintAreas:=False, _
                              OpenAfterPublish:=True
    End If
    If frmKasse.cboAuftragSuchen = "" And frmKasse.cbo_Angebot = "" Then
        For KIDlng = 0 To frmKasse.lstKasse.ColumnCount - 1
            Sheets("Kassendaten").Cells(frmKasse.lstKasse.List(KIDlng, 7), 18) = frmContact.txt_KDID.Value
        Next
    Else
        For KIDlng = 0 To frmKasse.lstKasse.ColumnCount - 1
            Sheets("Reservierungen").Cells(frmKasse.lstKasse.List(KIDlng, 7), 19) = frmContact.txt_KDID.Value
        Next
    End If
    frmKasse.txt_RENr.Value = CStr(frmKasseWA.txt_Nummer.Value)
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    frmKasse.txt_KDID.Value = txt_KDID.Value
    If frmKasseWA.txt_RL = "RL" Then
        Call Lieferschein
        Exit Sub
    Else
        If frmKasse.cboart2 = "Barverkauf" Then
            MsgBox "Beleg wurde gedruckt!", , "Barverkauf"
        ElseIf Not frmKasseWA.txt_Art = "REPDF" Then
            MsgBox "Rechnung wurde gedruckt!", , "Rechnung " + frmKasse.txtRnr + " wurde gedruckt"
        Else
            MsgBox "Rechnung wurde als PDF gespeichert!", , "Rechnung " + frmKasse.txtRnr + " als PDF"
        End If
        frmKasse.txt_OpRechnung.Value = ""
        frmKasse.txt_PrintRE.Value = ""
    End If
End Sub

Sub Auftrag() 'v1.44
    Dim zeLB, zeTB, KIDlng, Pos, lngID, Farbe, spLB, lngKID, lng As Long
    Dim nSelCount, l, lngCount, Last_Row, xrow As Long
    Dim pdfName, pdfDatei, FDate As String
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row2 As Long
    Dim Kopien As Variant
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    lngCount = frmKasse.lstKasse.ListCount
    With frmKasse.lstKasse
        For l = 0 To .ListCount - 1
          If .Selected(l) Then
            nSelCount = nSelCount + 1
          End If
        Next
    End With
    Application.ScreenUpdating = False
    Sheets("Druckvorlage").Activate
    If txt_IDART = "APDF" Then
        pdfDatei = CStr(frmKasse.txtRnr)
        pdfName = Application.GetSaveAsFilename(Environ("USERPROFILE") & "\Desktop\" & pdfDatei & ".pdf", "PDF-Dateien (*.pdf), *.pdf")
    End If
    Last_Row = CDbl(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & Last_Row).Delete
    lng = CLng(frmKasse.lstKasse.ListCount) + 24
    Range("Druckvorlage!A17:F" & lng).Font.Size = 9
    Sheets("Druckvorlage").Visible = True
    Range("Druckvorlage!D2") = "Auftrag:"
    If Not frmKasse.txtAdatum.Value = "" Then
        Range("Druckvorlage!D3") = "F|fffd|llig am:"
        Range("Druckvorlage!E3") = frmKasse.txtAdatum
    Else
        Range("Druckvorlage!D3") = ""
        Range("Druckvorlage!E3") = ""
    End If
    Range("Druckvorlage!E2") = "'" & frmKasse.txtRnr.Text
    lngKID = Worksheets("Kunden").Range("A:A").Find(frmContact.txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row
    Range("Druckvorlage!E11") = "Auftrag"
    Range("Druckvorlage!E11").Font.Size = 14
    Range("Druckvorlage!D5") = "Kundennummer:"
    Range("Druckvorlage!D6") = ""
    Range("Druckvorlage!E4") = Format(Date, FDate)
    Range("Druckvorlage!E5") = "'" & txt_KDNr.Value
    Range("Druckvorlage!E6") = ""
    Range("Druckvorlage!E7") = Sheets("Kunden").Cells(CDbl(lngKID), 13)
    Range("Druckvorlage!E16") = "Preis"
    Range("Druckvorlage!F16") = "Betrag"
    If nSelCount < lngCount Then
        Range("Druckvorlage!F14") = "Teilrechnung"
    Else
        Range("Druckvorlage!F14") = ""
    End If
    Worksheets("Druckvorlage").PageSetup.RightFooter = "&8" & "Seite &P von &N"
    zeTB = 17
    Pos = 1
    Application.ScreenUpdating = False
    With frmKasse.lstKasse
        For zeLB = 0 To .ListCount - 1
            If .Selected(zeLB) Then
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.lstKasse.List(zeLB, 6)) Then
                            lngID = i
                        End If
                    Next i
                End With
                Sheets("Druckvorlage").Cells(zeTB, 1) = Pos
                Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 1).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmKasse.lstKasse.List(zeLB, 0)
                Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
                If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                    If Not Sheets("Lager").Cells(CDbl(lngID), 32) = "" Then
                        If Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        ElseIf Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        ElseIf frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & CDbl(Sheets("Lager").Cells(CLng(lngID), 32)) & " kg"
                        End If
                    Else
                        If Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")" & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt"
                        ElseIf Not frmKasse.lstKasse.List(zeLB, 3) = "0%" And Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " / " & frmKasse.lstKasse.List(zeLB, 3) & " Rabatt"
                        ElseIf frmKasse.lstKasse.List(zeLB, 3) = "0%" And Not Sheets("Lager").Cells(CDbl(lngID), 4) = "" Then
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1) & " (" & Sheets("Lager").Cells(CDbl(lngID), 4) & ")"
                        Else
                            Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
                        End If
                    End If
                Else
                    Sheets("Druckvorlage").Cells(zeTB, 3) = frmKasse.lstKasse.List(zeLB, 1)
                End If
                Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
                If Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then
                    With ThisWorkbook.Sheets("Leistungen")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 2) = CStr(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 2)) Then
                                xrow = i
                            End If
                        Next i
                    End With
                    Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Leistungen").Cells(CDbl(xrow), 8)
                Else
                    If Not Worksheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 28).Value = "" Then
                        Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(zeLB, 7)), 30).Value
                    Else
                        Sheets("Druckvorlage").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Lager").Cells(CDbl(lngID), 12)
                    End If
                End If
                Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 4).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(zeTB, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 6).VerticalAlignment = xlTop
                zeTB = zeTB + 1
                Pos = Pos + 1
            End If
        Next
    End With
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To CDbl(Pos) - 1
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    Sheets("Druckvorlage").Cells(zeTB + 2, 1) = "Auftrag erstellt durch ..."
    Sheets("Druckvorlage").Cells(zeTB + 2, 1).Font.Size = 11
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Sheets("Druckvorlage").Cells(zeTB + 3, 1) = "'" & Sheets("Daten").Range("B22").Value
        Sheets("Druckvorlage").Cells(zeTB + 3, 1).Font.Size = 11
    Else
        If frmContact.cboAnsp = "" Then
            Sheets("Druckvorlage").Cells(zeTB + 3, 1) = Worksheets("Daten").Range("B9")
            Sheets("Druckvorlage").Cells(zeTB + 3, 1).Font.Size = 11
        Else
            Sheets("Druckvorlage").Cells(zeTB + 3, 1) = frmContact.cboAnsp.Text
            Sheets("Druckvorlage").Cells(zeTB + 3, 1).Font.Size = 11
        End If
    End If
    If txt_IDART = "APRI" Then
        Kopien = Application.InputBox("Anzahl Kopien", "Auftrag drucken", 1)
        If Kopien = False Then
            Exit Sub
            Application.ScreenUpdating = True
        End If
        Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
    Else
        pdfDatei = frmKasse.txtRnr.Text
        Sheets("Druckvorlage").ExportAsFixedFormat Type:=xlTypePDF, Filename:=pdfName, _
                              Quality:=xlQualityStandard, IncludeDocProperties:=False, IgnorePrintAreas:=False, _
                              OpenAfterPublish:=True
    End If
    If frmKasse.cboAuftragSuchen = "" And frmKasse.cbo_Angebot = "" Then
        For KIDlng = 0 To frmKasse.lstKasse.ColumnCount - 1
            Sheets("Kassendaten").Cells(frmKasse.lstKasse.List(KIDlng, 7), 18) = frmContact.txt_KDID.Value
        Next
    Else
        For KIDlng = 0 To frmKasse.lstKasse.ColumnCount - 1
            Sheets("Reservierungen").Cells(frmKasse.lstKasse.List(KIDlng, 7), 19) = frmContact.txt_KDID.Value
        Next
    End If
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    frmKasse.txt_KDID.Value = txt_KDID.Value
End Sub
Attribute VB_Name = "frmEingang"
Attribute VB_Base = "0{1C78826B-EB16-4520-9480-D61498FCEC95}{50594525-DA14-4970-83A9-D566C2D3923C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim irow, ALetzte, lbtime  As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    txt_SacnEin.Value = ""
    ALetzte = Sheets("Bestellung").Cells(Rows.Count, 1).End(xlUp).Row
    Set DIC = CreateObject("scripting.dictionary")
    For irow = 2 To ALetzte
        If Not IsEmpty(Sheets("Bestellung").Cells(irow, 1)) Then
            xKey = Sheets("Bestellung").Cells(irow, 1).Value
            DIC(xKey) = 0
        End If
    Next
    For Each xKey In DIC
        cboeingang.AddItem xKey
    Next
    DIC.RemoveAll
    Set DIC = Nothing
    If cboeingang.ListIndex = -1 Then cboeingang = "Keine Bestellung vorhanden"
    Call sortieren
    cboeingang.ListIndex = -1 '-1 damit es keinen Fehler gibt, wenn keine Bestellung vorhanden ist
    lbtime = Time
    If cboeingang = "Keine Bestellung vorhanden" Then
        Cmd_close.SetFocus
    End If
End Sub

Private Sub cmd_BestAendern_Click()
    If cboeingang = "" Then Exit Sub
    frmBestellung.cboVAuftrag = cboeingang
    frmBestellung.txt_Eingang.Value = "Eingang"
    frmBestellung.Show
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Schlie|fffd|en"" beenden!", , "Hinweis"
        Cmd_close.SetFocus
        Cancel = True
    End If
End Sub

Private Sub cmd_BarcodeEin_Click() 'v1.39
    If cboeingang = "Keine Bestellung vorhanden" Then Exit Sub
    If frmEingang.cboeingang = "" Then
        MsgBox "Bitte w|fffd|hlen Sie erst eine Bestellung aus!", , "Hinweis"
        frmEingang.cboeingang.SetFocus
    Else
        txt_SacnEin.Value = "Eingang"
        frmBarcode.cmd_BCAusbuchen.Caption = "Einbuchen"
        frmBarcode.Caption = "Barcode Wareneingang" & " Nr.:" & cboeingang
        frmBarcode.txt_BarcodeArt.Value = "Eingang"
        frmBarcode.txt_KasseNr.Value = cboeingang
        frmBarcode.check_HLager.Enabled = False
        frmBarcode.lbl_HLager.Enabled = False
        frmBarcode.check_NBestand.Enabled = False
        frmBarcode.lbl_NBestand.Enabled = False
        frmBarcode.Show
    End If
End Sub

Private Sub cmdTeillieferung_Click() 'v1.43
    lbl_status.Visible = True
    lbl_status.Caption = "Teillieferung wird gebucht!"
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    Application.Wait (Now + TimeValue("00:00:01"))
    Call TeilL
End Sub

Sub TeilL() '1.44
    Dim lngZeile, arrTmpA, arrTmpB, i, Last_Row, plng As Long
    Dim lngwert, lngwert2 As Double
    Dim iSelCnt, ix, xrow, brow, lngIndex, l, intRow, listenwert, Datumstxt As Long

    Dim blnMarkiert As Boolean
    Dim lngMsg, DatumLong, strBLS As String
    On Error Resume Next

    iSelCnt = 0
    For ix = 0 To lstWAimput.ListCount - 1
        If lstWAimput.Selected(ix) = True Then iSelCnt = iSelCnt + 1
    Next ix
    If iSelCnt = 0 Then
        Exit Sub
    ElseIf iSelCnt > 1 Then
        MsgBox "Bitte markieren Sie nur einen Artikel!"
        For intRow = 0 To Me!lstWAimput.ListCount - 1
            Me!lstWAimput.Selected(intRow) = False
        Next intRow
        Exit Sub
    End If
    With Worksheets("Wareneingang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If Sheets("Daten").Range("F28").Value = "Ja" Then
        strBLS = InputBox("Bitte geben Sie die Lieferschein-Nr. ein!", "Lieferschein")
    End If
    Application.ScreenUpdating = False
    If frmEingang.cboeingang = "" Then Exit Sub
    With ThisWorkbook.Worksheets("Wareneingang")
        With lstWAimput
            For l = 0 To .ListCount - 1
                If frmEingang.lstWAimput.Selected(l) Then
                    If lstWAimput.List(l, 4) = "" Then GoTo weiter
                    lngMsg = InputBox("Geben Sie die erhaltende Menge f|fffd|r diesen Artikel (" + lstWAimput.List(l, 3) + ") ein!", "Teillieferung")
                    If lngMsg = "" Then Exit Sub
                    Datumstxt = MsgBox("M|fffd|chten Sie das aktuelle Datum verwenden?", vbYesNo, "Wareneingangsdatum")
                    If Datumstxt = vbNo Then
                        DatumLong = InputBox("Bitte geben Sie ein Datum ein!" & vbLf & "Format: DD.MM.YYYY", "Wareneingang am:")
                        If DatumLong = "" Or Not IsDate(DatumLong) Then
                            DatumLong = Date
                        Else
                            If CDate(DatumLong) > Date Then
                                MsgBox "Datum liegt in der Zukunft!", , "Hinweis"
                                Application.ScreenUpdating = True
                                Exit Sub
                            End If
                        End If
                    End If
                    If Not IsNumeric(lngMsg) Then
                        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
                        Application.ScreenUpdating = True
                        Exit Sub
                    End If
                    If CDbl(lngMsg) > frmEingang.lstWAimput.List(l, 4) Then
                        MsgBox "Die angegebende Menge ist gr|fffd||fffd|er als die bestellte!", vbOKOnly, "Hinweis"
                        Application.ScreenUpdating = True
                        Exit Sub
                    Else
                        If Not Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 14) = "" Then
                            With ThisWorkbook.Sheets("Lagerorte")
                                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                                arrTmpA = .Range("A1:AO" & Last_Row)
                                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                                For i = 2 To UBound(arrTmpA)
                                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 14)) Then
                                        xrow = i
                                    End If
                                Next i
                            End With
                            If Not Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 16) = "" Then
                                lngwert2 = CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6) - lngMsg)
                                lngwert = CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 17)) / CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6))
                                Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 17) = (lngwert * lngwert2)
                                Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6) = CDbl(lngwert2)
                                Sheets("Lagerorte").Cells(xrow, 4).Value = CDbl(Sheets("Lagerorte").Cells(xrow, 4).Value) + (CDbl(lngMsg * lngwert))
                            Else
                                lngwert = CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6))
                                Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6) = CDbl(lngwert - lngMsg)
                                Sheets("Lagerorte").Cells(xrow, 4).Value = CDbl(Sheets("Lagerorte").Cells(xrow, 4).Value) + (CDbl(lngMsg))
                            End If
                        Else
                            With ThisWorkbook.Sheets("Lager")
                                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                                arrTmpA = .Range("A1:AO" & Last_Row)
                                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                                For i = 2 To UBound(arrTmpA)
                                    If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(frmEingang.lstWAimput.List(l, 8)) Then
                                        xrow = i
                                    End If
                                Next i
                            End With
                            If Not Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 16) = "" Then
                                lngwert2 = CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6) - lngMsg)
                                lngwert = CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 17)) / CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6))
                                Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 17) = (lngwert * lngwert2)
                                Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6) = CDbl(lngwert2)
                                Sheets("Lager").Cells(xrow, 8).Value = CDbl(Sheets("Lager").Cells(xrow, 8).Value) + (CDbl(lngMsg * lngwert))
                            Else
                                lngwert = CDbl(Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6))
                                Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(l, 1), 6) = CDbl(lngwert - lngMsg)
                                Sheets("Lager").Cells(xrow, 8).Value = CDbl(Sheets("Lager").Cells(xrow, 8).Value) + (CDbl(lngMsg))
                            End If
                        End If
                        lngZeile = Worksheets("Wareneingang").Cells(Rows.Count, 1).End(xlUp).Row
                        Sheets("Wareneingang").Activate
                        For lngIndex = 0 To lstWAimput.ListCount - 1
                            If lstWAimput.Selected(lngIndex) = True Then
                                lngZeile = lngZeile + 1
                                Worksheets("Wareneingang").Cells(lngZeile, 1).Value = cboeingang.Text 'Liefernummer
                                Worksheets("Wareneingang").Cells(lngZeile, 2).Value = Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 2) 'Lieferant
                                Worksheets("Wareneingang").Cells(lngZeile, 3).Value = "'" & lstWAimput.Column(2, lngIndex) 'Artikelnummer
                                Worksheets("Wareneingang").Cells(lngZeile, 4).Value = "'" & lstWAimput.Column(5, lngIndex) 'Herstellernummer
                                Worksheets("Wareneingang").Cells(lngZeile, 5).Value = lstWAimput.Column(3, lngIndex)
                                plng = lstWAimput.Column(1, lngIndex)
                                If Not Worksheets("Bestellung").Cells(plng, 17) = "" Then
                                    Worksheets("Wareneingang").Cells(lngZeile, 6).Value = CDbl(lngMsg * lngwert)
                                Else
                                    Worksheets("Wareneingang").Cells(lngZeile, 6).Value = CDbl(lngMsg)
                                End If
                                Worksheets("Wareneingang").Cells(lngZeile, 7).Value = Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 8)
                                If Datumstxt = vbYes Then
                                    Worksheets("Wareneingang").Cells(lngZeile, 8).Value = Date
                                    Worksheets("Wareneingang").Cells(lngZeile, 9).Value = Format(Time, "hh:mm:ss")
                                Else
                                    Worksheets("Wareneingang").Cells(lngZeile, 10).Value = CDate(DatumLong)
                                End If
                                Worksheets("Wareneingang").Cells(lngZeile, 9).Value = Format(Time, "hh:mm:ss")
                                Worksheets("Wareneingang").Cells(lngZeile, 10).Value = "Teillieferung"
                                Worksheets("Wareneingang").Cells(lngZeile, 11).Value = CDbl(lstWAimput.Column(9, lngIndex)) 'EK Preis pro St|fffd|ck
                                Worksheets("Wareneingang").Cells(lngZeile, 12).Value = lstWAimput.Column(8, lngIndex) 'ID
                                If Sheets("Daten").Range("B5").Value = "True" Then
                                    Worksheets("Wareneingang").Cells(lngZeile, 13).Value = Sheets("Daten").Range("B24").Value
                                End If
                                Worksheets("Wareneingang").Cells(lngZeile, 16).Value = Format(Date, "MMMM")
                                Worksheets("Wareneingang").Cells(lngZeile, 17).Value = Format(Date, "YYYY")
                                Worksheets("Wareneingang").Cells(lngZeile, 18).Value = lstWAimput.Column(7, lngIndex)
                                Worksheets("Wareneingang").Cells(lngZeile, 19).Value = strBLS
                            End If
                        Next
                    End If
                End If
            Next
        End With
        Application.ScreenUpdating = True
        Call SuchenEingang
weiter:
    End With
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call SuchenEingang
    lbl_status.Visible = False
End Sub

Private Sub cmdWEDruck_Click()
    lbl_status.Visible = True
    lbl_status.Caption = "Wareneingansschein wird gedruckt!"
    Application.Wait (Now + TimeValue("00:00:01"))
    Call WEschein
End Sub

Private Sub cmbMA_Click()
    Dim intRow As Long
    For intRow = 0 To Me!lstWAimput.ListCount - 1
        Me!lstWAimput.Selected(intRow) = False
    Next intRow
End Sub

Private Sub cboeingang_Click()
    If Not cboeingang = "" Then cmd_BestAendern.Visible = True
    Call SuchenEingang
    Call select_all
End Sub

Private Sub cmdchanel_Click()
    If tbABackup.Value = "" Then
        frmLager.txt_item.SetFocus
    Else
        frmLager.cboArtikelnummer.Value = tbABackup.Value
    End If
    Unload frmEingang
    frmLager.Show
End Sub

Sub WEBuchen() '1.44
    Dim lngZeile, lngIndex, lngLine, listenwert, plng, lngrow, stxt, Datumstxt As Long
    Dim objLines, objItems As Collection
    Dim blnMarkiert As Boolean
    Dim strArticle, DatumLong, strBLS As String
    Dim dblAnzahl As Double
    Dim arrTmpA2, arrTmpB2, i2 As Long, n2, lng2, lngs2 As Long
    Dim Last_Row2 As Long
    On Error Resume Next
    If cboeingang.Value = "Keine Bestellung vorhanden" Or cboeingang.Value = "No order exists" Or cboeingang.Text = "" Then
        MsgBox "Es wurde keine Auswahl getroffen!", vbOKOnly, "Wareneingang"
        lbl_status.Visible = False
        Exit Sub
    End If
    If Sheets("Daten").Range("F28").Value = "Ja" Then
        strBLS = InputBox("Bitte geben Sie die Lieferschein-Nr. ein!", "Lieferschein")
    End If
    stxt = MsgBox("M|fffd|chten Sie die Bestellung " + cboeingang.Text + " jetzt einbuchen?", vbYesNo, "Wareneingang")
    If stxt = vbNo Then
        lbl_status.Visible = False
        Exit Sub
    End If
    If cboeingang.Value = "" Then Exit Sub
    'Pruefen ob markiert
    For listenwert = 0 To lstWAimput.ListCount - 1
        If lstWAimput.Selected(listenwert) Then
            blnMarkiert = True
            Exit For
        End If
    Next listenwert
    If blnMarkiert = False Then
        MsgBox "Es wurde keine Auswahl f|fffd|r den Warenausgang getroffen! Bitte makrieren Sie mindestens ein Artikel!", _
        vbExclamation, "Hinweis!"
        lbl_status.Visible = False
        Exit Sub
    End If
    With Worksheets("Wareneingang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    Datumstxt = MsgBox("M|fffd|chten Sie das aktuelle Datum verwenden?", vbYesNo, "Wareneingangsdatum")
    If Datumstxt = vbNo Then
        DatumLong = InputBox("Bitte geben Sie ein Datum ein!" & vbLf & "Format: DD.MM.YYYY", "Wareneingang am:")
        If DatumLong = "" Then
            MsgBox "Es wurde kein Datum angegeben!", , "Datum fehlt!"
            lbl_status.Visible = False
            Exit Sub
        End If
    End If
    Application.ScreenUpdating = False
    Set objLines = New Collection
    Set objItems = New Collection
    With ThisWorkbook.Worksheets("Lager")
        For lngIndex = 0 To lstWAimput.ListCount - 1
            If lstWAimput.Selected(lngIndex) Then
                strArticle = lstWAimput.List(lngIndex, 8)
                dblAnzahl = 0
                lngLine = 0
                plng = 0
                If Not Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 14) = "" Then
                    lngLine = 0
                    With ThisWorkbook.Sheets("Lagerorte")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 10, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 1) = CStr(Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 14).Text) Then
                                lngLine = i2
                            End If
                        Next i2
                    End With
                    If lngLine > 0 Then
                        plng = lstWAimput.Column(1, lngIndex)
                        If Not Worksheets("Bestellung").Cells(plng, 16) = "" Then
                            Worksheets("Lagerorte").Cells(lngLine, 4).Value = Worksheets("Lagerorte").Cells(lngLine, 4).Value + _
                                                 CDbl(Worksheets("Bestellung").Cells(plng, 17))
                            For lngrow = 1 To Worksheets("Bestellung").Cells(Rows.Count, 6).End(xlUp).Row
                                If Worksheets("Bestellung").Cells(lngrow, 12).Text = Worksheets("Lager").Cells(lngLine, 1).Text Then
                                    dblAnzahl = dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 16)
                                End If
                            Next
                            If dblAnzahl - CDbl(Worksheets("Bestellung").Cells(plng, 17)) = 0 Then
                                Worksheets("Lager").Cells(lngLine, 9).Value = ""
                            End If
                            objLines.Add lstWAimput.List(lngIndex, 1)
                            objItems.Add CStr(lngIndex)
                        Else
                            Worksheets("Lagerorte").Cells(lngLine, 4).Value = Worksheets("Lagerorte").Cells(lngLine, 4).Value + _
                                                 CDbl(lstWAimput.List(lngIndex, 4))
                            plng = lstWAimput.Column(1, lngIndex)
                            For lngrow = 1 To Worksheets("Bestellung").Cells(Rows.Count, 6).End(xlUp).Row
                                If Worksheets("Bestellung").Cells(lngrow, 12).Text = Worksheets("Lager").Cells(lngLine, 1).Text Then
                                    dblAnzahl = dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 6)
                                End If
                            Next
                            If dblAnzahl - CDbl(Worksheets("Bestellung").Cells(plng, 6)) = 0 Then
                                Worksheets("Lager").Cells(lngLine, 9).Value = ""
                            End If
                            objLines.Add lstWAimput.List(lngIndex, 1)
                            objItems.Add CStr(lngIndex)
                        End If
                    End If
                Else
                    lngLine = 0
                    With ThisWorkbook.Sheets("Lager")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 10, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 1) = CStr(strArticle) Then
                                lngLine = i2
                            End If
                        Next i2
                    End With
                    If lngLine > 0 Then
                        plng = lstWAimput.Column(1, lngIndex)
                        If Not Worksheets("Bestellung").Cells(plng, 16) = "" Then
                            .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value + _
                                                         CDbl(Worksheets("Bestellung").Cells(plng, 17))
                            
                            For lngrow = 1 To Worksheets("Bestellung").Cells(Rows.Count, 6).End(xlUp).Row
                                If Worksheets("Bestellung").Cells(lngrow, 12).Text = Worksheets("Lager").Cells(lngLine, 1).Text Then
                                    dblAnzahl = dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 17)
                                End If
                            Next
                            If dblAnzahl - CDbl(Worksheets("Bestellung").Cells(plng, 17)) = 0 Then
                                Worksheets("Lager").Cells(lngLine, 9).Value = ""
                            End If
                            objLines.Add lstWAimput.List(lngIndex, 1)
                            objItems.Add CStr(lngIndex)
                        Else
                            .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value + _
                                                         CDbl(lstWAimput.List(lngIndex, 4))
                            plng = lstWAimput.Column(1, lngIndex)
                            For lngrow = 1 To Worksheets("Bestellung").Cells(Rows.Count, 6).End(xlUp).Row
                                If Worksheets("Bestellung").Cells(lngrow, 12).Text = Worksheets("Lager").Cells(lngLine, 1).Text Then
                                    dblAnzahl = dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 6)
                                End If
                            Next
                            If dblAnzahl - CDbl(Worksheets("Bestellung").Cells(plng, 6)) = 0 Then
                                Worksheets("Lager").Cells(lngLine, 9).Value = ""
                            End If
                            objLines.Add lstWAimput.List(lngIndex, 1)
                            objItems.Add CStr(lngIndex)
                        End If
                    End If
                End If
            End If
        Next lngIndex
    End With
    Sheets("Wareneingang").Activate
    lngZeile = Worksheets("Wareneingang").Cells(Rows.Count, 1).End(xlUp).Row
    With ThisWorkbook.Worksheets("Wareneingang")
        For lngIndex = 0 To frmEingang.lstWAimput.ListCount - 1
            If frmEingang.lstWAimput.Selected(lngIndex) Then
                lngZeile = lngZeile + 1
                If Not Worksheets("Bestellung").Cells(CLng(lstWAimput.Column(6, lngIndex)), 3) = "TEXT" Or Not Worksheets("Bestellung").Cells(CLng(lstWAimput.Column(6, lngIndex)), 12) = "" Then
                    Worksheets("Wareneingang").Cells(lngZeile, 1).Value = cboeingang.Text 'Liefernummer
                    Worksheets("Wareneingang").Cells(lngZeile, 2).Value = Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 2) 'Lieferant
                    Worksheets("Wareneingang").Cells(lngZeile, 3).Value = "'" & lstWAimput.Column(2, lngIndex) 'Artikelnummer
                    Worksheets("Wareneingang").Cells(lngZeile, 4).Value = "'" & lstWAimput.Column(5, lngIndex) 'Herstellernummer
                    Worksheets("Wareneingang").Cells(lngZeile, 5).Value = lstWAimput.Column(3, lngIndex)
                    If Not Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 16) = "" Then
                        Worksheets("Wareneingang").Cells(lngZeile, 6).Value = CDbl(Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 17))
                    Else
                        Worksheets("Wareneingang").Cells(lngZeile, 6).Value = CDbl(Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 6)) 'Menge
                    End If
                    Worksheets("Wareneingang").Cells(lngZeile, 7).Value = Worksheets("Bestellung").Cells(CDbl(lstWAimput.Column(6, lngIndex)), 8)
                    If Datumstxt = vbYes Then
                        Worksheets("Wareneingang").Cells(lngZeile, 8).Value = Date
                        Worksheets("Wareneingang").Cells(lngZeile, 9).Value = Format(Time, "hh:mm:ss")
                    Else
                        Worksheets("Wareneingang").Cells(lngZeile, 8).Value = CDate(DatumLong)
                    End If
                    Worksheets("Wareneingang").Cells(lngZeile, 11).Value = CDbl(lstWAimput.Column(9, lngIndex)) 'EK Preis pro St|fffd|ck
                    Worksheets("Wareneingang").Cells(lngZeile, 12).Value = lstWAimput.Column(8, lngIndex) 'ID
                    If Sheets("Daten").Range("B5").Value = "True" Then
                        Worksheets("Wareneingang").Cells(lngZeile, 13).Value = Sheets("Daten").Range("B24").Value
                    End If
                    Worksheets("Wareneingang").Cells(lngZeile, 16).Value = Format(Date, "MMMM")
                    Worksheets("Wareneingang").Cells(lngZeile, 17).Value = Format(Date, "YYYY")
                    Worksheets("Wareneingang").Cells(lngZeile, 18).Value = CStr(lstWAimput.Column(7, lngIndex)) 'Lagerplatz
                    Worksheets("Wareneingang").Cells(lngZeile, 19).Value = strBLS
                End If
            End If
        Next
    End With
    Sheets("Bestellung").Activate
    If objItems.Count > 0 Then
        For lngIndex = objItems.Count To 1 Step -1
            lstWAimput.RemoveItem CLng(objItems(lngIndex))
        Next
    End If
    If objLines.Count > 0 Then
        With ThisWorkbook.Worksheets("Bestellung")
            For lngIndex = objLines.Count To 1 Step -1
                .Rows(CLng(objLines(lngIndex))).Delete
            Next
        End With
    End If
    Set objLines = Nothing
    Set objItems = Nothing
    Call TextClear
    ActiveWorkbook.Save
    Call AnsichtLager
    frmLager.cboArtikelnummer.Value = tbABackup.Value
    Sheets("Center").Activate
    cboeingang.Clear
    lstWAimput.Clear
    UserForm_Initialize
    frmLager.Asuchen
    Application.ScreenUpdating = True
    lbl_status.Visible = False
End Sub

Private Sub cmdWeingang_Click() '1.44
    lbl_status.Visible = True
    lbl_status.Caption = "Die Lieferung wird ins Lager gebucht!"
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    Application.Wait (Now + TimeValue("00:00:01"))
    Call WEBuchen
End Sub

Private Sub lstWAimput_DblClick(ByVal Cancel As MSForms.ReturnBoolean) '1.44
    Dim iSelCnt, ix, xrow, intRow As Long
    Dim lngMsg, stxt As String
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row, lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    iSelCnt = 0
    For ix = 0 To lstWAimput.ListCount - 1
        If lstWAimput.Selected(ix) = True Then iSelCnt = iSelCnt + 1
    Next ix
    If iSelCnt > 1 Then
        MsgBox "Bitte markieren Sie nur einen Artikel!", "Hauptlagerplatz |fffd|ndern"
            For intRow = 0 To Me!lstWAimput.ListCount - 1
                Me!lstWAimput.Selected(intRow) = False
            Next intRow
        Exit Sub
    End If
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = CStr(frmEingang.lstWAimput.List(lstWAimput.ListIndex, 8)) Then
                xrow = i
            End If
        Next i
    End With
    stxt = Sheets("Lager").Cells(xrow, 13).Value
    If stxt = "" Then stxt = "Noch keinen Vorhanden!"
    If cboeingang.Value = "" Then Exit Sub
    lngMsg = InputBox("Geben Sie ein neuen Lagerort (Hauptlagerplatz) f|fffd|r den Artikel (" + lstWAimput.List(lstWAimput.ListIndex, 3) + ") ein!" & vbLf & vbLf & "Hauptlagerplatz ist: " & stxt & _
        vbLf & vbLf & "Weitere Lagerplatz m|fffd|ssen seperat angelegt werden!", "Hauptlagerplatz |fffd|ndern")
    If lngMsg = "" Then Exit Sub
    Sheets("Lager").Cells(xrow, 13).Value = lngMsg
    Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(lstWAimput.ListIndex, 1), 7).Value = lngMsg
    Sheets("Bestellung").Cells(frmEingang.lstWAimput.List(lstWAimput.ListIndex, 1), 14).Value = ""
    Application.ScreenUpdating = True
    Call SuchenEingang
End Sub

Sub sortieren()
    Dim Letzter, Naechster As Long
    Dim i As String
    On Error Resume Next
    With cboeingang
        For Letzter = 0 To .ListCount - 1
            For Naechster = Letzter + 1 To .ListCount - 1
                If .List(Letzter) > .List(Naechster) Then
                   i = .List(Letzter)
                   .List(Letzter) = .List(Naechster)
                   .List(Naechster) = i
                End If
            Next Naechster
        Next Letzter
    End With
End Sub

Sub SuchenEingang() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next

    SuchKriterium = cboeingang.Text
    lstWAimput.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Bestellung")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = SuchKriterium Then
                n = n + 1
                arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ") & " / " & CStr(arrTmpA(i, 8))
                arrTmpB(2, n) = i
                arrTmpB(3, n) = arrTmpA(i, 3)
                arrTmpB(4, n) = VBA.Replace(CStr(arrTmpA(i, 5)), Chr$(13) & Chr$(10), " ")
                arrTmpB(5, n) = arrTmpA(i, 6)
                arrTmpB(6, n) = arrTmpA(i, 4)
                arrTmpB(7, n) = i
                If Not arrTmpA(i, 14) = "" Then
                    arrTmpB(8, n) = Worksheets("Lagerorte").Cells((Worksheets("Lagerorte").Range("A:A").Find(CStr(arrTmpA(i, 14)), LookIn:=xlValues, MatchCase:=True).Row), 3) 'Lagerplatz
                Else
                    arrTmpB(8, n) = arrTmpA(i, 7)
                End If
                arrTmpB(9, n) = arrTmpA(i, 12)
                arrTmpB(10, n) = arrTmpA(i, 10)
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstWAimput
                .ColumnCount = 10
                .ColumnWidths = "180;0;90;250;60;0;0;50;0;0"
                .MultiSelect = fmMultiSelectMulti
                .ListStyle = fmListStyleOption
                .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub

Sub TextClear()
    Dim lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    For lng = 2 To Sheets("Bestellung").UsedRange.Rows.Count
        If Sheets("Bestellung").Cells(lng, 1).Text = cboeingang.Value And Sheets("Bestellung").Cells(lng, 3).Text = "TEXT" Then
            If lstWAimput.ListCount = "" Then
                Sheets("Bestellung").Rows(lng).Delete
            End If
        End If
    Next lng
    Application.ScreenUpdating = True
End Sub

Sub WEschein() '1.44
    Dim zeLB, zeTB, lngIndex, listenwert, Farbe, xLast_Row As Long
    Dim allesDrucken, blnMarkiert As Boolean
    Dim arrTmpA, arrTmpB, i, Last_Row, xrow As Long
    Dim Kopien As Variant
    On Error Resume Next

    If cboeingang = "" Then Exit Sub
    For listenwert = 0 To lstWAimput.ListCount - 1
        If lstWAimput.Selected(listenwert) Then
            blnMarkiert = True
            Exit For
        End If
    Next listenwert
    If blnMarkiert = False Then
        MsgBox "Es wurde kein Artikel in der Liste makiert!", _
        vbExclamation, "Markierten Artikel l|fffd|schen!"
        lbl_status.Visible = False
        Exit Sub
    End If
    Application.ScreenUpdating = False
    Sheets("Vorlage2").Activate
    xLast_Row = CDbl(Sheets("Vorlage2").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Vorlage2").Rows("7:" & xLast_Row).Delete
    Sheets("Vorlage2").Range("Vorlage2!A7:G400").Font.Size = 9
    Sheets("Vorlage2").Range("A1") = "Wareneingangsschein"
    Sheets("Vorlage2").Range("G1") = Date
    Sheets("Vorlage2").Range("A3") = "Bestellung: " & cboeingang.Value
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = ""
    For zeLB = 0 To frmEingang.lstWAimput.ListCount - 1
        allesDrucken = allesDrucken Or frmEingang.lstWAimput.Selected(zeLB)
    Next
    zeTB = 7
    '--- selektierte Listboxeintraege in Zellen schreiben
    For zeLB = 0 To frmEingang.lstWAimput.ListCount - 1
        If frmEingang.lstWAimput.Selected(zeLB) Then
            Sheets("Vorlage2").Cells(zeTB, 1) = CDbl(zeLB + 1)
            Sheets("Vorlage2").Cells(zeTB, 2) = "'" & frmEingang.lstWAimput.List(zeLB, 2)
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If arrTmpA(i, 1) = CStr(frmEingang.lstWAimput.List(zeLB, 8)) Then
                        xrow = i
                    End If
                Next i
            End With
            Sheets("Vorlage2").Cells(zeTB, 3) = "'" & Sheets("Lager").Cells(CLng(xrow), 4)
            Sheets("Vorlage2").Cells(zeTB, 4) = frmEingang.lstWAimput.List(zeLB, 3)
            Sheets("Vorlage2").Cells(zeTB, 5) = frmEingang.lstWAimput.List(zeLB, 4)
            Sheets("Vorlage2").Cells(zeTB, 5).HorizontalAlignment = xlCenter
            Sheets("Vorlage2").Cells(zeTB, 6) = frmEingang.lstWAimput.List(zeLB, 7)
            Sheets("Vorlage2").Range("A4") = "Bestellung vom " & frmEingang.lstWAimput.List(zeLB, 6)
            Sheets("Vorlage2").Range("A5") = "Lieferant: " & frmEingang.lstWAimput.List(zeLB, 0)
            zeTB = zeTB + 1
        End If
    Next
    Farbe = 0
    For zeLB = 0 To frmEingang.lstWAimput.ListCount - 1
        If Farbe = 1 Then
            Sheets("Vorlage2").Range("A" & 7 + zeLB & ":G" & 7 + zeLB).Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = -0.149998474074526
                .PatternTintAndShade = 0
            End With
            Farbe = 0
        Else
            Sheets("Vorlage2").Range("A" & 7 + zeLB & ":G" & 7 + zeLB).Select
            Farbe = 1
        End If
    Next
    Sheets("Vorlage2").Cells(zeTB + 2, 1) = "Eingelagert durch: "
    Sheets("Vorlage2").Cells(zeTB + 2, 1).Font.Size = 11
    Sheets("Vorlage2").Cells(zeTB + 4, 1) = "...................................................................."
    Sheets("Vorlage2").Cells(zeTB + 5, 1) = "(Name/ Mitarbeiter)"
    Sheets("Vorlage2").Cells(zeTB + 5, 1).Font.Size = 11
    Kopien = Application.InputBox("Anzahl Kopien", "WE- Schein drucken", 1)
    If Kopien = False Then
        lbl_status.Visible = False
        Exit Sub
    End If
    Worksheets("Vorlage2").PrintOut Copies:=CLng(Kopien)
    Sheets("Center").Activate
    Application.ScreenUpdating = False
    lbl_status.Visible = True
    lbl_status.Caption = "Wareneingangs-Schein wurde gedruckt!"
End Sub

Private Sub cmbAM_Click()
    Call select_all
End Sub

Sub select_all()
    Dim intRow As Long
    For intRow = 0 To Me!lstWAimput.ListCount - 1
        Me!lstWAimput.Selected(intRow) = True
    Next intRow
End Sub

Private Sub cmd_close_Click()
    Unload frmEingang
    frmLager.txt_item.SetFocus
    frmLager.Show
End Sub
Attribute VB_Name = "frmEmail"
Attribute VB_Base = "0{8135A1B6-9F2A-42EB-B7A4-96C7902CCE99}{730EE000-CD70-48A2-857E-0A9AD2CAA279}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit

Private Sub cmd_TMail_Click()
    Call TestMail
End Sub

Private Sub txt_Email_Change()
    If Chk_ON.Value = True Then
        cmd_TMail.Visible = True
    Else
        cmd_TMail.Visible = False
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    frm_Date.lbl_Day.Caption = Format(Date, "dd")
    frm_Date.lbl_dayfull.Caption = Format(Date, "dddd")
    frm_Date.lbl_month.Caption = "." & Format(Date, "mm")
    frm_Date.lbl_year.Caption = "." & Format(Date, "yyyy")
    Chk_EPass.Value = True
    If Chk_EPass.Value = True Then
        frmEmail.txt_EPasswort.Enabled = False
    End If
    frmEmail.txt_Email.Value = ThisWorkbook.Sheets("Daten").Range("B27")
    frmEmail.txt_VON.Value = ThisWorkbook.Sheets("Daten").Range("B27")
    frmEmail.txt_Provider.Value = ThisWorkbook.Sheets("Daten").Range("B28")
    frmEmail.txt_EPasswort.Value = ThisWorkbook.Sheets("Daten").Range("B29")
    If ThisWorkbook.Sheets("Daten").Range("B30") = "SMTP" Then
        frmEmail.cbo_Port = "SMTP (Port 25)"
    ElseIf ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
        frmEmail.cbo_Port = "SSL (Port 465)"
    ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
        frmEmail.cbo_Port = "TLS (Port 587)"
    End If
    If ThisWorkbook.Sheets("Daten").Range("B31").Value = "Y" Then
        Chk_OY.Value = True
        Chk_ON.Value = False
        cmd_ESenden.Caption = "Outlook"
        cmd_ESenden.BackColor = &H808000
    Else
        Chk_OY.Value = False
        Chk_ON.Value = True
        cmd_ESenden.Caption = "Senden"
        cmd_ESenden.BackColor = &H8000&
    End If
    With cbo_Port
        .AddItem "SMTP (Port 25)"
        .AddItem "TLS (Port 587)"
        .AddItem "SSL (Port 465)"
    End With
    If Chk_ON.Value = True Then
        cmd_TMail.Visible = True
    Else
        cmd_TMail.Visible = False
    End If
End Sub

Sub TestMail()
    Dim Etxt, Ptxt, stxt, Ntxt, Btxt As String
    Dim iNachricht As Object
    Dim iKonfiguration  As Object
    Dim Felder As Variant
    'Geht unter Windows 7 Pro 64bit!
    On Error GoTo weiter
    Set iNachricht = CreateObject("CDO.Message")
    Set iKonfiguration = CreateObject("CDO.Configuration")
    iKonfiguration.Load -1
    Set Felder = iKonfiguration.Fields
    If iNachricht Is Nothing Then
        MsgBox Err.Description
    Else
        Etxt = ThisWorkbook.Sheets("Daten").Range("B27")
        stxt = ThisWorkbook.Sheets("Daten").Range("B28")
        Ntxt = frmEmail.txt_ENachricht.Value
        If Not frmEmail.txt_EPasswort.Value = "" Then
            Ptxt = ThisWorkbook.Sheets("Daten").Range("B29")
        Else
            frmPW.txt_type.Value = "TEmail"
            frmPW.Caption = "Bitte geben Sie Ihr E-Mail Passwort ein!"
            frmPW.Show
            Set iNachricht = Nothing
            Set iKonfiguration = Nothing
            Exit Sub
        End If
        If Ptxt = "" Then Exit Sub
        Btxt = frmEmail.txt_Betreff.Value
        Application.StatusBar = "E-Mail wird gesendet!"
        With Felder
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusername") = Etxt  '"Deine E-Mail-Adresse"
           .Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") = Ptxt  'Passwort angeben
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = stxt    'Postausgangsserver
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
            If ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 465    'ssl-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 587    'tls-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "SMTP" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 25     'smtp-Port
            End If
            .Item("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60
           .Update
        End With
        With iNachricht
            Set .Configuration = iKonfiguration
            .To = frmEmail.txt_Email.Value                                              'Empf|fffd|nger
            .Subject = "Testmail Lagerverwaltung!"                                      'Betreffzeile
            .TextBody = "Excel Testmail" & vbLf & vbLf & "Gesendet von der Excel Lagerverwaltung " & CStr(Sheets("Daten").Range("B45")) 'Nachricht
            .Send
        End With
    End If
    Application.StatusBar = False
    MsgBox "Testmail wurde versandt!"
    Unload frmEmail
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Exit Sub
weiter:
    Application.StatusBar = "Fehlgeschlagen!"
    MsgBox "Fehler beim versenden der E-Mail!", vbCritical, "Fehler"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Application.StatusBar = False
End Sub

Sub EMail()
    Dim Etxt, Ptxt, stxt, Ntxt, Btxt As String
    Dim iNachricht As Object
    Dim iKonfiguration  As Object
    Dim Felder As Variant
    'Geht unter Windows 7 Pro 64bit!
    On Error GoTo weiter
    Set iNachricht = CreateObject("CDO.Message")
    Set iKonfiguration = CreateObject("CDO.Configuration")
    iKonfiguration.Load -1
    Set Felder = iKonfiguration.Fields
    If iNachricht Is Nothing Then
        MsgBox Err.Description
    Else
        Etxt = ThisWorkbook.Sheets("Daten").Range("B27")
        stxt = ThisWorkbook.Sheets("Daten").Range("B28")
        Ntxt = frmEmail.txt_ENachricht.Value

        If Not frmEmail.txt_EPasswort.Value = "" Then
            Ptxt = ThisWorkbook.Sheets("Daten").Range("B29")
        Else
            frmPW.txt_type.Value = "Email"
            frmPW.Caption = "Bitte geben Sie Ihr E-Mail Passwort ein!"
            frmPW.Show
            Set iNachricht = Nothing
            Set iKonfiguration = Nothing
            Exit Sub
        End If
        If Ptxt = "" Then Exit Sub
        Btxt = frmEmail.txt_Betreff.Value
        Application.StatusBar = "E-Mail wird gesendet!"
        With Felder
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusername") = Etxt  '"Deine E-Mail-Adresse"
           .Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") = Ptxt  'Passwort angeben
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = stxt    'Postausgangsserver
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
            If ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 465    'ssl-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 587    'tls-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "SMTP" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 25     'smtp-Port
            End If
            .Item("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60
           .Update
        End With
        With iNachricht
            Set .Configuration = iKonfiguration
            .To = frmEmail.txt_AN.Value                                                 'Empf|fffd|nger
            .sender = frmEmail.txt_VON.Value                                            'Von
            .Subject = Btxt                                                             'Betreffzeile
            .TextBody = Ntxt & vbLf & vbLf & "Gesendet von der Lagerverwaltung 1.44"    'Nachricht
            .Send
        End With
    End If
    Application.StatusBar = False
    MsgBox "E-Mail wurde an " + frmEmail.txt_AN.Value + " versandt!"
    Unload frmEmail
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Exit Sub
weiter:
    Application.StatusBar = "Fehlgeschlagen!"
    MsgBox "Fehler beim versenden der E-Mail!", vbCritical, "Fehler"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Application.StatusBar = False
End Sub

Private Sub Chk_EPass_Click()
    If Chk_EPass.Value = True Then
        frmEmail.txt_EPasswort.Enabled = False
        frmEmail.txt_EPasswort.BackColor = &H8000000F
    Else
        frmEmail.txt_EPasswort.Enabled = True
        frmEmail.txt_EPasswort.BackColor = &H80000005
    End If
End Sub

Private Sub Chk_ON_Click()
    If Chk_ON.Value = True Then
        Chk_OY.Value = False
        cbo_Port.Enabled = True
        txt_EPasswort.Enabled = True
        txt_Provider.Enabled = True
        Chk_EPass.Enabled = True
    Else
        Chk_OY.Value = True
        cbo_Port.Enabled = False
        txt_EPasswort.Enabled = False
        txt_Provider.Enabled = False
        Chk_EPass.Enabled = False
    End If
End Sub

Private Sub Chk_OY_Click()
    If Chk_OY.Value = True Then
        Chk_ON.Value = False
        cbo_Port.Enabled = False
        txt_EPasswort.Enabled = False
        txt_Provider.Enabled = False
        Chk_EPass.Enabled = False
        cmd_ESenden.Caption = "Outlook"
        cmd_ESenden.BackColor = &H808000
    Else
        Chk_ON.Value = True
        cbo_Port.Enabled = True
        txt_EPasswort.Enabled = True
        txt_Provider.Enabled = True
        Chk_EPass.Enabled = True
        cmd_ESenden.Caption = "Senden"
        cmd_ESenden.BackColor = &H8000&
    End If
End Sub

Private Sub cmd_Ausblenden_Click()
    frm_Date.Left = 284
    If Application.Version Like "16*" Then
        frmEmail.Width = 382
        frmEmail.cmd_ESenden.Left = 276
    Else
        frmEmail.Width = 375
        frmEmail.cmd_ESenden.Left = 276
    End If
    cmd_EKonfig.Visible = True
End Sub

Private Sub cmd_EKonfig_Click()
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If Application.Version Like "16*" Then
        frm_Date.Left = 492
        frmEmail.Width = 592
        frmEmail.cmd_ESenden.Left = 486
    Else
        frm_Date.Left = 492
        frmEmail.Width = 584
        frmEmail.cmd_ESenden.Left = 486
    End If
    cmd_EKonfig.Visible = False
End Sub

Private Sub cmd_ESave_Click()
    ThisWorkbook.Sheets("Daten").Range("B27") = frmEmail.txt_Email.Value
    ThisWorkbook.Sheets("Daten").Range("B28") = frmEmail.txt_Provider.Value
    ThisWorkbook.Sheets("Daten").Range("B29") = frmEmail.txt_EPasswort.Value
    
    If frmEmail.cbo_Port = "SMTP (Port 25)" Then
        ThisWorkbook.Sheets("Daten").Range("B30") = "SMTP"
    ElseIf frmEmail.cbo_Port = "TLS (Port 587)" Then
        ThisWorkbook.Sheets("Daten").Range("B30") = "TLS"
    ElseIf frmEmail.cbo_Port = "SSL (Port 465)" Then
        ThisWorkbook.Sheets("Daten").Range("B30") = "SSL"
    End If
    If Chk_OY.Value = True Then
        ThisWorkbook.Sheets("Daten").Range("B31") = "Y"
    Else
        ThisWorkbook.Sheets("Daten").Range("B31") = "N"
    End If
    frmEmail.txt_VON.Value = frmEmail.txt_Email.Value
    MsgBox "Daten wurden gespeichert", , "E-Mail"
End Sub

Private Sub cmd_ESenden_Click()
    On Error GoTo weiter:
    If txt_AN.Value = "" Then
        MsgBox "Kein Empf|fffd|nger eingetragen!", , "E-Mail"
        txt_AN.SetFocus
        Exit Sub
    ElseIf txt_VON.Value = "" Then
        MsgBox "Kein Absender eingetragen!", , "E-Mail"
        txt_VON.SetFocus
        Exit Sub
    End If
    If Chk_ON.Value = True Then
        Call EMail
    Else
        Call Outlook
    End If
    Exit Sub
weiter:
    Application.ScreenUpdating = False
    Sheets("Daten").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = Format(Date, "DD.MM.YYYY")
    ActiveCell.Offset(0, 1).Value = "Fehler beim versenden einer E-Mail"
    ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
    Sheets("Center").Activate
    MsgBox "Es ist leider ein Fehler passiert! Bitte Pr|fffd|fen Sie Ihre Eingaben", , "E-Mail senden"
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_Eabbrechen_Click()
    Unload frmEmail
End Sub

Sub Outlook()
    Dim olApp As Object
    Dim olOldBody, strBody, strText As String
    On Error GoTo Fehler
    
    Set olApp = CreateObject("Outlook.Application")
    strBody = txt_ENachricht.Value
    strBody = Replace(strBody, vbLf, "<br>")
    strText = strBody
    With olApp.CreateItem(0)
        Set .SendUsingAccount = .Session.Accounts.Item(frmEmail.txt_Email.Value)
            .GetInspector.Display
            .To = txt_AN.Value
            .Subject = txt_Betreff.Value
            .HTMLBody = strBody & olOldBody
            .Display
    End With
    Set olApp = Nothing
    Exit Sub
Fehler:
    MsgBox "Es ist ein Feher aufgetretten!", , "Outlook"
    Set olApp = Nothing
End Sub
Attribute VB_Name = "frmEtikett"
Attribute VB_Base = "0{EB9457CC-D908-4BF0-B137-ED743CD62239}{7F02D372-7749-4139-BFE2-2EC9B1602233}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cbo_Auswahl1_Change()
    If frmEtikett.txt_Mode.Value = "" Then
        Call suchenEtikettB
    Else
        Call suchenEtikettBWE
    End If
End Sub

Private Sub cbo_Auswahl2_Change()
    If frmEtikett.txt_Mode.Value = "" Then
        Call suchenEtikettB
    Else
        Call suchenEtikettBWE
    End If
End Sub

Private Sub cbo_Auswahl3_Change()
    If frmEtikett.txt_Mode.Value = "" Then
        Call suchenEtikettB
    Else
        Call suchenEtikettBWE
    End If
End Sub

Private Sub cbo_Auswahl4_Change()
    If frmEtikett.txt_Mode.Value = "" Then
        Call suchenEtikettB
    Else
        Call suchenEtikettBWE
    End If
End Sub

Private Sub cbo_Auswahl5_Change()
    If frmEtikett.txt_Mode.Value = "" Then
        Call suchenEtikettB
    Else
        Call suchenEtikettBWE
    End If
End Sub

Private Sub cbo_Gew1_Change()
    txt_Gew2.Value = cbo_Gew1
End Sub

Private Sub Ch_T1_Click()
    frmEtikett.Ch_T1 = True
    frmEtikett.Ch_T2 = False
    Frame_T2.Enabled = False
    frmEtikett.Ch_T3 = False
    Frame_T3.Enabled = False
    txt_type.Value = "T1"
    'T1
    frmEtikett.txt_ArtikelAnE.Enabled = True
    frmEtikett.txt_BarArtikelAnE.Enabled = True
    frmEtikett.txt_ArtikelLaE.Enabled = True
    frmEtikett.txt_LieferantE.Enabled = True
    'T2
    frmEtikett.txt_ArtikelAnET2.Enabled = False
    frmEtikett.txt_BarArtikelAnET2.Enabled = False
    frmEtikett.txt_ArtikelLaET2.Enabled = False
    frmEtikett.txt_BarArtikelLaET2.Enabled = False
    'T3
    frmEtikett.txt_ArtikelAnET3.Enabled = False
    frmEtikett.txt_BarArtikelAnET3.Enabled = False
    frmEtikett.txt_BezeichnungET3.Enabled = False
    frmEtikett.txt_ArtikelLaET3.Enabled = False
    frmEtikett.txt_BarArtikelLaET3.Enabled = False
    frmEtikett.txt_LieferantET3.Enabled = False
    frmEtikett.txt_LieferantNrET3.Enabled = False
    frmEtikett.txt_BarLieferantNrET3.Enabled = False
End Sub

Private Sub Ch_T2_Click()
    frmEtikett.Ch_T2 = True
    frmEtikett.Ch_T1 = False
    Frame_T1.Enabled = False
    frmEtikett.Ch_T3 = False
    Frame_T3.Enabled = False
    txt_type.Value = "T2"
    'T1
    frmEtikett.txt_ArtikelAnE.Enabled = False
    frmEtikett.txt_BarArtikelAnE.Enabled = False
    frmEtikett.txt_ArtikelLaE.Enabled = False
    frmEtikett.txt_LieferantE.Enabled = False
    'T2
    frmEtikett.txt_ArtikelAnET2.Enabled = True
    frmEtikett.txt_BarArtikelAnET2.Enabled = True
    frmEtikett.txt_ArtikelLaET2.Enabled = True
    frmEtikett.txt_BarArtikelLaET2.Enabled = True
    'T3
    frmEtikett.txt_ArtikelAnET3.Enabled = False
    frmEtikett.txt_BarArtikelAnET3.Enabled = False
    frmEtikett.txt_BezeichnungET3.Enabled = False
    frmEtikett.txt_ArtikelLaET3.Enabled = False
    frmEtikett.txt_BarArtikelLaET3.Enabled = False
    frmEtikett.txt_LieferantET3.Enabled = False
    frmEtikett.txt_LieferantNrET3.Enabled = False
    frmEtikett.txt_BarLieferantNrET3.Enabled = False
End Sub

Private Sub Ch_T3_Click()
    frmEtikett.Ch_T3 = True
    frmEtikett.Ch_T1 = False
    Frame_T1.Enabled = False
    frmEtikett.Ch_T2 = False
    Frame_T2.Enabled = False
    txt_type.Value = "T3"
    
    frmEtikett.txt_ArtikelAnE.Enabled = False
    frmEtikett.txt_BarArtikelAnE.Enabled = False
    frmEtikett.txt_ArtikelLaE.Enabled = False
    frmEtikett.txt_LieferantE.Enabled = False
    'T2
    frmEtikett.txt_ArtikelAnET2.Enabled = False
    frmEtikett.txt_BarArtikelAnET2.Enabled = False
    frmEtikett.txt_ArtikelLaET2.Enabled = False
    frmEtikett.txt_BarArtikelLaET2.Enabled = False
    'T3
    frmEtikett.txt_ArtikelAnET3.Enabled = True
    frmEtikett.txt_BarArtikelAnET3.Enabled = True
    frmEtikett.txt_BezeichnungET3.Enabled = True
    frmEtikett.txt_ArtikelLaET3.Enabled = True
    frmEtikett.txt_BarArtikelLaET3.Enabled = True
    frmEtikett.txt_LieferantET3.Enabled = True
    frmEtikett.txt_LieferantNrET3.Enabled = True
    frmEtikett.txt_BarLieferantNrET3.Enabled = True
End Sub

Private Sub Check_ArtikelNr_Click()
    If Check_ArtikelNr.Value = True Then
        Check_HerstellerNr = False
        Check_Barcode.Value = False
        txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        lbl_BarArtikelAnE.Caption = frmArtikel.txt_Artikelnummer.Value
    End If
    If Check_HerstellerNr = False And Check_Barcode.Value = False Then
        Check_ArtikelNr.Value = True
        txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Artikelnummer.Value & "*"
        lbl_BarArtikelAnE.Caption = frmArtikel.txt_Artikelnummer.Value
    End If
End Sub

Private Sub Check_HerstellerNr_Click()
    If Check_HerstellerNr.Value = True Then
        Check_ArtikelNr = False
        Check_Barcode.Value = False
        txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        lbl_BarArtikelAnE.Caption = frmArtikel.txt_Hnr.Value
    End If
    If Check_ArtikelNr = False And Check_Barcode = False Then
        Check_HerstellerNr.Value = True
        lbl_BarArtikelAnE.Caption = frmArtikel.txt_Hnr.Value
        txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
        txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Hnr.Value & "*"
    End If
End Sub

Private Sub Check_Barcode_Click()
    If Check_Barcode.Value = True Then
        Check_ArtikelNr.Value = False
        Check_HerstellerNr.Value = False
        lbl_BarArtikelAnE.Caption = frmArtikel.txt_Barcode.Value
        txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
        txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
        txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
    End If
    If Check_ArtikelNr.Value = False And Check_HerstellerNr.Value = False Then
        Check_Barcode.Value = True
        lbl_BarArtikelAnE.Caption = frmArtikel.txt_Barcode.Value
        txt_BarArtikelAnE.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
        txt_BarArtikelAnET2.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
        txt_BarArtikelAnET3.Value = "*" & frmArtikel.txt_Barcode.Value & "*"
    End If
End Sub
Private Sub cmd_Abbrechen_Click()
    Unload frmEtikett
End Sub

Private Sub cmd_Ein_L_Click()
    Sheets("Daten").Range("D1") = ""
    Sheets("Daten").Range("D2") = ""
    Sheets("Daten").Range("D3") = ""
    Sheets("Daten").Range("D4") = ""
    Sheets("Daten").Range("D5") = ""
    Sheets("Daten").Range("D6") = ""
    Sheets("Daten").Range("E2") = ""
    Sheets("Daten").Range("E3") = ""
    Sheets("Daten").Range("E4") = ""
    Sheets("Daten").Range("E5") = ""
    Sheets("Daten").Range("E6") = ""
    Sheets("Daten").Range("D7") = ""
    Sheets("Daten").Range("D8") = ""
    Sheets("Daten").Range("D9") = ""
    Sheets("Daten").Range("D10") = ""
    Sheets("Daten").Range("D11") = ""
    Sheets("Daten").Range("D12") = ""
    Sheets("Daten").Range("D13") = ""
    txt_Tabellblatt.Value = ""
    cbo_Auswahl1.ListIndex = -1
    cbo_Auswahl2.ListIndex = -1
    cbo_Auswahl3.ListIndex = -1
    cbo_Auswahl4.ListIndex = -1
    cbo_Auswahl5.ListIndex = -1
    txt_Zeile1.Value = ""
    txt_Zeile2.Value = ""
    txt_Zeile3.Value = ""
    txt_Zeile4.Value = ""
    txt_Zeile5.Value = ""
    txt_DBvon.Value = ""
    txt_DBbis.Value = ""
    MsgBox "Einstellung wurde gel|fffd|scht!", , "Hinweis"
End Sub

Private Sub cmd_Ein_S_Click()
    Sheets("Daten").Range("D1") = txt_Tabellblatt.Value
    Sheets("Daten").Range("D2") = cbo_Auswahl1
    Sheets("Daten").Range("D3") = cbo_Auswahl2
    Sheets("Daten").Range("D4") = cbo_Auswahl3
    Sheets("Daten").Range("D5") = cbo_Auswahl4
    Sheets("Daten").Range("D6") = cbo_Auswahl5
    Sheets("Daten").Range("E2") = txt_Zeile1.Value
    Sheets("Daten").Range("E3") = txt_Zeile2.Value
    Sheets("Daten").Range("E4") = txt_Zeile3.Value
    Sheets("Daten").Range("E5") = txt_Zeile4.Value
    Sheets("Daten").Range("E6") = txt_Zeile5.Value
    Sheets("Daten").Range("D7") = txt_DBvon.Value
    Sheets("Daten").Range("D8") = txt_DBbis.Value
    If chk_Auswahl1.Value = True Then
        Sheets("Daten").Range("D9") = "ja"
    Else
        Sheets("Daten").Range("D9") = ""
    End If
    If chk_Auswahl2.Value = True Then
        Sheets("Daten").Range("D10") = "ja"
    Else
        Sheets("Daten").Range("D10") = ""
    End If
    If chk_Auswahl3.Value = True Then
        Sheets("Daten").Range("D11") = "ja"
    Else
        Sheets("Daten").Range("D11") = ""
    End If
    If chk_Auswahl4.Value = True Then
        Sheets("Daten").Range("D12") = "ja"
    Else
        Sheets("Daten").Range("D12") = ""
    End If
    If chk_Auswahl5.Value = True Then
        Sheets("Daten").Range("D13") = "ja"
    Else
        Sheets("Daten").Range("D13") = ""
    End If
    MsgBox "Einstellungen wurden gespeichert!", , "Hinweis"
End Sub

Private Sub cmd_newET_Click()
    Dim lng As Long
    Dim ws As Worksheet
    Dim neuname As String
    
    lng = MsgBox("M|fffd|chten Sie ein neuen Tabellenblatt erstellen?", vbYesNo, "Neues Tabellenblatt")
    If lng = vbYes Then
        neuname = InputBox("Neuer Name des Blattes")
        If neuname = "" Then GoTo weiter
        Set ws = ThisWorkbook.Worksheets.Add
        ws.Name = neuname
        txt_Tabellblatt.Value = neuname
    Else
weiter:
        Exit Sub
    End If
End Sub

Private Sub cmd_print_Click() 'v1.44
    Dim strDruckerA As String
    Dim Kopien As Variant
    On Error Resume Next
    
    If txt_type.Value = "BE" Then
        Call BEtikett
        Exit Sub
    End If
    strDruckerA = Application.ActivePrinter 'Drucker merken
    Application.ScreenUpdating = False
    With Sheets("Etikett_Druck")
        'T1
        Range("Etikett_Druck!C1") = "'" & frmEtikett.txt_ArtikelAnE.Value
        Range("Etikett_Druck!C2") = frmEtikett.txt_ArtikelLaE.Value
        Range("Etikett_Druck!B3") = frmEtikett.txt_BarArtikelAnE.Value
        Range("Etikett_Druck!C4") = frmEtikett.txt_LieferantE.Value
        'T2
        Range("Etikett_Druck!C6") = "'" & frmEtikett.txt_ArtikelAnET2.Value
        Range("Etikett_Druck!B7") = frmEtikett.txt_BarArtikelAnET2.Value
        Range("Etikett_Druck!C8") = frmEtikett.txt_ArtikelLaET2.Value
        Range("Etikett_Druck!B9") = frmEtikett.txt_BarArtikelLaET2.Value
        'T3
        Range("Etikett_Druck!C11") = "'" & frmEtikett.txt_ArtikelAnET3.Value
        Range("Etikett_Druck!B12") = frmEtikett.txt_BarArtikelAnET3.Value
        Range("Etikett_Druck!C13") = frmEtikett.txt_BezeichnungET3.Value
        Range("Etikett_Druck!C15") = frmEtikett.txt_ArtikelLaET3.Value
        Range("Etikett_Druck!B16") = frmEtikett.txt_BarArtikelLaET3.Value
        Range("Etikett_Druck!C17") = frmEtikett.txt_LieferantET3.Value
        Range("Etikett_Druck!C18") = "'" & frmEtikett.txt_LieferantNrET3.Value
        Range("Etikett_Druck!B19") = frmEtikett.txt_BarLieferantNrET3.Value
        'G1
        Range("Etikett_Druck!B22") = frmEtikett.txt_Firma.Value
        Range("Etikett_Druck!B24") = frmEtikett.txt_adress.Value
        Range("Etikett_Druck!B26") = "'" & frmEtikett.txt_PLZ.Value
        Range("Etikett_Druck!D23") = frmEtikett.txt_FirmaA.Value
        Range("Etikett_Druck!D24") = frmEtikett.txt_adressA.Value
        Range("Etikett_Druck!D26") = "'" & frmEtikett.txt_PLZA.Value
        Range("Etikett_Druck!G22") = "'" & frmEtikett.txt_LieferscheinNr.Value
        Range("Etikett_Druck!F24") = frmEtikett.txt_BarLieferscheinNr.Value
        If frmKasse.lstKasse.ListCount > 1 Then
            Range("Etikett_Druck!C28") = "Mehrfachlieferung"
            Range("Etikett_Druck!B30") = "*keine Daten*"
        Else
            Range("Etikett_Druck!C28") = frmEtikett.txt_ArtikelNrE.Value
            Range("Etikett_Druck!B30") = frmEtikett.txt_BarArtikelNrE.Value
        End If
        Range("Etikett_Druck!B33") = frmEtikett.txt_BezeichnungVDA.Value
        Range("Etikett_Druck!C37") = frmEtikett.txt_FuellmengeN.Value & " " & frmEtikett.cbo_Gew1.Text
        Range("Etikett_Druck!B38") = frmEtikett.txt_BarFuellmengeN.Value
        Range("Etikett_Druck!E37") = frmEtikett.txt_FuellmengeB.Value & " " & frmEtikett.txt_Gew2.Text
        Range("Etikett_Druck!D38") = frmEtikett.txt_BarFuellmengeB.Value
        Range("Etikett_Druck!G28") = "'" & frmEtikett.txt_RENr.Value
        Range("Etikett_Druck!F29") = frmEtikett.txt_BarRENr.Value
        Range("Etikett_Druck!F32") = frmEtikett.txt_DatumE.Value
        Range("Etikett_Druck!I32") = frmEtikett.txt_Stueckzahl.Value
        If Not frmEtikett.txt_P1.Value = "" And Not frmEtikett.txt_P2.Value = "" Then
            Range("Etikett_Druck!H32") = frmEtikett.txt_P1 & " / " & frmEtikett.txt_P2
        End If
        Range("Etikett_Druck!G36") = frmEtikett.txt_LieferantenE.Value
        Range("Etikett_Druck!G37") = frmEtikett.txt_LieferantAbs.Value
        Range("Etikett_Druck!F38") = frmEtikett.txt_BarLieferantAbs.Value
    End With
    Kopien = Application.InputBox("Anzahl Kopien", "Etikett drucken", 1)
    If Kopien = False Then
        Exit Sub
    End If
    Application.Dialogs(xlDialogPrinterSetup).Show
    If txt_type.Value = "T1" Then
        Sheets("Etikett_Druck").PageSetup.PrintArea = "$B$1:$D$4"
        Worksheets("Etikett_Druck").PrintOut Copies:=CLng(Kopien)
    ElseIf txt_type.Value = "T2" Then
        Sheets("Etikett_Druck").PageSetup.PrintArea = "$B$6:$D$9"
        Worksheets("Etikett_Druck").PrintOut Copies:=CLng(Kopien)
    ElseIf txt_type.Value = "T3" Then
        Sheets("Etikett_Druck").PageSetup.PrintArea = "$B$11:$D$19"
        Worksheets("Etikett_Druck").PrintOut Copies:=CLng(Kopien)
    ElseIf txt_type.Value = "G1" Then
        Sheets("Etikett_Druck").Range("B21") = Me.Label1
        Sheets("Etikett_Druck").Range("F28") = Me.lbl_Art
        Sheets("Etikett_Druck").Range("F34") = Me.Label21
        Sheets("Etikett_Druck").Range("F37") = Me.Label10
        Sheets("Etikett_Druck").Range("F36") = Me.Label19
        Range("Etikett_Druck!F38") = ""
        Sheets("Etikett_Druck").PageSetup.PrintArea = "$B$21:$I$40"
        Worksheets("Etikett_Druck").PrintOut Copies:=CLng(Kopien)
    End If
    Application.ActivePrinter = strDruckerA 'Drucker zur|fffd|cksetzen
    MsgBox "Etikett wird gedruckt!", , "Etikett"
    Application.ScreenUpdating = True
    Unload frmEtikett
End Sub

Public Function WorksheetExists(ByVal WorksheetName As String) As Boolean
    On Error Resume Next
    WorksheetExists = (Sheets(WorksheetName).Name <> "")
    On Error GoTo 0
End Function

Sub BEtikett()
    Dim strDruckerA, stxt, DBstr As String
    Dim Kopien As Variant
    On Error Resume Next
    
    stxt = txt_Tabellblatt.Value
    DBstr = Sheets("Daten").Range("D7") & ":" & Sheets("Daten").Range("D8")
    If WorksheetExists(stxt) Then
        strDruckerA = Application.ActivePrinter 'Drucker merken
        If chk_Auswahl1.Value = True Then
            Worksheets(stxt).Range(txt_Zeile1.Value).Font.Name = "Bar-Code 39"
            Worksheets(stxt).Range(txt_Zeile1.Value) = "*" & txt_Auswahl1.Value & "*"
        Else
            Worksheets(stxt).Range(txt_Zeile1.Value) = txt_Auswahl1.Value
        End If
        If chk_Auswahl2.Value = True Then
            Worksheets(stxt).Range(txt_Zeile2.Value).Font.Name = "Bar-Code 39"
            Worksheets(stxt).Range(txt_Zeile2.Value) = "*" & txt_Auswahl2.Value & "*"
        Else
            Worksheets(stxt).Range(txt_Zeile2.Value) = txt_Auswahl2.Value
        End If
        If chk_Auswahl3.Value = True Then
            Worksheets(stxt).Range(txt_Zeile3.Value).Font.Name = "Bar-Code 39"
            Worksheets(stxt).Range(txt_Zeile3.Value) = "*" & txt_Auswahl3.Value & "*"
        Else
            Worksheets(stxt).Range(txt_Zeile3.Value) = txt_Auswahl3.Value
        End If
        If chk_Auswahl4.Value = True Then
            Worksheets(stxt).Range(txt_Zeile4.Value).Font.Name = "Bar-Code 39"
            Worksheets(stxt).Range(txt_Zeile4.Value) = "*" & txt_Auswahl4.Value & "*"
        Else
            Worksheets(stxt).Range(txt_Zeile4.Value) = txt_Auswahl4.Value
        End If
        If chk_Auswahl5.Value = True Then
            Worksheets(stxt).Range(txt_Zeile5.Value).Font.Name = "Bar-Code 39"
            Worksheets(stxt).Range(txt_Zeile5.Value) = "*" & txt_Auswahl5.Value & "*"
        Else
            Worksheets(stxt).Range(txt_Zeile5.Value) = txt_Auswahl5.Value
        End If
        If Not Sheets("Daten").Range("D7") = "" And Not Sheets("Daten").Range("D7") = "" Then
            Sheets(stxt).PageSetup.PrintArea = DBstr
        End If
        Kopien = Application.InputBox("Anzahl Kopien", "Etikett drucken", 1)
        If Kopien = False Then
            Exit Sub
        End If
        Application.Dialogs(xlDialogPrinterSetup).Show
        Worksheets(stxt).PrintOut Copies:=CLng(Kopien)
    Else
        MsgBox "Tabellenblatt: " & stxt & " exitiert nicht!", , "Hinweis"
    End If
    Application.ActivePrinter = strDruckerA 'Drucker zur|fffd|cksetzen
End Sub

Private Sub txt_ArtikelAnE_Change()
    If txt_ArtikelAnE.Value = "" Then
        txt_BarArtikelAnE.Value = ""
    Else
        txt_BarArtikelAnE.Value = "*" & txt_ArtikelAnE.Value & "*"
    End If
End Sub

Private Sub txt_ArtikelAnET2_Change()
    If txt_ArtikelAnET2.Value = "" Then
        txt_BarArtikelAnET2.Value = ""
    Else
        txt_BarArtikelAnET2.Value = "*" & txt_ArtikelAnET2.Value & "*"
    End If
End Sub

Private Sub txt_ArtikelAnET3_Change()
    If txt_ArtikelAnET3.Value = "" Then
        txt_BarArtikelAnET3.Value = ""
    Else
        txt_BarArtikelAnET3.Value = "*" & txt_ArtikelAnET3.Value & "*"
    End If
End Sub

Private Sub txt_ArtikelLaET2_Change()
    If txt_ArtikelLaET2.Value = "" Then
        txt_BarArtikelLaET2.Value = ""
    Else
        txt_BarArtikelLaET2.Value = "*" & txt_ArtikelLaET2.Value & "*"
    End If
End Sub

Private Sub txt_ArtikelLaET3_Change()
    If txt_ArtikelLaET3.Value = "" Then
        txt_BarArtikelLaET3.Value = ""
    Else
        txt_BarArtikelLaET3.Value = "*" & txt_ArtikelLaET3.Value & "*"
    End If
End Sub

Private Sub txt_ArtikelNrE_Change()
    If txt_ArtikelNrE.Value = "" Then
        txt_BarArtikelNrE.Value = ""
    Else
        txt_BarArtikelNrE.Value = "*" & txt_ArtikelNrE.Value & "*"
    End If
End Sub

Private Sub txt_BarArtikelAnE_Change()
    lbl_BarArtikelAnE = txt_BarArtikelAnE
End Sub

Private Sub txt_FuellmengeB_Change()
    If txt_FuellmengeB = "" Then
        txt_BarFuellmengeB.Value = ""
    Else
        txt_BarFuellmengeB.Value = "*" & txt_FuellmengeB.Value & "*"
    End If
End Sub

Private Sub txt_FuellmengeN_Change()
    If txt_FuellmengeN = "" Then
        txt_BarFuellmengeN.Value = ""
    Else
        txt_BarFuellmengeN.Value = "*" & txt_FuellmengeN.Value & "*"
    End If
End Sub

Private Sub txt_LieferantAbs_Change()
    If txt_LieferantAbs.Value = "" Then
        txt_BarLieferantAbs.Value = ""
    Else
        txt_BarLieferantAbs.Value = "*" & txt_LieferantAbs.Value & "*"
    End If
End Sub

Private Sub txt_LieferantNrET3_Change()
    If txt_LieferantNrET3.Value = "" Then
        txt_BarLieferantNrET3.Value = ""
    Else
        txt_BarLieferantNrET3.Value = "*" & txt_LieferantNrET3.Value & "*"
    End If
End Sub

Private Sub txt_LieferscheinNr_Change()
    If txt_LieferscheinNr.Value = "" Then
        txt_BarLieferscheinNr.Value = ""
    Else
        txt_BarLieferscheinNr.Value = "*" & txt_LieferscheinNr.Value & "*"
    End If
End Sub

Private Sub txt_RENr_Change()
    If txt_RENr.Value = "" Then
        txt_BarRENr.Value = ""
    Else
        txt_BarRENr.Value = "*" & txt_RENr.Value & "*"
    End If
End Sub

Private Sub txt_Tabellblatt_Change()
    If txt_Tabellblatt.Value = "" Then
        lbl_TName.Visible = True
        cmd_newET.Visible = True
    Else
        lbl_TName.Visible = False
        cmd_newET.Visible = False
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim iZaehler As Long
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    If Worksheets("Daten").Range("B36") = "AN" Then
        Check_HerstellerNr = False
        Check_ArtikelNr.Value = True
        Check_Barcode.Value = False
    ElseIf Worksheets("Daten").Range("B36") = "HN" Then
        Check_ArtikelNr.Value = False
        Check_Barcode.Value = False
        Check_HerstellerNr = True
    Else
        Check_Barcode.Value = True
        Check_ArtikelNr.Value = False
        Check_HerstellerNr = False
    End If
    With cbo_Gew1
        .AddItem "g"
        .AddItem "kg"
        .AddItem "t"
    End With
    If Not Worksheets("Lager").Range("E1") = "" Then
        For iZaehler = 1 To 6
            With Controls("cbo_Auswahl" & iZaehler)
                .AddItem ""
                .AddItem Worksheets("Lager").Range("E1")
                .AddItem "Artikelnummer"
                .AddItem "Bezeichnung"
                .AddItem "EAN-Nummer"
                .AddItem "Einheit"
                .AddItem "EK-Preis"
                .AddItem "Gewicht"
                .AddItem "Herstellernummer"
                .AddItem "Hersteller"
                .AddItem "Lagerort"
                .AddItem "Lieferant"
                .AddItem "Menge"
                .AddItem "Kommentar"
                .AddItem "VK-Preis"
                .AddItem "Verwendbar"
                .AddItem "Warengruppe"
            End With
        Next iZaehler
    Else
        For iZaehler = 1 To 6
            With Controls("cbo_Auswahl" & iZaehler)
                .AddItem ""
                .AddItem "Artikelnummer"
                .AddItem "Bezeichnung"
                .AddItem "EAN-Nummer"
                .AddItem "Einheit"
                .AddItem "EK-Preis"
                .AddItem "Gewicht"
                .AddItem "Herstellernummer"
                .AddItem "Hersteller"
                .AddItem "Lagerort"
                .AddItem "Lieferant"
                .AddItem "Menge"
                .AddItem "Kommentar"
                .AddItem "VK-Preis"
                .AddItem "Verwendbar"
                .AddItem "Warengruppe"
            End With
        Next iZaehler
    End If
    txt_LieferantenE = Sheets("Daten").Range("B9").Text
    txt_DatumE = Format(Date, "DD.MM.YYYY")
End Sub

Sub suchenEtikettB() '1.44
    Dim iZ|fffd|hler As Long
    Dim Textstr As String
    On Error Resume Next
    If Not Sheets("Lager").Range("E1") = "" Then
        Textstr = CStr(Sheets("Lager").Range("E1"))
        For iZ|fffd|hler = 1 To 6
           If Not Controls("cbo_Auswahl" & iZ|fffd|hler) = "" Then
                If Controls("cbo_Auswahl" & iZ|fffd|hler) = Textstr Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Frei.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Artikelnummer" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Artikelnummer.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Bezeichnung" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Bezeichnung.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EAN-Nummer" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Barcode.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Einheit" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cbo_einheit.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EK-Preis" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txtEKPreis.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Gewicht" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Gewicht.Value & " " & frmArtikel.cbo_gewicht
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Herstellernummer" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Hnr.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Hersteller" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cbo_Hersteller
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Lagerort" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cboLagerort
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Lieferant" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cboLieferant
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Menge" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Bestand.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Kommentar" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txtKommentar.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "VK-Preis" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txtVKPreis.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Warengruppe" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cboWarengruppe
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Verwendbar" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Verwendbar.Value
                End If
            Else
                 Controls("txt_Auswahl" & iZ|fffd|hler) = ""
            End If
        Next iZ|fffd|hler
    Else
        For iZ|fffd|hler = 1 To 6
           If Not Controls("cbo_Auswahl" & iZ|fffd|hler) = "" Then
                If Controls("cbo_Auswahl" & iZ|fffd|hler) = "Artikelnummer" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Artikelnummer.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Bezeichnung" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Bezeichnung.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EAN-Nummer" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Barcode.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Einheit" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cbo_einheit.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EK-Preis" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txtEKPreis.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Gewicht" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Gewicht.Value & " " & frmArtikel.cbo_gewicht
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Herstellernummer" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Hnr.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Hersteller" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cbo_Hersteller
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Lagerort" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cboLagerort
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Lieferant" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cboLieferant
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Menge" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Bestand.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Kommentar" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txtKommentar.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "VK-Preis" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txtVKPreis.Value
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Warengruppe" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.cboWarengruppe
                ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Verwendbar" Then
                    Controls("txt_Auswahl" & iZ|fffd|hler) = frmArtikel.txt_Verwendbar.Value
                End If
            Else
                 Controls("txt_Auswahl" & iZ|fffd|hler) = ""
            End If
        Next iZ|fffd|hler
    End If
End Sub

Sub suchenEtikettBWE() '1.44
    Dim iZ|fffd|hler, lngID As Long
    Dim Textstr As String
    Dim arrTmpB, arrTmpA, Last_Row, i As Long
    On Error Resume Next
    If Not Sheets("Lager").Range("E1") = "" Then
        Textstr = CStr(Sheets("Lager").Range("E1"))
        For iZ|fffd|hler = 1 To 6
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmWareneingangoB.txtID) Then
                        lngID = i
                    End If
                Next i
            End With
            If Not Controls("cbo_Auswahl" & iZ|fffd|hler) = "" Then
                 If Controls("cbo_Auswahl" & iZ|fffd|hler) = Textstr Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 5)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Artikelnummer" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = frmWareneingangoB.cboArtikelNR.Value
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Bezeichnung" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = VBA.Replace(CStr(frmWareneingangoB.lbl_bezeichnung), Chr$(13) & Chr$(10), " ")
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EAN-Nummer" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 31)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Einheit" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 12)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EK-Preis" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 14)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Gewicht" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 12) & " " & Worksheets("Lager").Cells(CDbl(lngID), 13)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Herstellernummer" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 4)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Hersteller" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 7)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Lagerort" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = frmWareneingangoB.lbl_lagerort
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Menge" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 8)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Kommentar" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 20)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "VK-Preis" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 15)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Warengruppe" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 16)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Verwendbar" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 39)
                 End If
            Else
                 Controls("txt_Auswahl" & iZ|fffd|hler) = ""
            End If
        Next iZ|fffd|hler
    Else
        For iZ|fffd|hler = 1 To 6
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmWareneingangoB.txtID) Then
                        lngID = i
                    End If
                Next i
            End With
            If Not Controls("cbo_Auswahl" & iZ|fffd|hler) = "" Then
                 If Controls("cbo_Auswahl" & iZ|fffd|hler) = "Artikelnummer" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = frmWareneingangoB.cboArtikelNR.Value
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Bezeichnung" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = VBA.Replace(CStr(frmWareneingangoB.lbl_bezeichnung), Chr$(13) & Chr$(10), " ")
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EAN-Nummer" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 31)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Einheit" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 12)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "EK-Preis" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 14)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Gewicht" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 12) & " " & Worksheets("Lager").Cells(CDbl(lngID), 13)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Herstellernummer" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 4)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Hersteller" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 7)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Lagerort" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = frmWareneingangoB.lbl_lagerort
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Menge" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 8)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Kommentar" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 20)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "VK-Preis" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 15)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Warengruppe" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 16)
                 ElseIf Controls("cbo_Auswahl" & iZ|fffd|hler) = "Verwendbar" Then
                     Controls("txt_Auswahl" & iZ|fffd|hler) = Worksheets("Lager").Cells(CDbl(lngID), 39)
                 End If
            Else
                 Controls("txt_Auswahl" & iZ|fffd|hler) = ""
            End If
        Next iZ|fffd|hler
    End If
End Sub

Sub EtikettT()
    If frmEtikett.Ch_T1 = True Then
        frmEtikett.Ch_T2 = False
        Frame_T2.Enabled = False
        frmEtikett.Ch_T3 = False
        Frame_T3.Enabled = False
    ElseIf frmEtikett.Ch_T2 = True Then
        frmEtikett.Ch_T1 = False
        Frame_T1.Enabled = False
        frmEtikett.Ch_T3 = False
        Frame_T3.Enabled = False
    Else
        frmEtikett.Ch_T1 = False
        Frame_T1.Enabled = False
        frmEtikett.Ch_T2 = False
        Frame_T2.Enabled = False
    End If
End Sub
Attribute VB_Name = "frmGruppen"
Attribute VB_Base = "0{D9E5051D-E690-4ED5-B101-9D8B841D7CF6}{D99059F2-CA05-4A32-A0E9-6148B108E99B}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    If Sheets("Daten").Range("B7").Value = "Admin" Then lbl_Stime.Visible = True
    If cbo_Gruppe.ListIndex = -1 Then cbo_Gruppe = "Keine Gruppe(n) vorhanden"
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Gruppen")
        ALetzte = Sheets("Gruppen").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not IsEmpty(.Cells(irow, 2)) Then
                xKey = .Cells(irow, 2).Value
                DIC(xKey) = 0
            End If
        Next
        For Each xKey In DIC
            cbo_Gruppe.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_Gruppe.ListIndex = -1
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_Gruppe_Click()
    If Not cbo_Gruppe = "Keine Gruppe(n) vorhanden" And Not cbo_Gruppe = "" Then
        ComGrbe.Visible = True
        cmdloeschen.Visible = True
        cmd_GPrint.Visible = True
        cmd_Gorder.Visible = True
    End If
    Call Gruppen
    CheckBox2 = True
End Sub

Private Sub CheckBox2_Click()
    Dim intRow, lngwert As Long
    
    If Me!lstGruppen.ListCount = 0 Then
        CheckBox2 = False
        Exit Sub
    End If
    If CheckBox2 = False Then
        For intRow = 0 To Me!lstGruppen.ListCount - 1
            Me!lstGruppen.Selected(intRow) = False
        Next intRow
        lbl_Gewicht2.Caption = ""
        lbl_nvksum.Caption = Format(0, "currency")
        Exit Sub
    Else
        Call WKselect_all
    End If
End Sub

Sub WKselect_all()
    txt_Fast = "x"
    Dim intRow As Long
    For intRow = 0 To Me!lstGruppen.ListCount - 1
        Me!lstGruppen.Selected(intRow) = True
    Next intRow
    txt_Fast = ""
    Call AuswahlSum
End Sub

Private Sub cmd_Gorder_Click()
    Call Gorder
End Sub

Private Sub Gorder() 'v1.44
    Dim strBNr, strID, strF As String
    Dim lngIndex, lngID, Last_Row2, arrTmpA2, arrTmpB2, j2, i2, lngZeile As Long
    On Error Resume Next
    If Sheets("Daten").Range("D39").Value = "Nein" Or Not Sheets("Daten").Range("D39").Value = "" Then
        If Sheets("Daten").Range("D39").Value = "Auswahl 2" Then
            strBNr = "BE" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
        Else
            strF = Sheets("Daten").Range("D42")
            strBNr = Sheets("Daten").Range("D40") & Format((Sheets("Daten").Range("D41") + 1), strF)
        End If
    Else
        strBNr = InputBox("Bitte geben Sie eine Bestellnummer ein!", "Teil(e) nachbestellen")
    End If
    If strBNr = "" Then Exit Sub
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Bestellung").Cells(Rows.Count, 1).End(xlUp).Row
    frmGruppen.AuswahlSum
    If frmGruppen.cbo_Gruppe.Value = "" Then Exit Sub
    Sheets("Bestellung").Activate
    For lngIndex = 0 To frmGruppen.lstGruppen.ListCount - 1
        If frmGruppen.lstGruppen.Selected(lngIndex) Then
            lngZeile = lngZeile + 1
            strID = Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 1)
            With ThisWorkbook.Sheets("Lager")
                Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA2 = .Range("A1:AO" & Last_Row2)
                ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                For i2 = 2 To UBound(arrTmpA2)
                    If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(strID) Then
                        lngID = i2
                    End If
                Next i2
            End With
            Worksheets("Bestellung").Cells(lngZeile, 1).Value = "'" & strBNr 'Bestellnummer
            Worksheets("Bestellung").Cells(lngZeile, 2).Value = Worksheets("Lieferanten").Cells((Worksheets("Lieferanten").Range("A:A").Find(Worksheets("Lager").Cells(CDbl(lngID), 18), LookIn:=xlValues, MatchCase:=True).Row), 2)
            Worksheets("Bestellung").Cells(lngZeile, 3).Value = "'" & frmGruppen.lstGruppen.Column(0, lngIndex) 'Artikelnummer
            Worksheets("Bestellung").Cells(lngZeile, 4).Value = Worksheets("Lager").Cells(CDbl(lngID), 4) 'Herstellernummer
            Worksheets("Bestellung").Cells(lngZeile, 5).Value = frmGruppen.lstGruppen.Column(2, lngIndex) 'Bezeichnung
            Worksheets("Bestellung").Cells(lngZeile, 6).Value = frmGruppen.lstGruppen.Column(3, lngIndex)
            If Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 9) = "" Then
                Worksheets("Bestellung").Cells(lngZeile, 7).Value = Worksheets("Lager").Cells(CDbl(lngID), 13)
            Else
                Worksheets("Bestellung").Cells(lngZeile, 7).Value = ""
            End If
            Worksheets("Bestellung").Cells(lngZeile, 8).Value = Format(Date, "DD.MM.YYYY")
            Worksheets("Bestellung").Cells(lngZeile, 9).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 14) * frmGruppen.lstGruppen.Column(3, lngIndex))
            Worksheets("Bestellung").Cells(lngZeile, 10).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 14))
            Worksheets("Bestellung").Cells(lngZeile, 12).Value = Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 1) 'ID
            Worksheets("Bestellung").Cells(lngZeile, 13).Value = Worksheets("Lager").Cells(CDbl(lngID), 31) 'Barcode
            Worksheets("Bestellung").Cells(lngZeile, 14).Value = Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 9) 'LID
        End If
    Next
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    MsgBox "Die Bestellung: " & strBNr & " wurde gespeichert!" & vbLf & "Bitte pr|fffd|fen Sie die bestellte Menge!", , "Teil(e) nachbestellen"
End Sub

Private Sub cmd_GPrint_Click()
    lbl_status.Caption = "Gruppe: " & cbo_Gruppe & " wird gedruckt!"
    lbl_status.Visible = True
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    Call GPrint
End Sub

Sub GPrint() 'v1.43
    Dim zeLB, zeTB, spTB, spLB, lngW, Pos, lngID, Farbe As Long
    Dim strDruckerA As String
    Dim Kopien As Variant
    Dim arrTmpA2, arrTmpB2, i2 As Long
    Dim Last_Row2 As Long
    On Error Resume Next
    
    If cbo_Gruppe = "" Then Exit Sub
    Application.ScreenUpdating = False
    strDruckerA = Application.ActivePrinter 'Drucker merken
    Sheets("Vorlage2").Activate
    Sheets("Vorlage2").Visible = True
    Range("Vorlage2!A7:G400").Delete
    Sheets("Vorlage2").Range("A1") = "Artikelgruppe"
    Sheets("Vorlage2").Range("G1") = Format(Date, "DD.MM.YYYY")
    Sheets("Vorlage2").Range("A3") = cbo_Gruppe
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("A5") = ""
    Sheets("Vorlage2").Range("G6") = ""
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = ""
    zeTB = 7
    Pos = 1
    For zeLB = 0 To frmGruppen.lstGruppen.ListCount - 1
        If Not frmGruppen.lstGruppen.List(zeLB, 2) = "" Then
            With ThisWorkbook.Sheets("Lager")
                Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA2 = .Range("A1:AO" & Last_Row2)
                ReDim arrTmpB2(1 To 2, 1 To UBound(arrTmpA2))
                For i2 = 2 To UBound(arrTmpA2)
                    If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(lstGruppen.Column(1, zeLB)) Then
                        lngID = i2
                    End If
                Next i2
            End With
            Sheets("Vorlage2").Cells(zeTB, 1) = Pos
            Sheets("Vorlage2").Cells(zeTB, 1).HorizontalAlignment = xlLeft
            Sheets("Vorlage2").Cells(zeTB, 1).VerticalAlignment = xlTop
            Sheets("Vorlage2").Cells(zeTB, 1).NumberFormat = "@"
            Sheets("Vorlage2").Cells(zeTB, 2) = "'" & frmGruppen.lstGruppen.List(zeLB, 0)
            Sheets("Vorlage2").Cells(zeTB, 2).VerticalAlignment = xlTop
            Sheets("Vorlage2").Cells(zeTB, 3) = Sheets("Lager").Cells(CDbl(lngID), 4)
            Sheets("Vorlage2").Cells(zeTB, 3).VerticalAlignment = xlTop
            Sheets("Vorlage2").Cells(zeTB, 3).WrapText = True
            Sheets("Vorlage2").Cells(zeTB, 4) = frmGruppen.lstGruppen.List(zeLB, 2)
            Sheets("Vorlage2").Cells(zeTB, 4).HorizontalAlignment = xlLeft
            Sheets("Vorlage2").Cells(zeTB, 4).WrapText = True
            Sheets("Vorlage2").Cells(zeTB, 4).VerticalAlignment = xlTop
            Sheets("Vorlage2").Cells(zeTB, 5) = frmGruppen.lstGruppen.List(zeLB, 3) & " " & Worksheets("Lager").Cells(CDbl(lngID), 12)
            Sheets("Vorlage2").Cells(zeTB, 5).HorizontalAlignment = xlCenter
            Sheets("Vorlage2").Cells(zeTB, 5).VerticalAlignment = xlTop
            Sheets("Vorlage2").Cells(zeTB, 6) = frmGruppen.lstGruppen.List(zeLB, 5)
            Sheets("Vorlage2").Cells(zeTB, 6).VerticalAlignment = xlTop
            Sheets("Vorlage2").Cells(zeTB, 6).NumberFormat = "@"
            Pos = Pos + 1
            zeTB = zeTB + 1
        End If
    Next
    Farbe = 0
    For spLB = 0 To CDbl(Pos) - 1
        If Farbe = 1 Then
            Sheets("Vorlage2").Range("A" & 7 + spLB & ":G" & 7 + spLB).Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = -0.149998474074526
                .PatternTintAndShade = 0
            End With
            Farbe = 0
        Else
            Sheets("Vorlage2").Range("A" & 7 + spLB & ":G" & 7 + spLB).Select
            Farbe = 1
        End If
    Next
    Sheets("Vorlage2").Cells(zeTB + 2, 1) = "Entnahme durch: "
    Sheets("Vorlage2").Cells(zeTB + 4, 1) = "...................................................................."
    Sheets("Vorlage2").Cells(zeTB + 5, 1) = "(Name/ Mitarbeiter)"
    Kopien = Application.InputBox("Anzahl Kopien", "Gruppe drucken", 1)
    If Kopien = False Then
        Sheets("Center").Activate
        Application.ScreenUpdating = True
        lbl_status.BackColor = &HC0&
        lbl_status.BorderColor = &HC0&
        lbl_status.Caption = "Ausdruck wurde abgebrochen!"
        Application.Wait (Now + TimeValue("00:00:02"))
        lbl_status.Visible = False
        Exit Sub
    End If
    Application.Dialogs(xlDialogPrinterSetup).Show
    Worksheets("Vorlage2").PrintOut Copies:=CLng(Kopien)
    Application.ActivePrinter = strDruckerA 'Drucker zur|fffd|cksetzen
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    lbl_status.Visible = False
End Sub

Private Sub cmdexit_Click()
    If Not frmGruppen.txt_ASLager.Value = "" Then
        frmLager.cboArtikelnummer = frmGruppen.txt_ASLager.Value
    End If
    Unload frmGruppen
    frmLager.Show
End Sub

Private Sub lstGruppen_Change()
    If txt_Fast.Value = "" Then
        Call AuswahlSum
    End If
    lbl_status.Visible = False
End Sub

Private Sub txtinfo_Click()
    frmorderinfo.lblArtikelinfo.Caption = "Artikelgruppe (" + frmGruppen.cbo_Gruppe.Value + ")"
    Call frmorderinfo.SuchenBestellung2
    frmorderinfo.Show
End Sub

Private Sub ComGrbe_Click()
    On Error Resume Next
    If cbo_Gruppe = "Keine Gruppe(n) vorhanden" Then Exit Sub
    If cbo_Gruppe = "" Then
        lbl_status.Caption = "Bitte w|fffd|hlen Sie einen Gruppe aus!"
        lbl_status.Visible = True
        cbo_Gruppe.SetFocus
        Exit Sub
    Else
        frmGruppenanlegen.lbArtikelgruppeNamen.Caption = "Name der Gruppe"
        frmGruppenanlegen.txtAGName.Enabled = False
        frmGruppenanlegen.txtAGName.Value = frmGruppen.cbo_Gruppe.Value
        frmGruppenanlegen.lbinfo.Caption = "(" & cbo_Gruppe.Text & ") bearbeiten"
        frmGruppenanlegen.Label4.Caption = "Gruppe bearbeiten"
        frmGruppenanlegen.cmdchanel.Visible = False
        frmGruppenanlegen.cmdchanel2.Visible = True
        frmGruppenanlegen.cmdArtikelLoeschen.Visible = True
        frmGruppenanlegen.cbo_ArtikelNR_UM = txt_ANr.Value
        frmGruppenanlegen.txt_UMID.Value = txt_AID.Value
        frmGruppenanlegen.suchenNeu
        Unload frmGruppen
        frmGruppenanlegen.Show
    End If
End Sub

Private Sub cmbAM_Click()
    Dim intRow As Integer
    For intRow = 0 To Me!lstGruppen.ListCount - 1
        Me!lstGruppen.Selected(intRow) = True
    Next intRow
    Call AuswahlSum
End Sub

Private Sub cmbMA_Click()
    Dim intRow As Integer
    For intRow = 0 To Me!lstGruppen.ListCount - 1
        Me!lstGruppen.Selected(intRow) = False
    Next intRow
    Call AuswahlSum
End Sub

Private Sub cmdchanel_Click()
    Unload frmGruppen
    frmLager.Show
End Sub

Private Sub txtUMST_Change()
    Call AuswahlSum
End Sub

Private Sub cmd_GruppeNeu_Click()
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    Unload frmGruppen
    frmGruppenanlegen.cmdArtikelLoeschen.Visible = True
    frmGruppenanlegen.txtAGName.SetFocus
    frmGruppenanlegen.Show
End Sub

Private Sub cmdloeschen_Click()
    Dim z, p As Long
    Dim gn As String
    gn = cbo_Gruppe
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If cbo_Gruppe.Value = "" Or cbo_Gruppe = "Keine Gruppe(n) vorhanden" Then
        MsgBox "Es wurde keine Gruppe ausgew|fffd|hlt!", , "Hinweis"
        cbo_Gruppe.SetFocus
        Exit Sub
    End If
    If MsgBox(cbo_Gruppe.Value & " wirklich l|fffd|schen?", vbYesNo, "Gruppe l|fffd|schen") = vbYes Then
        If cbo_Gruppe <> "" Then
            Application.ScreenUpdating = False
            For z = lstGruppen.ListCount To 1 Step -1
                p = lstGruppen.Column(8, z - 1)
                Sheets("Gruppen").Rows(p).Delete
            Next
            cbo_Gruppe.Clear
            lbl_nvksum.Caption = ""
            txtmin.Value = ""
            lstGruppen.Clear
            Call UserForm_Initialize
            Application.ScreenUpdating = True
        End If
    Else
        Exit Sub
    End If
    lbl_status.Caption = "Gruppe: " & gn & " wurde gel|fffd|scht!"
    lbl_status.Visible = True
End Sub

Private Sub cmd_GruppeWA_Click()
    Dim blnMarkiert As Boolean
    Dim listenwert  As Long
    On Error Resume Next
 
    frmGruppen.txt_Fast.Value = "x"
    If txt_Lagercheck.Value > 0 And Not txt_Lagercheck.Value = "" Then
        MsgBox "Bitte pr|fffd|fen Sie, ob alle Aritkel (dieser Gruppe) im Lager angelegt sind!", vbCritical, "Warenausgang Gruppe"
        Exit Sub
    End If
    If cbo_Gruppe.Value = "" Then Exit Sub
    For listenwert = 0 To lstGruppen.ListCount - 1
        If lstGruppen.Selected(listenwert) Then
            blnMarkiert = True
            Exit For
        End If
    Next listenwert
    If blnMarkiert = False Then
        MsgBox "Es wurde kein Artikel in der Liste makiert!", _
        vbExclamation, "Hinweis!"
        Exit Sub
    End If
    frmWarenentnahmeschein.txtBezeichnung.Value = frmGruppen.cbo_Gruppe.Value
    frmWarenentnahmeschein.txtanzahl.Value = 1
    frmWarenentnahmeschein.txtUgruppen = frmGruppen.txtnvksum2.Value
    frmWarenentnahmeschein.Show
End Sub

Private Sub txtmin_Change()
    Farbepr|fffd|fen txtmin
End Sub

Sub Gruppen() '1.44
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2, arrTmpA, arrTmpB, i, j, n As Long
    Dim Last_Row3, arrTmpA3, arrTmpB3, i3 As Long
    Dim Last_Row, lngID, lngLPID, lngRow2, lngrow As Long
    Dim T As Double
    On Error Resume Next
    txt_Fast.Value = "x"
    Application.ScreenUpdating = False
    T = Timer
    lstGruppen.Clear
    txtinfo.Visible = False
    With ThisWorkbook.Sheets("Gruppen")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AZ" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) = CStr(cbo_Gruppe) Then
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AZ" & Last_Row2)
                    ReDim arrTmpB2(1 To 2, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If arrTmpA2(i2, 1) = CStr((arrTmpA(i, 1))) Then
                            lngID = i2
                        End If
                    Next i2
                End With
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = arrTmpA(i, 1)
                arrTmpB(3, n) = VBA.Replace(CStr(Worksheets("Lager").Cells(CDbl(lngID), 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 5)
                If arrTmpA(i, 9) = "" Then
                    arrTmpB(5, n) = Worksheets("Lager").Cells(CDbl(lngID), 8) 'Menge Lager
                    arrTmpB(6, n) = Worksheets("Lager").Cells(CDbl(lngID), 13) 'VBA #Lagerort
                Else
                    On Error GoTo Fehler:
                    With ThisWorkbook.Sheets("Lagerorte")
                        Last_Row3 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA3 = .Range("A1:AZ" & Last_Row3)
                        ReDim arrTmpB3(1 To 2, 1 To UBound(arrTmpA3))
                        For i3 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i3, 1) = CStr((arrTmpA(i, 9))) Then
                                lngLPID = i3
                            End If
                        Next i3
                    End With
                    arrTmpB(5, n) = Worksheets("Lagerorte").Cells(CDbl(lngLPID), 4) 'Menge Lager
                    arrTmpB(6, n) = Worksheets("Lagerorte").Cells(CDbl(lngLPID), 3)
                End If
                lngRow2 = 0
                For lngrow = 1 To Worksheets("Bestellung").Cells(Rows.Count, 6).End(xlUp).Row
                    If CStr(Worksheets("Bestellung").Cells(lngrow, 12)) = CStr(Worksheets("Lager").Cells(CDbl(lngID), 1)) Then
                        lngRow2 = lngRow2 + Worksheets("Bestellung").Cells(lngrow, 6)
                    End If
                Next
                If lngRow2 = 0 Then
                    If CDbl(arrTmpB(4, n)) > CDbl(arrTmpB(5, n)) Then
                        arrTmpB(7, n) = "Lagerbestand pr|fffd|fen!"
                    Else
                        arrTmpB(7, n) = ""
                        GoTo weiter2
Fehler:                     arrTmpB(7, n) = "#Fehler auf Lagerort!# "
                    End If
weiter2:
                ElseIf lngRow2 > 1 Then
                    arrTmpB(7, n) = "Es wurden " & lngRow2 & " St|fffd|cke bestellt!"
                Else
                    arrTmpB(7, n) = "Es wurde " & lngRow2 & " St|fffd|ck bestellt!"
                End If
                If Not Worksheets("Lager").Cells(CDbl(lngID), 42).Value = "" Then
                    arrTmpB(7, n) = "Artikel ist gesperrt!"
                End If
                arrTmpB(8, n) = Format(Worksheets("Lager").Cells(CDbl(lngID), 15) * CDbl(arrTmpA(i, 5)), "currency")
                arrTmpB(9, n) = i
                arrTmpB(10, n) = Worksheets("Lager").Cells(CDbl(lngID), 32) * CDbl(arrTmpA(i, 5))
                txt_AID.Value = arrTmpA(i, 8)
                txt_ANr.Value = arrTmpA(i, 7)
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 10)
             For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstGruppen
                 .ColumnCount = 10
                 .MultiSelect = fmMultiSelectMulti
                 .ListStyle = fmListStyleOption
                 .List = arrTmpA
             End With
        End If
    End With
    Call WKselect_all
    CheckBox2 = True
    Application.ScreenUpdating = True
    txt_Fast.Value = ""
    Call AuswahlSum
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub Datensaetze()
    On Error Resume Next
    ThisWorkbook.Activate
    If CDbl(lstGruppen.ListCount) = 0 Then
        lbl_datensaetze.Caption = ""
    ElseIf CDbl(lstGruppen.ListCount) > 1 Then
        lbl_datensaetze.Caption = lstGruppen.ListCount & " Datens|fffd|tze gefunden"
    Else
        lbl_datensaetze.Caption = lstGruppen.ListCount & " Datensatz gefunden"
    End If
End Sub

Sub min() '1.39
    Dim listArr() As Double
    Dim i As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    ReDim listArr(0 To lstGruppen.ListCount - 1)
        For i = 0 To lstGruppen.ListCount + 1
            listArr(i) = CDbl(lstGruppen.Column(4, i)) / CDbl(lstGruppen.Column(3, i))
        Next
    If CDbl(Fix(Application.min(listArr))) < 0 Then
        txtmin.Value = 0
    Else
        txtmin.Value = Fix(Application.min(listArr))
    End If
    If txtmin.Value <= 0 Then txtinfo.Visible = True
    Application.ScreenUpdating = True
End Sub

Function Farbepr|fffd|fen(tb As Object)
    With tb
        Select Case .Value
            Case Is = 0: .ForeColor = vbRed
            Case Is = "vorgemerkt": .BackColor = vbGreen
            Case Else: .ForeColor = vbBlack
        End Select
    End With
End Function

Sub AuswahlSum()
    Dim sumcost, Wert2 As Double
    Dim i As Long
    On Error Resume Next
    If txt_Fast.Value = "" Then
        Application.ScreenUpdating = False
        sumcost = 0
        Wert2 = 0
        For i = 0 To frmGruppen.lstGruppen.ListCount - 1
            If lstGruppen.Selected(i) Then
                sumcost = sumcost + frmGruppen.lstGruppen.List(i, 7)
                Wert2 = Wert2 + frmGruppen.lstGruppen.List(i, 9)
            End If
        Next i
        lbl_nvksum.Caption = Format((sumcost), "currency")
        txtnvksum2.Value = Format((sumcost), "currency")
        lbl_Gewicht2.Caption = Format(CDbl(Wert2), "0.000") & " kg"
        Call min
        Call Datensaetze
        Application.ScreenUpdating = True
    End If
End Sub
Attribute VB_Name = "frmGruppenanlegen"
Attribute VB_Base = "0{B0C50B6F-732F-4CEF-87E2-28523970CC74}{2516A109-334C-4A1D-83FF-30D6C2C207D1}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cbo_ArtikelNR_UM_Change()
    Call suchenTArtikelUmwa
End Sub

Private Sub cbo_Lagerplatz_Change()
    Dim lng, lngID As Long
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row, lngZ As Long
    On Error Resume Next
        
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = CStr(txtID) Then
                lngID = i
            End If
        Next i
    End With
    lngZ = 0
    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
        If Sheets("Lagerorte").Cells(lng, 2) = CStr(txtID) And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz.Text Then
            txt_LPID.Value = Sheets("Lagerorte").Cells(lng, 1)
            lngZ = lngZ + 1
        End If
    Next lng
    If lngZ = 0 Then
        txt_LPID.Value = ""
    End If
End Sub

Private Sub chk_UmwArtikel_Change()
    If chk_UmwArtikel.Value = True Then
        cbo_ArtikelNR_UM.Enabled = False
        txt_BezUmwa.Enabled = False
        List_Umwa.Enabled = False
        cmd_BezUmwa.Enabled = False
        lbl_BezUmwa.Enabled = False
        lbl_ListUmwa.Enabled = False
        cbo_ArtikelNR_UM.ListIndex = -1
    Else
        cbo_ArtikelNR_UM.Enabled = True
        txt_BezUmwa.Enabled = True
        List_Umwa.Enabled = True
        cmd_BezUmwa.Enabled = True
        lbl_BezUmwa.Enabled = True
        lbl_ListUmwa.Enabled = True
    End If
End Sub

Private Sub cmd_BezUmwa_Click()
    Call SuchenBegriffOP
End Sub

Private Sub cmd_NeuArtikelGr_Click()
    frmArtikel.txt_Verleih.Value = "Grup"
    Call Neu
End Sub

Private Sub cmdBezeichn_Click()
    Call SuchenBegriff
    lstArtikelID.SetFocus
End Sub

Sub SuchenBegriffOP() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next

    SuchKriterium = LCase(txt_BezUmwa)
    List_Umwa.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:N" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If InStr(1, LCase(arrTmpA(i, 6)), LCase(SuchKriterium)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(2, n) = i
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 2)
             For i = 1 To 2
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With List_Umwa
                .ColumnCount = 5
                .ColumnWidths = "100;0"
                .List = arrTmpA
             End With
        End If
    End With
End Sub

Sub SuchenBegriff() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next

    SuchKriterium = LCase(txt_Begriff)
    lstArtikelID.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:N" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If InStr(1, LCase(arrTmpA(i, 6)), LCase(SuchKriterium)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(2, n) = i
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 2)
             For i = 1 To 2
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstArtikelID
                .ColumnCount = 5
                .ColumnWidths = "100;0"
                .List = arrTmpA
             End With
        End If
    End With
End Sub

Private Sub cmd_SaveUm_Click()
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    Dim IDU As String
    On Error Resume Next
    If chk_UmwArtikel.Value = True Then
        Call Umwandeln
        MsgBox "Es wurde kein Artikel gespeichert!", , "Hinweis"
    Else
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If CStr(arrTmpA(i, 3)) = CStr(cbo_ArtikelNR_UM) Then
                    IDU = arrTmpA(i, 1)
                End If
            Next i
        End With
        frmGruppenanlegen.txt_UMID.Value = IDU
        Call Umwandeln
        MsgBox "Gespeicht!", , "Hinweis"
    End If
End Sub

Private Sub List_Umwa_Click()
    Dim lngZeile As Long

    lngZeile = List_Umwa.Column(1)
    txt_UMID.Value = Sheets("Lager").Cells(lngZeile, 1).Value
End Sub

Private Sub txt_Begriff_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If Not txt_Begriff = "" Then
        If KeyCode = 13 Then
            Call SuchenBegriff
        End If
    End If
End Sub

Private Sub txt_GArtikelNr_Change()
    If Not txt_GArtikelNr = "" Then
        If txt_GArtikelNr.TextLength > 2 Then
            Call GArtikelNr
            If lstArtikelID.ListCount = 0 Then
                lbl_Kartikel.Visible = True
            Else
                lbl_Kartikel.Visible = False
            End If
        Else
            lstArtikelID.Clear
        End If
    End If
End Sub

Sub GArtikelNr() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    Application.ScreenUpdating = False
    SuchKriterium = LCase(Me.txt_GArtikelNr)
    lstArtikelID.Clear
     With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:R" & Last_Row)
        ReDim arrTmpB(1 To 3, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If InStr(1, LCase(arrTmpA(i, 3)), LCase(SuchKriterium)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = CStr(arrTmpA(i, 3)) & " / " & VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(2, n) = i
                arrTmpB(3, n) = ""
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 3)
             For i = 1 To 3
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstArtikelID
                .ColumnCount = 3
                .ColumnWidths = "180;0;0"
                .List = arrTmpA
             End With
        End If
     End With
     Application.ScreenUpdating = True
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    cmdArtikelLoeschen.Caption = "Markierten Artikel " & vbLf & "l|fffd|schen"
    chk_UmwArtikel.Value = True
    Call ArtikelCombo
End Sub

Sub ArtikelCombo()
    Dim objDic  As Object
    Dim lngZ    As Long
    On Error Resume Next

    cbo_ArtikelNR_UM.Clear
    cboArtikelNR.Clear
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Lager").Cells(Rows.Count, 3).End(xlUp).Row
        objDic(Sheets("Lager").Cells(lngZ, 3).Value) = 0
    Next
    cboArtikelNR.List = objDic.keys
    cbo_ArtikelNR_UM.List = objDic.keys
    Set objDic = Nothing
    cbo_ArtikelNR_UM.ListIndex = -1
    cboArtikelNR.ListIndex = -1
End Sub

Private Sub lstArtikelID_Click()
    Dim lngZeile, lng As Long
    Dim lngS, lngg As Double
    Dim strFile As String
    Dim xKey As Variant
    Dim DIC As Object
    
    lngZeile = lstArtikelID.Column(1)
    txtBezeichnung.Value = Sheets("Lager").Cells(lngZeile, 6).Value
    txt_ArtikelNr.Value = Sheets("Lager").Cells(lngZeile, 3).Value
    txtID.Value = Sheets("Lager").Cells(lngZeile, 1).Value
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
            lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        frmGruppenanlegen.cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem Sheets("Lager").Cells(lngZeile, 13).Value
        For Each xKey In DIC
            frmGruppenanlegen.cbo_Lagerplatz.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_Lagerplatz.ListIndex = 0
    Else
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem Sheets("Lager").Cells(lngZeile, 13).Value
        cbo_Lagerplatz.ListIndex = 0
    End If
End Sub

Private Sub lstArtikelID_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    On Error Resume Next
    cboArtikelNR = Sheets("Lager").Cells(CLng(lstArtikelID.Column(1)), 3).Value
    txtstueck.SetFocus
End Sub

Private Sub lstArtikelID_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    cboArtikelNR = Sheets("Lager").Cells(CLng(lstArtikelID.Column(1)), 3).Value
    txtstueck.SetFocus
End Sub

Private Sub cmdArtikelLoeschen_Click()
    Dim lng As Long
    On Error Resume Next
    lng = lstGruppenanlegen.Column(6)
    Sheets("Gruppen").Rows(lng).Delete
    Call suchenNeu
End Sub

Private Sub cboArtikelNR_AfterUpdate() 'v1.40
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row, lngZ As Long
    Dim xrow, lng As Long
    Dim lngS, lngg As Double
    Dim strFile As String
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    
    Call suchenTArtikel
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 3) = CStr(cboArtikelNR) Then
                xrow = i
            End If
        Next i
    End With
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    txtBezeichnung.Value = Sheets("Lager").Cells(xrow, 6)
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
            lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        frmGruppenanlegen.cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem Sheets("Lager").Cells(xrow, 13).Value
        For Each xKey In DIC
            frmGruppenanlegen.cbo_Lagerplatz.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_Lagerplatz.ListIndex = 0
    Else
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem Sheets("Lager").Cells(xrow, 13).Value
        cbo_Lagerplatz.ListIndex = 0
    End If
End Sub

Private Sub cboartikelnr_Click() 'v1.40
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row, lngZ As Long
    Dim xrow As Long
    
    Call suchenTArtikel
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 3) = CStr(cboArtikelNR) Then
                xrow = i
            End If
        Next i
    End With
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    txtBezeichnung = Sheets("Lager").Cells(xrow, 6)
End Sub

Private Sub cmdchanel_Click()
    Dim z, p As Long
    On Error Resume Next

    If lstGruppenanlegen.ListCount = 0 Then
        Unload frmGruppenanlegen
        frmGruppen.Show
    Else
        For z = lstGruppenanlegen.ListCount To 1 Step -1
            p = lstGruppenanlegen.Column(4, z - 1)
            Sheets("Gruppen").Rows(p).Delete
        Next
        lstGruppenanlegen.Clear
        frmGruppen.Show
        Unload frmGruppenanlegen
    End If
End Sub

Private Sub cmdchanel2_Click()
    Unload frmGruppenanlegen
    frmGruppen.Show
End Sub

Private Sub cmdsave_Click()
    Unload frmGruppenanlegen
    frmGruppen.Show
End Sub

Private Sub CmdArtikelAN_Click() 'v1.39
    Dim lng(1 To 3) As Long
    Dim Last_Row, letztezeile, arrTmpA, arrTmpB, i, xrow, lngZeile As Long
    On Error Resume Next

    If txtID.Value = "" Or txtBezeichnung.Value = "" Then
        MsgBox "Sie m|fffd|ssen eine Artikelnummer angeben!", , "Hinweis"
        cboArtikelNR.SetFocus
        Exit Sub
    End If
    If txtAGName.Value = "" Then
        MsgBox "Sie m|fffd|ssen einen Namen f|fffd|r die Artikelgruppe angeben!", , "Hinweis"
        txtAGName.SetFocus
        Exit Sub
    End If
    If txtstueck.Value = "" Then
        MsgBox "Sie m|fffd|ssen eine Menge angeben!", , "Hinweis"
        txtstueck.SetFocus
        Exit Sub
    End If
    With Worksheets("Gruppen")
        If .FilterMode Then .ShowAllData
    End With
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Gruppen").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Gruppen").Activate
    lngZeile = lngZeile + 1
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                xrow = i
            End If
        Next i
    End With
    If Not Worksheets("Lager").Cells(CLng(xrow), 42) = "" Then
        MsgBox "Artikel ist gesperrt!", , "Hinweis"
        Sheets("Center").Activate
        Application.ScreenUpdating = True
        Exit Sub
    End If
    If Worksheets("Lager").Cells(CLng(xrow), 30) = "Y" Then
        If txtstueck.Value > CDbl("1") Then
            MsgBox "Durch die Seriennummer kann immer nur ein Artikel hinzugef|fffd|gt werden", , "Hinweis"
            txtstueck.Value = "1"
        End If
    Else
        Worksheets("Gruppen").Cells(lngZeile, 4).Value = txtBezeichnung.Value
    End If
    For lng(1) = 2 To ThisWorkbook.Worksheets("Gruppen").UsedRange.Rows.Count
        If Worksheets("Gruppen").Cells(lng(1), 2) = CStr(txtAGName) And Worksheets("Gruppen").Cells(lng(1), 1) = CStr(txtID) And Worksheets("Gruppen").Cells(lng(1), 9) = CStr(txt_LPID) Then
            lng(2) = Worksheets("Gruppen").Cells(lng(1), 1).Row
        End If
    Next lng
    If lng(2) > 0 Then
        lng(3) = Worksheets("Gruppen").Cells(lng(2), 5) + CDbl(txtstueck)
        Worksheets("Gruppen").Cells(lng(2), 5) = CDbl(lng(3))
        MsgBox "Artikel ist bereits vorhanden und die Menge betr|fffd|gt jetzt: " & lng(3) & "!", , "Hinweis"
    Else
        With frmGruppenanlegen
            Worksheets("Gruppen").Cells(lngZeile, 1).Value = "'" & txtID.Value
            Worksheets("Gruppen").Cells(lngZeile, 2).Value = txtAGName.Value
            If cboArtikelNR = "" Then
                Worksheets("Gruppen").Cells(lngZeile, 3).Value = "'" & txt_ArtikelNr.Value
            Else
                Worksheets("Gruppen").Cells(lngZeile, 3).Value = "'" & cboArtikelNR.Text
            End If
            Worksheets("Gruppen").Cells(lngZeile, 5).Value = txtstueck.Value
            If cbo_ArtikelNR_UM = "Keine Auswahl" Then
                Worksheets("Gruppen").Cells(lngZeile, 7).Value = ""
                Worksheets("Gruppen").Cells(lngZeile, 8).Value = ""
            Else
                Worksheets("Gruppen").Cells(lngZeile, 7).Value = cbo_ArtikelNR_UM
                Worksheets("Gruppen").Cells(lngZeile, 8).Value = txt_UMID.Value
            End If
            Worksheets("Gruppen").Cells(lngZeile, 9).Value = txt_LPID.Value
            cboArtikelNR.Value = ""
            txtBezeichnung.Value = ""
            txtstueck.Value = ""
            txt_Begriff.Value = ""
        End With
    End If
'    Sortieren nach Gruppennamen
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    ActiveSheet.UsedRange.Sort Key1:=Range(Cells(1, 2), Cells(letztezeile, 2)), Header:=xlYes
    Sheets("center").Activate
    lstArtikelID.Clear
    Call suchenNeu
    Application.ScreenUpdating = True
    txt_Begriff.SetFocus
End Sub

Sub suchenNeu() '1.44
    Dim Last_Row2, lngZ, Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim arrTmpA2, arrTmpB2, i2, j2, lng2, lngs2 As Long
    Dim SuchKriterium As String
    On Error Resume Next
    SuchKriterium = LCase(txtAGName.Text) '& "*"
    lstGruppenanlegen.Clear
    Application.ScreenUpdating = False
     With ThisWorkbook.Sheets("Gruppen")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And LCase(arrTmpA(i, 2)) Like SuchKriterium Then
                n = n + 1
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(arrTmpA(i, 1)) Then
                            lngZ = i2
                        End If
                    Next i2
                End With
                If Not arrTmpA(i, 8) = "" Then
                    chk_UmwArtikel.Value = False
                    cbo_ArtikelNR_UM.Enabled = True
                    cbo_ArtikelNR_UM.Text = arrTmpA(i, 7)
                Else
                    chk_UmwArtikel.Value = True
                End If
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = Worksheets("Lager").Cells(lngZ, 4)
                arrTmpB(3, n) = VBA.Replace(CStr(Worksheets("Lager").Cells(lngZ, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 5)
                If arrTmpA(i, 9) = "" Then
                    arrTmpB(5, n) = Worksheets("Lager").Cells(lngZ, 13)
                Else
                    arrTmpB(5, n) = Worksheets("Lagerorte").Cells((Worksheets("Lagerorte").Range("A:A").Find(CStr(arrTmpA(i, 9)), LookIn:=xlValues, MatchCase:=True).Row), 3)
                End If
                arrTmpB(6, n) = arrTmpA(i, 6)
                arrTmpB(7, n) = i
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 7)
             For i = 1 To 7
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstGruppenanlegen
                .ColumnCount = 5
                .ColumnWidths = "100;100;250;50;100;0;"
                .List = arrTmpA
             End With
        End If
     End With
     Application.ScreenUpdating = True
End Sub

Sub suchenTArtikel() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    
    If cboArtikelNR.Value = "" Then Exit Sub
    SuchKriterium = LCase(cboArtikelNR)
    lstArtikelID.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:N" & Last_Row)
       ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If InStr(1, LCase(arrTmpA(i, 3)), LCase(SuchKriterium)) > 0 Then
               n = n + 1
               arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
               arrTmpB(2, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 2)
            For i = 1 To 2
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstArtikelID
               .ColumnCount = 2
               .ColumnWidths = "100;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub

Sub suchenTArtikelUmwa() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    
    If cbo_ArtikelNR_UM.Value = "" Then Exit Sub
    SuchKriterium = LCase(cbo_ArtikelNR_UM)
    List_Umwa.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:N" & Last_Row)
       ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If InStr(1, LCase(arrTmpA(i, 3)), LCase(SuchKriterium)) > 0 Then
               n = n + 1
               arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
               arrTmpB(2, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 2)
            For i = 1 To 2
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With List_Umwa
               .ColumnCount = 2
               .ColumnWidths = "100;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub

Sub Umwandeln()
    Dim lng  As Long
    On Error Resume Next
    If txtAGName.Value = "" Then Exit Sub
    If lstGruppenanlegen.ListCount = 0 Then
        Exit Sub
    End If
    If chk_UmwArtikel.Value = True Then
        For lng = 2 To ThisWorkbook.Worksheets("Gruppen").UsedRange.Rows.Count
            If Worksheets("Gruppen").Cells(lng, 2) = txtAGName.Text Then
                Worksheets("Gruppen").Cells(lng, 7).Value = ""
                Worksheets("Gruppen").Cells(lng, 8).Value = ""
            End If
        Next lng
    Else
        For lng = 2 To ThisWorkbook.Worksheets("Gruppen").UsedRange.Rows.Count
            If Worksheets("Gruppen").Cells(lng, 2) = txtAGName.Text Then
                If cbo_ArtikelNR_UM = "Keine Auswahl" Then
                    Worksheets("Gruppen").Cells(lng, 7).Value = ""
                    Worksheets("Gruppen").Cells(lng, 8).Value = ""
                Else
                    Worksheets("Gruppen").Cells(lng, 7).Value = "'" & cbo_ArtikelNR_UM
                    Worksheets("Gruppen").Cells(lng, 8).Value = txt_UMID.Value
                End If
            End If
        Next lng
    End If
End Sub
Attribute VB_Name = "frmHelp"
Attribute VB_Base = "0{FE682A44-5CAD-4B02-87A9-032F8185F4FF}{2A25A41E-A021-4CFC-8D56-9E522D2CEF73}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cmdBackup_Click()
    Dim Datei As String
    Dim Phad As String
    On Error Resume Next
    Application.ScreenUpdating = False
    Datei = ThisWorkbook.Name
    Phad = ThisWorkbook.Path
    Kill Phad & "\" & Format(Now, "MM-DD-YY") & "_" & Format(Time, "HHMMSS") & "Backup.XLSM"
    ActiveWorkbook.SaveCopyAs Filename:=Phad & "\" & Format(Now, "MM-DD-YY") & "_" & Format(Time, "HHMMSS") & "Backup.XLSM"
    Sheets("Daten").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = Format(Date, "DD.MM.YYYY")
    ActiveCell.Offset(0, 1).Value = "Ein Backup wurde erfolgreich erstellt!"
    ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
    Sheets("Center").Activate
    MsgBox "Backup wurde erstellt!", vbOKOnly, "Backup"
    Application.ScreenUpdating = True
    Unload frmHelp
End Sub

Private Sub CommandButton1_Click()
    ThisWorkbook.Sheets("Daten").Range("B4").Value = "info"
    Unload frmHelp
End Sub

Private Sub Label10_Click()
    Open_URL ("https://drive.google.com/folderview?id=0B9nki6y80gLMemtpOGJmVHNsYWc&usp=sharing")
End Sub

Private Sub lbHomepage_Click()
    Open_URL (lbHomepage)
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
End Sub
Attribute VB_Name = "frmInfo"
Attribute VB_Base = "0{863F4F26-8148-4A06-9CF5-01162916A98E}{6BA271B9-65A6-4FAB-B716-118BF7C30A10}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
End Sub
Attribute VB_Name = "frmInfoAuf"
Attribute VB_Base = "0{125860A8-5A2F-4A78-8491-F87536FAC2D7}{EAD68384-7527-488A-9AAD-868F999DC882}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit

Private Sub ListBox1_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    On Error Resume Next
    If frmInfoAuf.Caption = "Alle aktiven Angebote!" Then
        frmKasse.cbo_Angebot = ListBox1.Column(1)
    Else
        frmKasse.cboAuftragSuchen = ListBox1.Column(1)
    End If
    Unload frmInfoAuf
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
End Sub

Private Sub ListBox1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    If frmInfoAuf.Caption = "Alle aktiven Angebote!" Then
        frmKasse.cbo_Angebot = ListBox1.Column(1)
    Else
        frmKasse.cboAuftragSuchen = ListBox1.Column(1)
    End If
    Unload frmInfoAuf
End Sub

Sub Auftrag()
    Dim MyDic As Object
    Dim sText As String
    Dim lZeile, lng, i, A As Long
    Dim ArrValues, arrList() As Variant
    On Error Resume Next
    Application.ScreenUpdating = False
    ListBox1.Clear
    '   Dictionary initialisieren
    Set MyDic = CreateObject("Scripting.Dictionary")
    With Worksheets("Reservierungen")
       For lZeile = 2 To .Cells(.Rows.Count, 1).End(xlUp).Row
          If .Cells(lZeile, 11).Value = "Auftrag" Then
    '   den Ordnungsbegriff (Key) zusammenstellen
            lng = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(.Cells(lZeile, 19).Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
             sText = .Cells(lZeile, 11).Value & .Cells(lZeile, 1).Value & Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6)
    '   als Items die drei Begriffe als Array speichern
             MyDic(sText) = _
                Array(.Cells(lZeile, 11).Value, .Cells(lZeile, 1).Value, Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6))
          End If
       Next lZeile
    End With
    ListBox1.ColumnWidths = "60;100;250"
    If MyDic.Count Then
        ArrValues = MyDic.Items
        ReDim arrList(1 To MyDic.Count, 1 To 3)
        For A = 1 To MyDic.Count
           For i = 1 To 3
              arrList(A, i) = ArrValues(A - 1)(i - 1)
           Next i
        Next
        ListBox1.List = arrList
    End If
    Application.ScreenUpdating = False
End Sub

Sub Angebot()
    Dim MyDic As Object
    Dim sText As String
    Dim lZeile, lng As Long
    Dim ArrValues As Variant
    Dim arrList() As Variant
    Dim i As Long     ' Innerer For/Next Schleifen-Index
    Dim A As Long     ' |fffd|u|fffd|erer For/Next Schleifen-Index
    On Error Resume Next
    Application.ScreenUpdating = False
    ListBox1.Clear
    '   Dictionary initialisieren
    Set MyDic = CreateObject("Scripting.Dictionary")
    With Worksheets("Reservierungen")
       For lZeile = 2 To .Cells(.Rows.Count, 1).End(xlUp).Row
          If .Cells(lZeile, 11).Value = "Angebot" Then
    '   den Ordnungsbegriff (Key) zusammenstellen
            lng = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(.Cells(lZeile, 19).Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
             sText = .Cells(lZeile, 11).Value & .Cells(lZeile, 1).Value & Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6)
    '   als Items die drei Begriffe als Array speichern
             MyDic(sText) = _
                Array(.Cells(lZeile, 11).Value, .Cells(lZeile, 1).Value, Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6))
          End If
       Next lZeile
    End With
    ListBox1.ColumnWidths = "60;100;250"
    If MyDic.Count Then
        ArrValues = MyDic.Items
        ReDim arrList(1 To MyDic.Count, 1 To 3)
        For A = 1 To MyDic.Count
           For i = 1 To 3
              arrList(A, i) = ArrValues(A - 1)(i - 1)
           Next i
        Next
        ListBox1.List = arrList
    End If
    Application.ScreenUpdating = False
End Sub
Attribute VB_Name = "frmInfoKasse"
Attribute VB_Base = "0{CC558B0E-B1C3-4E26-B2FF-9655FE09F634}{A6D9F191-BEDC-4842-8150-F371C8F7DABC}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    With Me.cbo_REStorno
        .AddItem "Rechnung"
        .AddItem "Stornorechnung"
    End With
End Sub

Private Sub cbo_REStorno_Change()
    If Not cbo_REStorno = "" Then
        cmd_KRDrucken.Caption = cbo_REStorno & " anschauen"
    Else
        cmd_KRDrucken.Caption = "Rechnung anschauen"
    End If
End Sub

Private Sub cmd_KLDrucken_Click()
    Dim Kstr, Kdate, KJahr As String
    If Not frmKunden.cbojahr = "" Then
        KJahr = frmKunden.cbojahr
    End If
    If Not frmKunden.cbomonat = "" Then
        Kdate = frmKunden.cbomonat
    End If
    Kstr = frmKunden.cboKDNr
    Call LSPrint
    Call DruckAnzeigen
    frmKunden.cboKDNr = Kstr
    frmKunden.MultiPage1.Value = 3
    frmKunden.cbojahr = KJahr
    frmKunden.Show
End Sub

Private Sub cmd_KRDrucken_Click()
    Dim Kstr, Kdate, KJahr As String
    If Not frmKunden.cbojahr = "" Then
        KJahr = frmKunden.cbojahr
    End If
    If Not frmKunden.cbomonat = "" Then
        Kdate = frmKunden.cbomonat
    End If
    Kstr = frmKunden.cboKDNr
    Call REPrint
    Call DruckAnzeigen
    frmKunden.cboKDNr = Kstr
    frmKunden.MultiPage1.Value = 3
    frmKunden.cbojahr = KJahr
    frmKunden.Show
End Sub

Sub LSPrint()
    Dim arrTmpA, arrTmpB, i, xrow, zeile, lngPos, Farbe, spLB As Long
    Dim Dwert, DWert2, DMWST, DMeng, DPEPr, DPEPr2 As Double
    Dim Last_Row, LRow As Long
    Dim SRaStr As String
    On Error Resume Next
    
    Application.ScreenUpdating = False
    Sheets("Druckvorlage").Activate
    Range("Druckvorlage!A2").Value = ""
    Range("Druckvorlage!A3").Value = ""
    Range("Druckvorlage!A4").Value = ""
    Range("Druckvorlage!A5").Value = ""
    Range("Druckvorlage!A6").Value = ""
    Range("Druckvorlage!D3").Value = ""
    Range("Druckvorlage!E3").Value = ""
    Range("Druckvorlage!E5").Value = ""
    Range("Druckvorlage!E6").Value = ""
    Range("Druckvorlage!E7").Value = ""
    Range("Druckvorlage!A9").Value = ""
    Range("Druckvorlage!C11").Value = ""
    Range("Druckvorlage!C12").Value = ""
    Range("Druckvorlage!C13").Value = ""
    Range("Druckvorlage!C14").Value = ""
    LRow = CDbl(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 12
    ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & LRow).Delete
    lngPos = 1
    zeile = 17
    Sheets("Druckvorlage").Range("D2") = "Lieferschein Nr.:"
    Sheets("Druckvorlage").Range("E2") = "'" & CStr(lbl_KLnr)
    Sheets("Druckvorlage").Range("E4") = lbl_KRnrDate
    Sheets("Druckvorlage").Range("E5") = CStr(frmKunden.txt_KDNr)
    Sheets("Druckvorlage").Range("E7") = "'" & CStr(frmKunden.txt_Email)
    Sheets("Druckvorlage").Range("E11") = "Lieferschein"
    Sheets("Druckvorlage").Range("A3") = frmKunden.cboanrede
    If frmKunden.cboanrede = "Firma" Then
        Sheets("Druckvorlage").Range("A4") = frmKunden.txt_Nachname
    Else
        Sheets("Druckvorlage").Range("A4") = frmKunden.txt_Vorname & " " & frmKunden.txt_Nachname
    End If
    Sheets("Druckvorlage").Range("A5") = frmKunden.txt_Strasse
    Sheets("Druckvorlage").Range("A6") = frmKunden.txt_PLZ & " " & frmKunden.txt_Ort
    With ThisWorkbook.Sheets("Warenausgang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AA" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 7 To UBound(arrTmpA)
            If arrTmpA(i, 2) = CStr(frmKunden.lstKunden.Column(0)) And arrTmpA(i, 17) = CStr(frmKunden.txtKDID) And Not CDbl(arrTmpA(i, 13)) < 0 And CStr(lbl_KAnr) = CStr(arrTmpA(i, 23)) Then
                DMeng = arrTmpA(i, 5)
                If CDbl(arrTmpA(i, 13)) < 0 Then
                    DPEPr2 = CDbl(arrTmpA(i, 13)) * (-1)
                Else
                    DPEPr2 = CDbl(arrTmpA(i, 13))
                End If
                DPEPr = CDbl(arrTmpA(i, 13))
                DWert2 = DWert2 + CDbl(DPEPr2 * DMeng)
                Dwert = Dwert + CDbl(DPEPr * DMeng)
                DMWST = DMWST + CDbl(arrTmpA(i, 16))
                Sheets("Druckvorlage").Cells(zeile, 1) = lngPos
                Sheets("Druckvorlage").Cells(zeile, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeile, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 2) = "'" & CStr(arrTmpA(i, 3))
                Sheets("Druckvorlage").Cells(zeile, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeile, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 3) = CStr(arrTmpA(i, 4))
                Sheets("Druckvorlage").Cells(zeile, 3).WrapText = True
                Sheets("Druckvorlage").Cells(zeile, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeile, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 4) = CStr(arrTmpA(i, 5))
                Sheets("Druckvorlage").Cells(zeile, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeile, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 4).NumberFormat = "@"
                If Not arrTmpA(i, 25) = "" Then
                    Sheets("Druckvorlage").Range("E11") = "Lieferschein (Kopie)"
                End If
                If Not arrTmpA(i, 19) = "" Then
                    Sheets("Druckvorlage").Range("D3") = "Kostenstelle:"
                    Sheets("Druckvorlage").Range("E3") = CStr(arrTmpA(i, 19))
                Else
                    Sheets("Druckvorlage").Range("D3") = ""
                    Sheets("Druckvorlage").Range("E3") = ""
                End If
                If Not arrTmpA(i, 23) = "" Then
                    Sheets("Druckvorlage").Range("D6") = "Auftags Nr.:"
                    Sheets("Druckvorlage").Range("E6") = CStr(arrTmpA(i, 23))
                Else
                    Sheets("Druckvorlage").Range("D6") = ""
                    Sheets("Druckvorlage").Range("E6") = ""
                End If
                lngPos = lngPos + 1
                zeile = zeile + 1
           End If
       Next i
    End With
    Sheets("Druckvorlage").Cells(zeile + 2, 1) = "Datum"
    Sheets("Druckvorlage").Cells(zeile + 2, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeile + 4, 1) = ". . . . . . . . ."
    Sheets("Druckvorlage").Cells(zeile + 5, 1) = "Ware erhalten / in Empfang genommen"
    Sheets("Druckvorlage").Cells(zeile + 5, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeile + 8, 1) = ". . . . . . . . . . . . . . . . . . "
    Sheets("Druckvorlage").Cells(zeile + 10, 1) = "Mit freundlichem Gru|fffd|"
    Sheets("Druckvorlage").Cells(zeile + 10, 1).Font.Size = 11
    If Not lbl_Mitarbeiter.Caption = "" Then
        With ThisWorkbook.Sheets("Mitarbeiter")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:W" & Last_Row)
           ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If CStr(arrTmpA(i, 2)) & ", " & CStr(arrTmpA(i, 3)) = lbl_Mitarbeiter Then
                   Sheets("Druckvorlage").Range("C11") = CStr(arrTmpA(i, 2)) & ", " & CStr(arrTmpA(i, 3)) & " / " & CStr(arrTmpA(i, 7))
                   Sheets("Druckvorlage").Range("C12") = "'" & CStr(arrTmpA(i, 5))
                   Sheets("Druckvorlage").Range("C13") = "'" & CStr(arrTmpA(i, 7))
                   Sheets("Druckvorlage").Range("C14") = CStr(arrTmpA(i, 4))
                   xrow = i
               End If
           Next i
        End With
        Sheets("Druckvorlage").Cells(zeile + 12, 1) = CStr(Sheets("Mitarbeiter").Cells(xrow, 2)) & ", " & CStr(Sheets("Mitarbeiter").Cells(xrow, 3))
        Sheets("Druckvorlage").Cells(zeile + 12, 1).Font.Size = 11
    Else
        Sheets("Druckvorlage").Range("C11") = ""
        Sheets("Druckvorlage").Range("C12") = ""
        Sheets("Druckvorlage").Range("C13") = ""
        Sheets("Druckvorlage").Range("C14") = ""
        Sheets("Druckvorlage").Cells(zeile + 12, 1) = CStr(Sheets("Daten").Range("B9"))
        Sheets("Druckvorlage").Cells(zeile + 12, 1).Font.Size = 11
    End If
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To lngPos
            SRaStr = "A" & 17 + spLB & ":F" & 17 + spLB
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range(SRaStr).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range(SRaStr).Select
                Farbe = 1
            End If
        Next spLB
    End If
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Sub REPrint()
    Dim arrTmpA, arrTmpB, i, xrow, zeile, lngPos, Farbe, spLB As Long
    Dim Dwert, DWert2, DMWST, DMeng, DPEPr, DPEPr2, Zahl, ZahlW As Double
    Dim Last_Row, LRow As Long
    Dim SRaStr, strSDate As String
    On Error Resume Next
    
    Application.ScreenUpdating = False
    Sheets("Druckvorlage").Activate
    Range("Druckvorlage!A2").Value = ""
    Range("Druckvorlage!A3").Value = ""
    Range("Druckvorlage!A4").Value = ""
    Range("Druckvorlage!A5").Value = ""
    Range("Druckvorlage!A6").Value = ""
    Range("Druckvorlage!D3").Value = ""
    Range("Druckvorlage!E3").Value = ""
    Range("Druckvorlage!E5").Value = ""
    Range("Druckvorlage!E6").Value = ""
    Range("Druckvorlage!E7").Value = ""
    Range("Druckvorlage!A9").Value = ""
    Range("Druckvorlage!C11").Value = ""
    Range("Druckvorlage!C12").Value = ""
    Range("Druckvorlage!C13").Value = ""
    Range("Druckvorlage!C14").Value = ""
    Range("Druckvorlage!E16") = "Preis"
    Range("Druckvorlage!F16") = "Betrag"
    LRow = CDbl(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & LRow).Delete
    lngPos = 1
    zeile = 17
    Sheets("Druckvorlage").Range("D2") = "Rechnungs Nr.:"
    Sheets("Druckvorlage").Range("E2") = CStr(frmKunden.lstKunden.Column(0))
    If cbo_REStorno = "Stornorechnung" Then
        strSDate = MsgBox("M|fffd|chten Sie das aktuelle Datum verwenden?", vbYesNo, "Storno - Datum")
        If strSDate = vbYes Then
            Sheets("Druckvorlage").Range("E4") = Format(Date, "DD.MM.YYYY")
        Else
            Sheets("Druckvorlage").Range("E4") = lbl_KRnrDate
        End If
    Else
        Sheets("Druckvorlage").Range("E4") = lbl_KRnrDate
    End If
    Sheets("Druckvorlage").Range("E5") = CStr(frmKunden.txt_KDNr)
    Sheets("Druckvorlage").Range("E7") = "'" & CStr(frmKunden.txt_Email)
    If frmInfoKasse.cbo_REStorno = "Stornorechnung" Then
        Sheets("Druckvorlage").Range("E11") = "Stornorechnung"
    Else
        Sheets("Druckvorlage").Range("E11") = "Rechnung"
    End If
    Sheets("Druckvorlage").Range("A3") = frmKunden.cboanrede
    If frmKunden.cboanrede = "Firma" Then
        Sheets("Druckvorlage").Range("A4") = frmKunden.txt_Nachname
    Else
        Sheets("Druckvorlage").Range("A4") = frmKunden.txt_Vorname & " " & frmKunden.txt_Nachname
    End If
    Sheets("Druckvorlage").Range("A5") = frmKunden.txt_Strasse
    Sheets("Druckvorlage").Range("A6") = frmKunden.txt_PLZ & " " & frmKunden.txt_Ort
    With ThisWorkbook.Sheets("Warenausgang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AA" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 7 To UBound(arrTmpA)
            If arrTmpA(i, 2) = CStr(frmKunden.lstKunden.Column(0)) And arrTmpA(i, 17) = CStr(frmKunden.txtKDID) Then 'And CStr(lbl_KAnr) = CStr(arrTmpA(i, 23)) Then
                DMeng = arrTmpA(i, 5)
                If CDbl(arrTmpA(i, 13)) < 0 Then
                    DPEPr2 = CDbl(arrTmpA(i, 13)) * (-1)
                Else
                    DPEPr2 = CDbl(arrTmpA(i, 13))
                End If
                DPEPr = CDbl(arrTmpA(i, 13))
                DWert2 = DWert2 + CDbl(DPEPr2 * DMeng)
                Dwert = Dwert + CDbl(DPEPr * DMeng)
                DMWST = DMWST + CDbl(arrTmpA(i, 16))
                Sheets("Druckvorlage").Cells(zeile, 1) = lngPos
                Sheets("Druckvorlage").Cells(zeile, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeile, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 2) = "'" & CStr(arrTmpA(i, 3))
                Sheets("Druckvorlage").Cells(zeile, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeile, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 3) = CStr(arrTmpA(i, 4))
                Sheets("Druckvorlage").Cells(zeile, 3).WrapText = True
                Sheets("Druckvorlage").Cells(zeile, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeile, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 4) = CStr(arrTmpA(i, 5))
                Sheets("Druckvorlage").Cells(zeile, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeile, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeile, 4).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(zeile, 5) = Format(CDbl(arrTmpA(i, 13)), "currency")
                Sheets("Druckvorlage").Cells(zeile, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeile, 5).VerticalAlignment = xlTop
                If DMeng < 0 Then
                    Sheets("Druckvorlage").Cells(zeile, 6) = Format(CDbl(DPEPr * DMeng) * (-1), "currency")
                    Sheets("Druckvorlage").Cells(zeile, 6).HorizontalAlignment = xlRight
                    Sheets("Druckvorlage").Cells(zeile, 6).VerticalAlignment = xlTop
                Else
                    Sheets("Druckvorlage").Cells(zeile, 6) = Format(CDbl(DPEPr * DMeng), "currency")
                    Sheets("Druckvorlage").Cells(zeile, 6).HorizontalAlignment = xlRight
                    Sheets("Druckvorlage").Cells(zeile, 6).VerticalAlignment = xlTop
                End If
                If Not arrTmpA(i, 24) = "" And Not frmInfoKasse.cbo_REStorno = "Stornorechnung" Then
                    Sheets("Druckvorlage").Range("E11") = "Rechnung (Kopie)"
                End If
                If Not arrTmpA(i, 19) = "" Then
                    Sheets("Druckvorlage").Range("D3") = "Kostenstelle:"
                    Sheets("Druckvorlage").Range("E3") = CStr(arrTmpA(i, 19))
                Else
                    Sheets("Druckvorlage").Range("D3") = ""
                    Sheets("Druckvorlage").Range("E3") = ""
                End If
                If Not arrTmpA(i, 23) = "" Then
                    Sheets("Druckvorlage").Range("D6") = "Auftags Nr.:"
                    Sheets("Druckvorlage").Range("E6") = CStr(arrTmpA(i, 23))
                Else
                    Sheets("Druckvorlage").Range("D6") = ""
                    Sheets("Druckvorlage").Range("E6") = ""
                End If
                lngPos = lngPos + 1
                zeile = zeile + 1
           End If
       Next i
    End With
    Sheets("Druckvorlage").Cells(zeile + 2, 5) = "Zwischensumme:"
    Sheets("Druckvorlage").Cells(zeile + 2, 5).HorizontalAlignment = xlRight
    Sheets("Druckvorlage").Cells(zeile + 2, 6) = Format(CDbl(DWert2), "currency")
    Sheets("Druckvorlage").Cells(zeile + 2, 6).HorizontalAlignment = xlRight
    Sheets("Druckvorlage").Cells(zeile + 3, 5) = "MwSt:"
    Sheets("Druckvorlage").Cells(zeile + 3, 5).HorizontalAlignment = xlRight
    Sheets("Druckvorlage").Cells(zeile + 3, 6) = Format(CDbl(DMWST), "currency")
    Sheets("Druckvorlage").Cells(zeile + 3, 6).HorizontalAlignment = xlRight
    Sheets("Druckvorlage").Cells(zeile + 4, 5) = "Gesamtbetrag:"
    Sheets("Druckvorlage").Cells(zeile + 4, 5).HorizontalAlignment = xlRight
    If Worksheets("Daten").Range("F36") = "Ja" Then
        ZahlW = DWert2 + DMWST
        Zahl = CLng(ZahlW / 0.05) * 0.05
        Sheets("Druckvorlage").Cells(zeile + 4, 6) = Format(Zahl, "currency")
    Else
        Sheets("Druckvorlage").Cells(zeile + 4, 6) = Format(CDbl(DWert2 + DMWST), "currency")
    End If
    Sheets("Druckvorlage").Cells(zeile + 4, 6).HorizontalAlignment = xlRight
    If Not lbl_Mitarbeiter.Caption = "" Then
        With ThisWorkbook.Sheets("Mitarbeiter")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AA" & Last_Row)
           ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If CStr(arrTmpA(i, 2)) & ", " & CStr(arrTmpA(i, 3)) = lbl_Mitarbeiter Then
                   Sheets("Druckvorlage").Range("C11") = CStr(arrTmpA(i, 2)) & ", " & CStr(arrTmpA(i, 3)) & " / " & CStr(arrTmpA(i, 7))
                   Sheets("Druckvorlage").Range("C12") = "'" & CStr(arrTmpA(i, 5))
                   Sheets("Druckvorlage").Range("C13") = "'" & CStr(arrTmpA(i, 7))
                   Sheets("Druckvorlage").Range("C14") = CStr(arrTmpA(i, 4))
                   xrow = i
               End If
           Next i
        End With
        Sheets("Druckvorlage").Cells(zeile + 6, 1) = "Mit freundlichem Gru|fffd|"
        Sheets("Druckvorlage").Cells(zeile + 6, 1).Font.Size = 11
        Sheets("Druckvorlage").Cells(zeile + 8, 1) = CStr(Sheets("Mitarbeiter").Cells(xrow, 2)) & ", " & CStr(Sheets("Mitarbeiter").Cells(xrow, 3))
        Sheets("Druckvorlage").Cells(zeile + 8, 1).Font.Size = 11
    Else
        Sheets("Druckvorlage").Range("C11") = ""
        Sheets("Druckvorlage").Range("C12") = ""
        Sheets("Druckvorlage").Range("C13") = ""
        Sheets("Druckvorlage").Range("C14") = ""
        Sheets("Druckvorlage").Cells(zeile + 6, 1) = "Mit freundlichem Gru|fffd|"
        Sheets("Druckvorlage").Cells(zeile + 6, 1).Font.Size = 11
        Sheets("Druckvorlage").Cells(zeile + 8, 1) = CStr(Sheets("Daten").Range("B9"))
        Sheets("Druckvorlage").Cells(zeile + 8, 1).Font.Size = 11
    End If
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To lngPos
            SRaStr = "A" & 17 + spLB & ":F" & 17 + spLB
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range(SRaStr).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range(SRaStr).Select
                Farbe = 1
            End If
        Next spLB
    End If
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Sub DruckAnzeigen()
    Unload frmLager
    Unload frmInfoKasse
    Unload frmKunden
    Worksheets("Druckvorlage").Activate
    With ActiveSheet
        .PrintPreview
    End With
    Worksheets("Center").Activate
End Sub

Private Sub cmd_KundenAE_Click()
    Dim strMsg As String
    If cmd_KundenAE.Caption = "Kunden |fffd|ndern?" Then
        strMsg = MsgBox("M|fffd|chten Sie den Kunden |fffd|ndern?", vbYesNo, "Kunde")
    Else
        strMsg = MsgBox("M|fffd|chten Sie einen Kunden ausw|fffd|hlen?", vbYesNo, "Kunde")
    End If
    If strMsg = vbYes Then
        frmContact.txt_KDID2.Value = CDbl(Sheets("Daten").Range("B19")) + 1
        frmContact.cboAnsp.Visible = False
        frmContact.txtdate.Visible = False
        frmContact.lblinfo.Visible = False
        frmContact.comnext.Visible = False
        frmContact.txt_Nummer.Value = frmKasse.txtRnr.Text
        frmContact.cmd_invoiceprint.Visible = False
        frmContact.cmdnextL.Visible = False
        frmContact.lblMitarbeiter.Visible = False
        frmContact.cmd_KDsave.Visible = True
        frmContact.lblinfo2.Visible = False
        frmContact.Show
    End If
End Sub

Private Sub cmd_ok_Click()
    Unload frmInfoKasse
End Sub

Private Sub CommandButton3_Click()
    Unload frmInfoKasse
End Sub

Sub KundenRELSSuchen() '1.44
    Dim arrTmpA, arrTmpB, i, xrow, lngSto As Long
    Dim Dwert As Double
    Dim Last_Row As Long
    On Error Resume Next
    
    If frmKunden.txtKDID.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    lngSto = 0
    With ThisWorkbook.Sheets("Warenausgang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:W" & Last_Row)
       ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
       For i = 7 To UBound(arrTmpA)
            If arrTmpA(i, 2) = CStr(frmKunden.lstKunden.Column(0)) And arrTmpA(i, 17) = CStr(frmKunden.txtKDID) Then
                Dwert = Dwert + (CDbl(arrTmpA(i, 7)) + CDbl(arrTmpA(i, 16)))
                xrow = i
            End If
            If arrTmpA(i, 2) = CStr(frmKunden.lstKunden.Column(0)) And arrTmpA(i, 17) = CStr(frmKunden.txtKDID) And arrTmpA(i, 1) = "Storno" Then
                lngSto = lngSto + 1
            End If
       Next i
    End With
    If lngSto > 0 Then
        cbo_REStorno.Visible = True
        cbo_REStorno.ListIndex = 1
    Else
        cbo_REStorno.Visible = False
    End If
    lbl_KArt.Caption = CStr(Sheets("Warenausgang").Cells(xrow, 1))
    lbl_Mitarbeiter.Caption = CStr(Sheets("Warenausgang").Cells(xrow, 18))
    lbl_KAnr.Caption = CStr(Sheets("Warenausgang").Cells(xrow, 23))
    lbl_KRnrDate.Caption = CStr(Sheets("Warenausgang").Cells(xrow, 8))
    lbl_KLnr.Caption = CStr(Sheets("Warenausgang").Cells(xrow, 22))
    lbl_KRnr.Caption = CStr(frmKunden.lstKunden.Column(0))
    lbl_KBetrag.Caption = Format(Dwert, "currency")
    If Not lbl_KRnr.Caption = "" Then
        cmd_KRDrucken.Enabled = True
    End If
    If Not lbl_KLnr.Caption = "" Then
        cmd_KLDrucken.Enabled = True
    Else
        cmd_KLDrucken.Enabled = False
    End If
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmKalender"
Attribute VB_Base = "0{4BC624F2-161E-4A58-BC32-55F7FF0599F9}{9FC65768-216E-4AFC-92AC-1CEFF253B0DD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim ListB As control
    Dim LabelCount1 As Integer
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    DateNow = Date
    For Each ListB In frmKalender.Controls
        If TypeName(ListB) = "Label" Then
            LabelCount1 = LabelCount1 + 1
            ReDim Preserve kLabel(1 To LabelCount1)
            Set kLabel(LabelCount1).lbl_Data = ListB
        End If
    Next ListB
    Call Kfuellen
End Sub

Private Sub cmd_heute_Click()
    cmd_Datum.Caption = Date

    If txt_UID.Value = "JR_RA" Then Call JRRA
    If txt_UID.Value = "JR_WA" Then Call JRWA
    If txt_UID.Value = "BSTLD" Then Call BSTLD
    If txt_UID.Value = "KDID" Then Call KDSU
    If txt_UID.Value = "AFAE" Then Call AFaellig2
    If txt_UID.Value = "WADA" Then Call WADA
    If txt_UID.Value = "VMVO" Then Call VMVO
    If txt_UID.Value = "VMBI" Then Call VMBI
    If txt_UID.Value = "VMEL" Then Call VMEL
    If txt_UID.Value = "VERW" Then Call VERW
End Sub

Private Sub cmd_Datum_Click()
    If cmd_Datum.Caption = "" Then Exit Sub
    If txt_UID.Value = "JR_RA" Then Call JRRA
    If txt_UID.Value = "JR_WA" Then Call JRWA
    If txt_UID.Value = "BSTLD" Then Call BSTLD
    If txt_UID.Value = "KDID" Then Call KDSU
    If txt_UID.Value = "AFAE" Then Call AFaellig
    If txt_UID.Value = "WADA" Then Call WADA
    If txt_UID.Value = "VMVO" Then Call VMVO
    If txt_UID.Value = "VMBI" Then Call VMBI
    If txt_UID.Value = "VMEL" Then Call VMEL
    If txt_UID.Value = "VERW" Then Call VERW
End Sub

Sub VERW()
    frmArtikel.txt_Verwendbar = frmKalender.cmd_Datum.Caption
    Unload frmKalender
End Sub

Sub VMEL()
    frmVInfo.txt_DatumV.Value = frmKalender.cmd_Datum.Caption
    Unload frmKalender
End Sub

Sub VMVO()
    frmVerleih.txt_VVdatum.Value = frmKalender.cmd_Datum.Caption
    frmBarcode.txt_VVdatum.Value = frmKalender.cmd_Datum.Caption
    Unload frmKalender
End Sub

Sub VMBI()
    frmVerleih.txt_VBdatum.Value = frmKalender.cmd_Datum.Caption
    frmBarcode.txt_VBdatum.Value = frmKalender.cmd_Datum.Caption
    Unload frmKalender
End Sub

Sub WADA()
    frmKasseWA.txt_WADatum = frmKalender.cmd_Datum.Caption
    Unload frmKalender
End Sub

Sub BSTLD() 'Datum Bestellung
    Dim lng, i  As Long
    On Error Resume Next
    i = 0
    If CDate(frmKalender.cmd_Datum.Caption) < Date Then
        MsgBox "Datum liegt in der Vergangenheit!", , "Hinweis"
        Exit Sub
    End If
    For lng = 2 To ThisWorkbook.Worksheets("Bestellung").UsedRange.Rows.Count
        If Worksheets("Bestellung").Cells(lng, 1) = CStr(frmBestellung.txtBestellNR.Value) Then
            Worksheets("Bestellung").Cells(lng, 11).Value = CDate(frmKalender.cmd_Datum.Caption)
            i = i + 1
        End If
    Next lng
    Call frmBestellung.SuchenBestellungNeu
    Unload frmKalender
End Sub

Sub JRRA()
    Dim datestr As String
    Dim lng, i As Long
    On Error Resume Next
    datestr = CDate(frmKalender.cmd_Datum.Caption)
    frmBericht.lstAuftrag.Clear
    frmBericht.lstAuftrag.ColumnCount = 7
    frmBericht.lstAuftrag.ColumnWidths = "120;120;50;250;80;0;60;0"
    frmBericht.lstAuftrag.TextAlign = fmTextAlignLeft
    frmBericht.lstAuftrag.Clear
    i = 0
    For lng = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
        If InStr(LCase(Worksheets("Reservierungen").Cells(lng, 17).Value), LCase(datestr)) > 0 Then
            frmBericht.lstAuftrag.AddItem Worksheets("Reservierungen").Cells(lng, 1).Value
            frmBericht.lstAuftrag.Column(1, i) = Worksheets("Reservierungen").Cells(lng, 2).Value
            frmBericht.lstAuftrag.Column(2, i) = Worksheets("Reservierungen").Cells(lng, 7).Value
            frmBericht.lstAuftrag.Column(3, i) = Worksheets("Reservierungen").Cells(lng, 6).Value
            frmBericht.lstAuftrag.Column(4, i) = Format(Worksheets("Reservierungen").Cells(lng, 8).Value, "currency")
            frmBericht.lstAuftrag.Column(5, i) = Worksheets("Reservierungen").Cells(lng, 4).Value
            frmBericht.lstAuftrag.Column(6, i) = Worksheets("Reservierungen").Cells(lng, 17).Value
            frmBericht.lstAuftrag.Column(7, i) = Worksheets("Reservierungen").Cells(lng, 2).Row
            i = i + 1
        End If
    Next lng
    If frmBericht.lstAuftrag.ListCount = 0 Then
        MsgBox "Am " + datestr + " liegen keine Auftr|fffd|ge vor!", vbInformation, "Suchabfrage"
    Else
        Unload frmKalender
    End If
End Sub

Sub JRWA()
    frmBericht.txtdatum.Value = frmKalender.cmd_Datum.Caption
    Unload frmKalender
End Sub

Function KDSU() 'Kunden/Datum
    Dim lngZeile, i As Long
    Dim strdate As Date

    frmKunden.lstKunden.BackColor = &H80000005
    frmKunden.lstKunden.Clear
    frmKunden.lstKunden.ColumnCount = 5
    frmKunden.lstKunden.ColumnWidths = "100;190;60;55;50;0"
    If Not IsDate(frmKalender.cmd_Datum.Caption) Then Exit Function
    strdate = frmKalender.cmd_Datum.Caption
    frmKunden.cbomonat = Format(strdate, "MMMM")
    i = 0
    For lngZeile = 2 To ThisWorkbook.Worksheets("Warenausgang").UsedRange.Rows.Count
        If Sheets("Warenausgang").Cells(lngZeile, 17).Value = frmKunden.txtKDID.Text And Sheets("Warenausgang").Cells(lngZeile, 8).Value = strdate Then
            
            frmKunden.lstKunden.AddItem Sheets("Warenausgang").Cells(lngZeile, 2).Value
            frmKunden.lstKunden.Column(1, i) = Sheets("Warenausgang").Cells(lngZeile, 4).Value
            frmKunden.lstKunden.Column(2, i) = Format(CDbl(Sheets("Warenausgang").Cells(lngZeile, 7) + Sheets("Warenausgang").Cells(lngZeile, 16)), "currency")
            frmKunden.lstKunden.Column(3, i) = Sheets("Warenausgang").Cells(lngZeile, 11).Value
            frmKunden.lstKunden.Column(4, i) = CDate(Sheets("Warenausgang").Cells(lngZeile, 8).Value)
            frmKunden.lstKunden.Column(5, i) = Sheets("Warenausgang").Cells(lngZeile, 2).Row
            i = i + 1
        End If
    Next lngZeile
    Call frmKunden.Datensaetze
    frmKunden.txt_CCheck.Value = ""
    Unload frmKalender
End Function

Private Sub cmd_DExit_Click()
    Unload frmKalender
End Sub

Private Sub SpinMonat_SpinDown()
    DateNow = DateSerial(Year(DateNow), Month(DateNow) - 1, 1)
    Call Kfuellen
End Sub

Private Sub SpinMonat_SpinUp()
    DateNow = DateSerial(Year(DateNow), Month(DateNow) + 1, 1)
    Call Kfuellen
End Sub

Private Sub SpinJahr_SpinDown()
    DateNow = DateSerial(Year(DateNow) - 1, Month(DateNow), 1)
    Call Kfuellen
End Sub

Private Sub SpinJahr_SpinUp()
    DateNow = DateSerial(Year(DateNow) + 1, Month(DateNow), 1)
    Call Kfuellen
End Sub

Function AFaellig()
    Dim lngMsg As String
    Dim lng, i As Long
    On Error Resume Next
    If frmKasse.cboAuftragSuchen.Value = "" Then Exit Function
    lngMsg = cmd_Datum.Caption
    If lngMsg = "" Then
        Exit Function
    Else
        i = 0
        For lng = 1 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
            If InStr(LCase(Worksheets("Reservierungen").Cells(lng, 1)), LCase(frmKasse.cboAuftragSuchen.Value)) > 0 Then
                Worksheets("Reservierungen").Cells(lng, 17).Value = CDate(lngMsg)
                i = i + 1
            End If
        Next lng
    End If
    Call frmKasse.SuchenAuftragV2
    Unload frmKalender
End Function

Function AFaellig2()
    Dim lngMsg As String
    Dim lng, i As Long
    On Error Resume Next
    If frmKasse.cboAuftragSuchen.Value = "" Then Exit Function
    lngMsg = cmd_Datum.Caption
    If lngMsg = "" Then
        Exit Function
    Else
        i = 0
        For lng = 1 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
            If InStr(LCase(Worksheets("Reservierungen").Cells(lng, 1)), LCase(frmKasse.cboAuftragSuchen.Value)) > 0 Then
                Worksheets("Reservierungen").Cells(lng, 17).Value = CDate(lngMsg)
                i = i + 1
            End If
        Next lng
    End If
    Call frmKasse.SuchenAuftragV2
    Unload frmKalender
End Function
Attribute VB_Name = "frmKalk"
Attribute VB_Base = "0{0F655CCC-3982-4E33-B676-92479EC1BA94}{A493ABCE-BDF3-410C-8AA7-537746C30519}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub txtEKPreis_Change()
    Call rechnenKalk
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    Call LieferantCombo
    txtBezugeingabe.Value = Sheets("Daten").Range("F31")
    txtHandlungskeingabe.Value = Sheets("Daten").Range("F32")
    txtgewinneingabe.Value = Sheets("Daten").Range("F33")
    txtKskontoeingabe.Value = Sheets("Daten").Range("F34")
    txtKrabatteingabe.Value = Sheets("Daten").Range("F35")
    Call rechnenKalk
End Sub

Private Sub cmdchanel_Click()
    Unload frmKalk
End Sub

Private Sub cmdwertall_Click()
    On Error Resume Next
    frmArtikel.txtVKPreis.Value = Format(CDbl(txtListenVK.Value), "currency")
    frmArtikel.txtEKPreis.Value = Format(CDbl(txtEKPreis.Value), "currency")
    frmArtikel.txtVKPreis2.Value = CDbl(txtListenVK.Value)
    frmArtikel.txtEKPreis2.Value = CDbl(txtEKPreis.Value)
    Unload frmKalk
End Sub

Private Sub txtBezugeingabe_AfterUpdate()
    Call rechnenKalk
End Sub

Private Sub txtEKPreis_AfterUpdate()
    If Not txtEKPreis.Value = "" Then
        On Error GoTo weiter
        txtEKPreis = Format(CDbl(txtEKPreis.Value), "currency")
        Call rechnenKalk
    End If
    Exit Sub
weiter:
    MsgBox "Fehler im Waehrungsformat!", , "Hinweis"
    txtEKPreis.Value = ""
    txtEKPreis.SetFocus
End Sub

Private Sub txtgewinneingabe_AfterUpdate()
    Call rechnenKalk
End Sub

Private Sub txtHandlungskeingabe_AfterUpdate()
    Call rechnenKalk
End Sub

Private Sub txtKrabatteingabe_AfterUpdate()
    Call rechnenKalk
End Sub

Private Sub txtKskontoeingabe_AfterUpdate()
    Call rechnenKalk
End Sub

Private Sub txtLrabatteingabe_AfterUpdate()
    Call rechnenKalk
End Sub

Private Sub txtSkontoeingabe_AfterUpdate()
    Call rechnenKalk
End Sub

Sub LieferantCombo()
    Dim lngZ As Long
    Dim objDic As Object
    On Error Resume Next

    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
      objDic(Sheets("Lieferanten").Cells(lngZ, 2).Value) = 0
    Next
    cboLieferant.List = objDic.keys
    Set objDic = Nothing
End Sub

Private Sub cboLieferant_Click()
    Dim xrow As Long
    On Error Resume Next
    
    If txtEKPreis.Value = "" Then
        MsgBox "Bitte geben Sie zuerst einen Betrag an!", vbOKOnly, "Hinweis"
        txtEKPreis.SetFocus
        cboLieferant.ListIndex = -1
        Exit Sub
    End If
    xrow = xFind(ActiveWorkbook.Name, "Lieferanten", frmKalk.cboLieferant, "B:B")
    If Sheets("Lieferanten").Cells(xrow, 14) = "" Then
        txtSkontoeingabe.Value = Format(CDbl(0), "currency")
    Else
        txtSkontoeingabe.Value = Format(Sheets("Lieferanten").Cells(xrow, 14), "#,##0.00%")
    End If
    
    If Sheets("Lieferanten").Cells(xrow, 19) = "" Then
        txtLrabatteingabe.Value = "0.00"
    Else
        txtLrabatteingabe.Value = Format(Sheets("Lieferanten").Cells(xrow, 19), "#,##0.00%")
    End If
    Call rechnenKalk
    txtBezugeingabe.SetFocus
End Sub

Sub rechnenKalk()
    Dim Zahl As Double
    On Error Resume Next
    Application.ScreenUpdating = False
    
    If Me.cboLieferant = "" Then
        If CDbl(txtEKPreis) > 0 Then
            txtBareinkauf.Value = Format(txtEKPreis, "0.00")
        Else
            txtBareinkauf.Value = Format("0", "0.00")
        End If
        GoTo weiter
    End If
    'Lieferrabatt
    If txtLrabatteingabe.Value <= 0 Or txtLrabatteingabe.Value = "" Then
        txtLrabatteingabe.Value = "0.00"
        txtziel.Value = Format(CDbl(txtEKPreis.Value), "currency")
        txtLrabatteingabe.Value = Format(CDbl(txtLrabatteingabe.Value) / 100, "#,##0.00%")
    Else
        txtLrabatteingabe.Value = Format(CDbl(Left((txtLrabatteingabe.Value), 4)) / 100, "#,##0.00%")
        txtLrabatt.Value = Format(CDbl(txtEKPreis.Value) * CDbl(Left((txtLrabatteingabe.Value), 4)) / 100, "#,##0.00")
        txtziel.Value = Format(CDbl(txtEKPreis.Value) - CDbl(txtLrabatt.Value), "#,##0.00")
    End If
    'Lieferskonto
    If txtSkontoeingabe.Value <= 0 Or txtSkontoeingabe.Value = "" Then
        txtSkontoeingabe.Value = "0.00"
        txtBareinkauf.Text = CDbl(txtziel) - 0
        txtSkontoeingabe.Text = Format(CDbl(txtSkontoeingabe) / 100, "0.00%")
    Else
        txtSkontoeingabe.Value = Format(CDbl(Left((txtSkontoeingabe.Value), 4)) / 100, "#,##0.00%")
        txtziel.Value = Format(CDbl(txtEKPreis.Value) - CDbl(txtLrabatt.Value), "#,##0.00")
        txtskonto.Value = Format(CDbl(txtziel.Value) * CDbl(Left((txtSkontoeingabe.Value), 4)) / 100, "#,##0.00")
        txtBareinkauf.Value = Format(CDbl(txtziel.Value) - CDbl(txtskonto.Value), "#,##0.00")
    End If
weiter:
    'Bezugskosten
    If txtBezugeingabe.Value <= 0 Or txtBezugeingabe.Value = "" Then
        txtBezug.Value = "0.00"
        txtBezugeingabe.Value = Format(txtBezugeingabe.Value, "#,##0.00")
        txtBezugspreis.Value = Format(CDbl(txtBareinkauf.Value) + 0, "#,##0.00")
    Else
        txtBezug.Value = Format(txtBezugeingabe.Value, "#,##0.00")
        txtBezugeingabe.Value = Format(txtBezugeingabe.Value, "#,##0.00")
        txtBezugspreis.Value = Format(CDbl(txtBezug.Value) + CDbl(txtBareinkauf.Value), "#,##0.00")
    End If
    'Handlungkosten
    If txtHandlungskeingabe.Value <= 0 Or txtHandlungskeingabe.Value = "" Then
        txtHand.Value = "0.00"
        txtHandlungskeingabe.Value = Format(CDbl(Left((txtHandlungskeingabe.Value), 4)) / 100, "#,##0.00%")
        txtselbst.Value = Format(CDbl(txtBezugspreis.Value), "#,##0.00")
    Else
        txtHandlungskeingabe.Value = Format(CDbl(Left((txtHandlungskeingabe.Value), 4)) / 100, "#,##0.00%")
        txtHand.Value = Format(CDbl(txtBezugspreis.Value) * CDbl(Left((txtHandlungskeingabe.Value), 4)) / 100, "#,##0.00")
        txtselbst.Value = Format(CDbl(txtBezugspreis.Value) + CDbl(txtHand.Value), "#,##0.00")
    End If
    'Selbstkosten
    If txtgewinneingabe.Value <= 0 Or txtgewinneingabe.Value = "" Then
        txtHand.Value = "0.00"
        txtgewinneingabe.Value = Format(CDbl(txtgewinneingabe.Value) / 100, "0.00%")
        txtBar.Value = Format(CDbl(txtselbst.Value), "#,##0.00")
    Else
        txtgewinneingabe.Value = Format(CDbl(Left((txtgewinneingabe.Value), 4)) / 100, "#,##0.00%")
        txtgewinn.Value = Format(CDbl(txtselbst.Value) * CDbl(Left((txtgewinneingabe.Value), 4)) / 100, "#,##0.00")
        txtBar.Value = Format(CDbl(txtselbst.Value) + CDbl(txtgewinn.Value), "#,##0.00")
   End If
   'Barverkaufspreis
   If txtKskontoeingabe.Value <= 0 Or txtKskontoeingabe.Value = "" Then
        txtKskontoeingabe.Value = "0.00"
        txtKskontoeingabe.Value = Format(CDbl(Left((txtKskontoeingabe.Value), 4)), "#,##0.00%")
        txtzielVK.Value = Format(CDbl(txtBar.Value), "#,##0.00")
        txtBKS.Value = 100
   Else
        txtBKS.Value = 100 - CDbl(Left((txtKskontoeingabe), 4))
        txtKskontoeingabe.Value = Format(CDbl(Left((txtKskontoeingabe.Value), 4)) / 100, "#,##0.00%")
        txtKskonto.Value = Format(CDbl(txtBar) * CDbl(Left((txtKskontoeingabe.Value), 4)) / CDbl(txtBKS.Value), "#,##0.00")
        txtzielVK.Value = Format(CDbl(txtBar.Value) + CDbl(txtKskonto.Value), "#,##0.00")
    End If
    'Zielverkaufspreis
    If txtKrabatteingabe.Value < 0 Or txtKrabatteingabe.Value = "" Then
        txtKrabatteingabe.Value = "0.00"
        txtKrabatteingabe.Value = Format(CDbl(txtKrabatteingabe.Value), "#,##0.00%")
        txtBKR.Value = 100
    Else
        txtBKR = 100 - CDbl(Left((txtKrabatteingabe.Value), 4))
        txtKrabatteingabe.Value = Format(CDbl(txtKrabatteingabe.Value) / 100, "#,##0.00%")
        txtKrabatt.Value = Format(CDbl(txtzielVK.Value) * CDbl(Left((txtKrabatteingabe.Value), 4)) / CDbl(txtBKR.Value), "#,##0.00")
        txtListenVK.Value = Format(CDbl(txtzielVK.Value) + CDbl(txtKrabatt.Value), "currency")
    End If
    
    If Worksheets("Daten").Range("F36") = "Ja" Then
        Zahl = txtListenVK
        Zahl = CLng(Zahl / 0.05) * 0.05
        txtListenVK = Format(Zahl, "currency")
    End If
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmKasse"
Attribute VB_Base = "0{1F18BE4D-9514-4F16-B4AB-4A67E434B6CB}{9C915EA5-F0EE-45B0-AFC1-713A2B205AED}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cbo_Lagerplatz_Click()
    txtMenge.SetFocus
End Sub

Private Sub cbo_VPEinheit_DropButtonClick()
    Dim xrow As Long
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    Dim strZu As String
    On Error Resume Next
    If cbo_VPEinheit = "Standard" Then
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:O" & Last_Row)
            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(txtID) Then
                    lbl_VKPreisKasse.Caption = Format(CDbl(arrTmpA(i, 15)), "currency")
                    xrow = xrow + 1
                End If
            Next i
        End With
        If xrow > 0 Then
            txt_VPEinheit.Value = ""
            txt_VPEPreis.Value = ""
            txt_VPEinheit2.Value = ""
        End If
        If Not txtMenge = "" Then
            lbl_Nettoges.Caption = Format(CDbl(lbl_VKPreisKasse.Caption) * txtMenge.Value, "currency")
        End If
        Application.ScreenUpdating = True
    Else
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("VPEinheit")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:O" & Last_Row)
            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                strZu = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ")"
                If cbo_VPEinheit = strZu And CStr(arrTmpA(i, 2)) = CStr(txtID) And arrTmpA(i, 14) = "VP-VK" Then
                    lbl_VKPreisKasse.Caption = Format(CDbl(arrTmpA(i, 12)), "currency")
                    txt_VPEinheit.Value = arrTmpA(i, 3)
                    txt_VPEinheit2.Value = arrTmpA(i, 5)
                    txt_VPEPreis.Value = arrTmpA(i, 13)
                End If
            Next i
        End With
        If Not txtMenge = "" Then
            lbl_Nettoges.Caption = Format(CDbl(lbl_VKPreisKasse.Caption) * txtMenge.Value, "currency")
        End If
        Application.ScreenUpdating = True
    End If
End Sub

Private Sub Check_SortAuf_Click()
    If Check_SortAuf.Value = True Then
        Sheets("Daten").Range("D20").Value = "Ja"
    Else
        Sheets("Daten").Range("D20").Value = "Nein"
    End If
End Sub

Private Sub cmd_Aliste_Click()
    frmInfoAuf.Auftrag
    frmInfoAuf.Show
End Sub

Private Sub cmd_AnList_Click()
    frmInfoAuf.Angebot
    frmInfoAuf.Caption = "Alle aktiven Angebote!"
    frmInfoAuf.Show
End Sub

Private Sub cmd_Beleg_Click()
    frmPW.txt_type = "Beleg"
    frmPW.Caption = "Bitte Admin-Passwort eingeben!"
    frmPW.lblPW.Caption = "Rechnung bereits gedruckt!"
    frmPW.Show
End Sub

Private Sub cmd_orderpdf_Click()
    If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
    If cboart2 = "Intern" Then
        MsgBox "Es kann keine Auftrag gedruckt werden." & vbLf & vbLf & "Grund: Intern", , "Hinweis"
        Exit Sub
    End If
    If cboart2 = "Angebot" Then
        MsgBox "Es kann keine Auftrag gedruckt werden." & vbLf & vbLf & "Grund: Angebot" & vbLf & "Wandeln Sie das Angebot in einen Auftrag um!", , "Hinweis"
        Exit Sub
    End If
    If lstKasse.ListCount = 0 Then
        MsgBox "Kein(e) Artikel in der Liste!", _
        vbExclamation, "Auftrag als PDF!"
        Exit Sub
    Else
        If Not txt_KDID.Value = "" Then
            If Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 4) = "Firma" Then
                frmContact.cboKDNr = "Firma " & Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 7)
            Else
            frmContact.cboKDNr = Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 7) & ", " & _
                                    Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 6)
            End If
        End If
        frmContact.Caption = "Auftrag als PDF"
        frmContact.txt_IDART.Value = "APDF"
        frmContact.cmd_invoiceprint.Caption = "Speichern (.pdf)"
        frmContact.lblinfo.Visible = False
        frmContact.lblinfo2.Visible = False
        frmContact.txtdate.Visible = False
        frmContact.comnext.Visible = False
        frmContact.cmdnextL.Visible = False
        frmContact.Show
    End If
End Sub

Private Sub cmd_orderprint_Click()
    If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
    If cboart2 = "Intern" Then
        MsgBox "Es kann keine Auftrag gedruckt werden." & vbLf & vbLf & "Grund: Intern", , "Hinweis"
        Exit Sub
    End If
    If cboart2 = "Angebot" Then
        MsgBox "Es kann keine Auftrag gedruckt werden." & vbLf & vbLf & "Grund: Angebot" & vbLf & "Wandeln Sie das Angebot in einen Auftrag um!", , "Hinweis"
        Exit Sub
    End If
    If lstKasse.ListCount = 0 Then
        MsgBox "Kein(e) Artikel in der Liste!", _
        vbExclamation, "Auftrag drucken!"
        Exit Sub
    Else
        If Not txt_KDID.Value = "" Then
            If Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 4) = "Firma" Then
                frmContact.cboKDNr = "Firma " & Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 7)
            Else
            frmContact.cboKDNr = Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 7) & ", " & _
                                    Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 6)
            End If
        End If
        frmContact.Caption = "Auftrag drucken"
        frmContact.txt_IDART.Value = "APRI"
        frmContact.cmd_invoiceprint.Caption = "Drucken"
        frmContact.lblinfo.Visible = False
        frmContact.lblinfo2.Visible = False
        frmContact.txtdate.Visible = False
        frmContact.comnext.Visible = False
        frmContact.cmdnextL.Visible = False
        frmContact.Show
    End If
End Sub

Private Sub lstKasse_Click()
    cmdMloeschen.Visible = True
End Sub

Private Sub txt_RENr_Change()
    If Not txt_RENr.Value = "" And cboart2 = "Auftrag" Then
        cmd_Beleg.Visible = True
    Else
        cmd_Beleg.Visible = False
    End If
End Sub

Sub VEVKVerfuegbar() '1.44
    Dim xrow As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    On Error Resume Next
    cbo_VPEinheit.Clear
    Application.ScreenUpdating = False
    Set DIC = CreateObject("scripting.dictionary")
    With cbo_VPEinheit
        With ThisWorkbook.Sheets("VPEinheit")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:O" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 2) = "" And CStr(arrTmpA(i, 2)) = CStr(txtID) And arrTmpA(i, 14) = "VP-VK" Then
                    xKey = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ")"
                    xrow = xrow + 1
                    DIC(xKey) = 0
                End If
            Next i
        End With
        cbo_VPEinheit.AddItem "Standard"
        For Each xKey In DIC
            cbo_VPEinheit.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_VPEinheit.ListIndex = 0
        If Not xrow = 0 Then
            cbo_VPEinheit.ListIndex = 0
            cbo_VPEinheit.Enabled = True
        Else
            cbo_VPEinheit.ListIndex = 0
            cbo_VPEinheit.Enabled = False
        End If
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub txtID_Change()
    If Not txtID.Value = "" Then
        Call VEVKVerfuegbar
    End If
End Sub

Private Sub txtRabatt_Change()
    Call NettogesRechnen
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    Dim strANr As String
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    cboart2.Clear
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    cmdKasse.Caption = "Ausbuchen"
    cmd_Beleg.Caption = "Beleg ist gesperrt!" & vbLf & "Freigeben?"
    If Sheets("Lager").Cells(1, 5) = "" Then
        lbl_Frei.Visible = False
        lblFrei.Visible = False
    Else
        lbl_Frei.Visible = True
        lblFrei.Visible = True
        lblFrei.Caption = Sheets("Lager").Cells(1, 5)
    End If
    With cboart2
        .AddItem "Bitte ausw|fffd|hlen"
        .AddItem "Barverkauf"
        .AddItem "Rechnung"
        .AddItem "Angebot"
        .AddItem "Auftrag"
        .AddItem "Intern"
    End With
    cboart2.ListIndex = 0
    txtRabatt.Locked = True
    If Not Sheets("Kassendaten").Range("B2").Value = "" Then
        cmdKasseaktive.Caption = "Wechseln zu " & Sheets("Kassendaten").Range("K2").Value
    End If
    If Sheets("Daten").Range("D20").Value = "Ja" Then
        Check_SortAuf.Value = True
    Else
        Check_SortAuf.Value = False
    End If
    Call SuchenKasseV2
    Call RAuftraege
    Call RAngebote
    Call ListMakiert
    If cboart2.Value = "Intern" Then
        chkoMwSt = True
    End If
    If lstKasse.ListCount > 0 Then
        cmdNArtikel.Visible = True
    End If
End Sub

Private Sub cbo_Angebot_Change()
    If Not cbo_Angebot = "" Then
        cmd_InfoAN.Enabled = True
        cmd_orderpdf.Visible = False
        cmd_orderprint.Visible = False
        cmd_printinvoice.Visible = False
        cmd_pdfinvoice.Visible = False
        cmdLschein_PDF.Visible = False
        cmdLschein.Visible = False
        cmdADrucken.Visible = True
        cmdPDFprint.Visible = True
    Else
        cmd_InfoAN.Enabled = False
    End If
End Sub

Private Sub cbo_Angebot_click()
    On Error Resume Next
    cboart2 = "Angebot"
    txt_RENr.Value = ""
    cboAuftragSuchen.ListIndex = -1
    cmdDaendern.Visible = False
    comAStorno.Visible = True
    cmdNArtikel.Visible = True
    cmd_umWAngebot.Visible = True
    comAStorno.Caption = "Angebot l|fffd|schen"
    txtRnr = cbo_Angebot
    Call SuchenAngebotNeu
    cmd_printinvoice.Visible = False
    cmd_pdfinvoice.Visible = False
    cmdLschein_PDF.Visible = False
    cmdLschein.Visible = False
    If lbl_ArtikelNR.Caption = "" Then
        lstKasse.SetFocus
    Else
        txtMenge.SetFocus
    End If
    CheckBox2 = True
End Sub

Private Sub cbo_Lagerplatz_Change()
    Dim lng, lngID As Long
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    If cbo_Lagerplatz = "Hauptlagerplatz" Then
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                    lngID = i
                End If
            Next i
        End With
        txt_LMenge.Value = Sheets("Lager").Cells(lngID, 8)
        lbl_LOAnzahl.Caption = Sheets("Lager").Cells(lngID, 8)
        txt_LPID.Value = ""
    Else
        For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
            If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz.Text Then
                txt_LMenge.Value = Sheets("Lagerorte").Cells(lng, 4)
                lbl_LOAnzahl.Caption = Sheets("Lagerorte").Cells(lng, 4)
                txt_LPID.Value = Sheets("Lagerorte").Cells(lng, 1)
            End If
        Next lng
    End If
End Sub

Private Sub cboAuftragSuchen_Change()
    If Not cboAuftragSuchen = "" Then
        cmd_orderpdf.Visible = True
        cmd_orderprint.Visible = True
        cmd_InfoAUF.Enabled = True
        cmd_printinvoice.Visible = True
        cmd_pdfinvoice.Visible = True
        cmdLschein_PDF.Visible = True
        cmdLschein.Visible = True
        cmdADrucken.Visible = False
        cmdPDFprint.Visible = False
    Else
        cmd_InfoAUF.Enabled = False
    End If
    cmdMloeschen.Visible = False
End Sub

Private Sub cboAuftragSuchen_Click()
    On Error Resume Next
    cbo_Angebot.ListIndex = -1
    comAStorno.Visible = True
    comAStorno.Caption = "Auftrag stornieren"
    txtAdatum.Visible = True
    lblAdatum.Visible = True
    lblAdatum2.Visible = True
    cmdDaendern.Visible = True
    cmd_umWAngebot.Visible = False
    txtRnr.BorderColor = &HC000&
    cmd_printinvoice.Visible = True
    cmd_pdfinvoice.Visible = True
    cmdLschein_PDF.Visible = True
    cmdLschein.Visible = True
    Call SuchenAuftragV2
    If lbl_ArtikelNR.Caption = "" Then
        lstKasse.SetFocus
    Else
        txtMenge.SetFocus
    End If
End Sub

Private Sub cmd_NeuArtikelKasse_Click()
    frmArtikel.txt_Verleih.Value = "Kasse"
    Call Neu
End Sub

Private Sub cmd_ScanHinZu_Click()
    On Error Resume Next
    If cboart2.ListIndex = 0 Then Exit Sub
    If txt_sperre.Value = "" Then GoTo weiter
    If Not txt_RENr.Value = "" And CLng(txt_sperre) = 0 Then
        MsgBox "Beleg ist abgeschlossen!" & vbLf & "Grund: Rechnung wurde bereits gedruckt!" & vbLf & vbLf & "Rechnungs Nr.: " & txt_RENr, vbInformation, cboart2 & " " & txtRnr
        Exit Sub
    End If
weiter:
    If cboart2 = "Auftrag" And txtRnr.Value = "" Then
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2 = "Angebot" And txtRnr.Value = "" Then
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2 = "Rechnung" And txtRnr.Value = "" Then
        txtRnr.SetFocus
        Exit Sub
    End If
    frmBarcode.txt_BarcodeArt.Value = "kasse"
    frmBarcode.txt_BarcodeArt2.Value = cboart2
    If cboart2 = "Auftrag" Or cboart2 = "Angebot" Or cboart2 = "Rechnung" Then
        frmBarcode.txt_KasseNr.Value = txtRnr.Value
        frmBarcode.Caption = cboart2 & " (" & txtRnr.Value & " ) / Artikel hinzuf|fffd|gen"
    Else
        frmBarcode.Caption = cboart2 & " / Artikel hinzuf|fffd|gen"
    End If
    If lstKasse.ListCount = 0 Then
        frmBarcode.cmd_BCAusbuchen.Caption = cboart2 & " erstellen!"
    Else
        frmBarcode.cmd_BCAusbuchen.Caption = cboart2 & " / hinzuf|fffd|gen!"
    End If
    frmBarcode.Show
End Sub

Private Sub CheckBox2_Click()
    Dim intRow, lngwert As Long
    txt_Fast.Value = "x"
    If Me!lstKasse.ListCount = 0 Then
        txt_Fast.Value = ""
        CheckBox2 = False
        Exit Sub
    End If
    If CheckBox2 = False Then
        For intRow = 0 To Me!lstKasse.ListCount - 1
            Me!lstKasse.Selected(intRow) = False
        Next intRow
        lbl_Gewicht2.Caption = ""
        lbl_sum12.Caption = Format(0, "currency")
        lbl_MwStsum.Caption = Format(0, "currency")
        lbl_sum22.Caption = Format(0, "currency")
        txt_Fast.Value = ""
        Exit Sub
    Else
        Call WKselect_all
    End If
    txt_Fast.Value = ""
End Sub

Sub WKselect_all()
    Dim intRow, lngwert, lngwert2 As Long
    txt_Fast.Value = "x"
    lngwert = lstKasse.ListCount
    For intRow = 0 To Me!lstKasse.ListCount - 1
        Me!lstKasse.Selected(intRow) = True
        lngwert2 = lngwert2 + 1
    Next intRow
    txt_Fast.Value = ""
    If lngwert2 = lngwert Then
        Call SumKasseV2
    End If
End Sub

Private Sub cmd_InfoAN_Click()
    Dim lngID As Long
    On Error Resume Next

    If frmKasse.cbo_Angebot = "" Then Exit Sub
    lngID = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(txt_KDID.Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
    If Worksheets("Kunden").Cells(CLng(lngID), 7) = "" Then
        frmInfoKasse.Caption = "Information zum Angebot " & frmKasse.txtRnr.Value
        frmInfoKasse.lbl_InfoArt.Caption = frmKasse.cboart2 & " / " & frmKasse.txtRnr.Value
        frmInfoKasse.lbl_KDNR.Caption = Worksheets("Kunden").Cells(CLng(lngID), 3)
        frmInfoKasse.cmd_KundenAE.Caption = "Kunden hinzuf|fffd|gen"
        frmInfoKasse.Show
        Exit Sub
    Else
        frmInfoKasse.cmd_KundenAE.Caption = "Kunden |fffd|ndern?"
    End If
    frmInfoKasse.Caption = "Information zum Angebot " & frmKasse.txtRnr.Value
    frmInfoKasse.lbl_InfoArt.Caption = frmKasse.cboart2 & " / " & frmKasse.txtRnr.Value
    frmInfoKasse.lbl_KDNR.Caption = Worksheets("Kunden").Cells(CLng(lngID), 3)
    frmInfoKasse.lbl_ErstelltAM.Caption = Worksheets("Reservierungen").Cells((Worksheets("Reservierungen").Range("A2" & ":A" & Worksheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row).Find(cbo_Angebot.Text, LookAt:=xlWhole, MatchCase:=True).Row), 21)
    frmInfoKasse.lbl_ErstelltVON.Caption = Worksheets("Reservierungen").Cells((Worksheets("Reservierungen").Range("A2" & ":A" & Worksheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row).Find(cbo_Angebot.Text, LookAt:=xlWhole, MatchCase:=True).Row), 22)
    frmInfoKasse.lbl_email.Caption = Worksheets("Kunden").Cells(CLng(lngID), 13)
    frmInfoKasse.lbl_tele.Caption = Worksheets("Kunden").Cells(CLng(lngID), 11)
    If Worksheets("Kunden").Cells(CLng(lngID), 4) = "Firma" Then
        frmInfoKasse.lbl_Kunden.Caption = "Firma " & Worksheets("Kunden").Cells(CLng(lngID), 7)
    Else
        frmInfoKasse.lbl_Kunden.Caption = Worksheets("Kunden").Cells(CLng(lngID), 6) & " " & Worksheets("Kunden").Cells(CLng(lngID), 7)
    End If
    frmInfoKasse.lbl_Anschrift.Caption = Worksheets("Kunden").Cells(CLng(lngID), 8)
    frmInfoKasse.lbl_PLZ.Caption = Worksheets("Kunden").Cells(CLng(lngID), 9) & " " & Worksheets("Kunden").Cells(CLng(lngID), 10)
    frmInfoKasse.Show
End Sub

Private Sub cmd_InfoAUF_Click()
    Dim lngID As Long
    On Error Resume Next
    If frmKasse.cboAuftragSuchen = "" Then Exit Sub
    lngID = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(txt_KDID.Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
    If Worksheets("Kunden").Cells(CLng(lngID), 7) = "" Then
        frmInfoKasse.Caption = "Information zum Auftrag " & frmKasse.txtRnr.Value
        frmInfoKasse.lbl_InfoArt.Caption = frmKasse.cboart2.Text & " / " & frmKasse.txtRnr.Value
        frmInfoKasse.lbl_Faellig.Caption = frmKasse.txtAdatum.Value
        frmInfoKasse.cmd_KundenAE.Caption = "Kunden hinzuf|fffd|gen"
        frmInfoKasse.Show
        Exit Sub
    Else
        frmInfoKasse.cmd_KundenAE.Caption = "Kunden |fffd|ndern?"
    End If
    frmInfoKasse.Caption = "Information zum Auftrag " & frmKasse.txtRnr.Value
    frmInfoKasse.lbl_InfoArt.Caption = frmKasse.cboart2.Text & " / " & frmKasse.txtRnr.Value
    frmInfoKasse.lbl_Faellig.Caption = frmKasse.txtAdatum.Value
    frmInfoKasse.lbl_KDNR.Caption = Worksheets("Kunden").Cells(CLng(lngID), 3)
    frmInfoKasse.lbl_email.Caption = Worksheets("Kunden").Cells(CLng(lngID), 13)
    frmInfoKasse.lbl_tele.Caption = Worksheets("Kunden").Cells(CLng(lngID), 11)
    frmInfoKasse.lbl_ErstelltAM.Caption = Worksheets("Reservierungen").Cells((Worksheets("Reservierungen").Range("A2" & ":A" & Worksheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row).Find(cboAuftragSuchen.Text, LookAt:=xlWhole, MatchCase:=True).Row), 21)
    frmInfoKasse.lbl_ErstelltVON.Caption = Worksheets("Reservierungen").Cells((Worksheets("Reservierungen").Range("A2" & ":A" & Worksheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row).Find(cboAuftragSuchen.Text, LookAt:=xlWhole, MatchCase:=True).Row), 22)
    If Worksheets("Kunden").Cells(CLng(lngID), 4) = "Firma" Then
        frmInfoKasse.lbl_Kunden.Caption = "Firma " & Worksheets("Kunden").Cells(CLng(lngID), 7)
    Else
        frmInfoKasse.lbl_Kunden.Caption = Worksheets("Kunden").Cells(CLng(lngID), 6) & " " & Worksheets("Kunden").Cells(CLng(lngID), 7)
    End If
    frmInfoKasse.lbl_Anschrift.Caption = Worksheets("Kunden").Cells(CLng(lngID), 8)
    frmInfoKasse.lbl_PLZ.Caption = Worksheets("Kunden").Cells(CLng(lngID), 9) & " " & Worksheets("Kunden").Cells(CLng(lngID), 10)
    frmInfoKasse.Show
End Sub

Private Sub cmd_kostenstelle_Click()
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    frmkostenstelle.Show
End Sub

Private Sub cmd_printinvoice_Click()
    If cboAuftragSuchen = "" Then Exit Sub
    frmKasseWA.Caption = "Rechnung zu " & frmKasse.cboart2 & " / " & frmKasse.txtRnr & " / " & Format(lbl_sum22.Caption, "currency")
    frmKasseWA.txt_Art.Value = "RE"
    frmKasseWA.txt_VerwWA.SetFocus
    frmKasseWA.Check_VorG.Value = True
    frmKasseWA.lbl_VorG.Enabled = True
    frmKasseWA.lbl_VorG.Font.Bold = True
    frmKasseWA.Check_REprint.Value = True
    frmKasseWA.lbl_REprint.Font.Bold = True
    frmKasseWA.lbl_REprint.Enabled = True
    frmKasseWA.txt_LSNr.Visible = False
    frmKasseWA.lbl_Liefernr.Visible = False
    If Not txt_RENr.Value = "" Then
        frmKasseWA.txt_Nummer.Value = CStr(txt_RENr)
        frmKasseWA.txt_Nummer.Enabled = False
        frmKasseWA.cmd_REAUF.Enabled = False
    Else
        frmKasseWA.txt_Nummer.SetFocus
    End If
    frmKasseWA.Show
End Sub

Private Sub cmd_pdfinvoice_Click()
    If cboAuftragSuchen = "" Then Exit Sub
    frmKasseWA.Caption = "Rechnung (.pdf) zu " & frmKasse.cboart2 & " / " & frmKasse.txtRnr & " / " & Format(lbl_sum22.Caption, "currency")
    frmKasseWA.txt_Art.Value = "REPDF"
    frmKasseWA.txt_VerwWA.SetFocus
    frmKasseWA.Check_VorG.Value = True
    frmKasseWA.lbl_VorG.Enabled = True
    frmKasseWA.lbl_VorG.Font.Bold = True
    frmKasseWA.Check_REprint.Value = True
    frmKasseWA.lbl_REprint.Caption = "Rechnung als .pdf"
    frmKasseWA.lbl_REprint.Font.Bold = True
    frmKasseWA.lbl_REprint.Enabled = True
    frmKasseWA.txt_LSNr.Visible = False
    frmKasseWA.lbl_Liefernr.Visible = False
    If Not txt_RENr.Value = "" Then
        frmKasseWA.txt_Nummer.Value = CStr(txt_RENr)
        frmKasseWA.txt_Nummer.Enabled = False
        frmKasseWA.cmd_REAUF.Enabled = False
    Else
        frmKasseWA.txt_Nummer.SetFocus
    End If
    frmKasseWA.Show
End Sub

Sub Invoice()
    On Error Resume Next
    
    If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
    If cboart2 = "Intern" Then
        MsgBox "Es kann keine Rechnung gedruckt werden." & vbLf & vbLf & "Grund: Intern", , "Hinweis"
        Exit Sub
    End If
    If cboart2 = "Angebot" Then
        MsgBox "Es kann keine Rechnung gedruckt werden." & vbLf & vbLf & "Grund: Angebot" & vbLf & "Wandeln Sie das Angebot in einen Auftrag um!", , "Hinweis"
        Exit Sub
    End If
    If lstKasse.ListCount = 0 Then
        MsgBox "Kein(e) Artikel in der Liste!", _
        vbExclamation, "Rechnung"
        Exit Sub
    Else
        If Not txt_KDID.Value = "" Then
            If Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 4) = "Firma" Then
                frmContact.cboKDNr = "Firma " & Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 7)
            Else
            frmContact.cboKDNr = Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 7) & ", " & _
                                    Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 6)
            End If
        End If
        If frmKasse.cboart2 = "Barverkauf" Then
            frmContact.Caption = "Ausdruck / Barverkauf / Kunde"
        End If
        frmContact.lblinfo.Visible = False
        frmContact.lblinfo2.Visible = False
        frmContact.txtdate.Visible = False
        frmContact.comnext.Visible = False
        frmContact.cmdnextL.Visible = False
        frmContact.Show
    End If
End Sub

Private Sub txtRnr_AfterUpdate()
    Dim strRN As String
    Dim Treffer As Range

    If Not txtRnr = "" And lstKasse.ListCount = 0 And cboart2 = "Auftrag" Then
        Set Treffer = Worksheets("Reservierungen").Columns(1).Find(what:=txtRnr.Value, LookAt:=xlWhole, MatchCase:=True)
            If Treffer Is Nothing Then
                Set Treffer = Nothing
                Exit Sub
            Else
                strRN = MsgBox("Die Auftragsnummer " + (txtRnr) + " wurde bereits erfasst! M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
                If strRN = vbNo Then
                    txtRnr.Value = ""
                    txtRnr.SetFocus
                    Set Treffer = Nothing
                    Exit Sub
                End If
            End If
    End If
    Set Treffer = Nothing
End Sub

Private Sub txtRnr_Change()
    If Not txtRnr = "" Then
        txtRnr.BorderColor = &HC000&
        cmdletzterArtikel.Visible = True
    Else
        txtRnr.BorderColor = &HFF&
    End If
End Sub

Private Sub cmd_Leistung_Click()
    If Not txt_RENr.Value = "" And txt_sperre = "0" Then
        lbl_status.Caption = "Beleg ist abgeschlossen und Rechnung (" & txt_RENr & ") wurde bereits gedruckt!" & vbLf & "Rechnungsbeleg: " & CStr(txt_RENr)
        lbl_status.Visible = True
        Exit Sub
    End If
    If Not cboart2 = "Bitte ausw|fffd|hlen" Then
        frmLeistung.Show
        frmLeistung.txt_kzel.SetFocus
    Else
        MsgBox "Bitte w|fffd|hlen Sie zuerst eine Art oder ein Auftrag aus!", , "Leistungen"
        cboart2.SetFocus
    End If
End Sub

Private Sub cmd_Etikett_Click()
    Dim lng, slng, lngGe, KNID As Long
    Dim Mlng As Double
    Dim Blng, Blng2, stxt As String
    Dim strFontFileName As String
    'Schriftart pruefen
    strFontFileName = "Bar-Code 39"
    If SystemFontExists(strFontFileName) = False Then
        MsgBox "Bitte installieren Sie die Schriftart (Bar-Code 39)!" & vbLf & "Weitere Informationen finden Sie auch im Benutzerhandbuch!", vbInformation, "Schriftart (Bar-Code 39) ist nicht installiert!"
        Exit Sub
    End If
    If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
    If cboart2 = "Angebot" Then
        MsgBox "F|fffd|r Angebot nicht Verf|fffd|gbar!", , "Hinweis"
        Exit Sub
    End If
    frmEtikett.fra_BeEtikett.Visible = False
    If Not cboart2 = "Intern" Then
        If txt_KDID.Value = "" Then
            stxt = MsgBox("M|fffd|chten Sie einen Kunden ausw|fffd|hlen?", vbYesNo, "Kunde")
            If stxt = vbYes Then
                frmContact.cboAnsp.Visible = False
                frmContact.txtdate.Visible = False
                frmContact.lblinfo.Visible = False
                frmContact.cmd_invoiceprint.Visible = False
                frmContact.cmdnextL.Visible = False
                frmContact.lblMitarbeiter.Visible = False
                frmContact.lblinfo2.Visible = False
                frmContact.cmd_KDsave.Visible = True
                frmContact.Show
            End If
        End If
    End If
    frmEtikett.txt_type.Value = "G1"
    If Not txt_KDID.Value = "" Then
        KNID = Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 1).Row
        frmEtikett.txt_Firma = Worksheets("Kunden").Cells(KNID, 7) & ", " & Worksheets("Kunden").Cells(KNID, 6)
        frmEtikett.txt_adress = Worksheets("Kunden").Cells(KNID, 8)
        frmEtikett.txt_PLZ = Worksheets("Kunden").Cells(KNID, 9) & " " & Worksheets("Kunden").Cells(KNID, 10)
        frmEtikett.txt_LieferantAbs = Worksheets("Kunden").Cells(KNID, 24)
    End If
    frmEtikett.txt_LieferscheinNr.Value = frmKasse.txt_LSNr.Value
    slng = 0
    Mlng = 0
    With lstKasse
        For lng = 0 To .ListCount - 1
            If .Selected(lng) = True Then
                slng = slng + 1
                Mlng = Mlng + lstKasse.Column(2, lng)
                Blng = lstKasse.Column(1, lng)
                Blng2 = Blng2 & Blng & ", "
                lngGe = lngGe + lstKasse.Column(9, lng)
            End If
        Next lng
    End With
    If slng = 1 Then
        With lstKasse
            For lng = 0 To .ListCount - 1
                If .Selected(lng) = True Then
                    frmEtikett.txt_ArtikelNrE.Value = lstKasse.Column(0, lng)
                    frmEtikett.txt_BezeichnungVDA.Value = lstKasse.Column(1, lng)
                    frmEtikett.txt_Stueckzahl.Value = lstKasse.Column(2, lng)
                End If
            Next
        End With
    Else
        frmEtikett.txt_Stueckzahl.Value = Mlng
        frmEtikett.txt_BezeichnungVDA.Value = Blng2
    End If
    If lngGe > 0 Then
        frmEtikett.txt_FuellmengeN = lngGe
        frmEtikett.cbo_Gew1 = "Kg"
    End If
    If frmKasse.cboart2 = "Auftrag" Then
        frmEtikett.lbl_Art.Caption = "(5) Auftrag"
        frmEtikett.txt_RENr.Value = frmKasse.txtRnr.Value
    Else
        frmEtikett.lbl_Art.Caption = "(5) " & frmKasse.cboart2.Text
    End If
    frmEtikett.Frame_EGross.Top = 6
    frmEtikett.Frame_EGross.Left = 4.5
    frmEtikett.Show
End Sub

Private Sub cmd_umWAngebot_Click()
    Dim z, l As Long
    Dim stxt, Astr, Anrstr, strFor, strNr, strAUNext, strAUNr As String
    On Error Resume Next

    stxt = MsgBox("M|fffd|chten Sie das Angebot: " + cbo_Angebot + " in einen Auftrag umwandeln?", vbYesNo, "Hinweis")
    If stxt = vbNo Then Exit Sub
    Astr = MsgBox("M|fffd|chten Sie eine neue Auftragsnummer vergeben?", vbYesNo + vbQuestion, "Hinweis")
    If Sheets("Daten").Range("D31") = "Auswahl 1" Then
        strFor = Sheets("Daten").Range("D34")
        strNr = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
    Else
        strNr = "AUF" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
    End If
    If Astr = vbYes Then
        Anrstr = InputBox("Bitte vergeben Sie eine neue Auftragsnummer!", "Auftrags Nr.", strNr)
        If Anrstr = "" Then
            MsgBox "Achtung: Auftragsnummer darf nicht leer sein!", vbCritical, "Hinweis"
            Exit Sub
        End If
    End If
    For z = lstKasse.ListCount To 1 Step -1
        l = lstKasse.Column(7, z - 1)
        Sheets("Reservierungen").Cells(l, 11) = "Auftrag"
        If Astr = vbYes Then
            Sheets("Reservierungen").Cells(l, 1) = Anrstr
        End If
    Next
    If Sheets("Daten").Range("D31") = "Auswahl 1" Then
        strFor = Sheets("Daten").Range("D34")
        strAUNext = Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
        strAUNr = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
        If CStr(strNr) = CStr(strAUNr) Then
            Sheets("Daten").Range("D33") = "'" & CStr(strAUNext)
        End If
    End If
    frmKasse.cbo_Angebot.Clear
    frmKasse.cboAuftragSuchen.Clear
    lstKasse.Clear
    frmKasse.cboart2.ListIndex = -1
    Call RAuftraege
    Call RAngebote
    Call leeren
    cmd_umWAngebot.Visible = False
    If Astr = vbYes Then
        MsgBox "Angebot wurde in einen Auftrag umgewandelt!" & vbLf & vbLf & "Ihre Auftragsnummer lautet: " + Anrstr, vbInformation, "Hinweis"
    Else
        MsgBox "Angebot wurde in einen Auftrag umgewandelt!", vbInformation, "Hinweis"
    End If
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Schlie|fffd|en"" beenden!", , "Hinweis"
        cmdexit.SetFocus
        Cancel = True
    End If
End Sub

Private Sub cmdDaendern_Click()
    If lstKasse.ListCount = 0 Then Exit Sub
    frmKalender.txt_UID = "AFAE"
    frmKalender.Show
End Sub

Private Sub txtMenge_Change()
    If txtMenge.Value = "" Then Exit Sub
    If Not IsNumeric(txtMenge.Value) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        txtMenge.Value = ""
        txtMenge.SetFocus
    End If
End Sub

Private Sub cboart2_Click()
    Dim strFor As String
    On Error Resume Next
    If cboart2.Text = "Rechnung" Then
        lbRNr.Caption = "Beleg Nr.:"
        cboAuftragSuchen.ListIndex = -1
        cbo_Angebot.ListIndex = -1
        If Sheets("Daten").Range("D23") = "Ja" Then
            txtRnr.Visible = False
            txtRnr.BorderColor = &HFF&
            txtRnr.Value = ""
            lbRNr.Visible = False
        Else
            txtRnr.Visible = True
            txtRnr.BorderColor = &HFF&
            txtRnr.Value = ""
            lbRNr.Visible = True
        End If
        cmddelete.Visible = True
        cmdMengeaendern.Visible = False
        comAStorno.Visible = False
        txtAdatum.Visible = False
        lblAdatum.Visible = False
        lblAdatum2.Visible = False
        cmdDaendern.Visible = False
        cmd_orderpdf.Visible = False
        cmd_orderprint.Visible = False
        cmdADrucken.Visible = False
        cmdPDFprint.Visible = False
        txtRnr.SetFocus
    ElseIf cboart2.Text = "Angebot" Then
        cboAuftragSuchen.ListIndex = -1
        lbRNr.Caption = "Angebots Nr."
        lbRNr.Visible = True
        txtRnr.Visible = True
        txtRnr.Value = ""
        txtRnr.BorderColor = &HFF&
        cmddelete.Visible = False
        txtAdatum.Visible = False
        lblAdatum.Visible = False
        lblAdatum2.Visible = False
        cmdDaendern.Visible = False
        cmdNArtikel.Visible = True
        cmdADrucken.Visible = True
        cmdPDFprint.Visible = True
        If Not Sheets("Daten").Range("D35").Value = "Nein" Or Sheets("Daten").Range("D35").Value = "" Then
            If Not Sheets("Daten").Range("D35") = "Auswahl 2" Then
                strFor = Sheets("Daten").Range("D38")
                txtRnr.Value = Sheets("Daten").Range("D36") & Format(CDbl(Sheets("Daten").Range("D37")) + 1, strFor)
            Else
                txtRnr.Value = "AN" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
            End If
            txtMenge.SetFocus
        End If
        txtRnr.SetFocus
    ElseIf cboart2.Text = "Auftrag" Then
        cbo_Angebot.ListIndex = -1
        lbRNr.Caption = "Auftrags Nr."
        lbRNr.Visible = True
        txtRnr.Visible = True
        txtRnr.Value = ""
        txtRnr.BorderColor = &HFF&
        cmddelete.Visible = False
        txtAdatum.Visible = True
        lblAdatum.Visible = True
        lblAdatum2.Visible = True
        cmdNArtikel.Visible = True
        cmdDaendern.Visible = True
        cmdADrucken.Visible = False
        cmdPDFprint.Visible = False
        If Not Sheets("Daten").Range("D31").Value = "Nein" Or Sheets("Daten").Range("D31").Value = "" Then
            If Not Sheets("Daten").Range("D31") = "Auswahl 2" Then
                strFor = Sheets("Daten").Range("D34")
                txtRnr.Value = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
            Else
                txtRnr.Value = "AUF" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
            End If
            txtMenge.SetFocus
        Else
            txtRnr.SetFocus
        End If
    Else
        txtRnr.Visible = False
        lbRNr.Visible = False
        cmddelete.Visible = True
        cmdMengeaendern.Visible = False
        comAStorno.Visible = False
        txtAdatum.Visible = False
        lblAdatum.Visible = False
        lblAdatum2.Visible = False
        cmdDaendern.Visible = False
        cboAuftragSuchen.ListIndex = -1
        cbo_Angebot.ListIndex = -1
        cmd_printinvoice.Visible = False
        cmd_pdfinvoice.Visible = False
        cmdLschein_PDF.Visible = False
        cmdLschein.Visible = False
        cmd_orderpdf.Visible = False
        cmd_orderprint.Visible = False
        cmdADrucken.Visible = False
        cmdPDFprint.Visible = False
    End If
    If cboart2.Text = "Intern" Then
        chkoMwSt = True
    Else
        chkoMwSt = False
    End If
    If lstKasse.ListCount = 0 Then
        lbl_Gewicht2.Caption = ""
        lbl_sum12.Caption = ""
        lbl_MwStsum.Caption = ""
        lbl_sum22.Caption = ""
        lbl_Rabatt.Caption = ""
    End If
    txt_RENr.Value = ""
    txt_LSNr.Value = ""
End Sub

Private Sub cboart2_DropButtonClick()
    Dim strFor As String
    If lstKasse.ListCount = 0 Then
        txt_sperre.Value = ""
    End If
    If frmKasse.cboart2 = "Barverkauf" Then
        frmKasse.lstKasse.Clear
        Call SuchenKasseV2
        Exit Sub
    End If
    If Not frmKasse.lbl_ArtikelNR.Caption = "" Then
        frmKasse.lstKasse.Clear
    Else
        If frmKasse.lstKasse.ListCount > 0 And Not frmKasse.cboart2 = "Barverkauf" And Not frmKasse.cboart2 = "Rechnung" And Not frmKasse.cboart2 = "Intern" Then
            frmKasse.txt_KDID.Value = ""
            frmKasse.txtRnr.Value = ""
            cboAuftragSuchen.ListIndex = -1
            frmKasse.lstKasse.Clear
            Call leeren
            If Not Sheets("Daten").Range("D31").Value = "Nein" Or Sheets("Daten").Range("D31").Value = "" Then
                If cboart2 = "Auftrag" Then
                    If Not Sheets("Daten").Range("D34") = "#Auftrag#" Then
                        strFor = Sheets("Daten").Range("D34")
                        txtRnr.Value = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
                    Else
                        txtRnr.Value = "AUF" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
                    End If
                End If
            End If
            If Not Sheets("Daten").Range("D35").Value = "Nein" Or Sheets("Daten").Range("D35").Value = "" Then
                If cboart2 = "Angebot" Then
                    If Not Sheets("Daten").Range("D35") = "Auswahl 2" Then
                        strFor = Sheets("Daten").Range("D38")
                        txtRnr.Value = Sheets("Daten").Range("D36") & Format(CDbl((Sheets("Daten").Range("D37")) + 1), strFor)
                    Else
                        txtRnr.Value = "AN" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
                    End If
                End If
            End If
        End If
    End If
    cmdADrucken.Visible = False
    cmdPDFprint.Visible = False
    cmd_printinvoice.Visible = False
    cmd_pdfinvoice.Visible = False
    cmdLschein_PDF.Visible = False
    cmdLschein.Visible = False
    cmd_orderprint.Visible = False
    cmd_orderpdf.Visible = False
End Sub

Private Sub chkoMwSt_Click()
    Call SumKasseV2
End Sub
    
Private Sub cmdKasse_Click() '1.44
    Dim arrTmpA, arrTmpB, i, lngS, LngRED, LngLSD As Long
    Dim Last_Row As Long
    Dim arrTmpA2, arrTmpB2, i2, lngs2 As Long
    Dim Last_Row2, lng2 As Long
    Dim l, lz, lngLine, lng, stxt, lngwert, lngWertZ As Long
    Dim lngA As Long
    Dim LagerWert, LagerMenge, lngM, lngR, strF As String
    On Error Resume Next
    ThisWorkbook.Activate
    If Not cbo_Angebot = "" Then
        MsgBox "Angebote k|fffd|nnen nicht ausgebucht werden!" & vbLf & "Wandeln Sie diesen in einen Auftrag um!", , "Hinweis"
        Exit Sub
    End If
    If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
    If cboart2 = "Barverkauf" Then
        frmKasseWA.Check_LSprint.Enabled = False
        If Sheets("Daten").Range("D23") = "Nein" Then
            frmKasseWA.txt_Nummer = "B" & ThisWorkbook.Sheets("Warenausgang").Range("B1").Text & Format(ThisWorkbook.Sheets("Warenausgang").Range("B2") + 1, "000000")
        End If
    ElseIf cboart2 = "Rechnung" Then
        frmKasseWA.cmd_REAUF.Visible = False
    ElseIf cboart2 = "Intern" Then
        frmKasseWA.lbl_Nummer.Caption = "Beleg:"
        frmKasseWA.lbl_Nummer.Top = 138
        frmKasseWA.txt_Nummer.Enabled = True
        frmKasseWA.lbl_auto.Visible = False
        frmKasseWA.Check_auto.Visible = False
        frmKasseWA.cmd_REAUF.Visible = False
        frmKasseWA.txt_LSNr.Enabled = False
    End If
    Application.ScreenUpdating = False
    If Sheets("Daten").Range("F27") = "Ja" And Not cboAuftragSuchen = "" Then
        LngRED = 0
        LngLSD = 0
        With ThisWorkbook.Sheets("Reservierungen")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 1) = CStr(cboAuftragSuchen) And CLng(arrTmpA(i, 15)) > 0 Then
                    LngRED = LngRED + CDbl(arrTmpA(i, 15))
                End If
                If arrTmpA(i, 1) = CStr(cboAuftragSuchen) And CLng(arrTmpA(i, 16)) > 0 Then
                    LngLSD = LngLSD + CDbl(arrTmpA(i, 16))
                End If
            Next i
        End With
        If Sheets("Daten").Range("F29") = "RL" Or Sheets("Daten").Range("F29") = "" Then
            If LngRED = 0 Then
                frmKasseWA.Check_REprint.Value = True
            End If
            If LngLSD = 0 Then
                frmKasseWA.Check_LSprint.Value = True
            End If
        ElseIf Sheets("Daten").Range("F29") = "L" Then
            If LngLSD = 0 Then
                frmKasseWA.Check_LSprint.Value = True
            End If
        Else
            If LngRED = 0 Then
                frmKasseWA.Check_REprint.Value = True
            End If
        End If
    End If
    If Not txt_RENr.Value = "" Then
        frmKasseWA.txt_Nummer.Value = CStr(txt_RENr)
        If Not cboAuftragSuchen = "" Then
            If CLng(frmKasse.txt_sperre) = 0 Then
                frmKasseWA.txt_Nummer.Enabled = False
                frmKasseWA.cmd_REAUF.Enabled = False
            End If
        End If
    End If
    If Not txt_LSNr.Value = "" Then
        frmKasseWA.txt_LSNr.Value = CStr(txt_LSNr)
        If Not cboAuftragSuchen = "" Then
            If CLng(frmKasse.txt_sperre) = 0 Then
                frmKasseWA.txt_LSNr.Enabled = False
                frmKasseWA.cmd_REAUF.Enabled = False
            End If
        End If
    End If
    If Worksheets("Lager").FilterMode Then Worksheets("Lager").ShowAllData
    If CDbl(lbl_sum22.Caption) > 0 Then
        If Not cboart2 = "Intern" Then
            If Not cboart2 = "Barverkauf" And Not frmKasse.txt_KDID.Value = "" Then
                If Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A2" & ":A" & Worksheets("Kunden").Cells(Rows.Count, 1).End(xlUp).Row).Find(CStr(frmKasse.txt_KDID), LookAt:=xlWhole, MatchCase:=True).Row), 29) = "Bar" Then
                    strF = MsgBox("Barzahlung erhalten?", vbYesNo, "Barverkauf")
                    If strF = vbNo Then
                        Application.ScreenUpdating = True
                        Exit Sub
                    End If
                ElseIf Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A2" & ":A" & Worksheets("Kunden").Cells(Rows.Count, 1).End(xlUp).Row).Find(CStr(frmKasse.txt_KDID), LookAt:=xlWhole, MatchCase:=True).Row), 29) = "Vor" Then
                    strF = MsgBox("Kunde hat |fffd|ber Vorkasse bezahlt?", vbYesNo, "Vorkasse")
                    If strF = vbNo Then
                        Application.ScreenUpdating = True
                        Exit Sub
                    End If
                End If
            End If
        End If
    End If
    For lz = 0 To lstKasse.ListCount - 1
        If lstKasse.Selected(lz) = True Then
            lngWertZ = lngWertZ + 1
        End If
    Next
    If Sheets("Daten").Range("D21").Value = "Nein" Then GoTo weiter:
    If lngWertZ = 0 Then
        Application.ScreenUpdating = True
        Exit Sub
    End If
    lngM = 0
    lngLine = 0
    With frmKasse.lstKasse
        For l = 0 To .ListCount - 1
            If .Selected(l) = True Then
                LagerWert = lstKasse.Column(6, l)
                LagerMenge = lstKasse.Column(2, l)
                lngR = 0
                lngwert = 0
                lngLine = 0
                If Not cboAuftragSuchen = "" Then
                    If Not Sheets("Reservierungen").Cells(CDbl(lstKasse.Column(7, l)), 23) = "" Then
                        With ThisWorkbook.Sheets("Lagerorte")
                            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                            arrTmpA = .Range("A1:AO" & Last_Row)
                            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                            For i = 2 To UBound(arrTmpA)
                                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(Sheets("Reservierungen").Cells(CDbl(lstKasse.Column(7, l)), 23)) Then
                                    lngLine = i
                                End If
                            Next i
                        End With
                        lngR = Sheets("Lagerorte").Cells(lngLine, 4).Value
                    Else
                        With ThisWorkbook.Sheets("Lager")
                            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                            arrTmpA = .Range("A1:AO" & Last_Row)
                            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                            For i = 2 To UBound(arrTmpA)
                                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(Sheets("Reservierungen").Cells(CDbl(lstKasse.Column(7, l)), 18)) Then
                                    lngLine = i
                                End If
                            Next i
                        End With
                        lngR = Sheets("Lager").Cells(lngLine, 8).Value
                    End If
                Else
                    If Not Sheets("Kassendaten").Cells(CDbl(lstKasse.Column(7, l)), 20) = "" Then
                        With ThisWorkbook.Sheets("Lagerorte")
                            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                            arrTmpA = .Range("A1:AO" & Last_Row)
                            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                            For i = 2 To UBound(arrTmpA)
                                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(Sheets("Kassendaten").Cells(CDbl(lstKasse.Column(7, l)), 20)) Then
                                    lngLine = i
                                End If
                            Next i
                        End With
                        lngR = Sheets("Lagerorte").Cells(lngLine, 4).Value
                    Else
                        With ThisWorkbook.Sheets("Lager")
                            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                            arrTmpA = .Range("A1:AO" & Last_Row)
                            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                            For i = 2 To UBound(arrTmpA)
                                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(Sheets("Kassendaten").Cells(CDbl(lstKasse.Column(7, l)), 17)) Then
                                    lngLine = i
                                End If
                            Next i
                        End With
                        lngR = Sheets("Lager").Cells(lngLine, 8).Value
                    End If
                End If
                If Not cboAuftragSuchen = "" Then
                    If cboart2 = "Auftrag" Then
                        If Not Sheets("Reservierungen").Cells(CDbl(lstKasse.Column(7, l)), 10) = "L" Then
                            If Not Sheets("Reservierungen").Cells(CDbl(lstKasse.Column(7, l)), 23) = "" Then
                                lngwert = CDbl(Worksheets("Lagerorte").Cells(CDbl(lngLine), 4).Value)
                                If CDbl(lngwert) < CDbl(LagerMenge) Then
                                    MsgBox "Der Artikel (" & lstKasse.Column(0, l) & "/" & lstKasse.Column(1, l) & ") verf|fffd|gt nicht |fffd|ber den n|fffd|tigen Bestand von " & CDbl(lstKasse.Column(2, l)) & "! " & vbLf & vbLf & " Verf|fffd|gbar sind: " & lngwert, vbInformation, "Warenaugang"
                                    lngM = lngM + 1
                                End If
                            Else
                                lngwert = CDbl(Sheets("Lager").Cells(lngLine, 8).Value)
                                If CDbl(lngwert) < CDbl(LagerMenge) Then
                                    MsgBox "Der Artikel (" & lstKasse.Column(0, l) & "/" & lstKasse.Column(1, l) & ") verf|fffd|gt nicht |fffd|ber den n|fffd|tigen Bestand von " & CDbl(lstKasse.Column(2, l)) & "! " & vbLf & vbLf & " Verf|fffd|gbar sind: " & lngwert, vbInformation, "Warenaugang"
                                    lngM = lngM + 1
                                End If
                            End If
                        End If
                    End If
                Else
                    If Not Sheets("Kassendaten").Cells(CDbl(lstKasse.Column(7, l)), 10) = "L" Then
                        If Not Sheets("Kassendaten").Cells(CDbl(lstKasse.Column(7, l)), 20) = "" Then
                            lngwert = CDbl(Worksheets("Lagerorte").Cells(CDbl(lngLine), 4).Value)
                            If CDbl(lngwert) < CDbl(LagerMenge) Then
                                MsgBox "Der Artikel (" & lstKasse.Column(0, l) & "/" & lstKasse.Column(1, l) & ") verf|fffd|gt nicht |fffd|ber den n|fffd|tigen Bestand von " & CDbl(lstKasse.Column(2, l)) & "! " & vbLf & vbLf & " Verf|fffd|gbar sind: " & lngwert, vbInformation, "Warenaugang"
                                lngM = lngM + 1
                            End If
                        Else
                            lngwert = CDbl(Sheets("Lager").Cells(lngLine, 8).Value)
                            If CDbl(lngwert) < CDbl(LagerMenge) Then
                                MsgBox "Der Artikel (" & lstKasse.Column(0, l) & "/" & lstKasse.Column(1, l) & ") verf|fffd|gt nicht |fffd|ber den n|fffd|tigen Bestand von " & CDbl(lstKasse.Column(2, l)) & "! " & vbLf & vbLf & " Verf|fffd|gbar sind: " & lngwert, vbInformation, "Warenaugang"
                                lngM = lngM + 1
                            End If
                        End If
                    End If
                End If
            End If
        Next
    End With
    If CDbl(lngM) > 0 Then
        If lngM = 1 Then
            stxt = MsgBox(lngM & " Artikel verf|fffd|gt nicht |fffd|ber den n|fffd|tigen Lagerbestand (bzw. auf dem Lagerplatz)! M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
        Else
            stxt = MsgBox(lngM & " Artikel verf|fffd|gten nicht |fffd|ber den n|fffd|tigen Lagerbestand (bzw. auf dem Lagerplatz)! M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
        End If
        If stxt = vbNo Then
              With lstKasse
                For l = 0 To .ListCount - 1
                    If .Selected(l) = True Then
                        LagerWert = lstKasse.Column(6, l)
                        LagerMenge = lstKasse.Column(2, l)
                        lngR = 0
                        lngwert = 0
                        lngLine = 0
                        For lngA = 2 To Sheets("Reservierungen").UsedRange.Rows.Count
                            If Sheets("Reservierungen").Cells(lngA, 18).Text = lstKasse.Column(6, l) Then
                                If Sheets("Reservierungen").Cells(lngA, 11) = "Auftrag" Then
                                    lngR = lngR + CDbl(Sheets("Reservierungen").Cells(lngA, 7))
                                End If
                            End If
                        Next lngA
                        If Not cboAuftragSuchen = "" Then
                            If cboart2 = "Auftrag" Then
                                If Not Sheets("Reservierungen").Cells(CDbl(lstKasse.Column(7, l)), 23) = "" Then
                                    With ThisWorkbook.Sheets("Lagerorte")
                                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                                        For i2 = 2 To UBound(arrTmpA2)
                                            If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(Sheets("Reservierungen").Cells(CDbl(lstKasse.Column(7, l)), 23).Text) Then
                                                lngLine = i2
                                            End If
                                        Next i2
                                    End With
                                    If Sheets("Lagerorte").Cells(lngLine, 4).Value < CDbl("0") Then
                                        lngwert = (CDbl(Sheets("Lagerorte").Cells(lngLine, 4).Value) + CDbl(lngR))
                                        If CDbl(lngwert) < CDbl(LagerMenge) Then
                                            lstKasse.Selected(l) = False
                                        End If
                                    End If
                                Else
                                    With ThisWorkbook.Sheets("Lager")
                                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                                        For i2 = 2 To UBound(arrTmpA2)
                                            If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(LagerWert) Then
                                                lngLine = i2
                                            End If
                                        Next i2
                                    End With
                                    If Sheets("Lager").Cells(lngLine, 8).Value < CDbl("0") Then
                                        lngwert = (CDbl(Sheets("Lager").Cells(lngLine, 8).Value) + CDbl(lngR))
                                        If CDbl(lngwert) < CDbl(LagerMenge) Then
                                            lstKasse.Selected(l) = False
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                Next
            End With
            Application.ScreenUpdating = True
            Exit Sub
        Else
            If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
            If frmKasse.cboart2 = "Angebot" Then Exit Sub
            frmKasseWA.Caption = frmKasse.cboart2 & " / " & frmKasse.txtRnr & " / " & Format(lbl_sum22.Caption, "currency")
            frmKasseWA.txt_VerwWA.SetFocus
            frmKasseWA.txt_Art.Value = "AUSBU"
            frmKasseWA.Check_VorG.Value = True
            frmKasseWA.lbl_VorG.Enabled = True
            frmKasseWA.lbl_VorG.Font.Bold = True
            frmKasseWA.Check_AusB.Value = True
            frmKasseWA.lbl_AusB.Font.Bold = True
            frmKasseWA.lbl_AusB.Enabled = True
            frmKasseWA.Check_REprint.Enabled = True
            frmKasseWA.lbl_REprint.Enabled = True
            frmKasseWA.Check_LSprint.Enabled = True
            frmKasseWA.lbl_LSprint.Enabled = True
            frmKasseWA.Show
        End If
        Application.ScreenUpdating = True
    Else
        If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
        If frmKasse.cboart2 = "Angebot" Then Exit Sub
        frmKasseWA.Caption = frmKasse.cboart2 & " / " & frmKasse.txtRnr & " / " & Format(lbl_sum22.Caption, "currency")
        frmKasseWA.txt_VerwWA.SetFocus
        frmKasseWA.Check_VorG.Value = True
        frmKasseWA.lbl_VorG.Enabled = True
        frmKasseWA.lbl_VorG.Font.Bold = True
        frmKasseWA.Check_AusB.Value = True
        frmKasseWA.lbl_AusB.Font.Bold = True
        frmKasseWA.lbl_AusB.Enabled = True
        frmKasseWA.Check_REprint.Enabled = True
        frmKasseWA.lbl_REprint.Enabled = True
        frmKasseWA.Check_LSprint.Enabled = True
        frmKasseWA.lbl_LSprint.Enabled = True
        frmKasseWA.txt_Art.Value = "AUSBU"
        frmKasseWA.Show
    End If
    Application.ScreenUpdating = True
    Exit Sub
weiter:
    With frmKasseWA
        .Check_VorG.Value = True
        .lbl_VorG.Enabled = True
        .lbl_VorG.Font.Bold = True
        .Check_AusB.Value = True
        .lbl_AusB.Font.Bold = True
        .lbl_AusB.Enabled = True
        .Check_REprint.Enabled = True
        .lbl_REprint.Enabled = True
        If frmKasse.cboart2 = "Barverkauf" Then
            .txt_Nummer.Enabled = False
            .cmd_REAUF.Enabled = False
        ElseIf frmKasse.cboart2 = "Intern" Then
            .txt_Nummer.Enabled = False
            .cmd_REAUF.Enabled = False
            .Check_REprint.Enabled = False
            .lbl_REprint.Enabled = False
            .txt_Nummer.Enabled = True
        Else
            .Check_LSprint.Enabled = True
            .lbl_LSprint.Enabled = True
        End If
        .txt_Art.Value = "AUSBU"
        .Caption = frmKasse.cboart2 & " / " & frmKasse.txtRnr & " / " & Format(frmKasse.lbl_sum22.Caption, "currency")
        .txt_VerwWA.SetFocus
        .Show
    End With
End Sub
    
Sub KasseWA()
    If Not cbo_Angebot = "" Then
        MsgBox "Angebot kann nicht verbucht werden!", , "Hinweis"
        Exit Sub
    End If
    If lstKasse.ListCount = 0 Then Exit Sub
    If cboAuftragSuchen.Value = "" Then
        Call Kasse
    Else
        Call Kasse2
    End If
End Sub

Private Sub cmdLschein_PDF_Click()
    If cboAuftragSuchen = "" Then Exit Sub
    frmKasseWA.Caption = "Lieferschein / .pdf " & frmKasse.cboart2 & " / " & frmKasse.txtRnr & " / " & Format(lbl_sum22.Caption, "currency")
    frmKasseWA.txt_Art.Value = "LSPDF"
    frmKasseWA.txt_VerwWA.SetFocus
    frmKasseWA.Check_VorG.Value = False
    frmKasseWA.Check_AusB.Value = False
    frmKasseWA.Check_REprint.Enabled = False
    frmKasseWA.lbl_REprint.Enabled = False
    frmKasseWA.lbl_LSprint.Enabled = True
    frmKasseWA.Check_LSprint.Value = True
    frmKasseWA.txt_WADatum.Enabled = False
    frmKasseWA.lbl_LSprint.Caption = "Lieferschein als .pdf"
    frmKasseWA.lbl_LSprint.Font.Bold = True
    frmKasseWA.txt_LSNr.Visible = True
    frmKasseWA.txt_Nummer.Enabled = False
    frmKasseWA.txt_Nummer.BackColor = &H8000000F
    frmKasseWA.txt_Nummer.BorderColor = &H808080
    frmKasseWA.txt_LSNr.BorderColor = &HFF&
    If Not txt_LSNr.Value = "" Then
        frmKasseWA.txt_LSNr.Value = CStr(txt_LSNr)
        frmKasseWA.txt_Nummer.Enabled = False
        frmKasseWA.cmd_REAUF.Enabled = False
    Else
        If Sheets("Daten").Range("F23").Value = "Nein" Or Sheets("Daten").Range("F23").Value = "" Then
            frmKasseWA.txt_LSNr.SetFocus
            frmKasseWA.cmd_REAUF.Caption = "Lieferschein Nr. = Aufragsnummer"
            frmKasseWA.cmd_REAUF.Visible = True
            frmKasseWA.cmd_REAUF.Enabled = True
        Else
            frmKasseWA.cmd_REAUF.Visible = False
        End If
    End If
    frmKasseWA.Show
End Sub

Private Sub cmdLschein_Click()
    If cboAuftragSuchen = "" Then Exit Sub
    frmKasseWA.Caption = "Lieferschein " & frmKasse.cboart2 & " / " & frmKasse.txtRnr & " / " & Format(lbl_sum22.Caption, "currency")
    frmKasseWA.txt_Art.Value = "LS"
    frmKasseWA.txt_VerwWA.SetFocus
    frmKasseWA.Check_VorG.Value = False
    frmKasseWA.Check_AusB.Value = False
    frmKasseWA.Check_REprint.Enabled = False
    frmKasseWA.lbl_REprint.Enabled = False
    frmKasseWA.lbl_LSprint.Enabled = True
    frmKasseWA.Check_LSprint.Value = True
    frmKasseWA.txt_WADatum.Enabled = False
    frmKasseWA.cmd_WACalenda.Enabled = False
    frmKasseWA.lbl_LSprint.Font.Bold = True
    frmKasseWA.txt_Nummer.Enabled = False
    frmKasseWA.txt_Nummer.BackColor = &H8000000F
    frmKasseWA.txt_Nummer.BorderColor = &H808080
    frmKasseWA.txt_LSNr.BorderColor = &HFF&
    If Not txt_LSNr.Value = "" Then
        frmKasseWA.txt_LSNr.Value = CStr(txt_LSNr)
        frmKasseWA.txt_Nummer.Enabled = False
        frmKasseWA.cmd_REAUF.Enabled = False
    Else
        If Sheets("Daten").Range("F23").Value = "Nein" Or Sheets("Daten").Range("F23").Value = "" Then
            frmKasseWA.txt_LSNr.SetFocus
            frmKasseWA.cmd_REAUF.Caption = "Lieferschein Nr. = Aufragsnummer"
            frmKasseWA.cmd_REAUF.Visible = True
            frmKasseWA.cmd_REAUF.Enabled = True
        Else
            frmKasseWA.cmd_REAUF.Visible = False
        End If
    End If
    frmKasseWA.Show
End Sub

Sub Lieferschein()
    On Error Resume Next
    If lstKasse.ListCount = 0 Then
        MsgBox "Kein(e) Artikel in der Liste!", _
        vbExclamation, "Lieferschein!"
        Exit Sub
    Else
        If cboart2.Value = "Auftrag" Or cboart2.Value = "Rechnung" Then
            If Not txt_KDID.Value = "" Then
                If Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 4) = "Firma" Then
                    frmContact.cboKDNr = "Firma " & Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 7)
                Else
                frmContact.cboKDNr = Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 7) & ", " & _
                                        Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 6)
                End If
            End If
            frmContact.cmd_invoiceprint.Visible = False
            frmContact.cmd_KDsave.Visible = False
            frmContact.comnext.Visible = False
            frmContact.comnext.Visible = False
            frmContact.txtdate.Visible = False
            frmContact.lblinfo.Visible = False
            frmContact.lblinfo2.Visible = False
            frmContact.Show
        Else
            lbl_status.Caption = "Diese Funktion ist f|fffd|r " & frmKasse.cboart2 & " nicht Verf|fffd|gbar!"
            lbl_status.BackColor = &HC0&
            lbl_status.BorderColor = &HC0&
        End If
    End If
End Sub

Private Sub cmdMengeaendern_Click() 'v1.44
    Dim l, lng, lngS As Long
    Dim strMsg, stgMenge As String
    Dim Wert1, Wert2 As Double
    On Error GoTo weiter
    ThisWorkbook.Activate
    If cbo_Angebot = "" Then
        If Not cboAuftragSuchen = "" Then
            If Not txt_RENr.Value = "" And Not txt_sperre.Value = "" Then
                If CLng(txt_sperre) = 0 Then
                    lbl_status.Caption = "Beleg ist abgeschlossen und Rechnung (" & txt_RENr & ") wurde bereits gedruckt!" & vbLf & "Rechnungsbeleg: " & CStr(txt_RENr)
                    lbl_status.BackColor = &HC0&
                    lbl_status.BorderColor = &HC0&
                    lbl_status.Visible = True
                    Exit Sub
                End If
            End If
        End If
    End If
    With lstKasse
        For l = 0 To .ListCount - 1
            If .Selected(l) Then
                stgMenge = frmKasse.lstKasse.Column(2, l)
                strMsg = InputBox("Bitte geben Sie eine neue Menge f|fffd|r den Artikel (" + frmKasse.lstKasse.Column(1, l) + ") an!", "Neue Menge")
                If strMsg = "" Then Exit Sub
                If Not IsNumeric(strMsg) Then
                    MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
                    Exit Sub
                End If
                If CDbl(strMsg) = 0 Then
                    MsgBox "Menge muss gr|fffd||fffd|er sein als 0!", , "Hinweis"
                    Exit Sub
                End If
                With ThisWorkbook.Worksheets("Reservierungen")
                    If Not cboAuftragSuchen = "" Or Not cbo_Angebot = "" Then
                        lng = frmKasse.lstKasse.Column(7, l) 'Zeileninfo
                        If Sheets("Reservierungen").Cells(lng, 28).Value = "VP" Then
                            Wert1 = CDbl(Sheets("Reservierungen").Cells(lng, 29))
                            Wert2 = CDbl(Sheets("Reservierungen").Cells(lng, 7))
                            Sheets("Reservierungen").Cells(lng, 7) = CDbl((strMsg) * Wert2) / Wert1
                            Sheets("Reservierungen").Cells(lng, 29) = CDbl(strMsg)
                        Else
                            Sheets("Reservierungen").Cells(lng, 7).Value = Sheets("Reservierungen").Cells(lng, 7).Value - _
                                                                 CDbl(lstKasse.Column(2, l)) 'alte Menge zurruecksetzen
                            Sheets("Reservierungen").Cells(lng, 7).Value = Sheets("Reservierungen").Cells(lng, 7).Value + _
                                                                 CDbl(strMsg) 'neue Menge hinzu buchen
                        End If
                    Else
                        lng = frmKasse.lstKasse.Column(7, l) 'Zeileninfo
                        If Sheets("Kassendaten").Cells(lng, 21).Value = "VP" Then
                            Wert1 = CDbl(Sheets("Kassendaten").Cells(lng, 22))
                            Wert2 = CDbl(Sheets("Kassendaten").Cells(lng, 7))
                            Sheets("Kassendaten").Cells(lng, 7) = CDbl((strMsg) * Wert2) / Wert1
                            Sheets("Kassendaten").Cells(lng, 22) = CDbl(strMsg)
                        Else
                            Sheets("Kassendaten").Cells(lng, 7).Value = Sheets("Kassendaten").Cells(lng, 7).Value - _
                                                                 CDbl(lstKasse.Column(2, l)) 'alte Menge zurruecksetzen
                            Sheets("Kassendaten").Cells(lng, 7).Value = Sheets("Kassendaten").Cells(lng, 7).Value + _
                                                                 CDbl(strMsg) 'neue Menge hinzu buchen
                        End If
                    End If
                End With
                lngS = lngS + 1
            End If
        Next
    End With
    If cboart2 = "Angebot" Then
        Call SuchenAngebotNeu 'Auftrag in Listbox aktualisieren
    ElseIf cboart2 = "Auftrag" Then
        Call SuchenAuftragV2 'Angebot in Listbox aktualisieren
    Else
        Call SuchenKasseV2
    End If
    If lngS > 1 Then
        lbl_status.Caption = " Die Mengen wurde erfolgreich aktualisiert / gespeichert!"
    Else
        lbl_status.Caption = " Die Menge wurde von " & stgMenge & " auf " & strMsg & " erfolgreich aktualisiert / gespeichert!"
    End If
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    lbl_status.Visible = True
    Exit Sub
weiter:
    lbl_status.Caption = "Es ist leider ein Fehler passiert. Bitte pr|fffd|fen Sie Ihr Lager!"
    lbl_status.BackColor = &HC0&
    lbl_status.BorderColor = &HC0&
    lbl_status.Visible = True
End Sub

Private Sub cmdMloeschen_Click()
    Dim strNr As String
    Dim Istlng, lng As Long
    On Error Resume Next
    If cboart2 = "Auftrag" Then
        If txt_sperre.Value = 0 And Not txt_RENr.Value = "" Then
            lbl_status.Caption = "Beleg ist abgeschlossen und Rechnung (" & txt_RENr & ") wurde bereits gedruckt!" & vbLf & "Rechnungsbeleg: " & CStr(txt_RENr)
            lbl_status.Visible = True
            Exit Sub
        ElseIf txt_sperre.Value = 1 And Not txt_RENr = "" Then
            ThisWorkbook.Sheets("Daten").Activate
            Range("A65536").End(xlUp).Offset(1, 0).Select
            ActiveCell.Offset(0, 0).Value = Date
            ActiveCell.Offset(0, 1).Value = "Beleg: " & frmKasse.txt_RENr & " wurde bearbeitet! / Eine Pos. wurde gel|fffd|scht!"
            ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
            ThisWorkbook.Sheets("Center").Activate
        End If
    End If
    lng = 0
    For Istlng = 0 To lstKasse.ListCount - 1
        If lstKasse.Selected(Istlng) = True Then
            lng = lng + 1
        End If
    Next Istlng
    If CLng(lstKasse.ListCount) = lng Then
        Call klickStorno
        Exit Sub
    End If
    If Not frmKasse.cboart2 = "Auftrag" And Not frmKasse.cboart2 = "Angebot" Then
        Call loeschen1
        cboart2.Clear
        UserForm_Initialize
    ElseIf frmKasse.cboart2 = "Auftrag" Then
        Call loeschen2
        Call SuchenAuftragV2
    ElseIf frmKasse.cboart2 = "Angebot" Then
        Call loeschen2
        Call SuchenAngebotNeu
    End If
    lbl_status.Caption = " . . Pos. wurde gel|fffd|scht! . . "
    lbl_status.Visible = True
    Application.Wait (Now + TimeValue("00:00:02"))
    lbl_status.Visible = False
End Sub

Private Sub cmdWEschein_Click()
    On Error Resume Next
    If lstKasse.ListCount = 0 Then
        MsgBox "Es befinden sich keine Artikel in der Liste!", _
        vbExclamation, "WA - Schein!"
        Exit Sub
    Else
        Call WAschein
    End If
End Sub

Private Sub comAStorno_Click()
    Call klickStorno
End Sub

Sub klickStorno()
    Dim strMsg As String
    If frmKasse.lstKasse.ListCount = 0 Then Exit Sub
    strMsg = MsgBox("M|fffd|chten Sie den " + cboart2 + ": " + txtRnr + " stornieren?", vbYesNo, cboart2 & ": " + txtRnr)
    If strMsg = vbYes Then
        lbl_status.Caption = " . . Aufrag: " & txtRnr & " wurde erfogreich storniert! . . "
        lbl_status.Visible = True
        With Worksheets("Reservierungen")
            If .FilterMode Then .ShowAllData
        End With
        With Worksheets("Lager")
            If .FilterMode Then .ShowAllData
        End With
        Call ASorno
        comAStorno.Visible = False
        Call leeren
        lbl_datensaetze.Caption = ""
    Else
        lbl_status.Visible = False
        Exit Sub
    End If
End Sub

Private Sub cmdKasseaktive_Click()
    If cmdKasseaktive.Caption = "Kasse (leer)" Then Exit Sub
    frmKasse.txtRnr.Value = ""
    cboAuftragSuchen.ListIndex = -1
    cbo_Angebot.ListIndex = -1
    cmd_umWAngebot.Visible = False
    Call SuchenKasseV2
    cmdMengeaendern.Visible = False
    cmdMloeschen.Visible = False
    comAStorno.Visible = False
    cmdMengeaendern.Visible = False
End Sub

Private Sub cmdADrucken_Click()
    txt_OpAngebot.Value = "Print"
    frmContact.comnext.Caption = "Drucken"
    frmContact.Caption = "Angebot Drucken"
    Call Angebot
End Sub

Private Sub cmdPDFprint_Click()
    txt_OpAngebot.Value = "PDF"
    frmContact.comnext.Caption = "Speichern (.pdf)"
    frmContact.Caption = "Angebot als PDF"
    Call Angebot
End Sub

Sub Angebot()
    On Error Resume Next
    ThisWorkbook.Activate
    If cboart2 = "Intern" Then
        MsgBox "Es kann kein Angebot gedruckt werden." & vbLf & vbLf & "Grund: Intern", , "Hinweis"
        Exit Sub
    End If
    If lstKasse.ListCount = 0 Then
        MsgBox "Kein(e) Artikel in der Liste!", _
        vbExclamation, "Angebot"
        Exit Sub
    Else
        If cboart2.Text = "Angebot" Then
            If Not txt_KDID.Value = "" Then
                If Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 4) = "Firma" Then
                    frmContact.cboKDNr = "Firma " & Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues).Row, 7)
                Else
                    frmContact.cboKDNr = Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 7) & ", " & _
                                        Worksheets("Kunden").Cells(Worksheets("Kunden").Range("A:A").Find(txt_KDID.Text, LookIn:=xlValues, MatchCase:=True).Row, 6)
                End If
            End If
            frmContact.cmd_invoiceprint.Visible = False
            frmContact.cmd_KDsave.Visible = False
            frmContact.comnext.Visible = True
            frmContact.cmdnextL.Visible = False
            frmContact.txtdate.Visible = True
            frmContact.lblinfo.Visible = True
            frmContact.lblinfo2.Visible = True
            frmContact.Show
        Else
            MsgBox "Diese Funktion ist f|fffd|r " + cboart2 + " nicht Verf|fffd|gbar! Verwenden Sie bitte Angebot.", , "Hinweis"
            txt_OpAngebot.Value = ""
        End If
    End If
End Sub

Private Sub cmdexit_Click()
    frmLager.txtWG.Value = ""
    Unload frmKasse
End Sub

Private Sub lstKasse_change()
    Dim lngIndex, n As Long
    lbl_status.Visible = False
    If Not txt_Fast.Value = "" Then
        Exit Sub
    Else
        Call SumKasseV2
    End If
    With lstKasse
        For lngIndex = 0 To .ListCount - 1
            If .Selected(lngIndex) Then
                n = n + 1
            End If
        Next lngIndex
    End With
    If n > 0 Then
        cmdMloeschen.Visible = True
    Else
        cmdMloeschen.Visible = False
    End If
End Sub

Private Sub txtMenge_AfterUpdate()
    If Not lbl_VKPreisKasse.Caption = "" Then txtRabatt.Locked = False
    Call NettogesRechnen
End Sub

Private Sub NettogesRechnen()
    On Error Resume Next
    If txtMenge.Value = "" Then Exit Sub
    If Not txt_VPEinheit.Value = "" Then
        If txtRabatt.Value = "" Then
            lbl_Nettoges.Caption = Format(CDbl(lbl_VKPreisKasse.Caption) * txtMenge.Value, "currency")
        Else
            Call Rabatt
        End If
    Else
        If txtRabatt.Value = "" Then
            lbl_Nettoges.Caption = Format(CDbl(lbl_VKPreisKasse.Caption) * txtMenge.Value, "currency")
        Else
            Call Rabatt
        End If
    End If
End Sub

Sub Rabatt() '1.44
    Dim strR As String
    Dim lng As Long
    On Error Resume Next
    strR = txtRabatt.Text
    For lng = Len(strR) To 1 Step -1
        If IsNumeric(Mid(strR, lng, 1)) = True Then
            strR = Left(strR, lng)
            Exit For
        End If
    Next lng
    If txtRabatt.Value = "" Then
        Call NettogesRechnen
    Else
        txtrabattrechnen.Value = Format((Format(CDbl(lbl_VKPreisKasse.Caption), "currency") * CDbl(txtMenge.Value)) - Format(CDbl(lbl_VKPreisKasse.Caption), "currency") * CDbl(txtMenge.Value) * strR / 100) ' * Format(CDbl(txtRabatt.Value), "currency")
        lbl_Nettoges.Caption = Format(CDbl(txtrabattrechnen.Value), "currency")
    End If
End Sub

Private Sub txtRabatt_AfterUpdate()
    Dim wert As Integer
    On Error Resume Next
    
    If lbl_bezeichnung.Caption = "" Then Exit Sub
    If txtRabatt.Value = "" Then Exit Sub
    If txtMenge.Value = "" Then
        txtRabatt.Value = ""
        txtMenge.SetFocus
        MsgBox "Bitte geben Sie zuerst eine Menge an", vbOKOnly, "Hinweis"
        Exit Sub
    End If
    If txtRabatt.Value = "" Then Exit Sub
    
    wert = CInt(txtRabatt.Text)
    If wert > 100 Then
        MsgBox "Bitte w|fffd|hlen Sie ein Bereich zwischen 1% und 99%", , "Hinweis"
        txtRabatt.Text = ""
        txtRabatt.SetFocus
    Else
        txt_Rabatt2 = CDbl(txtRabatt.Value)
        txtRabatt.Value = txt_Rabatt2.Value & "%"
    End If
End Sub

Private Sub cmdchanel_Click()
    On Error Resume Next
    frmLager.txtWG.Value = ""
        frmLager.txt_WGA.Value = ""
    If txtArtikelnummerSicherung.Value = "" Then
        frmLager.txtWG.Value = ""
        frmLager.txt_Kassenart.Value = ""
        Unload frmKasse
        frmLager.txt_item.SetFocus
        Exit Sub
    Else
        frmLager.txt_item.Value = txtArtikelnummerSicherung.Value
        frmLager.Asuchen
        Unload frmKasse
    End If
End Sub

Sub CheckKasse()
    Dim lngIndex, lngLine, stxt, lngZ As Long
    Dim strArticle, LagerWert As String
    Dim Last_Row, arrTmpA, arrTmpB, i As Long
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2 As Long
    Dim objLines, objItems As Collection
    Set objLines = New Collection
    Set objItems = New Collection
    On Error Resume Next
    ThisWorkbook.Activate
    Worksheets("Reservierungen").Columns("L:L").NumberFormat = "0.0%"
    Worksheets("Kassendaten").Columns("L:L").NumberFormat = "0.0%"
    
    If Not cboart2 = "Intern" Then
        If txt_KDID.Value = "" Then
            stxt = MsgBox("M|fffd|chten Sie einen Kunden ausw|fffd|hlen?", vbYesNo, "Kunde")
            If stxt = vbYes Then
                frmContact.cboAnsp.Visible = False
                frmContact.txtdate.Visible = False
                frmContact.lblinfo.Visible = False
                frmContact.cmd_invoiceprint.Visible = False
                frmContact.cmdnextL.Visible = False
                frmContact.lblMitarbeiter.Visible = False
                frmContact.cmd_KDsave.Visible = True
                frmContact.lblinfo2.Visible = False
                frmContact.Show
            End If
        End If
    End If
    With Worksheets("Warenausgang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Lager")
        For lngIndex = 0 To lstKasse.ListCount - 1
            If lstKasse.Selected(lngIndex) Then
                strArticle = lstKasse.List(lngIndex, 6)
                LagerWert = ""
                lngLine = 0
                With ThisWorkbook.Sheets("Lager")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strArticle) Then
                            lngLine = i
                        End If
                    Next i
                End With
                If Not cboAuftragSuchen = "" Then
                    LagerWert = Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 23)
                Else
                    LagerWert = Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 20)
                End If
                If Not LagerWert = "" Then
                    With ThisWorkbook.Sheets("Lagerorte")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(LagerWert) Then
                                lngZ = i2
                            End If
                        Next i2
                    End With
                    If Not cboAuftragSuchen = "" Then
                        With ThisWorkbook.Worksheets("Lagerorte")
                            If Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 28) = "VP" Then
                                .Cells(lngZ, 4).Value = .Cells(lngZ, 4).Value - CDbl(Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 7))
                            Else
                                .Cells(lngZ, 4).Value = .Cells(lngZ, 4).Value - CDbl(lstKasse.Column(2, lngIndex))
                            End If
                        End With
                        With ThisWorkbook.Worksheets("Lager")
                            .Cells(lngLine, 23).Value = Date
                            .Cells(lngLine, 24).Value = Format(Time, "hh:mm:ss")
                            If Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 28) = "VP" Then
                                .Cells(lngLine, 25).Value = .Cells(lngLine, 25).Value + CDbl(Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 7))
                            Else
                                .Cells(lngLine, 25).Value = .Cells(lngLine, 25).Value + CDbl(lstKasse.List(lngIndex, 2))
                            End If
                        End With
                    Else
                        With ThisWorkbook.Worksheets("Lagerorte")
                            If Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 21) = "VP" Then
                                .Cells(lngZ, 4).Value = CDbl(.Cells(lngZ, 4).Value) - CDbl(Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 7))
                            Else
                                .Cells(lngZ, 4).Value = CDbl(.Cells(lngZ, 4).Value) - CDbl(lstKasse.Column(2, lngIndex))
                            End If
                        End With
                        With ThisWorkbook.Worksheets("Lager")
                            .Cells(lngLine, 23).Value = Date
                            .Cells(lngLine, 24).Value = Format(Time, "hh:mm:ss")
                            If Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 21) = "VP" Then
                                .Cells(lngLine, 25).Value = CDbl(.Cells(lngLine, 25).Value) + CDbl(Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 7))
                            Else
                                .Cells(lngLine, 25).Value = CDbl(.Cells(lngLine, 25).Value) + CDbl(lstKasse.List(lngIndex, 2))
                            End If
                        End With
                    End If
                Else
                    If Not cboAuftragSuchen = "" Then
                        If lngLine > 0 Then
                            If Not lstKasse.List(lngIndex, 2) = "" Then
                               .Cells(lngLine, 23).Value = Date
                               .Cells(lngLine, 24).Value = Format(Time, "hh:mm:ss")
                               If Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 28) = "VP" Then
                                   .Cells(lngLine, 25).Value = CDbl(.Cells(lngLine, 25).Value) + _
                                                              CDbl(Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 7))
                                   .Cells(lngLine, 8).Value = CDbl(.Cells(lngLine, 8).Value) - _
                                                             CDbl(Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 7))
                               Else
                                   .Cells(lngLine, 25).Value = CDbl(.Cells(lngLine, 25).Value) + _
                                                             CDbl(lstKasse.List(lngIndex, 2))
                                   .Cells(lngLine, 8).Value = CDbl(.Cells(lngLine, 8).Value) - _
                                                             CDbl(lstKasse.List(lngIndex, 2))
                               End If
                            End If
                            objLines.Add lstKasse.List(lngIndex, 1)
                            objItems.Add CStr(lngIndex)
                        End If
                    Else
                        If lngLine > 0 Then
                            If Not lstKasse.List(lngIndex, 2) = "" Then
                               .Cells(lngLine, 23).Value = Date
                               .Cells(lngLine, 24).Value = Format(Time, "hh:mm:ss")
                               If Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 21) = "VP" Then
                                   .Cells(lngLine, 25).Value = CDbl(.Cells(lngLine, 25).Value) + _
                                                              CDbl(Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 7))
                                   .Cells(lngLine, 8).Value = CDbl(.Cells(lngLine, 8).Value) - _
                                                             CDbl(Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 7))
                               Else
                                   .Cells(lngLine, 25).Value = CDbl(.Cells(lngLine, 25).Value) + _
                                                             CDbl(lstKasse.List(lngIndex, 2))
                                   .Cells(lngLine, 8).Value = CDbl(.Cells(lngLine, 8).Value) - _
                                                             CDbl(lstKasse.List(lngIndex, 2))
                               End If
                            End If
                            objLines.Add lstKasse.List(lngIndex, 1)
                            objItems.Add CStr(lngIndex)
                        End If
                    End If
                End If
            End If
        Next
    End With
    Application.ScreenUpdating = True
    If frmKasse.cboart2 = "Barverkauf" Or frmKasse.cboart2 = "Rechnung" Then
        If frmKasseWA.Check_REprint.Value = True Then
            frmKasse.Invoice
        End If
    End If
End Sub

Sub Kasse() 'v1.44
    Dim lngZeile, lngIndex, lngR, lngL As Long
    Dim strMsg, strRE, strBE As String
    Dim dblSum As Double
    On Error Resume Next
    ThisWorkbook.Activate
    If cboart2 = "Barverkauf" Then
        strMsg = MsgBox("Barverkauf wirklich buchen?", vbYesNo, "Warenausgang")
    Else
        strMsg = MsgBox(cboart2 + " " + txtRnr.Text + " wirklich buchen?", vbYesNo, "Warenausgang")
    End If
    If strMsg = vbNo Then Exit Sub
    Call CheckKasse
    dblSum = lbl_sum22
    If Not Sheets("Daten").Range("D23") = "Auswahl2" Then
        If Not Sheets("Daten").Range("D23") = "Nein" Or Not Sheets("Daten").Range("D23") = "" Then
            lngL = CDbl(Sheets("Daten").Range("D25")) + 1
            strRE = CStr(Sheets("Daten").Range("D26"))
            If CStr(frmKasseWA.txt_Nummer) = CStr(Sheets("Daten").Range("D24")) & Format(lngL, strRE) Then
                Sheets("Daten").Range("D25") = "'" & Format(lngL, strRE)
            End If
        End If
    End If
    Application.ScreenUpdating = False
    ThisWorkbook.Activate
    Sheets("Warenausgang").Activate
    lngZeile = Worksheets("Warenausgang").Cells(Rows.Count, 1).End(xlUp).Row 'ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    With ThisWorkbook.Worksheets("Warenausgang")
        For lngIndex = 0 To lstKasse.ListCount - 1
            lngZeile = lngZeile + 1
            If Sheets("Daten").Range("D23") = "Auswahl 1" Then
                lngR = CDbl(Sheets("Daten").Range("D25")) + 1
                strRE = Sheets("Daten").Range("D26")
                Sheets("Warenausgang").Cells(lngZeile, 2) = "'" & frmKasseWA.txt_Nummer
                strBE = frmKasseWA.txt_Nummer
            Else
                If cboart2 = "Barverkauf" Then
                    Sheets("Warenausgang").Cells(lngZeile, 2).Value = "B" & ThisWorkbook.Sheets("Warenausgang").Range("B1").Text & Format(ThisWorkbook.Sheets("Warenausgang").Range("B2") + 1, "000000")
                    strBE = "B" & ThisWorkbook.Sheets("Warenausgang").Range("B1").Text & Format(ThisWorkbook.Sheets("Warenausgang").Range("B2") + 1, "000000")
                End If
            End If
            Sheets("Warenausgang").Cells(lngZeile, 1) = cboart2.Text 'Art
            Sheets("Warenausgang").Cells(lngZeile, 3) = "'" & lstKasse.Column(0, lngIndex)
            Sheets("Warenausgang").Cells(lngZeile, 4) = lstKasse.Column(1, lngIndex) 'Bezeichnung
            If Not Worksheets("Kassendaten").Cells(CLng(lstKasse.Column(7, lngIndex)), 21) = "" Then 'Wenn VP
                Sheets("Warenausgang").Cells(lngZeile, 5) = Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 22)
                Sheets("Warenausgang").Cells(lngZeile, 26) = CDbl(Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 7))
            Else
                Sheets("Warenausgang").Cells(lngZeile, 5) = lstKasse.Column(2, lngIndex) 'Menge
            End If
            Sheets("Warenausgang").Cells(lngZeile, 6) = lstKasse.Column(5, lngIndex) 'MWST
            If Not Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9) = "" Then
                Sheets("Warenausgang").Cells(lngZeile, 7) = (Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9))) * lstKasse.Column(2, lngIndex)
            Else
                Sheets("Warenausgang").Cells(lngZeile, 7) = CDbl(lstKasse.Column(4, lngIndex) * lstKasse.Column(2, lngIndex))
            End If
            Sheets("Warenausgang").Cells(lngZeile, 8) = txt_WADatum.Value 'Datum
            Sheets("Warenausgang").Cells(lngZeile, 9) = Format(Time, "hh:mm:ss")
            Sheets("Warenausgang").Cells(lngZeile, 11) = Format(Date, "mmmm")
            Sheets("Warenausgang").Cells(lngZeile, 12) = Format(Date, "yyyy")
            If Not Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9) = "" Then
                Sheets("Warenausgang").Cells(lngZeile, 13) = Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9))
                Sheets("Warenausgang").Cells(lngZeile, 10) = "Rabatt: " & Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9) * 100 & "%"
            Else
                Sheets("Warenausgang").Cells(lngZeile, 13) = CDbl(Sheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13))
            End If
            Sheets("Warenausgang").Cells(lngZeile, 14) = lstKasse.Column(6, lngIndex) 'ID
            Sheets("Warenausgang").Cells(lngZeile, 15) = frmKasse.txt_VerZweWA.Value  'Zweck
            If chkoMwSt = True Then
                Sheets("Warenausgang").Cells(lngZeile, 16) = CDbl(Format(0, "currency"))
            Else
                If Not Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9) = "" Then
                    If lstKasse.Column(2, lngIndex) = "" Then
                        Sheets("Warenausgang").Cells(lngZeile, 16) = ((Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9))) * 1) * Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 12)
                    Else
                        Sheets("Warenausgang").Cells(lngZeile, 16) = ((Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 9))) * lstKasse.Column(2, lngIndex)) * Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 12)
                    End If
                Else
                    If lstKasse.Column(2, lngIndex) = "" Then
                        Sheets("Warenausgang").Cells(lngZeile, 16) = (CDbl(Sheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13)) * CDbl(Format(lstKasse.Column(5, lngIndex), "#.#0,0"))) * 1
                    Else
                        Sheets("Warenausgang").Cells(lngZeile, 16) = (CDbl(Sheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 13)) * CDbl(Format(lstKasse.Column(5, lngIndex), "#.#0,0"))) * CDbl(lstKasse.Column(2, lngIndex))
                    End If
                End If
            End If
            If Worksheets("Kassendaten").Cells(CLng(Sheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex))), 18) = "" Then
                Sheets("Warenausgang").Cells(lngZeile, 17) = txt_KDID.Value
            Else
                Sheets("Warenausgang").Cells(lngZeile, 17) = Worksheets("Kassendaten").Cells(CLng(Sheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex))), 18) 'Kunden ID
            End If

            If Not Sheets("Daten").Range("B22").Value = "" Then
                Sheets("Warenausgang").Cells(lngZeile, 18).Value = Sheets("Daten").Range("B22").Value
            Else
                If Sheets("Daten").Range("B5").Value = "True" Then
                    Sheets("Warenausgang").Cells(lngZeile, 18).Value = Sheets("Daten").Range("B24").Value
                End If
            End If
            Sheets("Warenausgang").Cells(lngZeile, 19) = txt_KostenWA
            Sheets("Warenausgang").Cells(lngZeile, 20) = "'" & Worksheets("Kassendaten").Cells(lstKasse.Column(7, lngIndex), 19) 'Serien- Nr.
        Next
        If cboart2.Value = "Barverkauf" Then
            ThisWorkbook.Sheets("Warenausgang").Range("B2") = CDbl(ThisWorkbook.Sheets("Warenausgang").Range("B2").Text) + 1
        End If
    End With
    Call Listeloeschen
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    MsgBox "Abgang wurde in Warenausgang gebucht!" & vbLf & "Beleg: " & strBE & vbLf & "Betrag: " & Format(dblSum, "currency"), vbOKOnly, "Warenausgang"
    Call AnsichtLager
End Sub

Sub Kasse2() 'v1.44
    Dim lngZeile, lngIndex, lngL, lngR, lngNr As Long
    Dim lngSum As Double
    Dim strMsg, strRE, strLS As String
    On Error Resume Next
    ThisWorkbook.Activate
    strMsg = MsgBox(cboart2 + " " + txtRnr.Text + " wirklich buchen?", vbYesNo, "Warenausgang")
    If strMsg = vbNo Then Exit Sub
    Call CheckKasse
    lngSum = frmKasse.lbl_sum22.Caption
    If Not Sheets("Daten").Range("D23") = "Auswahl2" Then
        If Not Sheets("Daten").Range("D23") = "Nein" Or Not Sheets("Daten").Range("D23") = "" Then
            lngL = CDbl(Sheets("Daten").Range("D25")) + 1
            strRE = CStr(Sheets("Daten").Range("D26"))
            If CStr(frmKasseWA.txt_Nummer) = CStr(Sheets("Daten").Range("D24")) & Format(lngL, strRE) Then
                Sheets("Daten").Range("D25") = "'" & Format(lngL, strRE)
            End If
        End If
    End If
    If frmKasseWA.Check_LSprint.Value = True Then
        If Sheets("Daten").Range("F23") = "Auswahl1" Then
            If Not Sheets("Daten").Range("F23") = "Nein" Then
                lngL = CDbl(Sheets("Daten").Range("F25")) + 1
                strLS = CStr(Sheets("Daten").Range("F26"))
                If CStr(frmKasseWA.txt_LSNr) = CStr(Sheets("Daten").Range("F24") & Format(CDbl(lngL), strLS)) Then
                    Sheets("Daten").Range("F25") = "'" & Format(lngL, strLS)
                End If
            Else
                GoTo weiterLS:
            End If
        End If
    End If
weiterLS:
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Warenausgang").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Warenausgang").Activate
    With lstKasse
        For lngIndex = 0 To .ListCount - 1
            If .Selected(lngIndex) Then
                lngZeile = lngZeile + 1
                Sheets("Warenausgang").Cells(lngZeile, 2) = "'" & frmKasse.txt_RENr
                Sheets("Warenausgang").Cells(lngZeile, 1) = "Auftrag" 'Art
                Sheets("Warenausgang").Cells(lngZeile, 3) = "'" & lstKasse.Column(0, lngIndex) 'Artikelnummer
                Sheets("Warenausgang").Cells(lngZeile, 4) = lstKasse.Column(1, lngIndex) 'Beschreibung
                If Not Worksheets("Reservierungen").Cells(CLng(lstKasse.Column(7, lngIndex)), 28) = "" Then 'Wenn VP
                    Sheets("Warenausgang").Cells(lngZeile, 5) = Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 29)
                    Sheets("Warenausgang").Cells(lngZeile, 26) = CDbl(Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 7))
                Else
                    Sheets("Warenausgang").Cells(lngZeile, 5) = lstKasse.Column(2, lngIndex) 'Menge
                End If
                Sheets("Warenausgang").Cells(lngZeile, 6) = lstKasse.Column(5, lngIndex) 'MWST
                If Not Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9) = "" Then
                    Sheets("Warenausgang").Cells(lngZeile, 7) = (Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9))) * lstKasse.Column(2, lngIndex)
                Else
                    Sheets("Warenausgang").Cells(lngZeile, 7) = CDbl(lstKasse.Column(4, lngIndex) * lstKasse.Column(2, lngIndex)) 'Preis
                End If
                Sheets("Warenausgang").Cells(lngZeile, 8) = txt_WADatum.Value 'Datum
                Sheets("Warenausgang").Cells(lngZeile, 9) = Format(Time, "hh:mm:ss")
                Sheets("Warenausgang").Cells(lngZeile, 11) = Format(Date, "mmmm")
                Sheets("Warenausgang").Cells(lngZeile, 12) = Format(Date, "yyyy")
                If Not Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9) = "" Then
                    Sheets("Warenausgang").Cells(lngZeile, 13) = Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9))
                    Sheets("Warenausgang").Cells(lngZeile, 10) = "Rabatt: " & Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9) * 100 & "%"
                Else
                    Sheets("Warenausgang").Cells(lngZeile, 13) = CDbl(Sheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13))
                End If
                Sheets("Warenausgang").Cells(lngZeile, 14) = lstKasse.Column(6, lngIndex) 'ID
                Sheets("Warenausgang").Cells(lngZeile, 15) = frmKasse.txt_VerZweWA.Value  'Zweck
                '####MwSt
                If chkoMwSt = True Then
                    Sheets("Warenausgang").Cells(lngZeile, 16) = CDbl(Format(0, "currency"))
                Else
                    If Not Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9) = "" Then
                        If lstKasse.Column(2, lngIndex) = "" Then
                            Sheets("Warenausgang").Cells(lngZeile, 16) = ((Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9))) * 1) * Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 12)
                        Else
                            Sheets("Warenausgang").Cells(lngZeile, 16) = ((Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) - (Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13) * Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 9))) * lstKasse.Column(2, lngIndex)) * Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 12)
                        End If
                    Else
                        If lstKasse.Column(2, lngIndex) = "" Then
                            Sheets("Warenausgang").Cells(lngZeile, 16) = (CDbl(Sheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13)) * CDbl(Format(lstKasse.Column(5, lngIndex), "#.#0,0"))) * 1
                        Else
                            Sheets("Warenausgang").Cells(lngZeile, 16) = (CDbl(Sheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 13)) * CDbl(Format(lstKasse.Column(5, lngIndex), "#.#0,0"))) * CDbl(lstKasse.Column(2, lngIndex))
                        End If
                    End If
                End If

                If Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 19) = "" Then
                    Sheets("Warenausgang").Cells(lngZeile, 17) = txt_KDID.Value
                Else
                    Sheets("Warenausgang").Cells(lngZeile, 17) = Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 19) 'Kunden ID
                End If
                If Not Sheets("Daten").Range("B22").Value = "" Then
                    Sheets("Warenausgang").Cells(lngZeile, 18).Value = Sheets("Daten").Range("B22").Value
                Else
                    If Sheets("Daten").Range("B5").Value = "True" Then
                        Sheets("Warenausgang").Cells(lngZeile, 18).Value = Sheets("Daten").Range("B24").Value
                    End If
                End If
                Sheets("Warenausgang").Cells(lngZeile, 19) = txt_KostenWA
                Sheets("Warenausgang").Cells(lngZeile, 20) = "'" & Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 20) 'Serien- Nr.
                Sheets("Warenausgang").Cells(lngZeile, 21) = Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 23)
                If CLng(Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 15)) > 0 Then
                    Sheets("Warenausgang").Cells(lngZeile, 24) = "Ja"
                End If
                If CLng(Worksheets("Reservierungen").Cells(lstKasse.Column(7, lngIndex), 16)) > 0 Then
                    Sheets("Warenausgang").Cells(lngZeile, 25) = "Ja"
                End If
                If Not frmKasse.txt_LSNr = "" Then
                    Sheets("Warenausgang").Cells(lngZeile, 22) = "'" & CStr(frmKasse.txt_LSNr)
                Else
                    If Not frmKasseWA.txt_LSNr = "" Then
                        Sheets("Warenausgang").Cells(lngZeile, 22) = "'" & CStr(frmKasseWA.txt_LSNr)
                    End If
                End If
                If Not CStr(frmKasseWA.txt_Nummer) = CStr(frmKasse.txtRnr) Then
                    Sheets("Warenausgang").Cells(lngZeile, 23) = "'" & frmKasse.txtRnr
                End If
            End If
        Next
    End With
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call Listeloeschen2
    ActiveWorkbook.Save
    MsgBox "Abgang wurde in Warenausgang gebucht!" & vbLf & "Betrag: " & Format(lngSum, "currency"), vbOKOnly, "Warenausgang"
    txtRnr.Value = ""
End Sub

Sub PGruppe()
    Dim zlng, lngZeile As Long
    On Error Resume Next
    Call SuchenZeile
    If Not Sheets("Kassendaten").Range("R1").Value = "" Then
        Sheets("StatistikGruppen").Activate
        lngZeile = Worksheets("StatistikGruppen").Cells(Rows.Count, 1).End(xlUp).Row + 1
        zlng = txtsgruppen.Value
        If txtsgruppen.Value = "" Then
            Worksheets("StatistikGruppen").Cells(lngZeile, 1).Value = Sheets("Daten").Range("B21")
            Worksheets("StatistikGruppen").Cells(lngZeile, 2).Value = Sheets("Daten").Range("B22")
            Worksheets("StatistikGruppen").Cells(lngZeile, 3).Value = Sheets("Daten").Range("B23")
            Worksheets("StatistikGruppen").Cells(lngZeile, 4).Value = Format(Date, "DD.MM.YYYY")
        Else
            Sheets("StatistikGruppen").Cells(zlng, 2) = CDbl(Sheets("StatistikGruppen").Cells(zlng, 2)) + CDbl(Sheets("Daten").Range("B22"))
            Sheets("StatistikGruppen").Cells(zlng, 3) = CDbl(Sheets("StatistikGruppen").Cells(zlng, 3)) + CDbl(Sheets("Daten").Range("B23"))
            Sheets("StatistikGruppen").Cells(zlng, 4) = Format(Date, "DD.MM.YYYY")
        End If
        Sheets("Center").Activate
    End If
End Sub

Sub SuchenZeile()
    Dim xrow As String
    On Error Resume Next
    xrow = xFind(ActiveWorkbook.Name, "StatistikGruppen", Sheets("Daten").Range("B21"), "A:A")
    If xrow = False Then
        txtsgruppen.Value = ""
    Else
        txtsgruppen.Value = xrow
    End If
End Sub

Sub ASorno() 'v1.43
    On Error Resume Next
    ThisWorkbook.Activate
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    If frmKasse.cboart2 = "Angebot" Then
        Call ListeloeschenAll
        frmLager.Maskeclear
        frmLager.cboArtikelnummer.SetFocus
        frmKasse.cbo_Angebot.ListIndex = -1
        frmKasse.cboart2.ListIndex = -1
        frmKasse.txtRnr.Value = ""
        ActiveWorkbook.Save
        Call RAngebote
        Exit Sub
    End If
    Call ListeloeschenAll
    ActiveWorkbook.Save
    frmLager.Maskeclear
    frmKasse.cboart2.ListIndex = -1
    frmKasse.cboAuftragSuchen.Clear
    frmKasse.txtRnr.Value = ""
    Call ListMakiert
    Call RAuftraege
    frmLager.cboArtikelnummer.SetFocus
End Sub

Private Sub cmdNartikel_Click() 'v1.44
    Dim letztezeile, arrTmpA, arrTmpB, i, lngS, lngIndex, lngID, Last_Row, lng, lngAID As Long
    Dim strSN, strAUNext, strFor, strAUNr, FDate As String
    Dim xwert As Double
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    If cboart2 = "Bitte ausw|fffd|hlen" Then
        cboart2.BorderColor = &HFF&
        Exit Sub
    End If
    ThisWorkbook.Activate
    If Not lbl_bezeichnung.Caption = "" Then
        If CDbl(txtMenge) = 0 Then
            MsgBox "Die Menge muss gr|fffd||fffd|er sein als 0!", , "Hinweis"
            txtMenge.SetFocus
            Exit Sub
        End If
    End If
    If Not txt_RENr.Value = "" Then
        If txt_sperre.Value = 0 Then
            MsgBox "Beleg ist abgeschlossen und Rechnung wurde bereits gedruckt!" & vbLf & "Rechnungsbeleg: " & CStr(txt_RENr), vbInformation
            Exit Sub
        ElseIf txt_sperre.Value = 1 And Not txt_RENr = "" Then
            ThisWorkbook.Sheets("Daten").Activate
            Range("A65536").End(xlUp).Offset(1, 0).Select
            ActiveCell.Offset(0, 0).Value = Date
            ActiveCell.Offset(0, 1).Value = "Beleg: " & frmKasse.txt_RENr & " wurde bearbeitet! / Eine Pos. wurde hinzugef|fffd|gt!"
            ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
            ThisWorkbook.Sheets("Center").Activate
        End If
    End If
    If frmKasse.lbl_ArtikelNR.Caption = "" And lstKasse.ListCount > 0 Then
        If cboart2 = "Auftrag" Then
            frmLager.txtWG.Value = frmKasse.txtRnr.Text
            frmLager.txt_WGA.Value = ""
        Else
            frmLager.txt_WGA.Value = frmKasse.txtRnr.Text
            frmLager.txtWG.Value = ""
        End If
        Unload frmKasse
        frmLager.txt_item.Value = ""
        frmLager.txt_item.SetFocus
        Exit Sub
    End If
    If lbl_ArtikelNR.Caption = "" Then Exit Sub
    If cboart2.Value = "" Then
        MsgBox "W|fffd|hlen Sie eine Art aus!", vbOKOnly, "Hinweis"
        cboart2.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Rechnung" And txtRnr.Value = "" And Sheets("Daten").Range("D23") = "Nein" Then
        MsgBox "Geben Sie eine Rechnungsnummer an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Rechnung" And txtRnr.Value = "" And Sheets("Daten").Range("D23") = "" Then
        MsgBox "Geben Sie eine Rechnungsnummer an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Auftrag" And txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Auftragsnummer oder ein Projektnamen an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Angebot" And txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Angebotsnummer an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    ElseIf lbl_bezeichnung.Caption = "" Then
        MsgBox "Artikelnummer hat keine Bezeichung!", vbOKOnly, "Hinweis"
        Unload frmKasse
        Exit Sub
    End If
    If lbl_VKPreisKasse.Caption = "" Then
        If MsgBox("M|fffd|chten Sie ohne Preis fortfahren?", vbYesNo, "Preis") = vbYes Then
            lbl_VKPreisKasse.Caption = 0
        Else
            Exit Sub
        End If
    ElseIf txtMenge.Value = "" Then
        MsgBox "Bitte geben Sie eine Menge an!", vbOKOnly, "Hinweis"
        txtMenge.SetFocus
        Exit Sub
    End If
    If frmKasse.cboart2 = "Intern" Then
        frmLager.txtWG.Value = frmKasse.cboAuftragSuchen.Text
        frmLager.txt_Kassenart.Value = "Intern"
        frmLager.txt_WGA.Value = ""
        frmLager.txtWG.Value = ""
    ElseIf frmKasse.cboart2 = "Auftrag" Then
        frmLager.txtWG.Value = frmKasse.txtRnr.Text
        frmLager.txt_WGA.Value = ""
        frmLager.txt_Kassenart.Value = ""
    ElseIf frmKasse.cboart2 = "Angebot" Then
        frmLager.txt_WGA.Value = frmKasse.txtRnr.Text
        frmLager.txtWG.Value = ""
        frmLager.txt_Kassenart.Value = ""
    End If
    Worksheets("Kassendaten").Columns("L:L").NumberFormat = "0.0%"
    Worksheets("Reservierungen").Columns("L:L").NumberFormat = "0.0%"
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                lngID = i
            End If
        Next
    End With
    If Not Worksheets("Lager").Cells(CLng(lngID), 42) = "" Then
        MsgBox "Artikel: """ & Sheets("Lager").Cells(lngID, 6) & """ ist gesperrt!", , "Gesperrt seit: " & Sheets("Lager").Cells(lngID, 42)
        GoTo weiter:
        Exit Sub
    End If
    If Not frmKasse.cboart2 = "Auftrag" And Not frmKasse.cboart2 = "Angebot" Then
        With Worksheets("Kassendaten")
            If .FilterMode Then .ShowAllData
        End With
        If frmKasse.lstKasse.ListCount = 0 And Not frmKasse.cboart2 = "Intern" Then
            Call KuHiZu
        End If
        Sheets("Kassendaten").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        For lngAID = 2 To ThisWorkbook.Worksheets("Kassendaten").UsedRange.Rows.Count
            If Sheets("Kassendaten").Cells(lngAID, 17) = CStr(txtID.Value) And Sheets("Kassendaten").Cells(lngAID, 20) = txt_LPID.Value And Not Sheets("Kassendaten").Cells(lngAID, 21) = "VP" Then
                xwert = Sheets("Kassendaten").Cells(lngAID, 7)
                Sheets("Kassendaten").Cells(lngAID, 7).Value = CDbl(xwert + txtMenge.Value)
                GoTo weiter
            End If
        Next lngAID
        If Worksheets("Lager").Cells(CDbl(lngID), 30) = "Y" Then
            If txtMenge.Value > CDbl("1") Then
                MsgBox "Durch die Seriennummer kann immer nur ein Artikel hinzugef|fffd|gt werden", , "Hinweis"
                txtMenge.Value = "1"
            End If
            strSN = InputBox("Bitte geben Sie die Seriennummer an!" & vbLf & "Artikel: " + lbl_bezeichnung.Caption + vbLf & vbLf & "Tipp: Sie k|fffd|nnen die Serien- Nr. auch scannen", "Seriennummer")
            If Not strSN = "" Then
                ActiveCell.Offset(0, 18).Value = strSN
                ActiveCell.Offset(0, 5).Value = lbl_bezeichnung.Caption & " /SN:" & strSN
            Else
                Application.ScreenUpdating = True
                Exit Sub
            End If
        Else
            If Not txt_VPEinheit = "" Then
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption & " / " & cbo_VPEinheit
                ActiveCell.Offset(0, 22).Value = CStr(txt_VPEinheit2)
            Else
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption
            End If
        End If
        If cboart2.Value = "Intern" Then
            ActiveCell.Offset(0, 0) = "Intern" & Format(Date, "dd.mm.yy") & "/" & Format(Time, "hhmmss")
        Else
            If Sheets("Daten").Range("D23") = "Ja" Then
                ActiveCell.Offset(0, 0).Value = "Rechnung"
            Else
                ActiveCell.Offset(0, 0).Value = "'" & txtRnr 'Belegnummer
            End If
        End If
        ActiveCell.Offset(0, 2).Value = "'" & lbl_herstellerNr.Caption
        ActiveCell.Offset(0, 3).Value = lbl_Hersteller
        ActiveCell.Offset(0, 4).Value = "'" & lbl_Frei.Caption
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption & "-2" & txt_VPEinheit
            ActiveCell.Offset(0, 7).Value = CDbl(lbl_VKPreisKasse.Caption) * CDbl(txtMenge.Value) 'VK-Preis + Menge
            ActiveCell.Offset(0, 6).Value = txtMenge.Value * txt_VPEinheit
            ActiveCell.Offset(0, 12).Value = txt_VPEPreis
        Else
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption
            ActiveCell.Offset(0, 7).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15) * CDbl(txtMenge.Value)) 'VK-Preis + Menge
            ActiveCell.Offset(0, 12).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15))
            ActiveCell.Offset(0, 6).Value = txtMenge.Value
        End If
        ActiveCell.Offset(0, 8).Value = txtRabatt.Text
        ActiveCell.Offset(0, 9).Value = txtzeile.Text
        ActiveCell.Offset(0, 10).Value = cboart2.Value
        ActiveCell.Offset(0, 11).Value = CDbl(Format(lbl_UMST, "#.#0,0"))
        ActiveCell.Offset(0, 13).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 32))
        ActiveCell.Offset(0, 16).Value = txtID.Value
        ActiveCell.Offset(0, 17).Value = txt_KDID.Value
        If Not txt_LPID.Value = "" Then
             ActiveCell.Offset(0, 19).Value = "'" & txt_LPID.Value
        End If
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 20).Value = "VP"
            ActiveCell.Offset(0, 21).Value = CDbl(txtMenge)
            If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 27).Value = "VP"
            ActiveCell.Offset(0, 28).Value = CDbl(txtMenge)
            If Me.txtMenge > 1 Then
                If txt_VPEinheit2 = "Karton" Then
                    ActiveCell.Offset(0, 22).Value = "Kartons"
                ElseIf txt_VPEinheit2 = "Kiste" Then
                    ActiveCell.Offset(0, 22).Value = "Kisten"
                ElseIf txt_VPEinheit2 = "Palette" Then
                    ActiveCell.Offset(0, 22).Value = "Paletten"
                ElseIf txt_VPEinheit2 = "Paket" Then
                    ActiveCell.Offset(0, 22).Value = "Pakete"
                ElseIf txt_VPEinheit2 = "Pack" Then
                    ActiveCell.Offset(0, 22).Value = "Packs"
                Else
                    ActiveCell.Offset(0, 22).Value = "Beh|fffd|lter"
                End If
            Else
                ActiveCell.Offset(0, 22).Value = CStr(txt_VPEinheit2)
            End If
        End If
        End If
        Call leeren
        Unload frmKasse
        frmLager.txt_item.Value = ""
        frmLager.txt_item.SetFocus
    Else
        With Worksheets("Reservierungen")
            If .FilterMode Then .ShowAllData
        End With
        If frmKasse.cboart2 = "Intern" Then
            frmLager.txtWG.Value = frmKasse.cboAuftragSuchen.Text
            frmLager.txt_Kassenart.Value = "Intern"
            frmLager.txt_WGA.Value = ""
            frmLager.txtWG.Value = ""
        ElseIf frmKasse.cboart2 = "Auftrag" Then
            frmLager.txtWG.Value = frmKasse.txtRnr.Text
            frmLager.txt_WGA.Value = ""
            frmLager.txt_Kassenart.Value = ""
        ElseIf frmKasse.cboart2 = "Angebot" Then
            frmLager.txt_WGA.Value = frmKasse.txtRnr.Text
            frmLager.txtWG.Value = ""
            frmLager.txt_Kassenart.Value = ""
        End If
        If frmKasse.lstKasse.ListCount = 0 And Not frmKasse.cboart2 = "Intern" Then
            Call KuHiZu
        End If
        Sheets("Reservierungen").Activate
        Range("A500000").End(xlUp).Offset(1, 0).Select
        For lngAID = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
            If Sheets("Reservierungen").Cells(lngAID, 18) = CStr(txtID.Value) And Sheets("Reservierungen").Cells(lngAID, 1) = CStr(txtRnr.Value) And Sheets("Reservierungen").Cells(lngAID, 23) = txt_LPID.Value And Not Sheets("Reservierungen").Cells(lngAID, 28) = "VP" Then
                xwert = Sheets("Reservierungen").Cells(lngAID, 7)
                Sheets("Reservierungen").Cells(lngAID, 7).Value = CDbl(xwert + txtMenge.Value)
                GoTo weiter
            End If
        Next lngAID
        If Worksheets("Lager").Cells(CDbl(lngID), 30) = "Y" Then
            If txtMenge.Value > CDbl("1") Then
                MsgBox "Durch die Seriennummer kann immer nur ein Artikel hinzugef|fffd|gt werden", , "Hinweis"
                txtMenge.Value = "1"
            End If
            strSN = InputBox("Bitte geben Sie die Seriennummer an!" & vbLf & "Artikel: " + lbl_bezeichnung.Caption + vbLf & vbLf & "Tipp: Sie k|fffd|nnen die Serien- Nr. auch scannen", "Seriennummer")
            If Not strSN = "" Then
                ActiveCell.Offset(0, 19).Value = strSN
                ActiveCell.Offset(0, 5).Value = lbl_bezeichnung.Caption & " /SN:" & strSN
            Else
                Application.ScreenUpdating = True
                Exit Sub
            End If
        Else
            If Not txt_VPEinheit = "" Then
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption & " / " & cbo_VPEinheit
            Else
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption
            End If
        End If
        ActiveCell.Offset(0, 0).Value = "'" & txtRnr 'Belegnummer
        ActiveCell.Offset(0, 2).Value = "'" & lbl_herstellerNr.Caption
        ActiveCell.Offset(0, 3).Value = lbl_Hersteller
        ActiveCell.Offset(0, 4).Value = "'" & lbl_Frei.Caption
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption & "-2" & txt_VPEinheit
            ActiveCell.Offset(0, 7).Value = CDbl(lbl_VKPreisKasse.Caption) * CDbl(txtMenge.Value) 'VK-Preis + Menge
            ActiveCell.Offset(0, 6).Value = txtMenge.Value * txt_VPEinheit
            ActiveCell.Offset(0, 12).Value = txt_VPEPreis
        Else
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption
            ActiveCell.Offset(0, 7).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15) * CDbl(txtMenge.Value)) 'VK-Preis + Menge
            ActiveCell.Offset(0, 12).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15))
            ActiveCell.Offset(0, 6).Value = txtMenge.Value
        End If
        ActiveCell.Offset(0, 8).Value = txtRabatt.Text
        ActiveCell.Offset(0, 9).Value = txtzeile.Text
        ActiveCell.Offset(0, 10).Value = cboart2.Value
        ActiveCell.Offset(0, 11).Value = CDbl(Format(lbl_UMST, "#.#0,0"))
        ActiveCell.Offset(0, 13).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 32))
        If Not txtAdatum.Value = "" Then
            ActiveCell.Offset(0, 16).Value = CDate(txtAdatum.Value)
        End If
        ActiveCell.Offset(0, 17).Value = txtID.Value
        ActiveCell.Offset(0, 18).Value = txt_KDID.Value
        ActiveCell.Offset(0, 20).Value = Format(Date, FDate)
        If Sheets("Daten").Range("B5").Value = "True" Then
            ActiveCell.Offset(0, 21).Value = Sheets("Daten").Range("B24").Value
        End If
        If Not txt_LPID.Value = "" Then
             ActiveCell.Offset(0, 22).Value = "'" & txt_LPID.Value
        End If
        If Not txt_RENr.Value = "" Then
            ActiveCell.Offset(0, 24).Value = "'" & txt_RENr
        End If
        If Not txt_LSNr.Value = "" Then
            ActiveCell.Offset(0, 25).Value = "'" & txt_LSNr
        End If
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 27).Value = "VP"
            ActiveCell.Offset(0, 28).Value = CDbl(txtMenge)
            If Me.txtMenge > 1 Then
                If txt_VPEinheit2 = "Karton" Then
                    ActiveCell.Offset(0, 29).Value = "Kartons"
                ElseIf txt_VPEinheit2 = "Kiste" Then
                    ActiveCell.Offset(0, 29).Value = "Kisten"
                ElseIf txt_VPEinheit2 = "Palette" Then
                    ActiveCell.Offset(0, 29).Value = "Paletten"
                ElseIf txt_VPEinheit2 = "Paket" Then
                    ActiveCell.Offset(0, 29).Value = "Pakete"
                ElseIf txt_VPEinheit2 = "Pack" Then
                    ActiveCell.Offset(0, 29).Value = "Packs"
                Else
                    ActiveCell.Offset(0, 29).Value = "Beh|fffd|lter"
                End If
            Else
                ActiveCell.Offset(0, 29).Value = CStr(txt_VPEinheit2)
            End If
        End If
        If Not Sheets("Daten").Range("D31").Value = "Nein" Or Sheets("Daten").Range("D31").Value = "" Then
            If cboart2 = "Auftrag" And lstKasse.ListCount = 0 Then
                If Not Sheets("Daten").Range("D34") = "#Auftrag#" Then
                    strFor = Sheets("Daten").Range("D34")
                    strAUNext = Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
                    strAUNr = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
                    If CStr(txtRnr) = CStr(strAUNr) Then
                        Sheets("Daten").Range("D33") = "'" & CStr(strAUNext)
                    End If
                End If
            End If
        End If
        If Not Sheets("Daten").Range("D35").Value = "Nein" Or Sheets("Daten").Range("D35").Value = "" Then
            strFor = ""
            strAUNext = ""
            strAUNr = ""
            If cboart2 = "Angebot" And lstKasse.ListCount = 0 Then
                If Not Sheets("Daten").Range("D35") = "Auswahl 2" Then
                    strFor = Sheets("Daten").Range("D38")
                    strAUNext = Format(CDbl(Sheets("Daten").Range("D37") + 1), strFor)
                    strAUNr = Sheets("Daten").Range("D36") & Format(CDbl(Sheets("Daten").Range("D37") + 1), strFor)
                    If CStr(txtRnr) = CStr(strAUNr) Then
                        Sheets("Daten").Range("D37") = "'" & CStr(strAUNext)
                    End If
                End If
            End If
        End If
weiter:
        Call leeren
        frmLager.txt_item.Value = ""
        frmLager.txt_item.SetFocus
        Unload frmKasse
    End If
    If Sheets("Daten").Range("D20").Value = "Ja" Then
        'Sortieren nach Nummer
        letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
        ActiveSheet.UsedRange.Sort Key1:=Range(Cells(1, 1), Cells(letztezeile, 1)), Header:=xlYes
    End If
    Application.ScreenUpdating = True
    Sheets("Center").Activate
End Sub

Private Sub cmdletzterArtikel_Click() 'v1.44
    Dim arrTmpA, arrTmpB, i, lngS, letztezeile As Long
    Dim lngIndex, lngAID, lngID, Last_Row, lng As Long
    Dim xwert As Double
    Dim SINP, strAUNext, strFor, strAUNr, FDate, strKID As String
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    If cboart2 = "Bitte ausw|fffd|hlen" Then
        cboart2.BorderColor = &HFF&
        Exit Sub
    End If
    ThisWorkbook.Activate
    If CDbl(txtMenge) = 0 Then
        MsgBox "Die Menge muss gr|fffd||fffd|er sein als 0!", , "Hinweis"
        txtMenge.SetFocus
        Exit Sub
    End If
    frmLager.txtWG.Value = ""
    If lbl_ArtikelNR.Caption = "" Then Exit Sub
    If Not txt_RENr.Value = "" Then
        If txt_sperre.Value = 0 Then
            lbl_status.Caption = "Beleg ist abgeschlossen und Rechnung wurde bereits gedruckt!" & vbLf & "Rechnungsbeleg: " & CStr(txt_RENr)
            lbl_status.Visible = True
            Application.Wait (Now + TimeValue("00:00:03"))
            lbl_status.Visible = False
            Exit Sub
        ElseIf txt_sperre.Value = 1 And Not txt_RENr = "" Then
            ThisWorkbook.Sheets("Daten").Activate
            Range("A65536").End(xlUp).Offset(1, 0).Select
            ActiveCell.Offset(0, 0).Value = Date
            ActiveCell.Offset(0, 1).Value = "Beleg: " & frmKasse.txt_RENr & " wurde bearbeitet! / Eine Pos. wurde hinzugef|fffd|gt!"
            ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
            ThisWorkbook.Sheets("Center").Activate
        End If
    End If
    If cboart2.Value = "" Then
        MsgBox "W|fffd|hlen Sie eine Art aus!", vbOKOnly, "Hinweis"
        cboart2.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Rechnung" And txtRnr.Value = "" And Sheets("Daten").Range("D23") = "Nein" Then
        MsgBox "Geben Sie eine Rechnungsnummer an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Rechnung" And txtRnr.Value = "" And Sheets("Daten").Range("D23") = "" Then
        MsgBox "Geben Sie eine Rechnungsnummer an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Auftrag" And txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Auftragsnummer oder ein Projektnamen an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    ElseIf cboart2.Value = "Angebot" And txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Angebotsnummer an!", vbOKOnly, "Hinweis"
        txtRnr.SetFocus
        Exit Sub
    End If
    If lbl_bezeichnung.Caption = "" Then Exit Sub
    If lbl_VKPreisKasse.Caption = "" Then
        lbl_VKPreisKasse.Caption = 0
    End If
    If txtMenge.Value = "" Then
        MsgBox "Bitte geben Sie eine Menge an!", vbOKOnly, "Hinweis"
        txtMenge.SetFocus
        Exit Sub
    End If
    Worksheets("Kassendaten").Columns("L:L").NumberFormat = "0.0%"
    Worksheets("Reservierungen").Columns("L:L").NumberFormat = "0.0%"
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                lngID = i
            End If
        Next i
    End With
    If Not Worksheets("Lager").Cells(CLng(lngID), 42) = "" Then
        MsgBox "Artikel: """ & Sheets("Lager").Cells(lngID, 6) & """ ist gesperrt!", , "Gesperrt seit: " & Sheets("Lager").Cells(lngID, 42)
        lbl_ArtikelNR.Caption = ""
        lbl_herstellerNr.Caption = ""
        lbl_Hersteller.Caption = ""
        lbl_Frei.Caption = ""
        lbl_bezeichnung.Caption = ""
        txtMenge.Value = ""
        lbl_VKPreisKasse.Caption = ""
        txtRabatt.Value = ""
        txtrabatt2.Value = ""
        lbl_Nettoges.Caption = ""
        cbo_VPEinheit.Clear
        cbo_Lagerplatz.Clear
        txtrabattpreis.Value = ""
        lbl_UMST.Caption = ""
        lbl_LOAnzahl.Caption = ""
        Exit Sub
    End If
    If Not frmKasse.cboart2 = "Auftrag" And Not frmKasse.cboart2 = "Angebot" Then
        With Worksheets("Kassendaten")
            If .FilterMode Then .ShowAllData
        End With
        If frmKasse.lstKasse.ListCount = 0 And Not frmKasse.cboart2 = "Intern" Then
            Call KuHiZu
        End If
        Sheets("Kassendaten").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        For lngAID = 2 To ThisWorkbook.Worksheets("Kassendaten").UsedRange.Rows.Count
            If CStr(Sheets("Kassendaten").Cells(lngAID, 17)) = CStr(txtID.Value) And Sheets("Kassendaten").Cells(lngAID, 20) = txt_LPID.Value And Not Sheets("Kassendaten").Cells(lngAID, 21) = "VP" Then
                xwert = Sheets("Kassendaten").Cells(lngAID, 7)
                Sheets("Kassendaten").Cells(lngAID, 7).Value = CDbl(xwert + txtMenge.Value)
                GoTo weiter
            End If
        Next lngAID
        If Worksheets("Lager").Cells(CDbl(lngID), 30) = "Y" And txt_VPEinheit.Value = "" Then
            If txtMenge.Value > CDbl("1") Then
                MsgBox "Durch die Seriennummer kann immer nur ein Artikel hinzugef|fffd|gt werden", , "Hinweis"
                txtMenge.Value = "1"
            End If
            SINP = InputBox("Bitte geben Sie die Seriennummer an!" & vbLf & "Artikel: " + lbl_bezeichnung.Caption + vbLf & vbLf & "Tipp: Sie k|fffd|nnen die Serien- Nr. auch scannen", "Seriennummer")
            If Not SINP = "" Then
                ActiveCell.Offset(0, 18).Value = SINP
                ActiveCell.Offset(0, 5).Value = lbl_bezeichnung.Caption & " /SN:" & SINP
            Else
                Application.ScreenUpdating = True
                Exit Sub
            End If
        Else
            If Not txt_VPEinheit = "" Then
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption & " / " & cbo_VPEinheit
                If Me.txtMenge > 1 Then
                    If txt_VPEinheit2 = "Karton" Then
                        ActiveCell.Offset(0, 22).Value = "Kartons"
                    ElseIf txt_VPEinheit2 = "Kiste" Then
                        ActiveCell.Offset(0, 22).Value = "Kisten"
                    ElseIf txt_VPEinheit2 = "Palette" Then
                        ActiveCell.Offset(0, 22).Value = "Paletten"
                    ElseIf txt_VPEinheit2 = "Paket" Then
                        ActiveCell.Offset(0, 22).Value = "Pakete"
                    ElseIf txt_VPEinheit2 = "Pack" Then
                        ActiveCell.Offset(0, 22).Value = "Packs"
                    Else
                        ActiveCell.Offset(0, 22).Value = "Beh|fffd|lter"
                    End If
                Else
                    ActiveCell.Offset(0, 22).Value = CStr(txt_VPEinheit2)
                End If
            Else
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption
            End If
        End If
        If cboart2.Value = "Intern" Then
            ActiveCell.Offset(0, 0) = "Intern" & Format(Date, "dd.mm.yy") & "/" & Format(Time, "hhmmss")
        ElseIf cboart2.Value = "Barverkauf" Then
            ActiveCell.Offset(0, 0) = "Bar" & Format(Date, "dd.mm.yy") & "/" & Format(Time, "hhmmss")
        Else
            If Sheets("Daten").Range("D23") = "Ja" Then
                ActiveCell.Offset(0, 0).Value = "Rechnung"
            Else
                ActiveCell.Offset(0, 0).Value = "'" & txtRnr 'Belegnummer
            End If
        End If
        ActiveCell.Offset(0, 2).Value = "'" & lbl_herstellerNr.Caption
        ActiveCell.Offset(0, 3).Value = "'" & lbl_Hersteller
        ActiveCell.Offset(0, 4).Value = "'" & lbl_Frei.Caption
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption & "-2" & txt_VPEinheit
            ActiveCell.Offset(0, 7).Value = CDbl(lbl_VKPreisKasse.Caption) * CDbl(txtMenge.Value) 'VK-Preis + Menge
            ActiveCell.Offset(0, 6).Value = txtMenge.Value * txt_VPEinheit
            ActiveCell.Offset(0, 12).Value = txt_VPEPreis
        Else
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption
            ActiveCell.Offset(0, 7).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15) * CDbl(txtMenge.Value)) 'VK-Preis + Menge
            ActiveCell.Offset(0, 12).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15))
            ActiveCell.Offset(0, 6).Value = txtMenge.Value
        End If
        ActiveCell.Offset(0, 8).Value = txtRabatt.Text
        ActiveCell.Offset(0, 9).Value = txtzeile.Text
        ActiveCell.Offset(0, 10).Value = cboart2
        ActiveCell.Offset(0, 13).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 32))
        ActiveCell.Offset(0, 11).Value = CDbl(Format(lbl_UMST, "#.#0,0"))
        ActiveCell.Offset(0, 16).Value = txtID 'Prim|fffd|rschluessel
        ActiveCell.Offset(0, 17).Value = txt_KDID 'Prim|fffd|rschluessel
        ActiveCell.Offset(0, 19).Value = txt_LPID.Value
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 20).Value = "VP"
            ActiveCell.Offset(0, 21).Value = CDbl(txtMenge)
        End If
        strKID = Me.txt_KDID
        Call SuchenKasseV2
        Call leeren
        cmdKasseaktive.Caption = "Kasse (" & cboart2 & ")"
    Else
        With Worksheets("Reservierungen")
            If .FilterMode Then .ShowAllData
        End With
        If frmKasse.lstKasse.ListCount = 0 And Not frmKasse.cboart2 = "Intern" Then
            Call KuHiZu
        End If
        strKID = Me.txt_KDID
        Sheets("Reservierungen").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        For lngAID = 2 To ThisWorkbook.Worksheets("Reservierungen").UsedRange.Rows.Count
            If CStr(Sheets("Reservierungen").Cells(lngAID, 18)) = CStr(txtID.Value) And Sheets("Reservierungen").Cells(lngAID, 1) = CStr(txtRnr.Value) And Sheets("Reservierungen").Cells(lngAID, 23) = txt_LPID.Value And Not Sheets("Reservierungen").Cells(lngAID, 28) = "VP" Then
                xwert = Sheets("Reservierungen").Cells(lngAID, 7)
                Sheets("Reservierungen").Cells(lngAID, 7).Value = CDbl(xwert + txtMenge.Value)
                GoTo weiter
            End If
        Next lngAID
        If Worksheets("Lager").Cells(CDbl(lngID), 30) = "Y" And txt_VPEinheit.Value = "" Then
            If txtMenge.Value > CDbl("1") Then
                MsgBox "Durch die Seriennummer kann immer nur ein Artikel hinzugef|fffd|gt werden", , "Hinweis"
                txtMenge.Value = "1"
            End If
            SINP = InputBox("Bitte geben Sie die Seriennummer an!" & vbLf & "Artikel: " + lbl_bezeichnung.Caption + vbLf & vbLf & "Tipp: Sie k|fffd|nnen die Serien- Nr. auch scannen", "Seriennummer")
            If Not SINP = "" Then
                ActiveCell.Offset(0, 19).Value = SINP
                ActiveCell.Offset(0, 5).Value = lbl_bezeichnung.Caption & " /SN:" & SINP
            Else
                Application.ScreenUpdating = True
                Exit Sub
            End If
        Else
            If Not txt_VPEinheit = "" Then
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption & " / " & cbo_VPEinheit
            Else
                ActiveCell.Offset(0, 5).Value = frmKasse.lbl_bezeichnung.Caption
            End If
        End If
        ActiveCell.Offset(0, 0).Value = "'" & txtRnr.Value 'Belegnummer
        ActiveCell.Offset(0, 2).Value = "'" & lbl_herstellerNr.Caption
        ActiveCell.Offset(0, 3).Value = "'" & lbl_Hersteller
        ActiveCell.Offset(0, 4).Value = "'" & lbl_Frei.Caption
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption & "-2" & txt_VPEinheit
            ActiveCell.Offset(0, 7).Value = CDbl(lbl_VKPreisKasse.Caption) * CDbl(txtMenge.Value) 'VK-Preis + Menge
            ActiveCell.Offset(0, 6).Value = txtMenge.Value * txt_VPEinheit
            ActiveCell.Offset(0, 12).Value = txt_VPEPreis
        Else
            ActiveCell.Offset(0, 1).Value = "'" & lbl_ArtikelNR.Caption
            ActiveCell.Offset(0, 7).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15) * CDbl(txtMenge.Value)) 'VK-Preis + Menge
            ActiveCell.Offset(0, 12).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 15))
            ActiveCell.Offset(0, 6).Value = txtMenge.Value
        End If
        ActiveCell.Offset(0, 8).Value = txtRabatt.Text
        ActiveCell.Offset(0, 9).Value = txtzeile.Text
        ActiveCell.Offset(0, 10).Value = cboart2
        ActiveCell.Offset(0, 13).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngID), 32))
        ActiveCell.Offset(0, 11).Value = CDbl(Format(lbl_UMST, "#.#0,0"))
        If Not txtAdatum.Value = "" Then
            ActiveCell.Offset(0, 16).Value = CDate(txtAdatum.Value)
        End If
        ActiveCell.Offset(0, 17).Value = txtID.Value
        ActiveCell.Offset(0, 18).Value = txt_KDID.Value
        ActiveCell.Offset(0, 20).Value = Format(Date, FDate)
        If Not txt_RENr.Value = "" Then
            ActiveCell.Offset(0, 24).Value = "'" & txt_RENr
        End If
        If Not txt_LSNr.Value = "" Then
            ActiveCell.Offset(0, 25).Value = "'" & txt_LSNr
        End If
        If Not Sheets("Daten").Range("B22").Value = "" Then
            ActiveCell.Offset(0, 21).Value = Sheets("Daten").Range("B22").Value
        Else
            If Sheets("Daten").Range("B5").Value = "True" Then
                ActiveCell.Offset(0, 21).Value = Sheets("Daten").Range("B24").Value
            End If
        End If
        If Not txt_LPID.Value = "" Then
             ActiveCell.Offset(0, 22).Value = "'" & txt_LPID.Value
        End If
        If Not txt_VPEinheit = "" Then
            ActiveCell.Offset(0, 27).Value = "VP"
            ActiveCell.Offset(0, 28).Value = CDbl(txtMenge)
            If Me.txtMenge > 1 Then
                If txt_VPEinheit2 = "Karton" Then
                    ActiveCell.Offset(0, 29).Value = "Kartons"
                ElseIf txt_VPEinheit2 = "Kiste" Then
                    ActiveCell.Offset(0, 29).Value = "Kisten"
                ElseIf txt_VPEinheit2 = "Palette" Then
                    ActiveCell.Offset(0, 29).Value = "Paletten"
                ElseIf txt_VPEinheit2 = "Paket" Then
                    ActiveCell.Offset(0, 29).Value = "Pakete"
                ElseIf txt_VPEinheit2 = "Pack" Then
                    ActiveCell.Offset(0, 29).Value = "Packs"
                Else
                    ActiveCell.Offset(0, 29).Value = "Beh|fffd|lter"
                End If
            Else
                ActiveCell.Offset(0, 29).Value = CStr(txt_VPEinheit2)
            End If
        End If
        If Not Sheets("Daten").Range("D31").Value = "Nein" Or Sheets("Daten").Range("D31").Value = "" Then
            If cboart2 = "Auftrag" And lstKasse.ListCount = 0 Then
                If Not Sheets("Daten").Range("D34") = "#Auftrag#" Then
                    strFor = Sheets("Daten").Range("D34")
                    strAUNext = Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
                    strAUNr = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
                    If CStr(txtRnr) = CStr(strAUNr) Then
                        Sheets("Daten").Range("D33") = "'" & CStr(strAUNext)
                    End If
                End If
            End If
        End If
        If Not Sheets("Daten").Range("D35").Value = "Nein" Or Sheets("Daten").Range("D35").Value = "" Then
            strFor = ""
            strAUNext = ""
            strAUNr = ""
            If cboart2 = "Angebot" And lstKasse.ListCount = 0 Then
                If Not Sheets("Daten").Range("D35") = "Auswahl 2" Then
                    strFor = Sheets("Daten").Range("D38")
                    strAUNext = Format(CDbl(Sheets("Daten").Range("D37") + 1), strFor)
                    strAUNr = Sheets("Daten").Range("D36") & Format(CDbl(Sheets("Daten").Range("D37") + 1), strFor)
                    If CStr(txtRnr) = CStr(strAUNr) Then
                        Sheets("Daten").Range("D37") = "'" & CStr(strAUNext)
                    End If
                End If
            End If
        End If
weiter:
        Application.ScreenUpdating = True
        If Sheets("Daten").Range("D20").Value = "Ja" Then
            'Sortieren nach Nummer
            letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
            ActiveSheet.UsedRange.Sort Key1:=Range(Cells(1, 1), Cells(letztezeile, 1)), Header:=xlYes
        End If
        Sheets("Center").Activate
        If frmKasse.cboart2.Text = "Auftrag" Then
            Call leeren
            Call RAuftraege
            cboAuftragSuchen = txtRnr.Value
            Call SuchenAuftragV2
        ElseIf frmKasse.cboart2 = "Angebot" Then
            Call leeren
            Call RAngebote
            cbo_Angebot = txtRnr.Value
            Call SuchenAngebotNeu
        Else
            Call leeren
            Call SuchenKasseV2
        End If
        comAStorno.Visible = True
    End If
    Call SumKasseV2
    Call ListMakiert
    txt_KDID.Value = CStr(strKID)
    Sheets("Center").Activate
    cmdletzterArtikel.SetFocus
End Sub

Sub KuHiZu()
    Dim strMsg As String
    If txt_KDID.Value = "" Then
        strMsg = MsgBox("M|fffd|chten Sie einen Kunden ausw|fffd|hlen?", vbYesNo, "Kunde")
        If strMsg = vbYes Then
            frmContact.txt_KDID2.Value = CDbl(Sheets("Daten").Range("B19")) + 1
            frmContact.cboAnsp.Visible = False
            frmContact.txtdate.Visible = False
            frmContact.lblinfo.Visible = False
            frmContact.comnext.Visible = False
            frmContact.cmd_invoiceprint.Visible = False
            frmContact.cmdnextL.Visible = False
            frmContact.lblMitarbeiter.Visible = False
            frmContact.cmd_KDsave.Visible = True
            frmContact.lblinfo2.Visible = False
            frmContact.Show
        End If
    End If
End Sub

Sub leeren()
    lbl_ArtikelNR.Caption = ""
    lbl_herstellerNr.Caption = ""
    lbl_Hersteller.Caption = ""
    lbl_Frei.Caption = ""
    lbl_bezeichnung.Caption = ""
    txtMenge.Value = ""
    lbl_VKPreisKasse.Caption = ""
    txtRabatt.Value = ""
    txtrabatt2.Value = ""
    lbl_Nettoges.Caption = ""
    cbo_Lagerplatz.Clear
    txtrabattpreis.Value = ""
    lbl_UMST.Caption = ""
    txt_KDID.Value = ""
    lbl_Gewicht2.Caption = ""
    lbl_sum12.Caption = ""
    lbl_MwStsum.Caption = ""
    lbl_sum22.Caption = ""
    lbl_Rabatt.Caption = ""
    lbl_datensaetze.Caption = ""
    lbl_Rabatt.Caption = ""
    lbl_LOAnzahl.Caption = ""
    txt_RENr.Value = ""
    txt_LSNr.Value = ""
End Sub

Sub Listeloeschen()
    Dim z, l As Long
    On Error Resume Next
    For z = lstKasse.ListCount To 1 Step -1
        l = lstKasse.Column(7, z - 1)
        Sheets("Kassendaten").Rows(l).Delete
    Next
    lstKasse.Clear
    Call leeren
End Sub

Sub Listeloeschen2()
    Dim z, l  As Long
    On Error Resume Next
    With frmKasse.lstKasse
        For l = .ListCount - 1 To 0 Step -1
            If .Selected(l) = True Then
                z = CDbl(frmKasse.lstKasse.Column(7, l))
                Sheets("Reservierungen").Rows(CDbl(z)).Delete
            End If
        Next
    End With
    lstKasse.Clear
    Call leeren
    Call RAuftraege
    Call AnsichtLager
End Sub

Sub ListeloeschenAll()
    Dim z, l As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    For z = lstKasse.ListCount To 1 Step -1
        l = lstKasse.Column(7, z - 1)
        Sheets("Reservierungen").Rows(l).Delete
    Next
    Application.ScreenUpdating = True
    lstKasse.Clear
    Call RAuftraege
End Sub

Private Sub cmddelete_Click()
    On Error Resume Next
    If cboart2.Value = "" Then Exit Sub
    If MsgBox("M|fffd|chten Sie die Liste wirklich l|fffd|schen?", vbYesNo, "Liste l|fffd|schen") = vbYes Then
        Call Listeloeschen
        cmdKasseaktive.Caption = "Kasse (leer)"
        cboart2.Clear
        txtRnr.Value = ""
        UserForm_Initialize
    Else
        Exit Sub
    End If
End Sub

Sub loeschen1() 'v1.40
    Dim lngZeile, l As Long
    ThisWorkbook.Activate
    Application.ScreenUpdating = False
    With lstKasse
        For l = .ListCount - 1 To 0 Step -1
            If .Selected(l) = True Then
                With ThisWorkbook.Worksheets("Kassendaten")
                    lngZeile = lstKasse.Column(7, l)
                    .Rows(lstKasse.Column(7, l)).Delete
                End With
            End If
        Next
    End With
    Application.ScreenUpdating = True
    Call SuchenKasseV2
    UserForm_Initialize
End Sub

Sub loeschen2() 'v1.42
    Dim l(1 To 2) As Long
    Dim strMsg As String
    On Error Resume Next
    Application.ScreenUpdating = False
    With lstKasse
        For l(1) = 0 To lstKasse.ListCount - 1
            If lstKasse.Selected(l(1)) = True Then
                If Not cboAuftragSuchen = "" Then
                    strMsg = MsgBox("M|fffd|chten Sie den Artikel (" + frmKasse.lstKasse.Column(1, l(1)) + ") aus dem Auftrag (" + cboAuftragSuchen + ") l|fffd|schen?", vbYesNo, "Artikel entfernen")
                    If strMsg = vbNo Then
                        lstKasse.Selected(l(1)) = False
                        GoTo weiter
                    End If
                ElseIf Not cbo_Angebot = "" Then
                    strMsg = MsgBox("M|fffd|chten Sie den Artikel (" + frmKasse.lstKasse.Column(1, l(1)) + ") aus dem Angebot (" + cbo_Angebot + ") l|fffd|schen?", vbYesNo, "Artikel entfernen")
                    If strMsg = vbNo Then
                        lstKasse.Selected(l(1)) = False
                        GoTo weiter
                    End If
                End If
                lstKasse.Selected(l) = True
                If Sheets("Reservierungen").Cells(lstKasse.Column(7, l(1)), 10) = "L" Then
                    Sheets("Reservierungen").Rows(lstKasse.Column(7, l(1))).Delete
                    Exit Sub
                End If
            End If
weiter:  Next l(1)
    End With
    With lstKasse
        For l(2) = .ListCount - 1 To 0 Step -1
            If lstKasse.Selected(l(2)) = True Then
                With ThisWorkbook.Worksheets("Reservierungen")
                    .Rows(lstKasse.Column(7, l(2))).Delete
                End With
            End If
        Next l(2)
    End With
    Application.ScreenUpdating = True
    lstKasse.Clear
    If Not cboAuftragSuchen = "" Then
        Call SuchenAuftragV2
    ElseIf Not cbo_Angebot = "" Then
        Call SuchenAngebotNeu
    End If
End Sub

Private Sub txtVKPreisKasse_AfterUpdate()
    lbl_VKPreisKasse.Caption = Format(lbl_VKPreisKasse.Caption, "currency")
End Sub

Sub RAuftraege()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    cboAuftragSuchen.Clear
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Reservierungen").Cells(lngZ, 11).Value = "Auftrag" Then
            objDic(Sheets("Reservierungen").Cells(lngZ, 1).Value) = 0
        End If
    Next
    cboAuftragSuchen.List = objDic.keys
    Set objDic = Nothing
End Sub

Sub RAngebote()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    cbo_Angebot.Clear
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Reservierungen").Cells(lngZ, 11).Value = "Angebot" Then
            objDic(Sheets("Reservierungen").Cells(lngZ, 1).Value) = 0
        End If
    Next
    cbo_Angebot.List = objDic.keys
    Set objDic = Nothing
End Sub

Sub SuchenAuftragV2() '1.44
    Dim arrTmpA, arrTmpB, i, lngSp, Last_Row, n, j As Long
    Dim WertM, WertN, WertB, WertR, WertG, Wert19, Wert7, Zahl As Double
    Dim SuchKriterium As String
    On Error Resume Next
    WertG = 0
    WertB = 0
    WertN = 0
    WertM = 0
    WertR = 0
    Wert19 = 0
    Wert7 = 0
    Zahl = 0
    cboart2.Value = "Auftrag"
    SuchKriterium = cboAuftragSuchen.Text
    lstKasse.Clear
    txtRnr.Value = SuchKriterium
    txt_Fast.Value = "x"
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Reservierungen")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = SuchKriterium Then
                n = n + 1
                If Not arrTmpA(i, 24) = "" Then
                    lngSp = lngSp + 1
                End If
                arrTmpB(1, n) = arrTmpA(i, 2)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                If arrTmpA(i, 28) = "VP" Then
                    If Int(arrTmpA(i, 29)) = arrTmpA(i, 29) Then
                        arrTmpB(3, n) = arrTmpA(i, 29) 'Menge
                    ElseIf CStr(Format(arrTmpA(i, 29), "0.0")) = arrTmpA(i, 29) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 29), "0.0")
                    ElseIf CStr(Format(arrTmpA(i, 29), "0.00")) = arrTmpA(i, 29) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 29), "0.00")
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 29), "0.000")
                    End If
                Else
                    If Int(arrTmpA(i, 7)) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = arrTmpA(i, 7) 'Menge
                    ElseIf CStr(Format(arrTmpA(i, 7), "0.0")) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.0")
                    ElseIf CStr(Format(arrTmpA(i, 7), "0.00")) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.00")
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.000")
                    End If
                End If
                arrTmpB(4, n) = CDbl(arrTmpA(i, 9)) * 100 & "%"
                If arrTmpA(i, 28) = "VP" Then
                    If Not arrTmpA(i, 9) = "" Then
                        arrTmpB(9, n) = arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))) 'MWST
                        arrTmpB(5, n) = Format(arrTmpA(i, 13) * arrTmpA(i, 7), "currency")
                        WertR = WertR + CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        End If
                        WertM = WertM + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        WertN = WertN + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9)))))
                        WertB = WertB + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))))) + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))))
                    Else
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        End If
                        arrTmpB(5, n) = Format(arrTmpA(i, 13) * arrTmpA(i, 7), "currency")
                        arrTmpB(9, n) = arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))) 'MWST
                        WertM = WertM + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        WertB = WertB + (arrTmpA(i, 7) * arrTmpA(i, 13) + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))) 'brutto
                        WertN = WertN + (arrTmpA(i, 7) * arrTmpA(i, 13)) 'netto
                    End If
                Else
                    If Not arrTmpA(i, 9) = "" Then
                        arrTmpB(9, n) = arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))) 'MWST
                        arrTmpB(5, n) = Format(arrTmpA(i, 13), "currency")
                        WertR = WertR + CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        End If
                        WertM = WertM + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        WertN = WertN + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9)))))
                        WertB = WertB + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))))) + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))))
                    Else
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        End If
                        arrTmpB(5, n) = Format(arrTmpA(i, 13), "currency")
                        arrTmpB(9, n) = arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))) 'MWST
                        WertM = WertM + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        WertB = WertB + (arrTmpA(i, 7) * arrTmpA(i, 13) + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))) 'brutto
                        WertN = WertN + (arrTmpA(i, 7) * arrTmpA(i, 13)) 'netto
                    End If
                End If
                arrTmpB(6, n) = CDbl(arrTmpA(i, 12)) * 100 & "%"
                arrTmpB(7, n) = arrTmpA(i, 18)
                arrTmpB(8, n) = i
                arrTmpB(10, n) = CDbl(arrTmpA(i, 7) * arrTmpA(i, 14)) 'Gewicht
                WertG = WertG + arrTmpA(i, 14)
                txt_sperre.Value = lngSp
                txt_LSNr.Value = Sheets("Reservierungen").Cells(CLng(i), 26).Value
                txt_RENr.Value = Sheets("Reservierungen").Cells(CLng(i), 25).Value
                txt_KDID.Value = Sheets("Reservierungen").Cells(CLng(i), 19).Value
                txtAdatum.Value = Sheets("Reservierungen").Cells(CLng(i), 17).Value
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstKasse
                .ColumnCount = 6
                .ColumnWidths = "80;250;50;40;60;20"
                .MultiSelect = fmMultiSelectMulti
                .ListStyle = fmListStyleOption
                .List = arrTmpA
            End With
       End If
    End With
    lbl_Gewicht2.Caption = Format(CDbl(WertG), "0.000") & " kg"
    lbl_sum12.Caption = Format(WertN, "currency")
    lbl_MwStsum.Caption = Format(WertM, "currency")
    If Worksheets("Daten").Range("F36") = "Ja" Then
        Zahl = CLng(WertB / 0.05) * 0.05
        lbl_sum22.Caption = Format(Zahl, "currency")
    Else
        lbl_sum22.Caption = Format(WertB, "currency")
    End If
    lbl_Rabatt.Caption = Format(WertR, "currency")
    txt_MWSTV.Value = Wert19
    txt_MWSTG.Value = Wert7
    Application.ScreenUpdating = True
    Call WKselect_all
    Call Datensaetze
    txt_Fast.Value = ""
    CheckBox2 = True
    cmdMloeschen.Visible = True
End Sub

Sub SumKasseV2() '1.41
    Dim WertG, WertB, WertN, WertM, WertR, WertR2, MWST1, MWST2, Zahl As Double
    Dim i As Long
    On Error Resume Next
    txt_Fast.Value = "x"
    Application.ScreenUpdating = False
    WertG = 0
    WertB = 0
    WertN = 0
    WertM = 0
    WertR = 0
    MWST1 = 0
    MWST2 = 0
    If Not cboAuftragSuchen = "" Or Not cbo_Angebot = "" Then
        For i = 0 To frmKasse.lstKasse.ListCount - 1
            If frmKasse.lstKasse.Selected(i) Then
                If Not Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9) = "" Then
                    WertR2 = 0
                    WertN = WertN + CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value) * (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) - (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value)))
                    WertR2 = CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value) * (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) - (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value)))
                    WertR = WertR + (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value) * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)) - WertR2
                    If chkoMwSt.Value = True Then
                        WertM = 0
                        MWST1 = 0
                        MWST2 = 0
                        WertB = WertB + (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)) - (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value))))
                    Else
                        If CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B2")) Then '19%
                            MWST1 = MWST1 + frmKasse.lstKasse.List(i, 8)
                        ElseIf CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B3")) Then '7%
                            MWST2 = MWST2 + frmKasse.lstKasse.List(i, 8)
                        End If
                        WertM = WertM + frmKasse.lstKasse.List(i, 8)
                        WertB = WertB + (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)) - (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value)))) + frmKasse.lstKasse.List(i, 8)
                    End If
                Else
                    WertN = WertN + CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)
                    If chkoMwSt.Value = True Then
                        WertM = 0
                        MWST1 = 0
                        MWST2 = 0
                        WertB = WertB + CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)
                    Else
                        If CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B2")) Then '19%
                            MWST1 = MWST1 + frmKasse.lstKasse.List(i, 8)
                        ElseIf CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B3")) Then '7%
                            MWST2 = MWST2 + frmKasse.lstKasse.List(i, 8)
                        End If
                        WertM = WertM + frmKasse.lstKasse.List(i, 8)
                        WertB = WertB + (CDbl(Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * Sheets("Reservierungen").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)) + frmKasse.lstKasse.List(i, 8)
                    End If
                End If
                WertG = WertG + frmKasse.lstKasse.List(i, 9)
            End If
        Next i
        lbl_Gewicht2.Caption = Format(CDbl(WertG), "0.000") & " kg"
        lbl_sum12.Caption = Format(WertN + WertR, "currency")
        lbl_MwStsum.Caption = Format(WertM, "currency")
        If Worksheets("Daten").Range("F36") = "Ja" Then
            Zahl = CLng(WertB / 0.05) * 0.05
            lbl_sum22.Caption = Format(Zahl, "currency")
        Else
            lbl_sum22.Caption = Format(WertB, "currency")
        End If
        lbl_Rabatt.Caption = Format(WertR, "currency")
        txt_MWSTV.Value = CDbl(MWST1)
        txt_MWSTG.Value = CDbl(MWST2)
        txt_MWSTV2.Value = Format(MWST1, "currency")
        txt_MWSTG2.Value = Format(MWST2, "currency")
    Else
        For i = 0 To frmKasse.lstKasse.ListCount - 1
            If frmKasse.lstKasse.Selected(i) Then
                If frmKasse.lstKasse.Selected(i) Then
                    If Not Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9) = "" Then
                        WertR2 = 0
                        WertN = WertN + CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value) * (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) - (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value)))
                        WertR2 = CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value) * (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) - (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value)))
                        WertR = WertR + (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)) - WertR2
                        If chkoMwSt.Value = True Then
                            WertM = 0
                            MWST1 = 0
                            MWST2 = 0
                            WertB = WertB + (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)) - (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value))))
                        Else
                            If CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B2")) Then '19%
                                MWST1 = MWST1 + frmKasse.lstKasse.List(i, 8)
                            ElseIf CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B3")) Then '7%
                                MWST2 = MWST2 + frmKasse.lstKasse.List(i, 8)
                            End If
                            WertM = WertM + frmKasse.lstKasse.List(i, 8)
                            WertB = WertB + (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)) - (CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) * CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 9).Value)))) + frmKasse.lstKasse.List(i, 8)
                        End If
                    Else
                        WertN = WertN + CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)
                        If chkoMwSt.Value = True Then
                            WertM = 0
                            MWST1 = 0
                            MWST2 = 0
                            WertB = WertB + CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value)
                        Else
                            If CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B2")) Then '19%
                                MWST1 = MWST1 + frmKasse.lstKasse.List(i, 8)
                            ElseIf CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 12).Value) = CDbl(Worksheets("Daten").Range("B3")) Then '7%
                                MWST2 = MWST2 + frmKasse.lstKasse.List(i, 8)
                            End If
                            WertM = WertM + frmKasse.lstKasse.List(i, 8)
                            WertB = WertB + CDbl(Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 7).Value * Sheets("Kassendaten").Cells(CLng(frmKasse.lstKasse.List(i, 7)), 13).Value) + frmKasse.lstKasse.List(i, 8)
                        End If
                    End If
                    WertG = WertG + frmKasse.lstKasse.List(i, 9)
                End If
            End If
        Next i
        lbl_Gewicht2.Caption = Format(CDbl(WertG), "0.000") & " kg"
        lbl_sum12.Caption = Format(WertN + WertR, "currency")
        lbl_MwStsum.Caption = Format(WertM, "currency")
        If Worksheets("Daten").Range("F36") = "Ja" Then
            Zahl = CLng(WertB / 0.05) * 0.05
            lbl_sum22.Caption = Format(Zahl, "currency")
        Else
            lbl_sum22.Caption = Format(WertB, "currency")
        End If
        lbl_Rabatt.Caption = Format(WertR, "currency")
        txt_MWSTV.Value = CDbl(MWST1)
        txt_MWSTG.Value = CDbl(MWST2)
        txt_MWSTV2.Value = Format(MWST1, "currency")
        txt_MWSTG2.Value = Format(MWST2, "currency")
    End If
    Call ListMakiert
    txt_Fast.Value = ""
    Application.ScreenUpdating = True
End Sub

Sub SuchenAngebotNeu() '1.44
    Dim WertM, WertN, WertB, WertR, WertG, Wert19, Wert7, Zahl As Double
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    Dim SuchKriterium As String
    On Error Resume Next
    WertG = 0
    WertB = 0
    WertN = 0
    WertM = 0
    WertR = 0
    Wert19 = 0
    Wert7 = 0
    cboart2.Value = "Angebot"
    SuchKriterium = cbo_Angebot.Text
    lstKasse.Clear
    txt_Fast.Value = "x"
    txtRnr.Value = SuchKriterium
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Reservierungen")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = SuchKriterium Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 2)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                If arrTmpA(i, 28) = "VP" Then
                    If Int(arrTmpA(i, 29)) = arrTmpA(i, 29) Then
                        arrTmpB(3, n) = arrTmpA(i, 29) 'Menge
                    ElseIf CStr(Format(arrTmpA(i, 29), "0.0")) = arrTmpA(i, 29) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 29), "0.0")
                        ElseIf CStr(Format(arrTmpA(i, 29), "0.00")) = arrTmpA(i, 29) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 29), "0.00")
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 29), "0.000")
                    End If
                Else
                    If Int(arrTmpA(i, 7)) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = arrTmpA(i, 7) 'Menge
                    ElseIf CStr(Format(arrTmpA(i, 7), "0.0")) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.0")
                    ElseIf CStr(Format(arrTmpA(i, 7), "0.00")) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.00")
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.000")
                    End If
                End If
                arrTmpB(4, n) = CDbl(arrTmpA(i, 9)) * 100 & "%"
                If arrTmpA(i, 28) = "VP" Then
                    If Not arrTmpA(i, 9) = "" Then
                        arrTmpB(9, n) = arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))) 'MWST
                        arrTmpB(5, n) = Format(arrTmpA(i, 13) * arrTmpA(i, 7), "currency")
                        WertR = WertR + CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        End If
                        WertM = WertM + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        WertN = WertN + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9)))))
                        WertB = WertB + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))))) + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))))
                    Else
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        End If
                        arrTmpB(5, n) = Format(arrTmpA(i, 13) * arrTmpA(i, 7), "currency")
                        arrTmpB(9, n) = arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))) 'MWST
                        WertM = WertM + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        WertB = WertB + (arrTmpA(i, 7) * arrTmpA(i, 13) + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))) 'brutto
                        WertN = WertN + (arrTmpA(i, 7) * arrTmpA(i, 13)) 'netto
                    End If
                Else
                    If Not arrTmpA(i, 9) = "" Then
                        arrTmpB(9, n) = arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))) 'MWST
                        arrTmpB(5, n) = Format(arrTmpA(i, 13), "currency")
                        WertR = WertR + CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        End If
                        WertM = WertM + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        WertN = WertN + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9)))))
                        WertB = WertB + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))))) + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))))
                    Else
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        End If
                        arrTmpB(5, n) = Format(arrTmpA(i, 13), "currency")
                        arrTmpB(9, n) = arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))) 'MWST
                        WertM = WertM + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        WertB = WertB + (arrTmpA(i, 7) * arrTmpA(i, 13) + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))) 'brutto
                        WertN = WertN + (arrTmpA(i, 7) * arrTmpA(i, 13)) 'netto
                    End If
                End If
                arrTmpB(6, n) = CDbl(arrTmpA(i, 12)) * 100 & "%"
                arrTmpB(7, n) = arrTmpA(i, 18)
                arrTmpB(8, n) = i
                arrTmpB(10, n) = CDbl(arrTmpA(i, 7) * arrTmpA(i, 14)) 'Gewicht
                WertG = WertG + arrTmpA(i, 14)
                txt_KDID.Value = Sheets("Reservierungen").Cells(CLng(i), 19).Value
                txtAdatum.Value = Sheets("Reservierungen").Cells(CLng(i), 17).Value
            End If
        Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 10)
            For i = 1 To 10
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstKasse
               .ColumnCount = 6
               .ColumnWidths = "80;250;50;40;60;20"
               .MultiSelect = fmMultiSelectMulti
                .ListStyle = fmListStyleOption
               .List = arrTmpA
            End With
       End If
    End With
    lbl_Gewicht2.Caption = Format(CDbl(WertG), "0.000") & " kg"
    lbl_sum12.Caption = Format(WertN, "currency")
    lbl_MwStsum.Caption = Format(WertM, "currency")
    If Worksheets("Daten").Range("F36") = "Ja" Then
        Zahl = CLng(WertB / 0.05) * 0.05
        lbl_sum22.Caption = Format(Zahl, "currency")
    Else
        lbl_sum22.Caption = Format(WertB, "currency")
    End If
    lbl_Rabatt.Caption = Format(WertR, "currency")
    Application.ScreenUpdating = True
    Call WKselect_all
    Call Datensaetze
    txt_Fast.Value = ""
    CheckBox2 = True
End Sub

Sub SuchenKasseV2() '1.44
    Dim WertM, WertN, WertB, WertR, WertG, Wert19, Wert7, Zahl As Double
    Dim arrTmpA, arrTmpB, i, Last_Row, n, j As Long
    Dim SuchKriterium As String
    On Error Resume Next
    If Sheets("Kassendaten").Range("K2") = "" Then
        Exit Sub
    Else
        cboart2 = Sheets("Kassendaten").Range("K2")
    End If
    WertG = 0
    WertB = 0
    WertN = 0
    WertM = 0
    WertR = 0
    Wert19 = 0
    Wert7 = 0
    lstKasse.Clear
    txtRnr.Value = SuchKriterium
    txt_Fast.Value = "x"
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Kassendaten")
        Last_Row = .Cells(Rows.Count, 2).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not LCase(arrTmpA(i, 8)) = "" Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 2)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                If arrTmpA(i, 21) = "VP" Then
                    If Int(arrTmpA(i, 22)) = arrTmpA(i, 22) Then
                        arrTmpB(3, n) = arrTmpA(i, 22) 'Menge
                    ElseIf CStr(Format(arrTmpA(i, 22), "0.0")) = arrTmpA(i, 22) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 22), "0.0")
                    ElseIf CStr(Format(arrTmpA(i, 22), "0.00")) = arrTmpA(i, 22) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 22), "0.00")
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 22), "0.000")
                    End If
                Else
                    If Int(arrTmpA(i, 7)) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = arrTmpA(i, 7) 'Menge
                    ElseIf CStr(Format(arrTmpA(i, 7), "0.0")) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.0")
                    ElseIf CStr(Format(arrTmpA(i, 7), "0.00")) = arrTmpA(i, 7) Then
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.00")
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 7), "0.000")
                    End If
                End If
                arrTmpB(4, n) = CDbl(arrTmpA(i, 9)) * 100 & "%"
                If arrTmpA(i, 21) = "VP" Then
                    If Not arrTmpA(i, 9) = "" Then
                        arrTmpB(9, n) = arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))) 'MWST
                        arrTmpB(5, n) = Format(arrTmpA(i, 13) * arrTmpA(i, 7), "currency")
                        WertR = WertR + CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        End If
                        WertM = WertM + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        WertN = WertN + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9)))))
                        WertB = WertB + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))))) + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))))
                    Else
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        End If
                        arrTmpB(5, n) = Format(arrTmpA(i, 13) * arrTmpA(i, 7), "currency")
                        arrTmpB(9, n) = arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))) 'MWST
                        WertM = WertM + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        WertB = WertB + (arrTmpA(i, 7) * arrTmpA(i, 13) + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))) 'Brutto
                        WertN = WertN + (arrTmpA(i, 7) * arrTmpA(i, 13)) 'netto
                    End If
                Else
                    If Not arrTmpA(i, 9) = "" Then
                        arrTmpB(9, n) = arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))) 'MWST
                        arrTmpB(5, n) = Format(arrTmpA(i, 13), "currency")
                        WertR = WertR + CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        End If
                        WertM = WertM + arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12)))
                        WertN = WertN + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9)))))
                        WertB = WertB + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13)) - (CDbl(arrTmpA(i, 13) * arrTmpA(i, 9))))) + (arrTmpA(i, 7) * (CDbl(arrTmpA(i, 13) - (arrTmpA(i, 13) * arrTmpA(i, 9))) * CDbl(arrTmpA(i, 12))))
                    Else
                        If CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B2")) Then '19%
                            Wert19 = Wert19 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        ElseIf CStr(arrTmpA(i, 12)) = CStr(Worksheets("Daten").Range("B3")) Then '7%
                            Wert7 = Wert7 + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        End If
                        arrTmpB(5, n) = Format(arrTmpA(i, 13), "currency")
                        arrTmpB(9, n) = arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))) 'MWST
                        WertM = WertM + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))
                        WertB = WertB + (arrTmpA(i, 7) * arrTmpA(i, 13) + (arrTmpA(i, 7) * (arrTmpA(i, 13) * CDbl(arrTmpA(i, 12))))) 'brutto
                        WertN = WertN + (arrTmpA(i, 7) * arrTmpA(i, 13)) 'netto
                    End If
                End If
                arrTmpB(6, n) = CDbl(arrTmpA(i, 12)) * 100 & "%"
                arrTmpB(7, n) = arrTmpA(i, 17)
                arrTmpB(8, n) = i
                arrTmpB(10, n) = CDbl(arrTmpA(i, 7) * arrTmpA(i, 14)) 'Gewicht
                txt_KDID.Value = Sheets("Kassendaten").Cells(CLng(i), 18).Text
                txtRnr.Value = Sheets("Kassendaten").Cells(CLng(i), 1).Value
                WertG = WertG + arrTmpA(i, 14)
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 10)
             For i = 1 To 10
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstKasse
                 .ColumnCount = 6
                 .ColumnWidths = "80;250;50;40;60;20"
                 .MultiSelect = fmMultiSelectMulti
                 .ListStyle = fmListStyleOption
                 .List = arrTmpA
             End With
        End If
    End With
    lbl_Gewicht2.Caption = Format(CDbl(WertG), "0.000") & " kg"
    lbl_sum12.Caption = Format(WertN + WertR, "currency")
    lbl_MwStsum.Caption = Format(WertM, "currency")
    If Worksheets("Daten").Range("F36") = "Ja" Then
        Zahl = CLng(WertB / 0.05) * 0.05
        lbl_sum22.Caption = Format(Zahl, "currency")
    Else
        lbl_sum22.Caption = Format(WertB, "currency")
    End If
    lbl_Rabatt.Caption = Format(WertR, "currency")
    Application.ScreenUpdating = True
    Call WKselect_all
    txt_Fast.Value = ""
    Datensaetze
    CheckBox2 = True
End Sub

Sub WAschein() 'v1.44
    Dim zeLB, zeTB, spTB, spLB, Farbe, lngW, Pos, azeile, lngKID, lngID, lngrow As Long
    Dim arrTmpA, arrTmpB, i, lngS, Last_Row As Long
    Dim Kopien As Variant
    Dim FDate As String
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    Application.ScreenUpdating = False
    Farbe = 1
    Sheets("Vorlage2").Visible = True
    lngrow = CDbl(Sheets("Vorlage2").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Vorlage2").Rows("7:" & lngrow).Delete
    Range("Vorlage2!A7:G200").Font.Size = 9
    Sheets("Vorlage2").Range("A1") = "Warenentnahmeschein"
    Sheets("Vorlage2").Range("G1") = Format(Date, FDate)
    Sheets("Vorlage2").Range("A3") = "Nummer: " & txtRnr.Value
    If Not frmKasse.txt_KDID.Value = "" Then
        With ThisWorkbook.Sheets("Kunden")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AG" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txt_KDID) Then
                    lngKID = i
                End If
            Next i
        End With
        If Sheets("Kunden").Cells(CDbl(lngKID), 6) = "" Then
            Sheets("Vorlage2").Range("A4") = "Firma: " & Sheets("Kunden").Cells(CDbl(lngKID), 7)
        Else
            Sheets("Vorlage2").Range("A4") = Sheets("Kunden").Cells(CDbl(lngKID), 7) & " " & Sheets("Kunden").Cells(CDbl(lngKID), 6)
        End If
    End If
    Sheets("Vorlage2").Range("A5") = ""
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = ""
    Sheets("Vorlage2").Activate
    zeTB = 7
    lngW = 0
    Pos = 1
    azeile = 0
    '--- selektierte Listboxeintraege in Zellen schreiben
    With frmKasse.lstKasse
        For zeLB = 0 To .ListCount - 1
            If .Selected(zeLB) Then
                If Not cbo_Angebot = "" Or Not cboAuftragSuchen = "" Then
                    If Sheets("Reservierungen").Cells(CDbl(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then GoTo weiter
                Else
                    If Sheets("Kassendaten").Cells(CDbl(frmKasse.lstKasse.List(zeLB, 7)), 10) = "L" Then GoTo weiter
                End If
                With ThisWorkbook.Sheets("Lager")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.lstKasse.List(zeLB, 6)) Then
                            lngID = i
                        End If
                    Next i
                End With
                Sheets("Vorlage2").Cells(zeTB, 1) = Pos
                Sheets("Vorlage2").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Vorlage2").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Vorlage2").Cells(zeTB, 2) = "'" & frmKasse.lstKasse.List(zeLB, 0)
                Sheets("Vorlage2").Cells(zeTB, 2).VerticalAlignment = xlTop
                Sheets("Vorlage2").Cells(zeTB, 3) = Sheets("Lager").Cells(CDbl(lngID), 4)
                Sheets("Vorlage2").Cells(zeTB, 4) = frmKasse.lstKasse.List(zeLB, 1)
                Sheets("Vorlage2").Cells(zeTB, 4).HorizontalAlignment = xlLeft
                Sheets("Vorlage2").Cells(zeTB, 4).VerticalAlignment = xlTop
                Sheets("Vorlage2").Cells(zeTB, 5) = frmKasse.lstKasse.List(zeLB, 2) & " " & Worksheets("Lager").Cells(CDbl(lngID), 12)
                Sheets("Vorlage2").Cells(zeTB, 5).HorizontalAlignment = xlCenter
                Sheets("Vorlage2").Cells(zeTB, 5).VerticalAlignment = xlTop
                If Not cbo_Angebot = "" Or Not cboAuftragSuchen = "" Then
                    If Not Sheets("Reservierungen").Cells(CDbl(frmKasse.lstKasse.List(zeLB, 7)), 23) = "" Then
                        Sheets("Vorlage2").Cells(zeTB, 6) = Sheets("Lagerorte").Cells(Worksheets("Lagerorte").Range("A:A").Find(Sheets("Reservierungen").Cells(CDbl(frmKasse.lstKasse.List(zeLB, 7)), 23).Text, LookIn:=xlValues, MatchCase:=True).Row, 3)
                    Else
                        Sheets("Vorlage2").Cells(zeTB, 6) = Sheets("Lager").Cells(CDbl(lngID), 13)
                    End If
                Else
                    If Not Sheets("Kassendaten").Cells(CDbl(frmKasse.lstKasse.List(zeLB, 7)), 20) = "" Then
                        Sheets("Vorlage2").Cells(zeTB, 6) = Sheets("Lagerorte").Cells(Worksheets("Lagerorte").Range("A:A").Find(Sheets("Kassendaten").Cells(CDbl(frmKasse.lstKasse.List(zeLB, 7)), 20).Text, LookIn:=xlValues, MatchCase:=True).Row, 3)
                    Else
                        Sheets("Vorlage2").Cells(zeTB, 6) = Sheets("Lager").Cells(CDbl(lngID), 13)
                    End If
                End If
                Sheets("Vorlage2").Cells(zeTB, 6).HorizontalAlignment = xlLeft
                Sheets("Vorlage2").Cells(zeTB, 6).VerticalAlignment = xlTop
                Pos = Pos + 1
                zeTB = zeTB + 1
weiter:
            End If
        Next
    End With
    Farbe = 0
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        For spLB = 0 To CDbl(Pos) - 1
            If Farbe = 1 Then
                Sheets("Vorlage2").Range("A" & 7 + spLB & ":G" & 7 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Vorlage2").Range("A" & 7 + spLB & ":G" & 7 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    Sheets("Vorlage2").Cells(zeTB + 2, 1) = "Entnahme durch: "
    Sheets("Vorlage2").Cells(zeTB + 2, 1).Font.Size = 11
    Sheets("Vorlage2").Cells(zeTB + 4, 1) = "...................................................................."
    Sheets("Vorlage2").Cells(zeTB + 5, 1) = "(Name/ Mitarbeiter)"
    Sheets("Vorlage2").Cells(zeTB + 5, 1).Font.Size = 11
    Kopien = Application.InputBox("Anzahl Kopien", "Warenentnahme drucken", 1)
    If Kopien = False Then
        Application.ScreenUpdating = True
        Exit Sub
    End If
    Worksheets("Vorlage2").PrintOut Copies:=CLng(Kopien)
    MsgBox "WA-Schein wird gedruckt!", , "Warenentnahmeschein"
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Sub ListMakiert()
    Dim nSelCount, l, lngCount As Long
    On Error Resume Next
    lngCount = lstKasse.ListCount
    Application.ScreenUpdating = False
    With lstKasse
        For l = 0 To .ListCount - 1
          If .Selected(l) Then
            nSelCount = nSelCount + 1
          End If
        Next
    End With
    Application.ScreenUpdating = True
    If nSelCount = 1 Then
        cmdMloeschen.Visible = True
        cmdMloeschen.Caption = "Markierte Position l|fffd|schen"
        If Not cboart2 = "Intern" Or Not cboart2 = "Rechnung" Or Not cboart2 = "Barverkauf" Then
            cmdMengeaendern.Visible = True
            cmdMengeaendern.Caption = "Menge |fffd|ndern"
        End If
    ElseIf nSelCount > 1 And nSelCount < lngCount Then
        cmdMloeschen.Visible = True
        cmdMloeschen.Caption = "Markierte Positionen l|fffd|schen"
        cmdMengeaendern.Visible = False
    Else
        cmdMloeschen.Visible = False
        cmdMengeaendern.Visible = True
        cmdMengeaendern.Caption = "Mengen |fffd|ndern"
    End If
End Sub

Sub Datensaetze()
    On Error Resume Next
    ThisWorkbook.Activate
    If CDbl(lstKasse.ListCount) = 0 Then
        lbl_datensaetze.Caption = ""
    ElseIf CDbl(lstKasse.ListCount) > 1 Then
        lbl_datensaetze.Caption = lstKasse.ListCount & " Datens|fffd|tze gefunden"
    Else
        lbl_datensaetze.Caption = lstKasse.ListCount & " Datensatz gefunden"
    End If
End Sub
Attribute VB_Name = "frmKasseWA"
Attribute VB_Base = "0{C294D273-CCE4-4526-A7EB-12540D415655}{7C7FF2C3-2109-4022-BB12-944012AAE35C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim lngKID, lngID As Long
    Dim sngTop, sngLeft As Single
    Dim Last_Row, arrTmpA, arrTmpB, i As Long
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    frmKasse.txt_VerZweWA.Value = ""
    frmKasse.txt_KostenWA.Value = ""
    frmKasse.txt_StatusWA.Value = ""
    txt_WADatum.Value = Format(Date, "DD.MM.YYYY")
    If Not frmKasse.txt_KDID = "" Then
        With ThisWorkbook.Sheets("Kunden")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AG" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.txt_KDID) Then
                    lngKID = i
                End If
            Next i
        End With
        If Not frmKasse.txt_KDID.Value = "" Then
            frmKasseWA.txt_KDNr.Value = Worksheets("Kunden").Cells(CDbl(lngKID), 3)
            If Worksheets("Kunden").Cells(CDbl(lngKID), 4) = "Firma" Then
                frmKasseWA.txt_Kunde.Value = "Firma " & Worksheets("Kunden").Cells(CDbl(lngKID), 7)
            Else
                frmKasseWA.txt_Kunde.Value = Worksheets("Kunden").Cells(CDbl(lngKID), 6) & " " & Worksheets("Kunden").Cells(CDbl(lngKID), 7)
            End If
        End If
    End If
    cbo_kosten = "Keine Auswahl"
    Call Kostenstellen
End Sub

Private Sub cbo_kosten_Change()
    If Not cbo_kosten = "" Then
        If Check_LSprint.Value = True Or Check_REprint.Value = True Then
            lbl_PrintKostenstelle.Enabled = True
            Check_PrintKostenstelle.Enabled = True
            Check_PrintKostenstelle.Value = True
        Else
            lbl_PrintKostenstelle.Enabled = False
            Check_PrintKostenstelle.Enabled = False
            Check_PrintKostenstelle.Value = False
        End If
    Else
        Check_PrintKostenstelle.Value = False
        lbl_PrintKostenstelle.Enabled = False
        Check_PrintKostenstelle.Enabled = False
    End If
End Sub

Private Sub Check_auto_Change()
    If Check_auto.Value = True Then
        cmd_REAUF.Visible = False
    End If
    If Not txt_Verleih = "" Then
        cmd_REAUF.Visible = True
        cmd_REAUF.Caption = "Rechnungsnummer = Verleih-Nr."
    End If
End Sub

Private Sub cmd_REAUF_Click()
    If Not txt_Verleih.Value = "" Then
        txt_Nummer.Value = frmVInfo.txt_VNr.Text
        Exit Sub
    End If
    If txt_Art = "AUSBU" Then
        txt_Nummer.Value = frmKasse.txtRnr
        If Check_LSprint.Value = True Then
            txt_LSNr.Value = frmKasse.txtRnr
        End If
    ElseIf txt_Art = "LS" Then
        If Check_LSprint.Value = True Then
            txt_LSNr.Value = frmKasse.txtRnr
        End If
    ElseIf txt_Art = "LSPDF" Then
        If Check_LSprint.Value = True Then
            txt_LSNr.Value = frmKasse.txtRnr
        End If
    Else
        If Check_LSprint.Value = True Then
            txt_LSNr.Value = frmKasse.txt_LSNr
        Else
            txt_Nummer.Value = frmKasse.txtRnr
        End If
    End If
End Sub

Private Sub txt_art_Change()
    Call FNummern
End Sub

Private Sub txt_nummer_AfterUpdate() '1.44
    Dim lng As Long
    Dim strRN As String
    Dim Last_Row, arrTmpA, arrTmpB, i As Long
    On Error Resume Next
    If Not txt_Nummer = "" And frmKasse.lstKasse.ListCount = 0 And frmKasse.cboart2 = "Auftrag" Or frmKasse.cboart2 = "Rechnung" Then
        With ThisWorkbook.Sheets("Warenausgang")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AG" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) = CStr(txt_Nummer) Then
                    lng = i
                End If
            Next i
        End With
        If lng > 0 Then
            strRN = MsgBox("Rechnungsnummer " + (txt_Nummer) + " wurde bereits erfasst! M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
            If strRN = vbNo Then
                txt_Nummer.Value = ""
                txt_Nummer.SetFocus
                Exit Sub
            End If
        End If
    End If
    If Not txt_Nummer = "" Then
        txt_Nummer.BorderColor = &HC000&
    Else
        txt_Nummer.BorderColor = &HFF&
    End If
End Sub

Private Sub txt_nummer_Change()
    If Not txt_Nummer.Value = "" Then
        txt_Nummer.BorderColor = &HC000&
    Else
        txt_Nummer.BorderColor = &HFF&
    End If
End Sub

Sub FNummern()
    Dim strF As String
    Dim lngID As Long
    Dim Last_Row, arrTmpA, arrTmpB, i As Long
    On Error Resume Next
    If frmKasse.cboart2 = "Intern" Then
        txt_Nummer.Value = "INTERN" & Format(Date, "YYDDMM") & Format(Now, "HHMMSS")
        Exit Sub
    End If
    If txt_Art = "RE" Or txt_Art = "REPDF" Or txt_Art = "AUSBU" Then
        If Sheets("Daten").Range("D23").Value = "Nein" Or Sheets("Daten").Range("D23").Value = "" Then
            Check_auto.Enabled = False
        Else
            Check_auto.Value = True
            If frmKasse.txt_RENr = "" Then
                If Sheets("Daten").Range("B5").Value = "True" Then
                    If Not Sheets("Daten").Range("B7").Value = "Admin" Then
                        txt_Nummer.Enabled = False
                    End If
                End If
                If Sheets("Daten").Range("D23").Value = "Auswahl 2" Then
                    With ThisWorkbook.Sheets("Kunden")
                        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AG" & Last_Row)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.txt_KDID) Then
                                lngID = i
                            End If
                        Next i
                    End With
                    If Worksheets("Kunden").Cells(CLng(lngID), 6) = "" Then
                        txt_Nummer.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & Format(Date, "YYYYMMDD")
                    Else
                        txt_Nummer.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & "_" & UCase(Worksheets("Kunden").Cells(CLng(lngID), 6)) & Format(Date, "YYYYMMDD")
                    End If
                Else
                    strF = Sheets("Daten").Range("D26")
                    txt_Nummer.Value = Sheets("Daten").Range("D24") & Format((Sheets("Daten").Range("D25") + 1), strF)
                End If
            End If
        End If
    End If
    If txt_Art = "AUSBU" Or txt_Art = "LS" Or txt_Art = "LSPDF" Then
        If Sheets("Daten").Range("F23").Value = "Nein" Or Sheets("Daten").Range("F23").Value = "" Then
            Check_auto.Enabled = False
        Else
            Check_auto.Value = True
            If frmKasse.txt_LSNr = "" Then
                If Sheets("Daten").Range("B5").Value = "True" Then
                    If Not Sheets("Daten").Range("B7").Value = "Admin" Then
                        txt_Nummer.Enabled = False
                    End If
                End If
                If Sheets("Daten").Range("F23").Value = "Auswahl 2" Then
                    With ThisWorkbook.Sheets("Kunden")
                        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AG" & Last_Row)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(frmKasse.txt_KDID) Then
                                lngID = i
                            End If
                        Next i
                    End With
                    If txt_Art = "AUSBU" Then
                        If Worksheets("Kunden").Cells(CLng(lngID), 6) = "" Then
                            txt_LSNr.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & Format(Date, "YYYYMMDD")
                        Else
                            txt_LSNr.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & "_" & UCase(Worksheets("Kunden").Cells(CLng(lngID), 6)) & Format(Date, "YYYYMMDD")
                        End If
                    Else
                        If Worksheets("Kunden").Cells(CLng(lngID), 6) = "" Then
                            txt_LSNr.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & Format(Date, "YYYYMMDD")
                        Else
                            txt_LSNr.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & "_" & UCase(Worksheets("Kunden").Cells(CLng(lngID), 6)) & Format(Date, "YYYYMMDD")
                        End If
                    End If
                Else
                    strF = Sheets("Daten").Range("F26")
                    If txt_Art = "AUSBU" Then
                        txt_LSNr.Value = Sheets("Daten").Range("F24") & Format((Sheets("Daten").Range("F25") + 1), strF)
                    Else
                        txt_LSNr.Value = Sheets("Daten").Range("F24") & Format((Sheets("Daten").Range("F25") + 1), strF)
                    End If
                End If
            End If
        End If
    End If
End Sub

Private Sub Check_LSprint_Click()
    If Check_LSprint = True Then
        If Not cbo_kosten = "" Then Check_PrintKostenstelle.Enabled = True
        If Not cbo_kosten = "" Then lbl_PrintKostenstelle.Enabled = True
    Else
        If Not Check_REprint = True Then
            Check_PrintKostenstelle.Enabled = False
            lbl_PrintKostenstelle.Enabled = False
        End If
    End If
    If Check_REprint = True And Check_LSprint = True Then
        txt_RL.Value = "RL"
    Else
        txt_RL.Value = ""
    End If
    If Check_LSprint.Value = True Then
        txt_LSNr.Visible = True
        lbl_Liefernr.Visible = True
    Else
        txt_LSNr.Visible = False
        lbl_Liefernr.Visible = False
    End If
End Sub

Private Sub Check_REprint_Change()
    If Check_LSprint.Value = True Then
        txt_LSNr.Visible = True
        lbl_Liefernr.Visible = True
    Else
        txt_LSNr.Visible = False
        lbl_Liefernr.Visible = False
    End If
End Sub

Private Sub Check_REprint_Click()
    If Check_REprint.Value = True Then
        If Not cbo_kosten = "" Then Check_PrintKostenstelle.Enabled = True
        If Not cbo_kosten = "" Then lbl_PrintKostenstelle.Enabled = True
    Else
         If Not Check_LSprint = True Then
            Check_PrintKostenstelle.Enabled = False
            lbl_PrintKostenstelle.Enabled = False
        End If
    End If
    If Check_REprint = True And Check_LSprint = True Then
        txt_RL.Value = "RL"
    Else
        txt_RL.Value = ""
    End If
End Sub

Private Sub cmd_WACalenda_Click()
    frmKalender.txt_UID = "WADA"
    frmKalender.Show
End Sub

Private Sub cmd_weiter_Click() 'v1.42
    Dim strF, strVNR, strNr As String
    On Error Resume Next
    If frmKasseWA.Check_LSprint.Value = True And txt_LSNr.Value = "" Then
        MsgBox "Geben Sie bitte eine Lieferscheinnummer an!", , "Lieferschein"
        txt_LSNr.SetFocus
        Exit Sub
    End If
    If txt_Art = "LSPDF" Then
        If txt_LSNr.Value = "" Then
            MsgBox "Bitte geben Sie eine Lieferscheinnummer an!", , "Hinweis"
            txt_LSNr.SetFocus
            Exit Sub
        End If
        frmContact.Caption = "Lieferschein als PDF"
        frmKasse.txt_OpLieferschein.Value = "PDF"
        frmContact.txt_RL.Value = ""
        frmContact.cmdnextL.Caption = "Speichern (.pdf)"
        Call frmKasse.Lieferschein
        Unload frmKasseWA
        Exit Sub
    ElseIf txt_Art = "LS" Then
        If txt_LSNr.Value = "" Then
            MsgBox "Bitte geben Sie eine Lieferscheinnummer an!", , "Hinweis"
            txt_LSNr.SetFocus
            Exit Sub
        End If
        frmContact.Caption = "Lieferschein drucken"
        frmKasse.txt_OpLieferschein.Value = "Print"
        frmContact.cmdnextL.Caption = "Drucken"
        frmContact.txt_RL.Value = ""
        Call frmKasse.Lieferschein
        Unload frmKasseWA
        Exit Sub
    ElseIf txt_Art = "REPDF" Then
        If txt_Nummer.Value = "" Then
            MsgBox "Bitte geben Sie eine Rechnungsnummer (Beleg) an!", , "Hinweis"
            txt_Nummer.SetFocus
            Exit Sub
        End If
        frmKasse.txt_OpRechnung.Value = "PDF"
        frmContact.Caption = "Rechnung als PDF"
        frmContact.txt_RL.Value = ""
        frmContact.cmd_invoiceprint.Caption = "Speichern (.pdf)"
        Call frmKasse.Invoice
        Unload frmKasseWA
        Exit Sub
    ElseIf txt_Art = "RE" Then
        If txt_Nummer.Value = "" Then
            MsgBox "Bitte geben Sie eine Rechnungsnummer (Beleg) an!", , "Hinweis"
            txt_Nummer.SetFocus
            Exit Sub
        End If
        frmKasse.txt_OpRechnung.Value = "Print"
        frmContact.Caption = "Rechnung drucken"
        frmContact.txt_RL.Value = ""
        frmContact.cmd_invoiceprint.Caption = "Drucken"
        Call frmKasse.Invoice
        Unload frmKasseWA
        Exit Sub
    End If
    If Sheets("Daten").Range("B35") = "Ja" And cbo_kosten = "" Then
        MsgBox "Sie m|fffd|ssen eine Kostenstelle angeben", , "Kostenstelle"
        cbo_kosten.SetFocus
        Application.ScreenUpdating = True
        Exit Sub
    End If
    If txt_Verleih.Value = "Verleih" Then
        If txt_Nummer.Value = "" Then
            MsgBox "Bitte geben Sie eine Rechnungsnummer (Beleg) an!", , "Hinweis"
            txt_Nummer.SetFocus
            Exit Sub
        End If
        strF = Sheets("Daten").Range("D26")
        strNr = Format((Sheets("Daten").Range("D25") + 1), strF)
        strVNR = CStr(Sheets("Daten").Range("D24")) & strNr
        If CStr(txt_Nummer) = strVNR Then
            Sheets("Daten").Range("D25") = "'" & strNr
        End If
        Call frmVInfo.VREinlagern
        Exit Sub
    End If
    If txt_Nummer.Value = "" Then
        MsgBox "Bitte geben Sie eine Rechnungsnummer (Beleg) an!", , "Hinweis"
        txt_Nummer.SetFocus
        Exit Sub
    End If
    If txt_RL.Value = "RL" Then
        frmContact.Caption = "Rechnung & Lieferschein drucken"
        frmKasse.txt_PrintRE.Value = "WA"
        frmKasse.txt_PrintLS.Value = "WA"
        frmKasse.txt_OpRechnung.Value = "Print"
        frmKasse.txt_OpLieferschein.Value = "Print"
        frmContact.cmd_invoiceprint.Caption = "Drucken"
        frmContact.txt_RL.Value = txt_RL.Value
        Call frmKasse.Invoice
    Else
        If Check_LSprint = True Then
            frmKasse.txt_PrintLS.Value = "WA"
            frmContact.Caption = "Lieferschein drucken"
            frmKasse.txt_OpLieferschein.Value = "Print"
            frmContact.cmdnextL.Caption = "Drucken"
            Call frmKasse.Lieferschein
        End If
    End If
    frmKasse.txt_KostenWA.Value = frmKasseWA.cbo_kosten
    frmKasse.txt_StatusWA.Value = frmKasseWA.cbo_Status
    If frmKasseWA.txt_WADatum.Value = "" Then
        frmKasse.txt_WADatum.Value = Date
    Else
        frmKasse.txt_WADatum.Value = CDate(frmKasseWA.txt_WADatum.Value)
    End If
    If Not frmKasseWA.txt_VerwWA.Value = "" Then
        frmKasse.txt_VerZweWA.Value = frmKasseWA.txt_VerwWA.Value
    End If
    frmKasse.txt_RENr.Value = txt_Nummer
    frmKasse.txt_LSNr.Value = txt_LSNr
    Call frmKasse.KasseWA
    Unload frmKasseWA
End Sub

Private Sub cmdchanel_Click()
    frmKasse.txt_VerZweWA.Value = ""
    frmKasse.txt_KostenWA.Value = ""
    frmKasse.txt_StatusWA.Value = ""
    Unload frmKasseWA
End Sub

Private Sub txt_WADatum_Change()
    On Error Resume Next
    If CDate(txt_WADatum) <> Date Then
        txt_WADatum.ForeColor = &HFF&
    Else
        txt_WADatum.ForeColor = &H404040
    End If
    If txt_WADatum.Value = "" Then
        txt_WADatum.BackColor = &HFF&
    Else
        txt_WADatum.BackColor = &H80000005
    End If
End Sub

Sub Kostenstellen() '1.41
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    cbo_kosten.Clear
    With cbo_kosten
        ALetzte = Sheets("Kostenstellen").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not IsEmpty(Sheets("Kostenstellen").Cells(irow, 1)) Then
                xKey = Sheets("Kostenstellen").Cells(irow, 1).Value & " / " & Sheets("Kostenstellen").Cells(irow, 2).Value
                DIC(xKey) = 0
            End If
        Next
        cbo_kosten.AddItem ""
        For Each xKey In DIC
            cbo_kosten.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_kosten.ListIndex = -1
    End With
End Sub
Attribute VB_Name = "frmKunden"
Attribute VB_Base = "0{A428BC4A-71E3-4F71-836A-D2C094204128}{346DE7C0-9FB7-4F35-8251-61809EA57D22}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim i, aRow As Long
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
     Application.ScreenUpdating = False
    lbl_kinfo.Caption = WorksheetFunction.CountA(Sheets("Kunden").Range("A:A")) - 1 & " Kunden vorhanden"
    aRow = Sheets("Kunden").Cells(Rows.Count, 1).End(xlUp).Row
    For i = 2 To aRow
        If Sheets("Kunden").Cells(i, 4) = "Firma" Then
            cboKDNr.AddItem Sheets("Kunden").Cells(i, 4) & " " & Sheets("Kunden").Cells(i, 7)
        Else
            cboKDNr.AddItem Sheets("Kunden").Cells(i, 7) & ", " & Sheets("Kunden").Cells(i, 6)
        End If
    Next i
    chk_Keine.Value = True
    With cboanrede
        .AddItem "Herr"
        .AddItem "Frau"
        .AddItem "Firma"
    End With
    With cbomonat
        .AddItem "Januar"
        .AddItem "Februar"
        .AddItem "M|fffd|rz"
        .AddItem "April"
        .AddItem "Mai"
        .AddItem "Juni"
        .AddItem "Juli"
        .AddItem "August"
        .AddItem "September"
        .AddItem "Oktober"
        .AddItem "November"
        .AddItem "Dezember"
    End With
    With cbomonatV
        .AddItem "Januar"
        .AddItem "Februar"
        .AddItem "M|fffd|rz"
        .AddItem "April"
        .AddItem "Mai"
        .AddItem "Juni"
        .AddItem "Juli"
        .AddItem "August"
        .AddItem "September"
        .AddItem "Oktober"
        .AddItem "November"
        .AddItem "Dezember"
    End With
    Application.ScreenUpdating = True
    Call DatumHis
    Call DatumVer
    If cboKDNr = "" Then
        lstKunden.Clear
        lbl_Gesamt.Caption = ""
    End If
    Call Datensaetze
    If Not Sheets("Daten").Range("B48").Value = "" Then
        lbl_LKNr.Caption = "Letzte vergebene Nr.: " & Sheets("Daten").Range("B48").Value
    Else
        lbl_LKNr.Caption = ""
    End If
    txt_Snachnamen.SetFocus
End Sub

Private Sub cboJahr_Change()
    If Not cbojahr = "" Then
        cbomonat.Enabled = True
        cbomonat = ""
    Else
        cbomonat.Enabled = False
    End If
End Sub

Private Sub cboJahr_Click()
    Call KundenJahr
End Sub

Private Sub cbojahrVer_Click()
     If Not cbojahrVer = "" Then
        cbomonatV.Enabled = True
        cbomonatV = ""
    Else
        cbomonatV.Enabled = False
    End If
    Call VHsuchenNeu
End Sub

Private Sub cbomonatV_Click()
    Call VHsuchenNeu
End Sub

Private Sub Chk_Ksperren_Click()
    If Not txtKDID = "" Then
        If Chk_Ksperren.Value = True And Me.txt_sperren = "" Then
            lbl_status.Caption = "Bitte speichern Sie den Kunden, um die |fffd|nderung zu |fffd|bernehmen!"
            lbl_status.Visible = True
        ElseIf Chk_Ksperren.Value = False And Me.txt_sperren = "x" Then
            lbl_status.Caption = "Bitte speichern Sie den Kunden, um die |fffd|nderung zu |fffd|bernehmen!"
            lbl_status.Visible = True
        Else
            lbl_status.Visible = False
        End If
        lbl_status.BackColor = &HC0&
        lbl_status.BorderColor = &HC0&
    End If
End Sub

Private Sub cmd_HisAlle_Click()
    Call Belegesuchen
End Sub

Private Sub cmd_Valle_Click()
    cbomonatV = ""
    Call VHsuchenNeu
End Sub

Sub VHsuchenNeu() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next
    If txtKDID.Value = "" Then Exit Sub
    BoxListe = "Verleih_Historie"
    list_HVerleih.BackColor = &H80000005
    Application.ScreenUpdating = False
    If Not cbojahrVer = "" And Not cbomonatV = "" Then
        list_HVerleih.Clear
        With ThisWorkbook.Sheets(BoxListe)
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:U" & Last_Row)
           ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If arrTmpA(i, 2) = CStr(txtKDID) And arrTmpA(i, 17) = CStr(cbomonatV) And arrTmpA(i, 18) = CStr(cbojahrVer) Then
                   n = n + 1
                   arrTmpB(1, n) = arrTmpA(i, 1)
                   arrTmpB(2, n) = arrTmpA(i, 10)
                   arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 7)), Chr$(13) & Chr$(10), " ")
                   arrTmpB(4, n) = Format(CDbl(arrTmpA(i, 12)), "currency")
                   arrTmpB(5, n) = arrTmpA(i, 17)
                   arrTmpB(6, n) = arrTmpA(i, 16)
                   arrTmpB(7, n) = i
               End If
           Next i
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 7)
                For i = 1 To 7
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With list_HVerleih
                   .ColumnCount = 6
                   .ColumnWidths = "80;27;185;60;55;50;0"
                   .List = arrTmpA
                End With
           End If
        End With
    ElseIf Not cbomonatV = "" Then
        With ThisWorkbook.Sheets(BoxListe)
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:U" & Last_Row)
           ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If arrTmpA(i, 2) = CStr(txtKDID) And arrTmpA(i, 17) = CStr(cbomonatV) Then
                   n = n + 1
                   arrTmpB(1, n) = arrTmpA(i, 1)
                   arrTmpB(2, n) = arrTmpA(i, 10)
                   arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 7)), Chr$(13) & Chr$(10), " ")
                   arrTmpB(4, n) = Format(CDbl(arrTmpA(i, 12)), "currency")
                   arrTmpB(5, n) = arrTmpA(i, 17)
                   arrTmpB(6, n) = arrTmpA(i, 16)
                   arrTmpB(7, n) = i
               End If
           Next i
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 7)
                For i = 1 To 7
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With list_HVerleih
                   .ColumnCount = 6
                   .ColumnWidths = "80;27;185;60;55;50;0"
                   .List = arrTmpA
                End With
           End If
        End With
    Else
        With ThisWorkbook.Sheets(BoxListe)
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:U" & Last_Row)
           ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If arrTmpA(i, 2) = CStr(txtKDID) Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 1)
                    arrTmpB(2, n) = arrTmpA(i, 10)
                    arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 7)), Chr$(13) & Chr$(10), " ")
                    If arrTmpA(i, 12) = "" Then
                        arrTmpB(4, n) = Format(0, "currency")
                    Else
                        arrTmpB(4, n) = Format(CDbl(arrTmpA(i, 12)), "currency")
                    End If
                    arrTmpB(5, n) = arrTmpA(i, 17)
                    arrTmpB(6, n) = arrTmpA(i, 16)
                    arrTmpB(7, n) = i
               End If
           Next i
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 7)
                For i = 1 To 7
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With list_HVerleih
                   .ColumnCount = 6
                   .ColumnWidths = "80;27;185;60;55;50;0"
                   .List = arrTmpA
                End With
           End If
        End With
    End If
    If list_HVerleih.ListCount > 0 Then
        cmd_VHBelegPrint.Visible = True
    Else
        cmd_VHBelegPrint.Visible = False
    End If
    Application.ScreenUpdating = True
    Call Datensaetze
End Sub

Private Sub cmd_VHBelegPrint_Click()
    Dim lngIndex, Farbe, lngID As Long
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    On Error Resume Next

    Application.ScreenUpdating = False
    Sheets("Vorlage2").Visible = True
    Sheets("Vorlage2").Activate
    Sheets("Vorlage2").Range("A7:G500").Delete

    If Not cbojahrVer = "" And Not cbomonatV = "" Then
        Sheets("Vorlage2").Range("A1") = "Verleih-Historie (" & cbomonatV & " " & cbojahrVer & ")"
    ElseIf Not cbojahrVer = "" And cbomonatV = "" Then
        Sheets("Vorlage2").Range("A1") = "Verleih-Historie " & cbojahrVer
    Else
        Sheets("Vorlage2").Range("A1") = "Verleih-Historie"
    End If
    Sheets("Vorlage2").Range("A3") = "(" & CStr(txt_KDNr) & ") " & cboKDNr
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("D6") = "Beleg"
    Sheets("Vorlage2").Range("B6") = "Artikel Nr."
    Sheets("Vorlage2").Range("G1") = Format(Date, "DD.MM.YYYY")
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("B6") = "Beleg"
    Sheets("Vorlage2").Range("C6") = ""
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Preis"
    Sheets("Vorlage2").Range("G6") = "Datum"
    Farbe = 1
    For lngIndex = 0 To list_HVerleih.ListCount - 1
        Range("A300").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = "'" & CDbl(lngIndex) + 1
        ActiveCell.Offset(0, 1).Value = "'" & list_HVerleih.Column(0, lngIndex) 'Beleg
        ActiveCell.Offset(0, 1).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 1).HorizontalAlignment = xlLeft
        ActiveCell.Offset(0, 2).Value = Sheets("Verleih_Historie").Cells(list_HVerleih.Column(6, lngIndex), 13) & " - " & Sheets("Verleih_Historie").Cells(list_HVerleih.Column(6, lngIndex), 14)
        ActiveCell.Offset(0, 2).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 3).Value = list_HVerleih.Column(2, lngIndex) 'Beschreibung
        ActiveCell.Offset(0, 3).WrapText = True
        ActiveCell.Offset(0, 3).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 4).Value = list_HVerleih.Column(1, lngIndex) 'Menge
        ActiveCell.Offset(0, 4).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 4).HorizontalAlignment = xlCenter
        ActiveCell.Offset(0, 5).Value = list_HVerleih.Column(3, lngIndex) 'Monat
        ActiveCell.Offset(0, 5).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 6).Value = list_HVerleih.Column(5, lngIndex) 'Datum
        ActiveCell.Offset(0, 6).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 6).HorizontalAlignment = xlLeft
    Next
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For lngIndex = 0 To list_HVerleih.ListCount - 1
            If Farbe = 1 Then
                Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
                Farbe = 1
            End If
        Next
    End If
    Worksheets("Vorlage2").PrintOut
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    MsgBox "Ausdruck erfolgt!", vbOKOnly, cboKDNr
End Sub

Private Sub cmd_VKBelegPrint_Click()
    Dim lngIndex, Farbe, lngID As Long
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    On Error Resume Next

    Application.ScreenUpdating = False
    Sheets("Vorlage2").Visible = True
    Sheets("Vorlage2").Activate
    Sheets("Vorlage2").Range("A7:G500").Delete

    If Not cbojahr = "" And Not cbomonat = "" Then
        Sheets("Vorlage2").Range("A1") = "Verkaufshistorie (" & cbomonat & " " & cbojahr & ")"
    ElseIf Not cbojahr = "" And cbomonat = "" Then
        Sheets("Vorlage2").Range("A1") = "Verkaufshistorie " & cbojahr
    Else
        Sheets("Vorlage2").Range("A1") = "Verkaufshistorie"
    End If
    Sheets("Vorlage2").Range("A3") = "(" & CStr(txt_KDNr) & ") " & cboKDNr
    Sheets("Vorlage2").Range("A4") = "(" & lbl_Gesamt & ")"
    Sheets("Vorlage2").Range("D6") = "Beleg"
    Sheets("Vorlage2").Range("B6") = "Artikel Nr."
    Sheets("Vorlage2").Range("G1") = Format(Date, "DD.MM.YYYY")
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("B6") = "Beleg"
    Sheets("Vorlage2").Range("C6") = ""
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Preis"
    Sheets("Vorlage2").Range("G6") = "Datum"
    Farbe = 1
    For lngIndex = 0 To lstKunden.ListCount - 1
        Range("A300").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = "'" & CDbl(lngIndex) + 1
        ActiveCell.Offset(0, 1).Value = "'" & lstKunden.Column(0, lngIndex) 'Beleg
        ActiveCell.Offset(0, 1).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 1).HorizontalAlignment = xlLeft
        ActiveCell.Offset(0, 2).Value = "" 'Frei
        ActiveCell.Offset(0, 2).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 3).Value = lstKunden.Column(2, lngIndex) 'Beschreibung
        ActiveCell.Offset(0, 3).WrapText = True
        ActiveCell.Offset(0, 3).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 4).Value = lstKunden.Column(1, lngIndex) 'Menge
        ActiveCell.Offset(0, 4).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 4).HorizontalAlignment = xlCenter
        ActiveCell.Offset(0, 5).Value = lstKunden.Column(3, lngIndex) 'Monat
        ActiveCell.Offset(0, 5).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 6).Value = lstKunden.Column(5, lngIndex) 'Datum
        ActiveCell.Offset(0, 6).VerticalAlignment = xlTop
        ActiveCell.Offset(0, 6).HorizontalAlignment = xlLeft
    Next
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For lngIndex = 0 To lstKunden.ListCount - 1
            If Farbe = 1 Then
                Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Vorlage2").Range("A" & 7 + lngIndex & ":G" & 7 + lngIndex).Select
                Farbe = 1
            End If
        Next
    End If
    Worksheets("Vorlage2").PrintOut
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    MsgBox "Ausdruck erfolgt!", vbOKOnly, cboKDNr
End Sub

Private Sub lstKunden_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    If Not txtKDID = "" And Not lstKunden.ListCount = 0 Then
        Call frmInfoKasse.KundenRELSSuchen
        frmInfoKasse.Fra_Kunden.Left = 0
        frmInfoKasse.Show
    End If
End Sub

Private Sub txt_Snachnamen_Change()
    If txt_Snachnamen.TextLength > 2 Then
        Call KASuchen
    End If
End Sub

Private Sub txtKDID_Change()
    lbl_status.Visible = False
    If Not txtKDID = "" Then
        Chk_Ksperren.Visible = True
        lbl_gesperrt.Visible = True
    Else
        Chk_Ksperren.Visible = False
        lbl_gesperrt.Visible = False
    End If
End Sub

Private Sub chk_Bar_Click()
    If chk_Bar.Value = True Then
        chk_Sofort.Value = False
        chk_Voraus.Value = False
        chk_KFuss.Value = False
        chk_Keine.Value = False
        txt_Fusszeile = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer."
    End If
End Sub

Private Sub chk_Keine_Click()
    If chk_Keine.Value = True Then
        chk_Voraus.Value = False
        chk_Sofort.Value = False
        chk_Bar.Value = False
        chk_KFuss.Value = False
        txt_Fusszeile = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer."
    End If
End Sub

Private Sub Chk_Ksperren_Change()
    If Chk_Ksperren.Value = True And Not txtKDID.Value = "" Then
        Chk_Ksperren.Value = True
        lbl_gesperrt.ForeColor = &HFF&
        lbl_gesperrt.Caption = "Kunde gesperrt"
    Else
        Chk_Ksperren.Value = False
        lbl_gesperrt.ForeColor = &H404040
        lbl_gesperrt.Caption = "Kunden sperren"
    End If
End Sub

Private Sub chk_KFuss_Click()
    On Error Resume Next
    If chk_KFuss.Value = True Then
        chk_Sofort.Value = False
        chk_Bar.Value = False
        chk_Voraus.Value = False
    End If
    If Not cboKDNr = "" Then
        If chk_Keine.Value = True And chk_KFuss.Value = True Then
            txt_Fusszeile.Locked = False
            lbl_Skonto.Enabled = False
            lbl_TageSk.Enabled = False
            lbl_TageNetto.Enabled = False
            txt_skonto.Enabled = False
            txt_TageSk.Enabled = False
            txt_TageNetto.Enabled = False
        Else
            txt_Fusszeile.Locked = True
            lbl_Skonto.Enabled = True
            lbl_TageSk.Enabled = True
            lbl_TageNetto.Enabled = True
            txt_skonto.Enabled = True
            txt_TageSk.Enabled = True
            txt_TageNetto.Enabled = True
        End If
    End If
    Call Fusszeile
End Sub

Private Sub chk_Sofort_Click()
    If chk_Sofort.Value = True Then
        chk_Bar.Value = False
        chk_Voraus.Value = False
        chk_KFuss.Value = False
        chk_Keine.Value = False
        txt_Fusszeile = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & "Sofort f|fffd|llig nach Rechnungsstellung."
    End If
End Sub

Private Sub chk_Voraus_Click()
    If chk_Voraus.Value = True Then
        chk_Sofort.Value = False
        chk_Bar.Value = False
        chk_KFuss.Value = False
        chk_Keine.Value = False
        txt_Fusszeile = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer."
    End If
End Sub

Private Sub cmd_KCalenda_Click()
    txt_CCheck.Value = "x"
    frmKalender.txt_UID = "KDID"
    frmKalender.Show
End Sub

Private Sub cmd_KEmail_Click()
    On Error GoTo weiter
    If txt_Email.Value = "" Then Exit Sub
    frmEmail.txt_Betreff = "Rechnung: " + frmKunden.lstKunden.Column(0) & " vom " + frmKunden.lstKunden.Column(4)
weiter:
    If cboanrede = "Herr" Then
        frmEmail.txt_ENachricht.Value = "Sehr geehrter Herr " & txt_Nachname & "," & vbLf & vbLf
        frmEmail.txt_ENachricht.SetFocus
    ElseIf cboanrede = "Frau" Then
        frmEmail.txt_ENachricht.Value = "Sehr geehrte Frau " & txt_Nachname & "," & vbLf & vbLf
        frmEmail.txt_ENachricht.SetFocus
    Else
        frmEmail.txt_ENachricht.Value = "Sehr geehrte Damen und Herren," & vbLf & vbLf
        frmEmail.txt_ENachricht.SetFocus
    End If

    frmEmail.txt_AN.Value = frmKunden.txt_Email.Value
    frmEmail.Show
End Sub

Private Sub txt_Email_Change()
    If Not txt_Email.Value = "" Then
        cmd_KEmail.Visible = True
    Else
        cmd_KEmail.Visible = False
    End If
End Sub

Private Sub txt_skonto_Change()
    If Not txt_skonto.Value = "" Then
        If Not IsNumeric(txt_skonto.Value) Then
            txt_skonto.Value = ""
        Else
            Call Fusszeile
            txt_skonto.BackColor = &HFFFFFF
        End If
    End If
End Sub

Private Sub txt_TageNetto_Change()
    If Not txt_TageNetto.Value = "" Then
        If Not IsNumeric(txt_TageNetto.Value) Then
            txt_TageNetto.Value = ""
        Else
            Call Fusszeile
            txt_TageNetto.BackColor = &HFFFFFF
        End If
    End If
End Sub

Private Sub txt_TageSk_Change()
    If Not txt_TageSk.Value = "" Then
        If Not IsNumeric(txt_TageSk.Value) Then
            txt_TageSk.Value = ""
        Else
            Call Fusszeile
            txt_TageSk.BackColor = &HFFFFFF
        End If
    End If
End Sub

Sub checkBedi()
    If chk_Sofort.Value = True Then
        chk_Bar.Value = False
        chk_Voraus.Value = False
        chk_KFuss.Value = False
    ElseIf chk_Bar.Value = True Then
        chk_Sofort.Value = False
        chk_Voraus.Value = False
        chk_KFuss.Value = False
    ElseIf chk_Voraus.Value = True Then
        chk_Sofort.Value = False
        chk_Bar.Value = False
        chk_KFuss.Value = False
    ElseIf chk_KFuss.Value = True Then
        chk_Sofort.Value = False
        chk_Bar.Value = False
        chk_Voraus.Value = False
    Else
        chk_Sofort.Value = False
        chk_Bar.Value = False
        chk_Voraus.Value = False
        chk_KFuss.Value = False
    End If
End Sub

Sub Fusszeile()
    Dim strSK, strTG, strNTG As String
    
    If txt_skonto.Value = "" Then
        strSK = "%WERT%"
        lbl_Skonto.ForeColor = &HFF&
    Else
        strSK = txt_skonto.Value
    End If
    If txt_TageSk.Value = "" Then
        strTG = "%WERT%"
        lbl_TageSk.ForeColor = &HFF&
    Else
        strTG = txt_TageSk.Value
    End If
    If txt_TageNetto.Value = "" Then
        strNTG = "%WERT%"
        lbl_TageNetto.ForeColor = &HFF&
    Else
        strNTG = txt_TageNetto.Value
    End If
    If chk_KFuss.Value = True Then
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & "Zahlung: " & strTG & " Tage abzgl. " & strSK & "% Skonto, " & strNTG & " Tage netto."
    Else
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer."
        lbl_Skonto.ForeColor = &H404040
        lbl_TageSk.ForeColor = &H404040
        lbl_TageNetto.ForeColor = &H404040
    End If
End Sub

Sub DatumHis()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 7 To Sheets("Warenausgang").Cells(Rows.Count, 1).End(xlUp).Row
        If CStr(Sheets("Warenausgang").Cells(lngZ, 17).Value) = CStr(txtKDID) Then
            objDic(Sheets("Warenausgang").Cells(lngZ, 12).Value) = 0
        End If
    Next
    cbojahr.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
End Sub

Sub DatumVer()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 3 To Sheets("Verleih_Historie").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Verleih_Historie").Cells(lngZ, 2).Value = txtKDID.Text Then
            objDic(Sheets("Verleih_Historie").Cells(lngZ, 18).Value) = 0
        End If
    Next
    cbojahrVer.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
End Sub

Private Sub cboAnrede_Change()
    If cboanrede = "Firma" Then
        lblzus.Visible = False
        txt_Zusatz.Visible = False
        lblVornamen.Visible = False
        txt_Vorname.Visible = False
        txt_Geb.Visible = False
        lblGeb.Visible = False
        lblGebtype.Visible = False
        lblNachname.Caption = "Firma"
    Else
        lblzus.Visible = True
        txt_Zusatz.Visible = True
        lblVornamen.Visible = True
        txt_Vorname.Visible = True
        txt_Geb.Visible = True
        lblGeb.Visible = True
        lblGebtype.Visible = True
        lblNachname.Caption = "Nachname"
    End If
End Sub

Private Sub cmd_Del_Click()
    Dim lng, stxt, i, aRow As Long
    Dim info As String
    On Error Resume Next
    
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If frmKunden.txt_Nachname.Value = "" Then Exit Sub
    info = frmKunden.cboKDNr.Text
    If frmKunden.cboKDNr = "" Then
        If cboanrede = "Firma" Then
            stxt = MsgBox("M|fffd|chten Sie die Firma (" + frmKunden.txt_Nachname + ") wirklich l|fffd|schen?", vbYesNo, "Kunden l|fffd|schen")
        Else
            stxt = MsgBox("M|fffd|chten Sie die Kunde (" + frmKunden.txt_Nachname & ", " & frmKunden.txt_Vorname + ") wirklich l|fffd|schen?", vbYesNo, "Kunden l|fffd|schen")
        End If
    Else
        If cboanrede = "Firma" Then
            stxt = MsgBox("M|fffd|chten Sie die Firma (" + frmKunden.txt_Nachname + ") wirklich l|fffd|schen?", vbYesNo, "Kunden l|fffd|schen")
        Else
            stxt = MsgBox("M|fffd|chten Sie die Kunde (" + frmKunden.txt_Nachname & ", " & frmKunden.txt_Vorname + ") wirklich l|fffd|schen?", vbYesNo, "Kunden l|fffd|schen")
        End If
    End If
    If stxt = vbYes Then
        lng = Worksheets("Kunden").Range("A:A").Find(txtKDID.Text, LookIn:=xlValues, MatchCase:=True).Row
        Sheets("Kunden").Rows(lng).Delete
    Else
        Exit Sub
    End If
    Application.ScreenUpdating = False
    Sheets("Daten").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = Date
    ActiveCell.Offset(0, 1).Value = "Kunde: (" & frmKunden.cboKDNr & ") wurde gel|fffd|scht!" & " (" & frmLager.lbl_Benutzer & ")"
    ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
    Sheets("Center").Activate
    lbl_status.Caption = "Kunde (" + frmKunden.cboKDNr + ") wurde gel|fffd|scht"
    lbl_status.Visible = True
    Call Kleeren
    cboKDNr.Clear
    lstKunden.Clear
    Call Datensaetze
    aRow = Sheets("Kunden").Cells(Rows.Count, 1).End(xlUp).Row
    For i = 2 To aRow
        If Sheets("Kunden").Cells(i, 4) = "Firma" Then
            cboKDNr.AddItem Sheets("Kunden").Cells(i, 4) & " " & Sheets("Kunden").Cells(i, 7)
        Else
            cboKDNr.AddItem Sheets("Kunden").Cells(i, 7) & ", " & Sheets("Kunden").Cells(i, 6)
        End If
    Next i
    Application.ScreenUpdating = True
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Schlie|fffd|en"" beenden!", , "Hinweis"
        ComKExit.SetFocus
        Cancel = True
    End If
End Sub

Sub KundenJahr() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim Dwert As Double
    On Error Resume Next
    
    If txtKDID.Value = "" Then Exit Sub
    lstKunden.BackColor = &H80000005
    lstKunden.Clear
    lbl_Gesamt.Caption = ""
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Warenausgang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:U" & Last_Row)
       ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
       For i = 7 To UBound(arrTmpA)
           If arrTmpA(i, 17) = CStr(txtKDID) And CDate(arrTmpA(i, 12)) = CDate(cbojahr) Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 2)
               arrTmpB(2, n) = arrTmpA(i, 5)
               arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 4)), Chr$(13) & Chr$(10), " ")
               arrTmpB(4, n) = Format(CDbl(arrTmpA(i, 7) + arrTmpA(i, 16)), "currency")
               Dwert = Dwert + CDbl(arrTmpA(i, 7) + arrTmpA(i, 16))
               arrTmpB(5, n) = arrTmpA(i, 11)
               arrTmpB(6, n) = arrTmpA(i, 8)
               arrTmpB(7, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstKunden
               .ColumnCount = 6
               .ColumnWidths = "80;27;185;60;55;50;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
    If lstKunden.ListCount > 0 Then
        lbl_RELSInfo.Visible = True
        cmd_VKBelegPrint.Visible = True
    Else
        lbl_RELSInfo.Visible = False
        cmd_VKBelegPrint.Visible = False
    End If
    lbl_Gesamt.Caption = Format(Dwert, "currency")
    Call Datensaetze
End Sub

Private Sub cbomonat_DropButtonClick() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim Dwert As Double
    On Error Resume Next
    
    If cbomonat = "" Then Exit Sub
    If txtKDID.Value = "" Then Exit Sub
    lstKunden.BackColor = &H80000005
    lstKunden.Clear
    lbl_Gesamt.Caption = ""
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Warenausgang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:U" & Last_Row)
       ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
       For i = 7 To UBound(arrTmpA)
           If arrTmpA(i, 17) = CStr(txtKDID) And arrTmpA(i, 11) = cbomonat.Text And CDate(arrTmpA(i, 12)) = CDate(cbojahr) Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 2)
               arrTmpB(2, n) = arrTmpA(i, 5)
               arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 4)), Chr$(13) & Chr$(10), " ")
               arrTmpB(4, n) = Format(CDbl(arrTmpA(i, 7) + arrTmpA(i, 16)), "currency")
               Dwert = Dwert + CDbl(arrTmpA(i, 7) + arrTmpA(i, 16))
               arrTmpB(5, n) = arrTmpA(i, 11)
               arrTmpB(6, n) = arrTmpA(i, 8)
               arrTmpB(7, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstKunden
               .ColumnCount = 6
               .ColumnWidths = "80;27;185;60;55;50;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
    If lstKunden.ListCount > 0 Then
        lbl_RELSInfo.Visible = True
        cmd_VKBelegPrint.Visible = True
    Else
        lbl_RELSInfo.Visible = False
        cmd_VKBelegPrint.Visible = False
    End If
    lbl_Gesamt.Caption = Format(Dwert, "currency")
    Call Datensaetze
End Sub

Private Sub cmd_aendern_Click()
    Dim lng As Long
    Dim strSK, strTG, strNTG As String
    
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    strSK = txt_skonto.Value
    strTG = txt_TageSk.Value
    strNTG = txt_TageNetto.Value
    If txtKDID.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    With Worksheets("Kunden")
        If .FilterMode Then .ShowAllData
    End With
    lng = Worksheets("Kunden").Range("A:A").Find(txtKDID.Text, LookIn:=xlValues, MatchCase:=True).Row
    Sheets("Kunden").Cells(lng, 3).Value = txt_KDNr.Value
    Sheets("Kunden").Cells(lng, 4).Value = cboanrede.Value
    Sheets("Kunden").Cells(lng, 5).Value = txt_Zusatz.Value
    Sheets("Kunden").Cells(lng, 6).Value = txt_Vorname.Value
    Sheets("Kunden").Cells(lng, 7).Value = txt_Nachname.Value
    Sheets("Kunden").Cells(lng, 8).Value = txt_Strasse.Value
    Sheets("Kunden").Cells(lng, 9).Value = "'" & txt_PLZ.Value
    Sheets("Kunden").Cells(lng, 10).Value = txt_Ort.Value
    Sheets("Kunden").Cells(lng, 11).Value = "'" & txt_Telefon.Value
    Sheets("Kunden").Cells(lng, 12).Value = "'" & txt_Mobil.Value
    Sheets("Kunden").Cells(lng, 13).Value = txt_Email.Value
    If Not txt_Geb.Value = "" Then
        Sheets("Kunden").Cells(lng, 14).Value = CDate(txt_Geb.Value)
    End If
    Sheets("Kunden").Cells(lng, 15).Value = txt_Bank.Value
    Sheets("Kunden").Cells(lng, 16).Value = "'" & txt_Kontonr.Value
    Sheets("Kunden").Cells(lng, 17).Value = txt_BLZ.Value
    Sheets("Kunden").Cells(lng, 18).Value = txt_IBAN.Value
    Sheets("Kunden").Cells(lng, 19).Value = txt_BIC.Value
    Sheets("Kunden").Cells(lng, 20).Value = txt_HRB.Value
    Sheets("Kunden").Cells(lng, 21).Value = txt_UstID.Value
    Sheets("Kunden").Cells(lng, 22).Value = txt_SteuerNr.Value
    Sheets("Kunden").Cells(lng, 23).Value = txt_area.Value
    Sheets("Kunden").Cells(lng, 24).Value = "'" & txt_FremdKNr.Value
    Sheets("Kunden").Cells(lng, 25).Value = "'" & txt_KZusatz1.Value
    Sheets("Kunden").Cells(lng, 26).Value = "'" & txt_KZusatz2.Value
    If Chk_Ksperren.Value = True Then
        Sheets("Kunden").Cells(lng, 28).Value = "ja"
    Else
        Sheets("Kunden").Cells(lng, 28).Value = ""
    End If
    If chk_Keine.Value = True And chk_KFuss.Value = True Then
        Sheets("Kunden").Cells(lng, 29).Value = "benf"
        Sheets("Kunden").Cells(lng, 33).Value = CStr(txt_Fusszeile)
    ElseIf chk_KFuss.Value = True Then
        Sheets("Kunden").Cells(lng, 29).Value = "ja"
        Sheets("Kunden").Cells(lng, 33).Value = "Zahlung: " & strTG & " Tage abzgl. " & strSK & " Skonto, " & strNTG & " Tage netto."
    ElseIf chk_Voraus.Value = True Then
        Sheets("Kunden").Cells(lng, 29).Value = "Vor"
    ElseIf chk_Bar.Value = True Then
        Sheets("Kunden").Cells(lng, 29).Value = "Bar"
    ElseIf chk_Sofort.Value = True Then
        Sheets("Kunden").Cells(lng, 29).Value = "Sofort"
        Sheets("Kunden").Cells(lng, 33).Value = "Zahlung: Sofort f|fffd|llig nach Rechnungsstellung."
    Else
        Sheets("Kunden").Cells(lng, 29).Value = ""
    End If
    Sheets("Kunden").Cells(lng, 30).Value = txt_skonto.Value
    Sheets("Kunden").Cells(lng, 31).Value = txt_TageSk.Value
    Sheets("Kunden").Cells(lng, 32).Value = txt_TageNetto.Value
    ActiveWorkbook.Save
    lbl_status.Visible = True
    lbl_status.BackColor = &HC000&
    lbl_status.BorderColor = &HC000&
    If cboanrede = "Firma" Then
        Me.lbl_status.Caption = "Der Eintrag von Firma " & txt_Nachname & " wurde ge|fffd|ndert!"
    Else
        Me.lbl_status.Caption = "Der Eintrag von " + txt_Nachname & ", " & txt_Vorname & " wurde ge|fffd|ndert!"
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_Anlegen_Click()
    Dim zeile, i, aRow, lngZeile As Long
    Dim strSK, strTG, strNTG As String
    On Error Resume Next
    
    strSK = txt_skonto.Value
    strTG = txt_TageSk.Value
    strNTG = txt_TageNetto.Value
    zeile = 0
    If txt_Nachname.Value = "" Then Exit Sub
    If Not txtKDID.Value = "" Then
        txtKDID.Value = ""
        Exit Sub
    End If
    Application.ScreenUpdating = False
    If Sheets("Daten").Cells(19, 2) = "" Or Sheets("Daten").Cells(19, 2) = 0 Then
        If CDbl(WorksheetFunction.CountA(Sheets("Kunden").Range("A:A"))) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(19, 2).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(Sheets("Kunden").Cells(Sheets("Kunden").Cells(1048576, 1).End(xlUp).Row, 1)) > CDbl(Sheets("Daten").Cells(19, 2).Value) Then
            zeile = CDbl(Sheets("Kunden").Cells(Sheets("Kunden").Cells(1048576, 1).End(xlUp).Row, 1)) + 1
            Sheets("Daten").Cells(19, 2).Value = CDbl(Sheets("Kunden").Cells(Sheets("Kunden").Cells(1048576, 1).End(xlUp).Row, 1)) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(19, 2).Value) + 1
            Sheets("Daten").Cells(19, 2).Value = CDbl(Sheets("Daten").Cells(19, 2).Value) + 1
        End If
    End If
    With Worksheets("Kunden")
        If .FilterMode Then .ShowAllData
    End With
    lngZeile = Worksheets("Kunden").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Kunden").Activate
    lngZeile = lngZeile + 1
    Worksheets("Kunden").Cells(lngZeile, 1) = zeile
    Worksheets("Kunden").Cells(lngZeile, 2) = Date
    If Not IsNumeric(txt_KDNr) Then
        Worksheets("Kunden").Cells(lngZeile, 3).Value = txt_KDNr.Value
    Else
        Worksheets("Kunden").Cells(lngZeile, 3).Value = "'" & txt_KDNr.Text
    End If
    Worksheets("Kunden").Cells(lngZeile, 4).Value = cboanrede
    Worksheets("Kunden").Cells(lngZeile, 5).Value = txt_Zusatz.Value
    Worksheets("Kunden").Cells(lngZeile, 6).Value = txt_Vorname.Value
    Worksheets("Kunden").Cells(lngZeile, 7).Value = txt_Nachname.Value
    Worksheets("Kunden").Cells(lngZeile, 8).Value = txt_Strasse.Value
    Worksheets("Kunden").Cells(lngZeile, 9).Value = "'" & txt_PLZ.Value
    Worksheets("Kunden").Cells(lngZeile, 10).Value = txt_Ort.Value
    Worksheets("Kunden").Cells(lngZeile, 11).Value = "'" & txt_Telefon.Value
    Worksheets("Kunden").Cells(lngZeile, 12).Value = "'" & txt_Mobil.Value
    Worksheets("Kunden").Cells(lngZeile, 13).Value = txt_Email.Value
    If Not txt_Geb.Value = "" Then
        Worksheets("Kunden").Cells(lngZeile, 14).Value = CDate(txt_Geb.Value)
    End If
    Worksheets("Kunden").Cells(lngZeile, 15).Value = txt_Bank.Value
    Worksheets("Kunden").Cells(lngZeile, 16).Value = "'" & txt_Kontonr.Value
    Worksheets("Kunden").Cells(lngZeile, 17).Value = txt_BLZ.Value
    Worksheets("Kunden").Cells(lngZeile, 18).Value = txt_IBAN.Value
    Worksheets("Kunden").Cells(lngZeile, 19).Value = txt_BIC.Value
    Worksheets("Kunden").Cells(lngZeile, 20).Value = txt_HRB.Value
    Worksheets("Kunden").Cells(lngZeile, 21).Value = txt_UstID.Value
    Worksheets("Kunden").Cells(lngZeile, 22).Value = txt_SteuerNr.Value
    Worksheets("Kunden").Cells(lngZeile, 23).Value = txt_area.Value
    Worksheets("Kunden").Cells(lngZeile, 24).Value = "'" & txt_FremdKNr.Value
    Worksheets("Kunden").Cells(lngZeile, 25).Value = "'" & txt_KZusatz1.Value
    Worksheets("Kunden").Cells(lngZeile, 26).Value = "'" & txt_KZusatz2.Value
    If Sheets("Daten").Range("B5").Value = "True" Then
        Worksheets("Kunden").Cells(lngZeile, 27).Value = Sheets("Daten").Range("B24").Value
    End If
    If chk_Keine.Value = True And chk_KFuss.Value = True Then
        Worksheets("Kunden").Cells(lngZeile, 29).Value = "benf"
        Worksheets("Kunden").Cells(lngZeile, 33).Value = CStr(txt_Fusszeile)
    ElseIf chk_KFuss.Value = True Then
        Worksheets("Kunden").Cells(lngZeile, 29).Value = "ja"
        Worksheets("Kunden").Cells(lngZeile, 33).Value = "Zahlung: " & strTG & " Tage abzgl. " & strSK & " Skonto, " & strNTG & " Tage netto."
    ElseIf chk_Voraus.Value = True Then
        Worksheets("Kunden").Cells(lngZeile, 29).Value = "Vor"
    ElseIf chk_Bar.Value = True Then
        Worksheets("Kunden").Cells(lngZeile, 29).Value = "Bar"
    ElseIf chk_Sofort.Value = True Then
        Worksheets("Kunden").Cells(lngZeile, 29).Value = "Sofort"
        Worksheets("Kunden").Cells(lngZeile, 33).Value = "Zahlung: Sofort f|fffd|llig nach Rechnungsstellung."
    Else
        Worksheets("Kunden").Cells(lngZeile, 29).Value = ""
    End If
    ActiveWorkbook.Save
    If txt_Verleih.Value = "Verleih" Then
        Call frmVerleih.Kunden
        frmVerleih.cbo_Kunden = txt_Nachname.Value & ", " & txt_Vorname.Value
    End If
    If Not txt_KDNr.Value = "" Then
        Sheets("Daten").Range("B48").Value = "'" & txt_KDNr.Text
    End If
    MsgBox cboanrede & " " & txt_Nachname & " wurde erfolgreich angelegt!", , "Anlegen"
    Call Kleeren
    cboKDNr.Clear
    aRow = Sheets("Kunden").Cells(Rows.Count, 1).End(xlUp).Row
    For i = 2 To aRow
        cboKDNr.AddItem Sheets("Kunden").Cells(i, 7) & ", " & Sheets("Kunden").Cells(i, 6)
    Next i
    If Not Sheets("Daten").Range("B48").Value = "" Then
        lbl_LKNr.Caption = "Letzte vergebene Nr.: " & Sheets("Daten").Range("B48").Value
    Else
        lbl_LKNr.Caption = ""
    End If
    Sheets("center").Activate
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_Kclear_Click()
    On Error Resume Next
    Dim objControl As control
    For Each objControl In Controls
        Select Case TypeName(objControl)
           Case "TextBox"
              objControl.Text = ""
           Case "ComboBox"
              objControl.ListIndex = -1
           Case "CheckBox"
              objControl.Value = False
           Case "OptionButton"
              objControl.Value = False
        End Select
    Next
    chk_Keine.Value = True
    lst_Auswahl.Clear
    list_HVerleih.Clear
    lstKunden.Clear
    cmd_Aendern.Visible = False
    cmd_Del.Visible = False
    txt_KDNr.SetFocus
    lbl_gesperrt.ForeColor = &H404040
    lbl_gesperrt.Caption = "Kunden sperren"
    cmd_Anlegen.Visible = True
    frmKunden.MultiPage1.Value = 0
    Call Datensaetze
End Sub

Private Sub lst_Auswahl_Click()
    Dim lngZeile As Long
    On Error Resume Next
    If txt_Snachnamen.Value = "" Then Exit Sub
    lngZeile = lst_Auswahl.Column(1)
    txtKDID.Value = Sheets("Kunden").Cells(lngZeile, 1)
    txt_angelegt.Value = Sheets("Kunden").Cells(lngZeile, 2)
    txt_KDNr.Value = Sheets("Kunden").Cells(lngZeile, 3)
    cboanrede = Sheets("Kunden").Cells(lngZeile, 4)
    txt_Zusatz = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 4)
    txt_Vorname.Value = Sheets("Kunden").Cells(lngZeile, 6)
    txt_Nachname.Value = Sheets("Kunden").Cells(lngZeile, 7)
    txt_Strasse.Value = Sheets("Kunden").Cells(lngZeile, 8)
    txt_PLZ.Value = Sheets("Kunden").Cells(lngZeile, 9)
    txt_Ort.Value = Sheets("Kunden").Cells(lngZeile, 10)
    txt_Telefon.Value = Sheets("Kunden").Cells(lngZeile, 11)
    txt_Mobil.Value = Sheets("Kunden").Cells(lngZeile, 12)
    txt_Email.Value = Sheets("Kunden").Cells(lngZeile, 13)
    txt_Geb.Value = Sheets("Kunden").Cells(lngZeile, 14)
    txt_Bank.Value = Sheets("Kunden").Cells(lngZeile, 15)
    txt_Kontonr.Value = Sheets("Kunden").Cells(lngZeile, 16)
    txt_BLZ.Value = Sheets("Kunden").Cells(lngZeile, 17)
    txt_IBAN.Value = Sheets("Kunden").Cells(lngZeile, 18)
    txt_BIC.Value = Sheets("Kunden").Cells(lngZeile, 19)
    txt_HRB.Value = Sheets("Kunden").Cells(lngZeile, 20)
    txt_UstID.Value = Sheets("Kunden").Cells(lngZeile, 21)
    txt_SteuerNr.Value = Sheets("Kunden").Cells(lngZeile, 22)
    txt_FremdKNr.Value = Sheets("Kunden").Cells(lngZeile, 24)
    txt_skonto.Value = Sheets("Kunden").Cells(lngZeile, 30)
    txt_TageSk.Value = Sheets("Kunden").Cells(lngZeile, 31)
    txt_TageNetto.Value = Sheets("Kunden").Cells(lngZeile, 32)
    If Not Sheets("Kunden").Cells(lngZeile, 28) = "" Then
        Me.txt_sperren = "x"
    Else
        Me.txt_sperren = ""
    End If
    If Sheets("Kunden").Cells(lngZeile, 29) = "ja" Then
        chk_KFuss.Value = True
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Sheets("Kunden").Cells(lngZeile, 33)
    ElseIf Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "Bar" Then
        chk_Bar.Value = True
    ElseIf Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "Vor" Then
        chk_Voraus.Value = True
    ElseIf Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "Sofort" Then
        chk_Sofort.Value = True
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 33).Value
    Else
        chk_KFuss.Value = False
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer."
        chk_Keine.Value = True
    End If
    Call Belegesuchen
    Call DatumHis
    cmd_Anlegen.Visible = False
End Sub

Private Sub lst_Auswahl_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Dim lngZeile As Long
    On Error Resume Next
    If txt_Snachnamen.Value = "" Then Exit Sub
    lngZeile = lst_Auswahl.Column(1)
    txtKDID.Value = Sheets("Kunden").Cells(lngZeile, 1)
    txt_angelegt.Value = Sheets("Kunden").Cells(lngZeile, 2)
    txt_KDNr.Value = Sheets("Kunden").Cells(lngZeile, 3)
    cboanrede = Sheets("Kunden").Cells(lngZeile, 4)
    txt_Vorname.Value = Sheets("Kunden").Cells(lngZeile, 6)
    txt_Nachname.Value = Sheets("Kunden").Cells(lngZeile, 7)
    txt_Strasse.Value = Sheets("Kunden").Cells(lngZeile, 8)
    txt_PLZ.Value = Sheets("Kunden").Cells(lngZeile, 9)
    txt_Ort.Value = Sheets("Kunden").Cells(lngZeile, 10)
    txt_Telefon.Value = Sheets("Kunden").Cells(lngZeile, 11)
    txt_Mobil.Value = Sheets("Kunden").Cells(lngZeile, 12)
    txt_Email.Value = Sheets("Kunden").Cells(lngZeile, 13)
    txt_Geb.Value = Sheets("Kunden").Cells(lngZeile, 14)
    txt_Bank.Value = Sheets("Kunden").Cells(lngZeile, 15)
    txt_Kontonr.Value = Sheets("Kunden").Cells(lngZeile, 16)
    txt_BLZ.Value = Sheets("Kunden").Cells(lngZeile, 17)
    txt_IBAN.Value = Sheets("Kunden").Cells(lngZeile, 18)
    txt_BIC.Value = Sheets("Kunden").Cells(lngZeile, 19)
    txt_HRB.Value = Sheets("Kunden").Cells(lngZeile, 20)
    txt_UstID.Value = Sheets("Kunden").Cells(lngZeile, 21)
    txt_SteuerNr.Value = Sheets("Kunden").Cells(lngZeile, 22)
    txt_FremdKNr.Value = Sheets("Kunden").Cells(lngZeile, 24)
    If Not Sheets("Kunden").Cells(lngZeile, 28) = "" Then
        Me.txt_sperren = "x"
    End If
    cboKDNr = Sheets("Kunden").Cells(lngZeile, 7) & ", " & Sheets("Kunden").Cells(lngZeile, 6)
    Call Belegesuchen
    Call Datensaetze
End Sub

Private Sub cboKDNr_click()
    lst_Auswahl.Clear
    lst_Auswahl.BackColor = &H80000004
    txt_Snachnamen.Value = ""
    txtKDID.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 1)
    txt_angelegt.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 2)
    txt_KDNr.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 3)
    cboanrede = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 4)
    txt_Zusatz = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 5)
    txt_Vorname.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 6)
    txt_Nachname.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 7)
    txt_Strasse.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 8)
    txt_PLZ.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 9)
    txt_Ort.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 10)
    txt_Telefon.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 11)
    txt_Mobil.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 12)
    txt_Email.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 13)
    txt_Geb.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 14)
    txt_Bank.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 15)
    txt_Kontonr.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 16)
    txt_BLZ.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 17)
    txt_IBAN.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 18)
    txt_BIC.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 19)
    txt_HRB.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 20)
    txt_UstID.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 21)
    txt_SteuerNr.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 22)
    txt_area.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 23)
    txt_FremdKNr.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 24)
    txt_KZusatz1.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 25)
    txt_KZusatz2.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 26)
    If Not Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 28) = "" Then
        Me.txt_sperren = "x"
    Else
        Me.txt_sperren = ""
    End If
    If Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 28).Value = "ja" Then
        Chk_Ksperren.Value = True
        lbl_gesperrt.ForeColor = &HFF&
        lbl_gesperrt.Caption = "Kunde gesperrt"
    Else
        Chk_Ksperren.Value = False
        lbl_gesperrt.ForeColor = &H404040
        lbl_gesperrt.Caption = "Kunden sperren"
    End If
    txt_skonto.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 30).Value
    txt_TageSk.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 31).Value
    txt_TageNetto.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 32).Value
    If Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "benf" Then
        chk_Keine.Value = True
        chk_KFuss.Value = True
        txt_Fusszeile.Value = Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 33)
    ElseIf Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "ja" Then
        chk_KFuss.Value = True
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 33).Value
    ElseIf Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "Bar" Then
        chk_Bar.Value = True
    ElseIf Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "Vor" Then
        chk_Voraus.Value = True
    ElseIf Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 29).Value = "Sofort" Then
        chk_Sofort.Value = True
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Sheets("Kunden").Cells(cboKDNr.ListIndex + 2, 33).Value
    Else
        chk_KFuss.Value = False
        txt_Fusszeile.Value = "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer."
        chk_Keine.Value = True
    End If
    cbomonat = ""
    Call Belegesuchen
    Call Datensaetze
    If Not txtKDID.Value = "" Then
        cmd_Aendern.Visible = True
        cmd_Del.Visible = True
    End If
    Call DatumHis
    Call DatumVer
    Call VHsuchenNeu
    cmd_Anlegen.Visible = False
End Sub

Private Sub cmdchanel_Click()
    Unload frmKunden
End Sub

Private Sub ComKExit_Click()
    Unload frmKunden
End Sub

Private Sub cmd_Ksuchen_Click()
    Call KASuchen
End Sub

Sub KASuchen()
    Dim lngZeile, i, Alng, xrow As Long
    Dim andoubl As Double
    Dim arrTmpA, arrTmpB As Long
    Dim Last_Row As Long
    On Error Resume Next

    If txt_Snachnamen = "" Then Exit Sub
    andoubl = 0
    For Alng = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
        If InStr(1, LCase(Sheets("Kunden").Cells(Alng, 7).Value), LCase(txt_Snachnamen.Text)) > 0 Then
            andoubl = andoubl + 1
            i = i + 1
        End If
    Next Alng
    If andoubl >= 1 Then
        lst_Auswahl.BackColor = &H80000005
        lst_Auswahl.Clear
        lst_Auswahl.ColumnCount = 2
        lst_Auswahl.ColumnWidths = "200;0"
        i = 0
        For lngZeile = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
            If InStr(1, LCase(Sheets("Kunden").Cells(lngZeile, 7).Value), LCase(txt_Snachnamen.Text)) > 0 Then
                lst_Auswahl.AddItem "ID " & Sheets("Kunden").Cells(lngZeile, 1).Value & " " & Sheets("Kunden").Cells(lngZeile, 7).Value & ", " & Sheets("Kunden").Cells(lngZeile, 6).Value
                lst_Auswahl.Column(1, i) = Sheets("Kunden").Cells(lngZeile, 17).Row
                lst_Auswahl.Column(2, i) = Sheets("Kunden").Cells(lngZeile, 1).Text
                i = i + 1
            End If
        Next lngZeile
        Call Kleeren
        lstKunden.Clear
    Else
        lst_Auswahl.Clear
        lst_Auswahl.BackColor = &H80000004
        xrow = xFind(ActiveWorkbook.Name, ("Kunden"), txt_Snachnamen.Value, "G:G")
        If xrow = False Then
            Call Kleeren
            lstKunden.Clear
            MsgBox "Es ist kein Kunde/Firma mit dem Namen (" + txt_Snachnamen + ") vorhanden!", , "Hinweis"
            txt_Snachnamen.SetFocus
            Exit Sub
        End If
        txtKDID.Value = Sheets("Kunden").Cells(xrow, 1)
        txt_angelegt.Value = Sheets("Kunden").Cells(xrow, 2)
        txt_KDNr.Value = Sheets("Kunden").Cells(xrow, 3)
        cboanrede = Sheets("Kunden").Cells(xrow, 4)
        txt_Vorname.Value = Sheets("Kunden").Cells(xrow, 6)
        txt_Nachname.Value = Sheets("Kunden").Cells(xrow, 7)
        txt_Strasse.Value = Sheets("Kunden").Cells(xrow, 8)
        txt_PLZ.Value = Sheets("Kunden").Cells(xrow, 9)
        txt_Ort.Value = Sheets("Kunden").Cells(xrow, 10)
        txt_Telefon.Value = Sheets("Kunden").Cells(xrow, 11)
        txt_Mobil.Value = Sheets("Kunden").Cells(xrow, 12)
        txt_Email.Value = Sheets("Kunden").Cells(xrow, 13)
        txt_Geb.Value = Sheets("Kunden").Cells(xrow, 14)
        txt_Bank.Value = Sheets("Kunden").Cells(xrow, 15)
        txt_Kontonr.Value = Sheets("Kunden").Cells(xrow, 16)
        txt_BLZ.Value = Sheets("Kunden").Cells(xrow, 17)
        txt_IBAN.Value = Sheets("Kunden").Cells(xrow, 18)
        txt_BIC.Value = Sheets("Kunden").Cells(xrow, 19)
        txt_FremdKNr.Value = Sheets("Kunden").Cells(xrow, 24)
        txt_KZusatz1.Value = Sheets("Kunden").Cells(xrow, 25)
        txt_KZusatz2.Value = Sheets("Kunden").Cells(xrow, 26)
        cboKDNr = Sheets("Kunden").Cells(xrow, 7) & ", " & Sheets("Kunden").Cells(xrow, 6)
        Call Belegesuchen
    End If
End Sub

Sub Belegesuchen() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim Dwert As Double
    On Error Resume Next
    
    If txtKDID.Value = "" Then Exit Sub
    lstKunden.BackColor = &H80000005
    lstKunden.Clear
    cbojahr = ""
    cbomonat = ""
    lbl_Gesamt.Caption = ""
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Warenausgang")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:U" & Last_Row)
       ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
       For i = 7 To UBound(arrTmpA)
           If Not arrTmpA(i, 17) = "" And arrTmpA(i, 17) = CStr(txtKDID) Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 2)
               arrTmpB(2, n) = arrTmpA(i, 5)
               arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 4)), Chr$(13) & Chr$(10), " ")
               arrTmpB(4, n) = Format(CDbl(arrTmpA(i, 7) + arrTmpA(i, 16)), "currency")
               Dwert = Dwert + CDbl(arrTmpA(i, 7) + arrTmpA(i, 16))
               arrTmpB(5, n) = arrTmpA(i, 11)
               arrTmpB(6, n) = arrTmpA(i, 8)
               arrTmpB(7, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstKunden
               .ColumnCount = 6
               .ColumnWidths = "80;27;185;60;55;50;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
    lbl_Gesamt.Caption = Format(Dwert, "currency")
    If lstKunden.ListCount > 0 Then
        lbl_RELSInfo.Visible = True
        cmd_VKBelegPrint.Visible = True
    Else
        lbl_RELSInfo.Visible = False
        cmd_VKBelegPrint.Visible = False
    End If
    Call Datensaetze
End Sub

Sub Datensaetze()
    Dim lngdatenv As Long
    On Error Resume Next
    lngdatenv = 0
    If CDbl(lstKunden.ListCount) = 0 Then
        lbldatensaetze.Caption = "Kein Datensatz gefunden"
        Me.lbl_status.Visible = False
        txtdaten.Visible = False
    ElseIf CDbl(lstKunden.ListCount) > 1 Then
        lngdatenv = lngdatenv + CDbl(lstKunden.ListCount)
        lbldatensaetze.Caption = lstKunden.ListCount & " Datens|fffd|tze gefunden"
        txtdaten.Visible = True
    Else
        lngdatenv = lngdatenv + CDbl(lstKunden.ListCount)
        lbldatensaetze.Caption = lstKunden.ListCount & " Datensatz gefunden"
        txtdaten.Visible = True
    End If
    If CDbl(list_HVerleih.ListCount) = 0 Then
        lbldatensaetze3.Caption = "Kein Datensatz gefunden"
        lbldatensaetze3.Caption = ""
        txtdaten2.Visible = False
    ElseIf CDbl(list_HVerleih.ListCount) > 1 Then
        lbldatensaetze3.Caption = list_HVerleih.ListCount & " Datens|fffd|tze gefunden"
        lngdatenv = lngdatenv + CDbl(list_HVerleih.ListCount)
        txtdaten2.Visible = True
    Else
        lbldatensaetze3.Caption = list_HVerleih.ListCount & " Datensatz gefunden"
        lngdatenv = lngdatenv + CDbl(list_HVerleih.ListCount)
        txtdaten2.Visible = True
    End If
    If lngdatenv = 0 Then
        Me.lbl_status.Visible = False
    Else
        Me.lbl_status.Caption = lngdatenv & " Datens|fffd|tze gefunden (Verkauf / Verleih)!"
        Me.lbl_status.BackColor = &H404040
        Me.lbl_status.BorderColor = &H404040
        Me.lbl_status.Visible = True
    End If
End Sub

Sub Kleeren()
    txtKDID.Value = ""
    txt_angelegt.Value = ""
    txt_KDNr.Value = ""
    cboanrede = ""
    txt_Vorname.Value = ""
    txt_Nachname.Value = ""
    txt_Strasse.Value = ""
    txt_PLZ.Value = ""
    txt_Ort.Value = ""
    txt_Telefon.Value = ""
    txt_Mobil.Value = ""
    txt_Email.Value = ""
    txt_Geb.Value = ""
    txt_Bank.Value = ""
    txt_Kontonr.Value = ""
    txt_BLZ.Value = ""
    txt_IBAN.Value = ""
    txt_BIC.Value = ""
    txt_HRB.Value = ""
    txt_UstID.Value = ""
    txt_SteuerNr.Value = ""
    txt_area.Value = ""
    txt_FremdKNr.Value = ""
    txt_KZusatz1.Value = ""
    txt_KZusatz2.Value = ""
End Sub
Attribute VB_Name = "frmLaden"
Attribute VB_Base = "0{5E6EFD85-CF46-4D75-9E70-7DCCFE1EEC76}{F0F55DBC-3660-4189-B5FD-2C16005B52EA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    Application.ScreenUpdating = True
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
End Sub

Sub LadenClose()
    Dim dat As Date
    dat = Now
    frmLaden.Show False
    Do
        DoEvents
    Loop Until Abs(DateDiff("s", dat, Now)) > 4
    Unload frmLaden
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        Cancel = True
    End If
End Sub
Attribute VB_Name = "frmLager"
Attribute VB_Base = "0{59287571-2E8F-459D-AADB-F613024CBB00}{C952AABD-132E-464D-B0DB-8C0861EED0D1}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'###############################################
'# Version        :Excel Lagerverwaltung 1.44  #
'# Entwicklung                                 #
'# und Design     :Marcel Kusche               #
'# Stand          :Juli 2019                   #
'# Sprache        :German                      #
'# Das Ver|fffd|ffentlichen oder Ver|fffd|ndern des      #
'# Quellcodes ist untersagt und bedarf         #
'# meines Einverst|fffd|ndnisses!                   #
'###############################################
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    lbl_cboKat.Caption = CStr(Sheets("Lager").Range("AO1"))
    lbl_Version.Caption = "Versionsnummer: " & CStr(Sheets("Daten").Range("B45"))
    Application.ScreenUpdating = False
    If Sheets("Daten").Range("B7").Value = "Admin" Then lbl_Stime.Visible = True
    If Not Sheets("Daten").Range("D44") = "" Then
        If Not Sheets("Daten").Range("B5").Value = "True" Then cmd_Button.Top = 262.5
        cmd_Button.Visible = True
    Else
        cmd_Button.Visible = False
    End If
    cmd_Button.Caption = Sheets("Daten").Range("D44").Value
    If Not Sheets("Daten").Range("F2").Value = "" Then
        If CDbl(Sheets("Daten").Range("F2").Value) > CDbl(Sheets("Daten").Range("B8").Value) Then
            lbl_V2.Caption = "Neue Version Verf|fffd|gbar!"
            lbl_V2.BackColor = &HC0&
            lbl_V2.Visible = True
        ElseIf Not Sheets("Daten").Range("F1").Value = Sheets("Daten").Range("B45").Value Then
            lbl_V2.Caption = "Ein Update ist Verf|fffd|gbar!"
            lbl_V2.BackColor = &H80FF&
            lbl_V2.Visible = True
        Else
            lbl_V2.Visible = False
        End If
    End If
    If Worksheets("Daten").Range("B22") = "ja" Then
        chkEKPreis.Value = True
    Else
        chkEKPreis.Value = False
    End If
    If Sheets("Daten").Range("B38").Value = "Ja" Then
        cmd_Verleih.Visible = True
        cmdKasse.Height = 54
        lbl_AVerleih.ForeColor = &H404040
        lbl_AVerleih2.ForeColor = &H404040
    Else
        cmdKasse.Height = 80
        cmd_Verleih.Visible = False
        lbl_AVerleih.ForeColor = &HC0C0C0
        lbl_AVerleih2.ForeColor = &HC0C0C0
    End If
    If Sheets("Daten").Range("B34").Value = "Status ok!" Then
        txtIDS.Value = "Status ok!"
        txtIDS.BackColor = &H80000005
        txtIDS.ForeColor = &H8000&
        lbl_V2.Visible = False
    Else
        txtIDS.Value = "Fehler ID!"
        lbl_V2.Visible = True
        lbl_V2.Caption = "#ID Fehler > Bitte pr|fffd|fen!#"
        txtIDS.BackColor = &HC0&
        txtIDS.ForeColor = &HFFFFFF
    End If
    If Not Sheets("Daten").Range("B22").Value = "" Then
        frmLager.lbl_Benutzer.Caption = Sheets("Daten").Range("B22").Value
        cmdLogOut.Visible = False
        cmd_Abmelden.Visible = True
    Else
        If Sheets("Daten").Range("B5").Value = "True" Then
            frmLager.lbl_Benutzer.Caption = Sheets("Daten").Range("B24").Value
            frmLager.txt_Admin.Value = AdminN
            If ThisWorkbook.Sheets("Daten").Range("B7").Value = "Admin" Then
                cmdLogOut.Visible = True
                cmd_Abmelden.Visible = False
            ElseIf ThisWorkbook.Sheets("Daten").Range("B24").Value <> 0 Then
                cmdLogOut.Visible = False
                cmd_Abmelden.Visible = True
            End If
        Else
            If ThisWorkbook.Sheets("Daten").Range("B7").Value = "Admin" Then
                cmdLogOut.Visible = True
            End If
            cmd_Abmelden.Visible = False
            frmLager.lbl_Benutzer.Caption = ""
        End If
    End If
    If Sheets("Lager").Cells(1, 5) = "" Then
        txtFrei.BackColor = &H8000000B
    Else
        txtFrei.BackColor = &H80000005
        lblFrei.Caption = Sheets("Lager").Cells(1, 5)
    End If
    cmdAnlegen2.Caption = "|fffd|hnlichen" & vbLf & "Artikel anlegen"
    cmdKasse.Caption = "Warenausgang" & vbLf & "Auftr|fffd|ge"
    lbinfo.Caption = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1 & " Artikel vorhanden"
    If txt_Bezeichnung.Value = "" Then cmdAnlegen2.Visible = False
    lbstatus.BackColor = &H8000000B
    Application.ScreenUpdating = True
    Call AnsichtLager
    Call ArtikelCombo
    Call WGCombo
    Call KategorieCombo
    Call HerstellerCombo
    chkEKPreis.Value = False
    txtHnr.SetFocus
End Sub

Private Sub cmd_Button_Click()
    Dim bwert, varPfad As String
    On Error GoTo weiter
    If Not Sheets("Daten").Range("D45") = "" Then
        bwert = CStr(Sheets("Daten").Range("D45"))
        Shell bwert & varPfad, 3
    End If
    Exit Sub
weiter:
    MsgBox "Sorry, es ist nicht m|fffd|glich das Programm zu |fffd|ffnen!", vbInformation, "Progamm starten"
End Sub

Private Sub cmd_DEinBuchen_Click() '1.44
    Dim strA, lngMsg, strLID As String
    Dim lngZeile, lng, lngrow, Last_Row, lngS As Long
    Dim arrTmpA, arrTmpB, i As Long
    On Error Resume Next
    
    If Sheets("Daten").Range("D48") = "Nein" Then
        MsgBox "Die Funktion ist standardgem|fffd||fffd| deaktiviert! Sie k|fffd|nnen dieses in den Einstellungen |fffd|ndern!", vbInformation, "Hinweis"
        Exit Sub
    End If
    If Not txt_gesperrt.Value = "" Then
        MsgBox "Artikel: """ & Me.txt_Bezeichnung & """ ist gesperrt!", , "Gesperrt seit: " & txt_gesperrt
        Exit Sub
    End If
    Application.ScreenUpdating = False
    strA = txt_item.Value
    If Not txtzeile = "" Then
        lngZeile = CLng(txtzeile)
    Else
        If Not txtID.Value = "" Then
            lngZeile = ""
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                        lngZeile = i
                    End If
                Next i
            End With
        Else
            Application.ScreenUpdating = True
            Exit Sub
        End If
    End If
    If txtID.Value = "" Then
        MsgBox "Bitte w|fffd|hlen Sie ein Artikel!", vbOKOnly, "Direkt Einbuchen"
        Frame_ArtikelS.cboArtikelnummer.SetFocus
        Exit Sub
    Else
        lngMsg = InputBox("Geben Sie die ein zubuchende Menge ein!", "Direkt Einbuchen (" + txt_item + ")", 1)
        If lngMsg = "" Then
            Application.ScreenUpdating = True
            Exit Sub
        End If
        If Not IsNumeric(lngMsg) Then
            MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
            Application.ScreenUpdating = True
            Exit Sub
        End If
        If txt_LPID.Value = "" And txt_MengePlatz.Value = "" Then
            lng = txt_BestandVer
        Else
            lng = txt_MengePlatz.Value
        End If
        If Not txt_LPID.Value = "" Then
            strLID = txt_LPID.Value
            For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
                If Sheets("Lagerorte").Cells(lng, 1) = strLID Then
                    Sheets("Lagerorte").Cells(lng, 4).Value = CDbl(Sheets("Lagerorte").Cells(lng, 4).Value) + CDbl(lngMsg)
                End If
            Next lng
        Else
            Worksheets("Lager").Cells(lngZeile, 8).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 8)) + CDbl(lngMsg)
        End If
    End If
    With Worksheets("Wareneingang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    Sheets("Wareneingang").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = "D" & ThisWorkbook.Sheets("Warenausgang").Range("B1").Text & Format(ThisWorkbook.Sheets("Warenausgang").Range("B5") + 1, "000000")
    ActiveCell.Offset(0, 1).Value = "Direkt Einbuchen"
    ActiveCell.Offset(0, 2).Value = "'" & txt_item.Value
    ActiveCell.Offset(0, 4).Value = txt_Bezeichnung.Value
    ActiveCell.Offset(0, 5).Value = CDbl(lngMsg)
    ActiveCell.Offset(0, 6).Value = "Direkt Einbuchen"
    ActiveCell.Offset(0, 7).Value = Date
    ActiveCell.Offset(0, 8).Value = Format(Time, "hh:mm:ss")
    ActiveCell.Offset(0, 11).Value = CStr(txtID.Value)
    ActiveCell.Offset(0, 12).Value = lbl_Benutzer
    ActiveCell.Offset(0, 15).Value = Format(Date, "mmmm")
    ActiveCell.Offset(0, 16).Value = Format(Date, "yyyy")
    ActiveCell.Offset(0, 17).Value = txtLagerort
    ThisWorkbook.Sheets("Warenausgang").Range("B5") = CDbl(ThisWorkbook.Sheets("Warenausgang").Range("B5").Text) + 1
    MsgBox "Es wurden " + lngMsg + " " + lbl_bezeichnung.Caption + " eingebucht" & vbLf & vbLf & "Beleg: " & "D" & ThisWorkbook.Sheets("Warenausgang").Range("B1").Text & Format(ThisWorkbook.Sheets("Warenausgang").Range("B5"), "000000"), vbOKOnly, "Direkt Einbuchen"
    If Worksheets("Lager").Cells(lngZeile, 9).Text = "Bestellt" Then
        UserForm_Initialize
        Application.ScreenUpdating = True
        Exit Sub
    Else
        If txtMeldeBestand.Value = "" Then
            If (CDbl(Worksheets("Lager").Cells(lngZeile, 8).Value) + CDbl(lngS)) <= CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 10).Value) And Not Worksheets("Lager").Cells(lngZeile, 9) = "Bestellt" Then
                Worksheets("Lager").Cells(lngZeile, 9).Font.ColorIndex = 3
                Worksheets("Lager").Cells(lngZeile, 9) = "Bestellen"
            End If
        Else
            If (CDbl(Worksheets("Lager").Cells(lngZeile, 8).Value) + CDbl(lngS)) <= CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 11).Value) And Not Worksheets("Lager").Cells(lngZeile, 9) = "Bestellt" Then
                Worksheets("Lager").Cells(lngZeile, 9).Font.ColorIndex = 3
                Worksheets("Lager").Cells(lngZeile, 9) = "Bestellen"
            End If
        End If
    End If
    Frame_ArtikelS.cboArtikelnummer.Clear
    UserForm_Initialize
    Call Maskeclear
    txt_item.Value = strA
    Call Asuchen
    Call Datensaetze
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_kostenstelle_Click()
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    frmkostenstelle.Show
End Sub

Private Sub cmd_WLieferanten_Click()
    If txtID = "" Then Exit Sub
    lstmainmenu.Enabled = False
    frmAusw.Caption = "Weitere Lieferanten"
    frmAusw.txt_WLieferant.Value = Me.txtID
    frmAusw.Show
End Sub

Private Sub txt_AnZLieferanten_Change()
    If Not txt_AnZLieferanten = "" Then
        cmd_WLieferanten.Visible = True
    Else
        cmd_WLieferanten.Visible = False
    End If
End Sub

Private Sub txtBestand_Change()
    If Not txtBestand.Value = "" Then
        Call SuchenR
    End If
End Sub

Sub AnZLieferanten()
    Dim arrTmpA, arrTmpB, i As Long, j As Double, n As Long
    Dim SuchKriterium As String, Last_Row As Long
    On Error Resume Next
    SuchKriterium = CStr(frmLager.txtID)
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AA" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 14) = "VP-WL" And arrTmpA(i, 2) Like SuchKriterium Then
                n = n + 1
            End If
        Next i
        If n > 0 Then
            txt_AnZLieferanten = n
        Else
            txt_AnZLieferanten = ""
        End If
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub txt_Lemail_Click()
    If frmLager.txt_Lemail = "" Then Exit Sub
    frmEmail.txt_AN.Value = frmLager.txt_Lemail
    frmEmail.Show
End Sub

Private Sub cbo_Lagerplatz_Change()
    Dim lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    If cbo_Lagerplatz = "Hauptlagerplatz" Then
        txtLagerort.Value = Sheets("Lager").Cells(CLng(txtzeile), 13).Value
        txt_MengePlatz.Value = Sheets("Lager").Cells(CLng(txtzeile), 8).Value
        txt_LPID.Value = ""
    Else
        txtLagerort.Value = ""
        For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
            If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz.Text Then
                txt_MengePlatz.Value = Sheets("Lagerorte").Cells(lng, 4)
                txt_LPID.Value = Sheets("Lagerorte").Cells(lng, 1)
            End If
        Next lng
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_BarcodeAus_Click()
    Dim strFontFileName As String
    On Error Resume Next
    strFontFileName = "Bar-Code 39"
    If SystemFontExists(strFontFileName) = False Then
        MsgBox "Bitte installieren Sie die Schriftart (Bar-Code 39)!" & vbLf & "Weitere Informationen finden Sie auch im Benutzerhandbuch!", vbInformation, "Schriftart (Bar-Code 39) ist nicht installiert!"
        Exit Sub
    Else
        frmBarcode.Show
    End If
End Sub

Private Sub cmd_DatenAkt_Click()
    frmLaden.Label1.Caption = "Bitte warten Sie, Daten werden aktualisiert!"
    frmLaden.Show
    DoEvents
    Call DatenAll
    frmLaden.Label1.Caption = "Daten wurden aktualisiert!"
    Call frmLaden.LadenClose
End Sub

Private Sub cmd_supplier_Click()
    frmLieferanten.Show
End Sub

Private Sub cmd_Verleih_Click()
    Dim lngg, lng As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    Application.ScreenUpdating = False
    frmVerleih.lbl_VArtikelNr.Caption = txt_item.Value
    frmVerleih.txt_VArtikelID.Value = txtID.Value
    frmVerleih.lbl_VBezeichnung.Caption = txt_Bezeichnung.Value
    frmVerleih.lbl_VHerstellerNR.Caption = txtHnr.Value
    frmVerleih.lbl_VHersteller.Caption = cboHersteller.Value
    If Not txt_VKDID.Value = "" Then
        frmVerleih.cbo_Kunden = frmLager.txt_VKDID
        frmVerleih.txt_VNr.Value = frmLager.txt_VNr.Value
        frmVerleih.cbo_VNr = frmLager.txt_VNr.Value
    End If
    If txt_BestandVer.Value = "" Then
        frmVerleih.txt_Verfuegbar.Value = txtBestand.Value
        frmVerleih.lbl_Verfuegbar.Caption = "Verf|fffd|gbar: " & txtBestand.Value
    Else
        frmVerleih.txt_Verfuegbar.Value = txt_BestandVer.Value
        frmVerleih.lbl_Verfuegbar.Caption = "Verf|fffd|gbar: " & txt_BestandVer.Value
    End If
    If txt_BestandVer.Value = "" And frmVerleih.txt_Verfuegbar.Value = "" Then
        frmVerleih.txt_Verfuegbar.Value = ""
        frmVerleih.lbl_Verfuegbar.Caption = ""
    End If
    If Not txt_LPID.Value = "" Then
        frmVerleih.txt_LPID.Value = txt_LPID.Value
        frmVerleih.txt_LMenge.Value = txt_MengePlatz.Value
    ElseIf txt_LPID.Value = "" And Not txt_MengePlatz.Value = "" Then
        frmVerleih.txt_Verfuegbar.Value = txt_MengePlatz.Value
    End If
    If Not txtID.Value = "" Then
        If cbo_Lagerplatz.ListCount > 1 Then
            frmVerleih.cbo_Lagerplatz.BackColor = &H80000005
            frmVerleih.cbo_Lagerplatz.Enabled = True
            frmVerleih.cbo_Lagerplatz.TabStop = True
            frmVerleih.cbo_Lagerplatz = cbo_Lagerplatz
        Else
            frmVerleih.cbo_Lagerplatz = txtLagerort.Value
            frmVerleih.cbo_Lagerplatz.BackColor = &H8000000F
            frmVerleih.cbo_Lagerplatz.Enabled = False
            frmVerleih.cbo_Lagerplatz.TabStop = False
        End If
    Else
        frmVerleih.cbo_Lagerplatz.BackColor = &H8000000F
        frmVerleih.cbo_Lagerplatz.Locked = True
    End If
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        frmVerleih.cbo_Lagerplatz.Enabled = True
        frmVerleih.cbo_Lagerplatz.Clear
        frmVerleih.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        For Each xKey In DIC
            frmVerleih.cbo_Lagerplatz.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        frmVerleih.cbo_Lagerplatz.ListIndex = 0
    Else
        frmVerleih.cbo_Lagerplatz.Clear
        frmVerleih.cbo_Lagerplatz.Enabled = False
    End If
    frmVerleih.cbo_Liste.ListIndex = 0
    Application.ScreenUpdating = True
    frmVerleih.Show
End Sub

Private Sub cmd_UmL_Click()
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    If Sheets("Lager").Cells(CLng(frmLager.txtzeile), 13) = "" Then
        frmLagerorte.lbl_LagerInfo.Caption = "Noch kein Hauptlagerplatz!"
        frmLagerorte.txt_info.Value = "HH"
    Else
        frmLagerorte.txt_info.Value = ""
    End If
    If txtID.Value = "" Then Exit Sub
    frmLagerorte.lbl_Artikelnummer.Caption = txt_item.Value
    frmLagerorte.lbl_bezeichnung.Caption = lbl_bezeichnung
    frmLagerorte.lbl_Artikelnummer2.Caption = txt_item.Value
    frmLagerorte.txt_Bezeichnung2.Value = lbl_bezeichnung
    frmLagerorte.lbl_ID.Caption = txtID.Value
    Call frmLagerorte.suchenIDNeu
    frmLagerorte.Show
End Sub

Private Sub cmd_KategorieHM_Click()
    If cbo_KategorieHM = "" Then Exit Sub
    Call Kategorie
End Sub

Private Sub lbl_Benutzer_Click()
    If lbl_Benutzer.Caption = "" Then Exit Sub
    MsgBox Sheets("Daten").Range("B24") & vbLf & AdminN & vbLf & "Angemeldet seit: " & Format(Sheets("Daten").Range("B23"), "hh:nn") & " Uhr" & " (" & FormatDateTime(Time - ZeitN, vbLongTime) & ")", , "Info / Angemeldet"
End Sub

Private Sub lbl_Day_Click()
    frmKalender.cmd_heute.Visible = False
    frmKalender.cmd_Datum.Visible = False
    frmKalender.txt_UID.Value = "info"
    frmKalender.Show
End Sub

Private Sub lbl_month_Click()
    frmKalender.cmd_heute.Visible = False
    frmKalender.cmd_Datum.Visible = False
    frmKalender.txt_UID.Value = "info"
    frmKalender.Show
End Sub

Private Sub lbl_Verleihanzeigen_Click()
    frmVerleih.txt_IDArtikel.Value = txtID
    Call frmVerleih.SuchenID2
    frmVerleih.Show
    Call frmVerleih.leeren
    Call frmVerleih.SuchenID2
End Sub

Private Sub lbl_year_Click()
    frmKalender.cmd_heute.Visible = False
    frmKalender.cmd_Datum.Visible = False
    frmKalender.txt_UID.Value = "info"
    frmKalender.Show
End Sub

Private Sub lstmainmenu_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Call cmdKasse_Click
End Sub

Private Sub txt_Bezeichnung_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If Not txt_Bezeichnung = "" Then
        If KeyCode = 13 Then
            Call Bezeichnung
        End If
    End If
End Sub

Private Sub txt_item_Change()
    If txt_item.Value = "" Then
        txt_item.BorderColor = &HFF&
    Else
        txt_item.BorderColor = &HC000&
    End If
End Sub

Private Sub txt_Lemail_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    If frmLager.txt_Lemail = "" Then Exit Sub
    frmEmail.txt_AN.Value = frmLager.txt_Lemail
    frmEmail.Show
End Sub

Private Sub txt_item_AfterUpdate()
    If txt_item.Value = "" Then Exit Sub
    Call Asuchen
    Call Datensaetze
End Sub

Private Sub txtHnr_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If Not txtHnr = "" Then
        If KeyCode = 13 Then
            txtzeile.Value = ""
            lblZinfo.Caption = ""
            Call SuchenHerstellerNr
        End If
    End If
End Sub

Private Sub txtID_Change()
    If Not txtID.Value = "" Then
        Call VDatumcheck
    End If
End Sub

Sub WGCombo()
    Dim hsh As Object, i As Long
    Application.ScreenUpdating = False
    Const COL1 As Long = 8 'Spalte
    Set hsh = CreateObject("Scripting.Dictionary")
    With Sheets("Daten")
        For i = 2 To .Cells(.Rows.Count, COL1).End(xlUp).Row
            hsh(.Cells(i, COL1).Text) = 0
        Next
        cboWarengruppe.List = Application.Transpose(hsh.keys)
    End With
    Set hsh = Nothing
    Application.ScreenUpdating = True
End Sub

Sub KategorieCombo()
    Dim hsh As Object, i As Long
    Application.ScreenUpdating = False
    Const COL1 As Long = 9 'Spalte
    Set hsh = CreateObject("Scripting.Dictionary")
    With Sheets("Daten")
        For i = 2 To .Cells(.Rows.Count, COL1).End(xlUp).Row
            hsh(.Cells(i, COL1).Text) = 0
        Next
        cbo_KategorieHM.List = Application.Transpose(hsh.keys)
    End With
    Set hsh = Nothing
    Application.ScreenUpdating = True
End Sub

Sub HerstellerCombo()
    Dim hsh As Object, i As Long
    Application.ScreenUpdating = False
    Const COL1 As Long = 10 'Spalte
    Set hsh = CreateObject("Scripting.Dictionary")
    With Sheets("Daten")
        For i = 2 To .Cells(.Rows.Count, COL1).End(xlUp).Row
            hsh(.Cells(i, COL1).Text) = 0
        Next
        cboHersteller.List = Application.Transpose(hsh.keys)
    End With
    Set hsh = Nothing
    Application.ScreenUpdating = True
End Sub

Sub wenn()
    On Error Resume Next
    ThisWorkbook.Activate
    Application.ScreenUpdating = False
    With frmLager
        If CDbl(.txtbestandmin.Value + .txtMeldeBestand.Value) > 0 Then
            If .txt_BestandVer.Value = "" Then
                If IsNumeric(.txtbestandmin) Then
                    If CDbl(.txtbestandmin.Value) >= CDbl(.txtBestand.Value) Then
                        .lblhinweis.Caption = "Minimum erreicht. Bitte bestellen!"
                        .lblhinweis.ForeColor = vbRed
                        .lbstatus.BackColor = vbRed
                    ElseIf CDbl(frmLager.txtMeldeBestand.Value) >= CDbl(.txtBestand.Value) Then
                        .lblhinweis.Caption = "Meldebestand erreicht!"
                        .lblhinweis.ForeColor = &H80FF&
                        .lbstatus.BackColor = &H8000000B
                    Else: frmLager.lblhinweis.Caption = "Bestand OK"
                        .lblhinweis.ForeColor = &H4000&
                        .lbstatus.BackColor = &H8000000B
                    End If
                Else
                    .lblhinweis.Caption = "Kein Mindestbestand!"
                    .lblhinweis.ForeColor = &H80FF&
                    .lbstatus.BackColor = &H8000000B
                End If
            Else
                If IsNumeric(.txtbestandmin) Then
                    If CDbl(.txtbestandmin.Value) >= CDbl(.txt_BestandVer.Value) Then
                        .lblhinweis.Caption = "Minimum erreicht. Bitte bestellen!"
                        .lblhinweis.ForeColor = vbRed
                        .lbstatus.BackColor = vbRed
                    ElseIf CDbl(frmLager.txtMeldeBestand.Value) >= CDbl(.txt_BestandVer.Value) Then
                        .lblhinweis.Caption = "Meldebestand erreicht!"
                        .lblhinweis.ForeColor = &H80FF&
                        .lbstatus.BackColor = &H8000000B
                    Else: frmLager.lblhinweis.Caption = "Bestand OK"
                        .lblhinweis.ForeColor = &H4000&
                        .lbstatus.BackColor = &H8000000B
                    End If
                Else
                    .lblhinweis.Caption = "Kein Mindestbestand!"
                    .lblhinweis.ForeColor = &H80FF&
                    .lbstatus.BackColor = &H8000000B
                End If
            End If
        Else
            .lblhinweis.Caption = ""
            .lbstatus.BackColor = &H8000000B
        End If
    End With
    If Not CStr(Worksheets("Lager").Cells(CLng(txtzeile), 9)) = "Bestellt" Then
        If Not frmLager.txtMeldeBestand = "" Then
            If CDbl(Sheets("Lager").Cells(CLng(txtzeile), 8).Value <= Sheets("Lager").Cells(CLng(txtzeile), 11).Value) Then
                Sheets("Lager").Cells(CLng(txtzeile), 9).Font.ColorIndex = 3
                Sheets("Lager").Cells(CLng(txtzeile), 9) = "Bestellen"
            Else
                Sheets("Lager").Cells(CLng(txtzeile), 9) = ""
            End If
        ElseIf Not frmLager.txtbestandmin = "" Then
            If CDbl(Sheets("Lager").Cells(CLng(txtzeile), 8).Value) <= CDbl(Sheets("Lager").Cells(CLng(txtzeile), 10).Value) Then
                Sheets("Lager").Cells(CLng(txtzeile), 9).Font.ColorIndex = 3
                Sheets("Lager").Cells(CLng(txtzeile), 9) = "Bestellen"
            Else
                Sheets("Lager").Cells(CLng(txtzeile), 9) = ""
            End If
        End If
    End If
    Application.ScreenUpdating = True
End Sub

Sub LffrmLager()
    Dim xrow As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    With frmLager
        xrow = xFind(ActiveWorkbook.Name, "Lieferanten", CStr(.txtLNr), "A:A")
        .txtLFirma.Value = VBA.Replace(CStr(Sheets("Lieferanten").Cells(xrow, 2).Value), Chr$(13) & Chr$(10), " ")
        .txtLAnsprech.Value = Sheets("Lieferanten").Cells(xrow, 5)
        .txtLphone.Value = Sheets("Lieferanten").Cells(xrow, 8)
        .txt_Lemail.Value = Sheets("Lieferanten").Cells(xrow, 12)
    End With
    Application.ScreenUpdating = True
End Sub

Sub VDatumcheck()
    Dim arrTmpA, arrTmpB, i, lngS As Long
    Dim Last_Row, lng As Long
    Dim lngID As Long
    Dim Vdate As Date
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    If ThisWorkbook.Sheets("Daten").Range("B44").Value = "Nein" Then Exit Sub
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                lngID = i
            End If
        Next i
    End With
    If Worksheets("Lager").Cells(CLng(lngID), 39) = "" Then Exit Sub
    Vdate = Worksheets("Lager").Cells(CLng(lngID), 39)
    If CDate(Worksheets("Lager").Cells(CLng(lngID), 39)) <= CDate(Date) Then
        MsgBox "Verwendbarkeit f|fffd|r diesen Artikel ist abgelaufen!" & vbLf & vbLf & "Verwendbar bis: " & Vdate, vbCritical, "Verwendbarkeit"
        Exit Sub
    ElseIf Not Worksheets("Lager").Cells(CLng(lngID), 39) = "" And Worksheets("Lager").Cells(CLng(lngID), 40) = "" Then
        If CDate(Vdate - 14) <= Date Then
            MsgBox "Verwendbarkeit l|fffd|uft f|fffd|r den Artikel ab!" & vbLf & vbLf & "Verwendbar bis: " & Vdate, vbCritical, "Verwendbarkeit (automatische Meldung)"
            Exit Sub
        End If
    ElseIf CDate(Worksheets("Lager").Cells(CLng(lngID), 40)) <= CDate(Date) Then
        MsgBox "Verwendbarkeit l|fffd|uft f|fffd|r den Artikel ab!" & vbLf & vbLf & "Verwendbar bis: " & Vdate, vbCritical, "Verwendbarkeit"
    End If
End Sub

Private Sub cmd_Abmelden_Click()
    ThisWorkbook.Sheets("Daten").Range("B7").Value = ""
    ThisWorkbook.Sheets("Daten").Range("B23").Value = ""
    ThisWorkbook.Sheets("Daten").Range("B24").Value = ""
    frmLager.txt_Admin.Value = ""
    Unload frmLager
End Sub

Private Sub cmd_Kunden_Click()
    frmKunden.Show
End Sub

Private Sub cmdIDdoppel_Click()
    Call Find_DoppelteID
End Sub

Sub Find_DoppelteID() '1.40
    Dim oDic As Object, ArrayData()
    Dim n, lngx, zeile, lngID, lngA, wert As Long
    Dim strZ As String
    Dim nTimer
    On Error Resume Next
    nTimer = Timer
    wert = 0
    lngID = WorksheetFunction.CountA(Sheets("Lager").Range("A:A")) - 1
    lngA = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1
    If lngID = lngA Then
        Sheets("Daten").Range("B34").Value = "Status ok!"
    Else
        Sheets("Daten").Range("B34").Value = ""
        Sheets("Daten").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = "'" & Date
        ActiveCell.Offset(0, 1).Value = "#IDs FEHLEN/UNVOLLSTAENDIG!# Bitte pr|fffd|fen!"
        ActiveCell.Offset(0, 2).Value = "'" & Format(Now, "HH:MM:SS")
        wert = 1
        Sheets("Center").Activate
    End If
    If Not wert = 1 Then
        Set oDic = CreateObject("Scripting.Dictionary")
        Sheets("Lager").Activate
        lngx = 0
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Lager") 'Tabelle anpassen
            zeile = .Cells(Rows.Count, 1).End(xlUp).Row
            strZ = "A" & zeile
            ArrayData = .Range("A2:" & strZ).Value2 'Zellbereich anpassen
            ReDim ArrayAusgabe(1 To UBound(ArrayData), 1 To 1)
            For n = 1 To UBound(ArrayData)
                If Not ArrayData(n, 1) = "" Then
                    oDic(ArrayData(n, 1)) = oDic(ArrayData(n, 1)) + 1
                End If
            Next n
            For n = 1 To UBound(ArrayData)
                If oDic(ArrayData(n, 1)) > 1 Then
                    lngx = lngx + 1
                End If
            Next n
        End With
        Application.ScreenUpdating = True
        Sheets("Center").Activate
        If lngx > 1 Then
            Sheets("Daten").Range("B34").Value = "#Fehler ID!"
            txtIDS.Value = "#Fehler ID!"
            txtIDS.BackColor = &HC0&
            txtIDS.ForeColor = &HFFFFFF
            lbl_V2.Visible = True
            lbl_V2.Caption = "#ID Fehler > Bitte pr|fffd|fen!#"
            MsgBox "Es wurden " & lngx & " Eintr|fffd|ge gefunden!" & vbLf & vbLf & "Dauer: " & Format(CDbl(Timer - nTimer), "0.00") & " Sek.", vbCritical, "Doppelte ID"
        Else
            Sheets("Daten").Range("B34").Value = "Status ok!"
            txtIDS.Value = "Status ok!"
            txtIDS.BackColor = &H80000005
            txtIDS.ForeColor = &H8000&
            lbl_V2.Visible = False
            MsgBox "Dauer: " & Format(CDbl(Timer - nTimer), "0.00") & " Sek.", , "Kein Fehler gefunden!"
        End If
    Else
        MsgBox "Dauer: " & Format(CDbl(Timer - nTimer), "0.00") & " Sek.", , "Fehler gefunden! (IDs fehlen)"
    End If
End Sub

Private Sub cmdLogOut_Click()
    ThisWorkbook.Sheets("Daten").Range("B7").Value = ""
    ThisWorkbook.Sheets("Daten").Range("B23").Value = ""
    ThisWorkbook.Sheets("Daten").Range("B24").Value = ""
    Unload frmLager
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Schlie|fffd|en"" beenden!", , "Hinweis"
        cmdexit.SetFocus
        Cancel = True
    End If
End Sub

Private Sub cmdstatusinfo_Click()
    On Error Resume Next
    If lblhinweis.Caption = "" Then Exit Sub
    frmorderinfo.lblArtikelinfo.Caption = VBA.Replace(CStr(txt_item.Text), Chr$(13) & Chr$(10), " ") & " " & VBA.Replace(CStr(lbl_bezeichnung), Chr$(13) & Chr$(10), " ") & " (" + txtHnr + ")"
    Call frmorderinfo.SuchenBestellung
    frmorderinfo.Show
End Sub

Private Sub cmdBild_Click()
    Dim strLink As String
    On Error GoTo sprungmarke
    If txtID.Value = "" Then Exit Sub
    If Worksheets("Lager").Cells(CLng(txtzeile), 28) = "" Then Exit Sub
    If Not txtID.Value = "" Then
        strLink = Worksheets("Lager").Cells(CLng(txtzeile), 28).Formula
        strLink = Split(strLink, "(" & Chr(34))(1)
        strLink = Split(strLink, Chr(34) & ",")(0)
        strLink = Replace(strLink, "file:///", "")
        With Sheets("Lager")
            ThisWorkbook.FollowHyperlink strLink
        End With
        Exit Sub
    End If
sprungmarke:
    MsgBox "Bild nicht gefunden!", vbOKOnly, "Hinweis"
End Sub

Private Sub cmdPDF1_Click()
    Dim strLink As String
    On Error GoTo sprungmarke
    If txtPDF.Value = "" Or txtID.Value = "" Then Exit Sub
    strLink = Worksheets("Lager").Cells(txtzeile, 27).Formula
    strLink = Split(strLink, "(" & Chr(34))(1)
    strLink = Split(strLink, Chr(34) & ",")(0)
    ThisWorkbook.FollowHyperlink strLink
    ThisWorkbook.Worksheets("Center").Activate
    Exit Sub
sprungmarke:
    MsgBox "PDF Datei nicht gefunden!", vbOKOnly, "Hinweis"
End Sub

Private Sub cmdSuchenWaren_Click()
    If cboWarengruppe.Value = "" Then Exit Sub
    txtzeile.Value = ""
    lblZinfo.Caption = ""
    Call Warengruppe
End Sub

Sub Alles() '1.44
    Dim arrTmpA, arrTmpB, i, j, Last_Row, n, lng, lngS, lngL As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2 As Long
    Dim T As Double
    Dim strwert As String
    On Error Resume Next
    T = Timer
    Application.ScreenUpdating = False
    strwert = txtWG.Value
    lstmainmenu.Clear
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not LCase(arrTmpA(i, 1)) = "" Then
                n = n + 1
                lngS = 0
                arrTmpB(1, n) = arrTmpA(i, 3)
                lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                If lngL > 45 Then
                    arrTmpB(2, n) = Left$(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                Else
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                End If
                With ThisWorkbook.Sheets("Lagerorte")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If Not arrTmpA2(i2, 2) = "" And arrTmpA2(i2, 2) = CStr(arrTmpA(i, 1)) Then
                            lngS = lngS + CDbl(arrTmpA2(i2, 4))
                        End If
                    Next i2
                End With
                If CDbl(lngS) > 0 Then
                    If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                    End If
                Else
                    If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                    End If
                End If
               arrTmpB(4, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 4)
            For i = 1 To 4
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstmainmenu
               .ColumnCount = 3
               .ColumnWidths = "100;250;50;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
    Call Datensaetze
    txtWG.Value = strwert
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub Warengruppe() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row As Long, n, lng, lngS, lngL As Long
    Dim SuchKriterium, strwert As String
    Dim j As Double
    Dim T As Double
    On Error Resume Next
    T = Timer
    strwert = txtWG.Value
    SuchKriterium = cboWarengruppe
    Call Maskeclear
    cboWarengruppe = SuchKriterium
    lstmainmenu.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If Not arrTmpA(i, 16) = "" And LCase(arrTmpA(i, 16)) = LCase(SuchKriterium) Then
                n = n + 1
                lngS = 0
                arrTmpB(1, n) = arrTmpA(i, 3)
                lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                If lngL > 45 Then
                    arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                Else
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                End If
                For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                    If CStr(Sheets("Lagerorte").Cells(lng, 2).Value) = CStr(arrTmpA(i, 1)) Then
                        lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                    End If
                Next lng
                If CDbl(lngS) > 0 Then
                    If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                    End If
                Else
                    If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                    End If
                End If
                arrTmpB(4, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 4)
            For i = 1 To 4
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstmainmenu
               .ColumnCount = 3
               .ColumnWidths = "100;250;50;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
    Call Datensaetze
    txtWG.Value = strwert
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub Kategorie() '1.40
    Dim arrTmpA, arrTmpB, i As Long, j As Double, n, lng, lngS, lngL As Long
    Dim SuchKriterium, strwert As String, Last_Row As Long
    Dim T As Double
    On Error Resume Next
    T = Timer
    strwert = txtWG.Value
    Application.ScreenUpdating = False
    If cboWarengruppe.Value = "" Then
        SuchKriterium = LCase(cbo_KategorieHM.Text)
        lstmainmenu.Clear
        With ThisWorkbook.Sheets("Lager")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AO" & Last_Row)
           ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 41) = "" And LCase(arrTmpA(i, 41)) = LCase(SuchKriterium) Then
                    n = n + 1
                    lngS = 0
                    arrTmpB(1, n) = arrTmpA(i, 3)
                    lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                    If lngL > 45 Then
                        arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                    Else
                        arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    End If
                    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                         If CStr(Sheets("Lagerorte").Cells(lng, 2).Value) = CStr(arrTmpA(i, 1)) Then
                             lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                         End If
                     Next lng
                     If CDbl(lngS) > 0 Then
                        If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    Else
                        If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    End If
                    arrTmpB(4, n) = i
               End If
           Next i
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 4)
                For i = 1 To 4
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With lstmainmenu
                   .ColumnCount = 3
                   .ColumnWidths = "100;250;50;0"
                   .List = arrTmpA
                End With
           End If
        End With
    Else
        lstmainmenu.Clear
        With ThisWorkbook.Sheets("Lager")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AO" & Last_Row)
           ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If Not arrTmpA(i, 16) = "" And arrTmpA(i, 16) = CStr(cboWarengruppe) And arrTmpA(i, 41) = CStr(cbo_KategorieHM) Then
                   n = n + 1
                   arrTmpB(1, n) = arrTmpA(i, 3)
                   arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                   arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                   arrTmpB(4, n) = i
               End If
           Next i
          
           If n > 0 Then
                Erase arrTmpA
                ReDim arrTmpA(1 To n, 1 To 7)
                For i = 1 To 4
                   For j = 1 To n
                       arrTmpA(j, i) = arrTmpB(i, j)
                   Next
                Next
                With lstmainmenu
                   .ColumnCount = 3
                   .ColumnWidths = "100;250;50;50;0;0"
                   .List = arrTmpA
                End With
           End If
        End With
    End If
    Application.ScreenUpdating = True
    Call Datensaetze
    txtWG.Value = strwert
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Private Sub cmdtxtAsuchen_Click()
    If Not txt_item.Value = "" Then
        Call Asuchen
        Call SuchenBMenge
        Call SuchenR
    End If
End Sub

Sub Asuchen() '1.44
    Dim strFile, nrstr, strID, strwert As String
    Dim lng, lngg, xrow As Long
    Dim T, lngS As Double
    Dim xKey As Variant
    Dim DIC As Object
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    T = Timer
    ThisWorkbook.Activate
    Application.ScreenUpdating = False
    strwert = txtWG.Value
    If txt_item.Value = "" Then Exit Sub
    nrstr = txtWG.Value
    Call suchenTArtikel
    lngg = 0
    Set frmLager.Image1.Picture = Nothing
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 3) = "" And arrTmpA(i, 3) = CStr(txt_item) Then
                xrow = i
            End If
        Next i
    End With
    If xrow = 0 Then GoTo weiter
        lblZinfo.Caption = "Artikel befindet sich in Zeile " & CDbl(xrow)
        lbl_bezeichnung.Caption = Sheets("Lager").Cells(xrow, 6)
        txt_Bezeichnung.Value = VBA.Replace(CStr(Sheets("Lager").Cells(xrow, 6).Value), Chr$(13) & Chr$(10), " ")
        cboHersteller.Value = Sheets("Lager").Cells(xrow, 7)
        Application.ScreenUpdating = True
        strID = Sheets("Lager").Cells(xrow, 1)
        txtID.Value = strID
        lngS = 0
        Set DIC = CreateObject("scripting.dictionary")
        For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
            If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
                lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                xKey = Sheets("Lagerorte").Cells(lng, 3).Value
                DIC(xKey) = 0
                lngg = lngg + 1
            End If
        Next lng
        If CDbl(lngg) > 0 Then
            txtBestand.Value = Sheets("Lager").Cells(xrow, 8) + lngS
            cbo_Lagerplatz.Enabled = True
            lbl_lagerplatz.Enabled = True
            lbl_lagerplatz2.Enabled = True
            frmLager.cbo_Lagerplatz.Clear
            frmKasse.cbo_Lagerplatz.Clear
            frmLager.txt_MengePlatz.Value = ""
            frmLager.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
            frmKasse.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
            For Each xKey In DIC
                frmLager.cbo_Lagerplatz.AddItem xKey
                frmKasse.cbo_Lagerplatz.AddItem xKey
            Next
            DIC.RemoveAll
            Set DIC = Nothing
            If Not Sheets("Lager").Cells(xrow, 13).Value = "" Then
                txtLagerort.Value = Sheets("Lager").Cells(xrow, 13).Value
            End If
            lbl1.BackColor = &H808080
            lbl2.BackColor = &H808080
            lbl3.BackColor = &H808080
        Else
            frmLager.cbo_Lagerplatz.Clear
            frmKasse.cbo_Lagerplatz.Clear
            frmLager.txt_MengePlatz.Value = ""
            txtBestand.Value = Sheets("Lager").Cells(xrow, 8)
            cbo_Lagerplatz.Enabled = False
            lbl_lagerplatz.Enabled = False
            lbl_lagerplatz2.Enabled = False
            txt_MengePlatz.Value = ""
            cbo_Lagerplatz.Clear
            txtLagerort.Value = Sheets("Lager").Cells(xrow, 13).Value
            lbl1.BackColor = &HC0C0C0
            lbl2.BackColor = &HC0C0C0
            lbl3.BackColor = &HC0C0C0
        End If
        Application.ScreenUpdating = False
        lbl_ldate.Caption = Sheets("Lager").Cells(xrow, 18).Text
        txtHnr.Value = Sheets("Lager").Cells(xrow, 4)
        txtLagerort.Value = Sheets("Lager").Cells(xrow, 13)
        cboWarengruppe.Text = Sheets("Lager").Cells(xrow, 16)
        txtbestandmin.Value = Sheets("Lager").Cells(xrow, 10)
        lbl_ldate.Caption = Sheets("Lager").Cells(xrow, 17).Text
        txteinheit.Value = Sheets("Lager").Cells(xrow, 12)
        txtMeldeBestand.Value = Sheets("Lager").Cells(xrow, 11)
        txtFrei.Value = Sheets("Lager").Cells(xrow, 5)
        lbl_bereitsVerk.Caption = Sheets("Lager").Cells(xrow, 25)
        lbl_erstellt.Caption = Sheets("Lager").Cells(xrow, 2)
        lbl_letzterWA.Caption = Sheets("Lager").Cells(xrow, 23)
        lbl_lWAt.Caption = Sheets("Lager").Cells(xrow, 24)
        lbl_Kommentar.Caption = Sheets("Lager").Cells(xrow, 20)
        Frame_Lieferant.txtLNr.Value = Sheets("Lager").Cells(xrow, 18).Text
        txtPDF.Text = Sheets("Lager").Cells(xrow, 27)
        txtPreisVK.Value = CDbl(Sheets("Lager").Cells(xrow, 15))
        lbl_EKPreis.Caption = Format(Sheets("Lager").Cells(xrow, 14), "currency")
        lbl_VKPreis.Caption = Format(CDbl(Sheets("Lager").Cells(xrow, 15)), "currency")
        lbl_UMST.Caption = Format(Sheets("Lager").Cells(xrow, 21), "0.0%")
        txt_BN.Value = Sheets("Lager").Cells(xrow, 22)
        txtzeile.Value = CDbl(xrow)
        txt_gesperrt.Value = Sheets("Lager").Cells(xrow, 42)
        If CDbl(Sheets("Lager").Cells(xrow, 32)) > 0 Then
        If Format(CDbl(Sheets("Lager").Cells(xrow, 32)), "0.0") = CDbl(Sheets("Lager").Cells(xrow, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(xrow, 32), "0.0") & " " & "Kg"
        ElseIf Format(CDbl(Sheets("Lager").Cells(xrow, 32)), "0.00") = CDbl(Sheets("Lager").Cells(xrow, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(xrow, 32), "0.00") & " " & "Kg"
        ElseIf Format(CDbl(Sheets("Lager").Cells(xrow, 32)), "0.000") = CDbl(Sheets("Lager").Cells(xrow, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(xrow, 32), "0.000") & " " & "Kg"
        Else
            txt_AGewicht.Value = Sheets("Lager").Cells(xrow, 32) & " " & "Kg"
        End If
    Else
        txt_AGewicht.Value = ""
    End If
    If Sheets("Lager").Cells(xrow, 21) = "" Then
        lbl_ButtoVK.Caption = Format(CDbl(Sheets("Lager").Cells(xrow, 15)), "currency")
    Else
        lbl_ButtoVK.Caption = Format((Sheets("Lager").Cells(xrow, 15) * Sheets("Lager").Cells(xrow, 21)) + Sheets("Lager").Cells(xrow, 15), "currency")
    End If
    If Len(Sheets("Lager").Cells(xrow, 28).Value) > 0 Then
        strFile = Sheets("Lager").Cells(xrow, 28).Formula
        strFile = Split(strFile, "(" & Chr(34))(1)
        strFile = Split(strFile, Chr(34) & ",")(0)
        strFile = Replace(strFile, "file:///", "")
        Set frmLager.Image1.Picture = LoadPicture(strFile)
        lbl_bild.Visible = False
    Else
        Set frmLager.Image1.Picture = Nothing
        lbl_bild.Visible = True
    End If
    'Kommentar pruefen
    If Sheets("Lager").Cells(xrow, 20) <> 0 Then
        tbKomHinweis.BackColor = &HC0&
    Else
        tbKomHinweis.BackColor = &H8000000B
    End If
    cmdAnlegen2.Visible = True
    Call LffrmLager 'Lieferanten ergaenzen
weiter:
    Call wenn
    Call AnZLieferanten
    If txtBestand.Value = "" Then
        lblhinweis.Caption = ""
        tbKomHinweis.BackColor = &H80000005
    End If
    If lstmainmenu.ListCount > 1 Then
        cboWarengruppe.ListIndex = -1
        cboHersteller.ListIndex = -1
        cboWarengruppe.ListIndex = -1
        Call Textboxenleeren
        txt_item.SetFocus
    End If
    Call Datensaetze
    txtWG.Value = nrstr
    If lstmainmenu.ListCount >= 1 Then
        lstmainmenu.SetFocus
        lstmainmenu.ListIndex = 0
    End If
    txtWG.Value = strwert
    Application.ScreenUpdating = True
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Public Sub Selektieren()
    Dim i As Long
    Application.ScreenUpdating = False
    For i = 1 To frmLager.lstmainmenu.ListCount - 1
        frmLager.lstmainmenu.Selected(i) = True
    Next i
    Application.ScreenUpdating = True
End Sub

Private Sub chkEKPreis_Click()
    If chkEKPreis.Value = True Then
        lbl_EKPreis.Visible = True
        Worksheets("Daten").Range("B22") = "ja"
    Else
        lbl_EKPreis.Visible = False
        Worksheets("Daten").Range("B22") = ""
    End If
End Sub

Private Sub cmdAnlegen2_Click() 'V1.44
    On Error Resume Next
    ThisWorkbook.Activate
    If Sheets("Daten").Range("B33").Value = "" Then
        frmArtikel.lbl_LArtikelNr.Caption = ""
    Else
        frmArtikel.lbl_LArtikelNr.Caption = "Letzte Artikel Nr.: " & Sheets("Daten").Range("B33").Value
    End If
    With frmArtikel
        .Caption = "|fffd|hnlichen Artikel anlegen"
        .lbl_AHinweis.Visible = False
        .cmdaendern.Visible = False
        .cbo_Hersteller.Value = cboHersteller.Value
        .txt_Bezeichnung.Value = txt_Bezeichnung.Value
        .cbo_einheit.Value = txteinheit.Value
        .cboLagerort.Value = txtLagerort.Value
        .txt_Hnr.Text = txtHnr.Text
        .cboWarengruppe.Value = cboWarengruppe.Value
        .txtKommentar.Value = lbl_Kommentar.Caption
        .txtMeldeBestand.Value = txtMeldeBestand.Value
        .txtbestandmin.Value = txtbestandmin.Value
        .cboWarengruppe = Me.cboWarengruppe
        If Not lbl_EKPreis.Caption = "" Then
            .txtEKPreis.Value = Format(CDbl(lbl_EKPreis), "currency")
        End If
        If txt_BN.Value = "B" Then
            .op_Brutto.Value = True
            .op_Netto.Value = False
        Else
            .op_Netto.Value = True
            .op_Brutto.Value = False
        End If
        If lbl_UMST.Caption = "0,0%" Or lbl_UMST.Caption = "0.0%" Then
            .cboUMST.Value = "ohne"
        Else
            .cboUMST.Value = lbl_UMST.Caption
        End If
        If Frame_Lieferant.txtLFirma = "" Then
            .cboLieferant.ListIndex = -1
        Else
            .cboLieferant.Value = Frame_Lieferant.txtLFirma.Value
        End If
        Unload frmLager
        .txt_Artikelnummer.SetFocus
        .Show
    End With
End Sub

Sub cboArtikelnummer_Click() 'v1.36
    Dim strNrA As String
    If Not txtWG.Value = "" Then
        strNrA = txtWG.Value
    End If
    If frmLager.cboArtikelnummer = "" Then Exit Sub
    Call ArtikelDrop
    txtWG.Value = strNrA
End Sub

Sub ArtikelDrop() '1.44
    Dim xrow, strFile As String
    Dim arrTmpA, arrTmpB, i, Last_Row, lng, lngS, lngg As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim Zahl, ZahlW As Double
    On Error Resume Next

    Set frmLager.Image1.Picture = Nothing
    Application.ScreenUpdating = False
    If cboArtikelnummer.Value = "" Then
        Exit Sub
    End If
    lngg = 0
    ZahlW = 0
    Zahl = 0
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 3) = "" And arrTmpA(i, 3) = CStr(cboArtikelnummer) Then
                xrow = i
            End If
        Next i
    End With
    If xrow = 0 Then GoTo weiter
    txtzeile.Text = CDbl(xrow)
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    lblZinfo.Caption = "Artikel befindet sich in Zeile " & CDbl(xrow)
    txt_item.Value = Frame_ArtikelS.cboArtikelnummer.Text
    Call suchenTArtikel
    lbl_bezeichnung.Caption = Sheets("Lager").Cells(xrow, 6)
    txt_Bezeichnung.Value = VBA.Replace(CStr(Sheets("Lager").Cells(xrow, 6).Value), Chr$(13) & Chr$(10), " ")
    cboHersteller.Text = Sheets("Lager").Cells(xrow, 7)
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
            lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        txtBestand.Value = Sheets("Lager").Cells(xrow, 8) + lngS
        cbo_Lagerplatz.Enabled = True
        lbl_lagerplatz.Enabled = True
        lbl_lagerplatz2.Enabled = True
        frmLager.cbo_Lagerplatz.Clear
        frmKasse.cbo_Lagerplatz.Clear
        frmLager.txt_MengePlatz.Value = ""
        frmLager.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        frmKasse.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        For Each xKey In DIC
            frmLager.cbo_Lagerplatz.AddItem xKey
            frmKasse.cbo_Lagerplatz.AddItem xKey
        Next
        frmLager.cbo_Lagerplatz.ListIndex = 0
        DIC.RemoveAll
        Set DIC = Nothing
        If Not Sheets("Lager").Cells(xrow, 13).Value = "" Then
            txtLagerort.Value = Sheets("Lager").Cells(xrow, 13).Value
        End If
        lbl1.BackColor = &H808080
        lbl2.BackColor = &H808080
        lbl3.BackColor = &H808080
    Else
        frmLager.cbo_Lagerplatz.Clear
        frmKasse.cbo_Lagerplatz.Clear
        frmLager.txt_MengePlatz.Value = ""
        txtBestand.Value = Sheets("Lager").Cells(xrow, 8)
        cbo_Lagerplatz.Enabled = False
        lbl_lagerplatz.Enabled = False
        lbl_lagerplatz2.Enabled = False
        txt_MengePlatz.Value = ""
        cbo_Lagerplatz.Clear
        txtLagerort.Value = Sheets("Lager").Cells(xrow, 13).Value
        lbl1.BackColor = &HC0C0C0
        lbl2.BackColor = &HC0C0C0
        lbl3.BackColor = &HC0C0C0
    End If
    lbl_ldate.Caption = Sheets("Lager").Cells(xrow, 18).Text
    txtHnr.Value = Sheets("Lager").Cells(xrow, 4)
    txtLagerort.Value = Sheets("Lager").Cells(xrow, 13)
    cboWarengruppe.Value = Sheets("Lager").Cells(xrow, 16)
    txtbestandmin.Value = Sheets("Lager").Cells(xrow, 10)
    lbl_ldate.Caption = Sheets("Lager").Cells(xrow, 17).Text
    txteinheit.Value = Sheets("Lager").Cells(xrow, 12)
    txtMeldeBestand.Value = Sheets("Lager").Cells(xrow, 11)
    txtFrei.Value = Sheets("Lager").Cells(xrow, 5)
    lbl_bereitsVerk.Caption = Sheets("Lager").Cells(xrow, 25)
    lbl_erstellt.Caption = Sheets("Lager").Cells(xrow, 2)
    lbl_letzterWA.Caption = Sheets("Lager").Cells(xrow, 23)
    lbl_lWAt.Caption = Sheets("Lager").Cells(xrow, 24).Text
    lbl_Kommentar.Caption = Sheets("Lager").Cells(xrow, 20)
    lbl_UMST.Caption = Format(Sheets("Lager").Cells(xrow, 21), "0.0%")
    Frame_Lieferant.txtLFirma.Value = Sheets("Lager").Cells(xrow, 19)
    Frame_Lieferant.txtLNr.Text = Sheets("Lager").Cells(xrow, 18).Text
    txtPDF.Value = Sheets("Lager").Cells(xrow, 27)
    txtPreisVK.Value = CDbl(Sheets("Lager").Cells(xrow, 15))
    lbl_EKPreis.Caption = Format(Sheets("Lager").Cells(xrow, 14), "currency")
    lbl_VKPreis.Caption = Format(CDbl(Sheets("Lager").Cells(xrow, 15)), "currency")
    txt_BN.Value = Sheets("Lager").Cells(xrow, 22)
    cbo_KategorieHM = Sheets("Lager").Cells(xrow, 41)
    txtzeile.Value = xrow
    If Worksheets("Daten").Range("F36") = "Ja" Then
        If Sheets("Lager").Cells(xrow, 21) = "" Then
            ZahlW = CDbl(Sheets("Lager").Cells(CLng(xrow), 15))
            Zahl = CLng(ZahlW / 0.05) * 0.05
            lbl_ButtoVK.Caption = Format(Zahl, "currency")
        Else
            ZahlW = CDbl(Sheets("Lager").Cells(CLng(xrow), 15) * Sheets("Lager").Cells(CDbl(xrow), 21)) + Sheets("Lager").Cells(xrow, 15)
            Zahl = CLng(ZahlW / 0.05) * 0.05
            lbl_ButtoVK.Caption = Format(Zahl, "currency")
        End If
    Else
        If Sheets("Lager").Cells(xrow, 21) = "" Then
            lbl_ButtoVK.Caption = Format(CDbl(Sheets("Lager").Cells(CLng(xrow), 15)), "currency")
        Else
            lbl_ButtoVK.Caption = Format((CDbl(Sheets("Lager").Cells(CLng(xrow), 15) * Sheets("Lager").Cells(CDbl(xrow), 21))) + Sheets("Lager").Cells(xrow, 15), "currency")
        End If
    End If
    If CDbl(Sheets("Lager").Cells(xrow, 32)) > 0 Then
        If Format(CDbl(Sheets("Lager").Cells(xrow, 32)), "0.0") = CDbl(Sheets("Lager").Cells(xrow, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(xrow, 32), "0.0") & " " & "Kg"
        ElseIf Format(CDbl(Sheets("Lager").Cells(xrow, 32)), "0.00") = CDbl(Sheets("Lager").Cells(xrow, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(xrow, 32), "0.00") & " " & "Kg"
        ElseIf Format(CDbl(Sheets("Lager").Cells(xrow, 32)), "0.000") = CDbl(Sheets("Lager").Cells(xrow, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(xrow, 32), "0.000") & " " & "Kg"
        Else
            txt_AGewicht.Value = Sheets("Lager").Cells(xrow, 32) & " " & "Kg"
        End If
    Else
        txt_AGewicht.Value = ""
    End If
    If Len(Sheets("Lager").Cells(xrow, 28).Value) > 0 Then
        strFile = Sheets("Lager").Cells(xrow, 28).Formula
        strFile = Split(strFile, "(" & Chr(34))(1)
        strFile = Split(strFile, Chr(34) & ",")(0)
        strFile = Replace(strFile, "file:///", "")
        Set frmLager.Image1.Picture = LoadPicture(strFile)
        lbl_bild.Visible = False
    Else
        Set frmLager.Image1.Picture = Nothing
        lbl_bild.Visible = True
    End If
    'Kommentar pr|fffd|fen
    If Sheets("Lager").Cells(xrow, 20) <> 0 Then
        tbKomHinweis.BackColor = &HC0&
    Else
        tbKomHinweis.BackColor = &H8000000B
    End If
    Call LffrmLager 'Lieferanten erg|fffd|nzen
    If Not frmLager.txtbestandmin.Value = "" Then
        If frmLager.txtMeldeBestand.Value = "" Then
            If (CDbl(Sheets("Lager").Cells(xrow, 8).Value) + CDbl(lngS)) <= CDbl(Sheets("Lager").Cells(xrow, 12).Value) And Not Worksheets("Lager").Cells(xrow, 9) = "Bestellt" Then
                Sheets("Lager").Cells(xrow, 9).Font.ColorIndex = 3
                Sheets("Lager").Cells(xrow, 9) = "Bestellen"
            Else
                Sheets("Lager").Cells(xrow, 9) = ""
            End If
        Else
            If (CDbl(Sheets("Lager").Cells(xrow, 8).Value) + CDbl(lngS)) <= CDbl(Sheets("Lager").Cells(xrow, 11).Value) And Not Worksheets("Lager").Cells(xrow, 9) = "Bestellt" Then
                Sheets("Lager").Cells(xrow, 9).Font.ColorIndex = 3
                Sheets("Lager").Cells(xrow, 9) = "Bestellen"
            Else
                Sheets("Lager").Cells(xrow, 9) = ""
            End If
        End If
    End If
weiter:
    Call wenn
    Call AnZLieferanten
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    If txtBestand.Value = "" Then
        lblhinweis.Caption = ""
        tbKomHinweis.BackColor = &H80000005
    End If
    If lstmainmenu.ListCount > 1 Then
        cboWarengruppe.ListIndex = -1
        lbl_bezeichnung.Caption = ""
        cboHersteller.ListIndex = -1
        txtHnr.Value = ""
        txtLagerort.Value = ""
        cboWarengruppe.ListIndex = -1
        Call Textboxenleeren
    End If
    cmdAnlegen2.Visible = True
    Call Datensaetze
    Call SuchenBMenge
    Application.ScreenUpdating = True
End Sub

Private Sub cmdAV_Click()
    frmGruppen.txt_ASLager.Value = frmLager.cboArtikelnummer
    frmGruppen.txt_Admin.Value = frmLager.txt_Admin.Value
    Unload frmLager
    frmGruppen.Show
End Sub

Private Sub cboBezeichnung_Enter()
    Frame_ArtikelS.cboArtikelnummer.ListIndex = -1
    txt_item.Value = ""
    cboHersteller.Value = ""
    lbl_bezeichnung.Caption = ""
    txtHnr.Value = ""
    txtLagerort.Value = ""
    cboWarengruppe.Value = ""
    lbldatensaetze.Caption = ""
    Call Textboxenleeren
End Sub

Private Sub cmdDirekt_Click() 'v1.44
    Dim strA, lngMsg, strLID As String
    Dim lngZeile, lng, lngS, lngg, lngrow, Last_Row As Long
    Dim arrTmpA, arrTmpB, i As Long
    On Error Resume Next
    If Sheets("Daten").Range("D48") = "Nein" Then
        MsgBox "Die Funktion ist standardgem|fffd||fffd| deaktiviert! Sie k|fffd|nnen dieses in den Einstellungen |fffd|ndern!", vbInformation, "Hinweis"
        Exit Sub
    End If
    If Not txt_gesperrt.Value = "" Then
        MsgBox "Artikel: """ & Me.txt_Bezeichnung & """ ist gesperrt!", , "Gesperrt seit: " & txt_gesperrt
        Exit Sub
    End If
    Application.ScreenUpdating = False
    strA = txt_item.Value
    If Not txtzeile = "" Then
        lngZeile = CLng(txtzeile)
    Else
        If Not txtID.Value = "" Then
            lngZeile = ""
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txtID) Then
                        lngZeile = i
                    End If
                Next i
            End With
        Else
            Exit Sub
        End If
    End If
    If txtID.Value = "" Then
        MsgBox "Bitte w|fffd|hlen Sie ein Artikel!", vbOKOnly, "Direkt buchen"
        Frame_ArtikelS.cboArtikelnummer.SetFocus
        Exit Sub
    ElseIf txtBestand.Value <= 0 Or txtBestand.Value = "" Then
        MsgBox "Kein Bestand!", vbOKOnly, "Hinweis"
        Exit Sub
    Else
        lngMsg = InputBox("Geben Sie die zu verbuchende Menge ein!", "Direkt Buchung (" + txt_item + ")", 1)
        If lngMsg = "" Then Exit Sub
        If Not IsNumeric(lngMsg) Then
            MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
            Exit Sub
        End If
        If txt_LPID.Value = "" And txt_MengePlatz.Value = "" Then
            lng = txt_BestandVer
        Else
            lng = txt_MengePlatz.Value
        End If
        If Not txt_LPID.Value = "" Then
            strLID = txt_LPID.Value
            For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
                If Sheets("Lagerorte").Cells(lng, 1) = strLID Then
                    lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                    lngrow = Sheets("Lagerorte").Cells(lng, 1).Row
                    lngg = lngg + 1
                End If
            Next lng
        End If
        If CDbl(lngg) > 0 And Not txt_LPID.Value = "" Then
            If CDbl(lngMsg) > CDbl(lngS) Then
                MsgBox "Ihre Eingabe ist gr|fffd||fffd|er wie der Verf|fffd|gbarer Bestand! M|fffd|chten Sie trotzdem fortfahren?", vbYesNo, "Hinweis"
                If vbYes Then Call DirektBuchen
                If vbNo Then Exit Sub
            End If
            Sheets("Lagerorte").Cells(lngrow, 4).Value = CDbl(Sheets("Lagerorte").Cells(CDbl(lngrow), 4).Value) - CDbl(lngMsg)
            Worksheets("Lager").Cells(lngZeile, 25).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngrow), 25).Value) + CDbl(lngMsg)
            Worksheets("Lager").Cells(lngZeile, 23).Value = Date
            Worksheets("Lager").Cells(lngZeile, 24).Value = Format(Time, "hh:mm:ss")
        Else
            If CDbl(lngMsg) > CDbl(txtBestand) Then
                MsgBox "Ihre Eingabe ist gr|fffd||fffd|er wie der Bestand! M|fffd|chten Sie trotzdem fortfahren?", vbYesNo, "Hinweis"
                If vbYes Then Call DirektBuchen
                If vbNo Then Exit Sub
            Else
                Worksheets("Lager").Cells(lngZeile, 8).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 8)) - CDbl(lngMsg)
                Worksheets("Lager").Cells(lngZeile, 25).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 25).Value) + CDbl(lngMsg)
                Worksheets("Lager").Cells(lngZeile, 23).Value = Date
                Worksheets("Lager").Cells(lngZeile, 24).Value = Format(Time, "hh:mm:ss")
                Call DirektBuchen
            End If
        End If
    End If
    With Worksheets("Warenausgang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    Sheets("Warenausgang").Activate
    Range("A65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, 0).Value = "Direkt Buchung"
    ActiveCell.Offset(0, 1).Value = "D" & ThisWorkbook.Sheets("Warenausgang").Range("B1").Text & Format(ThisWorkbook.Sheets("Warenausgang").Range("B5") + 1, "000000")
    ActiveCell.Offset(0, 2).Value = "'" & txt_item.Value
    ActiveCell.Offset(0, 3).Value = txt_Bezeichnung.Value
    ActiveCell.Offset(0, 4).Value = CDbl(lngMsg)
    ActiveCell.Offset(0, 5).Value = lbl_UMST.Caption
    ActiveCell.Offset(0, 6).Value = CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 15)) * CDbl(lngMsg)
    ActiveCell.Offset(0, 7).Value = Date
    ActiveCell.Offset(0, 8).Value = Format(Time, "hh:mm:ss")
    ActiveCell.Offset(0, 10).Value = Format(Date, "mmmm")
    ActiveCell.Offset(0, 11).Value = Format(Date, "yyyy")
    ActiveCell.Offset(0, 12).Value = CDbl(Worksheets("Lager").Cells(CLng(lngZeile), 15)) 'Preis nach ID
    ActiveCell.Offset(0, 13).Value = txtID.Value
    If CDbl(lbl_UMST.Caption) > 0 Then
        ActiveCell.Offset(0, 15).Value = (CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 15) * lngMsg)) * CDbl(lbl_UMST.Caption)
    Else
        ActiveCell.Offset(0, 15).Value = 0
    End If
    If Sheets("Daten").Range("B5").Value = "True" Then
        ActiveCell.Offset(0, 17).Value = Sheets("Daten").Range("B24").Value
    End If
    ActiveCell.Offset(0, 20).Value = strLID
    ThisWorkbook.Sheets("Warenausgang").Range("B5") = CDbl(ThisWorkbook.Sheets("Warenausgang").Range("B5").Text) + 1
    MsgBox "Es wurden " + lngMsg + " " + lbl_bezeichnung.Caption + " gebucht" & vbLf & vbLf & "Beleg: " & "D" & ThisWorkbook.Sheets("Warenausgang").Range("B1").Text & Format(ThisWorkbook.Sheets("Warenausgang").Range("B5"), "000000"), vbOKOnly, "Direkt Buchung"
    If Worksheets("Lager").Cells(lngZeile, 9).Text = "Bestellt" Then
        UserForm_Initialize
        Exit Sub
    Else
        If txtMeldeBestand.Value = "" Then
            If (CDbl(Worksheets("Lager").Cells(lngZeile, 8).Value) + CDbl(lngS)) <= CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 10).Value) And Not Worksheets("Lager").Cells(lngZeile, 9) = "Bestellt" Then
                Worksheets("Lager").Cells(lngZeile, 9).Font.ColorIndex = 3
                Worksheets("Lager").Cells(lngZeile, 9) = "Bestellen"
            End If
        Else
            If (CDbl(Worksheets("Lager").Cells(lngZeile, 8).Value) + CDbl(lngS)) <= CDbl(Worksheets("Lager").Cells(CDbl(lngZeile), 11).Value) And Not Worksheets("Lager").Cells(lngZeile, 9) = "Bestellt" Then
                Worksheets("Lager").Cells(lngZeile, 9).Font.ColorIndex = 3
                Worksheets("Lager").Cells(lngZeile, 9) = "Bestellen"
            End If
        End If
    End If
    Frame_ArtikelS.cboArtikelnummer.Clear
    UserForm_Initialize
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call Maskeclear
    txt_item.Value = strA
    Call Asuchen
    Call Datensaetze
End Sub

Private Sub cmdKasse_Click()
    On Error Resume Next
    If txtID.Value = "" Then
        frmKasse.Show
        Exit Sub
    Else
        frmKasse.txtArtikelnummerSicherung.Value = txt_item.Value
        frmKasse.lbl_herstellerNr.Caption = txtHnr.Value
        frmKasse.lbl_Hersteller.Caption = cboHersteller.Value
        frmKasse.txtzeile.Value = txtzeile.Text
        frmKasse.lbl_ArtikelNR.Caption = txt_item.Value
        frmKasse.lbl_bezeichnung.Caption = txt_Bezeichnung.Value
        frmKasse.lbl_VKPreisKasse.Caption = lbl_VKPreis.Caption
        frmKasse.lbl_Frei.Caption = txtFrei.Value
        frmKasse.lbl_UMST.Caption = lbl_UMST.Caption
        frmKasse.txt_Admin.Value = txt_Admin.Value
        frmKasse.txtID.Value = txtID.Value
        frmKasse.txtMenge.SetFocus
        frmKasse.cmdletzterArtikel.Visible = True
        If Not txt_LPID.Value = "" Then
            frmKasse.txt_LPID.Value = txt_LPID.Value
            frmKasse.txt_LMenge.Value = txt_MengePlatz.Value
        ElseIf txt_LPID.Value = "" And Not txt_MengePlatz.Value = "" Then
            frmKasse.txt_LMenge.Value = txt_MengePlatz.Value
            frmKasse.cbo_Lagerplatz = "Hauptlagerplatz"
        End If
        If Not txtID.Value = "" Then
            If cbo_Lagerplatz.ListCount > 1 Then
                frmKasse.cbo_Lagerplatz.BackColor = &H80000005
                frmKasse.cbo_Lagerplatz.Enabled = True
                frmKasse.cbo_Lagerplatz.TabStop = True
                frmKasse.cbo_Lagerplatz = cbo_Lagerplatz
            Else
                frmKasse.cbo_Lagerplatz = txtLagerort.Value
                frmKasse.cbo_Lagerplatz.BackColor = &H8000000F
                frmKasse.cbo_Lagerplatz.Enabled = False
                frmKasse.cbo_Lagerplatz.TabStop = False
            End If
        Else
            frmKasse.cbo_Lagerplatz.BackColor = &H8000000F
            frmKasse.cbo_Lagerplatz.Locked = True
        End If
        If cbo_Lagerplatz = "" Then
            frmKasse.lbl_LOAnzahl.Caption = txtBestand.Value
        End If
        If Not frmLager.txtWG.Value = "" Then
            Call frmKasse.RAuftraege
            frmKasse.cboAuftragSuchen = frmLager.txtWG.Value
            frmKasse.txtMenge.SetFocus
            GoTo weiter
        ElseIf Not txt_Kassenart.Value = "" Then
            frmKasse.txtRnr = frmLager.txt_WGA.Value
            frmKasse.txtMenge.SetFocus
            GoTo weiter
        ElseIf Not txt_WGA.Value = "" Then
            Call frmKasse.RAngebote
            frmKasse.cbo_Angebot = frmLager.txt_WGA.Value
            frmKasse.txtMenge.SetFocus
            GoTo weiter
        End If
        If frmKasse.txtArtikelnummerSicherung = "" Then
            frmKasse.cmdletzterArtikel.Visible = False
            frmKasse.cmdNArtikel.Visible = False
        Else
            frmKasse.cmdletzterArtikel.Visible = True
            frmKasse.cmdNArtikel.Visible = True
        End If
weiter:
        frmKasse.Show
    End If
End Sub

Private Sub cboLagerort_Click()
    If txtLagerort.Value = "" Then
        MsgBox "Bitte geben Sie ein Lagerort an!", vbOKOnly, "Hinweis"
        txtLagerort.SetFocus
    Else
        Call SuchenLO
        Call LOMSGBOX
    End If
End Sub

Private Sub cmdreport_Click()
    Unload frmLager
    frmBericht.Show
End Sub

Private Sub cmdSearchall_Click()
    Dim strwert As String
    strwert = txtWG.Value
    Application.Cursor = xlWait
    Application.StatusBar = "Daten werden gelesen..."
    Frame_ArtikelS.cboArtikelnummer.Value = ""
    Call Maskeclear
    Call Alles
    Application.StatusBar = False
    Application.Cursor = Default
    txtWG.Value = strwert
End Sub

Private Sub cmd_clear_Click()
    Call Maskeclear
    cmdAnlegen2.Visible = False
    txtWG.Value = ""
    txt_WGA.Value = ""
    MultiPage1.Value = 0
    lbl_AVerleih2.Caption = ""
    lbl_Verleihanzeigen.Visible = False
    Frame_ArtikelS.txt_item.SetFocus
    lbl_bild.Visible = False
    txt_VNr.Value = ""
    txt_VKDID.Value = ""
    cbo_Lagerplatz.Clear
End Sub

Private Sub cmdAbestellen_Click()
    On Error Resume Next
    If txtID.Value = "" Then
        frmBestellung.cboLieferant.ListIndex = 0
        Unload frmLager
        frmBestellung.txt_Begriff.SetFocus
        frmBestellung.Show
    Else
        With frmBestellung
            .lbl_bezeichnung.Caption = frmLager.lbl_bezeichnung
            .lbl_herstellerNr.Caption = frmLager.txtHnr
            If frmLager.txt_LPID = "" Then
                If frmLager.txtLagerort.Value = "" Then
                    .lbl_lagerort.Caption = "Kein Lagerort zugewiesen!"
                Else
                    .lbl_lagerort.Caption = frmLager.txtLagerort
                End If
            Else
            .txt_LPID = frmLager.txt_LPID
            .cbo_Lagerplatz = frmLager.cbo_Lagerplatz
            End If
            .txt_BEK.Value = lbl_EKPreis
            .tbABackup.Value = txt_item.Value
            .cbo_Lieferant.Value = Frame_Lieferant.txtLFirma.Value
            .cboArtikelNR.Value = txt_item.Value
            .lbl_itemnumber.Caption = txt_item.Value
            .txtpreis.Value = lbl_EKPreis.Caption
            .txtID.Value = txtID.Value
            .txt_LNr.Value = Frame_Lieferant.txtLNr.Value
            .txt_LVerfuegbar = Frame_Lieferant.txtLNr.Value
            .lbl_lagerort = txtLagerort
            .VPzusam
            Unload frmLager
            .Show
        End With
    End If
End Sub

Private Sub cmd_Anlegen_Click()
    On Error Resume Next
    If Sheets("Daten").Range("B33").Value = "" Then
        frmArtikel.lbl_LArtikelNr.Caption = ""
    Else
        frmArtikel.lbl_LArtikelNr.Caption = "Letzte Artikel Nr.: " & Sheets("Daten").Range("B33").Value
    End If
    frmArtikel.cbo_einheit = Sheets("Daten").Range("B21").Value
    frmArtikel.lbl_AHinweis.Visible = False
    frmArtikel.cmdaendern.Visible = False
    frmArtikel.cbo_ASerienNr.ListIndex = 0
    If Sheets("Daten").Range("B21").Value = "" Then
        frmArtikel.cbo_einheit = ""
    Else
        frmArtikel.cbo_einheit = Sheets("Daten").Range("B21").Value
    End If
    Unload frmLager
    frmArtikel.txt_Artikelnummer.SetFocus
    frmArtikel.Show
End Sub

Private Sub cmd_loeschen_Click() 'v1.44
    Dim lng, lngLine As Long
    Dim i, Ainfo, AdminN As String
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    Application.ScreenUpdating = False
    Ainfo = txt_item.Value & " / " & txt_Bezeichnung.Text
    If txtID.Value = "" Then
        txt_item.SetFocus
        Application.ScreenUpdating = True
        Exit Sub
    End If
    If Not txt_gesperrt.Value = "" Then
        MsgBox "Artikel: """ & Me.txt_Bezeichnung & """ ist gesperrt und kann daher nicht gel|fffd|scht werden!", , "Gesperrt seit: " & txt_gesperrt
        Application.ScreenUpdating = True
        Exit Sub
    End If
    For lngLine = 2 To Sheets("Reservierungen").UsedRange.Rows.Count
        If Sheets("Reservierungen").Cells(lngLine, 18) = txtID.Text Then
            MsgBox "Artikel kann nicht gel|fffd|scht werden. Bitte pr|fffd|fen Sie, ob sich dieser im Auftr|fffd|ge/Angebote befindet.", vbCritical, "Hinweis"
            Application.ScreenUpdating = True
            Exit Sub
        End If
    Next lngLine
    For lngLine = 2 To Sheets("Kassendaten").UsedRange.Rows.Count
        If Sheets("Kassendaten").Cells(lngLine, 17) = txtID.Text Then
            MsgBox "Artikel kann nicht gel|fffd|scht werden. Bitte pr|fffd|fen Sie, ob sich dieser im Warenausgang befindet.", vbCritical, "Hinweis"
            Application.ScreenUpdating = True
            Exit Sub
        End If
    Next lngLine
    For lngLine = 2 To Sheets("Bestellung").UsedRange.Rows.Count
        If Sheets("Bestellung").Cells(lngLine, 12) = txtID.Text Then
            MsgBox "Artikel kann nicht gel|fffd|scht werden. Bitte pr|fffd|fen Sie, ob sich dieser in einer Bestellung befindet.", vbCritical, "Hinweis"
            Application.ScreenUpdating = True
            Exit Sub
        End If
    Next lngLine
    For lngLine = 2 To Sheets("Verleih").UsedRange.Rows.Count
        If Sheets("Verleih").Cells(lngLine, 4) = txtID.Text Then
            MsgBox "Artikel kann nicht gel|fffd|scht werden. Bitte pr|fffd|fen Sie, ob sich dieser in einer Vermietung/ Verleih befindet.", vbCritical, "Hinweis"
            Application.ScreenUpdating = True
            Exit Sub
        End If
    Next lngLine
    If txt_item.Value = "" Then
        Frame_ArtikelS.cboArtikelnummer.SetFocus
        Application.ScreenUpdating = True
        Exit Sub
    End If
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    i = MsgBox("Artikel: (" + Frame_ArtikelS.cboArtikelnummer.Text + "/" + txt_Bezeichnung.Text + ") wirklich l|fffd|schen? Dieser Artikel wird dann auch in den Artikelgruppe gel|fffd|scht (falls vorhanden)!" & vbLf & vbLf & "Es werden auch alle dazugeh|fffd|rigen Lagerpl|fffd|tze gel|fffd|scht!", vbYesNo + vbQuestion, "Info")
        If i = vbYes Then
            Sheets("Lager").Activate
            lng = CDbl(txtzeile)
            Sheets("Lager").Rows(lng).Delete
            Call ZeileLoeschenGr
            Call ZeileLoeschenLP
            Frame_ArtikelS.cboArtikelnummer.Clear
            UserForm_Initialize
            Call Maskeclear
            Sheets("Daten").Activate
            Range("A65536").End(xlUp).Offset(1, 0).Select
            ActiveCell.Offset(0, 0).Value = Date
            ActiveCell.Offset(0, 1).Value = "Artikel (" & Ainfo & ") wurde gel|fffd|scht!" & " (" & lbl_Benutzer & ")"
            ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
            Sheets("Center").Activate
            ActiveWorkbook.Save
            MsgBox "Artikel (" + Ainfo + ") wurde gel|fffd|scht", vbOKOnly, "Hinweis"
        End If
    lbinfo.Caption = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1 & " Artikel vorhanden"
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Sub ZeileLoeschenGr()
    Dim zeile, lngLetzte As Long
    lngLetzte = Sheets("Gruppen").Cells(Sheets("Gruppen").Rows.Count, 2).End(xlUp).Row
    For zeile = lngLetzte To 1 Step -1
       If Sheets("Gruppen").Cells(zeile, 8).Value = CStr(txtID.Text) Then
          Sheets("Gruppen").Rows(zeile).Delete
       End If
    Next
End Sub

Sub ZeileLoeschenLP()
    Dim zeile, lngLetzte As Long
    Application.ScreenUpdating = False
    lngLetzte = Sheets("Lagerorte").Cells(Sheets("Lagerorte").Rows.Count, 2).End(xlUp).Row
    For zeile = lngLetzte To 1 Step -1
       If Sheets("Lagerorte").Cells(zeile, 2).Value = CStr(txtID.Text) Then
          Sheets("Lagerorte").Rows(zeile).Delete
       End If
    Next
    Application.ScreenUpdating = True
End Sub

Sub Grloeschen()
    Dim lng As Long
    Application.ScreenUpdating = False
        For lng = Range(Rows.Count, 2).End(xlUp).Row To 1 Step -1
            If Cells(lng, 2).Value = txt_item.Value Then Rows(lng).Delete
        Next lng
    Application.ScreenUpdating = True
End Sub

Private Sub cmdwe_Click()
    Dim lngMsg As Long
    lngMsg = MsgBox("Liegt eine Bestellung vor?", vbYesNo + vbQuestion, "Wareneingang")
    If lngMsg = vbYes Then
        frmEingang.tbABackup.Text = Frame_ArtikelS.cboArtikelnummer.Text
        Unload frmLager
        frmEingang.Show
    Else
        If Not txtID.Value = "" Then
            frmWareneingangoB.cbo_Lieferant = VBA.Replace(CStr(txtLFirma.Value), Chr$(13) & Chr$(10), " ")
            frmWareneingangoB.txt_zeile.Value = txtzeile.Value
            frmWareneingangoB.cboArtikelNR = txt_item.Value
        End If
        Unload frmLager
        frmWareneingangoB.Show
    End If
End Sub

Private Sub cmdInfo_Click()
    frmInfo.Show
End Sub

Private Sub cmdBezeichn_Click()
    If txt_Bezeichnung.Value = "" Then
        MsgBox "Bitte geben Sie eine Bezeichnung an!", vbOKOnly, "Suchen Bezeichnung"
        txt_Bezeichnung.SetFocus
    Else
        Call Bezeichnung
    End If
    If lstmainmenu.ListCount = 1 Then
        lstmainmenu.SetFocus
        lstmainmenu.ListIndex = 0
        Call listsuchen
        Call SuchenR
    End If
End Sub

Sub Bezeichnung() '1.40
    Dim arrTmpA, arrTmpB, i As Long, j As Double, n, lng, lngS, lngL As Long
    Dim SuchKriterium, strwert As String, Last_Row As Long
    Dim T As Double
    On Error Resume Next
    T = Timer
    txtWG.Value = strwert
    SuchKriterium = LCase(txt_Bezeichnung.Text)
    Call Maskeclear
    txt_Bezeichnung.Value = SuchKriterium
    lstmainmenu.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 6) = "" And InStr(1, LCase(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")), LCase(VBA.Replace(CStr(SuchKriterium), Chr$(13) & Chr$(10), " "))) > 0 Then
            n = n + 1
            lngS = 0
            arrTmpB(1, n) = arrTmpA(i, 3)
            lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
            If lngL > 45 Then
                arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
            Else
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
            End If
            For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                If CStr(Sheets("Lagerorte").Cells(lng, 2).Value) = CStr(arrTmpA(i, 1)) Then
                    lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                End If
            Next lng
            If CDbl(lngS) > 0 Then
                If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                    arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                    arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                Else
                    arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                End If
            Else
                If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                    arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                    arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                Else
                    arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                End If
            End If
            arrTmpB(4, n) = i
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 4)
            For i = 1 To 4
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstmainmenu
               .ColumnCount = 4
               .ColumnWidths = "100;250;50;0"
               .List = arrTmpA
            End With
       Else
           MsgBox "Suchbegriff: " + SuchKriterium + " nicht gefunden!", vbOKOnly, "Suchabfrage"
       End If
    End With
    Application.ScreenUpdating = True
    Call Datensaetze
    strwert = txtWG.Value
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub SuchenBezeichnung() 'v1.38
    Dim strB, nrstr, strID As String
    Dim lngZeile, lng, lngS, i As Long
    On Error Resume Next
    With Application
        .ScreenUpdating = False
        .EnableEvents = False
        .Calculation = xlCalculationManual
    End With
    nrstr = txtWG.Value
    strB = txt_Bezeichnung.Text
    Call ListHmask
    Application.ScreenUpdating = False
    i = 0
    For lngZeile = 2 To ThisWorkbook.Worksheets("Lager").UsedRange.Rows.Count
        If InStr(1, LCase(Sheets("Lager").Cells(lngZeile, 6).Value), LCase(strB)) > 0 Then
            lngS = 0
            lstmainmenu.AddItem Sheets("Lager").Cells(lngZeile, 3).Value
            lstmainmenu.Column(1, i) = Sheets("Lager").Cells(lngZeile, 6).Value
            strID = Sheets("Lager").Cells(lngZeile, 1).Value
            For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                If Sheets("Lagerorte").Cells(lng, 2).Value = strID Then
                    lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                End If
            Next lng
            If CDbl(lngS) > 0 Then
                lstmainmenu.Column(2, i) = CDbl(Sheets("Lager").Cells(lngZeile, 8).Value + lngS) & " " & Sheets("Lager").Cells(lngZeile, 12).Value
            Else
                lstmainmenu.Column(2, i) = Sheets("Lager").Cells(lngZeile, 8).Value & " " & Sheets("Lager").Cells(lngZeile, 12).Value
            End If
            lstmainmenu.Column(3, i) = Sheets("Lager").Cells(lngZeile, 13).Value
            lstmainmenu.Column(4, i) = Sheets("Lager").Cells(lngZeile, 15).Row
            i = i + 1
        End If
        Frame_ArtikelS.cboArtikelnummer.ListIndex = -1
        txt_item.Value = ""
        Call Textboxenleeren
    Next lngZeile
    With Application
        .ScreenUpdating = True
        .EnableEvents = True
        .Calculation = xlCalculationAutomatic
    End With
    If lstmainmenu.ListCount = 0 Then
        MsgBox "Suchbegriff: " + strB + " nicht gefunden!", vbOKOnly, "Suchabfrage"
        lblhinweis.Caption = ""
        tbKomHinweis.BackColor = &H80000005
        txt_Bezeichnung.Text = strB
        txt_Bezeichnung.SetFocus
        txtWG.Value = nrstr
        Exit Sub
    End If
    txt_Bezeichnung.Text = strB
    txtWG.Value = nrstr
    Application.ScreenUpdating = True
    Call Datensaetze
End Sub

Private Sub cmdaendern_Click() '1.44
    Dim xrow As Long
    Dim strID, slrow, slrow2 As String
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    strID = txtID.Text
    frmArtikel.lbl_LArtikelNr.Caption = ""
    xrow = CLng(txtzeile)
    Application.ScreenUpdating = False
    If Not Sheets("Lager").Cells(xrow, 18) = "" Then
        slrow = Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(Sheets("Lager").Cells(xrow, 18), LookIn:=xlValues, MatchCase:=True).Row, 2)
    End If
    If Not Sheets("Lager").Cells(xrow, 19) = "" Then
        slrow2 = Sheets("Lieferanten").Cells(Worksheets("Lieferanten").Range("A:A").Find(CStr(Sheets("Lager").Cells(xrow, 19)), LookIn:=xlValues, MatchCase:=True).Row, 2)
    End If
    frmArtikel.cmd_Lplaetze.Enabled = True
    frmArtikel.lbl_VPArtikelnummer.Caption = txt_item
    With frmArtikel
        .chk_ASperren.Visible = True
        .lbl_ASperren.Visible = True
        .cmd_Verlauf.Visible = True
        .lbl_WEDruck.Enabled = False
        .chk_WEDruck.Enabled = False
        .lblinfo.Caption = "|fffd|ndern"
        .txt_Artikelnummer.Value = txt_item.Value
        .txtEKPreis.Value = Format(CDbl(lbl_EKPreis.Caption), "currency")
        .cboLieferant.Value = VBA.Replace(CStr(slrow), Chr$(13) & Chr$(10), " ")
        .txtLNr = Sheets("Lager").Cells(xrow, 18)
        .cmdanlegen.Visible = False
        .cmdNArtikel.Visible = False
        .txt_Bestand = Sheets("Lager").Cells(xrow, 8)
        .cbo_Hersteller.Value = cboHersteller.Text
        .txt_Bezeichnung.Value = Sheets("Lager").Cells(xrow, 6)
        .cbo_einheit = txteinheit.Value
        .cboLagerort.Value = txtLagerort.Value
        .txt_Hnr.Value = txtHnr.Value
        .cboWarengruppe.Value = cboWarengruppe.Value
        .txtKommentar.Value = Sheets("Lager").Cells(xrow, 20)
        .txtMeldeBestand.Value = txtMeldeBestand.Value
        .txt_Frei.Value = txtFrei.Value
        .txtbestandmin.Value = txtbestandmin.Value
        .txtAS.Value = txtzeile.Value
        .txtID.Value = txtID.Value
        If Sheets("Daten").Range("B7") = "Admin" Then
            .txt_Artikelnummer.Enabled = True
            .txt_Bestand.Enabled = True
            .lbl_AHinweis.Visible = True
            .cmd_InfoFrei.Visible = True
            .Caption = "Artikel Stammdaten (Admin)"
        Else
            .txt_Bestand.Enabled = False
            .txt_Artikelnummer.Enabled = False
            .lbl_AHinweis.Visible = False
            .Caption = "Artikel Stammdaten"
        End If
        .cmd_InfoItem.Visible = False
        .txt_Barcode.Value = Sheets("Lager").Cells(xrow, 31)
        If Sheets("Lager").Cells(xrow, 33) = "gr" Or Sheets("Lager").Cells(xrow, 33) = "g" Then
            .txt_Gewicht.Value = Format(CDbl(Sheets("Lager").Cells(xrow, 32) * 1000), "0.000")
            .cbo_gewicht = Sheets("Lager").Cells(xrow, 33)
        Else
            If Not Sheets("Lager").Cells(xrow, 32) = "" Then
                .txt_Gewicht.Value = Format(CDbl(Sheets("Lager").Cells(xrow, 32)), "0.000")
                .cbo_gewicht.Text = Sheets("Lager").Cells(xrow, 33)
            End If
        End If
        .txt_laenge.Value = Format(Sheets("Lager").Cells(xrow, 34), "0.00")
        .txt_breite.Value = Format(Sheets("Lager").Cells(xrow, 35), "0.00")
        .txt_tiefe.Value = Format(Sheets("Lager").Cells(xrow, 36), "0.00")
        .txt_durchmesser.Value = Format(Sheets("Lager").Cells(xrow, 37), "0.00")
        If Not Sheets("Lager").Cells(xrow, 38) = "" Then .cbo_masse = Sheets("Lager").Cells(xrow, 38)
        .txt_Verwendbar = Sheets("Lager").Cells(xrow, 39)
        .txt_VerwendbarEr = Sheets("Lager").Cells(xrow, 40)
        .cbo_Kategorie = Sheets("Lager").Cells(xrow, 41)
        If Not Sheets("Lager").Cells(xrow, 42) = "" Then
            .chk_ASperren.Value = True
            .lbl_ASperren.Caption = "Artikel ist gesperrt!"
            .lbl_ASperren.ForeColor = &HFF&
        Else
            .chk_ASperren.Value = False
            .lbl_ASperren.Caption = "Artikel sperren?"
            .lbl_ASperren.ForeColor = &H404040
        End If
        If Sheets("Lager").Cells(xrow, 30) = "N" Then
            frmArtikel.cbo_ASerienNr = "Nein"
        ElseIf Not Sheets("Lager").Cells(xrow, 30) = "" Then
            frmArtikel.cbo_ASerienNr = "Ja"
        Else
            frmArtikel.cbo_ASerienNr = "Nein"
        End If
        .txtAS = xrow
        If txtPDF.Value = "" Then
            .cmdPDFloeschen.Visible = False
            .txtPDFa.Value = "Keine PDF gespeichert"
        Else
            .cmdPDFloeschen.Visible = True
            .txtPDFa.Value = txtPDF.Text
        End If
        If lbl_UMST.Caption = "0,0%" Or lbl_UMST.Caption = "0.0%" Then
            .cboUMST.Value = "ohne"
        Else
            .cboUMST.Value = lbl_UMST.Caption
        End If
        If txt_BN.Value = "B" Then
            .op_Brutto.Value = True
            .op_Netto.Value = False
            .txtVKPreis.Value = Format(CDbl(lbl_ButtoVK.Caption), "currency")
        Else
            .op_Netto.Value = True
            .op_Brutto.Value = False
            .txtVKPreis.Value = Format(CDbl(lbl_VKPreis.Caption), "currency")
        End If
        Unload frmLager
        .bild
        .Show
    End With
    Application.ScreenUpdating = True
    frmArtikel.Repaint
End Sub

Private Sub cmdMinMax_Click()
    ThisWorkbook.Activate
    If cmdMinMax.Caption = "Ausblenden" Then
        txt_wert1.Value = Format(frmLager.Width, "#")
        txt_wert2.Value = Format(frmLager.Height, "#")
        Height = 64
        Width = 150
        cmdMinMax.Caption = "Einblenden"
    Else
        frmLager.Width = CDbl(txt_wert1.Value)
        frmLager.Height = CDbl(txt_wert2.Value)
        cmdMinMax.Caption = "Ausblenden"
    End If
End Sub

Private Sub cmdexit_Click()
    On Error Resume Next
    frmAnmelden.txt_Admin.Value = ""
    Sheets("Center").Activate
    Unload frmLager
    Application.ScreenUpdating = True
End Sub

Private Sub cmdLieferand_Click()
    On Error GoTo weiter
    If txtLNr.Value = "" Then Exit Sub
    If Frame_Lieferant.txtLNr.Text = "" Or Frame_Lieferant.txtLNr.Text = "Kein Artikel vorhanden" Or Frame_Lieferant.txtLNr.Text = "No items found" Then
        frmLieferanten.Show
        frmLieferanten.MultiPage1.Value = 0
    Else
        frmLieferanten.MultiPage1.Value = 0
        frmLieferanten.cboLNr.Value = Frame_Lieferant.txtLNr.Value + ", " + Frame_Lieferant.txtLFirma.Value
        If Frame_Lieferant.txtLAnsprech.Value = "" Then
            frmLieferanten.txtstaff.SetFocus
            frmLieferanten.Show
            Exit Sub
        ElseIf Frame_Lieferant.txtLphone.Value = "" Then
            frmLieferanten.txtphone.SetFocus
            frmLieferanten.Show
            Exit Sub
        End If
        frmLieferanten.Show
        frmLieferanten.MultiPage1.Value = 0
    End If
    Exit Sub
weiter:
    MsgBox "Es ist leider ein Fehler passiert!", , "Lieferant"
End Sub

Private Sub lstmainmenu_Click()
    Call listsuchen
    Call SuchenR
End Sub

Sub listsuchen() '1.44
    Dim lngZeile, lng As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2 As Long
    Dim lngS, lngg, Zahl, ZahlW As Double
    Dim strFile As String
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    
    If CDbl(lstmainmenu.ListCount) = 0 Then Exit Sub
    Application.ScreenUpdating = False
    lngg = 0
    Zahl = 0
    ZahlW = 0
    txt_BestandVer.Value = ""
    lngZeile = lstmainmenu.Column(3)
    txtzeile.Value = lstmainmenu.Column(3)
    txtID.Value = Sheets("Lager").Cells(lngZeile, 1).Value
    lblZinfo.Caption = "Artikel befindet sich in Zeile " & CDbl(lngZeile)
    lbl_erstellt.Caption = Sheets("Lager").Cells(lngZeile, 2).Value
    txt_item.Value = Sheets("Lager").Cells(lngZeile, 3).Value
    txtHnr.Value = Sheets("Lager").Cells(lngZeile, 4).Value
    txtFrei.Value = Sheets("Lager").Cells(lngZeile, 5).Value
    txt_Bezeichnung.Value = VBA.Replace(CStr(Sheets("Lager").Cells(lngZeile, 6).Value), Chr$(13) & Chr$(10), " ")
    lbl_bezeichnung.Caption = Sheets("Lager").Cells(lngZeile, 6).Value
    cboHersteller.Value = Sheets("Lager").Cells(lngZeile, 7).Value
    Set DIC = CreateObject("scripting.dictionary")
    With ThisWorkbook.Sheets("Lagerorte")
        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA2 = .Range("A1:AO" & Last_Row2)
        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
        For i2 = 2 To UBound(arrTmpA2)
            If Not arrTmpA2(i2, 2) = "" And arrTmpA2(i2, 2) = CStr(txtID) Then
                lngS = lngS + CDbl(arrTmpA2(i2, 4))
                xKey = CStr(arrTmpA2(i2, 3))
                DIC(xKey) = 0
                lngg = lngg + 1
            End If
        Next i2
    End With
    If CDbl(lngg) > 0 Then
        txtBestand.Value = Sheets("Lager").Cells(lngZeile, 8) + lngS
        cbo_Lagerplatz.Enabled = True
        lbl_lagerplatz.Enabled = True
        lbl_lagerplatz2.Enabled = True
        frmLager.cbo_Lagerplatz.Clear
        frmKasse.cbo_Lagerplatz.Clear
        frmLager.txt_MengePlatz.Value = ""
        frmLager.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        frmKasse.cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        For Each xKey In DIC
            frmLager.cbo_Lagerplatz.AddItem xKey
            frmKasse.cbo_Lagerplatz.AddItem xKey
        Next
        frmLager.cbo_Lagerplatz.ListIndex = 0
        DIC.RemoveAll
        Set DIC = Nothing
        If Not Sheets("Lager").Cells(lngZeile, 13).Value = "" Then
            txtLagerort.Value = Sheets("Lager").Cells(lngZeile, 13).Value
        End If
        lbl1.BackColor = &H808080
        lbl2.BackColor = &H808080
        lbl3.BackColor = &H808080
    Else
        frmLager.cbo_Lagerplatz.Clear
        frmKasse.cbo_Lagerplatz.Clear
        frmLager.txt_MengePlatz.Value = ""
        txtBestand.Value = Sheets("Lager").Cells(lngZeile, 8)
        cbo_Lagerplatz.Enabled = False
        lbl_lagerplatz.Enabled = False
        lbl_lagerplatz2.Enabled = False
        txt_MengePlatz.Value = ""
        cbo_Lagerplatz.Clear
        txtLagerort.Value = Sheets("Lager").Cells(lngZeile, 13).Value
        lbl1.BackColor = &HC0C0C0
        lbl2.BackColor = &HC0C0C0
        lbl3.BackColor = &HC0C0C0
    End If
    txtbestandmin.Value = Sheets("Lager").Cells(lngZeile, 10).Value
    txtMeldeBestand = Sheets("Lager").Cells(lngZeile, 11).Value
    txteinheit.Value = Sheets("Lager").Cells(lngZeile, 12).Value
    lbl_EKPreis.Caption = Format(CDbl(Sheets("Lager").Cells(lngZeile, 14)), "currency")
    txtPreisVK.Value = Format(CDbl(Sheets("Lager").Cells(lngZeile, 15)), "currency")
    cboWarengruppe.Value = Sheets("Lager").Cells(lngZeile, 16).Value
    lbl_ldate.Caption = Sheets("Lager").Cells(lngZeile, 17).Value
    Frame_Lieferant.txtLNr.Value = Sheets("Lager").Cells(lngZeile, 18).Value
    Frame_Lieferant.txtLFirma.Value = Sheets("Lager").Cells(lngZeile, 19).Value
    lbl_Kommentar.Caption = Sheets("Lager").Cells(lngZeile, 20).Value
    lbl_UMST.Caption = Format(Sheets("Lager").Cells(lngZeile, 21).Value, "#,##0.0%")
    lbl_letzterWA.Caption = Sheets("Lager").Cells(lngZeile, 23).Value
    lbl_lWAt.Caption = Sheets("Lager").Cells(lngZeile, 24).Text
    lbl_bereitsVerk.Caption = Sheets("Lager").Cells(lngZeile, 25).Value
    txtPDF.Value = Sheets("Lager").Cells(lngZeile, 27).Value
    lbl_VKPreis.Caption = Format(CDbl(Sheets("Lager").Cells(lngZeile, 15)), "currency")
    txt_BN.Value = Sheets("Lager").Cells(lngZeile, 22)
    cbo_KategorieHM = Sheets("Lager").Cells(lngZeile, 41)
    txt_gesperrt.Value = Sheets("Lager").Cells(lngZeile, 42)
    If Worksheets("Daten").Range("F36") = "Ja" Then
        If Sheets("Lager").Cells(lngZeile, 21) = "" Then
            ZahlW = CDbl(Sheets("Lager").Cells(CLng(lngZeile), 15))
            Zahl = CLng(ZahlW / 0.05) * 0.05
            lbl_ButtoVK.Caption = Format(Zahl, "currency")
        Else
            ZahlW = CDbl(Sheets("Lager").Cells(CLng(lngZeile), 15) * Sheets("Lager").Cells(CDbl(lngZeile), 21)) + Sheets("Lager").Cells(lngZeile, 15)
            Zahl = CLng(ZahlW / 0.05) * 0.05
            lbl_ButtoVK.Caption = Format(Zahl, "currency")
        End If
    Else
        If Sheets("Lager").Cells(lngZeile, 21) = "" Then
            lbl_ButtoVK.Caption = Format(CDbl(Sheets("Lager").Cells(CLng(lngZeile), 15)), "currency")
        Else
            lbl_ButtoVK.Caption = Format((CDbl(Sheets("Lager").Cells(CLng(lngZeile), 15) * Sheets("Lager").Cells(CDbl(lngZeile), 21))) + Sheets("Lager").Cells(lngZeile, 15), "currency")
        End If
    End If
    If Not Sheets("Lager").Cells(lngZeile, 32) = "" Then
        If Format(CDbl(Sheets("Lager").Cells(lngZeile, 32)), "0.0") = CDbl(Sheets("Lager").Cells(lngZeile, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(lngZeile, 32), "0.0") & " " & "Kg"
        ElseIf Format(CDbl(Sheets("Lager").Cells(lngZeile, 32)), "0.00") = CDbl(Sheets("Lager").Cells(lngZeile, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(lngZeile, 32), "0.00") & " " & "Kg"
        ElseIf Format(CDbl(Sheets("Lager").Cells(lngZeile, 32)), "0.000") = CDbl(Sheets("Lager").Cells(lngZeile, 32)) Then
            txt_AGewicht.Value = Format(Sheets("Lager").Cells(lngZeile, 32), "0.000") & " " & "Kg"
        Else
            txt_AGewicht.Value = Sheets("Lager").Cells(lngZeile, 32) & " " & "Kg"
        End If
    Else
        txt_AGewicht.Value = ""
    End If
    If Not Len(Sheets("Lager").Cells(lngZeile, 28).Value) = "" Then
        On Error GoTo weiter
        strFile = Sheets("Lager").Cells(lngZeile, 28).Formula
        strFile = Split(strFile, "(" & Chr(34))(1)
        strFile = Split(strFile, Chr(34) & ",")(0)
        strFile = Replace(strFile, "file:///", "")
        Set frmLager.Image1.Picture = LoadPicture(strFile)
        lbl_bild.Visible = False
    Else
weiter:
        Set frmLager.Image1.Picture = Nothing
        lbl_bild.Visible = True
    End If
    If Sheets("Lager").Cells(lngZeile, 20) <> 0 Then
        tbKomHinweis.BackColor = &HC0&
    Else
        tbKomHinweis.BackColor = &H8000000B
    End If
    Application.ScreenUpdating = True
    Call LffrmLager
    Call wenn
    txtID.Value = Sheets("Lager").Cells(lngZeile, 1).Value
    cmdAnlegen2.Visible = True
    Call SuchenBMenge
    Call pruefen
    Call AnZLieferanten
End Sub

Private Sub txtEKPreis_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    lbl_EKPreis.Caption = Format(lbl_EKPreis.Caption, "currency")
End Sub

Sub pruefen()
    On Error Resume Next
    If Not txtbestandmin.Value = "" Then
        If CDbl(txtBestand.Value) <= CDbl(txtbestandmin.Value) Then
            txtBestand.ForeColor = vbRed
        Else
            txtBestand.ForeColor = &H404040
        End If
    ElseIf Not txt_BestandVer.Value = "" And Not txtbestandmin.Value = "" Then
        If CDbl(txt_BestandVer.Value) <= CDbl(txtbestandmin.Value) Then
            txtBestand.ForeColor = vbRed
        Else
            txtBestand.ForeColor = &H404040
        End If
    End If
    If txtbestandmin.Value = "" And CDbl(txtBestand) >= 0 Then
        txtBestand.ForeColor = &H404040
    ElseIf CDbl(txtBestand) < 0 Then
        txtBestand.ForeColor = vbRed
    End If
End Sub

Private Sub cmdLagerort_Click()
    If txtLagerort.Value = "" Then Exit Sub
    txtzeile.Value = ""
    lblZinfo.Caption = ""
    Call SuchenLO
End Sub

Sub SuchenLO() '1.44
    Dim arrTmpA, arrTmpB, i, Anz, lngL As Long, j As Double, n As Long
    Dim SuchKriterium, strwert As String, Last_Row, lng As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2 As Long
    Dim T, lngS As Double
    On Error Resume Next
    If frmLager.txtLagerort.Value = "" Then Exit Sub
    T = Timer
    Application.ScreenUpdating = False
    strwert = txtWG.Value
    SuchKriterium = frmLager.txtLagerort
    Anz = Len(txtLagerort) - Len(Application.Substitute(txtLagerort, "*", ""))
    lstmainmenu.Clear
    If frmLager.txtLagerort = "" Then GoTo weiter
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        If Anz > 0 Then
             For i = 2 To UBound(arrTmpA)
                 If Not arrTmpA(i, 13) = "" And arrTmpA(i, 13) Like SuchKriterium Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 3)
                    lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                    If lngL > 45 Then
                        arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                    Else
                        arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    End If
'                    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
'                        If Sheets("Lagerorte").Cells(1, 2).Value = CStr(arrTmpA(i, 1)) Then
'                            lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
'                        End If
'                    Next lng
                    With ThisWorkbook.Sheets("Lagerorte")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If Not arrTmpA2(i2, 2) = "" And arrTmpA2(i2, 2) = CStr(arrTmpA(i, 1)) Then
                                lngS = lngS + CDbl(arrTmpA2(i2, 4))
                            End If
                        Next i2
                    End With
                    If CDbl(lngS) > 0 Then
                        If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    Else
                        If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    End If
                    arrTmpB(4, n) = i
                 End If
            Next i
       Else
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 13) = "" And arrTmpA(i, 13) = SuchKriterium Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 3)
                    lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                    If lngL > 45 Then
                        arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                    Else
                        arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    End If
'                    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
'                        If Sheets("Lagerorte").Cells(1, 2).Value = CStr(arrTmpA(i, 1)) Then
'                            lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
'                        End If
'                    Next lng
                    With ThisWorkbook.Sheets("Lagerorte")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If Not arrTmpA2(i2, 2) = "" And arrTmpA2(i2, 2) = CStr(arrTmpA(i, 1)) Then
                                lngS = lngS + CDbl(arrTmpA2(i2, 4))
                            End If
                        Next i2
                    End With
                    If CDbl(lngS) > 0 Then
                        If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    Else
                        If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    End If
                    arrTmpB(4, n) = i
                End If
            Next i
        End If
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 4)
            For i = 1 To 4
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstmainmenu
               .ColumnCount = 4
               .ColumnWidths = "100;250;50;0"
               .List = arrTmpA
            End With
       End If
    End With
weiter:
    Application.ScreenUpdating = True
    Call SuchenLO2
    txtWG.Value = strwert
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub SuchenLO2() '1.44
    Dim arrTmpA, arrTmpB, i, Anz As Long, j As Double, n As Long
    Dim SuchKriterium As String, Last_Row, lngID As Long
    Dim arrTmpA2, arrTmpB2, i2, Last_Row2 As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    SuchKriterium = frmLager.txtLagerort
    lstmainmenu2.Clear
    Anz = Len(txtLagerort) - Len(Application.Substitute(txtLagerort, "*", ""))
    With ThisWorkbook.Sheets("Lagerorte")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row + 1
        arrTmpA = .Range("A1:AA" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        If Anz > 0 Then
             For i = 2 To UBound(arrTmpA)
                 If Not arrTmpA(i, 3) = "" And arrTmpA(i, 3) = SuchKriterium Then
                     n = n + 1
                     With ThisWorkbook.Sheets("Lager")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(arrTmpA(i, 2)) Then
                                lngID = i2
                            End If
                        Next i2
                    End With
                    arrTmpB(1, n) = Sheets("Lager").Cells(lngID, 3)
                    arrTmpB(2, n) = VBA.Replace(CStr(Sheets("Lager").Cells(lngID, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(3, n) = (arrTmpA(i, 4) + Sheets("Lager").Cells(lngID, 8)) & " " & Sheets("Lager").Cells(lngID, 12)
                    arrTmpB(4, n) = lngID
                 End If
            Next i
        Else
            For i = 2 To UBound(arrTmpA)
                 If arrTmpA(i, 3) Like SuchKriterium Then
                     n = n + 1
                     With ThisWorkbook.Sheets("Lager")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If Not arrTmpA2(i2, 1) = "" And arrTmpA2(i2, 1) = CStr(arrTmpA(i, 2)) Then
                                lngID = i2
                            End If
                        Next i2
                    End With
                    arrTmpB(1, n) = Sheets("Lager").Cells(lngID, 3)
                    arrTmpB(2, n) = VBA.Replace(CStr(Sheets("Lager").Cells(lngID, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(3, n) = (arrTmpA(i, 4) + Sheets("Lager").Cells(lngID, 8)) & " " & Sheets("Lager").Cells(lngID, 12)
                    arrTmpB(4, n) = lngID
                 End If
            Next i
        End If
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 4)
            For i = 1 To 4
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstmainmenu2
               .ColumnCount = 4
               .ColumnWidths = "50;50;50;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
    Call LoBox
End Sub

Sub LoBox()
    Dim i, i2, lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    With lstmainmenu
       .ColumnCount = 4
       .ColumnWidths = "100;250;50;0"
    End With
    If lstmainmenu.ListCount = 0 Then
        i2 = lstmainmenu.ListCount
        i2 = 0
        i = 0
        For lng = 1 To lstmainmenu2.ListCount
            lstmainmenu.AddItem lstmainmenu2.Column(0, lng)
            lstmainmenu.Column(1, i2) = lstmainmenu2.Column(1, lng)
            lstmainmenu.Column(2, i2) = lstmainmenu2.Column(2, lng)
            lstmainmenu.Column(3, i2) = lstmainmenu2.Column(3, lng)
            i2 = i2 + 1
        Next lng
    Else
        i2 = lstmainmenu.ListCount
        For lng = 1 To lstmainmenu2.ListCount
            lstmainmenu.AddItem lstmainmenu2.Column(0, i)
            lstmainmenu.Column(1, i2) = lstmainmenu2.Column(1, i)
            lstmainmenu.Column(2, i2) = lstmainmenu2.Column(2, i)
            lstmainmenu.Column(3, i2) = lstmainmenu2.Column(3, i)
            i2 = i2 + 1
            i = i + 1
        Next lng
    End If
    lstmainmenu2.Clear
    Application.ScreenUpdating = True
    Call Datensaetze
End Sub

Private Sub cmdHerstellerNr_Click()
    If txtHnr.Value = "" Then
        MsgBox "Bitte geben Sie eine Herstellernummer an!", , "Suchen Hersteller-Nr."
        txtHnr.SetFocus
    Else
        txtzeile.Value = ""
        lblZinfo.Caption = ""
        Call SuchenHerstellerNr
    End If
End Sub

Sub SuchenHerstellerNr() '1.44
    Dim arrTmpA, arrTmpB, i, lngL As Long, j As Double, n As Long
    Dim SuchKriterium, strwert As String, Last_Row, lng As Long
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2 As Long
    Dim T, lngS As Double
    On Error Resume Next
    T = Timer
    Application.ScreenUpdating = False
    strwert = txtWG.Value
    SuchKriterium = LCase(frmLager.txtHnr)
    Call Maskeclear
    txtHnr.Value = SuchKriterium
    lstmainmenu.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 4) = "" And InStr(1, LCase(arrTmpA(i, 4)), LCase(SuchKriterium)) > 0 Then
                lngS = 0
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                If lngL > 45 Then
                    arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                Else
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                End If
'                For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
'                    If CStr(Sheets("Lagerorte").Cells(lng, 2).Value) = CStr(arrTmpA(i, 1)) Then
'                        lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
'                    End If
'                Next lng
                With ThisWorkbook.Sheets("Lagerorte")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If Not arrTmpA2(i2, 2) = "" And arrTmpA2(i2, 2) = CStr(arrTmpA(i, 1)) Then
                            lngS = lngS + CDbl(arrTmpA2(i2, 4))
                        End If
                    Next i2
                End With
                If CDbl(lngS) > 0 Then
                    If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                    End If
                Else
                    If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                    End If
                End If
                arrTmpB(4, n) = i
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 4)
             For i = 1 To 4
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstmainmenu
                .ColumnCount = 4
                .ColumnWidths = "100;250;50;0"
                .List = arrTmpA
             End With
        Else
            MsgBox "Suchbegriff: " + SuchKriterium + " nicht gefunden!", vbOKOnly, "Suchabfrage"
        End If
    End With
    Application.ScreenUpdating = True
    Call Datensaetze
    If lstmainmenu.ListCount = 1 Then
        lstmainmenu.ListIndex = 0
        Call listsuchen
    End If
    txtWG.Value = strwert
    Application.ScreenUpdating = True
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Private Sub cmdHersteller_Click()
    If Not cboHersteller = "" Then
        txtzeile.Value = ""
        lblZinfo.Caption = ""
        Call Hersteller
    End If
End Sub

Sub Hersteller() '1.40
    Dim arrTmpA, arrTmpB, i, Last_Row As Long, j As Double, n, lng, lngS, lngL As Long
    Dim SuchKriterium, strwert As String
    Dim T As Double
    On Error Resume Next
    T = Timer
    strwert = txtWG.Value
    SuchKriterium = cboHersteller.Text
    Call Maskeclear
    cboHersteller = SuchKriterium
    lstmainmenu.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 7) = "" And LCase(arrTmpA(i, 7)) Like LCase(SuchKriterium) Then
                n = n + 1
                lngS = 0
                arrTmpB(1, n) = arrTmpA(i, 3)
                lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                If lngL > 45 Then
                    arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                Else
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                End If
                For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                    If CStr(Sheets("Lagerorte").Cells(lng, 2).Value) = CStr(arrTmpA(i, 1)) Then
                        lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                    End If
                Next lng
                If CDbl(lngS) > 0 Then
                    If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                    End If
                Else
                    If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                    End If
                End If
                arrTmpB(4, n) = i
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 4)
            For i = 1 To 4
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With lstmainmenu
               .ColumnCount = 4
               .ColumnWidths = "100;250;50;0;0;0"
               .List = arrTmpA
            End With
       End If
    End With
    Call Datensaetze
    txtWG.Value = strwert
    Application.ScreenUpdating = True
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub ListHmask()
    lstmainmenu.Clear
    lstmainmenu.ColumnCount = 3
    lstmainmenu.ColumnWidths = "100;250;50;0;0;0"
    lstmainmenu.TextAlign = fmTextAlignLeft
    lstmainmenu.Clear
    lbstatus.BackColor = &H8000000B
End Sub

Private Sub DirektBuchen() 'aus alter Version
    Dim lngZeile, i As Long
    On Error Resume Next
    ThisWorkbook.Activate
    With Worksheets("Warenausgang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lagerorte")
        If .FilterMode Then .ShowAllData
    End With
    lngZeile = frmLager.lstmainmenu.Column(4)
    i = lstmainmenu.ListIndex
    lstmainmenu.Column(5, i) = txtBestand.Value
    Frame_ArtikelS.cboArtikelnummer.SetFocus
End Sub

Sub LOMSGBOX()
    On Error Resume Next
    If CDbl(lstmainmenu.ListCount) = 0 Then
        MsgBox "Kein Datensatz gefunden", vbOKOnly, "Info"
    ElseIf CDbl(lstmainmenu.ListCount) > 1 Then
        MsgBox lstmainmenu.ListCount & " Datens|fffd|tze gefunden", vbOKOnly, "Info"
    Else
        MsgBox lstmainmenu.ListCount & " Datensatz gefunden", vbOKOnly, "Info"
    End If
End Sub

Sub suchenTArtikel() '1.44
    Dim arrTmpA, arrTmpB, i, n, z, lng, Last_Row, lngL As Long
    Dim j As Double
    Dim T, lngS As Double
    Dim SuchKriterium As String
    On Error Resume Next
    T = Timer
    Application.ScreenUpdating = False
    SuchKriterium = txt_item.Text
    lstmainmenu.Clear
    z = 0
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 3) = "" And arrTmpA(i, 3) = CStr(txt_item) Then
                n = n + 1
                lngS = 0
                arrTmpB(1, n) = arrTmpA(i, 3)
                lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                If lngL > 45 Then
                    arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                Else
                    arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                End If
                For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                    If CStr(Sheets("Lagerorte").Cells(lng, 2).Value) = CStr(arrTmpA(i, 1)) Then
                        lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                    End If
                Next lng
                If CDbl(lngS) > 0 Then
                    If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                    End If
                Else
                    If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                    ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                        arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                    Else
                        arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                    End If
                End If
                arrTmpB(4, n) = i
                z = z + 1
            End If
        Next i
    End With
    If z = 0 Then
         With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If InStr(1, LCase(VBA.Replace(CStr(arrTmpA(i, 3)), Chr$(13) & Chr$(10), " ")), LCase(VBA.Replace(CStr(SuchKriterium), Chr$(13) & Chr$(10), " "))) > 0 Then
                    n = n + 1
                    lngS = 0
                    arrTmpB(1, n) = arrTmpA(i, 3)
                    lngL = Len(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "))
                    If lngL > 45 Then
                        arrTmpB(2, n) = Left(VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " "), 45) & " ..."
                    Else
                        arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    End If
                    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count + 1
                        If CStr(Sheets("Lagerorte").Cells(lng, 2).Value) = CStr(arrTmpA(i, 1)) Then
                            lngS = lngS + CDbl(Sheets("Lagerorte").Cells(lng, 4).Value)
                        End If
                    Next lng
                    If CDbl(lngS) > 0 Then
                        If Int(CDbl(arrTmpA(i, 8) + lngS)) = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = CDbl(arrTmpA(i, 8) + lngS) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") = CDbl(arrTmpA(i, 8) + lngS) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    Else
                        If Int(CDbl(arrTmpA(i, 8))) = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = arrTmpA(i, 8) & " " & arrTmpA(i, 12)
                        ElseIf Format(CDbl(arrTmpA(i, 8)), "0.0") = CDbl(arrTmpA(i, 8)) Then
                            arrTmpB(3, n) = Format(CDbl(arrTmpA(i, 8) + lngS), "0.0") & " " & arrTmpA(i, 12)
                        Else
                            arrTmpB(3, n) = Format(arrTmpA(i, 8), "0.00") & " " & arrTmpA(i, 12)
                        End If
                    End If
                    arrTmpB(4, n) = i
                End If
            Next i
        End With
    End If
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 4)
        For i = 1 To 4
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With lstmainmenu
           .ColumnCount = 4
           .ColumnWidths = "100;250;50;0"
           .List = arrTmpA
        End With
        txtzeile.Value = ""
        lblZinfo.Caption = ""
    Else
        MsgBox "Artikelnummer: " + SuchKriterium + " nicht gefunden!", vbOKOnly, "Suchabfrage"
        txt_item.BorderColor = &HFF&
        lblhinweis.Caption = ""
        tbKomHinweis.BackColor = &H80000005
        With txt_item
          .SetFocus
          .SelStart = 0
          .SelLength = Len(.Text)
        End With
        Application.ScreenUpdating = True
        Exit Sub
    End If
    Call Datensaetze
    If lstmainmenu.ListCount >= 1 Then
        lstmainmenu.ListIndex = 1
        lstmainmenu.SetFocus
    End If
    Application.ScreenUpdating = True
    lbl_Stime.Caption = "(Suchabfrage dauerte: " & Format(Timer - T, "0.0000") & " sec)"
End Sub

Sub ArtikelCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    cboArtikelnummer.Clear
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Lager").Cells(Rows.Count, 3).End(xlUp).Row
        objDic(Sheets("Lager").Cells(lngZ, 3).Value) = 0
    Next
    Frame_ArtikelS.cboArtikelnummer.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
End Sub

Sub SuchenBMenge() '1.44
    Dim dblAnzahl As Double
    Dim lngrow As Long
    On Error Resume Next
    ThisWorkbook.Activate
    Application.ScreenUpdating = False
    For lngrow = 1 To Worksheets("Bestellung").Cells(Rows.Count, 12).End(xlUp).Row
        If CStr(Worksheets("Bestellung").Cells(lngrow, 12)) = CStr(txtID) And Not Worksheets("Bestellung").Cells(lngrow, 16) = "" Then
            dblAnzahl = dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 17)
        ElseIf CStr(Worksheets("Bestellung").Cells(lngrow, 12)) = CStr(txtID) And Worksheets("Bestellung").Cells(lngrow, 16) = "" Then
            dblAnzahl = dblAnzahl + Worksheets("Bestellung").Cells(lngrow, 6)
        End If
    Next
    If dblAnzahl = 0 Then
        cmdstatusinfo.Visible = False
        Application.ScreenUpdating = True
        Exit Sub
    Else
        If dblAnzahl > 1 Then
            lblhinweis = "Es wurden " & dblAnzahl & " St|fffd|cke bestellt!"
            frmLager.lblhinweis.ForeColor = &H4000&
        Else
            lblhinweis = "Es wurde " & dblAnzahl & " St|fffd|ck bestellt!"
            frmLager.lblhinweis.ForeColor = &H4000&
        End If
        cmdstatusinfo.Visible = True
    End If
    Application.ScreenUpdating = True
End Sub

Sub Textboxenleeren()
    Dim merk, merkKasse As String
    Dim s1txt, s2txt As String
    On Error Resume Next
    ThisWorkbook.Activate
    s2txt = txt_VNr.Value
    s1txt = txt_VKDID.Value
    merk = txtIDS.Value
    merkKasse = txt_WGA.Value
    Dim objControl As control
    For Each objControl In Controls
        Select Case TypeName(objControl)
           Case "TextBox"
              objControl.Text = ""
           Case "ComboBox"
              objControl.ListIndex = -1
        End Select
    Next
    lblhinweis.Caption = ""
    lbl_bezeichnung.Caption = ""
    lbldatensaetze.Caption = ""
    Set frmLager.Image1.Picture = Nothing
    lbstatus.BackColor = &H8000000B
    tbKomHinweis.BackColor = &H8000000B
    cmdstatusinfo.Visible = False
    txtIDS.Value = merk
    txt_WGA.Value = merkKasse
    txt_VNr.Value = s2txt
    txt_VKDID.Value = s1txt
End Sub

Sub Sucheleeren()
    lbl_bezeichnung.Caption = ""
    txtBestand.Value = ""
    txt_BestandVer.Value = ""
    txt_BestandVer.Enabled = False
    lbl_Verfuegbar.Enabled = False
    lbstatus.BackColor = &H8000000B
    lbl_ldate.Caption = ""
    lbl_EKPreis.Caption = ""
    txtbestandmin.Value = ""
    lblhinweis.Caption = ""
    lbl_ldate.Caption = ""
    lbl_VKPreis.Caption = ""
    txteinheit.Value = ""
    txtFrei.Value = ""
    txtMeldeBestand.Value = ""
    lbl_bereitsVerk.Caption = ""
    lbl_erstellt.Caption = ""
    lbl_lWAt.Caption = ""
    lbl_letzterWA.Caption = ""
    lbl_ButtoVK.Caption = ""
    lbl_Kommentar.Caption = ""
    Frame_Lieferant.txtLFirma.Value = ""
    Frame_Lieferant.txtLNr.Value = ""
    Frame_Lieferant.txtLAnsprech.Value = ""
    Frame_Lieferant.txtLphone.Value = ""
    txt_BN.Value = ""
    Frame_Lieferant.txt_Lemail.Value = ""
    lbldatensaetze.Caption = ""
    lbl_AufRser.Caption = ""
    txt_BestandVer.Enabled = False
    lbl_Verfuegbar.Enabled = False
    Frame_Verf.BackColor = &H8000000B
    lbl_Verfuegbar.BackColor = &H8000000B
    lbl_Verfuegbar.ForeColor = &H8000000B
    tbKomHinweis.BackColor = &H8000000B
    lbl_ArAkRe.ForeColor = &H404040
    Call Datensaetze
End Sub

Sub Maskeclear()
    Call Textboxenleeren
    cboArtikelnummer.ListIndex = -1
    txt_item.Value = ""
    lblZinfo.Caption = ""
    lbl_Kommentar.Caption = ""
    cboHersteller.Value = ""
    cbo_KategorieHM = ""
    lbl_bezeichnung.Caption = ""
    cboWarengruppe.Value = ""
    lblhinweis.Caption = ""
    Frame_ArtikelS.cboArtikelnummer.Value = ""
    lbldatensaetze.Caption = ""
    lstmainmenu.Clear
    txt_BestandVer.Enabled = False
    lbl_Verfuegbar.Enabled = False
    Frame_Verf.BackColor = &H8000000B
    lbl_Verfuegbar.BackColor = &H8000000B
    lbl_Verfuegbar.ForeColor = &H8000000B
    tbKomHinweis.BackColor = &H8000000B
    lbl_ArAkRe.ForeColor = &H404040
    lbl_erstellt.Caption = ""
    lbl_ldate.Caption = ""
    lbl_letzterWA.Caption = ""
    lbl_EKPreis.Caption = ""
    lbl_VKPreis.Caption = ""
    lbl_UMST.Caption = ""
    lbl_ButtoVK.Caption = ""
    lbl_bereitsVerk.Caption = ""
    lbl_AVerleih2.Caption = ""
    lbl_AufRser.Caption = ""
    lbl_lWAt.Caption = ""
    lbl_Stime.Caption = ""
End Sub

Sub Datensaetze()
    On Error Resume Next
    ThisWorkbook.Activate
    If CDbl(lstmainmenu.ListCount) = 0 Then
        lbldatensaetze.Caption = ""
    ElseIf CDbl(lstmainmenu.ListCount) > 1 Then
        lbldatensaetze.Caption = lstmainmenu.ListCount & " Datens|fffd|tze gefunden"
    Else
        lbldatensaetze.Caption = lstmainmenu.ListCount & " Datensatz gefunden"
    End If
End Sub

Sub SuchenR() 'v1.44
    Dim lngR As Long
    Dim i As Double
    On Error Resume Next
    ThisWorkbook.Activate
    Call SuchenVerleih
    Application.ScreenUpdating = False
    i = 0
    For lngR = 2 To Sheets("Reservierungen").UsedRange.Rows.Count
        If CStr(Sheets("Reservierungen").Cells(lngR, 18)) = CStr(txtID.Text) And Sheets("Reservierungen").Cells(lngR, 11) = "Auftrag" Then
            i = i + CDbl(Sheets("Reservierungen").Cells(lngR, 7))
        End If
    Next lngR
    If i = 0 Then
        txt_BestandVer.Enabled = False
        lbl_Verfuegbar.Enabled = False
        Frame_Verf.BackColor = &H8000000B
        lbl_Verfuegbar.BackColor = &H8000000B
        lbl_Verfuegbar.ForeColor = &H8000000B
        lbl_ArAkRe.ForeColor = &H404040
        lbl_AufRser.Caption = ""
        txt_BestandVer.Value = ""
        Application.ScreenUpdating = True
        Exit Sub
    Else
        txt_BestandVer.Enabled = True
        lbl_Verfuegbar.Enabled = True
        Frame_Verf.BackColor = &H80&
        lbl_Verfuegbar.BackColor = &H80&
        lbl_Verfuegbar.ForeColor = &HFFFFFF
        lbl_ArAkRe.ForeColor = &HFF&
        If CDbl(i) >= 0 Then
            txt_BestandVer = CDbl(txtBestand) - CDbl(i)
        Else
            txt_BestandVer = 0
        End If
        If txt_BestandVer < 0 Then
            txt_BestandVer.Value = 0
        End If
        lbl_AufRser.Caption = i
        txt_BestandVer.ForeColor = &HFF&
    End If
    Application.ScreenUpdating = True
End Sub

Sub SuchenVerleih() 'v1.44
    Dim lng As Long
    Dim i As Double
    On Error Resume Next
    ThisWorkbook.Activate
    i = 0
    Application.ScreenUpdating = False
    For lng = 2 To Sheets("Verleih").UsedRange.Rows.Count
        If CStr(Sheets("Verleih").Cells(lng, 4)) = CStr(txtID) Then
            i = i + CDbl(Sheets("Verleih").Cells(lng, 8))
        End If
    Next lng
    If i > 0 Then
        lbl_AVerleih2.Caption = i
        lbl_Verleihanzeigen.Visible = True
    Else
        lbl_AVerleih2.Caption = ""
        lbl_Verleihanzeigen.Visible = False
    End If
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmLagerorte"
Attribute VB_Base = "0{15CF3F6C-48D8-4271-A74A-C2DA7623D845}{86F02433-9D8C-488A-98E2-0A80A20AB0F9}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cbo_NebenL_Change()
    txt_Lagerplatz.Value = cbo_NebenL.Text
End Sub

Private Sub List_Lagerort_Change()
    If List_Lagerort.ListCount = 0 Then
        lbl_Lager.Caption = "Neues Hauptlager:"
    Else
        lbl_Lager.Caption = "Neues Nebenlager:"
    End If
    If List_Lagerort.ListCount = 1 And txt_info.Value = "HH" Then
        cmd_LPdel.Visible = False
    Else
        cmd_LPdel.Visible = True
    End If
End Sub

Private Sub txt_info_Change()
    If List_Lagerort.ListCount = 0 Then
        lbl_Lager.Caption = "Neues Hauptlager:"
        lbl_VLager.Caption = "Vorhandene Hauptlager:"
        Call HLagerortCombo
    Else
        lbl_Lager.Caption = "Neues Nebenlager:"
        lbl_VLager.Caption = "Vorhandene Nebenlager:"
        Call LagerortCombo
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim iZaehler As Long
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    Call suchenIDNeu
    Call LagerortCombo
    Application.ScreenUpdating = False
    chk_Lagerplatz.Value = True
    For iZaehler = 1 To 2
        With Controls("cbo_Platz" & iZaehler)
            .AddItem "Hauptlager"
            .AddItem "Nebenlager"
        End With
    Next iZaehler
    Application.ScreenUpdating = True
End Sub

Sub HLagerortCombo()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    cbo_NebenL.Clear
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Daten").Cells(Rows.Count, 1).End(xlUp).Row
      objDic(Sheets("Daten").Cells(lngZ, 12).Value) = 0
    Next
    cbo_NebenL.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
    Call SortierenComboboxHort
End Sub

Sub SortierenComboboxHort()
    Dim i_Erster As Integer
    Dim i_Letzter As Integer
    Dim i_Aktuell As Integer
    Dim i_N|fffd|chster As Integer
    Dim s_buffer As String
    Application.ScreenUpdating = False
    With cbo_NebenL
        If .ListCount = 0 Then Exit Sub
        i_Erster = 0
        i_Letzter = .ListCount - 1
        For i_Aktuell = i_Erster To i_Letzter
            For i_N|fffd|chster = i_Aktuell + 1 To i_Letzter
                If .List(i_Aktuell) > .List(i_N|fffd|chster) Then
                    s_buffer = .List(i_N|fffd|chster)
                    .List(i_N|fffd|chster) = .List(i_Aktuell)
                    .List(i_Aktuell) = s_buffer
                End If
            Next i_N|fffd|chster
        Next i_Aktuell
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_Lagerplatz1_Change()
    Dim lng As Long
    Dim stxt As String
    On Error Resume Next
    Application.ScreenUpdating = False
    stxt = lbl_ID.Caption
    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
        If Sheets("Lagerorte").Cells(lng, 2) = stxt And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz1.Text Then
            lbl_Menge1.Caption = Sheets("Lagerorte").Cells(lng, 4)
            txt_LPID1.Value = Sheets("Lagerorte").Cells(lng, 1)
        End If
    Next lng
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_Lagerplatz2_Change()
    Dim lng As Long
    Dim stxt As String
    On Error Resume Next
    Application.ScreenUpdating = False
    stxt = lbl_ID.Caption
    For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
        If Sheets("Lagerorte").Cells(lng, 2) = stxt And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz2.Text Then
            lbl_Menge2.Caption = Sheets("Lagerorte").Cells(lng, 4)
            txt_LPID2.Value = Sheets("Lagerorte").Cells(lng, 1)
        End If
    Next lng
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_Platz1_Change()
    Dim lngID As Long
    Dim arrTmpA, arrTmpB, i, j As Long
    Dim Last_Row, xrow As Long
    On Error Resume Next
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        Application.ScreenUpdating = False
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(lbl_ID) Then
                lngID = i
            End If
        Next i
        Application.ScreenUpdating = True
    End With
    If cbo_Platz1 = "Hauptlager" Then
        cbo_Lagerplatz1.Visible = False
        cbo_Platz2 = "Nebenlager"
        lbl_Menge1.Caption = Worksheets("Lager").Cells(CDbl(lngID), 8)
        txt_LPID1.Value = ""
    ElseIf cbo_Platz1 = "Nebenlager" Then
        cbo_Lagerplatz1.Visible = True
        Call LagerplatzCombo1
    End If
End Sub

Private Sub cbo_Platz2_Change()
    Dim stxt As String
    Dim arrTmpA, arrTmpB, i, j As Long
    Dim Last_Row, xrow As Long
    On Error Resume Next
    stxt = lbl_ID.Caption
    Application.ScreenUpdating = False
    If cbo_Platz2 = "Hauptlager" Then
        cbo_Lagerplatz2.Visible = False
        cbo_Platz1 = "Nebenlager"
        If cbo_Platz2 = "Hauptlager" Then
        'If txt_info.Value = "A" Then
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                Application.ScreenUpdating = False
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(stxt) Then
                        xrow = arrTmpA(i, 8)
                    End If
                Next i
                Application.ScreenUpdating = True
            End With
        End If
        lbl_Menge2.Caption = xrow
        txt_LPID2.Value = ""
    Else
        cbo_Lagerplatz2.Visible = True
        LagerplatzCombo2
    End If
    Application.ScreenUpdating = True
End Sub

Sub LagerplatzCombo1()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim stxt As String
    On Error Resume Next
    Application.ScreenUpdating = False
    cbo_Lagerplatz1.Clear
    stxt = lbl_ID.Caption
    With cbo_Lagerplatz1
        ALetzte = Sheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not IsEmpty(Sheets("Lagerorte").Cells(irow, 2)) Then
                If Sheets("Lagerorte").Cells(irow, 2).Value = stxt Then
                    xKey = Sheets("Lagerorte").Cells(irow, 3).Value
                    DIC(xKey) = 0
                End If
            End If
        Next
        For Each xKey In DIC
            cbo_Lagerplatz1.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_Lagerplatz1.ListIndex = 0
    End With
    Application.ScreenUpdating = True
End Sub

Sub LagerplatzCombo2()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim stxt As String
    On Error Resume Next
    
    cbo_Lagerplatz2.Clear
    stxt = lbl_ID.Caption
    Application.ScreenUpdating = False
    With cbo_Lagerplatz2
        ALetzte = Sheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not IsEmpty(Sheets("Lagerorte").Cells(irow, 2)) Then
                If Sheets("Lagerorte").Cells(irow, 2).Value = stxt Then
                    xKey = Sheets("Lagerorte").Cells(irow, 3).Value
                    DIC(xKey) = 0
                End If
            End If
        Next
        For Each xKey In DIC
            cbo_Lagerplatz2.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_Lagerplatz2.ListIndex = 0
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub chk_Lagerplatz_Click()
    If chk_Lagerplatz.Value = False And Not Sheets("Daten").Range("B7") = "Admin" And Not frmLager.lbl_Benutzer.Caption = "" Then
        If Not frmLager.txt_Admin = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            chk_Lagerplatz.Value = True
            txt_Lagermenge.Enabled = False
            Exit Sub
        End If
    Else
        If chk_Lagerplatz.Value = True Then
            txt_Lagermenge.Enabled = False
            txt_Lagermenge.Value = 0
        Else
            txt_Lagermenge.Enabled = True
        End If
    End If
End Sub

Private Sub cmd_umlagern_Click() '1.44
    Dim imtxt, stxt As String
    Dim xrow, lng1, lng2 As Long
    Dim arrTmpA, arrTmpB, i, j As Long
    Dim Last_Row As Long
    On Error Resume Next
    
    If cbo_Platz1 = "" Then Exit Sub
    If cbo_Platz2 = "" Then Exit Sub
    If CDbl(lbl_Menge1) = 0 Then
        MsgBox "Keine Verf|fffd|gbare Menge", , "Hinweis"
    End If
    If txt_LPID1.Value = txt_LPID2.Value Then
        MsgBox "Das Umlagern auf zwei identische Lagerpl|fffd|tze ist nicht m|fffd|glich!", , "Hinweis"
    Else
        imtxt = InputBox("Bitte geben Sie die Menge an!", "Umlagern", 1)
        If imtxt = "" Then Exit Sub
        If CDbl(imtxt) > CDbl(lbl_Menge1) Then
            MsgBox "Die Menge ist gr|fffd||fffd|er als die vorhandene!", , "Quell - Lager"
            Exit Sub
        End If
        stxt = lbl_ID.Caption
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(stxt) Then
                    xrow = i
                End If
            Next i
        End With
        If Not txt_LPID1.Value = "" Then
            With ThisWorkbook.Sheets("Lagerorte")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(txt_LPID1) Then
                        lng1 = i
                    End If
                Next i
            End With
        End If
        If Not txt_LPID2.Value = "" Then
            With ThisWorkbook.Sheets("Lagerorte")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(txt_LPID2) Then
                        lng2 = i
                    End If
                Next i
            End With
        End If
        If txt_LPID1.Value = "" And Not txt_LPID2.Value = "" Then
            Sheets("Lager").Cells(xrow, 8).Value = (CDbl(lbl_Menge1) - CDbl(imtxt))
            Sheets("Lagerorte").Cells(lng2, 4).Value = (CDbl(lbl_Menge2) + CDbl(imtxt))
            MsgBox "Erfolgreich gespeichert!", , " Hauptlager > Nebenlager"
        ElseIf Not txt_LPID1.Value = "" And txt_LPID2.Value = "" Then
            Sheets("Lager").Cells(xrow, 8).Value = (CDbl(lbl_Menge2) + CDbl(imtxt))
            Sheets("Lagerorte").Cells(lng1, 4).Value = (CDbl(lbl_Menge1) - CDbl(imtxt))
            MsgBox "Erfolgreich gespeichert!", , "Nebenlager > Hauptlager"
        ElseIf Not txt_LPID1.Value = "" And Not txt_LPID2.Value = "" Then
            Sheets("Lagerorte").Cells(lng1, 4).Value = (CDbl(lbl_Menge1) - CDbl(imtxt))
            Sheets("Lagerorte").Cells(lng2, 4).Value = (CDbl(lbl_Menge2) + CDbl(imtxt))
            MsgBox "Erfolgreich Gespeichert!", , "Nebenlager > Nebenlager"
        End If
    End If
    Application.ScreenUpdating = True
    lbl_Menge1.Caption = (CDbl(lbl_Menge1) - CDbl(imtxt))
    lbl_Menge2.Caption = (CDbl(lbl_Menge2) + CDbl(imtxt))
    Call suchenIDNeu
    frmLagerorte.MultiPage1.Value = 0
End Sub

Private Sub cmdchanel_Click()
    Dim strID As String
    Dim arrTmpA, arrTmpB, i, j, n As Long
    Dim Last_Row, xrow As Long
    On Error Resume Next
    strID = lbl_ID.Caption
    frmLager.cbo_Lagerplatz.Enabled = True
    frmLager.Asuchen
    Application.ScreenUpdating = False
    If txt_info.Value = "A" Then
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And LCase(arrTmpA(i, 1)) = CStr(strID) Then
                    xrow = arrTmpA(i, 8)
                End If
            Next i
        End With
    End If
    frmArtikel.txt_Bestand.Value = xrow
    Application.ScreenUpdating = True
    txt_info.Value = ""
    Unload frmLagerorte
End Sub

Private Sub ComKExit_Click()
    Dim strID As String
    On Error Resume Next
    strID = lbl_ID.Caption
    frmLager.cbo_Lagerplatz.Enabled = True
    frmLager.Asuchen
    txt_info.Value = ""
    Unload frmLagerorte
End Sub

Sub LagerortCombo()
    Dim hsh As Object, i As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Const COL1 As Integer = 3
    Set hsh = CreateObject("Scripting.Dictionary")
    With Sheets("Lagerorte")
        For i = 2 To Sheets("Lagerorte").Cells(.Rows.Count, COL1).End(xlUp).Row
            hsh(Sheets("Lagerorte").Cells(i, COL1).Text) = 0
        Next
        cbo_NebenL.List = Application.Transpose(hsh.keys)
    End With
    Application.ScreenUpdating = True
End Sub

Sub SortierenComboboxLNort()
    Dim i_Erster As Integer
    Dim i_Letzter As Integer
    Dim i_Aktuell As Integer
    Dim i_N|fffd|chster As Integer
    Dim s_buffer As String
    Application.ScreenUpdating = False
    With cbo_NebenL
        If .ListCount = 0 Then Exit Sub
        i_Erster = 0
        i_Letzter = .ListCount - 1
        For i_Aktuell = i_Erster To i_Letzter
            For i_N|fffd|chster = i_Aktuell + 1 To i_Letzter
                If .List(i_Aktuell) > .List(i_N|fffd|chster) Then
                    s_buffer = .List(i_N|fffd|chster)
                    .List(i_N|fffd|chster) = .List(i_Aktuell)
                    .List(i_Aktuell) = s_buffer
                End If
            Next i_N|fffd|chster
        Next i_Aktuell
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_NextLager_Click() '1.44
    Dim strID As String
    Dim letztezeile, MaxID, zeile, z, LRow As Long
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    strID = lbl_ID.Caption
    If txt_info.Value = "AH" Then
        frmArtikel.cboLagerort.Value = txt_Lagerplatz.Value
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(strID) Then
                    Worksheets("Lager").Cells(CLng(i), 13) = txt_Lagerplatz.Value
                End If
            Next i
        End With
        txt_info = "A"
        lbl_LagerInfo.Caption = ""
        MsgBox "Hauptlagerplatz wurde zugeordnet: " & txt_Lagerplatz.Value, , "Hinweis"
        txt_Lagerplatz.Value = ""
        Call suchenIDNeu
        Exit Sub
    ElseIf txt_info.Value = "HH" Then
        frmLager.txtLagerort.Value = txt_Lagerplatz.Value
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And CStr(arrTmpA(i, 1)) = CStr(strID) Then
                    Worksheets("Lager").Cells(CLng(i), 13) = txt_Lagerplatz.Value
                End If
            Next i
        End With
        txt_info = ""
        lbl_LagerInfo.Caption = ""
        MsgBox "Hauptlagerplatz wurde zugeordnet: " & txt_Lagerplatz.Value, , "Hinweis"
        txt_Lagerplatz.Value = ""
        Call suchenIDNeu
        Exit Sub
    End If
    Application.ScreenUpdating = False
        Sheets("Lagerorte").Activate
        LRow = CLng(Sheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row) + 1
        letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
        MaxID = 0
        For z = 2 To letztezeile
            If CDbl(Cells(z, 1)) > MaxID Then
                MaxID = CDbl(Cells(z, 1))
            End If
        Next
    If Sheets("Daten").Cells(43, 2) = "" Or Sheets("Daten").Cells(43, 2) = 0 Then
        If CDbl(MaxID) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(43, 2).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(MaxID) > CDbl(Sheets("Daten").Cells(43, 2).Value) Then
            zeile = CDbl(MaxID) + 1
            Sheets("Daten").Cells(43, 2).Value = CDbl(MaxID) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(43, 2).Value) + 1
            Sheets("Daten").Cells(43, 2).Value = CDbl(Sheets("Daten").Cells(43, 2).Value) + 1
        End If
    End If
    Sheets("Lagerorte").Cells(LRow, 1) = zeile 'ID_LO
    Sheets("Lagerorte").Cells(LRow, 2) = CStr(lbl_ID)
    Sheets("Lagerorte").Cells(LRow, 3) = "'" & txt_Lagerplatz.Value
    If txt_Lagermenge = "" Then
        Sheets("Lagerorte").Cells(LRow, 4) = 0
    Else
        Sheets("Lagerorte").Cells(LRow, 4) = txt_Lagermenge.Value
    End If
    txt_Lagerplatz.Value = ""
    txt_Lagermenge.Value = ""
    Call suchenIDNeu
    Sheets("Center").Activate
    If Worksheets("Daten").Range("B43") = "" Then
        Worksheets("Daten").Range("B43").Value = CDbl("1")
    Else
        Worksheets("Daten").Range("B43").Value = CDbl(zeile)
    End If
    txt_Lagermenge.Value = "0"
    If List_Lagerort.ListCount = 0 Then
        lbl_Lager.Caption = "Neues Hauptlager:"
        lbl_VLager.Caption = "Vorhandene Hauptlager:"
        Call HLagerortCombo
    Else
        lbl_Lager.Caption = "Neues Nebenlager:"
        lbl_VLager.Caption = "Vorhandene Nebenlager:"
        Call LagerortCombo
    End If
    Application.ScreenUpdating = True
    MsgBox "Lagerplatz hinzugef|fffd|gt!", , "Hinweis"
End Sub

Private Sub cmd_LPdel_Click()
    Dim lngrow As Long
    Dim strName, strF As String
    On Error Resume Next
    strName = List_Lagerort.Column(0)
    If List_Lagerort.Column(3) = "HL" Then 'Hauptlager
        If CDbl(List_Lagerort.Column(1)) > 0 Then
            MsgBox "Kann nicht gel|fffd|scht werden!" & vbLf & "Grund: Lagerbestand vorhanden!", vbInformation, "Hinweis Hauptlagerplatz"
            Exit Sub
        End If
        strF = MsgBox("M|fffd|chten Sie wirklich den Hauptlagerplatz: (" & strName & ") l|fffd|schen?", vbYesNo + vbQuestion, "Best|fffd|ttigen")
        If strF = vbYes Then
            lngrow = List_Lagerort.Column(3)
            Sheets("Lager").Cells(lngrow, 13) = ""
            Call suchenIDNeu
            MsgBox "Lagerplatz: " & strName & " wurde entfernt!", , "Hinweis"
        End If
    Else
        If CDbl(List_Lagerort.Column(1)) > 0 Then 'Nebenlager
            MsgBox "Kann nicht gel|fffd|scht werden!" & vbLf & "Grund: Noch Bestand auf dem Lagerplatz!", vbInformation, "Hinweis Nebenlager"
            Exit Sub
        End If
        strF = MsgBox("M|fffd|chten Sie wirklich den Lagerplatz: (" & strName & ") l|fffd|schen?", vbYesNo + vbQuestion, "Best|fffd|ttigen")
        If strF = vbYes Then
            lngrow = List_Lagerort.Column(3)
            Sheets("Lagerorte").Rows(lngrow).Delete
            Call suchenIDNeu
            MsgBox "Lagerplatz: " & strName & " wurde entfernt!", , "Hinweis"
        End If
    End If
    If List_Lagerort.ListCount = 0 Then
        lbl_Lager.Caption = "Neues Hauptlager:"
        lbl_VLager.Caption = "Vorhandene Hauptlager:"
        txt_info.Value = "HH"
        lbl_LagerInfo.Caption = "Noch kein Hauptlagerplatz!"
        Call HLagerortCombo
    Else
        lbl_Lager.Caption = "Neues Nebenlager:"
        lbl_VLager.Caption = "Vorhandene Nebenlager:"
        Call LagerortCombo
    End If
End Sub

Private Sub txt_Lagermenge_Change()
    If chk_Lagerplatz.Value = True Then
        txt_Lagermenge.Enabled = False
    Else
        txt_Lagermenge.Enabled = True
    End If
End Sub

Private Sub txt_Menge1_Change()
    If CDbl(lbl_Menge1) > 0 Then
        lbl_Menge1.ForeColor = &H80000008
    Else
        lbl_Menge1.ForeColor = &HFF&
    End If
End Sub

Sub suchenIDNeu() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    On Error Resume Next
    List_Lagerort.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And LCase(arrTmpA(i, 1)) = CStr(lbl_ID) Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 13)
                arrTmpB(2, n) = arrTmpA(i, 8)
                If Not arrTmpA(i, 13) = "" Then
                    arrTmpB(3, n) = "HL"
                Else
                    arrTmpB(3, n) = ""
                End If
                arrTmpB(4, n) = i
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 4)
        For i = 1 To 4
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With List_Lagerort
           .ColumnCount = 4
           .ColumnWidths = "220;60;0;0"
           .List = arrTmpA
        End With
    End If
    Call SuchenID2
    If List_Lagerort.ListCount = 1 And txt_info.Value = "HH" Then
        cmd_LPdel.Visible = False
    Else
        cmd_LPdel.Visible = True
    End If
    Application.ScreenUpdating = True
End Sub

Sub SuchenID2() '1.40
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Lagerorte")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) = CStr(lbl_ID) Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = arrTmpA(i, 4)
                arrTmpB(3, n) = ""
                arrTmpB(4, n) = i
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 4)
        For i = 1 To 4
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With List_Lagerort2
           .ColumnCount = 4
           .ColumnWidths = "220;60;0;0"
           .List = arrTmpA
        End With
    End If
    Application.ScreenUpdating = True
    Call LOEZus
End Sub

Sub LOEZus()
    Dim i, i2, lng As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    i2 = List_Lagerort.ListCount
    For lng = 1 To List_Lagerort2.ListCount
        List_Lagerort.AddItem List_Lagerort2.Column(0, i)
        List_Lagerort.Column(1, i2) = List_Lagerort2.Column(1, i)
        List_Lagerort.Column(2, i2) = List_Lagerort2.Column(2, i)
        List_Lagerort.Column(3, i2) = List_Lagerort2.Column(3, i)
        List_Lagerort.Column(4, i2) = List_Lagerort2.Column(4, i)
        i2 = i2 + 1
        i = i + 1
    Next lng
    List_Lagerort2.Clear
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmLeistung"
Attribute VB_Base = "0{5AD0E343-B04E-4268-89DF-CD478AD5F123}{12D46963-DF92-43F7-AC76-77C47917F067}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cboUMST_Change()
    If Not cboUMST = "" Then
        If cboUMST = "ohne" Or cboUMST = "0%" Then
            Me.op_Brutto.Visible = False
            Me.op_Netto.Visible = False
        Else
            op_Brutto.Visible = True
            Me.op_Netto.Visible = True
        End If
    End If
End Sub

Private Sub cmd_Lchange_Click()
    Dim Last_Row, arrTmpA, arrTmpB, i, xrow As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Leistungen")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txt_LID) Then
                xrow = i
            End If
        Next i
    End With
    If xrow > 0 Then
        Worksheets("Leistungen").Cells(xrow, 2).Value = txt_kzel.Value
        Worksheets("Leistungen").Cells(xrow, 3).Value = txt_Art.Value
        Worksheets("Leistungen").Cells(xrow, 4).Value = txt_Lbezeichnung
        Worksheets("Leistungen").Cells(xrow, 5).Value = txt_LPreis
        If cboUMST = "" Then
            Worksheets("Leistungen").Cells(xrow, 6).Value = Format(CDbl(0), "#.#0,0")
        Else
            If cboUMST = "ohne" Then
                 Worksheets("Leistungen").Cells(xrow, 6).Value = "0"
            Else
                Worksheets("Leistungen").Cells(xrow, 6).Value = Format(CDbl(cboUMST.Value), "#.#0,0")
            End If
        End If
        Worksheets("Leistungen").Cells(xrow, 7).Value = txt_AnzahlL.Value
        If Me.chk_ohneE.Value = True Then
            Worksheets("Leistungen").Cells(xrow, 8).Value = ""
        Else
            Worksheets("Leistungen").Cells(xrow, 8).Value = cbo_aWert
        End If
        If op_Brutto = True Then
            Worksheets("Leistungen").Cells(xrow, 9).Value = "B"
        Else
            Worksheets("Leistungen").Cells(xrow, 9).Value = "N"
        End If
    End If
    Application.ScreenUpdating = True
    Call suchenL
    MsgBox "Vorlage wurde ge|fffd|ndert!", , "Hinweis"
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    Call suchenL
    op_Brutto.Value = True
    With cboUMST
        .AddItem Sheets("Daten").Range("B2") * 100 & "%"
        .AddItem Sheets("Daten").Range("B3") * 100 & "%"
        .AddItem "ohne"
    End With
    cboUMST.ListIndex = 0
    cbo_aWert.Locked = False
    cbo_aWert.Enabled = True
    txt_AnzahlL.BackColor = &HFFFFFF
    With cbo_aWert
        .AddItem "AW"
        .AddItem "Stunde"
        .AddItem "Minuten"
        .AddItem "Tage"
        .AddItem "St|fffd|ck"
        .AddItem "Kg"
        .AddItem "Liter"
        .AddItem "meter"
        .AddItem "cm"
        .AddItem "mm"
        .AddItem "m|fffd|"
        .AddItem "cm|fffd|"
        .AddItem "mm|fffd|"
        .AddItem "Sonstiges"
    End With
End Sub

Private Sub txt_AnzahlL_Change()
    If Not txt_LID = "" And txt_AnzahlL.Value = "" Then
        txt_AnzahlL.BorderColor = &HC0&
    Else
        txt_AnzahlL.BorderColor = &H808080
    End If
End Sub

Private Sub txt_LID_Change()
    If Not txt_LID = "" Then
        cmd_Lchange.Enabled = True
        cmd_Lclear.Enabled = True
    Else
        cmd_Lchange.Enabled = False
        cmd_Lclear.Enabled = False
    End If
    If Not txt_LID = "" And txt_AnzahlL.Value = "" Then
        txt_AnzahlL.BorderColor = &HC0&
    Else
        txt_AnzahlL.BorderColor = &H808080
    End If
End Sub

Private Sub cmd_Lclear_Click()
    Dim lng, stxt As Long
    On Error Resume Next
    
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If frmLeistung.txt_LID.Value = "" Then Exit Sub
    stxt = MsgBox("M|fffd|chten Sie die Leistung (" + txt_Art + ") wirklich l|fffd|schen?", vbYesNo, "Leistung l|fffd|schen")
    If stxt = vbYes Then
        lng = Worksheets("Leistungen").Range("A:A").Find(txt_LID.Text, LookIn:=xlValues, MatchCase:=True).Row
        Sheets("Leistungen").Rows(lng).Delete
    Else
        Exit Sub
    End If
    MsgBox "Leistung (" + txt_Art + ") wurde gel|fffd|scht", , "Hinweis"
    txt_LID.Value = ""
    txt_Art.Value = ""
    txt_kzel.Value = ""
    txt_Lbezeichnung.Value = ""
    txt_LPreis.Value = ""
    cboUMST = ""
    lstLeistung.Clear
    Call suchenL
End Sub

Private Sub cmd_Lleeren_Click()
    txt_LID.Value = ""
    txt_Art.Value = ""
    txt_kzel.Value = ""
    txt_Lbezeichnung.Value = ""
    txt_LPreis.Value = ""
    cboUMST = ""
    lbl_Ainfo.Caption = ""
    txt_AnzahlL.Value = ""
    txt_AnzahlL2.Value = ""
    cbo_aWert.ListIndex = -1
    cbo_aWert.Locked = False
    cbo_aWert.Enabled = True
    txt_AnzahlL.BackColor = &HFFFFFF
    txt_kzel.SetFocus
End Sub

Private Sub cmd_Lspeichern_Click()
    Dim zeile, lngZeile As Long
    On Error Resume Next
    
    If txt_Art.Value = "" Then Exit Sub
    txt_LID.Value = ""
    If txt_AnzahlL.Value = "" Then
        MsgBox "Bitte geben Sie ein Wert ein!", , "Hinweis"
        txt_AnzahlL.SetFocus
        Exit Sub
    End If
    If Sheets("Daten").Cells(20, 2) = "" Or Sheets("Daten").Cells(20, 2) = 0 Then
        zeile = 1
    Else
        zeile = Sheets("Daten").Cells(20, 2) + 1
    End If
    Application.ScreenUpdating = False
    With Worksheets("Leistungen")
        If .FilterMode Then .ShowAllData
    End With
    lngZeile = Worksheets("Leistungen").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Leistungen").Activate
    lngZeile = lngZeile + 1
    Worksheets("Leistungen").Cells(lngZeile, 1) = zeile
    Worksheets("Leistungen").Cells(lngZeile, 2).Value = txt_kzel.Value
    Worksheets("Leistungen").Cells(lngZeile, 3).Value = txt_Art.Value
    Worksheets("Leistungen").Cells(lngZeile, 4).Value = txt_Lbezeichnung
    Worksheets("Leistungen").Cells(lngZeile, 5).Value = txt_LPreis
    If cboUMST = "" Then
        Worksheets("Leistungen").Cells(lngZeile, 6).Value = Format(CDbl(0), "#.#0,0")
    Else
        If cboUMST = "ohne" Then
             Worksheets("Leistungen").Cells(lngZeile, 6).Value = "0"
        Else
            Worksheets("Leistungen").Cells(lngZeile, 6).Value = Format(CDbl(cboUMST.Value), "#.#0,0")
        End If
    End If
    Worksheets("Leistungen").Cells(lngZeile, 7).Value = txt_AnzahlL.Value
    Worksheets("Leistungen").Cells(lngZeile, 8).Value = cbo_aWert
    If op_Brutto = True Then
        Worksheets("Leistungen").Cells(lngZeile, 9).Value = "B"
    Else
        Worksheets("Leistungen").Cells(lngZeile, 9).Value = "N"
    End If
    ActiveWorkbook.Save
    MsgBox "Leistung (" + txt_Art + ") wurde angelegt!", , "Hinweis"
    txt_LID.Value = ""
    txt_Art.Value = ""
    txt_kzel.Value = ""
    txt_Lbezeichnung.Value = ""
    txt_LPreis.Value = ""
    cboUMST = ""
    lbl_Ainfo.Caption = ""
    txt_AnzahlL.Value = ""
    txt_AnzahlL2.Value = ""
    cbo_aWert.ListIndex = -1
    lstLeistung.Clear
    Sheets("center").Activate
    Application.ScreenUpdating = True
    Call suchenL
    Sheets("Daten").Cells(20, 2).Value = Sheets("Daten").Cells(20, 2).Value + 1
End Sub

Private Sub cmdanlegen_Click() 'v1.44
    Dim zstr, strKID, strRN As String
    On Error Resume Next
    strRN = frmKasse.txtRnr
    strKID = frmKasse.txt_KDID.Value
    If frmKasse.cboart2 = "" Or frmKasse.cboart2 = "Bitte ausw|fffd|hlen" Then Exit Sub
    If txt_LPreis.Value = "" Then
        MsgBox "Bitte geben Sie einen Preis ein!", , "Leistungen"
        txt_LPreis.SetFocus
        Exit Sub
    End If
    If txt_Lbezeichnung.Value = "" Then
        MsgBox "Bitte geben Sie Bezeichnung ein!", , "Leistungen"
        txt_Lbezeichnung.SetFocus
        Exit Sub
    End If
    If cboUMST = "" Then
        MsgBox "Bitte geben Sie ein Steuersatz ein!", , "Leistungen"
        cboUMST.SetFocus
        Exit Sub
    End If
    If txt_AnzahlL = "" Then
        MsgBox "Bitte geben Sie ein Wert ein!", , "Hinweis"
        txt_AnzahlL.SetFocus
        Exit Sub
    End If
    If frmKasse.cboart2.Value = "Rechnung" And frmKasse.txtRnr.Value = "" Then
       MsgBox "Geben Sie eine Rechnungsnummer an!", vbOKOnly, "Hinweis"
        frmKasse.txtRnr.SetFocus
        Exit Sub
    End If
    If frmKasse.cboart2.Value = "Auftrag" And frmKasse.txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Auftragsnummer an!", vbOKOnly, "Hinweis"
        frmKasse.txtRnr.SetFocus
        Exit Sub
    ElseIf frmKasse.cboart2.Value = "Angebot" And frmKasse.txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Auftragsnummer an!", vbOKOnly, "Hinweis"
        frmKasse.txtRnr.SetFocus
        Exit Sub
    End If
    With Worksheets("Kassendaten")
        If .FilterMode Then .ShowAllData
    End With
    If txt_AnzahlL2 = "" Then
        zstr = 1
    Else
        zstr = txt_AnzahlL2
    End If
    Worksheets("Kassendaten").Columns("L:L").NumberFormat = "0.0%"
    Worksheets("Reservierungen").Columns("L:L").NumberFormat = "0.0%"
    Application.ScreenUpdating = False
    If Not frmKasse.cboart2 = "Auftrag" And Not frmKasse.cboart2 = "Angebot" Then
        Sheets("Kassendaten").Activate
        Range("B65536").End(xlUp).Offset(1, 0).Select
        If frmKasse.cboart2.Value = "Intern" Then
            ActiveCell.Offset(0, -1) = "Intern " & Date & "/" & Format(Time, "hhmmss")
        Else
            ActiveCell.Offset(0, -1).Value = "'" & frmKasse.txtRnr 'Belegnummer
        End If
        ActiveCell.Offset(0, 0).Value = "'" & txt_kzel.Value
        ActiveCell.Offset(0, 4).Value = txt_Lbezeichnung.Value
        ActiveCell.Offset(0, 5).Value = CDbl(txt_AnzahlL.Value)
        ActiveCell.Offset(0, 8).Value = "L"
        ActiveCell.Offset(0, 9).Value = frmKasse.cboart2
        If cboUMST = "ohne" Then
             ActiveCell.Offset(0, 10).Value = CDbl(Format(0, "#.#0,0"))
        Else
            ActiveCell.Offset(0, 10).Value = CDbl(Format(cboUMST.Value, "#.#0,0"))
        End If
        ActiveCell.Offset(0, 18).Value = frmKasse.txt_KDID.Text
        If op_Brutto.Value = True Then
            If cboUMST = "ohne" Then
                ActiveCell.Offset(0, 6).Value = CDbl(txt_AnzahlL.Value) * CDbl(txt_LPreis.Value)
                ActiveCell.Offset(0, 11).Value = CDbl(txt_LPreis.Value)
            Else
                If cboUMST = ThisWorkbook.Sheets("Daten").Range("B3").Text Then
                    ActiveCell.Offset(0, 6).Value = CDbl(txt_LPreis.Value * CDbl(txt_AnzahlL.Value) / CDbl(zstr)) * 100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                    ActiveCell.Offset(0, 11).Value = CDbl(txt_LPreis.Value * 100) / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                Else
                    ActiveCell.Offset(0, 6).Value = CDbl(txt_LPreis.Value * CDbl(txt_AnzahlL.Value) / CDbl(zstr)) * 100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                    ActiveCell.Offset(0, 11).Value = CDbl(txt_LPreis.Value) * 100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                End If
            End If
        Else
            If cboUMST = "ohne" Then
                ActiveCell.Offset(0, 6).Value = (CDbl(txt_LPreis.Value)) * CDbl(txt_AnzahlL.Value) / CDbl(zstr)
                ActiveCell.Offset(0, 11).Value = (CDbl(txt_LPreis.Value)) * CDbl(txt_AnzahlL.Value) / CDbl(zstr)
            Else
                ActiveCell.Offset(0, 6).Value = (CDbl(txt_LPreis.Value)) * CDbl(txt_AnzahlL.Value) / CDbl(zstr)
                ActiveCell.Offset(0, 11).Value = (CDbl(txt_LPreis.Value))
            End If
        End If
        Call frmKasse.SuchenKasseV2
        Call frmKasse.leeren
    Else
        With Worksheets("Reservierungen")
            If .FilterMode Then .ShowAllData
        End With
        Sheets("Reservierungen").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = "'" & frmKasse.txtRnr
        ActiveCell.Offset(0, 1).Value = "'" & txt_kzel.Value
        ActiveCell.Offset(0, 5).Value = txt_Lbezeichnung.Value
        ActiveCell.Offset(0, 6).Value = CDbl(txt_AnzahlL.Value)
        ActiveCell.Offset(0, 9).Value = "L"
        If frmKasse.cboart2 = "Auftrag" Then
            ActiveCell.Offset(0, 10).Value = "Auftrag"
        ElseIf frmKasse.cboart2 = "Angebot" Then
            ActiveCell.Offset(0, 10).Value = "Angebot"
        End If
        ActiveCell.Offset(0, 18).Value = frmKasse.txt_KDID.Text
        If cboUMST = "ohne" Then
             ActiveCell.Offset(0, 11).Value = CDbl(Format(0, "#.#0,0"))
        Else
            ActiveCell.Offset(0, 11).Value = CDbl(Format(cboUMST.Value, "#.#0,0"))
        End If
        If Not CDbl(txt_LPreis) > 0 Or txt_LPreis.Value = "" Then
            ActiveCell.Offset(0, 7).Value = 0
            ActiveCell.Offset(0, 12).Value = 0
        Else
            If op_Brutto.Value = True Then
                If cboUMST = "ohne" Then
                    ActiveCell.Offset(0, 7).Value = CDbl(txt_LPreis.Value) * CDbl(txt_AnzahlL.Value)
                    ActiveCell.Offset(0, 12).Value = CDbl(txt_LPreis.Value)
                Else
                    If cboUMST = ThisWorkbook.Sheets("Daten").Range("B3").Text Then
                        ActiveCell.Offset(0, 7).Value = CDbl(txt_LPreis.Value * CDbl(txt_AnzahlL.Value) / CDbl(zstr)) * 100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                        ActiveCell.Offset(0, 12).Value = CDbl(txt_LPreis.Value) * 100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                    Else
                        ActiveCell.Offset(0, 7).Value = CDbl(txt_LPreis.Value * CDbl(txt_AnzahlL.Value) / CDbl(zstr)) * 100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                        ActiveCell.Offset(0, 12).Value = CDbl(txt_LPreis.Value) * 100 / (CDbl(Format(cboUMST.Value, "#.#0,0") * 100) + 100)
                    End If
                End If
            Else
                If cboUMST = "ohne" Then
                    ActiveCell.Offset(0, 7).Value = (CDbl(txt_LPreis.Value)) * CDbl(txt_AnzahlL.Value)
                    ActiveCell.Offset(0, 12).Value = CDbl(txt_LPreis.Value)
                Else
                    ActiveCell.Offset(0, 7).Value = (CDbl(txt_LPreis.Value)) * CDbl(txt_AnzahlL.Value) / CDbl(zstr)
                    ActiveCell.Offset(0, 12).Value = CDbl(txt_LPreis.Value) / CDbl(zstr)
                End If
            End If
        End If
        ActiveCell.Offset(0, 18).Value = CStr(frmKasse.txt_KDID.Value)
        ActiveCell.Offset(0, 20).Value = Format(Date, "DD.MM.YYYY")
        If Sheets("Daten").Range("B5").Value = "True" Then
            ActiveCell.Offset(0, 21).Value = Sheets("Daten").Range("B24").Value
        End If
        If Not frmKasse.txt_RENr.Value = "" Then
            ActiveCell.Offset(0, 24).Value = frmKasse.txt_RENr.Value
        End If
        If Not frmKasse.txt_LSNr.Value = "" Then
            ActiveCell.Offset(0, 25).Value = frmKasse.txt_LSNr.Value
        End If
        If frmKasse.cboart2 = "Auftrag" Then
            Call frmKasse.RAuftraege
            Call frmKasse.SuchenAuftragV2
            frmKasse.cboAuftragSuchen.Text = strRN
        Else
            Call frmKasse.RAngebote
            Call frmKasse.SuchenAuftragV2
            frmKasse.cbo_Angebot.Text = strRN
        End If
        frmKasse.cmdMengeaendern.Visible = True
        frmKasse.comAStorno.Visible = True
        Call frmKasse.leeren
    End If
    Call frmKasse.ListMakiert
    Call frmKasse.SumKasseV2
    Application.ScreenUpdating = True
    frmKasse.txt_KDID.Value = strKID
    Unload frmLeistung
    Sheets("Center").Activate
End Sub

Private Sub cmdchanel_Click()
    Unload frmLeistung
End Sub

Sub suchenL()
    Dim lngZeile, i As Long
    On Error Resume Next
    lstLeistung.Clear
    lstLeistung.ColumnCount = 3
    lstLeistung.ColumnWidths = "50;80;150;0"
    i = 0
    For lngZeile = 2 To ThisWorkbook.Worksheets("Leistungen").UsedRange.Rows.Count
            lstLeistung.AddItem Sheets("Leistungen").Cells(lngZeile, 2).Value
            lstLeistung.Column(1, i) = Sheets("Leistungen").Cells(lngZeile, 3).Value
            lstLeistung.Column(2, i) = VBA.Replace(CStr(Sheets("Leistungen").Cells(lngZeile, 4)), Chr$(13) & Chr$(10), " ")
            lstLeistung.Column(3, i) = Sheets("Leistungen").Cells(lngZeile, 1).Row
            i = i + 1
    Next lngZeile
End Sub

Private Sub lstLeistung_Click()
    Dim lngZeile As Long
    On Error Resume Next
    lngZeile = lstLeistung.Column(3)
    txt_LID.Value = Sheets("Leistungen").Cells(lngZeile, 1)
    txt_kzel.Value = Sheets("Leistungen").Cells(lngZeile, 2)
    txt_Art.Value = Sheets("Leistungen").Cells(lngZeile, 3)
    txt_Lbezeichnung.Value = Sheets("Leistungen").Cells(lngZeile, 4)
    If Not txt_LPreis.Value = Sheets("Leistungen").Cells(lngZeile, 5) = "" Then
        txt_LPreis.Value = Format(CDbl(Sheets("Leistungen").Cells(lngZeile, 5)), "currency")
    Else
        txt_LPreis.Value = Format("0,00", "currency")
    End If
    If CDbl(Sheets("Leistungen").Cells(lngZeile, 6)) = CDbl("0") Then
        cboUMST = "ohne"
    Else
        cboUMST = CDbl(Sheets("Leistungen").Cells(lngZeile, 6) * 100) & "%"
    End If
    txt_AnzahlL.Value = Sheets("Leistungen").Cells(lngZeile, 7)
    txt_AnzahlL2.Value = Sheets("Leistungen").Cells(lngZeile, 7)
    lbl_Ainfo.Caption = Sheets("Leistungen").Cells(lngZeile, 7) & " / " & Sheets("Leistungen").Cells(lngZeile, 8)
    cbo_aWert = Sheets("Leistungen").Cells(lngZeile, 8)
    If Sheets("Leistungen").Cells(lngZeile, 9) = "N" Then
        op_Netto.Value = True
        op_Brutto.Value = False
    Else
        op_Netto.Value = False
        op_Brutto.Value = True
    End If
    If txt_Lbezeichnung.Value = "" Then
        txt_Lbezeichnung.SetFocus
    Else
        txt_AnzahlL.SetFocus
    End If
End Sub

Private Sub op_Netto_Click()
    If op_Netto.Value = True Then op_Brutto.Value = False
    If op_Brutto.Value = True Then op_Netto.Value = False
End Sub
Attribute VB_Name = "frmLieferanten"
Attribute VB_Base = "0{5C7DFB35-C0F7-42F8-8FF9-29907DF94CCE}{494AA6D7-62B3-4E8B-AB17-6A0D078D55CA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim aRow, i As Long
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    txt_skonto.Value = Format(txt_skonto.Value, "#,##0.0 %")
    cboLNr.Clear
    aRow = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
    cboLNr.AddItem "neuen Lieferanten hinzuf|fffd|gen"
    lbl_infoL.Caption = WorksheetFunction.CountA(Sheets("Lieferanten").Range("A:A")) - 1 & " Lieferanten vorhanden"
    For i = 2 To aRow
        cboLNr.AddItem Sheets("Lieferanten").Cells(i, 1) & ", " & VBA.Replace(CStr(Sheets("Lieferanten").Cells(i, 2)), Chr$(13) & Chr$(10), " ")
    Next i
    cboLNr.ListIndex = 0
    If Not Sheets("Daten").Range("B41").Value = "" Then
        If cboLNr = "neuen Lieferanten hinzuf|fffd|gen" Then
            lbl_LLieferantenNr.Caption = "Letzte vergebene Nr.: " & Sheets("Daten").Range("B41").Value
        Else
            lbl_LLieferantenNr.Caption = ""
        End If
    End If
End Sub

Private Sub cboLNr_Change()
    If cboLNr = "neuen Lieferanten hinzuf|fffd|gen" Then
        cmdLanlegen.Visible = True
        cmdLaendern.Visible = False
        cmdLloeschen.Visible = False
        cmd_LEMail.Visible = False
    Else
        cmdLanlegen.Visible = False
        cmdLaendern.Visible = True
        cmdLloeschen.Visible = True
    End If
End Sub

Private Sub txt_Mzuschl_AfterUpdate()
    If txt_Mzuschl.Value = "" Then Exit Sub
    On Error GoTo weiter
    txt_Mzuschl.Value = Format(CDbl(txt_Mzuschl.Value), "currency")
    Exit Sub
weiter:
    MsgBox "Fehler im Waehrungsformat!", , "Hinweis"
    txt_Mzuschl.Value = ""
End Sub

Private Sub txt_MzuschlB_AfterUpdate()
    If txt_MzuschlB.Value = "" Then Exit Sub
    On Error GoTo weiter
    txt_MzuschlB.Value = Format(CDbl(txt_MzuschlB.Value), "currency")
    Exit Sub
weiter:
    MsgBox "Fehler im Waehrungsformat!", , "Hinweis"
    txt_MzuschlB.Value = ""
End Sub

Private Sub txtcompany_Change()
    If Not txtcompany = "" Then
        lbl_NFirma.Visible = False
    End If
End Sub

Private Sub txtMail_Change()
    If Not cboLNr = "neuen Lieferanten hinzuf|fffd|gen" And Not txtMail.Value = "" Then
        cmd_LEMail.Visible = True
    Else
        cmd_LEMail.Visible = False
    End If
End Sub

Private Sub cmd_Fsuchen_Click()
    Call FSuchen
End Sub

Sub FSuchen()
    Dim lngZeile, i, Alng, xrow As Long
    Dim andoubl As Double
    On Error Resume Next

    If txt_SFirma = "" Then Exit Sub
    andoubl = 0
    For Alng = 2 To ThisWorkbook.Worksheets("Lieferanten").UsedRange.Rows.Count
        If InStr(1, LCase(Sheets("Lieferanten").Cells(Alng, 2).Value), LCase(txt_SFirma.Text)) > 0 Then
            andoubl = andoubl + 1
            i = i + 1
        End If
    Next Alng
    If andoubl >= 1 Then
        list_Liefer.BackColor = &H80000005
        list_Liefer.Clear
        list_Liefer.ColumnCount = 2
        list_Liefer.ColumnWidths = "240;0"
        i = 0
        For lngZeile = 2 To ThisWorkbook.Worksheets("Lieferanten").UsedRange.Rows.Count
            If InStr(1, LCase(Sheets("Lieferanten").Cells(lngZeile, 2).Value), LCase(txt_SFirma.Text)) > 0 Then
                list_Liefer.AddItem Sheets("Lieferanten").Cells(lngZeile, 1).Value & ", " & VBA.Replace(CStr(Sheets("Lieferanten").Cells(lngZeile, 2).Value), Chr$(13) & Chr$(10), " ")
                list_Liefer.Column(1, i) = Sheets("Lieferanten").Cells(lngZeile, 17).Row
                list_Liefer.Column(2, i) = Sheets("Lieferanten").Cells(lngZeile, 1).Text
                i = i + 1
            End If
        Next lngZeile
        list_Liefer.SetFocus
    Else
        list_Liefer.Clear
        list_Liefer.BackColor = &H80000004
        xrow = xFind(ActiveWorkbook.Name, ("Lieferanten"), txt_SFirma.Value, "G:G")
        If xrow = False Then
            MsgBox "Es ist kein Lieferant mit dem Namen (" + txt_SFirma + ") vorhanden!", , "Hinweis"
            txt_SFirma.SetFocus
            Exit Sub
        End If
    End If
End Sub

Private Sub list_Liefer_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    If list_Liefer.ListCount = 0 Then Exit Sub
    cboLNr = list_Liefer.List(list_Liefer.ListIndex, 0)
    txt_SFirma.Value = ""
End Sub

Private Sub cmd_LEMail_Click()
    If txtMail.Value = "" Then Exit Sub
    frmEmail.txt_AN.Value = frmLieferanten.txtMail.Value
    frmEmail.Show
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Schlie|fffd|en"" beenden!", , "Hinweis"
        ComExit.SetFocus
        Cancel = True
    End If
End Sub

Private Sub cmdLaendern_Click()
    Dim xzeile As Long
    On Error Resume Next
    
    If txtLNr.Value = "" Then Exit Sub
    txt_skonto.Value = Format(CDbl(txt_skonto.Value / 100), "#,##0.0 %")
    txtLieferrabatt.Value = Format(CDbl(txtLieferrabatt.Value / 100), "#,##0.0 %")
    With Worksheets("Lieferanten")
        If .FilterMode Then .ShowAllData
    End With
    If cboLNr.ListIndex = 0 Then
        xzeile = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row + 1
    Else
        xzeile = cboLNr.ListIndex + 1
    End If
    If Not IsNumeric(txtLNr) Then
        Sheets("Lieferanten").Cells(xzeile, 1) = txtLNr.Value
    Else
        Sheets("Lieferanten").Cells(xzeile, 1) = "'" & txtLNr.Text
    End If
    Sheets("Lieferanten").Cells(xzeile, 2) = txtcompany.Value
    Sheets("Lieferanten").Cells(xzeile, 3) = txtadress.Value
    Sheets("Lieferanten").Cells(xzeile, 4) = "'" & txtPLZ.Value
    Sheets("Lieferanten").Cells(xzeile, 5) = txtstaff.Value
    Sheets("Lieferanten").Cells(xzeile, 6) = "'" & txtIBAN.Value
    Sheets("Lieferanten").Cells(xzeile, 7) = txtsteuerNr.Value
    Sheets("Lieferanten").Cells(xzeile, 8) = "'" & txtphone.Value
    Sheets("Lieferanten").Cells(xzeile, 9) = "'" & txtphone2.Value
    Sheets("Lieferanten").Cells(xzeile, 10) = "'" & txtMobil.Value
    Sheets("Lieferanten").Cells(xzeile, 11) = "'" & txtfax.Value
    Sheets("Lieferanten").Cells(xzeile, 12) = txtMail.Value
    Sheets("Lieferanten").Cells(xzeile, 13) = txtHomepage.Value
    Sheets("Lieferanten").Cells(xzeile, 14) = txt_skonto.Value
    Sheets("Lieferanten").Cells(xzeile, 15) = txtBLZ.Value
    Sheets("Lieferanten").Cells(xzeile, 16) = "'" & txtKontoNr.Value
    Sheets("Lieferanten").Cells(xzeile, 17) = txtBank.Value
    Sheets("Lieferanten").Cells(xzeile, 18) = txtlieferzeit.Value
    Sheets("Lieferanten").Cells(xzeile, 19) = txtLieferrabatt.Value
    Sheets("Lieferanten").Cells(xzeile, 20) = txtSWIFT.Value
    Sheets("Lieferanten").Cells(xzeile, 21) = Format(txtVersand.Value, "currency")
    Sheets("Lieferanten").Cells(xzeile, 22) = Format(txtVFrei.Value, "currency")
    Sheets("Lieferanten").Cells(xzeile, 23) = txt_TageNetto.Value
    Sheets("Lieferanten").Cells(xzeile, 24) = txt_EigeneLNr.Value
    Sheets("Lieferanten").Cells(xzeile, 25) = txt_LZusatzfeld.Value
    Sheets("Lieferanten").Cells(xzeile, 26) = txt_TageSk.Value
    Sheets("Lieferanten").Cells(xzeile, 27) = txt_Mzuschl.Value
    Sheets("Lieferanten").Cells(xzeile, 28) = txt_MzuschlB.Value
    MsgBox "Lieferant " & txtcompany.Value & " wurde ge|fffd|ndert!", vbOKOnly, "Lieferant"
End Sub

Private Sub cmdLanlegen_Click()
    Dim lng, i, lngZeile As Long
    Dim Treffer As Range
    On Error Resume Next
    
    If txtLNr.Value = "" Then Exit Sub
    If txtLNr.Value = txtLNr2.Text Then
        MsgBox "Bitte vergeben Sie eine andere Lieferantennummer!", vbOKOnly, "Hinweis"
        txtLNr.SetFocus
        Exit Sub
    End If
    Set Treffer = Sheets("Lieferanten").Columns(1).Find(what:=txtLNr.Value, LookAt:=xlWhole, MatchCase:=True)
    Rem wenn Lieferant schon vorhanden ist
    If Treffer Is Nothing Then
        lng = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
    Else
        i = MsgBox("Der Lieferant " + (frmLieferanten.txtLNr.Value) + " wurde bereits erfasst!", vbOKOnly + vbCritical, "Lieferant")
        If i = vbOK Then
            txtLNr.Value = ""
            txtLNr.SetFocus
            Exit Sub
        End If
    End If
    Application.ScreenUpdating = False
    txt_skonto.Value = Format(CDbl(txt_skonto.Value / 100), "#,##0.0 %")
    txtLieferrabatt.Value = Format(CDbl(txtLieferrabatt.Value / 100), "#,##0.0 %")
    With Worksheets("Lieferanten")
        If .FilterMode Then .ShowAllData
    End With
    lngZeile = Worksheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Lieferanten").Activate
    lngZeile = lngZeile + 1
    If Not IsNumeric(txtLNr) Then
        Worksheets("Lieferanten").Cells(lngZeile, 1).Value = txtLNr.Value
    Else
        Worksheets("Lieferanten").Cells(lngZeile, 1).Value = "'" & txtLNr.Text
    End If
    Worksheets("Lieferanten").Cells(lngZeile, 2).Value = txtcompany
    Worksheets("Lieferanten").Cells(lngZeile, 3).Value = txtadress
    Worksheets("Lieferanten").Cells(lngZeile, 4) = "'" & txtPLZ
    Worksheets("Lieferanten").Cells(lngZeile, 5) = txtstaff
    Worksheets("Lieferanten").Cells(lngZeile, 6) = "'" & txtIBAN
    Worksheets("Lieferanten").Cells(lngZeile, 7) = txtsteuerNr
    Worksheets("Lieferanten").Cells(lngZeile, 8) = "'" & txtphone
    Worksheets("Lieferanten").Cells(lngZeile, 9) = "'" & txtphone2
    Worksheets("Lieferanten").Cells(lngZeile, 10) = "'" & txtMobil
    Worksheets("Lieferanten").Cells(lngZeile, 11) = "'" & txtfax
    Worksheets("Lieferanten").Cells(lngZeile, 12) = txtMail
    Worksheets("Lieferanten").Cells(lngZeile, 13) = txtHomepage
    Worksheets("Lieferanten").Cells(lngZeile, 14) = txt_skonto.Value
    Worksheets("Lieferanten").Cells(lngZeile, 15) = txtBLZ.Value
    Worksheets("Lieferanten").Cells(lngZeile, 16) = "'" & txtKontoNr.Value
    Worksheets("Lieferanten").Cells(lngZeile, 17) = txtBank
    Worksheets("Lieferanten").Cells(lngZeile, 18) = txtlieferzeit.Value
    Worksheets("Lieferanten").Cells(lngZeile, 19) = txtLieferrabatt.Value
    Worksheets("Lieferanten").Cells(lngZeile, 20) = txtSWIFT
    Worksheets("Lieferanten").Cells(lngZeile, 21) = Format(CDbl(txtVersand.Value), "currency")
    Worksheets("Lieferanten").Cells(lngZeile, 22) = Format(CDbl(txtVFrei.Value), "currency")
    Worksheets("Lieferanten").Cells(lngZeile, 23) = txt_TageNetto.Value
    Worksheets("Lieferanten").Cells(lngZeile, 24) = txt_EigeneLNr.Value
    Worksheets("Lieferanten").Cells(lngZeile, 25) = txt_LZusatzfeld.Value
    Worksheets("Lieferanten").Cells(lngZeile, 26) = txt_TageSk.Value
    Worksheets("Lieferanten").Cells(lngZeile, 27) = txt_Mzuschl.Value
    Worksheets("Lieferanten").Cells(lngZeile, 28) = txt_MzuschlB.Value
    Worksheets("Daten").Range("B41").Value = "'" & txtLNr.Value
    Sheets("Center").Activate
    UserForm_Initialize
    MsgBox "Lieferant wurde angelegt!", vbOKOnly, "Lieferant"
    If txt_Art.Value = "Bestellung" Then
        Call frmBestellung.LieferCombo
    Else
        Call comboboxfuellen
    End If
    Set Treffer = Nothing
    Application.ScreenUpdating = True
End Sub

Private Sub txtVersand_AfterUpdate()
    If txtVersand.Value = "" Then Exit Sub
    On Error GoTo weiter
    txtVersand.Value = Format(CDbl(txtVersand.Value), "currency")
    Exit Sub
weiter:
    MsgBox "Fehler im Waehrungsformat!", , "Hinweis"
    txtVersand.Value = ""
End Sub

Private Sub txtVFrei_AfterUpdate()
    If txtVFrei.Value = "" Then Exit Sub
    On Error GoTo weiter
    txtVFrei.Value = Format(CDbl(txtVFrei.Value), "currency")
    Exit Sub
weiter:
    MsgBox "Fehler im Waehrungsformat!", , "Hinweis"
    txtVFrei.Value = ""
End Sub

Sub Lffrm()
    Dim xrow As Long
    On Error Resume Next
    With frmLieferanten
        xrow = xFind(ActiveWorkbook.Name, "Lieferanten", .txtcompany.Value, "B:B")
        frmLieferanten.cboLNr = Sheets("Lieferanten").Cells(xrow, 1)
        .txtadress.Value = Sheets("Lieferanten").Cells(xrow, 3)
        .txtPLZ.Value = Sheets("Lieferanten").Cells(xrow, 4)
        .txtstaff.Value = Sheets("Lieferanten").Cells(xrow, 5)
        .TextBox5.Value = Sheets("Lieferanten").Cells(xrow, 7)
        .txtphone.Value = Sheets("Lieferanten").Cells(xrow, 8)
        .txtfax.Value = Sheets("Lieferanten").Cells(xrow, 10)
        .txtMobil.Value = Sheets("Lieferanten").Cells(xrow, 9)
        .txtMail.Value = Sheets("Lieferanten").Cells(xrow, 11)
        .txtHomepage.Value = Sheets("Lieferanten").Cells(xrow, 12)
        .txtBLZ.Value = Sheets("Lieferanten").Cells(xrow, 14)
        .txtKontoNr.Value = Sheets("Lieferanten").Cells(xrow, 15)
        .txt_skonto.Value = Sheets("Lieferanten").Cells(xrow, 13)
        .txtBank.Value = Sheets("Lieferanten").Cells(xrow, 16)
        .txtlieferzeit.Value = Sheets("Lieferanten").Cells(xrow, 17)
    End With
End Sub

Private Sub cmdLloeschen_Click()
    Dim i As Long
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If txtLNr.Value = "" Then
        MsgBox "Bitte w|fffd|hlen Sie einen Lieferanten aus!", vbOKOnly, "Hinweis"
        Exit Sub
    End If
    i = MsgBox("Lieferant " + cboLNr.Value + " wirklich l|fffd|schen?", vbYesNo + vbQuestion, "Info")
    If i = vbYes Then
        If cboLNr.ListIndex > 0 Then
            Sheets("Lieferanten").Rows(cboLNr.ListIndex + 1).Delete
            txtcompany.Value = ""
            txtadress.Value = ""
            txtPLZ.Value = ""
            UserForm_Initialize
        End If
    End If
End Sub

Private Sub cboLNr_click()
    On Error Resume Next
    If cboLNr.ListIndex <> 0 Then
        txtLNr.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 1)
        txtLNr2.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 1)
        txtcompany.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 2)
        txtadress.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 3)
        txtPLZ.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 4)
        txtstaff.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 5)
        txtphone.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 8)
        txtphone2.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 9)
        txtMobil.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 10)
        txtfax.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 11)
        txtMail.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 12)
        txtHomepage.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 13)
        txtBLZ.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 15)
        txtKontoNr.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 16)
        txtBank.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 17)
        txtIBAN.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 6)
        txt_skonto.Value = Format(Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 14).Value, "#,#0.0 %")
        txtlieferzeit.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 18)
        txtLieferrabatt.Value = Format(Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 19).Value, "#,#0.0 %")
        txtSWIFT.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 20)
        txtsteuerNr.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 7)
        If Not Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 21) = "" Then
            txtVersand.Value = Format(Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 21), "currency")
        End If
        If Not Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 22) = "" Then
            txtVFrei.Value = Format(Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 22), "currency")
        End If
        txt_TageNetto = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 23)
        txt_EigeneLNr.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 24)
        txt_LZusatzfeld.Value = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 25)
        txt_TageSk = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 26)
        txt_Mzuschl = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 27)
        txt_MzuschlB = Sheets("Lieferanten").Cells(cboLNr.ListIndex + 1, 28)
    Else
        txtLNr.Value = ""
        txtcompany.Value = ""
        txtadress.Value = ""
        txtPLZ.Value = ""
        txtstaff.Value = ""
        txtphone.Value = ""
        txtphone2.Value = ""
        txtfax.Value = ""
        txtMobil.Value = ""
        txtMail.Value = ""
        txtHomepage.Value = ""
        txtBLZ.Value = ""
        txtKontoNr.Value = ""
        txtBank.Value = ""
        txtIBAN.Value = ""
        txt_skonto.Value = ""
        txtsteuerNr.Value = ""
        txtlieferzeit.Value = ""
        txtLieferrabatt.Value = ""
        txtSWIFT.Value = ""
        txtVersand.Value = ""
        txtVFrei.Value = ""
        txt_EigeneLNr.Value = ""
        txt_LZusatzfeld.Value = ""
        txt_TageNetto.Value = ""
        txt_TageSk.Value = ""
        listLierfant.Clear
    End If
    Call WELieferant
End Sub

Private Sub ComExit_Click()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    Application.ScreenUpdating = False
    If txtVerweisArtikel.Value = 1 Then
        frmArtikel.cboLieferant.Clear
        ALetzte = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not IsEmpty(Sheets("Lieferanten").Cells(irow, 2)) Then
                xKey = Sheets("Lieferanten").Cells(irow, 2).Value
                DIC(xKey) = 0
            End If
        Next
        For Each xKey In DIC
            frmArtikel.cboLieferant.AddItem xKey
        Next
            DIC.RemoveAll
        Set DIC = Nothing
        frmArtikel.cboLieferant.ListIndex = -1
        Sheets("center").Activate
    End If
    Application.ScreenUpdating = True
    Unload frmLieferanten
End Sub

Private Sub txtHomepage_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    If txtHomepage.Value = "" Then
        txtHomepage.Value = "Keine Webseite vorhanden"
    Else
        Open_URL (txtHomepage.Value)
    End If
End Sub

Private Sub txtMail_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    If InStr(txtMail.Value, "@") > 0 Then
        ActiveWorkbook.FollowHyperlink "mailto:" & txtMail
    End If
End Sub

Sub comboboxfuellen()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    Application.ScreenUpdating = False
    With frmArtikel
        .cboLieferant.Clear
        .txtLNr.Value = ""
        If .cboLieferant.ListIndex = -1 Then .cboLieferant = "kein Lieferant vorhanden"
        ALetzte = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not IsEmpty(Sheets("Lieferanten").Cells(irow, 2)) Then
                xKey = Sheets("Lieferanten").Cells(irow, 2).Value
                DIC(xKey) = 0
            End If
        Next
        For Each xKey In DIC
            .cboLieferant.AddItem xKey
        Next
        DIC.RemoveAll
        .cboLieferant.ListIndex = -1
        Set DIC = Nothing
    End With
    Application.ScreenUpdating = True
End Sub

Sub WELieferant() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n, n2 As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next
    If txtLNr.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    BoxListe = "Wareneingang"
    SuchKriterium = LCase(txtcompany.Text)
    listLierfant.Clear
    With ThisWorkbook.Sheets(BoxListe)
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A2:Z" & Last_Row)
       ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
       For i = 1 To UBound(arrTmpA)
           If LCase(arrTmpA(i, 2)) Like SuchKriterium Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 8)
               arrTmpB(2, n) = arrTmpA(i, 3)
               arrTmpB(3, n) = arrTmpA(i, 5)
               arrTmpB(4, n) = arrTmpA(i, 6)
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 4)
            For i = 1 To 4
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With listLierfant
               .ColumnCount = 4
               .ColumnWidths = "60;80;280;50;0;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmMitarbeiter"
Attribute VB_Base = "0{E5CB1710-491E-4F35-911F-337564BD5377}{5C24CE10-CECF-4EA7-A49D-F0EB467BC94A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim aRow, lng As Long
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    If Not Sheets("Daten").Range("D46").Value = "" Then
        lbl_Date.Caption = "(" & Sheets("Daten").Range("D46").Value & ")"
    Else
        lbl_Date.Caption = "(DD.MM.YYYY)"
    End If
    Check_Pprint.Value = True
    If Worksheets("Daten").Range("B37") = "AN" Then
        Check_Herstell.Value = False
        Check_Eigene.Value = True
    Else
        Check_Eigene.Value = False
        Check_Herstell.Value = True
    End If
    If Not Sheets("Daten").Range("B22").Value = "" Then
        comMitarbeiter.Visible = False
        txt_Gast.Value = Sheets("Daten").Range("B22").Value
        txt_Gast.Visible = True
    Else
        With Worksheets("Mitarbeiter")
            aRow = Sheets("Mitarbeiter").Cells(Rows.Count, 2).End(xlUp).Row
            For lng = 2 To aRow
                comMitarbeiter.AddItem Sheets("Mitarbeiter").Cells(lng, 2) & ", " & Sheets("Mitarbeiter").Cells(lng, 3)
            Next lng
        End With
        If Not Sheets("Daten").Range("B24").Value = "" Then
            comMitarbeiter = Sheets("Daten").Range("B24").Value
        End If
    End If
End Sub

Sub Staff()
    Dim stxt As String
    Dim lng As Long
    lng = frmMitarbeiter.comMitarbeiter.ListIndex + 2
    If comMitarbeiter = "" And Sheets("Daten").Range("B22").Value = "" Then
         stxt = MsgBox("Soll ohne Mitarbeiter gedruckt werden?", vbYesNo, "Hinweis")
         If stxt = vbYes Then
             Range("Druckvorlage!C11") = ""
             Range("Druckvorlage!C12") = ""
             Range("Druckvorlage!C13") = ""
             Range("Druckvorlage!C14") = ""
         Else
             comMitarbeiter.SetFocus
             Exit Sub
         End If
     Else
         If Not Worksheets("Mitarbeiter").Cells(lng, 7).Value = "" Then
             Range("Druckvorlage!C11") = Worksheets("Mitarbeiter").Cells(lng, 1).Value & " " & Worksheets("Mitarbeiter").Cells(lng, 2).Value & " / " & Worksheets("Mitarbeiter").Cells(lng, 7).Value
         Else
             Range("Druckvorlage!C11") = Worksheets("Mitarbeiter").Cells(lng, 1).Value & " " & Worksheets("Mitarbeiter").Cells(lng, 2).Value
         End If
         Range("Druckvorlage!C12") = "'" & Worksheets("Mitarbeiter").Cells(lng, 5).Value
         Range("Druckvorlage!C13") = Worksheets("Mitarbeiter").Cells(lng, 6).Value
         Range("Druckvorlage!C14") = Worksheets("Mitarbeiter").Cells(lng, 4).Value
     End If
End Sub

Private Sub Check_Eigene_Click()
    If Check_Eigene.Value = True Then
        Check_Herstell.Value = False
    Else
        If Check_Herstell.Value = False Then
            Check_Eigene.Value = True
        End If
    End If
    Worksheets("Daten").Range("B37") = "AN"
End Sub

Private Sub Check_Herstell_Click()
    If Check_Herstell.Value = True Then
        Check_Eigene.Value = False
    Else
        If Check_Eigene.Value = False Then
            Check_Herstell.Value = True
        End If
    End If
    Worksheets("Daten").Range("B37") = "HN"
End Sub

Private Sub comDrucken_Click()
    If txt_Verleih.Value = "verleih" Then
        Call Verleih
    ElseIf txt_Verleih.Value = "zustand" Then
        Call VerleihZustand
    Else
        Call Drucken
    End If
End Sub

Sub Drucken() '1.44
    Dim intLeerPos, zeLB, zeTB, spLB, lng, Farbe, Pos, lngLID, Last_Row, lngEinheit As Long
    Dim pdfName, pdfDatei, strMenge, strEinheit, strEinheit2, FDate As String
    Dim Kopien As Variant
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    Call Staff
    Application.ScreenUpdating = False
    If frmBestellung.txt_OpBestellung.Value = "PDF" Then
        pdfDatei = frmBestellung.txtBestellNR.Text
        pdfName = Application.GetSaveAsFilename(Environ("USERPROFILE") & "\Desktop\" & pdfDatei & ".pdf", "PDF-Dateien (*.pdf), *.pdf")
    End If
    Sheets("Druckvorlage").Activate
    Last_Row = CDbl(Sheets("Druckvorlage").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Druckvorlage").Rows("17:" & Last_Row).Delete
    Range("Druckvorlage!A17:F150").Font.Size = 9
    Range("Druckvorlage!E11") = "Bestellung"
    Range("Druckvorlage!D2") = "Bestellung:"
    Range("Druckvorlage!D3") = "Lieferdatum:"
    Range("Druckvorlage!D5") = "Lieferanten-Nr.:"
    Range("Druckvorlage!D6") = "Meine Kunden Nr.:"
    Range("Druckvorlage!A2") = ""
    Range("Druckvorlage!A3") = ""
    Range("Druckvorlage!D6") = ""
    Range("Druckvorlage!E6") = ""
    Range("Druckvorlage!E7") = ""
    Range("Druckvorlage!F14") = ""
    Range("Druckvorlage!E16") = "Preis"
    Range("Druckvorlage!F16") = "Betrag"
    Range("Druckvorlage!E2") = "'" & frmBestellung.txtBestellNR.Text
    Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & Sheets("Daten").Range("B26").Value
    If Not txt_Lieferdatum.Value = "" Then
        Range("Druckvorlage!E3") = "'" & txt_Lieferdatum
    Else
        Range("Druckvorlage!E3") = ""
    End If
    Range("Druckvorlage!E4") = Format(Date, FDate)
    Worksheets("Druckvorlage").PageSetup.RightFooter = "&8" & "Seite &P von &N"
    zeTB = 17
    Pos = 1
    If Not frmBestellung.cboLieferant = "" Or Not frmBestellung.cboLieferant = "Keine Auswahl" Then
        lngLID = Worksheets("Lieferanten").Cells((Worksheets("Lieferanten").Range("A:A").Find(CStr(frmBestellung.txt_LNr), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
        Sheets("Druckvorlage").Range("A4") = VBA.Replace(CStr(Worksheets("Lieferanten").Cells(CDbl(lngLID), 2).Text), Chr$(13) & Chr$(10), " ")
        Sheets("Druckvorlage").Range("A4").WrapText = False
        Sheets("Druckvorlage").Range("A5") = Worksheets("Lieferanten").Cells(CDbl(lngLID), 3).Text
        Sheets("Druckvorlage").Range("A6") = "'" & Worksheets("Lieferanten").Cells(CDbl(lngLID), 4).Text
        Sheets("Druckvorlage").Range("E5") = "'" & Worksheets("Lieferanten").Cells(CDbl(lngLID), 1).Text
        Sheets("Druckvorlage").Range("E6") = "'" & Worksheets("Lieferanten").Cells(CDbl(lngLID), 24).Text
        Sheets("Druckvorlage").Range("E7") = CStr(Worksheets("Lieferanten").Cells(CDbl(lngLID), 12))
    Else
        Sheets("Druckvorlage").Range("A2") = ""
        Sheets("Druckvorlage").Range("A3") = ""
        Sheets("Druckvorlage").Range("A4") = ""
        Sheets("Druckvorlage").Range("A5") = ""
        Sheets("Druckvorlage").Range("A6") = ""
        Sheets("Druckvorlage").Range("E5") = ""
        Sheets("Druckvorlage").Range("E7") = ""
    End If
    lngEinheit = 0
    For zeLB = 0 To frmBestellung.lstBestellung.ListCount - 1
        If Not frmBestellung.lstBestellung.List(zeLB, 5) = "-" Then
            strEinheit2 = CStr(Mid(frmBestellung.lstBestellung.List(zeLB, 3), InStr(frmBestellung.lstBestellung.List(zeLB, 3), " ") + 1))
            If StrComp(strEinheit, strEinheit2) <> 0 Then
                strEinheit = CStr(strEinheit2)
                lngEinheit = lngEinheit + 1
            End If
        End If
        Sheets("Druckvorlage").Cells(zeTB, 1) = Pos
        Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
        Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
        Sheets("Druckvorlage").Cells(zeTB, 1).NumberFormat = "@"
        If Check_Herstell.Value = True Then
            Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmBestellung.lstBestellung.List(zeLB, 1)
            Sheets("Druckvorlage").Cells(zeTB, 3) = frmBestellung.lstBestellung.List(zeLB, 2)
        Else
            Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmBestellung.lstBestellung.List(zeLB, 0)
            If Not frmBestellung.lstBestellung.List(zeLB, 1) = "" Then
                Sheets("Druckvorlage").Cells(zeTB, 3) = frmBestellung.lstBestellung.List(zeLB, 2) & " (" & frmBestellung.lstBestellung.List(zeLB, 1) & ")"
            Else
                Sheets("Druckvorlage").Cells(zeTB, 3) = frmBestellung.lstBestellung.List(zeLB, 2)
            End If
        End If
        Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
        Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
        Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
        Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
        Sheets("Druckvorlage").Cells(zeTB, 4) = frmBestellung.lstBestellung.List(zeLB, 3)
        Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
        Sheets("Druckvorlage").Cells(zeTB, 4).NumberFormat = "@"
        If Check_Pprint.Value = False Then
            If Not frmBestellung.lstBestellung.List(zeLB, 5) = "-" Then
                Sheets("Druckvorlage").Cells(zeTB, 5) = Format(CDbl(frmBestellung.lstBestellung.List(zeLB, 5)), "currency")
                Sheets("Druckvorlage").Cells(zeTB, 5).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 5).VerticalAlignment = xlTop
                intLeerPos = InStr(frmBestellung.lstBestellung.List(zeLB, 3) & " ", " ")
                strMenge = Left(frmBestellung.lstBestellung.List(zeLB, 3), intLeerPos - 1)
                Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl(frmBestellung.lstBestellung.List(zeLB, 5)) * CDbl(strMenge), "currency")
                Sheets("Druckvorlage").Cells(zeTB, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 6).VerticalAlignment = xlTop
            End If
        End If
        zeTB = zeTB + 1
        Pos = Pos + 1
    Next zeLB
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To CDbl(Pos) - 1
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    Sheets("Druckvorlage").Cells(zeTB + 2, 3) = "Gesamt:"
    Sheets("Druckvorlage").Cells(zeTB + 2, 3).HorizontalAlignment = xlRight
    If lngEinheit = 1 Then
        Sheets("Druckvorlage").Cells(zeTB + 2, 4) = CDbl(frmBestellung.txtBMsum.Value) & " " & strEinheit
    Else
        Sheets("Druckvorlage").Cells(zeTB + 2, 4) = CDbl(frmBestellung.txtBMsum.Value)
    End If
    Sheets("Druckvorlage").Cells(zeTB + 2, 4).HorizontalAlignment = xlRight
    If Check_Pprint.Value = False Then
        Sheets("Druckvorlage").Cells(zeTB + 2, 6) = Format(Format(frmBestellung.txtBsum.Value, "#.##"), "currency")
        Sheets("Druckvorlage").Cells(zeTB + 2, 6).HorizontalAlignment = xlRight
    End If
    Sheets("Druckvorlage").Cells(zeTB + 4, 1) = Sheets("Daten").Range("B25").Value
    Sheets("Druckvorlage").Cells(zeTB + 6, 1) = "Mit freundlichem Gru|fffd|"
    Sheets("Druckvorlage").Cells(zeTB + 6, 1).Font.Size = 11
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Sheets("Druckvorlage").Cells(zeTB + 9, 1) = "'" & Sheets("Daten").Range("B22").Value
        Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
        Range("Druckvorlage!C11") = Sheets("Daten").Range("D22").Value
    Else
        If frmMitarbeiter.comMitarbeiter = "" Then
            Sheets("Druckvorlage").Cells(zeTB + 9, 1) = Worksheets("Daten").Range("B9")
            Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
        Else
            Sheets("Druckvorlage").Cells(zeTB + 9, 1) = frmMitarbeiter.comMitarbeiter.Text
            Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
        End If
    End If
    If frmBestellung.txt_OpBestellung.Value = "PDF" Then
        pdfDatei = frmBestellung.txtBestellNR.Text
        Sheets("Druckvorlage").ExportAsFixedFormat Type:=xlTypePDF, Filename:=pdfName, _
            Quality:=xlQualityStandard, IncludeDocProperties:=False, IgnorePrintAreas:=False, _
            OpenAfterPublish:=True
    Else
        Kopien = Application.InputBox("Anzahl Kopien", "Bestellung drucken", 1)
        If Kopien = False Then Exit Sub
        Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
    End If
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    frmBestellung.txt_OpBestellung.Value = ""
    Unload frmMitarbeiter
End Sub

Private Sub cmdchanel_Click()
    Unload frmMitarbeiter
    If Not frmBestellung.txt_OpBestellung.Value = "PDF" Then
        frmBestellung.lbl_status.BackColor = &HC0&
        frmBestellung.lbl_status.BorderColor = &HC0&
        frmBestellung.lbl_status.Caption = "Ausdruck wurde abgebrochen!"
        Application.Wait (Now + TimeValue("00:00:02"))
        frmBestellung.lbl_status.Visible = False
    Else
        frmBestellung.lbl_status.BackColor = &HC0&
        frmBestellung.lbl_status.BorderColor = &HC0&
        frmBestellung.lbl_status.Caption = "Speicher als PDF wurde abgebrochen!"
        Application.Wait (Now + TimeValue("00:00:02"))
        frmBestellung.lbl_status.Visible = False
    End If
End Sub

Sub Fusszeile()
    Dim lngID As Long
    On Error Resume Next
    lngID = Worksheets("Kunden").Range("A:A").Find(CStr(frmVInfo.txt_KID), LookIn:=xlValues, MatchCase:=True).Row
    If Worksheets("Kunden").Cells(CDbl(lngID), 29) = "" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & Sheets("Daten").Range("B26").Value
    ElseIf Worksheets("Kunden").Cells(CDbl(lngID), 29) = "benf" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & Worksheets("Kunden").Cells(CDbl(lngID), 33)
    ElseIf Worksheets("Kunden").Cells(CDbl(lngID), 29) = "ja" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Worksheets("Kunden").Cells(CDbl(lngID), 33)
    ElseIf Worksheets("Kunden").Cells(CDbl(lngID), 29) = "Sofort" Then
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & "Preisangabe: netto, zzgl. der zum Zeitpunkt der Lieferung g|fffd|ltigen Mehrwertsteuer." & vbLf & vbLf & Worksheets("Kunden").Cells(CDbl(lngID), 33)
        Worksheets("Druckvorlage").PageSetup.CenterFooter = "&8" & Sheets("Daten").Range("B26").Value
    End If
End Sub

Sub Verleih()
    Dim l, zeLB, zeTB, spLB, Farbe, Pos, lngW, azeile, lngKID As Long
    Dim FDate As String
    Dim Kopien As Variant
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    If frmVInfo.lst_VerleihI.ListCount = 0 Then Exit Sub
    Call Staff
    Application.ScreenUpdating = False
    Sheets("Druckvorlage").Activate
    Sheets("Druckvorlage").Visible = True
    Range("Druckvorlage!A17:F400").Delete
    Range("Druckvorlage!A17:F150").Font.Size = 9
    lngKID = Worksheets("Kunden").Range("A:A").Find(CStr(frmVInfo.txt_KID), LookIn:=xlValues, MatchCase:=True).Row
    Range("Druckvorlage!A3") = Sheets("Kunden").Cells(CDbl(lngKID), 4)
    Range("Druckvorlage!A4") = Sheets("Kunden").Cells(CDbl(lngKID), 6) & " " & Sheets("Kunden").Cells(CDbl(lngKID), 7)
    Range("Druckvorlage!A5") = frmVInfo.txt_KDAdress.Value
    Range("Druckvorlage!A6") = frmVInfo.txt_KDPLZ & " " & frmVInfo.txt_KDOrt
    Range("Druckvorlage!D2") = "Verleihnummer:"
    Range("Druckvorlage!E2") = "'" & frmVInfo.txt_VNr.Value
    Range("Druckvorlage!E16") = ""
    Range("Druckvorlage!A2") = ""
    Range("Druckvorlage!F16") = ""
    Range("Druckvorlage!D3") = ""
    Range("Druckvorlage!E3") = ""
    Range("Druckvorlage!E11") = "Verleih"
    Range("Druckvorlage!D5") = "Kundennummer:"
    Range("Druckvorlage!D6") = ""
    Range("Druckvorlage!E4") = Format(Date, FDate)
    Range("Druckvorlage!E5") = "'" & Sheets("Kunden").Cells(CDbl(lngKID), 3)
    Range("Druckvorlage!E6") = ""
    Worksheets("Druckvorlage").PageSetup.RightFooter = "&8" & "Seite &P von &N"
    zeTB = 17
    Pos = 1
    lngW = 0
    azeile = 0
    With frmVInfo.lst_VerleihI
        For zeLB = 0 To .ListCount - 1
            If .Selected(zeLB) Then
                Sheets("Druckvorlage").Cells(zeTB, 1) = Pos
                Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 1).NumberFormat = "@"
                Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmVInfo.lst_VerleihI.List(zeLB, 0)
                Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 3) = frmVInfo.lst_VerleihI.List(zeLB, 1)
                Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 4) = frmVInfo.lst_VerleihI.List(zeLB, 5) 'Menge
                Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 4).NumberFormat = "@"
                zeTB = zeTB + 1
                Pos = Pos + 1
            End If
        Next
    End With
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To CDbl(Pos) - 1
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    Sheets("Druckvorlage").Cells(zeTB + 2, 1) = "Datum"
    Sheets("Druckvorlage").Cells(zeTB + 2, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeTB + 4, 1) = ". . . . . . . . . . . . . . . . . ."
    Sheets("Druckvorlage").Cells(zeTB + 5, 1) = "Ware erhalten / in Empfang genommen"
    Sheets("Druckvorlage").Cells(zeTB + 5, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeTB + 8, 1) = ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
    Sheets("Druckvorlage").Cells(zeTB + 9, 1) = "Mit freundlichem Gru|fffd|"
    Sheets("Druckvorlage").Cells(zeTB + 9, 1).Font.Size = 11
    If Not Sheets("Daten").Range("B22").Value = "" Then
        Sheets("Druckvorlage").Cells(zeTB + 12, 1) = "'" & Sheets("Daten").Range("B22").Value
        Sheets("Druckvorlage").Cells(zeTB + 12, 1).Font.Size = 11
        Range("Druckvorlage!C11") = Sheets("Daten").Range("D22").Value
    Else
        If frmMitarbeiter.comMitarbeiter = "" Then
            Sheets("Druckvorlage").Cells(zeTB + 12, 1) = Worksheets("Daten").Range("B9")
            Sheets("Druckvorlage").Cells(zeTB + 12, 1).Font.Size = 11
        Else
            Sheets("Druckvorlage").Cells(zeTB + 12, 1) = frmMitarbeiter.comMitarbeiter.Text
            Sheets("Druckvorlage").Cells(zeTB + 12, 1).Font.Size = 11
        End If
    End If
    Kopien = Application.InputBox("Anzahl Kopien", "Beleg drucken", 1)
    If Kopien = False Then
        Application.ScreenUpdating = True
        Exit Sub
    End If
    Call Fusszeile
    Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    MsgBox "Beleg wurde gedruckt!", , "Hinweis"
    Unload frmMitarbeiter
End Sub

Sub VerleihZustand()
    Dim zeLB, zeTB, spLB, Farbe, Pos, azeile, lngKID As Long
    Dim nSelCount, l, lngCount As Long
    Dim Kopien As Variant
    Dim FDate As String
    On Error Resume Next
    If Not Sheets("Daten").Range("D46") = "" Then
        FDate = Sheets("Daten").Range("D46")
    Else
        FDate = "DD.MM.YYYY"
    End If
    If frmVInfo.lst_VerleihI.ListCount = 0 Then Exit Sub
    Call Staff
    Application.ScreenUpdating = False
    lngCount = frmVInfo.lst_VerleihI.ListCount
    With frmVInfo.lst_VerleihI
        For l = 0 To .ListCount - 1
          If .Selected(l) Then
            nSelCount = nSelCount + 1
          End If
        Next
    End With
    Sheets("Druckvorlage").Activate
    Sheets("Druckvorlage").Visible = True
    Range("Druckvorlage!A17:F400").Delete
    Range("Druckvorlage!A17:F150").Font.Size = 9
    lngKID = Worksheets("Kunden").Range("A:A").Find(CStr(frmVInfo.txt_KID), LookIn:=xlValues, MatchCase:=True).Row
    Range("Druckvorlage!A3") = Sheets("Kunden").Cells(CDbl(lngKID), 4)
    Range("Druckvorlage!A4") = Sheets("Kunden").Cells(CDbl(lngKID), 6) & " " & Sheets("Kunden").Cells(CDbl(lngKID), 7)
    Range("Druckvorlage!A5") = frmVInfo.txt_KDAdress.Value
    Range("Druckvorlage!A6") = frmVInfo.txt_KDPLZ & " " & frmVInfo.txt_KDOrt
    Range("Druckvorlage!D2") = "Verleihnummer:"
    Range("Druckvorlage!E2") = "'" & frmVInfo.txt_VNr.Value
    Range("Druckvorlage!A2") = ""
    Range("Druckvorlage!D3") = ""
    Range("Druckvorlage!E11") = "Zustandsbericht"
    Range("Druckvorlage!E16") = "n.O."
    Range("Druckvorlage!F16") = "i.O."
    Range("Druckvorlage!D5") = "Kundennummer:"
    Range("Druckvorlage!D6") = ""
    Range("Druckvorlage!E4") = Format(Date, FDate)
    Range("Druckvorlage!E5") = "'" & Sheets("Kunden").Cells(CDbl(lngKID), 3)
    Range("Druckvorlage!E6") = ""
    Range("Druckvorlage!E7") = Sheets("Kunden").Cells(CDbl(lngKID), 13)
    zeTB = 17
    Pos = 1
    azeile = 0
    With frmVInfo.lst_VerleihI
        For zeLB = 0 To .ListCount - 1
            If .Selected(zeLB) Then
                Sheets("Druckvorlage").Cells(zeTB, 1) = "'" & Pos
                Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 1).Font.Size = 9
                Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmVInfo.lst_VerleihI.List(zeLB, 0)
                Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 2).Font.Size = 9
                Sheets("Druckvorlage").Cells(zeTB, 3) = frmVInfo.lst_VerleihI.List(zeLB, 1)
                Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 3).Font.Size = 9
                Sheets("Druckvorlage").Cells(zeTB, 4) = "'" & frmVInfo.lst_VerleihI.List(zeLB, 5) 'Menge
                Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 4).Font.Size = 9
                Sheets("Druckvorlage").Cells(zeTB + 1, 2) = "Bemerkung:"
                Sheets("Druckvorlage").Cells(zeTB + 1, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB + 1, 2).Font.Size = 11
                Sheets("Druckvorlage").Cells(zeTB + 1, 2).HorizontalAlignment = xlGeneral
                Sheets("Druckvorlage").Cells(zeTB + 1, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB + 1, 3) = vbLf & vbLf
            End If
            zeTB = zeTB + 2
            Pos = Pos + 1
        Next
    End With
    If Sheets("Daten").Range("D17").Value = "Ja" Then
        Farbe = 0
        For spLB = 0 To (CDbl(Pos) * 2) - 2
            If Farbe = 1 Then
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = -0.149998474074526
                    .PatternTintAndShade = 0
                End With
                Farbe = 0
            Else
                Sheets("Druckvorlage").Range("A" & 17 + spLB & ":F" & 17 + spLB).Select
                Farbe = 1
            End If
        Next
    End If
    Sheets("Druckvorlage").Cells(zeTB + 2, 1) = "Datum"
    Sheets("Druckvorlage").Cells(zeTB + 2, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeTB + 4, 1) = ". . . . . . . . . . . . . . . . . ."
    Sheets("Druckvorlage").Cells(zeTB + 5, 1) = "Ware gepr|fffd|ft durch:"
    Sheets("Druckvorlage").Cells(zeTB + 5, 1).Font.Size = 11
    Sheets("Druckvorlage").Cells(zeTB + 8, 1) = ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
    Kopien = Application.InputBox("Anzahl Kopien", "Zustand drucken", 1)
    If Kopien = False Then
        Application.ScreenUpdating = True
        Exit Sub
    End If
    Call Fusszeile
    Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    frmVInfo.txt_KDID.Value = frmVInfo.txt_KDID.Value
    MsgBox "Zustandsbericht wurde gedruckt", , "Hinweis"
    Unload frmMitarbeiter
End Sub
Attribute VB_Name = "frmPW"
Attribute VB_Base = "0{5226A2B8-EFE7-4DEF-80FF-DA67E046CF20}{AAC76E93-F765-4033-8AAE-BD59850932AB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cmd_PAnzeigen_Click()
    txtpw.PasswordChar = ""
    Application.Wait Now + TimeSerial(0, 0, 2) '2 sekunden Pause
    Call PWCH
End Sub

Sub PWCH()
    txtpw.PasswordChar = "*"
    txtpw.SetFocus
End Sub

Private Sub txtpw_Change()
    If Not txtpw.Value = "" Then
        cmd_PAnzeigen.Enabled = True
    Else
        cmd_PAnzeigen.Enabled = False
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    txtpw.PasswordChar = "*"
End Sub

Sub TestMail()
    Dim Etxt, Ptxt, stxt, Ntxt, Btxt As String
    Dim iNachricht As Object
    Dim iKonfiguration  As Object
    Dim Felder As Variant
    'Geht unter Windows 7 Pro 64bit!
    On Error GoTo weiter
    Set iNachricht = CreateObject("CDO.Message")
    Set iKonfiguration = CreateObject("CDO.Configuration")
    iKonfiguration.Load -1
    Set Felder = iKonfiguration.Fields
    If iNachricht Is Nothing Then
        MsgBox Err.Description
    Else
        Etxt = ThisWorkbook.Sheets("Daten").Range("B27")
        stxt = ThisWorkbook.Sheets("Daten").Range("B28")
        Ntxt = frmEmail.txt_ENachricht.Value
        Ptxt = CStr(txtpw)
        If Ptxt = "" Then
            Set iNachricht = Nothing
            Set iKonfiguration = Nothing
            Application.StatusBar = False
            Exit Sub
        End If
        If Ptxt = "" Then Exit Sub
        Btxt = frmEmail.txt_Betreff.Value
        Application.StatusBar = "E-Mail wird gesendet!"
        With Felder
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusername") = Etxt  'Deine E-Mail-Adresse
           .Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") = Ptxt  'Passwort angeben
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = stxt    'Postausgangsserver
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
            If ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 465    'ssl-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 587    'tls-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "SMTP" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 25     'smtp-Port
            End If
            .Item("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60
           .Update
        End With
        With iNachricht
            Set .Configuration = iKonfiguration
            .To = CStr(frmEmail.txt_Email)                                              'Empf|fffd|nger
            .sender = CStr(frmEmail.txt_Email)
            .Subject = "Testmail Lagerverwaltung!"                                      'Betreffzeile
            .TextBody = "Excel Testmail" & vbLf & vbLf & "Gesendet von der Excel Lagerverwaltung " & CStr(Sheets("Daten").Range("B45")) 'Nachricht
            .Send
        End With
    End If
    Application.StatusBar = False
    MsgBox "Testmail wurde versandt!"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Unload frmPW
    Exit Sub
weiter:
    Application.StatusBar = "Fehlgeschlagen!"
    MsgBox "Fehler beim versenden der E-Mail!", vbCritical, "Fehler"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Application.StatusBar = False
End Sub

Sub ETestMail()
    Dim Etxt, Ptxt, stxt, Ntxt, Btxt As String
    Dim iNachricht As Object
    Dim iKonfiguration  As Object
    Dim Felder As Variant
    'Geht unter Windows 7 Pro 64bit!
    On Error GoTo weiter
    Set iNachricht = CreateObject("CDO.Message")
    Set iKonfiguration = CreateObject("CDO.Configuration")
    iKonfiguration.Load -1
    Set Felder = iKonfiguration.Fields
    If iNachricht Is Nothing Then
        MsgBox Err.Description
    Else
        Etxt = ThisWorkbook.Sheets("Daten").Range("B27")
        stxt = ThisWorkbook.Sheets("Daten").Range("B28")
        Ntxt = frmEmail.txt_ENachricht.Value
        Ptxt = CStr(txtpw)
        If Ptxt = "" Then
            Set iNachricht = Nothing
            Set iKonfiguration = Nothing
            Application.StatusBar = False
            Exit Sub
        End If
        If Ptxt = "" Then Exit Sub
        Application.StatusBar = "Test-EMail wird gesendet!"
        With Felder
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusername") = Etxt  'Deine E-Mail-Adresse
           .Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") = Ptxt  'Passwort angeben
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = stxt    'Postausgangsserver
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
            If ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 465    'ssl-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 587    'tls-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "SMTP" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 25     'smtp-Port
            End If
            .Item("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60
           .Update
        End With
        With iNachricht
            Set .Configuration = iKonfiguration
            .To = CStr(frmSettings.txt_Email)                                           'Empf|fffd|nger
            .sender = CStr(frmSettings.txt_Email)
            .Subject = "Testmail Lagerverwaltung!"                                      'Betreffzeile
            .TextBody = "Excel Testmail" & vbLf & vbLf & "Gesendet von der Excel Lagerverwaltung " & CStr(Sheets("Daten").Range("B45")) 'Nachricht
            .Send
        End With
    End If
    Application.StatusBar = False
    MsgBox "Testmail wurde versandt!"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Unload frmPW
    Exit Sub
weiter:
    Application.StatusBar = "Fehlgeschlagen!"
    MsgBox "Fehler beim versenden der E-Mail!", vbCritical, "Fehler"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Application.StatusBar = False
End Sub

Sub EMail()
    Dim Etxt, Ptxt, stxt, Ntxt, Btxt As String
    Dim iNachricht As Object
    Dim iKonfiguration  As Object
    Dim Felder As Variant
    'Geht unter Windows 7 / 10 Pro 64bit!
    On Error GoTo weiter
    Set iNachricht = CreateObject("CDO.Message")
    Set iKonfiguration = CreateObject("CDO.Configuration")
    iKonfiguration.Load -1
    Set Felder = iKonfiguration.Fields
    If iNachricht Is Nothing Then
        MsgBox Err.Description
    Else
        Etxt = ThisWorkbook.Sheets("Daten").Range("B27")
        stxt = ThisWorkbook.Sheets("Daten").Range("B28")
        Ntxt = frmEmail.txt_ENachricht.Value
        Ptxt = CStr(txtpw)
        If Ptxt = "" Then
            Set iNachricht = Nothing
            Set iKonfiguration = Nothing
            Application.StatusBar = False
            Exit Sub
        End If
        Btxt = frmEmail.txt_Betreff.Value
        Application.StatusBar = "E-Mail wird gesendet!"
        With Felder
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusername") = Etxt      'Deine E-Mail-Adresse
           .Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") = Ptxt      'Passwort angeben
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = stxt        'Postausgangsserver
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
            If ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 465 'ssl-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 587 'tls-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "SMTP" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 25  'smtp-Port
            End If
            .Item("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60
           .Update
        End With
        With iNachricht
            Set .Configuration = iKonfiguration
            .To = frmEmail.txt_AN.Value                                                     'Empf|fffd|nger
            .sender = frmEmail.txt_VON.Value                                                'Von
            .Subject = Btxt                                                                 'Betreffzeile
            .TextBody = Ntxt & vbLf & vbLf & "Gesendet von der Lagerverwaltung " & CStr(Sheets("Daten").Range("B45"))  'Nachricht
            .Send
        End With
    End If
    Application.StatusBar = False
    MsgBox "E-Mail wurde an " + frmEmail.txt_AN.Value + " versandt!"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Unload frmPW
    Exit Sub
weiter:
    Application.StatusBar = "Fehlgeschlagen!"
    MsgBox "Fehler beim versenden der E-Mail!", vbCritical, "Fehler"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Application.StatusBar = False
End Sub

Private Sub txtpw_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If Not txtpw = "" Then
        If KeyCode = 13 Then
            Call cmd_ok_Click
        End If
    End If
End Sub

Private Sub cmd_ok_Click()
    If txtpw.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    If txt_type.Value = "" Then
        If CStr(txtpw) = "ExCeLvBa@2018" Then
            Sheets("Daten").Range("B6").Value = "0000"
            Unload frmPW
            MsgBox "Passwort wurde zur|fffd|ckgesetzt!", , "Hinweis"
            Exit Sub
        End If
        If txtpw.Text = Sheets("Daten").Range("B6").Text Then
            ThisWorkbook.Sheets("Daten").Range("B7").Value = "Admin"
            Unload frmPW
            MsgBox "Sie sind jetzt als Admin angemeldet!", , "Hinweis"
            Application.ScreenUpdating = True
        Else
            lblPW.Caption = "Passwort ist falsch!"
            Sheets("Daten").Activate
            Range("A65536").End(xlUp).Offset(1, 0).Select
            ActiveCell.Offset(0, 0).Value = Format(Date, "DD.MM.YYYY")
            ActiveCell.Offset(0, 1).Value = "Falsches Admin Passwort"
            ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
            Sheets("Center").Activate
            txtpw.Value = ""
            txtpw.SetFocus
            Application.ScreenUpdating = True
        End If
    ElseIf txt_type.Value = "Email" Then
        Call EMail
    ElseIf txt_type.Value = "TEmail" Then
        Call TestMail
    ElseIf txt_type.Value = "ETEmail" Then
        Call ETestMail
    ElseIf txt_type.Value = "Beleg" Then
        If txtpw.Text = Sheets("Daten").Range("B6").Text Then
            frmKasse.txt_sperre.Value = 1
            frmKasse.cmd_Beleg.Visible = False
            Unload frmPW
            MsgBox "Sie k|fffd|nnen den Beleg jetzt bearbeiten!", , "Hinweis"
            Application.ScreenUpdating = True
        Else
            lblPW.Caption = "Passwort ist falsch!"
            txtpw.Value = ""
            txtpw.SetFocus
            Application.ScreenUpdating = True
        End If
    End If
End Sub

Private Sub Cmd_Cancel_Click()
    Unload frmPW
End Sub
Attribute VB_Name = "frmProtokoll"
Attribute VB_Base = "0{2D36EAD8-3674-472C-96CC-617722225F99}{500C81FB-CD70-4D9D-A3C6-5980055FBBCC}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    Call Ereignis
End Sub

Private Sub cmd_LoginExit_Click()
    Unload frmProtokoll
End Sub

Private Sub cmd_Ploeschen_Click()
    Dim stxt As String
    
    stxt = MsgBox("M|fffd|chten Sie wirklich das Protokoll l|fffd|schen?", vbYesNo, "Hinweis")
    If stxt = vbYes Then
        If Sheets("Daten").Range("B6").Value = "" Or Sheets("Daten").Range("B7").Value = "Admin" Then
            Application.ScreenUpdating = False
            Range("Daten!A50:C300").Clear
            Application.ScreenUpdating = True
            list_Ereignis.Clear
            Call Ereignis
            Sheets("Center").Activate
        Else
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            frmPW.Show
        End If
    End If
End Sub

Sub Ereignis() 'v1.34
    Dim lngZeile, i, lng As Long
    On Error Resume Next
    
    list_Ereignis.Clear
    list_Ereignis.ColumnCount = 3
    list_Ereignis.ColumnWidths = "60;55;150"
    i = 0
    Application.ScreenUpdating = False
    lng = CDbl(Sheets("Daten").UsedRange.Rows.Count)
    For lngZeile = 50 To Sheets("Daten").UsedRange.Rows.Count
        If Not Sheets("Daten").Cells(lng, 3) = "" Then
            list_Ereignis.AddItem Sheets("Daten").Cells(lng, 1).Value
            list_Ereignis.Column(1, i) = CDate(Sheets("Daten").Cells(lng, 3).Value)
            list_Ereignis.Column(2, i) = Sheets("Daten").Cells(lng, 2).Value
            list_Ereignis.Column(3, i) = Sheets("Daten").Cells(lng, 15).Row
            i = i + 1
        End If
        lng = lng - 1
    Next lngZeile
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmSettings"
Attribute VB_Base = "0{C8313B9C-C32C-4742-A7B1-09F2462C1014}{98F2BEEC-A41F-4578-A369-1CA0FCC63337}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cbo_Ausdruck_Change()
    If cbo_Ausdruck = "Rechnung & Lieferschein" Then
        Sheets("Daten").Range("F29").Value = "RL"
    ElseIf cbo_Ausdruck = "nur Lieferschein" Then
        Sheets("Daten").Range("F29").Value = "L"
    Else
        Sheets("Daten").Range("F29").Value = "R"
    End If
End Sub

Private Sub cbo_ZO10_Change()
    Sheets("Daten").Range("F28").Value = cbo_ZO10
End Sub

Private Sub cbo_ZO11_Change()
    Sheets("Daten").Range("F30").Value = cbo_ZO11
End Sub

Private Sub cbo_ZO12_Change()
    Sheets("Daten").Range("F36").Value = cbo_ZO12
End Sub

Private Sub cbo_ZO7_Change()
    Sheets("Daten").Range("D19").Value = cbo_ZO7
End Sub

Private Sub cbo_DateFormat_Change()
    Sheets("Daten").Range("D46").Value = cbo_DateFormat
End Sub

Private Sub cbo_ZO3_Change()
    Sheets("Daten").Range("D17").Value = cbo_ZO3
End Sub

Private Sub cbo_ZO4_Change()
    Sheets("Daten").Range("D48").Value = cbo_ZO4
End Sub

Private Sub cbo_UpdateAus_Change()
    If cbo_UpdateAus = "niemals" Then
        Sheets("Daten").Range("B46").Value = "Nein"
    ElseIf cbo_UpdateAus = "t|fffd|glich" Then
        Sheets("Daten").Range("B46").Value = "T"
    ElseIf cbo_UpdateAus = "w|fffd|chentlich" Then
        Sheets("Daten").Range("B46").Value = "W"
        Sheets("Daten").Range("B47").Value = Format(Date + 7, "DD.MM.YYYY")
    ElseIf cbo_UpdateAus = "monatlich" Then
        Sheets("Daten").Range("B46").Value = "M"
        Sheets("Daten").Range("B47").Value = Format(Date + 30, "DD.MM.YYYY")
    End If
End Sub

Private Sub cbo_ZO8_Change()
    Sheets("Daten").Range("D21").Value = cbo_ZO8
End Sub

Private Sub cbo_ZO9_Change()
    Sheets("Daten").Range("F27").Value = cbo_ZO9
    If cbo_ZO9 = "Ja" Then
        cbo_Ausdruck.Enabled = True
    Else
        cbo_Ausdruck.Enabled = False
        cbo_Ausdruck.ListIndex = -1
    End If
End Sub

Private Sub Chk_EPass_Change()
    If Chk_EPass.Value = True Then
        frmSettings.txt_EPasswort.Enabled = False
        frmSettings.txt_EPasswort.BackColor = &H8000000F
    Else
        frmSettings.txt_EPasswort.Enabled = True
        frmSettings.txt_EPasswort.BackColor = &H80000005
    End If
End Sub

Private Sub Chk_EPass_Click()
    If Chk_EPass.Value = True Then
        frmSettings.txt_EPasswort.Enabled = False
        frmSettings.txt_EPasswort.BackColor = &H8000000F
    Else
        frmSettings.txt_EPasswort.Enabled = True
        frmSettings.txt_EPasswort.BackColor = &H80000005
    End If
End Sub

Private Sub chk_Gast_Click()
    If chk_Gast.Value = True Then
        Sheets("Daten").Range("B21").Value = "Gast"
    Else
        Sheets("Daten").Range("B21").Value = ""
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub Chk_ON_Click()
    If Chk_ON.Value = True Then
        Chk_OY.Value = False
        cbo_Port.Enabled = True
        txt_EPasswort.Enabled = True
        txt_Provider.Enabled = True
        Chk_EPass.Enabled = True
        cmd_TMail.Visible = True
    Else
        Chk_OY.Value = True
        cbo_Port.Enabled = False
        txt_EPasswort.Enabled = False
        txt_Provider.Enabled = False
        Chk_EPass.Enabled = False
        cmd_TMail.Visible = False
    End If
End Sub

Private Sub Chk_OY_Click()
    If Chk_OY.Value = True Then
        Chk_ON.Value = False
        cbo_Port.Enabled = False
        txt_EPasswort.Enabled = False
        txt_Provider.Enabled = False
        Chk_EPass.Enabled = False
    Else
        Chk_ON.Value = True
        cbo_Port.Enabled = True
        txt_EPasswort.Enabled = True
        txt_Provider.Enabled = True
        Chk_EPass.Enabled = True
    End If
End Sub

Private Sub cmd_ESave_Click()
    ThisWorkbook.Sheets("Daten").Range("B27") = frmSettings.txt_Email.Value
    ThisWorkbook.Sheets("Daten").Range("B28") = frmSettings.txt_Provider.Value
    ThisWorkbook.Sheets("Daten").Range("B29") = frmSettings.txt_EPasswort.Value
    
    If frmSettings.cbo_Port = "SMTP (Port 25)" Then
        ThisWorkbook.Sheets("Daten").Range("B30") = "SMTP"
    ElseIf frmSettings.cbo_Port = "TLS (Port 587)" Then
        ThisWorkbook.Sheets("Daten").Range("B30") = "TLS"
    ElseIf frmSettings.cbo_Port = "SSL (Port 465)" Then
        ThisWorkbook.Sheets("Daten").Range("B30") = "SSL"
    End If
    If Chk_OY.Value = True Then
        ThisWorkbook.Sheets("Daten").Range("B31") = "Y"
    Else
        ThisWorkbook.Sheets("Daten").Range("B31") = "N"
    End If
    MsgBox "Daten wurden gespeichert", , "E-Mail"
End Sub

Sub TestMail()
    Dim Etxt, Ptxt, stxt, Ntxt, Btxt As String
    Dim iNachricht As Object
    Dim iKonfiguration  As Object
    Dim Felder As Variant
    'Geht unter Windows 7 Pro 64bit!
    On Error GoTo weiter
    Set iNachricht = CreateObject("CDO.Message")
    Set iKonfiguration = CreateObject("CDO.Configuration")
    iKonfiguration.Load -1
    Set Felder = iKonfiguration.Fields
    If iNachricht Is Nothing Then
        MsgBox Err.Description
    Else
        Etxt = ThisWorkbook.Sheets("Daten").Range("B27")
        stxt = ThisWorkbook.Sheets("Daten").Range("B28")
        If Not frmSettings.txt_EPasswort.Value = "" Then
            Ptxt = CStr(ThisWorkbook.Sheets("Daten").Range("B29"))
        Else
            frmPW.txt_type.Value = "ETEmail"
            frmPW.Caption = "Bitte geben Sie Ihr E-Mail Passwort ein!"
            frmPW.Show
            Set iNachricht = Nothing
            Set iKonfiguration = Nothing
            Exit Sub
        End If
        If Ptxt = "" Then Exit Sub
        Application.StatusBar = "E-Mail wird gesendet!"
        With Felder
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = True
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpauthenticate") = 1
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusername") = Etxt  '"Deine E-Mail-Adresse"
           .Item("http://schemas.microsoft.com/cdo/configuration/sendpassword") = Ptxt  'Passwort angeben
           .Item("http://schemas.microsoft.com/cdo/configuration/smtpserver") = stxt    'Postausgangsserver
           .Item("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2
            If ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 465    'ssl-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 587    'tls-Port
            ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "SMTP" Then
                .Item("http://schemas.microsoft.com/cdo/configuration/smptserverport") = 25     'smtp-Port
            End If
            .Item("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60
           .Update
        End With
        With iNachricht
            Set .Configuration = iKonfiguration
            .To = frmSettings.txt_Email.Value                                               'Empf|fffd|nger
            .Subject = "Testmail Lagerverwaltung!"                                          'Betreffzeile
            .TextBody = "Excel Testmail" & vbLf & vbLf & "Gesendet von der Excel Lagerverwaltung " & CStr(Sheets("Daten").Range("B45")) 'Nachricht
            .Send
        End With
    End If
    Application.StatusBar = False
    MsgBox "Testmail wurde versandt!"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Exit Sub
weiter:
    Application.StatusBar = "Fehlgeschlagen!"
    MsgBox "Fehler beim versenden der Test-Email!", vbCritical, "Fehler"
    Set iNachricht = Nothing
    Set iKonfiguration = Nothing
    Application.StatusBar = False
End Sub

Private Sub cmd_InfoLogo_Click()
    MsgBox "Das Logo wird automatisch in die Druckvorlage |fffd|bernommen" & vbLf & "und sollte nicht gr|fffd||fffd|er sein als 350 x 200 pixel!", , "Hinweis Logo"
End Sub

Private Sub cmd_InfoZ10_Click()
    MsgBox "Im Wareneingang den Beleg (Lieferschein) von Lieferanten erfassen!", , "Hinweis"
End Sub

Private Sub cmd_InfoZO1_Click()
    MsgBox "Im Warenausgang muss beim verbuchen eine Kostenstelle angegeben werden!", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO2_Click()
    MsgBox "Hier k|fffd|nnen Sie, anhand der Herstellernummer, den Artikel in verschiedenen Portalen vergleichen!", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO3_Click()
    MsgBox "Fablich (Grau/Wei|fffd|) abgestufte Zeilen, bei den Positionen!", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO4_Click()
    MsgBox "Schnelles Ein,- und Ausbuchen zulassen!", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO5_Click()
    MsgBox "Zeige des Verleih-Button in der Hauptmaske.", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO6_Click()
    MsgBox "Pr|fffd|ft die Verwendbarkeit, bei aufrufen des Artikels! ", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO7_Click()
    MsgBox "Aktualisiert die Daten (wzB. die Warengruppe) automatisch beim Starten des Projektes!" & vbLf & "Dadurch kann der Startprozess etwas l|fffd|nger dauern!", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO8_Click()
    MsgBox "Pr|fffd|ft, ob die Menge im Lager Verf|fffd|gbar ist!", vbInformation, "Hinweis"
End Sub

Private Sub cmd_InfoZO9_Click()
    MsgBox "Das Projekt erkennt, ob eine Rechnung oder ein Lieferschein gedruckt wurde. Ist dieses nicht der Fall, wird bei Warenausgang automatisch Rechnung / Lieferschein aktivert.", vbInformation, "Auftr|fffd|ge"
End Sub

Private Sub cmd_TMail_Click()
    If txt_Email.Value = "" Then
        MsgBox "Bitte geben Sie eine E-Mail an!", , "Hinweis"
        txt_Email.SetFocus
    ElseIf txt_Provider.Value = "" Then
        MsgBox "Bitte geben Sie einen Postausgangsserver an!", , "Hinweis"
        txt_Provider.SetFocus
    ElseIf cbo_Port.Value = "" Then
        MsgBox "Bitte geben Sie ein Port an!", , "Hinweis"
        cbo_Port.SetFocus
    Else
        If Not InStr(txt_Email, "@") > 0 Then
        MsgBox "Ung|fffd|ltiges E-Mail - Format!", , "Hinweis"
        txt_Email.SetFocus
        Else
            Call TestMail
        End If
    End If
End Sub

Private Sub cmd_Update_Click()
    On Error Resume Next
    Application.StatusBar = "Es wird nach einem Update gepr|fffd|ft - einen Moment Geduld bitte."
    With Application
        .ScreenUpdating = False
        .EnableEvents = False
        .Calculation = xlCalculationManual
    End With
    Sheets("Daten").Activate
    ActiveSheet.Columns("O:O").Delete
    With ActiveSheet.QueryTables.Add(Connection:= _
        "URL;https://blickwinkel178.blogspot.de/p/versionsnummer.html", Destination:=Range( _
        "$O$1"))
        .Name = "forum_1"
        .FieldNames = True
        .RowNumbers = False
        .FillAdjacentFormulas = False
        .PreserveFormatting = True
        .RefreshOnFileOpen = False
        .BackgroundQuery = True
        .RefreshStyle = xlInsertDeleteCells
        .SavePassword = False
        .SaveData = True
        .AdjustColumnWidth = True
        .RefreshPeriod = 0
        .WebSelectionType = xlSpecifiedTables
        .WebFormatting = xlWebFormattingNone
        .WebTables = "1"
        .WebPreFormattedTextToColumns = True
        .WebConsecutiveDelimitersAsOne = True
        .WebSingleBlockTextImport = False
        .WebDisableDateRecognition = False
        .WebDisableRedirections = False
        .Refresh BackgroundQuery:=False
    End With
    Sheets("Center").Activate
    If CDbl(Sheets("Daten").Range("B8").Value) < CDbl(Sheets("Daten").Range("O2").Value) Then
        MsgBox "Eine neue Version ist Verf|fffd|gbar! Version (" + Sheets("Daten").Range("O1").Value + ")" & vbLf & vbLf & "Ihre Version: " & Sheets("Daten").Range("B8").Value, , "Neue Version!"
    ElseIf CDbl(Sheets("Daten").Range("B8").Value) > CDbl(Sheets("Daten").Range("O2").Value) Then
        MsgBox "Sie nutzen eine Betaversion!", , "Hinweis"
        Exit Sub
    Else
        If Sheets("Daten").Range("B45").Value = Sheets("Daten").Range("O1").Value Then
            MsgBox "Gl|fffd|ckwunsch, ihre Version ist auf dem neuesten Stand!", , "Kein Update Verf|fffd|gbar!"
        Else
            MsgBox "Eine Update ist Verf|fffd|gbar! Version: (" + Sheets("Daten").Range("O1").Value + ")" & vbLf & vbLf & "Ihre Version: " & Sheets("Daten").Range("B45").Value, , "Update"
        End If
    End If
    With Application
        .ScreenUpdating = True
        .EnableEvents = True
        .Calculation = xlCalculationAutomatic
    End With
    Application.StatusBar = False
End Sub

Private Sub CommandButton2_Click()
    Dim Bpfad As Variant
    On Error Resume Next
    Bpfad = Application.GetOpenFilename("Programm (*.exe), *.exe")
    If Bpfad <> False Then
        txt_BPfad.Text = CStr(Bpfad)
    End If
End Sub

Private Sub cmd_TPfad_Click()
    Dim bwert, varPfad As String
    On Error GoTo Fehler
    If Not txt_BPfad = "" Then
        bwert = CStr(txt_BPfad)
        Shell bwert & varPfad, 3
    End If
    Exit Sub
Fehler:
    MsgBox "Sorry, es ist nicht m|fffd|glich das Programm zu |fffd|ffnen!", vbInformation, "Progamm |fffd|ffnen"
End Sub

Private Sub CommandButton6_Click()
    If Len(txt_BPfad.Value) > 0 Then
        Sheets("Daten").Range("D45").FormulaLocal = "=HYPERLINK(" & _
        Chr(34) & "file:///" & txt_BPfad.Text & Chr(34) & ";" & _
        Chr(34) & StrReverse(Split(StrReverse(txt_BPfad.Text), "\")(0)) & Chr(34) & ")"
    End If
End Sub

Private Sub cmd_Logo_Click()
    Dim r As Variant
    On Error Resume Next
    r = Application.GetOpenFilename("Bilder / Fotos (*.jpg), *.jpg")
    If r <> False Then
        txtjpg.Text = CStr(r)
    End If
    Set Image1.Picture = LoadPicture(txtjpg)
    lbl_Logo.Visible = False
    With Sheets("Druckvorlage").PageSetup
        .RightHeaderPicture.Filename = CStr(r)
        .RightHeader = "&G"
    End With
    Sheets("Daten").Range("D47").Value = txtjpg
End Sub

Private Sub cmd_LogoDel_Click()
    With Sheets("Druckvorlage").PageSetup
        .RightHeaderPicture.Filename = ""
        .RightHeader = ""
    End With
    lbl_Logo.Visible = True
    Image1.Picture = Nothing
    Sheets("Daten").Range("D47").Value = ""
End Sub

Private Sub cmd_InfoZO12_Click()
    MsgBox "Bei einem Angebot oder einer Rechnung, wird der Gesamtbetrag auf 5 Rappen gerundet!", , "Region Schweiz"
End Sub

Private Sub cmd_InfoZO11_Click()
    MsgBox "Beim Anlegen kann in Anschluss ein Beleg ausgedruckt werden, wenn der Bestand gr|fffd||fffd|er ist wie 0!", , "Neuer Artikel"
End Sub

Private Sub lbl_OVers_Click()
    MsgBox "You are currently running Microsoft Office, " _
    & " version " & Application.Version & ", build " _
    & Application.Build & "."
End Sub

Private Sub txt_BName_Change()
    Dim lngL As Long
    If Not txt_BName.Value = "" Then
        lbl_BAngezeigt.Visible = True
    Else
        lbl_BAngezeigt.Visible = False
    End If
    lngL = Len(txt_BName)
    If lngL > 15 Then
        txt_Bcounter.Caption = "Text zu lang!"
        txt_BName.ForeColor = &HFF&
        txt_Bcounter.ForeColor = &HFF&
    Else
        txt_Bcounter.Caption = "Noch max. " & CDbl(15 - lngL) & " Zeichen"
        txt_BName.ForeColor = &H404040
        txt_Bcounter.ForeColor = &H4000&
        Sheets("Daten").Range("D44") = CStr(txt_BName)
    End If
End Sub

Private Sub txt_BPfad_Change()
    Sheets("Daten").Range("D45") = CStr(txt_BPfad)
End Sub

Private Sub txtFrei_Change()
    Dim lngL As Long
    lngL = Len(txtFrei)
    If lngL > 12 Then
        txt_Tcounter.Caption = "Text zu lang!"
        txtFrei.ForeColor = &HFF&
        txt_Tcounter.ForeColor = &HFF&
    Else
        txt_Tcounter.Caption = "Noch max. " & CDbl(12 - lngL) & " Zeichen"
        txtFrei.ForeColor = &H404040
        txt_Tcounter.ForeColor = &H4000&
        
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    Dim i As Long
    Dim CB As Object
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    If Sheets("Daten").Range("B5").Value = "True" Then
        chk_Anmeldung.Value = True
    Else
        chk_Anmeldung.Value = False
    End If
    If Sheets("Daten").Range("B21").Value = "Gast" Then
        chk_Gast.Value = True
    Else
        chk_Gast.Value = False
    End If
    Call Msuchen
    If Not Sheets("Daten").Range("D47").Value = "" Then
        lbl_Logo.Visible = False
        Set Image1.Picture = LoadPicture(Sheets("Daten").Range("D47").Value)
    End If
    cbo_DateFormat = Sheets("Daten").Range("D46").Value
    txt_BName.Value = CStr(Sheets("Daten").Range("D44"))
    txt_BPfad.Value = CStr(Sheets("Daten").Range("D45"))
    txtFrei.Value = Sheets("Lager").Cells(1, 5).Value
    txttax1.Value = CDbl(Sheets("Daten").Range("B2") * 100) & "%"
    txttax2.Value = CDbl(Sheets("Daten").Range("B3") * 100) & "%"
    txtcompany.Value = Sheets("Daten").Range("B9").Text
    txtadress.Value = Sheets("Daten").Range("B10").Text
    txtPLZ.Value = Sheets("Daten").Range("B11").Text
    txtAnsprech.Value = Sheets("Daten").Range("B12").Text
    txtphone.Value = Sheets("Daten").Range("B13").Text
    txtfax.Value = Sheets("Daten").Range("B14").Text
    txtEmail.Value = Sheets("Daten").Range("B15").Text
    txtHomepage.Value = Sheets("Daten").Range("B16").Text
    txt_VorlageBest.Value = Sheets("Daten").Range("B25").Text
    txt_VorlageFuss.Value = Sheets("Daten").Range("B26").Text
    txt_Bezug.Value = Sheets("Daten").Range("F31")
    txt_Hand.Value = Sheets("Daten").Range("F32")
    txt_gewinn.Value = Sheets("Daten").Range("F33")
    txt_Kskonto.Value = Sheets("Daten").Range("F34")
    txt_Krabatt.Value = Sheets("Daten").Range("F35")
    
    cmdMzu.Caption = "Neuen Mitarbeiter" & vbLf & "hinzuf|fffd|gen"
    With cbo_Ausdruck
        .AddItem "Rechnung & Lieferschein"
        .AddItem "nur Lieferschein"
        .AddItem "nur Rechnung"
    End With
    With cboanrede
        .AddItem "Herr"
        .AddItem "Frau"
    End With
    Call BereichW
    With cbo_berechigung
        .AddItem "Beschr|fffd|nkten Zugriff"
        .AddItem "Vollzugriff / Admin"
    End With
    With cbo_UpdateAus
        .AddItem "niemals"
        .AddItem "t|fffd|glich"
        .AddItem "w|fffd|chentlich"
        .AddItem "monatlich"
    End With
    For i = 1 To 12
        Set CB = frmSettings.Controls("cbo_ZO" & i)
        CB.AddItem "Ja"
        CB.AddItem "Nein"
    Next i
    With cbo_DateFormat
        .AddItem "DD.MM.YYYY"
        .AddItem "DD.MM.YY"
        .AddItem "MM.DD.YYYY"
        .AddItem "MM.DD.YY"
        .AddItem "YYYY/MM/DD"
        .AddItem "YYYY.MM.DD"
        .AddItem "YYYY-MM-DD"
    End With
    If Sheets("Daten").Range("B46").Value = "T" Then
        cbo_UpdateAus = "t|fffd|glich"
    ElseIf Sheets("Daten").Range("B46").Value = "W" Then
        cbo_UpdateAus = "w|fffd|chentlich"
    ElseIf Sheets("Daten").Range("B46").Value = "M" Then
        cbo_UpdateAus = "monatlich"
    Else
        cbo_UpdateAus = "niemals"
    End If
    cbo_ZO1 = Sheets("Daten").Range("B35")
    cbo_ZO2 = Sheets("Daten").Range("B42")
    cbo_ZO3 = Sheets("Daten").Range("D17")
    cbo_ZO4 = Sheets("Daten").Range("D48")
    cbo_ZO5 = Sheets("Daten").Range("B38")
    cbo_ZO6 = Sheets("Daten").Range("B44")
    cbo_ZO7 = Sheets("Daten").Range("D19")
    cbo_ZO8 = Sheets("Daten").Range("D21")
    cbo_ZO9 = Sheets("Daten").Range("F27")
    cbo_ZO10 = Sheets("Daten").Range("F28")
    cbo_ZO11 = Sheets("Daten").Range("F30")
    cbo_ZO12 = Sheets("Daten").Range("F36")
    If Sheets("Daten").Range("F29").Value = "RL" And Sheets("Daten").Range("F27").Value = "Ja" Then
        cbo_Ausdruck.ListIndex = 0
    ElseIf Sheets("Daten").Range("F29").Value = "L" And Sheets("Daten").Range("F27").Value = "Ja" Then
        cbo_Ausdruck.ListIndex = 1
    Else
        cbo_Ausdruck.ListIndex = 2
    End If
    cmdLagerein.Caption = "WA / WE" & vbLf & "Lager einblenden"
    lbl_VersNr.Caption = CStr(Sheets("Daten").Range("B45"))
    frmSettings.txt_Email.Value = ThisWorkbook.Sheets("Daten").Range("B27")
    frmSettings.txt_Provider.Value = ThisWorkbook.Sheets("Daten").Range("B28")
    frmSettings.txt_EPasswort.Value = ThisWorkbook.Sheets("Daten").Range("B29")
    If ThisWorkbook.Sheets("Daten").Range("B30") = "SMTP" Then
        frmSettings.cbo_Port = "SMTP (Port 25)"
    ElseIf ThisWorkbook.Sheets("Daten").Range("B30") = "SSL" Then
        frmSettings.cbo_Port = "SSL (Port 465)"
    ElseIf ThisWorkbook.Sheets("Daten").Range("B30").Value = "TLS" Then
        frmSettings.cbo_Port = "TLS (Port 587)"
    End If
    If ThisWorkbook.Sheets("Daten").Range("B31").Value = "Y" Then
        frmSettings.Chk_OY.Value = True
        frmSettings.Chk_ON.Value = False
    Else
        Chk_OY.Value = False
        Chk_ON.Value = True
    End If
    With cbo_Port
        .AddItem "SMTP (Port 25)"
        .AddItem "TLS (Port 587)"
        .AddItem "SSL (Port 465)"
    End With
    If Chk_ON.Value = True Then
        cmd_TMail.Visible = True
    Else
        cmd_TMail.Visible = False
    End If
    Chk_EPass.Value = True
    lbl_Printer.Caption = Application.ActivePrinter
    lbl_OS.Caption = Application.Build
    lbl_pfad.Caption = ThisWorkbook.Path
    lbl_Waerung.Caption = Format(0, "currency")
    If Application.Version Like "16*" Then
        lbl_OVers.Caption = "Office 2016" & " (" & Application.Version & ")"
    ElseIf Application.Version Like "15*" Then
        lbl_OVers.Caption = "Office 2013" & " (" & Application.Version & ")"
    ElseIf Application.Version Like "14*" Then
        lbl_OVers.Caption = "Office 2010" & " (" & Application.Version & ")"
    ElseIf Application.Version Like "13*" Then
        lbl_OVers.Caption = "Office 2007" & " (" & Application.Version & ")"
    Else
        lbl_OVers.Caption = "Wird leider nicht unterst|fffd|tzt!" & " (" & Application.Version & ")"
        lbl_OVers.ForeColor = &HFF&
    End If
    If CLng(WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1) > 10000 Then
        lbl_Ainfo.Caption = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1 & " Artikel vorhanden"
        lbl_Ainfo.ForeColor = &HFF&
        lbl_B2.Width = 100
        lbl_B2.BackColor = &HFF&
    ElseIf CLng(WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1) > 9000 Then
        lbl_Ainfo.Caption = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1 & " Artikel vorhanden"
        lbl_B2.Width = CLng((WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1) * 100) / CDbl("10000")
        lbl_Ainfo.ForeColor = &HFF&
        lbl_B2.BackColor = &H8080FF
    ElseIf CLng(WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1) > 7000 Then
        lbl_Ainfo.Caption = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1 & " Artikel vorhanden"
        lbl_B2.Width = CLng((WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1) * 100) / CDbl("10000")
        lbl_Ainfo.ForeColor = &HFF&
        lbl_B2.BackColor = &H80FF&
    Else
        lbl_Ainfo.Caption = WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1 & " Artikel vorhanden"
        lbl_B2.Width = CLng((WorksheetFunction.CountA(Sheets("Lager").Range("C:C")) - 1) * 100) / CDbl("10000")
        lbl_B2.BackColor = &HC000&
        lbl_Ainfo.ForeColor = &H80000006
    End If
    With cbo_RE
        .AddItem "Nein"
        .AddItem "Auswahl 1"
        .AddItem "Auswahl 2"
    End With
    With cbo_LS
        .AddItem "Nein"
        .AddItem "Auswahl 1"
        .AddItem "Auswahl 2"
    End With
    With cbo_VM
        .AddItem "Nein"
        .AddItem "Auswahl 1"
        .AddItem "Auswahl 2"
    End With
    With cbo_AU
        .AddItem "Nein"
        .AddItem "Auswahl 1"
        .AddItem "Auswahl 2"
    End With
    With cbo_AN
        .AddItem "Nein"
        .AddItem "Auswahl 1"
        .AddItem "Auswahl 2"
    End With
    With cbo_BE
        .AddItem "Nein"
        .AddItem "Auswahl 1"
        .AddItem "Auswahl 2"
    End With
    txt_Auf.Value = Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
    lbl_Auf.Caption = "Setzt sich aus AUF, Datum und Uhrzeit zusammen" & vbLf & "zB.AUF" & txt_Auf
    If Sheets("Daten").Range("D27").Value = "Nein" Or Sheets("Daten").Range("D27").Value = "" Then
        cbo_VM = "Nein"
        txt_TextVM.Value = CStr(Sheets("Daten").Range("D28").Text)
        txt_ZahlVM.Value = CStr(Sheets("Daten").Range("D29").Text)
    ElseIf Sheets("Daten").Range("D27").Value = "Auswahl 1" Then
        cbo_VM = "Auswahl 1"
        txt_TextVM.Value = CStr(Sheets("Daten").Range("D28").Text)
        txt_ZahlVM.Value = CStr(Sheets("Daten").Range("D29").Text)
    Else
        cbo_VM = "Auswahl 2"
        txt_TextVM.Value = CStr(Sheets("Daten").Range("D28").Text)
        txt_ZahlVM.Value = CStr(Sheets("Daten").Range("D29").Text)
        txt_ZahlVM.Enabled = False
        txt_TextVM.Enabled = False
    End If
    If Sheets("Daten").Range("D23").Value = "Nein" Or Sheets("Daten").Range("D23").Value = "" Then
        cbo_RE = "Nein"
        txt_TextRE.Value = CStr(Sheets("Daten").Range("D24").Text)
        txt_ZahlRE.Value = CStr(Sheets("Daten").Range("D25").Text)
    ElseIf Sheets("Daten").Range("D23").Value = "Auswahl 1" Then
        cbo_RE = "Auswahl 1"
        txt_TextRE.Value = CStr(Sheets("Daten").Range("D24").Text)
        txt_ZahlRE.Value = CStr(Sheets("Daten").Range("D25").Text)
    Else
        cbo_RE = "Auswahl 2"
        txt_TextRE.Value = CStr(Sheets("Daten").Range("D24").Text)
        txt_ZahlRE.Value = CStr(Sheets("Daten").Range("D25").Text)
        txt_ZahlRE.Enabled = False
        txt_TextRE.Enabled = False
    End If
    If Sheets("Daten").Range("F23").Value = "Nein" Or Sheets("Daten").Range("F23").Value = "" Then
        cbo_LS = "Nein"
        txt_TextLS.Value = CStr(Sheets("Daten").Range("F24").Text)
        txt_ZahlLS.Value = CStr(Sheets("Daten").Range("F25").Text)
    ElseIf Sheets("Daten").Range("F23").Value = "Auswahl 1" Then
        cbo_LS = "Auswahl 1"
        txt_TextLS.Value = CStr(Sheets("Daten").Range("F24").Text)
        txt_ZahlLS.Value = CStr(Sheets("Daten").Range("F25").Text)
    Else
        cbo_LS = "Auswahl 2"
        txt_TextLS.Value = CStr(Sheets("Daten").Range("F24").Text)
        txt_ZahlLS.Value = CStr(Sheets("Daten").Range("F25").Text)
        txt_ZahlLS.Enabled = False
        txt_TextLS.Enabled = False
    End If
    If Sheets("Daten").Range("D31").Value = "Nein" Or Sheets("Daten").Range("D31").Value = "" Then
        cbo_AU = "Nein"
        txt_TextAU.Value = CStr(Sheets("Daten").Range("D32").Text)
        txt_ZahlAU.Value = CStr(Sheets("Daten").Range("D33").Text)
    ElseIf Sheets("Daten").Range("D31").Value = "Auswahl 1" Then
        cbo_AU = "Auswahl 1"
        txt_TextAU.Value = CStr(Sheets("Daten").Range("D32").Text)
        txt_ZahlAU.Value = CStr(Sheets("Daten").Range("D33").Text)
    Else
        cbo_AU = "Auswahl 2"
        txt_TextAU.Value = CStr(Sheets("Daten").Range("D32").Text)
        txt_ZahlAU.Value = CStr(Sheets("Daten").Range("D33").Text)
        txt_ZahlAU.Enabled = False
        txt_TextAU.Enabled = False
    End If
    If Sheets("Daten").Range("D35").Value = "Nein" Or Sheets("Daten").Range("D35").Value = "" Then
        cbo_AN = "Nein"
        txt_TextAN.Value = CStr(Sheets("Daten").Range("D36").Text)
        txt_ZahlAN.Value = CStr(Sheets("Daten").Range("D37").Text)
    ElseIf Sheets("Daten").Range("D31").Value = "Auswahl 1" Then
        cbo_AN = "Auswahl 1"
        txt_TextAN.Value = CStr(Sheets("Daten").Range("D36").Text)
        txt_ZahlAN.Value = CStr(Sheets("Daten").Range("D37").Text)
    Else
        cbo_AN = "Auswahl 2"
        txt_TextAN.Value = CStr(Sheets("Daten").Range("D36").Text)
        txt_ZahlAN.Value = CStr(Sheets("Daten").Range("D37").Text)
        txt_ZahlAN.Enabled = False
        txt_TextAN.Enabled = False
    End If
    If Sheets("Daten").Range("D39").Value = "Nein" Or Sheets("Daten").Range("D39").Value = "" Then
        cbo_BE = "Nein"
        txt_TextBE.Value = CStr(Sheets("Daten").Range("D40").Text)
        txt_ZahlBE.Value = CStr(Sheets("Daten").Range("D41").Text)
    ElseIf Sheets("Daten").Range("D39").Value = "Auswahl 1" Then
        cbo_BE = "Auswahl 1"
        txt_TextBE.Value = CStr(Sheets("Daten").Range("D40").Text)
        txt_ZahlBE.Value = CStr(Sheets("Daten").Range("D41").Text)
    Else
        cbo_BE = "Auswahl 2"
        txt_TextBE.Value = CStr(Sheets("Daten").Range("D40").Text)
        txt_ZahlBE.Value = CStr(Sheets("Daten").Range("D41").Text)
        txt_ZahlBE.Enabled = False
        txt_TextBE.Enabled = False
    End If
End Sub

Private Sub cbo_ZO6_Change()
    Sheets("Daten").Range("B44").Value = cbo_ZO6
End Sub

Private Sub cbo_ZO2_Change()
    Sheets("Daten").Range("B42").Value = cbo_ZO2
End Sub

Private Sub cbo_ZO5_Click()
    If cbo_ZO5 = "Nein" Then
        ThisWorkbook.Sheets("Verleih").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Verleih_Historie").Visible = xlVeryHidden
    End If
    Sheets("Daten").Range("B38").Value = cbo_ZO5
End Sub

Private Sub cmd_Freigabe_Click()
    Dim Ename   As String
    Dim Eanzahl As Integer
    On Error Resume Next
    Eanzahl = Workbooks.Count
    ThisWorkbook.Sheets("Daten").Range("B1").Value = ActiveWorkbook.Name
    Ename = Sheets("Daten").Range("B1")
    ActiveWorkbook.SaveAs Filename:="C:\FreigegebeneMappe.xls", AccessMode:=xlShared
End Sub

Private Sub cmd_Protokoll_Click()
    frmProtokoll.Show
End Sub

Private Sub cbo_ZO1_DropButtonClick()
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    Sheets("Daten").Range("B35").Value = cbo_ZO1
End Sub

Private Sub chk_Anmeldung_Click()
    If chk_Anmeldung.Value = True Then
        Sheets("Daten").Range("B5").Value = "True"
        chk_Gast.Enabled = True
        lbl_Gast.Enabled = True
    Else
        Sheets("Daten").Range("B5").Value = "False"
        Sheets("Daten").Range("B21").Value = ""
        chk_Gast.Enabled = False
        lbl_Gast.Enabled = False
        chk_Gast.Value = False
    End If
End Sub

Private Sub cmd_text1_Click()
    Dim lngL As Long
    lngL = Len(txt_VorlageBest)
    If lngL > 100 Then
        MsgBox "Der Text ist zu lang!", vbOKOnly + vbInformation, "Max 100 Zeichen"
        Exit Sub
    End If
    Sheets("Daten").Range("B25").Value = txt_VorlageBest.Value
    MsgBox "Text wurde gespeichert!", , "Hinweis"
End Sub

Private Sub cmd_text2_Click()
    Sheets("Daten").Range("B26").Value = txt_VorlageFuss.Value
    Sheets("Druckvorlage").PageSetup.CenterFooter = "&8" & txt_VorlageFuss.Value
    MsgBox "Text wurde gespeichert!", , "Hinweis"
End Sub

Private Sub cmd_Maendern_Click()
    Dim xzeile As Long
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If txt_Mzeile.Value = "" Then Exit Sub
    xzeile = CDbl(txt_Mzeile.Value)
    Sheets("Mitarbeiter").Cells(xzeile, 1) = cboanrede
    Sheets("Mitarbeiter").Cells(xzeile, 2) = txtnn.Value
    Sheets("Mitarbeiter").Cells(xzeile, 3) = txtvn.Value
    Sheets("Mitarbeiter").Cells(xzeile, 4) = txtmemail.Value
    Sheets("Mitarbeiter").Cells(xzeile, 5) = "'" & txttele.Value
    Sheets("Mitarbeiter").Cells(xzeile, 6) = "'" & txtmfax.Value
    Sheets("Mitarbeiter").Cells(xzeile, 7) = cboabteilung
    If cbo_berechigung = "Vollzugriff / Admin" Then
        Sheets("Mitarbeiter").Cells(xzeile, 9) = "Admin"
    Else
        Sheets("Mitarbeiter").Cells(xzeile, 9) = ""
    End If
    MsgBox "Mitarbeiter wurde ge|fffd|ndert!", , "Hinweis"
    cboanrede.ListIndex = -1
    cboabteilung.ListIndex = -1
    txtnn.Value = ""
    txtvn.Value = ""
    Call Msuchen
End Sub

Sub lstStaff_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Dim lngZeile    As Long
    Dim strFile     As String
    On Error Resume Next
    Application.ScreenUpdating = False
    If CDbl(lstStaff.ListCount) = 0 Then Exit Sub
    lngZeile = lstStaff.Column(3)
    cboanrede = Sheets("Mitarbeiter").Cells(lngZeile, 1).Value
    txtvn.Value = Sheets("Mitarbeiter").Cells(lngZeile, 3).Value
    txtnn.Value = Sheets("Mitarbeiter").Cells(lngZeile, 2).Value
    txtmemail.Value = Sheets("Mitarbeiter").Cells(lngZeile, 4).Value
    txttele.Value = Sheets("Mitarbeiter").Cells(lngZeile, 5).Value
    txtmfax.Value = Sheets("Mitarbeiter").Cells(lngZeile, 6).Value
    cboabteilung = Sheets("Mitarbeiter").Cells(lngZeile, 7).Value
    If Sheets("Mitarbeiter").Cells(lngZeile, 9).Value = "Admin" Then
        cbo_berechigung.ListIndex = 1
    Else
        cbo_berechigung.ListIndex = 0
    End If
    txt_Mzeile.Value = lngZeile
    Application.ScreenUpdating = True
End Sub

Sub txt_VorlageBest_Change()
    Dim lngL As Long
    lngL = Len(txt_VorlageBest)
    If lngL > 100 Then
        txt_counter.Caption = "Text zu lang!"
        txt_VorlageBest.ForeColor = &HFF&
        txt_counter.ForeColor = &HFF&
    Else
        txt_counter.Caption = "Noch " & CDbl(100 - lngL) & " Zeichen"
        txt_VorlageBest.ForeColor = &H404040
        txt_counter.ForeColor = &H4000&
    End If
End Sub

Sub BereichW()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Mitarbeiter").Cells(Rows.Count, 1).End(xlUp).Row
            objDic(Sheets("Mitarbeiter").Cells(lngZ, 7).Value) = 0
    Next
    cboabteilung.List = objDic.keys
    Set objDic = Nothing
End Sub

Sub cmdadmin_Click()
    Dim PW, NPW1, NPW2 As String
    PW = InputBox("Bitte geben Sie das alte Passwort ein!", "ADMIN")
    If PW = "" Then Exit Sub
    If PW = "vocus@2018" Then
        Sheets("Daten").Range("B6").Value = "0000"
        MsgBox "Passwort wurde z|fffd|rckgesetzt", , "Hinweis"
        Exit Sub
    End If
    If PW = Sheets("Daten").Range("B6").Text Then
        NPW1 = InputBox("Bitte geben Sie ein neues Passwort ein!", "ADMIN")
        If NPW1 = "" Then Exit Sub
        If Not NPW1 = "" Then
            NPW2 = InputBox("Bitte wiederholen Sie das neue Passwort ein!", "ADMIN")
            If NPW1 = NPW2 Then
                Sheets("Daten").Range("B6").Value = NPW2
                Sheets("Daten").Activate
                Application.ScreenUpdating = False
                Range("A65536").End(xlUp).Offset(1, 0).Select
                ActiveCell.Offset(0, 0).Value = Format(Date, "DD.MM.YYYY")
                ActiveCell.Offset(0, 1).Value = "Admin Passwort wurde ge|fffd|ndert!"
                ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
                Sheets("Center").Activate
                MsgBox "Passwort wurde erfolgreich gespeichert!", , "Hinweis"
                Application.ScreenUpdating = True
                Exit Sub
            Else
                MsgBox "Passwort stimmt nicht |fffd|berein!", , "Hinweis"
                Exit Sub
            End If
        Else
            Exit Sub
        End If
    Else
        MsgBox "Falsches Passwort", , "Hinweis"
    End If
End Sub

Private Sub cmdArtikelHochkomma_Click()
    Dim intmsg As Integer
    intmsg = MsgBox("Diese Funktion ben|fffd|tigen Sie nur, wenn Sie Ihre Artikel nicht |fffd|ber die Maske angelegt haben! M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
    If intmsg = vbYes Then
        Call Hochkomma_setzen
        Call DatenAll2
        MsgBox "Artikelnummern wurden |fffd|berpr|fffd|ft!", , "Format"
    End If
End Sub

Private Sub cmdaus_Click()
    On Error Resume Next
    If Sheets("Daten").Range("B6").Value = "" Or Sheets("Daten").Range("B7").Value = "Admin" Then
        ThisWorkbook.Sheets("Lager").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Mitarbeiter").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Bestellung").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Wareneingang").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Warenausgang").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Mitarbeiter").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Inventur").Visible = xlVeryHidden
        ThisWorkbook.Sheets("StatistikGruppen").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Lieferanten").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Gruppen").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Kassendaten").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Reservierungen").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Kunden").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Leistungen").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Kostenstellen").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Verleih").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Verleih_Historie").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Preisverlauf").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Barcode").Visible = xlVeryHidden
        ThisWorkbook.Sheets("Lagerorte").Visible = xlVeryHidden
        ThisWorkbook.Sheets("VPEinheit").Visible = xlVeryHidden
     Else
        MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
        frmPW.Show
    End If
End Sub

Private Sub cmdein_Click()
    On Error Resume Next
    If Sheets("Daten").Range("B6").Value = "" Or Sheets("Daten").Range("B7").Value = "Admin" Then
        ThisWorkbook.Sheets("Lager").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Mitarbeiter").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Bestellung").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Wareneingang").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Warenausgang").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Mitarbeiter").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Inventur").Visible = xlSheetVisible
        ThisWorkbook.Sheets("StatistikGruppen").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Lieferanten").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Gruppen").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Kassendaten").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Reservierungen").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Kunden").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Leistungen").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Kostenstellen").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Verleih").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Verleih_Historie").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Preisverlauf").Visible = xlSheetVisible
        ThisWorkbook.Sheets("Lagerorte").Visible = xlSheetVisible
        ThisWorkbook.Sheets("VPEinheit").Visible = xlSheetVisible
    Else
        MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
        frmPW.Show
    End If
End Sub

Private Sub cmdLagerein_Click()
    If Sheets("Daten").Range("B6").Value = "" Or Sheets("Daten").Range("B7").Value = "Admin" Then
        If Sheets("Lager").Visible = xlSheetVisible Then
            MsgBox "Tabellenblatt WA, WE und Lager sind bereits eingeblendet!", , "Hinweis"
        Else
            ThisWorkbook.Sheets("Lager").Visible = xlSheetVisible
            ThisWorkbook.Sheets("Wareneingang").Visible = xlSheetVisible
            ThisWorkbook.Sheets("Warenausgang").Visible = xlSheetVisible
        End If
    Else
        MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
    End If
End Sub

Private Sub cmdMentf_Click()
    Dim blnMarkiert As Boolean
    Dim listenwert, lng, stxt As Long
    On Error Resume Next
    'Pruefen ob markiert
    For listenwert = 0 To lstStaff.ListCount - 1
        If lstStaff.Selected(listenwert) Then
            blnMarkiert = True
            Exit For
        End If
    Next listenwert
    If blnMarkiert = False Then
        MsgBox "Es wurde kein Mitarbeiter in der Liste makiert!", _
        vbExclamation, "Mitarbeiter l|fffd|schen!"
        Exit Sub
    End If
    stxt = MsgBox("Mitarbeiter (" + lstStaff.Column(1) + ") wirklich l|fffd|schen?", vbYesNo, "Hinweis")
    If stxt = vbNo Then Exit Sub
    lng = lstStaff.Column(3)
    cboanrede.ListIndex = -1
    cboabteilung.ListIndex = -1
    txtvn.Value = ""
    txtnn.Value = ""
    txt_Mzeile.Value = ""
    txttele.Value = ""
    txtmfax.Value = ""
    txtmemail.Value = ""
    cbo_berechigung.ListIndex = -1
    Sheets("Mitarbeiter").Rows(lng).Delete
    Call Msuchen
End Sub

Private Sub cmdMzu_Click()
    On Error Resume Next
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    If frmSettings.txtnn.Value = "" Then
        MsgBox "Sie m|fffd|ssen einen Namen angeben!", vbOKOnly, "Mitarbeiter"
        txtnn.SetFocus
        Exit Sub
    End If
    If frmSettings.cbo_berechigung = "" Then
        MsgBox "Sie m|fffd|ssen eine Berechtigung ausw|fffd|hlen!", vbOKOnly, "Berechtigung"
        cbo_berechigung.SetFocus
        Exit Sub
    End If
    Application.ScreenUpdating = False
    Sheets("Mitarbeiter").Activate
    Range("C65536").End(xlUp).Offset(1, 0).Select
    ActiveCell.Offset(0, -2).Value = cboanrede.Text
    ActiveCell.Offset(0, -1).Value = txtnn.Value
    ActiveCell.Offset(0, 0).Value = txtvn.Value
    ActiveCell.Offset(0, 1).Value = txtmemail.Value
    ActiveCell.Offset(0, 2).Value = "'" & txttele.Value
    ActiveCell.Offset(0, 3).Value = "'" & txtmfax.Value
    ActiveCell.Offset(0, 4).Value = cboabteilung.Text
    If cbo_berechigung = "Vollzugriff / Admin" Then
        ActiveCell.Offset(0, 6).Value = "Admin"
    End If
    cboanrede.Text = ""
    txtnn.Value = ""
    txtvn.Value = ""
    txtmemail.Value = ""
    txttele.Value = ""
    txtmfax.Value = ""
    cboabteilung.Text = ""
    lstStaff.Clear
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    Call Msuchen
    ActiveWorkbook.Save
End Sub

Private Sub cmd_import_Click()
    Dim lngM As Long
    If Sheets("Daten").Range("B6").Value = "" Or Sheets("Daten").Range("B7").Value = "Admin" Then
        lngM = MsgBox("M|fffd|chten Sie Ihre Daten aus einer |fffd|lteren Version importieren? Bitte beachten Sie, dass dieses erst ab der Version 1.25 m|fffd|glich ist, da sonst die Datei unbrauchbar/ fehlerhaft wird! Auch kann es Probleme mit der Excel Version 2007 geben!" _
        & vbCrLf & vbCrLf & "Bitte w|fffd|hlen Sie Ihre alte Datei aus!" & vbCrLf & vbCrLf & "M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
        If lngM = vbYes Then
            Unload frmSettings
            frmLaden.Show
            frmLaden.Label1.Caption = "Bitte warten Sie, Daten werden |fffd|bernommen!"
            Application.ScreenUpdating = False
            DoEvents
            Call frmSettings.Import
            Application.ScreenUpdating = True
            Unload frmLaden
        Else
            Exit Sub
        End If
     Else
        MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
        frmPW.Show
    End If
End Sub

Sub Import() '1.44
    Dim Dateiname As Variant
    Dim WB As Workbook
    Dim Einfo, stxt As String
    On Error Resume Next
    Einfo = Worksheets("Daten").Range("B1").Value
    Dateiname = Application.GetOpenFilename("XLSM-Dateien,*.xlsm")
    If Dateiname <> False Then
        Workbooks.Open Filename:=Dateiname
        Set WB = ActiveWorkbook
        With ThisWorkbook
            WB.Worksheets("Daten").UsedRange.COPY .Sheets("Daten").Range("A1")
            WB.Worksheets("Lager").UsedRange.COPY .Sheets("Lager").Range("A1")
            WB.Worksheets("Mitarbeiter").UsedRange.COPY .Sheets("Mitarbeiter").Range("A1")
            WB.Worksheets("Wareneingang").UsedRange.COPY .Sheets("Wareneingang").Range("A1")
            WB.Worksheets("Warenausgang").UsedRange.COPY .Sheets("Warenausgang").Range("A1")
            WB.Worksheets("Gruppen").UsedRange.COPY .Sheets("Gruppen").Range("A1")
            WB.Worksheets("Kassendaten").UsedRange.COPY .Sheets("Kassendaten").Range("A1")
            WB.Worksheets("Reservierungen").UsedRange.COPY .Sheets("Reservierungen").Range("A1")
            WB.Worksheets("Bestellung").UsedRange.COPY .Sheets("Bestellung").Range("A1")
            WB.Worksheets("Lieferanten").UsedRange.COPY .Sheets("Lieferanten").Range("A1")
            WB.Worksheets("Kunden").UsedRange.COPY .Sheets("Kunden").Range("A1")
            WB.Worksheets("Leistungen").UsedRange.COPY .Sheets("Leistungen").Range("A1")
            WB.Worksheets("Verleih").UsedRange.COPY .Sheets("Verleih").Range("A1")
            WB.Worksheets("Verleih_Historie").UsedRange.COPY .Sheets("Verleih_Historie").Range("A1")
            WB.Worksheets("Kostenstellen").UsedRange.COPY .Sheets("Kostenstellen").Range("A1")
            WB.Worksheets("Preisverlauf").UsedRange.COPY .Sheets("Preisverlauf").Range("A1")
            WB.Worksheets("Lagerorte").UsedRange.COPY .Sheets("Lagerorte").Range("A1")
            WB.Worksheets("VPEinheit").UsedRange.COPY .Sheets("VPEinheit").Range("A1")
            If Not WB.Worksheets("Daten").Range("D1").Value = "" Then
                stxt = WB.Worksheets("Daten").Range("D1").Value
                ThisWorkbook.Worksheets.Add.Name = stxt
                WB.Worksheets(stxt).UsedRange.COPY .Sheets(stxt).Range("A1")
            End If
        End With
    Else
        MsgBox "Keine Datei ausgew|fffd|hlt!", , "Hinweis"
        Set WB = Nothing
        Exit Sub
    End If
    Worksheets("Warenausgang").Range("P6") = "UmSt."
    WB.Close savechanges:=False
    Worksheets("Daten").Range("B1").Value = Einfo
    Worksheets("Daten").Range("B17").Value = "Import" 'nach Datenimport
    Worksheets("Daten").Range("B8").Value = "1,44"
    Worksheets("Daten").Range("B45").Value = "1.44GER18092019"
    Worksheets("Daten").Range("A25") = "VorlageBest"
    Worksheets("Daten").Range("A26") = "DVorlageFuss"
    Worksheets("Daten").Range("A23") = "Anmeldezei:t"
    txtcompany.Value = Sheets("Daten").Range("B9").Text
    txtadress.Value = Sheets("Daten").Range("B10").Text
    txtPLZ.Value = Sheets("Daten").Range("B11").Text
    txtAnsprech.Value = Sheets("Daten").Range("B12").Text
    txtphone.Value = Sheets("Daten").Range("B13").Text
    txtfax.Value = Sheets("Daten").Range("B14").Text
    txtEmail.Value = Sheets("Daten").Range("B15").Text
    txtHomepage.Value = Sheets("Daten").Range("B16").Text
    Worksheets("Daten").Range("B2").NumberFormat = "0.0%"
    Worksheets("Daten").Range("B3").NumberFormat = "0.0%"
    Worksheets("Barcode").Range("A1").Value = "ID"
    Worksheets("Barcode").Range("B1").Value = "Artikelnummer"
    Worksheets("Barcode").Range("C1").Value = "Bezeichnung"
    Worksheets("Barcode").Range("D1").Value = "Menge"
    Worksheets("Barcode").Range("E1").Value = "Preis"
    Worksheets("Barcode").Range("F1").Value = "frei"
    Worksheets("Barcode").Range("G1").Value = "frei"
    Worksheets("Barcode").Range("H1").Value = "HNr"
    Worksheets("Barcode").Range("I1").Value = "Barcode"
    Worksheets("Reservierungen").Range("N1").Value = "Gewicht" 'alt MWST
    Worksheets("Reservierungen").Range("O1").Value = "RN Druck" 'alt Frei
    Worksheets("Reservierungen").Range("P1").Value = "LS Druck" 'alt Frei
    Worksheets("Kassendaten").Range("N1").Value = "Gewicht" 'alt MWST
    Worksheets("Kassendaten").Range("O1").Value = "RN Druck" 'alt Frei
    Worksheets("Kassendaten").Range("P1").Value = "LS Druck" 'alt Frei
    Worksheets("Warenausgang").Range("U6").Value = "Lagerplatz LP-ID"
    Worksheets("Warenausgang").Range("V6").Value = "Lieferscheinnummer"
    Worksheets("Warenausgang").Range("W6").Value = "Aufrags -Nr"
    Worksheets("Daten").Range("C1").Value = "Name"
    Worksheets("Daten").Range("C2").Value = "Auswahl1"
    Worksheets("Daten").Range("C3").Value = "Auswahl2"
    Worksheets("Daten").Range("C4").Value = "Auswahl3"
    Worksheets("Daten").Range("C5").Value = "Auswahl4"
    Worksheets("Daten").Range("C6").Value = "Auswahl5"
    Worksheets("Daten").Range("C7").Value = "Druckbereich"
    Worksheets("Daten").Range("C8").Value = "Druckbereich"
    Worksheets("Daten").Range("C9").Value = "Barcode:"
    Worksheets("Daten").Range("C10").Value = "Barcode:"
    Worksheets("Daten").Range("C11").Value = "Barcode:"
    Worksheets("Daten").Range("C12").Value = "Barcode:"
    Worksheets("Daten").Range("C13").Value = "Barcode:"
    Worksheets("Daten").Range("C14").Value = "Barcode HL:"
    Worksheets("Daten").Range("C15").Value = "Barcode NB:"
    Worksheets("Daten").Range("C16").Value = "BarcodeMAngabe:"
    Worksheets("Daten").Range("C17").Value = "Farbig Druck:"
    Worksheets("Daten").Range("C18").Value = "Szeit:"
    Worksheets("Daten").Range("C20").Value = "AufSort:"
    Worksheets("Daten").Range("C21").Value = "WA Verfuegbarkeit:"
    Worksheets("Daten").Range("C22").Value = "Kostenstelle Drucken:"
    Worksheets("Daten").Range("C23").Value = "RN:"
    Worksheets("Daten").Range("C24").Value = "RN_Textteil:"
    Worksheets("Daten").Range("C25").Value = "RN_Zahl:"
    Worksheets("Daten").Range("C26").Value = "Zeichen:"
    Worksheets("Daten").Range("C27").Value = "VN:"
    Worksheets("Daten").Range("C28").Value = "Text:"
    Worksheets("Daten").Range("C29").Value = "Zahl:"
    Worksheets("Daten").Range("C30").Value = "Zeichen:"
    Worksheets("Daten").Range("C31").Value = "AU:"
    Worksheets("Daten").Range("C32").Value = "Text:"
    Worksheets("Daten").Range("C33").Value = "Zahl:"
    Worksheets("Daten").Range("C34").Value = "Zeichen:"
    Worksheets("Daten").Range("C35").Value = "AN:"
    Worksheets("Daten").Range("C36").Value = "Text:"
    Worksheets("Daten").Range("C37").Value = "Zahl:"
    Worksheets("Daten").Range("C38").Value = "Zeichen:"
    Worksheets("Daten").Range("C39").Value = "BE:"
    Worksheets("Daten").Range("C40").Value = "Text:"
    Worksheets("Daten").Range("C41").Value = "Zahl:"
    Worksheets("Daten").Range("C42").Value = "Zeichen:"
    Worksheets("Daten").Range("E23").Value = "LS:"
    Worksheets("Daten").Range("E24").Value = "RN_Textteil:"
    Worksheets("Daten").Range("E25").Value = "RN_Zahl:"
    Worksheets("Daten").Range("E26").Value = "Zeichen:"
    Worksheets("Lager").Range("R1").Value = "Hauptlieferant"
    Worksheets("Lager").Range("S1").Value = "Frei"
    Set WB = Nothing
    Sheets("Druckvorlage").Range("E11:F13").Select
    With Selection.Font
        .Name = "Arial"
        .Size = 14
    End With
    Sheets("Center").Activate
    MsgBox "Daten wurden |fffd|bernommen! Starten Sie das Projekt NEU und |fffd|berpr|fffd|fen Sie Ihre Daten!", , "Hinweis!"
End Sub

Private Sub cmd_RID_Click()
    Dim slng As Long
    If Sheets("Daten").Range("B6").Value = "" Or Sheets("Daten").Range("B7").Value = "Admin" Then
        slng = MsgBox("M|fffd|chten Sie wirklich alle ID`s zur|fffd|cksetzen?" & vbLf & "(Artikel ID, Kunden ID und Leistungs ID)", vbYesNo, "ID")
        If slng = vbYes Then
            Worksheets("Daten").Range("B20") = CDbl("0")
            Worksheets("Daten").Range("B19") = CDbl("0")
            Worksheets("Daten").Range("B18") = CDbl("0")
            Worksheets("Daten").Range("B43") = CDbl("0")
            Worksheets("Daten").Range("B24") = ""
            Worksheets("Daten").Range("B27:B30") = ""
            Worksheets("Daten").Range("B31") = "Y"
            Worksheets("Daten").Range("B33") = ""
            Worksheets("Daten").Range("B41") = ""
            Worksheets("Daten").Range("B48") = ""
            Worksheets("Daten").Range("D43") = 0
            ActiveWorkbook.Save
            MsgBox "Die ID's wurden zur|fffd|ckgesetzt!", , "Hinweis"
        Else
            Exit Sub
        End If
    Else
        MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
        frmPW.Show
    End If
End Sub

Private Sub cmdexit_Click()
    On Error Resume Next
    Application.ScreenUpdating = False
    Sheets("Center").Unprotect
    txtcompany.SetFocus
    With frmSettings
        ThisWorkbook.Sheets("Center").Range("L15") = CDbl(Format(.txttax1.Value, "#.#0,0"))
        ThisWorkbook.Sheets("Center").Range("L16") = CDbl(Format(.txttax2.Value, "#.#0,0"))
        ThisWorkbook.Sheets("Daten").Range("B2") = CDbl(Format(.txttax1.Value, "#.#0,0"))
        ThisWorkbook.Sheets("Daten").Range("B3") = CDbl(Format(.txttax2.Value, "#.#0,0"))
        ThisWorkbook.Sheets("Center").Range("D12") = .txtcompany.Value
        ThisWorkbook.Sheets("Center").Range("D13") = .txtadress.Value
        ThisWorkbook.Sheets("Center").Range("D14") = "'" & .txtPLZ.Value
        ThisWorkbook.Sheets("Center").Range("D15") = .txtAnsprech.Value
        ThisWorkbook.Sheets("Center").Range("D16") = "'" & .txtphone.Text
        ThisWorkbook.Sheets("Center").Range("D17") = "'" & .txtfax.Text
        ThisWorkbook.Sheets("Center").Range("D18") = .txtEmail.Value
        ThisWorkbook.Sheets("Center").Range("D19") = .txtHomepage.Text
        ThisWorkbook.Sheets("Daten").Range("B9") = .txtcompany.Value
        ThisWorkbook.Sheets("Daten").Range("B10") = .txtadress.Value
        ThisWorkbook.Sheets("Daten").Range("B11") = "'" & .txtPLZ.Value
        ThisWorkbook.Sheets("Daten").Range("B12") = .txtAnsprech.Value
        ThisWorkbook.Sheets("Daten").Range("B13") = "'" & .txtphone.Text
        ThisWorkbook.Sheets("Daten").Range("B14") = "'" & .txtfax.Text
        ThisWorkbook.Sheets("Daten").Range("B15") = .txtEmail.Value
        ThisWorkbook.Sheets("Daten").Range("B16") = .txtHomepage.Value
        ThisWorkbook.Sheets("Daten").Range("F31") = .txt_Bezug.Value
        ThisWorkbook.Sheets("Daten").Range("F32") = .txt_Hand.Value
        ThisWorkbook.Sheets("Daten").Range("F33") = .txt_gewinn.Value
        ThisWorkbook.Sheets("Daten").Range("F34") = .txt_Kskonto.Value
        ThisWorkbook.Sheets("Daten").Range("F35") = .txt_Krabatt.Value
        ThisWorkbook.Sheets("Reservierungen").Range("N1") = "Gewicht"
        ThisWorkbook.Sheets("Reservierungen").Range("O1") = "Frei"
        ThisWorkbook.Sheets("Kassendaten").Range("N1") = "Gewicht"
        ThisWorkbook.Sheets("Kassendaten").Range("O1") = "Frei"
        If Check_PrintCompany.Value = True Then
            ThisWorkbook.Sheets("Druckvorlage").Range("A1") = txtcompany & " - " & txtadress & " - " & txtPLZ
        End If
    End With
    Call UebernFN
    Sheets("Lager").Cells(1, 5) = txtFrei
    Sheets("Center").Protect
    Unload frmSettings
    Application.ScreenUpdating = True
End Sub

Sub UebernFN()
    Dim lng, lng2, lng3 As Long
    Dim strF, strF2, strF3 As String
    On Error Resume Next
    
    If cbo_BE = "Auswahl 1" Then
        If txt_ZahlBE = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Bestellung"
            txt_ZahlBE.BorderStyle = True
            txt_ZahlBE.BorderColor = &HFF&
            txt_ZahlBE.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D40").Value = "'" & CStr(txt_TextBE)
        Sheets("Daten").Range("D41").Value = "'" & CStr(txt_ZahlBE)
        lng = CLng(Len(txt_ZahlBE))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D42").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D42").Value = CStr("#Bestellung#")
        Sheets("Daten").Range("D40").Value = "'" & CStr(txt_TextBE)
        Sheets("Daten").Range("D41").Value = "'" & CStr(txt_ZahlBE)
    End If
    strF3 = ""
    If cbo_LS = "Auswahl 1" Then
        If txt_ZahlLS = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Lieferschein"
            txt_ZahlLS.BorderStyle = True
            txt_ZahlLS.BorderColor = &HFF&
            txt_ZahlLS.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("F24").Value = "'" & CStr(txt_TextLS)
        Sheets("Daten").Range("F25").Value = "'" & CStr(txt_ZahlLS)
        lng = CLng(Len(txt_ZahlLS))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("F26").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("F26").Value = CStr("#Lieferschein#")
        Sheets("Daten").Range("F24").Value = "'" & CStr(txt_TextLS)
        Sheets("Daten").Range("F25").Value = "'" & CStr(txt_ZahlLS)
    End If
    strF3 = ""
    If cbo_AN = "Auswahl 1" Then
        If txt_ZahlAN = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Angebot"
            txt_ZahlAN.BorderStyle = True
            txt_ZahlAN.BorderColor = &HFF&
            txt_ZahlAN.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D36").Value = "'" & CStr(txt_TextAN)
        Sheets("Daten").Range("D37").Value = "'" & CStr(txt_ZahlAN)
        lng = CLng(Len(txt_ZahlAN))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D38").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D38").Value = CStr("#Angebot#")
        Sheets("Daten").Range("D36").Value = "'" & CStr(txt_TextAN)
        Sheets("Daten").Range("D37").Value = "'" & CStr(txt_ZahlAN)
    End If
    strF3 = ""
    If cbo_RE = "Auswahl 1" Then
        If txt_ZahlRE = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Rechnung"
            txt_ZahlRE.BorderStyle = True
            txt_ZahlRE.BorderColor = &HFF&
            txt_ZahlRE.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D24").Value = "'" & CStr(txt_TextRE)
        Sheets("Daten").Range("D25").Value = "'" & CStr(txt_ZahlRE)
        lng = CLng(Len(txt_ZahlRE))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D26").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D26").Value = CStr("#Rechnung#")
        Sheets("Daten").Range("D24").Value = "'" & CStr(txt_TextRE)
        Sheets("Daten").Range("D25").Value = "'" & CStr(txt_ZahlRE)
    End If
    strF3 = ""
    If cbo_AU = "Auswahl 1" Then
        If txt_ZahlAU = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Auftrag"
            txt_ZahlAU.BorderStyle = True
            txt_ZahlAU.BorderColor = &HFF&
            txt_ZahlAU.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D32").Value = "'" & CStr(txt_TextAU)
        Sheets("Daten").Range("D33").Value = "'" & CStr(txt_ZahlAU)
        lng = CLng(Len(txt_ZahlAU))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D34").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D34").Value = CStr("#Auftrag#")
        Sheets("Daten").Range("D32").Value = "'" & CStr(txt_TextAU)
        Sheets("Daten").Range("D33").Value = "'" & CStr(txt_ZahlAU)
    End If
    strF3 = ""
    If cbo_VM = "Auswahl 1" Then
        If txt_ZahlVM = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Vermietung"
            txt_ZahlVM.BorderStyle = True
            txt_ZahlVM.BorderColor = &HFF&
            txt_ZahlVM.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D28").Value = "'" & CStr(txt_TextVM)
        Sheets("Daten").Range("D29").Value = "'" & CStr(txt_ZahlVM)
        lng = CLng(Len(txt_ZahlVM))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D30").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D30").Value = CStr("#Vermietung#")
        Sheets("Daten").Range("D28").Value = "'" & CStr(txt_TextVM)
        Sheets("Daten").Range("D29").Value = "'" & CStr(txt_ZahlVM)
    End If
End Sub

Private Sub cmdResetNr_Click()
    If Sheets("Daten").Range("B6").Value = "" Or Sheets("Daten").Range("B7").Value = "Admin" Then
        Call Reset
        Exit Sub
    Else
        MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
        frmPW.Show
    End If
    Call Reset
End Sub

Private Sub cmdDrucker_Click()
    Application.Dialogs(xlDialogPrinterSetup).Show
End Sub

Private Sub txttax1_Enter()
    frmSettings.txttax1.Value = ""
End Sub

Private Sub txttax2_Enter()
    frmSettings.txttax2.Value = ""
End Sub

Private Sub txttax1_BeforeDropOrPaste(ByVal Cancel As MSForms.ReturnBoolean, ByVal Action As MSForms.fmAction, ByVal Data As MSForms.DataObject, ByVal x As Single, ByVal Y As Single, ByVal Effect As MSForms.ReturnEffect, ByVal Shift As Integer)
    frmSettings.txttax1.Value = ""
End Sub

Private Sub txttax1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    frmSettings.txttax1.Value = Format(txttax1.Value / 100, "0.0%")
End Sub

Private Sub txttax2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    frmSettings.txttax2.Value = Format(txttax2.Value / 100, "0.0%")
End Sub

Sub Reset()
    Dim strBN As String
    strBN = MsgBox("Fortlaufende Belegnummern zur|fffd|cksetzen? ", vbYesNo + vbQuestion, "Info")
    If strBN = vbYes Then
        With Worksheets("Warenausgang")
            .Range("B2") = 0
            .Range("B5") = 0
        End With
        MsgBox "Wurde zur|fffd|ckgesetzt!", , "Hinweis"
    End If
End Sub

Sub Msuchen()
    Dim lngZeile, i As Long
    On Error Resume Next
    lstStaff.Clear
    lstStaff.ColumnCount = 2
    lstStaff.ColumnWidths = "100;140"
    i = 0
    Application.ScreenUpdating = False
    For lngZeile = 2 To Sheets("Mitarbeiter").UsedRange.Rows.Count
        lstStaff.AddItem Sheets("Mitarbeiter").Cells(lngZeile, 7).Value
        lstStaff.Column(1, i) = Sheets("Mitarbeiter").Cells(lngZeile, 3).Value & ", " & Sheets("Mitarbeiter").Cells(lngZeile, 2).Value
        lstStaff.Column(3, i) = Sheets("Mitarbeiter").Cells(lngZeile, 15).Row
        i = i + 1
    Next lngZeile
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_AN_Change()
    Sheets("Daten").Range("D35").Value = cbo_AN
    If cbo_AN = "Nein" Then
        txt_ZahlAN.Enabled = False
        txt_TextAN.Enabled = False
        frmV2AN.Enabled = False
        frmV1AN.Enabled = False
        Exit Sub
    ElseIf cbo_AN = "Auswahl 1" Then
        frmV2AN.Enabled = False
        txt_ZahlAN.Enabled = True
        txt_TextAN.Enabled = True
        frmV1AN.Enabled = True
    Else
        frmV1AN.Enabled = False
        frmV2AN.Enabled = True
    End If
End Sub

Private Sub cbo_AU_Change()
    Sheets("Daten").Range("D31").Value = cbo_AU
    If cbo_AU = "Nein" Then
        txt_ZahlAU.Enabled = False
        txt_TextAU.Enabled = False
        frmV2AU.Enabled = False
        frmV1AU.Enabled = False
        Exit Sub
    ElseIf cbo_AU = "Auswahl 1" Then
        frmV2AU.Enabled = False
        txt_ZahlAU.Enabled = True
        txt_TextAU.Enabled = True
        frmV1AU.Enabled = True
    Else
        frmV1AU.Enabled = False
        frmV2AU.Enabled = True
    End If
End Sub

Private Sub cbo_BE_Change()
    Sheets("Daten").Range("D39").Value = cbo_BE
    If cbo_BE = "Nein" Then
        txt_ZahlBE.Enabled = False
        txt_TextBE.Enabled = False
        frmV2BE.Enabled = False
        frmV1BE.Enabled = False
        Exit Sub
    ElseIf cbo_BE = "Auswahl 1" Then
        frmV2BE.Enabled = False
        txt_ZahlBE.Enabled = True
        txt_TextBE.Enabled = True
        frmV1BE.Enabled = True
    Else
        frmV1BE.Enabled = False
        frmV2BE.Enabled = True
    End If
End Sub

Private Sub cbo_LS_Change()
    Sheets("Daten").Range("F23").Value = cbo_LS
    If cbo_LS = "Nein" Then
        txt_ZahlLS.Enabled = False
        txt_TextLS.Enabled = False
        frmV2LS.Enabled = False
        frmV1LS.Enabled = False
        Exit Sub
    ElseIf cbo_LS = "Auswahl 1" Then
        frmV2LS.Enabled = False
        txt_ZahlLS.Enabled = True
        txt_TextLS.Enabled = True
        frmV1LS.Enabled = True
    Else
        frmV1LS.Enabled = False
        frmV2LS.Enabled = True
    End If
End Sub

Private Sub cbo_RE_Change()
    Sheets("Daten").Range("D23").Value = cbo_RE
    If cbo_RE = "Nein" Then
        txt_ZahlRE.Enabled = False
        txt_TextRE.Enabled = False
        frmV2RE.Enabled = False
        frmV1RE.Enabled = False
        Exit Sub
    ElseIf cbo_RE = "Auswahl 1" Then
        frmV2RE.Enabled = False
        txt_ZahlRE.Enabled = True
        txt_TextRE.Enabled = True
        frmV1RE.Enabled = True
    Else
        frmV1RE.Enabled = False
        frmV2RE.Enabled = True
    End If
End Sub

Private Sub cbo_VM_Change()
    Sheets("Daten").Range("D27").Value = cbo_VM
    If cbo_VM = "Nein" Then
        txt_ZahlVM.Enabled = False
        txt_TextVM.Enabled = False
        frmV2VM.Enabled = False
        frmV1VM.Enabled = False
        Exit Sub
    ElseIf cbo_VM = "Auswahl 1" Then
        frmV2VM.Enabled = False
        txt_ZahlVM.Enabled = True
        txt_TextVM.Enabled = True
        frmV1VM.Enabled = True
    Else
        frmV1VM.Enabled = False
        frmV2VM.Enabled = True
    End If
End Sub

Private Sub cmd_exit_Click()
    Dim lng, lng2, lng3 As Long
    Dim strF, strF2, strF3 As String
    On Error Resume Next
    If cbo_BE = "Auswahl 1" Then
        If txt_ZahlBE = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Bestellung"
            txt_ZahlBE.BorderStyle = True
            txt_ZahlBE.BorderColor = &HFF&
            txt_ZahlBE.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D40").Value = "'" & CStr(txt_TextBE)
        Sheets("Daten").Range("D41").Value = "'" & CStr(txt_ZahlBE)
        lng = CLng(Len(txt_ZahlBE))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D42").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D42").Value = CStr("#Bestellung#")
        Sheets("Daten").Range("D40").Value = "'" & CStr(txt_TextBE)
        Sheets("Daten").Range("D41").Value = "'" & CStr(txt_ZahlBE)
    End If
    strF3 = ""
    If cbo_LS = "Auswahl 1" Then
        If txt_ZahlLS = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Lieferschein"
            txt_ZahlLS.BorderStyle = True
            txt_ZahlLS.BorderColor = &HFF&
            txt_ZahlLS.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("F24").Value = "'" & CStr(txt_TextLS)
        Sheets("Daten").Range("F25").Value = "'" & CStr(txt_ZahlLS)
        lng = CLng(Len(txt_ZahlLS))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("F26").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("F26").Value = CStr("#Lieferschein#")
        Sheets("Daten").Range("F24").Value = "'" & CStr(txt_TextLS)
        Sheets("Daten").Range("F25").Value = "'" & CStr(txt_ZahlLS)
    End If
    strF3 = ""
    If cbo_AN = "Auswahl 1" Then
        If txt_ZahlAN = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Angebot"
            txt_ZahlAN.BorderStyle = True
            txt_ZahlAN.BorderColor = &HFF&
            txt_ZahlAN.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D36").Value = "'" & CStr(txt_TextAN)
        Sheets("Daten").Range("D37").Value = "'" & CStr(txt_ZahlAN)
        lng = CLng(Len(txt_ZahlAN))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D38").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D38").Value = CStr("#Angebot#")
        Sheets("Daten").Range("D36").Value = "'" & CStr(txt_TextAN)
        Sheets("Daten").Range("D37").Value = "'" & CStr(txt_ZahlAN)
    End If
    strF3 = ""
    If cbo_RE = "Auswahl 1" Then
        If txt_ZahlRE = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Rechnung"
            txt_ZahlRE.BorderStyle = True
            txt_ZahlRE.BorderColor = &HFF&
            txt_ZahlRE.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D24").Value = "'" & CStr(txt_TextRE)
        Sheets("Daten").Range("D25").Value = "'" & CStr(txt_ZahlRE)
        lng = CLng(Len(txt_ZahlRE))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D26").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D26").Value = CStr("#Rechnung#")
        Sheets("Daten").Range("D24").Value = "'" & CStr(txt_TextRE)
        Sheets("Daten").Range("D25").Value = "'" & CStr(txt_ZahlRE)
    End If
    strF3 = ""
    If cbo_AU = "Auswahl 1" Then
        If txt_ZahlAU = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Auftrag"
            txt_ZahlAU.BorderStyle = True
            txt_ZahlAU.BorderColor = &HFF&
            txt_ZahlAU.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D32").Value = "'" & CStr(txt_TextAU)
        Sheets("Daten").Range("D33").Value = "'" & CStr(txt_ZahlAU)
        lng = CLng(Len(txt_ZahlAU))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D34").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D34").Value = CStr("#Auftrag#")
        Sheets("Daten").Range("D32").Value = "'" & CStr(txt_TextAU)
        Sheets("Daten").Range("D33").Value = "'" & CStr(txt_ZahlAU)
    End If
    strF3 = ""
    If cbo_VM = "Auswahl 1" Then
        If txt_ZahlVM = "" Then
            MsgBox "Sie m|fffd|ssen mindestens einen Wert (Zahl) angeben!", vbCritical, "Vermietung"
            txt_ZahlVM.BorderStyle = True
            txt_ZahlVM.BorderColor = &HFF&
            txt_ZahlVM.SetFocus
            Exit Sub
        End If
        Sheets("Daten").Range("D28").Value = "'" & CStr(txt_TextVM)
        Sheets("Daten").Range("D29").Value = "'" & CStr(txt_ZahlVM)
        lng = CLng(Len(txt_ZahlVM))
        For lng2 = 1 To lng
            strF3 = strF3 & "0"
        Next lng2
        Sheets("Daten").Range("D30").Value = "'" & CStr(strF3)
    Else
        Sheets("Daten").Range("D30").Value = CStr("#Vermietung#")
        Sheets("Daten").Range("D28").Value = "'" & CStr(txt_TextVM)
        Sheets("Daten").Range("D29").Value = "'" & CStr(txt_ZahlVM)
    End If
End Sub

Private Sub txt_ZahlLS_Change()
    If Not txt_ZahlLS = "" Then
        If Not IsNumeric(txt_ZahlLS) Then
            SendKeys "{BS}"
        End If
    End If
End Sub

Private Sub txt_ZahlRE_Change()
    If Not txt_ZahlRE = "" Then
        If Not IsNumeric(txt_ZahlRE) Then
            SendKeys "{BS}"
        End If
    End If
End Sub
Attribute VB_Name = "frmVInfo"
Attribute VB_Base = "0{52541400-4718-4D06-9424-352F822158B1}{9CB4BC20-FC55-4D9D-B60F-08BCB50009C4}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    cmd_einlagern.Caption = "Einlagern" & vbLf & "R|fffd|cknahme"
    cmd_Zustand.Caption = "Zustandsbeleg" & vbLf & "Drucken"
    cmd_VerleihScan.Caption = "Einlagern" & vbLf & "|ll ll Scannen l ll||"
    txt_DatumV.Value = Format(Date, "DD.MM.YYYY")
    Call suchenVerleihNr
End Sub

Sub suchenVerleihNr() '1.44
    Dim Last_Row, lngKID, arrTmpA, arrTmpB, i, j, n As Long
    Dim douKau As Double
    Dim BoxListe As String
    
    BoxListe = "Verleih"
    lst_VerleihI.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 8, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If frmVerleih.cbo_VNr = arrTmpA(i, 1) And Not arrTmpA(i, 18) = "" Then
                douKau = douKau + arrTmpA(i, 12)
            End If
            If frmVerleih.cbo_VNr = arrTmpA(i, 1) Then
                n = n + 1
                If arrTmpA(i, 18) = "" Then
                    txt_KID.Value = CStr(arrTmpA(i, 2))
                End If
                arrTmpB(1, n) = arrTmpA(i, 5)
                arrTmpB(2, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(3, n) = arrTmpA(i, 9)
                arrTmpB(4, n) = arrTmpA(i, 10)
                If Not arrTmpA(i, 18) = "" Then
                    arrTmpB(5, n) = Format(CDbl(0 - arrTmpA(i, 12)), "currency")
                Else
                    If arrTmpA(i, 11) = "unbegrenzt" Then
                        If arrTmpA(i, 12) = "" Then
                            arrTmpB(5, n) = Format(CDbl(arrTmpA(i, 13) * (DateDiff("d", arrTmpA(i, 9), txt_DatumV.Value))), "currency")
                        Else
                            arrTmpB(5, n) = Format(arrTmpA(i, 12), "currency")
                        End If
                    Else
                        If arrTmpA(i, 13) = "" Then
                            arrTmpB(5, n) = Format(arrTmpA(i, 12), "currency")
                        Else
                            arrTmpB(5, n) = Format(CDbl(arrTmpA(i, 13) * (DateDiff("d", arrTmpA(i, 9), arrTmpA(i, 10)))), "currency")
                        End If
                    End If
                End If
                arrTmpB(6, n) = arrTmpA(i, 8)
                arrTmpB(7, n) = i
                arrTmpB(8, n) = arrTmpA(i, 4)
            End If
        Next i
        txt_Kaution.Value = Format(douKau, "currency")
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 8)
            For i = 1 To 8
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lst_VerleihI
                .ColumnCount = 7
                .MultiSelect = fmMultiSelectMulti
                .ListStyle = fmListStyleOption
                .ColumnWidths = "100;180;70;70;60;50;0"
                .List = arrTmpA
            End With
        End If
    End With
    lngKID = Worksheets("Kunden").Range("A:A").Find(txt_KID.Text, LookIn:=xlValues, MatchCase:=True).Row
    txt_KDNr.Value = Sheets("Kunden").Cells(CLng(lngKID), 3)
    If Sheets("Kunden").Cells(CLng(lngKID), 4) = "Firma" Then
        txt_KDName.Value = "Firma" & " " & Sheets("Kunden").Cells(CLng(lngKID), 7)
    Else
        txt_KDName.Value = Sheets("Kunden").Cells(CLng(lngKID), 7) & ", " & Sheets("Kunden").Cells(CLng(lngKID), 6)
    End If
    txt_KDAdress.Value = Sheets("Kunden").Cells(CLng(lngKID), 8)
    txt_KDOrt.Value = Sheets("Kunden").Cells(CLng(lngKID), 10)
    txt_KDPLZ.Value = Sheets("Kunden").Cells(CLng(lngKID), 9)
    txt_phone.Value = Sheets("Kunden").Cells(CLng(lngKID), 11)
    Call SummeVerleih
    Call WKselect_all
End Sub

Private Sub check_SecAll_Click()
    Dim intRow As Long
    If Me!lst_VerleihI.ListCount = 0 Then
        check_SecAll = False
        Exit Sub
    End If
    If check_SecAll = False Then
        For intRow = 0 To Me!lst_VerleihI.ListCount - 1
            Me!lst_VerleihI.Selected(intRow) = False
        Next intRow
    Else
        Call WKselect_all
    End If
End Sub

Sub WKselect_all()
    Dim intRow As Long
    For intRow = 0 To Me!lst_VerleihI.ListCount - 1
        Me!lst_VerleihI.Selected(intRow) = True
    Next intRow
    check_SecAll.Value = True
End Sub

Private Sub cmd_DateEL_Click()
    frmKalender.txt_UID = "VMEL"
    frmKalender.Show
End Sub

Private Sub cmd_VerleihScan_Click()
    If lst_VerleihI.ListCount = 0 Then Exit Sub
    frmBarcode.txt_BarcodeArt.Value = "verleihAus"
    frmBarcode.txt_KasseNr.Value = txt_VNr.Value
    frmBarcode.Caption = "Verleih Nr.: " & txt_VNr.Value
    frmBarcode.cmd_BCAusbuchen.Caption = "Verleih ausscannen!"
    frmBarcode.check_HLager.Enabled = False
    frmBarcode.lbl_HLager.Enabled = False
    frmBarcode.check_NBestand.Enabled = False
    frmBarcode.lbl_NBestand.Enabled = False
    frmBarcode.Show
End Sub

Private Sub cmd_PosLoeschen_Click() '1.44
    Dim lngZeile, lngIndex, l, lz, stxt As Long
    Dim Last_Row, arrTmpA, arrTmpB, i As Long
    Dim LagerWert, strPl As String
    
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    With lst_VerleihI
        For l = 0 To lst_VerleihI.ListCount - 1
            If lst_VerleihI.Selected(l) = True Then
                stxt = MsgBox("M|fffd|chten Sie den Artikel (" + frmVInfo.lst_VerleihI.Column(1, l) + ") aus dem Verleih (" + txt_VNr + ") l|fffd|schen?", vbYesNo, "Pos. entfernen")
                If stxt = vbNo Then
                    lst_VerleihI.Selected(l) = False
                    GoTo weiter
                End If
                lst_VerleihI.Selected(l) = True
                With ThisWorkbook.Worksheets("Verleih")
                    lngZeile = lst_VerleihI.Column(6, l)
                    If lst_VerleihI.Column(0, l) = "Kaution" Then GoTo weiter
                    LagerWert = Sheets("Verleih").Cells(lngZeile, 4).Text
                    If Not Sheets("Verleih").Cells(lngZeile, 18) = "" Then
                        If Sheets("Verleih").Cells(lngZeile, 17) = "" Then
                            With ThisWorkbook.Sheets("Lager")
                                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                                arrTmpA = .Range("A1:AO" & Last_Row)
                                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                                For i = 2 To UBound(arrTmpA)
                                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(LagerWert) Then
                                        lngIndex = i
                                    End If
                                Next i
                            End With
                            Sheets("Lager").Cells(lngIndex, 8).Value = Sheets("Lager").Cells(lngIndex, 8).Value + _
                                                             CDbl(lst_VerleihI.Column(5, l))
                        Else
                            strPl = Sheets("Verleih").Cells(lngZeile, 17)
                            With ThisWorkbook.Sheets("Lagerorte")
                                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                                arrTmpA = .Range("A1:AO" & Last_Row)
                                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                                For i = 2 To UBound(arrTmpA)
                                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strPl) Then
                                        lngIndex = i
                                    End If
                                Next i
                            End With
                            Sheets("Lagerorte").Cells(lngIndex, 4).Value = Sheets("Lagerorte").Cells(lngIndex, 4).Value + _
                                                             CDbl(lst_VerleihI.Column(5, l))
                        End If
                    End If
                End With
            End If
weiter:
        Next
    End With
    With lst_VerleihI
        For lz = .ListCount - 1 To 0 Step -1
            If lst_VerleihI.Selected(lz) = True Then
                With ThisWorkbook.Worksheets("Verleih")
                    .Rows(lst_VerleihI.Column(6, lz)).Delete
                End With
            End If
        Next
    End With
    ActiveWorkbook.Save
    If lst_VerleihI.ListCount = 0 Then
        Unload frmVInfo
    Else
        UserForm_Initialize
    End If
End Sub

Private Sub cmd_VBDrucken_Click()
    frmMitarbeiter.Caption = "Verleih - Beleg"
    frmMitarbeiter.txt_Verleih.Value = "verleih"
    frmMitarbeiter.Frame3.Visible = False
    frmMitarbeiter.Check_Pprint.Visible = False
    frmMitarbeiter.Label3.Visible = False
    frmMitarbeiter.lbl_Date.Visible = False
    frmMitarbeiter.txt_Lieferdatum.Visible = False
    frmMitarbeiter.Show
End Sub

Private Sub cmd_VMenge_Click() '1.44
    Dim lngLine, l, lng As Long
    Dim strArticle, lngMsg As String
    Dim Last_Row, arrTmpA, arrTmpB, i As Long
    On Error GoTo weiter

    With lst_VerleihI
        For l = 0 To .ListCount - 1
            If .Selected(l) Then
                If lst_VerleihI.Column(0, l) = "Kaution" Then
                        MsgBox "Kaution kann nicht ge|fffd|ndert werden!", , "Hinweis"
                        GoTo weiter1
                    End If
                lngMsg = InputBox("Bitte geben Sie eine neue Menge f|fffd|r den Artikel (" + frmVInfo.lst_VerleihI.Column(1, l) + ") an!", "Neue Menge")
                If lngMsg = "" Then Exit Sub
                If Not IsNumeric(lngMsg) Then
                    MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
                    Exit Sub
                End If
                With ThisWorkbook.Worksheets("Verleih")
                    strArticle = lst_VerleihI.Column(7, l)
                    With ThisWorkbook.Sheets("Lager")
                        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AO" & Last_Row)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strArticle) Then
                                lngLine = i
                            End If
                        Next i
                    End With
                    Sheets("Lager").Cells(lngLine, 8).Value = Sheets("Lager").Cells(lngLine, 8).Value + _
                                                    CDbl(lst_VerleihI.List(l, 5)) 'Menge zur|fffd|ck buchen
                    Sheets("Lager").Cells(lngLine, 8).Value = Sheets("Lager").Cells(lngLine, 8).Value - _
                                                 CDbl(lngMsg)
                    
                    lng = frmVInfo.lst_VerleihI.Column(6, l) 'Zeileninfo
                    Sheets("Verleih").Cells(lng, 8).Value = Sheets("Verleih").Cells(lng, 8).Value - _
                                                         CDbl(lst_VerleihI.Column(5, l)) 'alte Menge zurruecksetzen
                    Sheets("Verleih").Cells(lng, 8).Value = Sheets("Verleih").Cells(lng, 8).Value + _
                                                         CDbl(lngMsg) 'neue Menge hinzu buchen
weiter1:
                End With
            End If
        Next
    End With
    Call suchenVerleihNr
    Exit Sub
weiter:
    MsgBox "Es ist leider ein Fehler passiert. Bitte pr|fffd|fen Sie Ihr Lager", , "Hinweis"
End Sub

Private Sub cmd_Zustand_Click()
    frmMitarbeiter.Caption = "Verleih - Zustand"
    frmMitarbeiter.txt_Verleih.Value = "zustand"
    frmMitarbeiter.Frame3.Visible = False
    frmMitarbeiter.Check_Pprint.Visible = False
    frmMitarbeiter.Label3.Visible = False
    frmMitarbeiter.lbl_Date.Visible = False
    frmMitarbeiter.txt_Lieferdatum.Visible = False
    frmMitarbeiter.Show
End Sub

Private Sub cmdchanel_Click()
    frmVerleih.lbl_bild.Visible = False
    Set frmVerleih.Image1.Picture = Nothing
    frmVerleih.lst_Verleih.ListIndex = -1
    frmVerleih.lst_VerleihK.ListIndex = -1
    Unload frmVInfo
End Sub

Private Sub cmdexit_Click()
    Call frmVerleih.leeren
    frmVerleih.lbl_bild.Visible = False
    Set frmVerleih.Image1.Picture = Nothing
    If Not frmLager.txt_item.Value = "" Then
        Call frmLager.Asuchen
    End If
    Unload frmVInfo
End Sub

Private Sub cmd_einlagern_Click()
    Dim strF As String
    Dim lngID As Long
    
    frmKasseWA.txt_Verleih.Value = "Verleih"
    frmKasseWA.Caption = "Verleih / Ware einlagern" & " (" & txt_VNr.Value & ")"
    frmKasseWA.txt_KDNr = txt_KDNr.Value
    frmKasseWA.txt_Kunde = txt_KDName.Value
    frmKasseWA.txt_VerwWA.Visible = False
    frmKasseWA.Label38.Visible = False
    frmKasseWA.Label39.Visible = False
    frmKasseWA.lbl_LSprint.Visible = False
    frmKasseWA.Check_LSprint.Visible = False
    frmKasseWA.Check_REprint.Enabled = True
    frmKasseWA.lbl_REprint.Enabled = True
    If Sheets("Daten").Range("D23").Value = "Nein" Or Sheets("Daten").Range("D23").Value = "" Then
        frmKasseWA.txt_Nummer.Value = txt_VNr.Text
        frmKasseWA.cmd_REAUF.Caption = "Rechnungsnummer = Verleih-Nr."
        frmKasseWA.Check_auto.Enabled = False
    Else
        frmKasseWA.Check_auto.Value = True
        frmKasseWA.Check_VorG.Value = True
        frmKasseWA.lbl_VorG.Enabled = True
        If Sheets("Daten").Range("B5").Value = "True" Then
            If Not Sheets("Daten").Range("B7").Value = "Admin" Then
                frmKasseWA.txt_Nummer.Enabled = False
            End If
        End If
        If Sheets("Daten").Range("D23").Value = "Auswahl 2" Then
            lngID = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(txt_KID.Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
            If Worksheets("Kunden").Cells(CLng(lngID), 6) = "" Then
                frmKasseWA.txt_Nummer.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & Format(Date, "YYYYMMDD")
            Else
                frmKasseWA.txt_Nummer.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & "_" & UCase(Worksheets("Kunden").Cells(CLng(lngID), 6)) & Format(Date, "YYYYMMDD")
            End If
        Else
            strF = Sheets("Daten").Range("D26")
            frmKasseWA.txt_Nummer.Value = Sheets("Daten").Range("D24") & Format((Sheets("Daten").Range("D25") + 1), strF)
        End If
    End If
    frmKasseWA.Show
End Sub

Private Sub cmd_VAusL_Click()
    Dim stxt, s2txt As String
    Dim l, lz As Long
    Dim Last_Row, arrTmpA, arrTmpB, i, xrow As Long
    On Error Resume Next
    
    If Sheets("Daten").Range("B5").Value = "True" Then
        If Not Sheets("Daten").Range("B7").Value = "Admin" Then
            MsgBox "Keine Berechtigung!" & vbCrLf & "Bitte melden Sie sich als Admin an!", , "Admin"
            Exit Sub
        End If
    End If
    stxt = MsgBox("M|fffd|chten Sie die ausgew|fffd|hlten Position/en auslagern?" & vbLf & vbLf & "Wichtig: Der Bestand wird nicht ins Lager zur|fffd|ck gebucht!", vbQuestion & vbYesNo, "Hinweis")
    If stxt = vbNo Then Exit Sub
    Application.ScreenUpdating = False
    s2txt = InputBox("M|fffd|chten Sie einen Grund angeben? (z.B. Verbrauchsmaterial oder Defekt).", "Verleih auslagern")
    Sheets("Warenausgang").Activate
    With ThisWorkbook.Worksheets("Warenausgang")
        With lst_VerleihI
            For l = 0 To lst_VerleihI.ListCount - 1
                If lst_VerleihI.Column(0, l) = "Kaution" Then
                    MsgBox "Kaution kann nicht ausgelagert werden!", , "Hinweis"
                    GoTo weiter
                End If
                If lst_VerleihI.Selected(l) = True Then
                    Range("A500000").End(xlUp).Offset(1, 0).Select
                    ActiveCell.Offset(0, 0) = "Verleih"
                    ActiveCell.Offset(0, 1) = "'" & frmVInfo.txt_VNr.Value
                    ActiveCell.Offset(0, 2) = lst_VerleihI.Column(0, l) 'Artikelnummer
                    ActiveCell.Offset(0, 3) = lst_VerleihI.Column(1, l) 'Bezeichnung
                    ActiveCell.Offset(0, 4) = CDbl(lst_VerleihI.Column(5, l)) 'Menge
                    ActiveCell.Offset(0, 7) = Format(Date, "DD.MM.YYYY") 'Datum
                    ActiveCell.Offset(0, 8) = Format(Now, "HH:MM:SS") 'Zeit
                    ActiveCell.Offset(0, 9) = s2txt
                    ActiveCell.Offset(0, 10) = Format(Date, "MMMM")
                    ActiveCell.Offset(0, 11) = Format(Date, "YYYY")
                    With ThisWorkbook.Sheets("Lager")
                        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AO" & Last_Row)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_VerleihI.Column(7, l)) Then
                                xrow = i
                            End If
                        Next i
                    End With
                    ActiveCell.Offset(0, 12) = Sheets("Lager").Cells(CLng(xrow), 14)
                    ActiveCell.Offset(0, 13) = lst_VerleihI.Column(7, l) 'ID
                    ActiveCell.Offset(0, 16) = "'" & frmVInfo.txt_KID.Value 'KDID
                    ActiveCell.Offset(0, 17) = frmLager.lbl_Benutzer
                End If
weiter:
            Next
        End With
    End With
    With lst_VerleihI
        For lz = .ListCount - 1 To 0 Step -1
            If lst_VerleihI.Selected(lz) = True Then
                If Not lst_VerleihI.Column(0, lz) = "Kaution" Then
                    With ThisWorkbook.Worksheets("Verleih")
                        .Rows(lst_VerleihI.Column(6, lz)).Delete
                    End With
                End If
            End If
        Next
    End With
    Call suchenVerleihNr
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    Sheets("Center").Activate
    If lst_VerleihI.ListCount = 0 Then
        Unload frmVInfo
    Else
        UserForm_Initialize
    End If
End Sub

Private Sub txt_DatumV_Change()
    Call suchenVerleihNr
End Sub

Private Sub SummeVerleih()
    Dim wert As Double
    Dim Sgl As Single
    On Error Resume Next
    
    For Sgl = 0 To lst_VerleihI.ListCount - 1
        wert = wert + lst_VerleihI.List(Sgl, 4)
    Next Sgl
    txt_Verleihgesamtkosten.Value = Format((wert), "currency")
End Sub

Private Sub PrintRE() '1.42
    Dim zeLB, zeTB, spLB, KIDlng, Farbe, Pos, azeile, lngKID As Long
    Dim nSelCount, l, lngCount As Long
    Dim Kopien As Variant
    Dim allesDrucken As Boolean
    On Error Resume Next
    
    lngCount = frmVInfo.lst_VerleihI.ListCount
    With frmVInfo.lst_VerleihI
        For l = 0 To .ListCount - 1
          If .Selected(l) Then
            nSelCount = nSelCount + 1
          End If
        Next
    End With
    Application.ScreenUpdating = False
    Sheets("Druckvorlage").Activate
    Sheets("Druckvorlage").Visible = True
    Range("Druckvorlage!A17:F150").Clear
    Range("Druckvorlage!A17:F150").Font.Size = 9
    lngKID = Worksheets("Kunden").Range("A:A").Find(txt_KID.Text, LookIn:=xlValues, MatchCase:=True).Row
    Range("Druckvorlage!A3") = Sheets("Kunden").Cells(CDbl(lngKID), 6) & " " & Sheets("Kunden").Cells(CDbl(lngKID), 7)
    Range("Druckvorlage!A4") = txt_KDAdress.Value
    Range("Druckvorlage!A6") = txt_KDPLZ & " " & txt_KDAdress
    Range("Druckvorlage!D2") = "RE - Nummer:"
    Range("Druckvorlage!E2") = "'" & frmVInfo.txt_VNr.Value
    Range("Druckvorlage!D3") = ""
    Range("Druckvorlage!E3") = ""
    Range("Druckvorlage!A9") = ""
    Range("Druckvorlage!E11") = "Rechnung / Verleih / Vermietung"
    Range("Druckvorlage!C11") = frmLager.lbl_Benutzer
    Range("Druckvorlage!E16") = ""
    Range("Druckvorlage!F16") = "Betrag"
    Range("Druckvorlage!D5") = "Kundennummer:"
    Range("Druckvorlage!E4") = Date
    Range("Druckvorlage!E5") = "'" & Sheets("Kunden").Cells(CDbl(lngKID), 3)
    Range("Druckvorlage!E6") = ""
    Range("Druckvorlage!D6") = ""
    If nSelCount < lngCount Then
        Range("Druckvorlage!F14") = "Teilrechnung"
    Else
        Range("Druckvorlage!F14") = ""
    End If
    For zeLB = 0 To frmVInfo.lst_VerleihI.ListCount - 1
        allesDrucken = allesDrucken Or frmVInfo.lst_VerleihI.Selected(zeLB)
    Next
    zeTB = 17
    Pos = 1
    azeile = 0
    With frmVInfo.lst_VerleihI
        For zeLB = 0 To .ListCount - 1
            If .Selected(zeLB) Then
                Sheets("Druckvorlage").Cells(zeTB, 1) = Pos
                Sheets("Druckvorlage").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 1).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 2) = "'" & frmVInfo.lst_VerleihI.List(zeLB, 0)
                Sheets("Druckvorlage").Cells(zeTB, 2).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 2).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 3) = frmVInfo.lst_VerleihI.List(zeLB, 1)
                Sheets("Druckvorlage").Cells(zeTB, 3).HorizontalAlignment = xlLeft
                Sheets("Druckvorlage").Cells(zeTB, 3).WrapText = True
                Sheets("Druckvorlage").Cells(zeTB, 3).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 4) = frmVInfo.lst_VerleihI.List(zeLB, 5) 'Menge
                Sheets("Druckvorlage").Cells(zeTB, 4).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 4).VerticalAlignment = xlTop
                Sheets("Druckvorlage").Cells(zeTB, 6) = Format(CDbl(frmVInfo.lst_VerleihI.List(zeLB, 4)), "currency")
                Sheets("Druckvorlage").Cells(zeTB, 6).HorizontalAlignment = xlRight
                Sheets("Druckvorlage").Cells(zeTB, 6).VerticalAlignment = xlTop
                zeTB = zeTB + 1
                Pos = Pos + 1
            End If
        Next
    End With
    If Worksheets("Daten").Range("B3").Value = Worksheets("Daten").Range("B2").Value Then
        Sheets("Druckvorlage").Cells(zeTB + 2, 5) = "Zwischensumme:"
        Sheets("Druckvorlage").Cells(zeTB + 2, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 2, 6) = Format(CDbl(frmVInfo.txt_Verleihgesamtkosten.Value), "currency")
        Sheets("Druckvorlage").Cells(zeTB + 2, 6).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 3, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %"
        Sheets("Druckvorlage").Cells(zeTB + 3, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "Gesamtsumme:"
        Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 7, 1) = "Mit freundlichem Gru|fffd|"
        Sheets("Druckvorlage").Cells(zeTB + 10, 1) = Worksheets("Daten").Range("B9")
    Else
        Sheets("Druckvorlage").Cells(zeTB + 2, 5) = "Zwischensumme:"
        Sheets("Druckvorlage").Cells(zeTB + 2, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 2, 6) = Format(CDbl(frmVInfo.txt_Verleihgesamtkosten.Value), "currency")
        Sheets("Druckvorlage").Cells(zeTB + 2, 6).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 4, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B3") * 100) & " %:"
        Sheets("Druckvorlage").Cells(zeTB + 4, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 5, 5) = "MwSt " & CDbl(Worksheets("Daten").Range("B2") * 100) & " %:"
        Sheets("Druckvorlage").Cells(zeTB + 5, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 6, 5) = "Gesamtsumme:"
        Sheets("Druckvorlage").Cells(zeTB + 6, 5).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 6, 6) = Format(CDbl(Format(frmVInfo.txt_Verleihgesamtkosten.Value)), "currency")
        Sheets("Druckvorlage").Cells(zeTB + 6, 6).HorizontalAlignment = xlRight
        Sheets("Druckvorlage").Cells(zeTB + 8, 1) = "Mit freundlichem Gru|fffd|"
        Sheets("Druckvorlage").Cells(zeTB + 8, 1).Font.Size = 11
        If frmContact.cboAnsp = "" Then
            Sheets("Druckvorlage").Cells(zeTB + 11, 1) = Worksheets("Daten").Range("B9")
            Sheets("Druckvorlage").Cells(zeTB + 11, 1).Font.Size = 11
        Else
            Sheets("Druckvorlage").Cells(zeTB + 11, 1) = frmContact.cboAnsp.Text
            Sheets("Druckvorlage").Cells(zeTB + 11, 1).Font.Size = 11
        End If
    End If
    Kopien = Application.InputBox("Anzahl Kopien", "Rechnung drucken", 1)
    If Kopien = False Then
        Exit Sub
        Application.ScreenUpdating = True
    End If
    Worksheets("Druckvorlage").PrintOut Copies:=CLng(Kopien)
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    frmVInfo.txt_KDID.Value = txt_KDID.Value
End Sub

Sub VREinlagern() 'v1.44
    Dim l, Last_Row, arrTmpA, arrTmpB, i, xrow As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    If frmKasseWA.Check_REprint.Value = True Then
        Call PrintRE
    End If
    Sheets("Verleih_Historie").Activate
    With ThisWorkbook.Worksheets("Verleih_Historie")
        With lst_VerleihI
            For l = 0 To lst_VerleihI.ListCount - 1
                If lst_VerleihI.Selected(l) = True Then
                    Range("A500000").End(xlUp).Offset(1, 0).Select
                    ActiveCell.Offset(0, 0) = "'" & frmVInfo.txt_VNr.Value
                    ActiveCell.Offset(0, 1) = "'" & frmVInfo.txt_KID.Value
                    ActiveCell.Offset(0, 2) = frmVInfo.txt_KDName
                    ActiveCell.Offset(0, 3) = lst_VerleihI.Column(7, l)
                    ActiveCell.Offset(0, 4) = lst_VerleihI.Column(0, l)
                    With ThisWorkbook.Sheets("Lager")
                        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA = .Range("A1:AO" & Last_Row)
                        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                        For i = 2 To UBound(arrTmpA)
                            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lst_VerleihI.Column(7, l)) Then
                                xrow = i
                            End If
                        Next i
                    End With
                    If Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 18) = "" Then
                        ActiveCell.Offset(0, 5) = Sheets("Lager").Cells(CLng(xrow), 4)
                    End If
                    ActiveCell.Offset(0, 6) = lst_VerleihI.Column(1, l)
                    If Not frmKasseWA.cbo_kosten = "" Then
                        ActiveCell.Offset(0, 7) = Sheets("Kostenstellen").Cells(frmKasseWA.cbo_kosten.ListIndex + 2, 1)
                    End If
                    ActiveCell.Offset(0, 8) = Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 7)
                    ActiveCell.Offset(0, 9) = Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 8)
                    ActiveCell.Offset(0, 11) = CDbl(lst_VerleihI.Column(4, l))
                    If IsDate(Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 9)) Then
                        ActiveCell.Offset(0, 12) = CDate(Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 9))
                    Else
                        ActiveCell.Offset(0, 12) = Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 9)
                    End If
                    If IsDate(Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 10)) Then
                        ActiveCell.Offset(0, 13) = CDate(Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 10))
                    Else
                        ActiveCell.Offset(0, 13) = Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 10)
                    End If
                    ActiveCell.Offset(0, 14) = Sheets("Verleih").Cells(lst_VerleihI.Column(6, l), 16)
                    ActiveCell.Offset(0, 15) = CDate(frmKasseWA.txt_WADatum.Value)
                    ActiveCell.Offset(0, 16) = Format(CDate(frmKasseWA.txt_WADatum.Value), "MMMM")
                    ActiveCell.Offset(0, 17) = Format(CDate(frmKasseWA.txt_WADatum.Value), "YYYY")
                    ActiveCell.Offset(0, 18) = frmLager.lbl_Benutzer
                End If
            Next
        End With
    End With
    Sheets("Center").Activate
    Call Loeschen
    Application.ScreenUpdating = True
    MsgBox "Die Ware wurde wieder in den Lagerbestand gebucht!", , "Einlagern"
    Unload frmKasseWA
    If lst_VerleihI.ListCount = 0 Then
        Unload frmVInfo
    End If
    frmVerleih.lst_VerleihK.Clear
    Call frmVerleih.Kunden
    Call frmVerleih.suchen
    Call frmVerleih.SuchenKunden
    Call frmVerleih.SuchenVNr
    Call frmVerleih.V2List
End Sub

Sub Loeschen() '1.44
    Dim lngIndex, l, lz, lngZeile As Long
    Dim LagerWert, strPl As String
    Dim Last_Row, arrTmpA, arrTmpB, i As Long
    On Error Resume Next
    With lst_VerleihI
        For l = 0 To lst_VerleihI.ListCount - 1
            If lst_VerleihI.Selected(l) = True Then
                lst_VerleihI.Selected(l) = True
                With ThisWorkbook.Worksheets("Verleih")
                    lngZeile = lst_VerleihI.Column(6, l)
                    LagerWert = Sheets("Verleih").Cells(lngZeile, 4).Text
                    If Sheets("Verleih").Cells(lngZeile, 18) = "" Then
                        If Sheets("Verleih").Cells(lngZeile, 17) = "" Then
                            With ThisWorkbook.Sheets("Lager")
                                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                                arrTmpA = .Range("A1:AO" & Last_Row)
                                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                                For i = 2 To UBound(arrTmpA)
                                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(LagerWert) Then
                                        lngIndex = i
                                    End If
                                Next i
                            End With
                            Sheets("Lager").Cells(lngIndex, 8).Value = Sheets("Lager").Cells(lngIndex, 8).Value + _
                                                             CDbl(lst_VerleihI.Column(5, l))
                        Else
                            strPl = Sheets("Verleih").Cells(lngZeile, 17)
                            With ThisWorkbook.Sheets("Lagerorte")
                                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                                arrTmpA = .Range("A1:AO" & Last_Row)
                                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                                For i = 2 To UBound(arrTmpA)
                                    If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(strPl) Then
                                        lngIndex = i
                                    End If
                                Next i
                            End With
                            Sheets("Lagerorte").Cells(lngIndex, 4).Value = Sheets("Lagerorte").Cells(lngIndex, 4).Value + _
                                                             CDbl(lst_VerleihI.Column(5, l))
                        End If
                    End If
                End With
            End If
weiter:
        Next
    End With
    With lst_VerleihI
        For lz = .ListCount - 1 To 0 Step -1
            If lst_VerleihI.Selected(lz) = True Then
                With ThisWorkbook.Worksheets("Verleih")
                    .Rows(lst_VerleihI.Column(6, lz)).Delete
                End With
            End If
        Next
    End With
    ActiveWorkbook.Save
    UserForm_Initialize
End Sub
Attribute VB_Name = "frmVerlauf"
Attribute VB_Base = "0{07A8B14C-7794-47A2-94B4-8B2CDDA5AC11}{CFB30745-1E99-4285-BC4B-022963AD1177}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
End Sub

Private Sub cmd_close_Click()
    Unload frmVerlauf
End Sub

Sub Verlauf() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, lngS, j, n As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next
    
    Application.ScreenUpdating = False
    BoxListe = "Preisverlauf"
    SuchKriterium = LCase(frmArtikel.txtID.Text)
    list_Verlauf.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:G" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = SuchKriterium Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3) & " | " & CDate(arrTmpA(i, 6))
                arrTmpB(2, n) = Format(arrTmpA(i, 4), "currency")
                arrTmpB(3, n) = Format(arrTmpA(i, 5), "currency")
                If CDbl(arrTmpA(i, 4)) < CDbl(arrTmpA(i, 5)) Then
                    arrTmpB(4, n) = "+ " & Format(CDbl(arrTmpA(i, 5)) * 100 / CDbl(arrTmpA(i, 4)) - 100, "0.0") & "%"
                Else
                    arrTmpB(4, n) = "- " & Format(100 - (CDbl(arrTmpA(i, 5)) * 100 / CDbl(arrTmpA(i, 4))), "0.00") & "%"
                End If
                arrTmpB(5, n) = arrTmpA(i, 7)
                arrTmpB(6, n) = i
            End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 6)
            For i = 1 To 6
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With list_Verlauf
               .ColumnCount = 6
               .ColumnWidths = "100;80;80;75;100;0"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmVerleih"
Attribute VB_Base = "0{4014BADD-2707-4FA0-A1EA-E258015F819A}{9D33A886-6ECE-44B2-97F4-451E07C09A5E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cmd_Kaution_Click()
    Dim strMsg As String
    If txt_VNr.Value = "" Then
        MsgBox "Bitte geben Sie oben die Verleihnummer an!", , "Hinweis"
            txt_VNr.SetFocus
        Exit Sub
    End If
    strMsg = InputBox("Bitte geben Sie einen Betrag f|fffd|r die Kaution an! (" + txt_VNr + " / " + lbl_KDName + ")", "Kaution")
    If strMsg = "" Then Exit Sub
    If Not IsNumeric(strMsg) Then
        MsgBox "Bitte nur Zahlen eingeben", , "Hinweis"
        strMsg = InputBox("Bitte geben Sie einen Betrag f|fffd|r die Kaution an! (" + txt_VNr + " / " + lbl_KDName + ")", "Kaution")
    End If
    If strMsg = "" Then
        Exit Sub
    Else
        Application.ScreenUpdating = False
        Sheets("Verleih").Activate
        Range("A65536").End(xlUp).Offset(1, 0).Select
        ActiveCell.Offset(0, 0).Value = "'" & txt_VNr.Value 'Verleihnummer
        ActiveCell.Offset(0, 1).Value = "'" & txt_KDID.Value
        ActiveCell.Offset(0, 2).Value = "'" & lbl_KDName.Caption
        ActiveCell.Offset(0, 4).Value = "Kaution"
        ActiveCell.Offset(0, 5).Value = "Kautionszahlung " & "(" & Format(strMsg, "currency") & ")"
        ActiveCell.Offset(0, 7).Value = 0
        ActiveCell.Offset(0, 11).Value = CDbl(strMsg)
        ActiveCell.Offset(0, 13).Value = "'" & Format(Date, "DD.MM.YYYY")
        ActiveCell.Offset(0, 14).Value = frmLager.lbl_Benutzer
        ActiveCell.Offset(0, 17).Value = "ja"
        Sheets("Center").Activate
        Application.ScreenUpdating = False
    End If
    MsgBox "Eine Kaution wurde erfolgreich hinzugef|fffd|gt!", , "Hinweis"
End Sub

Private Sub txt_VBdatum_AfterUpdate()
    On Error Resume Next
    If Not txt_VBdatum.Value = "" Then
        If CDbl(CDate(txt_VBdatum.Value)) < CDbl(CDate(txt_VVdatum.Value)) Then
            MsgBox "Ung|fffd|ltiges Datum", , "Datum"
            txt_VBdatum.Value = ""
            txt_VBdatum.SetFocus
        End If
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    txt_Vnachnamen.SetFocus
    txt_VVdatum.Value = Date
    cmd_retoure.Caption = "> Verwalten <" & vbLf & "Einlagern & R|fffd|cknahme"
    With cbo_Liste
        .AddItem "Alle anzeigen"
        .AddItem "|fffd|berf|fffd|llige anzeigen"
        .ListIndex = 0
    End With
    Call Kunden
    Call suchen
    Call SuchenKunden
    Call SuchenVNr
    Call V2List
End Sub

Private Sub cbo_Kunden_Click()
    If Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 28) = "ja" Then
        MsgBox "Kunde (" & cbo_Kunden & ") ist gesperrt!", , "Hinweis"
        txt_KDID.Value = ""
        lbl_KDNR.Caption = ""
        lbl_KDName.Caption = ""
        lbl_KDAdress.Caption = ""
        lbl_KDPLZ.Caption = ""
        lbl_KDOrt.Caption = ""
        Exit Sub
    End If
    txt_KDID.Value = Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 1)
    lbl_KDNR.Caption = Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 3)
    lbl_KDName.Caption = Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 7) & ", " & Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 6)
    lbl_KDAdress.Caption = Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 8)
    lbl_KDPLZ.Caption = Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 9)
    lbl_KDOrt.Caption = Sheets("Kunden").Cells(cbo_Kunden.ListIndex + 2, 10)
    txt_VNr.SetFocus
End Sub

Sub KASuchen()
    Dim lngZeile, i, Alng, xrow As Long
    Dim andoubl As Double
    On Error Resume Next
    If txt_Vnachnamen = "" Then Exit Sub
    andoubl = 0
    For Alng = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
        If InStr(1, LCase(Sheets("Kunden").Cells(Alng, 7).Value), LCase(txt_Vnachnamen.Text)) > 0 Then
            andoubl = andoubl + 1
            i = i + 1
        End If
    Next Alng
    If andoubl >= 1 Then
        lst_VAuswahl.BackColor = &H80000005
        lst_VAuswahl.Clear
        lst_VAuswahl.ColumnCount = 2
        lst_VAuswahl.ColumnWidths = "100;0"
        i = 0
        For lngZeile = 2 To ThisWorkbook.Worksheets("Kunden").UsedRange.Rows.Count
            If InStr(1, LCase(Sheets("Kunden").Cells(lngZeile, 7).Value), LCase(txt_Vnachnamen.Text)) > 0 Then
                lst_VAuswahl.AddItem "ID " & Sheets("Kunden").Cells(lngZeile, 1).Value & " " & Sheets("Kunden").Cells(lngZeile, 7).Value & ", " & Sheets("Kunden").Cells(lngZeile, 6).Value
                lst_VAuswahl.Column(1, i) = Sheets("Kunden").Cells(lngZeile, 17).Row
                lst_VAuswahl.Column(2, i) = Sheets("Kunden").Cells(lngZeile, 1).Text
                i = i + 1
            End If
        Next lngZeile
        lst_VAuswahl.SetFocus
    Else
        lst_VAuswahl.Clear
        lst_VAuswahl.BackColor = &H80000004
        xrow = xFind(ActiveWorkbook.Name, ("Kunden"), txt_Vnachnamen.Value, "G:G")
        If xrow = False Then
            MsgBox "Es ist kein Kunde/Firma mit dem Namen (" + txt_Vnachnamen + ") vorhanden!", , "Hinweis"
            txt_Vnachnamen.SetFocus
            Exit Sub
        End If
        txt_KDID.Value = Sheets("Kunden").Cells(xrow, 1)
        lbl_KDNR.Caption = Sheets("Kunden").Cells(xrow, 3)
        lbl_KDName.Caption = Sheets("Kunden").Cells(xrow, 6) & " " & Sheets("Kunden").Cells(xrow, 7)
        lbl_KDAdress.Caption = Sheets("Kunden").Cells(xrow, 8)
        lbl_KDPLZ.Caption = Sheets("Kunden").Cells(xrow, 9)
        lbl_KDOrt.Caption = Sheets("Kunden").Cells(xrow, 10)
    End If
End Sub

Private Sub cbo_Lagerplatz_Change()
    Dim lng, lngID As Long
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    On Error Resume Next
    If cbo_Lagerplatz = "Hauptlagerplatz" Then
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txt_VArtikelID.Text) Then
                    lngID = i
                End If
            Next i
        End With
         txt_LMenge.Value = Sheets("Lager").Cells(lngID, 8)
         txt_LPID.Value = ""
    Else
        For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
            If Sheets("Lagerorte").Cells(lng, 2) = txt_VArtikelID.Text And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz.Text Then
                txt_LMenge.Value = Sheets("Lagerorte").Cells(lng, 4)
                txt_LPID.Value = Sheets("Lagerorte").Cells(lng, 1)
            End If
        Next lng
    End If
End Sub

Private Sub cbo_Liste_Click()
    If cbo_Liste = "|fffd|berf|fffd|llige anzeigen" Then
        Call V2TestDatum
        lst_Verleih.ForeColor = &HC0&
    Else
        lst_Verleih.ForeColor = &H404040
        Call V2List
    End If
End Sub

Private Sub cbo_SuchenK_Click()
    Call suchenVerleihK
    Call VerleihKunde
    If List_KundenList.ListCount = 0 Then
        List_KundenList.BackColor = &H80000004
    Else
        List_KundenList.BackColor = &HFFFFFF
    End If
    lst_Verleih.ListIndex = -1
    lst_VerleihK.ListIndex = -1
    Set frmVerleih.Image1.Picture = Nothing
    lbl_bild.Visible = False
End Sub

Private Sub cbo_VNr_Change()
    If Not cbo_VNr = "" Then
        lbl_VerleihnummerAus.ForeColor = &H8000&
        cmd_retoure.Enabled = True
        lst_Verleih.ListIndex = -1
        lst_VerleihK.ListIndex = -1
        Set frmVerleih.Image1.Picture = Nothing
        lbl_bild.Visible = False
    Else
        lbl_VerleihnummerAus.ForeColor = &HFF&
        cmd_retoure.Enabled = False
    End If
End Sub

Private Sub cbo_VNr_Click()
    Call suchenVerleihNr
End Sub

Private Sub cmd_Ksuchen_Click()
 Call KASuchen
End Sub

Private Sub cmd_NeuArtikel_Click()
    If Sheets("Daten").Range("B33").Value = "" Then
        frmArtikel.lbl_LArtikelNr.Caption = ""
    Else
        frmArtikel.lbl_LArtikelNr.Caption = "Letzte Artikel Nr.: " & Sheets("Daten").Range("B33").Value
    End If
    frmArtikel.txt_Verleih.Value = "Verleih"
    frmArtikel.cmdaendern.Visible = False
    frmArtikel.cmdNArtikel.Visible = False
    frmArtikel.txt_Artikelnummer.SetFocus
    frmArtikel.Show
End Sub

Private Sub cmd_NeuKunde_Click()
    frmKunden.cmd_KEmail.Enabled = False
    frmKunden.cmd_Ksuchen.Enabled = False
    frmKunden.cboKDNr.Enabled = False
    frmKunden.txt_Snachnamen.Enabled = False
    frmKunden.txt_KDNr.SetFocus
    frmKunden.txt_Verleih.Value = "Verleih"
    frmKunden.Show
End Sub

Private Sub VartikelHinzu()
    Dim intzeile, lngIndex, lngAID, lngZeile As Long
    Dim xwert As Double
    Dim SINP, strMsg, strVNR, strF, strNr As String
    Dim Last_Row, arrTmpA, arrTmpB, i, xrow As Long
    On Error Resume Next
    
    If lbl_VArtikelNr.Caption = "" Then Exit Sub
    If txt_VNr.Value = "" Then
        MsgBox "Bitte geben Sie eine eindeutige Verleihnummer an!", vbOKOnly, "Hinweis"
        txt_VNr.SetFocus
        Exit Sub
    End If
    If txt_VMenge.Value = "" Then
        MsgBox "Bitte geben Sie eine Menge an!", vbOKOnly, "Hinweis"
        txt_VMenge.SetFocus
        Exit Sub
    End If
    With Worksheets("Verleih")
        If .FilterMode Then .ShowAllData
    End With
    If CDbl(txt_VMenge.Value) > CDbl(txt_Verfuegbar.Value) Then
        strMsg = MsgBox("Die angegebene Menge ist gr|fffd||fffd|er als die Verf|fffd|gbare! M|fffd|chten Sie fortfahren?", vbYesNo + vbQuestion, "Hinweis")
        If strMsg = vbNo Then Exit Sub
    End If
    Application.ScreenUpdating = False
        lngZeile = Worksheets("Verleih").Cells(Rows.Count, 1).End(xlUp).Row
        Sheets("Verleih").Activate
        lngZeile = lngZeile + 1
        For lngAID = 2 To ThisWorkbook.Worksheets("Verleih").UsedRange.Rows.Count
            If Sheets("Verleih").Cells(lngAID, 4) = CStr(txt_VArtikelID.Value) And Sheets("Verleih").Cells(lngAID, 1) = CStr(txt_VNr.Text) Then
                xwert = Sheets("Verleih").Cells(lngAID, 8)
                Sheets("Verleih").Cells(lngAID, 8).Value = CDbl(xwert + txt_VMenge.Value)
                GoTo weiter
            End If
        Next lngAID
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txt_VArtikelID) Then
                    xrow = i
                End If
            Next i
        End With
        If Not Worksheets("Lager").Cells(CLng(xrow), 42) = "" Then
            MsgBox "Artikel ist gesperrt!", , "Hinweis"
            Exit Sub
            Application.ScreenUpdating = True
        End If
        If Worksheets("Lager").Cells(CLng(xrow), 30) = "Y" Then
            If txt_VMenge.Value > CDbl("1") Then
                MsgBox "Durch die Seriennummer kann immer nur ein Artikel hinzugef|fffd|gt werden", , "Hinweis"
                txt_VMenge.Value = CDbl("1")
            End If
            SINP = InputBox("Bitte geben Sie die Seriennummer an!" & vbLf & "Artikel: " + lbl_VBezeichnung.Caption + vbLf & vbLf & "Tipp: Sie k|fffd|nnen die Serien- Nr. auch scannen", "Seriennummer")
            If Not SINP = "" Then
                Worksheets("Verleih").Cells(lngZeile, 7).Value = SINP
                Worksheets("Verleih").Cells(lngZeile, 6).Value = lbl_VBezeichnung.Caption & " /SN:" & SINP
            Else
                Application.ScreenUpdating = True
                Exit Sub
            End If
        Else
            Worksheets("Verleih").Cells(lngZeile, 6).Value = lbl_VBezeichnung.Caption
        End If
        If Not txt_LPID.Value = "" Then
            With ThisWorkbook.Worksheets("Lagerorte")
                lngIndex = CDbl(Worksheets("Lagerorte").Range("A:A").Find(txt_LPID.Text, LookIn:=xlValues, MatchCase:=True).Row) 'Zeileninfo
                    .Cells(lngIndex, 4).Value = .Cells(lngIndex, 4).Value - CDbl(txt_VMenge.Value)
            End With
        Else
            With ThisWorkbook.Worksheets("Lager")
                With ThisWorkbook.Sheets("Lager")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:AO" & Last_Row)
                    ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(txt_VArtikelID.Text) Then
                            lngIndex = i
                        End If
                    Next i
                End With
                    .Cells(lngIndex, 8).Value = .Cells(lngIndex, 8).Value - CDbl(txt_VMenge.Value)
            End With
        End If
        If lst_VerleihK.ListCount = 0 Then
            strF = Sheets("Daten").Range("D30")
            strNr = Format(Sheets("Daten").Range("D29") + 1, strF)
            strVNR = CStr(Sheets("Daten").Range("D28")) & strNr
            If CStr(txt_VNr) = strVNR Then
                Sheets("Daten").Range("D29") = "'" & strNr
            End If
        End If
        Worksheets("Verleih").Cells(lngZeile, 1).Value = "'" & txt_VNr.Value 'Verleihnummer
        Worksheets("Verleih").Cells(lngZeile, 2).Value = "'" & txt_KDID.Value
        Worksheets("Verleih").Cells(lngZeile, 3).Value = "'" & lbl_KDName.Caption
        Worksheets("Verleih").Cells(lngZeile, 4).Value = "'" & txt_VArtikelID.Value
        Worksheets("Verleih").Cells(lngZeile, 5).Value = "'" & lbl_VArtikelNr.Caption
        Worksheets("Verleih").Cells(lngZeile, 6).Value = lbl_VBezeichnung.Caption
        Worksheets("Verleih").Cells(lngZeile, 7).Value = SINP
        Worksheets("Verleih").Cells(lngZeile, 8).Value = txt_VMenge.Value
        If Check_umbegr.Value = False Then
            Worksheets("Verleih").Cells(lngZeile, 9).Value = CDate(txt_VVdatum.Value)
            If txt_VBdatum.Value = "" Then
                Worksheets("Verleih").Cells(lngZeile, 10).Value = "unbegrenzt"
                Worksheets("Verleih").Cells(lngZeile, 11).Value = "unbegrenzt"
            Else
                Worksheets("Verleih").Cells(lngZeile, 10).Value = CDate(txt_VBdatum.Value)
            End If
        Else
            Worksheets("Verleih").Cells(lngZeile, 9).Value = CDate(txt_VVdatum.Value)
            Worksheets("Verleih").Cells(lngZeile, 10).Value = "unbegrenzt"
            Worksheets("Verleih").Cells(lngZeile, 11).Value = "unbegrenzt"
        End If
        If txt_VPreis.Value = "" Then
            Worksheets("Verleih").Cells(lngZeile, 12).Value = CDbl(0#)
        Else
            If Check_umbegr.Value = True And Check_ProDay.Value = True Then
                Worksheets("Verleih").Cells(lngZeile, 13).Value = txt_VPreis.Value
            Else
                If Check_ProDay.Value = True Then
                    Worksheets("Verleih").Cells(lngZeile, 12).Value = txt_VPreis.Value * (DateDiff("d", txt_VVdatum.Value, txt_VBdatum.Value))
                    Worksheets("Verleih").Cells(lngZeile, 13).Value = txt_VPreis.Value
                Else
                    Worksheets("Verleih").Cells(lngZeile, 12).Value = CDbl(txt_VPreis.Value)
                End If
            End If
        End If
        Worksheets("Verleih").Cells(lngZeile, 14).Value = Date
        Worksheets("Verleih").Cells(lngZeile, 15).Value = frmLager.lbl_Benutzer
        Worksheets("Verleih").Cells(lngZeile, 16).Value = txt_VKomentar.Value
        If Not txt_LPID.Value = "" Then
             Worksheets("Verleih").Cells(lngZeile, 17).Value = "'" & txt_LPID.Value
        End If
weiter:
        Call suchen
        Call SuchenVNr
        Call SuchenKunden
        Call SuchenID2
        Call AnsichtLager
        Call V2List
        Worksheets("Daten").Range("D10") = CStr(txt_VNr)
        lbl_VArtikelNr.Caption = ""
        lbl_VBezeichnung.Caption = ""
        lbl_VHerstellerNR.Caption = ""
        lbl_VHersteller.Caption = ""
        txt_VKomentar.Value = ""
        txt_VVdatum.Value = Date
        txt_VBdatum.Value = ""
        txt_VMenge.Value = ""
        txt_VPreis.Value = ""
        txt_VArtikelID.Value = ""
        lbl_Verfuegbar.Caption = ""
        cbo_VNr = txt_VNr.Value
        Check_ProDay.Value = False
        Check_umbegr.Value = False
        ActiveWorkbook.Save
        'Sortieren nach Nummer
        intzeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
        ActiveSheet.UsedRange.Sort Key1:=Range(Cells(1, 1), Cells(intzeile, 1)), Header:=xlYes
    Application.ScreenUpdating = True
    cbo_VNr = txt_VNr.Value
    Sheets("Center").Activate
End Sub

Private Sub cmd_KundeU_Click()
    If cbo_SuchenK = "" Then Exit Sub
    cbo_Kunden = cbo_SuchenK
End Sub

Private Sub cmd_ScanHinZu_Click()
    If lbl_KDName.Caption = "" Then Exit Sub
    If txt_VNr = "" Then
        txt_VNr.SetFocus
        Exit Sub
    End If
    frmBarcode.txt_BarcodeArt.Value = "verleih"
    frmBarcode.Caption = "Verleih " & "/ " & txt_VNr
    If lst_VerleihK.ListCount = 0 Then
        frmBarcode.cmd_BCAusbuchen.Caption = "Verleih erstellen!"
    Else
        frmBarcode.cmd_BCAusbuchen.Caption = "Verleih / hinzuf|fffd|gen!"
    End If
    frmBarcode.txt_KasseNr.Value = txt_VNr.Value
    If Application.Version Like "16*" Then
        If Sheets("Daten").Range("B35") = "Ja" And frmEingang.txt_SacnEin.Value = "" Then
            frmBarcode.Frame_Verleih.Visible = True
            frmBarcode.Frame_Verleih.Top = 374
            frmBarcode.Height = 467
            frmBarcode.Frame2.Top = 403
            frmBarcode.cbo_kostenBC.Visible = True
            frmBarcode.Frame_Verleih.Visible = True
            frmBarcode.Kostenstellen
        Else
            frmBarcode.Frame_Verleih.Visible = True
            frmBarcode.Frame2.Top = 360
            frmBarcode.Height = 424
        End If
    Else
        If Sheets("Daten").Range("B35") = "Ja" And frmEingang.txt_SacnEin.Value = "" Then
            frmBarcode.Frame_Verleih.Visible = True
            frmBarcode.Frame_Verleih.Top = 374
            frmBarcode.Height = 460
            frmBarcode.Frame2.Top = 404
            frmBarcode.cbo_kostenBC.Visible = True
            Call frmBarcode.Kostenstellen
        Else
            frmBarcode.Frame_Verleih.Visible = True
            frmBarcode.Frame_Verleih.Top = 353
            frmBarcode.Frame2.Top = 380
            frmBarcode.Height = 437
        End If
    End If
    frmBarcode.Show
End Sub

Private Sub cmd_SuchenKnamen_Click()
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next
    
    If txt_SuchenKnamen.Value = "" Then
        txt_SuchenKnamen.SetFocus
        Exit Sub
    End If
    BoxListe = "Verleih"
    SuchKriterium = LCase(txt_SuchenKnamen)
    lst_VerleihK.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:Q" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If InStr(1, LCase(arrTmpA(i, 3)), LCase(SuchKriterium)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 1)
                arrTmpB(2, n) = arrTmpA(i, 5)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 8)
                arrTmpB(5, n) = arrTmpA(i, 10)
                arrTmpB(6, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 6)
            For i = 1 To 6
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lst_VerleihK
                .ColumnCount = 6
                .ColumnWidths = "100;100;200;60;60;0"
                .List = arrTmpA
            End With
        Else
            MsgBox "Kein Treffer!", , "Kunden suche"
            With txt_SuchenKnamen
              .SetFocus
              .SelStart = 0
              .SelLength = Len(.Text)
            End With
            txt_SuchenKnamen.SetFocus
        End If
    End With
End Sub

Private Sub cmd_VArtikel_Click()
    Call VartikelHinzu
End Sub

Private Sub cmd_VnrInfo_Click()
    Dim lngID As Long
    Dim strF As String
    On Error Resume Next
    If lst_VerleihK.ListCount > 0 Then Exit Sub
    If Sheets("Daten").Range("D27").Value = "Nein" Or Sheets("Daten").Range("D27").Value = "" Then
        If Not Worksheets("Daten").Range("D10") = "" Then
            MsgBox "Vergeben Sie eine eindeutige Verleihnummer!" & vbLf & vbLf & "Letzte Verleihnummer: " & Worksheets("Daten").Range("D10"), , "Hinweis"
        Else
            MsgBox "Vergeben Sie eine eindeutige Verleihnummer!", , "Hinweis"
        End If
    Else
        If Sheets("Daten").Range("D27").Value = "Auswahl 2" Then
            If frmVerleih.txt_KDID = "" Then
                MsgBox "W|fffd|hlen Sie bitte erst ein Kunden aus!", , "hinweis"
                Exit Sub
            End If
            lngID = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(frmVerleih.txt_KDID.Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
            If Worksheets("Kunden").Cells(CLng(lngID), 6) = "" Then
                txt_VNr.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & Format(Date, "YYYYMMDD")
            Else
                txt_VNr.Value = UCase(Worksheets("Kunden").Cells(CLng(lngID), 7)) & "_" & UCase(Worksheets("Kunden").Cells(CLng(lngID), 6)) & Format(Date, "YYYYMMDD")
            End If
        Else
            strF = Sheets("Daten").Range("D30")
            txt_VNr.Value = Sheets("Daten").Range("D28") & Format((Sheets("Daten").Range("D29") + 1), strF)
        End If
    End If
    txt_VNr = LTrim(txt_VNr)
    txt_VNr.SetFocus
End Sub

Private Sub cmd_VNrU_Click()
    Dim lngZeile As Long
    On Error Resume Next
    
    If cbo_VNr = "" Then Exit Sub
    txt_VNr.Value = cbo_VNr
    For lngZeile = 2 To ThisWorkbook.Worksheets("Verleih").UsedRange.Rows.Count
        If cbo_VNr = Sheets("Verleih").Cells(lngZeile, 1).Text Then
            cbo_Kunden = Sheets("Verleih").Cells(lngZeile, 3)
            Exit Sub
        End If
    Next lngZeile
End Sub

Private Sub cmd_retoure_Click()
    If cbo_VNr = "" Then Exit Sub
    frmVInfo.txt_VNr = cbo_VNr
    Call frmVInfo.suchenVerleihNr
    frmVInfo.Show
End Sub

Sub VerleihKunde()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next

    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Verleih").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Verleih").Cells(lngZ, 3).Value = cbo_SuchenK Then
            objDic(Sheets("Verleih").Cells(lngZ, 1).Value) = 0
        End If
    Next
    List_KundenList.List = objDic.keys
    Set objDic = Nothing
End Sub

Private Sub cmd_SuchenVnr_Click()
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next
    
    If txt_SuchenVNr.Value = "" Then
        txt_SuchenVNr.SetFocus
        Exit Sub
    End If
    BoxListe = "Verleih"
    SuchKriterium = LCase(txt_SuchenVNr)
    lst_VerleihK.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:Q" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If InStr(1, LCase(arrTmpA(i, 1)), LCase(SuchKriterium)) > 0 Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 1)
                arrTmpB(2, n) = arrTmpA(i, 5)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 8)
                arrTmpB(5, n) = arrTmpA(i, 10)
                arrTmpB(6, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 6)
            For i = 1 To 6
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lst_VerleihK
                .ColumnCount = 6
                .ColumnWidths = "100;100;200;60;60;0"
                .List = arrTmpA
            End With
        Else
            MsgBox "Kein Treffer!", , "Verleihnummer suche"
            With txt_SuchenKnamen
              .SetFocus
              .SelStart = 0
              .SelLength = Len(.Text)
            End With
            txt_SuchenVNr.SetFocus
        End If
    End With
End Sub

Private Sub cmd_VHinzuWeiter_Click()
    If lbl_VArtikelNr.Caption = "" Then
        frmLager.txt_VKDID.Value = cbo_Kunden
        frmLager.txt_VNr.Value = txt_VNr.Value
        Unload frmVerleih
        frmLager.txt_item.SetFocus
    Else
        frmLager.txt_VKDID.Value = cbo_Kunden
        frmLager.txt_VNr.Value = txt_VNr.Value
        Call VartikelHinzu
        Unload frmVerleih
        frmLager.txt_item.SetFocus
    End If
End Sub

Private Sub cmd_printList_Click()
    If Not frmVerleih.lst_Verleih.ListCount = 0 Then
        Call ListePrint
    End If
End Sub

Sub ListePrint()
    Dim zeLB, zeTB, spLB, Farbe, lngW, Pos, azeile As Long
    Dim Kopien As Variant
    On Error Resume Next
    
    Application.ScreenUpdating = False
    Farbe = 1
    Sheets("Vorlage2").Visible = True
    Range("Vorlage2!A7:G200").Clear
    Range("Vorlage2!A7:G200").Font.Size = 9
    Sheets("Vorlage2").Range("A1") = "Verleih & Vermietung"
    Sheets("Vorlage2").Range("G1") = Date
    If cbo_Liste = "Alle anzeigen" Then
        Sheets("Vorlage2").Range("A3") = "Komplette Liste / Stand: (" & Date & ")"
    Else
        Sheets("Vorlage2").Range("A3") = "Ueberf|fffd|llige / Stand: (" & Date & ")"
    End If
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("A5") = ""
    Sheets("Vorlage2").Range("B6") = "Verleihnummer"
    Sheets("Vorlage2").Range("C6") = "Verliehen bis"
    Sheets("Vorlage2").Range("D6") = "Kunde"
    Sheets("Vorlage2").Range("E6") = ""
    Sheets("Vorlage2").Range("F6") = ""
    Sheets("Vorlage2").Range("G6") = ""
    Sheets("Vorlage2").Activate
    zeTB = 7
    lngW = 0
    Pos = 1
    azeile = 0
    '--- selektierte Listboxeintraege in Zellen schreiben
    With frmVerleih.lst_Verleih
        For zeLB = 0 To frmVerleih.lst_Verleih.ListCount - 1
            If Not frmVerleih.lst_Verleih.List(zeLB, 0) = "" Then
                Sheets("Vorlage2").Cells(zeTB, 1) = Pos
                Sheets("Vorlage2").Cells(zeTB, 1).HorizontalAlignment = xlLeft
                Sheets("Vorlage2").Cells(zeTB, 2) = "'" & frmVerleih.lst_Verleih.List(zeLB, 0)
                Sheets("Vorlage2").Cells(zeTB, 2).WrapText = True
                Sheets("Vorlage2").Cells(zeTB, 3) = frmVerleih.lst_Verleih.List(zeLB, 1)
                Sheets("Vorlage2").Cells(zeTB, 3).HorizontalAlignment = xlLeft
                Sheets("Vorlage2").Cells(zeTB, 3).WrapText = True
                Sheets("Vorlage2").Cells(zeTB, 4) = frmVerleih.lst_Verleih.List(zeLB, 2)
                Sheets("Vorlage2").Cells(zeTB, 4).HorizontalAlignment = xlLeft
                Sheets("Vorlage2").Cells(zeTB, 5) = frmVerleih.lst_Verleih.List(zeLB, 3)
                Sheets("Vorlage2").Cells(zeTB, 5).HorizontalAlignment = xlRight
                Sheets("Vorlage2").Cells(zeTB, 6) = frmVerleih.lst_Verleih.List(zeLB, 4)
                Sheets("Vorlage2").Cells(zeTB, 6).HorizontalAlignment = xlRight
                Pos = Pos + 1
                zeTB = zeTB + 1
                azeile = azeile + 1
            End If
        Next zeLB
    End With
    Farbe = 0
    For spLB = 0 To CDbl(azeile)
        If Farbe = 1 Then
            Sheets("Vorlage2").Range("A" & 7 + spLB & ":G" & 7 + spLB).Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = -0.149998474074526
                .PatternTintAndShade = 0
            End With
            Farbe = 0
        Else
            Sheets("Vorlage2").Range("A" & 7 + spLB & ":G" & 7 + spLB).Select
            Farbe = 1
        End If
    Next
    Kopien = Application.InputBox("Anzahl Kopien", "Liste drucken", 1)
    If Kopien = False Then
        Application.ScreenUpdating = True
        Exit Sub
    End If
    Worksheets("Vorlage2").PrintOut Copies:=CLng(Kopien)
    MsgBox "Liste wird gedruckt!", , "Verleih"
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Private Sub cmd_DateVO_Click()
    frmKalender.txt_UID = "VMVO"
    frmKalender.Show
End Sub

Private Sub cmd_DateBI_Click()
    frmKalender.txt_UID = "VMBI"
    frmKalender.Show
End Sub

Private Sub List_KundenList_Click()
    cbo_VNr = List_KundenList.List(List_KundenList.ListIndex, 0)
End Sub

Private Sub lst_VAuswahl_Click()
    Dim lngZeile, zlng As Long
    On Error Resume Next
    If txt_Vnachnamen.Value = "" Then Exit Sub
    zlng = lst_VAuswahl.Column(1)
    If Sheets("Kunden").Cells(zlng, 28) = "ja" Then
        MsgBox "Kunde (" & Sheets("Kunden").Cells(zlng, 7) & "," & Sheets("Kunden").Cells(zlng, 6) & ") ist gesperrt!", , "Hinweis"
        Exit Sub
    End If
    lngZeile = lst_VAuswahl.Column(1)
    txt_KDID.Value = Sheets("Kunden").Cells(lngZeile, 1)
    lbl_KDNR.Caption = Sheets("Kunden").Cells(lngZeile, 3)
    If Sheets("Kunden").Cells(lngZeile, 4) = "Firma" Then
        lbl_KDName.Caption = "Firma" & " " & Sheets("Kunden").Cells(lngZeile, 7)
    Else
        lbl_KDName.Caption = Sheets("Kunden").Cells(lngZeile, 7) & ", " & Sheets("Kunden").Cells(lngZeile, 6)
    End If
    lbl_KDAdress.Caption = Sheets("Kunden").Cells(lngZeile, 8)
    lbl_KDPLZ.Caption = Sheets("Kunden").Cells(lngZeile, 9)
    lbl_KDOrt.Caption = Sheets("Kunden").Cells(lngZeile, 10)
    txt_VNr.SetFocus
End Sub

Private Sub lst_Verleih_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    cbo_Kunden = lst_Verleih.List(lst_Verleih.ListIndex, 2)
    cbo_VNr = lst_Verleih.List(lst_Verleih.ListIndex, 0)
End Sub

Private Sub lst_Verleih_Click()
    On Error Resume Next
    cbo_Kunden = lst_Verleih.List(lst_Verleih.ListIndex, 2)
    cbo_VNr = lst_Verleih.List(lst_Verleih.ListIndex, 0)
    txt_VNr = lst_Verleih.List(lst_Verleih.ListIndex, 0)
End Sub

Private Sub lst_VerleihK_Click()
    Dim lng, lngrow, lngZeile As Long
    Dim strFile As String
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    On Error Resume Next

    lng = lst_VerleihK.List(lst_VerleihK.ListIndex, 5)
    lngrow = Sheets("Verleih").Cells(lng, 4)
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" And arrTmpA(i, 1) = CStr(lngrow) Then
                lngZeile = i
            End If
        Next i
    End With
    If Len(Sheets("Lager").Cells(lngZeile, 28).Value) > 0 Then
        strFile = Sheets("Lager").Cells(lngZeile, 28).Formula
        strFile = Split(strFile, "(" & Chr(34))(1)
        strFile = Split(strFile, Chr(34) & ",")(0)
        strFile = Replace(strFile, "file:///", "")
        Set frmVerleih.Image1.Picture = LoadPicture(strFile)
        lbl_bild.Visible = False
    Else
        Set frmVerleih.Image1.Picture = Nothing
        lbl_bild.Visible = True
    End If
    cbo_VNr = lst_VerleihK.List(lst_VerleihK.ListIndex, 0)
    lst_Verleih.ListIndex = -1
End Sub

Private Sub txt_VMenge_Change()
    If Not txt_VNr.Value = "" Then
        If txt_VMenge.Value = "" Then
            txt_VMenge.BackColor = &H8080FF
        Else
            txt_VMenge.BackColor = &H80000005
        End If
    Else
        txt_VMenge.BackColor = &H80000005
    End If
End Sub

Private Sub txt_Vnachnamen_AfterUpdate()
    If txt_Vnachnamen.Value = "" Then Exit Sub
    Call KASuchen
End Sub

Private Sub txt_VNr_AfterUpdate()
    Dim lng, i As Long
    Dim Treffer As Range
    On Error Resume Next
    If Not cbo_VNr = "" Then
        If cbo_VNr = txt_VNr Then Exit Sub
    End If
    If Not txt_VNr = "" Then
        Set Treffer = Worksheets("Verleih_Historie").Columns(1).Find(what:=txt_VNr.Value, LookAt:=xlWhole, MatchCase:=True)
            If Treffer Is Nothing Then
                lng = Sheets("Verleih_Historie").Cells(Rows.Count, 1).End(xlUp).Row
            Else
                i = MsgBox("Die Verleihnummer: (" + (txt_VNr.Value) + ") wurde bereits erfasst! M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
                If i = vbNo Then
                    txt_VNr.Value = ""
                    txt_VNr.SetFocus
                    Set Treffer = Nothing
                    Exit Sub
                End If
            End If
    End If
    If Not txt_VNr = "" Then
        txt_VNr.BackColor = &HFFFFFF
    Else
        txt_VNr.BackColor = &H8080FF
    End If
    Set Treffer = Nothing
End Sub

Private Sub txt_VVdatum_Change()
    If Not txt_VVdatum = "" Then
        If Not txt_VBdatum.Value = "" Then
            If CDbl(CDate(txt_VVdatum.Value)) > CDbl(CDate(txt_VBdatum.Value)) Then
                MsgBox "Ung|fffd|ltiges Datum", , "Datum"
                txt_VVdatum.Value = ""
                txt_VVdatum.SetFocus
            End If
        End If
    End If
End Sub

Sub Kunden()
    Dim i, aRow As Long
    On Error Resume Next
    frmVerleih.cbo_Kunden.Clear
    aRow = Sheets("Kunden").[A65536].End(xlUp).Row
    For i = 2 To aRow
        If Sheets("Kunden").Cells(i, 4) = "Firma" Then
            frmVerleih.cbo_Kunden.AddItem Sheets("Kunden").Cells(i, 4) & " " & Sheets("Kunden").Cells(i, 7)
        Else
            frmVerleih.cbo_Kunden.AddItem Sheets("Kunden").Cells(i, 7) & ", " & Sheets("Kunden").Cells(i, 6)
        End If
    Next i
End Sub

Sub leeren()
    On Error Resume Next
    Dim objControl As control
    For Each objControl In Controls
        Select Case TypeName(objControl)
           Case "TextBox"
              objControl.Text = ""
           Case "ComboBox"
              objControl.ListIndex = -1
           Case "CheckBox"
              objControl.Value = False
           Case "OptionButton"
              objControl.Value = False
        End Select
    Next
    List_KundenList.Clear
    lst_VerleihK.Clear
    cbo_Liste.ListIndex = 0
    lbl_Verfuegbar.Caption = ""
    txt_Verfuegbar.Value = ""
    Set frmVerleih.Image1.Picture = Nothing
    lbl_bild.Visible = True
End Sub

Sub SuchenKunden()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    cbo_SuchenK.Clear
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Verleih").Cells(Rows.Count, 1).End(xlUp).Row
        objDic(Sheets("Verleih").Cells(lngZ, 3).Value) = 0
    Next
    cbo_SuchenK.List = objDic.keys
    Set objDic = Nothing
End Sub

Sub SuchenVNr()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    cbo_VNr.Clear
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Verleih").Cells(Rows.Count, 1).End(xlUp).Row
        objDic(Sheets("Verleih").Cells(lngZ, 1).Value) = 0
    Next
    cbo_VNr.List = objDic.keys
    Set objDic = Nothing
End Sub

Sub suchen() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next

    BoxListe = "Verleih"
    lst_Verleih.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If Not arrTmpA(i, 1) = "" Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 3)
                arrTmpB(2, n) = arrTmpA(i, 5)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 8)
                arrTmpB(5, n) = arrTmpA(i, 10)
                arrTmpB(6, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 6)
            For i = 1 To 6
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lst_Verleih
                .ColumnCount = 6
                .ColumnWidths = "100;100;200;60;60;0"
                .List = arrTmpA
            End With
        End If
    End With
End Sub

Sub suchenVerleihK() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next
    
    BoxListe = "Verleih"
    lst_VerleihK.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:Q" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 3) = CStr(cbo_SuchenK.Text) Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 1)
                arrTmpB(2, n) = arrTmpA(i, 5)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 8)
                arrTmpB(5, n) = arrTmpA(i, 10)
                arrTmpB(6, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 6)
            For i = 1 To 6
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lst_VerleihK
                .ColumnCount = 6
                .ColumnWidths = "100;100;200;60;60;0"
                .List = arrTmpA
            End With
        End If
    End With
End Sub

Sub suchenVerleihNr() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    On Error Resume Next
    
    BoxListe = "Verleih"
    lst_VerleihK.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:R" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = CStr(cbo_VNr.Text) And arrTmpA(i, 18) = "" Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 1)
                arrTmpB(2, n) = arrTmpA(i, 5)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 8)
                arrTmpB(5, n) = arrTmpA(i, 10)
                arrTmpB(6, n) = i
            End If
        Next i
        If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 6)
            For i = 1 To 6
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
            Next
            With lst_VerleihK
                .ColumnCount = 6
                .ColumnWidths = "100;100;200;60;60;0"
                .List = arrTmpA
            End With
        End If
    End With
End Sub

Sub Verleihlist()
    lst_Verleih.Clear
    lst_Verleih.ColumnCount = 5
    lst_Verleih.ColumnWidths = "100;100;200;60;60;10"
End Sub

Private Sub cmdchanel_Click()
    frmLager.txt_VKDID.Value = ""
    frmLager.txt_VNr.Value = ""
    Unload frmVerleih
End Sub

Private Sub cmdexit_Click()
    Unload frmVerleih
    frmLager.txt_item.SetFocus
End Sub

Sub V2List()
    Dim MyDic As Object
    Dim sText As String
    Dim lZeile, lng, i, A As Long
    Dim ArrValues, arrList() As Variant
    On Error Resume Next
    Application.ScreenUpdating = False
    lst_Verleih.Clear
    '   Dictionary initialisieren
    Set MyDic = CreateObject("Scripting.Dictionary")
    With Worksheets("Verleih")
        For lZeile = 2 To .Cells(.Rows.Count, 1).End(xlUp).Row
           If .Cells(lZeile, 18).Value = "" Then
        '   den Ordnungsbegriff (Key) zusammenstellen
                lng = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(.Cells(lZeile, 2).Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
                sText = .Cells(lZeile, 2).Value & .Cells(lZeile, 1).Value & Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6)
        '   als Items die drei Begriffe als Array speichern
                If Worksheets("Kunden").Cells(lng, 4) = "Firma" Then
                MyDic(sText) = _
                    Array(.Cells(lZeile, 1).Value, .Cells(lZeile, 10).Value, Worksheets("Kunden").Cells(lng, 4) & " " & Worksheets("Kunden").Cells(lng, 7))
                Else
                    MyDic(sText) = Array(.Cells(lZeile, 1).Value, .Cells(lZeile, 10).Value, Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6))
                End If
            End If
        Next lZeile
    End With
    lst_Verleih.ColumnWidths = "100;100;250"
    If MyDic.Count Then
        ArrValues = MyDic.Items
        ReDim arrList(1 To MyDic.Count, 1 To 3)
        For A = 1 To MyDic.Count
           For i = 1 To 3
              arrList(A, i) = ArrValues(A - 1)(i - 1)
           Next i
        Next
        lst_Verleih.List = arrList
    End If
    Application.ScreenUpdating = False
End Sub

Sub V2TestDatum()
    Dim MyDic As Object
    Dim sText As String
    Dim lZeile, lng, i, A As Long
    Dim ArrValues, arrList() As Variant
    On Error Resume Next
    Application.ScreenUpdating = False
    lst_Verleih.Clear
    '   Dictionary initialisieren
    Set MyDic = CreateObject("Scripting.Dictionary")
    With Worksheets("Verleih")
       For lZeile = 2 To .Cells(.Rows.Count, 1).End(xlUp).Row
            If Not .Cells(lZeile, 10).Value = "unbegrenzt" Then
                If CDate(.Cells(lZeile, 10).Value) < CDate(Date) Then
                    If .Cells(lZeile, 18).Value = "" Then
                        '   den Ordnungsbegriff (Key) zusammenstellen
                        lng = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(.Cells(lZeile, 2).Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
                         sText = .Cells(lZeile, 2).Value & .Cells(lZeile, 1).Value & Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6)
                        '   als Items die drei Begriffe als Array speichern
                         If Worksheets("Kunden").Cells(lng, 4) = "Firma" Then
                            MyDic(sText) = _
                            Array(.Cells(lZeile, 1).Value, .Cells(lZeile, 10).Value, Worksheets("Kunden").Cells(lng, 4) & " " & Worksheets("Kunden").Cells(lng, 7))
                        Else
                            MyDic(sText) = Array(.Cells(lZeile, 1).Value, .Cells(lZeile, 10).Value, Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6))
                        End If
                    End If
                End If
            End If
       Next lZeile
    End With
    lst_Verleih.ColumnWidths = "100;100;250"
    If MyDic.Count Then
        ArrValues = MyDic.Items
        ReDim arrList(1 To MyDic.Count, 1 To 3)
        For A = 1 To MyDic.Count
           For i = 1 To 3
              arrList(A, i) = ArrValues(A - 1)(i - 1)
           Next i
        Next
        lst_Verleih.List = arrList
    End If
    Application.ScreenUpdating = False
End Sub

Sub SuchenID2()
    Dim MyDic As Object
    Dim sText As String
    Dim lZeile, lng, i, A As Long
    Dim ArrValues, arrList() As Variant
    On Error Resume Next
    Application.ScreenUpdating = False
    lst_Verleih.Clear
    Set MyDic = CreateObject("Scripting.Dictionary")
    With Worksheets("Verleih")
       For lZeile = 2 To .Cells(.Rows.Count, 1).End(xlUp).Row
            If CStr(.Cells(lZeile, 4).Value) = CStr(txt_IDArtikel) Then
                If .Cells(lZeile, 18).Value = "" Then
                    '   den Ordnungsbegriff (Key) zusammenstellen
                    lng = Worksheets("Kunden").Cells((Worksheets("Kunden").Range("A:A").Find(CStr(.Cells(lZeile, 2).Value), LookIn:=xlValues, MatchCase:=True).Row), 1).Row
                    sText = .Cells(lZeile, 2).Value & .Cells(lZeile, 1).Value & Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6)
                    '   als Items die drei Begriffe als Array speichern
                    If Worksheets("Kunden").Cells(lng, 4) = "Firma" Then
                        MyDic(sText) = _
                        Array(.Cells(lZeile, 1).Value, .Cells(lZeile, 10).Value, Worksheets("Kunden").Cells(lng, 4) & " " & Worksheets("Kunden").Cells(lng, 7))
                    Else
                        MyDic(sText) = Array(.Cells(lZeile, 1).Value, .Cells(lZeile, 10).Value, Worksheets("Kunden").Cells(lng, 7) & ", " & Worksheets("Kunden").Cells(lng, 6))
                    End If
                End If
            End If
       Next lZeile
    End With
    lst_Verleih.ColumnWidths = "100;100;250"
    If MyDic.Count Then
        ArrValues = MyDic.Items
        ReDim arrList(1 To MyDic.Count, 1 To 3)
        For A = 1 To MyDic.Count
           For i = 1 To 3
              arrList(A, i) = ArrValues(A - 1)(i - 1)
           Next i
        Next
        lst_Verleih.List = arrList
    End If
    Application.ScreenUpdating = False
End Sub
Attribute VB_Name = "frmWareneingangoB"
Attribute VB_Base = "0{627E2AEF-5D53-413C-A66E-7FD8C8F1C7AF}{DB3785C7-A17A-43D1-9058-5228FE014F3B}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub cbo_Lieferant_Change()
    On Error Resume Next
    If Not cbo_Lieferant = "Alle anzeigen" Then
        cbo_LVerfuegbar.Visible = False
        lbl_LVerfuegbar.Visible = False
    End If
    Dim xrow As Long
    On Error Resume Next
    If Not cbo_Lieferant = "Alle anzeigen" Then
        xrow = xFind(ActiveWorkbook.Name, "Lieferanten", CStr(cbo_Lieferant), "B:B")
        txt_LVerfuegbar.Value = CStr(Sheets("Lieferanten").Cells(xrow, 1))
    Else
        txt_LVerfuegbar.Value = ""
    End If
End Sub

Private Sub cbo_LVerfuegbar_Change()
    Dim xrow As Long
    On Error Resume Next
    If Not cbo_LVerfuegbar = "" And cbo_Lieferant = "Alle anzeigen" Then
        xrow = xFind(ActiveWorkbook.Name, "Lieferanten", CStr(cbo_LVerfuegbar), "B:B")
        txt_LVerfuegbar.Value = CStr(Sheets("Lieferanten").Cells(xrow, 1))
    Else
        txt_LVerfuegbar.Value = ""
    End If
End Sub

Private Sub cbo_LVerfuegbar_DropButtonClick()
    Dim xrow, xrow2, lngg, lng, lngZeile2 As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim arrTmpA, arrTmpB, i, n As Long
    Dim Last_Row, lngL As Long
    On Error Resume Next

    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:P" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = CStr(txtID) Then
                xrow = i
            End If
        Next i
    End With
    If cbo_Lieferant = "Alle anzeigen" Then
        If Sheets("Lager").Cells(xrow, 18).Value = "" Then
            txt_EKPreis.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
        ElseIf CStr(Sheets("Lager").Cells(xrow, 18)) = CStr(txt_LVerfuegbar) Then
            txt_EKPreis.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
        Else
            With ThisWorkbook.Sheets("VPEinheit")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:P" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If arrTmpA(i, 2) = CStr(Me.txtID) And arrTmpA(i, 10) = CStr(txt_LVerfuegbar) And arrTmpA(i, 14) = "VP-WL" Then
                        xrow2 = i
                    End If
                Next i
            End With
            txt_EKPreis.Value = Format(Sheets("VPEinheit").Cells(xrow2, 13), "currency")
            txtpreis.Value = Sheets("VPEinheit").Cells(xrow2, 13)
        End If
    End If
End Sub

Private Sub cboArtikelNR_DropButtonClick()
    Call Klickliste
    Call VPzusam
End Sub

Private Sub cboErzeugnis_Change()
    If cboErzeugnis = "Fremderzeugnis" Then
        lblLieferant.Visible = True
        cmd_NewSupplier.Visible = True
        cbo_Lieferant.Visible = True
    Else
        lblLieferant.Visible = False
        cmd_NewSupplier.Visible = False
        cbo_Lieferant.Visible = False
        lbl_LVerfuegbar.Visible = False
        cbo_LVerfuegbar.Visible = False
    End If
End Sub

Private Sub cmd_EtikettB_Click()
    On Error Resume Next
    If Not txtID.Value = "" Then
        frmEtikett.txt_Mode.Value = "WEOB"
        frmEtikett.txt_type.Value = "BE"
        frmEtikett.txt_Tabellblatt.Value = Sheets("Daten").Range("D1")
        frmEtikett.cbo_Auswahl1 = Sheets("Daten").Range("D2")
        frmEtikett.cbo_Auswahl2 = Sheets("Daten").Range("D3")
        frmEtikett.cbo_Auswahl3 = Sheets("Daten").Range("D4")
        frmEtikett.cbo_Auswahl4 = Sheets("Daten").Range("D5")
        frmEtikett.cbo_Auswahl5 = Sheets("Daten").Range("D6")
        frmEtikett.txt_Zeile1.Value = Sheets("Daten").Range("E2")
        frmEtikett.txt_Zeile2.Value = Sheets("Daten").Range("E3")
        frmEtikett.txt_Zeile3.Value = Sheets("Daten").Range("E4")
        frmEtikett.txt_Zeile4.Value = Sheets("Daten").Range("E5")
        frmEtikett.txt_Zeile5.Value = Sheets("Daten").Range("E6")
        frmEtikett.txt_DBvon.Value = Sheets("Daten").Range("D7")
        frmEtikett.txt_DBbis.Value = Sheets("Daten").Range("D8")
        If Sheets("Daten").Range("D9").Value = "ja" Then
            frmEtikett.chk_Auswahl1.Value = True
        End If
        If Sheets("Daten").Range("D10").Value = "ja" Then
            frmEtikett.chk_Auswahl2.Value = True
        End If
        If Sheets("Daten").Range("D11").Value = "ja" Then
            frmEtikett.chk_Auswahl3.Value = True
        End If
        If Sheets("Daten").Range("D12").Value = "ja" Then
            frmEtikett.chk_Auswahl4.Value = True
        End If
        If Sheets("Daten").Range("D13").Value = "ja" Then
            frmEtikett.chk_Auswahl5.Value = True
        End If
        Call frmEtikett.suchenEtikettBWE
        frmEtikett.Show
    End If
End Sub

Private Sub cmd_EtikettG_Click()
    Dim lng, slng, lngGe, KNID, LID As Long
    Dim Mlng As Double
    Dim Blng, Blng2, stxt As String
    Dim strFontFileName As String
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    On Error Resume Next
    'Schriftart pruefen
    strFontFileName = "Bar-Code 39"
    If SystemFontExists(strFontFileName) = False Then
        MsgBox "Bitte installieren Sie die Schriftart (Bar-Code 39)!" & vbLf & "Weitere Informationen finden Sie auch im Benutzerhandbuch!", vbInformation, "Schriftart (Bar-Code 39) ist nicht installiert!"
        Exit Sub
    End If
    If Me.txtstueck = "" Then
        MsgBox "Geben Sie die Menge an!", , "Hinweis"
        Exit Sub
    End If
    frmEtikett.Label1.Caption = "(1) Liefertant"
    frmEtikett.lbl_Art.Caption = "(5) Lagerort"
    frmEtikett.Label21.Caption = "(11) Eingelagert durch:"
    frmEtikett.Label19.Caption = ""
    frmEtikett.Label10.Caption = " Mitarbeiter:"
    frmEtikett.fra_BeEtikett.Visible = False
    frmEtikett.txt_type.Value = "G1"
    If Not txt_LVerfuegbar.Value = "" Then
        With ThisWorkbook.Sheets("Lieferanten")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:P" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 1) = CStr(txt_LVerfuegbar) Then
                    LID = i
                End If
            Next i
        End With
        frmEtikett.txt_Firma = Worksheets("Lieferanten").Cells(LID, 2)
        frmEtikett.txt_adress = Worksheets("Lieferanten").Cells(LID, 3)
        frmEtikett.txt_PLZ = Worksheets("Lieferanten").Cells(LID, 4)
    End If
    
    frmEtikett.txt_LieferscheinNr.Value = txtbeleg
    frmEtikett.txt_Stueckzahl.Value = txtstueck
    frmEtikett.txt_BezeichnungVDA.Value = Me.lbl_bezeichnung
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:P" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = CStr(txtID) Then
                KNID = i
            End If
        Next i
    End With
    If Not Worksheets("Lager").Cells(KNID, 32) = "" Then
        frmEtikett.txt_FuellmengeN = Worksheets("Lager").Cells(KNID, 32) * txtstueck
        frmEtikett.cbo_Gew1 = "Kg"
    End If
    frmEtikett.txt_ArtikelNrE.Value = Worksheets("Lager").Cells(KNID, 4)
    If Not Worksheets("Lager").Cells(KNID, 11) = "" Then
        frmEtikett.txt_BarArtikelNrE = "*" & Worksheets("Lager").Cells(KNID, 11) & "*"
    End If
    If Not lbl_lagerort = "Kein Lagerort zugewiesen!" Then
        If cbo_Lagerplatz = "Hauptlagerplatz" Then
            frmEtikett.txt_RENr.Value = Me.lbl_lagerort
        Else
            frmEtikett.txt_RENr.Value = cbo_Lagerplatz
        End If
    End If
    If Not Sheets("Daten").Range("B24") = "" Then
        frmEtikett.txt_LieferantAbs.Value = Sheets("Daten").Range("B24")
    End If
    frmEtikett.txt_BarLieferantAbs.Value = ""
    frmEtikett.Frame_EGross.Top = 6
    frmEtikett.Frame_EGross.Left = 4.5
    frmEtikett.txt_FuellmengeB.SetFocus
    frmEtikett.Show
End Sub

Private Sub cmd_NewSupplier_Click()
    frmLieferanten.txtVerweisArtikel.Value = 1
    frmLieferanten.txt_Art.Value = "Bestellung"
    frmLieferanten.txtLNr.SetFocus
    frmLieferanten.Show
End Sub

Private Sub cmd_WEDruck_Click()
    If lstWAimputoB.ListCount = 0 Then Exit Sub
    Call WEscheinOB
End Sub

Sub WEscheinOB() '1.44
    Dim zeLB, zeTB, lngIndex, listenwert, Farbe, xLast_Row As Long
    Dim blnMarkiert As Boolean
    Dim arrTmpA, arrTmpB, i, Last_Row, xrow As Long
    Dim Kopien As Variant
    On Error Resume Next

    Application.ScreenUpdating = False
    Sheets("Vorlage2").Activate
    xLast_Row = CDbl(Sheets("Vorlage2").Cells(Rows.Count, 1).End(xlUp).Row) + 10
    ThisWorkbook.Sheets("Vorlage2").Rows("7:" & xLast_Row).Delete
    Sheets("Vorlage2").Range("Vorlage2!A7:G400").Font.Size = 9
    Sheets("Vorlage2").Range("A1") = "Wareneingangsschein"
    Sheets("Vorlage2").Range("G1") = Date
    Sheets("Vorlage2").Range("A3") = "Wareneingang: " & txtbeleg.Value
    Sheets("Vorlage2").Range("A4") = ""
    Sheets("Vorlage2").Range("B6") = "Artikelnummer"
    Sheets("Vorlage2").Range("C6") = "Herstellernummer"
    Sheets("Vorlage2").Range("D6") = "Artikelbezeichnung"
    Sheets("Vorlage2").Range("E6") = "Menge"
    Sheets("Vorlage2").Range("F6") = "Lagerort"
    Sheets("Vorlage2").Range("G6") = ""
    zeLB = 0
    zeTB = 7
    '--- selektierte Listboxeintraege in Zellen schreiben
    For zeLB = 0 To frmWareneingangoB.lstWAimputoB.ListCount - 1
        Sheets("Vorlage2").Cells(zeTB, 1) = CDbl(zeLB + 1)
        Sheets("Vorlage2").Cells(zeTB, 1).HorizontalAlignment = xlLeft
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 1) = CStr(Sheets("Wareneingang").Cells(CLng(frmWareneingangoB.lstWAimputoB.List(zeLB, 5)), 12)) Then
                    xrow = i
                End If
            Next i
        End With
        Sheets("Vorlage2").Cells(zeTB, 2) = "'" & Sheets("Lager").Cells(CLng(xrow), 3)
        Sheets("Vorlage2").Cells(zeTB, 2).HorizontalAlignment = xlLeft
        Sheets("Vorlage2").Cells(zeTB, 3) = "'" & Sheets("Lager").Cells(CLng(xrow), 4)
        Sheets("Vorlage2").Cells(zeTB, 4) = "'" & Sheets("Lager").Cells(CLng(xrow), 6)
        Sheets("Vorlage2").Cells(zeTB, 5) = frmWareneingangoB.lstWAimputoB.List(zeLB, 4)
        Sheets("Vorlage2").Cells(zeTB, 5).HorizontalAlignment = xlCenter
        Sheets("Vorlage2").Cells(zeTB, 6) = Sheets("Wareneingang").Cells(CLng(frmWareneingangoB.lstWAimputoB.List(zeLB, 5)), 18)
        Sheets("Vorlage2").Range("A4") = "Lieferant: " & Sheets("Wareneingang").Cells(CLng(frmWareneingangoB.lstWAimputoB.List(zeLB, 5)), 2)
        zeTB = zeTB + 1
    Next
    Farbe = 0
    For zeLB = 0 To frmEingang.lstWAimput.ListCount - 1
        If Farbe = 1 Then
            Sheets("Vorlage2").Range("A" & 7 + zeLB & ":G" & 7 + zeLB).Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorDark1
                .TintAndShade = -0.149998474074526
                .PatternTintAndShade = 0
            End With
            Farbe = 0
        Else
            Sheets("Vorlage2").Range("A" & 7 + zeLB & ":G" & 7 + zeLB).Select
            Farbe = 1
        End If
    Next
    Sheets("Vorlage2").Cells(zeTB + 2, 1) = "Eingelagert durch: "
    Sheets("Vorlage2").Cells(zeTB + 2, 1).Font.Size = 11
    Sheets("Vorlage2").Cells(zeTB + 4, 1) = "...................................................................."
    Sheets("Vorlage2").Cells(zeTB + 5, 1) = "(Name/ Mitarbeiter)"
    Sheets("Vorlage2").Cells(zeTB + 5, 1).Font.Size = 11
    Kopien = Application.InputBox("Anzahl Kopien", "WE- Schein drucken", 1)
    Worksheets("Vorlage2").PrintOut Copies:=CLng(Kopien)
    Sheets("Center").Activate
    Application.ScreenUpdating = False
    MsgBox "Wareneingangs-Schein wurde gedruckt!", , "Hinweis"
End Sub

Private Sub txt_Begriff_Change()
    If Not txt_Begriff = "" Then
        If txt_Begriff.TextLength > 2 Then
            Call SuchenBegriff
        Else
            lstArtikelID.Clear
        End If
    End If
End Sub

Private Sub txt_EKPreis_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If Not txt_EKPreis.Value = "" And Not txtID = "" Then
        txt_EKPreis.Value = Format(txt_EKPreis.Value, "currency")
    End If
End Sub

Private Sub txt_VKPreis_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If Not txt_VKPreis.Value = "" And Not txtID = "" Then
        txt_VKPreis.Value = Format(txt_VKPreis.Value, "currency")
    End If
End Sub

Private Sub txtID_Change()
    If Not txtID = "" And Not cboErzeugnis = "Eigene Produktion" Then
        Call LVerfuegbar
        Call SuchenVP
    Else
        cbo_LVerfuegbar.Visible = False
        lbl_LVerfuegbar.Visible = False
    End If
    If txtID.Value = "" Then
        cmd_EtikettMWE.Visible = False
        cmd_EtikettB.Visible = False
        cmd_EtikettG.Visible = False
    Else
        cmd_EtikettMWE.Visible = True
        cmd_EtikettB.Visible = True
        cmd_EtikettG.Visible = True
    End If
End Sub

Sub LVerfuegbar() '1.44
    Dim irow, ALetzte, xrow, Last_Row, lngL, arrTmpA, arrTmpB, i, j, n As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    If Not cbo_Lieferant = "Alle anzeigen" Then Exit Sub
    cbo_LVerfuegbar.Visible = True
    lbl_LVerfuegbar.Visible = True
    cbo_LVerfuegbar.Clear
    Application.ScreenUpdating = False
    With cbo_LVerfuegbar
        ALetzte = Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
        Set DIC = CreateObject("scripting.dictionary")
        For irow = 2 To ALetzte
            If Not Sheets("Lager").Cells(irow, 1) = "" And Sheets("Lager").Cells(irow, 1) = CStr(txtID) Then
                xrow = xFind(ActiveWorkbook.Name, "Lieferanten", CStr(Sheets("Lager").Cells(irow, 18)), "A:A")
                xKey = VBA.Replace(CStr(Sheets("Lieferanten").Cells(xrow, 2)), Chr$(13) & Chr$(10), " ")
                DIC(xKey) = 0
            End If
        Next
        With ThisWorkbook.Sheets("VPEinheit")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:O" & Last_Row)
            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 2) = "" And arrTmpA(i, 2) Like CStr(txtID) And arrTmpA(i, 14) = "VP-WL" Then
                    xKey = arrTmpA(i, 11)
                    DIC(xKey) = 0
                End If
            Next i
        End With
        For Each xKey In DIC
            cbo_LVerfuegbar.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_LVerfuegbar.ListIndex = 0
        If cbo_LVerfuegbar = "" Then
            cbo_LVerfuegbar.Visible = False
            lbl_LVerfuegbar.Visible = False
        End If
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    lbl_Day.Caption = Format(Date, "dd")
    lbl_dayfull.Caption = Format(Date, "dddd")
    lbl_month.Caption = "." & Format(Date, "mm")
    lbl_year.Caption = "." & Format(Date, "yyyy")
    cmd_EtikettB.Caption = "Eigenes" & vbLf & "Etikett drucken"
    cmd_EtikettG.Caption = "Gro|fffd|es" & vbLf & "Etikett drucken"
    Call ArtikelCombo
    With cboErzeugnis
        .AddItem "Fremderzeugnis"
        .AddItem "Eigene Produktion"
        .ListIndex = 0
    End With
    Call LieferantCombo
End Sub

Sub VPzusam()
    Dim i, i2, lng As Long
    On Error Resume Next
    If lstArtikelID2.ListCount = 0 Then Exit Sub
    Application.ScreenUpdating = False
    i2 = lstArtikelID.ListCount
    For lng = 1 To lstArtikelID2.ListCount
        lstArtikelID.AddItem lstArtikelID2.Column(0, i)
        lstArtikelID.Column(1, i2) = lstArtikelID2.Column(1, i)
        lstArtikelID.Column(2, i2) = lstArtikelID2.Column(2, i)
        lstArtikelID.Column(3, i2) = lstArtikelID2.Column(3, i)
        lstArtikelID.Column(4, i2) = lstArtikelID2.Column(4, i)
        i2 = i2 + 1
        i = i + 1
    Next lng
    lstArtikelID2.Clear
    Application.ScreenUpdating = True
End Sub

Private Sub cbo_Lagerplatz_Change()
    Dim lng, lngID As Long
    Dim strID As String
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    On Error Resume Next
    strID = txtID.Value
    If cbo_Lagerplatz = "Hauptlagerplatz" Then
        txt_LPID.Value = ""
        With ThisWorkbook.Sheets("Lager")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:AO" & Last_Row)
           ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
                If cbo_Lieferant = "Alle anzeigen" Then
                    If arrTmpA(i, 1) = CStr(txtID) Then
                        lngID = i
                    End If
                Else
                    If InStr(1, LCase(arrTmpA(i, 6)), LCase(txt_Begriff.Text)) > 0 And arrTmpA(i, 18) = CStr(txt_LVerfuegbar.Text) Then
                        lngID = i
                    End If
                End If
           Next i
        End With
        lbl_lagerort.Caption = Sheets("Lager").Cells(lngID, 13)
    Else
        For lng = 2 To ThisWorkbook.Worksheets("Lagerorte").UsedRange.Rows.Count
            If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text And Sheets("Lagerorte").Cells(lng, 3) = cbo_Lagerplatz.Text Then
                lbl_lagerort.Caption = ""
                txt_LPID.Value = Sheets("Lagerorte").Cells(lng, 1)
            End If
        Next lng
    End If
End Sub

Private Sub cboartikelnr_Click()
    txtstueck.SetFocus
End Sub

Private Sub cmd_EtikettMWE_Click()
    Dim strFontFileName As String
    'Schriftart pruefen
    strFontFileName = "Bar-Code 39"
    If SystemFontExists(strFontFileName) = False Then
        MsgBox "Bitte installieren Sie die Schriftart (Bar-Code 39)!" & vbLf & "Weitere Informationen finden Sie auch im Benutzerhandbuch!", vbInformation, "Schriftart (Bar-Code 39) ist nicht installiert!"
        Exit Sub
    End If
    If txtID.Value = "" Then Exit Sub
    frmEtikett.fra_BeEtikett.Visible = False
    frmEtikett.Frame_Artikel.Top = 6
    frmEtikett.Frame_Artikel.Left = 6
    'Etikett1
    frmEtikett.txt_ArtikelAnE.Value = cboArtikelNR.Value
    frmEtikett.txt_ArtikelLaE.Value = lbl_lagerort.Caption
    frmEtikett.txt_LieferantE.Value = cbo_Lieferant
    'Etikett2
    frmEtikett.txt_ArtikelAnET2.Value = cboArtikelNR.Value
    frmEtikett.txt_ArtikelLaET2.Value = lbl_lagerort.Caption
    'Etikett3
    frmEtikett.txt_ArtikelAnET3.Value = cboArtikelNR.Value
    frmEtikett.txt_BezeichnungET3.Value = lbl_bezeichnung.Caption
    frmEtikett.txt_ArtikelLaET3.Value = lbl_lagerort.Caption
    frmEtikett.txt_LieferantET3.Value = cbo_Lieferant
    frmEtikett.txt_LieferantNrET3.Value = txt_IDLieferant.Value
    frmEtikett.Ch_T1 = True
    frmEtikett.Show
End Sub

Private Sub cmd_Lortaendern_Click() '1.44
    Dim lngMsg As String
    Dim xrow As Long
    Dim arrTmpA, arrTmpB, i, Last_Row As Long
    On Error Resume Next
    If txtID.Value = "" Then Exit Sub
    lngMsg = InputBox("Geben Sie ein neuen Lagerort f|fffd|r den Artikel (" + lbl_bezeichnung.Caption + ") ein!", "Lagerort |fffd|ndern")
    If lngMsg = "" Then Exit Sub
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:N" & Last_Row)
        ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 1) = CStr(Me.txtID) Then
                xrow = i
            End If
        Next i
    End With
    Sheets("Lager").Cells(xrow, 13).Value = lngMsg
    lbl_lagerort.Caption = lngMsg
End Sub

Private Sub cmd_NeuArtikelBestO_Click()
    frmArtikel.txt_Verleih.Value = "BestO"
    Call Neu
End Sub

Private Sub cmd_ScanWEOhne_Click() '1.44
    Dim strMsg As String
    If txtbeleg.Value = "" Then
        MsgBox "Bitte geben Sie erst ein Beleg oder Referenztext an!", , "Hinweis"
        txtbeleg.SetFocus
        Exit Sub
    ElseIf Me.cboErzeugnis.ListIndex = 0 And Me.cbo_Lieferant.ListIndex = 0 Then
        strMsg = MsgBox("M|fffd|chten Sie ohne Lieferant fortfahren?", vbYesNo, "Hinweis")
        If strMsg = vbYes Then
            GoTo weiter:
        Else
            cbo_Lieferant.SetFocus
            Exit Sub
        End If
    Else
weiter:
        frmBarcode.txt_BarcodeArt.Value = "WEOH"
        frmBarcode.cmd_BCAusbuchen.Caption = "Manuellen WE einbuchen"
        frmBarcode.Caption = "Barcode Wareneingang" & " Nr.:" & txtbeleg.Value
        frmBarcode.txt_KasseNr.Value = txtbeleg.Value
        frmBarcode.check_HLager.Enabled = False
        frmBarcode.lbl_HLager.Enabled = False
        frmBarcode.check_NBestand.Enabled = False
        frmBarcode.lbl_NBestand.Enabled = False
        frmBarcode.Show
    End If
End Sub

Sub SuchenBegriff() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    On Error Resume Next
    lstArtikelID.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:N" & Last_Row)
        ReDim arrTmpB(1 To 3, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
        If InStr(1, LCase(arrTmpA(i, 6)), LCase(txt_Begriff.Text)) > 0 Then
            n = n + 1
            arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
            arrTmpB(2, n) = i
        End If
       Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 3)
        For i = 1 To 3
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With lstArtikelID
           .ColumnCount = 1
           .ColumnWidths = "50;100;0"
           .List = arrTmpA
        End With
    Else
        MsgBox "Suchbegriff: " + txt_Begriff.Value + " nicht gefunden!", vbOKOnly, "Suchabfrage"
        txt_Begriff.SetFocus
    End If
End Sub

Private Sub lstArtikelID_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    If Not lstArtikelID.Column(2) = "VP" Then
        Me.cboArtikelNR = Me.lbl_itemnumber
        If lstArtikelID2.ListCount > 0 Then
            Call VPzusam
        End If
    End If
    txtstueck.SetFocus
End Sub

Private Sub lstArtikelID_Click() '1.44
    Dim lngZeile, lng, lngg, lngZeile2, xrow As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row, lngL As Long
    On Error Resume Next
    
    lngZeile = lstArtikelID.Column(1)
    If lstArtikelID.Column(2) = "VP" Then
        lngZeile2 = lstArtikelID.Column(1)
        With ThisWorkbook.Sheets("Lager")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:N" & Last_Row)
            ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 1) = CStr(Me.txtID) Then
                    xrow = i
                End If
            Next i
        End With
        lbl_itemnumber.Caption = Sheets("Lager").Cells(xrow, 3).Value & "-1" & Sheets("VPEinheit").Cells(lngZeile2, 3).Value
        lbl_bezeichnung.Caption = lstArtikelID.Column(0)
        lbl_herstellerNr.Caption = Sheets("VPEinheit").Cells(lngZeile2, 9).Value
        lbl_Einheit = Sheets("VPEinheit").Cells(lngZeile2, 5).Value
        If Not Sheets("VPEinheit").Cells(lngZeile2, 12).Value = "" Then
            txt_EKPreis.Value = Format(Sheets("VPEinheit").Cells(lngZeile2, 12).Value, "currency")
        Else
            txt_EKPreis.Value = ""
        End If
        txt_VKPreis.Value = "-"
        txtpreis.Value = CDbl(Sheets("VPEinheit").Cells(lngZeile, 13).Value) * CDbl(Sheets("VPEinheit").Cells(lngZeile2, 3).Value)
        txt_zeile = lngZeile2
        txt_VPMenge = Sheets("VPEinheit").Cells(lngZeile2, 3).Value
    Else
        txt_VPMenge.Value = ""
        lbl_itemnumber.Caption = Sheets("Lager").Cells(lngZeile, 3).Value
        lbl_bezeichnung.Caption = Sheets("Lager").Cells(lngZeile, 6).Value
        lbl_herstellerNr.Caption = Sheets("Lager").Cells(lngZeile, 4).Value
        lbl_Einheit.Caption = Sheets("Lager").Cells(lngZeile, 12).Value
        lbl_lagerort.Caption = Sheets("Lager").Cells(lngZeile, 13).Value
        If cbo_Lieferant = "Alle anzeigen" Then
            txt_EKPreis.Value = Format(Sheets("Lager").Cells(lngZeile, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(lngZeile, 14).Value
            txt_VKPreis.Value = Format(Sheets("Lager").Cells(lngZeile, 15).Value, "currency")
        Else
            If Sheets("Lager").Cells(lngZeile, 18).Value = "" Then
                txt_EKPreis.Value = Format(Sheets("Lager").Cells(lngZeile, 14).Value, "currency")
                txtpreis.Value = Sheets("Lager").Cells(lngZeile, 14).Value
            ElseIf CStr(Sheets("Lager").Cells(lngZeile, 18)) = CStr(txt_LVerfuegbar) Then
                txt_EKPreis.Value = Format(Sheets("Lager").Cells(lngZeile, 14).Value, "currency")
                txtpreis.Value = Sheets("Lager").Cells(lngZeile, 14).Value
                txt_VKPreis.Value = Format(Sheets("Lager").Cells(lngZeile, 15).Value, "currency")
            Else
                With ThisWorkbook.Sheets("VPEinheit")
                    Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA = .Range("A1:N" & Last_Row)
                    ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
                    For i = 2 To UBound(arrTmpA)
                        If arrTmpA(i, 2) = CStr(Me.txtID) And arrTmpA(i, 10) = CStr(txt_LVerfuegbar) And arrTmpA(i, 14) = "VP-WL" Then
                            xrow = i
                        End If
                    Next i
                End With
                txt_EKPreis.Value = Format(Sheets("VPEinheit").Cells(xrow, 13), "currency")
                txtpreis.Value = Sheets("VPEinheit").Cells(xrow, 13)
                txt_VKPreis.Value = "-"
            End If
        End If
        txtID.Value = Sheets("Lager").Cells(lngZeile, 1).Value
        txt_zeile = lngZeile
        txt_VPMenge = ""
    End If
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = CStr(txtID) Then
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        cbo_Lagerplatz.Enabled = True
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        For Each xKey In DIC
            cbo_Lagerplatz.AddItem xKey
        Next
        cbo_Lagerplatz.ListIndex = 0
        DIC.RemoveAll
        Set DIC = Nothing
    Else
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.Enabled = False
    End If
    txt_zeile = lngZeile
    If lbl_lagerort = "" Then
        lbl_lagerort.Caption = "Kein Lagerort zugewiesen!"
    End If
    txtstueck.SetFocus
End Sub

Private Sub cboArtikelNR_Change() 'v1.44
    Call SuchArtikel
    If Not Me.lstArtikelID.ListCount > 1 Then
        Call Klickliste
    End If
End Sub

Sub Klickliste()
    Dim xrow, xrow2, lngg, lng, lngZeile2 As Long
    Dim xKey As Variant
    Dim DIC As Object
    Dim arrTmpA, arrTmpB, i, n As Long
    Dim Last_Row, lngL As Long
    On Error Resume Next

    Call SuchArtikel
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:N" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If arrTmpA(i, 3) = CStr(cboArtikelNR) Then
                xrow = i
            End If
        Next i
    End With
    lbl_itemnumber.Caption = Sheets("Lager").Cells(xrow, 3)
    If lstArtikelID.Column(2) = "VP" Then
        lngZeile2 = lstArtikelID.Column(1)
        lbl_itemnumber.Caption = Sheets("Lager").Cells(xrow, 3).Value & "-1" & Sheets("VPEinheit").Cells(lngZeile2, 3).Value
    End If
    Application.ScreenUpdating = False
    lbl_bezeichnung.Caption = Sheets("Lager").Cells(xrow, 6)
    lbl_herstellerNr.Caption = Sheets("Lager").Cells(xrow, 4)
    lbl_lagerort.Caption = Sheets("Lager").Cells(xrow, 13)
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    txtID.Value = Sheets("Lager").Cells(xrow, 1)
    txt_zeile = xrow
    Set DIC = CreateObject("scripting.dictionary")
    For lng = 2 To Worksheets("Lagerorte").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Lagerorte").Cells(lng, 2) = txtID.Text Then
            xKey = Sheets("Lagerorte").Cells(lng, 3).Value
            DIC(xKey) = 0
            lngg = lngg + 1
        End If
    Next lng
    If CDbl(lngg) > 0 Then
        cbo_Lagerplatz.Enabled = True
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.AddItem "Hauptlagerplatz"
        For Each xKey In DIC
            cbo_Lagerplatz.AddItem xKey
        Next
        DIC.RemoveAll
        Set DIC = Nothing
        cbo_Lagerplatz.ListIndex = 0
    Else
        cbo_Lagerplatz.Clear
        cbo_Lagerplatz.Enabled = False
    End If
    If cbo_Lieferant = "Alle anzeigen" Then
        txt_EKPreis.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
        txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
    Else
        If Sheets("Lager").Cells(xrow, 18).Value = "" Then
            txt_EKPreis.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
            txt_VKPreis = Format(CDbl(Sheets("Lager").Cells(xrow, 15).Value), "currency")
        ElseIf CStr(Sheets("Lager").Cells(xrow, 18)) = CStr(txt_LVerfuegbar) Then
            txt_EKPreis.Value = Format(Sheets("Lager").Cells(xrow, 14).Value, "currency")
            txtpreis.Value = Sheets("Lager").Cells(xrow, 14).Value
            txt_VKPreis = Format(CDbl(Sheets("Lager").Cells(xrow, 15).Value), "currency")
        Else
            With ThisWorkbook.Sheets("VPEinheit")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:N" & Last_Row)
                ReDim arrTmpB(1 To 9, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                    If arrTmpA(i, 2) = CStr(Me.txtID) And arrTmpA(i, 10) = CStr(txt_LVerfuegbar) And arrTmpA(i, 14) = "VP-WL" Then
                        xrow2 = i
                    End If
                Next i
            End With
            txt_EKPreis.Value = Format(Sheets("VPEinheit").Cells(xrow2, 13), "currency")
            txtpreis.Value = Sheets("VPEinheit").Cells(xrow2, 13)
            txt_VKPreis = "-"
        End If
    End If
    If lbl_lagerort = "" Then
        lbl_lagerort.Caption = "Kein Lagerort zugewiesen!"
    End If
    Application.ScreenUpdating = True
End Sub

Sub SuchArtikel()
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n, w As Long
    Dim SuchKriterium As String
    On Error Resume Next
    txtID.Value = ""
    txt_VPMenge.Value = ""
    Application.ScreenUpdating = False
    SuchKriterium = LCase(cboArtikelNR.Text)
    lstArtikelID.Clear
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:R" & Last_Row)
        ReDim arrTmpB(1 To 2, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            w = 0
            If cbo_Lieferant = "" Or cbo_Lieferant = "Alle anzeigen" Then
                If LCase(arrTmpA(i, 3)) Like SuchKriterium Then
                    w = w + 1
                    n = n + 1
                    arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = ""
                End If
            Else
                w = 0
                If LCase(arrTmpA(i, 3)) Like SuchKriterium And arrTmpA(i, 18) Like txt_LVerfuegbar Then
                    n = n + 1
                    w = w + 1
                    arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = ""
                End If
            End If
            If w = 0 Then
                If LCase(arrTmpA(i, 3)) Like SuchKriterium Then
                    n = n + 1
                    arrTmpB(1, n) = VBA.Replace(CStr(arrTmpA(i, 6)), Chr$(13) & Chr$(10), " ")
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = ""
                End If
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 3)
             For i = 1 To 3
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With lstArtikelID
                .ColumnCount = 3
                .ColumnWidths = "180;0;0"
                .List = arrTmpA
             End With
        End If
     End With
     Application.ScreenUpdating = True
End Sub

Private Sub lblButtonHelp_Click()
    MsgBox "Als Beleg kann eine Rechnungsnummer verwendet werden. Oder geben Sie ein Referenztext an!", vbOKOnly, "Info"
End Sub

Private Sub cmdexit_Click()
    Unload frmWareneingangoB
    frmLager.Show
End Sub

Private Sub cmdchanel_Click()
    Unload frmWareneingangoB
    frmLager.Show
End Sub

Sub SuchenVP()
    Dim Last_Row, lngL, arrTmpA, arrTmpB, i, j, n As Long
    On Error Resume Next
    lstArtikelID2.Clear
    lngL = 0
    If Not cbo_Lieferant = "Alle anzeigen" Then
        lngL = 1
        With ThisWorkbook.Sheets("VPEinheit")
           Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
           arrTmpA = .Range("A1:R" & Last_Row)
           ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
           For i = 2 To UBound(arrTmpA)
               If arrTmpA(i, 2) = CStr(Me.txtID) And CStr(arrTmpA(i, 14)) = "VP-LB" Then
                   n = n + 1
                   arrTmpB(1, n) = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ") " & lbl_bezeichnung
                   arrTmpB(2, n) = i
                   arrTmpB(3, n) = "VP"
               End If
           Next i
        End With
    Else
        With ThisWorkbook.Sheets("VPEinheit")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:P" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If arrTmpA(i, 2) = CStr(Me.txtID) And CStr(arrTmpA(i, 14)) = "VP-LB" Then
                    n = n + 1
                    arrTmpB(1, n) = arrTmpA(i, 5) & " (" & arrTmpA(i, 3) & " " & arrTmpA(i, 4) & ") " & lbl_bezeichnung
                    arrTmpB(2, n) = i
                    arrTmpB(3, n) = "VP"
                End If
            Next i
        End With
    End If
    Erase arrTmpA
    ReDim arrTmpA(1 To n, 1 To 3)
    For i = 1 To 3
       For j = 1 To n
           arrTmpA(j, i) = arrTmpB(i, j)
       Next
    Next
    With lstArtikelID2
       .ColumnCount = 3
       .ColumnWidths = "180;20;20"
       .List = arrTmpA
    End With
End Sub

Sub PruefenWL()
    Dim arrTmpA, arrTmpB, i, lngS As Long
    Dim Last_Row, lng As Long
    Dim lng2, xrow, rz As Long
    Dim stxt, sWert, strL, strNr, strF, strM As String
    Dim arrTmpA2, arrTmpB2, i2  As Long
    Dim Last_Row2, lngL2, wert, Wert2 As Long
    On Error Resume Next
        
    wert = 0
    Wert2 = 0
    With ThisWorkbook.Sheets("Lager")
        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA2 = .Range("A1:AA" & Last_Row2)
        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
        For i2 = 2 To UBound(arrTmpA2)
            If CStr(arrTmpA2(i2, 1)) = CStr(txtID) And arrTmpA2(i2, 18) = CStr(txt_LVerfuegbar) Then
               wert = wert + 1
            End If
        Next i2
    End With
    With ThisWorkbook.Sheets("VPEinheit")
        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA2 = .Range("A1:P" & Last_Row2)
        ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
        For i2 = 2 To UBound(arrTmpA2)
            If arrTmpA2(i2, 2) = Me.txtID And arrTmpA2(i2, 10) = CStr(txt_LVerfuegbar) And arrTmpA2(i2, 14) = "VP-WL" Then
                Wert2 = Wert2 + 1
            End If
        Next i2
    End With
    If wert + Wert2 = 0 Then
        strM = MsgBox("M|fffd|chten den Lieferanten (" & cbo_Lieferant & ") dem Artikel hinzuf|fffd|gen?", vbYesNo, "Weiterer Lieferant")
        If strM = vbYes Then
            Call BWLieferant
        End If
    End If
End Sub

Sub BWLieferant()
    Dim MaxID, z, zeile, LRow, letztezeile, wert As Long
    Dim xrow As Long

    If txt_EKPreis.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    Sheets("Lagerorte").Activate
    LRow = CLng(Sheets("VPEinheit").Cells(Rows.Count, 1).End(xlUp).Row) + 1
    letztezeile = ActiveSheet.UsedRange.SpecialCells(xlLastCell).Row
    MaxID = 0
    For z = 2 To letztezeile
        If CDbl(Cells(z, 1)) > MaxID Then
            MaxID = CDbl(Cells(z, 1))
        End If
    Next
    If Sheets("Daten").Cells(43, 4) = "" Or Sheets("Daten").Cells(43, 4) = 0 Then
        If CDbl(MaxID) > 1 Then
            GoTo weiter
        End If
        Sheets("Daten").Cells(43, 4).Value = 1
        zeile = 1
    Else
weiter:
        If CDbl(MaxID) > CDbl(Sheets("Daten").Cells(43, 4).Value) Then
            zeile = CDbl(MaxID) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(MaxID) + 1
        Else
            zeile = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
            Sheets("Daten").Cells(43, 4).Value = CDbl(Sheets("Daten").Cells(43, 4).Value) + 1
        End If
    End If
    Sheets("VPEinheit").Cells(LRow, 1) = "'" & CStr(zeile) 'VP-ID
    Sheets("VPEinheit").Cells(LRow, 2) = "'" & CStr(txtID)
    Sheets("VPEinheit").Cells(LRow, 3) = 1
    Sheets("VPEinheit").Cells(LRow, 6) = ""
    Sheets("VPEinheit").Cells(LRow, 7) = ""
    Sheets("VPEinheit").Cells(LRow, 8) = ""
    Sheets("VPEinheit").Cells(LRow, 9) = "'" & CStr(lbl_herstellerNr)
    Sheets("VPEinheit").Cells(LRow, 10) = "'" & CStr(txt_LVerfuegbar)
    Sheets("VPEinheit").Cells(LRow, 11) = "'" & CStr(cbo_Lieferant)
    Sheets("VPEinheit").Cells(LRow, 12) = "-"
    Sheets("VPEinheit").Cells(LRow, 13) = CDbl(txt_EKPreis)
    Sheets("VPEinheit").Cells(LRow, 14) = "VP-WL"
    Sheets("VPEinheit").Cells(LRow, 16) = CStr(Sheets("Daten").Cells(24, 2))
    Sheets("Center").Activate
    Application.ScreenUpdating = True
End Sub

Private Sub cmdhinzu_Click() 'v1.44
    Dim Last_Row, lngLine, lngZeile, arrTmpA, arrTmpB, i As Long
    Dim Last_Row2, lngLine2, arrTmpA2, arrTmpB2, i2 As Long
    Dim strArticle, Rstr, RIStr, stxt, Dstr, Dstr2, strLO As String
    On Error Resume Next

    If lbl_bezeichnung.Caption = "" Then Exit Sub
    Call PruefenWL
    strLO = ""
    If txtbeleg.Value = "" Then
        MsgBox "Bitte geben Sie einen Beleg oder eine Referenz an!", vbOKOnly, "Hinweis"
        txtbeleg.SetFocus
        Exit Sub
    End If
    If txtstueck.Value = "" Then
        MsgBox "Bitte geben Sie eine Menge an!", vbOKOnly, "Hinweis"
        txtstueck.SetFocus
        Exit Sub
    End If
    Dstr = MsgBox("M|fffd|chten Sie das aktuelle Datum verwenden?", vbYesNo, "Wareneingangsdatum")
    If Dstr = vbNo Then
        Dstr2 = InputBox("Bitte geben Sie ein Datum ein!" & vbLf & "Format: DD.MM.YYYY", "Wareneingang am:")
        If Dstr2 = "" Then
            MsgBox "Es wurde kein Datum angegeben!", , "Datum fehlt!"
            Exit Sub
        End If
    Else
        Dstr2 = Date
    End If
    With Worksheets("Wareneingang")
        If .FilterMode Then .ShowAllData
    End With
    With Worksheets("Lager")
        If .FilterMode Then .ShowAllData
    End With
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
             If arrTmpA(i, 1) = CStr(txtID) Then
                lngLine = i
             End If
        Next i
    End With
    If Not Sheets("Lager").Cells(lngLine, 42) = "" Then
        MsgBox "Artikel: """ & Sheets("Lager").Cells(lngLine, 6) & """ ist gesperrt!", , "Gesperrt seit: " & Sheets("Lager").Cells(lngLine, 42)
        Exit Sub
    End If
    If Not txt_LPID.Value = "" Then
        With ThisWorkbook.Worksheets("Lagerorte")
            lngLine = 0
            With ThisWorkbook.Sheets("Lagerorte")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                     If arrTmpA(i, 1) = CStr(txt_LPID) Then
                        lngLine = i
                        strLO = CStr(arrTmpA(i, 3))
                     End If
                Next i
            End With
            If lngLine > 0 Then
                If Not txt_VPMenge.Value = "" Then
                    .Cells(lngLine, 4).Value = .Cells(lngLine, 4).Value + (CDbl(txtstueck.Value) * CDbl(txt_VPMenge.Value))
                Else
                    .Cells(lngLine, 4).Value = .Cells(lngLine, 4).Value + CDbl(txtstueck.Value)
                End If
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                         If arrTmpA2(i, 1) = CStr(txtID) Then
                            lngLine2 = i
                         End If
                    Next i2
                End With
                If Not txt_EKPreis.Value = txt_EKPreis2.Value Then
                    Sheets("Lager").Cells(lngLine2, 14).Value = CDbl(txt_EKPreis)
                End If
                If Not txt_VKPreis.Value = txt_VKPreis2.Value Then
                    Sheets("Lager").Cells(lngLine2, 15).Value = CDbl(txt_VKPreis)
                End If
            End If
        End With
    Else
        With ThisWorkbook.Worksheets("Lager")
            lngLine = 0
            With ThisWorkbook.Sheets("Lager")
                Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA = .Range("A1:AO" & Last_Row)
                ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
                For i = 2 To UBound(arrTmpA)
                     If arrTmpA(i, 1) = CStr(txtID) Then
                        lngLine = i
                        strLO = arrTmpA(i, 13)
                     End If
                Next i
            End With
            If txt_EKPreis.Value <> txt_EKPreis2.Value Then
                .Cells(lngLine, 14).Value = CDbl(txt_EKPreis)
            End If
            If txt_VKPreis.Value <> txt_VKPreis2.Value Then
                .Cells(lngLine, 15).Value = CDbl(txt_VKPreis)
            End If
            If lngLine > 0 Then
                If Not txt_VPMenge.Value = "" Then
                    .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value + (CDbl(txtstueck.Value) * CDbl(txt_VPMenge.Value))
                Else
                    .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value + CDbl(txtstueck.Value)
                End If
                    If Not Worksheets("Lager").Cells(lngLine, 9).Value = "" Then
                        If frmLager.txtMeldeBestand.Value = "" Then
                            If Not Worksheets("Lager").Cells(lngLine, 9).Value = "Bestellt" And CDbl(Worksheets("Lager").Cells(lngLine, 8).Value) <= CDbl(Worksheets("Lager").Cells(lngLine, 10).Value) Then 'Spalte "Status"
                                Worksheets("Lager").Cells(lngLine, 9) = "Bestellen"
                                Worksheets("Lager").Cells(lngLine, 9).Font.ColorIndex = 3
                            Else
                                Worksheets("Lager").Cells(lngLine, 9) = ""
                            End If
                        Else
                            If Not Worksheets("Lager").Cells(lngLine, 9).Value = "Bestellt" And CDbl(Worksheets("Lager").Cells(lngLine, 8).Value) <= CDbl(Worksheets("Lager").Cells(lngLine, 11).Value) Then 'Spalte "Status"
                                Worksheets("Lager").Cells(lngLine, 9) = "Bestellen"
                                Worksheets("Lager").Cells(lngLine, 9).Font.ColorIndex = 3
                            Else
                                Worksheets("Lager").Cells(lngLine, 9) = ""
                            End If
                        End If
                    End If
            End If
        End With
    End If
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Wareneingang").Cells(Rows.Count, 1).End(xlUp).Row + 1
    ThisWorkbook.Worksheets("Wareneingang").Activate
    If cboErzeugnis.Value = "Fremderzeugnis" Then
        Worksheets("Wareneingang").Cells(lngZeile, 1).Value = txtbeleg.Value
    Else
        Worksheets("Wareneingang").Cells(lngZeile, 1).Value = txtbeleg.Value
        Worksheets("Wareneingang").Cells(lngZeile, 10).Value = "Eigenes Erzeugnis " & Format(Dstr2, "DD.MM.YYYY")
    End If
    If cbo_Lieferant.ListIndex = 0 And Me.cbo_LVerfuegbar = "" Then
        Worksheets("Wareneingang").Cells(lngZeile, 2).Value = "keine Angabe"
    ElseIf cbo_Lieferant.ListIndex = 0 And Not Me.cbo_LVerfuegbar = "" Then
        Worksheets("Wareneingang").Cells(lngZeile, 2).Value = cbo_LVerfuegbar
    Else
        Worksheets("Wareneingang").Cells(lngZeile, 2).Value = cbo_Lieferant
    End If
    Worksheets("Wareneingang").Cells(lngZeile, 3).Value = lbl_itemnumber
    Worksheets("Wareneingang").Cells(lngZeile, 4).Value = "'" + lbl_herstellerNr.Caption
    Worksheets("Wareneingang").Cells(lngZeile, 5).Value = lbl_bezeichnung.Caption
    If Not txt_VPMenge.Value = "" Then
        Worksheets("Wareneingang").Cells(lngZeile, 6).Value = CDbl(txtstueck.Value) * CDbl(txt_VPMenge.Value)
    Else
        Worksheets("Wareneingang").Cells(lngZeile, 6).Value = CDbl(txtstueck.Value)
    End If
    Worksheets("Wareneingang").Cells(lngZeile, 7).Value = "manueller WE"
    Worksheets("Wareneingang").Cells(lngZeile, 8).Value = Format(Dstr2, "DD.MM.YYYY")
    Worksheets("Wareneingang").Cells(lngZeile, 9).Value = Format(Time, "hh:mm:ss")
    Worksheets("Wareneingang").Cells(lngZeile, 11).Value = CDbl(txtpreis.Value)
    Worksheets("Wareneingang").Cells(lngZeile, 12).Value = txtID.Value
    If Sheets("Daten").Range("B5").Value = "True" Then
        Worksheets("Wareneingang").Cells(lngZeile, 13).Value = Sheets("Daten").Range("B24").Value
    End If
    Rstr = MsgBox("M|fffd|chten Sie eine Rechnungsnummer erfassen?", vbYesNo, "Rechnungsnummer")
    If Rstr = vbYes Then
        RIStr = InputBox("Bitte geben Sie eine Rechnungsnummer an!", "Rechnungsnummer")
        If Not RIStr = "" Then
            Worksheets("Wareneingang").Cells(lngZeile, 14).Value = "'" & RIStr
        End If
    End If
    Worksheets("Wareneingang").Cells(lngZeile, 16).Value = Format(Dstr2, "MMMM")
    Worksheets("Wareneingang").Cells(lngZeile, 17).Value = Format(Dstr2, "YYYY")
    Worksheets("Wareneingang").Cells(lngZeile, 18).Value = strLO
    cboArtikelNR.Value = ""
    lbl_bezeichnung.Caption = ""
    txtstueck.Value = ""
    lbl_herstellerNr.Caption = ""
    lbl_lagerort.Caption = ""
    Call SuchenBeleg
    Call AnsichtLager
    lstArtikelID.Clear
    Worksheets("Center").Activate
    cboArtikelNR.SetFocus
    Application.ScreenUpdating = True
    MsgBox "Artikel wurde hinzugef|fffd|gt", vbOKOnly, "Hinweis"
End Sub

Sub LieferantCombo()
    Dim irow, ALetzte As Long
    Dim xKey As Variant
    Dim DIC As Object
    On Error Resume Next
    cbo_Lieferant.Clear
    With cbo_Lieferant
       ALetzte = Sheets("Lieferanten").Cells(Rows.Count, 1).End(xlUp).Row
       Set DIC = CreateObject("scripting.dictionary")
       For irow = 2 To ALetzte
           If Not IsEmpty(Sheets("Lieferanten").Cells(irow, 2)) Then
               xKey = VBA.Replace(CStr(Sheets("Lieferanten").Cells(irow, 2).Value), Chr$(13) & Chr$(10), " ")
               DIC(xKey) = 0
           End If
       Next
       cbo_Lieferant.AddItem "Alle anzeigen"
       For Each xKey In DIC
           cbo_Lieferant.AddItem xKey
       Next
       DIC.RemoveAll
       Set DIC = Nothing
       cbo_Lieferant.ListIndex = 0
    End With
    cbo_Lieferant = "Alle anzeigen"
End Sub

Sub ArtikelCombo() 'v1.44
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    cboArtikelNR.Clear
    Application.ScreenUpdating = False
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Lager").Cells(Rows.Count, 1).End(xlUp).Row
      objDic(Sheets("Lager").Cells(lngZ, 3).Value) = 0
    Next
    cboArtikelNR.List = objDic.keys
    Set objDic = Nothing
    Application.ScreenUpdating = True
End Sub

Sub SuchenBeleg() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    SuchKriterium = CStr(txtbeleg.Text)
    lstWAimputoB.Clear
    Application.ScreenUpdating = False
    With ThisWorkbook.Sheets("Wareneingang")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 6, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            If LCase(arrTmpA(i, 1)) = LCase(CStr(SuchKriterium)) Then
                n = n + 1
                arrTmpB(1, n) = arrTmpA(i, 1)
                arrTmpB(2, n) = arrTmpA(i, 3)
                arrTmpB(3, n) = arrTmpA(i, 4)
                arrTmpB(4, n) = VBA.Replace(CStr(arrTmpA(i, 5)), Chr$(13) & Chr$(10), " ")
                arrTmpB(5, n) = arrTmpA(i, 6)
                arrTmpB(6, n) = i
            End If
        Next i
    End With
    If n > 0 Then
        Erase arrTmpA
        ReDim arrTmpA(1 To n, 1 To 6)
        For i = 1 To 6
           For j = 1 To n
               arrTmpA(j, i) = arrTmpB(i, j)
           Next
        Next
        With lstWAimputoB
           .ColumnCount = 6
           .ColumnWidths = "70;70;70;200;30;0"
           .List = arrTmpA
        End With
    End If
    txt_EKPreis.Value = ""
    txt_EKPreis2.Value = ""
    cbo_Lagerplatz.Clear
    cboArtikelNR.ListIndex = -1
    lbl_bezeichnung.Caption = ""
    lbl_herstellerNr.Caption = ""
    txt_VKPreis.Value = ""
    txt_VKPreis2.Value = ""
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "frmWarenentnahmeschein"
Attribute VB_Base = "0{F95ADA7B-7692-4D80-8DE6-CBBB98428618}{D82F1678-CD59-4F1E-8CB2-08647E4ECF3F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    With cboArt
        .AddItem "Barverkauf"
        .AddItem "Rechnung"
        .AddItem "Angebot NEU"
        .AddItem "Angebot ausw|fffd|hlen"
        .AddItem "Auftrag NEU"
        .AddItem "Auftrag ausw|fffd|hlen"
        .AddItem "Intern"
        .AddItem "Umwandeln"
    End With
End Sub

Private Sub txtRnr_AfterUpdate()
    Dim Last_Row, arrTmpB, arrTmpA, xrow, i As Long
    Dim strMsg As String
    On Error Resume Next
    If Not frmWarenentnahmeschein.txtRnr = "" And cboArt = "Auftrag NEU" Then
        Application.ScreenUpdating = False
        With ThisWorkbook.Sheets("Warenausgang")
            Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
            arrTmpA = .Range("A1:AO" & Last_Row)
            ReDim arrTmpB(1 To 4, 1 To UBound(arrTmpA))
            For i = 2 To UBound(arrTmpA)
                If Not arrTmpA(i, 2) = "" And CStr(arrTmpA(i, 2)) = CStr(frmWarenentnahmeschein.txtRnr) Then
                    xrow = i
                End If
            Next i
        End With
        Application.ScreenUpdating = True
        If xrow > 0 Then
            strMsg = MsgBox("Die Auftragsnummer " + (txtRnr) + " wurde bereits erfasst! M|fffd|chten Sie fortfahren?", vbYesNo, "Hinweis")
            If strMsg = vbNo Then
                frmWarenentnahmeschein.txtRnr.Value = ""
                frmWarenentnahmeschein.txtRnr.SetFocus
            End If
        End If
    End If
    If Not frmWarenentnahmeschein.txtRnr = "" Then
        txtRnr.BackColor = &HFFFFFF
    Else
        txtRnr.BackColor = &H8080FF
    End If
End Sub

Private Sub cboauftraege_click()
    txtRnr.Value = cboauftraege.Text
End Sub

Private Sub cmdchanel_Click()
    Unload frmWarenentnahmeschein
End Sub

Private Sub cboArt_Change()
    Dim strFor As String
    
    If cboArt.Value = "Rechnung" Then
        txtRnr.Value = ""
        txtRnr.Enabled = True
        lbRNr.Caption = "Rechnungs Nr."
        txtRnr.Visible = True
        lbRNr.Visible = True
        txtRnr.Locked = False
        lblAuftragR.Visible = False
        cboauftraege.Visible = False
        txtR.Value = 0
        txtRnr.SetFocus
        cmdbuchen.Caption = "Weiter"
        txt_GAID.Value = ""
    ElseIf cboArt.Value = "Auftrag" Then
        txtRnr.Enabled = True
        lbRNr.Caption = "Auftrags Nr."
        lbRNr.Visible = True
        txtRnr.Visible = True
        txtRnr.Locked = False
        lblAuftragR.Visible = False
        cboauftraege.Visible = False
        txtR.Value = 0
        txtRnr.SetFocus
        cmdbuchen.Caption = "Weiter"
        txt_GAID.Value = ""
    ElseIf cboArt.Value = "Angebot NEU" Then
        txtRnr.Enabled = True
        lbRNr.Caption = "Angebot Nr."
        lbRNr.Visible = True
        txtRnr.Visible = True
        txtRnr.Locked = False
        lblAuftragR.Visible = False
        cboauftraege.Visible = False
        txtR.Value = 1
        cmdbuchen.Caption = "Weiter"
        txt_GAID.Value = ""
        If Not Sheets("Daten").Range("D35").Value = "Nein" Or Sheets("Daten").Range("D35").Value = "" Then
            If CStr(Sheets("Daten").Range("D35")) = "Auswahl 1" Then
                strFor = Sheets("Daten").Range("D38")
                txtRnr.Value = Sheets("Daten").Range("D36") & Format(CDbl(Sheets("Daten").Range("D37") + 1), strFor)
            Else
                txtRnr.Value = "AN" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
            End If
            txtanzahl.SetFocus
        End If
        txtRnr.SetFocus
    ElseIf cboArt.Value = "Auftrag ausw|fffd|hlen" Then
        txtRnr.Enabled = True
        lbRNr.Caption = "Auftrags Nr."
        lbRNr.Visible = True
        txtRnr.Visible = True
        lblAuftragR.Visible = True
        cboauftraege.ListIndex = -1
        cboauftraege.Visible = True
        cboauftraege.SetFocus
        txtRnr.Value = ""
        txtR.Value = 1
        cmdbuchen.Caption = "Weiter"
        txtRnr.Enabled = False
        txt_GAID.Value = ""
        Call RAuftraege
    ElseIf cboArt.Value = "Angebot ausw|fffd|hlen" Then
        txtRnr.Enabled = True
        lbRNr.Caption = "Auftrags Nr."
        lbRNr.Visible = True
        txtRnr.Visible = True
        lblAuftragR.Visible = True
        cboauftraege.ListIndex = -1
        cboauftraege.Visible = True
        cboauftraege.SetFocus
        txtRnr.Value = ""
        txtR.Value = 1
        cmdbuchen.Caption = "Weiter"
        txtRnr.Enabled = False
        txt_GAID.Value = ""
        Call RAngebote
    ElseIf cboArt.Value = "Auftrag NEU" Then
        txtRnr.Enabled = True
        lbRNr.Caption = "Auftrags Nr."
        lbRNr.Visible = True
        txtRnr.Visible = True
        lblAuftragR.Visible = False
        cboauftraege.Visible = False
        txtR.Value = 1
        If Not Sheets("Daten").Range("D31").Value = "Nein" Or Sheets("Daten").Range("D31").Value = "" Then
            If Sheets("Daten").Range("D31") = "Auswahl 1" Then
                strFor = Sheets("Daten").Range("D34")
                txtRnr.Value = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
            Else
                txtRnr.Value = "AUF" & Format(Date, "DDMMYY") & Format(Time, "HHMMSS")
            End If
            txtanzahl.SetFocus
        Else
            txtRnr.Value = ""
        End If
        txtRnr.Locked = False
        cmdbuchen.Caption = "Weiter"
        txtRnr.Enabled = True
        txt_GAID.Value = ""
        txtRnr.SetFocus
    ElseIf cboArt.Value = "Umwandeln" Then
        lbRNr.Caption = "in Artikel"
        lbRNr.Visible = True
        txtRnr.Visible = True
        lblAuftragR.Visible = False
        cboauftraege.Visible = False
        txtRnr.Enabled = False
        txtRnr.Value = frmGruppen.txt_ANr.Value
        txt_GAID.Value = frmGruppen.txt_AID.Value
        cmdbuchen.Caption = "Umwandeln"
        If frmGruppen.txt_ANr.Value = "" Then
            MsgBox "Der Gruppe ist kein Artikel zugeordnet! ", , "Hinweis"
            cboArt.ListIndex = -1
            Exit Sub
        End If
    Else
        txtRnr.Visible = False
        lbRNr.Visible = False
        txtR.Value = 0
        cboauftraege.Visible = False
        cmdbuchen.Caption = "Weiter"
        txtRnr.Enabled = True
        txt_GAID.Value = ""
    End If
End Sub

Private Sub cmdbuchen_Click()
    Dim stxt As Long
    Dim strFor, strAUNext, strAUNr As String
    On Error Resume Next
    
    If cboArt = "" Then
        MsgBox "W|fffd|hlen Sie eine Art aus!", , "Hinweis"
        cboArt.SetFocus
        Exit Sub
    End If
    If cboArt = "Umwandeln" Then
        Call Umwandeln
        Exit Sub
    End If
    If cboArt.Value = "Auftrag NEU" Or cboArt.Value = "Angebot NEU" Then
        If cboArt.Value = "Auftrag NEU" Then
            If Sheets("Daten").Range("D31") = "Auswahl 1" Then
                strFor = Sheets("Daten").Range("D34")
                strAUNext = Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
                strAUNr = Sheets("Daten").Range("D32") & Format(CDbl(Sheets("Daten").Range("D33") + 1), strFor)
                If CStr(txtRnr) = CStr(strAUNr) Then
                    Sheets("Daten").Range("D33") = "'" & CStr(strAUNext)
                End If
            End If
        End If
        If cboArt.Value = "Angebot NEU" Then
            If Sheets("Daten").Range("D35") = "Auswahl 1" Then
                strFor = Sheets("Daten").Range("D38")
                strAUNext = Format(CDbl(Sheets("Daten").Range("D37") + 1), strFor)
                strAUNr = Sheets("Daten").Range("D36") & Format(CDbl(Sheets("Daten").Range("D37") + 1), strFor)
                If CStr(txtRnr) = CStr(strAUNr) Then
                    Sheets("Daten").Range("D37") = "'" & CStr(strAUNext)
                End If
            End If
        End If
        stxt = MsgBox("M|fffd|chten Sie einen Kunden ausw|fffd|hlen?", vbYesNo, "Kunden ausw|fffd|hlen")
        If stxt = vbYes Then
            Call Kunden
        End If
    End If
    If cboArt.Value = "Rechnung" And frmWarenentnahmeschein.txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Rechnungsnummer an!", , "Hinweis"
        frmWarenentnahmeschein.txtRnr.SetFocus
        Exit Sub
    End If
    If cboArt.Value = "Auftrag NEU" And frmWarenentnahmeschein.txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Auftragsnummer an!", , "Hinweis"
        frmWarenentnahmeschein.txtRnr.SetFocus
        Exit Sub
    End If
    If cboArt.Value = "Angebot NEU" And frmWarenentnahmeschein.txtRnr.Value = "" Then
        MsgBox "Geben Sie eine Angebotsnummer an!", , "Hinweis"
        frmWarenentnahmeschein.txtRnr.SetFocus
        Exit Sub
    End If
    If cboArt.Value = "Auftrag ausw|fffd|hlen" And frmWarenentnahmeschein.cboauftraege = "" Then
        MsgBox "Bitte w|fffd|hlen Sie eine Auftragsnummer!", , "Hinweis"
        frmWarenentnahmeschein.cboauftraege.SetFocus
        Exit Sub
    End If
    If cboArt.Value = "Angebot ausw|fffd|hlen" And frmWarenentnahmeschein.cboauftraege = "" Then
        MsgBox "Bitte w|fffd|hlen Sie eine Angebotsnummer!", , "Hinweis"
        frmWarenentnahmeschein.cboauftraege.SetFocus
        Exit Sub
    End If
    If txtR.Value = 0 Then
        If txtanzahl.Value > 0 Then WarenausgangGruppe
    Else
        If txtanzahl.Value > 0 Then WarenausgangGruppe2
    End If
End Sub

Sub Kunden()
    frmContact.txt_IDART.Value = "WAG"
    frmContact.cboAnsp.Visible = False
    frmContact.txtdate.Visible = False
    frmContact.lblinfo.Visible = False
    frmContact.comnext.Visible = False
    frmContact.cmd_invoiceprint.Visible = False
    frmContact.cmdnextL.Visible = False
    frmContact.lblMitarbeiter.Visible = False
    frmContact.cmd_KDsave.Visible = True
    frmContact.lblinfo2.Visible = False
    frmContact.Show
End Sub

Private Sub txtanzahl_Change()
    On Error GoTo sprungmarke
    If CDbl(frmGruppen.txtmin.Value) <= 0 Then
        lblhinweis.Caption = "Nicht Verf|fffd|gbar!"
    ElseIf CDbl(frmGruppen.txtmin.Value) < CDbl(txtanzahl) Then
        lblhinweis.Caption = "Achtung! Nur " + frmGruppen.txtmin.Text + " Verf|fffd|gbar!"
    Else
        lblhinweis.Caption = ""
    End If
    Exit Sub
sprungmarke:
    lblhinweis.Caption = "Falsche oder keine Eingabe!"
End Sub

Sub WarenausgangGruppe() 'v1.44
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2, j2, n2, lng2, lngs2, lngIndex, lngID, lngZeile As Long
    Dim SINP, strID As String
    Dim SuchKriterium2 As String
    On Error Resume Next
    If frmGruppen.cbo_Gruppe.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    Sheets("Kassendaten").Activate
    lngZeile = Worksheets("Kassendaten").Cells(Rows.Count, 1).End(xlUp).Row
    For lngIndex = 0 To frmGruppen.lstGruppen.ListCount - 1
        If frmGruppen.lstGruppen.Selected(lngIndex) Then
            lngZeile = lngZeile + 1
            strID = Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 1)
            With ThisWorkbook.Sheets("Lager")
                Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA2 = .Range("A1:AO" & Last_Row2)
                ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                For i2 = 2 To UBound(arrTmpA2)
                    If arrTmpA2(i2, 1) = CStr(strID) Then
                        lngID = i2
                    End If
                Next i2
            End With
            If Worksheets("Lager").Cells(CDbl(lngID), 30) = "Y" Then
                SINP = InputBox("Bitte geben Sie die Seriennummer an!" & vbLf & "Artikel: " + frmGruppen.lstGruppen.Column(2, lngIndex) + vbLf & vbLf & "Tipp: Sie k|fffd|nnen die Serien- Nr. auch scannen", "Seriennummer")
                If Not SINP = "" Then
                    Worksheets("Kassendaten").Cells(lngZeile, 19).Value = SINP
                    Worksheets("Kassendaten").Cells(lngZeile, 6).Value = frmGruppen.lstGruppen.Column(2, lngIndex) & " /SN:" & SINP
                    Worksheets("Kassendaten").Cells(lngZeile, 7).Value = "1"
                Else
                    Application.ScreenUpdating = True
                    Exit Sub
                End If
            Else
                Worksheets("Kassendaten").Cells(lngZeile, 6).Value = frmGruppen.lstGruppen.Column(2, lngIndex) 'Bezeichnung
                Worksheets("Kassendaten").Cells(lngZeile, 7).Value = frmGruppen.lstGruppen.Column(3, lngIndex) * CDbl(txtanzahl.Value)
            End If
            If cboArt.Text = "Intern" Then
                Worksheets("Kassendaten").Cells(lngZeile, 1) = "Intern" & Format(Date, "dd.mm.yy") & "/" & Format(Time, "hhmmss")
            ElseIf cboArt.Value = "Barverkauf" Then
                 Worksheets("Kassendaten").Cells(lngZeile, 1).Value = "Barverkauf " & Date
            Else
                Worksheets("Kassendaten").Cells(lngZeile, 1).Value = "'" & txtRnr 'Belegnummer
            End If
            Worksheets("Kassendaten").Cells(lngZeile, 2).Value = "'" & frmGruppen.lstGruppen.Column(0, lngIndex) 'Artikelnummer
            Worksheets("Kassendaten").Cells(lngZeile, 3).Value = Worksheets("Lager").Cells(CDbl(lngID), 4)
            Worksheets("Kassendaten").Cells(lngZeile, 4).Value = Worksheets("Lager").Cells(CDbl(lngID), 7)
            Worksheets("Kassendaten").Cells(lngZeile, 8).Value = Worksheets("Lager").Cells(CDbl(lngID), 15) * CDbl(frmGruppen.lstGruppen.Column(3, lngIndex)) * CDbl(txtanzahl)
            Worksheets("Kassendaten").Cells(lngZeile, 10).Value = Worksheets("Gruppen").Cells(frmGruppen.lstGruppen.Column(9, lngIndex), 6)
            Worksheets("Kassendaten").Cells(lngZeile, 11).Value = frmWarenentnahmeschein.cboArt.Text
            Worksheets("Kassendaten").Cells(lngZeile, 12).Value = Worksheets("Lager").Cells(CDbl(lngID), 21)
            If Worksheets("Lager").Cells(CDbl(lngID), 17) = "" And Worksheets("Lager").Cells(CDbl(lngID), 14) = "" Then
                Worksheets("Kassendaten").Cells(lngZeile, 13).Value = 0
            Else
                If Worksheets("Lager").Cells(CDbl(lngID), 15) = "" Then
                    Worksheets("Kassendaten").Cells(lngZeile, 13).Value = Worksheets("Lager").Cells(CDbl(lngID), 14)
                Else
                    Worksheets("Kassendaten").Cells(lngZeile, 13).Value = Worksheets("Lager").Cells(CDbl(lngID), 15)
                End If
            End If
            Worksheets("Kassendaten").Cells(lngZeile, 17).Value = strID 'ID
            Worksheets("Kassendaten").Cells(lngZeile, 14).Value = Worksheets("Lager").Cells(CDbl(lngID), 32)
            Worksheets("Kassendaten").Cells(lngZeile, 20).Value = Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 9) 'LID
            Sheets("Daten").Range("B22") = frmWarenentnahmeschein.txtanzahl.Value
            Sheets("Daten").Range("B23") = CDbl(frmWarenentnahmeschein.txtanzahl.Value) * CDbl(frmWarenentnahmeschein.txtUgruppen.Value)
            Sheets("Daten").Range("B21") = txtBezeichnung.Value
        End If
    Next
    frmKasse.cboart2 = cboArt
    Unload frmWarenentnahmeschein
    frmGruppen.lstGruppen.Clear
    frmGruppen.cbo_Gruppe = ""
    frmGruppen.txtmin = ""
    frmGruppen.Hide
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    frmKasse.SuchenKasseV2
    frmKasse.Show
End Sub

Sub WarenausgangGruppe2() 'v1.44
    Dim lngIndex, lngID, lngZeile As Long
    Dim SINP, strID As String
    Dim Last_Row2, arrTmpA2, arrTmpB2, i2, j2, n2, lng2, lngs2 As Long
    Dim SuchKriterium2 As String
    On Error Resume Next
    If txtRnr.Value = "" Then
        MsgBox "Bitte geben Sie eine Auftragsnummer an!", , "Hinweis"
        txtRnr.SetFocus
    End If
    If frmGruppen.cbo_Gruppe.Value = "" Then Exit Sub
    Application.ScreenUpdating = False
    lngZeile = Worksheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row
    Sheets("Reservierungen").Activate
    For lngIndex = 0 To frmGruppen.lstGruppen.ListCount - 1
        If frmGruppen.lstGruppen.Selected(lngIndex) Then
            lngZeile = lngZeile + 1
            strID = Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 1)
            With ThisWorkbook.Sheets("Lager")
                Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                arrTmpA2 = .Range("A1:AO" & Last_Row2)
                ReDim arrTmpB2(1 To 4, 1 To UBound(arrTmpA2))
                For i2 = 2 To UBound(arrTmpA2)
                    If arrTmpA2(i2, 1) = CStr(strID) Then
                        lngID = i2
                    End If
                Next i2
            End With
            If Worksheets("Lager").Cells(CDbl(lngID), 30) = "Y" Then
                SINP = InputBox("Bitte geben Sie die Seriennummer an!" & vbLf & "Artikel: " + frmGruppen.lstGruppen.Column(2, lngIndex) + vbLf & vbLf & "Tipp: Sie k|fffd|nnen die Serien- Nr. auch scannen", "Seriennummer")
                If Not SINP = "" Then
                    Worksheets("Reservierungen").Cells(lngZeile, 19).Value = SINP
                    Worksheets("Reservierungen").Cells(lngZeile, 6).Value = frmGruppen.lstGruppen.Column(2, lngIndex) & " /SN:" & SINP
                    Worksheets("Reservierungen").Cells(lngZeile, 7).Value = "1"
                Else
                    Application.ScreenUpdating = True
                    Exit Sub
                End If
            Else
                Worksheets("Reservierungen").Cells(lngZeile, 6).Value = frmGruppen.lstGruppen.Column(2, lngIndex) 'Bezeichnung
                Worksheets("Reservierungen").Cells(lngZeile, 7).Value = frmGruppen.lstGruppen.Column(3, lngIndex) * CDbl(txtanzahl.Value)
            End If
            Worksheets("Reservierungen").Cells(lngZeile, 1).Value = "'" & txtRnr.Text
            Worksheets("Reservierungen").Cells(lngZeile, 2).Value = "'" & frmGruppen.lstGruppen.Column(0, lngIndex) 'Artikelnummer
            Worksheets("Reservierungen").Cells(lngZeile, 3).Value = Worksheets("Lager").Cells(CDbl(lngID), 4)
            Worksheets("Reservierungen").Cells(lngZeile, 4).Value = Worksheets("Lager").Cells(CDbl(lngID), 7)
            If Not frmGruppen.lstGruppen.Column(7, lngIndex) = "" Then
                Worksheets("Reservierungen").Cells(lngZeile, 8).Value = Worksheets("Lager").Cells(CDbl(lngID), 15) * CDbl(frmGruppen.lstGruppen.Column(3, lngIndex)) * CDbl(txtanzahl)
            End If
            Worksheets("Reservierungen").Cells(lngZeile, 10).Value = lngID
            If cboArt = "Auftrag NEU" Or cboArt = "Auftrag ausw|fffd|hlen" Then
                Worksheets("Reservierungen").Cells(lngZeile, 11).Value = "Auftrag"
            ElseIf cboArt = "Angebot NEU" Or cboArt = "Angebot ausw|fffd|hlen" Then
                Worksheets("Reservierungen").Cells(lngZeile, 11).Value = "Angebot"
            End If
            Worksheets("Reservierungen").Cells(lngZeile, 12).Value = Worksheets("Lager").Cells(CDbl(lngID), 21)
            If Worksheets("Lager").Cells(CDbl(lngID), 15) = "" And Worksheets("Lager").Cells(CDbl(lngID), 14) = "" Then
                Worksheets("Reservierungen").Cells(lngZeile, 13).Value = 0
            Else
                If Worksheets("Lager").Cells(CDbl(lngID), 15) = "" Then
                    Worksheets("Reservierungen").Cells(lngZeile, 13).Value = Worksheets("Lager").Cells(CDbl(lngID), 14)
                Else
                    Worksheets("Reservierungen").Cells(lngZeile, 13).Value = Worksheets("Lager").Cells(CDbl(lngID), 15)
                End If
            End If
            Worksheets("Reservierungen").Cells(lngZeile, 14).Value = Worksheets("Lager").Cells(CDbl(lngID), 32)
            Worksheets("Reservierungen").Cells(lngZeile, 18).Value = strID 'ID
            Worksheets("Reservierungen").Cells(lngZeile, 19).Value = txt_KDID.Value
            Worksheets("Reservierungen").Cells(lngZeile, 21).Value = Format(Date, "DD.MM.YYYY")
            If Sheets("Daten").Range("B5").Value = "True" Then
                Worksheets("Reservierungen").Cells(lngZeile, 22).Value = Sheets("Daten").Range("B24").Value
            End If
            Worksheets("Reservierungen").Cells(lngZeile, 23).Value = Worksheets("Gruppen").Cells(CDbl(frmGruppen.lstGruppen.Column(8, lngIndex)), 9) 'LID
        End If
    Next
    Application.ScreenUpdating = True
    If cboArt = "Auftrag NEU" Or cboArt.Value = "Auftrag ausw|fffd|hlen" Then
        frmKasse.RAuftraege
        frmKasse.cboAuftragSuchen = txtRnr.Text
    ElseIf cboArt = "Angebot NEU" Or cboArt.Value = "Angebot ausw|fffd|hlen" Then
        frmKasse.RAngebote
        frmKasse.cbo_Angebot = txtRnr.Text
    End If
    Unload frmWarenentnahmeschein
    frmKasse.Show
    frmGruppen.lstGruppen.Clear
    frmGruppen.cbo_Gruppe = ""
    frmGruppen.txtmin = ""
    Unload frmGruppen
    Sheets("Center").Activate
End Sub

Sub RAuftraege()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Reservierungen").Cells(lngZ, 11).Value = "Auftrag" Then
            objDic(Sheets("Reservierungen").Cells(lngZ, 1).Value) = 0
        End If
    Next
    cboauftraege.List = objDic.keys
    Set objDic = Nothing
    If cboauftraege.ListCount = 0 Then
        MsgBox "Keine Auftr|fffd|ge vorhanden!", , "Hinweis"
    End If
End Sub

Sub RAngebote()
    Dim objDic As Object
    Dim lngZ As Long
    On Error Resume Next
    Set objDic = CreateObject("Scripting.Dictionary")
    For lngZ = 2 To Sheets("Reservierungen").Cells(Rows.Count, 1).End(xlUp).Row
        If Sheets("Reservierungen").Cells(lngZ, 11).Value = "Angebot" Then
            objDic(Sheets("Reservierungen").Cells(lngZ, 1).Value) = 0
        End If
    Next
    cboauftraege.List = objDic.keys
    Set objDic = Nothing
    If cboauftraege.ListCount = 0 Then
        MsgBox "Keine Angebote vorhanden!", , "Hinweis"
    End If
End Sub

Sub Umwandeln() 'v1.44
    Dim lngID, lngLine, IDU, lngIndex, zlng As Long
    Dim strArticle As String
    Dim objLines, objItems As Collection
    Set objLines = New Collection
    Set objItems = New Collection
    Dim arrTmpA, arrTmpB, i As Long
    Dim Last_Row As Long
    Dim arrTmpA2, arrTmpB2, i2 As Long
    Dim Last_Row2 As Long
    On Error Resume Next
    zlng = 0
    Application.ScreenUpdating = False
    With ThisWorkbook.Worksheets("Lager")
        For lngID = 0 To frmGruppen.lstGruppen.ListCount - 1
            If frmGruppen.lstGruppen.Selected(lngID) Then
                strArticle = frmGruppen.lstGruppen.List(lngID, 1)
                lngLine = 0
                If Worksheets("Gruppen").Cells(CLng(frmGruppen.lstGruppen.List(lngID, 8)), 9) = "" Then
                    With ThisWorkbook.Sheets("Lager")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:AO" & Last_Row2)
                        ReDim arrTmpB2(1 To 10, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 1) = CStr(strArticle) Then
                                lngLine = i2
                            End If
                        Next i2
                    End With
                    If lngLine > 0 Then
                        .Cells(lngLine, 8).Value = .Cells(lngLine, 8).Value - _
                                                 CDbl(frmGruppen.lstGruppen.Column(3, lngID) * txtanzahl.Value)
                      objLines.Add frmGruppen.lstGruppen.List(lngID, 1)
                      objItems.Add CStr(lngID)
                    End If
                Else
                    With ThisWorkbook.Sheets("Lagerorte")
                        Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                        arrTmpA2 = .Range("A1:E" & Last_Row2)
                        ReDim arrTmpB2(1 To 10, 1 To UBound(arrTmpA2))
                        For i2 = 2 To UBound(arrTmpA2)
                            If arrTmpA2(i2, 1) = CStr(Worksheets("Gruppen").Cells(CLng(frmGruppen.lstGruppen.List(lngID, 8)), 9)) Then
                                lngLine = i2
                            End If
                        Next i2
                    End With
                    If lngLine > 0 Then
                        ThisWorkbook.Sheets("Lagerorte").Cells(lngLine, 4).Value = ThisWorkbook.Sheets("Lagerorte").Cells(lngLine, 4).Value - _
                                                 CDbl(frmGruppen.lstGruppen.Column(3, lngID) * txtanzahl.Value)
                      objLines.Add frmGruppen.lstGruppen.List(lngID, 1)
                      objItems.Add CStr(lngID)
                    End If
                End If
            End If
        Next
    End With
    With ThisWorkbook.Sheets("Lager")
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        ReDim arrTmpB(1 To 10, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA2)
            If arrTmpA(i, 1) = CStr(txt_GAID) Then
                IDU = i
            End If
        Next i
    End With
    Worksheets("Lager").Cells(IDU, 8) = Worksheets("Lager").Cells(IDU, 8) + CDbl(txtanzahl)
    Call UmWA
    Application.ScreenUpdating = True
    If frmGruppen.cbo_Gruppe.Value = "" Then Exit Sub
    frmGruppen.Gruppen
    frmGruppen.AuswahlSum
    Unload frmWarenentnahmeschein
    Set objLines = Nothing
    Set objItems = Nothing
    Application.ScreenUpdating = True
    Sheets("Center").Activate
End Sub

Sub UmWA() '1.44
    Dim lngIndex, lngID As Long
    Dim bstrg As String
    Dim arrTmpA2, arrTmpB2, i2 As Long, n2, lng2, lngs2 As Long
    Dim Last_Row2 As Long
    On Error Resume Next
    
    Application.ScreenUpdating = False
    bstrg = "UA" & Format(Date, "YYMMDD") & Format(Time, "hhmmss")
    Sheets("Warenausgang").Activate
    With ThisWorkbook.Worksheets("Warenausgang")
        For lngIndex = 0 To frmGruppen.lstGruppen.ListCount - 1
            If frmGruppen.lstGruppen.Selected(lngIndex) Then
                Range("A500000").End(xlUp).Offset(1, 0).Select
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 10, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If arrTmpA2(i2, 1) = CStr(frmGruppen.lstGruppen.List(lngIndex, 1)) Then
                            lngID = i2
                        End If
                    Next i2
                End With
                ActiveCell.Offset(0, 0) = "Intern" 'Art
                ActiveCell.Offset(0, 1) = bstrg 'Beleg
                ActiveCell.Offset(0, 2) = "'" & frmGruppen.lstGruppen.Column(0, lngIndex)
                ActiveCell.Offset(0, 3) = frmGruppen.lstGruppen.Column(2, lngIndex) 'Bezeichnung
                ActiveCell.Offset(0, 4) = frmGruppen.lstGruppen.Column(3, lngIndex) * CDbl(txtanzahl.Value) 'Menge
                ActiveCell.Offset(0, 5) = Sheets("Lager").Cells(CDbl(lngID), 21) * 100 & "%" 'MwSt
                ActiveCell.Offset(0, 6) = CDbl(frmGruppen.lstGruppen.Column(7, lngIndex)) * CDbl(frmGruppen.lstGruppen.Column(3, lngIndex))
                ActiveCell.Offset(0, 7) = Format(Date, "DD.MM.YYYY") 'Datum
                ActiveCell.Offset(0, 8) = Format(Time, "hh:mm:ss")
                ActiveCell.Offset(0, 10) = Format(Date, "mmmm")
                ActiveCell.Offset(0, 11) = Format(Date, "yyyy")
                ActiveCell.Offset(0, 12) = Sheets("Lager").Cells(CDbl(lngID), 15) 'NVK
                ActiveCell.Offset(0, 13) = frmGruppen.lstGruppen.Column(1, lngIndex) 'ID
                ActiveCell.Offset(0, 14) = txtBezeichnung & " > " & txtRnr.Value 'Zweck
                ActiveCell.Offset(0, 15) = "-"
                ActiveCell.Offset(0, 16) = "-"
                If Sheets("Daten").Range("B5").Value = "True" Then
                    ActiveCell.Offset(0, 17).Value = Sheets("Daten").Range("B24").Value
                End If
            End If
        Next
    End With
    Sheets("Center").Activate
    Application.ScreenUpdating = True
    ActiveWorkbook.Save
    MsgBox "Die Gruppe " + frmGruppen.cbo_Gruppe + " wurde in den Artikel " + txtRnr + " umgewandelt!" & vbLf & "Belegnummer ist: " & bstrg, , "Hinweis"
End Sub
Attribute VB_Name = "frmWillkommen"
Attribute VB_Base = "0{5316AF08-A704-4CB2-B141-42C56AE5F7E1}{27BBABCB-E52D-455D-8D38-4AFBFCE4FCD0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub Check_Ein_Click()
    If Check_Ein.Value = True Then
        chkausblenden.Enabled = True
        lbl_HinweisStart.Enabled = True
    Else
        chkausblenden.Enabled = False
        lbl_HinweisStart.Enabled = False
    End If
End Sub

Private Sub cmdweiter_Click()
    Dim stxt As String
    On Error Resume Next
    
    If VBA.Environ("Username") = "Marcel K" Then
        Call Anmelden
        Exit Sub
    End If
    If ThisWorkbook.Sheets("Daten").Range("B39") = "" And ThisWorkbook.Sheets("Daten").Range("B40") = "" Then
        ThisWorkbook.Sheets("Daten").Range("B40") = Format(DateAdd("d", 30, Now()), "dd.mm.yyyy")
        Call Anmelden
        Exit Sub
    End If
    If ThisWorkbook.Sheets("Daten").Range("B39") = "" And Not ThisWorkbook.Sheets("Daten").Range("B40") = "" Then
        If CDbl(DateDiff("D", Date, CDate(Sheets("Daten").Range("B40")))) <= 0 Then
            GoTo weiter
        Else
            If Check_Ein.Value = True Then
                GoTo weiter
            Else
                Call Anmelden
                Exit Sub
            End If
        End If
    End If
weiter:
    If Not ThisWorkbook.Sheets("Daten").Range("B39") = "" Then
        ThisWorkbook.Sheets("Daten").Range("B40") = ""
        lbl_EinDatum.Caption = ThisWorkbook.Sheets("Daten").Range("B39")
        Check_Ein.Value = True
        Check_Ein.Enabled = False
        If chkausblenden.Value = True And Check_Ein.Value = True Then
            ThisWorkbook.Sheets("Daten").Range("B4").Value = ""
        End If
        Call Anmelden
        Exit Sub
    End If
    If Check_Ein.Value = False Then
        stxt = MsgBox("Bitte Best|fffd|ttigen Sie! (Einverstanden)" & vbLf & vbLf & "M|fffd|chten Sie Abrechen/ Beenden?", vbYesNo, "Hinweis")
        If stxt = vbNo Then
            Exit Sub
        Else
            Application.DisplayAlerts = False
            Application.EnableEvents = False
            ActiveWorkbook.Save
            Application.Quit
        End If
    Else
        If ThisWorkbook.Sheets("Daten").Range("B39") = "" Then
            ThisWorkbook.Sheets("Daten").Range("B39") = Format(Date, "DD.MM.YYYY")
            ThisWorkbook.Sheets("Daten").Range("B40") = ""
            Application.ScreenUpdating = False
            Sheets("Daten").Activate
            Range("A65536").End(xlUp).Offset(1, 0).Select
            ActiveCell.Offset(0, 0).Value = Date
            ActiveCell.Offset(0, 1).Value = "Bedingung akzeptiert!"
            ActiveCell.Offset(0, 2).Value = Format(Now, "HH:MM:SS")
            Sheets("Center").Activate
            Application.ScreenUpdating = True
        End If
    End If
    If chkausblenden.Value = True And Check_Ein.Value = True Then
        ThisWorkbook.Sheets("Daten").Range("B4").Value = ""
    Else
        If Check_Ein.Value = False And chkausblenden.Value = True Then
            MsgBox "Bitte Best|fffd|ttigen Sie! (Einverstanden)", , "Hinweis"
        End If
    End If
    Call Anmelden
End Sub

Private Sub Label13_Click()
    Open_URL ("http://blickwinkel178.blogspot.de/2014/09/changelog-excel-lagerverwaltung.html")
End Sub

Private Sub lbl_check_Click()
    Unload frmWillkommen
End Sub

Private Sub lbHomepage_Click()
    Open_URL ("http://blickwinkel178.blogspot.de")
End Sub

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    ThisWorkbook.Activate
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    If Application.Version Like "18*" Then
        lbl_Version.Caption = "Office 365" & " (" & Application.Version & ")"
    ElseIf Application.Version Like "16*" Then
        lbl_Version.Caption = "Office 2016 or 2019" & " (" & Application.Version & ")"
    ElseIf Application.Version Like "15*" Then
        lbl_Version.Caption = "Office 2013" & " (" & Application.Version & ")"
    ElseIf Application.Version Like "14*" Then
        lbl_Version.Caption = "Office 2010" & " (" & Application.Version & ")"
    Else
        lbl_Version.Caption = "Wird leider nicht unterst|fffd|tzt!" & " (" & Application.Version & ")"
        lbl_Version.ForeColor = &HFF&
    End If
    lbl_VNr.Caption = "Versionsnummer: " & CStr(Sheets("Daten").Range("B45"))
    If Check_Ein.Value = True Then
        chkausblenden.Enabled = True
        lbl_HinweisStart.Enabled = True
    Else
        chkausblenden.Enabled = False
        lbl_HinweisStart.Enabled = False
    End If
    If Not ThisWorkbook.Sheets("Daten").Range("B39") = "" Then
        Check_Ein.Value = True
        Check_Ein.Enabled = False
        lbl_EinDatum.Caption = "(" & ThisWorkbook.Sheets("Daten").Range("B39") & ")"
        Exit Sub
    End If
    If Not ThisWorkbook.Sheets("Daten").Range("B40") = "" Then
        If CDbl(DateDiff("D", Date, CDate(Sheets("Daten").Range("B40")))) <= 0 Then
            lbl_EinDatum.Caption = "Bitte best|fffd|ttigen!"
        Else
            lbl_EinDatum.Caption = "(Es verbleiben: " & DateDiff("D", Date, CDate(Sheets("Daten").Range("B40"))) & " Tage!)"
        End If
    End If
End Sub

Sub Anmelden()
    If Sheets("Daten").Range("B5").Value = "True" Then
        Unload frmWillkommen
        frmAnmelden.Show
    Else
        Unload frmWillkommen
    End If
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If CloseMode = vbFormControlMenu Then
        MsgBox "Bitte mit dem Button ""Weiter"" schlie|fffd|en!", , "Hinweis"
        cmdweiter.SetFocus
        Cancel = True
    End If
End Sub
Attribute VB_Name = "frmkostenstelle"
Attribute VB_Base = "0{87357793-2DD7-4276-A94D-C30A73A75D29}{195D744E-54A2-460D-A9A6-843B7415CE7A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
    frmkostenstelle.lbl_Day.Caption = Format(Date, "dd")
    frmkostenstelle.lbl_dayfull.Caption = Format(Date, "dddd")
    frmkostenstelle.lbl_month.Caption = "." & Format(Date, "mm")
    frmkostenstelle.lbl_year.Caption = "." & Format(Date, "yyyy")
    Call SuchenKosten
End Sub

Sub SuchenKosten()
    Dim lngZeile, i As Long
    On Error Resume Next
    
    lstKosten.Clear
    lstKosten.ColumnCount = 2
    lstKosten.ColumnWidths = "50;80;150;0"
    i = 0
    For lngZeile = 2 To ThisWorkbook.Worksheets("Kostenstellen").UsedRange.Rows.Count
            lstKosten.AddItem Sheets("Kostenstellen").Cells(lngZeile, 1).Value
            lstKosten.Column(1, i) = Sheets("Kostenstellen").Cells(lngZeile, 2).Value
            lstKosten.Column(2, i) = Sheets("Kostenstellen").Cells(lngZeile, 1).Row
            i = i + 1
    Next lngZeile
End Sub

Private Sub cmd_DelKosten_Click()
    Dim lng As Long
    Dim strID As String
    On Error Resume Next
    
    strID = lstKosten.Column(1)
    lng = lstKosten.Column(2)
    Sheets("Kostenstellen").Rows(lng).Delete
    Call SuchenKosten
    MsgBox strID & " wurde entfernt!", , "Hinweis"
End Sub

Private Sub cmd_Kostenhinzu_Click()
    Dim lngZeile As Long
    Application.ScreenUpdating = False
        Sheets("Kostenstellen").Activate
        lngZeile = Worksheets("Kostenstellen").Cells(Rows.Count, 1).End(xlUp).Row + 1
        Worksheets("Kostenstellen").Cells(lngZeile, 1).Value = txt_KostenNr.Value
        Worksheets("Kostenstellen").Cells(lngZeile, 1).Value = txt_KostenBez.Value
        txt_KostenNr.Value = ""
        txt_KostenBez.Value = ""
        txt_KostenNr.SetFocus
        Call SuchenKosten
        Sheets("Center").Activate
    Application.ScreenUpdating = True
    MsgBox "Kostenstelle hinzugef|fffd|gt!", , "Hinweis"
End Sub

Private Sub cmdchanel_Click()
    Unload frmkostenstelle
End Sub

Private Sub ComKExit_Click()
    Unload frmkostenstelle
End Sub
Attribute VB_Name = "frmorderinfo"
Attribute VB_Base = "0{4EF94FCF-3B8C-45D2-842B-2C28A85A4FD3}{826800CE-8E5A-4ADB-9C42-29153BCCDEC0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub UserForm_Initialize()
    Dim sngTop, sngLeft As Single
    On Error Resume Next
    
    StartUpPosition = 0
    sngLeft = Application.Left + Application.Width / 2 - Width / 2
    sngTop = Application.Top + Application.Height / 2 - Height / 2
    Left = sngLeft
    Top = sngTop
End Sub
Private Sub cmdexit_Click()
    Unload frmorderinfo
End Sub

Sub SuchenBestellung() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n As Long
    Dim SuchKriterium As String
    On Error Resume Next
    Application.ScreenUpdating = False
    SuchKriterium = CStr(frmLager.txtID)
    frmorderinfo.lstBestellinfo.Clear
    With ThisWorkbook.Sheets("Bestellung")
       Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
       arrTmpA = .Range("A1:AO" & Last_Row)
       ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
       For i = 2 To UBound(arrTmpA)
           If arrTmpA(i, 12) = SuchKriterium Then
               n = n + 1
               arrTmpB(1, n) = arrTmpA(i, 1)
               arrTmpB(2, n) = arrTmpA(i, 8)
               arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ")
               arrTmpB(4, n) = arrTmpA(i, 5)
               arrTmpB(5, n) = arrTmpA(i, 6)
               arrTmpB(6, n) = arrTmpA(i, 11)
               arrTmpB(7, n) = i
           End If
       Next i
       If n > 0 Then
            Erase arrTmpA
            ReDim arrTmpA(1 To n, 1 To 7)
            For i = 1 To 7
               For j = 1 To n
                   arrTmpA(j, i) = arrTmpB(i, j)
               Next
            Next
            With frmorderinfo.lstBestellinfo
               .ColumnCount = 6
               .ColumnWidths = "100;60;130;180;50;50"
               .List = arrTmpA
            End With
       End If
    End With
    Application.ScreenUpdating = True
End Sub

Sub SuchenBestellung2() '1.44
    Dim Last_Row, arrTmpA, arrTmpB, i, j, n, zList As Long
    Dim SuchKriterium As String
    Dim BoxListe As String
    Dim Last_Row2, lngZ, arrTmpA2, arrTmpB2, i2, j2, n2, lng2, lngs2 As Long
    Dim SuchKriterium2 As String
    On Error Resume Next
    Application.ScreenUpdating = False
    BoxListe = "Bestellung"
    frmorderinfo.lstBestellinfo.Clear
    With ThisWorkbook.Sheets(BoxListe)
        Last_Row = .Cells(Rows.Count, 1).End(xlUp).Row
        arrTmpA = .Range("A1:AO" & Last_Row)
        zList = frmGruppen.lstGruppen.ListCount - 1
        ReDim arrTmpB(1 To 7, 1 To UBound(arrTmpA))
        For i = 2 To UBound(arrTmpA)
            zList = zList - 1
            SuchKriterium = LCase(CStr(frmGruppen.lstGruppen.Column(1, zList)))
            If Not LCase(arrTmpA(i, 12)) Like SuchKriterium Then
                n = n + 1
                With ThisWorkbook.Sheets("Lager")
                    Last_Row2 = .Cells(Rows.Count, 1).End(xlUp).Row
                    arrTmpA2 = .Range("A1:AO" & Last_Row2)
                    ReDim arrTmpB2(1 To 7, 1 To UBound(arrTmpA2))
                    For i2 = 2 To UBound(arrTmpA2)
                        If arrTmpA2(i2, 1) = CStr(Worksheets("Bestellung").Cells(i, 12)) Then
                            lngZ = i2
                        End If
                    Next i2
                End With
                arrTmpB(1, n) = arrTmpA(i, 1)
                arrTmpB(2, n) = arrTmpA(i, 8)
                arrTmpB(3, n) = VBA.Replace(CStr(arrTmpA(i, 2)), Chr$(13) & Chr$(10), " ")
                arrTmpB(4, n) = arrTmpA(i, 5)
                arrTmpB(5, n) = arrTmpA(i, 6) & " " & Worksheets("Lager").Cells(lngZ, 12)
                arrTmpB(6, n) = arrTmpA(i, 11)
                arrTmpB(7, n) = i
            End If
        Next i
        If n > 0 Then
             Erase arrTmpA
             ReDim arrTmpA(1 To n, 1 To 7)
             For i = 1 To 7
                For j = 1 To n
                    arrTmpA(j, i) = arrTmpB(i, j)
                Next
             Next
             With frmorderinfo.lstBestellinfo
                .ColumnCount = 6
                .ColumnWidths = "100;60;130;180;50;50"
                .List = arrTmpA
             End With
        Else
            frmorderinfo.lblArtikelinfo.Caption = "Artikelgruppe: " + frmGruppen.cbo_Gruppe.Value + " (Keine Bestellung/en vorhanden!)"
        End If
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub lstBestellinfo_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    On Error Resume Next
    frmEingang.cboeingang = frmorderinfo.lstBestellinfo.Column(0)
    Unload frmorderinfo
    Unload frmGruppen
    frmEingang.Show
End Sub


' InQuest injected base64 decoded content
' !zp.~
' z{gj

INQUEST-PP=macro
