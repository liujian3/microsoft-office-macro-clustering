Attribute VB_Name = "Module1"
Public Prekid As Boolean

Private Sub IzradiBackup()
    
    Dim Ws As Worksheet
    Dim TroskoviBackupWsh As Worksheet
    Dim PokazateljiBackupWsh As Worksheet
    Dim TroskoviBackupBool As Boolean
    Dim PokazateljiBackupBool As Boolean
    
    TroskoviBackupBool = False
    PokazateljiBackupBool = False
    
    For Each Ws In ThisWorkbook.Worksheets
        If TroskoviBackupBool = False Then
            If Ws.Name = "Tro|fffd|koviBackup" Then
                TroskoviBackupBool = True
                Set TroskoviBackupWsh = Ws
            End If
        End If
        If PokazateljiBackupBool = False Then
            If Ws.Name = "PokazateljiBackup" Then
                PokazateljiBackupBool = True
                Set PokazateljiBackupWsh = Ws
            End If
        End If
    Next
    
    ThisWorkbook.Unprotect "odatorticaaaa983"
    
    If TroskoviBackupBool = False Then
        Set TroskoviBackupWsh = ThisWorkbook.Worksheets.Add
        TroskoviBackupWsh.Name = "Tro|fffd|koviBackup"
    End If
    
    If PokazateljiBackupBool = False Then
        Set PokazateljiBackupWsh = ThisWorkbook.Worksheets.Add
        PokazateljiBackupWsh.Name = "PokazateljiBackup"
    End If
    
    ThisWorkbook.Sheets("Tro|fffd|kovi").Cells.Copy Destination:=TroskoviBackupWsh.Cells
    ThisWorkbook.Sheets("Pokazatelji").Cells.Copy Destination:=PokazateljiBackupWsh.Cells
    With ThisWorkbook.Sheets("Tro|fffd|kovi")
        If .ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" And .ZakljucajOtkljucaj.Visible = True Then
            TroskoviBackupWsh.Range("E1").Value = "Zaklju|fffd|aj"
        ElseIf .ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" And .ZakljucajOtkljucaj.Visible = False Then
            TroskoviBackupWsh.Range("E1").Value = "Otklju|fffd|aj"
        End If
    End With
    TroskoviBackupWsh.Visible = xlSheetVeryHidden
    PokazateljiBackupWsh.Visible = xlSheetVeryHidden
    ThisWorkbook.Protect "odatorticaaaa983"
    
    Set Ws = Nothing
    Set TroskoviBackupWsh = Nothing
    Set PokazateljiBackupWsh = Nothing
    
End Sub

Private Sub VratiBackup()
    
    Const Element_projekta_Col As Integer = 3
    Const Jedinicna_cijena_Col As Integer = 14
    Const Popratni_dokumenti_nastanka_Col As Integer = 16
    Const Klarifikacija_korisnika_Col As Integer = 18
    Const MinRw As Long = 12
    Const MaxRw As Long = 2000
    
    Dim Ws As Worksheet
    Dim TroskoviBackupWsh As Worksheet
    Dim PokazateljiBackupWsh As Worksheet
    Dim MyRng As Range
    Dim TroskoviBackupBool As Boolean
    Dim PokazateljiBackupBool As Boolean
    
    On Error GoTo Kraj
    
    TroskoviBackupBool = False
    PokazateljiBackupBool = False
    
    For Each Ws In ThisWorkbook.Worksheets
        If Ws.Name = "Tro|fffd|koviBackup" Then
            TroskoviBackupBool = True
            Set TroskoviBackupWsh = Ws
        End If
        If Ws.Name = "PokazateljiBackup" Then
            PokazateljiBackupBool = True
            Set PokazateljiBackupWsh = Ws
        End If
    Next
    
    If TroskoviBackupBool = True Then
        With ThisWorkbook.Sheets("Tro|fffd|kovi")
            .Unprotect Password:="odatorticaaaa983"
            Application.EnableEvents = False
            Set MyRng = TroskoviBackupWsh.Range(TroskoviBackupWsh.Cells(MinRw, Element_projekta_Col), _
                TroskoviBackupWsh.Cells(MaxRw, Jedinicna_cijena_Col))
            .Range(.Cells(MinRw, Element_projekta_Col), .Cells(MaxRw, Jedinicna_cijena_Col)).Value = MyRng.Value
            Set MyRng = TroskoviBackupWsh.Range(TroskoviBackupWsh.Cells(MinRw, Popratni_dokumenti_nastanka_Col), _
                TroskoviBackupWsh.Cells(MaxRw, Klarifikacija_korisnika_Col))
            .Range(.Cells(MinRw, Popratni_dokumenti_nastanka_Col), .Cells(MaxRw, Klarifikacija_korisnika_Col)).Value = MyRng.Value
            Set MyRng = TroskoviBackupWsh.Range("D1:D3")
            .Range("D1:D3").Value = MyRng.Value
            Application.EnableEvents = True
            If TroskoviBackupWsh.Range("E1").Value = "Zaklju|fffd|aj" Then
                .ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj"
                .ZakljucajOtkljucaj.Visible = True
                .ZakljucajOdobrenje.Visible = True
            ElseIf TroskoviBackupWsh.Range("E1").Value = "Otklju|fffd|aj" Then
                .ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj"
                .ZakljucajOtkljucaj.Visible = False
                .ZakljucajOdobrenje.Visible = False
            End If
        End With
    End If
        
    If PokazateljiBackupBool = True Then
        ThisWorkbook.Sheets("Pokazatelji").Unprotect Password:="odatorticaaaa983"
        PokazateljiBackupWsh.Cells.Copy Destination:=ThisWorkbook.Sheets("Pokazatelji").Cells
    End If
    
Kraj:
    Application.EnableEvents = True
    Err.Clear
    On Error GoTo 0
    
    With ThisWorkbook.Sheets("Tro|fffd|kovi")
        If .ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
            .Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowFiltering:=True
        Else
            .Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
        End If
    End With
    ThisWorkbook.Sheets("Pokazatelji").Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
        Scenarios:=True, AllowFiltering:=True
    
    Set Ws = Nothing
    Set TroskoviBackupWsh = Nothing
    Set PokazateljiBackupWsh = Nothing
    Set MyRng = Nothing
    
End Sub

Private Sub SakrijRadneListove()
    
    Dim Ws As Worksheet
    Dim MsgStr As String
    Dim MsgInt As Integer
    Dim PocetakBool As Boolean
    
    PocetakBool = False
    Prekid = False
    
    If ThisWorkbook.Saved = False Then
        
        MsgStr = "Want to save your changes to '" & ThisWorkbook.Name & "'?"
        
        MsgInt = MsgBox(prompt:=MsgStr, Buttons:=vbYesNoCancel + vbExclamation, Title:="Microsoft Excel")
        
        If MsgInt = vbYes Then
            ThisWorkbook.Save
        ElseIf MsgInt = vbCancel Then
            Prekid = True
            Set Ws = Nothing
            Exit Sub
        End If
        
    End If
    
    If ThisWorkbook.Saved = False Then
        Call VratiBackup
    End If
    
    ThisWorkbook.Unprotect "odatorticaaaa983"
    
    ThisWorkbook.Sheets("List").Range("A10").Copy
    ThisWorkbook.Sheets("List").Range("A10").PasteSpecial Paste:=xlPasteValues
    Application.CutCopyMode = False
    
    For Each Ws In ThisWorkbook.Worksheets
        If Ws.Name = "Po|fffd|etak" Then
            PocetakBool = True
            Ws.Visible = xlSheetVisible
            Ws.Protect Password:="odatorticaaaa983"
            Ws.EnableSelection = xlNoSelection
            Exit For
        End If
    Next
    
    On Error Resume Next
    If PocetakBool = True Then
        ThisWorkbook.Sheets("Legenda i upute").Visible = xlSheetVeryHidden
        ThisWorkbook.Sheets("Tro|fffd|kovi").Visible = xlSheetVeryHidden
        ThisWorkbook.Sheets("Pokazatelji").Visible = xlSheetVeryHidden
        ThisWorkbook.Sheets("List").Visible = xlSheetVeryHidden
    End If
    Err.Clear
    On Error GoTo 0
    
    ThisWorkbook.Protect "odatorticaaaa983"
    ThisWorkbook.Save
    
    Set Ws = Nothing
    
End Sub

Private Sub PrikaziRadneListove()
    
    Dim Ws As Worksheet
    
    ThisWorkbook.Unprotect "odatorticaaaa983"
    
    On Error Resume Next
    ThisWorkbook.Sheets("Legenda i upute").Visible = xlSheetVisible
    ThisWorkbook.Sheets("Tro|fffd|kovi").Visible = xlSheetVisible
    ThisWorkbook.Sheets("Pokazatelji").Visible = xlSheetVisible
    If ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" And _
        ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Visible = True Then
        ThisWorkbook.Sheets("List").Visible = xlSheetVisible
    End If
    On Error GoTo 0
    
    For Each Ws In ThisWorkbook.Worksheets
        If Ws.Name = "Po|fffd|etak" Then
            Ws.Visible = xlSheetVeryHidden
            Exit For
        End If
    Next
    
    ThisWorkbook.Protect "odatorticaaaa983"
    
    Set Ws = Nothing
    
End Sub
Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet81"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "ZakljucajOtkljucaj, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "ZakljucajOdobrenje, 2, 1, MSForms, CommandButton"
Option Explicit

Private Sub Worksheet_Change(ByVal Target As Range)
    ' pazi kod promjena konstanta ili varijabli jer kod postavljanja uvjetnog oblikovanja ne koristim konstante niti varijable
    ' u tom slu|fffd|aju pretra|fffd|uj "FormatConditions" i ru|fffd|no mijenjaj
    ' pazi - kod kori|fffd|tenja vrijednosti iz radnog lista "List" ne koristim konstante niti varijable
    ' u slu|fffd|aju promjena adresa u radnom listu "List" pretra|fffd|uj "List" i ru|fffd|no mijenjaj
    ' pazi - kod provjere indirektnih tro|fffd|kova ru|fffd|no upisujem formule
    ' promjena 12.04.2017. - izmijenjene adrese u formulama kod provjere indirektnih tro|fffd|kova te adrese kod uvjetnog oblikovanja ("FormatConditions") jer je smanjen broj redaka s 10000 na 2000
    
    Const Opis_troska_Col As Integer = 8
    Const Broj_jedinica_Col As Integer = 13
    Const Jedinicna_cijena_Col As Integer = 14
    Const PT2_prilagodjen_broj_jedinica_Col As Integer = 21
    Const PT2_prilagodjena_jedinicna_cijena_Col As Integer = 22
    Const Prazna1_Col As Integer = 25
    Const Prazna2_Col As Integer = 26
    Const Broj_troska_Col As Integer = 2
    Const Element_projekta_Col As Integer = 3
    Const Klarifikacija_korisnika_Col As Integer = 18
    Const Komentar_PT2_Col As Integer = 19
    Const Provjera1_Col As Integer = 27
    Const Provjera2_Col As Integer = 28
    Const Oznaka_troska_Col As Integer = 10
    Const PT2_prilagodjena_oznaka_Col As Integer = 20
    Const Ukupni_iznos_Col As Integer = 15
    Const PT2_prilagodjen_iznos_Col As Integer = 23
    Const Naziv_dobavljaca_Col As Integer = 5
    Const OIB_dobavljaca_Col As Integer = 6
    Const Vrsta_troska_Col As Integer = 7
    Const Nastanak_troska_Col As Integer = 9
    Const Popratni_dokumenti_nastanka_Col As Integer = 16
    Const Popratni_dokumenti_placanja_Col As Integer = 17
    ' promjena 17.04.2017.
    Const Mjesec = 11
    Const Godina = 12
    ' kraj promjene 17.04.2017.
    Const MinRw As Long = 12
    ' promjena 12.04.2017. - smanjen broj redaka s 10000 na 2000 zbog smanjenja veli|fffd|ine i ubrzavanja tablice
    Const MaxRw As Long = 2000
    ' kraj promjene 12.04.2017.
    Dim i As Long
    Dim rw As Long
    Dim BrojFormula As Long
    Dim MyVar As Variant
    Dim MyStr As String
    Dim Naslov As String
    Dim Adresa1 As String
    Dim Adresa2 As String
    Dim MyRng As Range
    
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    
    On Error GoTo ErrHandler
    
    Sheet81.Unprotect "odatorticaaaa983"
    
    
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        ' uklonjene formule za provjeru u koloni Prazna1_Col jer kriterij za provjeru (naziv stavke je "1.1 Tro|fffd|kovi zaposlenih") nije ograni|fffd|en samo na pla|fffd|e
        ' zadnja verzija koja je imala uklju|fffd|ene te kolone je: "Tehni|fffd|ka pomo|fffd| - proba 1 - Backup - 16-06-15 - 4.xlsm"
        ' ostavljam dio makronaredbe koji radi tu provjeru jer nema nikakvog u|fffd|inka i ne tro|fffd|i puno vremena
        ' ako na|fffd|emo odgovaraju|fffd|i kriterij mo|fffd|emo ga ponovno staviti u funkciju
        Err.Clear
        On Error Resume Next
        With Sheet81
            Set MyRng = Nothing
            Set MyRng = .Range(.Cells(MinRw - 1, Prazna1_Col), .Cells(MaxRw, Prazna1_Col)).Find("GRE|fffd|KA", LookIn:=xlValues)
        End With
        If MyRng Is Nothing Or Err.Number <> 0 Then
            Err.Clear
        Else
            rw = MyRng.Row
            Application.Undo
            Application.ScreenUpdating = True
            Sheet81.Cells(rw, Broj_jedinica_Col).Select
            Naslov = "|fffd|elija " & Sheet81.Cells(rw, Broj_jedinica_Col).Address(rowabsolute:=False, columnabsolute:=False)
            MsgBox prompt:="Broj jedinica za pla|fffd|e mora biti izme|fffd|u 0 i 1!", Title:=Naslov, Buttons:=vbCritical
            Err.Clear
            GoTo ErrHandler
        End If
        On Error GoTo ErrHandler
    End If
    
    
    If ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" Then
        ' uklonjene formule za provjeru u koloni Prazna1_Col jer kriterij za provjeru (naziv stavke je "1.1 Tro|fffd|kovi zaposlenih") nije ograni|fffd|en samo na pla|fffd|e
        ' zadnja verzija koja je imala uklju|fffd|ene te kolone je: "Tehni|fffd|ka pomo|fffd| - proba 1 - Backup - 16-06-15 - 4.xlsm"
        ' ostavljam dio makronaredbe koji radi tu provjeru jer nema nikakvog u|fffd|inka i ne tro|fffd|i puno vremena
        ' ako na|fffd|emo odgovaraju|fffd|i kriterij mo|fffd|emo ga ponovno staviti u funkciju
        Err.Clear
        On Error Resume Next
        With Sheet81
            Set MyRng = Nothing
            Set MyRng = .Range(.Cells(MinRw - 1, Prazna2_Col), .Cells(MaxRw, Prazna2_Col)).Find("GRE|fffd|KA", LookIn:=xlValues)
        End With
        If MyRng Is Nothing Or Err.Number <> 0 Then
            Err.Clear
        Else
            rw = MyRng.Row
            Application.Undo
            Application.ScreenUpdating = True
            Sheet81.Cells(rw, PT2_prilagodjen_broj_jedinica_Col).Select
            Naslov = "|fffd|elija " & Sheet81.Cells(rw, PT2_prilagodjen_broj_jedinica_Col).Address(rowabsolute:=False, columnabsolute:=False)
            MsgBox prompt:="Broj jedinica za pla|fffd|e mora biti izme|fffd|u 0 i 1!", Title:=Naslov, Buttons:=vbCritical
            Err.Clear
            GoTo ErrHandler
        End If
        On Error GoTo ErrHandler
        
        
        ' promjena 12.04.2017. - comment-out
        ' Prilago|fffd|eni broj jedinica mo|fffd|e biti ve|fffd|i od potra|fffd|ivanog. Bitno je da odobreni iznos ne bude ve|fffd|i od potra|fffd|ivanog.
'        Err.Clear
'        On Error Resume Next
'        With Sheet81
'            Set MyRng = Nothing
'            Set MyRng = .Range(.Cells(MinRw - 1, Provjera1_Col), .Cells(MaxRw, Provjera1_Col)).Find("GRE|fffd|KA", LookIn:=xlValues)
'        End With
'        If MyRng Is Nothing Or Err.Number <> 0 Then
'            Err.Clear
'        Else
'            Rw = MyRng.Row
'            Application.Undo
'            Application.ScreenUpdating = True
'            Sheet81.Cells(Rw, PT2_prilagodjen_broj_jedinica_Col).Select
'            Naslov = "|fffd|elija " & Sheet81.Cells(Rw, PT2_prilagodjen_broj_jedinica_Col).Address(rowabsolute:=False, columnabsolute:=False)
'            MsgBox Prompt:="Odobreni broj jedinica ne mo|fffd|e biti ve|fffd|i od potra|fffd|ivanog!", _
'                Title:=Naslov, Buttons:=vbCritical
'            Err.Clear
'            GoTo ErrHandler
'        End If
'        On Error GoTo ErrHandler
        ' kraj promjene 12.04.2017.
        
        
        ' promjena 12.04.2017. - comment-out
        ' Prilago|fffd|ena jedini|fffd|na cijena mo|fffd|e biti ve|fffd|a od potra|fffd|ivane. Bitno je da odobreni iznos ne bude ve|fffd|i od potra|fffd|ivanog.
'        Err.Clear
'        On Error Resume Next
'        With Sheet81
'            Set MyRng = Nothing
'            Set MyRng = .Range(.Cells(MinRw - 1, Provjera2_Col), .Cells(MaxRw, Provjera2_Col)).Find("GRE|fffd|KA", LookIn:=xlValues)
'        End With
'        If MyRng Is Nothing Or Err.Number <> 0 Then
'            Err.Clear
'        Else
'            Rw = MyRng.Row
'            Application.Undo
'            Application.ScreenUpdating = True
'            Sheet81.Cells(Rw, PT2_prilagodjena_jedinicna_cijena_Col).Select
'            Naslov = "|fffd|elija " & Sheet81.Cells(Rw, PT2_prilagodjena_jedinicna_cijena_Col).Address(rowabsolute:=False, columnabsolute:=False)
'            MsgBox Prompt:="Odobrena jedini|fffd|na cijena ne mo|fffd|e biti ve|fffd|a od potra|fffd|ivane!", _
'                Title:=Naslov, Buttons:=vbCritical
'            Err.Clear
'            GoTo ErrHandler
'        End If
'        On Error GoTo ErrHandler
        ' kraj promjene 12.04.2017.
    End If
    
    
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        
        
        With Sheet81
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, Broj_jedinica_Col), .Cells(MaxRw, Broj_jedinica_Col)). _
                Find(What:=".?????", LookIn:=xlFormulas, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Broj jedinica mo|fffd|e biti unesen s najvi|fffd|e 4 decimale!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
            On Error GoTo ErrHandler
            
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, Broj_jedinica_Col), .Cells(MaxRw, Broj_jedinica_Col)). _
                Find(What:="-", LookIn:=xlValues, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Broj jedinica ne mo|fffd|e biti negativan!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
            On Error GoTo ErrHandler
        End With
        
        
        With Sheet81
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, Jedinicna_cijena_Col), .Cells(MaxRw, Jedinicna_cijena_Col)). _
                Find(What:=".???", LookIn:=xlFormulas, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Jedini|fffd|na cijena mo|fffd|e biti unesena s najvi|fffd|e 2 decimale!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
            On Error GoTo ErrHandler
            
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, Jedinicna_cijena_Col), .Cells(MaxRw, Jedinicna_cijena_Col)). _
                Find(What:="-", LookIn:=xlValues, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Jedini|fffd|na cijena ne mo|fffd|e biti negativan broj!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
        End With
        
        
    End If
    
    
    If ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" Then
        
        
        With Sheet81
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, PT2_prilagodjen_broj_jedinica_Col)). _
                Find(What:=".?????", LookIn:=xlFormulas, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Broj jedinica mo|fffd|e biti unesen s najvi|fffd|e 4 decimale!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
            On Error GoTo ErrHandler
            
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, PT2_prilagodjen_broj_jedinica_Col)). _
                Find(What:="-", LookIn:=xlValues, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Broj jedinica ne mo|fffd|e biti negativan!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
            On Error GoTo ErrHandler
        End With
        
        
        With Sheet81
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, PT2_prilagodjena_jedinicna_cijena_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)). _
                Find(What:=".???", LookIn:=xlFormulas, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Jedini|fffd|na cijena mo|fffd|e biti unesena s najvi|fffd|e 2 decimale!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
            On Error GoTo ErrHandler
            
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, PT2_prilagodjena_jedinicna_cijena_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)). _
                Find(What:="-", LookIn:=xlValues, Lookat:=xlPart)
            MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
            If Err.Number = 0 Then
                Application.Undo
                Application.ScreenUpdating = True
                MyRng.Select
                Naslov = "|fffd|elija " & MyStr
                MsgBox prompt:="Jedini|fffd|na cijena ne mo|fffd|e biti negativan broj!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
            Err.Clear
            On Error GoTo ErrHandler
        End With
        
        
    End If
    
    
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        ' promjena 17.04.2017.
        If ThisWorkbook.Sheets("List").Range("G1").Value <> MaxRw - MinRw + 1 Or _
            ThisWorkbook.Sheets("List").Range("H1").Value <> MaxRw - MinRw + 1 Or _
            ThisWorkbook.Sheets("List").Range("AI1").Value <> MaxRw - MinRw + 1 Or _
            ThisWorkbook.Sheets("List").Range("AJ1").Value <> MaxRw - MinRw + 1 Or _
            ThisWorkbook.Sheets("List").Range("AK1").Value <> MaxRw - MinRw + 1 Or _
            ThisWorkbook.Sheets("List").Range("AL1").Value <> MaxRw - MinRw + 1 Or _
            ThisWorkbook.Sheets("List").Range("AM1").Value <> MaxRw - MinRw + 1 Then
        ' kraj promjene 17.04.2017.
            Application.Undo
            Naslov = "Gre|fffd|ka!"
            MsgBox prompt:="Potrebno je odabrati vrijednost iz padaju|fffd|eg izbornika!", _
                Title:=Naslov, Buttons:=vbCritical
            GoTo ErrHandler
        End If
        If ThisWorkbook.Sheets("List").Range("J1").Value > 0 Then
            Application.Undo
            Naslov = "Gre|fffd|ka!"
            MsgBox prompt:="Unos mora biti broj!", _
                Title:=Naslov, Buttons:=vbCritical
            GoTo ErrHandler
        End If
        Err.Clear
        On Error Resume Next
        With Sheet81
            BrojFormula = .Range(.Cells(MinRw, Element_projekta_Col), .Cells(MaxRw, Jedinicna_cijena_Col)).SpecialCells(xlCellTypeFormulas).Count
            If Err.Number <> 0 Then
                Err.Clear
                BrojFormula = .Range(.Cells(MinRw, Klarifikacija_korisnika_Col), .Cells(MaxRw, Klarifikacija_korisnika_Col)).SpecialCells(xlCellTypeFormulas).Count
                If Err.Number <> 0 Then
                    Err.Clear
                    BrojFormula = 0
                Else
                 Naslov = .Range(.Cells(MinRw, Klarifikacija_korisnika_Col), .Cells(MaxRw, Klarifikacija_korisnika_Col)). _
                    SpecialCells(xlCellTypeFormulas).Cells(1, 1).Address(rowabsolute:=False, columnabsolute:=False)
                End If
            Else
             Naslov = .Range(.Cells(MinRw, Element_projekta_Col), .Cells(MaxRw, Jedinicna_cijena_Col)). _
                SpecialCells(xlCellTypeFormulas).Cells(1, 1).Address(rowabsolute:=False, columnabsolute:=False)
            End If
            On Error GoTo ErrHandler
            If BrojFormula > 0 Then
                Application.Undo
                Naslov = "|fffd|elija " & Naslov
                MsgBox prompt:="Unos ne mo|fffd|e biti formula!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
        End With
    End If
    
    
    If ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" Then
        If ThisWorkbook.Sheets("List").Range("K1").Value > 0 Then
            Application.Undo
            Naslov = "Gre|fffd|ka!"
            MsgBox prompt:="Unos mora biti broj!", _
                Title:=Naslov, Buttons:=vbCritical
            GoTo ErrHandler
        End If
        Err.Clear
        On Error Resume Next
        With Sheet81
            BrojFormula = .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).SpecialCells(xlCellTypeFormulas).Count
            If Err.Number <> 0 Then
                Err.Clear
                BrojFormula = 0
            Else
                Naslov = .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)). _
                    SpecialCells(xlCellTypeFormulas).Cells(1, 1).Address(rowabsolute:=False, columnabsolute:=False)
            End If
            On Error GoTo ErrHandler
            If BrojFormula > 0 Then
                Application.Undo
                Naslov = "|fffd|elija " & Naslov
                MsgBox prompt:="Unos ne mo|fffd|e biti formula!", _
                    Title:=Naslov, Buttons:=vbCritical
                GoTo ErrHandler
            End If
        End With
    End If
    
    
    ' provjera indirektnih tro|fffd|kova
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        With Sheet81
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, Oznaka_troska_Col), .Cells(MaxRw, Oznaka_troska_Col)). _
                Find(What:="Indirektni tro|fffd|ak", LookIn:=xlFormulas, Lookat:=xlWhole)
                MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
                Adresa1 = MyRng.Row
                Adresa2 = MyRng.Column
            If Err.Number = 0 Then
                If MyRng.Row < MaxRw Then
                    Set MyRng = .Range(.Cells(MyRng.Row + 1, Oznaka_troska_Col), .Cells(MaxRw, Oznaka_troska_Col)). _
                        Find(What:="Indirektni tro|fffd|ak", LookIn:=xlFormulas, Lookat:=xlWhole)
                    MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
                    If Err.Number = 0 Then
                        Application.Undo
                        Application.ScreenUpdating = True
                        MyRng.Select
                        Naslov = "|fffd|elija " & MyStr
                        MsgBox prompt:="Samo jedna linija tro|fffd|ka mo|fffd|e imati oznaku Indirektni tro|fffd|ak!", _
                            Title:=Naslov, Buttons:=vbCritical
                        GoTo ErrHandler
                    Else
                        Set MyRng = .Range(.Cells(MinRw, Ukupni_iznos_Col), .Cells(MaxRw, Ukupni_iznos_Col))
                        ' pazi - ovdje ru|fffd|no upisujem formulu
                        MyRng.FormulaR1C1 = "=IF(OR(RC[-2]="""",RC[-1]=""""),"""",ROUND(RC[-2]*RC[-1],2))"
                        Set MyRng = .Cells(CLng(Adresa1), CInt(Adresa2))
                        .Cells(MyRng.Row, Broj_jedinica_Col).ClearContents
                        .Cells(MyRng.Row, Jedinicna_cijena_Col).ClearContents
                        .Cells(MyRng.Row, Naziv_dobavljaca_Col).ClearContents
                        .Cells(MyRng.Row, OIB_dobavljaca_Col).ClearContents
                        .Cells(MyRng.Row, Vrsta_troska_Col).ClearContents
                        .Cells(MyRng.Row, Opis_troska_Col).ClearContents
'                        .Cells(MyRng.Row, Nastanak_troska_Col).ClearContents
                        .Cells(MyRng.Row, Mjesec).ClearContents
                        .Cells(MyRng.Row, Godina).ClearContents
                        .Cells(MyRng.Row, Popratni_dokumenti_nastanka_Col).ClearContents
                        .Cells(MyRng.Row, Popratni_dokumenti_placanja_Col).ClearContents
                        .Cells(MyRng.Row, Klarifikacija_korisnika_Col).ClearContents
                        ' pazi - ovdje ru|fffd|no upisujem formulu
                        If MyRng.Row = MinRw Then
                            .Cells(MyRng.Row, Ukupni_iznos_Col).Formula = "=ROUND(15%*(SUMIF(J13:J2000,""Izravni tro|fffd|ak osoblja*"",O13:O2000)),2)"
'                        ElseIf MyRng.Row = MaxRw Then
'                            .Cells(MyRng.Row, Ukupni_iznos_Col).Formula = "=ROUND(15%*(SUMIF(J12:J9999,""Izravni tro|fffd|ak osoblja"",M12:M9999) + SUMIF(J12:J9999,"""",M12:M9999)),2)"
                        Else
                            Adresa1 = MyRng.Row - 1
                            Adresa2 = MyRng.Row + 1
                            .Cells(MyRng.Row, Ukupni_iznos_Col).Formula = "=ROUND(15%*(SUMIF(J12:J" & Adresa1 & ",""Izravni tro|fffd|ak osoblja*"",O12:O" & Adresa1 & ") +SUMIF(J" & Adresa2 & ":J2000,""Izravni tro|fffd|ak osoblja*"",O" & Adresa2 & ":O2000)),2)"
                        End If
                    End If
                Else
                    Set MyRng = .Range(.Cells(MinRw, Ukupni_iznos_Col), .Cells(MaxRw, Ukupni_iznos_Col))
                    ' pazi - ovdje ru|fffd|no upisujem formulu
                    MyRng.FormulaR1C1 = "=IF(OR(RC[-2]="""",RC[-1]=""""),"""",ROUND(RC[-2]*RC[-1],2))"
                    Set MyRng = .Cells(CLng(Adresa1), CInt(Adresa2))
                    .Cells(MyRng.Row, Broj_jedinica_Col).ClearContents
                    .Cells(MyRng.Row, Jedinicna_cijena_Col).ClearContents
                    .Cells(MyRng.Row, Naziv_dobavljaca_Col).ClearContents
                    .Cells(MyRng.Row, OIB_dobavljaca_Col).ClearContents
                    .Cells(MyRng.Row, Vrsta_troska_Col).ClearContents
                    .Cells(MyRng.Row, Opis_troska_Col).ClearContents
                    .Cells(MyRng.Row, Nastanak_troska_Col).ClearContents
                    .Cells(MyRng.Row, Mjesec).ClearContents
                    .Cells(MyRng.Row, Godina).ClearContents
                    .Cells(MyRng.Row, Popratni_dokumenti_nastanka_Col).ClearContents
                    .Cells(MyRng.Row, Popratni_dokumenti_placanja_Col).ClearContents
                    .Cells(MyRng.Row, Klarifikacija_korisnika_Col).ClearContents
                    ' pazi - ovdje ru|fffd|no upisujem formulu
                    .Cells(MyRng.Row, Ukupni_iznos_Col).Formula = "=ROUND(15%*(SUMIF(J12:J1999,""Izravni tro|fffd|ak osoblja*"",O12:O1999)),2)"
                End If
            Else
                Set MyRng = .Range(.Cells(MinRw, Ukupni_iznos_Col), .Cells(MaxRw, Ukupni_iznos_Col))
                ' pazi - ovdje ru|fffd|no upisujem formulu
                MyRng.FormulaR1C1 = "=IF(OR(RC[-2]="""",RC[-1]=""""),"""",ROUND(RC[-2]*RC[-1],2))"
            End If
            Err.Clear
            On Error GoTo ErrHandler
        End With
    End If
    If ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" Then
        With Sheet81
            Err.Clear
            On Error Resume Next
            Set MyRng = .Range(.Cells(MinRw - 1, PT2_prilagodjena_oznaka_Col), .Cells(MaxRw, PT2_prilagodjena_oznaka_Col)). _
                Find(What:="Indirektni tro|fffd|ak", LookIn:=xlFormulas, Lookat:=xlWhole)
                MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
                Adresa1 = MyRng.Row
                Adresa2 = MyRng.Column
            If Err.Number = 0 Then
                If MyRng.Row < MaxRw Then
                    Set MyRng = .Range(.Cells(MyRng.Row + 1, PT2_prilagodjena_oznaka_Col), .Cells(MaxRw, PT2_prilagodjena_oznaka_Col)). _
                        Find(What:="Indirektni tro|fffd|ak", LookIn:=xlFormulas, Lookat:=xlWhole)
                    MyStr = MyRng.Address(rowabsolute:=False, columnabsolute:=False)
                    If Err.Number = 0 Then
                        Application.Undo
                        Application.ScreenUpdating = True
                        MyRng.Select
                        Naslov = "|fffd|elija " & MyStr
                        MsgBox prompt:="Samo jedna linija tro|fffd|ka mo|fffd|e imati oznaku Indirektni tro|fffd|ak!", _
                            Title:=Naslov, Buttons:=vbCritical
                        GoTo ErrHandler
                    Else
                        Set MyRng = .Range(.Cells(MinRw, PT2_prilagodjen_iznos_Col), .Cells(MaxRw, PT2_prilagodjen_iznos_Col))
                        ' pazi - ovdje ru|fffd|no upisujem formulu
                        MyRng.FormulaR1C1 = "=IF(OR(RC[-2]="""",RC[-1]=""""),"""",IF(ROUND(RC[-2]*RC[-1],2)>RC[-8],RC[-8],ROUND(RC[-2]*RC[-1],2)))"
                        Set MyRng = .Cells(CLng(Adresa1), CInt(Adresa2))
                        .Cells(MyRng.Row, PT2_prilagodjen_broj_jedinica_Col).ClearContents
                        .Cells(MyRng.Row, PT2_prilagodjena_jedinicna_cijena_Col).ClearContents
                        ' pazi - ovdje ru|fffd|no upisujem formulu
                        If MyRng.Row = MinRw Then
                            .Cells(MyRng.Row, PT2_prilagodjen_iznos_Col).Formula = "=ROUND(15%*(SUMIF(T13:T2000,""Izravni tro|fffd|ak osoblja*"",W13:W2000)),2)"
'                        ElseIf MyRng.Row = MaxRw Then
'                            .Cells(MyRng.Row, PT2_prilagodjen_iznos_Col).Formula = "=ROUND(15%*(SUMIF(R12:R9999,""Izravni tro|fffd|ak osoblja"",U12:U9999) + SUMIF(R12:R9999,"""",U12:U9999)),2)"
                        Else
                            Adresa1 = MyRng.Row - 1
                            Adresa2 = MyRng.Row + 1
                            .Cells(MyRng.Row, PT2_prilagodjen_iznos_Col).Formula = "=ROUND(15%*(SUMIF(T12:T" & Adresa1 & ",""Izravni tro|fffd|ak osoblja*"",W12:W" & Adresa1 & ") +SUMIF(T" & Adresa2 & ":T2000,""Izravni tro|fffd|ak osoblja*"",W" & Adresa2 & ":W2000)),2)"
                        End If
                    End If
                Else
                    Set MyRng = .Range(.Cells(MinRw, PT2_prilagodjen_iznos_Col), .Cells(MaxRw, PT2_prilagodjen_iznos_Col))
                    ' pazi - ovdje ru|fffd|no upisujem formulu
                    MyRng.FormulaR1C1 = "=IF(OR(RC[-2]="""",RC[-1]=""""),"""",IF(ROUND(RC[-2]*RC[-1],2)>RC[-8],RC[-8],ROUND(RC[-2]*RC[-1],2)))"
                    Set MyRng = .Cells(CLng(Adresa1), CInt(Adresa2))
                    .Cells(MyRng.Row, PT2_prilagodjen_broj_jedinica_Col).ClearContents
                    .Cells(MyRng.Row, PT2_prilagodjena_jedinicna_cijena_Col).ClearContents
                    ' pazi - ovdje ru|fffd|no upisujem formulu
                    .Cells(MyRng.Row, PT2_prilagodjen_iznos_Col).Formula = "=ROUND(15%*(SUMIF(T12:T1999,""Izravni tro|fffd|ak osoblja*"",W12:W1999)),2)"
                End If
            Else
                Set MyRng = .Range(.Cells(MinRw, PT2_prilagodjen_iznos_Col), .Cells(MaxRw, PT2_prilagodjen_iznos_Col))
                ' pazi - ovdje ru|fffd|no upisujem formulu
                MyRng.FormulaR1C1 = "=IF(OR(RC[-2]="""",RC[-1]=""""),"""",IF(ROUND(RC[-2]*RC[-1],2)>RC[-8],RC[-8],ROUND(RC[-2]*RC[-1],2)))"
            End If
            Err.Clear
            On Error GoTo ErrHandler
        End With
    End If
    ' kraj provjere indirektnih tro|fffd|kova
    
    
    Cells.FormatConditions.Delete
    With Range("S12:S2000")
        .FormatConditions.Add Type:=xlExpression, Formula1:= _
            "=AND(S12="""";X12<>"""";X12>0)"
        .FormatConditions(.FormatConditions.Count).SetFirstPriority
        With .FormatConditions(1).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 255
            .TintAndShade = 0
        End With
        ' promjena 18.04.2017.
        .FormatConditions(1).StopIfTrue = True
        ' kraj promjene 18.04.2017.
    End With
    
    With Range("C12:C2000")
        .FormatConditions.Add Type:=xlExpression, Formula1:= _
            "=AND(C12="""";OR(D12<>"""";E12<>"""";F12<>"""";G12<>"""";H12<>"""";I12<>"""";J12<>"""";K12<>"""";L12<>"""";M12<>"""";N12<>""""))"
        .FormatConditions(.FormatConditions.Count).SetFirstPriority
        With .FormatConditions(1).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 255
            .TintAndShade = 0
        End With
        ' promjena 18.04.2017.
        .FormatConditions(1).StopIfTrue = True
        ' kraj promjene 18.04.2017.
    End With
    
    With Range("D12:D2000")
        .FormatConditions.Add Type:=xlExpression, Formula1:= _
            "=AND(D12="""";OR(E12<>"""";F12<>"""";G12<>"""";H12<>"""";I12<>"""";J12<>"""";K12<>"""";L12<>"""";M12<>"""";N12<>""""))"
        .FormatConditions(.FormatConditions.Count).SetFirstPriority
        With .FormatConditions(1).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 255
            .TintAndShade = 0
        End With
        ' promjena 18.04.2017.
        .FormatConditions(1).StopIfTrue = True
        ' kraj promjene 18.04.2017.
    End With
    
    
    ' promjena 17.04.2017.
    With Sheet81
        Set MyRng = .Range(.Cells(MinRw, Broj_troska_Col), .Cells(MaxRw, Broj_troska_Col))
        MyRng.FormulaR1C1 = "=IF(RC[13]="""","""",IF(ROW(R[-1]C)=11,1,R[-1]C+1))"
    End With
    ' kraj promjene 17.04.2017.
    
    
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    Else
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
    End If
    
    Set MyRng = Nothing
    
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.CommandBars("Ply").Enabled = True
    
    Exit Sub
    
    
ErrHandler:
    On Error GoTo 0
    
    
    Cells.FormatConditions.Delete
    With Range("S12:S2000")
        .FormatConditions.Add Type:=xlExpression, Formula1:= _
            "=AND(S12="""";X12<>"""";X12>0)"
        .FormatConditions(.FormatConditions.Count).SetFirstPriority
        With .FormatConditions(1).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 255
            .TintAndShade = 0
        End With
        ' promjena 18.04.2017.
        .FormatConditions(1).StopIfTrue = True
        ' kraj promjene 18.04.2017.
    End With
    
    With Range("C12:C2000")
        .FormatConditions.Add Type:=xlExpression, Formula1:= _
            "=AND(C12="""";OR(D12<>"""";E12<>"""";F12<>"""";G12<>"""";H12<>"""";I12<>"""";J12<>"""";K12<>"""";L12<>"""";M12<>"""";N12<>""""))"
        .FormatConditions(.FormatConditions.Count).SetFirstPriority
        With .FormatConditions(1).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 255
            .TintAndShade = 0
        End With
        ' promjena 18.04.2017.
        .FormatConditions(1).StopIfTrue = True
        ' kraj promjene 18.04.2017.
    End With
    
    With Range("D12:D2000")
        .FormatConditions.Add Type:=xlExpression, Formula1:= _
            "=AND(D12="""";OR(E12<>"""";F12<>"""";G12<>"""";H12<>"""";I12<>"""";J12<>"""";K12<>"""";L12<>"""";M12<>"""";N12<>""""))"
        .FormatConditions(.FormatConditions.Count).SetFirstPriority
        With .FormatConditions(1).Interior
            .PatternColorIndex = xlAutomatic
            .Color = 255
            .TintAndShade = 0
        End With
        ' promjena 18.04.2017.
        .FormatConditions(1).StopIfTrue = True
        ' kraj promjene 18.04.2017.
    End With
    
    
    ' promjena 17.04.2017.
    With Sheet81
        Set MyRng = .Range(.Cells(MinRw, Broj_troska_Col), .Cells(MaxRw, Broj_troska_Col))
        MyRng.FormulaR1C1 = "=IF(RC[13]="""","""",IF(ROW(R[-1]C)=11,1,R[-1]C+1))"
    End With
    ' kraj promjene 17.04.2017.
    
    
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    Else
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
    End If
    
    Set MyRng = Nothing
    
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.CommandBars("Ply").Enabled = True
    
End Sub

Private Sub ZakljucajOdobrenje_Click()
    ' pazi dolazi li do promjene adrese za Range varijablu SifraProjekta (npr. kod brisanja ili dodavanja kolona)
    ' pazi, kod brisanja nekih kolona koristim apsolutne adrese kolona
    
    Const MinRw As Long = 12
    ' promjena 12.04.2017. - smanjen broj redaka s 10000 na 2000 zbog smanjenja veli|fffd|ine i ubrzavanja tablice
    Const MaxRw As Long = 2000
    ' kraj promjene 12.04.2017.
'    Dim MyStr As String
'    Dim MyVar As Variant
    Dim wsh As Worksheet
    Dim rw1 As Long
    Dim rw2 As Long
    Dim rw3 As Long
    Dim rw4 As Long
    Dim rw5 As Long
    Dim rw6 As Long
    Dim rw7 As Long
    Dim rw8 As Long
    Dim rw9 As Long
    Dim rw10 As Long
    Dim rw11 As Long
    ' promjena 17.04.2017.
    Const Mjesec = 11
    Const Godina = 12
    Const Broj_ZNS_Col As Integer = 1
    ' kraj promjene 17.04.2017.
'    Dim Odluka_o_odobrenju_Col As Integer
    Dim Element_projekta_Col As Integer
    Const PT2_prilagodjen_broj_jedinica_Col As Integer = 21
    Const PT2_prilagodjena_jedinicna_cijena_Col As Integer = 22
    Const PT2_prilagodjen_iznos_Col As Integer = 23
    Const Ukupno_neprihvatljivo_Col As Integer = 24
    Const Broj_troska_Col As Integer = 2
    Const Komentar_PT2_Col As Integer = 19
    Const PT2_prilagodjena_oznaka_Col As Integer = 20
    Const Popratni_dokumenti_nastanka_Col As Integer = 16
    Const Popratni_dokumenti_placanja_Col As Integer = 17
    Const Klarifikacija_korisnika_Col As Integer = 18
    Dim SifraProjekta As Range
    Dim MyRng As Range
    Dim Odgovor As Variant
    ' promjena 18.04.2017. - makronaredba onemogu|fffd|ena za tablicu na korisnike
    Exit Sub
    ' kraj promjene 18.04.2017.
    Application.ScreenUpdating = False
    
    On Error GoTo ErrHandler
    
    Odgovor = MsgBox(prompt:="Pokrenuli ste postupak odobrenja. " & _
        "Nakon odobrenja tablica |fffd|e se trajno zaklju|fffd|ati te |fffd|e daljnji unos podataka biti onemogu|fffd|en. " & _
        "Izaberite Ok za nastavak ili Cancel za prekid postupka odobrenja.", Buttons:=vbOKCancel)
    If Odgovor = vbCancel Then GoTo ErrHandler
    
'    MyStr = "pass"
    rw1 = 4
    rw2 = 5
    rw3 = 6
    rw4 = 1
    rw5 = 2
    rw6 = 3
    rw7 = 7
    rw8 = 8
    rw9 = 9
    rw10 = 10
    rw11 = 11
'    Odluka_o_odobrenju_Col = 1
    Element_projekta_Col = 3
    Set SifraProjekta = Sheet81.Range("D1")
    
    Sheet81.Unprotect "odatorticaaaa983"
    ThisWorkbook.Unprotect "odatorticaaaa983"
    
    ZakljucajOdobrenje.Visible = False
    
'    Sheet81.Rows(rw1).Hidden = True
'    Sheet81.Rows(rw2).Hidden = True
'    Sheet81.Rows(rw3).Hidden = True
    ' promjena 12.04.2017. - sad se retci ispod zadnjeg retka koji sadr|fffd|i podatke bri|fffd|u u radnom listu "Tro|fffd|kovi" zbog smanjenja veli|fffd|ine i ubrzavanja tablice
    ' u sljede|fffd|em bloku bri|fffd|em sve retke ispod zadnjeg retka koji sadr|fffd|i podatke
    Application.EnableEvents = False
    With Sheet81
        Set MyRng = .Cells(MinRw, Ukupno_neprihvatljivo_Col + 20)
        Set MyRng = MyRng.End(xlDown)
        Set MyRng = MyRng.End(xlDown)
        Set MyRng = .Cells(MyRng.Row, Element_projekta_Col)
        Set MyRng = MyRng.End(xlUp)
        .Rows(MyRng.Row + 1 & ":" & MaxRw).Delete
    End With
    Application.EnableEvents = True
    ' kraj bloka za brisanje suvi|fffd|nih redaka
    ' kraj promjene 12.04.2017.
    ' promjena 12.04.2017.
    Sheet81.Columns(Broj_troska_Col).Hidden = False
    Sheet81.Columns(Broj_troska_Col).Locked = True
    ' kraj promjene 12.04.2017.
    Sheet81.Columns(Broj_ZNS_Col).Locked = True
    Sheet81.Columns(PT2_prilagodjen_broj_jedinica_Col).Locked = True
    Sheet81.Columns(PT2_prilagodjena_jedinicna_cijena_Col).Locked = True
    Sheet81.Columns(PT2_prilagodjen_iznos_Col).Locked = True
    Sheet81.Columns(Ukupno_neprihvatljivo_Col).Locked = True
    Sheet81.Columns(Komentar_PT2_Col).Locked = True
    Sheet81.Columns(PT2_prilagodjena_oznaka_Col).Locked = True
    Sheet81.Rows(rw4).Locked = True
    Sheet81.Rows(rw5).Locked = True
    Sheet81.Rows(rw6).Locked = True
    Sheet81.Rows(rw7).Locked = True
    Sheet81.Rows(rw8).Locked = True
    Sheet81.Rows(rw9).Locked = True
    Sheet81.Rows(rw10).Locked = True
    Sheet81.Rows(rw11).Locked = True
    SifraProjekta.Locked = True
    ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj"
    ZakljucajOtkljucaj.Visible = False
    ' dodavanje radnog lista za ispis
    Set wsh = Sheets.Add(After:=ThisWorkbook.Sheets(ThisWorkbook.Sheets.Count))
    With wsh
        .Name = "Ispis"
        Sheet81.Cells.Copy .Cells
        .Cells.Copy
        .Cells.PasteSpecial xlPasteValues
        .Columns(Broj_troska_Col).Hidden = False
        ' promjena 12.04.2017.
        .Columns(Broj_troska_Col).Locked = False
        ' kraj promjene 12.04.2017.
        .Columns(Broj_ZNS_Col).Locked = False
        .Columns(PT2_prilagodjen_broj_jedinica_Col).Locked = False
        .Columns(PT2_prilagodjena_jedinicna_cijena_Col).Locked = False
        .Columns(PT2_prilagodjen_iznos_Col).Locked = False
        .Columns(Ukupno_neprihvatljivo_Col).Locked = False
        .Columns(Komentar_PT2_Col).Locked = False
        .Columns(PT2_prilagodjena_oznaka_Col).Locked = False
'        .Columns(PT2_prilagodjen_iznos_Col).ColumnWidth = 43
        .Range(.Cells(rw1, Klarifikacija_korisnika_Col), .Cells(rw3, Klarifikacija_korisnika_Col)).Copy _
        Destination:=.Cells(rw1, PT2_prilagodjen_iznos_Col)
        .Columns(Ukupno_neprihvatljivo_Col).Delete
        .Columns(PT2_prilagodjena_jedinicna_cijena_Col).Delete
        .Columns(PT2_prilagodjen_broj_jedinica_Col).Delete
        .Columns(PT2_prilagodjena_oznaka_Col).Delete
        .Columns(Klarifikacija_korisnika_Col).Delete
        .Columns(Popratni_dokumenti_placanja_Col).Delete
        .Columns(Popratni_dokumenti_nastanka_Col).Delete
        ' pazi, u sljede|fffd|em retku koristim apsolutne adrese kolona jer ih ima puno
        .Columns("E:N").Delete
        ' promjena 12.04.2017. - comment-out
'        .Columns(Broj_troska_Col).Delete
        ' kraj promjene 12.04.2017.
        .Columns(Broj_ZNS_Col).Delete
        ' pazi, u sljede|fffd|a 3 retka koristim apsolutne adrese kolona jer su se promijenile nakon |fffd|to ih je ve|fffd|ina izbrisana
        .Columns("E").Cut .Columns("G")
        .Columns("E").Delete
        .Columns("G:L").Delete
        ' pazi, u sljede|fffd|em retku koristim apsolutne adrese |fffd|elija (bri|fffd|em subtotale)
        .Range("E4:F6").Delete xlShiftToLeft
        ' promjena 12.04.2017. - comment-out - sad se retci ispod zadnjeg retka koji sadr|fffd|i podatke bri|fffd|u u radnom listu "Tro|fffd|kovi" zbog smanjenja veli|fffd|ine i ubrzavanja tablice
        ' u sljede|fffd|em bloku bri|fffd|em sve retke ispod zadnjeg retka koji sadr|fffd|i podatke
'        Set MyRng = .Cells(MinRw, Ukupno_neprihvatljivo_Col + 20)
'        Set MyRng = MyRng.End(xlDown)
'        Set MyRng = MyRng.End(xlDown)
'        Set MyRng = .Cells(MyRng.Row, Odluka_o_odobrenju_Col)
'        Set MyRng = MyRng.End(xlUp)
'        .Rows(MyRng.Row + 1 & ":" & MaxRw).Delete
        ' kraj bloka za brisanje suvi|fffd|nih redaka
        ' kraj promjene 12.04.2017.
        ' pode|fffd|avanje postavki za ispis
        Application.PrintCommunication = False
        With .PageSetup
            .Zoom = False
            .FitToPagesWide = 1
            .FitToPagesTall = False
        End With
        Application.PrintCommunication = True
        ' kraj pode|fffd|avanja postavki za ispis
        .Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    End With
    ' kraj dodavanja radnog lista za ispis
    ThisWorkbook.Sheets("List").Visible = xlSheetVeryHidden
    ThisWorkbook.Protect "odatorticaaaa983"
    
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowFiltering:=True
    Sheet3.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowFiltering:=True
    
    Set MyRng = Nothing
    Set SifraProjekta = Nothing
    
    Application.ScreenUpdating = True
    Application.CommandBars("Ply").Enabled = True

    Exit Sub
    
    
ErrHandler:
    On Error GoTo 0
    
    ThisWorkbook.Protect "odatorticaaaa983"
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
        Sheet3.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    Else
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
        Sheet3.Unprotect Password:="odatorticaaaa983"
    End If
    
    Set MyRng = Nothing
    Set SifraProjekta = Nothing
    
    Application.ScreenUpdating = True
    Application.CommandBars("Ply").Enabled = True

End Sub

Private Sub ZakljucajOtkljucaj_Click()
    ' pazi dolazi li do promjene adrese za Range varijabli SifraProjekta i Subtotal (npr. kod brisanja ili dodavanja kolona)
    
    Dim MyStr As String
    Dim MyVar As Variant
    Dim rw1 As Long
    Dim rw2 As Long
    Dim rw3 As Long
    Dim rw4 As Long
    Dim rw5 As Long
    Dim rw6 As Long
    Dim rw7 As Long
    Dim rw8 As Long
    Dim rw9 As Long
    Dim rw10 As Long
    Dim rw11 As Long
    ' promjena 17.04.2017.
    Const Mjesec = 11
    Const Godina = 12
    Const Broj_ZNS_Col As Integer = 1
    Dim Naslov As String
    ' kraj promjene 17.04.2017.
'    Dim Odluka_o_odobrenju_Col As Integer
    Const PT2_prilagodjen_broj_jedinica_Col As Integer = 21
    Const PT2_prilagodjena_jedinicna_cijena_Col As Integer = 22
    Const PT2_prilagodjen_iznos_Col As Integer = 23
    Const Ukupno_neprihvatljivo_Col As Integer = 24
    Dim Broj_troska_Col As Integer
    Dim Element_projekta_Col As Integer
    Dim Stavka_troska_Col As Integer
    Dim Opis_troska_Col As Integer
    Const Broj_jedinica_Col As Integer = 13
    Const Jedinicna_cijena_Col As Integer = 14
    Const Klarifikacija_korisnika_Col As Integer = 18
    Dim Naziv_dobavljaca_Col As Integer
    Dim OIB_dobavljaca_Col As Integer
    Dim Vrsta_troska_Col As Integer
    Dim Nastanak_troska_Col As Integer
    Dim Oznaka_troska_Col As Integer
    Const Popratni_dokumenti_nastanka_Col As Integer = 16
    Const Popratni_dokumenti_placanja_Col As Integer = 17
    Const Komentar_PT2_Col As Integer = 19
    Const PT2_prilagodjena_oznaka_Col As Integer = 20
    Dim Subtotal As Range
    Dim SifraProjekta As Range
    ' promjena 18.04.2017.
    Const MinRw As Long = 12
    Const MaxRw As Long = 2000
    Dim IzvanTablice As Range
    Dim BrZNSiRazdoblje As Range
    Set BrZNSiRazdoblje = Sheet81.Range("D2:D3")
    ' kraj promjene 18.04.2017.
    
    Application.ScreenUpdating = False
    
    On Error GoTo ErrHandler
    
    MyStr = "pq184c25"
    rw1 = 4
    rw2 = 5
    rw3 = 6
    rw4 = 1
    rw5 = 2
    rw6 = 3
    rw7 = 7
    rw8 = 8
    rw9 = 9
    rw10 = 10
    rw11 = 11
'    Odluka_o_odobrenju_Col = 1
    Set SifraProjekta = Sheet81.Range("D1")
    ' promjena 17.04.2017.
    Set Subtotal = Sheet81.Range("R4:S6")
    ' kraj promjene 17.04.2017.
    
    Broj_troska_Col = 2
    Element_projekta_Col = 3
    Stavka_troska_Col = 4
    Opis_troska_Col = 8
    Naziv_dobavljaca_Col = 5
    OIB_dobavljaca_Col = 6
    Vrsta_troska_Col = 7
    Nastanak_troska_Col = 9
    Oznaka_troska_Col = 10
    
    Sheet81.Unprotect "odatorticaaaa983"
    
    If ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" Then
        ThisWorkbook.Unprotect "odatorticaaaa983"
'        ThisWorkbook.Sheets("List").Visible = xlSheetVeryHidden
'        ThisWorkbook.Protect "odatorticaaaa983"
'        Sheet81.Rows(rw1).Hidden = True
        Sheet81.Rows(rw2).Hidden = True
        Sheet81.Rows(rw3).Hidden = True
        Sheet81.Columns(Broj_ZNS_Col).Hidden = True
        Sheet81.Columns(PT2_prilagodjena_oznaka_Col).Hidden = True
        Sheet81.Columns(PT2_prilagodjen_broj_jedinica_Col).Hidden = True
        Sheet81.Columns(PT2_prilagodjena_jedinicna_cijena_Col).Hidden = True
        Sheet81.Columns(PT2_prilagodjen_iznos_Col).Hidden = True
        Sheet81.Columns(Ukupno_neprihvatljivo_Col).Hidden = True
        ' promjena 12.04.2017.
        Sheet81.Columns(Broj_troska_Col).Hidden = False
        Sheet81.Columns(Broj_troska_Col).Locked = True
        ' kraj promjene 12.04.2017.
        
        ' promjena 12.04.2017.
'        Sheet81.Columns(Broj_troska_Col).Locked = False
        ' kraj promjene 12.04.2017.
        Sheet81.Columns(Element_projekta_Col).Locked = False
        Sheet81.Columns(Stavka_troska_Col).Locked = False
        Sheet81.Columns(Opis_troska_Col).Locked = False
        Sheet81.Columns(Broj_jedinica_Col).Locked = False
        Sheet81.Columns(Jedinicna_cijena_Col).Locked = False
        Sheet81.Columns(Klarifikacija_korisnika_Col).Locked = False
        Sheet81.Columns(Naziv_dobavljaca_Col).Locked = False
        Sheet81.Columns(OIB_dobavljaca_Col).Locked = False
        Sheet81.Columns(Vrsta_troska_Col).Locked = False
        Sheet81.Columns(Nastanak_troska_Col).Locked = False
        Sheet81.Columns(Oznaka_troska_Col).Locked = False
        ' promjena 17.04.2017.
        Sheet81.Columns(Mjesec).Locked = False
        Sheet81.Columns(Godina).Locked = False
        ' kraj promjene 17.04.2017.
        Sheet81.Columns(Popratni_dokumenti_nastanka_Col).Locked = False
        Sheet81.Columns(Popratni_dokumenti_placanja_Col).Locked = False
        Sheet81.Columns(Komentar_PT2_Col).Locked = True
        
        
        ' promjena 24.05.2017
        Dim rw As Long
        Dim LastRowNum As Long
        LastRowNum = 0
        rw = MinRw - 1
        
        ThisWorkbook.Sheets("List").Unprotect "odatorticaaaa983"
        ThisWorkbook.Sheets("List").Range("AQ1").Value = "Verzija"
        ThisWorkbook.Sheets("List").Range("AQ2").Value = "TURIZAM 4.0"
        ThisWorkbook.Sheets("List").Protect Password:="odatorticaaaa983", DrawingObjects:=True, _
            Contents:=True, Scenarios:=True, AllowFiltering:=True
        
        If Application.WorksheetFunction.CountA(Me.Columns(Broj_troska_Col)) <> 0 Then
            LastRowNum = Me.Columns(Broj_troska_Col).Find(What:="*", _
                            LookIn:=xlValues, _
                            SearchOrder:=xlByRows, _
                            SearchDirection:=xlPrevious).Row
        Else
            LastRowNum = 1
        End If
        
        With Me
            Do Until rw > LastRowNum
                rw = rw + 1
                If .Cells(rw, Komentar_PT2_Col).Value = "" Then
                    .Range(.Cells(rw, Broj_troska_Col), .Cells(rw, Komentar_PT2_Col)).Locked = True
                End If
            Loop
        End With
        ' kraj promjene 24.05.2017
        
        
        Sheet81.Rows(rw1).Locked = True
        Sheet81.Rows(rw4).Locked = True
        Sheet81.Rows(rw5).Locked = True
        Sheet81.Rows(rw6).Locked = True
        Sheet81.Rows(rw7).Locked = True
        Sheet81.Rows(rw8).Locked = True
        Sheet81.Rows(rw9).Locked = True
        Sheet81.Rows(rw10).Locked = True
        Sheet81.Rows(rw11).Locked = True
        
        SifraProjekta.Locked = True
        Subtotal.Locked = True
        ' promjena 18.04.2017.
        BrZNSiRazdoblje.Locked = False
        With Sheet81
            Set IzvanTablice = .Cells(MinRw, Ukupno_neprihvatljivo_Col + 20)
            Set IzvanTablice = IzvanTablice.End(xlDown)
            Set IzvanTablice = IzvanTablice.End(xlDown)
            Set IzvanTablice = .Range(.Cells(MaxRw + 1, Element_projekta_Col), .Cells(IzvanTablice.Row, Komentar_PT2_Col))
            IzvanTablice.Locked = True
        End With
        ' kraj promjene 18.04.2017.
        ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj"
        ZakljucajOdobrenje.Visible = False
        ThisWorkbook.Sheets("List").Visible = xlSheetVeryHidden
        ThisWorkbook.Protect "odatorticaaaa983"
    Else
        MyVar = Application.InputBox("Unesite lozinku:", "Lozinka")
        If CStr(MyVar) = MyStr Then
            ThisWorkbook.Unprotect "odatorticaaaa983"
'            ThisWorkbook.Sheets("List").Visible = xlSheetVisible
'            ThisWorkbook.Protect "odatorticaaaa983"
            Sheet81.Rows(rw1).Hidden = False
            Sheet81.Rows(rw2).Hidden = False
            Sheet81.Rows(rw3).Hidden = False
            Sheet81.Columns(Broj_ZNS_Col).Hidden = False
            Sheet81.Columns(PT2_prilagodjena_oznaka_Col).Hidden = False
            Sheet81.Columns(PT2_prilagodjen_broj_jedinica_Col).Hidden = False
            Sheet81.Columns(PT2_prilagodjena_jedinicna_cijena_Col).Hidden = False
            Sheet81.Columns(PT2_prilagodjen_iznos_Col).Hidden = False
            Sheet81.Columns(Ukupno_neprihvatljivo_Col).Hidden = False
            ' promjena 12.04.2017.
            Sheet81.Columns(Broj_troska_Col).Hidden = False
            Sheet81.Columns(Broj_troska_Col).Locked = True
            ' kraj promjene 12.04.2017.
            
            Sheet81.Columns(Broj_ZNS_Col).Locked = True
            Sheet81.Columns(PT2_prilagodjen_broj_jedinica_Col).Locked = False
            Sheet81.Columns(PT2_prilagodjena_jedinicna_cijena_Col).Locked = False
            Sheet81.Columns(PT2_prilagodjen_iznos_Col).Locked = True
            Sheet81.Columns(Ukupno_neprihvatljivo_Col).Locked = True
            Sheet81.Columns(Komentar_PT2_Col).Locked = False
            Sheet81.Columns(PT2_prilagodjena_oznaka_Col).Locked = False
            
            Sheet81.Rows(rw1).Locked = True
            Sheet81.Rows(rw2).Locked = True
            Sheet81.Rows(rw3).Locked = True
            Sheet81.Rows(rw4).Locked = True
            Sheet81.Rows(rw5).Locked = True
            Sheet81.Rows(rw6).Locked = True
            Sheet81.Rows(rw7).Locked = True
            Sheet81.Rows(rw8).Locked = True
            Sheet81.Rows(rw9).Locked = True
            Sheet81.Rows(rw10).Locked = True
            Sheet81.Rows(rw11).Locked = True
            Sheet81.Columns(Broj_troska_Col).Locked = True
            Sheet81.Columns(Element_projekta_Col).Locked = True
            Sheet81.Columns(Stavka_troska_Col).Locked = True
            Sheet81.Columns(Opis_troska_Col).Locked = True
            Sheet81.Columns(Broj_jedinica_Col).Locked = True
            Sheet81.Columns(Jedinicna_cijena_Col).Locked = True
            Sheet81.Columns(Klarifikacija_korisnika_Col).Locked = True
            Sheet81.Columns(Naziv_dobavljaca_Col).Locked = True
            Sheet81.Columns(OIB_dobavljaca_Col).Locked = True
            Sheet81.Columns(Vrsta_troska_Col).Locked = True
            Sheet81.Columns(Nastanak_troska_Col).Locked = True
            Sheet81.Columns(Oznaka_troska_Col).Locked = True
            ' promjena 17.04.2017.
            Sheet81.Columns(Mjesec).Locked = True
            Sheet81.Columns(Godina).Locked = True
            ' kraj promjene 17.04.2017.
            Sheet81.Columns(Popratni_dokumenti_nastanka_Col).Locked = True
            Sheet81.Columns(Popratni_dokumenti_placanja_Col).Locked = True
            
            SifraProjekta.Locked = False
            Subtotal.Locked = True
            ' promjena 18.04.2017.
            BrZNSiRazdoblje.Locked = False
            With Sheet81
                Set IzvanTablice = .Cells(MinRw, Ukupno_neprihvatljivo_Col + 20)
                Set IzvanTablice = IzvanTablice.End(xlDown)
                Set IzvanTablice = IzvanTablice.End(xlDown)
                Set IzvanTablice = .Range(.Cells(MaxRw + 1, Element_projekta_Col), .Cells(IzvanTablice.Row, Komentar_PT2_Col))
                IzvanTablice.Locked = True
            End With
            ' kraj promjene 18.04.2017.
            ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj"
            ZakljucajOdobrenje.Visible = True
            ThisWorkbook.Sheets("List").Visible = True
            ThisWorkbook.Protect "odatorticaaaa983"
        ' promjena 17.04.2017.
        Else
            Naslov = "Gre|fffd|ka!"
            MsgBox prompt:="Neto|fffd|na lozinka!", Title:=Naslov, Buttons:=vbCritical
        ' kraj promjene 17.04.2017.
        End If
    End If
    
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        ' promjena 17.04.2017.
        ZakljucajOtkljucaj.Visible = False
        ' kraj promjene 17.04.2017.
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
        Sheet3.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    Else
        ' promjena 17.04.2017.
        ZakljucajOtkljucaj.Visible = True
        ' kraj promjene 17.04.2017.
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
        Sheet3.Unprotect Password:="odatorticaaaa983"
    End If
    
    Set SifraProjekta = Nothing
    Set Subtotal = Nothing
    ' promjena 18.04.2017.
    Set BrZNSiRazdoblje = Nothing
    ' kraj promjene 18.04.2017.
    
    Application.ScreenUpdating = True
    Application.CommandBars("Ply").Enabled = True
    
    Exit Sub
    
    
ErrHandler:
    On Error GoTo 0
    
    ThisWorkbook.Protect "odatorticaaaa983"
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    If ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        ' promjena 17.04.2017.
        ZakljucajOtkljucaj.Visible = False
        ' kraj promjene 17.04.2017.
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
        Sheet3.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    Else
        ' promjena 17.04.2017.
        ZakljucajOtkljucaj.Visible = True
        ' kraj promjene 17.04.2017.
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
        Sheet3.Unprotect Password:="odatorticaaaa983"
    End If
    
    Set SifraProjekta = Nothing
    Set Subtotal = Nothing
    ' promjena 18.04.2017.
    Set BrZNSiRazdoblje = Nothing
    ' kraj promjene 18.04.2017.
    
    Application.ScreenUpdating = True
    Application.CommandBars("Ply").Enabled = True
    
End Sub



Private Function HasValidation(r) As Boolean
'   Returns True if every cell in Range r uses Data Validation
    Dim x As Variant
    On Error Resume Next
    x = r.Validation.Type
    If Err.Number = 0 Then HasValidation = True Else HasValidation = False
End Function

Private Function AfterPoint(S As String) As Long
    On Error Resume Next
    AfterPoint = Len(Split(S & ",", ",")(1))
    On Error GoTo 0
End Function
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Private bActivated As Boolean
Private bBackuped As Boolean

Private Sub Workbook_Activate()
    Const MinRw As Long = 12
    ' promjena 12.04.2017. - smanjen broj redaka s 10000 na 2000 zbog smanjenja veli|fffd|ine i ubrzavanja tablice
    Const MaxRw As Long = 2000
    ' kraj promjene 12.04.2017.
    Const PT2_prilagodjen_broj_jedinica_Col As Integer = 21
    Const PT2_prilagodjena_jedinicna_cijena_Col As Integer = 22
    Const Klarifikacija_korisnika_Col As Integer = 18
    Const Komentar_PT2_Col As Integer = 19
'    Const Odluka_o_odobrenju_Col As Integer = 1
    Const Broj_troska_Col As Integer = 2
    Const Ukupno_neprihvatljivo_Col As Integer = 24
    ' promjena 12.04.2017.
    Const OIB_dobavljaca_Col As Integer = 6
    Const Vrsta_troska_Col As Integer = 7
    Const Nastanak_troska_Col As Integer = 9
    Const Oznaka_troska_Col As Integer = 10
    Const Opis_troska_Col As Integer = 8
    Const Broj_jedinica_Col As Integer = 13
    Const Jedinicna_cijena_Col As Integer = 14
    ' kraj promjene 12.04.2017.
    Const Broj_ZNS_Str As String = "A"
    Const Provjera2_Str As String = "AB"
    Const nesto As Boolean = True
    ' promjena 12.04.2017.
    Dim MyRng As Range
    ' kraj promjene 12.04.2017.
    ' promjena 18.04.2017.
    Dim Filtri As Range
    ' kraj promjene 18.04.2017.
    ' promjena 17.04.2017.
    Const Mjesec = 11
    Const Godina = 12
    Const Broj_ZNS_Col As Integer = 1
    Const Element_projekta_Col As Integer = 3
    Const Ukupni_iznos_Col As Integer = 15
    Const Popratni_dokumenti_nastanka_Col As Integer = 16
    Const PT2_prilagodjena_oznaka_Col As Integer = 20
    Dim counter As Long
    Dim counter1 As Long
    Dim i As Long
    ' kraj promjene 17.04.2017.
    Dim colStr As String
    If bActivated = False Then
        bActivated = True
        bBackuped = False
    Else
        Exit Sub
    End If
    Application.EnableEvents = True
    Application.ScreenUpdating = False
    Application.Run "Module1.PrikaziRadneListove"
    colStr = Broj_ZNS_Str & ":" & Provjera2_Str
    ThisWorkbook.Unprotect "odatorticaaaa983"
'    ThisWorkbook.Sheets("List").Protect Password:="odatorticaaaa983", DrawingObjects:=True, _
        Contents:=True, Scenarios:=True, AllowInsertingHyperlinks:=True, _
        AllowFiltering:=True
    ThisWorkbook.Sheets("List").Protect Password:="odatorticaaaa983", DrawingObjects:=True, _
        Contents:=True, Scenarios:=True, AllowFiltering:=True
    ThisWorkbook.Sheets("Legenda i upute").Protect Password:="odatorticaaaa983", DrawingObjects:=True, _
        Contents:=True, Scenarios:=True, AllowFiltering:=True
    ThisWorkbook.Sheets("Predlo|fffd|ak").Protect Password:="odatorticaaaa983", DrawingObjects:=True, _
        Contents:=True, Scenarios:=True, AllowFiltering:=True, UserInterfaceOnly:=True
        ThisWorkbook.Sheets("Predlo|fffd|ak").Visible = xlSheetVeryHidden
    If ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Or _
        ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Visible = False Then
        ThisWorkbook.Sheets("List").Visible = xlSheetVeryHidden
    End If
    ThisWorkbook.Protect "odatorticaaaa983"
    Call Validacija
    ' FSP-u je omogu|fffd|eno formatiranje |fffd|elija, pa ovime tu mogu|fffd|nost ograni|fffd|avam na kolonu "Komentar PT 2"
    ' ovaj dio makronaredbe je stavljen u  "Workbook_Open" Event jer mu dugo treba da se izvr|fffd|i
    Application.EnableEvents = False
    Sheet81.Unprotect "odatorticaaaa983"
    Sheet81.Activate
    ' promjena 18.04.2017.
    If Sheet81.AutoFilterMode Then Sheet81.Cells.AutoFilter
    Set Filtri = Range("A11:S11")
    Filtri.AutoFilter
    ' kraj promjene 18.04.2017.
    ' promjena 12.04.2017.
    With Sheet81
        Set MyRng = .Range(.Cells(MinRw, Broj_troska_Col), .Cells(MaxRw, Broj_troska_Col))
        MyRng.FormulaR1C1 = "=IF(RC[13]="""","""",IF(ROW(R[-1]C)=11,1,R[-1]C+1))"
        MyRng.Locked = True
    End With
    ' kraj promjene 12.04.2017.
    ' promjena 18.04.2017. - gumb ZakljucajOtkljucaj u korisnikovoj tablici postaje nevidljiv odmah nakon zaklju|fffd|avanja
    ' s obzirom da se u korisnikovoj tablici nece koristiti gumb ZakljucajOdobrenje, uklanjamo uvjet ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Visible = False
    ' to moramo u|fffd|initi jer bi ina|fffd|e makronaredba uvijek pokretala ovaj dio koda ako je radni list zaklju|fffd|an jer bi gumb ZakljucajOtkljucaj bio nevidljiv
    ' to ne bi valjalo jer se ovaj dio koda treba pokrenuti samo ako je radni list otklju|fffd|an ili ako je zaklju|fffd|an radi odobrenja
'    If ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" Or _
'        ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Visible = False Then
    If ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj" Then
    ' kraj promjene 18.04.2017.
        ' promjena 12.04.2017.
        Sheet81.Columns(Broj_troska_Col).Hidden = False
        ' kraj promjene 12.04.2017.
        With Sheet81
            With .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorAccent1
                .TintAndShade = 0.799981688894314
                .PatternTintAndShade = 0
            End With
            .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).Copy
        End With
        With Sheet2
            ' promjena 12.04.2017. - promjena |fffd|irina kolona
            .Columns(OIB_dobavljaca_Col).ColumnWidth = 14.57
            .Columns(Vrsta_troska_Col).ColumnWidth = 14.57
            .Columns(Nastanak_troska_Col).ColumnWidth = 30
            .Columns(Oznaka_troska_Col).ColumnWidth = 19.57
            .Columns(Opis_troska_Col).ColumnWidth = 45
            .Columns(Klarifikacija_korisnika_Col).ColumnWidth = 65
            .Columns(Komentar_PT2_Col).ColumnWidth = 65
            .Columns(Broj_jedinica_Col).ColumnWidth = 11.43
            .Columns(Jedinicna_cijena_Col).ColumnWidth = 11.43
            .Columns(PT2_prilagodjen_broj_jedinica_Col).ColumnWidth = 11.43
            .Columns(PT2_prilagodjena_jedinicna_cijena_Col).ColumnWidth = 11.43
            ' kraj promjene 12.04.2017.
            ' promjena 17.04.2017. - promjena |fffd|irina kolona
            .Columns(Mjesec).ColumnWidth = 7
            .Columns(Godina).ColumnWidth = 7
            .Columns(Broj_ZNS_Col).ColumnWidth = 7
            ' kraj promjene 17.04.2017.
            .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).PasteSpecial Paste:=xlPasteFormats
            .Range(.Cells(MinRw, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).NumberFormat = .Cells(MinRw, Ukupno_neprihvatljivo_Col).NumberFormat
            .Range(.Cells(MinRw, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, PT2_prilagodjen_broj_jedinica_Col)).NumberFormat = "#,##0.0000"
            .Cells.Copy
        End With
        With Sheet81
            .Cells.PasteSpecial Paste:=xlPasteFormats
            .Activate
            .Cells(MinRw, Broj_ZNS_Col).Select
            With .Range(.Cells(MinRw, Broj_ZNS_Col), .Cells(MaxRw, Klarifikacija_korisnika_Col)).Font
                .Bold = False
                .Italic = False
                .Strikethrough = False
                .Subscript = False
                .Superscript = False
                .Underline = xlUnderlineStyleNone
                .Name = "Arial"
                .Size = 10
                .ColorIndex = xlAutomatic
                .TintAndShade = 0
'                .FontStyle = "Regular"
'                .OutlineFont = False
'                .Shadow = False
            End With
            With .Range(.Cells(MinRw, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, Ukupno_neprihvatljivo_Col)).Font
                .Bold = False
                .Italic = False
                .Strikethrough = False
                .Subscript = False
                .Superscript = False
                .Underline = xlUnderlineStyleNone
                .Name = "Arial"
                .Size = 10
'                .ColorIndex = xlAutomatic
                .TintAndShade = 0
'                .FontStyle = "Regular"
'                .OutlineFont = False
'                .Shadow = False
            End With
            With .Range(.Cells(MinRw, Ukupno_neprihvatljivo_Col - 1), .Cells(MaxRw, Ukupno_neprihvatljivo_Col)).Font
                .ColorIndex = xlAutomatic
            End With
            ' promjena 12.04.2017. - promjena |fffd|irina kolona
            .Columns(OIB_dobavljaca_Col).ColumnWidth = 14.57
            .Columns(Vrsta_troska_Col).ColumnWidth = 14.57
            .Columns(Nastanak_troska_Col).ColumnWidth = 30
            .Columns(Oznaka_troska_Col).ColumnWidth = 19.57
            .Columns(Opis_troska_Col).ColumnWidth = 45
            .Columns(Klarifikacija_korisnika_Col).ColumnWidth = 65
            .Columns(Komentar_PT2_Col).ColumnWidth = 65
            .Columns(Broj_jedinica_Col).ColumnWidth = 11.43
            .Columns(Jedinicna_cijena_Col).ColumnWidth = 11.43
            .Columns(PT2_prilagodjen_broj_jedinica_Col).ColumnWidth = 11.43
            .Columns(PT2_prilagodjena_jedinicna_cijena_Col).ColumnWidth = 11.43
            ' kraj promjene 12.04.2017.
            ' promjena 17.04.2017. - promjena |fffd|irina kolona
            .Columns(Mjesec).ColumnWidth = 7
            .Columns(Godina).ColumnWidth = 7
            .Columns(Broj_ZNS_Col).ColumnWidth = 7
            ' kraj promjene 17.04.2017.
        End With
        Application.CutCopyMode = False
        ' promjena 17.04.2017.
        With Sheet81
            Set MyRng = .Range(.Cells(MinRw, Broj_troska_Col), .Cells(MaxRw, Broj_troska_Col))
            MyRng.FormulaR1C1 = "=IF(RC[13]="""","""",IF(ROW(R[-1]C)=11,1,R[-1]C+1))"
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
        End With
        ' kraj promjene 17.04.2017.
        If ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Visible = False Then
            Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                        Scenarios:=True, AllowFiltering:=True
        Else
            Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                        Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
        End If
    Else
        ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Caption = "Zaklju|fffd|aj"
        Application.ScreenUpdating = False
        Sheet81.Columns(colStr).Hidden = False
        ' promjena 12.04.2017.
        Sheet81.Columns(Broj_troska_Col).Hidden = False
        ' kraj promjene 12.04.2017.
        With Sheet81
            With .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .ThemeColor = xlThemeColorAccent1
                .TintAndShade = 0.799981688894314
                .PatternTintAndShade = 0
            End With
            .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).Copy
        End With
        With Sheet2
            .Range(.Cells(MinRw, Komentar_PT2_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).PasteSpecial Paste:=xlPasteFormats
            .Range(.Cells(MinRw, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).NumberFormat = .Cells(MinRw, Ukupno_neprihvatljivo_Col).NumberFormat
            .Cells.Copy
        End With
        With Sheet81
            .Cells.PasteSpecial Paste:=xlPasteFormats
            .Activate
            .Cells(MinRw, Broj_ZNS_Col).Select
            With .Range(.Cells(MinRw, Broj_ZNS_Col), .Cells(MaxRw, Klarifikacija_korisnika_Col)).Font
                .Bold = False
                .Italic = False
                .Strikethrough = False
                .Subscript = False
                .Superscript = False
                .Underline = xlUnderlineStyleNone
                .Name = "Arial"
                .Size = 10
                .ColorIndex = xlAutomatic
                .TintAndShade = 0
'                .FontStyle = "Regular"
'                .OutlineFont = False
'                .Shadow = False
            End With
            With .Range(.Cells(MinRw, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, Ukupno_neprihvatljivo_Col)).Font
                .Bold = False
                .Italic = False
                .Strikethrough = False
                .Subscript = False
                .Superscript = False
                .Underline = xlUnderlineStyleNone
                .Name = "Arial"
                .Size = 10
'                .ColorIndex = xlAutomatic
                .TintAndShade = 0
'                .FontStyle = "Regular"
'                .OutlineFont = False
'                .Shadow = False
            End With
            With .Range(.Cells(MinRw, Ukupno_neprihvatljivo_Col - 1), .Cells(MaxRw, Ukupno_neprihvatljivo_Col)).Font
                .ColorIndex = xlAutomatic
            End With
        End With
        Application.CutCopyMode = False
        ' promjena 17.04.2017.
        With Sheet81
            Set MyRng = .Range(.Cells(MinRw, Broj_troska_Col), .Cells(MaxRw, Broj_troska_Col))
            MyRng.FormulaR1C1 = "=IF(RC[13]="""","""",IF(ROW(R[-1]C)=11,1,R[-1]C+1))"
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
            .Columns(PT2_prilagodjena_oznaka_Col).Delete
        End With
        ' kraj promjene 17.04.2017.
        Application.Run "Sheet81.ZakljucajOtkljucaj_Click"
    End If
    ' promjena 12.04.2017.
    Set MyRng = Nothing
    ' kraj promjene 12.04.2017.
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    Application.CommandBars("Ply").Enabled = True
End Sub

Private Sub Workbook_AfterSave(ByVal Success As Boolean)
    Application.ScreenUpdating = False
    If Success = True And bBackuped = False Then
        Application.Run "Module1.IzradiBackup"
        bBackuped = True
        ThisWorkbook.Save
    Else
        bBackuped = False
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
    Const MinRw As Long = 12
    Const MaxRw As Long = 2000
    Const Oznaka_troska_Col As Integer = 10
    Dim MyRng As Range
    Dim Naslov As String
    Application.ScreenUpdating = False
    Application.Run "Module1.SakrijRadneListove"
    If Prekid = True Then
        Cancel = True
    Else
        Cancel = False
    End If
    Application.ScreenUpdating = True
    If Cancel = False Then
        On Error Resume Next
        With Sheet81
            .Activate
            Set MyRng = .Range(.Cells(MinRw, Oznaka_troska_Col), .Cells(MaxRw, Oznaka_troska_Col))
            Err.Clear
            Set MyRng = MyRng.Find(What:="Izravni tro|fffd|ak osoblja", LookIn:=xlValues, Lookat:=xlPart)
            If MyRng Is Nothing Or Err.Number <> 0 Then
            Else
                Set MyRng = .Range(.Cells(MinRw, Oznaka_troska_Col), .Cells(MaxRw, Oznaka_troska_Col))
                Err.Clear
                Set MyRng = MyRng.Find(What:="Indirektni tro|fffd|ak", LookIn:=xlValues, Lookat:=xlWhole)
                If MyRng Is Nothing Or Err.Number <> 0 Then
                    Naslov = "Upozorenje!"
                    MsgBox prompt:="Izvje|fffd|taj sadr|fffd|i izravne tro|fffd|kove osoblja, ali ne sadr|fffd|i indirektne tro|fffd|kove. " & _
                    "Imate pravo potra|fffd|ivati indirektne tro|fffd|kove u iznosu od 15% potra|fffd|ivanih izravnih tro|fffd|kova osoblja.", _
                        Title:=Naslov, Buttons:=vbExclamation
                End If
            End If
        End With
    End If
    Err.Clear
    On Error GoTo 0
    Set MyRng = Nothing
End Sub

Private Sub Workbook_Open()
    bActivated = False
End Sub




Private Sub Validacija()
    ' pazi - kod kori|fffd|tenja vrijednosti iz radnog lista "List" ne koristim konstante niti varijable
    ' u slu|fffd|aju promjena adresa u radnom listu "List" pretra|fffd|uj "List" i ru|fffd|no mijenjaj
    
    Const Broj_jedinica_Col As Integer = 13
    Const Jedinicna_cijena_Col As Integer = 14
    Const PT2_prilagodjen_broj_jedinica_Col As Integer = 21
    Const PT2_prilagodjena_jedinicna_cijena_Col As Integer = 22
    ' promjena 17.04.2017.
    Const OIB_dobavljaca_Col As Integer = 6
    Const Mjesec = 11
    Const Godina = 12
    ' kraj promjene 17.04.2017.
    ' promjena 18.04.2017.
    Const Naziv_dobavljaca_Col As Integer = 5
    Const Opis_troska_Col As Integer = 8
    Const Popratni_dokumenti_nastanka_Col As Integer = 16
    Const Popratni_dokumenti_placanja_Col As Integer = 17
    Const Klarifikacija_korisnika_Col As Integer = 18
    ' kraj promjene 18.04.2017.
    
    Dim MyStr As String
    Dim MyStr1 As String
    Dim MinRw As Long
    Dim MaxRw As Long
    Dim Broj_troska_Col As Integer
    Dim Element_projekta_Col As Integer
    Dim Stavka_troska_Col As Integer
    Dim Vrsta_troska_Col As Integer
    Dim Nastanak_troska_Col As Integer
    Dim Oznaka_troska_Col As Integer
    Const PT2_prilagodjena_oznaka_Col As Integer = 20
    
    On Error GoTo ErrHandler
    
    MinRw = 12
    ' promjena 12.04.2017. - smanjen broj redaka s 10000 na 2000 zbog smanjenja veli|fffd|ine i ubrzavanja tablice
    MaxRw = 2000
    ' kraj promjene 12.04.2017.
    Broj_troska_Col = 2
    Element_projekta_Col = 3
    Stavka_troska_Col = 4
    Vrsta_troska_Col = 7
    Nastanak_troska_Col = 9
    Oznaka_troska_Col = 10
    
    Sheet81.Unprotect Password:="odatorticaaaa983"
    
    MyStr = "=List!$A$2:$A$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("M1").Value + 1)
    MyStr = MyStr & MyStr1
    
    ' promjena 12.04.2017.
'    With Sheet81
'        With .Range(.Cells(MinRw, Broj_troska_Col), .Cells(MaxRw, Broj_troska_Col)).Validation
'            .Delete
'            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
'            xlBetween, Formula1:=MyStr
'            .IgnoreBlank = True
'            .InCellDropdown = True
'            .InputTitle = ""
'            .ErrorTitle = "Gre|fffd|ka!"
'            .InputMessage = ""
'            .ErrorMessage = "Potrebno je odabrati broj iz padaju|fffd|eg izbornika."
'            .ShowInput = False
'            .ShowError = True
'        End With
'    End With
    ' kraj promjene 12.04.2017.
    
    
    With Sheet81
        .Range(.Cells(MinRw, Naziv_dobavljaca_Col), .Cells(MaxRw, Naziv_dobavljaca_Col)).Validation.Delete
        .Range(.Cells(MinRw, Opis_troska_Col), .Cells(MaxRw, Opis_troska_Col)).Validation.Delete
        .Range(.Cells(MinRw, Popratni_dokumenti_nastanka_Col), .Cells(MaxRw, Popratni_dokumenti_nastanka_Col)).Validation.Delete
        .Range(.Cells(MinRw, Popratni_dokumenti_placanja_Col), .Cells(MaxRw, Popratni_dokumenti_placanja_Col)).Validation.Delete
        .Range(.Cells(MinRw, Klarifikacija_korisnika_Col), .Cells(MaxRw, Klarifikacija_korisnika_Col)).Validation.Delete
    End With
    
    
    MyStr = "=List!$B$2:$B$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("N1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, Element_projekta_Col), .Cells(MaxRw, Element_projekta_Col)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati element projekta iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    
    
    MyStr = "=List!$C$2:$C$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("O1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, Stavka_troska_Col), .Cells(MaxRw, Stavka_troska_Col)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati stavku tro|fffd|ka iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    
    
    MyStr = "=List!$S$2:$S$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("W1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, Vrsta_troska_Col), .Cells(MaxRw, Vrsta_troska_Col)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati vrstu tro|fffd|ka iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    
    
    MyStr = "=List!$T$2:$T$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("X1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, Nastanak_troska_Col), .Cells(MaxRw, Nastanak_troska_Col)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati vrijednost iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    
    
    MyStr = "=List!$U$2:$U$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("Y1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, Oznaka_troska_Col), .Cells(MaxRw, Oznaka_troska_Col)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati oznaku tro|fffd|ka iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    
    
    MyStr = "=List!$U$2:$U$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("Y1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, PT2_prilagodjena_oznaka_Col), .Cells(MaxRw, PT2_prilagodjena_oznaka_Col)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati oznaku tro|fffd|ka iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    
    
    ' validacija za kolonu "Broj jedinica"
    With Sheet81
        With .Range(.Cells(MinRw, Broj_jedinica_Col), .Cells(MaxRw, Broj_jedinica_Col)).Validation
            .Delete
            .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, Operator _
            :=xlGreaterEqual, Formula1:="0"
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = "Unos mora biti broj jednak ili ve|fffd|i od 0."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    ' kraj validacije za kolonu "Broj jedinica"
    
    ' validacija za kolonu "Jedini|fffd|na cijena HRK"
    With Sheet81
        With .Range(.Cells(MinRw, Jedinicna_cijena_Col), .Cells(MaxRw, Jedinicna_cijena_Col)).Validation
            .Delete
            .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, Operator _
            :=xlGreaterEqual, Formula1:="0"
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = "Unos mora biti broj jednak ili ve|fffd|i od 0."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    ' kraj validacije za kolonu "Jedini|fffd|na cijena HRK"
    
    ' validacija za kolonu "PT2 prilago|fffd|en broj jedinica"
    With Sheet81
        With .Range(.Cells(MinRw, PT2_prilagodjen_broj_jedinica_Col), .Cells(MaxRw, PT2_prilagodjen_broj_jedinica_Col)).Validation
            .Delete
            .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, Operator _
            :=xlGreaterEqual, Formula1:="0"
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = "Unos mora biti broj jednak ili ve|fffd|i od 0."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    ' kraj validacije za kolonu "PT2 prilago|fffd|en broj jedinica"
    
    ' validacija za kolonu "PT2 prilago|fffd|ena jedini|fffd|na cijena"
    With Sheet81
        With .Range(.Cells(MinRw, PT2_prilagodjena_jedinicna_cijena_Col), .Cells(MaxRw, PT2_prilagodjena_jedinicna_cijena_Col)).Validation
            .Delete
            .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, Operator _
            :=xlGreaterEqual, Formula1:="0"
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = "Unos mora biti broj jednak ili ve|fffd|i od 0."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    ' kraj validacije za kolonu "PT2 prilago|fffd|ena jedini|fffd|na cijena"
    
    ' promjena 17.04.2017.
    ' validacija za kolonu "OIB dobavlja|fffd|a"
    ' za sada comment-out jer |fffd|e korisnici unositi i VAT brojeve koji ne moraju imati 11 znamenaka
    With Sheet81
        With .Range(.Cells(MinRw, OIB_dobavljaca_Col), .Cells(MaxRw, OIB_dobavljaca_Col)).Validation
            .Delete
'            .Add Type:=xlValidateTextLength, AlertStyle:=xlValidAlertStop, _
'            Operator:=xlEqual, Formula1:="11"
'            .IgnoreBlank = True
'            .InCellDropdown = True
'            .InputTitle = ""
'            .ErrorTitle = "Gre|fffd|ka!"
'            .InputMessage = ""
'            .ErrorMessage = "OIB mora imati 11 znamenaka."
'            .ShowInput = False
'            .ShowError = True
        End With
    End With
    ' kraj validacije za kolonu "OIB dobavlja|fffd|a"
    
    ' validacija za kolonu "Mjesec"
    MyStr = "=List!$AC$2:$AC$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("AF1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, Mjesec), .Cells(MaxRw, Mjesec)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati vrijednost iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    ' kraj validacije za kolonu "Mjesec"
    
    ' validacija za kolonu "Godina"
    MyStr = "=List!$AD$2:$AD$"
    MyStr1 = CStr(ThisWorkbook.Sheets("List").Range("AG1").Value + 1)
    MyStr = MyStr & MyStr1
    
    With Sheet81
        With .Range(.Cells(MinRw, Godina), .Cells(MaxRw, Godina)).Validation
            .Delete
            .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
            xlBetween, Formula1:=MyStr
            .IgnoreBlank = True
            .InCellDropdown = True
            .InputTitle = ""
            .ErrorTitle = "Gre|fffd|ka!"
            .InputMessage = ""
            .ErrorMessage = _
            "Potrebno je odabrati vrijednost iz padaju|fffd|eg izbornika."
            .ShowInput = False
            .ShowError = True
        End With
    End With
    ' kraj validacije za kolonu "Godina"
    ' kraj promjene 17.04.2017.
    
    
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    If ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    Else
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
    End If
    
'    Application.ScreenUpdating = True
    Application.CommandBars("Ply").Enabled = True
    
    Exit Sub
    
ErrHandler:
    On Error GoTo 0
    
'    Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                Scenarios:=True, AllowInsertingHyperlinks:=True, AllowFiltering:=True
    If ThisWorkbook.Sheets("Tro|fffd|kovi").ZakljucajOtkljucaj.Caption = "Otklju|fffd|aj" Then
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True
    Else
        Sheet81.Protect Password:="odatorticaaaa983", DrawingObjects:=True, Contents:=True, _
                    Scenarios:=True, AllowFiltering:=True, AllowFormattingCells:=True
    End If
    
'    Application.ScreenUpdating = True
    Application.CommandBars("Ply").Enabled = True
    
End Sub


INQUEST-PP=macro
