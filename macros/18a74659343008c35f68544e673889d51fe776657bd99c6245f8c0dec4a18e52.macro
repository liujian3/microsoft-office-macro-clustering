Attribute VB_Name = "HideTitleBar"
Option Explicit
Option Private Module

Public Const GWL_STYLE = -16
Public Const WS_CAPTION = &HC00000
#If VBA7 Then
    Public Declare PtrSafe Function GetWindowLong _
                           Lib "user32" Alias "GetWindowLongA" ( _
                           ByVal hWnd As Long, _
                           ByVal nIndex As Long) As Long
                           
    Public Declare PtrSafe Function SetWindowLong _
                           Lib "user32" Alias "SetWindowLongA" ( _
                           ByVal hWnd As Long, _
                           ByVal nIndex As Long, _
                           ByVal dwNewLong As Long) As Long
    Public Declare PtrSafe Function DrawMenuBar _
                           Lib "user32" ( _
                           ByVal hWnd As Long) As Long
    Public Declare PtrSafe Function FindWindowA _
                           Lib "user32" (ByVal lpClassName As String, _
                           ByVal lpWindowName As String) As Long
#Else
    Public Declare Function GetWindowLong _
                           Lib "user32" Alias "GetWindowLongA" ( _
                           ByVal hWnd As Long, _
                           ByVal nIndex As Long) As Long
    Public Declare Function SetWindowLong _
                           Lib "user32" Alias "SetWindowLongA" ( _
                           ByVal hWnd As Long, _
                           ByVal nIndex As Long, _
                           ByVal dwNewLong As Long) As Long
    Public Declare Function DrawMenuBar _
                           Lib "user32" ( _
                           ByVal hWnd As Long) As Long
    Public Declare Function FindWindowA _
                           Lib "user32" (ByVal lpClassName As String, _
                           ByVal lpWindowName As String) As Long
#End If
Sub HideTitleBar(frm As Object)
    Dim lngWindow As Long
    Dim lFrmHdl As Long
    lFrmHdl = FindWindowA(vbNullString, frm.Caption)
    lngWindow = GetWindowLong(lFrmHdl, GWL_STYLE)
    lngWindow = lngWindow And (Not WS_CAPTION)
    Call SetWindowLong(lFrmHdl, GWL_STYLE, lngWindow)
    Call DrawMenuBar(lFrmHdl)
End Sub
'PLACE IN YOUR USERFORM CODE
Private Sub UserForm_Initialize()
#If IsMac = False Then
    'hide the title bar if you're working on a windows machine. Otherwise, just display it as you normally would
    Me.Height = Me.Height - 10
    HideTitleBar.HideTitleBar Me
#End If
End Sub

Attribute VB_Name = "Module1"
Public bCancel, bstop As Boolean
Public nMaxRows, nMaxGames, nSimWeek, nTotalTeam, nTotalSimGames, nClubs As Integer
Public TimeZone As String
Sub ModelLeague_w_Prediction()
Dim bLogo, bPredict As Boolean
Dim shtTable As String

    bLogo = True
    bPredict = True
    nMaxRows = 564
    nMaxGames = 38
'    shtTable = "TableNG"
    shtTable = "Table"
    nClubs = 20
    
    Call ModelLeague(bLogo, bPredict, nMaxRows, shtTable)
    'Call Filter_Team_Manual(bLogo)
    
End Sub
Sub ModelLeague_no_Prediction()

Dim bLogo, bPredict As Boolean
Dim shtTable As String

    bLogo = False
    bPredict = False
    nMaxRows = 564
    nMaxGames = 38
'    shtTable = "TableNG"
    shtTable = "Table"
    nClubs = 20
    
    Call ModelLeague(bLogo, bPredict, nMaxRows, shtTable)
    'Call Filter_Team_Manual(bLogo)
    
End Sub
Sub Run_MC()

Dim bLogo As Boolean

    bLogo = True
    Call ModelLeague_MC(bLogo)
    'Call Filter_Team_Manual(bLogo)
    
End Sub

Sub UpdateSPI()
    Dim shtSPI, shtSPISource As String
    Dim shtFixture As String
    Dim nWk As Integer
    Dim Team, team_temp As String
    Dim spi_off, spi_def, spi As Double
    Dim dt1, dt2 As Date
    
    shtFixture = "fixtures"
    shtSPI = "SPI"
    shtSPISource = "spi_global_rankings"
    
    Sheets(shtSPI).Unprotect ("pineapple")
    
    Sheets(shtSPISource).Select
    Cells.Select

    Selection.ClearContents

    If ActiveSheet.QueryTables.Count > 0 Then
        ActiveSheet.QueryTables(1).Delete
    End If

    ActiveWorkbook.Queries.Add Name:="spi_global_rankings", Formula:= _
        "let" & Chr(13) & "" & Chr(10) & "    Source = Csv.Document(Web.Contents(""https://projects.fivethirtyeight.com/soccer-api/club/spi_global_rankings.csv""),[Delimiter="","", Columns=7, Encoding=1252, QuoteStyle=QuoteStyle.None])," & Chr(13) & "" & Chr(10) & "    #""Promoted Headers"" = Table.PromoteHeaders(Source, [PromoteAllScalars=true])," & Chr(13) & "" & Chr(10) & "    #""Changed Type"" = Table.TransformColumnTypes(#""Promoted Headers"",{{""rank" & _
        """, Int64.Type}, {""prev_rank"", Int64.Type}, {""name"", type text}, {""league"", type text}, {""off"", type number}, {""def"", type number}, {""spi"", type number}})" & Chr(13) & "" & Chr(10) & "in" & Chr(13) & "" & Chr(10) & "    #""Changed Type"""
    With ActiveSheet.ListObjects.Add(SourceType:=0, Source:= _
        "OLEDB;Provider=Microsoft.Mashup.OleDb.1;Data Source=$Workbook$;Location=""spi_global_rankings"";Extended Properties=""""" _
        , Destination:=Range("spi_global_rankings!$A$1")).QueryTable
        .CommandType = xlCmdSql
        .CommandText = Array("SELECT * FROM [spi_global_rankings]")
        .RowNumbers = False
        .FillAdjacentFormulas = False
        .PreserveFormatting = True
        .RefreshOnFileOpen = False
        .BackgroundQuery = True
        .RefreshStyle = xlInsertDeleteCells
        .SavePassword = False
        .SaveData = True
        .AdjustColumnWidth = True
        .RefreshPeriod = 0
        .PreserveColumnInfo = True
        .ListObject.DisplayName = "spi_global_rankings"
        .Refresh BackgroundQuery:=False
    End With
    
    Sheets(shtSPISource).Cells(1, 9) = Now()
    
    Sheets(shtSPI).Select
    
    dt1 = Date
    nWk = 38
    
    For I = 1 To 380
        dt2 = Sheets(shtFixture).Cells(I + 1, 2)
        If dt1 <= dt2 Then
            nWk = Sheets(shtFixture).Cells(I + 1, 1)
            Exit For
        End If
    Next I
    For I = 1 To 20
        j = 1
        Team = Sheets(shtSPI).Cells(I + 1, 9)
        team_temp = Sheets(shtSPISource).Cells(j + 1, 3)
        Do While Team <> team_temp
            j = j + 1
            team_temp = Sheets(shtSPISource).Cells(j + 1, 3)
            If j >= 999 Then
            Sheets(shtSPI).Cells(I + 1, 8) = "Not found"
            Exit Do
            End If
        Loop
        spi_off = Sheets(shtSPISource).Cells(j + 1, 5)
        spi_def = Sheets(shtSPISource).Cells(j + 1, 6)
        spi = Sheets(shtSPISource).Cells(j + 1, 7)
        Sheets(shtSPI).Cells(I + 1, 6) = spi_off
        Sheets(shtSPI).Cells(I + 1, 7) = spi_def
        Sheets(shtSPI).Cells(I + 1, 8) = spi
    Next I
    Sheets(shtSPI).Cells(22, 7) = nWk
    
    ActiveWorkbook.Queries("spi_global_rankings").Delete
    ActiveWorkbook.Connections("Connection").Delete
    'Application.CommandBars("Queries and Connections").Visible = False

    Sheets(shtSPI).Protect ("pineapple")
    
End Sub
Sub UpdateTableNG(shtTableNew, shtTable, Rank, ni, nj)

Dim strRange1 As String

'Sheets(shtTableNew).Select


'    For Each pic In ActiveSheet.Pictures
'        bDelete = True
'        For I = 1 To 20
'            If pic.Name = Cells(I + 1, 45) Then
'                bDelete = False
'                Exit For
'            End If
'        Next I
'        If bDelete Then pic.Delete
'    Next pic
'


For m = 1 To 20
    k = 0
    For n = 1 To 11
    If (n > 2) Then k = 1
    Sheets(shtTableNew).Cells(m + 1, n + k) = Sheets(shtTable).Cells(ni + Rank(m), nj - 2 + n)

    If n = 11 Then
        For j = 1 To 5
            Sheets(shtTableNew).Cells(m + 1, n + j) = Sheets(shtTable).Cells(ni + Rank(m), nj - 2 + n + j)
        Next j
    End If
    Next n
    
    'strrange2 = "C" & (m + 1)
    
    'ThisWorkbook.Sheets(shtDashboard).Activate
    
    'Sheets("Dashboard").Select
    'Range("A2").Select
    'Selection.Copy
    'Range("A34").Select
    'ActiveSheet.Paste
    'Sheets("Table").Select
    'Range("C21").Select
    'ActiveSheet.Paste
    
    'Sheets(shtTableNew).Select
    'For p = 1 To 20
    '    If Cells(m + 1, 2) = Cells(p + 1, 43) Then
    '        strrange1 = Cells(p + 1, 45)
    '        Exit For
    '    End If
    'strRange1 = "A" & (p + 1)

    'Sheets(shtDashboard).Select
    'Range(strRange1).Select
    'Selection.Copy
    'Sheets(shtTableNew).Select
    'Range(strRange2).Select
    'ActiveSheet.Paste
    'Exit For
    'End If
    
    'Next p
    

    'ActiveSheet.Shapes.Range(Array(strrange1)).Select
    'Selection.Copy
    'strrange2 = "C" & m + 1
    'Range(strrange2).Select
    'ActiveSheet.Paste

    'Selection.ShapeRange.Height = 20
    'Selection.ShapeRange.IncrementLeft (Columns("C").width - Selection.ShapeRange.width) / 2
    'Selection.ShapeRange.IncrementTop (Range(strrange2).Height - Selection.ShapeRange.Height) / 2
    
    'PicFileName = PicPath & Sheets(shtTable).Cells(ni + Rank(m), nj) & ".png"
    'TempFile = Dir(PicFileName)
    'If Len(TempFile) = 0 Then
        'PicFileName = PicPath & "Chelsea.png"
    'End If

    'With ActiveSheet.Pictures.Insert(PicFileName)
        'With .ShapeRange
        '.LockAspectRatio = msoTrue
        ''.Width = 7.5
        '.Height = 24
        'End With

        '.Left = ActiveSheet.Cells(m + 1, 3).Left + (ActiveSheet.Cells(m + 1, 3).Width - .Width) / 2
        '.Top = ActiveSheet.Cells(m + 1, 3).Top + (ActiveSheet.Cells(m + 1, 3).Height - .Height) / 2
        '.Placement = 1
        '.PrintObject = True
    'End With
    
    'If Not (Sheets(shtTable).Cells(ni + rank(m), nj + 15) = "") Then
    
    'Sheets(shtTableNew).Select
    'strrange2 = "Q" & (m + 1)
    
    'For p = 1 To 20
    '    If Sheets(shtTable).Cells(ni + rank(m), nj + 15) = Cells(p + 1, 43) Then
    '        strrange1 = Cells(p + 1, 45)
    '        Exit For
    '    End If
            
            
    'strrange1 = "A" & (p + 1)

    'Sheets(shtDashboard).Select
    'Range(strrange1).Select
    'Selection.Copy
    'Sheets(shtTableNew).Select
    'Range(strrange2).Select
    'ActiveSheet.Paste
    'Exit For

    'End If
    'Next p
    

    'ActiveSheet.Shapes.Range(Array(strrange1)).Select
    'Selection.Copy
    'strrange2 = "Q" & m + 1
    'Range(strrange2).Select
    'ActiveSheet.Paste

    'Selection.ShapeRange.Height = 20
    'Selection.ShapeRange.IncrementLeft (Columns("Q").width - Selection.ShapeRange.width) / 2
    'Selection.ShapeRange.IncrementTop (Range(strrange2).Height - Selection.ShapeRange.Height) / 2

    
    'PicFileName = PicPath & Sheets(shtTable).Cells(ni + Rank(m), nj + 15) & ".png"
    'TempFile = Dir(PicFileName)
    'If Len(TempFile) = 0 Then
        'PicFileName = PicPath & "Chelsea.png"
    'End If

    'With ActiveSheet.Pictures.Insert(PicFileName)
        'With .ShapeRange
        '.LockAspectRatio = msoTrue
        ''.Width = 7.5
        '.Height = 24
        'End With

        '.Left = ActiveSheet.Cells(m + 1, 17).Left + (ActiveSheet.Cells(m + 1, 17).Width - .Width) / 2
        '.Top = ActiveSheet.Cells(m + 1, 17).Top + (ActiveSheet.Cells(m + 1, 17).Height - .Height) / 2
        '.Placement = 1
        '.PrintObject = True
    'End With
    'End If
    
    strRange1 = ""
    If Not (Sheets(shtTable).Cells(ni + Rank(m), nj + 15) = "") Then
    
        For p = 1 To 20
            If Sheets(shtTable).Cells(ni + Rank(m), nj + 15) = Sheets(shtTable).Cells(ni + p, nj) Then
                strRange1 = Sheets(shtTable).Cells(ni + p, nj - 2)
                Exit For
            End If
        Next p
        
        Sheets(shtTableNew).Cells(m + 1, 17) = strRange1
        
    Else
        Sheets(shtTableNew).Cells(m + 1, 17) = ""
    End If
    
    
    Sheets(shtTableNew).Cells(m + 1, 18) = Sheets(shtTable).Cells(ni + Rank(m), nj + 16)
    
Next m

End Sub
Sub UpdateTable(shtTableNew, shtTable, Rank, ni, nj, PlayOffWinner)
Dim strRange1, strRange2 As String
Dim bDelect As Boolean
Dim pic As Object
Dim shtDashboard As String

shtDashboard = "Dashboard"



Sheets(shtTableNew).Select

'    For Each pic In ActiveSheet.Pictures
'        bDelete = True
'        For I = 1 To nClubs
'            If pic.Name = Cells(I + 1, 45) Then
'                bDelete = False
'                Exit For
'            End If
'        Next I
'        If bDelete Then pic.Delete
'    Next pic

    For Each pic In ActiveSheet.Pictures
        pic.Delete
    Next pic
    


For m = 1 To nClubs
    k = 0
    For n = 1 To 11
    If (n > 2) Then k = 1
    Sheets(shtTableNew).Cells(m + 1, n + k) = Sheets(shtTable).Cells(ni + Rank(m), nj - 2 + n)

    If n = 11 Then
        For j = 1 To 5
            Sheets(shtTableNew).Cells(m + 1, n + j) = Sheets(shtTable).Cells(ni + Rank(m), nj - 2 + n + j)
        Next j
    End If
    Next n
    
'    strRange2 = "C" & (m + 1)
    
    'ThisWorkbook.Sheets(shtDashboard).Activate
    
    'Sheets("Dashboard").Select
    'Range("A2").Select
    'Selection.Copy
    'Range("A34").Select
    'ActiveSheet.Paste
    'Sheets("Table").Select
    'Range("C21").Select
    'ActiveSheet.Paste
    
    'Sheets(shtTableNew).Select
    For p = 1 To nClubs
        tmpName = Sheets(shtDashboard).Cells(p + 1, 2)
        If Cells(m + 1, 2) = tmpName Then
            strRange1 = Sheets(shtDashboard).Cells(p + 1, 4)
            Exit For
        End If
    'strRange1 = "A" & (p + 1)

    'Sheets(shtDashboard).Select
    'Range(strRange1).Select
    'Selection.Copy
    'Sheets(shtTableNew).Select
    'Range(strRange2).Select
    'ActiveSheet.Paste
    'Exit For
    'End If
    
    Next p
    
    Sheets(shtDashboard).Select
    ActiveSheet.Shapes.Range(Array(strRange1)).Select
    
    On Error Resume Next
    
    Selection.CopyPicture
    
    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        Selection.CopyPicture
'        nTmp = Cells(2, 41)
'        Cells(nTmp, nColTeam) = Team
'        Cells(nTmp, nColTeam + 1) = nTrgRow
'        Cells(2, 41) = nTmp + 1
    End If
    On Error GoTo 0
    
    Sheets(shtTableNew).Select
    strRange2 = "C" & m + 1
    Range(strRange2).Select
    
    On Error Resume Next
    
    ActiveSheet.Paste
    Selection.Placement = xlMoveAndSize

    Selection.ShapeRange.Height = 20
    Selection.ShapeRange.IncrementLeft (Columns("C").Width - Selection.ShapeRange.Width) / 2
    Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2

    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        ActiveSheet.Paste
        Selection.Placement = xlMoveAndSize

        Selection.ShapeRange.Height = 20
        Selection.ShapeRange.IncrementLeft (Columns("C").Width - Selection.ShapeRange.Width) / 2
        Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
    
    End If
    On Error GoTo 0
    
'    PicFileName = PicPath & Sheets(shtTable).Cells(ni + Rank(m), nj) & ".png"
'    TempFile = Dir(PicFileName)
'    If Len(TempFile) = 0 Then
'        PicFileName = PicPath & "Chelsea.png"
'    End If
'
'    With ActiveSheet.Pictures.Insert(PicFileName)
'        With .ShapeRange
'        .LockAspectRatio = msoTrue
'        '.Width = 7.5
'        .Height = 24
'        End With
'
'        .Left = ActiveSheet.Cells(m + 1, 3).Left + (ActiveSheet.Cells(m + 1, 3).Width - .Width) / 2
'        .Top = ActiveSheet.Cells(m + 1, 3).Top + (ActiveSheet.Cells(m + 1, 3).Height - .Height) / 2
'        .Placement = 1
'        .PrintObject = True
'    End With
    
    If Not (Sheets(shtTable).Cells(ni + Rank(m), nj + 15) = "") Then
    
    Sheets(shtTableNew).Select
    strRange2 = "Q" & (m + 1)
    
    For p = 1 To nClubs
        tmpName = Sheets(shtDashboard).Cells(p + 1, 2)
        If Sheets(shtTable).Cells(ni + Rank(m), nj + 15) = tmpName Then
            strRange1 = Sheets(shtDashboard).Cells(p + 1, 4)
            Exit For
        End If
            
            
    'strrange1 = "A" & (p + 1)

    'Sheets(shtDashboard).Select
    'Range(strrange1).Select
    'Selection.Copy
    'Sheets(shtTableNew).Select
    'Range(strrange2).Select
    'ActiveSheet.Paste
    'Exit For

    'End If
    Next p
    
    Sheets(shtDashboard).Select
    ActiveSheet.Shapes.Range(Array(strRange1)).Select
    
    On Error Resume Next
    
    Selection.CopyPicture
    
    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        Selection.CopyPicture
'        nTmp = Cells(2, 41)
'        Cells(nTmp, nColTeam) = Team
'        Cells(nTmp, nColTeam + 1) = nTrgRow
'        Cells(2, 41) = nTmp + 1
    End If
    On Error GoTo 0
    
    
    Sheets(shtTableNew).Select
    strRange2 = "Q" & m + 1
    Range(strRange2).Select
    
    On Error Resume Next
    
    ActiveSheet.Paste
    Selection.Placement = xlMoveAndSize

    Selection.ShapeRange.Height = 20
    Selection.ShapeRange.IncrementLeft (Columns("Q").Width - Selection.ShapeRange.Width) / 2
    Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
    
    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        ActiveSheet.Paste
        Selection.Placement = xlMoveAndSize
    
        Selection.ShapeRange.Height = 20
        Selection.ShapeRange.IncrementLeft (Columns("Q").Width - Selection.ShapeRange.Width) / 2
        Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
    End If
    On Error GoTo 0
    
'    PicFileName = PicPath & Sheets(shtTable).Cells(ni + Rank(m), nj + 15) & ".png"
'    TempFile = Dir(PicFileName)
'    If Len(TempFile) = 0 Then
'        PicFileName = PicPath & "Chelsea.png"
'    End If
'
'    With ActiveSheet.Pictures.Insert(PicFileName)
'        With .ShapeRange
'        .LockAspectRatio = msoTrue
'        '.Width = 7.5
'        .Height = 24
'        End With
'
'        .Left = ActiveSheet.Cells(m + 1, 17).Left + (ActiveSheet.Cells(m + 1, 17).Width - .Width) / 2
'        .Top = ActiveSheet.Cells(m + 1, 17).Top + (ActiveSheet.Cells(m + 1, 17).Height - .Height) / 2
'        .Placement = 1
'        .PrintObject = True
'    End With
    End If
    
    Sheets(shtTableNew).Cells(m + 1, 18) = Sheets(shtTable).Cells(ni + Rank(m), nj + 16)
    
Next m

'For I = 1 To 2
'    Sheets(shtTableNew).Cells(I + 1, 1).Interior.Color = RGB(198, 224, 180)
'Next I
'
'For I = 3 To 6
'    Sheets(shtTableNew).Cells(I + 1, 1).Interior.Color = RGB(226, 239, 218)
'    If Sheets(shtTableNew).Cells(I + 1, 2) = PlayOffWinner Then
'        Sheets(shtTableNew).Cells(I + 1, 1).Interior.Color = RGB(198, 224, 180)
'    End If
'Next I
      
    
    
End Sub
Sub UpdateHTMLTable(ShtTableHTML, shtTable, Rank, ni, nj)
Dim strRange1, strForm As String
Dim strHTMLWin, strHTMLDraw, strHTMLLoss As String

strHTMLWin = "<img class=""aligncenter size-full wp-image-4338"" src=""http://www.tangfamily.me/wp-content/uploads/2018/09/Win.png"" alt="""" width=""8"" height=""20"" />"
strHTMLDraw = "<img class=""aligncenter size-full wp-image-4339"" src=""http://www.tangfamily.me/wp-content/uploads/2018/09/Draw.png"" alt="""" width=""8"" height=""20"" />"
strHTMLLoss = "<img class=""aligncenter size-full wp-image-4340"" src=""http://www.tangfamily.me/wp-content/uploads/2018/09/Loss.png"" alt="""" width=""8"" height=""20"" />"

Sheets(ShtTableHTML).Select
    

For m = 1 To 20

    For n = 1 To 6
    If n = 1 Then k = 0
    If n = 2 Then k = -3
    If n = 3 Then k = -4
    If n = 4 Then k = 2
    If n = 5 Then k = 9

    Sheets(ShtTableHTML).Cells(m + 1, n) = Sheets(shtTable).Cells(ni + Rank(m), nj - 1 + k)

    If n = 6 Then
        k = 10
        For j = 1 To 5
            strForm = Sheets(shtTable).Cells(ni + Rank(m), nj - 1 + k + j)
            If strForm = "W" Then
                Sheets(ShtTableHTML).Cells(m + 1, n + j) = strHTMLWin
            ElseIf strForm = "D" Then
                Sheets(ShtTableHTML).Cells(m + 1, n + j) = strHTMLDraw
            ElseIf strForm = "L" Then
                Sheets(ShtTableHTML).Cells(m + 1, n + j) = strHTMLLoss
            Else
                Sheets(ShtTableHTML).Cells(m + 1, n + j) = ""
            End If
        Next j
    End If
    Next n
  
    strRange1 = ""
    If Not (Sheets(shtTable).Cells(ni + Rank(m), nj + 15) = "") Then
    
        For p = 1 To 20
            If Sheets(shtTable).Cells(ni + Rank(m), nj + 15) = Sheets(shtTable).Cells(ni + p, nj) Then
                strRange1 = Sheets(shtTable).Cells(p + ni, 4)
                Exit For
            End If
        Next p
        
        Sheets(ShtTableHTML).Cells(m + 1, 12) = strRange1
        
    Else
        Sheets(ShtTableHTML).Cells(m + 1, 12) = ""
    End If
    
    Sheets(ShtTableHTML).Cells(m + 1, 13) = Sheets(shtTable).Cells(ni + Rank(m), nj + 16)
        
Next m
    
End Sub
Sub InsertLogo(shtTarget, shtSource)
Dim strRange1, strRange2 As String
Dim bDelect As Boolean
Dim pic As Object


Sheets(shtTarget).Select

'For Each pic In ActiveSheet.Pictures
'     pic.Delete
'Next pic
    


For m = 1 To 20
   
    For p = 1 To 20
        If Cells(m + 1, 2) = Sheets(shtSource).Cells(p + 1, 2) Then
            strRange1 = Sheets(shtSource).Cells(p + 1, 4)
            Exit For
        End If
    Next p
    
    Sheets(shtSource).Select
    ActiveSheet.Shapes.Range(Array(strRange1)).Select
    'Sheets(shtSource).Shapes.Range(Array(strRange1)).Select
    
    On Error Resume Next
    Selection.CopyPicture
    
    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        Selection.CopyPicture
'        nTmp = Cells(2, 41)
'        Cells(nTmp, nColTeam) = Team
'        Cells(nTmp, nColTeam + 1) = nTrgRow
'        Cells(2, 41) = nTmp + 1
    End If
    On Error GoTo 0
    
    Sheets(shtTarget).Select
    strRange2 = "C" & m + 1
    
    Range(strRange2).Select
    
    On Error Resume Next
    
    ActiveSheet.Paste
    Selection.ShapeRange.Height = 20
    Selection.ShapeRange.IncrementLeft (Columns("C").Width - Selection.ShapeRange.Width) / 2
    Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
    Selection.Placement = xlMoveAndSize
    
    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        ActiveSheet.Paste
        Selection.ShapeRange.Height = 20
        Selection.ShapeRange.IncrementLeft (Columns("C").Width - Selection.ShapeRange.Width) / 2
        Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
        Selection.Placement = xlMoveAndSize
'        Cells(nTrgRow, 14) = "Err"
    End If
    On Error GoTo 0
    
'    ActiveSheet.Paste
'    ActiveSheet.Pictures.Paste(Link:=True).Select

'    Selection.ShapeRange.Height = 20
'    Selection.ShapeRange.IncrementLeft (Columns("C").Width - Selection.ShapeRange.Width) / 2
'    Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
    
   
Next m
    
End Sub
Sub InsertAllLogosFromFile(shtTarget, iColName, iColLogo, iRow, bDeleteAllFirst, PicPath)
Dim Team As String
Dim pic As Object


Sheets(shtTarget).Select

If bDeleteAllFirst Then
    For Each pic In ActiveSheet.Pictures
         pic.Delete
    Next pic
End If
    
For m = iRow To iRow + 19
   Team = Sheets(shtTarget).Cells(m, iColName)
   Call InsertSingleLogoFromFile(shtTarget, m, iColLogo, Team, PicPath)
Next m
    
End Sub
Sub InsertAllLogosByCopy(shtTarget, iColName, iColLogo, iRow, bDeleteAllFirst)
Dim Team As String
Dim pic As Object


Sheets(shtTarget).Select

If bDeleteAllFirst Then
    For Each pic In ActiveSheet.Pictures
         pic.Delete
    Next pic
End If
    
For m = iRow To iRow + 19
   Team = Sheets(shtTarget).Cells(m, iColName)
   Call InsertSingleLogoByCopy(shtTarget, m, iColLogo, Team)
Next m
    
End Sub

Sub InsertSingleLogoFromFile(shtTarget, iRow, iCol, TeamName, PicPath)

Dim PicFileName As String
    Sheets(shtTarget).Select
    
    PicFileName = PicPath & TeamName & ".png"
    TempFile = Dir(PicFileName)
    If Len(TempFile) = 0 Then
        PicFileName = PicPath & "Chelsea.png"
    End If

    With ActiveSheet.Pictures.Insert(PicFileName)
        With .ShapeRange
        .LockAspectRatio = msoTrue
        '.Width = 7.5
        .Height = 24
        End With

        .Left = ActiveSheet.Cells(iRow, iCol).Left + (ActiveSheet.Cells(m + 1, 17).Width - .Width) / 2
        .Top = ActiveSheet.Cells(iRow, iCol).Top + (ActiveSheet.Cells(m + 1, 17).Height - .Height) / 2
        .Placement = 1
        .PrintObject = True
    End With
   
End Sub
Sub InsertSingleLogoByCopy(shtTarget, iRow, iCol, TeamName)

Dim shtDashboard As String
Dim strRange1, strRange2 As String
Dim bDelect As Boolean
Dim a() As String

'Dim pic As Object

shtDashboard = "Dashboard"

Sheets(shtTarget).Select

'For Each pic In ActiveSheet.Pictures
'     pic.Delete
'Next pic
    


For p = 1 To 20
        If TeamName = Sheets(shtDashboard).Cells(p + 1, 2) Then
            strRange1 = Sheets(shtDashboard).Cells(p + 1, 4)
            Exit For
        End If
Next p
    
    Sheets(shtDashboard).Select
    ActiveSheet.Shapes.Range(Array(strRange1)).Select
    'Sheets(ShtTableNew).Shapes.Range(Array(strRange1)).Select
    Selection.Copy
    
    Sheets(shtTarget).Select
    strRange2 = Cells(iRow, iCol).Address
    a = Split(strRange2, "$")
    
    Range(strRange2).Select
    ActiveSheet.Paste

    Selection.ShapeRange.Height = 20
    Selection.ShapeRange.IncrementLeft (Columns(a(1)).Width - Selection.ShapeRange.Width) / 2
    Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
     
End Sub
Sub CalGfGa(spiGF, spiGA, Offhome, Defhome, Offaway, Defaway, homeadvtg, rdhome, rdaway, SRHome, SRAway, Off_ave, Def_ave)
    Dim offhome_adj, defhome_adj, offaway_adj, defaway_adj As Single
        offhome_adj = Offhome + (Defaway - Def_ave)
        defhome_adj = Defhome + (Offaway - Off_ave)
        offaway_adj = Offaway + (Defhome - Def_ave)
        defaway_adj = Defaway + (Offhome - Off_ave)
            spiGF = (offhome_adj + defaway_adj) / 2
            spiGA = (defhome_adj + offaway_adj) / 2
            spiGF = spiGF * homeadvtg - (1 - rdhome / 7)
            spiGA = spiGA - (1 - rdaway / 7)
            spiGF = spiGF * Exp(SRHome / 10)
            spiGA = spiGA * Exp(SRAway / 10)
            'spiGF = spiGF * (1 + SRHome / 20)
            'spiGA = spiGA * (1 + SRAway / 20)
            
End Sub

Function Poisson(Lamda, k)
    Poisson = (Lamda ^ k * Exp(-Lamda)) / Factorial(k)
End Function
Function Factorial(n)
    Dim I As Integer
    
    Factorial = 1
    
    For I = 1 To n
        Factorial = Factorial * I
    Next I
 
End Function
Sub SPIAdjust(spi_off, spi_def, ProjectedGF, ProjectedGA, ActualGF, ActualGA)
    Dim ThreshHold, step, tmpGF, tmpGA As Single
    ThreshHold = 1.7
    step = 0.1
    
    If ActualGF >= 5 Then ActualGF = 5
    If ActualGA >= 5 Then ActualGA = 5
    
    
    tmpGF = ActualGF - ProjectedGF
    tmpGA = ActualGA - ProjectedGA
    
    'spi_off = spi_off + Int((ActualGA - ProjectedGA) / ThreshHold + 0.5) * step
    'spi_def = spi_def + Int((ActualGF - ProjectedGF) / ThreshHold + 0.5) * step
    
    If tmpGF >= 0 Then
    spi_off = spi_off + Int(tmpGF / ThreshHold) * step
    Else
    spi_off = spi_off + Int(tmpGF / ThreshHold + 1) * step
    End If
    
    If tmpGA >= 0 Then
        spi_def = spi_def + Int(tmpGA / ThreshHold) * step
    Else
        spi_def = spi_def + Int(tmpGA / ThreshHold + 1) * step
    End If
    
    If spi_off > 3 Then spi_off = 3
    If spi_off < 0.5 Then spi_off = 0.5
    If spi_def < 0.3 Then spi_def = 0.3
    If spi_def > 2 Then spi_def = 2
    
End Sub
Sub FillCalendarNew(nRowCal, nMaxRow, shtCalendar, shtFixture, HomeTeam, AwayTeam, GF, GA, matchTime, nMatchwk, TimeZone, n, I)
Dim ntmpRowCal As Integer
Dim tmpstring As String
Dim tmpMatchWk As Integer

 For m = nRowCal To nMaxRow
        tmpstring = Sheets(shtCalendar).Cells(m, 8)
        If Left(tmpstring, 4) = "Week" Then
            'Sheets(shtCalendar).Cells(m, 8).HorizontalAlignment = xlRight
            tmpMatchWk = Right(tmpstring, Len(tmpstring) - 5)
            If nMatchwk = tmpMatchWk Then
                Sheets(shtCalendar).Cells(m + 1, 9) = "W %"
                Sheets(shtCalendar).Cells(m + 1, 10) = "D %"
                Sheets(shtCalendar).Cells(m + 1, 11) = "L %"
                Sheets(shtCalendar).Cells(m + 1, 12) = "GF"
                Sheets(shtCalendar).Cells(m + 1, 13) = "GA"
                n = 0
            End If
        End If
        If Sheets(shtCalendar).Cells(m, 2) = HomeTeam And Sheets(shtCalendar).Cells(m, 8) = AwayTeam Then
                ntmpRowCal = m
                If GA >= 0 Then
                    Sheets(shtCalendar).Cells(m, 4) = GF
                    Sheets(shtCalendar).Cells(m, 6) = GA
                    Sheets(shtCalendar).Cells(m, 5) = ":"
                    Sheets(shtCalendar).Cells(m, 1) = matchTime
                    Sheets(shtCalendar).Cells(m, 9) = Sheets(shtFixture).Cells(I + 1, 22)
                    Sheets(shtCalendar).Cells(m, 10) = Sheets(shtFixture).Cells(I + 1, 23)
                    Sheets(shtCalendar).Cells(m, 11) = Sheets(shtFixture).Cells(I + 1, 24)
                    Sheets(shtCalendar).Cells(m, 12) = Sheets(shtFixture).Cells(I + 1, 20)
                    Sheets(shtCalendar).Cells(m, 13) = Sheets(shtFixture).Cells(I + 1, 21)
                    n = n + 1
                Else
                    Sheets(shtCalendar).Cells(m, 4) = ""
                    Sheets(shtCalendar).Cells(m, 6) = ""
                    Sheets(shtCalendar).Cells(m, 5) = "v"
                    Sheets(shtCalendar).Cells(m, 1) = matchTime
                    Sheets(shtCalendar).Cells(m, 9) = Sheets(shtFixture).Cells(I + 1, 22)
                    Sheets(shtCalendar).Cells(m, 10) = Sheets(shtFixture).Cells(I + 1, 23)
                    Sheets(shtCalendar).Cells(m, 11) = Sheets(shtFixture).Cells(I + 1, 24)
                    Sheets(shtCalendar).Cells(m, 12) = Sheets(shtFixture).Cells(I + 1, 20)
                    Sheets(shtCalendar).Cells(m, 13) = Sheets(shtFixture).Cells(I + 1, 21)
                    n = n + 1
                End If
        
        If n = 10 Then
            Sheets(shtCalendar).Cells(m + 1, 1) = "Time Zone:" & TimeZone
            'Sheets(shtCalendar).Cells(m + 1, 13) = ""
            Sheets(shtCalendar).Cells(m + 1, 1).Font.Size = 10
            Sheets(shtCalendar).Cells(m + 1, 1).HorizontalAlignment = xlLeft
        End If
        
        End If
 
        
    Next m
    
    nRowCal = ntmpRowCal

 End Sub
Sub CopyPIC(shtSource, nColTeam, nColPic, nStartRowTeam, shtTarget, strTrgCol, nTrgRow, Team, h)


Dim strRange2, strRange1 As String

    Sheets(shtSource).Select
    
   
    For p = 1 To 24
        If Cells(p + nStartRowTeam - 1, nColTeam) = Team Then
            strRange1 = Cells(p + nStartRowTeam - 1, nColPic)
            Exit For
        End If
    Next p
    

    ActiveSheet.Shapes.Range(Array(strRange1)).Select
    'Application.Wait (Now + TimeValue("0:00:01"))
'    Call Sleep(100)
    On Error Resume Next
    Selection.CopyPicture
    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        Selection.CopyPicture
'        nTmp = Cells(2, 41)
'        Cells(nTmp, nColTeam) = Team
'        Cells(nTmp, nColTeam + 1) = nTrgRow
'        Cells(2, 41) = nTmp + 1
    End If
    On Error GoTo 0
    


    Sheets(shtTarget).Select
    strRange2 = strTrgCol & nTrgRow
    Range(strRange2).Select
    
    On Error Resume Next
    
    ActiveSheet.Paste
    Selection.ShapeRange.Height = h
    Selection.ShapeRange.IncrementLeft (Columns(strTrgCol).Width - Selection.ShapeRange.Width) / 2
    Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
    Selection.Placement = xlMoveAndSize
    
    If Err.Number <> 0 Then
        Application.Wait (Now + TimeValue("0:00:01"))
        ActiveSheet.Paste
        Selection.ShapeRange.Height = h
        Selection.ShapeRange.IncrementLeft (Columns(strTrgCol).Width - Selection.ShapeRange.Width) / 2
        Selection.ShapeRange.IncrementTop (Range(strRange2).Height - Selection.ShapeRange.Height) / 2
        Selection.Placement = xlMoveAndSize
'        Cells(nTrgRow, 14) = "Err"
    End If
    On Error GoTo 0

End Sub
Sub CopyPICHTML(shtSource, nColTeam, nColPic, nStartRowTeam, shtTarget, strTrgCol, nTrgRow, Team, h)

Dim strRange2, strRange1 As String

      
    For p = 1 To 20
        If Sheets(shtSource).Cells(p + nStartRowTeam - 1, nColTeam) = Team Then
            strRange1 = Sheets(shtSource).Cells(p + nStartRowTeam - 1, nColPic)
            Exit For
        End If
    Next p
    
    strRange2 = strTrgCol & nTrgRow
    Sheets(shtTarget).Range(strRange2) = strRange1

End Sub
Sub GenerateCalendarHTML(TgSheet)
    Dim ii, jj, iMonth, ni, nj As Integer
    Dim matchMonthOld As String
    Dim shtTable, shtTableNew, shtFixture, shtDashboard As String
    'Dim TgSheet As String
    Dim w, h As Integer
    Dim iStart, jStart, jCol As Integer
    Dim matchDay As Integer
    Dim matchMonth, matchWkDay As String
    Dim matchTime As String
    Dim ResultHome, ResultAway As String
    Dim GF, GA As Integer
    Dim matchDate, matchDateOld As Date
    Dim HomeTeam_Short, AwayTeam_Short As String
    Dim HomeTeam, AwayTeam As String
    Dim nTeam, iBlk, jBlk As Integer
    Dim m, n As Integer
    Dim bNewCol As Boolean
    Dim widthCol As Integer
    'Dim TimeZone As String
    Dim TimeCol As Integer
    Dim matchWeek, matchWeekOld As Integer
    Dim PicPath, PicFileName, TempFile As String
    Dim pic As Object
    Dim ip_Home, ip_Away As Integer
    
    
    shtTable = "Sheet5"
    shtFixture = "fixtures"
    'TgSheet = "Calendar_New"
    shtDashboard = "Dashboard"
    shtTableNew = "Table"
    shtWkPredict = "WeeklyPredict"
    
    Sheets(shtTable).Unprotect ("pineapple")
    Sheets(shtTableNew).Unprotect ("pineapple")
    Sheets(shtDashboard).Unprotect ("pineapple")
    Sheets(TgSheet).Unprotect ("pineapple")
    

'PicPath = "D:\Users\Jie\Pictures\premier league\logo\small\"
    
    TimeZone = Sheets(shtDashboard).Cells(1, 4)
    
    If TimeZone = "UK" Then
        TimeCol = 4
    ElseIf TimeZone = "EST" Then
        TimeCol = 3
    ElseIf TimeZone = "CST" Then
        TimeCol = 5
    ElseIf TimeZone = "MST" Then
        TimeCol = 6
    ElseIf TimeZone = "PST" Then
        TimeCol = 7
    Else
        TimeCol = 3
    End If

    w = 20
    h = 600
    
    ni = 52
    nj = 8
    
    
    m = 7
    n = 3
    
    widthCol = 13

    
    matchMonth = ""
    matchDay = 0
    matchDateOld = DateValue("1/1/1900")
    matchMonthOld = ""
    matchWeek = 0
    matchWeekOld = 0
    

    
    Sheets(TgSheet).Activate
    
    For Each pic In ActiveSheet.Pictures
        pic.Delete
    Next pic
    
    iStart = 1
    jStart = 1
    
    ii = iStart
    jj = jStart
    
    jCol = 1
    iMonth = 0
    
    For I = 1 To 380
    
    matchWeek = Sheets(shtFixture).Cells(I + 1, 1)
    matchDate = Sheets(shtFixture).Cells(I + 1, 2)
    matchMonth = MonthName(Month(matchDate), True)
    matchDay = Day(matchDate)
    matchWkDay = WeekdayName(Weekday(matchDate), True)
    matchTime = TimeValue(Sheets(shtFixture).Cells(I + 1, TimeCol).Text)
    
    If (matchWeek <> matchWeekOld) Then
        If I > 1 Then
            Cells(ii, jj) = "Time Zone: " & TimeZone
            Cells(ii, jj).Font.Size = 12
            Cells(ii, jj).HorizontalAlignment = xlLeft
            For n = jj To jj + widthCol - 1
                Cells(ii, n).Interior.Color = RGB(nR1, nG1, nB1)
                Cells(ii, n).Font.Color = RGB(nRf1, nGf1, nBf1)
            Next n
            
            Cells(ii, jj + 1) = "#" & WorksheetFunction.Dec2Hex(nR, 2) & WorksheetFunction.Dec2Hex(nG, 2) & WorksheetFunction.Dec2Hex(nB, 2)
            Cells(ii, jj + 1).Font.Color = RGB(nRf, nGf, nBf)
            Cells(ii, jj + 1).Interior.Color = RGB(nR, nG, nB)
            Cells(ii, jj + 1).Font.Size = 12
            
            Cells(ii, jj + 2) = "#" & WorksheetFunction.Dec2Hex(nRf, 2) & WorksheetFunction.Dec2Hex(nGf, 2) & WorksheetFunction.Dec2Hex(nBf, 2)
            Cells(ii, jj + 2).Font.Color = RGB(nRf, nGf, nBf)
            Cells(ii, jj + 2).Interior.Color = RGB(nR, nG, nB)
            Cells(ii, jj + 2).Font.Size = 12
            
            Cells(ii, jj + 3) = "#" & WorksheetFunction.Dec2Hex(Int((nR + nR1) / 2), 2) & WorksheetFunction.Dec2Hex(Int((nG + nG1) / 2), 2) & WorksheetFunction.Dec2Hex(Int((nB + nB1) / 2), 2)
            Cells(ii, jj + 3).Font.Color = RGB(nRf, nGf, nBf)
            Cells(ii, jj + 3).Interior.Color = RGB(Int((nR + nR1) / 2), Int((nG + nG1)) / 2, Int((nB + nB1) / 2))
            Cells(ii, jj + 3).Font.Size = 12
            
            Cells(ii, jj + 4) = "#" & WorksheetFunction.Dec2Hex(nR1, 2) & WorksheetFunction.Dec2Hex(nG1, 2) & WorksheetFunction.Dec2Hex(nB1, 2)
            Cells(ii, jj + 4).Font.Color = RGB(nRf1, nGf1, nBf1)
            Cells(ii, jj + 4).Interior.Color = RGB(nR1, nG1, nB1)
            Cells(ii, jj + 4).Font.Size = 12
            
            'Cells(ii, jj + 5) = "#" & Format(Hex(nR1f), String(2, "0")) & Format(Hex(nGf1), String(2, "0")) & Format(Hex(nBf1), String(2, "0"))
            Cells(ii, jj + 5) = "#" & WorksheetFunction.Dec2Hex(nR1f, 2) & WorksheetFunction.Dec2Hex(nGf1, 2) & WorksheetFunction.Dec2Hex(nBf1, 2)
            Cells(ii, jj + 5).Font.Color = RGB(nRf1, nGf1, nBf1)
            Cells(ii, jj + 5).Interior.Color = RGB(nR1, nG1, nB1)
            Cells(ii, jj + 5).Font.Size = 12
            
            ii = ii + 1
        End If
        
        iMonth = iMonth + 1
            
        nR = Sheets(shtTable).Cells(ni + iMonth, 27)
        nG = Sheets(shtTable).Cells(ni + iMonth, 28)
        nB = Sheets(shtTable).Cells(ni + iMonth, 29)
        
        nRf = Sheets(shtTable).Cells(ni + iMonth, 30)
        nGf = Sheets(shtTable).Cells(ni + iMonth, 31)
        nBf = Sheets(shtTable).Cells(ni + iMonth, 32)
        
        nR1 = Sheets(shtTable).Cells(ni + iMonth, 33)
        nG1 = Sheets(shtTable).Cells(ni + iMonth, 34)
        nB1 = Sheets(shtTable).Cells(ni + iMonth, 35)
        
        nRf1 = Sheets(shtTable).Cells(ni + iMonth, 36)
        nGf1 = Sheets(shtTable).Cells(ni + iMonth, 37)
        nBf1 = Sheets(shtTable).Cells(ni + iMonth, 38)
        
        If iMonth >= 10 Then iMonth = 0
        Cells(ii, jj + 10) = "Week " & matchWeek
        'Cells(ii, jj + 7) = matchWeek
        Cells(ii, jj + 10).Font.Bold = True
        Cells(ii, jj + 10).Font.Size = 24
        Cells(ii, jj + 10).HorizontalAlignment = xlRight
        For n = jj To jj + widthCol - 1
            Cells(ii, n).Interior.Color = RGB(nR, nG, nB)
            Cells(ii, n).Font.Color = RGB(nRf, nGf, nBf)
        Next n
        ii = ii + 1
        matchWeekOld = matchWeek
    End If
        
    
    HomeTeam = Sheets(shtFixture).Cells(I + 1, 10)
    AwayTeam = Sheets(shtFixture).Cells(I + 1, 13)
    
    ip_Home = 0
    ip_Away = 0
    For np = 1 To 20
        If HomeTeam = Sheets(shtTable).Cells(5 + np, 8) Then
            HomeTeam_Short = Sheets(shtTable).Cells(5 + np, 6)
            ip_Home = 1
        End If
        If AwayTeam = Sheets(shtTable).Cells(5 + np, 8) Then
            AwayTeam_Short = Sheets(shtTable).Cells(5 + np, 6)
            ip_Away = 1
        End If
    If ip_Home = 1 And ip_way = 1 Then Exit For
    Next np
    
    If Not (IsEmpty(Sheets(shtFixture).Cells(I + 1, 11))) And Not (IsEmpty(Sheets(shtFixture).Cells(I + 1, 12))) Then
            
        GF = Sheets(shtFixture).Cells(I + 1, 11)
        GA = Sheets(shtFixture).Cells(I + 1, 12)
    Else
        GA = -1
        GF = -1
    End If
    
    
    If (matchDate <> matchDateOld) Then
        Cells(ii, jj) = matchMonth & " " & matchDay & ", " & matchWkDay
        Cells(ii, jj).Font.Bold = True
        Cells(ii, jj).Font.Size = 20
        Cells(ii, jj).HorizontalAlignment = xlLeft
        
        For n = jj To jj + widthCol - 1
            Cells(ii, n).Interior.Color = RGB(Int((nR + nR1) / 2), Int((nG + nG1)) / 2, Int((nB + nB1) / 2))
            Cells(ii, n).Font.Color = RGB(nRf, nGf, nBf)
        Next n
        
        matchDateOld = matchDate
        ii = ii + 1
    End If
        'Cells(ii, jj + 1) = HomeTeam
        Cells(ii, jj + 1) = HomeTeam_Short
        Cells(ii, jj + 1).HorizontalAlignment = xlRight
        If GF >= 0 Then
            Cells(ii, jj + 3) = GF
            Cells(ii, jj + 4) = ":"
            Cells(ii, jj + 5) = GA
        Else
            Cells(ii, jj + 3) = ""
            Cells(ii, jj + 4) = "v"
            Cells(ii, jj + 5) = ""
        End If
        'Cells(ii, jj + 7) = AwayTeam
        Cells(ii, jj + 7) = AwayTeam_Short
        Cells(ii, jj + 7).HorizontalAlignment = xlLeft
        Cells(ii, jj) = matchTime
        
                
            'PicFileName = PicPath & HomeTeam & ".png"
            'TempFile = Dir(PicFileName)
            'If Len(TempFile) = 0 Then
            'PicFileName = PicPath & "Chelsea.png"
            'End If
            
            'With ActiveSheet.Pictures.Insert(PicFileName)
                'With .ShapeRange
                '.LockAspectRatio = msoTrue
                ''.Width = 7.5
                '.Height = 24
                'End With

                '.Left = Cells(ii, jj + 1).Left + (Cells(ii, jj + 1).Width - .Width) / 2
                '.Top = Cells(ii, jj + 1).Top + (Cells(ii, jj + 1).Height - .Height) / 2
                '.Placement = 1
                '.PrintObject = True

            'End With

    'Call InsertPICwithLink(HomeTeam, PicPath, ii, jj + 1, 24, 7.5)
    'Call CopyPIC(shtTableNew, 43, 45, 2, TgSheet, "C", ii, HomeTeam, 20)
    Call CopyPICHTML(shtTable, 8, 4, 6, TgSheet, "C", ii, HomeTeam, 20)
    ' CopyPIC (shtSource,  nColTeam, nColPic,nStartRowTeam, shtTarget,strTrgCol, nTrgRow, Team, h)
        
            'PicFileName = PicPath & AwayTeam & ".png"
            'TempFile = Dir(PicFileName)
            'If Len(TempFile) = 0 Then
            'PicFileName = PicPath & "Chelsea.png"
            'End If
            
            'With ActiveSheet.Pictures.Insert(PicFileName)
                'With .ShapeRange
                '.LockAspectRatio = msoTrue
                ''.Width = 7.5
                '.Height = 24
                'End With

                '.Left = Cells(ii, jj + 5).Left + (Cells(ii, jj + 5).Width - .Width) / 2
                '.Top = Cells(ii, jj + 5).Top + (Cells(ii, jj + 5).Height - .Height) / 2
                '.Placement = 1
                '.PrintObject = True

            'End With


    'Call InsertPICwithLink(AwayTeam, PicPath, ii, jj + 5, 24, 7.5)
    'Call CopyPIC(shtTableNew, 43, 45, 2, TgSheet, "G", ii, AwayTeam, 20)
    Call CopyPICHTML(shtTable, 8, 4, 6, TgSheet, "G", ii, AwayTeam, 20)
    ' CopyPIC (shtSource,  nColTeam, nColPic,nStartRowTeam, shtTarget,strTrgCol, nTrgRow, Team, h)
        
        For n = jj To jj + widthCol - 1
            Cells(ii, n).Interior.Color = RGB(nR1, nG1, nB1)
            Cells(ii, n).Font.Color = RGB(nRf1, nGf1, nBf1)
        Next n
        
        ii = ii + 1
        If ii > h Then
            ii = iStart
            jCol = jCol + 1
            jj = jStart + widthCol * (jCol - 1)
        End If

    
    Next I
    
            Cells(ii, jj) = "Time Zone: " & TimeZone
            Cells(ii, jj).Font.Size = 12
            Cells(ii, jj).HorizontalAlignment = xlLeft
            For n = jj To jj + widthCol - 1
                Cells(ii, n).Interior.Color = RGB(nR1, nG1, nB1)
                Cells(ii, n).Font.Color = RGB(nRf1, nGf1, nBf1)
            Next n
            
            

            Cells(ii, jj + 1) = "#" & Hex(nR) & Hex(nG) & Hex(nB)
            Cells(ii, jj + 1).Font.Color = RGB(nRf, nGf, nBf)
            Cells(ii, jj + 1).Interior.Color = RGB(nR, nG, nB)
            
            Cells(ii, jj + 2) = "#" & Hex(nRf) & Hex(nGf) & Hex(nBf)
            Cells(ii, jj + 2).Font.Color = RGB(nRf, nGf, nBf)
            Cells(ii, jj + 2).Interior.Color = RGB(nR, nG, nB)
            
            Cells(ii, jj + 3) = "#" & Hex(Int((nR + nR1) / 2)) & Hex(Int((nG + nG1) / 2)) & Hex(Int((nB + nB1) / 2))
            Cells(ii, jj + 3).Font.Color = RGB(nRf, nGf, nBf)
            Cells(ii, jj + 3).Interior.Color = RGB(Int((nR + nR1) / 2), Int((nG + nG1)) / 2, Int((nB + nB1) / 2))
            
            Cells(ii, jj + 4) = "#" & Hex(nR1) & Hex(nG1) & Hex(nB1)
            Cells(ii, jj + 4).Font.Color = RGB(nRf1, nGf1, nBf1)
            Cells(ii, jj + 4).Interior.Color = RGB(nR1, nG1, nB1)
            
            Cells(ii, jj + 5) = "#" & Hex(nR1f) & Hex(nGf1) & Hex(nBf1)
            Cells(ii, jj + 5).Font.Color = RGB(nRf1, nGf1, nBf1)
            Cells(ii, jj + 5).Interior.Color = RGB(nR1, nG1, nB1)
            
            
            
    Sheets(shtTable).Protect ("pineapple")
    Sheets(shtTableNew).Protect ("pineapple")
    Sheets(shtDashboard).Protect ("pineapple")
    Sheets(TgSheet).Protect ("pineapple")

        

End Sub
Sub ModelLeague_MC(bLogo)
    Dim ii(20), jj(20), nGame(20), Points(20) As Integer
    Dim matchMonthOld(20) As String
    Dim shtTable, shtFixture, shtDashboard, shtTableNew, shtCalendar, shtSPI, shtMCTable As String
    Dim TgSheet As String
    Dim w, h As Integer
    Dim iStart, jStart As Integer
    Dim LastMatchDate(20) As Date
    Dim matchDay As Integer
    Dim matchMonth, matchWkDay As String
    Dim matchTime As String
    Dim ResultHome, ResultAway As String
    Dim GF, GA, HomePoints, AwayPoints As Integer
    Dim matchDate(380) As Date
    Dim HomeTeam(380), AwayTeam(380) As String
    Dim HomeTeamNext, AwayTeamNext As String
    Dim nTeam, iBlk, jBlk As Integer
    Dim m, n As Integer
    Dim bNewCol As Boolean
    Dim widthCol As Integer
    Dim TimeZone As String
    Dim TimeCol As Integer
    Dim pic As Object
    Dim nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1 As Integer
    Dim tbPoints(20), tbMP(20), tbW(20), tbD(20), tbL(20), tbGA(20), tbGF(20) As Integer
    Dim tbTotPoints(20) As Single
    Dim Form(20, 5) As String
    Dim nextOppo(20), nextGame(20) As String
    Dim Rank(20) As Integer
    Dim strRange1, strRange2 As String
    Dim bDelete As Boolean
    Dim nRowCal, ntmpRowCal As Integer
    Dim spi_off(20), spi_def(20), subRating(20), spi_off_ave, spi_def_ave As Single
    Dim iHome, iAway, RestDaysHome, RestDaysAway As Integer
    Dim spiGF(380), spiGA(380), homeadvtg As Single
    Dim totalGoals, GoalFactor, AveGoals As Single
    Dim Winpct, DrawPct, LossPct, HomeProb(7), AwayProb(7), HomeProbAcc(7), AwayProbAcc(7) As Single
    Dim HomeRND, AwayRND As Single
    Dim GA_guess(380), GF_guess(380) As Integer
    Dim nMC, nMCTotal, spiWk As Integer
    Dim shtMCGD, shtMCLoss, shtMCDraw, shtMCWin, shtMCPoints, shtMCGA, shtMCGF, shtMCSummary, shtMCSummaryHTML As String
    Dim nMatchwk(380) As Integer
    
    Dim avePoints(20), aveMP(20), aveW(20), aveD(20), aveL(20), aveGA(20), aveGF(20), aveGD(20) As Long
    Dim aveTotPoints(20) As Single
    Dim nWinLeague(20), nTop4(20), nRelegate(20) As Integer
    Dim timeStart, timeNow As Long
    Dim secElapsed, minElapsed As Integer
    

    
    'Application.ScreenUpdating = False
    bCancel = False
    
    ufProgress.LabelProgress.Width = 0
    ufProgress.Show
    
    timeStart = Timer
    
    shtTable = "Sheet5"
    shtFixture = "fixtures"
    TgSheet = "Fixtures_by_Clubs"
    shtDashboard = "Dashboard"
    shtTableNew = "Table"
    shtCalendar = "Fixtures_by_Date"
    shtSPI = "SPI"
    shtMCSummaryHTML = "MC Summary HTML"
    'shtMCTable = "MC_Table"
    'shtMCGF = "MC_GF"
    'shtMCGA = "MC_GA"
    'shtMCGD = "MC_GD"
    'shtMCLoss = "MC_Loss"
    'shtMCDraw = "MC_Draw"
    'shtMCWin = "MC_Win"
    'shtMCPoints = "MC_Points"
    shtMCSummary = "Predicted_Table"
    
    Sheets(shtTable).Unprotect ("pineapple")
    Sheets(shtTableNew).Unprotect ("pineapple")
    Sheets(shtDashboard).Unprotect ("pineapple")
    Sheets(shtCalendar).Unprotect ("pineapple")
    Sheets(shtSPI).Unprotect ("pineapple")
    Sheets(shtMCSummary).Unprotect ("pineapple")
    'Sheets(shtMCTable).Unprotect ("pineapple")
    'Sheets(shtMCGF).Unprotect ("pineapple")
    'Sheets(shtMCGA).Unprotect ("pineapple")
    
    'Sheets(shtMCGD).Unprotect ("pineapple")
    'Sheets(shtMCLoss).Unprotect ("pineapple")
    'Sheets(shtMCDraw).Unprotect ("pineapple")
    'Sheets(shtMCWin).Unprotect ("pineapple")
    'Sheets(shtMCPoints).Unprotect ("pineapple")
        
    'Sheets(shtTableNew).Activate
    
    TimeZone = Sheets(shtDashboard).Cells(1, 4)
    
    If TimeZone = "UK" Then
        TimeCol = 4
    ElseIf TimeZone = "EST" Then
        TimeCol = 3
    ElseIf TimeZone = "CST" Then
        TimeCol = 5
    ElseIf TimeZone = "MST" Then
        TimeCol = 6
    ElseIf TimeZone = "PST" Then
        TimeCol = 7
    Else
        TimeCol = 4
    End If

    'w = 20
    'h = 27
    
    'm = 5
    'n = 4
    
    'widthCol = 10

'    Sheets(shtMCGF).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 380
'        Cells(1, I + 1) = "Game " & I
'    Next I
'
'    Sheets(shtMCGA).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 380
'        Cells(1, I + 1) = "Game " & I
'    Next I
'
'    Sheets(shtMCGD).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 20
'        Cells(1, I + 1) = Sheets(shtDashboard).Cells(I + 1, 2)
'    Next I
'
'    Sheets(shtMCLoss).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 20
'        Cells(1, I + 1) = Sheets(shtDashboard).Cells(I + 1, 2)
'    Next I
'
'    Sheets(shtMCDraw).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 20
'        Cells(1, I + 1) = Sheets(shtDashboard).Cells(I + 1, 2)
'    Next I
'
'    Sheets(shtMCWin).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 20
'        Cells(1, I + 1) = Sheets(shtDashboard).Cells(I + 1, 2)
'    Next I
'
'    Sheets(shtMCPoints).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 20
'        Cells(1, I + 1) = Sheets(shtDashboard).Cells(I + 1, 2)
'    Next I
'
'    Sheets(shtMCTable).Select
'    Cells.ClearContents
'
'    Cells(1, 1) = "n"
'    For I = 1 To 20
'        Cells(1, I + 1) = Sheets(shtDashboard).Cells(I + 1, 2)
'    Next I

    
    nMCTotal = Sheets(shtDashboard).Cells(14, 6)
    
    Sheets(shtMCSummary).Select
    For Each pic In ActiveSheet.Pictures
        pic.Delete
    Next pic
    
    For nMC = 1 To nMCTotal
    
    pctdone = nMC / nMCTotal
    timeNow = Timer
    minElapsed = Int((timeNow - timeStart) / 60)
    secElapsed = Round((timeNow - timeStart - minElapsed * 60), 0)
    
    With ufProgress
        .LabelCaption.Caption = "Monte Carlo Run " & nMC & " of " & nMCTotal
        .LabelTime.Caption = "Elapsed time: " & minElapsed & " min " & secElapsed & " sec"
        .LabelProgress.Width = pctdone * (.FrameProgress.Width)
    End With
    
    DoEvents
    
    'Sheets(shtFixture).Range("K12:L381").ClearContents
    'Cells(14, 6) = nMC
    
    matchMonth = ""
    matchDay = 0
    spi_off_ave = 0
    spi_def_ave = 0
    For I = 1 To 20
        ii(I) = 1
        jj(I) = 1
        nGame(I) = 0
        Points(I) = 0
        matchMonthOld(I) = ""
        tbPoints(I) = 0
        tbMP(I) = 0
        tbW(I) = 0
        tbD(I) = 0
        tbL(I) = 0
        tbGF(I) = 0
        tbGA(I) = 0
        'spi_off(I) = Sheets(shtSPI).Cells(I + 1, 3)
        'spi_def(I) = Sheets(shtSPI).Cells(I + 1, 4)
        'subRating(I) = Sheets(shtSPI).Cells(I + 1, 5)
        'spi_off_ave = spi_off_ave + spi_off(I)
        'spi_def_ave = spi_def_ave + spi_def(I)
        For j = 1 To 5
        Form(I, j) = ""
        Next j
        nextOppo(I) = ""
        nextGame(I) = ""
        LastMatchDate(I) = "8 / 1 / 18"
    Next I
    
    Call readSPI(shtSPI, spi_off, spi_def, subRating, spi_off_ave, spi_def_ave, 0, spiWk)
    
    'spi_off_ave = spi_off_ave / 20
    'spi_def_ave = spi_def_ave / 20
    homeadvtg = 1.1
    AveGoals = 2.85
    
    'Sheets(TgSheet).Activate
    
    'For Each PIC In ActiveSheet.Pictures
        'PIC.Delete
    'Next PIC
    
    nRowCal = 1
    ntmpRowCal = 1
    
    'Sheets(shtMCGF).Cells(nMC + 1, 1) = nMC
    'Sheets(shtMCGA).Cells(nMC + 1, 1) = nMC
    
    For I = 1 To 380
    nMatchwk(I) = Sheets(shtFixture).Cells(I + 1, 1)
    matchDate(I) = Sheets(shtFixture).Cells(I + 1, 2)
    HomeTeam(I) = Sheets(shtFixture).Cells(I + 1, 10)
    AwayTeam(I) = Sheets(shtFixture).Cells(I + 1, 13)
    
        For k = 1 To 20
        If HomeTeam(I) = Sheets(shtSPI).Cells(k + 1, 2) Then
            iHome = k
            Exit For
        End If
        Next k
        
        For k = 1 To 20
        If AwayTeam(I) = Sheets(shtSPI).Cells(k + 1, 2) Then
            iAway = k
            Exit For
        End If
        Next k
        
    RestDaysHome = matchDate(I) - LastMatchDate(iHome)
    RestDaysAway = matchDate(I) - LastMatchDate(iAway)
    
    If RestDaysHome > 7 Then RestDaysHome = 7
    If RestDaysAway > 7 Then RestDaysAway = 7
    
    If spiWk = nMatchwk(I) Then Call readSPI(shtSPI, spi_off, spi_def, subRating, spi_off_ave, spi_def_ave, 1, spiWk)
        
    Call CalGfGa(spiGF(I), spiGA(I), spi_off(iHome), spi_def(iHome), spi_off(iAway), spi_def(iAway), homeadvtg, RestDaysHome, RestDaysAway, subRating(iHome), subRating(iAway), _
    spi_off_ave, spi_def_ave)
       
    Next I
    
    totalGoals = 0
    For I = 1 To 380
    totalGoals = totalGoals + spiGA(I) + spiGF(I)
    Next I
    GoalFactor = AveGoals / (totalGoals / 380)
    
    For I = 1 To 380
        spiGA(I) = spiGA(I) * GoalFactor
        spiGF(I) = spiGF(I) * GoalFactor
        'Sheets(shtFixture).Cells(I + 1, 20) = spiGF(I)
        'Sheets(shtFixture).Cells(I + 1, 21) = spiGA(I)
    Next I
    
    For I = 1 To 380

    
        For k = 1 To 20
        If HomeTeam(I) = Sheets(shtSPI).Cells(k + 1, 2) Then
            iHome = k
            Exit For
        End If
        Next k
        
        For k = 1 To 20
        If AwayTeam(I) = Sheets(shtSPI).Cells(k + 1, 2) Then
            iAway = k
            Exit For
        End If
        Next k
        
    RestDaysHome = matchDate(I) - LastMatchDate(iHome)
    RestDaysAway = matchDate(I) - LastMatchDate(iAway)
    
    If RestDaysHome > 7 Then RestDaysHome = 7
    If RestDaysAway > 7 Then RestDaysAway = 7
    
    LastMatchDate(iHome) = matchDate(I)
    LastMatchDate(iAway) = matchDate(I)
    
    If spiWk = nMatchwk(I) Then Call readSPI(shtSPI, spi_off, spi_def, subRating, spi_off_ave, spi_def_ave, 1, spiWk)
        
    Call CalGfGa(spiGF(I), spiGA(I), spi_off(iHome), spi_def(iHome), spi_off(iAway), spi_def(iAway), homeadvtg, RestDaysHome, RestDaysAway, subRating(iHome), subRating(iAway), _
    spi_off_ave, spi_def_ave)
    
    'spiGF(I) = spiGF(I) * GoalFactor
    'spiGA(I) = spiGA(I) * GoalFactor
    
        Winpct = 0
        DrawPct = 0
        LossPct = 0
        For m = 0 To 6
            HomeProbAcc(m + 1) = 0
            AwayProbAcc(m + 1) = 0
        Next m
        For m = 0 To 6
            AwayProb(m + 1) = Poisson(spiGA(I), m)
            For p = 0 To m
                AwayProbAcc(m + 1) = AwayProbAcc(m + 1) + AwayProb(p + 1)
            Next p
            For n = 0 To 6
                If m = 0 Then
                    HomeProb(n + 1) = Poisson(spiGF(I), n)
                For p = 0 To n
                    HomeProbAcc(n + 1) = HomeProbAcc(n + 1) + HomeProb(p + 1)
                Next p
                End If
                If m = n Then
                    DrawPct = DrawPct + AwayProb(m + 1) * HomeProb(n + 1)
                ElseIf m < n Then
                    Winpct = Winpct + AwayProb(m + 1) * HomeProb(n + 1)
                Else
                    LossPct = LossPct + AwayProb(m + 1) * HomeProb(n + 1)
                End If
            Next n
        Next m
        'Sheets(shtFixture).Cells(I + 1, 22) = Winpct
        'Sheets(shtFixture).Cells(I + 1, 23) = DrawPct
        'Sheets(shtFixture).Cells(I + 1, 24) = LossPct
        
        If IsEmpty(Sheets(shtFixture).Cells(I + 1, 11)) And IsEmpty(Sheets(shtFixture).Cells(I + 1, 12)) Then
        
        Randomize
        HomeRND = Rnd
        For m = 0 To 6
        If HomeRND <= HomeProbAcc(m + 1) Then
            GF_guess(I) = m
            Exit For
        End If
        Next m
        
        Randomize
        AwayRND = Rnd
        For m = 0 To 6
        If AwayRND <= AwayProbAcc(m + 1) Then
            GA_guess(I) = m
            Exit For
        End If
        Next m
        
        Else
            GF_guess(I) = Sheets(shtFixture).Cells(I + 1, 11)
            GA_guess(I) = Sheets(shtFixture).Cells(I + 1, 12)
        End If
        
'        Sheets(shtMCGF).Cells(nMC + 1, I + 1) = GF_guess(I)
'        Sheets(shtMCGA).Cells(nMC + 1, I + 1) = GA_guess(I)
        
        'HomeTeam = Sheets(shtFixture).Cells(I + 1, 10)
        'AwayTeam = Sheets(shtFixture).Cells(I + 1, 13)
    
        'For k = 1 To 20
        'If HomeTeam(I) = Sheets(shtSPI).Cells(k + 1, 2) Then
            'iHome = k
            'Exit For
        'End If
        'Next k
        
        'For k = 1 To 20
        'If AwayTeam(I) = Sheets(shtSPI).Cells(k + 1, 2) Then
            'iAway = k
            'Exit For
        'End If
        'Next k
            
        'Sheets(shtFixture).Cells(I + 1, 25) = GF_guess(i)
        'Sheets(shtFixture).Cells(I + 1, 26) = GA_guess(i)
        
        'Sheets(shtFixture).Cells(I + 1, 27) = HomeRND
        'Sheets(shtFixture).Cells(I + 1, 28) = AwayRND
        
        Call SPIAdjust(spi_off(iHome), spi_def(iHome), spiGF(I), spiGA(I), GF_guess(I), GA_guess(I))
        Call SPIAdjust(spi_off(iAway), spi_def(iAway), spiGA(I), spiGF(I), GA_guess(I), GF_guess(I))
        
        'For m = 0 To 6
            'Sheets(shtFixture).Cells(I + 1, 29 + m) = HomeProbAcc(m + 1)
            'Sheets(shtFixture).Cells(I + 1, 36 + m) = AwayProbAcc(m + 1)
        'Next m
        
        
    'Sheets(shtFixture).Cells(I + 1, 43) = spi_off(iHome)
    'Sheets(shtFixture).Cells(I + 1, 44) = spi_def(iHome)
    'Sheets(shtFixture).Cells(I + 1, 45) = spi_off(iAway)
    'Sheets(shtFixture).Cells(I + 1, 46) = spi_def(iAway)
         
    Next I
    
    'For I = 1 To 380
    
    'If IsEmpty(Sheets(shtFixture).Cells(I + 1, 11)) And IsEmpty(Sheets(shtFixture).Cells(I + 1, 12)) Then
        'Sheets(shtFixture).Cells(I + 1, 11) = Sheets(shtFixture).Cells(I + 1, 25)
        'Sheets(shtFixture).Cells(I + 1, 12) = Sheets(shtFixture).Cells(I + 1, 26)
    'End If
    
    'Next I

    
    For I = 1 To 380
  
    'HomeTeam = Sheets(shtFixture).Cells(I + 1, 10)
    'AwayTeam = Sheets(shtFixture).Cells(I + 1, 13)
    
    'If Not (IsEmpty(Sheets(shtFixture).Cells(I + 1, 11))) And Not (IsEmpty(Sheets(shtFixture).Cells(I + 1, 12))) Then
            
        'GF = Sheets(shtFixture).Cells(I + 1, 11)
        'GA = Sheets(shtFixture).Cells(I + 1, 12)
        GF = GF_guess(I)
        GA = GA_guess(I)
        If GF > GA Then
            ResultHome = "W"
            ResultAway = "L"
            HomePoints = 3
            AwayPoints = 0
        ElseIf GF = GA Then
            ResultHome = "D"
            ResultAway = "D"
            HomePoints = 1
            AwayPoints = 1
        Else
            ResultHome = "L"
            ResultAway = "W"
            HomePoints = 0
            AwayPoints = 3
        End If
    'Else
        'GA = -1
        'GF = -1
    'End If
    
    'Call FindTeamNo(HomeTeam, nTeam, m, n, iBlk, jBlk)
    
    'iStart = (iBlk - 1) * h
    'jStart = (jBlk - 1) * w
        
    'If ii(nTeam) = 1 Then
        'ii(nTeam) = ii(nTeam) + iStart
        'jj(nTeam) = jj(nTeam) + jStart
        'Cells(ii(nTeam), jj(nTeam)) = HomeTeam
        'ii(nTeam) = ii(nTeam) + 1
        'bNewCol = True
    'End If
           
    'If ii(nTeam) >= iStart + h Then
        'ii(nTeam) = iStart + 4
        'jj(nTeam) = jj(nTeam) + widthCol
        'bNewCol = True
    'End If
        
    'Call WriteTeam(bNewCol, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, "H", GF, GA, ResultHome)
    
    Call FindTeamNo(HomeTeam(I), nTeam, 1, 1, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    
    nGame(nTeam) = nGame(nTeam) + 1
    
    If GA >= 0 Then
        tbMP(nTeam) = tbMP(nTeam) + 1
        If ResultHome = "W" Then
        tbW(nTeam) = tbW(nTeam) + 1
        ElseIf ResultHome = "D" Then
        tbD(nTeam) = tbD(nTeam) + 1
        Else
        tbL(nTeam) = tbL(nTeam) + 1
        End If
        tbPoints(nTeam) = tbW(nTeam) * 3 + tbD(nTeam)
        tbGF(nTeam) = tbGF(nTeam) + GF
        tbGA(nTeam) = tbGA(nTeam) + GA
    End If
        

        Points(nTeam) = Points(nTeam) + HomePoints
        
                
    
    'Call WriteTeamToTeamPage3(HomeTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
    'Call WriteTeamToTeamPage3(HomeTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
    
    'Call FindTeamNo(AwayTeam, nTeam, m, n, iBlk, jBlk)
    
    'iStart = (iBlk - 1) * h
    'jStart = (jBlk - 1) * w
        
    'If ii(nTeam) = 1 Then
        'ii(nTeam) = ii(nTeam) + iStart
        'jj(nTeam) = jj(nTeam) + jStart
        'Cells(ii(nTeam), jj(nTeam)) = AwayTeam
        'ii(nTeam) = ii(nTeam) + 1
        'bNewCol = True
    'End If
           
    'If ii(nTeam) >= iStart + h Then
        'ii(nTeam) = iStart + 4
        'jj(nTeam) = jj(nTeam) + widthCol
        'bNewCol = True
    'End If

    'Call WriteTeam(bNewCol, HomeTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, "A", GA, GF, ResultAway)
    
    Call FindTeamNo(AwayTeam(I), nTeam, 1, 1, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    
    nGame(nTeam) = nGame(nTeam) + 1
    
    If GA >= 0 Then
        tbMP(nTeam) = tbMP(nTeam) + 1
        If ResultAway = "W" Then
        tbW(nTeam) = tbW(nTeam) + 1
        ElseIf ResultAway = "D" Then
        tbD(nTeam) = tbD(nTeam) + 1
        Else
        tbL(nTeam) = tbL(nTeam) + 1
        End If
        tbPoints(nTeam) = tbW(nTeam) * 3 + tbD(nTeam)
        tbGF(nTeam) = tbGF(nTeam) + GA
        tbGA(nTeam) = tbGA(nTeam) + GF
    End If
    
        Points(nTeam) = Points(nTeam) + AwayPoints

        

    
    'Call WriteTeamToTeamPage3(AwayTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
    'Call WriteTeamToTeamPage3(AwayTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
    Next I

    ni = 5
    nj = 8
    
    For I = 1 To 20
        'Sheets(shtTable).Cells(ni + I, nj + 1) = tbMP(I)
        'Sheets(shtTable).Cells(ni + I, nj + 2) = tbW(I)
        'Sheets(shtTable).Cells(ni + I, nj + 3) = tbD(I)
        'Sheets(shtTable).Cells(ni + I, nj + 4) = tbL(I)
        'Sheets(shtTable).Cells(ni + I, nj + 5) = tbGF(I)
        'Sheets(shtTable).Cells(ni + I, nj + 6) = tbGA(I)
        'Sheets(shtTable).Cells(ni + I, nj + 7) = tbGF(I) - tbGA(I)
        'Sheets(shtTable).Cells(ni + I, nj + 8) = tbPoints(I)
        tbTotPoints(I) = tbPoints(I) * 1000 + tbGF(I) - tbGA(I) + tbGA(I) / 100
        
        'For k = 5 To 1 Step -1
            'Sheets(shtTable).Cells(ni + I, nj + 15 - k) = Form(I, k)
        'Next k
        'Sheets(shtTable).Cells(ni + I, nj + 15) = nextOppo(I)
        'Sheets(shtTable).Cells(ni + I, nj + 16) = nextGame(I)
    Next I



For I = 1 To 20
    Rank(I) = I
Next I


'If nGameTotal > 0 Then
'For m = 1 To 20
    'Sheets(shtTable).Cells(ni + m, nj - 3) = rank(m)
'Next m
maxRank = 1
For I = 1 To 20

maxRankOld = maxRank
'tempPoints = Sheets(shtTable).Cells(ni + Rank(i), nj + 9)
tempPoints = -99
    For k = I To 20
    'If Sheets(shtTable).Cells(ni + rank(k), nj + 9) > tempPoints Then
    If tbTotPoints(Rank(k)) > tempPoints Then
        'tempPoints = Sheets(shtTable).Cells(ni + rank(k), nj + 9)
        tempPoints = tbTotPoints(Rank(k))
        maxRank = Rank(k)
    End If
    Next k
    

    For p = I To 20
    If Rank(p) = maxRank Then
    Index = p
    Exit For
    End If
    Next p
    
    For p = Index To I + 1 Step -1
    
    Rank(p) = Rank(p - 1)
    
    Next p
    
    
    Rank(I) = maxRank


Next I

'End If

'Sheets(shtMCPoints).Cells(nMC + 1, 1) = nMC
'Sheets(shtMCTable).Cells(nMC + 1, 1) = nMC
'Sheets(shtMCWin).Cells(nMC + 1, 1) = nMC
'Sheets(shtMCDraw).Cells(nMC + 1, 1) = nMC
'Sheets(shtMCLoss).Cells(nMC + 1, 1) = nMC
'Sheets(shtMCGD).Cells(nMC + 1, 1) = nMC

For m = 1 To 20

    'Sheets(shtMCTable).Cells(nMC + 1, m + 1) = Sheets(shtTable).Cells(ni + rank(m), nj - 3)
'    Sheets(shtMCTable).Cells(nMC + 1, Rank(m) + 1) = m
'    Sheets(shtMCPoints).Cells(nMC + 1, m + 1) = tbPoints(m)
'    Sheets(shtMCWin).Cells(nMC + 1, m + 1) = tbW(m)
'    Sheets(shtMCDraw).Cells(nMC + 1, m + 1) = tbD(m)
'    Sheets(shtMCLoss).Cells(nMC + 1, m + 1) = tbL(m)
'    Sheets(shtMCGD).Cells(nMC + 1, m + 1) = tbGF(m) - tbGA(m)
    
    If nMC = 1 Then
        avePoints(m) = tbPoints(m)
        aveW(m) = tbW(m)
        aveD(m) = tbD(m)
        aveL(m) = tbL(m)
        aveGD(m) = tbGF(m) - tbGA(m)
        If Rank(1) = m Then
            nWinLeague(m) = 1
            nTop4(m) = 1
            'Exit For
        End If

        For mm = 2 To 4
         If Rank(mm) = m Then
         nTop4(m) = 1
         'Exit For
         End If
        Next mm
        
        For mm = 18 To 20
        
         If Rank(mm) = m Then
         nRelegate(m) = 1
         'Exit For
         End If
        Next mm

    Else
        avePoints(m) = avePoints(m) + tbPoints(m)
        aveW(m) = aveW(m) + tbW(m)
        aveD(m) = aveD(m) + tbD(m)
        aveL(m) = aveL(m) + tbL(m)
        aveGD(m) = aveGD(m) + tbGF(m) - tbGA(m)
        
        If Rank(1) = m Then
            nWinLeague(m) = nWinLeague(m) + 1
            nTop4(m) = nTop4(m) + 1
            'Exit For
        End If

        For mm = 2 To 4
         If Rank(mm) = m Then
         nTop4(m) = nTop4(m) + 1
         'Exit For
         End If
        Next mm
        
        For mm = 18 To 20
        
         If Rank(mm) = m Then
         nRelegate(m) = nRelegate(m) + 1
         'Exit For
         End If
        Next mm

    End If
        
    
Next m

If Int(nMC / 10) * 10 = nMC Then
    Call UpdateMCTable(shtMCSummary, shtSPI, aveW, aveD, aveL, aveGD, nWinLeague, nTop4, nRelegate, nMC, _
    timeStart, minElapsed, secElapsed)
End If

 If nMC = nMCTotal Then
    Unload ufProgress
    'Application.ScreenUpdating = True
End If

If bCancel = True Then
    Call YesNoMessageBox
    If bstop = True Then
        Unload ufProgress
        nMCTotal = nMC
        Exit For
    Else
        bCancel = False
        bstop = False
    End If
End If

Next nMC


Call UpdateMCTable(shtMCSummary, shtSPI, aveW, aveD, aveL, aveGD, nWinLeague, nTop4, nRelegate, nMCTotal, _
timeStart, minElapsed, secElapsed)

'Call UpdateMCTableHTML(shtMCSummaryHTML, shtSPI, aveW, aveD, aveL, aveGD, nWinLeague, nTop4, nRelegate, nMCTotal, _
'timeStart, minElapsed, secElapsed)

Application.ScreenUpdating = False

If bLogo Then
    Call InsertLogo(shtMCSummary, shtDashboard)
End If

Application.ScreenUpdating = True
Range("A1").Select
 

    Sheets(shtTable).Protect ("pineapple")
    Sheets(shtTableNew).Protect ("pineapple")
    Sheets(shtDashboard).Protect ("pineapple")
    Sheets(shtCalendar).Protect ("pineapple")
    Sheets(shtSPI).Protect ("pineapple")
    Sheets(shtMCSummary).Protect ("pineapple")
    'Sheets(shtMCTable).Protect ("pineapple")
    'Sheets(shtMCGF).Protect ("pineapple")
    'Sheets(shtMCGA).Protect ("pineapple")
    'Sheets(shtMCGD).Protect ("pineapple")
    
    'Sheets(shtMCLoss).Protect ("pineapple")
    'Sheets(shtMCDraw).Protect ("pineapple")
    'Sheets(shtMCWin).Protect ("pineapple")
    'Sheets(shtMCPoints).Protect ("pineapple")
    

End Sub

Sub YesNoMessageBox()
 
Dim Answer As String
Dim MyNote As String
 
    'Place your text here
    MyNote = "Do you really want to stop?"
 
    'Display MessageBox
    Answer = MsgBox(MyNote, vbQuestion + vbYesNo, "Confirm")
 
    If Answer = vbNo Then
        'Code for No button Press
        'MsgBox "You pressed NO!"
        bstop = False
    Else
        'Code for Yes button Press
        MsgBox "OK.  Stop now."
        bstop = True
    End If
 
End Sub
Sub UpdateMCTable(shtMCSummary, shtSPI, aveW, aveD, aveL, aveGD, nWinLeague, nTop4, nRelegate, nMCTotal, _
timeStart, minElapsed, secElapsed)

Dim timeNow As Long

    Sheets(shtMCSummary).Select
    
    Application.ScreenUpdating = False
  
    Range("B1:Q21").Select
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Clear
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Add2 Key:=Range( _
        "B2:B21"), SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:= _
        xlSortNormal

    With ActiveWorkbook.Worksheets(shtMCSummary).Sort
        .SetRange Range("B1:Q21")
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
    Range("A1").Select

For m = 1 To 20
    Cells(m + 1, 4) = Sheets(shtSPI).Cells(m + 1, 6)
    Cells(m + 1, 5) = Sheets(shtSPI).Cells(m + 1, 7)
    Cells(m + 1, 6) = Sheets(shtSPI).Cells(m + 1, 5)
    
    Cells(m + 1, 7) = aveW(m) / nMCTotal
    Cells(m + 1, 8) = aveD(m) / nMCTotal
    Cells(m + 1, 9) = aveL(m) / nMCTotal
    Cells(m + 1, 10) = aveGD(m) / nMCTotal
    Cells(m + 1, 12) = nWinLeague(m) / nMCTotal
    Cells(m + 1, 13) = nTop4(m) / nMCTotal
    Cells(m + 1, 14) = nRelegate(m) / nMCTotal
Next m
    
    Sheets(shtMCSummary).Select
    Range("B1:q21").Select
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Clear
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Add2 Key:=Range( _
        "k2:k21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
        xlSortNormal
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Add2 Key:=Range( _
        "j2:j21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
        xlSortNormal
    With ActiveWorkbook.Worksheets(shtMCSummary).Sort
        .SetRange Range("B1:q21")
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

    Application.ScreenUpdating = True
    
    timeNow = Timer
    minElapsed = Int((timeNow - timeStart) / 60)
    secElapsed = Round((timeNow - timeStart - minElapsed * 60), 0)
    
    
    Cells(25, 3) = nMCTotal
    Cells(26, 3) = minElapsed
    Cells(26, 5) = secElapsed
    
    Range("A1").Select
    
'    Sheets("MC Summary").Select
'    Range("B1:O21").Select
'    ActiveWorkbook.Worksheets("MC Summary").Sort.SortFields.Clear
'    ActiveWorkbook.Worksheets("MC Summary").Sort.SortFields.Add2 Key:=Range( _
'        "I2:I21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
'        xlSortNormal
'    ActiveWorkbook.Worksheets("MC Summary").Sort.SortFields.Add2 Key:=Range( _
'        "H2:H21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
'        xlSortNormal
'    With ActiveWorkbook.Worksheets("MC Summary").Sort
'        .SetRange Range("B1:O21")
'        .Header = xlYes
'        .MatchCase = False
'        .Orientation = xlTopToBottom
'        .SortMethod = xlPinYin
'        .Apply
'    End With
'
'    Range("A1").Select
'
End Sub
Sub UpdateMCTableHTML(shtMCSummary, shtSPI, aveW, aveD, aveL, aveGD, nWinLeague, nTop4, nRelegate, nMCTotal, _
timeStart, minElapsed, secElapsed)

Dim timeNow As Long
Dim pctWL, pctT4, pctRel As Integer
Dim strWL, strT4, strRel, sthTable As String
    
    shtTable = "Sheet5"
    
    Sheets(shtMCSummary).Select
        
    Range("A1").Select

For m = 1 To 20

    Cells(m + 1, 2) = Sheets(shtTable).Cells(5 + m, 4)
    Cells(m + 1, 3) = Sheets(shtTable).Cells(5 + m, 3)
    Cells(m + 1, 4) = Sheets(shtSPI).Cells(m + 1, 6)
    Cells(m + 1, 5) = Sheets(shtSPI).Cells(m + 1, 7)
    Cells(m + 1, 6) = Round(aveGD(m) / nMCTotal, 0)
    
    Cells(m + 1, 7) = Round(aveW(m) / nMCTotal * 3 + aveD(m) / nMCTotal, 1)

    pctWL = Round(nWinLeague(m) / nMCTotal * 100, 0)
    pctT4 = Round(nTop4(m) / nMCTotal * 100, 0)
    pctRel = Round(nRelegate(m) / nMCTotal * 100, 0)
    
    If pctWL < 1 Then
        strWL = "<1%"
    ElseIf pctWL > 99 Then
        strWL = ">99%"
    Else
        strWL = pctWL & "%"
    End If
    
    If pctT4 < 1 Then
        strT4 = "<1%"
    ElseIf pctT4 > 99 Then
        strT4 = ">99%"
    Else
        strT4 = pctT4 & "%"
    End If
    
    If pctRel < 1 Then
        strRel = "<1%"
    ElseIf pctRel > 99 Then
        strRel = ">99%"
    Else
        strRel = pctRel & "%"
    End If
    
    Cells(m + 1, 8) = strWL
    Cells(m + 1, 9) = strT4
    Cells(m + 1, 10) = strRel
    
Next m
    
    Sheets(shtMCSummary).Select
    Range("B1:J21").Select
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Clear
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Add2 Key:=Range( _
        "G2:G21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
        xlSortNormal
    ActiveWorkbook.Worksheets(shtMCSummary).Sort.SortFields.Add2 Key:=Range( _
        "F2:F21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
        xlSortNormal
    With ActiveWorkbook.Worksheets(shtMCSummary).Sort
        .SetRange Range("B1:q21")
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
   

    
    Range("A1").Select
    
'    Sheets("MC Summary").Select
'    Range("B1:O21").Select
'    ActiveWorkbook.Worksheets("MC Summary").Sort.SortFields.Clear
'    ActiveWorkbook.Worksheets("MC Summary").Sort.SortFields.Add2 Key:=Range( _
'        "I2:I21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
'        xlSortNormal
'    ActiveWorkbook.Worksheets("MC Summary").Sort.SortFields.Add2 Key:=Range( _
'        "H2:H21"), SortOn:=xlSortOnValues, Order:=xlDescending, DataOption:= _
'        xlSortNormal
'    With ActiveWorkbook.Worksheets("MC Summary").Sort
'        .SetRange Range("B1:O21")
'        .Header = xlYes
'        .MatchCase = False
'        .Orientation = xlTopToBottom
'        .SortMethod = xlPinYin
'        .Apply
'    End With
'
'    Range("A1").Select
'
End Sub

    

   
Sub readSPI(shtName, spi_off, spi_def, subRating, spi_off_ave, spi_def_ave, week, newspiWeek)

For I = 1 To 20
If week = 0 Then
    spi_off(I) = Sheets(shtName).Cells(I + 1, 3)
    spi_def(I) = Sheets(shtName).Cells(I + 1, 4)
Else
    spi_off(I) = Sheets(shtName).Cells(I + 1, 6)
    spi_def(I) = Sheets(shtName).Cells(I + 1, 7)
End If
    subRating(I) = Sheets(shtName).Cells(I + 1, 5)
Next I
    newspiWeek = Sheets(shtName).Cells(22, 7)
spi_off_ave = 0
spi_def_ave = 0
For I = 1 To 20
    spi_off_ave = spi_off_ave + spi_off(I)
    spi_def_ave = spi_def_ave + spi_def(I)
Next I
    spi_off_ave = spi_off_ave / 20
    spi_def_ave = spi_def_ave / 20
End Sub

Sub ModelLeague(bLogo, bPredict, nRows, shtTableNew)
    Dim ii(20), jj(20), nGame(20), Points(20), nMatchwk As Integer
    Dim matchMonthOld(20) As String
    Dim shtTable, shtFixture, shtDashboard, shtCalendar, shtSPI, shtSPIHist As String
    Dim ShtTableHTML As String
    Dim TgSheet As String
    Dim w, h As Integer
    Dim iStart, jStart As Integer
    Dim LastMatchDate(20) As Date
    Dim matchDay As Integer
    Dim matchMonth, matchWkDay As String
    Dim matchTime As String
    Dim ResultHome, ResultAway As String
    Dim GF, GA, HomePoints, AwayPoints As Integer
    Dim matchDate As Date
    Dim HomeTeam, AwayTeam As String
    Dim HomeTeamNext, AwayTeamNext As String
    Dim nTeam, iBlk, jBlk As Integer
    Dim m, n As Integer
    Dim bNewCol As Boolean
    Dim widthCol As Integer
    'Dim TimeZone As String
    Dim TimeCol As Integer
    Dim pic As Object
    Dim nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1 As Integer
    Dim tbPoints(20), tbMP(20), tbW(20), tbD(20), tbL(20), tbGA(20), tbGF(20) As Integer
    Dim Form(20, 5) As String
    Dim nextOppo(20), nextGame(20) As String
    Dim Rank(20) As Integer
    Dim strRange1, strRange2 As String
    Dim bDelete As Boolean
    Dim nRowCal, ntmpRowCal As Integer
    Dim spi_off(20), spi_def(20), subRating(20), spi_off_ave, spi_def_ave As Single
    Dim iHome, iAway, RestDaysHome, RestDaysAway As Integer
    Dim spiGF(380), spiGA(380), homeadvtg As Single
    Dim totalGoals, GoalFactor, AveGoals As Single
    Dim Winpct, DrawPct, LossPct, HomeProb(7), AwayProb(7), HomeProbAcc(7), AwayProbAcc(7) As Single
    Dim HomeRND, AwayRND As Single
    Dim GA_guess, GF_guess, spiWk As Integer
    Dim tmpstring As String
    Dim mblk, nblk As Integer
    
    Application.ScreenUpdating = False
    ufProgress.LabelProgress.Width = 0
    ufProgress.CommandButtonStop.Visible = False
    ufProgress.Show
    
    shtTable = "Sheet5"
    shtFixture = "fixtures"
    TgSheet = "Fixtures_by_Clubs"
    shtDashboard = "Dashboard"
    'shtTableNew = "TableNG"
    'shtTableNew = "Table"
    shtCalendar = "Fixtures_by_Date"
    shtSPI = "SPI"
    shtSPIHist = "SPI_History"
    ShtTableHTML = "TableWeb"

    
    Sheets(TgSheet).Unprotect ("pineapple")
    Sheets(shtTable).Unprotect ("pineapple")
    Sheets(shtTableNew).Unprotect ("pineapple")
    Sheets(shtDashboard).Unprotect ("pineapple")
    Sheets(shtCalendar).Unprotect ("pineapple")
    Sheets(shtSPI).Unprotect ("pineapple")
    Sheets(shtSPIHist).Unprotect ("pineapple")
    Sheets(shtFixture).Unprotect ("pineapple")
    
    Sheets(shtFixture).Range("T2:AV381").ClearContents
    
    If bLogo = True Then
        Sheets(TgSheet).Select
    
        For Each pic In ActiveSheet.Pictures
             pic.Delete
        Next pic
    End If
    
    Sheets(shtTableNew).Activate
    
    TimeZone = Sheets(shtDashboard).Cells(1, 4)
    
    If TimeZone = "UK" Then
        TimeCol = 4
    ElseIf TimeZone = "EST" Then
        TimeCol = 3
    ElseIf TimeZone = "CST" Then
        TimeCol = 5
    ElseIf TimeZone = "MST" Then
        TimeCol = 6
    ElseIf TimeZone = "PST" Then
        TimeCol = 7
    Else
        TimeCol = 4
    End If

    w = 12
    h = 52

    mblk = 20
    nblk = 1

    widthCol = 12

    For I = 1 To 20
        ii(I) = 1
        jj(I) = 1
        matchMonthOld(I) = ""
    Next I
    
    matchMonth = ""
    matchDay = 0
    spi_off_ave = 0
    spi_def_ave = 0
    For I = 1 To 20
        ii(I) = 1
        jj(I) = 1
        nGame(I) = 0
        Points(I) = 0
        matchMonthOld(I) = ""
        tbPoints(I) = 0
        tbMP(I) = 0
        tbW(I) = 0
        tbD(I) = 0
        tbL(I) = 0
        tbGF(I) = 0
        tbGA(I) = 0
        'spi_off(I) = Sheets(shtSPI).Cells(I + 1, 3)
        'spi_def(I) = Sheets(shtSPI).Cells(I + 1, 4)
        'subRating(I) = Sheets(shtSPI).Cells(I + 1, 5)
        'SPI_Off_ave = SPI_Off_ave + spi_off(I)
        'SPI_Def_ave = SPI_Def_ave + spi_def(I)
        For j = 1 To 5
        Form(I, j) = ""
        Next j
        nextOppo(I) = ""
        nextGame(I) = ""
        LastMatchDate(I) = "8 / 1 / 18"
    Next I
    
    Call readSPI(shtSPI, spi_off, spi_def, subRating, spi_off_ave, spi_def_ave, 0, spiWk)
    
    'SPI_Off_ave = SPI_Off_ave / 20
    'SPI_Def_ave = SPI_Def_ave / 20
    homeadvtg = 1.1
    AveGoals = 2.85
    
    'Sheets(TgSheet).Activate
    
    'For Each PIC In ActiveSheet.Pictures
        'PIC.Delete
    'Next PIC
    
    nRowCal = 1
    ntmpRowCal = 1
    
    For I = 1 To 380
    nMatchwk = Sheets(shtFixture).Cells(I + 1, 1)
    matchDate = Sheets(shtFixture).Cells(I + 1, 2)
    HomeTeam = Sheets(shtFixture).Cells(I + 1, 10)
    AwayTeam = Sheets(shtFixture).Cells(I + 1, 13)
    
        For k = 1 To 20
        If HomeTeam = Sheets(shtSPI).Cells(k + 1, 2) Then
            iHome = k
            Exit For
        End If
        Next k
        
        For k = 1 To 20
        If AwayTeam = Sheets(shtSPI).Cells(k + 1, 2) Then
            iAway = k
            Exit For
        End If
        Next k
        
    RestDaysHome = matchDate - LastMatchDate(iHome)
    RestDaysAway = matchDate - LastMatchDate(iAway)
    
    If RestDaysHome > 7 Then RestDaysHome = 7
    If RestDaysAway > 7 Then RestDaysAway = 7
    
    LastMatchDate(iHome) = matchDate
    LastMatchDate(iAway) = matchDate
    
    'If spiWk = nMatchWk Then Call readSPI(shtSPI, spi_off, spi_def, subRating, spi_off_ave, spi_def_ave, 1, spiWk)
        
    Call CalGfGa(spiGF(I), spiGA(I), spi_off(iHome), spi_def(iHome), spi_off(iAway), spi_def(iAway), homeadvtg, RestDaysHome, RestDaysAway, subRating(iHome), subRating(iAway), _
    spi_off_ave, spi_def_ave)
       
    Next I
    
    totalGoals = 0
    For I = 1 To 380
    totalGoals = totalGoals + spiGA(I) + spiGF(I)
    Next I
    GoalFactor = AveGoals / (totalGoals / 380)
    
    For I = 1 To 380
        spiGF(I) = spiGF(I) * GoalFactor
        spiGA(I) = spiGA(I) * GoalFactor
        'Sheets(shtFixture).Cells(I + 1, 20) = spiGF(I)
        'Sheets(shtFixture).Cells(I + 1, 21) = spiGA(I)
    Next I
    
    For I = 1 To 20
        LastMatchDate(I) = "8 / 1 / 18"
    Next I
    
    For I = 1 To 380

    pctdone = I / (380 * 2)
    With ufProgress
        .LabelCaption.Caption = "Calcualte Probability for Game " & I & " of " & "380"
        .LabelProgress.Width = pctdone * (.FrameProgress.Width)
    End With
    
    DoEvents
    
    Sheets(shtTableNew).Activate
    Cells(28, 1) = "Calculating Probability for Game No. " & I

    
    nMatchwk = Sheets(shtFixture).Cells(I + 1, 1)
    matchDate = Sheets(shtFixture).Cells(I + 1, 2)
    HomeTeam = Sheets(shtFixture).Cells(I + 1, 10)
    AwayTeam = Sheets(shtFixture).Cells(I + 1, 13)
    
        For k = 1 To 20
        If HomeTeam = Sheets(shtSPI).Cells(k + 1, 2) Then
            iHome = k
            Exit For
        End If
        Next k
        
        For k = 1 To 20
        If AwayTeam = Sheets(shtSPI).Cells(k + 1, 2) Then
            iAway = k
            Exit For
        End If
        Next k
        
    RestDaysHome = matchDate - LastMatchDate(iHome)
    RestDaysAway = matchDate - LastMatchDate(iAway)
    
    If RestDaysHome > 7 Then RestDaysHome = 7
    If RestDaysAway > 7 Then RestDaysAway = 7
    
    LastMatchDate(iHome) = matchDate
    LastMatchDate(iAway) = matchDate
    
    If spiWk = nMatchwk Then Call readSPI(shtSPI, spi_off, spi_def, subRating, spi_off_ave, spi_def_ave, 1, spiWk)
        
    Call CalGfGa(spiGF(I), spiGA(I), spi_off(iHome), spi_def(iHome), spi_off(iAway), spi_def(iAway), homeadvtg, RestDaysHome, RestDaysAway, subRating(iHome), subRating(iAway), _
    spi_off_ave, spi_def_ave)
    
    'spiGF(I) = spiGF(I) * GoalFactor
    'spiGA(I) = spiGA(I) * GoalFactor
    
    Sheets(shtFixture).Cells(I + 1, 20) = spiGF(I)
    Sheets(shtFixture).Cells(I + 1, 21) = spiGA(I)
    
'    Sheets(shtFixture).Cells(I + 1, 47) = spiGF(I)
'    Sheets(shtFixture).Cells(I + 1, 48) = spiGA(I)
'
'    Sheets(shtFixture).Cells(I + 1, 49) = RestDaysHome
'    Sheets(shtFixture).Cells(I + 1, 50) = RestDaysAway
'
'    Sheets(shtFixture).Cells(I + 1, 51) = spi_off_ave
'    Sheets(shtFixture).Cells(I + 1, 52) = spi_def_ave
'
'    Sheets(shtFixture).Cells(I + 1, 43) = spi_off(iHome)
'    Sheets(shtFixture).Cells(I + 1, 44) = spi_def(iHome)
'    Sheets(shtFixture).Cells(I + 1, 45) = spi_off(iAway)
'    Sheets(shtFixture).Cells(I + 1, 46) = spi_def(iAway)
'
'    Sheets(shtSPIHist).Cells(iHome + 1, nMatchwk * 2 + 1) = spi_off(iHome)
'    Sheets(shtSPIHist).Cells(iHome + 1, nMatchwk * 2 + 2) = spi_def(iHome)
'    Sheets(shtSPIHist).Cells(iAway + 1, nMatchwk * 2 + 1) = spi_off(iAway)
'    Sheets(shtSPIHist).Cells(iAway + 1, nMatchwk * 2 + 2) = spi_def(iAway)
'
        Winpct = 0
        DrawPct = 0
        LossPct = 0
        For m = 0 To 6
            HomeProbAcc(m + 1) = 0
            AwayProbAcc(m + 1) = 0
        Next m
        For m = 0 To 6
            AwayProb(m + 1) = Poisson(spiGA(I), m)
            For p = 0 To m
                AwayProbAcc(m + 1) = AwayProbAcc(m + 1) + AwayProb(p + 1)
            Next p
            For n = 0 To 6
                If m = 0 Then
                    HomeProb(n + 1) = Poisson(spiGF(I), n)
                For p = 0 To n
                    HomeProbAcc(n + 1) = HomeProbAcc(n + 1) + HomeProb(p + 1)
                Next p
                End If
                If m = n Then
                    DrawPct = DrawPct + AwayProb(m + 1) * HomeProb(n + 1)
                ElseIf m < n Then
                    Winpct = Winpct + AwayProb(m + 1) * HomeProb(n + 1)
                Else
                    LossPct = LossPct + AwayProb(m + 1) * HomeProb(n + 1)
                End If
            Next n
        Next m
        Sheets(shtFixture).Cells(I + 1, 22) = Winpct
        Sheets(shtFixture).Cells(I + 1, 23) = DrawPct
        Sheets(shtFixture).Cells(I + 1, 24) = LossPct
        
        If IsEmpty(Sheets(shtFixture).Cells(I + 1, 11)) And IsEmpty(Sheets(shtFixture).Cells(I + 1, 12)) And bPredict = True Then
        
        GF_guess = 6
        GA_guess = 6
        
        Randomize
        HomeRND = Rnd

        
        For m = 0 To 6
        If HomeRND <= HomeProbAcc(m + 1) Then
            GF_guess = m
            Exit For
        End If
        Next m
        
        Randomize
        AwayRND = Rnd
        For m = 0 To 6
        If AwayRND <= AwayProbAcc(m + 1) Then
            GA_guess = m
            Exit For
        End If
        Next m
        
        Else
            GF_guess = Sheets(shtFixture).Cells(I + 1, 11)
            GA_guess = Sheets(shtFixture).Cells(I + 1, 12)
            HomeRND = -1
            AwayRND = -1
        End If
        
        HomeTeam = Sheets(shtFixture).Cells(I + 1, 10)
        AwayTeam = Sheets(shtFixture).Cells(I + 1, 13)
    
        For k = 1 To 20
        If HomeTeam = Sheets(shtSPI).Cells(k + 1, 2) Then
            iHome = k
            Exit For
        End If
        Next k
        
        For k = 1 To 20
        If AwayTeam = Sheets(shtSPI).Cells(k + 1, 2) Then
            iAway = k
            Exit For
        End If
        Next k
    

        
        Sheets(shtFixture).Cells(I + 1, 25) = GF_guess
        Sheets(shtFixture).Cells(I + 1, 26) = GA_guess
        If HomeRND >= 0 Then
            Sheets(shtFixture).Cells(I + 1, 27) = HomeRND
            Sheets(shtFixture).Cells(I + 1, 28) = AwayRND
        Else
            Sheets(shtFixture).Cells(I + 1, 27) = ""
            Sheets(shtFixture).Cells(I + 1, 28) = ""
        End If
        
        Call SPIAdjust(spi_off(iHome), spi_def(iHome), spiGF(I), spiGA(I), GF_guess, GA_guess)
        Call SPIAdjust(spi_off(iAway), spi_def(iAway), spiGA(I), spiGF(I), GA_guess, GF_guess)
        
'        For m = 0 To 6
'            Sheets(shtFixture).Cells(I + 1, 29 + m) = HomeProbAcc(m + 1)
'            Sheets(shtFixture).Cells(I + 1, 36 + m) = AwayProbAcc(m + 1)
'        Next m
        
        
'    Sheets(shtFixture).Cells(I + 1, 43) = spi_off(iHome)
'    Sheets(shtFixture).Cells(I + 1, 44) = spi_def(iHome)
'    Sheets(shtFixture).Cells(I + 1, 45) = spi_off(iAway)
'    Sheets(shtFixture).Cells(I + 1, 46) = spi_def(iAway)
         
    Next I
    
    For I = 1 To 380
    
    If IsEmpty(Sheets(shtFixture).Cells(I + 1, 11)) And IsEmpty(Sheets(shtFixture).Cells(I + 1, 12)) Then
        'Use Guessed score from RND as final score
        Sheets(shtFixture).Cells(I + 1, 11) = Sheets(shtFixture).Cells(I + 1, 25)
        Sheets(shtFixture).Cells(I + 1, 12) = Sheets(shtFixture).Cells(I + 1, 26)
        
        'Use Projected Score as final score
        'Sheets(shtFixture).Cells(I + 1, 11) = Sheets(shtFixture).Cells(I + 1, 18)
        'Sheets(shtFixture).Cells(I + 1, 12) = Sheets(shtFixture).Cells(I + 1, 19)
        
    End If
    
    Next I

    
    For I = 1 To 380
    
    pctdone = (I + 380) / (380 * 2)
    With ufProgress
        .LabelCaption.Caption = "Update Score for Game " & I & " of " & "380"
        .LabelProgress.Width = pctdone * (.FrameProgress.Width)
    End With
    
    DoEvents
    
    Sheets(shtTableNew).Activate
    Cells(28, 1) = "Updating Score for Game No. " & I
    
    nMatchwk = Sheets(shtFixture).Cells(I + 1, 1)
    matchDate = Sheets(shtFixture).Cells(I + 1, 2)
    matchMonth = MonthName(Month(matchDate), False)
    matchDay = Day(matchDate)
    matchWkDay = WeekdayName(Weekday(matchDate), True)
    matchTime = TimeValue(Sheets(shtFixture).Cells(I + 1, TimeCol).Text)
    
    HomeTeam = Sheets(shtFixture).Cells(I + 1, 10)
    AwayTeam = Sheets(shtFixture).Cells(I + 1, 13)
    
    If Not (IsEmpty(Sheets(shtFixture).Cells(I + 1, 11))) And Not (IsEmpty(Sheets(shtFixture).Cells(I + 1, 12))) Then
            
        GF = Sheets(shtFixture).Cells(I + 1, 11)
        GA = Sheets(shtFixture).Cells(I + 1, 12)
        If GF > GA Then
            ResultHome = "W"
            ResultAway = "L"
            HomePoints = 3
            AwayPoints = 0
        ElseIf GF = GA Then
            ResultHome = "D"
            ResultAway = "D"
            HomePoints = 1
            AwayPoints = 1
        Else
            ResultHome = "L"
            ResultAway = "W"
            HomePoints = 0
            AwayPoints = 3
        End If
    Else
        GA = -1
        GF = -1
    End If
    
    'Call FindTeamNo(HomeTeam, nTeam, m, n, iBlk, jBlk)
    
    'iStart = (iBlk - 1) * h
    'jStart = (jBlk - 1) * w
        
    'If ii(nTeam) = 1 Then
        'ii(nTeam) = ii(nTeam) + iStart
        'jj(nTeam) = jj(nTeam) + jStart
        'Cells(ii(nTeam), jj(nTeam)) = HomeTeam
        'ii(nTeam) = ii(nTeam) + 1
        'bNewCol = True
    'End If
           
    'If ii(nTeam) >= iStart + h Then
        'ii(nTeam) = iStart + 4
        'jj(nTeam) = jj(nTeam) + widthCol
        'bNewCol = True
    'End If
        
    'Call WriteTeam(bNewCol, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, "H", GF, GA, ResultHome)
    
    Call FindTeamNo(HomeTeam, nTeam, mblk, nblk, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    
    nGame(nTeam) = nGame(nTeam) + 1

    If GA >= 0 Then
        tbMP(nTeam) = tbMP(nTeam) + 1
        If ResultHome = "W" Then
        tbW(nTeam) = tbW(nTeam) + 1
        ElseIf ResultHome = "D" Then
        tbD(nTeam) = tbD(nTeam) + 1
        Else
        tbL(nTeam) = tbL(nTeam) + 1
        End If
        tbPoints(nTeam) = tbW(nTeam) * 3 + tbD(nTeam)
        tbGF(nTeam) = tbGF(nTeam) + GF
        tbGA(nTeam) = tbGA(nTeam) + GA
        

        Points(nTeam) = Points(nTeam) + HomePoints
        
        For k = 5 To 2 Step -1
            Form(nTeam, k) = Form(nTeam, k - 1)
        Next k
        
        If nGame(nTeam) >= 1 Then
            Form(nTeam, 1) = ResultHome
        End If
                
        If nGame(nTeam) = 38 Then
            nextOppo(nTeam) = ""
            nextGame(nTeam) = ""
        Else
            For k = I + 1 To 380
                HomeTeamNext = Sheets(shtFixture).Cells(k + 1, 10)
                AwayTeamNext = Sheets(shtFixture).Cells(k + 1, 13)
                If HomeTeamNext = HomeTeam Then
                    nextOppo(nTeam) = AwayTeamNext
                    nextGame(nTeam) = "H"
                    Exit For
                ElseIf AwayTeamNext = HomeTeam Then
                    nextOppo(nTeam) = HomeTeamNext
                    nextGame(nTeam) = "A"
                    Exit For
                End If
            Next k
        End If
    ElseIf ii(nTeam) = 1 Then
    
        nextOppo(nTeam) = AwayTeam
        nextGame(nTeam) = "H"
    
    End If


    
    iStart = (iBlk - 1) * h
    jStart = (jBlk - 1) * w

    If ii(nTeam) = 1 Then
        ii(nTeam) = ii(nTeam) + iStart
        jj(nTeam) = jj(nTeam) + jStart
        Sheets(TgSheet).Cells(ii(nTeam), jj(nTeam)) = HomeTeam
        ii(nTeam) = ii(nTeam) + 1
        bNewCol = True
    End If

    If ii(nTeam) >= iStart + h Then
        ii(nTeam) = iStart + 4
        jj(nTeam) = jj(nTeam) + widthCol
        bNewCol = True
    End If


    Call WriteTeam2(TgSheet, bLogo, bNewCol, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, "H", GF, GA, _
    ResultHome, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
        
'    If ii(nTeam) = 1 Then
'        Sheets(HomeTeam).Unprotect ("pineapple")
'        'Sheets(HomeTeam).Select
'        'Columns("G:I").Select
'        'Selection.ClearContents
'        'Columns("L:M").Select
'        'Selection.ClearContents
'        Sheets(HomeTeam).Columns("G:I").ClearContents
'        Sheets(HomeTeam).Columns("L:M").ClearContents
'        'Sheets(HomeTeam).Cells(ii(nTeam), jj(nTeam)) = HomeTeam
'        ii(nTeam) = ii(nTeam) + 1
'    End If
    
    'Call WriteTeamToTeamPage3(HomeTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
    'Call WriteTeamToTeamPage3(HomeTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
'    If nGame(nTeam) = 38 Then
'        Sheets(HomeTeam).Cells(52, 11) = "Time Zone: " & TimeZone
'        Sheets(HomeTeam).Protect ("pineapple")
'    End If
    
    'Call FindTeamNo(AwayTeam, nTeam, m, n, iBlk, jBlk)
    
    'iStart = (iBlk - 1) * h
    'jStart = (jBlk - 1) * w
        
    'If ii(nTeam) = 1 Then
        'ii(nTeam) = ii(nTeam) + iStart
        'jj(nTeam) = jj(nTeam) + jStart
        'Cells(ii(nTeam), jj(nTeam)) = AwayTeam
        'ii(nTeam) = ii(nTeam) + 1
        'bNewCol = True
    'End If
           
    'If ii(nTeam) >= iStart + h Then
        'ii(nTeam) = iStart + 4
        'jj(nTeam) = jj(nTeam) + widthCol
        'bNewCol = True
    'End If

    'Call WriteTeam(bNewCol, HomeTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, "A", GA, GF, ResultAway)
    
    Call FindTeamNo(AwayTeam, nTeam, mblk, nblk, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    
    nGame(nTeam) = nGame(nTeam) + 1
    
    If GA >= 0 Then
        tbMP(nTeam) = tbMP(nTeam) + 1
        If ResultAway = "W" Then
        tbW(nTeam) = tbW(nTeam) + 1
        ElseIf ResultAway = "D" Then
        tbD(nTeam) = tbD(nTeam) + 1
        Else
        tbL(nTeam) = tbL(nTeam) + 1
        End If
        tbPoints(nTeam) = tbW(nTeam) * 3 + tbD(nTeam)
        tbGF(nTeam) = tbGF(nTeam) + GA
        tbGA(nTeam) = tbGA(nTeam) + GF
    
        Points(nTeam) = Points(nTeam) + AwayPoints

        
        For k = 5 To 2 Step -1
            Form(nTeam, k) = Form(nTeam, k - 1)
        Next k
        
        If nGame(nTeam) >= 1 Then
            Form(nTeam, 1) = ResultAway
        End If
        
        If nGame(nTeam) = 38 Then
            nextOppo(nTeam) = ""
            nextGame(nTeam) = ""
        Else
            For k = I + 1 To 380
                HomeTeamNext = Sheets(shtFixture).Cells(k + 1, 10)
                AwayTeamNext = Sheets(shtFixture).Cells(k + 1, 13)
                If HomeTeamNext = AwayTeam Then
                    nextOppo(nTeam) = AwayTeamNext
                    nextGame(nTeam) = "H"
                    Exit For
                ElseIf AwayTeamNext = AwayTeam Then
                    nextOppo(nTeam) = HomeTeamNext
                    nextGame(nTeam) = "A"
                    Exit For
                End If
            Next k
        End If
    ElseIf ii(nTeam) = 1 Then
    
        nextOppo(nTeam) = HomeTeam
        nextGame(nTeam) = "A"
        
           
    End If
    
    iStart = (iBlk - 1) * h
    jStart = (jBlk - 1) * w

    If ii(nTeam) = 1 Then
        ii(nTeam) = ii(nTeam) + iStart
        jj(nTeam) = jj(nTeam) + jStart
        Sheets(TgSheet).Cells(ii(nTeam), jj(nTeam)) = AwayTeam
        ii(nTeam) = ii(nTeam) + 1
        bNewCol = True
    End If

    If ii(nTeam) >= iStart + h Then
        ii(nTeam) = iStart + 4
        jj(nTeam) = jj(nTeam) + widthCol
        bNewCol = True
    End If

    Call WriteTeam2(TgSheet, bLogo, bNewCol, HomeTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, "A", GA, GF, _
    ResultAway, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)

'    If ii(nTeam) = 1 Then
'        Sheets(AwayTeam).Unprotect ("pineapple")
'        'Sheets(AwayTeam).Select
'        'Cells.Select
'        'Selection.ClearContents
'        'Sheets(AwayTeam).Cells(ii(nTeam), jj(nTeam)) = AwayTeam
'        Sheets(AwayTeam).Columns("G:I").ClearContents
'        Sheets(AwayTeam).Columns("L:M").ClearContents
'        ii(nTeam) = ii(nTeam) + 1
'    End If
    

    
    'Call WriteTeamToTeamPage3(AwayTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
    'Call WriteTeamToTeamPage3(AwayTeam, HomeTeam, AwayTeam, ii(nTeam), jj(nTeam), matchMonth, matchMonthOld(nTeam), matchDay, matchWkDay, matchTime, _
    Game, GF, GA, nGame(nTeam), Points(nTeam), nR1, nG1, nB1)
    
'    If nGame(nTeam) = 38 Then
'        Sheets(AwayTeam).Cells(52, 11) = "Time Zone: " & TimeZone
'        Sheets(AwayTeam).Protect ("pineapple")
'    End If
    
Call FillCalendarNew(nRowCal, nRows, shtCalendar, shtFixture, HomeTeam, AwayTeam, GF, GA, matchTime, nMatchwk, TimeZone, n, I)
    
'    For m = nRowCal To 534
'        tmpString = Sheets(shtCalendar).Cells(m, 8)
'        If Left(tmpString, 4) = "Week" Then
'            Sheets(shtCalendar).Cells(m, 8).HorizontalAlignment = xlRight
'            If nMatchWk = Right(tmpString, Len(tmpString) - 5) Then
'                Sheets(shtCalendar).Cells(m + 1, 9) = "W %"
'                Sheets(shtCalendar).Cells(m + 1, 10) = "D %"
'                Sheets(shtCalendar).Cells(m + 1, 11) = "L %"
'                Sheets(shtCalendar).Cells(m + 1, 12) = "GF"
'                Sheets(shtCalendar).Cells(m + 1, 13) = "GA"
'                n = 0
'            End If
'        End If
'        If Sheets(shtCalendar).Cells(m, 2) = HomeTeam And Sheets(shtCalendar).Cells(m, 8) = AwayTeam Then
'                ntmpRowCal = m
'                If GA >= 0 Then
'                    Sheets(shtCalendar).Cells(m, 4) = GF
'                    Sheets(shtCalendar).Cells(m, 6) = GA
'                    Sheets(shtCalendar).Cells(m, 5) = ":"
'                    Sheets(shtCalendar).Cells(m, 1) = matchTime
'                    Sheets(shtCalendar).Cells(m, 9) = Sheets(shtFixture).Cells(I + 1, 22)
'                    Sheets(shtCalendar).Cells(m, 10) = Sheets(shtFixture).Cells(I + 1, 23)
'                    Sheets(shtCalendar).Cells(m, 11) = Sheets(shtFixture).Cells(I + 1, 24)
'                    Sheets(shtCalendar).Cells(m, 12) = Sheets(shtFixture).Cells(I + 1, 20)
'                    Sheets(shtCalendar).Cells(m, 13) = Sheets(shtFixture).Cells(I + 1, 21)
'                    n = n + 1
'                Else
'                    Sheets(shtCalendar).Cells(m, 4) = ""
'                    Sheets(shtCalendar).Cells(m, 6) = ""
'                    Sheets(shtCalendar).Cells(m, 5) = "v"
'                    Sheets(shtCalendar).Cells(m, 1) = matchTime
'                    Sheets(shtCalendar).Cells(m, 9) = Sheets(shtFixture).Cells(I + 1, 22)
'                    Sheets(shtCalendar).Cells(m, 10) = Sheets(shtFixture).Cells(I + 1, 23)
'                    Sheets(shtCalendar).Cells(m, 11) = Sheets(shtFixture).Cells(I + 1, 24)
'                    Sheets(shtCalendar).Cells(m, 12) = Sheets(shtFixture).Cells(I + 1, 20)
'                    Sheets(shtCalendar).Cells(m, 13) = Sheets(shtFixture).Cells(I + 1, 21)
'                    n = n + 1
'                End If
'
'        If n = 10 Then
'            Sheets(shtCalendar).Cells(m + 1, 1) = "Time Zone:" & TimeZone
'            'Sheets(shtCalendar).Cells(m + 1, 13) = ""
'            Sheets(shtCalendar).Cells(m + 1, 1).Font.Size = 10
'            Sheets(shtCalendar).Cells(m + 1, 1).HorizontalAlignment = xlLeft
'        End If
'
'        End If
'
'
'    Next m
'
'    nRowCal = ntmpRowCal

     If I = 380 Then
        Unload ufProgress
      End If

    
    Next I

    'Application.ScreenUpdating = True

    ni = 5
    nj = 8
    
    For I = 1 To 20
        Sheets(shtTable).Cells(ni + I, nj + 1) = tbMP(I)
        Sheets(shtTable).Cells(ni + I, nj + 2) = tbW(I)
        Sheets(shtTable).Cells(ni + I, nj + 3) = tbD(I)
        Sheets(shtTable).Cells(ni + I, nj + 4) = tbL(I)
        Sheets(shtTable).Cells(ni + I, nj + 5) = tbGF(I)
        Sheets(shtTable).Cells(ni + I, nj + 6) = tbGA(I)
        Sheets(shtTable).Cells(ni + I, nj + 7) = tbGF(I) - tbGA(I)
        Sheets(shtTable).Cells(ni + I, nj + 8) = tbPoints(I)
        For k = 5 To 1 Step -1
            Sheets(shtTable).Cells(ni + I, nj + 15 - k) = Form(I, k)
        Next k
        Sheets(shtTable).Cells(ni + I, nj + 15) = nextOppo(I)
        Sheets(shtTable).Cells(ni + I, nj + 16) = nextGame(I)
    Next I



For I = 1 To 20
    Rank(I) = I
Next I


'If nGameTotal > 0 Then
For m = 1 To 20
    Sheets(shtTable).Cells(ni + m, nj - 3) = Rank(m)
Next m
maxRank = 1
For I = 1 To 20

maxRankOld = maxRank
'tempPoints = Sheets(shtTable).Cells(ni + Rank(i), nj + 9)
tempPoints = -99
    For k = I To 20
    If Sheets(shtTable).Cells(ni + Rank(k), nj + 9) > tempPoints Then
        tempPoints = Sheets(shtTable).Cells(ni + Rank(k), nj + 9)
        maxRank = Rank(k)
    End If
    Next k
    

    For p = I To 20
    If Rank(p) = maxRank Then
    Index = p
    Exit For
    End If
    Next p
    
    For p = Index To I + 1 Step -1
    
    Rank(p) = Rank(p - 1)
    
    Next p
    
    
    Rank(I) = maxRank


Next I

'End If

If shtTableNew = "TableNG" Then
    Call UpdateTableNG(shtTableNew, shtTable, Rank, ni, nj)
Else
    Call UpdateTable(shtTableNew, shtTable, Rank, ni, nj, "")
'    Call UpdateHTMLTable(ShtTableHTML, shtTable, Rank, ni, nj)
End If

    Sheets(shtTableNew).Activate
    Cells(28, 1) = ""
    Application.ScreenUpdating = True
    
    Sheets(TgSheet).Protect ("pineapple")
    Sheets(shtTable).Protect ("pineapple")
    Sheets(shtTableNew).Protect ("pineapple")
    Sheets(shtDashboard).Protect ("pineapple")
    Sheets(shtCalendar).Protect ("pineapple")
    Sheets(shtSPI).Protect ("pineapple")
    Sheets(shtSPIHist).Protect ("pineapple")
    Sheets(shtFixture).Protect ("pineapple")

End Sub

Sub WriteTeamToTeamPage(Team, Home, Away, ii, jj, Month, MonthOld, Day, WkDay, Time, Game, GF, GA, nGame, Points, nR1, nG1, nB1)

    Dim PicPath, PicFileName, TempFile As String
    Dim pic As Object
  
    PicPath = "D:\Users\Jie\Pictures\premier league\logo\small\"
                
        If Month <> MonthOld Then
            Sheets(Team).Cells(ii, jj) = Month
            Sheets(Team).Cells(ii, jj).Font.Bold = True
            MonthOld = Month
            ii = ii + 1
        End If
        
        Sheets(Team).Cells(ii, jj + 1) = Day
        Sheets(Team).Cells(ii, jj + 2) = WkDay
        Sheets(Team).Cells(ii, jj + 3) = Time
        Sheets(Team).Cells(ii, jj + 4) = Home
        
        If GA <> -1 Then
            Sheets(Team).Cells(ii, jj + 6) = GF
            Sheets(Team).Cells(ii, jj + 7) = ":"
            Sheets(Team).Cells(ii, jj + 8) = GA
            Sheets(Team).Cells(nGame + 3, jj + 11) = nGame
            Sheets(Team).Cells(nGame + 3, jj + 11).Font.Color = RGB(nR1, nG1, nB1)
            Sheets(Team).Cells(nGame + 3, jj + 12) = Points
            Sheets(Team).Cells(nGame + 3, jj + 12).Font.Color = RGB(nR1, nG1, nB1)
            
        End If
        
        Sheets(Team).Cells(ii, jj + 10) = Away


            
            Sheets(Team).Select
            
            If ii = 3 Then
            For Each pic In ActiveSheet.Pictures
                pic.Delete
            Next pic
            End If
            
            PicFileName = PicPath & Home & ".png"
            TempFile = Dir(PicFileName)
            If Len(TempFile) = 0 Then
            PicFileName = PicPath & "Chelsea.png"
            End If
            
            With ActiveSheet.Pictures.Insert(PicFileName)
                With .ShapeRange
                .LockAspectRatio = msoTrue
                '.Width = 7.5
                .Height = 12
                End With

                .Left = Cells(ii, jj + 5).Left + (Cells(ii, jj + 5).Width - .Width) / 2
                .Top = Cells(ii, jj + 5).Top + (Cells(ii, jj + 5).Height - .Height) / 2
                .Placement = 1
                .PrintObject = True

            End With
            
            PicFileName = PicPath & Away & ".png"
            TempFile = Dir(PicFileName)
            If Len(TempFile) = 0 Then
            PicFileName = PicPath & "Chelsea.png"
            End If

            With ActiveSheet.Pictures.Insert(PicFileName)
                With .ShapeRange
                .LockAspectRatio = msoTrue
                '.Width = 7.5
                .Height = 12
                End With

                .Left = Cells(ii, jj + 9).Left + (Cells(ii, jj + 9).Width - .Width) / 2
                .Top = Cells(ii, jj + 9).Top + (Cells(ii, jj + 9).Height - .Height) / 2
                .Placement = 1
                .PrintObject = True

            End With


        
        ii = ii + 1

End Sub
Sub WriteTeamToTeamPage2(Team, Home, Away, ii, jj, Month, MonthOld, Day, WkDay, Time, Game, GF, GA, nGame, Points, nR1, nG1, nB1)

    Dim PicPath, PicFileName, TempFile As String
    Dim pic As Object
    Dim str1, str2 As String
  
    'PicPath = "D:\Users\Jie\Pictures\premier league\logo\small\"
                
        If Month <> MonthOld Then
            Sheets(Team).Cells(ii, jj) = Month
            Sheets(Team).Cells(ii, jj).Font.Bold = True
            MonthOld = Month
            ii = ii + 1
        End If
        
        Sheets(Team).Cells(ii, jj + 1) = Day
        Sheets(Team).Cells(ii, jj + 2) = WkDay
        Sheets(Team).Cells(ii, jj + 3) = Time
        Sheets(Team).Cells(ii, jj + 4) = Home
        
        If GA <> -1 Then
            Sheets(Team).Cells(ii, jj + 6) = GF
            Sheets(Team).Cells(ii, jj + 7) = ":"
            Sheets(Team).Cells(ii, jj + 8) = GA
            Sheets(Team).Cells(nGame + 3, jj + 11) = nGame
            Sheets(Team).Cells(nGame + 3, jj + 11).Font.Color = RGB(nR1, nG1, nB1)
            Sheets(Team).Cells(nGame + 3, jj + 12) = Points
            Sheets(Team).Cells(nGame + 3, jj + 12).Font.Color = RGB(nR1, nG1, nB1)
            
        End If
        
        Sheets(Team).Cells(ii, jj + 10) = Away


            
            Sheets(Team).Select
            
            If ii = 3 Then
            For Each pic In ActiveSheet.Pictures
                pic.Delete
            Next pic
            End If
            
        Sheets("Dashboard").Select
        
        For m = 1 To 20
        If Home = Cells(m + 1, 2) Then
        str1 = Cells(m + 1, 4)
        Exit For
        End If
        Next m
        
        ActiveSheet.Shapes.Range(Array(str1)).Select
        Selection.Copy
        Sheets(Team).Select
        
        str2 = "F" & ii
        Range(str2).Select
        ActiveSheet.Paste

        Selection.ShapeRange.Height = 12.96
        Selection.ShapeRange.IncrementLeft (Columns("f").Width - Selection.ShapeRange.Width) / 2
        Selection.ShapeRange.IncrementTop (Range(str2).Height - Selection.ShapeRange.Height) / 2
        
        Sheets("Dashboard").Select
        
        For m = 1 To 20
        If Away = Cells(m + 1, 2) Then
        str1 = Cells(m + 1, 4)
        Exit For
        End If
        Next m
        
        ActiveSheet.Shapes.Range(Array(str1)).Select
        Selection.Copy
        Sheets(Team).Select
        
        str2 = "J" & ii
        Range(str2).Select
        ActiveSheet.Paste

        Selection.ShapeRange.Height = 12.96
        Selection.ShapeRange.IncrementLeft (Columns("J").Width - Selection.ShapeRange.Width) / 2
        Selection.ShapeRange.IncrementTop (Range(str2).Height - Selection.ShapeRange.Height) / 2



        
        ii = ii + 1

End Sub
Sub WriteTeamToTeamPage3(Team, Home, Away, ii, jj, Month, MonthOld, Day, WkDay, Time, Game, GF, GA, nGame, Points, nR1, nG1, nB1)

    Dim PicPath, PicFileName, TempFile As String
    Dim pic As Object
    Dim str1, str2 As String
  
                
        If Month <> MonthOld Then
            'Sheets(Team).Cells(ii, jj) = Month
            'Sheets(Team).Cells(ii, jj).Font.Bold = True
            MonthOld = Month
            ii = ii + 1
        End If
        
        'Sheets(Team).Cells(ii, jj + 1) = Day
        'Sheets(Team).Cells(ii, jj + 2) = WkDay
        Sheets(Team).Cells(ii, jj + 3) = Time
        'Sheets(Team).Cells(ii, jj + 4) = Home
        
        If GA <> -1 Then
            Sheets(Team).Cells(ii, jj + 6) = GF
            Sheets(Team).Cells(ii, jj + 7) = ":"
            Sheets(Team).Cells(ii, jj + 8) = GA
            Sheets(Team).Cells(nGame + 2, jj + 11) = nGame
            Sheets(Team).Cells(nGame + 2, jj + 11).Font.Color = RGB(nR1, nG1, nB1)
            Sheets(Team).Cells(nGame + 2, jj + 12) = Points
            Sheets(Team).Cells(nGame + 2, jj + 12).Font.Color = RGB(nR1, nG1, nB1)
            
        End If
        
        'Sheets(Team).Cells(ii, jj + 10) = Away
        
        ii = ii + 1

End Sub

Sub WriteTeam(bLogo, bNewCol, Oppo, ii, jj, Month, MonthOld, Day, WkDay, Time, Game, GF, GA, Result)
    Dim PicPath, PicFileName, TempFile As String
  
    PicPath = "D:\Users\Jie\Pictures\premier league\logo\small\"
        
        If bNewCol = True Then
            Cells(ii, jj) = Month
            MonthOld = Month
            ii = ii + 1
            bNewCol = False
        End If
        
        If Month <> MonthOld Then
            Cells(ii, jj) = Month
            MonthOld = Month
            ii = ii + 1
        End If
        
        If bLogo = True Then
            Cells(ii, jj) = Day
            Cells(ii, jj).Font.Bold = False
            Cells(ii, jj + 1) = WkDay
            Cells(ii, jj).Font.Bold = False
            Cells(ii, jj + 2) = Time
            Cells(ii, jj + 2).NumberFormat = "hh:mm"
            Cells(ii, jj + 4) = Oppo
            Cells(ii, jj + 5) = Game
        End If
        
        If GA <> -1 Then
            Cells(ii, jj + 6) = GF
            Cells(ii, jj + 7) = ":"
            Cells(ii, jj + 8) = GA
            Cells(ii, jj + 9) = Result
        Else
            Cells(ii, jj + 6) = ""
            Cells(ii, jj + 7) = ""
            Cells(ii, jj + 8) = ""
            Cells(ii, jj + 9) = ""
        End If
        
        If bLogo = True Then
        
            PicFileName = PicPath & Oppo & ".png"
            TempFile = Dir(PicFileName)
            If Len(TempFile) = 0 Then
            PicFileName = PicPath & "Chelsea.png"
            End If
            
            With ActiveSheet.Pictures.Insert(PicFileName)
                With .ShapeRange
                .LockAspectRatio = msoTrue
                '.Width = 7.5
                .Height = 20
                End With

                .Left = Cells(ii, jj + 3).Left + (Cells(ii, jj + 1).Width - .Width) / 2
                .Top = Cells(ii, jj + 3).Top + (Cells(ii, jj + 1).Height - .Height) / 2
                .Placement = 1
                .PrintObject = True

            End With
        
        End If

        
        ii = ii + 1

End Sub
Sub WriteTeam2(shtTgt, bLogo, bNewCol, Oppo, ii, jj, Month, MonthOld, Day, WkDay, Time, Game, GF, GA, Result, nGame, Points, nR1, nG1, nB1)
    Dim PicPath, PicFileName, TempFile As String
  
    'PicPath = "D:\Users\Jie\Pictures\premier league\logo\small\"
        
        If bNewCol = True Then
            Sheets(shtTgt).Cells(ii, jj) = Month
            Sheets(shtTgt).Cells(ii, jj).Font.Bold = True
            MonthOld = Month
            ii = ii + 1
            bNewCol = False
        End If
        
        If Month <> MonthOld Then
            Sheets(shtTgt).Cells(ii, jj) = Month
            Sheets(shtTgt).Cells(ii, jj).Font.Bold = True
            MonthOld = Month
            ii = ii + 1
        End If
        
        'If bLogo = True Then
            Sheets(shtTgt).Cells(ii, jj) = Day
            Sheets(shtTgt).Cells(ii, jj).Font.Bold = False
            Sheets(shtTgt).Cells(ii, jj + 1) = WkDay
            Sheets(shtTgt).Cells(ii, jj).Font.Bold = False
            Sheets(shtTgt).Cells(ii, jj + 2) = Time
            Sheets(shtTgt).Cells(ii, jj + 2).NumberFormat = "hh:mm"
            Sheets(shtTgt).Cells(ii, jj + 4) = Oppo
            Sheets(shtTgt).Cells(ii, jj + 5) = Game
            

        'End If
        
        If GA <> -1 Then
            Sheets(shtTgt).Cells(ii, jj + 6) = GF
            Sheets(shtTgt).Cells(ii, jj + 7) = ":"
            Sheets(shtTgt).Cells(ii, jj + 8) = GA
            Sheets(shtTgt).Cells(ii, jj + 9) = Result
            Sheets(shtTgt).Cells(nGame + 2, jj + 10) = nGame
            Sheets(shtTgt).Cells(nGame + 2, jj + 10).Font.Color = RGB(nR1, nG1, nB1)
            Sheets(shtTgt).Cells(nGame + 2, jj + 11) = Points
            Sheets(shtTgt).Cells(nGame + 2, jj + 11).Font.Color = RGB(nR1, nG1, nB1)
        Else
            Sheets(shtTgt).Cells(ii, jj + 6) = ""
            Sheets(shtTgt).Cells(ii, jj + 7) = ""
            Sheets(shtTgt).Cells(ii, jj + 8) = ""
            Sheets(shtTgt).Cells(ii, jj + 9) = ""
            Sheets(shtTgt).Cells(nGame + 2, jj + 10) = ""
            Sheets(shtTgt).Cells(nGame + 2, jj + 11) = ""
        End If
        
'        If bLogo = True Then
'
'            PicFileName = PicPath & Oppo & ".png"
'            TempFile = Dir(PicFileName)
'            If Len(TempFile) = 0 Then
'            PicFileName = PicPath & "Chelsea.png"
'            End If
'
'            With ActiveSheet.Pictures.Insert(PicFileName)
'                With .ShapeRange
'                .LockAspectRatio = msoTrue
'                '.Width = 7.5
'                .Height = 20
'                End With
'
'                .Left = Cells(ii, jj + 3).Left + (Cells(ii, jj + 1).Width - .Width) / 2
'                .Top = Cells(ii, jj + 3).Top + (Cells(ii, jj + 1).Height - .Height) / 2
'                .Placement = 1
'                .PrintObject = True
'
'            End With
'
'        End If

        If bLogo = True Then

        Call InsertSingleLogoByCopy(shtTgt, ii, jj + 3, Oppo)

        End If

        
        
        ii = ii + 1
        
        If nGame = nMaxGames Then Sheets(shtTgt).Cells(ii + 2, jj) = TimeZone & " Time"
        

End Sub

Sub FindTeamNo(Team, nTeam, m, n, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    Dim shtTable As String
    Dim ni, nj As Integer
    Dim tmpTeam As String
    
    
    shtTable = "Sheet5"
    ni = 5
    nj = 8
    
    nTeam = 1
    
    For I = 1 To 20
        tmpTeam = Sheets(shtTable).Cells(ni + I, nj)
        If Team = tmpTeam Then
            nTeam = I

            nR = Sheets(shtTable).Cells(ni + I, 27)
            nG = Sheets(shtTable).Cells(ni + I, 28)
            nB = Sheets(shtTable).Cells(ni + I, 29)
            
            nRf = Sheets(shtTable).Cells(ni + I, 30)
            nGf = Sheets(shtTable).Cells(ni + I, 31)
            nBf = Sheets(shtTable).Cells(ni + I, 32)
            
            nR1 = Sheets(shtTable).Cells(ni + I, 33)
            nG1 = Sheets(shtTable).Cells(ni + I, 34)
            nB1 = Sheets(shtTable).Cells(ni + I, 35)
            
            nRf1 = Sheets(shtTable).Cells(ni + I, 36)
            nGf1 = Sheets(shtTable).Cells(ni + I, 37)
            nBf1 = Sheets(shtTable).Cells(ni + I, 38)
                    
            iBlk = Int((nTeam - 1) / m) + 1
            jBlk = nTeam - (iBlk - 1) * m
            
        'If nTeam <= 10 Then
            'iBlk = 1
            'jBlk = nTeam
        'Else
            'iBlk = 2
            'jBlk = nTeam - 10
        'End If
        
        
            Exit For
        End If
    Next I
End Sub

Sub PlotChartMain()
Dim team1, team2, team3 As String
Dim mblk, nblk As Integer
Dim nTeam1, nTeam2, nTeam3 As Integer
Dim nC1, nC2, nC3 As Integer
Dim strCx1, strCx2, strCx3 As String
Dim strCy1, strCy2, strCy3 As String
Dim iBlk, jBlk As Integer
Dim nR, nG, nB As Integer
Dim nRf, nGf, nBf As Integer
Dim nR1, nG1, nB1 As Integer
Dim nRf1, nGf1, nBf1 As Integer
Dim shtTableNew, shtFixtures_by_Clubs As String


h = 52
w = 12
mblk = 20
nblik = 1

shtFixtures_by_Clubs = "Fixtures_by_Clubs"


    ActiveSheet.Unprotect ("pineapple")

    
    strTemp = ActiveSheet.Name
    
    If strTemp = "TableNG" Then
        ActiveSheet.ChartObjects("Chart 1").Activate
    Else
        ActiveSheet.ChartObjects("Chart 1").Activate
    End If

    
    team1 = ActiveSheet.Cells(19, 22)
    team2 = ActiveSheet.Cells(20, 22)
    team3 = ActiveSheet.Cells(21, 22)
    
    Call FindTeamNo(team1, nTeam1, mblk, nblk, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    nC1 = (jBlk - 1) * w + 11
    strCx1 = Split(Sheets(shtFixtures_by_Clubs).Cells(1, nC1).Address, "$")(1)
    strCy1 = Split(Sheets(shtFixtures_by_Clubs).Cells(1, nC1 + 1).Address, "$")(1)
    
     'MsgBox team1 & "Column " & nC1 & " = Column " & strCx1 & " " & strCy1
    
    Call FindTeamNo(team2, nTeam2, mblk, nblk, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    nC2 = (jBlk - 1) * w + 11
    strCx2 = Split(Sheets(shtFixtures_by_Clubs).Cells(1, nC2).Address, "$")(1)
    strCy2 = Split(Sheets(shtFixtures_by_Clubs).Cells(1, nC2 + 1).Address, "$")(1)
    
    Call FindTeamNo(team3, nTeam3, mblk, nblk, iBlk, jBlk, nR, nG, nB, nRf, nGf, nBf, nR1, nG1, nB1, nRf1, nGf1, nBf1)
    nC3 = (jBlk - 1) * w + 11
    strCx3 = Split(Sheets(shtFixtures_by_Clubs).Cells(1, nC3).Address, "$")(1)
    strCy3 = Split(Sheets(shtFixtures_by_Clubs).Cells(1, nC3 + 1).Address, "$")(1)
    
    ActiveChart.Axes(xlValue).MajorGridlines.Select
    
    string1 = team1
    string2 = "=" & "'" & shtFixtures_by_Clubs & "'" & "!$" & strCx1 & "$3:$" & strCx1 & "$40"
    string3 = "=" & "'" & shtFixtures_by_Clubs & "'" & "!$" & strCy1 & "$3:$" & strCy1 & "$40"
    
    ActiveChart.FullSeriesCollection(1).Name = string1
    ActiveChart.FullSeriesCollection(1).XValues = string2
    ActiveChart.FullSeriesCollection(1).Values = string3
    
    string1 = team2
    string2 = "=" & "'" & shtFixtures_by_Clubs & "'" & "!$" & strCx2 & "$3:$" & strCx2 & "$40"
    string3 = "=" & "'" & shtFixtures_by_Clubs & "'" & "!$" & strCy2 & "$3:$" & strCy2 & "$40"
    
    ActiveChart.FullSeriesCollection(2).Name = string1
    ActiveChart.FullSeriesCollection(2).XValues = string2
    ActiveChart.FullSeriesCollection(2).Values = string3
    
    string1 = team3
    string2 = "=" & "'" & shtFixtures_by_Clubs & "'" & "!$" & strCx3 & "$3:$" & strCx3 & "$40"
    string3 = "=" & "'" & shtFixtures_by_Clubs & "'" & "!$" & strCy3 & "$3:$" & strCy3 & "$40"
    
    ActiveChart.FullSeriesCollection(3).Name = string1
    ActiveChart.FullSeriesCollection(3).XValues = string2
    ActiveChart.FullSeriesCollection(3).Values = string3
    

    
End Sub
Sub PlotChart2(team1, team2, team3)
    Dim team1, team2, team3 As String
    Dim string1, string2, string3, strTemp As String
    
    ActiveSheet.Unprotect ("pineapple")

    
    strTemp = ActiveSheet.Name
    
    If strTemp = "TableNG" Then
        ActiveSheet.ChartObjects("Chart 1").Activate
    Else
        ActiveSheet.ChartObjects("Chart 7261").Activate
    End If
    ActiveChart.Axes(xlValue).MajorGridlines.Select
    
    string1 = "=" & "'" & team1 & "'" & "!$A$1"
    string2 = "=" & "'" & team1 & "'" & "!$L$3:$L$40"
    string3 = "=" & "'" & team1 & "'" & "!$M$3:$M$40"

    ActiveChart.FullSeriesCollection(1).Name = string1
    ActiveChart.FullSeriesCollection(1).XValues = string2
    ActiveChart.FullSeriesCollection(1).Values = string3
    
    string1 = "=" & "'" & team2 & "'" & "!$A$1"
    string2 = "=" & "'" & team2 & "'" & "!$L$3:$L$40"
    string3 = "=" & "'" & team2 & "'" & "!$M$3:$M$40"
    
    ActiveChart.FullSeriesCollection(2).Name = string1
    ActiveChart.FullSeriesCollection(2).XValues = string2
    ActiveChart.FullSeriesCollection(2).Values = string3
    
    string1 = "=" & "'" & team3 & "'" & "!$A$1"
    string2 = "=" & "'" & team3 & "'" & "!$L$3:$L$40"
    string3 = "=" & "'" & team3 & "'" & "!$M$3:$M$40"
    
    ActiveChart.FullSeriesCollection(3).Name = string1
    ActiveChart.FullSeriesCollection(3).XValues = string2
    ActiveChart.FullSeriesCollection(3).Values = string3

    
    Range("A1").Select
    ActiveSheet.Protect ("pineapple")


End Sub

Attribute VB_Name = "Module2"
Sub ListPic()

I = 1
For Each pic In ActiveSheet.Pictures
    Cells(I + 1, 3) = pic.TopLeftCell.Address
    Cells(I + 1, 4) = pic.Name
    I = I + 1
Next pic

End Sub

Sub deletePIC()
For Each pic In ActiveSheet.Pictures
    If InStr(pic.TopLeftCell.Address, "AR") = 0 Then pic.Delete
Next pic
End Sub
Attribute VB_Name = "Module3"
Sub Macro1()
Attribute Macro1.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Macro1 Macro
'

'
    ActiveSheet.ChartObjects("Chart 1").Activate
    ActiveSheet.Shapes.Range(Array("Picture 6")).Select
    Selection.Placement = xlMoveAndSize
    Range("R3").Select
    ActiveSheet.Shapes.Range(Array("Picture 8")).Select
    Selection.Placement = xlMoveAndSize
    Range("R8").Select
    ActiveWorkbook.Save
End Sub
Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet24"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet26"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ufProgress"
Attribute VB_Base = "0{9563F4E8-3E02-4CB1-A52E-0331F130B5F4}{9FF311DE-0B63-44B5-9C59-515D48AACB8F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButtonStop_Click()
    bCancel = True
End Sub


INQUEST-PP=macro
