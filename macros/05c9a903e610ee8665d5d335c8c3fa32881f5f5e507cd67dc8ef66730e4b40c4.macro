Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CheckBox1, 11, 1, MSForms, CheckBox"
'Option Explicit
Private Sub CommandButton1_Click()
    UserForm2.Show
End Sub

Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton2, 9, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 10, 1, MSForms, CommandButton"
Private Sub CommandButton1_Click()
'|fffd||479||fffd||fffd||53c||fffd||bc||fffd||fffd||fffd||fffd|
    Dim zmh As Long
    Application.ScreenUpdating = False
    With Sheet2
    .Unprotect
    .Range("J4:J65536").ClearContents
    zmh = .Range("D65536").End(xlUp).Row
    If CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||531||fffd||5be||fffd||fffd||fffd||fffd|" Then
        CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        .Range("A4:K" & zmh).Sort Key1:=.Range("H3"), Order1:=xlAscending, Header:=xlContinuous
    Else
        CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||531||fffd||5be||fffd||fffd||fffd||fffd|"
        For i = 5 To zmh
            .Cells(i, 10) = Application.WorksheetFunction.SumIf(.Range("H5:H" & zmh), .Cells(i, 8), .Range("F5:F" & zmh))
        Next i
        .Range("J4") = "|fffd||fffd||fffd|"
        .Range("A4:J" & zmh).Sort Key1:=.Range("J4"), Order1:=xlAscending, Header:=xlContinuous
        .Range("J4:J" & zmh).ClearContents
    End If
    ChangeClor
    .Protect contents:=True
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub CommandButton2_Click()
'|221||fffd||fffd||fffd||fffd||fffd||fffd|
    Dim J As Double, h As Double, sum_jh As Double, sum_jf As Double, sum_df As Double
    Application.ScreenUpdating = False
    sum_jh = 0
    sum_jf = 0
    sum_df = 0
    s = 0
     yh_MaxRow = Sheet1.Range("D65536").End(xlUp).Row
    qy_MaxRow = Sheet1.Range("N65536").End(xlUp).Row
    With Sheet2
        .Unprotect
        mycell = ActiveWindow.RangeSelection.Address
        For i = 1 To ActiveWindow.RangeSelection.Areas.count
            qsh = ActiveWindow.RangeSelection.Areas(i).Row
            For J = 1 To ActiveWindow.RangeSelection.Areas(i).Rows.count
                s = s + 1
                sum_jh = sum_jh + Val(.Cells(qsh + J - 1, 8))
                sum_jf = sum_jf + Val(.Cells(qsh + J - 1, 6))  '|fffd||8dfd||fffd||fffd||fffd|
                sum_df = sum_df + Val(.Cells(qsh + J - 1, 7))  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            Next J
        Next i

        c = sum_jh / s - Val(.Cells(qsh, 8))
        If c <> 0 Then
            ms = MsgBox("|fffd||fffd||461||fffd||fffd||fffd||fffd||fffd||432||fffd||fffd||fffd||fffd||ee5||fffd||fffd||fffd||fffd||fffd||423||fffd||fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||523||fffd||fffd||fffd| ", vbDefaultButton1 + vbExclamation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2")
            .Range(mycell).Select
        Else
            If sum_jf <> sum_df Then
                ms = MsgBox("|461||fffd||fffd||fffd||fffd||fffd||43d||fffd||fffd||fffd||fffd||fffd||fffd||ecbb||fffd||223||fffd||fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||523||fffd||fffd||fffd| ", vbDefaultButton1 + vbExclamation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2")
                .Range(mycell).Select
            Else
                '|225||fffd||fffd||fffd||fffd||fffd||771||fffd||fffd||fffd||139||fffd||fffd||531||fffd||5be|
                Sheet1.Range("H:H,R:R").Replace What:=.Cells(qsh, 8), Replacement:="", LookAt:=xlWhole, _
                                                SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                                ReplaceFormat:=False
                Sheet1.Range("H:H,R:R").Replace What:="", Replacement:="", LookAt:=xlPart
                Sheet1.Range("A4:I" & yh_MaxRow).AutoFilter Field:=8, Criteria1:="="
                Sheet1.Range("I5:I" & yh_MaxRow).ClearContents
                Sheet1.Range("A4:I" & yh_MaxRow).AutoFilter
                Sheet1.Range("K4:S" & qy_MaxRow).AutoFilter Field:=8, Criteria1:="="
                Sheet1.Range("S5:S" & qy_MaxRow).ClearContents
                Sheet1.Range("K4:S" & qy_MaxRow).AutoFilter
                sxwdz    '|2e2||fffd||fffd||3b4||fffd||fffd||fffd||fffd|
                'ChangeClor    '|fffd||fffd||fffd||f8||fffd||2bd|
                If Sheet1.CheckBox1 = True Then
                    |fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|
                End If
                .Range("A1").Select
                Application.ScreenUpdating = True
                ms = MsgBox("|fffd||fffd||fffd||6ce4||fffd||663||fffd||fffd||473||fffd||fffd||fffd||461||fffd||fffd||fffd||139||fffd||fffd||53c||fffd||bc||fffd||fffd||fffd||fffd| ", vbOKOnly + vbInformation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
            End If
        End If
        .Protect contents:=True
    End With
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton3, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton4, 2, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton5, 3, 2, MSForms, CommandButton"
Attribute VB_Control = "CommandButton6, 4, 3, MSForms, CommandButton"
Attribute VB_Control = "CommandButton7, 5, 4, MSForms, CommandButton"
Attribute VB_Control = "CheckBox1, 10, 5, MSForms, CheckBox"
Attribute VB_Control = "CommandButton1, 7, 6, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 8, 7, MSForms, CommandButton"
Attribute VB_Control = "CheckBox2, 19, 8, MSForms, CheckBox"
'Private Sub CheckBox2_Change()
'  If CheckBox2.Value = True Then
'     Sheet1.Range("I4,S4").Value = "|fffd||5b9||fffd||fffd||fffd||fffd||fffd|"
'  Else
'    Sheet1.Range("I4,S4").Value = ""
'  End If
'End Sub



Private Sub CommandButton1_Click()
'|fffd||fffd||3b4||fffd||fffd||fffd||2fd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    Application.ScreenUpdating = False
    With Sheet3
        .Unprotect
        zmh1 = .Range("D65536").End(xlUp).Row
        zmh2 = .Range("N65536").End(xlUp).Row
        If CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
            For i = 5 To zmh1
                .Cells(i, 8) = .Cells(i, 6) + .Cells(i, 7)
            Next i
            For J = 5 To zmh2
                .Cells(J, 18) = .Cells(J, 16) + .Cells(J, 17)
            Next J
            .Range("A4:H" & zmh1).Sort Key1:=.Range("H4"), Order1:=xlAscending, Key2:=.Range("D4"), Order2:=xlAscending, Header:=xlGuess
            .Range("K4:R" & zmh2).Sort Key1:=.Range("R4"), Order1:=xlAscending, Key2:=.Range("N4"), Order2:=xlAscending, Header:=xlGuess
            .Range("H5:H65536").ClearContents
            .Range("R5:R65536").ClearContents
            CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        Else
            If CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
                .Range("A4:H" & zmh1).Sort Key1:=.Range("D4"), Order1:=xlAscending, Key2:=.Range("F4"), Order2:=xlAscending, Key3:=.Range("G4"), Order2:=xlAscending, Header:=xlGuess
                .Range("K4:R" & zmh2).Sort Key1:=.Range("N4"), Order1:=xlAscending, Key2:=.Range("Q4"), Order2:=xlAscending, Key3:=.Range("P4"), Order2:=xlAscending, Header:=xlGuess
                CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            Else
                .Range("A4:H" & zmh1).Sort Key1:=.Range("A4"), Order1:=xlAscending, Header:=xlGuess
                .Range("K4:R" & zmh2).Sort Key1:=.Range("K4"), Order1:=xlAscending, Header:=xlGuess
                CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            End If

        End If
        .Protect contents:=True
    End With
    Application.ScreenUpdating = True
End Sub

Private Sub CommandButton2_Click()
'|278||461||3b4||fffd||fffd||fffd||2f5||fffd||5b8||fffd||fffd||fffd||fffd||fffd|
    On Error Resume Next

    If CommandButton2.Caption = "|fffd||fffd||fffd||fffd||fffd||278||461|" Then
        CommandButton2.Caption = "|fffd||fffd||2be||22b||fffd||fffd|"
        UserForm3.Show
    Else
        Sheet3.Unprotect
        Sheet3.ShowAllData
        CommandButton2.Caption = "|fffd||fffd||fffd||fffd||fffd||278||461|"
        Sheet3.Protect contents:=True
    End If
End Sub

Private Sub CommandButton3_Click()
'|fffd||fffd||fffd||fffd||2e2||fffd||fffd||3b4||fffd||fffd||fffd||fffd|
    sxwdz
End Sub

Private Sub CommandButton4_Click()
'sg|3b4||fffd||fffd||fffd||fffd|
    Dim J As Double, jh As Double, sum_yhjf As Double, sum_yhdf As Double, sum_qyjf As Double, sum_qydf As Double, y_end As Integer
    Application.ScreenUpdating = False
    sum_yhjf = 0
    sum_yhdf = 0
    sum_qyjf = 0
    sum_qydf = 0

    'On Error Resume Next

    With Sheet3
        y_end = .Range("D65536").End(xlUp).Row    '|fffd||fffd||fffd||fffd||3b4||fffd||fffd||fffd||fffd||fffd||fffd||fffd||775||fffd||fffd||fffd||129||fffd||435||fffd||fffd||43a||fffd|
        q_end = .Range("N65536").End(xlUp).Row    '|fffd||fffd||4b5||3b4||fffd||fffd||fffd||fffd||fffd||fffd||fffd||775||fffd||fffd||fffd||129||fffd||435||fffd||fffd||43a||fffd|

        sum_yhjf = Application.WorksheetFunction.SumIf(.Range("H5:H" & y_end), "<>", .Range("F5:F" & y_end))
        sum_yhdf = Application.WorksheetFunction.SumIf(.Range("H5:H" & y_end), "<>", .Range("G5:G" & y_end))
        sum_qyjf = Application.WorksheetFunction.SumIf(.Range("R5:R" & q_end), "<>", .Range("p5:p" & q_end))
        sum_qydf = Application.WorksheetFunction.SumIf(.Range("R5:R" & q_end), "<>", .Range("q5:q" & q_end))

        If Round(sum_yhjf, 2) - Round(sum_yhdf, 2) = Round(sum_qydf, 2) - Round(sum_qyjf, 2) Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||223||fffd||fffd||fffd|sg|fffd||fffd||fffd||fffd||fffd||fffd|
            For J = 5 To y_end    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||437||fffd|sg|fffd||fffd||fffd||fffd|
                If .Cells(J, 8) <> "" Then    '|fffd||fffd||fffd||531||fffd||1f2||fffd||3aa|0|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||774||fffd||fffd||3f9||fffd||fffd||531||fffd||1f2||fffd||fffd||fffd||fffd||1b5||fffd||fffd||479||fffd||fffd||531||fffd|
                    MyXh = Sheet3.Cells(J, 1)
                    If .CheckBox1.Value = True Then
                        LeiBei = Left(MyXh, 2)
                        If LeiBei = "qy" Then
                            MyRow = Sheet1.Range("K:K").Find(MyXh, LookIn:=xlValues).Row
                            JH_yh = Application.WorksheetFunction.Max(Sheet2.Range("H4:H65536"))    '|13f||1f0||fffd||fffd||fffd||139||fffd||fffd||531||fffd||5be|
                            jh = JH_yh + 1
                            Sheet1.Cells(MyRow, 18) = jh
                            If CheckBox2.Value = True Then
                                Sheet1.Cells(MyRow, 19) = "sg"
                            End If
                        Else
                            MyRow = Sheet1.Range("A:A").Find(MyXh, LookIn:=xlValues).Row
                            JH_yh = Application.WorksheetFunction.Max(Sheet2.Range("H4:H65536"))    '|13f||1f0||fffd||fffd||fffd||139||fffd||fffd||531||fffd||5be|
                            jh = JH_yh + 1
                            Sheet1.Cells(MyRow, 8) = jh
                            If CheckBox2.Value = True Then
                                Sheet1.Cells(MyRow, 9) = "sg"
                            End If
                        End If
                    Else
                        MyRow = Sheet1.Range("A:A").Find(MyXh, LookIn:=xlValues).Row
                        JH_yh = Application.WorksheetFunction.Max(Sheet2.Range("H4:H65536"))    '|13f||1f0||fffd||fffd||fffd||139||fffd||fffd||531||fffd||5be|
                        jh = JH_yh + 1
                        Sheet1.Cells(MyRow, 8) = jh
                        If CheckBox2.Value = True Then
                            Sheet1.Cells(MyRow, 9) = "sg"
                        End If
                    End If
                End If
            Next J

            For i = 5 To q_end    '|fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||fffd|sg|fffd||fffd||fffd||fffd|
                If .Cells(i, 18) <> "" Then    '|fffd||fffd|i|fffd||531||fffd||1f2||fffd||3aa|0|fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||774||fffd||fffd||3f9||fffd||fffd||531||fffd||1f2||fffd||fffd||fffd||fffd||1b5||fffd||fffd||479||fffd||fffd||531||fffd|
                    MyXh = Sheet3.Cells(i, 11)
                    MyRow = Sheet1.Range("K:K").Find(MyXh, LookIn:=xlValues).Row
                    JH_yh = Application.WorksheetFunction.Max(Sheet2.Range("H4:H65536"))    '|13f||1f0||fffd||fffd||fffd||139||fffd||fffd||531||fffd||5be|
                    jh = JH_yh + 1
                    Sheet1.Cells(MyRow, 18) = jh
                    If CheckBox2.Value = True Then
                        Sheet1.Cells(MyRow, 19) = "sg"
                    End If
                End If
            Next i
            sxwdz    '|2e2||fffd||fffd||3b4||fffd||fffd||fffd||fffd|
            'ChangeClor    '|fffd||fffd||fffd||f8||fffd||2bd|
            If Sheet1.CheckBox1 = True Then
                |fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|
            End If
        Else
            ms = MsgBox("|fffd||2e74||fffd||535||13c||fffd||bc||fffd||fffd||fffd||fffd||fffd||ecbb||fffd||fffd||223||fffd||fffd||fffd||fffd||98e1|", vbOKOnly + vbCritical, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        End If

    End With

    Application.ScreenUpdating = True
End Sub

Private Sub CommandButton5_Click()
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||6b2||fffd||fffd||fffd||fffd||fffd|
    Dim J As Double, h As Double, sum_jf As Double, sum_df As Double
    Application.ScreenUpdating = False

    sum_jf = 0
    sum_df = 0
    mycell = ActiveWindow.RangeSelection.Address

    If ActiveWindow.RangeSelection.Areas(1).Column > 8 Then
        ms = MsgBox("|461||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||461||fffd||fffd||fffd||fffd||fffd||436||fffd||fffd||2f5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||a3863||fffd| ", vbDefaultButton1 + vbExclamation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        End
    End If
    For i = 1 To ActiveWindow.RangeSelection.Areas.count
        qsh = ActiveWindow.RangeSelection.Areas(i).Row
        For J = 1 To ActiveWindow.RangeSelection.Areas(i).Rows.count
            sum_jf = sum_jf + Val(Cells(qsh + J - 1, 6))  '|fffd||8dfd||fffd||fffd||fffd|
            sum_df = sum_df + Val(Cells(qsh + J - 1, 7))  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Next J
    Next i

    If sum_jf <> sum_df Then
        ms = MsgBox("|461||fffd||fffd||fffd||fffd||fffd||43d||fffd||fffd||fffd||fffd||fffd||fffd||ecbb||fffd||fffd||4e6||fffd||fffd||fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||523||fffd||fffd||fffd| ", vbDefaultButton1 + vbExclamation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        Sheet3.Range(mycell).Select
    Else
        JH_yh = Application.WorksheetFunction.Max(Sheet2.Range("H4:H65536"))    '|13f||1f0||fffd||fffd||fffd||139||fffd||fffd||531||fffd||5be|
        jh = JH_yh + 1
        For i = 1 To ActiveWindow.RangeSelection.Areas.count
            qsh = ActiveWindow.RangeSelection.Areas(i).Row
            For J = 1 To ActiveWindow.RangeSelection.Areas(i).Rows.count
                s = qsh + J - 1
                MyXh = Sheet3.Cells(s, 1)
                MyRow = Sheet1.Range("A:A").Find(MyXh, LookIn:=xlValues).Row
                Sheet1.Cells(MyRow, 8) = jh
                If CheckBox2.Value = True Then
                    Sheet1.Cells(MyRow, 9) = "sg"
                End If
            Next J
        Next i
        sxwdz    '|2e2||fffd||fffd||3b4||fffd||fffd||fffd||fffd|
        'ChangeClor    '|fffd||fffd||fffd||f8||fffd||2bd|
        If Sheet1.CheckBox1 = True Then
            |fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|
        End If
        Sheet3.Range("A1").Select
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub CommandButton6_Click()
'|fffd||57c||fffd||fffd||fffd||fffd||6b2||fffd||fffd||fffd||fffd||fffd|
    Dim J As Double, h As Double, sum_jh As Double, sum_jf As Double, sum_df As Double
    Application.ScreenUpdating = False

    sum_jh = 0
    sum_jf = 0
    sum_df = 0
    s = 0

    mycell = ActiveWindow.RangeSelection.Address

    If ActiveWindow.RangeSelection.Areas(1).Column < 11 Then
        ms = MsgBox("|461||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||461||fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd||fffd||57c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||a3863||fffd| ", vbDefaultButton1 + vbExclamation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        End
    End If
    For i = 1 To ActiveWindow.RangeSelection.Areas.count
        qsh = ActiveWindow.RangeSelection.Areas(i).Row
        For J = 1 To ActiveWindow.RangeSelection.Areas(i).Rows.count
            sum_jf = sum_jf + Val(Cells(qsh + J - 1, 16))  '|fffd||8dfd||fffd||fffd||fffd|
            sum_df = sum_df + Val(Cells(qsh + J - 1, 17))  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Next J
    Next i



    If sum_jf <> sum_df Then
        ms = MsgBox("|461||fffd||fffd||fffd||fffd||fffd||43d||fffd||fffd||fffd||fffd||fffd||fffd||ecbb||fffd||fffd||4e6||fffd||fffd||fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||523||fffd||fffd||fffd| ", vbDefaultButton1 + vbExclamation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        Sheet3.Range(mycell).Select
    Else
        JH_yh = Application.WorksheetFunction.Max(Sheet2.Range("H4:H65536"))    '|13f||1f0||fffd||fffd||fffd||139||fffd||fffd||531||fffd||5be|
        jh = JH_yh + 1
        For i = 1 To ActiveWindow.RangeSelection.Areas.count
            qsh = ActiveWindow.RangeSelection.Areas(i).Row
            For J = 1 To ActiveWindow.RangeSelection.Areas(i).Rows.count
                s = qsh + J - 1
                MyXh = Sheet3.Cells(s, 11)
                MyRow = Sheet1.Range("K:K").Find(MyXh, LookIn:=xlValues).Row
                Sheet1.Cells(MyRow, 18) = jh
                If CheckBox2.Value = True Then
                    Sheet1.Cells(MyRow, 19) = "sg"
                End If
            Next J
        Next i
        sxwdz    '|2e2||fffd||fffd||3b4||fffd||fffd||fffd||fffd|
        'ChangeClor    '|fffd||fffd||fffd||f8||fffd||2bd|
        If Sheet1.CheckBox1 = True Then
            |fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|
        End If
        Sheet3.Range("A1").Select
    End If

    Sheet2.Protect contents:=True
    Sheet3.Protect contents:=True
    Application.ScreenUpdating = True
End Sub

Private Sub CommandButton7_Click()

    If CommandButton7.Caption = "|fffd||1bc||fffd||4bb||fffd||536||fffd|" Then
        CommandButton7.Caption = "|fffd||fffd||fffd||fffd||56a||4aa||fffd||1bc||fffd|"
        |fffd||1bc||fffd||4bb||fffd||536||fffd|
    Else
        CommandButton7.Caption = "|fffd||1bc||fffd||4bb||fffd||536||fffd|"
        |fffd||fffd||fffd||fffd||56a||4aa||fffd||1bc||fffd|
    End If



End Sub
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton2, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 2, 1, MSForms, CommandButton"
Private Sub CommandButton1_Click()
'|fffd||fffd||129||fffd||fffd||fffd||fffd|
    Application.ScreenUpdating = False
    tjb_end = Sheet4.Range("A65536").End(xlUp).Row - 1   '|fffd||fffd||fffd||6b1||fffd||fffd||fffd||fffd||fffd||129||fffd||fffd|
    p = Round(Sheet4.Cells(tjb_end, 6) - Sheet4.Cells(tjb_end, 13), 2)

    If p = 0 Then
        msg = "|fffd||fffd||fffd||4aa||fffd||fffd||fffd||43d||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||771||fffd||fffd||fffd|" & vbCrLf
        msg = msg & "|fffd||479||fffd||fffd||53c||fffd||bc||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3b4||fffd||fffd||fffd||2fd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4bb||fffd||6a3||fffd||fffd||fffd|"
        ms = MsgBox(msg, vbOKCancel + vbDefaultButton2 + vbQuestion, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        If ms = vbOK Then
            Sheet3.Unprotect
            Sheet2.Unprotect
            msg = "|fffd||fffd||fffd||fffd||1f0||fffd||1f7||71e37||771||fffd||fffd||fffd||fffd||fffd||fffd||763||fffd|" & vbCrLf
            msg = msg & "|fffd||fffd||4aa||fffd||fffd||fffd||fffd||fffd||bc34||fffd||fffd||237||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            ms = MsgBox(msg, vbOKCancel + vbDefaultButton1 + vbQuestion, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
            If ms = vbOK Then
                If Sheet4.Range("M5") = "" Then
                    ms = MsgBox("|3aa||fffd||fffd||fffd||fffd||237||fffd||fffd||fffd||fffd||fffd||775||fffd||fffd||13c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|M5|fffd||fffd||52a||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||b7||77a||fffd||fffd||67d||fffd||5ea||fffd||fffd|", vbOKOnly + vbCritical, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
                    End
                End If
                mypath = ActiveWorkbook.Path
                bakname = Sheet4.Range("M5").Value & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||6b1||fffd||fffd||fffd||fffd||fffd|.XLS"
                yfbak = mypath & "\" & bakname
                fondfile = Dir(yfbak)
                If fondfile <> "" Then
                    Kill yfbak
                End If
                ActiveWorkbook.SaveCopyAs yfbak
            End If

            Sheet1.Range("A5:R65536").ClearContents
            zmh = Sheet2.Range("D65536").End(xlUp).Row
            For i = 5 To zmh
                Sheet2.Cells(i, 8).Value = Sheet4.Range("M5").Value & "-" & Sheet2.Cells(i, 8).Value
            Next i
            zmh5 = Sheet5.Range("D65536").End(xlUp).Row
            Sheet5.Unprotect
            Sheet2.Range("A5:H" & zmh).Copy Destination:=Sheet5.Cells(zmh5 + 1, 1)
            Sheet5.Protect contents:=True
            Sheet2.Range("A5:R65536").ClearContents
            Sheet3.Range("A5:R10000").Copy
            Sheet1.Range("A5").PasteSpecial Paste:=xlValues
            Sheet1.Activate
            Sheet1.Range("A1").Select
            Sheet3.Range("A5:R65536").ClearContents
            Sheet4.Range("A10:M65536,F8:F9,M8:M9,M5").ClearContents
            Sheet4.Activate
        End If
        Sheet3.Protect contents:=True
        Sheet2.Protect contents:=True
    Else
        ms = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||2eb||fffd||fffd||fffd||fffd||ecbb||fffd||fffd||223||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2e3||fffd|", vbOKOnly + vbCritical, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        End
    End If
    Application.ScreenUpdating = True
End Sub

Private Sub CommandButton2_Click()
'|fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|
    |fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|

    y_end = Sheet4.Range("F65536").End(xlUp).Row
    If Round(Sheet4.Cells(y_end, 6), 2) = Round(Sheet4.Cells(y_end, 13), 2) Then
        ms = MsgBox("|fffd||fffd||3f2||fffd||fffd||3f2||fffd||fffd||fffd||fffd||fffd||6b1||fffd||fffd||fffd||fffd||fffd||fffd||263||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2eb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||223||fffd|", vbOKOnly + vbInformation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
    End If
End Sub
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 1, 0, MSForms, CommandButton"
Private Sub CommandButton1_Click()
'|fffd||fffd||1f0||fffd||fffd||fffd||479||fffd||fffd||53c||fffd||bc||fffd||fffd||fffd||fffd|
    Dim zmh As Long
    Application.ScreenUpdating = False
    With Sheet5
        .Unprotect
        .Range("J4:J65536").ClearContents
        zmh = .Range("D65536").End(xlUp).Row
        If CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||531||fffd||5be||fffd||fffd||fffd||fffd|" Then
            CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            Range("A4:K" & zmh).Sort Key1:=.Range("H3"), Order1:=xlAscending, Header:=xlContinuous
        Else
            CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||531||fffd||5be||fffd||fffd||fffd||fffd|"
            For i = 5 To zmh
                .Cells(i, 10) = Application.WorksheetFunction.SumIf(.Range("H5:H" & zmh), .Cells(i, 8), .Range("F5:F" & zmh))
            Next i
            .Range("J4") = "|fffd||fffd||fffd|"
            .Range("A4:J" & zmh).Sort Key1:=.Range("J4"), Order1:=xlAscending, Header:=xlContinuous
            .Range("J4:J" & zmh).ClearContents
        End If
        ChangeClor2
        .Protect contents:=True
    End With
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()
    On Error Resume Next
    Application.WindowState = xlMaximized
    Sheet6.Activate
    UserForm1.Show

End Sub

Attribute VB_Name = "UserForm1"
Attribute VB_Base = "0{24565398-5648-4156-B1E8-7FFA670EBC77}{47978AD7-32C8-4B89-B046-6C6D722A66EF}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False





Private Sub Label12_Click()
    Link = "http://aluo.blog.esnai.com"
    On Error GoTo errorhandle
    ActiveWorkbook.FollowHyperlink Address:=Link, NewWindow:=True
    Exit Sub
errorhandle:
    MsgBox "|fffd||fffd||2b1||fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||4e3||fffd||fffd||fffd||fffd||53a||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||777||fffd||fffd||132||fffd||fffd||361||fffd|"
End Sub


Private Sub Label16_Click()
    Link = "http://392028647.qzone.qq.com"
    On Error GoTo errorhandle
    ActiveWorkbook.FollowHyperlink Address:=Link, NewWindow:=True
    Exit Sub
errorhandle:
    MsgBox "|fffd||fffd||2b1||fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||4e3||fffd||fffd||fffd||fffd||53a||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||777||fffd||fffd||fffd|QQ|fffd||57c||4871|"
End Sub

Private Sub Label6_Click()
    Link = "http://aluo.blog.esnai.com"
    On Error GoTo errorhandle
    ActiveWorkbook.FollowHyperlink Address:=Link, NewWindow:=True
    Exit Sub
errorhandle:
    MsgBox "|fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||4e3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||53a||fffd||fffd||675||fffd||bc||fffd||fffd||fffd||fffd||fffd||777||fffd||fffd||132||fffd||fffd||361||fffd|"
End Sub



Private Sub UserForm_Activate()
    Application.OnTime Now + TimeValue("00:00:10"), "killform"
End Sub

Attribute VB_Name = "UserForm2"
Attribute VB_Base = "0{D57EDB4A-0042-4504-AE91-045E67CE15F1}{D193EA94-AD0F-426B-9B4A-5B0AAB65A4DB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub CommandButton1_Click()

    Dim arr_hh()    '|fffd||fffd||fffd|Key|5b5||fffd||138||fffd||fffd||43a||fffd|
    Dim arr_yh_yigou() As Long, arr_qy_yigou() As Long
    Dim arr_yh_xh() As String, arr_qy_xh() As String    '|fffd||536||fffd||fffd||fffd||fffd|
    Dim sg_yh()    '|fffd||5b9||fffd||fffd||fffd||fffd||531||fffd||5be|
    Dim sg_qy()


    DuoBiSG = False
    Unload Me
    yh_MaxRow = Sheet1.Range("D65536").End(xlUp).Row
    qy_MaxRow = Sheet1.Range("N65536").End(xlUp).Row
    If yh_MaxRow = 4 Or qy_MaxRow = 4 Then
        ms = MsgBox("|fffd||fffd||fffd||43b||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd||fffd||763||fffd||fffd||7b7||fffd||fffd||fffd||fffd||523||fffd|", vbOKCancel + vbDefaultButton2 + vbQuestion, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        End
    End If
    msg = "|3f5||373||fffd||fffd||fffd||fffd||fffd||fffd||fffd||536||fffd||fffd||fffd||fffd||523||fffd||fffd||fffd||fffd||fffd||fffd||536||fffd||fffd||fffd|" & vbCrLf
    msg = msg & "|fffd||53d||fffd||221||fffd||fffd||52d||fffd||5b9||fffd||fffd||fffd||fffd||53c||fffd||bc||fffd||fffd||fffd||1f7||fffd||fffd||fffd||fffd||fffd||fffd|"
    ms = MsgBox(msg, vbOKCancel + vbDefaultButton2 + vbQuestion, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
    If ms = vbCancel Then
        End
    End If

    t = Timer
    If CheckBox1.Value = True Then    '|fffd||fffd||fffd||fffd||36c||fffd||fffd||fffd||136||fffd||2bc||fffd||bc||fffd||fffd||fffd||fffd||fffd||5b9||fffd||fffd||fffd||fffd||fffd|
        DuoBiSG = True
    End If
    If CheckBox4.Value = True Then    '|fffd||fffd||fffd||fffd||fffd||5b9||fffd||fffd||fffd||fffd||fffd||fffd||131||fffd||5be|
        BaoLiuSG = True
    End If
    Application.ScreenUpdating = False
    Sheet2.Unprotect
    Sheet3.Unprotect

    Set dict = CreateObject("Scripting.Dictionary")
    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||27e||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||13f||578||618b6||fffd||fffd||163||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5a3||fffd||fffd||fffd||fffd||131||fffd||fffd||375||fffd||fffd||fffd||fffd||5a3||fffd||5ea||fffd||fffd||fffd||271||fffd||5fc||fffd||fffd||fffd||fffd||5b5||fffd||fffd||fffd||53c||fffd||fffd||fffd||fffd||fffd||bc||5f0||fffd||fffd||fffd||5b5||fffd||fffd||fffd||fffd||fffd||9863|
    With Sheet1
        .Range("F:G,P:Q").Replace What:="--", Replacement:="", LookAt:=xlPart, _
                                  SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                  ReplaceFormat:=False
        .Range("F:G,P:Q").Replace What:=" ", Replacement:="", LookAt:=xlPart, _
                                  SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                  ReplaceFormat:=False
        .Range("F:G,P:Q").Replace What:="|fffd||fffd|", Replacement:="", LookAt:=xlPart, _
                                  SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                  ReplaceFormat:=False
        .Range("F:G,P:Q").Replace What:=",", Replacement:="", LookAt:=xlPart, _
                                  SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                  ReplaceFormat:=False
        .Range("F:G,P:Q").Replace What:="|fffd||fffd|", Replacement:="", LookAt:=xlPart, _
                                  SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                  ReplaceFormat:=False
        .Range("F:G,P:Q").Replace What:="0", Replacement:="", LookAt:=xlWhole, _
                                  SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                  ReplaceFormat:=False
        .Range("F:G,P:Q").NumberFormatLocal = "#,##0.00_ "
        .Range("F:G") = .Range("F:G").Value
        .Range("P:Q") = .Range("P:Q").Value


        ReDim arr_yh_yigou(1 To yh_MaxRow)    '|fffd||fffd||fffd||43c||fffd||bc||fffd||fffd||fffd||531||fffd||5be||fffd||fffd||fffd||fffd||fffd||fffd|
        ReDim arr_qy_yigou(1 To qy_MaxRow)    '|fffd||fffd||4b5||fffd||fffd||bc||fffd||fffd||fffd||531||fffd||5be||fffd||fffd||fffd||fffd||fffd||fffd|
        ReDim sg_yh(1 To yh_MaxRow)
        ReDim sg_qy(1 To qy_MaxRow)
        If BaoLiuSG = True Then
             For i = 1 To yh_MaxRow - 4
                If .Cells(i + 4, 9).Value = "sg" Then
                   arr_yh_yigou(i) = .Cells(i + 4, 8).Value
                   sg_yh(i) = "sg"
                End If
             Next i

             For i = 1 To qy_MaxRow - 4
                If .Cells(i + 4, 19).Value = "sg" Then
                   arr_qy_yigou(i) = .Cells(i + 4, 18).Value
                   sg_qy(i) = "sg"
                End If
             Next i
             max1 = arr_yh_yigou
             max2 = arr_qy_yigou
             biaozhi = Application.Max(max1, max2)
        Else
        biaozhi = 0
        End If
            .Range("H5:I65536").Clear
            .Range("R5:S65536").Clear
        arr_yhjf = .Range("F5:F" & yh_MaxRow)    '|fffd||fffd||4aa||fffd||fffd||fffd||535||fffd||fffd||fffd||fffd||43d||8dfd||fffd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|yh_jf
        arr_yhdf = .Range("G5:G" & yh_MaxRow)
        arr_qyjf = .Range("P5:P" & qy_MaxRow)    '|fffd||fffd||4aa||fffd||fffd||fffd||535||fffd||fffd||fffd||4b5||fffd||8dfd||fffd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|qy_jf
        arr_qydf = .Range("Q5:Q" & qy_MaxRow)
    End With

    yhjf_wygs = 0    '|fffd||fffd||fffd||43d||8dfd||fffd||fffd||3a8||4bb||5b5||fffd||138||fffd||fffd||fffd|
    dict_xh = 0
    


    '***********************************************************************
    '|fffd||fffd||fffd||b4||fffd||fffd||bf6b||fffd||fffd||fffd||43d||8dfd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||5b5||fffd|dict|fffd||fffd||fffd||fffd||fffd||fffd||fffd||43a||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|arr_hh
    For y = LBound(arr_yhjf) To UBound(arr_yhjf)
        MyKey = arr_yhjf(y, 1)
        If MyKey <> 0 And MyKey <> "" Then
            If Not dict.exists(MyKey) Then    '|fffd||fffd||fffd||fffd||5b5||fffd||fffd||fffd||fb||fffd||434||fffd||5b5|
                yhjf_wygs = yhjf_wygs + 1
                dict_xh = yhjf_wygs    '|fffd||fffd||fffd||5b5||fffd||fffd||435||fffd||fffd||fffd||fffd|
                dict.Add MyKey, dict_xh
                ReDim Preserve arr_hh(yhjf_wygs)    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|Key|fffd||fffd||fffd||fffd||fffd||fffd||fffd||43a||fffd|
                ReDim row_hh(1 To 1)
                row_hh(1) = y + 4
                arr_hh(yhjf_wygs) = row_hh
            Else
                dict_xh = dict.Item(MyKey)    '|fffd||fffd||fffd||5b5||fffd||fffd||435||fffd||fffd||fffd||fffd|
                row_hh = arr_hh(dict_xh)
                cfgs = UBound(arr_hh(dict_xh)) + 1    '|fffd||638||fffd||5b5||fffd||138||fffd||fffd||fffd|
                ReDim Preserve row_hh(1 To cfgs)
                row_hh(cfgs) = y + 4
                arr_hh(dict_xh) = row_hh
            End If
        End If
    Next y

    '|fffd||fffd||fffd||b4||fffd||fffd||bf6b||fffd||fffd||4b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b5||48e8||fffd||fffd||fffd||43d||8dfd||fffd||fffd||fffd||e74||fffd||fffd|
    For qd = LBound(arr_qydf) To UBound(arr_qydf)
        MyKey = arr_qydf(qd, 1)
        If MyKey <> 0 Or MyKey <> "" Then
            If dict.exists(MyKey) Then
                dict_xh = dict.Item(MyKey)    '|fffd||fffd||fffd||5b5||fffd||fffd||435||fffd||fffd||fffd||fffd|
                row_hh = arr_hh(dict_xh)
                cfgs = UBound(row_hh)     '|fffd||638||fffd||5b5||fffd||138||fffd||fffd||fffd|

                If DuoBiSG = True Then
                    qygs = Application.CountIf(Sheet1.Range("Q5:Q" & qy_MaxRow), MyKey)    '|fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd||fffd||435||138||fffd||fffd||fffd|
                    If Not (qygs > 1 Or cfgs > 1) Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd||5b5||fffd||179||fffd||fffd||523||fffd||fffd||fffd||fffd||fffd||fffd||539||fffd|
                        For y = 1 To cfgs
                            MyHh = row_hh(y)    '|fffd||43a||fffd|
                            If arr_yh_yigou(MyHh - 4) = 0 Then
                                If Val(TextBox1.Text) <> 0 Then    '|fffd||fffd||fffd||fffd||43c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||436||fffd|
                                    jg = Abs(DateValue(Sheet1.Cells(qd + 4, 14)) - DateValue(Sheet1.Cells(MyHh, 4))) - Val(TextBox1.Text)
                                    If jg < 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||5b8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||17d||fffd||fffd||439||fffd||fffd||fffd|
                                        If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                            If Sheet1.Cells(qd + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                                biaozhi = biaozhi + 1
                                                arr_yh_yigou(MyHh - 4) = biaozhi
                                                arr_qy_yigou(qd) = biaozhi
                                                Exit For
                                            End If
                                        Else
                                            biaozhi = biaozhi + 1
                                            arr_yh_yigou(MyHh - 4) = biaozhi
                                            arr_qy_yigou(qd) = biaozhi
                                            Exit For
                                        End If
                                    End If
                                Else
                                    If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                        If Sheet1.Cells(qd + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                            biaozhi = biaozhi + 1
                                            arr_yh_yigou(MyHh - 4) = biaozhi
                                            arr_qy_yigou(qd) = biaozhi
                                            Exit For
                                        End If
                                    Else
                                        biaozhi = biaozhi + 1
                                        arr_yh_yigou(MyHh - 4) = biaozhi
                                        arr_qy_yigou(qd) = biaozhi
                                        Exit For
                                    End If

                                End If
                            End If
                        Next y
                    End If
                Else
                    For y = 1 To cfgs
                        MyHh = row_hh(y)    '|fffd||43a||fffd|
                        If arr_yh_yigou(MyHh - 4) = 0 Then
                            If Val(TextBox1.Text) <> 0 Then    '|fffd||fffd||fffd||fffd||43c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||436||fffd|
                                jg = Abs(DateValue(Sheet1.Cells(qd + 4, 14)) - DateValue(Sheet1.Cells(MyHh, 4))) - Val(TextBox1.Text)
                                If jg < 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||5b8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||17d||fffd||fffd||439||fffd||fffd||fffd|
                                    If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                        If Sheet1.Cells(qd + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                            biaozhi = biaozhi + 1
                                            arr_yh_yigou(MyHh - 4) = biaozhi
                                            arr_qy_yigou(qd) = biaozhi
                                            Exit For
                                        End If
                                    Else
                                        biaozhi = biaozhi + 1
                                        arr_yh_yigou(MyHh - 4) = biaozhi
                                        arr_qy_yigou(qd) = biaozhi
                                        Exit For
                                    End If

                                End If
                            Else
                                If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                    If Sheet1.Cells(qd + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                        biaozhi = biaozhi + 1
                                        arr_yh_yigou(MyHh - 4) = biaozhi
                                        arr_qy_yigou(qd) = biaozhi
                                        Exit For
                                    End If
                                Else
                                    biaozhi = biaozhi + 1
                                    arr_yh_yigou(MyHh - 4) = biaozhi
                                    arr_qy_yigou(qd) = biaozhi
                                    Exit For
                                End If
                            End If
                        End If
                    Next y
                End If
            End If
        End If
    Next qd

    '***********************************************************************
    '|fffd||fffd||fffd||b4||fffd||fffd||bf6b||fffd||fffd||fffd||434||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||5b5||fffd|dict|fffd||fffd||fffd||fffd||fffd||fffd||fffd||43a||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|arr_hh
    dict.RemoveAll
    Erase arr_yhjf, arr_qydf, arr_hh, row_hh
    For y = LBound(arr_yhdf) To UBound(arr_yhdf)
        MyKey = arr_yhdf(y, 1)
        If MyKey <> 0 And MyKey <> "" Then
            If Not dict.exists(MyKey) Then    '|fffd||fffd||fffd||fffd||5b5||fffd||fffd||fffd||fb||fffd||434||fffd||5b5|
                yhdf_wygs = yhdf_wygs + 1
                dict_xh = yhdf_wygs    '|fffd||fffd||fffd||5b5||fffd||fffd||435||fffd||fffd||fffd||fffd|
                dict.Add MyKey, dict_xh
                ReDim Preserve arr_hh(yhdf_wygs)    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|Key|fffd||fffd||fffd||fffd||fffd||fffd||fffd||43a||fffd|
                ReDim row_hh(1 To 1)
                row_hh(1) = y + 4
                arr_hh(yhdf_wygs) = row_hh
            Else
                dict_xh = dict.Item(MyKey)    '|fffd||fffd||fffd||5b5||fffd||fffd||435||fffd||fffd||fffd||fffd|
                row_hh = arr_hh(dict_xh)
                cfgs = UBound(arr_hh(dict_xh)) + 1    '|fffd||638||fffd||5b5||fffd||138||fffd||fffd||fffd|
                ReDim Preserve row_hh(1 To cfgs)
                row_hh(cfgs) = y + 4
                arr_hh(dict_xh) = row_hh
            End If
        End If
    Next y

    '|fffd||fffd||fffd||b4||fffd||fffd||bf6b||fffd||fffd||4b5||fffd||8dfd||fffd||fffd||fffd||5b5||48e8||fffd||fffd||fffd||434||fffd||fffd||fffd||fffd||fffd||fffd||e74||fffd||fffd|
    For qj = LBound(arr_qyjf) To UBound(arr_qyjf)
        MyKey = arr_qyjf(qj, 1)
        If MyKey <> 0 Or MyKey <> "" Then
            If dict.exists(MyKey) Then
                dict_xh = dict.Item(MyKey)    '|fffd||fffd||fffd||5b5||fffd||fffd||435||fffd||fffd||fffd||fffd|
                row_hh = arr_hh(dict_xh)
                cfgs = UBound(row_hh)     '|fffd||638||fffd||5b5||fffd||138||fffd||fffd||fffd|

                If DuoBiSG = True Then
                    qygs = Application.CountIf(Sheet1.Range("P5:P" & qy_MaxRow), MyKey)    '|fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd||fffd||435||138||fffd||fffd||fffd|
                    If Not (qygs > 1 Or cfgs > 1) Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd||5b5||fffd||179||fffd||fffd||523||fffd||fffd||fffd||fffd||fffd||fffd||539||fffd|
                        For y = 1 To cfgs
                            MyHh = row_hh(y)    '|fffd||43a||fffd|
                            If arr_yh_yigou(MyHh - 4) = 0 Then

                                If Val(TextBox1.Text) <> 0 Then    '|fffd||fffd||fffd||fffd||43c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||436||fffd|
                                    jg = Abs(DateValue(Sheet1.Cells(qj + 4, 14)) - DateValue(Sheet1.Cells(MyHh, 4))) - Val(TextBox1.Text)
                                    If jg < 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||5b8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||17d||fffd||fffd||439||fffd||fffd||fffd|
                                        If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                            If Sheet1.Cells(qj + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                                biaozhi = biaozhi + 1
                                                arr_yh_yigou(MyHh - 4) = biaozhi
                                                arr_qy_yigou(qj) = biaozhi
                                                Exit For
                                            End If
                                        Else
                                            biaozhi = biaozhi + 1
                                            arr_yh_yigou(MyHh - 4) = biaozhi
                                            arr_qy_yigou(qj) = biaozhi
                                            Exit For
                                        End If

                                    End If
                                Else

                                    If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                        If Sheet1.Cells(qj + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                            biaozhi = biaozhi + 1
                                            arr_yh_yigou(MyHh - 4) = biaozhi
                                            arr_qy_yigou(qj) = biaozhi
                                            Exit For
                                        End If
                                    Else
                                        biaozhi = biaozhi + 1
                                        arr_yh_yigou(MyHh - 4) = biaozhi
                                        arr_qy_yigou(qj) = biaozhi
                                        Exit For
                                    End If

                                End If
                            End If

                        Next y
                    End If
                Else
                    For y = 1 To cfgs
                        MyHh = row_hh(y)    '|fffd||43a||fffd|
                        If arr_yh_yigou(MyHh - 4) = 0 Then

                            If Val(TextBox1.Text) <> 0 Then    '|fffd||fffd||fffd||fffd||43c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||436||fffd|
                                jg = Abs(DateValue(Sheet1.Cells(qj + 4, 14)) - DateValue(Sheet1.Cells(MyHh, 4))) - Val(TextBox1.Text)
                                If jg < 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||5b8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||17d||fffd||fffd||439||fffd||fffd||fffd|

                                    If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                        If Sheet1.Cells(qj + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                            biaozhi = biaozhi + 1
                                            arr_yh_yigou(MyHh - 4) = biaozhi
                                            arr_qy_yigou(qj) = biaozhi
                                            Exit For
                                        End If
                                    Else
                                        biaozhi = biaozhi + 1
                                        arr_yh_yigou(MyHh - 4) = biaozhi
                                        arr_qy_yigou(qj) = biaozhi
                                        Exit For
                                    End If

                                End If
                            Else

                                If CheckBox3 = True Then    '|fffd||fffd||fffd||4f5||fffd||fffd||77a||fffd||fffd||436||3e3||fffd||fffd||fffd||fffd||375||fffd||fffd||77a||17e||fffd||fffd||fffd||232||179||fffd||fffd||fffd|
                                    If Sheet1.Cells(qj + 4, 13) = Sheet1.Cells(MyHh, 3) Then
                                        biaozhi = biaozhi + 1
                                        arr_yh_yigou(MyHh - 4) = biaozhi
                                        arr_qy_yigou(qj) = biaozhi
                                        Exit For
                                    End If
                                Else
                                    biaozhi = biaozhi + 1
                                    arr_yh_yigou(MyHh - 4) = biaozhi
                                    arr_qy_yigou(qj) = biaozhi
                                    Exit For
                                End If

                            End If
                        End If

                    Next y
                End If

            End If
        End If
    Next qj

    '***********************************************************************
    '|fffd||fffd||fffd||fffd||536||fffd||fffd||fffd||fffd|
    ReDim arr_yh_xh(1 To yh_MaxRow - 4)
    ReDim arr_qy_xh(1 To qy_MaxRow - 4)
    For y = 1 To yh_MaxRow - 4
        arr_yh_xh(y) = "yh" & Application.Rept("0", 5 - Len(y)) & y
    Next y
    For q = 1 To qy_MaxRow - 4
        arr_qy_xh(q) = "qy" & Application.Rept("0", 5 - Len(q)) & q
    Next q

    '**************************************************************************************
    '|fffd||fffd||fffd||b4||fffd||fffd||bf6b||fffd||479||fffd||fffd||53c||fffd||bc||fffd||fffd||3b4||fffd||fffd||fffd||2f7||5b1||fffd||fffd||1b5||fffd||fffd||fffd||4e6||fffd||fffd||fffd||fffd|
    With Sheet1
        .Range("A5:A" & yh_MaxRow) = Application.Transpose(arr_yh_xh)
        .Range("K5:K" & qy_MaxRow) = Application.Transpose(arr_qy_xh)
        .Range("H5:H" & yh_MaxRow) = Application.Transpose(arr_yh_yigou)
        .Range("R5:R" & qy_MaxRow) = Application.Transpose(arr_qy_yigou)
        .Range("I5:I" & yh_MaxRow) = Application.Transpose(sg_yh)
        .Range("S5:S" & qy_MaxRow) = Application.Transpose(sg_qy)
        .Range("H:H,R:R").Replace What:=0, Replacement:="", LookAt:=xlWhole, _
                                  SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
                                  ReplaceFormat:=False
        .Range("H:H,R:R").Replace What:="", Replacement:="", LookAt:=xlPart
    End With

    Sheet2.Range("A5:I36656").Interior.ColorIndex = xlNone
    Sheet2.Range("A5:I36656").Borders.LineStyle = xlNone
    sxwdz    '|2e2||fffd||fffd||3b4||fffd||fffd||fffd||fffd|
    'ChangeClor    '|fffd||fffd||fffd||fffd||fffd||479||fffd||fffd||53c||fffd||bc||fffd||138||fffd||2bd|


    With Sheet1
        maxh = Application.WorksheetFunction.Max(yh_MaxRow, qy_MaxRow)
        .Range("A5:R63356").Borders.LineStyle = xlNone
        .Range(.Cells(5, 1), .Cells(maxh, 19)).Font.Size = 10
        .Range(.Cells(5, 1), .Cells(maxh, 19)).Font.Name = "|fffd||fffd||fffd||fffd|"
        .Range(.Cells(5, 1), .Cells(maxh, 3)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 11), .Cells(maxh, 13)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 4), .Cells(maxh, 8)).HorizontalAlignment = xlRight
        .Range(.Cells(5, 5), .Cells(maxh, 5)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 14), .Cells(maxh, 18)).HorizontalAlignment = xlRight
        .Range(.Cells(5, 15), .Cells(maxh, 15)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 1), .Cells(maxh, 19)).VerticalAlignment = xlBottom
        .Range(.Cells(5, 4), .Cells(maxh, 4)).NumberFormatLocal = "yyyy-mm-dd"
        .Range(.Cells(5, 14), .Cells(maxh, 14)).NumberFormatLocal = "yyyy-mm-dd"
        .Range(.Cells(5, 1), .Cells(maxh, 19)).Borders.LineStyle = xlContinuous
        .Range(.Cells(4, 10), .Cells(maxh + 1, 10)).Borders(xlInsideVertical).LineStyle = xlNone
        .Range(.Cells(4, 10), .Cells(maxh + 1, 10)).Borders(xlInsideHorizontal).LineStyle = xlNone
        .Columns("T:IV").Delete Shift:=xlToLeft
        .Range(.Cells(maxh + 2, 2), .Cells(65536, 2)).EntireRow.Delete
    End With
    Sheet3.CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    If CheckBox2.Value = True Then
        Sheet3.Unprotect
        zmh1 = Sheet3.Range("D65536").End(xlUp).Row
        zmh2 = Sheet3.Range("N65536").End(xlUp).Row
        Sheet3.Range("A4:I" & zmh1).Sort Key1:=Sheet3.Range("F4"), Order1:=xlAscending, Key2:=Sheet3.Range("G4"), Order2:=xlAscending, Header:=xlGuess
        Sheet3.Range("K4:S" & zmh2).Sort Key1:=Sheet3.Range("Q4"), Order1:=xlAscending, Key2:=Sheet3.Range("P4"), Order2:=xlAscending, Header:=xlGuess
        Sheet3.CommandButton1.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    End If
    Application.ScreenUpdating = True

    If Sheet1.CheckBox1 = True Then
        |fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|
    End If
    Sheet2.Protect contents:=True
    Sheet3.Protect contents:=True
    If Timer - t < 1 Then
        msg = "|fffd||536||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||263||fffd||fffd||fffd||fffd||3b9||fffd||fffd||539||fffd||fffd||fffd||2b1|0"
    Else
        msg = "|fffd||536||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||263||fffd||fffd||fffd||fffd||3b9||fffd||fffd||539||fffd||fffd||fffd||2b1|"
    End If
    msg = msg & Timer - t & "|fffd||fffd|" & vbCrLf
    msg = msg & "|fffd||67a||663||fffd||fffd||fffd||fffd||fffd||130||263||fffd||fffd||fffd|"
    ms = MsgBox(msg, vbOKOnly + vbInformation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")

End Sub

Private Sub CommandButton2_Click()
    Unload Me
End Sub

Private Sub SpinButton1_Change()
    TextBox1.Text = SpinButton1.Value
End Sub

Private Sub TextBox1_Change()

    If Int(Val(TextBox1.Text)) = Val(TextBox1.Text) Then
        SpinButton1.Value = Val(TextBox1.Text)
    Else
        ms = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||4e6||3aa||fffd||fffd||fffd||fffd||fffd||fffd|", vbOKOnly + vbInformation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        TextBox1.Text = ""
    End If
End Sub
Attribute VB_Name = "UserForm3"
Attribute VB_Base = "0{C29D1630-F1CA-43E2-84E6-BDDCA8962498}{23F12174-EE23-4D7E-904D-C0A8D2E50BBA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Private Sub CommandButton1_Click()
    Application.ScreenUpdating = False

    With Sheet3
        zmh1 = .Range("D65536").End(xlUp).Row
        .Unprotect
        .Range("I4|fffd||fffd|J4") = " "
        If OptionButton1 = True Then
            .Cells(1, 20) = .Cells(4, 6)
            .Cells(1, 21) = .Cells(4, 17)
            .Cells(2, 20) = Val(TextBox4.Text)
            .Cells(3, 21) = Val(TextBox4.Text)
        Else
            .Cells(1, 20) = .Cells(4, 7)
            .Cells(1, 21) = .Cells(4, 16)
            .Cells(2, 20) = Val(TextBox4.Text)
            .Cells(3, 21) = Val(TextBox4.Text)
        End If
        .Range("A4:R" & zmh1).AdvancedFilter Action:=xlFilterInPlace, CriteriaRange:=Range("T1:U3"), Unique:=False
        .Range("T1:U3") = ""
        Unload Me
        .Protect contents:=True
    End With

    Application.ScreenUpdating = True
End Sub


Private Sub TextBox4_Change()
    If Int(Val(TextBox4.Text)) <> Val(TextBox4.Text) Then
        TextBox4.Text = Int(Val(TextBox4.Text))
    End If
End Sub
Attribute VB_Name = "|123||fffd||fffd|1"
Sub KillForm()
    Unload UserForm1
End Sub
Sub ChangeClor()    '|fffd||fffd||fffd||fffd||fffd||479||fffd||fffd||53c||fffd||bc||fffd||135||fffd||26b|
    Dim i As Integer, h As Long, mycol As Integer
    Sheet2.Unprotect
    maxh = Sheet2.Range("D65536").End(xlUp).Row

    With Sheet2
        .Range(.Cells(5, 1), .Cells(maxh, 9)).Interior.ColorIndex = xlNone
        .Range(.Cells(4, 1), .Cells(maxh, 9)).Borders.LineStyle = xlContinuous
        i = 1
        For h = 7 To maxh
            If .Cells(h, 8) <> .Cells(h - 1, 8) Then
                i = i + 1
            End If
            mycol = i Mod 2
            If mycol = 0 Then
                .Range(.Cells(h, 1), .Cells(h, 9)).Interior.ColorIndex = 35
            Else
                .Range(.Cells(h, 1), .Cells(h, 9)).Interior.ColorIndex = xlNone
            End If
        Next h

        .Range(.Cells(5, 1), .Cells(maxh, 9)).Font.Size = 10
        .Range(.Cells(5, 1), .Cells(maxh, 9)).Font.Name = "|fffd||fffd||fffd||fffd|"
        .Range(.Cells(5, 1), .Cells(maxh, 3)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 4), .Cells(maxh, 9)).HorizontalAlignment = xlRight
        .Range(.Cells(5, 5), .Cells(maxh, 5)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 1), .Cells(maxh, 9)).VerticalAlignment = xlBottom
        .Range(.Cells(5, 4), .Cells(maxh, 4)).NumberFormatLocal = "yyyy-mm-dd"
        '.Columns("N:IV").Delete Shift:=xlToLeft
        .Range(.Cells(maxh + 2, 2), .Cells(65536, 2)).EntireRow.Delete
    End With
    Sheet2.Protect contents:=True
End Sub
Sub ChangeClor2()    '|fffd||fffd||fffd||fffd||1f0||fffd||fffd||fffd||479||fffd||fffd||53c||fffd||bc||fffd||135||fffd||26b|
    Dim i As Integer, h As Long, mycol As Integer
    'Application.ScreenUpdating = False
    maxh = Sheet5.Range("D65536").End(xlUp).Row

    With Sheet5
        .Range(.Cells(5, 1), .Cells(maxh, 9)).Interior.ColorIndex = xlNone
        .Range(.Cells(4, 1), .Cells(maxh, 9)).Borders.LineStyle = xlContinuous
        i = 1
        For h = 7 To maxh
            If .Cells(h, 8) <> .Cells(h - 1, 8) Then
                i = i + 1
            End If
            mycol = i Mod 2
            If mycol = 0 Then
                .Range(.Cells(h, 1), .Cells(h, 9)).Interior.ColorIndex = 35
            Else
                .Range(.Cells(h, 1), .Cells(h, 9)).Interior.ColorIndex = xlNone
            End If
        Next h
        .Range(.Cells(5, 1), .Cells(maxh, 9)).Font.Size = 10
        .Range(.Cells(5, 1), .Cells(maxh, 9)).Font.Name = "|fffd||fffd||fffd||fffd|"
        .Range(.Cells(5, 1), .Cells(maxh, 3)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 4), .Cells(maxh, 9)).HorizontalAlignment = xlRight
        .Range(.Cells(5, 5), .Cells(maxh, 5)).HorizontalAlignment = xlLeft
        .Range(.Cells(5, 1), .Cells(maxh, 9)).VerticalAlignment = xlBottom
        .Range(.Cells(5, 4), .Cells(maxh, 4)).NumberFormatLocal = "yyyy-mm-dd"
        '.Columns("N:IV").Delete Shift:=xlToLeft
        .Range(.Cells(maxh + 2, 2), .Cells(65536, 2)).EntireRow.Delete
    End With
    'Application.ScreenUpdating = True
End Sub

Sub sxwdz()    '|2e2||fffd||fffd||3b4||fffd||fffd||fffd||fffd|

    Sheet2.Unprotect
    Sheet3.Unprotect
    Sheet3.Range("A5:S65536").ClearContents
    Sheet3.Range("A5:S65536").Borders.LineStyle = xlNone
    With Sheet1
        yh_MaxRow2 = .Range("D65536").End(xlUp).Row
        qy_MaxRow2 = .Range("N65536").End(xlUp).Row

        Sheet2.Rows("5:65536").Delete
        Sheet3.Rows("5:55536").Delete
        .Range("A4:I" & yh_MaxRow2).AutoFilter
        .Range("A4:I" & yh_MaxRow2).AutoFilter Field:=8, Criteria1:="<>", Operator:=xlAnd
        .AutoFilter.Range.SpecialCells(12).Copy Sheet2.Cells(4, 1)
        .Range("A4:I" & yh_MaxRow2).AutoFilter Field:=8, Criteria1:="=", Operator:=xlAnd
        .AutoFilter.Range.SpecialCells(12).Copy Sheet3.Cells(4, 1)

        yg_MaxRow = Sheet2.Range("D65536").End(xlUp).Row
        .Range("A4:I" & yh_MaxRow2).AutoFilter
        .Range("K4:S" & qy_MaxRow2).AutoFilter Field:=8, Criteria1:="<>", Operator:=xlAnd
        .AutoFilter.Range.SpecialCells(12).Copy Sheet2.Cells(yg_MaxRow + 1, 1)
        Sheet2.Rows(yg_MaxRow + 1).Delete
        .Range("K4:S" & qy_MaxRow2).AutoFilter Field:=8, Criteria1:="=", Operator:=xlAnd
        .AutoFilter.Range.SpecialCells(12).Copy Sheet3.Cells(4, 11)
        .Range("K4:S" & qy_MaxRow2).AutoFilter

        yg_MaxRow = Sheet2.Range("D65536").End(xlUp).Row
        Sheet2.Range("A4:I" & yg_MaxRow).Sort Key1:=Sheet2.Range("H4"), Order1:=xlAscending, Key2:=Sheet2.Range("A4"), Order2:=xlAscending, Header:=xlGuess
    End With

    With Sheet3
        'Range("A1").Select
        .Range("F4") = "|fffd||fffd||fffd||43d||8dfd|"
        .Range("G4") = "|fffd||fffd||fffd||434||fffd||fffd||fffd|"
        .Range("P4") = "|fffd||fffd||4b5||fffd||8dfd|"
        .Range("Q4") = "|fffd||fffd||4b5||fffd||fffd||fffd||fffd|"
        yh = .Range("D65536").End(xlUp).Row
        qy = .Range("N65536").End(xlUp).Row
        max_h = Application.WorksheetFunction.Max(yh, qy)

        .Range(.Cells(4, 1), .Cells(max_h, 19)).Borders.LineStyle = xlContinuous
        .Range(.Cells(3, 10), .Cells(max_h + 1, 10)).Borders(xlInsideVertical).LineStyle = xlNone
        .Range(.Cells(3, 10), .Cells(max_h + 1, 10)).Borders(xlInsideHorizontal).LineStyle = xlNone
        '.Columns("T:IV").Delete Shift:=xlToLeft
        .Range(.Cells(max_h + 2, 2), .Cells(65536, 2)).EntireRow.Delete
        .Range("H:H,R:R").Locked = False
        .Protect contents:=True
    End With
    ChangeClor
    Sheet2.Protect contents:=True

End Sub
Sub |fffd||fffd||fffd||275||fffd||fffd||6b1||fffd|()
    Dim y As Integer, q As Integer, y_end As Integer, q_end As Integer, count As Integer
    With Sheet4
        Application.ScreenUpdating = False
        .Range("A10:M65536").ClearContents
        .Range("A10:M65536").Borders.LineStyle = xlNone
        .Range("A10:M65536").Font.Bold = False
        y_end = Sheet3.Range("D65536").End(xlUp).Row
        q_end = Sheet3.Range("N65536").End(xlUp).Row
        ys = 10
        For y = 5 To y_end
            If Sheet3.Cells(y, 7) <> 0 Then
                .Cells(ys, 1).Value = Sheet3.Cells(y, 5)
                .Cells(ys, 2).Value = Sheet3.Cells(y, 1)
                .Cells(ys, 3).Value = Sheet3.Cells(y, 2)
                .Cells(ys, 4).Value = Sheet3.Cells(y, 3)
                .Cells(ys, 5).Value = Sheet3.Cells(y, 4)
                .Cells(ys, 6).Value = Sheet3.Cells(y, 7)
                ys = ys + 1
            End If
        Next y
        qs = 10
        For q = 5 To q_end
            If Sheet3.Cells(q, 16) <> 0 Then
                .Cells(qs, 8).Value = Sheet3.Cells(q, 15)
                .Cells(qs, 9).Value = Sheet3.Cells(q, 11)
                .Cells(qs, 10).Value = Sheet3.Cells(q, 12)
                .Cells(qs, 11).Value = Sheet3.Cells(q, 13)
                .Cells(qs, 12).Value = Sheet3.Cells(q, 14)
                .Cells(qs, 13).Value = Sheet3.Cells(q, 16)
                qs = qs + 1
            End If
        Next q
        max_h = Application.WorksheetFunction.Max(ys, qs)
        .Range("F9") = Application.WorksheetFunction.Sum(.Range(.Cells(10, 6), .Cells(max_h, 6)))
        .Range("M9") = Application.WorksheetFunction.Sum(.Range(.Cells(10, 13), .Cells(max_h, 13)))

        .Cells(max_h + 1, 1).Value = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||478||fffd||fffd||fffd||fffd||fffd||4b5||3b4||fffd||fffd||fffd||fffd|"
        .Cells(max_h + 1, 1).Font.Bold = True
        .Cells(max_h + 1, 8).Value = "|fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||478||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3b4||fffd||fffd||fffd||fffd|"
        .Cells(max_h + 1, 8).Font.Bold = True
        ys2 = max_h + 2
        For y = 5 To y_end
            If Sheet3.Cells(y, 6) <> 0 Then
                'yh = .Range("D8888").End(xlUp).Row '|237||fffd||fffd||fffd||fffd||fffd||fffd||3b4||fffd||fffd||fffd||fffd||fffd||fffd||129||fffd||fffd|
                .Cells(ys2, 1).Value = Sheet3.Cells(y, 5)
                .Cells(ys2, 2).Value = Sheet3.Cells(y, 1)
                .Cells(ys2, 3).Value = Sheet3.Cells(y, 2)
                .Cells(ys2, 4).Value = Sheet3.Cells(y, 3)
                .Cells(ys2, 5).Value = Sheet3.Cells(y, 4)
                .Cells(ys2, 6).Value = Sheet3.Cells(y, 6)
                ys2 = ys2 + 1
            End If
        Next y

        qs2 = max_h + 2
        For q = 5 To q_end
            If Sheet3.Cells(q, 17) <> 0 Then
                .Cells(qs2, 8).Value = Sheet3.Cells(q, 15)
                .Cells(qs2, 9).Value = Sheet3.Cells(q, 11)
                .Cells(qs2, 10).Value = Sheet3.Cells(q, 12)
                .Cells(qs2, 11).Value = Sheet3.Cells(q, 13)
                .Cells(qs2, 12).Value = Sheet3.Cells(q, 14)
                .Cells(qs2, 13).Value = Sheet3.Cells(q, 17)
                qs2 = qs2 + 1
            End If
        Next q
        max_h2 = Application.WorksheetFunction.Max(ys2, qs2)
        .Cells(max_h + 1, 6) = Application.WorksheetFunction.Sum(.Range(.Cells(max_h + 2, 6), .Cells(max_h2, 6)))
        .Cells(max_h + 1, 6).Font.Bold = True
        .Cells(max_h + 1, 13) = Application.WorksheetFunction.Sum(.Range(.Cells(max_h + 2, 13), .Cells(max_h2, 13)))
        .Cells(max_h + 1, 13).Font.Bold = True

        .Cells(max_h2 + 1, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd||e8e9||fffd||57c||fffd||fffd||fffd||fffd||fffd||fffd|"
        .Cells(max_h2 + 1, 1).Font.Bold = True
        .Cells(max_h2 + 1, 6) = .Cells(8, 6) + .Cells(9, 6) - .Cells(max_h + 1, 6)
        .Cells(max_h2 + 1, 6).Font.Bold = True
        .Cells(max_h2 + 1, 8) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||436||fffd||fffd||2f5||fffd||fffd||fffd||fffd||57c||fffd||fffd||fffd||fffd||fffd||fffd|"
        .Cells(max_h2 + 1, 8).Font.Bold = True
        .Cells(max_h2 + 1, 13) = .Cells(8, 13) + .Cells(9, 13) - .Cells(max_h + 1, 13)
        .Cells(max_h2 + 1, 13).Font.Bold = True
        .Cells(max_h2 + 2, 1) = "|fffd||fffd||fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||687f|"
        .Cells(max_h2 + 2, 12) = "|fffd||fffd||4e1||fffd||fffd||fffd||6a3||fffd|" & Date
        .Columns("O:IV").Delete Shift:=xlToLeft
        .Range(.Cells(max_h2 + 3, 2), .Cells(65535, 2)).EntireRow.Delete
        '|fffd||4f1||7ff||fffd|
        .Range("A6:R" & max_h2 + 5).Borders.LineStyle = xlNone
        .Range("A6:A" & max_h2 + 1).Borders(xlEdgeLeft).LineStyle = xlContinuous '|fffd||fffd||fffd||5b5||fffd||fffd||534||2fe||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        .Range("G6:G" & max_h2 + 1).Borders(xlEdgeLeft).LineStyle = xlContinuous
        .Range("H6:H" & max_h2 + 1).Borders(xlEdgeLeft).LineStyle = xlContinuous
        .Range("M6:M" & max_h2 + 1).Borders(xlEdgeRight).LineStyle = xlContinuous
        .Range(.Cells(max_h - 1, 1), .Cells(max_h - 1, 13)).Borders(xlEdgeBottom).LineStyle = xlContinuous
        .Range(.Cells(max_h + 1, 1), .Cells(max_h + 1, 13)).Borders(xlEdgeBottom).LineStyle = xlContinuous
        .Range(.Cells(max_h2, 1), .Cells(max_h2, 13)).Borders(xlEdgeBottom).LineStyle = xlContinuous
        .Range(.Cells(max_h2 + 1, 1), .Cells(max_h2 + 1, 13)).Borders(xlEdgeBottom).LineStyle = xlContinuous
        .Range(.Cells(max_h2 + 1, 1), .Cells(max_h2 + 1, 13)).Borders(xlEdgeBottom).Weight = xlMedium
        .Range("G6:G" & max_h2 + 1).Borders(xlInsideHorizontal).LineStyle = xlNone

        Application.ScreenUpdating = True
        If Round(.Cells(max_h2 + 1, 6), 2) = Round(.Cells(max_h2 + 1, 13), 2) Then
            'ms = MsgBox("|fffd||fffd||3f2||fffd||fffd||3f2||fffd||fffd||fffd||fffd||fffd||6b1||fffd||fffd||fffd||fffd||fffd||fffd||263||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2eb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||223||fffd|", vbOKOnly + vbInformation, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        Else
            msg = "|fffd||fffd||fffd||6ce4||fffd||663||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||ecbb||fffd||fffd||223||fffd||fffd||fffd||fffd||fffd||52d||fffd||fffd|" & vbCrLf
            msg = msg & "|fffd||fffd||fffd||fffd||3aa||fffd||fffd||fffd||6b1||fffd|F8|fffd||fffd|M8|fffd||fffd||52a||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||bcbb||fffd||fffd||237||fffd||fffd|"
            ms = MsgBox(msg, vbOKOnly + vbCritical, "|fffd||777||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| V2.2|fffd||fffd||2bd||fffd||fffd|")
        End If
    End With
End Sub
Sub |fffd||1bc||fffd||4bb||fffd||536||fffd|()
    Dim tc As Integer, bz As Integer, y1 As Long, y2 As Long, y3 As Long, q1 As Long, q2 As Long, q3 As Long
    Dim yhbz()
    Dim qybz()
    Dim arr_yhjf()
    Dim arr_yhdf()
    Dim arr_qyjf()
    Dim arr_qydf()

    With Sheet3
        .Unprotect
        '.Range("D3") = "|fffd||fffd||fffd||6b1||fffd||fffd||4bb||fffd||536||8ec||fffd||fffd||fffd||53a||fffd|"
        Application.ScreenUpdating = False
        yh_MaxRow = .Range("D65536").End(xlUp).Row    '|fffd||fffd||fffd||436||fffd||fffd||2f5||fffd||fffd||fffd||fffd||fffd||129||fffd||fffd|
        qy_MaxRow = .Range("N65536").End(xlUp).Row    '|fffd||fffd||4b5||fffd||57c||fffd||fffd||2b5||fffd||fffd||fffd||129||fffd||fffd|
        If yh_MaxRow < 6 Or qy_MaxRow < 5 Then
            End
        End If
        ReDim arr_yhjf(1 To yh_MaxRow - 4)
        arr_yhjf = .Range("F5:F" & yh_MaxRow)    '|fffd||fffd||4aa||fffd||fffd||fffd||535||fffd||fffd||fffd||fffd||43d||8dfd||fffd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|yh_jf
        arr_yhdf = .Range("G5:G" & yh_MaxRow)
        arr_qyjf = .Range("P5:P" & qy_MaxRow)    '|fffd||fffd||4aa||fffd||fffd||fffd||535||fffd||fffd||fffd||4b5||fffd||8dfd||fffd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|qy_jf
        arr_qydf = .Range("Q5:Q" & qy_MaxRow)
        '        yhbz = .Range("H5:H" & yh_MaxRow)    '|fffd||fffd||fffd||439||fffd||fffd||531||fffd||5be|
        '        qybz = .Range("R5:R" & qy_MaxRow)    '|fffd||fffd||4b5||fffd||fffd||fffd||531||fffd||5be|

    End With

    ReDim yhbz(1 To UBound(arr_yhjf))
    ReDim qybz(1 To UBound(arr_qyjf))
    bz = 0


    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||536||fffd| (|fffd||fffd||fffd||43d||8dfd|1|fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd|2)
    If qy_MaxRow > 5 Then
        For y1 = LBound(arr_yhjf) To UBound(arr_yhjf)
            tc = 0
            If arr_yhjf(y1, 1) <> 0 And yhbz(y1) = "" Then
                For q1 = LBound(arr_qydf) To UBound(arr_qydf) - 1
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_qydf(q1, 1) <> 0 And qybz(q1) = "" Then
                            For q2 = q1 + 1 To UBound(arr_qydf)
                                If arr_qydf(q2, 1) <> 0 And qybz(q2) = "" Then
                                    If arr_yhjf(y1, 1) = arr_qydf(q1, 1) + arr_qydf(q2, 1) Then
                                        bz = bz + 1
                                        yhbz(y1) = bz
                                        qybz(q1) = bz
                                        qybz(q2) = bz
                                        tc = 1
                                        Exit For
                                    End If
                                End If
                            Next q2
                        End If
                    End If
                Next q1
            End If
        Next y1
    End If

    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||536||fffd| (|fffd||fffd||fffd||434||fffd||fffd||fffd|1|fffd||fffd||fffd||fffd||4b5||fffd||8dfd|2)
    If qy_MaxRow > 5 Then
        For y1 = LBound(arr_yhdf) To UBound(arr_yhdf)
            tc = 0
            If arr_yhdf(y1, 1) <> 0 And yhbz(y1) = "" Then
                For q1 = LBound(arr_qyjf) To UBound(arr_qyjf) - 1
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_qyjf(q1, 1) <> 0 And qybz(q1) = "" Then
                            For q2 = q1 + 1 To UBound(arr_qyjf)
                                If arr_qyjf(q2, 1) <> 0 And qybz(q2) = "" Then
                                    If arr_yhdf(y1, 1) = arr_qyjf(q1, 1) + arr_qyjf(q2, 1) Then
                                        bz = bz + 1
                                        yhbz(y1) = bz
                                        qybz(q1) = bz
                                        qybz(q2) = bz
                                        tc = 1
                                        Exit For
                                    End If
                                End If
                            Next q2
                        End If
                    End If
                Next q1
            End If
        Next y1
    End If


    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||536||fffd| (|fffd||fffd||4b5||fffd||fffd||fffd||fffd|1|fffd||fffd||fffd||fffd||fffd||43d||8dfd|2)
    If yh_MaxRow > 5 Then
        For q1 = LBound(arr_qydf) To UBound(arr_qydf)
            tc = 0
            If arr_qydf(q1, 1) <> 0 And qybz(q1) = "" Then
                For y1 = LBound(arr_yhjf) To UBound(arr_yhjf) - 1
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_yhjf(y1, 1) <> 0 And yhbz(y1) = "" Then
                            For y2 = y1 + 1 To UBound(arr_yhjf)
                                If arr_yhjf(y2, 1) <> 0 And yhbz(y2) = "" Then
                                    If arr_qydf(q1, 1) = arr_yhjf(y1, 1) + arr_yhjf(y2, 1) Then
                                        bz = bz + 1
                                        qybz(q1) = bz
                                        yhbz(y1) = bz
                                        yhbz(y2) = bz
                                        tc = 1
                                        Exit For
                                    End If
                                End If
                            Next y2
                        End If
                    End If
                Next y1
            End If
        Next q1
    End If

    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||536||fffd| (|fffd||fffd||4b5||fffd||8dfd|1|fffd||fffd||fffd||fffd||fffd||434||fffd||fffd||fffd|2)
    If yh_MaxRow > 5 Then
        For q1 = LBound(arr_qyjf) To UBound(arr_qyjf)
            tc = 0
            If arr_qyjf(q1, 1) <> 0 And qybz(q1) = "" Then
                For y1 = LBound(arr_yhdf) To UBound(arr_yhdf) - 1
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_yhdf(y1, 1) <> 0 And yhbz(y1) = "" Then
                            For y2 = y1 + 1 To UBound(arr_yhdf)
                                If arr_yhdf(y2, 1) <> 0 And yhbz(y2) = "" Then
                                    If arr_qyjf(q1, 1) = arr_yhdf(y1, 1) + arr_yhdf(y2, 1) Then
                                        bz = bz + 1
                                        qybz(q1) = bz
                                        yhbz(y1) = bz
                                        yhbz(y2) = bz
                                        tc = 1
                                        Exit For
                                    End If
                                End If
                            Next y2
                        End If
                    End If
                Next y1
            End If
        Next q1
    End If

    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||43d||8dfd||fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd|)
    If qy_MaxRow > 6 Then
        For y1 = LBound(arr_yhjf) To UBound(arr_yhjf)
            tc = 0
            If arr_yhjf(y1, 1) <> 0 And yhbz(y1) = "" Then
                For q1 = LBound(arr_qydf) To UBound(arr_qydf) - 2
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_qydf(q1, 1) <> 0 And qybz(q1) = "" Then
                            For q2 = q1 + 1 To UBound(arr_qydf)
                                If tc = 1 Then
                                    Exit For
                                Else
                                    If arr_qydf(q2, 1) <> 0 And qybz(q2) = "" Then
                                        For q3 = q2 + 1 To UBound(arr_qydf)
                                            If arr_qydf(q3, 1) <> 0 And qybz(q3) = "" Then
                                                If arr_yhjf(y1, 1) = arr_qydf(q1, 1) + arr_qydf(q2, 1) + arr_qydf(q3, 1) Then
                                                    bz = bz + 1
                                                    yhbz(y1) = bz
                                                    qybz(q1) = bz
                                                    qybz(q2) = bz
                                                    qybz(q3) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next q3
                                    End If
                                End If
                            Next q2
                        End If
                    End If
                Next q1
            End If
        Next y1
    End If

    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||434||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||8dfd|)
    If qy_MaxRow > 6 Then
        For y1 = LBound(arr_yhdf) To UBound(arr_yhdf)
            tc = 0
            If arr_yhdf(y1, 1) <> 0 And yhbz(y1) = "" Then
                For q1 = LBound(arr_qyjf) To UBound(arr_qyjf) - 2
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_qyjf(q1, 1) <> 0 And qybz(q1) = "" Then
                            For q2 = q1 + 1 To UBound(arr_qyjf)
                                If tc = 1 Then
                                    Exit For
                                Else
                                    If arr_qyjf(q2, 1) <> 0 And qybz(q2) = "" Then
                                        For q3 = q2 + 1 To UBound(arr_qyjf)
                                            If arr_qyjf(q3, 1) <> 0 And qybz(q3) = "" Then
                                                If arr_yhdf(y1, 1) = arr_qyjf(q1, 1) + arr_qyjf(q2, 1) + arr_qyjf(q3, 1) Then
                                                    bz = bz + 1
                                                    yhbz(y1) = bz
                                                    qybz(q1) = bz
                                                    qybz(q2) = bz
                                                    qybz(q3) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next q3
                                    End If
                                End If
                            Next q2
                        End If
                    End If
                Next q1
            End If
        Next y1
    End If

    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||fffd||fffd||fffd| (|fffd||fffd||4b5||fffd||8dfd||fffd||fffd||fffd||fffd||fffd||434||fffd||fffd||fffd|)
    If qy_MaxRow > 6 Then
        For q1 = LBound(arr_qyjf) To UBound(arr_qyjf)
            tc = 0
            If arr_qyjf(q1, 1) <> 0 And qybz(q1) = "" Then
                For y1 = LBound(arr_yhdf) To UBound(arr_yhdf) - 2
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_yhdf(y1, 1) <> 0 And yhbz(y1) = "" Then
                            For y2 = y1 + 1 To UBound(arr_yhdf)
                                If tc = 1 Then
                                    Exit For
                                Else
                                    If arr_yhdf(y2, 1) <> 0 And yhbz(y2) = "" Then
                                        For y3 = y2 + 1 To UBound(arr_yhdf)
                                            If arr_yhdf(y3, 1) <> 0 And yhbz(y3) = "" Then
                                                If arr_qyjf(q1, 1) = arr_yhdf(y1, 1) + arr_yhdf(y2, 1) + arr_yhdf(y3, 1) Then
                                                    bz = bz + 1
                                                    qybz(q1) = bz
                                                    yhbz(y1) = bz
                                                    yhbz(y2) = bz
                                                    yhbz(y3) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next y3
                                    End If
                                End If
                            Next y2
                        End If
                    End If
                Next y1
            End If
        Next q1
    End If

    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||1f3||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||43d||8dfd||fffd||fffd|
    If qy_MaxRow > 6 Then
        For q1 = LBound(arr_qydf) To UBound(arr_qydf)
            tc = 0
            If arr_qydf(q1, 1) <> 0 And qybz(q1) = "" Then
                For y1 = LBound(arr_yhjf) To UBound(arr_yhjf) - 2
                    If tc = 1 Then
                        Exit For
                    Else
                        If arr_yhjf(y1, 1) <> 0 And yhbz(y1) = "" Then
                            For y2 = y1 + 1 To UBound(arr_yhjf)
                                If tc = 1 Then
                                    Exit For
                                Else
                                    If arr_yhjf(y2, 1) <> 0 And yhbz(y2) = "" Then
                                        For y3 = y2 + 1 To UBound(arr_yhjf)
                                            If arr_yhjf(y3, 1) <> 0 And yhbz(y3) = "" Then
                                                If arr_qydf(q1, 1) = arr_yhjf(y1, 1) + arr_yhjf(y2, 1) + arr_yhjf(y3, 1) Then
                                                    bz = bz + 1
                                                    qybz(q1) = bz
                                                    yhbz(y1) = bz
                                                    yhbz(y2) = bz
                                                    yhbz(y3) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next y3
                                    End If
                                End If
                            Next y2
                        End If
                    End If
                Next y1
            End If
        Next q1
    End If
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    With Sheet3
        .Range("H5:H" & yh_MaxRow) = Application.Transpose(yhbz)
        .Range("R5:R" & qy_MaxRow) = Application.Transpose(qybz)
        If .CheckBox1.Value = True Then
            .Range("K5:S" & qy_MaxRow).Cut .Cells(yh_MaxRow + 1, 1)
            .Range("A4:H" & yh_MaxRow + qy_MaxRow - 4).Sort Key1:=.Range("H4"), Order1:=xlDescending, Header:=xlGuess
            TheLast = .Range("H65536").End(xlUp).Row
            .Rows(TheLast + 1 & ":65536").Delete Shift:=xlUp
        End If
        .Range("A4:H" & yh_MaxRow).Sort Key1:=.Range("H4"), Order1:=xlAscending, Header:=xlGuess
        .Range("k4:R" & qy_MaxRow).Sort Key1:=.Range("R4"), Order1:=xlAscending, Header:=xlGuess
        If .CheckBox1.Value = True And TheLast > 5 Then
            i = 1
            For h = 6 To TheLast
                If .Cells(h, 8) <> .Cells(h - 1, 8) Then
                    i = i + 1
                End If
                mycol = i Mod 2
                If mycol = 0 Then
                    .Range(.Cells(h, 1), .Cells(h, 8)).Interior.ColorIndex = 35
                Else
                    .Range(.Cells(h, 1), .Cells(h, 8)).Interior.ColorIndex = xlNone
                End If
            Next h
        End If
        .Protect contents:=True
    End With
End Sub
Sub |fffd||fffd||fffd||fffd||56a||4aa||fffd||1bc||fffd|()
'|fffd||fffd||fffd||fffd||3b4||fffd||fffd||fffd||fffd||56a||4aa||fffd||139||63c||fffd||fffd||fffd||1a5||fffd||fffd||fffd||fffd||fffd||fffd||1bc||fffd||fffd||fffd||fffd||fffd|
    Dim yhbz()
    Dim qybz()
    Dim arr_yhjf()
    Dim arr_yhdf()
    Dim arr_qyjf()
    Dim arr_qydf()
    Dim yh_abstract()
    Dim qy_abstract()
    Dim arr_RemovedStr()
    Application.ScreenUpdating = False
    With Sheet3
        .Unprotect

        yh_MaxRow = .Range("D65536").End(xlUp).Row    '|fffd||fffd||fffd||436||fffd||fffd||2f5||fffd||fffd||fffd||fffd||fffd||129||fffd||fffd|
        qy_MaxRow = .Range("N65536").End(xlUp).Row    '|fffd||fffd||4b5||fffd||57c||fffd||fffd||2b5||fffd||fffd||fffd||129||fffd||fffd|
        If qy_MaxRow < 5 Or yh_MaxRow < 5 Then
            End
        End If

        arr_yhjf = .Range("F5:F" & yh_MaxRow)    '|fffd||fffd||4aa||fffd||fffd||fffd||535||fffd||fffd||fffd||fffd||43d||8dfd||fffd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|yh_jf
        arr_yhdf = .Range("G5:G" & yh_MaxRow)
        arr_qyjf = .Range("P5:P" & qy_MaxRow)    '|fffd||fffd||4aa||fffd||fffd||fffd||535||fffd||fffd||fffd||4b5||fffd||8dfd||fffd||fffd||fffd||fffd||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|qy_jf
        arr_qydf = .Range("Q5:Q" & qy_MaxRow)
        yh_abstract() = .Range("E5:E" & yh_MaxRow)
        qy_abstract() = .Range("O5:O" & qy_MaxRow)
    End With
    Remove_MaxRow = Sheet6.Range("A65536").End(xlUp).Row
    arr_RemovedStr = Sheet6.Range("A2:A" & Remove_MaxRow)
    RemovedStr = Join(Application.Transpose(arr_RemovedStr), "|fffd||fffd|")

    ReDim yhbz(1 To UBound(arr_yhjf))
    ReDim qybz(1 To UBound(arr_qyjf))
    bz = 0
    tc = 0

    '|fffd||fffd||fffd||234||fffd||fffd||fffd||fffd||fffd||fffd||43d||8dfd||fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd|

    For i = 5 To 2 Step -1
        For y1 = LBound(arr_yhjf) To UBound(arr_yhjf)
            tc = 0
            For q1 = LBound(arr_qydf) To UBound(arr_qydf)
                yh_len = Len(yh_abstract(y1, 1))
                If yh_len >= i Then
                    If tc = 1 Then    '|fffd||436||fffd||fffd||1f7||fffd||fffd||fffd||fffd||fffd||46d||fffd||fffd|
                        Exit For
                    Else
                        If arr_yhjf(y1, 1) = arr_qydf(q1, 1) And qybz(q1) = "" And yhbz(y1) = "" And arr_qydf(q1, 1) <> 0 Then
                            qy_len = Len(qy_abstract(q1, 1))
                            If qy_len >= i Then
                                If yh_len > qy_len Then
                                    If qy_len > i - 1 Then  '|fffd||fffd||5b1||23d||fffd|
                                        For qs = 1 To qy_len - i + 1
                                            mystr = Mid(qy_abstract(q1, 1), qs, i)
                                            mypos = InStr(1, yh_abstract(y1, 1), mystr, 1)
                                            If mypos <> 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3f9||fffd||fffd||531||fffd||5be||fffd||fffd|
                                                If InStr(RemovedStr, mystr) = 0 Then    '|fffd||fffd||fffd||fffd||fffd||173||fffd||fffd||fffd||fffd||623||fffd||fffd||78fa||fffd||fffd||fffd||7b9||fffd||2fe||fffd||fffd|
                                                    bz = bz + 1
                                                    yhbz(y1) = bz
                                                    qybz(q1) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next qs
                                    End If
                                Else     '|3bb||fffd||fd||fffd||fffd||fffd|
                                    If yh_len > i - 1 Then  '|fffd||fffd||5b1||23d||fffd|
                                        For qs = 1 To yh_len - i + 1
                                            mystr = Mid(yh_abstract(y1, 1), qs, i)
                                            mypos = InStr(1, qy_abstract(q1, 1), mystr, 1)
                                            If mypos <> 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3f9||fffd||fffd||531||fffd||5be||fffd||fffd|
                                                If InStr(RemovedStr, mystr) = 0 Then
                                                    bz = bz + 1
                                                    yhbz(y1) = bz
                                                    qybz(q1) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next qs
                                    End If
                                End If
                            End If
                        End If
                    End If
                Else
                    Exit For
                End If
            Next q1
        Next y1
    Next i

    '|fffd||fffd||fffd||234||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||8dfd|
    For i = 5 To 2 Step -1
        For q1 = LBound(arr_qyjf) To UBound(arr_qyjf)
            tc = 0
            For y1 = LBound(arr_yhdf) To UBound(arr_yhdf)
                qy_len = Len(qy_abstract(q1, 1))
                If qy_len >= i Then
                    If tc = 1 Then    '|fffd||436||fffd||fffd||1f7||fffd||fffd||fffd||fffd||fffd||46d||fffd||fffd|
                        Exit For
                    Else
                        If arr_qyjf(q1, 1) = arr_yhdf(y1, 1) And yhbz(y1) = "" And qybz(q1) = "" And arr_yhdf(y1, 1) <> 0 Then
                            yh_len = Len(yh_abstract(y1, 1))
                            If yh_len >= i Then
                                If qy_len > yh_len Then
                                    If yh_len > i - 1 Then  '|fffd||fffd||5b1||23d||fffd|
                                        For qs = 1 To yh_len - i + 1
                                            mystr = Mid(yh_abstract(y1, 1), qs, i)
                                            mypos = InStr(1, qy_abstract(q1, 1), mystr, 1)
                                            If mypos <> 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3f9||fffd||fffd||531||fffd||5be||fffd||fffd|
                                                If InStr(RemovedStr, mystr) = 0 Then
                                                    bz = bz + 1
                                                    qybz(q1) = bz
                                                    yhbz(y1) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next qs
                                    End If
                                Else     '|3bb||fffd||fd||fffd||fffd||fffd|
                                    If qy_len > i - 1 Then  '|fffd||fffd||5b1||23d||fffd|
                                        For qs = 1 To qy_len - i + 1
                                            mystr = Mid(qy_abstract(q1, 1), qs, i)
                                            mypos = InStr(1, yh_abstract(y1, 1), mystr, 1)
                                            If mypos <> 0 Then    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3f9||fffd||fffd||531||fffd||5be||fffd||fffd|
                                                If InStr(RemovedStr, mystr) = 0 Then
                                                    bz = bz + 1
                                                    qybz(q1) = bz
                                                    yhbz(y1) = bz
                                                    tc = 1
                                                    Exit For
                                                End If
                                            End If
                                        Next qs
                                    End If
                                End If
                            End If
                        End If
                    End If
                Else
                    Exit For
                End If
            Next y1
        Next q1
    Next i


    With Sheet3
        .Range("H5:H" & yh_MaxRow) = Application.Transpose(yhbz)
        .Range("R5:R" & qy_MaxRow) = Application.Transpose(qybz)
        If .CheckBox1.Value = True Then
            .Range("K5:S" & qy_MaxRow).Cut .Cells(yh_MaxRow + 1, 1)
            .Range("A4:H" & yh_MaxRow + qy_MaxRow - 4).Sort Key1:=.Range("H4"), Order1:=xlDescending, Header:=xlGuess
            TheLast = .Range("H65536").End(xlUp).Row
            .Rows(TheLast + 1 & ":65536").Delete Shift:=xlUp
        End If
        .Range("A4:H" & yh_MaxRow).Sort Key1:=.Range("H4"), Order1:=xlAscending, Header:=xlGuess
        .Range("k4:R" & qy_MaxRow).Sort Key1:=.Range("R4"), Order1:=xlAscending, Header:=xlGuess
        If .CheckBox1.Value = True And TheLast > 5 Then
            i = 1
            For h = 6 To TheLast
                If .Cells(h, 8) <> .Cells(h - 1, 8) Then
                    i = i + 1
                End If
                mycol = i Mod 2
                If mycol = 0 Then
                    .Range(.Cells(h, 1), .Cells(h, 8)).Interior.ColorIndex = 35
                Else
                    .Range(.Cells(h, 1), .Cells(h, 8)).Interior.ColorIndex = xlNone
                End If
            Next h
        End If
        .Protect contents:=True
    End With
End Sub


INQUEST-PP=macro
