Attribute VB_Name = "EstaPasta_de_trabalho"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True



























Attribute VB_Name = "M|fffd|d11Config"
Public ConfigAc As Range
Public nSugIni As Single
Public nSugFim As Single
Public nFixosDias, nFixosMeses As Single

Public AlerSemCorrJ|fffd|Feito As Boolean
Public AlerSemJurJ|fffd|Feito As Boolean
Public AlerSemRes|fffd|dJ|fffd|Feito As Boolean


Public Sub ConfigAcoVBA()
    NomeArqHist = "ConfgAco.hst"
    Set ConfigAc = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("ConfigAc")
    Application.ScreenUpdating = False
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
        ActiveWindow.Close False
    End If
    Application.ScreenUpdating = True
    'Ajuda
    i = InStr(1, ConfigAc(2, 2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxConfig").HelpFile = Left(ConfigAc(2,2).value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False


    nFixosDias = ConfigAc(22, 2).Value   'Aqui porque a pr|fffd|x. aciona o evento inicialize do form.
    nFixosMeses = ConfigAc(21, 2).Value
    UserForm1Config.HelpContextID = Right(ConfigAc(2, 2).Value, Len(ConfigAc(2, 2).Value) - i)

    vEnableEvents = False
    UserForm1Config.DataInicial_Cb.Value = Format(DateValue(ConfigAc(7, 2).Value), "dd/mm/yy")
    UserForm1Config.DataFinal_Cb.Value = Format(DateValue(ConfigAc(8, 2).Value), "dd/mm/yy")

    UserForm1Config.Per|fffd|odosPredef_Chb.Value = ConfigAc(25, 2).Value
    UserForm1Config.Nada_OpBt.Value = ConfigAc(13, 2).Value = 1
    UserForm1Config.SaldAVenc_OpBt.Value = ConfigAc(13, 2).Value = 2
    UserForm1Config.Fixos_OpBt.Value = ConfigAc(13, 2).Value = 3
    UserForm1Config.Recebido_Chb.Value = ConfigAc(35, 2).Value

    UserForm1Config.SemCorre|fffd||fffd|o_Chb.Value = ConfigAc(27, 2).Value
    UserForm1Config.JurosIdem_Chb.Value = ConfigAc(28, 2).Value
    UserForm1Config.SemRes|fffd|duo_Chb.Value = ConfigAc(29, 2).Value

    UserForm1Config.Multa_Chb.Value = ConfigAc(31, 2).Value
    UserForm1Config.Mora_Chb.Value = ConfigAc(32, 2).Value
    UserForm1Config.AumRed_Cb.Value = Format(ConfigAc(34, 2).Value, "0.0##########")
    UserForm1Config.Estorno_Chb.Value = ConfigAc(36, 2).Value

    UserForm1Config.FixosPerSeg_Lb.Caption = ConfigAc(17, 1).Value
    UserForm1Config.Estorno_Chb.Caption = ConfigAc(36, 1).Value
    OcultarExibControles1

    vEnableEvents = True
    Application.ScreenUpdating = True
    Application.StatusBar = False
    UserForm1Config.DataFinal_Cb.SetFocus
    UserForm1Config.Show
    Application.ScreenUpdating = True
    ConfigAc(1, 2) = BotAcionado
    If FecharArq Then ConfigAc(2, 2) = "Fechar"
    If BotAcionado <> False Then
        Application.ScreenUpdating = False
        'Atualizar hist|fffd|rico
        Application.ScreenUpdating = False
        If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
            SalvarHist = False
            AtuHist "DataInicial", UserForm1Config.DataInicial_Cb.Value, Format(DateValue(ConfigAc(7, 2)), "dd/mm/yy")
            AtuHist "DataFinal", UserForm1Config.DataFinal_Cb.Value, Format(DateValue(ConfigAc(8, 2)), "dd/mm/yy")
            AtuHist "AumRed", UserForm1Config.AumRed_Cb.Value, ConfigAc(34, 2)
            If SalvarHist Then SalvandoHist Else Workbooks(NomeArqHist).Close False
        End If
        'Transferindo dados
        ConfigAc(22, 2) = nFixosDias
        ConfigAc(21, 2) = nFixosMeses

        ConfigAc(7, 2) = DateValue(UserForm1Config.DataInicial_Cb.Value)
        ConfigAc(8, 2) = DateValue(UserForm1Config.DataFinal_Cb.Value)
        ConfigAc(34, 2) = CDbl(UserForm1Config.AumRed_Cb.Value)
        ConfigAc(23, 2) = nSugIni
        ConfigAc(24, 2) = nSugFim

        ConfigAc(25, 2) = UserForm1Config.Per|fffd|odosPredef_Chb.Value
        ConfigAc(13, 2) = -(1 * UserForm1Config.Nada_OpBt.Value + 2 * UserForm1Config.SaldAVenc_OpBt.Value + 3 * UserForm1Config.Fixos_OpBt.Value)
        ConfigAc(35, 2) = UserForm1Config.Recebido_Chb.Value

        ConfigAc(27, 2) = UserForm1Config.SemCorre|fffd||fffd|o_Chb.Value
        ConfigAc(28, 2) = UserForm1Config.JurosIdem_Chb.Value
        ConfigAc(29, 2) = UserForm1Config.SemRes|fffd|duo_Chb.Value

        ConfigAc(31, 2) = UserForm1Config.Multa_Chb.Value
        ConfigAc(32, 2) = UserForm1Config.Mora_Chb.Value
        ConfigAc(36, 2) = UserForm1Config.Estorno_Chb.Value

        Application.ScreenUpdating = False
    End If
    Unload UserForm1Config
    ThisWorkbook.Saved = True
End Sub


Sub OcultarExibControles1()
    With UserForm1Config
        .FixosTamPer|fffd|odo_Lb.Visible = .Fixos_OpBt.Value
        .FixosPerSeg_Lb.Visible = .Fixos_OpBt.Value
        .FixosMeses_Cb.Visible = .Fixos_OpBt.Value
        .FixosMeses_Lb.Visible = .Fixos_OpBt.Value
        .FixosDias_Cb.Visible = .Fixos_OpBt.Value
        .FixosDias_Lb.Visible = .Fixos_OpBt.Value
        .Frame1.Height = IIf(.Fixos_OpBt.Value, 72, 60)
        .Per|fffd|odosPredef_Chb.Visible = Not Workbooks("Cpap_pri.mac").Excel4MacroSheets(1).Range("Aberto")
        vMeses = Application.Run("cpap_jap.mac!M.F", DateValue(.DataInicial_Cb.Value) * 1, DateValue(.DataFinal_Cb.Value) * 1) + 1
        vDias = Workbooks("cpap_jap.mac").Sheets(1).Range("M.FretDias").Value + 1
        .Per|fffd|odo_Lb.Caption = "Relat|fffd|rio de pagamentos do per|fffd|odo de " & Choose(-1 * (vMeses < 2) - 2 * (vMeses = 2) - 3 * (vMeses > 2), "", "1 m|fffd|s ", vMeses - 1 & " meses ") & IIf(vMeses > 1 And vDias > 1, "mais ", "") & Choose(-1 * (vDias < 2) - 2 * (vDias = 2) - 3 * (vDias > 2), "", "1 dia", vDias - 1 & " dias")
        .DeAp|fffd|s_Lb.Caption = IIf(Workbooks("cpap_mp.mac").Sheets(1).Range("ODtAss").Value = DateValue(.DataInicial_Cb.Value) * 1, "  de", "ap|fffd|s")

        '&SET.VALUE(AD55;113+100*(OTabInd=1))&SET.VALUE(AD56;IF(OR(AND(JAdicParc;JurSC=FALSE);AJ55=FALSE;OTjur<0,005;OTabInd=1);0;113)))
        OTabInd = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("OTabInd")
        JAdicParc = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("JAdicParc")
        OTjur = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("OTjur")
        JurSC = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("JurSC")
        .SemCorre|fffd||fffd|o_Chb.Enabled = Not (OTabInd = 1)
        .JurosIdem_Chb.Visible = Not ((JAdicParc And JurSC = False) Or .SemCorre|fffd||fffd|o_Chb.Value = False Or OTjur < 0.005 Or OTabInd = 1)
        .SemRes|fffd|duo_Chb.Visible = Not (.SemCorre|fffd||fffd|o_Chb.Value = False Or OTabInd = 1)
        .Per|fffd|odos_Bt.Visible = Not (.SemCorre|fffd||fffd|o_Chb.Value = False Or OTabInd = 1)
    End With
End Sub











Attribute VB_Name = "M|fffd|d12CondEst"
Public CondEst As Range

Public Sub CondEstVBA()
    NomeArqHist = "CondEst.hst"
    Set CondEst = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("CondEst")
    Application.ScreenUpdating = False
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
        ActiveWindow.Close False
    End If
    Application.ScreenUpdating = True
    'Ajuda
    i = InStr(1, CondEst(2, 2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxIdent").HelpFile = Left(CondEst(2,2).value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False
    UserForm2CondEst.HelpContextID = Right(CondEst(2, 2).Value, Len(CondEst(2, 2).Value) - i)

    vEnableEvents = False
    UserForm2CondEst.JurTaxa_Cb.Value = Format(CondEst(9, 2).Value, "#,##0.00########")
    UserForm2CondEst.MultaPerc_Cb.Value = Format(CondEst(12, 2).Value, "#,##0.00")
    UserForm2CondEst.Res|fffd|duoPermitido_Cb.Value = Format(CondEst(15, 2).Value, "#,##0.00")

    UserForm2CondEst.Caption = CondEst(1, 1).Value
    UserForm2CondEst.CondAp|fffd|s_Lb.Caption = CondEst(7, 1).Value

    vEnableEvents = True
    Application.ScreenUpdating = True
    UserForm2CondEst.Exibir_Bt.SetFocus
    Application.StatusBar = False
    UserForm2CondEst.Show
    Application.ScreenUpdating = True
    CondEst(1, 2) = BotAcionado
    If FecharArq Then CondEst(2, 2) = "Fechar"
    If BotAcionado <> False Then
        Application.ScreenUpdating = False
        'Atualizar hist|fffd|rico
        Application.ScreenUpdating = False
        If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
            SalvarHist = False
            AtuHist "JurTaxa", UserForm2CondEst.JurTaxa_Cb.Value, Format(CondEst(9, 2), "#,##0.00########")
            AtuHist "MultaPerc", UserForm2CondEst.MultaPerc_Cb.Value, Format(CondEst(12, 2), "#,##0.00")
            AtuHist "Res|fffd|duoPermitido", UserForm2CondEst.Res|fffd|duoPermitido_Cb.Value, Format(CondEst(15, 2), "#,##0.00")
            If SalvarHist Then SalvandoHist Else Workbooks(NomeArqHist).Close False
        End If
        'Transferindo dados
        CondEst(9, 2) = CDbl(UserForm2CondEst.JurTaxa_Cb.Value)
        CondEst(12, 2) = CDbl(UserForm2CondEst.MultaPerc_Cb.Value)
        CondEst(15, 2) = CDbl(UserForm2CondEst.Res|fffd|duoPermitido_Cb.Value)

        Application.ScreenUpdating = False
    End If
    Unload UserForm2CondEst
    ThisWorkbook.Saved = True
End Sub
Attribute VB_Name = "M|fffd|d13AvIns"
Public AvInser As Range

Public Sub AvInserVBA()
    NomeArqHist = "AvInser.hst"
    Set AvInser = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("AvInser")
    Application.ScreenUpdating = False
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
        ActiveWindow.Close False
    End If
    Application.ScreenUpdating = True
    'Ajuda
    i = InStr(1, AvInser(2, 2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxIdent").HelpFile = Left(AvInser(2,2).value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False
    UserForm3AvIns.HelpContextID = Right(AvInser(2, 2).Value, Len(AvInser(2, 2).Value) - i)

    vEnableEvents = False

    UserForm3AvIns.DataInserir_Cb.Value = Format(DateValue(AvInser(14, 2).Value), "dd/mm/yy")
    UserForm3AvIns.ValorInserir_Cb.Value = Format(AvInser(17, 2).Value, "#,##0.00")

    '   UserForm3AvIns.DataRelLig_OpBt.Value = IIf(AvInser(9, 2).Value = 1, Null, False)
    '   UserForm3AvIns.DataRelRes_OpBt.Value = IIf(AvInser(9, 2).Value = 2, Null, False)
    '   UserForm3AvIns.DataVencLig_OpBt.Value = IIf(AvInser(9, 2).Value = 3, Null, False)
    '   UserForm3AvIns.DataVencRes_OpBt.Value = IIf(AvInser(9, 2).Value = 4, Null, False)
    '   UserForm3AvIns.CancelarBt_OpBt.Value = Null


    UserForm3AvIns.Caption = AvInser(1, 1).Value
    UserForm3AvIns.UnidMon_Lb.Caption = AvInser(15, 1).Value
    UserForm3AvIns.DataRelRes_OpBt.Caption = "Inserir em   " & AvInser(11, 1).Value
    UserForm3AvIns.DataVencLig_OpBt.Caption = "Inserir em   " & AvInser(12, 1).Value
    UserForm3AvIns.DataVencRes_OpBt.Caption = "Inserir em   " & AvInser(13, 1).Value
    OcultarExibControles3

    vEnableEvents = True
    Application.ScreenUpdating = True
    UserForm3AvIns.CancelarBt_OpBt.SetFocus
    Application.StatusBar = False
    UserForm3AvIns.Show
    Application.ScreenUpdating = True
    AvInser(1, 2) = BotAcionado
    If FecharArq Then AvInser(2, 2) = "Fechar"
    If BotAcionado <> False Then
        Application.ScreenUpdating = False
        'Atualizar hist|fffd|rico
        Application.ScreenUpdating = False
        If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
            SalvarHist = False
            AtuHist "DataInserir", UserForm3AvIns.DataInserir_Cb.Value, Format(DateValue(AvInser(14, 2)), "dd/mm/yy")
            AtuHist "ValorInserir", UserForm3AvIns.ValorInserir_Cb.Value, Format(AvInser(17, 2), "#,##0.00")
            If SalvarHist Then SalvandoHist Else Workbooks(NomeArqHist).Close False
        End If
        'Transferindo dados
        AvInser(14, 2) = DateValue(UserForm3AvIns.DataInserir_Cb.Value)
        AvInser(17, 2) = CDbl(UserForm3AvIns.ValorInserir_Cb.Value)

        i = 0
        If IsNull(UserForm3AvIns.DataRelLig_OpBt.Value) Then i = 1
        If IsNull(UserForm3AvIns.DataRelRes_OpBt.Value) Then i = 2
        If IsNull(UserForm3AvIns.DataVencLig_OpBt.Value) Then i = 3
        If IsNull(UserForm3AvIns.DataVencRes_OpBt.Value) Then i = 4
        AvInser(9, 2) = IIf(i > 0, i, -1 * UserForm3AvIns.DataRelLig_OpBt.Value - 2 * UserForm3AvIns.DataRelRes_OpBt.Value - 3 * UserForm3AvIns.DataVencLig_OpBt.Value - 4 * UserForm3AvIns.DataVencRes_OpBt.Value)

        Application.ScreenUpdating = False
    End If
    Unload UserForm3AvIns
    ThisWorkbook.Saved = True
End Sub

Sub OcultarExibControles3()
    With UserForm3AvIns
        .DataRelRes_OpBt.Visible = AvInser(11, 2) > 0
        .DataVencLig_OpBt.Visible = AvInser(12, 2) > 0
        .DataVencRes_OpBt.Visible = AvInser(13, 2) > 0
        .DataVencLig_OpBt.Top = 25 - 20 * (AvInser(11, 2) > 0)
        .DataVencRes_OpBt.Top = 25 - 20 * (AvInser(11, 2) > 0) - 20 * (AvInser(12, 2) > 0)
        i = -20 * (AvInser(11, 2) > 0) - 20 * (AvInser(12, 2) > 0) - 20 * (AvInser(13, 2) > 0)
        .ExibirBt_OpBt.Top = 25 + i
        .CancelarBt_OpBt.Top = 45 + i
        .Ajuda_Bt.Top = 40 + i
        .Agenda.Top = 40 + i
        .Height = 88 + i
    End With
End Sub
Attribute VB_Name = "M|fffd|d14Coment"
Public Coment As Range
'O coment|fffd|rio inicial tem que ser
'pego e inserido diretamente na nota ou na c|fffd|lula alvo, pois
'pode conter mais de 255 caracteres
Public C|fffd|lAlvo As Range
Public ComentIni As String
Public ComentFinal As String


Public Sub ComentVBA()
    NomeArqHist = "Coment.hst"
    Set Coment = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("Coment")
    Set C|fffd|lAlvo = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range(Coment(3))
    If Coment(4).Value = 1 Then
        If Len(C|fffd|lAlvo.NoteText()) > 0 Then ComentIni = C|fffd|lAlvo.Comment.Text Else ComentIni = ""
    Else
        ComentIni = C|fffd|lAlvo.Value
    End If
    Application.ScreenUpdating = False
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
        ActiveWindow.Close False
    End If
    Application.ScreenUpdating = True
    'Ajuda
    i = InStr(1, Coment(2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxIdent").HelpFile = Left(Coment(2).value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False
    UserForm4Coment.HelpContextID = Right(Coment(2).Value, Len(Coment(2).Value) - i)

    vEnableEvents = False

    UserForm4Coment.Observ_Cb.Value = ComentIni

    vSerie = Coment(5).Value
    If Coment(4).Value = 1 And Coment(8).Value >= 0 Then vTipo = "Pagamento"
    If Coment(4).Value = 1 And Coment(8).Value < 0 Then vTipo = "Acr|fffd|scimo"
    If Coment(4).Value = 2 And Coment(8).Value <= 0 Then vTipo = "Pagamento"
    If Coment(4).Value = 2 And Coment(8).Value > 0 Then vTipo = "Acr|fffd|scimo"

    UserForm4Coment.Caption = vSerie & ", " & Format(Coment(6).Value, "dd/mm/yy") & ", Comentar " & vTipo
    UserForm4Coment.Observ_Lb.Caption = "Coment|fffd|rio: (" & vTipo & " de $ " & Format(Abs(Coment(8).Value), "#,##0.00") & " em " & Format(Coment(7).Value, "dd/mm/yy") & ")"

    OcultarExibControles4

    vEnableEvents = True
    Application.ScreenUpdating = True
    UserForm4Coment.OK_Bt.SetFocus
    Application.StatusBar = False
    UserForm4Coment.Show
    Application.ScreenUpdating = True
    Coment(1).Value = BotAcionado
    If FecharArq Then Coment(2).Value = "Fechar"
    If BotAcionado <> False Then
        Application.ScreenUpdating = False
        'Atualizar hist|fffd|rico
        Application.ScreenUpdating = False
        If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
            SalvarHist = False
            ComentFinal = Application.WorksheetFunction.Substitute(UserForm4Coment.Observ_Cb.Value, Chr(13), "")
            AtuHist "Observ", ComentFinal, ComentIni
            If SalvarHist Then SalvandoHist Else Workbooks(NomeArqHist).Close False
        End If
        'Transferindo dados
        If Coment(4).Value = 1 Then
            If Len(C|fffd|lAlvo.NoteText()) = 0 Then C|fffd|lAlvo.AddComment ""
            If UserForm4Coment.Observ_Cb.Value <> "" Then
                Application.ScreenUpdating = False
                C|fffd|lAlvo.Comment.Text Text:=ComentFinal
                C|fffd|lAlvo.Comment.Shape.TextFrame.AutoSize = True
                UserForm4Coment.Observ_Tb.SetFocus
                UserForm4Coment.Observ_Tb.ScrollBars = fmScrollBarsNone
                If C|fffd|lAlvo.Comment.Shape.Width > UserForm4Coment.Observ_Tb.Width * 1.1 Then
                    C|fffd|lAlvo.Comment.Shape.Width = UserForm4Coment.Observ_Tb.Width * 1.1
                    C|fffd|lAlvo.Comment.Shape.Height = UserForm4Coment.Observ_Tb.LineCount * 12
                End If
                With C|fffd|lAlvo.Comment.Shape.TextFrame.Characters.Font
                    .Name = "Arial"
                    .FontStyle = "Normal"
                    .Size = 9
                End With
                Application.ScreenUpdating = True
            Else
                C|fffd|lAlvo.Comment.Delete
            End If
        Else
            If UserForm4Coment.Observ_Cb.Value <> "" Then
                If Len(ComentFinal) > 255 Then MsgBox "Coment|fffd|rios de pagamentos estendidos, especificamente, s|fffd| suportam textos at|fffd| 255 caracteres.", vbInformation + vbOKOnly
                C|fffd|lAlvo.Value = Left(ComentFinal, 255)
                C|fffd|lAlvo.WrapText = False
            Else
                C|fffd|lAlvo.ClearContents
            End If
            C|fffd|lAlvo.Font.ColorIndex = IIf(InStr(1, C|fffd|lAlvo.Value, "desconto", 1) + InStr(1, C|fffd|lAlvo.Value, "desc.", 1) > 0, 3, 0)
        End If
        Application.ScreenUpdating = False
    End If
    Unload UserForm4Coment
    ThisWorkbook.Saved = True
End Sub

Sub OcultarExibControles4()
    With UserForm4Coment
    End With
End Sub
Attribute VB_Name = "M|fffd|d15OrdPag"
Public OrdPag As Range
Dim NumNotes As Long
Public bOpenMpPla As Boolean
Dim nNew As Workbook

Sub OrdenarPagamentosMenu()
    '   NomeArqHist = "CondEst.hst"
    Set OrdPag = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("OrdPag")
    Application.ScreenUpdating = False
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    '   If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
    '      ActiveWindow.Close False
    '   End If
    Application.ScreenUpdating = True
    'Ajuda
    i = InStr(1, OrdPag(2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxIdent").HelpFile = Left(Ordpag(2,2).value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False
    UserForm5OrdPagMenu.HelpContextID = Right(OrdPag(2).Value, Len(OrdPag(2).Value) - i)

    vEnableEvents = False
    OrdPor = OrdPag(5).Value
    VencOrig = OrdPag(6).Value
    Esbo|fffd|o = OrdPag(7).Value
    UserForm5OrdPagMenu.U_NU_E_OpBt.Value = OrdPor = 1
    UserForm5OrdPagMenu.U_E_NU_E_OpBt.Value = OrdPor = 2
    UserForm5OrdPagMenu.NU_E_U_E_OpBt.Value = OrdPor = 3
    UserForm5OrdPagMenu.PorData_OpBt.Value = OrdPor = 4
    UserForm5OrdPagMenu.VencOrigExibir_Chb.Value = VencOrig = 2
    UserForm5OrdPagMenu.ValoresCalculadosApagar_Chb.Value = Esbo|fffd|o = 2

    vEnableEvents = True
    Application.ScreenUpdating = True
    UserForm5OrdPagMenu.OK_Bt.SetFocus
    Application.StatusBar = False
    UserForm5OrdPagMenu.Show
    Application.ScreenUpdating = True
    OrdPag(1) = BotAcionado
    If FecharArq Then OrdPag(2) = "Fechar"
    If BotAcionado <> False Then
        Application.ScreenUpdating = False
        'Atualizar hist|fffd|rico

        'Transferindo dados
        OrdPor = -1 * UserForm5OrdPagMenu.U_NU_E_OpBt.Value _
                - 2 * UserForm5OrdPagMenu.U_E_NU_E_OpBt.Value _
                - 3 * UserForm5OrdPagMenu.NU_E_U_E_OpBt.Value _
                - 4 * UserForm5OrdPagMenu.PorData_OpBt.Value
        VencOrig = UserForm5OrdPagMenu.VencOrigExibir_Chb.Value
        Esbo|fffd|o = UserForm5OrdPagMenu.ValoresCalculadosApagar_Chb.Value
        OrdPag(5) = OrdPor
        OrdPag(6) = 1 - VencOrig * 1
        OrdPag(7) = 1 - Esbo|fffd|o * 1

        Application.ScreenUpdating = False
    End If
    Unload UserForm5OrdPagMenu
    ThisWorkbook.Saved = True
End Sub

Sub OrdenarPagamentos()
'Usando para montar o A568.MDA
    Dim OrdImp As Boolean
    Dim OrdPor As Long
    Dim RowRef As Long   'Linha inicial da tabela dos pagamentos
    Dim |fffd|reaAlvo As Range
    Dim |fffd|reaOrd As Range
    Dim RecBtVis As Boolean   'Para exib e ocult o bot|fffd|o recalcular

    Application.ScreenUpdating = False
    Set nNew = Nothing
    If 10 = 10 Then
        'Antes de New tenta abrir cpap_mp.pla que j|fffd| vem com todos os objetos, evitanto copiar
        'e colar que |fffd| inst|fffd|vel no Excel 2010 principalmente com links. Ele montado pelo sub MontarMpPlaEx10
        'em fase de projeto e vai no pacote. Antes de copiar, pois a crtica em Exclusive perde modo de c|fffd|pia
        Application.DisplayAlerts = False: If Val(Application.Version) >= 15 Then Application.Run "cpap_ex8.mac!WinSDIalinhGet": Application.ScreenUpdating = True   'No Excel 2013 SDI estoca pos e size da janela ativa para alinh a abrir. E ScreenUpdating para o Excel atualizar a ribbon da nova janela SDI
        On Error Resume Next: Application.Run "cpap_ex8.mac!EnableEventsVBA", False: DirP = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirP").Value): DirPini = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirPini").Value): If DirP <> DirPini And Dir(DirPini & "\cpap_mp.pla") <> "" Then Application.Run "Cpap_ex8.Mac!CopyDirPiniVBA", DirP & "\cpap_mp.pla", DirPini, DirP    'No 2013 para copiar, mas era bug do 14. No entanto s|fffd| vai copiar se existir em DirPini assim j|fffd| vai para new sem perca de tempo e alertas
        Set nNew = Workbooks.Open(ThisWorkbook.Path & "\cpap_mp.pla", 0, True, , "as078)&%#%|fffd|%d")
        bOpenMpPla = Not nNew Is Nothing
        Application.DisplayAlerts = True
        On Error GoTo 0
    End If
    If bOpenMpPla Then
        Application.ScreenUpdating = True    'Necess|fffd|rio no Excel 2007 e 2010 devido a convers|fffd|o.
        Application.Run "cpap_ex8.mac!MyWait", 0.1
    Else
        Set nNew = Workbooks.Add    'Se falhar vai de New
    End If
    Application.Run "cpap_ex8.mac!EnableEventsVBA", True: If Val(Application.Version) >= 15 Then Application.Run "cpap_ex8.mac!MyWait", 0.3: Application.ExecuteExcel4Macro ("SHOW.TOOLBAR(""Ribbon"",FALSE)"): Application.Run "cpap_ex8.mac!WinSDIalinhSet"    'No 2013 alinh e oculta Ribbon para evitar a exib. da do Excel.

    Workbooks("cpap_mp.mac").Activate
    Application.ScreenUpdating = False
    Set OrdPag = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("OrdPag")
    OrdImp = OrdPag(3).Value
    RowRef = OrdPag(4).Value
    OrdPor = OrdPag(5).Value
    VencOrig = OrdPag(6).Value
    Esbo|fffd|o = OrdPag(7).Value

    MaxP = Workbooks("cpap_mp.mac").Sheets(1).Range("MaxP").Value
    MaxPb = MaxP + 42 + 1
    rDvrs = Workbooks("cpap_mp.mac").Sheets(1).Range("Dvrs").Rows.Count

    'Set |fffd|reaAlvo = Range("Print_Area")
    Set |fffd|reaAlvo = Range(ActiveWorkbook.ActiveSheet.PageSetup.PrintArea)
    iLin = |fffd|reaAlvo.Row
    iCol = |fffd|reaAlvo.Column
    nLin = |fffd|reaAlvo.Rows.Count
    nCol = |fffd|reaAlvo.Columns.Count
    Set |fffd|reaAlvo = Range("A1").Resize(iLin + nLin, iCol + nCol + 6)
    Application.CopyObjectsWithCells = False
    |fffd|reaAlvo.EntireRow.Copy

    nNew.Activate
    Range("A1").PasteSpecial Paste:=xlValues
    Range("A1").PasteSpecial Paste:=xlFormats

    If Val(Application.Version) > 9 Then Range("A1").PasteSpecial Paste:=xlNotes
    'O comando anterior no Excel 8 e 9 cria coment|fffd|rios que provocam GPF ao
    'passar o mouse para visualiz|fffd|-los. Foi contornado com um loop XLM mais lento
    'que antes chama GetNotesRef aqui neste m|fffd|dulo.

    If Val(Application.Version) > 8 Then
        Range("A1").PasteSpecial Paste:=8   'Falha se usar xlColumnWidths
        Application.CutCopyMode = False
        Application.CopyObjectsWithCells = True
    Else
        For i = 1 To 25
            nNew.Sheets(1).Columns(i).ColumnWidth = |fffd|reaAlvo.Columns(i).ColumnWidth
        Next
    End If

    If Val(Application.Version) > 11 Then
        'No Excel 2007, o xlFormats nao cola a altura das linhas. Um loop para ocultar em lote, mais rapido
        Dim iAc As Long
        iAc = 0
        For i = 1 To iLin + nLin
            If |fffd|reaAlvo.Cells(i, 1).Height <> |fffd|reaAlvo.Cells(i + 1, 1).Height Or i = iLin + nLin Then
                If iAc > 0 Then
                    nNew.Sheets(1).Range(nNew.Sheets(1).Cells(i - iAc, 1), nNew.Sheets(1).Cells(i, 1)).EntireRow.RowHeight = |fffd|reaAlvo.Cells(i, 1).Height    '|fffd|reaAlvo.Range(|fffd|reaAlvo.Cells(i - iAc, 1), |fffd|reaAlvo.Cells(i, 1)).EntireRow.RowHeight    'Cells(i, 1).Height
                    iAc = 0
                Else
                    nNew.Sheets(1).Cells(i, 1).EntireRow.RowHeight = |fffd|reaAlvo.Cells(i, 1).Height
                End If
            Else
                iAc = iAc + 1    'Loteando
            End If
            Application.StatusBar = "Verif. altura de linhas: " & Int(i / (iLin + nLin) * 100) & "%"
        Next
        Application.StatusBar = "  "    'False nao atualiza imediatamente no Excel 2007, parece bug
    End If


    Windows(1).Caption = "Acompanhamentos " & IIf(bOpenMpPla, " ", "") & "de  Contrato"
    Set |fffd|reaAlvo = Range("A1").Resize(iLin + nLin, iCol + nCol + 6)
    |fffd|reaAlvo.Offset(0, |fffd|reaAlvo.Columns.Count).Resize(|fffd|reaAlvo.Rows.Count, 40).Clear

    'Copiando os objetos
    If bOpenMpPla Then    '10 = 10 Se abriu MpPla ent|fffd|o n|fffd|o precisa copiar objetos apenas exibir, posicionar e ajustar tamanho, deixando pronto
        Workbooks("cpap_mp.mac").Activate
        Dim Shp As Shape
        For Each Shp In ActiveWorkbook.ActiveSheet.Shapes
            If Shp.Visible And InStr(1, Shp.Name, "Commen") = 0 Then
                nNew.Sheets(1).Shapes(Shp.Name).Visible = True
                nNew.Sheets(1).Shapes(Shp.Name).Height = Shp.Height
                nNew.Sheets(1).Shapes(Shp.Name).Width = Shp.Width
                If Shp.Top > 0 Then nNew.Sheets(1).Shapes(Shp.Name).Top = Shp.Top
                If Shp.Left > 0 Then nNew.Sheets(1).Shapes(Shp.Name).Left = Shp.Left    'No Excel 2010 n|fffd|o ajusta negativo ent|fffd|o deixa como fic|fffd|

                If Shp.Name = "Button 50" Or Shp.Name = "Button 51" Then    'Bot|fffd|es Antecipar a... e Atualizar para...
                    nNew.Sheets(1).Shapes(Shp.Name).TextFrame.Characters.Font.ColorIndex = Shp.TextFrame.Characters.Font.ColorIndex
                    nNew.Sheets(1).Shapes(Shp.Name).TextFrame.Characters.Text = Shp.TextFrame.Characters.Text
                    nNew.Sheets(1).Shapes(Shp.Name).Width = 85
                End If

                If Shp.Name = "Button 49" Then nNew.Sheets(1).Shapes(Shp.Name).Width = Int(Shp.Width * 1.2)    'Bot|fffd|o do painel fica pequeno no 2007

                If Shp.Name = "Text 52" Then nNew.Sheets(1).Shapes(Shp.Name).Top = Range("A" & RowRef).Offset(MaxPb + rDvrs, 0).Top - 9    'Bot|fffd|o da seta de exibir tudo a vencer
            End If
        Next
    Else
        'ActiveWorkbook.ActiveSheet.DrawingObjects.Copy n|fffd|o funciona no Excel 2007 e a copy de objetos so funciona
        'se nao misturar certos tipos de objetos
        Workbooks("cpap_mp.mac").Activate
        RecBtVis = ActiveWorkbook.ActiveSheet.Shapes("RecalBt").Visible
        If RecBtVis = False Then ActiveWorkbook.ActiveSheet.Shapes("RecalBt").Visible = True
        If 7 = 7 Then ActShDrawingObjectsCopy "RecalBt", "Button" Else ActiveWorkbook.ActiveSheet.DrawingObjects.Copy
        If RecBtVis = False Then ActiveWorkbook.ActiveSheet.Shapes("RecalBt").Visible = False
        Range("A1").Select
        nNew.Activate
        Application.Run "cpap_ex8.mac!MyWait", 0.1    'Tentativa para melhorar estabilidade dando + ou - 7 DoEvents com sleep
        ActiveWorkbook.ActiveSheet.Paste
        Range("A1").Select
        If RecBtVis = False Then ActiveWorkbook.ActiveSheet.Shapes("RecalBt").Visible = False

        Workbooks("cpap_mp.mac").Activate
        If 7 = 7 Then ActShDrawingObjectsCopy "Graf" Else ActiveWorkbook.ActiveSheet.DrawingObjects.Copy
        Range("A1").Select
        nNew.Activate
        Application.Run "cpap_ex8.mac!MyWait", 0.1
        ActiveWorkbook.ActiveSheet.Paste
        Range("A1").Select

        Workbooks("cpap_mp.mac").Activate
        If 7 = 7 Then ActShDrawingObjectsCopy "Fig" Else ActiveWorkbook.ActiveSheet.DrawingObjects.Copy
        Range("A1").Select
        nNew.Activate
        Application.Run "cpap_ex8.mac!MyWait", 0.1
        ActiveWorkbook.ActiveSheet.Paste
        Range("A1").Select

        Workbooks("cpap_mp.mac").Activate
        If 7 = 7 Then ActShDrawingObjectsCopy "Line", "Text", "Rect" Else ActiveWorkbook.ActiveSheet.DrawingObjects.Copy
        Range("A1").Select
        nNew.Activate
        Application.Run "cpap_ex8.mac!MyWait", 0.1
        ActiveWorkbook.ActiveSheet.Paste
        Range("A1").Select
    End If

    'Copiando Configuracao
    Dim Cfg(8)
    Workbooks("cpap_mp.mac").Activate
    With ActiveWindow
        Cfg(0) = .DisplayGridlines
        Cfg(1) = .DisplayHeadings
        Cfg(2) = .DisplayOutline
        Cfg(3) = .DisplayZeros
        Cfg(4) = .DisplayWorkbookTabs
        Cfg(5) = .Zoom
        Cfg(6) = .SplitRow
        Cfg(7) = .SplitColumn
        Cfg(8) = .FreezePanes
    End With

    nNew.Activate
    With ActiveWindow
        .DisplayGridlines = Cfg(0)
        .DisplayHeadings = Cfg(1)
        .DisplayOutline = Cfg(2)
        .DisplayZeros = Cfg(3)
        .DisplayWorkbookTabs = Cfg(4)
        .Zoom = Cfg(5)
        .SplitRow = Cfg(6)
        .SplitColumn = Cfg(7)
        .FreezePanes = Cfg(8)
    End With


    'Configurar p|fffd|gina para impress|fffd|o
    If OrdImp Then
        If Workbooks("cpap_jap.mac").Sheets(1).Range("FormTipo").Value Then
            'Usar XLM parece mais r|fffd|pido. Fica como padr|fffd|o
            Application.Run "cpap_mp.mac!OrdPagPageSetup"
        Else
            'Usar VBA parece mais lento. Para testar basta
            'acionar Ctrl+Q e Cancelar para formul|fffd|rio em XLM
            Set mpPageSetup = Workbooks("cpap_mp.mac").Sheets(1).PageSetup
            With ActiveWorkbook.ActiveSheet.PageSetup
                .PrintTitleRows = mpPageSetup.PrintTitleRows
                .PrintTitleColumns = mpPageSetup.PrintTitleColumns
            End With
            ActiveWorkbook.ActiveSheet.PageSetup.PrintArea = mpPageSetup.PrintArea
            With ActiveWorkbook.ActiveSheet.PageSetup
                .LeftHeader = mpPageSetup.LeftHeader
                .CenterHeader = mpPageSetup.CenterHeader
                .RightHeader = mpPageSetup.RightHeader
                .LeftFooter = mpPageSetup.LeftFooter
                .CenterFooter = mpPageSetup.CenterFooter
                .RightFooter = mpPageSetup.RightFooter
                .LeftMargin = mpPageSetup.LeftMargin
                .RightMargin = mpPageSetup.RightMargin
                .TopMargin = mpPageSetup.TopMargin
                .BottomMargin = mpPageSetup.BottomMargin
                .HeaderMargin = mpPageSetup.HeaderMargin
                .FooterMargin = mpPageSetup.FooterMargin
                .PrintHeadings = mpPageSetup.PrintHeadings
                .PrintGridlines = mpPageSetup.PrintGridlines
                .PrintComments = mpPageSetup.PrintComments
                .CenterHorizontally = mpPageSetup.CenterHorizontally
                .CenterVertically = mpPageSetup.CenterVertically
                .Orientation = mpPageSetup.Orientation
                .Draft = mpPageSetup.Draft
                .PaperSize = mpPageSetup.PaperSize
                .FirstPageNumber = mpPageSetup.FirstPageNumber
                .Order = mpPageSetup.Order
                .BlackAndWhite = mpPageSetup.BlackAndWhite
                .Zoom = mpPageSetup.Zoom
                .FitToPagesWide = mpPageSetup.FitToPagesWide
                .FitToPagesTall = mpPageSetup.FitToPagesTall
            End With
        End If
    End If

    'Excluindo objetos em exib n|fffd|o imprim|fffd|veis e sem links
    If Not bOpenMpPla Then    '10=10 n|fffd|o |fffd| necess., pois os objetos j|fffd| foram posicionado e os sem import. ficar|fffd|o ocultos
        For Each Fig In ActiveWorkbook.ActiveSheet.Shapes
            If Fig.Visible Then
                Fig.Select
                If Not Selection.PrintObject And Fig.OnAction = "" Then
                    Fig.Delete
                Else
                    'No Excel 2007 com os objetos sendo copiadas por tipo, esses precisam de reajuste de posicao
                    If Fig.Name = "Figura 24" Then Selection.ShapeRange.Left = Workbooks("cpap_mp.mac").ActiveSheet.Shapes("Figura 24").Left
                    If Fig.Name = "Figura 25" Then Selection.ShapeRange.Left = Workbooks("cpap_mp.mac").ActiveSheet.Shapes("Figura 25").Left
                    If Fig.Name = "Figura 213" Then Selection.ShapeRange.Left = Workbooks("cpap_mp.mac").ActiveSheet.Shapes("Figura 213").Left
                    If Fig.Name = "Figura 214" Then Selection.ShapeRange.Left = Workbooks("cpap_mp.mac").ActiveSheet.Shapes("Figura 214").Left
                    If Fig.Name = "Figura 34" Then Selection.ShapeRange.Left = Workbooks("cpap_mp.mac").ActiveSheet.Shapes("Figura 34").Left

                    If Fig.Name = "Text 52" Then Selection.ShapeRange.Top = Range("A" & RowRef).Offset(MaxPb + rDvrs, 0).Top - 9
                End If
            End If
        Next
    End If

    'Preparando coluna extra de vencimentos originais.
    If VencOrig = 2 Then
        Range("I" & RowRef).Resize(MaxPb).Value2 = Range("B" & RowRef).Resize(MaxPb).Value2
        Range("I" & RowRef).Resize(MaxPb).NumberFormat = Range("J" & RowRef).NumberFormat
        Range("I" & RowRef).Offset(MaxPb + 1, 0).Resize(rDvrs - 1, 1).ClearContents

        Range("I" & RowRef).Offset(-2, 0).Value = "Original"
        'Afasta texto para n|fffd|o influir no autofit das colunas
        Range("J" & RowRef).Offset(-3, 0).ClearContents
        Range("M" & RowRef).Offset(MaxPb + 1, 0).Resize(rDvrs - 1, 1).Value2 = Range("K" & RowRef).Offset(MaxPb + 1, 0).Resize(rDvrs - 1, 1).Value2
        Range("K" & RowRef).Offset(MaxPb + 1, 0).Resize(rDvrs - 1, 1).ClearContents

        Range("I" & RowRef).Offset(-3, 0).Resize(3 + MaxPb + rDvrs + 2, 4).Columns.AutoFit

        Range("I" & RowRef).Offset(-3, 0).Value = "Datas"    'Vencimento"
        Range("K" & RowRef).Offset(MaxPb + 1, 0).Resize(rDvrs - 1, 1).Value2 = Range("M" & RowRef).Offset(MaxPb + 1, 0).Resize(rDvrs - 1, 1).Value2
        Range("M" & RowRef).Offset(MaxPb + 1, 0).Resize(rDvrs - 1, 1).ClearContents

        Range("J" & RowRef).Offset(-34, 0).Resize(19, 1).Cut
        Range("I" & RowRef).Offset(-34, 0).Insert Shift:=xlToRight
    End If


    'Preparar para ordenar
    Range("A1").Select
    Set |fffd|reaOrd = Range("A" & RowRef).Resize(MaxPb + rDvrs, 25)

    'Preformatando, se for ordenar
    If OrdPor > 1 Then
        With |fffd|reaOrd.Range(Cells(MaxPb + 2, 7), Cells(MaxPb + rDvrs, 7))
            .Select
            .Borders(xlEdgeLeft).LineStyle = xlNone
            .Borders(xlEdgeTop).LineStyle = xlNone
            .Borders(xlEdgeBottom).LineStyle = xlNone
            .Borders(xlEdgeRight).LineStyle = xlNone
            .Borders(xlInsideVertical).LineStyle = xlNone
            .Borders(xlInsideHorizontal).LineStyle = xlNone
        End With
        With |fffd|reaOrd.Range(Cells(MaxPb + 2, 8), Cells(MaxPb + rDvrs, 12))
            .Borders(xlEdgeLeft).Weight = xlThin
            .Borders(xlEdgeTop).Weight = xlThin
            .Borders(xlEdgeBottom).Weight = xlThin
            .Borders(xlEdgeRight).Weight = xlThin
            .Borders(xlInsideVertical).Weight = xlThin
            .Borders(xlInsideHorizontal).Weight = xlThin
        End With
        With |fffd|reaOrd.Range(Cells(MaxPb + 2, 14), Cells(MaxPb + rDvrs, 17))
            .Borders(xlEdgeLeft).Weight = xlThin
            .Borders(xlEdgeTop).Weight = xlThin
            .Borders(xlEdgeBottom).Weight = xlThin
            .Borders(xlEdgeRight).Weight = xlThin
            .Borders(xlInsideVertical).Weight = xlThin
            .Borders(xlInsideHorizontal).Weight = xlThin
        End With
        With |fffd|reaOrd.Range(Cells(MaxPb + 2, 10), Cells(MaxPb + rDvrs, 10))
            .Borders(xlEdgeLeft).Weight = xlMedium
            .Borders(xlEdgeTop).Weight = xlMedium
            .Borders(xlEdgeBottom).Weight = xlMedium
            .Borders(xlEdgeRight).Weight = xlMedium
            .Borders(xlInsideHorizontal).Weight = xlMedium
        End With
        With |fffd|reaOrd.Range(Cells(MaxPb + 2, 14), Cells(MaxPb + rDvrs, 14))
            .Borders(xlEdgeLeft).Weight = xlMedium
            .Borders(xlEdgeTop).Weight = xlMedium
            .Borders(xlEdgeBottom).Weight = xlMedium
            .Borders(xlEdgeRight).Weight = xlMedium
            .Borders(xlInsideHorizontal).Weight = xlMedium
        End With
        With |fffd|reaOrd.Range(Cells(MaxPb + 2, 20), Cells(MaxPb + rDvrs, 25))
            .Locked = False
            .FormulaHidden = False
            .Borders(xlEdgeLeft).Weight = xlThin
            .Borders(xlEdgeTop).Weight = xlThin
            .Borders(xlEdgeBottom).Weight = xlThin
            .Borders(xlEdgeRight).Weight = xlThin
            .Borders(xlInsideVertical).Weight = xlThin
            .Borders(xlInsideHorizontal).Weight = xlThin
        End With
    End If

    'Ordenando
    If OrdPor = 4 Then
        'Preservar data na coluna B para ordenar pela data
        Range("B" & RowRef).Resize(MaxPb).Value2 = Range("J" & RowRef).Resize(MaxPb).Value2
        Range("B" & RowRef).Offset(MaxPb + 1).Resize(rDvrs - 1).Value2 = Range("E" & RowRef).Offset(MaxPb + 1).Resize(rDvrs - 1).Value2
    End If

    Range("D" & RowRef).Resize(2, 2).Clear
    Range("D" & RowRef).Value = 1
    Range("D" & RowRef).Resize(MaxPb).FormulaR1C1 = "=R[-1]C+1"
    Range("D" & RowRef).Resize(MaxPb).Value = Range("D" & RowRef).Resize(MaxPb).Value

    Range("E" & RowRef).Value = 1
    Range("E" & RowRef).Resize(MaxPb + rDvrs - 1).FormulaR1C1 = "=R[-1]C+1"
    Range("E" & RowRef).Resize(MaxPb + rDvrs - 1).Value = Range("E" & RowRef).Resize(MaxPb + rDvrs - 1).Value

    Range("C1").Value = 1
    Range("C2").Resize(iLin + nLin - 1).FormulaR1C1 = "=R[-1]C+1"
    Range("C2").Resize(iLin + nLin - 1).Value = Range("C2").Resize(iLin + nLin - 1).Value

    If OrdPor = 3 Then
        'Captar posi|fffd||fffd|o do vencimento, incrementando as presta|fffd||fffd|es para ao ordenar pela coluna jogar presta|fffd||fffd|es para o final
        Range("B" & RowRef).Resize(MaxPb + rDvrs - 1).FormulaR1C1 = "=IF(RC[2]="""","""",RC[2]+" & MaxPb & "*(RC[2]<" & MaxP & "))"
        Range("B" & RowRef).Resize(MaxPb + rDvrs - 1).Value = Range("B" & RowRef).Resize(MaxPb + rDvrs - 1).Value
    End If

    'Excluindo linhas de divis|fffd|o sem formata|fffd||fffd|o adequada antes de ordenar
    If OrdPor > 1 Then
        |fffd|reaOrd.Cells(MaxPb + 1, 1).EntireRow.Delete
        |fffd|reaOrd.Cells(MaxP + 1, 1).EntireRow.Delete
        'Marcar ocultas e diversos para jogar para o final e excluir ocultos depois de ordenar
        nLin = |fffd|reaOrd.Rows.Count
        nLinO = 0
        For i = 1 To nLin
            If |fffd|reaOrd.Cells(i, 4).Value = "" Then |fffd|reaOrd.Cells(i, 4).Value = 555554
            If |fffd|reaOrd.Cells(i, 4).Height = 0 Then
                |fffd|reaOrd.Cells(i, 4).Value = 555555
                nLinO = nLinO + 1
            End If
        Next
        |fffd|reaOrd.EntireRow.Hidden = False
        |fffd|reaOrd.Sort Key1:=Range("D" & RowRef), Order1:=xlAscending, Key2:=Range("E" & RowRef), Order2:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
        If nLinO > 0 Then |fffd|reaOrd.Range(Cells(nLin - nLinO + 1, 4), Cells(nLin, 4)).EntireRow.Delete

        If nLinO < nLin Then
            If OrdPor = 3 Or OrdPor = 4 Then |fffd|reaOrd.Sort Key1:=Range("B" & RowRef), Order1:=xlAscending, Key2:=Range("D" & RowRef), Order2:=xlAscending, Key3:=Range("E" & RowRef), Order3:=xlAscending, Header:=xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom

            'Formatar Estendidos
            Lin1 = ""
            Lin2 = ""
            nLin = |fffd|reaOrd.Rows.Count
            For i = 2 To nLin + 1
                If Lin1 = "" And |fffd|reaOrd.Cells(i, 7) = |fffd|reaOrd.Cells(i - 1, 7) Then Lin1 = i - 1
                If Lin1 <> "" And |fffd|reaOrd.Cells(i, 7) <> """" And |fffd|reaOrd.Cells(i, 7) <> |fffd|reaOrd.Cells(i - 1, 7) Then Lin2 = i - 1
                If Lin1 <> "" And Lin2 = "" And |fffd|reaOrd.Cells(i + 1, 7) = "Dvrs" Then Lin2 = i

                If |fffd|reaOrd.Cells(i, 7) = "Dvrs" Then
                    |fffd|reaOrd.Range(Cells(i, 19), Cells(nLin, 25)).Clear
                    With |fffd|reaOrd.Range(Cells(i, 7), Cells(nLin, 25))
                        .Borders(xlEdgeTop).Weight = xlMedium
                        .Borders(xlEdgeBottom).Weight = xlMedium
                    End With
                    Exit For
                End If

                If Lin1 <> "" And Lin2 <> "" And Lin2 > Lin1 Then
                    |fffd|reaOrd.Range(Cells(Lin1 + 1, 7), Cells(Lin2, 9)).Clear
                    |fffd|reaOrd.Range(Cells(Lin1 + 1, 17), Cells(Lin2, 25)).Clear
                    With |fffd|reaOrd.Range(Cells(Lin1 + 1, 11), Cells(Lin2, 11))
                        .Borders(xlEdgeLeft).Weight = xlMedium
                        .Borders(xlEdgeTop).Weight = xlThin
                        .Borders(xlEdgeBottom).Weight = xlThin
                        .Borders(xlEdgeRight).LineStyle = xlNone
                    End With
                    With |fffd|reaOrd.Range(Cells(Lin1, 7), Cells(Lin2, 25))
                        .Borders(xlEdgeTop).Weight = xlMedium
                        .Borders(xlEdgeBottom).Weight = xlMedium
                    End With
                    Lin1 = ""
                    Lin2 = ""
                End If
            Next
            |fffd|reaOrd.Replace What:="Venc. ??/??/??", Replacement:="", LookAt:=xlPart, _
                    SearchOrder:=xlByColumns, MatchCase:=False
            |fffd|reaOrd.Replace What:="Mu:", Replacement:="    Mu:", LookAt:=xlPart, _
                    SearchOrder:=xlByColumns, MatchCase:=False
            |fffd|reaOrd.Replace What:="""", Replacement:="      """, LookAt:=xlPart, _
                    SearchOrder:=xlByColumns, MatchCase:=False
        End If
    End If
    Application.GoTo Range("A1"), True

    'Formatando coment|fffd|rios, mesclar c|fffd|lula e alinhar
    nLin = |fffd|reaAlvo.Rows.Count
    For Each l In |fffd|reaAlvo.Range(Cells(nLin - 6, 7), Cells(nLin - 2, 19)).Rows
        l.HorizontalAlignment = xlLeft
        l.VerticalAlignment = xlCenter
        l.WrapText = True
        l.MergeCells = True
    Next

    'Limpar colunas de valores calculados para deixar em branco
    If Esbo|fffd|o = 2 Then
        Range("O" & RowRef).Offset(-4, 0).Resize(4 + |fffd|reaOrd.Rows.Count + 12, 4).ClearContents
        Range("O" & RowRef).Offset(-4, 0).Resize(4 + |fffd|reaOrd.Rows.Count + 12, 4).ClearNotes
        Range("L" & RowRef).Offset(-4, 0).Resize(4 + |fffd|reaOrd.Rows.Count + 3, 1).ClearContents
    End If

    ActiveWorkbook.ActiveSheet.ScrollArea = |fffd|reaAlvo.Resize(|fffd|reaAlvo.Rows.Count + 60).Address
    '   Application.ScreenUpdating = True
    Application.StatusBar = False
    Set nNew = Nothing
End Sub

Sub aaaa()
    ActiveWorkbook.ActiveSheet.ScrollArea = ""
    Application.Run Range("[cpap_pri.mac]cpap_pri!MenuOrig")
    Cells.EntireColumn.Hidden = False
    Cells.EntireRow.Hidden = False
End Sub

Public Function GetNotesRef()
    Dim ArrayFiles() As String
    Workbooks("cpap_mp.mac").Activate
    Set |fffd|reaAlvo = Range(ActiveWorkbook.ActiveSheet.PageSetup.PrintArea)
    Set |fffd|reaAlvo = Range(ActiveWorkbook.ActiveSheet.PageSetup.PrintArea).Resize(, 19)
    Set |fffd|reaAlvo = |fffd|reaAlvo.SpecialCells(xlCellTypeComments).SpecialCells(xlCellTypeVisible)
    ReDim Preserve ArrayFiles(0 To |fffd|reaAlvo.Cells.Count - 1)
    NumNotes = 0
    For Each C In |fffd|reaAlvo.Cells
        ArrayFiles(NumNotes) = C.Address
        NumNotes = NumNotes + 1
        Application.StatusBar = NumNotes
    Next
    GetNotesRef = Application.Transpose(ArrayFiles())
End Function

Sub OrdPagAguarde()
    Dim TxtBox As Shape
    vLeft = Application.ActiveWindow.ActiveCell.Left - 80
    vTop = Application.ActiveWindow.ActiveCell.Top - 30
    Set TxtBox = ActiveWorkbook.ActiveSheet.Shapes.AddTextbox(msoTextOrientationHorizontal, _
            vLeft, vTop, 196.5, 39.75)
    With TxtBox.TextFrame
        .Characters.Text = "Recalculando! Aguarde..."
        .Characters.Font.FontStyle = "Negrito"
        .Characters.Font.Size = 30
        .Characters.Font.ColorIndex = 3
        .AutoSize = True
    End With
    TxtBox.Fill.Visible = msoFalse
    TxtBox.Line.Visible = msoFalse
    '   TxtBox.Name = "RecalAguarde"
    TxtBox.Placement = xlFreeFloating
    Application.ScreenUpdating = True
End Sub

Sub OrdPagNoteClick()
    Dim TxtBox As Shape
    '   r = ActiveWindow.Panes(1).ScrollRow
    '   c = ActiveWindow.Panes(1).ScrollColumn
    '   vLeft = Cells(r, c).Left + 5
    '   vTop = Cells(r, c).Top + 5

    Application.GoTo Range("G64"), True
    vLeft = Range("G64").Left + 2 + IIf(ActiveWorkbook.ActiveSheet.Shapes("RecalBt").Visible, 200, 0)
    vTop = Range("G64").Top + 2
    ActiveWindow.SplitRow = 1
    ActiveWindow.FreezePanes = True

    Set TxtBox = ActiveWorkbook.ActiveSheet.Shapes.AddTextbox(msoTextOrientationHorizontal, _
            vLeft, vTop, 196.5, 39.75)
    With TxtBox.TextFrame
        '.Characters.Text = "Coment|fffd|rios (" & NumNotes & ")" & Chr(10) & "Clique aqui para pontuar"
        .Characters.Text = "Pontuar Coment|fffd|rios (" & NumNotes & ")"
        .Characters.Font.FontStyle = "Negrito"
        '      .Characters.Font.Size = 20
        '      .Characters.Font.ColorIndex = 3
        .AutoSize = True
    End With
    '   TxtBox.Fill.Visible = msoFalse
    '   TxtBox.Line.Visible = msoFalse
    TxtBox.Fill.ForeColor.SchemeColor = 26
    TxtBox.Shadow.Type = msoShadow14
    TxtBox.ZOrder msoSendToBack
    TxtBox.Name = "CommPontuar"
    TxtBox.Placement = xlFreeFloating
    TxtBox.OnAction = "cpap_mp.mac!OrdPagNotes"
    '   Application.ScreenUpdating = True
End Sub

Private Sub ActShDrawingObjectsCopy(sType1 As String, Optional sType2, Optional sType3)
' ActiveWorkbook.ActiveSheet.DrawingObjects.Copy n|fffd|o funciona no Excel 2007
    If IsMissing(sType2) Then sType2 = sType1
    If IsMissing(sType3) Then sType3 = sType1
   
    Dim ShpArray() As Variant  'Importante ser variant
    Dim Count As Long
    Dim Shp As Shape
    Dim vSel
    Set vSel = Selection()
    For Each Shp In ActiveWorkbook.ActiveSheet.Shapes
        If Shp.Visible = True And (InStr(Shp.Name, sType1) > 0 Or InStr(Shp.Name, sType2) > 0 Or InStr(Shp.Name, sType3) > 0) Then
            ReDim Preserve ShpArray(Count)
            ShpArray(Count) = Shp.Name
            Count = Count + 1
        End If
    Next
    Application.Run "cpap_ex8.mac!ClearClipb"
    ActiveWorkbook.ActiveSheet.Shapes.Range(ShpArray()).Select    'Poderia agrupar para copiar sem selecionar mais vai alterar o indice de figura
    Selection.Copy
    vSel.Select
End Sub

Private Sub MontarMpPlaEx10()
    If Val(Application.Version) <> 10 Then Stop
    Workbooks("cpap_mp.mac").Activate
    If ActiveWorkbook.ActiveSheet.Range("A1").Height = 0 Then Exit Sub
    Set ShMpMac = Workbooks("cpap_mp.mac").Sheets(1)
    Set nNew = Workbooks.Add(xlWBATWorksheet)
    With ActiveWindow
        .DisplayGridlines = False
        .DisplayHeadings = False
        .DisplayWorkbookTabs = False
    End With

    Dim Shp As Shape
    For Each Shp In ShMpMac.Shapes
        If InStr(1, Shp.Name, "Commen") = 0 Then
            Shp.Visible = True
            Shp.Copy
            ActiveWorkbook.ActiveSheet.Paste
            Selection.Name = Shp.Name
            Selection.Top = Shp.Top
            Selection.Left = Shp.Left
            Selection.Visible = False
            Range("A1").Select
        End If
    Next

    ActiveWorkbook.Names.Add Name:="Auto_Close", RefersToR1C1:="=cpap_mp.mac!OrdPagAutoFechar"
    ActiveWorkbook.Names.Add Name:="Aberto", RefersToR1C1:="=[cpap_pri.mac]cpap_pri!DirP"
    ActiveWorkbook.Names.Add Name:="DirP", RefersToR1C1:="=[cpap_pri.mac]cpap_pri!DirP"


    If MsgBox("Salvar cpap_mp.pla?", vbOKCancel) = vbOK Then
        On Error Resume Next
        Workbooks("cpap_mp.pla").Close False
        On Error GoTo 0
        nNew.SaveAs ThisWorkbook.Path & "\cpap_mp.pla", , "as078)&%#%|fffd|%d"
    End If
End Sub
Attribute VB_Name = "M|fffd|d16EstSerie"
Public EstSer As Range
Public RowRef As Long
Public MaxP As Long
Public MaxPb As Long
Public ONPrt As Long
Public ONBl As Long

Public Sub EstSerieVBA()
    NomeArqHist = "EstSerie.hst"
    Set EstSer = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("EstSer")
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
        ActiveWindow.Close False
    End If
    '    Application.ScreenUpdating = True

    'Ajuda
    i = InStr(1, EstSer(2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxIdent").HelpFile = Left(EstSer(2).value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False
    UserForm6EstSerie.HelpContextID = Right(EstSer(2).Value, Len(EstSer(2).Value) - i)

    vEnableEvents = False
    RowRef = EstSer(3).Value
    MaxP = Workbooks("cpap_mp.mac").Sheets(1).Range("MaxP").Value
    ONPrt = Workbooks("cpap_mp.mac").Sheets(1).Range("ONPrt").Value
    ONBl = Workbooks("cpap_mp.mac").Sheets(1).Range("ONBl").Value
    MaxPb = MaxP + 42 + 1
    With UserForm6EstSerie
        '.ValorInserir_Cb.Value = Format(0, "#,##0.00")
        .ValorTotal_Cb.Value = Format(EstSer(5).Value, "#,##0.00")
        .PrestDe_Chb.Value = EstSer(6).Value
        .BalDe_Chb.Value = EstSer(7).Value
        .SaltarComPag_Chb.Value = EstSer(8).Value
        .SaltarComAcr_Chb.Value = EstSer(9).Value
        .SaltarPasd_Chb.Value = EstSer(10).Value
        .SaltarLiq_Chb.Value = EstSer(11).Value
        .ObservPrefix_Chb.Value = EstSer(12).Value
        .Observ_Cb.Value = EstSer(13).Value
        vEnableEvents = True
        .DataInserir_Cb.Value = Format(DateValue(EstSer(4).Value), "dd/mm/yy")
    End With

    Application.ScreenUpdating = True
    UserForm6EstSerie.Cancelar_Bt.SetFocus
    Application.StatusBar = False
    UserForm6EstSerie.Show
    Application.ScreenUpdating = True
    EstSer(1).Value = BotAcionado
    If FecharArq Then EstSer(2).Value = "Fechar"
    If BotAcionado <> False Then
        Application.ScreenUpdating = False
        'Atualizar hist|fffd|rico
        Application.ScreenUpdating = False
        If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
            SalvarHist = False
            AtuHist "DataInserir", UserForm6EstSerie.DataInserir_Cb.Value, Format(DateValue(EstSer(4).Value), "dd/mm/yy")
            AtuHist "ValorInserir", UserForm6EstSerie.ValorInserir_Cb.Value, Format(0, "#,##0.00")
            AtuHist "ValorTotal", UserForm6EstSerie.ValorInserir_Cb.Value, Format(0, "#,##0.00")
            If SalvarHist Then SalvandoHist Else Workbooks(NomeArqHist).Close False
        End If
        'Transferindo dados
        With UserForm6EstSerie
            EstSer(4).Value = DateValue(.DataInserir_Cb.Value)
            EstSer(5).Value = .ValorTotal_Cb.Value
            EstSer(6).Value = .PrestDe_Chb.Value
            EstSer(7).Value = .BalDe_Chb.Value
            EstSer(8).Value = .SaltarComPag_Chb.Value
            EstSer(9).Value = .SaltarComAcr_Chb.Value
            EstSer(10).Value = .SaltarPasd_Chb.Value
            EstSer(11).Value = .SaltarLiq_Chb.Value
            EstSer(12).Value = .ObservPrefix_Chb.Value
            EstSer(13).Value = .Observ_Cb.Value
        End With
        Application.ScreenUpdating = False
    End If
    Unload UserForm6EstSerie
    ThisWorkbook.Saved = True
End Sub
Attribute VB_Name = "M|fffd|d17PerFixos"
Public PerFixDef As Range
Public PerFixos As String

Public Sub PerFixosDefVBA()
'Embora hist|fffd|rico e range de dados est|fffd|o preparados para uma eventualidade, por enquando
'n|fffd|o s|fffd|o necess|fffd|rios e este procedimento pode ser acionao diretamente do VBA
    NomeArqHist = "ConfgAco.hst"
    Set PerFixDef = Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("PerFixDef")
    Application.ScreenUpdating = False
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
        ActiveWindow.Close False
    End If
    Application.ScreenUpdating = True
    'Ajuda
    i = InStr(1, PerFixDef(2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxConfig").HelpFile = Left(PerFixDef(2).value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False

    PerFixos = Workbooks("cpap_mp.mac").Sheets(1).Range("PerFixos").Value
    UserForm71PerFixos.HelpContextID = Right(PerFixDef(2).Value, Len(PerFixDef(2).Value) - i)

    vEnableEvents = False
    '    UserForm71PerFixos.DataFinal_Cb.Value = Format(DateValue(PerFixDef(3).Value), "dd/mm/yy")
    vEnableEvents = True

    Application.ScreenUpdating = True
    Application.StatusBar = False
    UserForm71PerFixos.OK_Bt.SetFocus
    UserForm71PerFixos.Show
    Application.ScreenUpdating = True
    PerFixDef(1) = BotAcionado
    If FecharArq Then PerFixDef(2) = "Fechar"
    If BotAcionado <> False Then
        Application.ScreenUpdating = False
        'Atualizar hist|fffd|rico
        Application.ScreenUpdating = False
        If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
            SalvarHist = False
            '            AtuHist "DataFinal", UserForm71PerFixos.DataFinal_Cb.Value, Format(DateValue(PerFixDef(3)), "dd/mm/yy")
            If SalvarHist Then SalvandoHist Else Workbooks(NomeArqHist).Close False
        End If

        'Transferindo dados
        Workbooks("cpap_mp.mac").Sheets(1).Range("PerFixos").Value = PerFixos
        'PerFixDef(3) = DateValue(UserForm71PerFixos.DataFinal_Cb.Value)

        Application.ScreenUpdating = False
    End If
    Unload UserForm71PerFixos
    ThisWorkbook.Saved = True
End Sub

Attribute VB_Name = "M|fffd|d2Comum"
Public Const MarcHist = "|fffd|Hist|fffd|rico|fffd|"
Public NomeArqHist As String
Public vEnableEvents As Boolean
Public BotAcionado As Variant
Public SalvarHist As Boolean
Public FormatoHist As String
Public HistEditCampo As String
Public vCloseMode As Integer
Public FecharArq As Boolean
Public NmesIndMax As Long: Public bHtmlHelp As Boolean

Sub AtuHist(vCampo As String, ValorCb As String, ValorOrig As String)
    If ValorCb = "" Or ValorCb = ValorOrig Then Exit Sub
    'Verificando exist|fffd|ncia - Sug. Fixas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo)
    j = 0
    For Each C In campo
        j = j + 1
        If j > 1 And IIf(IsError(C.Value), "", C.Value) = ValorCb Then Exit Sub
    Next

    'Verificando exist|fffd|ncia - Sug. Hist|fffd|ricas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist").End(xlDown))
    If campo.Rows.Count > 10000 Then Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist")
    j = 0
    For Each C In campo
        j = j + 1
        If j > 1 And IIf(IsError(C.Value), "", C.Value) = ValorCb Then Exit Sub
    Next
    'Adicionando |fffd| lista de hist|fffd|rico
    campo.Rows(2).Insert Shift:=xlDown
    campo.Rows(2).Value = "'" & ValorCb   'O ap|fffd|strofo arquivo tudo como texto, previnindo erro em caso de f|fffd|rmula e altera no formato de n|fffd|meros pela planilha
    NumM|fffd|x = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist").Offset(-1, 0).Value
    If campo.Rows.Count > NumM|fffd|x Then campo(NumM|fffd|x + 2).ClearContents
    SalvarHist = True
End Sub

Function MyOpenFile(vFileName As String, vReadOnly As Boolean)
    On Error Resume Next
Retry:
    Application.DisplayAlerts = False
    '                                                         bEnableEvents = Application.EnableEvents
    Application.Run "cpap_ex8.mac!EnableEventsVBA", False    'Application.EnableEvents = False
    Set i = Workbooks.Open(Filename:=vFileName, ReadOnly:=vReadOnly, Notify:=False)
    Application.Run "cpap_ex8.mac!EnableEventsVBA", True    'Application.EnableEvents = bEnableEvents

    'Testar integridade. Ver se abre como texto, se n|fffd|o existe o nome DadosHist, se A1&His<>Ahist
    t1 = i.FileFormat = xlCurrentPlatformText
    t2 = i.Sheets(1).Range("DadosHist").Value
    t2 = t2 = Empty
    If t2 = False Then t3 = i.Sheets(1).Range("DadosHist").Offset(1).Value <> i.Sheets(1).Range("A1").Value & "Hist" Else t3 = False
    If t1 Or t2 Or t3 Then i.Close False

    Application.DisplayAlerts = True
    If i.Name = "" Then
        Select Case MsgBox("O arquivo " & vFileName & " contendo o hist|fffd|rico das caixas de inclus|fffd|o n|fffd|o foi encontrado ou est|fffd| corrompido." & Chr(10) & Chr(10) & "Se acionar Ignorar, o arquivo ser|fffd| ignorado e um novo ser|fffd| gerado para iniciar outro hist|fffd|rico.", vbQuestion + vbAbortRetryIgnore + vbDefaultButton2, "CPAP|fffd| - Tentando Abrir Arquivo de Hist|fffd|rico")
        Case Is = vbRetry
            GoTo Retry
        Case Is = vbAbort
            MyOpenFile = False
            Exit Function
        Case Is = vbIgnore
            Application.Workbooks.Add xlWBATWorksheet
            ActiveWorkbook.Names.Add Name:="DadosHist", RefersToR1C1:=Cells(100, 1)
            If Dir(vFileName) <> "" Then Kill vFileName
            ActiveWorkbook.SaveAs vFileName, IIf(Val(Application.Version) >= 12, 56, xlWorkbookNormal)    'xlExcel8 56
            SalvandoHist
            GoTo Retry
        End Select
    End If
    On Error GoTo 0
    If vReadOnly = False And i.ReadOnly Then
        i.Close False
        j = j + 1
        If j < 4 Then
            Application.Wait Now + TimeValue("00:00:01")
            GoTo Retry
        Else
            If MsgBox("O arquivo " & vFileName & " contendo o hist|fffd|rico das caixas de inclus|fffd|o pode estar em uso por outra esta|fffd||fffd|o. Acione OK para continuar tentando ou Cancelar para desistir?", vbQuestion + vbOKCancel, "CPAP|fffd|") = vbOK Then
                GoTo Retry
            Else
                MyOpenFile = False
                Exit Function
            End If
        End If
    End If
    ActiveWorkbook.ActiveSheet.Unprotect "MP542"
    ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos").CurrentRegion.ClearContents
    Set CopyRng = Range("A1").CurrentRegion
    Set PasteRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2

    ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").CurrentRegion.ClearContents
    Set CopyRng = Range("DadosHist").CurrentRegion
    Set PasteRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2
    MyOpenFile = True
End Function

Sub SalvandoHist()
    Workbooks(NomeArqHist).Sheets(1).Range("A1").CurrentRegion.ClearContents
    Set CopyRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos").CurrentRegion
    Set PasteRng = Workbooks(NomeArqHist).Sheets(1).Range("A1")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2

    Workbooks(NomeArqHist).Sheets(1).Range("DadosHist").CurrentRegion.ClearContents
    i = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").Row
    Workbooks(NomeArqHist).Names.Add Name:="DadosHist", RefersToR1C1:=Workbooks(NomeArqHist).Sheets(1).Cells(i, 1)
    Set CopyRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").CurrentRegion
    Set PasteRng = Workbooks(NomeArqHist).Sheets(1).Range("DadosHist")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2

    Workbooks(NomeArqHist).Activate
    ActiveWorkbook.ActiveSheet.Protect "MP542"
    If Run("cpap_ex8.mac!SaveVBA") Then ActiveWorkbook.Close False
End Sub

Sub ConfHist(vComboBox As Object, vOriginal As String, Optional SemEditSring As Boolean = False, Optional Formato As String)
    i = InStr(1, vComboBox.Name, "_")
    HistEditCampo = Left(vComboBox.Name, i - 1)
    i = MsgBox("OK  -  Configurar sugest|fffd|es fixas e hist|fffd|ricas;" & Chr(10) & Chr(10) & "Cancelar - Restaurar inicial.", vbQuestion + vbOKCancel, "Hist|fffd|rico de Inclus|fffd|es no Campo " & HistEditCampo) = vbOK
    If i Then
        FormatoHist = Formato
        UserFormEditHist.Nova_Bt.Enabled = Not SemEditSring
        UserFormEditHist.SugFixas_Ct.Enabled = Not SemEditSring
        UserFormEditHist.SugHist_Ct.Enabled = Not SemEditSring
        UserFormEditHist.Show
        Unload UserFormEditHist
    End If
    vComboBox.Value = vOriginal
    If i Then ListandoComboBox vComboBox, Formato
    SendKeys "{RIGHT}"
End Sub

Sub ListandoComboBox(vComboBox As Object, Optional Formato As String)
    i = InStr(1, vComboBox.Name, "_")
    vCampo = Left(vComboBox.Name, i - 1)
    'Limpando comboboxes
    While vComboBox.ListCount >= 1
        vComboBox.RemoveItem (0)
    Wend
    'Listando comboboxes - Lista de sug. fixas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo, ThisWorkbook.Sheets(NomeArqHist).Range(vCampo).End(xlDown))
    If campo.Rows.Count < 100 Then
        j = 0
        For Each C In campo
            cf = Format(IIf(IsError(C.Value), "", C.Value), Formato)
            j = j + 1
            If j > 1 Then
                vRep = False
                For i = 1 To vComboBox.ListCount
                    If vComboBox.List(i - 1) = cf Then vRep = True
                Next
                If vRep = False And cf <> "" Then vComboBox.AddItem (cf)
            End If
        Next
    End If
    'Listando comboboxes - Lista de sug. hist|fffd|ricas
    vComboBox.AddItem (MarcHist)
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist").End(xlDown))
    If campo.Rows.Count > 10000 Then Exit Sub
    j = 0
    For Each C In campo
        cf = Format(IIf(IsError(C.Value), "", C.Value), Formato)
        j = j + 1
        If j > 1 Then
            vRep = False
            For i = 1 To vComboBox.ListCount
                If vComboBox.List(i - 1) = cf Then vRep = True
            Next
            If vRep = False And cf <> "" Then vComboBox.AddItem (cf)
        End If
        Application.StatusBar = "Sugest|fffd|es Hist|fffd|ricas em " & vCampo & " " & j & "/" & campo.Rows.Count
    Next
    Application.StatusBar = False
End Sub


'EVENTOS DE CAIXA DE TEXTO PARA VALOR FINANCEIRO

Sub EvValor_Cb_MouseMove(Valor_Cb As Control, ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Valor_Cb.Locked = False
    sd = Application.International(xlDecimalSeparator)
    If Valor_Cb.Text = "0" Or Valor_Cb.Text = "0" & sd & "00" Then
        Valor_Cb.SelStart = 0
        Valor_Cb.SelLength = Len(Valor_Cb.Text)
    End If
End Sub

Sub EvValor_Cb_KeyDown(Valor_Cb As Control, ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    sd = Application.International(xlDecimalSeparator)
    vKeyCode = IIf(sd = ",", 188, 190)
    Valor_Cb.Locked = False
    If KeyCode = 37 Or (Shift = 2 And KeyCode = 86) Or (Shift = 1 And KeyCode = 45) Or (Shift = 2 And KeyCode = 88) Then Exit Sub   'Seta Esquerda e teclas do clipboard
    If KeyCode = 110 Or KeyCode = 190 Then KeyCode = vKeyCode
    If KeyCode = 188 Then If InStr(1, Valor_Cb.Value, sd) > 0 Then Valor_Cb.Locked = True
    If (KeyCode >= 96 And KeyCode <= 105) _
            Or (KeyCode >= 48 And KeyCode <= 57 And Shift = 0) _
            Or KeyCode = 188 Or KeyCode = 8 Or KeyCode = 46 _
            Or KeyCode = 107 Or (KeyCode = 187 And Shift = 1) _
            Or KeyCode = 109 Or (KeyCode = 189 And Shift = 0) Then Else Valor_Cb.Locked = True
End Sub

Sub EvValor_Cb_Change(Valor_Cb As Control, Optional vAbs As Boolean = False)
    i = Valor_Cb.Value
    j = Valor_Cb.SelStart
    SinNeg = vAbs = False And InStr(1, i, "-") > 0 And InStr(1, i, "+") = 0
    i = Application.WorksheetFunction.Substitute(i, "-", "")
    i = Application.WorksheetFunction.Substitute(i, "+", "")
    PartInt = i
    sd = Application.International(xlDecimalSeparator)
    sm = Application.International(xlThousandsSeparator)
    k = InStr(1, i, sd)
    If k > 0 Then
        PartFrac = Mid(i, k + 1, 100)
        PartFrac = Application.WorksheetFunction.Substitute(PartFrac, sm, "")
        PartInt = Mid(i, 1, k - 1)
        If PartInt = "" Then PartInt = "0"
    End If
    TamPartInt = Len(PartInt)
    PartInt = Application.WorksheetFunction.Substitute(PartInt, sm, "")
    PartInt = Format(PartInt, "#,##0")
    RepCurs = Len(PartInt) - TamPartInt
    vEnableEvents = False
    Valor_Cb.Value = IIf(SinNeg, "-", "") & PartInt & IIf(PartInt = "" Or k = 0, "", sd) & PartFrac
    vEnableEvents = True
    j = -(j + RepCurs) * (j + RepCurs >= 0)
    If Left(Valor_Cb.Value, 2) = "0" & sd And j < 3 Then j = 2
    Valor_Cb.SelStart = j

    'Evita colar texto
    Static ValorOld
    If Valor_Cb.Value <> "" And Valor_Cb.Value <> "-" And Not (IsNumeric(Valor_Cb.Value)) Then
        MsgBox Valor_Cb.Value, vbCritical, "Valor Inv|fffd|lido!"
        Valor_Cb.Value = ValorOld
    Else
        ValorOld = Valor_Cb.Value
    End If
End Sub

Sub EvValor_Cb_Exit(Valor_Cb As Control, Cancel As MSForms.ReturnBoolean, Formato As String)
    If Valor_Cb.Value = "" Then Valor_Cb.Value = 0
    If IsNumeric(Valor_Cb.Value) Then
        If Valor_Cb.Value <> Format(Valor_Cb.Value, Formato) Then Valor_Cb.Value = Format(Valor_Cb.Value, Formato)
    Else
        MsgBox "Data inv|fffd|lida!", vbCritical, "CPAP|fffd|"
        Cancel = True
    End If
End Sub


Sub CalculadoraBtClick(vForm As Object, Valor_Cb As Control, Calculadora_Bt As Control, NumDecim As Integer)
    Calculadora_Bt.SpecialEffect = fmSpecialEffectSunken
    If IsNumeric(Valor_Cb.Value) Then CalculadoraValorIni = IIf(Valor_Cb.Value * 1 = 0, 0, Valor_Cb.Value) Else CalculadoraValorIni = 0
    Workbooks("cpap_pri.mac").Sheets(1).Range("CalcVal").Value = CalculadoraValorIni
    Workbooks("cpap_pri.mac").Sheets(1).Range("CalcDec").Value = NumDecim

    Application.ExecuteExcel4Macro ("cpap_pri.mac!CalcVBA()")

    Valor_Cb.Value = Workbooks("cpap_pri.mac").Sheets(1).Range("CalcVal").Value
    Valor_Cb.SetFocus
    Calculadora_Bt.SpecialEffect = fmSpecialEffectEtched
End Sub



'EVENTOS DE CAIXA DE TEXTO DO CALEND|fffd|RIO

Sub EvCalend_Cb_MouseMove(Data_Cb As Control, ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Data_Cb.Locked = False
End Sub

Sub EvCalend_Cb_KeyDown(Data_Cb As Control, ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    j = Data_Cb.SelStart
    If KeyCode = 220 Or KeyCode = 191 Then KeyCode = 111   'Trocando \ por /
    If KeyCode = 8 Then KeyCode = 37    'Trocando Backspace por ser a esquerda

    'Setas, teclas do clipboard e /
    If KeyCode = 16 Or KeyCode = 17 _
            Or KeyCode = 37 Or KeyCode = 39 _
            Or (Shift = 2 And KeyCode = 67) _
            Or (Shift = 2 And KeyCode = 86) _
            Or (Shift = 1 And KeyCode = 45) _
            Or (Shift = 2 And KeyCode = 88) _
            Or (KeyCode = 111 And j > 0 And j < 8) Then
        Data_Cb.Locked = False
        Exit Sub
    End If
    If Data_Cb.SelLength > 1 Then Data_Cb.SelStart = j
    If j = 2 Or j = 5 Then Data_Cb.SelStart = j + 1
    Data_Cb.Locked = False
    If (KeyCode >= 96 And KeyCode <= 105) Or (KeyCode >= 48 And KeyCode <= 57 And Shift = 0) Then Else Data_Cb.Locked = True
    If j >= 8 Then Data_Cb.Locked = True
End Sub

Sub EvCalend_Cb_Change(Data_Cb As Control)
    If vEnableEvents = False Then Exit Sub
    i = Data_Cb.Value
    j = Data_Cb.SelStart
    'Eliminando barra dupla
    iSbd = Application.WorksheetFunction.Substitute(i, "//", "/")
    If i <> iSbd Then
        vEnableEvents = False
        Data_Cb.Value = iSbd
        vEnableEvents = True
        j = InStr(1, i, "//")
        Data_Cb.SelStart = j
        Exit Sub
    End If
    'Prevendo e para manter o formato dd/mm/yy, substituir
    If Len(i) > 8 And j > 0 Then
        vEnableEvents = False
        Data_Cb.Value = Left(i, j) & Mid(i, j + 2, 200)
        vEnableEvents = True
        If j = 2 Or j = 5 Then
            Data_Cb.SelStart = j + 1
        Else
            Data_Cb.SelStart = j
        End If
    End If
    'Tentando limitar a parte do dia
    i = Data_Cb.Value
    If Mid(i, 3, 1) = "/" And IsNumeric(Left(i, 2)) Then
        If Left(i, 2) > 31 And Left(i, 2) < 40 Then
            vEnableEvents = False
            Data_Cb.Value = "30" & Mid(i, 3, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 1
        End If
        If Left(i, 2) > 39 Then
            vEnableEvents = False
            Data_Cb.Value = "0" & Left(i, 1) & Mid(i, 3, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 3
        End If
    End If
    'Tentando limitar a parte do m|fffd|s
    If Mid(i, 3, 1) = "/" And Mid(i, 6, 1) = "/" And IsNumeric(Mid(i, 4, 2)) Then
        If Mid(i, 4, 2) > 12 And Mid(i, 4, 2) < 20 Then
            vEnableEvents = False
            Data_Cb.Value = Left(i, 3) & "12" & Mid(i, 6, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 4
        End If
        If Mid(i, 4, 2) > 19 Then
            vEnableEvents = False
            Data_Cb.Value = Left(i, 3) & "0" & Mid(i, 4, 1) & Mid(i, 6, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 6
        End If
    End If
End Sub

Sub EvCalend_Cb_Exit(Data_Cb As Control, ByVal Cancel As MSForms.ReturnBoolean, Optional DataIni As Date)
    If DataIni = 0 Then DataIni = Now
    i = Data_Cb.Value
    If IsDate(i) Then
        If NmesIndMax = 0 Then NmesIndMax = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("NmesIndMax").Value
        If DateValue(i) < DateSerial(1970, 5, 15) Or DateValue(Data_Cb.Value) > DateSerial(1970, 5 + NmesIndMax, 1) Then
            MsgBox "Data inv|fffd|lida. Digite uma data entre " & Format(DateSerial(1970, 5, 15), "dd/mm/yyyy") & " e " & Format(DateSerial(1970, 5 + NmesIndMax, 1), "dd/mm/yyyy") & ".", vbCritical, "CPAP|fffd|"
            Cancel = True
        End If
        If i <> Format(DateValue(i), "dd/mm/yy") Then Data_Cb.Value = Format(DateValue(i), "dd/mm/yy")
    Else
        'Tentando resolver final de m|fffd|s
        z = InStr(1, i, "/")
        If z > 1 Then
            I1 = Left(i, z - 1)
            i2 = Mid(i, z, 250)
            If IsNumeric(I1) Then
                If IsDate(I1 - 1 & i2) Then
                    Data_Cb.Value = Format(DateValue(I1 - 1 & i2), "dd/mm/yy")
                    Exit Sub
                End If
                If IsDate(I1 - 2 & i2) Then
                    Data_Cb.Value = Format(DateValue(I1 - 2 & i2), "dd/mm/yy")
                    Exit Sub
                End If
                If IsDate(I1 - 3 & i2) Then
                    Data_Cb.Value = Format(DateValue(I1 - 3 & i2), "dd/mm/yy")
                    Exit Sub
                End If
            End If
        End If
        If MsgBox("OK  -  Restaurar inicial, " & Format(DataIni, "dd/mm/yy") & ";" & Chr(10) & Chr(10) & "Cancelar - Voltar para alterar.", vbQuestion + vbOKCancel, "Data Inv|fffd|lida!  Campo: " & Left(Data_Cb.Name, InStr(1, Data_Cb.Name, "_") - 1)) = vbOK Then
            Data_Cb.Value = Format(DataIni, "dd/mm/yy")
        Else
            Cancel = True
        End If
    End If
End Sub


Sub CalendBtClick(vForm As Object, Data_Cb As Control, Calend_Bt As Control)
    Calend_Bt.SpecialEffect = fmSpecialEffectSunken
    CalendDataIni = IIf(IsDate(Data_Cb.Value), Data_Cb.Value, Date)
    Workbooks("cpap_pri.mac").Sheets(1).Range("CalendVal").Value = CalendDataIni

    Application.ExecuteExcel4Macro ("cpap_pri.mac!CalendVBA()")

    Data_Cb.Value = Format(Workbooks("cpap_pri.mac").Sheets(1).Range("CalendVal").Value, "dd/mm/yy")
    Data_Cb.SetFocus
    Calend_Bt.SpecialEffect = fmSpecialEffectEtched
End Sub



'EVENTOS DE CAIXA DE TEXTO PARA N|fffd|MERO DE TELEFONE

Sub EvFone_Cb_Change(Fone_Cb As Control)
    i = Fone_Cb.Value
    j = Fone_Cb.SelStart
    k = Len(i)
    i = Application.WorksheetFunction.Substitute(i, ".", "")
    i = Application.WorksheetFunction.Substitute(i, "-", "")
    vEnableEvents = False
    Fone_Cb.Value = IIf(Len(i) > 3, Left(i, 3) & "-" & Mid(i, 4, 20), i)
    If Len(i) > 7 Then Fone_Cb.Value = Left(i, Len(i) + 4 * (Len(i) > 4)) & "-" & Right(i, 4)
    vEnableEvents = True
    If j < k Then Fone_Cb.SelStart = j
End Sub

Sub EvFone_Cb_KeyDown(Fone_Cb As Control, ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    Fone_Cb.Locked = False
    If KeyCode = 37 Or (Shift = 2 And KeyCode = 86) Or (Shift = 1 And KeyCode = 45) Or (Shift = 2 And KeyCode = 88) Then Exit Sub   'Seta Esquerda e teclas do clipboard
    If KeyCode = 188 Then If InStr(1, Fone_Cb.Value, sd) > 0 Then Fone_Cb.Locked = True
    If (KeyCode >= 96 And KeyCode <= 105) Or (KeyCode >= 48 And KeyCode <= 57 And Shift = 0) Or KeyCode = 188 Or KeyCode = 8 Or KeyCode = 46 Then Else Fone_Cb.Locked = True
End Sub

Sub DesvanecerMesmoPa|fffd|s(Fone_Cb As Control)
    Pa|fffd|sEmpr = Workbooks("Cpap_pri.mac").Excel4MacroSheets(1).Range("Pa|fffd|sEmpr").Value & ""
    Fone_Cb.BackColor = IIf(Fone_Cb.Value = Pa|fffd|sEmpr, &H8000000F, &H80000005)
    Fone_Cb.ForeColor = IIf(Fone_Cb.Value = Pa|fffd|sEmpr, &H80000016, &H80000008)
End Sub

Sub DesvanecerMesmaCid(Fone_Cb As Control)
    CidEmpr = Workbooks("Cpap_pri.mac").Excel4MacroSheets(1).Range("CidEmpr").Value & ""
    Fone_Cb.BackColor = IIf(Fone_Cb.Value = CidEmpr, &H8000000F, &H80000005)
    Fone_Cb.ForeColor = IIf(Fone_Cb.Value = CidEmpr, &H80000016, &H80000008)
End Sub
Attribute VB_Name = "M|fffd|d4Editada"
Sub Editada()
    Dim WbEditada As Workbook
    Set WbEditada = ThisWorkbook
    Windows(WbEditada.Windows(1).Caption).Visible = True
    WbEditada.Activate

    For Each sh In WbEditada.Sheets
        'Este loop |fffd| usado s|fffd| onde houver planilha de hist|fffd|rico
        If Right(sh.Name, 4) = ".hst" Then
            sh.Activate
            NumCampos = Range("A1").CurrentRegion.Columns.Count
            NumSugPadr = Range("A1").CurrentRegion.Rows.Count
            Set Campos = Range(Cells(1, 1), Cells(1, NumCampos))

            'Limpando
            Range("DadosFixos").CurrentRegion.Clear
            Range("DadosHist").CurrentRegion.Clear
            For Each Nome In ActiveWorkbook.ActiveSheet.Names
                Nome.Delete
            Next
            With ActiveWindow
                .SplitColumn = 0
                .SplitRow = 12
            End With

            'Redefinindo
            LFix = 4 + 100   'N|fffd|m de linhas reservadas para sug. fixas. Pode ser alterado o c|fffd|digo |fffd| flex|fffd|vel
            With ActiveWorkbook.ActiveSheet.Names
                Ref = "=" & ActiveWorkbook.ActiveSheet.Name & "!" & Cells(NumSugPadr + 4, 1).Address(ReferenceStyle:=xlR1C1)
                .Add Name:="DadosFixos", RefersToR1C1:=Ref
                Ref = "=" & ActiveWorkbook.ActiveSheet.Name & "!" & Cells(NumSugPadr + 4 + LFix + 1, 1).Address(ReferenceStyle:=xlR1C1)
                .Add Name:="DadosHist", RefersToR1C1:=Ref


                For Each C In Campos
                    .Add Name:=C.Value, RefersToR1C1:=Cells(NumSugPadr + 4, C.Column)
                    .Add Name:=C.Value & "Hist", RefersToR1C1:=Cells(NumSugPadr + 4 + LFix + 2, C.Column)
                    C.Offset(NumSugPadr + 4 + LFix, 0).Value = 15
                    C.Offset(NumSugPadr + 4 + LFix + 1, 0).Value = C.Value & "Hist"
                Next
            End With
            Range("A1").CurrentRegion.Copy
            Range("DadosFixos").PasteSpecial xlPasteValues
            Application.CutCopyMode = False

            ActiveWindow.Panes(1).Activate
            Application.GoTo Reference:="DadosFixos", Scroll:=True
            ActiveWindow.Panes(3).Activate
            Application.GoTo Reference:="DadosHist", Scroll:=True
        End If
    Next

    If WbEditada.ReadOnly Then WbEditada.ChangeFileAccess xlReadWrite
    If Val(Application.Version) < 9 Then If MsgBox(WbEditada.Name & ".  Indenter? (Distanciar margens)", vbOKCancel) = vbOK Then Run "Indenter97.xla!IndentProject"
    WbEditada.Sheets(1).Select
    If MsgBox(WbEditada.Name & ".  Limpar C|fffd|digo?", vbOKCancel) = vbOK Then
        Application.OnTime Now, "VBACodeCleaner.xla!CodeCleanerMain"
    Else
        WbEditada.Save
    End If
End Sub
Attribute VB_Name = "Plan1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True



























Attribute VB_Name = "Plan3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True



























Attribute VB_Name = "Plan5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True



























Attribute VB_Name = "Plan6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True



























Attribute VB_Name = "Plan7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True



























Attribute VB_Name = "UserForm1Config"
Attribute VB_Base = "0{743D89D8-6695-41C2-86E7-F199DD1AC3DD}{71050313-7DDE-4143-B3D7-27316FAC0F60}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Dim ControleAtivo As Control

Private Sub UserForm_Activate()
    OK_Bt.SetFocus
    ControleAtivo.SetFocus
    Application.SendKeys "{HOME}"
End Sub
Private Sub UserForm_Deactivate()
    Set ControleAtivo = ActiveControl
End Sub

Private Sub UserForm_Initialize()
    vEnableEvents = True
    ListandoComboBox DataInicial_Cb
    ListandoComboBox DataFinal_Cb
    'ListandoComboBox SugIni_Cb
    For i = 1 To Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("DtIni2").Rows.Count
        SugIni_Cb.AddItem (Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("DtIni2").Item(i).Value)
    Next
    SugIni_Cb.Value = SugIni_Cb.List(0)
    'ListandoComboBox SugFim_Cb
    For i = 1 To Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("DtFin2").Rows.Count
        SugFim_Cb.AddItem (Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("DtFin2").Item(i).Value)
    Next
    SugFim_Cb.Value = SugFim_Cb.List(0)

    'ListandoComboBox Meses
    For i = 1 To Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("Meses").Rows.Count
        FixosMeses_Cb.AddItem (Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("Meses").Item(i).Value)
    Next
    FixosMeses_Cb.Value = FixosMeses_Cb.List(nFixosMeses + 1 * (nFixosMeses > 0))
    'ListandoComboBox Dias
    For i = 1 To Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("Dias").Rows.Count
        FixosDias_Cb.AddItem (Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("Dias").Item(i).Value)
    Next
    FixosDias_Cb.Value = FixosDias_Cb.List(nFixosDias + 1 * (nFixosDias > 0))

    ListandoComboBox AumRed_Cb, "#,##0.00########"
    If Not bHtmlHelp Then Ajuda_Bt.HelpContextID = HelpContextID
    Set ControleAtivo = OK_Bt
End Sub

Private Sub DataInicialCalend_Bt_Click()
    CalendBtClick UserForm1Config, DataInicial_Cb, DataInicialCalend_Bt
End Sub

Private Sub DataFinalCalend_Bt_Click()
    CalendBtClick UserForm1Config, DataFinal_Cb, DataFinalCalend_Bt
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub

Private Sub Ok_Bt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub Per|fffd|odosPredef_Chb_Click()
    Hide
    BotAcionado = 24
End Sub

Private Sub SemCorre|fffd||fffd|o_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    If SemCorre|fffd||fffd|o_Chb.Value And Not AlerSemCorrJ|fffd|Feito Then If MsgBox("|fffd|ndices mensais de corre|fffd||fffd|o n|fffd|o ser|fffd|o cobrados m|fffd|s a m|fffd|s, gerando ou n|fffd|o res|fffd|duo para o acerto ao final do per|fffd|odo, normalmente um ano. OK?", vbOKCancel + vbQuestion, "Pagamentos Fixos") = vbCancel Then SemCorre|fffd||fffd|o_Chb.Value = False Else AlerSemCorrJ|fffd|Feito = True
    OcultarExibControles1
    '   Hide
    '   BotAcionado = 26
End Sub

Private Sub JurosIdem_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    If JurosIdem_Chb.Value And Not AlerSemJurJ|fffd|Feito Then If MsgBox("A taxa de juros (juros financeiros), quando houver, tamb|fffd|m n|fffd|o ser|fffd| cobrada m|fffd|s a m|fffd|s, sendo acrescentada ao res|fffd|duo. No entanto, a lei permite essa cobran|fffd|a, mesmo assim voc|fffd| deseja assinalar esta op|fffd||fffd|o?", vbOKCancel + vbQuestion, "Pagamentos Fixos Sem Juros") = vbCancel Then JurosIdem_Chb.Value = False Else AlerSemJurJ|fffd|Feito = True
    '   Hide
    '   BotAcionado = 27
End Sub

Private Sub SemRes|fffd|duo_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    If SemRes|fffd|duo_Chb.Value And Not AlerSemRes|fffd|dJ|fffd|Feito Then If MsgBox("N|fffd|o ser|fffd| cobrado o res|fffd|duo referente a per|fffd|odos sem corre|fffd||fffd|o. Essa op|fffd||fffd|o |fffd| usada em contratos de aluguel e loteamento. Em contratos de compra e venda com prazo superior a 36 meses (3 anos), a lei permite essa cobran|fffd|a." & Chr(10) & Chr(10) & "Deseja assinalar esta op|fffd||fffd|o?", vbOKCancel + vbQuestion, "Res|fffd|duo de Per|fffd|odos Sem Corre|fffd||fffd|o") = vbCancel Then SemRes|fffd|duo_Chb.Value = False Else AlerSemRes|fffd|dJ|fffd|Feito = True
    '   Hide
    '   BotAcionado = 28
End Sub

Private Sub Per|fffd|odos_Bt_Click()
    Hide
    BotAcionado = 29
End Sub

Private Sub Multa_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    If Multa_Chb.Value Then If MsgBox("A multa contratual por atraso n|fffd|o mais ser|fffd| aplicada automaticamente. OK?" & Chr(10) & Chr(10) & "    Obs.: Para eliminar as multas e mora anteriores, j|fffd| salvas, zere as taxas de cada cada pagamento nas colunas ao lado direito da planilha, j|fffd| fora da |fffd|rea de impress|fffd|o.", vbOKCancel + vbQuestion, "Aplicar Multa Autom|fffd|tico") = vbCancel Then Multa_Chb.Value = False
    '   Hide
    '   BotAcionado = 30
End Sub

Private Sub Mora_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    If Mora_Chb.Value Then If MsgBox("A mora contratual por atraso n|fffd|o mais ser|fffd| aplicada automaticamente. OK?", vbOKCancel + vbQuestion, "Aplicar Mora Automatico") = vbCancel Then Mora_Chb.Value = False
    '   Hide
    '   BotAcionado = 31
End Sub

Private Sub Estorno_Chb_Click()
    Hide
    BotAcionado = 35
End Sub

Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub DataInicial_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvCalend_Cb_MouseMove DataInicial_Cb, Button, Shift, x, y
End Sub
Private Sub DataInicial_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvCalend_Cb_KeyDown DataInicial_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then DataInicialCalend_Bt_Click
End Sub
Private Sub DataInicial_Cb_Change()
    If DataInicial_Cb.Value = MarcHist Then ConfHist DataInicial_Cb, Format(DateValue(ConfigAc(7, 2)), "dd/mm/yy")
    EvCalend_Cb_Change DataInicial_Cb
End Sub
Private Sub DataInicial_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvCalend_Cb_Exit DataInicial_Cb, Cancel, DateValue(ConfigAc(7, 2).Value)
    If IsDate(DataInicial_Cb.Value) Then OcultarExibControles1
End Sub


Private Sub DataFinal_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvCalend_Cb_MouseMove DataFinal_Cb, Button, Shift, x, y
End Sub
Private Sub DataFinal_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvCalend_Cb_KeyDown DataFinal_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then DataFinalCalend_Bt_Click
End Sub
Private Sub DataFinal_Cb_Change()
    If DataFinal_Cb.Value = MarcHist Then ConfHist DataFinal_Cb, Format(DateValue(ConfigAc(8, 2)), "dd/mm/yy")
    EvCalend_Cb_Change DataFinal_Cb
End Sub
Private Sub DataFinal_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvCalend_Cb_Exit DataFinal_Cb, Cancel, DateValue(ConfigAc(8, 2).Value)
    If IsDate(DataFinal_Cb.Value) Then OcultarExibControles1
End Sub


Private Sub SugIni_Cb_Click()
    For i = 1 To SugIni_Cb.ListCount
        If SugIni_Cb.List(i - 1) = SugIni_Cb.Value Then Exit For
    Next
    nSugIni = i
    Hide
    BotAcionado = 22
End Sub

Private Sub SugFim_Cb_Click()
    For i = 1 To SugFim_Cb.ListCount
        If SugFim_Cb.List(i - 1) = SugFim_Cb.Value Then Exit For
    Next
    nSugFim = i
    Hide
    BotAcionado = 23
End Sub


Private Sub AumRed_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove AumRed_Cb, Button, Shift, x, y
End Sub
Private Sub AumRed_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown AumRed_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then AumRedCalculadora_Bt_Click
End Sub
Private Sub AumRed_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If AumRed_Cb.Value = MarcHist Then ConfHist AumRed_Cb, Format(ConfigAc(32, 2), "#,##0.00########"), False, "#,##0.00########"
    EvValor_Cb_Change AumRed_Cb, True
End Sub
Private Sub AumRed_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit AumRed_Cb, Cancel, "#,##0.00"
End Sub

Private Sub AumRedCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Config, AumRed_Cb, AumRedCalculadora_Bt, 5
End Sub


'COMBOBOXES SEM HIST|fffd|RICOS

Private Sub FixosMeses_Cb_Click()
    For i = 1 To FixosMeses_Cb.ListCount
        If FixosMeses_Cb.List(i - 1) = FixosMeses_Cb.Value Then Exit For
    Next
    nFixosMeses = i
    Hide
    BotAcionado = 20
End Sub

Private Sub FixosDias_Cb_Change()
    For i = 1 To FixosDias_Cb.ListCount
        If FixosDias_Cb.List(i - 1) = FixosDias_Cb.Value Then Exit For
    Next
    nFixosDias = i
    Hide
    BotAcionado = 21
End Sub


Private Sub Nada_OpBt_Click()
    OcultarExibControles1
End Sub
Private Sub SaldAVenc_OpBt_Click()
    OcultarExibControles1
End Sub
Private Sub Fixos_OpBt_Click()
    OcultarExibControles1
End Sub


Private Sub Agenda_Click()
    Application.ExecuteExcel4Macro ("cpap_pri.mac!Calendario()")
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub
Attribute VB_Name = "UserForm2CondEst"
Attribute VB_Base = "0{1C39D1D5-8121-4464-A8C6-7C5BF9B6FF61}{888CC294-9E18-463B-A477-0F8FE08B27A9}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Dim ControleAtivo As Control
Private Sub UserForm_Activate()
    Cancelar_Bt.SetFocus
    ControleAtivo.SetFocus
    '   Application.SendKeys "{HOME}"
End Sub
Private Sub UserForm_Deactivate()
    Set ControleAtivo = ActiveControl
End Sub

Private Sub UserForm_Initialize()
    vEnableEvents = True
    ListandoComboBox JurTaxa_Cb, "#,##0.00########"
    ListandoComboBox MultaPerc_Cb, "#,##0.00"
    ListandoComboBox Res|fffd|duoPermitido_Cb, "#,##0.00"
    If Not bHtmlHelp Then Ajuda_Bt.HelpContextID = HelpContextID
    Set ControleAtivo = Exibir_Bt
End Sub


Private Sub JurTaxaCalculadora_Bt_Click()
    CalculadoraBtClick UserForm2CondEst, JurTaxa_Cb, JurTaxaCalculadora_Bt, 5
End Sub
Private Sub MultaPercCalculadora_Bt_Click()
    CalculadoraBtClick UserForm2CondEst, MultaPerc_Cb, MultaPercCalculadora_Bt, 2
End Sub
Private Sub Res|fffd|duoPermitidoCalculadora_Bt_Click()
    CalculadoraBtClick UserForm2CondEst, Res|fffd|duoPermitido_Cb, Res|fffd|duoPermitidoCalculadora_Bt, 2
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub

Private Sub Exibir_Bt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub Calcular_Bt_Click()
    Calcular_Bt.SetFocus
    Hide
    BotAcionado = 2
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub AvalIns_Bt_Click()
    Hide
    BotAcionado = 5
End Sub

Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub JurTaxa_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove JurTaxa_Cb, Button, Shift, x, y
End Sub
Private Sub JurTaxa_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown JurTaxa_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then JurTaxaCalculadora_Bt_Click
End Sub
Private Sub JurTaxa_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If JurTaxa_Cb.Value = MarcHist Then ConfHist JurTaxa_Cb, Format(CondEst(9, 2), "#,##0.00########"), False, "#,##0.00########"
    EvValor_Cb_Change JurTaxa_Cb, True
End Sub
Private Sub JurTaxa_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit JurTaxa_Cb, Cancel, "#,##0.00"
End Sub





Private Sub MultaPerc_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove MultaPerc_Cb, Button, Shift, x, y
End Sub
Private Sub MultaPerc_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown MultaPerc_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then MultaPercCalculadora_Bt_Click
End Sub
Private Sub MultaPerc_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If MultaPerc_Cb.Value = MarcHist Then ConfHist MultaPerc_Cb, Format(CondEst(12, 2), "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change MultaPerc_Cb, True
End Sub
Private Sub MultaPerc_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit MultaPerc_Cb, Cancel, "#,##0.00"
End Sub


Private Sub Res|fffd|duoPermitido_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove Res|fffd|duoPermitido_Cb, Button, Shift, x, y
End Sub
Private Sub Res|fffd|duoPermitido_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown Res|fffd|duoPermitido_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then Res|fffd|duoPermitidoCalculadora_Bt_Click
End Sub
Private Sub Res|fffd|duoPermitido_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If Res|fffd|duoPermitido_Cb.Value = MarcHist Then ConfHist Res|fffd|duoPermitido_Cb, Format(CondEst(15, 2), "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change Res|fffd|duoPermitido_Cb, True
End Sub
Private Sub Res|fffd|duoPermitido_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit Res|fffd|duoPermitido_Cb, Cancel, "#,##0.00"
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub
Attribute VB_Name = "UserForm3AvIns"
Attribute VB_Base = "0{AFF9C59B-71FA-4939-8C21-AD1125123FB8}{F6C41EF3-389A-41ED-889B-FA6E3729F4AE}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Dim ControleAtivo As Control

Private Sub UserForm_Activate()
    CancelarBt_OpBt.SetFocus
    ControleAtivo.SetFocus
    Application.SendKeys "{HOME}"
End Sub
Private Sub UserForm_Deactivate()
    Set ControleAtivo = ActiveControl
End Sub


Private Sub UserForm_Initialize()
    vEnableEvents = True
    ListandoComboBox DataInserir_Cb, "dd/mm/yy"
    ListandoComboBox ValorInserir_Cb, "#,##0.00"
    If Not bHtmlHelp Then Ajuda_Bt.HelpContextID = HelpContextID
    Set ControleAtivo = ValorInserir_Cb
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub


Private Sub DataRelLig_OpBt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub DataRelRes_OpBt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub DataVencLig_OpBt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub DataVencRes_OpBt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub ExibirBt_OpBt_Click()
    Hide
    BotAcionado = 2
End Sub

Private Sub CancelarBt_OpBt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub DataInserir_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvCalend_Cb_MouseMove DataInserir_Cb, Button, Shift, x, y
End Sub
Private Sub DataInserir_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvCalend_Cb_KeyDown DataInserir_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then DataInserirCalend_Bt_Click
End Sub
Private Sub DataInserir_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If DataInserir_Cb.Value = MarcHist Then ConfHist DataInserir_Cb, Format(DateValue(AvInser(14, 2)), "dd/mm/yy"), False, "dd/mm/yy"
    EvCalend_Cb_Change DataInserir_Cb
    ExibirLabel1
End Sub
Private Sub DataInserir_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvCalend_Cb_Exit DataInserir_Cb, Cancel, DateValue(AvInser(14, 2))
End Sub

Private Sub DataInserirCalend_Bt_Click()
    CalendBtClick UserForm3AvIns, DataInserir_Cb, DataInserirCalend_Bt
End Sub

Private Sub ValorInserir_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove ValorInserir_Cb, Button, Shift, x, y
End Sub
Private Sub ValorInserir_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown ValorInserir_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then ValorInserirCalculadora_Bt_Click
End Sub
Private Sub ValorInserir_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If ValorInserir_Cb.Value = MarcHist Then ConfHist ValorInserir_Cb, Format(AvInser(17, 2), "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change ValorInserir_Cb
    ExibirLabel1
End Sub
Private Sub ValorInserir_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit ValorInserir_Cb, Cancel, "#,##0.00"
End Sub

Private Sub ValorInserirCalculadora_Bt_Click()
    CalculadoraBtClick UserForm3AvIns, ValorInserir_Cb, ValorInserirCalculadora_Bt, 2
End Sub

Private Sub ExibirLabel1()
    Label1.Visible = ValorInserir_Cb.Value = Format(AvInser(17, 2), "#,##0.00") And DataInserir_Cb.Value = Format(DateValue(AvInser(14, 2)), "dd/mm/yy")
End Sub

Private Sub Agenda_Click()
    Application.ExecuteExcel4Macro ("cpap_pri.mac!Calendario()")
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub
Attribute VB_Name = "UserForm4Coment"
Attribute VB_Base = "0{1978D32E-C321-487A-8372-825423F54E5B}{AE881B34-C63C-4B4A-BAFD-AC113126D29A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Dim ControleAtivo As Control


Private Sub UserForm_Activate()
    OK_Bt.SetFocus
    ControleAtivo.SetFocus
    '   Application.SendKeys "{HOME}"
End Sub
Private Sub UserForm_Deactivate()
    Set ControleAtivo = ActiveControl
End Sub


Private Sub Observ_Tb_Change()
    If Observ_Tb.Value = MarcHist Then ConfHist Observ_Cb, ComentIni
    i = Observ_Tb.Value
    j = Observ_Tb.SelStart
    k = Len(i)
    Observ_Tb.Value = LTrim(UCase(Left(Observ_Tb.Value, 1)) & Mid(Observ_Tb.Value, 2, 254 + 1746))
    If j < k Then Observ_Tb.SelStart = j
End Sub

Private Sub Observ_Cb_Change()
    Observ_Tb.Value = Observ_Cb.Value
    Observ_Tb.SetFocus
End Sub

Private Sub Observ_Tb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    Observ_Cb.Value = Observ_Tb.Value
End Sub

Private Sub Limpar_Bt_Click()
    Observ_Tb.Value = ""
    Observ_Cb.Value = ""
End Sub

Private Sub UserForm_Initialize()
    ListandoComboBox Observ_Cb
    If Not bHtmlHelp Then Ajuda_Bt.HelpContextID = HelpContextID
    Set ControleAtivo = Observ_Tb
End Sub

Private Sub Ok_Bt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub
Attribute VB_Name = "UserForm5OrdPagMenu"
Attribute VB_Base = "0{AD0A0B98-C9D1-428C-8CF9-C201B37ED9F4}{0C77858B-AD32-4B0E-A58E-1CD04F89AD5F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub Ok_Bt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub Padr|fffd|o_Bt_Click()
    If MsgBox("As op|fffd||fffd|es padr|fffd|o exibem a configura|fffd||fffd|o b|fffd|sica que, embora menos explicativa se houver muitos pagamentos estendidos, |fffd| mais r|fffd|pida e est|fffd|vel." & Chr(10) & Chr(10) & "Qualquer outra configura|fffd||fffd|o |fffd| um rearranjo daquela levando cerca de 8 segundos a mais para ser exibida e o rec|fffd|lculo a cada entrada pode ser autom|fffd|tico." & Chr(10) & Chr(10) & "Continua?", vbOKCancel + vbQuestion, "Restaurar Op|fffd||fffd|es Padr|fffd|o - Configura|fffd||fffd|o B|fffd|sica") = vbOK Then
        U_NU_E_OpBt.Value = True
        VencOrigExibir_Chb.Value = False
        ValoresCalculadosApagar_Chb.Value = False
        Ok_Bt_Click
    End If
End Sub

Private Sub U_E_NU_E_OpBt_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Ok_Bt_Click
End Sub

Private Sub U_NU_E_OpBt_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Ok_Bt_Click
End Sub
Private Sub NU_E_U_E_OpBt_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Ok_Bt_Click
End Sub
Private Sub PorData_OpBt_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Ok_Bt_Click
End Sub

Attribute VB_Name = "UserForm6EstSerie"
Attribute VB_Base = "0{083BF7C1-D866-4D3F-B80C-82DAD88AFE30}{5C91169A-4518-431F-8D13-37605409DA33}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Dim ControleAtivo As Control
Dim IsAcresc As Boolean
Dim dValorInserir As Double
Dim lPrestIniIns As Long
Dim lPrestFimIns As Long
Dim lBalIniIns As Long
Dim lBalFimIns As Long
Dim lTotIns As Long
Dim lPosDvrsIns As Long
Dim lCntIns As Long
Dim bListarInserindo As Boolean

Private Sub Acrescimo_Bt_Click()
    IsAcresc = True
    Pagamento_Bt_Click
End Sub
Private Sub Pagamento_Bt_Click()
    'Criticar Data
    Dim ODtAss
    ODtAss = Workbooks("cpap_mp.mac").Sheets(1).Range("ODtAss").Value
    If NmesIndMax = 0 Then NmesIndMax = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("NmesIndMax").Value
    If DateValue(DataInserir_Cb.Value) < ODtAss Or CLng(DateValue(DataInserir_Cb.Value)) > DateSerial(1970, 5 + NmesIndMax, 0) Then
        MsgBox "Informe uma data dentro do per|fffd|odo do parcelamento, ou seja, entre a data da compra (" & Format(ODtAss, "dd/mm/yy") & ") e um limite pr|fffd|tico", vbCritical, "Data Inv|fffd|lida"
        Exit Sub
    End If
    If Abs(CLng(DateValue(DataInserir_Cb.Value)) - CLng(Now)) > 20 Then
        If MsgBox("A data a inserir, " & Format(DateValue(DataInserir_Cb.Value), "dd/mm/yy") & ", |fffd| bem diferente da data de hoje, " & Format(Now, "dd/mm/yy") & ". Insere assim mesmo?", vbOKCancel + vbQuestion, "Confirmar Data") = vbCancel Then Exit Sub
    End If
    Hide
    Application.ScreenUpdating = False
    dValorInserir = ValorInserir_Cb.Value
    dValorInserir = IIf(IsAcresc, -1, 1) * Abs(dValorInserir)
    lPrestIniIns = IIf(PrestTot_Tb.Enabled, PrestIni_Cb.ListIndex + 1, 0)
    lPrestFimIns = IIf(PrestTot_Tb.Enabled, PrestFim_Cb.ListIndex + 1, 0)
    lBalIniIns = IIf(BalTot_Tb.Enabled, BalIni_Cb.ListIndex + 1, 0)
    lBalFimIns = IIf(BalTot_Tb.Enabled, BalFim_Cb.ListIndex + 1, 0)
    lTotIns = CLng(Tot_Tb.Value)

    lPosDvrsIns = Workbooks("cpap_mp.mac").Sheets(1).Range("Dvrs").Rows.Count
    Workbooks("cpap_mp.mac").Sheets(1).Range("Dvrs").Cells(lPosDvrsIns, 1).Select
    Selection.Resize(lTotIns).Select
    Selection.EntireRow.Insert

    bListarInserindo = True
    ListarCbs
    BotAcionado = 1
End Sub

Private Sub ListarCbs()
    Dim i As Long
    Dim Seq As String
    Dim Obs As String
    Dim Venc
    Dim bListPasd As Boolean
    Dim bListLiq As Boolean
    Dim bListComPag As Boolean
    Dim bListComAcr As Boolean
    Dim ValOr As Double
    Dim lCtPrest As Long
    Dim lCtBal As Long

    'S|fffd| para dar uma sensa|fffd||fffd|o de ativida, pois |fffd| muito r|fffd|pido
    Me.MousePointer = fmMousePointerHourGlass
    Application.Wait Now + TimeValue("00:00:01")

    'Limpando comboboxes
    While PrestIni_Cb.ListCount >= 1: PrestIni_Cb.RemoveItem (0): Wend
    While PrestFim_Cb.ListCount >= 1: PrestFim_Cb.RemoveItem (0): Wend
    While BalIni_Cb.ListCount >= 1: BalIni_Cb.RemoveItem (0): Wend
    While BalFim_Cb.ListCount >= 1: BalFim_Cb.RemoveItem (0): Wend

    'ListandoComboBox prest e bal
    For i = 1 To MaxPb
        If i = ONPrt + 1 Then i = MaxP + 3 + 1
        If i = MaxP + 3 + ONBl + 1 Then Exit For
        Seq = Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("G" & RowRef + i - 1).Value
        Venc = Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("J" & RowRef + i - 1).Value
        ValOr = Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("E" & RowRef + i - 1).Value

        If Venc <> "" And Venc <> 0 And ValOr <> 0 Then
            If Not SaltarPasd_Chb.Value Then bListPasd = True Else bListPasd = DateValue(DataInserir_Cb.Value) < Venc
            If Not SaltarLiq_Chb.Value Then bListLiq = True Else bListLiq = Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("W" & RowRef + i - 1).Value = Empty
            If Not SaltarComPag_Chb.Value Then bListComPag = True Else bListComPag = Not HasInc(i, True)    'Salta, se tiver pag. inclu|fffd|do na pos
            If Not SaltarComAcr_Chb.Value Then bListComAcr = True Else bListComAcr = Not HasInc(i, False)    'Salta, se tiver acr|fffd|sc. inclu|fffd|do na pos

            Seq = Seq & " - " & Format(Venc, "dd/mm/yy")
            Obs = IIf(Observ_Cb.Value = "", "", IIf(ObservPrefix_Chb.Value, IIf(dValorInserir > 0, "Pag. ", "Acr|fffd|sc. ") & lCntIns + 1 & "/" & lTotIns & " - ", "") & Observ_Cb.Value)
            If bListPasd And bListLiq And bListComPag And bListComAcr Then
                If i <= MaxP Then
                    lCtPrest = lCtPrest + 1
                    PrestIni_Cb.AddItem (Seq)
                    PrestFim_Cb.AddItem (Seq)
                    If bListarInserindo Then
                        If lCtPrest >= lPrestIniIns And lCtPrest <= lPrestFimIns Then
                            With Workbooks("cpap_mp.mac").Sheets(1).Range("Dvrs").Cells(lPosDvrsIns + lCntIns, 1)
                                .Offset(0, -2).Value = CLng(Venc)
                                .Offset(0, -3).Value = i
                                .Offset(0, 3).Value = CLng(DateValue(DataInserir_Cb.Value))
                                .Offset(0, 7).Value = dValorInserir
                                If Obs <> "" Then .Offset(0, 4).Value = Obs
                            End With
                            lCntIns = lCntIns + 1
                        End If
                    End If
                ElseIf i > MaxP + 3 Then
                    lCtBal = lCtBal + 1
                    BalIni_Cb.AddItem (Seq)
                    BalFim_Cb.AddItem (Seq)
                    If bListarInserindo Then
                        If lCtBal >= lBalIniIns And lCtBal <= lBalFimIns Then
                            With Workbooks("cpap_mp.mac").Sheets(1).Range("Dvrs").Cells(lPosDvrsIns + lCntIns, 1)
                                .Offset(0, -2).Value = CLng(Venc)
                                .Offset(0, -3).Value = i
                                .Offset(0, 3).Value = CLng(DateValue(DataInserir_Cb.Value))
                                .Offset(0, 7).Value = dValorInserir
                                If Obs <> "" Then .Offset(0, 4).Value = Obs
                            End With
                            lCntIns = lCntIns + 1
                        End If
                    End If
                End If
            End If
        End If
    Next

    If PrestIni_Cb.ListCount = 0 Then PrestIni_Cb.ListIndex = -1 Else PrestIni_Cb.ListIndex = 0
    If PrestFim_Cb.ListCount = 0 Then PrestFim_Cb.ListIndex = -1 Else PrestFim_Cb.ListIndex = PrestFim_Cb.ListCount - 1
    If BalIni_Cb.ListCount = 0 Then BalIni_Cb.ListIndex = -1 Else BalIni_Cb.ListIndex = 0
    If BalFim_Cb.ListCount = 0 Then BalFim_Cb.ListIndex = -1 Else BalFim_Cb.ListIndex = BalFim_Cb.ListCount - 1

    OcultarExibControles6
    Me.MousePointer = fmMousePointerDefault
End Sub

Function HasInc(i As Long, bIsPag As Boolean) As Boolean
    Dim j As Long
    HasInc = False

    If CDbl(Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("N" & RowRef + i - 1).Value) * IIf(bIsPag, 1, -1) > 0 Then
        HasInc = True
        Exit Function
    End If

    If Not bListarInserindo Then lPosDvrsIns = Workbooks("cpap_mp.mac").Sheets(1).Range("Dvrs").Rows.Count
    For j = 2 To lPosDvrsIns - 1
        With Workbooks("cpap_mp.mac").Sheets(1).Range("Dvrs").Cells(j, 1)
            If CLng(.Offset(0, -3).Value) = i And CDbl(.Offset(0, 7).Value) * IIf(bIsPag, 1, -1) > 0 Then
                HasInc = True
                Exit Function
            End If
        End With
    Next
End Function

Sub OcultarExibControles6()
    PrestIni_Cb.Enabled = PrestDe_Chb.Value And PrestIni_Cb.ListCount > 0
    PrestFim_Cb.Enabled = PrestIni_Cb.Enabled
    PrestAt|fffd|_Lb.Enabled = PrestIni_Cb.Enabled
    PrestTot_Tb.Enabled = PrestIni_Cb.Enabled

    BalIni_Cb.Enabled = BalDe_Chb.Value And BalIni_Cb.ListCount > 0
    BalFim_Cb.Enabled = BalIni_Cb.Enabled
    BalAt|fffd|_Lb.Enabled = BalIni_Cb.Enabled
    BalTot_Tb.Enabled = BalIni_Cb.Enabled

    PrestTot_Tb.Value = IIf(PrestTot_Tb.Enabled, PrestFim_Cb.ListIndex - PrestIni_Cb.ListIndex + 1, 0)
    BalTot_Tb.Value = IIf(BalTot_Tb.Enabled, BalFim_Cb.ListIndex - BalIni_Cb.ListIndex + 1, 0)

    Tot_Tb = PrestTot_Tb.Value * 1 + BalTot_Tb.Value
    If Tot_Tb.Value > 0 Then ValorInserir_Cb.Value = Format(ValorTotal_Cb.Value * 1 / Tot_Tb.Value, "#,##0.00") Else ValorInserir_Cb.Value = Format(0, "#,##0.00")

    SaltarPasd_Chb.Caption = "Passados, os de antes de " & DataInserir_Cb.Value

    Pagamento_Bt.Enabled = Tot_Tb * 1 > 0 And ValorInserir_Cb.Value * 1 <> 0
    Acrescimo_Bt.Enabled = Pagamento_Bt.Enabled
    ObservPrefix_Chb.Enabled = Observ_Cb.Value <> ""
End Sub

Private Sub UserForm_Initialize()
    ListandoComboBox DataInserir_Cb, "dd/mm/yy"
    ListandoComboBox ValorTotal_Cb, "#,##0.00"
    ListandoComboBox ValorInserir_Cb, "#,##0.00"
    ListandoComboBox Observ_Cb
    '    Ajuda_Bt.HelpContextID = HelpContextID
    Set ControleAtivo = ValorTotal_Cb
End Sub

Private Sub UserForm_Activate()
    Cancelar_Bt.SetFocus
    ControleAtivo.SetFocus
    '   Application.SendKeys "{HOME}"
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub

Private Sub BalDe_Chb_Click()
    OcultarExibControles6
End Sub

Private Sub BalFim_Cb_Change()
    If BalFim_Cb.ListIndex < BalIni_Cb.ListIndex Then BalIni_Cb.ListIndex = BalFim_Cb.ListIndex
    OcultarExibControles6
End Sub

Private Sub BalIni_Cb_Change()
    If BalIni_Cb.ListIndex > BalFim_Cb.ListIndex Then BalFim_Cb.ListIndex = BalIni_Cb.ListIndex
    OcultarExibControles6
End Sub

Private Sub PrestDe_Chb_Click()
    OcultarExibControles6
End Sub

Private Sub PrestFim_Cb_Change()
    If PrestFim_Cb.ListIndex < PrestIni_Cb.ListIndex Then PrestIni_Cb.ListIndex = PrestFim_Cb.ListIndex
    OcultarExibControles6
End Sub

Private Sub PrestIni_Cb_Change()
    If PrestIni_Cb.ListIndex > PrestFim_Cb.ListIndex Then PrestFim_Cb.ListIndex = PrestIni_Cb.ListIndex
    OcultarExibControles6
End Sub

Private Sub SaltarPasd_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    ListarCbs
End Sub
Private Sub SaltarLiq_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    ListarCbs
End Sub
Private Sub SaltarComPag_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    ListarCbs
End Sub
Private Sub SaltarComAcr_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    ListarCbs
End Sub

Private Sub DataInserir_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvCalend_Cb_MouseMove DataInserir_Cb, Button, Shift, x, y
End Sub
Private Sub DataInserir_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvCalend_Cb_KeyDown DataInserir_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then DataInserirCalend_Bt_Click
End Sub
Private Sub DataInserir_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If DataInserir_Cb.Value = MarcHist Then ConfHist DataInserir_Cb, Format(DateValue(EstSer(4).Value), "dd/mm/yy"), False, "dd/mm/yy"
    EvCalend_Cb_Change DataInserir_Cb
    ListarCbs
End Sub
Private Sub DataInserir_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvCalend_Cb_Exit DataInserir_Cb, Cancel, DateValue(EstSer(4))
End Sub
Private Sub DataInserirCalend_Bt_Click()
    CalendBtClick Me, DataInserir_Cb, DataInserirCalend_Bt
End Sub

Private Sub ValorInserir_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove ValorInserir_Cb, Button, Shift, x, y
    ValorInserir_Cb_Click
End Sub
Private Sub ValorInserir_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown ValorInserir_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then ValorInserirCalculadora_Bt_Click
End Sub
Private Sub ValorInserir_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If ValorInserir_Cb.Value = MarcHist Then ConfHist ValorInserir_Cb, Format(0, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change ValorInserir_Cb
    If ValorInserir_Cb.Value = "" Then ValorInserir_Cb.Value = 0
    '    If InStr(1, ValorInserir_Cb.Value, Application.International(xlDecimalSeparator)) <> 0 Then ValorInserir_Cb_Click
    '    OcultarExibControles6
End Sub
Private Sub ValorInserir_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit ValorInserir_Cb, Cancel, "#,##0.00"
    ValorInserir_Cb_Click
End Sub
Private Sub ValorInserirCalculadora_Bt_Click()
    CalculadoraBtClick Me, ValorInserir_Cb, ValorInserirCalculadora_Bt, 2
    ValorInserir_Cb_Click
End Sub
Private Sub ValorInserir_Cb_Click()
    ValorTotal_Cb.Value = Format(ValorInserir_Cb.Value * Tot_Tb.Value, "#,##0.00")
End Sub


Private Sub ValorTotal_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove ValorTotal_Cb, Button, Shift, x, y
End Sub
Private Sub ValorTotal_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown ValorTotal_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then ValorInserirCalculadora_Bt_Click
End Sub
Private Sub ValorTotal_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If ValorTotal_Cb.Value = MarcHist Then ConfHist ValorTotal_Cb, Format(0, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change ValorTotal_Cb
    If ValorTotal_Cb.Value = "" Then ValorTotal_Cb.Value = 0
    OcultarExibControles6
End Sub
Private Sub ValorTotal_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit ValorTotal_Cb, Cancel, "#,##0.00"
End Sub
Private Sub ValorTotalCalculadora_Bt_Click()
    CalculadoraBtClick Me, ValorTotal_Cb, ValorInserirCalculadora_Bt, 2
End Sub

Private Sub Observ_Cb_Change()
    Dim i As String
    Dim j As Long
    Dim k As Long
    If Observ_Cb.Value = MarcHist Then ConfHist Observ_Cb, ComentIni
    i = Observ_Cb.Value
    j = Observ_Cb.SelStart
    k = Len(i)
    Observ_Cb.Value = LTrim(UCase(Left(Observ_Cb.Value, 1)) & Mid(Observ_Cb.Value, 2, 254 + 1746))
    If j < k Then Observ_Cb.SelStart = j
    OcultarExibControles6
End Sub

Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub
Attribute VB_Name = "UserForm71PerFixos"
Attribute VB_Base = "0{668F70B7-AF1A-424B-81D2-7CADF6489CBE}{49DAA050-C765-4BA1-BAC6-1CA33D1B9849}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Dim ControleAtivo As Control
Dim ODtAss
Dim VencFinal
Dim DatasFins

Private Sub Comp_LstB_Click()
    If vEnableEvents = False Then Exit Sub
    If Comp_LstB.ListIndex > Comp_LstB.ListCount - 2 Then
        vEnableEvents = False
        'Embora a sele|fffd||fffd|o na caixa n|fffd|o altere, mas h|fffd| o retorno. Parece um bug
        Comp_LstB.ListIndex = Comp_LstB.ListIndex - 1
        vEnableEvents = True
    End If
End Sub

Private Sub Comp_LstB_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Editar_Bt_Click
End Sub

Private Sub Editar_Bt_Click()
    Dim PerSel As Long
    Dim TipPer As Long
    Dim DataFimRet

    'Detectando o tipo de per|fffd|odo pelo |fffd|ltimo intervalo, se n|fffd|o faz anual
    If UBound(DatasFins) > 0 Then
        vMeses = Application.Run("cpap_jap.mac!M.F", DatasFins(UBound(DatasFins) - 1) * 1, DatasFins(UBound(DatasFins)) * 1)
        If vMeses >= 2 And vMeses <= 12 Then TipPer = 13 - vMeses Else TipPer = 1
    Else
        TipPer = 0
    End If

    vEnableEvents = False
    PerSel = Comp_LstB.ListIndex + 1
    If PerSel > UBound(DatasFins) + 1 Then Exit Sub
    If PerSel = 0 Then PerSel = 1
    With UserForm72PerFixos
        .DataFinal_Cb.Value = Format(DatasFins(PerSel - 1) * 1, "dd/mm/yy")
        .DataFim = DatasFins(PerSel - 1) * 1
        If PerSel > 1 Then .DataIni = DatasFins(PerSel - 2) * 1 Else .DataIni = ODtAss
        .PerSel = PerSel
        .TipoPer|fffd|odo_Cb.ListIndex = TipPer
    End With
    vEnableEvents = True
    BotAcionado = False
    UserForm72PerFixos.Show

    If BotAcionado = 1 Then
        With UserForm72PerFixos
            TipPer = .TipoPer|fffd|odo_Cb.ListIndex
            DataFimRet = DateValue(.DataFinal_Cb.Value) * 1
        End With

        If PerSel = 1 Then PerFixos = DataFimRet Else PerFixos = DatasFins(0)
        For i = 1 To PerSel - 1
            PerFixos = PerFixos & ";" & IIf(i < PerSel - 1, DatasFins(i), DataFimRet)
        Next
        i = 0

        If TipPer > 0 Then
            Do
                i = i + 1
                j = Run("CPAP_EX8.MAC!MyEdate", DataFimRet, (13 - TipPer) * i)
                If j < VencFinal Then
                    PerFixos = PerFixos & ";" & j * 1
                Else
                    Exit Do
                End If
            Loop
        End If
        OcultarExibControles
        Comp_LstB.ListIndex = PerSel - 1
    End If
    Unload UserForm72PerFixos
End Sub

Private Sub UserForm_Activate()
    Editar_Bt.SetFocus
    ControleAtivo.SetFocus
End Sub
Private Sub UserForm_Deactivate()
    Set ControleAtivo = ActiveControl
End Sub

Private Sub UserForm_Initialize()
    vEnableEvents = True
    ODtAss = Workbooks("cpap_mp.mac").Sheets(1).Range("ODtAss").Value
    VencFinal = Workbooks("cpap_mp.mac").Sheets(1).Range("VencFinal").Value

    OcultarExibControles

    If Not bHtmlHelp Then Ajuda_Bt.HelpContextID = HelpContextID
    Set ControleAtivo = OK_Bt
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub

Private Sub Ok_Bt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub Agenda_Click()
    Application.ExecuteExcel4Macro ("cpap_pri.mac!Calendario()")
End Sub

Sub OcultarExibControles()
    'Limpando Listbox
    vEnableEvents = False
    Comp_LstB.ListIndex = -1
    While Comp_LstB.ListCount >= 1
        Comp_LstB.RemoveItem (0)
    Wend
    'Povoando listbox
    DatasFins = MySplit(PerFixos, ";")
    For i = 0 To UBound(DatasFins)
        If i = 0 Then DataIni = ODtAss Else DataIni = DatasFins(i - 1)
        vMeses = Application.Run("cpap_jap.mac!M.F", DataIni * 1, DatasFins(i) * 1) + 1
        vDias = Workbooks("cpap_jap.mac").Sheets(1).Range("M.FretDias").Value + 1
        Per|fffd|odoDesc = " (" & Choose(-1 * (vMeses < 2) - 2 * (vMeses = 2) - 3 * (vMeses > 2), "", "1 m|fffd|s", vMeses - 1 & " meses") & IIf(vMeses > 1 And vDias > 1, " mais ", "") & Choose(-1 * (vDias < 2) - 2 * (vDias = 2) - 3 * (vDias > 2), "", "1 dia", vDias - 1 & " dias") & ")"
        Comp_LstB.AddItem ("Per|fffd|odo " & Format(i + 1, "00") & " vai at|fffd| " & Format(DatasFins(i), "dd/mm/yyyy") & Per|fffd|odoDesc & IIf(i < UBound(DatasFins), ";", " e"))
    Next
    Comp_LstB.AddItem ("Per|fffd|odo " & Format(i + 1, "00") & " vai at|fffd| o fim")
    vEnableEvents = True
    '    If UBound(DatasFins) = 0 Then Comp_LstB.ListIndex = 0

    QuantPer|fffd|odos_Tb.Value = i + 1
    In|fffd|cio_Lb.Caption = "  In|fffd|cio em " & Format(ODtAss, "dd/mm/yyyy") & " (Data assinatura, compra)"
    Final_Lb.Caption = "  Fim em ou ap|fffd|s " & Format(VencFinal, "dd/mm/yyyy") & " (|fffd|ltima obriga|fffd||fffd|o)"

End Sub

Function MySplit(ByVal sString As String, Optional sDelim As String, Optional lLimit As Long = -1, Optional bCompare As Long = 0) As Variant
    'Excel 97 and Word6 haven't Split function
    Dim sSplit As String
    Dim sSplitArr() As String
    Dim i As Long
    Dim r As Long
    If sString = "" Or lLimit = 0 Then
        MySplit = Array()
        Exit Function
    End If
    If sDelim = "" Then
        ReDim Preserve sSplitArr(i)
        sSplitArr(i) = sString
    Else
        If InStr(1, sString, sDelim, bCompare) = 0 Then
            ReDim Preserve sSplitArr(i)
            sSplitArr(i) = sString
        Else
            r = 2
            sSplit = fSplitting(sString, sDelim, bCompare)
            Do While r > 0
                ReDim Preserve sSplitArr(i)
                sSplitArr(i) = sSplit
                r = r - 1 - 1 * (InStr(1, sString, sDelim, bCompare) > 0)
                If lLimit <> -1 And i = lLimit - 1 Then
                    sSplitArr(i) = sSplitArr(i) & IIf(r > 0, sDelim & sString, "")
                    Exit Do
                End If
                i = i + 1
                sSplit = fSplitting(sString, sDelim)
            Loop
        End If
    End If
    MySplit = sSplitArr
End Function

Function fSplitting(ByRef sString As String, sDelim As String, Optional bCompare As Long = 0) As String
    Dim lPos As Long
    lPos = InStr(1, sString, sDelim, bCompare)
    If lPos > 0 Then
        fSplitting = Left(sString, lPos - 1)
        sString = Mid(sString, lPos + Len(sDelim), Len(sString))
    Else
        fSplitting = sString
        sString = ""
    End If
End Function

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub
Attribute VB_Name = "UserForm72PerFixos"
Attribute VB_Base = "0{6CEEEC37-CD0C-4F99-A9AE-1986EFA3976E}{C4526AC7-0486-4C20-B4CB-2097E7D3A11A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Dim ControleAtivo As Control
Dim ODtAss
Dim VencFinal
Dim PerFixos As String
Dim DatasFins

Public PerSel As Long
Public DataIni
Public DataFim

Private Sub UserForm_Activate()
    Left = UserForm71PerFixos.Left + 10
    Top = UserForm71PerFixos.Top + UserForm71PerFixos.Comp_LstB.Top + 23 + PerSel * 10

    OK_Bt.SetFocus
    ControleAtivo.SetFocus
    '    Application.SendKeys "{HOME}"
End Sub
Private Sub UserForm_Deactivate()
    Set ControleAtivo = ActiveControl
End Sub

Private Sub UserForm_Initialize()
    vEnableEvents = True
    ODtAss = Workbooks("cpap_mp.mac").Sheets(1).Range("ODtAss").Value
    VencFinal = Workbooks("cpap_mp.mac").Sheets(1).Range("VencFinal").Value
    PerFixos = Workbooks("cpap_mp.mac").Sheets(1).Range("PerFixos").Value
    MaxP = Workbooks("cpap_mp.mac").Sheets(1).Range("MaxP").Value

    'ListandoComboBox Fixos
    TipoPer|fffd|odo_Cb.AddItem ("Fim")
    TipoPer|fffd|odo_Cb.AddItem ("Anuais")
    TipoPer|fffd|odo_Cb.AddItem ("11m")
    TipoPer|fffd|odo_Cb.AddItem ("10m")
    TipoPer|fffd|odo_Cb.AddItem ("9m")
    TipoPer|fffd|odo_Cb.AddItem ("8m")
    TipoPer|fffd|odo_Cb.AddItem ("7m")
    TipoPer|fffd|odo_Cb.AddItem ("Semestrais")
    TipoPer|fffd|odo_Cb.AddItem ("5m")
    TipoPer|fffd|odo_Cb.AddItem ("4m")
    TipoPer|fffd|odo_Cb.AddItem ("Trimestrais")
    TipoPer|fffd|odo_Cb.AddItem ("2m")


    '    ListandoComboBox DataFinal_Cb
    'ListandoComboBox SugFim_Cb
    For i = 1 To Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("DtFin2").Rows.Count
        SugFim_Cb.AddItem (Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("DtFin2").Item(i).Value)
    Next
    '    SugFim_Cb.Value = SugFim_Cb.List(0)

    '    OcultarExibControles

    '    Ajuda_Bt.HelpContextID = HelpContextID
    Set ControleAtivo = OK_Bt
End Sub

Private Sub DataFinalCalend_Bt_Click()
    CalendBtClick UserForm72PerFixos, DataFinal_Cb, DataFinalCalend_Bt
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub

Private Sub Ok_Bt_Click()
    Hide
    BotAcionado = 1
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub DataFinal_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvCalend_Cb_MouseMove DataFinal_Cb, Button, Shift, x, y
End Sub
Private Sub DataFinal_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvCalend_Cb_KeyDown DataFinal_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then DataFinalCalend_Bt_Click
End Sub
Private Sub DataFinal_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If DataFinal_Cb.Value = MarcHist Then ConfHist DataFinal_Cb, Format(DataFim, "dd/mm/yy")
    EvCalend_Cb_Change DataFinal_Cb
    If IsDate(DataFinal_Cb.Value) Then
        If DateValue(DataFinal_Cb.Value) <= DataIni Then
            MsgBox "A data final de um per|fffd|odo tem que ser posterior a data de seu in|fffd|cio (" & Format(DataIni, "dd/mm/yyyy") & "). A inicial ser|fffd| restaurada.", vbCritical + vbOKOnly, "Data Inv|fffd|lida!"
            DataFinal_Cb.Value = Format(DataFim, "dd/mm/yy")
        End If
        OcultarExibControles
    End If
End Sub
Private Sub DataFinal_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvCalend_Cb_Exit DataFinal_Cb, Cancel, DateValue(PerFixDef(3).Value)
    If IsDate(DataFinal_Cb.Value) Then
        If DateValue(DataFinal_Cb.Value) <= DataIni Then
            MsgBox "A data final de um per|fffd|odo tem que ser posterior a data de seu in|fffd|cio (" & Format(DataIni, "dd/mm/yyyy") & "). A inicial ser|fffd| restaurada.", vbCritical + vbOKOnly, "Data Inv|fffd|lida!"
            DataFinal_Cb.Value = Format(DataFim, "dd/mm/yy")
            Cancel = True
        End If
        OcultarExibControles
    End If
End Sub

Private Sub SugFim_Cb_Click()
    If SugFim_Cb.ListIndex = 0 Then Exit Sub
    For i = 1 To SugFim_Cb.ListCount
        If SugFim_Cb.List(i - 1) = SugFim_Cb.Value Then Exit For
    Next
    nSugFim = i
    '    Hide
    '    BotAcionado = 23
    DataFinal_Cb.Value = Format(Application.Workbooks("cpap_mp.mac").Excel4MacroSheets(1).Range("DtFin1").Item(i).Value, "dd/mm/yy")
    SugFim_Cb.ListIndex = 0
End Sub

Sub OcultarExibControles()
    If DataIni = Empty Or DataFim = Empty Then Exit Sub
    vMeses = Application.Run("cpap_jap.mac!M.F", DataIni * 1, DateValue(DataFinal_Cb.Value) * 1) + 1
    vDias = Workbooks("cpap_jap.mac").Sheets(1).Range("M.FretDias").Value + 1
    Per|fffd|odoDesc = " (" & Choose(-1 * (vMeses < 2) - 2 * (vMeses = 2) - 3 * (vMeses > 2), "", "1 m|fffd|s", vMeses - 1 & " meses") & IIf(vMeses > 1 And vDias > 1, " mais ", "") & Choose(-1 * (vDias < 2) - 2 * (vDias = 2) - 3 * (vDias > 2), "", "1 dia", vDias - 1 & " dias") & ")"
    Caption = "Editando Per|fffd|odo " & Format(PerSel, "00") & Per|fffd|odoDesc
    Per|fffd|odoAt|fffd|_Lb.Caption = "Per|fffd|odo " & Format(PerSel, "00") & " vai at|fffd|"
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub

Attribute VB_Name = "UserFormEditHist"
Attribute VB_Base = "0{01563C4D-49E2-45A1-8AE9-F0E64F4F7921}{CA8F154C-F293-43CE-BA02-9316FBDD8411}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private vListBox As Control
Private vTextBox As Control
Private SemAltera|fffd||fffd|es As Boolean


Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub UserForm_Initialize()
    vEnableEvents = True
    Caption = "Editando Sugest|fffd|es do Campo " & HistEditCampo
    'Listando listboxes - Lista de sug fixas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo, ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).End(xlDown))
    If campo.Rows.Count < 100 Then
        j = 0
        For Each C In campo
            cf = Format(IIf(IsError(C.Value), "", C.Value), FormatoHist)
            j = j + 1
            If j > 1 Then
                vRep = False
                For i = 1 To SugFixas_Lb.ListCount
                    If SugFixas_Lb.List(i - 1) = cf Then vRep = True
                Next
                If vRep = False Then SugFixas_Lb.AddItem (cf)
            End If
        Next
    End If

    'Listando ListBox - Sugest Hist|fffd|ricas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").End(xlDown))
    If campo.Rows.Count < 10000 Then
        j = 0
        For Each C In campo
            cf = Format(IIf(IsError(C.Value), "", C.Value), FormatoHist)
            j = j + 1
            If j > 1 Then
                vRep = False
                For i = 1 To SugHist_Lb.ListCount
                    If SugHist_Lb.List(i - 1) = cf Then vRep = True
                Next
                If vRep = False And cf <> "" Then SugHist_Lb.AddItem (cf)
            End If
        Next
    End If
    NumMax_Ct.Value = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(-1, 0)
    MultiPage1.Value = 0
    MultiPage1_Change
    SemAltera|fffd||fffd|es = True
    OcultarExibControlesHist
End Sub

Private Sub NumMax_Ct_Change()
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub NumMax_Ct_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If IsNumeric(NumMax_Ct.Value) Then
        If NumMax_Ct.Value < 0 Then NumMax_Ct.Value = 0
        If NumMax_Ct.Value > 100 Then NumMax_Ct.Value = 100
    Else
        NumMax_Ct.Value = 15
    End If
End Sub

Private Sub Fechar_Bt_Click()
    Hide
    If SemAltera|fffd||fffd|es = True Then Exit Sub
    If MsgBox("Salvar altera|fffd||fffd|es nas sugest|fffd|es para o campo " & HistEditCampo & "?", vbQuestion + vbOKCancel, "CPAP|fffd|") = vbCancel Then Exit Sub
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value) 'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
        'Limpando c|fffd|lulas
        Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo, ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).End(xlDown))
        If campo.Rows.Count < 100 Then
            i = campo(1)
            campo.ClearContents
            campo(1) = i
        End If
        Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").End(xlDown))
        If campo.Rows.Count > 10000 Then
        Else
            i = campo(1)
            campo.ClearContents
            campo(1) = i
        End If

        'Descaregando comboboxes - Sug. Fixas
        k = 0
        NumM|fffd|x = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").Row - ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos").Row - 3
        For j = 1 To SugFixas_Lb.ListCount
            If j > NumM|fffd|x Then Exit For
            vRep = False
            If j > 1 Then
                For i = 1 To j
                    If ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).Offset(i, 0) = SugFixas_Lb.List(j - 1) Then vRep = True
                Next
            End If
            If vRep = False Then
                k = k + 1
                ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).Offset(k, 0) = SugFixas_Lb.List(j - 1)
            End If
        Next

        'Descarregando comboboxes - Sug. Hist|fffd|ricas
        k = 0
        For j = 1 To SugHist_Lb.ListCount
            If j > NumMax_Ct.Value * 1 Then Exit For
            vRep = False
            If j > 1 Then
                For i = 1 To j
                    If ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(i, 0) = SugHist_Lb.List(j - 1) Then vRep = True
                Next
            End If
            If vRep = False Then
                k = k + 1
                ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(k, 0) = SugHist_Lb.List(j - 1)
            End If
        Next
    End If
    ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(-1, 0) = NumMax_Ct.Value
    SalvandoHist
    Application.ScreenUpdating = True
End Sub

Private Sub Mover_Sb_SpinUp()
    i = vListBox.ListIndex
    If i < 1 Then Exit Sub
    vListBox.AddItem vListBox.List(i), i - 1
    vListBox.RemoveItem i + 1
    vListBox.Selected(i - 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Mover_Sb_SpinDown()
    i = vListBox.ListIndex
    If i < 0 Or i + 1 >= vListBox.ListCount Then Exit Sub
    vListBox.AddItem vListBox.List(i), i + 2
    vListBox.RemoveItem i
    vListBox.Selected(i + 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Transf_Bt_Click()
    i = vListBox.ListIndex
    If i < 0 Then Exit Sub
    If vListBox.Selected(i) Then
        I1 = vListBox.Value
        vListBox.RemoveItem i
        vEnableEvents = False
        If vListBox.ListIndex = -1 Then vTextBox.Value = ""
        vEnableEvents = True
    End If
    If MultiPage1.Value = 0 Then MultiPage1.Value = 1 Else MultiPage1.Value = 0
    vListBox.AddItem I1
    vListBox.Selected(vListBox.ListCount - 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Excluir_Bt_Click()
    i = vListBox.ListIndex
    If i < 0 Then Exit Sub
    If vListBox.Selected(i) Then vListBox.RemoveItem i
    vEnableEvents = False
    If vListBox.ListIndex = -1 Then vTextBox.Value = ""
    vEnableEvents = True
    OcultarExibControlesHist
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Nova_Bt_Click()
    vListBox.AddItem "Nova Sugest|fffd|o" & vListBox.ListCount + 1
    vListBox.Selected(vListBox.ListCount - 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub MultiPage1_Change()
    If MultiPage1.Value = 0 Then
        Set vListBox = SugHist_Lb
        Set vTextBox = SugHist_Ct
    Else
        Set vListBox = SugFixas_Lb
        Set vTextBox = SugFixas_Ct
    End If
    OcultarExibControlesHist
End Sub

Private Sub SugFixas_Ct_Change()
    If vEnableEvents = False Then Exit Sub
    i = SugFixas_Lb.ListIndex
    I1 = SugFixas_Ct.SelStart
    If i < 0 Then
        j = SugFixas_Ct.Value
        Nova_Bt_Click
        SugFixas_Ct.Value = j
        i = SugFixas_Lb.ListCount - 1
    End If
    SugFixas_Lb.AddItem SugFixas_Ct.Value, i
    SugFixas_Lb.RemoveItem i + 1
    SugFixas_Lb.Selected(i) = True
    SugFixas_Ct.SelStart = I1
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub SugFixas_Ct_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    i = SugFixas_Lb.ListIndex
    If SugFixas_Ct.Value <> "" Or i < 0 Then Exit Sub
    SugFixas_Lb.RemoveItem i
End Sub

Private Sub SugFixas_LB_Click()
    vEnableEvents = False
    SugFixas_Ct.Value = SugFixas_Lb.Value
    If SugFixas_Ct.Enabled Then SugFixas_Ct.SetFocus
    vEnableEvents = True
    OcultarExibControlesHist
End Sub

Private Sub SugHist_Ct_Change()
    If vEnableEvents = False Then Exit Sub
    i = SugHist_Lb.ListIndex
    I1 = SugHist_Ct.SelStart
    If i < 0 Then
        j = SugHist_Ct.Value
        Nova_Bt_Click
        SugHist_Ct.Value = j
        i = SugHist_Lb.ListCount - 1
    End If
    SugHist_Lb.AddItem SugHist_Ct.Value, i
    SugHist_Lb.RemoveItem i + 1
    SugHist_Lb.Selected(i) = True
    SugHist_Ct.SelStart = I1
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub SugHist_Ct_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    i = SugHist_Lb.ListIndex
    If SugHist_Ct.Value <> "" Or i < 0 Then Exit Sub
    SugHist_Lb.RemoveItem i
End Sub

Private Sub SugHist_Lb_Click()
    vEnableEvents = False
    SugHist_Ct.Value = SugHist_Lb.Value
    If SugHist_Ct.Enabled Then SugHist_Ct.SetFocus
    vEnableEvents = True
    OcultarExibControlesHist
End Sub

Sub OcultarExibControlesHist()
    i = vListBox.ListIndex > -1
    Excluir_Bt.Enabled = i
    Mover_Sb.Enabled = i
    Mover_Lb.Enabled = i
    Transf_Bt.Enabled = i
    Transf_Bt.ControlTipText = "Transfere para " & IIf(MultiPage1.Value = 0, "Fixas", "Hist|fffd|ricas")
    WhatsThis_Img.Top = -50: If bHtmlHelp Then WhatsThis_Img.Top = -1: WhatsThis_Img.Left = Width - 10
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub



INQUEST-PP=macro
