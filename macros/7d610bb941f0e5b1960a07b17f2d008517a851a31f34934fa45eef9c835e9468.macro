Attribute VB_Name = "AL"
Sub ALSelect()
'On Error GoTo error_proc
Dim ALC As String

Sheet21.Range("AL.Override").Value = ""
ALC = Sheet21.Range("AL.Choice").Value

Select Case ALC

    Case "OBA New Template (for set ups involving only Letters products)"
    If MsgBox("The account live template 'New Account (OBA/Other)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator1
    Case "OBA Add On (for set ups involving only Letters products)"
    If MsgBox("The account live template 'Add On (OBA/Other)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator2
    Case "Click and Drop & OBA - Add-on"
    If MsgBox("The account live template 'Click & Drop (Add On)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator3
    Case "Click and Drop & OBA - New"
    If MsgBox("The account live template 'Click & Drop (New)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator4
    Case "Amazon MFN template"
    If MsgBox("The account live template 'Amazon MFN' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator6
    Case "New account |fffd| Shipping API"
    If MsgBox("The account live template 'API (New)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator7
    Case "Add-On Shipping API"
    If MsgBox("The account live template 'API (Add On)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator8
    Case "Pro Shipping New"
    If MsgBox("The account live template 'Pro Shipping (New)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator9
    Case "Pro Shipping Add On"
    If MsgBox("The account live template 'Pro Shipping (Add On)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator10
    Case "New account |fffd| Shipping TPI"
    If MsgBox("The account live template 'TPI (New)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator7
    Case "Add-On Shipping TPI"
    If MsgBox("The account live template 'TPI (Add On)' has been automatically selected. Do you want to continue?" & vbNewLine & vbNewLine & "Select 'Yes' to continue with this template or 'No' to manually select a different template", vbYesNo, "Account Live Template Automatic Selection Confirmation") = vbNo Then ALForm.Show Else _
    ALGenerator8
    
    
End Select

Exit Sub
error_proc:
If MsgBox("Error has occured with subroutine [ALSelect]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
ShutDown
End Sub

Attribute VB_Name = "ALForm"
Attribute VB_Base = "0{C9CD50BA-7A0D-4C39-AC08-98292D7077CE}{65E92C1D-E090-4EC7-AFEF-5AEF289ACDFD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
Sheet21.Range("AL.Override").Value = "OBA New Template (for set ups involving only Letters products)"
15140 ALGenerator1
15150 ALForm.Hide
End Sub

Private Sub CommandButton11_Click()
Sheet21.Range("AL.Override").Value = "New account |fffd| Shipping TPI"
15141 ALGenerator7
15142 ALForm.Hide
End Sub

Private Sub CommandButton12_Click()
Sheet21.Range("AL.Override").Value = "Add-On Shipping TPI"
15143 ALGenerator8
15144 ALForm.Hide
End Sub

Private Sub CommandButton2_Click()
Sheet21.Range("AL.Override").Value = "OBA Add On (for set ups involving only Letters products)"
15160 ALGenerator2
15170 ALForm.Hide
End Sub

Private Sub CommandButton3_Click()
Sheet21.Range("AL.Override").Value = "Click and Drop & OBA - New"
15180 ALGenerator4
15190 ALForm.Hide
End Sub

Private Sub CommandButton4_Click()
Sheet21.Range("AL.Override").Value = "Click and Drop & OBA - Add-on"
15200 ALGenerator3
15210 ALForm.Hide
End Sub

Private Sub CommandButton5_Click()
Sheet21.Range("AL.Override").Value = "OBA New Template (for set ups involving only Letters products)"
15220 ALGenerator5
15230 ALForm.Hide
End Sub

Private Sub CommandButton6_Click()
Sheet21.Range("AL.Override").Value = "Amazon MFN template"
15240 ALGenerator6
15250 ALForm.Hide
End Sub

Private Sub CommandButton7_Click()
Sheet21.Range("AL.Override").Value = "New account |fffd| Shipping API"
15251 ALGenerator7
15252 ALForm.Hide
End Sub

Private Sub CommandButton8_Click()
Sheet21.Range("AL.Override").Value = "Add-On Shipping API"
15253 ALGenerator8
15254 ALForm.Hide
End Sub

Private Sub CommandButton9_Click()
Sheet21.Range("AL.Override").Value = "Pro Shipping New"
15255 ALGenerator9
15256 ALForm.Hide
End Sub

Private Sub CommandButton10_Click()
Sheet21.Range("AL.Override").Value = "Pro Shipping Add On"
15257 ALGenerator10
15258 ALForm.Hide
End Sub
Attribute VB_Name = "AddFields"
Option Explicit
Dim intRowStartSoleTrader As Integer

Dim intFirstRowSiebel As Integer
Dim intFirstRowCustomer As Integer
Dim intFirstRowMCC As Integer
Dim intFirstRowSalesContact As Integer
Dim intFirstRowPartners As Integer
Dim intFirstRowBilling As Integer
Dim intFirstRowPrepay As Integer
Dim intFirstRowCreditCheck As Integer
Dim intFirstRowShipping As Integer
Dim intFirstRowBusinessMail As Integer
Dim intFirstRowCollection As Integer
Dim intFirstRowAddInfo As Integer
Dim intFirstRowCMC As Integer
Dim intFirstRowSettingUpServices As Integer
Dim intFirstRowCAP As Integer
Dim intFirstRowProducts As Integer

Sub AssignValues()
      Dim a As Integer
      Dim b As Integer
      Dim c As Integer
      Dim d As Integer
      Dim e As Integer
      Dim f As Integer
      Dim g As Integer
      Dim h As Integer
      Dim i As Integer
      Dim j As Integer
      Dim k As Integer
      Dim l As Integer
      Dim m As Integer
      Dim n As Integer
      Dim o As Integer
      Dim p As Integer
      Dim q As Integer
15720 On Error GoTo error_proc

15730 intFirstRowSiebel = Range("LOC.Siebel").Row
15740 intFirstRowCustomer = Range("LOC.Customer").Row
15750 intFirstRowMCC = Range("LOC.MCC").Row
15760 intFirstRowSalesContact = Range("LOC.SalesContact").Row
15770 intFirstRowPartners = Range("PAR.BeginPartnership").Row
15780 intFirstRowBilling = Range("LOC.Billing").Row
15790 intFirstRowPrepay = Range("LOC.PrePay").Row
15800 intFirstRowCreditCheck = Range("LOC.CreditCheck").Row
15810 intFirstRowShipping = Range("LOC.Shipping").Row
15820 intFirstRowBusinessMail = Range("LOC.BusinessMailAdvanced").Row
15830 intFirstRowCollection = Range("LOC.Collection").Row
15840 intFirstRowAddInfo = Range("LOC.AddInfo").Row
15850 intFirstRowCMC = Range("LOC.CMC").Row
15860 intFirstRowSettingUpServices = Range("LOC.SettingUpServices").Row
15870 intFirstRowCAP = Range("LOC.CAPTeam").Row
15880 intFirstRowProducts = Range("LOC.Products").Row

15890 a = intFirstRowSiebel
15900 b = intFirstRowCustomer
15910 c = intFirstRowMCC
15920 d = intFirstRowSalesContact
15930 e = intFirstRowPartners
15940 f = intFirstRowBilling
15950 g = intFirstRowPrepay
15960 h = intFirstRowCreditCheck
15970 j = intFirstRowShipping
15980 k = intFirstRowBusinessMail
15990 l = intFirstRowCollection
16000 m = intFirstRowAddInfo
16010 n = intFirstRowCMC
16020 o = intFirstRowSettingUpServices
16030 p = intFirstRowCAP
16040 q = intFirstRowProducts
16050 Exit Sub
error_proc:
16060     If MsgBox("Error has occured with subroutine [AssignValues]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16070     ShutDown

End Sub
Sub AddOperationsAssessmentFields()

End Sub
Sub AddCreditCheckFields()

End Sub
Sub AddNewCustomerSetupFields()

End Sub
Sub AddDMOorOBASetupFields()

End Sub
Sub AddPricingSheetFields()

End Sub
Sub AddNewAccountExistingCustomerFields()

End Sub
Sub AddBMASetupFields()

End Sub
Sub AddCollectionSetupChangeFields()

End Sub
Sub AddAccountAddOnFields()

End Sub
Sub AddAPISetupFields()

End Sub
Sub AddCOSSSetupFields()

End Sub
Attribute VB_Name = "AddProduct"
Attribute VB_Base = "0{CDB4FD89-E97F-4054-BB16-EE3D23749F94}{CED1303B-0413-4053-83F1-F1ABAE4380B6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public EnableEvents As Boolean
Dim DedicatedPricingFlag As Boolean
Dim AgreedRateFlag As Boolean
Dim DimensionsFlag As Boolean
Dim WeightFlag As Boolean
Dim ContractFlag As Boolean
Dim BMAFlag As Boolean
Dim InternationalFlag As Boolean
Dim CNFlag As Boolean


Private Sub AgreedRate_AfterUpdate()
      Dim AR As Double
      Dim CR As Double

3180  If hasNumeric(Me.AgreedRate) And hasNumeric(Me.CalculatorRate) And Me.TierCombo.Value = "Tier 1" Then
3190      AR = Me.AgreedRate.Value
3200      CR = Me.CalculatorRate.Value
3210      If AR < CR Then
3220          MsgBox "The Agreed Rate must be greater than or equal to the Calculator Rate imported for Tier 1 prices.", vbOKOnly + vbInformation, "Agreed Rate Error"
3230          Me.AgreedRate.Value = ""
3240      End If
3250  End If
          
3260  Exit Sub
error_proc:
3270      If MsgBox("Error has occured with subroutine [AgreedRateChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
3280      ShutDown

End Sub

Private Sub AverageLitres_Change()
      'Permit only numerical entries (key press is undone otherwise)
11840 On Error GoTo error_proc
11850 If Me.AverageLitres <> "" Then
11860     If Not hasNumeric(Me.AverageLitres) Then
11870         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
11880         If Len(Me.AverageLitres.text) > 0 Then Me.AverageLitres.text = Left(Me.AverageLitres.text, Len(Me.AverageLitres.text) - 1)
11890     End If
11900 End If

11910 Exit Sub
error_proc:
11920     If MsgBox("Error has occured with subroutine [LitresChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
11930     ShutDown
End Sub

Private Sub AverageLitres_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13980 On Error GoTo error_proc
13990 Call DimensionsCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
14000 If DimensionsFlag = True Then
14010     If Me.AverageLitres <> "" Then
14020         If Me.AverageLitres.Value < 2 Then
14030             MsgBox "Litres less than 2 has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Litres"
14031         ElseIf Me.AverageLitres.Value > 10 And Me.AverageWeight.Value < 2000 Then
14032             MsgBox "Litres greater than 10 has been entered with a weight of less than 2kg." & vbCr & vbCr _
                  & "Please check that this is correct as it is an usual profile incurring a price premium.", vbOKOnly, "Unusual Litres"
14033         ElseIf Me.AverageLitres.Value > 15 And Me.AverageWeight.Value < 5000 Then
14034             MsgBox "Litres greater than 15 has been entered with a weight of less than 5kg." & vbCr & vbCr _
                  & "Please check that this is correct as it is an usual profile incurring a price premium.", vbOKOnly, "Unusual Litres"
14035         ElseIf Me.AverageLitres.Value > 30 Then
14036             MsgBox "Litres greater than 30 has been entered." & vbCr & vbCr _
                  & "Please check that this is correct as it is an usual profile incurring a price premium.", vbOKOnly, "Unusual Litres"
14037         ElseIf Me.AverageLitres.Value > 129.076 Then
14038             MsgBox "Litres more than 129.076 has been entered." & vbCr & vbCr _
                  & "This is above the maximum allowed, please correct.", vbOKOnly, "Unusual Litres"
14039             AverageLitres = ""
14040             Me.AverageLitres.BorderColor = RGB(255, 0, 0)
14060         End If
14070         Me.AverageLitres.BorderColor = RGB(128, 128, 128)
14080     ElseIf Me.AverageLitres = "" Or Me.AverageLitres = 0 Then
14090         Me.AverageLitres.BorderColor = RGB(255, 0, 0)
14100     End If
14101 LitresTo
14110 End If
14120 Exit Sub
error_proc:
14130     If MsgBox("Error has occured with subroutine [AvgLitresExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14140     ShutDown
End Sub

Private Sub Discount_AfterUpdate()
3290  On Error GoTo error_proc
3300  If Not Me.Discount.Value <= 10 And Me.Discount.Value >= 0 Then
3310      MsgBox "The discount value must be between 0% and 10%."
3320      Discount.Value = 0
3330  End If
      'Call InputBorderCheck
3340  Exit Sub
error_proc:
3350      If MsgBox("Error has occured with subroutine [Discount_Chage]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
3360      ShutDown
End Sub


Private Sub FTE1_Change()
12140 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12150 If Me.FTE1 <> "" Then
12160     If Not hasNumeric(Me.FTE1) Then
12170         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12180         If Len(Me.FTE1.text) > 0 Then Me.FTE1.text = Left(Me.FTE1.text, Len(Me.FTE1.text) - 1)
12190     End If
12200 End If
12210 Exit Sub
error_proc:
12220     If MsgBox("Error has occured with subroutine [FTE1Change]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12230     ShutDown
End Sub

Private Sub FTE2_Change()
12140 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12150 If Me.FTE2 <> "" Then
12160     If Not hasNumeric(Me.FTE2) Then
12170         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12180         If Len(Me.FTE2.text) > 0 Then Me.FTE2.text = Left(Me.FTE2.text, Len(Me.FTE2.text) - 1)
12190     End If
12200 End If
12210 Exit Sub
error_proc:
12220     If MsgBox("Error has occured with subroutine [FTE2Change]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12230     ShutDown
End Sub

Private Sub FTE3_Change()
12140 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12150 If Me.FTE3 <> "" Then
12160     If Not hasNumeric(Me.FTE3) Then
12170         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12180         If Len(Me.FTE3.text) > 0 Then Me.FTE3.text = Left(Me.FTE3.text, Len(Me.FTE3.text) - 1)
12190     End If
12200 End If
12210 Exit Sub
error_proc:
12220     If MsgBox("Error has occured with subroutine [FTE3Change]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12230     ShutDown
End Sub

Private Sub ImportT1Button_Click()
3370  On Error GoTo error_proc
3380  If TierCombo.Value = "Tier 1" Or TierCombo.Value = "" Then
3390      If MsgBox("Do you want to import a Tier 1 profile?", vbYesNo, "Import Tier 1") = vbYes Then
3400      ImportTier1CSV
3410      Sheet23.Calculate
3420      Me.AnnualVolume.Value = Sheet23.Range("T1I.Quantity").Value
3430      Me.CalculatorRate.Value = Sheet23.Range("T1I.Price").Value
3440      Me.AverageWeight.Value = Sheet23.Range("T1I.AvgWeight").Value
3450      Me.MaxHeight.Value = Sheet23.Range("T1I.MaxH")
3460      Me.MaxWidth.Value = Sheet23.Range("T1I.MaxW")
3470      Me.MaxLength.Value = Sheet23.Range("T1I.MaxL").Value
3480      Me.MaxWeight.Value = Sheet23.Range("T1I.MaxWeight").Value
3490      Me.AverageHeight.Value = Sheet23.Range("T1I.AvgH").Value
3500      Me.AverageWidth.Value = Sheet23.Range("T1I.AvgW").Value
3510      Me.AverageLength.Value = Sheet23.Range("T1I.AvgL").Value
3520      Me.AgreedRate.Value = ""
3530      Me.TierCombo.Value = "Tier 1"
3540      Call InputBorderCheck
3550      Me.Imported.Value = True
3560      MsgBox "Import Successful, please confirm the sold price in the 'Agreed Rate (|fffd|)' field (must be >= value in 'Rate Card Rate (|fffd|)')."
3570      End If
3580  End If

3581  If TierCombo.Value = "Tier 2" Then
Me.Hide
AddT2
3589  End If

3590  Exit Sub
error_proc:
3600      If MsgBox("Error has occured with subroutine [ImportT1Button]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
3610      ShutDown
End Sub




Private Sub TierCombo_Change()
3620  On Error GoTo error_proc

3630      If TierCombo.Value = "Tier 1" Or TierCombo.Value = "Tier 2" Then
3640          ImportT1Button.Visible = True
3650          Product.Width = 228
3660      Else
3670          ImportT1Button.Visible = False
3680          Product.Width = 288
3690      End If
          
3700      If TierCombo.Value = "" Then
3710          Me.TierCombo.BorderColor = RGB(255, 0, 0)
3720      Else
3730          Me.TierCombo.BorderColor = RGB(128, 128, 128)
3740      End If

3750  Exit Sub
error_proc:
3760      If MsgBox("Error has occured with subroutine [TierCombo_Change]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
3770      ShutDown
End Sub

Private Sub ToggleButton1_Click()
If ToggleButton1.Value = False Then
    ToggleButton1.Caption = "Enter average in litres. Click here to use cm instead."
    AverageHeight.Value = ""
    AverageWidth.Value = ""
    AverageLength.Value = ""
    AverageHeight.Locked = True
    AverageWidth.Locked = True
    AverageLength.Locked = True
    AverageLitres.Locked = False
    AverageLitres.Value = ""
    AverageHeight.BackColor = RGB(150, 150, 150)
    AverageWidth.BackColor = RGB(150, 150, 150)
    AverageLength.BackColor = RGB(150, 150, 150)
    AverageLitres.BackColor = RGB(255, 255, 255)
    Me.AverageHeight.BorderColor = RGB(128, 128, 128)
    Me.AverageWidth.BorderColor = RGB(128, 128, 128)
    Me.AverageLength.BorderColor = RGB(128, 128, 128)
    If Me.AverageLitres = "" Or Me.AverageLitres = 0 Then
        Me.AverageLitres.BorderColor = RGB(255, 0, 0)
    Else
        Me.AverageLitres.BorderColor = RGB(128, 128, 128)
    End If
Else
    ToggleButton1.Caption = "Enter average in cm. Click here to use litres instead."
    AverageHeight.Locked = False
    AverageWidth.Locked = False
    AverageLength.Locked = False
    AverageHeight.Value = ""
    AverageWidth.Value = ""
    AverageLength.Value = ""
    AverageLitres.Value = ""
    AverageLitres.Locked = True
    AverageHeight.BackColor = RGB(255, 255, 255)
    AverageWidth.BackColor = RGB(255, 255, 255)
    AverageLength.BackColor = RGB(255, 255, 255)
    AverageLitres.BackColor = RGB(150, 150, 150)
    AverageLitres.BorderColor = RGB(128, 128, 128)
    If Me.AverageHeight = "" Or Me.AverageHeight = 0 Then
        Me.AverageHeight.BorderColor = RGB(255, 0, 0)
    Else
        Me.AverageHeight.BorderColor = RGB(128, 128, 128)
    End If
    If Me.AverageWidth = "" Or Me.AverageWidth = 0 Then
        Me.AverageWidth.BorderColor = RGB(255, 0, 0)
    Else
        Me.AverageWidth.BorderColor = RGB(128, 128, 128)
    End If
    If Me.AverageLength = "" Or Me.AverageLength = 0 Then
        Me.AverageLength.BorderColor = RGB(255, 0, 0)
    Else
        Me.AverageLength.BorderColor = RGB(128, 128, 128)
    End If

End If
End Sub

Private Sub UserForm_Initialize()
      'on error GoTo error_proc
3780  Me.EnableEvents = True
3781  Me.Class.List = Range("list.Class").Value
3790  With Me.Accreditation
3800      .AddItem "Yes"
3810      .AddItem "No"
3820      .text = "No"
3830  End With

3840  Me.Product.List = Range("ProductName.List").Value
3850  Me.ProductCode.List = Range("ProductCode.List").Value

3860  Counter = 1
3870  For Each OneCell In Range("ProductCode.List")
3880      If Me.ProductCode = OneCell.Value Then
3890          ProductDescrp = Range("list.Products").Cells(Counter, 1).Value
3900      End If
3910      Counter = Counter + 1
3920  Next OneCell

      'Do we show add product button?
3930  If NewProductFlag = True Then Me.OK.Visible = False

      'PRODUCT CODE
3940  If Form.Cells(ProductRow, ProductCol).Value <> "" Then
3950      Counter = 1
3960      For Each OneCell In Range("list.Products")
3970          If Form.Cells(ProductRow, ProductCol).Value = OneCell.Value Then
3980              Me.ProductCode.Value = Range("ProductCode.List").Cells(Counter, 1)
3990              Me.Product.Value = Range("ProductName.List").Cells(Counter, 1)
4000              GoTo FoundIt
4010          End If
4020          Counter = Counter + 1
4030      Next OneCell
4040  End If

FoundIt:
      'Load up the VBA Form with what's already been entered in the Excel worksheet 'Form'
4050  If Form.Cells(ProductRow, Range("PRO.Class").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.Class").Column).Value <> 0 Then
4060      Me.Class.Value = Form.Cells(ProductRow, Range("PRO.Class").Column).Value
4070  End If

4080  If Form.Cells(ProductRow, Range("PRO.AnnualVolume").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.AnnualVolume").Column).Value <> 0 Then
4090      Me.AnnualVolume.Value = Form.Cells(ProductRow, Range("PRO.AnnualVolume").Column).Value
4100  End If

4110  If Form.Cells(ProductRow, Range("PRO.CalcRate").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.CalcRate").Column).Value <> 0 Then
4120      Me.CalculatorRate.Value = Form.Cells(ProductRow, Range("PRO.CalcRate").Column).Value
4130  End If

4140  If Form.Cells(ProductRow, Range("PRO.AgreedRate").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.AgreedRate").Column).Value <> 0 Then
4150      Me.AgreedRate.Value = Form.Cells(ProductRow, Range("PRO.AgreedRate").Column).Value
4160  End If

4170  If Form.Cells(ProductRow, Range("PRO.LargeLetters").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.LargeLetters").Column).Value <> 0 Then
4180      Me.LargeLetters.Value = Form.Cells(ProductRow, Range("PRO.LargeLetters").Column).Value
4190  End If

4200  If Form.Cells(ProductRow, Range("PRO.Parcels").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.Parcels").Column).Value <> 0 Then
4210      Me.Parcels.Value = Form.Cells(ProductRow, Range("PRO.Parcels").Column).Value
4220  End If

4230  If Form.Cells(ProductRow, Range("PRO.Combined").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.Combined").Column).Value <> 0 Then
4240      Me.Combined.Value = Form.Cells(ProductRow, Range("PRO.Combined").Column).Value
4250  End If

4260  If Form.Cells(ProductRow, Range("PRO.AccRequired").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.AccRequired").Column).Value <> 0 Then
4270      Me.Accreditation.Value = Form.Cells(ProductRow, Range("PRO.AccRequired").Column)
4280  End If

4290  If Form.Cells(ProductRow, Range("PRO.PubCode").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.PubCode").Column).Value <> 0 Then
4300      Me.PeriodicalCode.Value = Form.Cells(ProductRow, Range("PRO.PubCode").Column).Value
4310  End If

4320  If Form.Cells(ProductRow, Range("PRO.PubTitle").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.PubTitle").Column).Value <> 0 Then
4330      Me.PeriodicalTitle.Value = Form.Cells(ProductRow, Range("PRO.PubTitle").Column).Value
4340  End If

4350  If Form.Cells(ProductRow, Range("PRO.AvgHeight").Column).Value <> "Height" _
          And Form.Cells(ProductRow, Range("PRO.AvgHeight").Column).Value <> "height" _
          And Form.Cells(ProductRow, Range("PRO.AvgHeight").Column).Value <> 0 Then
4360      Me.AverageHeight.Value = Form.Cells(ProductRow, Range("PRO.AvgHeight").Column).Value
4370  End If

4380  If Form.Cells(ProductRow, Range("PRO.AvgWidth").Column).Value <> "Width" _
          And Form.Cells(ProductRow, Range("PRO.AvgWidth").Column).Value <> "width" _
          And Form.Cells(ProductRow, Range("PRO.AvgWidth").Column).Value <> 0 Then
4390      Me.AverageWidth.Value = Form.Cells(ProductRow, Range("PRO.AvgWidth").Column).Value
4400  End If

4410  If Form.Cells(ProductRow, Range("PRO.AvgLength").Column).Value <> "Length" _
          And Form.Cells(ProductRow, Range("PRO.AvgLength").Column).Value <> "length" _
          And Form.Cells(ProductRow, Range("PRO.AvgLength").Column).Value <> 0 Then
4420      Me.AverageLength.Value = Form.Cells(ProductRow, Range("PRO.AvgLength").Column).Value
4430  End If

4440  If Form.Cells(ProductRow, Range("PRO.AvgWeight").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.AvgWeight").Column).Value <> 0 Then
4450      Me.AverageWeight.Value = Form.Cells(ProductRow, Range("PRO.AvgWeight").Column).Value
4460  End If

4470  If Form.Cells(ProductRow, Range("PRO.MaxHeight").Column).Value <> "Height" _
          And Form.Cells(ProductRow, Range("PRO.MaxHeight").Column).Value <> "height" _
          And Form.Cells(ProductRow, Range("PRO.MaxHeight").Column).Value <> 0 Then
4480      Me.MaxHeight.Value = Form.Cells(ProductRow, Range("PRO.MaxHeight").Column).Value
4490  End If

4500  If Form.Cells(ProductRow, Range("PRO.MaxWidth").Column).Value <> "Width" _
          And Form.Cells(ProductRow, Range("PRO.MaxWidth").Column).Value <> "width" _
          And Form.Cells(ProductRow, Range("PRO.MaxWidth").Column).Value <> 0 Then
4510      Me.MaxWidth.Value = Form.Cells(ProductRow, Range("PRO.MaxWidth").Column).Value
4520  End If

4530  If Form.Cells(ProductRow, Range("PRO.MaxLength").Column).Value <> "Length" _
          And Form.Cells(ProductRow, Range("PRO.MaxLength").Column).Value <> "length" _
          And Form.Cells(ProductRow, Range("PRO.MaxLength").Column).Value <> 0 Then
4540      Me.MaxLength.Value = Form.Cells(ProductRow, Range("PRO.MaxLength").Column).Value
4550  End If

4560  If Form.Cells(ProductRow, Range("PRO.MaxWeight").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.MaxWeight").Column).Value <> 0 Then
4570      Me.MaxWeight.Value = Form.Cells(ProductRow, Range("PRO.MaxWeight").Column).Value
4580  End If

4590  If Form.Cells(ProductRow, Range("PRO.SuffPre").Column).Value <> "" _
          And Form.Cells(ProductRow, Range("PRO.SuffPre").Column).Value <> 0 Then
4600      Me.SuffixPrefix.Value = Form.Cells(ProductRow, Range("PRO.SuffPre").Column).Value
4610  End If

4620  If Form.Cells(ProductRow, Range("PRO.Tier").Column).Value <> "" Then
4630      If Form.Cells(ProductRow, Range("PRO.Tier").Column).Value <> "Tier 1 Imported" Then Me.TierCombo.Value = Form.Cells(ProductRow, Range("PRO.Tier").Column).Value
4640  End If

4650  If Form.Cells(ProductRow, Range("PRO.Discount").Column).Value <> "" Then
4660      Me.Discount.Value = Form.Cells(ProductRow, Range("PRO.Discount").Column).Value
4670  End If

4671  If Form.Cells(ProductRow, Range("Pro.Country").Column).Value <> "" Then
4672      Me.CountryCombo.Value = Form.Cells(ProductRow, Range("Pro.Country").Column).Value
4673  End If
4674  If Form.Cells(ProductRow, Range("Pro.Serv").Column).Value <> "" Then
4675      Me.ServiceCombo.Value = Form.Cells(ProductRow, Range("Pro.Serv").Column).Value
4676  End If
4677  If Form.Cells(ProductRow, Range("Pro.Freq").Column).Value <> "" Then
4678      Me.FrequencyCombo.Value = Form.Cells(ProductRow, Range("Pro.Freq").Column).Value
4679  End If

4680  If Form.Cells(ProductRow, Range("PRO.Volume").Column).Value > 0 Then
4681      Me.AverageLitres.Value = Round(Form.Cells(ProductRow, Range("PRO.Volume").Column).Value, 2)
4682  End If

4683  If Form.Cells(ProductRow, Range("PRO.FTE1").Column).Value > 0 Then
4684      Me.FTE1.Value = Form.Cells(ProductRow, Range("PRO.FTE1").Column).Value
4685  End If
4686  If Form.Cells(ProductRow, Range("PRO.FTE2").Column).Value > 0 Then
4687      Me.FTE2.Value = Form.Cells(ProductRow, Range("PRO.FTE2").Column).Value
4688  End If
4689  If Form.Cells(ProductRow, Range("PRO.FTE3").Column).Value > 0 Then
4690      Me.FTE3.Value = Form.Cells(ProductRow, Range("PRO.FTE3").Column).Value
4691  End If


4694  Me.Imported.Value = False

      'Contract number input replaced by Finance sheet
      'If Form.Cells(ProductRow, Range("PRO.ContractNo").Column).Value <> "" _
          'And Form.Cells(ProductRow, Range("PRO.ContractNo").Column).Value <> 0 Then
          'Me.ContractNumber.Value = Form.Cells(ProductRow, Range("PRO.ContractNo").Column).Value
      'End If
4695  Exit Sub
error_proc:
4700      If MsgBox("Error has occured with subroutine [Initialise]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
4710      ShutDown

End Sub
Private Sub OK_Click()
4720  On Error GoTo error_proc
4730  DataOKFlag = True

4740  Call CheckDataEntered
4750  If DataOKFlag = True Then
4760      Call FillInForm
4770      Me.Hide
4780  End If

4790  Exit Sub
error_proc:
4800      If MsgBox("Error has occured with subroutine [Ok_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
4810      ShutDown

End Sub
Sub AddNewProduct_Click()
      Dim DataRowFlag As Boolean
      Dim ProductSlot As Boolean
      Dim SU1 As Boolean
      Dim SU2 As Boolean
4820  On Error GoTo error_proc
4830  DataOKFlag = True
4840  ProductSlot = False

4841  If Not Sheet23.Range("SU1.Check") Then
4842    If Me.ProductCode = "CRL" Or Me.ProductCode = "RM1" Or Me.ProductCode = "RM2" Or Me.ProductCode = "RM3" Or Me.ProductCode = "RM4" Then SU1 = True
4843  End If
4844  If Not Sheet23.Range("SU2.Check") Then
4845    If Me.ProductCode = "PPF" Or Me.ProductCode = "PK0" Or Me.ProductCode = "PK9" Or Me.ProductCode = "RM5" Or Me.ProductCode = "RM6" Then SU2 = True
4846  End If
4850  Call CheckDataEntered
4860  If DataOKFlag = True Then
4870      DataRowFlag = True
4880      For Each OneCell In Range(Range("PRO.Product.1"), Range("PRO.Product.30"))
4890          If DataRowFlag = True And OneCell.Value = 0 Then 'This is the first row without a product
4900              ProductRow = OneCell.Row
4910              ProductSlot = True
4920              GoTo FoundEmptyProduct
4930          End If
4940          DataRowFlag = Not (DataRowFlag)
4950      Next OneCell
FoundEmptyProduct:
4960      If ProductSlot Then
4970          Call FillInForm
4980      Else
4990          MsgBox "Maximum number (30) of product slots on this form have been filled." & vbCr & vbCr _
              & "Please start a fresh form if you wish to add further products.", vbOKOnly, "No More Product Slots Available"
5000      End If

5001    If SU1 Or SU2 Then
5002        Me.EnableEvents = False
5003        If SU1 Then Me.ProductCode = "SU1" Else Me.ProductCode = "SU2"
'5004        Me.EnableEvents = True
5005      For Each OneCell In Range(Range("PRO.Product.1"), Range("PRO.Product.30"))
5006          If DataRowFlag = True And OneCell.Value = 0 Then 'This is the first row without a product
5007              ProductRow = OneCell.Row
5008              ProductSlot = True
5009              GoTo FoundEmptyProduct2
5010          End If
5011          DataRowFlag = Not (DataRowFlag)
5012      Next OneCell
FoundEmptyProduct2:
5013      If ProductSlot Then
5014          Call FillInForm
5015      Else
5016          MsgBox "Maximum number (30) of product slots on this form have been filled." & vbCr & vbCr _
              & "Please start a fresh form if you wish to add further products.", vbOKOnly, "No More Product Slots Available"
5017      End If

5018    End If

5019    Me.Hide

5020    If SU1 Then MsgBox "SU1 has been automatically added to ensure compatability with the emergency posting process"
5021    If SU2 Then MsgBox "SU2 has been automatically added to ensure compatability with the emergency posting process"

5030  End If

5032  Exit Sub
error_proc:
5040      If MsgBox("Error has occured with subroutine [AddNewProduct_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
5050      ShutDown
End Sub

Sub AddNewProductUN_Click()
      Dim DataRowFlag As Boolean
      Dim ProductSlot As Boolean
      'on error GoTo error_proc
5060  DataOKFlag = True
5070  ProductSlot = False

5080  Call CheckDataEntered
5090  If DataOKFlag = True Then
5100      DataRowFlag = True
5110      For Each OneCell In Range(Range("PRO.Product.1"), Range("PRO.Product.30"))
5120          If DataRowFlag = True And OneCell.Value = 0 Then 'This is the first row without a product
5130              ProductRow = OneCell.Row
5140              ProductSlot = True
5150              GoTo FoundEmptyProduct
5160          End If
5170          DataRowFlag = Not (DataRowFlag)
5180      Next OneCell
FoundEmptyProduct:
5190      If ProductSlot Then
5200          Call FillInFormUN
5210      Else
5220          MsgBox "Maximum number (30) of product slots on this form have been filled." & vbCr & vbCr _
              & "Please start a fresh form if you wish to add further products.", vbOKOnly, "No More Product Slots Available"
5230      End If
5240      Me.Hide
5250  End If
5260  Exit Sub
error_proc:
5270      If MsgBox("Error has occured with subroutine [AddNewProduct_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
5280      ShutDown
End Sub
Sub Cancel_Click()
5290  On Error GoTo error_proc
5300  Me.Hide
5310  Exit Sub
error_proc:
5320      If MsgBox("Error has occured with subroutine [Cancel_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
5330      ShutDown
End Sub
Private Sub ProductCode_AfterUpdate()
5340  On Error GoTo error_proc
5341  If Me.EnableEvents = False Then Exit Sub
'5350  If Me.ProductCode.Value = "STL" Then MsgBox "From 29/03/2017 Barcoded Unsorted Product codes (UNA/UNB) are available & preferred for letters customers using OBA only - otherwise use STL as normal."
5360  If Me.ProductCode.Value = "CLN" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNC/UND)."
'5370  If Me.ProductCode.Value = "BPL" Then MsgBox "From 29/03/2017 Barcoded Unsorted Product codes (UNG/UNH) are available & preferred for letters customers using OBA only - otherwise use BPL as normal."
5380  If Me.ProductCode.Value = "CLA" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNI)."
5390  If Me.ProductCode.Value = "CLB" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNJ)."
5400  If Me.ProductCode.Value = "CLP" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNK)."
5410  If Me.ProductCode.Value = "CLQ" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNL)."
5420  If Me.ProductCode.Value = "SU1" Then MsgBox "Please note: To be used as a standalone product this requires Sales Director Approval and Ian Wilkinson must be copied in. (SU1)"
5430  If Me.ProductCode.Value = "SU2" Then MsgBox "Please note: To be used as a standalone product this requires Sales Director Approval and Ian Wilkinson must be copied in. (SU2)"
5440  If Me.ProductCode.Value = "UNO" Then MsgBox "This product (Advanced Local 1C Letter and Large Letter) must be pre-authorised by Danny Gates.  Only proceed if you have this authorisation."
5450  If Me.ProductCode.Value = "UNP" Then MsgBox "This product (Advanced Local 2C Letter and Large Letter) must be pre-authorised by Danny Gates.  Only proceed if you have this authorisation."
5460  If Me.ProductCode.Value = "CLN" Or Me.ProductCode.Value = "CLA" Or Me.ProductCode.Value = "CLB" Or Me.ProductCode.Value = "CLP" Or Me.ProductCode.Value = "CLQ" Or Me.ProductCode.Value = "CLN" Then
5470      Me.ProductCode.Value = ""
5480      Me.Product.Value = ""
5490      Exit Sub
5500  End If
5510  If Me.ProductCode.Value = "MTE" Then MsgBox ("This country priced product is to be used here for Tier 2a (without a discount)/Tier 2b (with a discount <=10%) pricing only. Please ensure you have a relevant pricing authorisation and attach this to your form submission." & vbNewLine & vbNewLine & "Any Tier 3 setups CANNOT be handled through this form and must follow the bespoke process.")
5520  If Me.ProductCode.Value = "MP9" Then MsgBox ("This country priced product is to be used here for Tier 2a (without a discount)/Tier 2b (with a discount <=10%) pricing only. Please ensure you have a relevant pricing authorisation and attach this to your form submission." & vbNewLine & vbNewLine & "Any Tier 3 setups CANNOT be handled through this form and must follow the bespoke process.")
5530  If Me.ProductCode.Value = "MP7" Then MsgBox ("This country priced product is to be used here for Tier 2a (without a discount)/Tier 2b (with a discount <=10%) pricing only. Please ensure you have a relevant pricing authorisation and attach this to your form submission." & vbNewLine & vbNewLine & "Any Tier 3 setups CANNOT be handled through this form and must follow the bespoke process.")
5540  Call InputBorderCheck
5550  If DedicatedPricingFlag = True Then MsgBox "The product you've chosen requires additional dedicated pricing information", vbOKOnly, "Additional Pricing Information Required"

5560  Exit Sub
error_proc:
5570      If MsgBox("Error has occured with subroutine [ProductCode_AfterUpdate]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
5580      ShutDown

End Sub
Private Sub ProductCode_Change()
      Dim Counter As Integer
      Dim OneCell As Range
5590  On Error GoTo error_proc

5600  If Len(Me.ProductCode) = 3 Then
5610      CodeOKFlag = False
5620      Counter = 1
5630      For Each OneCell In Range("ProductCode.List")
5640          If Me.ProductCode = OneCell.Value Then
5650              CodeOKFlag = True
5660              Me.Product = Range("ProductName.List").Cells(Counter, 1)
5670              Call ClassCheck(Counter)
      'Need to stop it now, as Counter is used to drive choice of class
5680              GoTo FoundProduct
5690          End If
5700          Counter = Counter + 1
5710      Next OneCell

FoundProduct:
5720      If CodeOKFlag = False Then
5730          MsgBox "That is an invalid code." & vbCr & vbCr _
                  & "Please select from the drop-down list provided.", vbOKOnly, "Invalid Code Entered"
5740          If Len(Me.ProductCode) > 0 Then Me.ProductCode = Left(Me.ProductCode, Len(Me.ProductCode) - 1)
5750      End If
5760  End If
5770  Exit Sub
error_proc:
5780      If MsgBox("Error has occured with subroutine [ProductCodeChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
5790      ShutDown
End Sub
Private Sub Product_AfterUpdate()
      Dim Counter As Integer
      Dim OneCell As Range
5800  On Error GoTo error_proc
5801  If Me.EnableEvents = False Then Exit Sub
5810  Counter = 1
5820  ProductNameOKFlag = False
5830  For Each OneCell In Range("ProductName.List")
5840      If Me.Product = OneCell.Value Then
5850          Me.ProductCode = Range("ProductCode.List").Cells(Counter, 1)
5860          ProductNameOKFlag = True
      'Need to stop it now, as Counter is used to drive choice of class
5870          GoTo FoundProductCode
5880      End If
5890      Counter = Counter + 1
5900  Next OneCell

FoundProductCode:
5910  If ProductNameOKFlag = True Then
5920      Call InputBorderCheck
5930      Call ClassCheck(Counter)
5940      If DedicatedPricingFlag = True Then MsgBox "The product you've chosen requires additional dedicated pricing information", vbOKOnly, "Additional Pricing Information Required"
5950  Else
5960      MsgBox "That is an invalid product description." & vbCr & vbCr _
              & "Please select from the drop-down list provided.", vbOKOnly, "Invalid Product Entered"
5970      Product.SetFocus
5980  End If
'5990  If Me.ProductCode.Value = "STL" Then MsgBox "From 29/03/2017 Barcoded Unsorted Product codes (UNA/UNB) are available & preferred for letters customers using OBA only - otherwise use STL as normal."
6000  If Me.ProductCode.Value = "CLN" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNC/UND)."
'6010  If Me.ProductCode.Value = "BPL" Then MsgBox "From 29/03/2017 Barcoded Unsorted Product codes (UNG/UNH) are available & preferred for letters customers using OBA only - otherwise use BPL as normal."
6020  If Me.ProductCode.Value = "CLA" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNI)."
6030  If Me.ProductCode.Value = "CLB" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNJ)."
6040  If Me.ProductCode.Value = "CLP" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNK)."
6050  If Me.ProductCode.Value = "CLQ" Then MsgBox "This product is no longer available, please use the appropriate replacement (UNL)."
6060  If Me.ProductCode.Value = "SU1" Then MsgBox "Please note: To be used as a standalone product this requires Sales Director Approval and Ian Wilkinson must be copied in. (SU1)"
6070  If Me.ProductCode.Value = "SU2" Then MsgBox "Please note: To be used as a standalone product this requires Sales Director Approval and Ian Wilkinson must be copied in. (SU2)"
6080  If Me.ProductCode.Value = "UNO" Then MsgBox "This product (Advanced Local 1C Letter and Large Letter) must be pre-authorised by Danny Gates.  Only proceed if you have this authorisation."
6090  If Me.ProductCode.Value = "UNP" Then MsgBox "This product (Advanced Local 2C Letter and Large Letter) must be pre-authorised by Danny Gates.  Only proceed if you have this authorisation."
6100  If Me.ProductCode.Value = "CLN" Or Me.ProductCode.Value = "CLA" Or Me.ProductCode.Value = "CLB" Or Me.ProductCode.Value = "CLP" Or Me.ProductCode.Value = "CLQ" Or Me.ProductCode.Value = "CLN" Then
6110      Me.ProductCode.Value = ""
6120      Me.Product.Value = ""
6130      Exit Sub
6140  End If

6150  If Me.ProductCode.Value = "MTE" Then MsgBox ("This country priced product is to be used here for Tier 2a (without a discount)/Tier 2b (with a discount <=10%) pricing only. Please ensure you have a relevant pricing authorisation and attach this to your form submission." & vbNewLine & vbNewLine & "Any Tier 3 setups CANNOT be handled through this form and must follow the bespoke process.")
6160  If Me.ProductCode.Value = "MP9" Then MsgBox ("This country priced product is to be used here for Tier 2a (without a discount)/Tier 2b (with a discount <=10%) pricing only. Please ensure you have a relevant pricing authorisation and attach this to your form submission." & vbNewLine & vbNewLine & "Any Tier 3 setups CANNOT be handled through this form and must follow the bespoke process.")
6170  If Me.ProductCode.Value = "MP7" Then MsgBox ("This country priced product is to be used here for Tier 2a (without a discount)/Tier 2b (with a discount <=10%) pricing only. Please ensure you have a relevant pricing authorisation and attach this to your form submission." & vbNewLine & vbNewLine & "Any Tier 3 setups CANNOT be handled through this form and must follow the bespoke process.")


6180  Exit Sub
error_proc:
6190      If MsgBox("Error has occured with subroutine [ProductAfterUpdate]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
6200      ShutDown
End Sub
Sub Class_AfterUpdate()
      Dim Counter As Integer
6210  On Error GoTo error_proc
6211  If Me.EnableEvents = False Then Exit Sub
6220  Counter = 1
6230  For Each OneCell In Range("ProductCode.List")
6240      If Me.ProductCode = OneCell.Value Then Call ClassCheck(Counter)
6250      Counter = Counter + 1
6260  Next OneCell
6270  Exit Sub
error_proc:
6280      If MsgBox("Error has occured with subroutine [ClassAfterUpdate]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
6290      ShutDown
End Sub
Sub InputBorderCheck()
6300  On Error GoTo error_proc

6310  Call TierCheck

6320  If Me.Class = "Please select" Or Me.Class = "" Then
6330      Me.Class.BorderColor = RGB(255, 0, 0)
6340  Else
6350      Me.Class.BorderColor = RGB(128, 128, 128)
6360  End If

6370  Call InternationalCheck
6380  If InternationalFlag = False Then
6390      If Me.AnnualVolume = "" Or Me.AnnualVolume = 0 Then
6400          Me.AnnualVolume.BorderColor = RGB(255, 0, 0)
6410      Else
6420          Me.AnnualVolume.BorderColor = RGB(128, 128, 128)
6430      End If
6440  Else
6450      Me.AnnualVolume.BorderColor = RGB(128, 128, 128)
6460  End If

6470  Call CNCheck
6480  If CNFlag = False Then
6490      Me.Discount.Visible = False
6500      Me.DiscountLabel.Visible = False
6510      Me.Discount.Value = ""
6520  Else
6530      Me.Discount.Visible = True
6540      Me.DiscountLabel.Visible = True
6550      If Me.Discount.Value = "" Then Me.Discount.Value = 0
6560  End If

6570  Call DedicatedPricingCheck
6580  If DedicatedPricingFlag = True Then
6590      If Me.LargeLetters = "" Or Me.LargeLetters = 0 Then
6600          Me.LargeLetters.BorderColor = RGB(255, 0, 0)
6610      Else
6620          Me.LargeLetters.BorderColor = RGB(128, 128, 128)
6630      End If
          
6640      If Me.Parcels = "" Or Me.Parcels = 0 Then
6650          Me.Parcels.BorderColor = RGB(255, 0, 0)
6660      Else
6670          Me.Parcels.BorderColor = RGB(128, 128, 128)
6680      End If
          
6690      If Me.Combined = "" Or Me.Combined = 0 Then
6700          Me.Combined.BorderColor = RGB(255, 0, 0)
6710      Else
6720          Me.Combined.BorderColor = RGB(128, 128, 128)
6730      End If
6740  Else
6750      Me.LargeLetters.BorderColor = RGB(128, 128, 128)
6760      Me.Parcels.BorderColor = RGB(128, 128, 128)
6770      Me.Combined.BorderColor = RGB(128, 128, 128)
6780  End If

6790  Call AgreedRateCheck
6800  If AgreedRateFlag = True Then
6810      If Me.AgreedRate = "" Or Me.AgreedRate = 0 Then
6820          Me.AgreedRate.BorderColor = RGB(255, 0, 0)
6830      Else
6840          Me.AgreedRate.BorderColor = RGB(128, 128, 128)
6850      End If
          
6860      If Me.CalculatorRate = "" Or Me.CalculatorRate = 0 Then
6870          Me.CalculatorRate.BorderColor = RGB(255, 0, 0)
6880      Else
6890          Me.CalculatorRate.BorderColor = RGB(128, 128, 128)
6900      End If
6910  Else
6920      Me.AgreedRate.BorderColor = RGB(128, 128, 128)
6930      Me.CalculatorRate.BorderColor = RGB(128, 128, 128)
6940  End If

6950  Call BMACheck
6960  Call WeightCheck

6970  If BMAFlag = True Or WeightFlag = True Then
6980      If Me.AverageWeight = "" Or Me.AverageWeight = 0 Then
6990          Me.AverageWeight.BorderColor = RGB(255, 0, 0)
7000      Else
7010          Me.AverageWeight.BorderColor = RGB(128, 128, 128)
7020      End If
          
      '    If Me.MaxWeight = "" Or Me.MaxWeight = 0 Then
      '        Me.MaxWeight.BorderColor = RGB(255, 0, 0)
      '    Else
      '        Me.MaxWeight.BorderColor = RGB(128, 128, 128)
      '    End If
7030  Else
7040      Me.AverageWeight.BorderColor = RGB(128, 128, 128)
      '    Me.MaxWeight.BorderColor = RGB(128, 128, 128)
7050  End If

7060  Call DimensionsCheck
7070  If DimensionsFlag = True Then
7071      If ToggleButton1 = True Then
7080          If Me.AverageHeight = "" Or Me.AverageHeight = 0 Then
7090              Me.AverageHeight.BorderColor = RGB(255, 0, 0)
7100          Else
7110              Me.AverageHeight.BorderColor = RGB(128, 128, 128)
7120          End If
              
7130          If Me.AverageWidth = "" Or Me.AverageWidth = 0 Then
7140              Me.AverageWidth.BorderColor = RGB(255, 0, 0)
7150          Else
7160              Me.AverageWidth.BorderColor = RGB(128, 128, 128)
7170          End If
              
7180          If Me.AverageLength = "" Or Me.AverageLength = 0 Then
7190              Me.AverageLength.BorderColor = RGB(255, 0, 0)
7200          Else
7210              Me.AverageLength.BorderColor = RGB(128, 128, 128)
7220          End If
7221      Else
7222          If Me.AverageLitres = "" Or Me.AverageLitres = 0 Then
7223              Me.AverageLitres.BorderColor = RGB(255, 0, 0)
7224          Else
7225              Me.AverageLitres.BorderColor = RGB(128, 128, 128)
7226          End If
7227      End If

7228      If Me.ProductCode.Value = "TRL" Or _
              Me.ProductCode.Value = "TRM" Or _
              Me.ProductCode.Value = "TRN" Or _
              Me.ProductCode.Value = "TRS" Then
          
7230          If Me.MaxHeight = "" Or Me.MaxHeight = 0 Then
7240              Me.MaxHeight.Value = 35.3
7250          Else
7260              Me.MaxHeight.BorderColor = RGB(128, 128, 128)
7270          End If
              
7280          If Me.MaxWidth = "" Or Me.MaxWidth = 0 Then
7290              Me.MaxWidth.Value = 25
7300          Else
7310              Me.MaxWidth.BorderColor = RGB(128, 128, 128)
7320          End If
              
7330          If Me.MaxLength = "" Or Me.MaxLength = 0 Then
7331              Me.MaxLength.Value = 2.5
7332          Else
7333              Me.MaxLength.BorderColor = RGB(128, 128, 128)
7334          End If

7335          If Me.MaxWeight = "" Or Me.MaxWeight = 0 Then
7336              Me.MaxWeight.Value = 1000
7337          Else
7338          End If
    
7340      Else

7241          If Me.MaxHeight = "" Or Me.MaxHeight = 0 Then
7242              Me.MaxHeight.Value = 61
7243          Else
7244              Me.MaxHeight.BorderColor = RGB(128, 128, 128)
7245          End If
              
7246          If Me.MaxWidth = "" Or Me.MaxWidth = 0 Then
7247              Me.MaxWidth.Value = 46
7348          Else
7349              Me.MaxWidth.BorderColor = RGB(128, 128, 128)
7350          End If
              
7351          If Me.MaxLength = "" Or Me.MaxLength = 0 Then
7352              Me.MaxLength.Value = 46
7353          Else
7354              Me.MaxLength.BorderColor = RGB(128, 128, 128)
7355          End If

7356          If Me.MaxWeight = "" Or Me.MaxWeight = 0 Then
7357              Me.MaxWeight.Value = 30000
7358          Else
7359          End If


7370      End If
          
7380  Else
7390      Me.AverageHeight.BorderColor = RGB(128, 128, 128)
7400      Me.AverageWidth.BorderColor = RGB(128, 128, 128)
7410      Me.AverageLength.BorderColor = RGB(128, 128, 128)
7420      Me.MaxHeight.BorderColor = RGB(128, 128, 128)
7430      Me.MaxWidth.BorderColor = RGB(128, 128, 128)
7440      Me.MaxLength.BorderColor = RGB(128, 128, 128)
7441      Me.AverageLitres.BorderColor = RGB(128, 128, 128)
7450  End If

7451 If Me.ProductCode = "BPK" Or Me.ProductCode = "BPM" Then
7452    Me.FrequencyCombo.Visible = True
7453    Me.CountryCombo.Visible = True
7454    Me.FreqTitle.Visible = True
7455    Me.CountryTitle.Visible = True
7456    Me.ServiceTitle.Visible = True
7457    Me.ServiceCombo.Visible = True
7458    If Me.ProductCode = "BPK" Then
7459        Me.CountryCombo = "Australia"
7460        Me.ServiceCombo = "INRE"
7461        Me.FrequencyCombo.Value = ""
7462        Me.FrequencyCombo.Visible = False
7463        Me.FreqTitle.Visible = False
7464    End If
7465    If Me.ProductCode = "BPM" Then
7466        Me.CountryCombo = "United States"
7467        Me.ServiceCombo = "INPU"
7468    End If
7469 Else
7470    Me.FrequencyCombo.Value = ""
7471    Me.CountryCombo.Value = ""
7472    Me.ServiceCombo = ""
7473    Me.FreqTitle.Visible = False
7474    Me.CountryTitle.Visible = False
7475    Me.FrequencyCombo.Visible = False
7476    Me.CountryCombo.Visible = False
7477    Me.ServiceTitle.Visible = False
7478    Me.ServiceCombo.Visible = False
7479 End If

7480 LitresTo

7481  Exit Sub
error_proc:
7482      If MsgBox("Error has occured with subroutine [InputBorderCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
7483      ShutDown

End Sub
Sub ClassCheck(CodeCount As Integer)
      Dim ClassChoice As String
7490  On Error GoTo error_proc

      'Check what sort of class(es) are valid for this product, and set data validation accordingly
7500  ClassChoice = Range("ProductClass.List").Cells(CodeCount, 1).Value

7510  Select Case ClassChoice
          Case "1"
7520          Me.Class.List = Array(Range("list.Class").Cells(2, 1))
7530          Me.Class = Range("list.Class").Cells(2, 1).Value
7540      Case "2"
7550          Me.Class.List = Array(Range("list.Class").Cells(3, 1))
7560          Me.Class = Range("list.Class").Cells(3, 1).Value
7570      Case "1+2"
7580          Me.Class.List = Array(Range("list.Class").Cells(4, 1))
7590          Me.Class = Range("list.Class").Cells(4, 1).Value
7600      Case "1or2"
7610          Me.Class.List = Range("list.ClassMini").Value
7620          If Me.Class = "" Then Me.Class = Range("List.ClassMini").Cells(1, 1).Value
7630      Case "Economy"
7640          Me.Class.List = Array(Range("list.Class").Cells(5, 1))
7650          Me.Class = Range("list.Class").Cells(5, 1).Value
7660      Case "Priority"
7670          Me.Class.List = Array(Range("list.Class").Cells(6, 1))
7680          Me.Class = Range("list.Class").Cells(6, 1).Value
7690      Case "Int"
7700          Me.Class.List = Array(Range("list.Class").Cells(7, 1))
7710          Me.Class = Range("list.Class").Cells(7, 1).Value
7720      Case "Fee"
7730          Me.Class.List = Array(Range("list.Class").Cells(8, 1))
7740          Me.Class = Range("list.Class").Cells(8, 1).Value
7750      Case "STD"
7760          Me.Class.List = Array(Range("list.Class").Cells(8, 1))
7770          Me.Class = Range("list.Class").Cells(8, 1).Value
7780      Case "Bespoke"
7790          Me.Class.List = Range("list.Class").Value
7800          If Me.Class = "" Then Me.Class = Range("list.Class").Cells(1, 1).Value
7810      Case "REMOVE"
7820          Me.Class.List = Array(Range("list.Class").Cells(8, 1))
7830          Me.Class = Range("list.Class").Cells(8, 1).Value
7840      Case "Int Returns"
7850          Me.Class.List = Range("list.Class").Value
7860          If Me.Class = "" Then Me.Class = Range("list.Class").Cells(1, 1).Value
7870      Case "Returns"
7880          Me.Class.List = Array(Range("list.Class").Cells(8, 1))
7890          Me.Class = Range("list.Class").Cells(8, 1).Value
7900  End Select
7910  Exit Sub
error_proc:
7920      If MsgBox("Error has occured with subroutine [ClassCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
7930      ShutDown

End Sub
Sub DedicatedPricingCheck()
      'Check if it requires dedicated pricing or not
7940  On Error GoTo error_proc
7950  DedicatedPricingFlag = False
7960  If Range("CHK.NewCustomerSetup") Or Range("CHK.NewAccountExistingCust") Or Range("CHK.AccountAddOn") Then
7970      For Each OneCell In Range("DedicatedPricing.List")
7980          If Me.ProductCode = OneCell.Value Then
7990              DedicatedPricingFlag = True
8000          End If
8010      Next OneCell
8020  End If
              
8030  If DedicatedPricingFlag = True Then
          'Turn on dedicated pricing boxes
8040      Me.LargeLetters.Visible = True
8050      Me.Parcels.Visible = True
8060      Me.Combined.Visible = True
8070      Me.LargeLettersLabel.Visible = True
8080      Me.ParcelsLabel.Visible = True
8090      Me.CombinedLabel.Visible = True
8100  Else
          'Turn off dedicated pricing boxes
8110      Me.LargeLetters.Visible = False
8120      Me.Parcels.Visible = False
8130      Me.Combined.Visible = False
8140      Me.LargeLettersLabel.Visible = False
8150      Me.ParcelsLabel.Visible = False
8160      Me.CombinedLabel.Visible = False
8170  End If
8180  Exit Sub
error_proc:
8190      If MsgBox("Error has occured with subroutine [DedicatedPricingCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8200      ShutDown
End Sub
Sub AgreedRateCheck()
      'Is an agreed rate and a calculator rate necessary?
8210  On Error GoTo error_proc
8220  AgreedRateFlag = False
8230  For Each OneCell In Range("AgreedRate.List")
8240      If Me.ProductCode.Value = OneCell.Value Then AgreedRateFlag = True
8250  Next OneCell

8260  If AgreedRateFlag = True Then
          'Turn on agreed rate and rate card rate boxes
8270      Me.AgreedRate.Visible = True
8280      Me.CalculatorRate.Visible = True
8290      Me.AgreedRateLabel.Visible = True
8300      Me.CalculatorRateLabel.Visible = True
8310  Else
          'Turn off agreed rate and rate card rate boxes
8320      Me.AgreedRate.Visible = False
8330      Me.CalculatorRate.Visible = False
8340      Me.AgreedRateLabel.Visible = False
8350      Me.CalculatorRateLabel.Visible = False
8360  End If
8370  Exit Sub
error_proc:
8380      If MsgBox("Error has occured with subroutine [AgreedRateCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8390      ShutDown
End Sub
Sub DimensionsCheck()
      'Are product dimensions necessary?
8400  On Error GoTo error_proc
8410  DimensionsFlag = False
8420  For Each OneCell In Range("Dimensions.List")
8430      If Me.ProductCode.Value = OneCell.Value Then DimensionsFlag = True
8440  Next OneCell
8450  Exit Sub
error_proc:
8460      If MsgBox("Error has occured with subroutine [DimensionsCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8470      ShutDown

End Sub
Sub WeightCheck()
      'Is product weight necessary?
8480  On Error GoTo error_proc
8490  WeightFlag = False
8500  For Each OneCell In Range("Weight.List")
8510      If Me.ProductCode.Value = OneCell.Value Then WeightFlag = True
8520  Next OneCell
8530  Exit Sub
error_proc:
8540      If MsgBox("Error has occured with subroutine [WeightCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8550      ShutDown
End Sub
Sub BMACheck()
8560  On Error GoTo error_proc
      'Is product a BMA product that requires average weight?
8570  BMAFlag = False
8580  For Each OneCell In Range("BMA.List")
8590      If Me.ProductCode.Value = OneCell.Value Then BMAFlag = True
8600  Next OneCell
8610  Exit Sub
error_proc:
8620      If MsgBox("Error has occured with subroutine [BMACheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8630      ShutDown
End Sub
Sub InternationalCheck()
8640  On Error GoTo error_proc
      'Is product an open product that does not require annual volumes?
8650  InternationalFlag = False
8660  For Each OneCell In Range("International.List")
8670      If Me.ProductCode.Value = OneCell.Value Then InternationalFlag = True
8680  Next OneCell
8690  Exit Sub
error_proc:
8700      If MsgBox("Error has occured with subroutine [InternationalCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8710      ShutDown
End Sub

Sub CNCheck()
8720  On Error GoTo error_proc
      'Is product an international product?
8730  CNFlag = False
8740  For Each OneCell In Range("ContractNumber.List")
8750      If Me.ProductCode.Value = OneCell.Value Then CNFlag = True
8760  Next OneCell
8770  Exit Sub
error_proc:
8780      If MsgBox("Error has occured with subroutine [CNCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8790      ShutDown
End Sub
Sub FillInForm()
      'Loads up the Excel worksheet 'Form' with what's been entered
      Dim Counter As Integer
      Dim OneCell As Range
8800  On Error GoTo error_proc

      'Firstly convert product code into code and description for form
8810  Counter = 1
8820  For Each OneCell In Range("ProductCode.List")
8830      If Me.ProductCode = OneCell.Value Then
8840          ProductDescrp = Range("list.Products").Cells(Counter, 1).Value
8850      End If
8860      Counter = Counter + 1
8870  Next OneCell

      'PRODUCT CODE
8880  Form.Cells(ProductRow, ProductCol).Value = ProductDescrp
8890  If ProductDescrp = "" Then Form.Cells(ProductRow, ProductCol).Value = ""
      'CLASS
8900  Form.Cells(ProductRow, Range("PRO.Class").Column).Value = Me.Class.Value
8910  If Me.Class.Value = "" Then Form.Cells(ProductRow, Range("PRO.Class").Column).Value = ""
      'Forecast annual volume
8920  Form.Cells(ProductRow, Range("PRO.AnnualVolume").Column).Value = Me.AnnualVolume.Value
8930  If Me.AnnualVolume.Value = "" Then Form.Cells(ProductRow, Range("PRO.AnnualVolume").Column).Value = ""

8940  If AgreedRateFlag = True Then
          'Calculator Rate (|fffd|)
8950      Form.Cells(ProductRow, Range("PRO.CalcRate").Column).Value = Me.CalculatorRate.Value
8960      If Me.CalculatorRate.Value = "" Then Form.Cells(ProductRow, Range("PRO.CalcRate").Column).Value = ""
          'Agreed Rate (|fffd|)
8970      Form.Cells(ProductRow, Range("PRO.AgreedRate").Column).Value = Me.AgreedRate.Value
8980      If Me.AgreedRate.Value = "" Then Form.Cells(ProductRow, Range("PRO.AgreedRate").Column).Value = ""
8990  Else
9000      Form.Cells(ProductRow, Range("PRO.CalcRate").Column).Value = ""
9010      Form.Cells(ProductRow, Range("PRO.AgreedRate").Column).Value = ""
9020  End If

9030  If DedicatedPricingFlag = True Then
      'Large Letters Price
9040      Form.Cells(ProductRow, Range("PRO.LargeLetters").Column).Value = Me.LargeLetters.Value
9050      If Me.LargeLetters.Value = "" Then Form.Cells(ProductRow, Range("PRO.LargeLetters").Column).Value = ""
          'Parcels Price
9060      Form.Cells(ProductRow, Range("PRO.Parcels").Column).Value = Me.Parcels.Value
9070      If Me.Parcels.Value = "" Then Form.Cells(ProductRow, Range("PRO.Parcels").Column).Value = ""
          'Combined Price
9080      Form.Cells(ProductRow, Range("PRO.Combined").Column).Value = Me.Combined.Value
9090      If Me.Combined.Value = "" Then Form.Cells(ProductRow, Range("PRO.Combined").Column).Value = ""
9100  Else
9110      Form.Cells(ProductRow, Range("PRO.LargeLetters").Column).Value = ""
9120      Form.Cells(ProductRow, Range("PRO.Parcels").Column).Value = ""
9130      Form.Cells(ProductRow, Range("PRO.Combined").Column).Value = ""
9140  End If

      'Accreditation Required
9150  Form.Cells(ProductRow, Range("PRO.AccRequired").Column).Value = Me.Accreditation.Value
9160  If Me.Accreditation.Value = "" Then Form.Cells(ProductRow, Range("PRO.AccRequired").Column).Value = ""
      'Presstream Periodical Code
9170  Form.Cells(ProductRow, Range("PRO.PubCode").Column).Value = Me.PeriodicalCode.Value
9180  If Me.PeriodicalCode.Value = "" Then Form.Cells(ProductRow, Range("PRO.PubCode").Column).Value = ""
      'Where presstream add periodic title
9190  Form.Cells(ProductRow, Range("PRO.PubTitle").Column).Value = Me.PeriodicalTitle.Value
9200  If Me.PeriodicalTitle.Value = "" Then Form.Cells(ProductRow, Range("PRO.PubTitle").Column).Value = ""

      'If BMAFlag = True Or WeightFlag = True Then
          'Average Weight (g)
9210      Form.Cells(ProductRow, Range("PRO.AvgWeight").Column).Value = Me.AverageWeight.Value
9220      If Me.AverageWeight.Value = "" Then Form.Cells(ProductRow, Range("PRO.AvgWeight").Column).Value = ""
          'Maximum Weight (g)
9230      Form.Cells(ProductRow, Range("PRO.MaxWeight").Column).Value = Me.MaxWeight.Value
9240      If Me.MaxWeight.Value = "" Then Form.Cells(ProductRow, Range("PRO.MaxWeight").Column).Value = ""
      'Else
      '    Form.Cells(ProductRow, Range("PRO.AvgWeight").Column).Value = ""
      '    Form.Cells(ProductRow, Range("PRO.MaxWeight").Column).Value = ""
      'End If

      'If DimensionsFlag = True Then
          'Average Height (cm)
9250      Form.Cells(ProductRow, Range("PRO.AvgHeight").Column).Value = Me.AverageHeight.Value
9260      If Me.AverageHeight.Value = "" Then Form.Cells(ProductRow, Range("PRO.AvgHeight").Column).Value = "Height"
          'Average Width (cm)
9270      Form.Cells(ProductRow, Range("PRO.AvgWidth").Column).Value = Me.AverageWidth.Value
9280      If Me.AverageWidth.Value = "" Then Form.Cells(ProductRow, Range("PRO.AvgWidth").Column).Value = "Width"
          'Average Length (cm)
9290      Form.Cells(ProductRow, Range("PRO.AvgLength").Column).Value = Me.AverageLength.Value
9300      If Me.AverageLength.Value = "" Then Form.Cells(ProductRow, Range("PRO.AvgLength").Column).Value = "Length"
          'Maximum Height (cm)
9310      Form.Cells(ProductRow, Range("PRO.MaxHeight").Column).Value = Me.MaxHeight.Value
9320      If Me.MaxHeight.Value = "" Then Form.Cells(ProductRow, Range("PRO.MaxHeight").Column).Value = "Height"
          'Maximum Width (cm)
9330      Form.Cells(ProductRow, Range("PRO.MaxWidth").Column).Value = Me.MaxWidth.Value
9340      If Me.MaxWidth.Value = "" Then Form.Cells(ProductRow, Range("PRO.MaxWidth").Column).Value = "Width"
          'Maximum Length (cm)
9350      Form.Cells(ProductRow, Range("PRO.MaxLength").Column).Value = Me.MaxLength.Value
9360      If Me.MaxLength.Value = "" Then Form.Cells(ProductRow, Range("PRO.MaxLength").Column).Value = "Length"
      'End If

9370      If Me.Discount.Value <> "" Then Form.Cells(ProductRow, Range("PRO.Discount").Column).Value = Me.Discount.Value
9371      If Me.CountryCombo.Value <> "" Then Form.Cells(ProductRow, Range("Pro.Country").Column).Value = Me.CountryCombo.Value
9372      If Me.FrequencyCombo.Value <> "" Then Form.Cells(ProductRow, Range("Pro.Freq").Column).Value = Me.FrequencyCombo.Value
9373      If Me.ServiceCombo.Value <> "" Then Form.Cells(ProductRow, Range("Pro.Serv").Column).Value = Me.ServiceCombo.Value
      'Set Tier
9380      If Me.TierCombo.Value = "Tier 1" Then
9390          If Me.Imported = True Then
9400              Form.Cells(ProductRow, Range("PRO.Tier").Column).Value = "Tier 1 Imported"
9410          Else
9420              Form.Cells(ProductRow, Range("PRO.Tier").Column).Value = Me.TierCombo.Value
9430          End If
9440      Else
9450          Form.Cells(ProductRow, Range("PRO.Tier").Column).Value = Me.TierCombo.Value
9460      End If
          
9461  If Me.ProductCode.Value = "TPL" Or _
          Me.ProductCode.Value = "TPL" Or _
          Me.ProductCode.Value = "TPM" Or _
          Me.ProductCode.Value = "TPN" Or _
          Me.ProductCode.Value = "TPS" Or _
          Me.ProductCode.Value = "TPA" Or _
          Me.ProductCode.Value = "TPB" Or _
          Me.ProductCode.Value = "TPC" Or _
          Me.ProductCode.Value = "TPD" Or _
          Me.ProductCode.Value = "TRL" Or _
          Me.ProductCode.Value = "TRM" Or _
          Me.ProductCode.Value = "TRN" Or _
          Me.ProductCode.Value = "TRS" _
      Then
9462      Form.Cells(ProductRow, Range("PRO.FTE1").Column).Value = Me.FTE1.Value
9463      Form.Cells(ProductRow, Range("PRO.FTE2").Column).Value = Me.FTE2.Value
9464      Form.Cells(ProductRow, Range("PRO.FTE3").Column).Value = Me.FTE3.Value
9465  End If
      'Suffix/Prefix
9470  Form.Cells(ProductRow, Range("PRO.SuffPre").Column).Value = Me.SuffixPrefix.Value
9480  If Me.SuffixPrefix.Value = "" Then Form.Cells(ProductRow, Range("PRO.SuffPre").Column).Value = ""

      'Replaced by Finance input
      'If ContractFlag = True Then
          'Contract Number
          'Form.Cells(ProductRow, Range("PRO.ContractNo").Column).Value = Me.ContractNumber.Value
          'If Me.ContractNumber.Value = "" Then Form.Cells(ProductRow, Range("PRO.ContractNo").Column).Value = ""
      'Else

      'End If

      'Copy T1 Import Info and cleanup
9490  Sheet23.Range("B3:AI3").Copy Destination:=Sheet23.Range("B" & Form.Cells(ProductRow, Range("PRO.ProductNumber").Column).Value & ":AI" & Form.Cells(ProductRow, Range("PRO.ProductNumber").Column).Value).Offset(3, 0)
9500  Call ImportCleanUp

9501  If Not Form.Range("CHK.OpsAssessment") = True Then
9502    If Me.ProductCode = "TPA" Or _
            Me.ProductCode = "TPB" Or _
            Me.ProductCode = "TPL" Or _
            Me.ProductCode = "TPM" Or _
            Me.ProductCode = "TRL" Or _
            Me.ProductCode = "TRM" _
        Then
9503        Form.Range("CHK.OpsAssessment") = True
9504        MsgBox "Ops Capacity Request has been automatically selected as this is required for High Volume setups regardless of current collection status.", vbInformation, "High Volume Customer Check"
9505    Else
9506    End If
9507  End If


9510  If Not Form.Range("CHK.CollectionSetupChange") = True Then
9511    If Me.ProductCode = "TPA" Or _
            Me.ProductCode = "TPB" Or _
            Me.ProductCode = "TPL" Or _
            Me.ProductCode = "TPM" Or _
            Me.ProductCode = "TRL" Or _
            Me.ProductCode = "TRM" _
        Then
9518        Form.Range("CHK.CollectionSetupChange") = True
9519        MsgBox "Collection setup has been automatically selected as this is required for High Volume setups regardless of current collection status.", vbInformation, "High Volume Customer Check"
9520    Else
9521      If Left(Me.ProductCode, 2) = "TP" Or Left(Me.ProductCode, 2) = "TR" Then
9530          If Form.Range("CHK.NewCustomerSetup") = True Then
9540              Form.Range("CHK.CollectionSetupChange") = True
9550              MsgBox "Collection setup has been automatically selected as this is required for Tracked products.", vbInformation, "Tracked New Customer Check"
9560          Else
9570              If MsgBox("Tracked products require a collection. Do you want to set up a collection? Only select 'No' if the customer has an existing collection in place for the Tracked service.", vbYesNo, "Tracked Add On Collection Check") = vbYes Then
9580                  Form.Range("CHK.CollectionSetupChange") = True
9590                  Else
                      'Do something here to record existing collection
9600              End If
9610          End If
9620      End If
9630    End If
9631  End If

9640  If Me.ProductCode = "TSN" Or Me.ProductCode = "TSS" Then
9650      If Not Form.Range("SHP.TrackedReturns") = True Then
9660          Form.Range("SHP.TrackedReturns") = True
9670          MsgBox "Please complete the Tracked Returns label details.", vbInformation, "Tracked Returns Details"
9680      End If
9690  End If
                 
9700  Exit Sub
error_proc:
9710      If MsgBox("Error has occured with subroutine [FillInForm]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
9720      ShutDown
End Sub

Sub FillInFormUN()
      'Loads up the Excel worksheet 'Form' with what's been entered
      Dim Counter As Integer
      Dim OneCell As Range
      'on error GoTo error_proc

      'Firstly convert product code into code and description for form
9730  Counter = 1
9740  For Each OneCell In Range("ProductCode.List")
9750      If Me.ProductCode = OneCell.Value Then
9760          ProductDescrp = Range("list.Products").Cells(Counter, 1).Value
9770      End If
9780      Counter = Counter + 1
9790  Next OneCell

      'PRODUCT CODE
9800  Form.Cells(ProductRow, ProductCol).Value = ProductDescrp
9810  If ProductDescrp = "" Then Form.Cells(ProductRow, ProductCol).Value = ""
      'CLASS
9820  Form.Cells(ProductRow, Range("PRO.Class").Column).Value = Me.Class.Value
9830  If Me.Class.Value = "" Then Form.Cells(ProductRow, Range("PRO.Class").Column).Value = ""

      'Copy T1 Import Info and cleanup
9840  Sheet23.Range("B3:AI3").Copy Destination:=Sheet23.Range("B" & Form.Cells(ProductRow, Range("PRO.ProductNumber").Column).Value & ":AI" & Form.Cells(ProductRow, Range("PRO.ProductNumber").Column).Value).Offset(3, 0)
9850  Call ImportCleanUp

9860  Exit Sub
error_proc:
9870      If MsgBox("Error has occured with subroutine [FillInFormUN]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
9880      ShutDown
End Sub

Sub CheckDataEntered()
Dim FTETotal As Long
Dim FTEv1 As Long
Dim FTEv2 As Long
Dim FTEv3 As Long
9890  On Error GoTo error_proc

      'BLANK PRODUCT CODE CHECK
9900  If Me.ProductCode.Value = "" Then
9910      Me.ProductCode.BorderColor = RGB(255, 0, 0)
9920      Me.ProductCode.SetFocus
9930      With Me.ProductCode
9940          .SelStart = 0
9950          .SelLength = Len(.text)
9960      End With
9970      MsgBox ("Please select a product to continue")
9980      DataOKFlag = False
9990      Exit Sub
10000 Else
10010     Me.ProductCode.BorderColor = RGB(128, 128, 128)
10020 End If

      'Has a class been entered?
10030 If Me.Class.Value = "" Or Me.Class.Value = "Please select" Then
10040     MsgBox ("Please add the Class for this product to continue")
10050     Me.Class.BorderColor = RGB(255, 0, 0)
10060     Me.Class.SetFocus
10070     DataOKFlag = False
10080     Exit Sub
10090 Else
10100     Me.Class.BorderColor = RGB(128, 128, 128)
10110 End If

      'Is an Annual Volume necessary? i.e. Product is NOT an international product
10120 Call InternationalCheck

      'If necessary, has an annual volume been entered?
10130 If InternationalFlag = False Then
10140     If Me.AnnualVolume.Value = "" Or Me.AnnualVolume.Value = 0 Then
10150         MsgBox ("Please add the Annual Volume for this product to continue")
10160         Me.AnnualVolume.BorderColor = RGB(255, 0, 0)
10170         Me.AnnualVolume.SetFocus
10180         Me.AnnualVolume.Value = ""
10190         DataOKFlag = False
10200         Exit Sub
10210     Else
10220         Me.AnnualVolume.BorderColor = RGB(128, 128, 128)
10230     End If
10240 Else
10250     Me.AnnualVolume.BorderColor = RGB(128, 128, 128)
10260 End If

      'Is an agreed rate and a calculator rate necessary?
10270 Call AgreedRateCheck

      'If necessary, has a calculator rate and an agreed rate been entered?
10280 If AgreedRateFlag = True Then
10290     If Me.CalculatorRate.Value = "" Or Me.CalculatorRate.Value = 0 Then
10300         MsgBox ("Please add the Calculator Rate for this product to continue")
10310         Me.CalculatorRate.BorderColor = RGB(255, 0, 0)
10320         Me.CalculatorRate.SetFocus
10330         Me.CalculatorRate.Value = ""
10340         DataOKFlag = False
10350         Exit Sub
10360     Else
10370         Me.CalculatorRate.BorderColor = RGB(128, 128, 128)
10380     End If

10390     If Me.AgreedRate.Value = "" Or Me.AgreedRate.Value = 0 Then
10400         MsgBox ("Please add the Agreed Rate for this product to continue")
10410         Me.AgreedRate.BorderColor = RGB(255, 0, 0)
10420         Me.AgreedRate.SetFocus
10430         Me.AgreedRate.Value = ""
10440         DataOKFlag = False
10450         Exit Sub
10460     Else
10470         Me.AgreedRate.BorderColor = RGB(128, 128, 128)
10480     End If
10490 End If

      'Does it require dedicated pricing?
10500 Call DedicatedPricingCheck

10510 If DedicatedPricingFlag = True Then
10520     If Me.LargeLetters.Value = "" Or Me.LargeLetters.Value = 0 Then
10530         MsgBox ("Please add the Large Letters price for this product to continue")
10540         Me.LargeLetters.BorderColor = RGB(255, 0, 0)
10550         Me.LargeLetters.SetFocus
10560         Me.LargeLetters.Value = ""
10570         DataOKFlag = False
10580         Exit Sub
10590     Else
10600         Me.LargeLetters.BorderColor = RGB(128, 128, 128)
10610     End If

10620     If Me.Parcels.Value = "" Or Me.Parcels.Value = 0 Then
10630         MsgBox ("Please add the Parcels price for this product to continue")
10640         Me.Parcels.BorderColor = RGB(255, 0, 0)
10650         Me.Parcels.SetFocus
10660         Me.Parcels.Value = ""
10670         DataOKFlag = False
10680         Exit Sub
10690     Else
10700         Me.Parcels.BorderColor = RGB(128, 128, 128)
10710     End If

10720     If Me.Combined.Value = "" Or Me.Combined.Value = 0 Then
10730         MsgBox ("Please add the Combined price for this product to continue")
10740         Me.Combined.BorderColor = RGB(255, 0, 0)
10750         Me.Combined.SetFocus
10760         Me.Combined.Value = ""
10770         DataOKFlag = False
10780         Exit Sub
10790     Else
10800         Me.Combined.BorderColor = RGB(128, 128, 128)
10810     End If
10820 End If

      'Are product dimensions necessary?
10830 Call BMACheck
10840 Call WeightCheck

10850 If BMAFlag = True Or WeightFlag = True Then
          'Has an average weight been entered?
10860     If Me.AverageWeight.Value = "" Or Me.AverageWeight.Value = 0 Then
10870         MsgBox ("Please add the Average Weight for this product to continue")
10880         Me.AverageWeight.BorderColor = RGB(255, 0, 0)
10890         Me.AverageWeight.SetFocus
10900         Me.AverageWeight.Value = ""
10910         DataOKFlag = False
10920         Exit Sub
10930     Else
10940         Me.AverageWeight.BorderColor = RGB(128, 128, 128)
10950     End If
          
          'Has an Maximum weight been entered?
      '    If Me.MaxWeight.Value = "" Or Me.MaxWeight.Value = 0 Then
      '        MsgBox ("Please add the Max Weight for this product to continue")
      '        Me.MaxWeight.BorderColor = RGB(255, 0, 0)
      '        Me.MaxWeight.SetFocus
      '        Me.MaxWeight.Value = ""
      '        DataOKFlag = False
      '        Exit Sub
      '    Else
      '        Me.MaxWeight.BorderColor = RGB(128, 128, 128)
      '    End If
10960 End If

10970 Call DimensionsCheck
10980 If DimensionsFlag = True Then
          'Has an average Height been entered?
10990     If Me.AverageHeight.Value = "" Or Me.AverageHeight.Value = 0 Then
11000         MsgBox ("Please add the Average Height for this product to continue")
11010         Me.AverageHeight.BorderColor = RGB(255, 0, 0)
11020         Me.AverageHeight.SetFocus
11030         Me.AverageHeight.Value = ""
11040         DataOKFlag = False
11050         Exit Sub
11060     Else
11070         Me.AverageHeight.BorderColor = RGB(128, 128, 128)
11080     End If

          'Has an average Width been entered?
11090     If Me.AverageWidth.Value = "" Or Me.AverageWidth.Value = 0 Then
11100         MsgBox ("Please add the Average Width for this product to continue")
11110         Me.AverageWidth.BorderColor = RGB(255, 0, 0)
11120         Me.AverageWidth.SetFocus
11130         Me.AverageWidth.Value = ""
11140         DataOKFlag = False
11150         Exit Sub
11160     Else
11170         Me.AverageWidth.BorderColor = RGB(128, 128, 128)
11180     End If
          
          'Has an average Length been entered?
11190     If Me.AverageLength.Value = "" Or Me.AverageLength.Value = 0 Then
11200         MsgBox ("Please add the Average Length for this product to continue")
11210         Me.AverageLength.BorderColor = RGB(255, 0, 0)
11220         Me.AverageLength.SetFocus
11230         Me.AverageLength.Value = ""
11240         DataOKFlag = False
11250         Exit Sub
11260     Else
11270         Me.AverageLength.BorderColor = RGB(128, 128, 128)
11280     End If
          
          'Has an Maximum Height been entered?
11290     If Me.MaxHeight.Value = "" Or Me.MaxHeight.Value = 0 Then
11300         MsgBox ("Please add the Max Height for this product to continue")
11310         Me.MaxHeight.BorderColor = RGB(255, 0, 0)
11320         Me.MaxHeight.SetFocus
11330         Me.MaxHeight.Value = ""
11340         DataOKFlag = False
11350         Exit Sub
11360     Else
11370         Me.MaxHeight.BorderColor = RGB(128, 128, 128)
11380     End If
          
          'Has an Maximum Width been entered?
11390     If Me.MaxWidth.Value = "" Or Me.MaxWidth.Value = 0 Then
11400         MsgBox ("Please add the Max Width for this product to continue")
11410         Me.MaxWidth.BorderColor = RGB(255, 0, 0)
11420         Me.MaxWidth.SetFocus
11430         Me.MaxWidth.Value = ""
11440         DataOKFlag = False
11450         Exit Sub
11460     Else
11470         Me.MaxWidth.BorderColor = RGB(128, 128, 128)
11480     End If
          
          'Has an Maximum Length been entered?
11490     If Me.MaxLength.Value = "" Or Me.MaxLength.Value = 0 Then
11500         MsgBox ("Please add the Max Length for this product to continue")
11510         Me.MaxLength.BorderColor = RGB(255, 0, 0)
11520         Me.MaxLength.SetFocus
11530         Me.MaxLength.Value = ""
11540         DataOKFlag = False
11550         Exit Sub
11560     Else
11570         Me.MaxLength.BorderColor = RGB(128, 128, 128)
11580     End If
11590 End If

11600 If Me.ProductCode.Value = "TPL" Or _
          Me.ProductCode.Value = "TPL" Or _
          Me.ProductCode.Value = "TPM" Or _
          Me.ProductCode.Value = "TPN" Or _
          Me.ProductCode.Value = "TPS" Or _
          Me.ProductCode.Value = "TPA" Or _
          Me.ProductCode.Value = "TPB" Or _
          Me.ProductCode.Value = "TPC" Or _
          Me.ProductCode.Value = "TPD" Or _
          Me.ProductCode.Value = "TRL" Or _
          Me.ProductCode.Value = "TRM" Or _
          Me.ProductCode.Value = "TRN" Or _
          Me.ProductCode.Value = "TRS" _
      Then
11610     If Me.TierCombo.Value = "" Then
11620         MsgBox ("Please add the Pricing Tier for this product to continue")
11630         Me.TierCombo.BorderColor = RGB(255, 0, 0)
11640         Me.TierCombo.Value = ""
11650         DataOKFlag = False
11660         Exit Sub
11670     Else
11680         Me.TierCombo.BorderColor = RGB(128, 128, 128)
11690     End If

11691   If IsNumeric(Me.FTE1.Value) Then FTEv1 = Me.FTE1.Value Else FTEv1 = 0
11692   If IsNumeric(Me.FTE2.Value) Then FTEv2 = Me.FTE2.Value Else FTEv2 = 0
11693   If IsNumeric(Me.FTE3.Value) Then FTEv3 = Me.FTE3.Value Else FTEv3 = 0

11694   FTETotal = (FTEv1 + FTEv2 + FTEv3)
11695   If FTETotal <> 100 Then
11696       DataOKFlag = False
11697       MsgBox ("Please enter correct FTE values to continue.")
11698   End If
11700 End If

11710 Exit Sub
error_proc:
11720     If MsgBox("Error has occured with subroutine [CheckDataEntered]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
11730     ShutDown
End Sub
Private Function hasNumeric(ByVal control As MSForms.control) As Boolean
11740 On Error GoTo errHandle
          Dim tmp As Double
11750     tmp = CDbl(control.Value)
11760     If InStr(control.Value, "+") = 0 And InStr(control.Value, "-") = 0 Then
11770         hasNumeric = True
11780     Else
11790         hasNumeric = False
11800     End If
11810 Exit Function
errHandle:
11820     control.SetFocus
11830     hasNumeric = False
End Function
Private Sub AnnualVolume_Change()
      'Permit only numerical entries (key press is undone otherwise)
11840 On Error GoTo error_proc
11850 If Me.AnnualVolume <> "" Then
11860     If Not hasNumeric(Me.AnnualVolume) Then
11870         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
11880         If Len(Me.AnnualVolume.text) > 0 Then Me.AnnualVolume.text = Left(Me.AnnualVolume.text, Len(Me.AnnualVolume.text) - 1)
11890     End If
11900 End If
11910 Exit Sub
error_proc:
11920     If MsgBox("Error has occured with subroutine [AnnualVolumeChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
11930     ShutDown

End Sub
Private Sub CalculatorRate_Change()
      'Permit only numerical entries (key press is undone otherwise)
11940 On Error GoTo error_proc
11950 If Me.CalculatorRate <> "" Then
11960     If Not hasNumeric(Me.CalculatorRate) Then
11970         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
11980         If Len(Me.CalculatorRate.text) > 0 Then Me.CalculatorRate.text = Left(Me.CalculatorRate.text, Len(Me.CalculatorRate.text) - 1)
11990     End If
12000 End If
12010 Exit Sub
error_proc:
12020     If MsgBox("Error has occured with subroutine [CalcRateChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12030     ShutDown
End Sub
Private Sub AgreedRate_Change()

      'Permit only numerical entries (key press is undone otherwise)
12040 On Error GoTo error_proc
12050 If Me.AgreedRate <> "" Then
12060     If Not hasNumeric(Me.AgreedRate) Then
12070         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12080         If Len(Me.AgreedRate.text) > 0 Then Me.AgreedRate.text = Left(Me.AgreedRate.text, Len(Me.AgreedRate.text) - 1)
12090     End If
12100 End If
          
12110 Exit Sub
error_proc:
12120     If MsgBox("Error has occured with subroutine [AgreedRateChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12130     ShutDown

End Sub
Private Sub AverageHeight_Change()
12140 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12150 If Me.AverageHeight <> "" Then
12160     If Not hasNumeric(Me.AverageHeight) Then
12170         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12180         If Len(Me.AverageHeight.text) > 0 Then Me.AverageHeight.text = Left(Me.AverageHeight.text, Len(Me.AverageHeight.text) - 1)
12190     End If
12200 End If
12210 Exit Sub
error_proc:
12220     If MsgBox("Error has occured with subroutine [AvgHeightChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12230     ShutDown

End Sub
Private Sub AverageWidth_Change()
12240 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12250 If Me.AverageWidth <> "" Then
12260     If Not hasNumeric(Me.AverageWidth) Then
12270         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12280         If Len(Me.AverageWidth.text) > 0 Then Me.AverageWidth.text = Left(Me.AverageWidth.text, Len(Me.AverageWidth.text) - 1)
12290     End If
12300 End If
12310 Exit Sub
error_proc:
12320     If MsgBox("Error has occured with subroutine [AvgWidthChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12330     ShutDown

End Sub
Private Sub AverageLength_Change()
      'Permit only numerical entries (key press is undone otherwise)
12340 On Error GoTo error_proc
12350 If Me.AverageLength <> "" Then
12360     If Not hasNumeric(Me.AverageLength) Then
12370         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12380         If Len(Me.AverageLength.text) > 0 Then Me.AverageLength.text = Left(Me.AverageLength.text, Len(Me.AverageLength.text) - 1)
12390     End If
12400 End If
12410 Exit Sub
error_proc:
12420     If MsgBox("Error has occured with subroutine [AvgLengthChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12430     ShutDown
End Sub
Private Sub AverageWeight_Change()
      'Permit only numerical entries (key press is undone otherwise)
12440 On Error GoTo error_proc
12450 If Me.AverageWeight <> "" Then
12460     If Not hasNumeric(Me.AverageWeight) Then
12470         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12480         If Len(Me.AverageWeight.text) > 0 Then Me.AverageWeight.text = Left(Me.AverageWeight.text, Len(Me.AverageWeight.text) - 1)
12490     End If

12500 End If
12510 Exit Sub
error_proc:
12520     If MsgBox("Error has occured with subroutine [AvgWeightChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12530     ShutDown
End Sub
Private Sub MaxHeight_Change()
12540 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12550 If Me.MaxHeight <> "" Then
12560     If Not hasNumeric(Me.MaxHeight) Then
12570         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12580         If Len(Me.MaxHeight.text) > 0 Then Me.MaxHeight.text = Left(Me.MaxHeight.text, Len(Me.MaxHeight.text) - 1)
12590     End If
12600 End If
12610 Exit Sub
error_proc:
12620     If MsgBox("Error has occured with subroutine [MaxHeightChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12630     ShutDown
End Sub
Private Sub MaxWidth_Change()
12640 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12650 If Me.MaxWidth <> "" Then
12660     If Not hasNumeric(Me.MaxWidth) Then
12670         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12680         If Len(Me.MaxWidth.text) > 0 Then Me.MaxWidth.text = Left(Me.MaxWidth.text, Len(Me.MaxWidth.text) - 1)
12690     End If
12700 End If
12710 Exit Sub
error_proc:
12720     If MsgBox("Error has occured with subroutine [MaxWidthChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12730     ShutDown

End Sub
Private Sub MaxLength_Change()
12740 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12750 If Me.MaxLength <> "" Then
12760     If Not hasNumeric(Me.MaxLength) Then
12770         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12780         If Len(Me.MaxLength.text) > 0 Then Me.MaxLength.text = Left(Me.MaxLength.text, Len(Me.MaxLength.text) - 1)
12790     End If
12800 End If
12810 Exit Sub
error_proc:
12820     If MsgBox("Error has occured with subroutine [MaxLengthChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12830     ShutDown

End Sub
Private Sub MaxWeight_Change()
12840 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12850 If Me.MaxWeight <> "" Then
12860     If Not hasNumeric(Me.MaxWeight) Then
12870         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12880         If Len(Me.MaxWeight.text) > 0 Then Me.MaxWeight.text = Left(Me.MaxWeight.text, Len(Me.MaxWeight.text) - 1)
12890     End If
12900 End If
12910 Exit Sub
error_proc:
12920     If MsgBox("Error has occured with subroutine [MaxWeightChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12930     ShutDown
End Sub
Private Sub LargeLetters_Change()
12940 On Error GoTo error_proc
      'Permit only numerical entries (key press is undone otherwise)
12950 If Me.LargeLetters <> "" Then
12960     If Not hasNumeric(Me.LargeLetters) Then
12970         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
12980         If Len(Me.LargeLetters.text) > 0 Then Me.LargeLetters.text = Left(Me.LargeLetters.text, Len(Me.LargeLetters.text) - 1)
12990     End If
13000 End If
13010 Exit Sub
error_proc:
13020     If MsgBox("Error has occured with subroutine [LargeLettersChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13030     ShutDown
End Sub
Private Sub Parcels_Change()
      'Permit only numerical entries (key press is undone otherwise)
13040 On Error GoTo error_proc
13050 If Me.Parcels <> "" Then
13060     If Not hasNumeric(Me.Parcels) Then
13070         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
13080         If Len(Me.Parcels.text) > 0 Then Me.Parcels.text = Left(Me.Parcels.text, Len(Me.Parcels.text) - 1)
13090     End If
13100 End If
13110 Exit Sub
error_proc:
13120     If MsgBox("Error has occured with subroutine [Parcels_Change]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13130     ShutDown

End Sub
Private Sub Combined_Change()
      'Permit only numerical entries (key press is undone otherwise)
13140 On Error GoTo error_proc
13150 If Me.Combined <> "" Then
13160     If Not hasNumeric(Me.Combined) Then
13170         MsgBox "Only enter numbers in this field", vbOKOnly + vbInformation, "Numeric Values Only"
13180         If Len(Me.Combined.text) > 0 Then Me.Combined.text = Left(Me.Combined.text, Len(Me.Combined.text) - 1)
13190     End If
13200 End If
13210 Exit Sub
error_proc:
13220     If MsgBox("Error has occured with subroutine [Combined_Change]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13230     ShutDown

End Sub
Private Sub AnnualVolume_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13240 On Error GoTo error_proc
13250 Call InputBorderCheck
13260 Exit Sub
error_proc:
13270     If MsgBox("Error has occured with subroutine [AnnualVolumeExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13280     ShutDown
End Sub
Private Sub Class_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13290 On Error GoTo error_proc
13300 Call InputBorderCheck
13310 Exit Sub
error_proc:
13320     If MsgBox("Error has occured with subroutine [Class_Exit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13330     ShutDown
End Sub
Private Sub CalculatorRate_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13340 On Error GoTo error_proc
13350 Call InputBorderCheck
13360 Exit Sub
error_proc:
13370     If MsgBox("Error has occured with subroutine [CalculatorRate_Exit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13380     ShutDown
End Sub
Private Sub AgreedRate_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13390 On Error GoTo error_proc
13400 Call InputBorderCheck
13410 Exit Sub
error_proc:
13420     If MsgBox("Error has occured with subroutine [AgreedRateExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13430     ShutDown

End Sub
Private Sub LargeLetters_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13440 On Error GoTo error_proc
13450 Call InputBorderCheck
13460 Exit Sub
error_proc:
13470     If MsgBox("Error has occured with subroutine [LargeLettersExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13480     ShutDown
End Sub
Private Sub Parcels_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13490 On Error GoTo error_proc
13500 Call InputBorderCheck
13510 Exit Sub
error_proc:
13520     If MsgBox("Error has occured with subroutine [ParcelsExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13530     ShutDown
End Sub
Private Sub Combined_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13540 On Error GoTo error_proc
13550 Call InputBorderCheck
13560 Exit Sub
error_proc:
13570     If MsgBox("Error has occured with subroutine [CombinedExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13580     ShutDown
End Sub
Private Sub ContractNumber_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13590 On Error GoTo error_proc
13600 Call InputBorderCheck
13610 Exit Sub
error_proc:
13620     If MsgBox("Error has occured with subroutine [ContractNumberExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13630     ShutDown

End Sub
Private Sub AverageHeight_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13640 On Error GoTo error_proc
13650 Call DimensionsCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
13660 If DimensionsFlag = True Then
13670     If Me.AverageHeight <> "" Then
13680         If Me.AverageHeight.Value < 5 Then
13690             MsgBox "Height less than 5cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Height"
13700         ElseIf Me.AverageHeight.Value > 61 Then
13710             MsgBox "Height more than 61cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Height"
13720         End If
13730         Me.AverageHeight.BorderColor = RGB(128, 128, 128)
13740     ElseIf Me.AverageHeight = "" Or Me.AverageHeight = 0 Then
13750         Me.AverageHeight.BorderColor = RGB(255, 0, 0)
13760     End If
13761 LitresTo
13770 End If
13780 Exit Sub
error_proc:
13790     If MsgBox("Error has occured with subroutine [AvgHeightExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13800     ShutDown
End Sub
Private Sub AverageWidth_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13810 On Error GoTo error_proc
13820 Call DimensionsCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
13830 If DimensionsFlag = True Then
13840     If Me.AverageWidth <> "" Then
13850         If Me.AverageWidth.Value < 5 Then
13860             MsgBox "Width less than 5cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Width"
13870         ElseIf Me.AverageWidth.Value > 46 Then
13880             MsgBox "Width more than 46cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Width"
13890         End If
13900         Me.AverageWidth.BorderColor = RGB(128, 128, 128)
13910     ElseIf Me.AverageWidth = "" Or Me.AverageWidth = 0 Then
13920         Me.AverageWidth.BorderColor = RGB(255, 0, 0)
13930     End If
13931 LitresTo
13940 End If
13950 Exit Sub
error_proc:
13960     If MsgBox("Error has occured with subroutine [AvgWidthExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13970     ShutDown
End Sub
Private Sub AverageLength_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13980 On Error GoTo error_proc
13990 Call DimensionsCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
14000 If DimensionsFlag = True Then
14010     If Me.AverageLength <> "" Then
14020         If Me.AverageLength.Value < 5 Then
14030             MsgBox "Length less than 5cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Length"
14040         ElseIf Me.AverageLength.Value > 46 Then
14050             MsgBox "Length more than 46cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Length"
14060         End If
14070         Me.AverageLength.BorderColor = RGB(128, 128, 128)
14080     ElseIf Me.AverageLength = "" Or Me.AverageLength = 0 Then
14090         Me.AverageLength.BorderColor = RGB(255, 0, 0)
14100     End If
14101 LitresTo
14110 End If
14120 Exit Sub
error_proc:
14130     If MsgBox("Error has occured with subroutine [AvgLengthExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14140     ShutDown

End Sub
Private Sub AverageWeight_Exit(ByVal Cancel As MSForms.ReturnBoolean)
14150 On Error GoTo error_proc
14160 Call BMACheck
14170 Call WeightCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
14180 If BMAFlag = True Or WeightFlag = True Then

14190     If Me.AverageWeight <> "" Then
14191         If Me.AverageWeight.Value > 30000 Then
14210             MsgBox "Weight greater than 30kg has been entered." & vbCr & vbCr _
                  & "This is above the maximum limit.", vbOKOnly, "Unusual Weight"
14211             Me.AverageWeight.Value = 0
14212         ElseIf Me.AverageWeight.Value < 100 Then
14213             MsgBox "Weight less than 100g has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Weight"
14220         ElseIf Me.AverageWeight.Value > 10000 Then
14230             MsgBox "Weight more than 10000g has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Weight"
14240         End If
14250         Me.AverageWeight.BorderColor = RGB(128, 128, 128)
14260     ElseIf Me.AverageWeight = "" Or Me.AverageWeight = 0 Then
14270         Me.AverageWeight.BorderColor = RGB(255, 0, 0)
14280     End If
14290 End If
14300 Exit Sub
error_proc:
14310     If MsgBox("Error has occured with subroutine [AvgWeightExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14320     ShutDown
End Sub
Private Sub MaxHeight_Exit(ByVal Cancel As MSForms.ReturnBoolean)
14330 On Error GoTo error_proc
14340 Call DimensionsCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
14350 If DimensionsFlag = True Then
14360     If Me.MaxHeight <> "" Then
14370         If Me.MaxHeight.Value < 5 Then
14380             MsgBox "Height less than 5cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Height"
14390         ElseIf Me.MaxHeight.Value > 61 Then
14400             MsgBox "Height more than 61cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Height"
14410         End If
14420         Me.MaxHeight.BorderColor = RGB(128, 128, 128)
14430     ElseIf Me.MaxHeight = "" Or Me.MaxHeight = 0 Then
14440         Me.MaxHeight.BorderColor = RGB(255, 0, 0)
14450     End If
14460 End If
14470 Exit Sub
error_proc:
14480     If MsgBox("Error has occured with subroutine [MaxHeightExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14490     ShutDown
End Sub
Private Sub MaxWidth_Exit(ByVal Cancel As MSForms.ReturnBoolean)
14500 On Error GoTo error_proc
14510 Call DimensionsCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
14520 If DimensionsFlag = True Then
14530     If Me.MaxWidth <> "" Then
14540         If Me.MaxWidth.Value < 5 Then
14550             MsgBox "Width less than 5cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Width"
14560         ElseIf Me.MaxWidth.Value > 50 Then
14570             MsgBox "Width more than 50cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Width"
14580         End If
14590         Me.MaxWidth.BorderColor = RGB(128, 128, 128)
14600     ElseIf Me.MaxWidth = "" Or Me.MaxWidth = 0 Then
14610         Me.MaxWidth.BorderColor = RGB(255, 0, 0)
14620     End If
14630 End If
14640 Exit Sub
error_proc:
14650     If MsgBox("Error has occured with subroutine [MaxWidthExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14660     ShutDown

End Sub
Private Sub MaxLength_Exit(ByVal Cancel As MSForms.ReturnBoolean)
14670 On Error GoTo error_proc
14680 Call DimensionsCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
14690 If DimensionsFlag = True Then
14700     If Me.MaxLength <> "" Then
14710         If Me.MaxLength.Value < 5 Then
14720             MsgBox "Length less than 5cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Length"
14730         ElseIf Me.MaxLength.Value > 50 Then
14740             MsgBox "Length more than 50cm has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Length"
14750         End If
14760         Me.MaxLength.BorderColor = RGB(128, 128, 128)
14770     ElseIf Me.MaxLength = "" Or Me.MaxLength = 0 Then
14780         Me.MaxLength.BorderColor = RGB(255, 0, 0)
14790     End If
14800 End If
14810 Exit Sub
error_proc:
14820     If MsgBox("Error has occured with subroutine [MaxLengthExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14830     ShutDown
End Sub
Private Sub MaxWeight_Exit(ByVal Cancel As MSForms.ReturnBoolean)
14840 On Error GoTo error_proc

14850 Call WeightCheck
      'If parcels product, ask the user 'Are you sure?' if the value is less than 5cm or more than 50cm.
14860 If WeightFlag = True Then
14861     If Me.MaxWeight.Value > 30000 Then
14862         MsgBox "Weight greater than 30kg has been entered." & vbCr & vbCr _
              & "This is above the maximum limit.", vbOKOnly, "Unusual Weight"
14863         Me.MaxWeight.Value = 0
14870     ElseIf Me.MaxWeight <> "" Then
14880         If Me.MaxWeight.Value < 100 Then
14890             MsgBox "Weight less than 100g has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Weight"
14900         ElseIf Me.MaxWeight.Value > 20000 Then
14910             MsgBox "Weight more than 20kg has been entered." & vbCr & vbCr _
                  & "Please check that this is correct.", vbOKOnly, "Unusual Weight"
14920         End If
14930         Me.MaxWeight.BorderColor = RGB(128, 128, 128)
14940     ElseIf Me.MaxWeight = "" Or Me.MaxWeight = 0 Then
14950         Me.MaxWeight.BorderColor = RGB(255, 0, 0)
14960     End If
14970 End If
14980 Exit Sub
error_proc:
14990     If MsgBox("Error has occured with subroutine [MaxWeightExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
15000     ShutDown

End Sub

Private Sub FTE1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13810 On Error GoTo error_proc
'13820 Call DimensionsCheck
'13830 If DimensionsFlag = True Then
13840     If Me.FTE1 <> "" Then
13850         If Me.FTE1.Value > 100 Then
13860             MsgBox "Value must be less than 100."
13861             Me.FTE1.Value = ""
13862             Me.FTE1.BorderColor = RGB(255, 0, 0)
13863         Else
13900             Me.FTE1.BorderColor = RGB(128, 128, 128)
13910             If Me.FTE1.Value = "" Then Me.FTE1.BorderColor = RGB(255, 0, 0)
13930         End If
13940     End If
13950 Exit Sub
error_proc:
13960     If MsgBox("Error has occured with subroutine [FTE1Exit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13970     ShutDown
End Sub

Private Sub FTE2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13810 On Error GoTo error_proc
'13820 Call DimensionsCheck
'13830 If DimensionsFlag = True Then
13840     If Me.FTE2 <> "" Then
13850         If Me.FTE2.Value > 100 Then
13860             MsgBox "Value must be less than 100."
13861             Me.FTE2.Value = ""
13862             Me.FTE2.BorderColor = RGB(255, 0, 0)
13863         Else
13900             Me.FTE2.BorderColor = RGB(128, 128, 128)
13910             If Me.FTE2.Value = "" Then Me.FTE2.BorderColor = RGB(255, 0, 0)
13930         End If
13940     End If
13950 Exit Sub
error_proc:
13960     If MsgBox("Error has occured with subroutine [FTE2Exit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13970     ShutDown
End Sub

Private Sub FTE3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
13810 On Error GoTo error_proc
'13820 Call DimensionsCheck
'13830 If DimensionsFlag = True Then
13840     If Me.FTE3 <> "" Then
13850         If Me.FTE3.Value > 100 Then
13860             MsgBox "Value must be less than 100."
13861             Me.FTE3.Value = ""
13862             Me.FTE3.BorderColor = RGB(255, 0, 0)
13863         Else
13900             Me.FTE3.BorderColor = RGB(128, 128, 128)
13910             If Me.FTE3.Value = "" Then Me.FTE3.BorderColor = RGB(255, 0, 0)
13930         End If
13940     End If
13950 Exit Sub
error_proc:
13960     If MsgBox("Error has occured with subroutine [FTE3Exit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13970     ShutDown
End Sub

Private Sub FTE_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim FTETotal As Long
Dim FTEv1 As Long
Dim FTEv2 As Long
Dim FTEv3 As Long
13810 On Error GoTo error_proc
'13820 Call DimensionsCheck
'13830 If DimensionsFlag = True Then
13840     If Me.FTE3 <> "" Then
13850         If Me.FTE3.Value > 100 Then
13860             MsgBox "Value must be less than 100."
13861             Me.FTE3.Value = ""
13862             Me.FTE3.BorderColor = RGB(255, 0, 0)
13863         Else
13908             Me.FTE3.BorderColor = RGB(128, 128, 128)
13909             If Me.FTE3.Value = "" Then Me.FTE3.BorderColor = RGB(255, 0, 0)
13910         End If
19311     End If

13912     If Me.FTE2 <> "" Then
13913         If Me.FTE2.Value > 100 Then
13914             MsgBox "Value must be less than 100."
13915             Me.FTE2.Value = ""
13916             Me.FTE2.BorderColor = RGB(255, 0, 0)
13917         Else
13918             Me.FTE2.BorderColor = RGB(128, 128, 128)
13919             If Me.FTE2.Value = "" Then Me.FTE2.BorderColor = RGB(255, 0, 0)
13920         End If
13921     End If

13923     If Me.FTE1 <> "" Then
13924         If Me.FTE1.Value > 100 Then
13925             MsgBox "Value must be less than 100."
13926             Me.FTE1.Value = ""
13927             Me.FTE1.BorderColor = RGB(255, 0, 0)
13928         Else
13929             Me.FTE1.BorderColor = RGB(128, 128, 128)
13930             If Me.FTE1.Value = "" Then Me.FTE1.BorderColor = RGB(255, 0, 0)
13931         End If
13932     End If

13933   If IsNumeric(Me.FTE1.Value) Then FTEv1 = Me.FTE1.Value Else FTEv1 = 0
13934   If IsNumeric(Me.FTE2.Value) Then FTEv2 = Me.FTE2.Value Else FTEv2 = 0
13935   If IsNumeric(Me.FTE3.Value) Then FTEv3 = Me.FTE3.Value Else FTEv3 = 0

13936   FTETotal = (FTEv1 + FTEv2 + FTEv3)

13937    If FTETotal <> 100 Then
13938            Me.FTE.BorderColor = RGB(255, 0, 0)
13939            Me.FTE.Caption = "Fall to Earth - Must add up to 100"
         Else
13940            Me.FTE.BorderColor = RGB(128, 128, 128)
13941            Me.FTE.Caption = "Fall to Earth"
13942    End If

13970 Exit Sub
error_proc:
13971     If MsgBox("Error has occured with subroutine [FTEExit]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13972     ShutDown
End Sub
Sub TierCheck()
15010 If Me.ProductCode.Value = "TPL" Or _
          Me.ProductCode.Value = "TPL" Or _
          Me.ProductCode.Value = "TPM" Or _
          Me.ProductCode.Value = "TPN" Or _
          Me.ProductCode.Value = "TPS" Or _
          Me.ProductCode.Value = "TPA" Or _
          Me.ProductCode.Value = "TPB" Or _
          Me.ProductCode.Value = "TPC" Or _
          Me.ProductCode.Value = "TPD" Or _
          Me.ProductCode.Value = "TRL" Or _
          Me.ProductCode.Value = "TRM" Or _
          Me.ProductCode.Value = "TRN" Or _
          Me.ProductCode.Value = "TRS" _
      Then
15020     Me.TierCombo.Visible = True
15030     Me.TierCombo.BorderColor = RGB(255, 0, 0)
15040     Me.TierLabel.Visible = True
15050     Me.ImportT1Button.Visible = True
15060     Me.Product.Width = 228
15061     Me.FTE.Visible = True
15062     Me.FTE1.Visible = True
15063     Me.FTE2.Visible = True
15064     Me.FTE3.Visible = True
15065     Me.FTE1.BorderColor = RGB(255, 0, 0)
15066     Me.FTE2.BorderColor = RGB(255, 0, 0)
15067     Me.FTE3.BorderColor = RGB(255, 0, 0)
15168     Me.FTE1Label.Visible = True
15169     Me.FTE2Label.Visible = True
15170     Me.FTE3Label.Visible = True
15071 Else
15080     Me.TierCombo.Visible = False
15090     Me.TierCombo.BorderColor = RGB(128, 128, 128)
15100     Me.TierLabel.Visible = False
15110     Me.ImportT1Button.Visible = False
15120     Me.Product.Width = 288
15121     Me.FTE.Visible = False
15122     Me.FTE1.Visible = False
15123     Me.FTE2.Visible = False
15124     Me.FTE3.Visible = False
15025     Me.FTE1.BorderColor = RGB(128, 128, 128)
15026     Me.FTE2.BorderColor = RGB(128, 128, 128)
15027     Me.FTE3.BorderColor = RGB(128, 128, 128)
15128     Me.FTE1Label.Visible = False
15129     Me.FTE2Label.Visible = False
15130     Me.FTE3Label.Visible = False
15131     Me.FTE1.Value = ""
15132     Me.FTE2.Value = ""
15133     Me.FTE3.Value = ""
15134 End If
End Sub

Sub AddNewProductT2_Click()
      Dim DataRowFlag As Boolean
      Dim ProductSlot As Boolean
      'on error GoTo error_proc
25060  DataOKFlag = True
25070  ProductSlot = False

25080  Call CheckDataEntered
25090  If DataOKFlag = True Then
25100      DataRowFlag = True
25110      For Each OneCell In Range(Range("PRO.Product.1"), Range("PRO.Product.30"))
25120          If DataRowFlag = True And OneCell.Value = 0 Then 'This is the first row without a product
25130              ProductRow = OneCell.Row
25140              ProductSlot = True
25150              GoTo FoundEmptyProduct
25160          End If
25170          DataRowFlag = Not (DataRowFlag)
25180      Next OneCell
FoundEmptyProduct:
25190      If ProductSlot Then
25200          Call FillInForm
25210      Else
25220          MsgBox "Maximum number (30) of product slots on this form have been filled." & vbCr & vbCr _
              & "Please start a fresh form if you wish to add further products.", vbOKOnly, "No More Product Slots Available"
25230      End If
25240      Me.Hide
25250  End If
25260  Exit Sub
error_proc:
25270      If MsgBox("Error has occured with subroutine [AddNewProductT2_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
25280      ShutDown
End Sub

Sub LitresTo()
Dim AvgH As Double
Dim AvgW As Double
Dim AvgD As Double
Dim AvgL As Double

    If IsNumeric(Me.AverageHeight.Value) Then AvgH = Me.AverageHeight.Value Else AvgH = 0
    If IsNumeric(Me.AverageWidth.Value) Then AvgW = Me.AverageWidth.Value Else AvgW = 0
    If IsNumeric(Me.AverageLength.Value) Then AvgD = Me.AverageLength.Value Else AvgD = 0
    If IsNumeric(Me.AverageLitres.Value) Then AvgL = Me.AverageLitres.Value Else AvgL = 0

        If DimensionsFlag = False Then Exit Sub
        
            If ToggleButton1.Value = False Then
                If Me.ProductCode.Value = "TRL" Or _
                    Me.ProductCode.Value = "TRM" Or _
                    Me.ProductCode.Value = "TRN" Or _
                    Me.ProductCode.Value = "TRS" _
                Then
                    AvgD = 25
                    AvgW = 2.5
                    AvgH = (AvgL * 1000) / (AvgW * AvgD)
                Else
                    AvgD = 46
                    AvgW = 46
                    AvgH = (AvgL * 1000) / (AvgW * AvgD)
                End If
                Me.AverageHeight.Value = Round(AvgH, 2)
                Me.AverageWidth.Value = Round(AvgW, 2)
                Me.AverageLength.Value = Round(AvgD, 2)
            Else
                AvgL = (AvgD * AvgW * AvgH) / 1000
                Me.AverageLitres.Value = Round(AvgL, 2)
            End If

    If Me.ProductCode.Value = "TRL" Or _
        Me.ProductCode.Value = "TRM" Or _
        Me.ProductCode.Value = "TRN" Or _
        Me.ProductCode.Value = "TRS" _
    Then
        If AvgL > 2.20265 Then
            MsgBox "Dimensions too big for a letterboxable product. Please correct."
                Me.AverageHeight.Value = 0
                Me.AverageWidth.Value = 0
                Me.AverageLength.Value = 0
                Me.AverageLitres.Value = 0
        End If
    Else
        If AvgL > 129.076 Then
            MsgBox "Dimensions too big for this product. Please correct."
                Me.AverageHeight.Value = 0
                Me.AverageWidth.Value = 0
                Me.AverageLength.Value = 0
                Me.AverageLitres.Value = 0
        End If
    End If
End Sub
Attribute VB_Name = "AddProductForm"
Global ProductRow As Integer
Global ProductCol As Integer
Global DataOKFlag As Boolean
Global NewProductFlag As Boolean

Option Explicit

Sub AddProductSub()
      Dim OneCell As Range
      Dim DataRowFlag As Boolean
      Dim ProductSlot As Boolean
16080 On Error GoTo error_proc
16090 StartUp
16100 NewProductFlag = True

16110 ProductCol = Range("PRO.Product.1").Column
16120 DataRowFlag = True
16130 ProductSlot = False

16140 For Each OneCell In Range(Range("PRO.Product.1"), Range("PRO.Product.30"))
16150     If DataRowFlag = True And OneCell.Value = 0 Then 'This is the first row without a product
16160         ProductRow = OneCell.Row
16170         ProductSlot = True
16180         GoTo FoundEmptyProduct
16190     End If
16200     DataRowFlag = Not (DataRowFlag)
16210 Next OneCell
FoundEmptyProduct:
16220 If ProductSlot Then
16230     Load AddProduct
16240     AddProduct.Show
16250     AddProduct.Hide
16260     Unload AddProduct
16270 Else
16280     MsgBox "Maximum number (30) of product slots on this form have been filled." & vbCr & vbCr _
          & "Please start a fresh form if you wish to add further products.", vbOKOnly, "No More Product Slots Available"
16290 End If

16300 ShowHide
16310 ShutDown
16320 Exit Sub
error_proc:
16330     If MsgBox("Error has occured with subroutine [AddProductSub]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16340     ShutDown
End Sub
Sub EditProductSubroutine(ThisOne As Integer)
16350 On Error GoTo error_proc
16360 StartUp
16370 NewProductFlag = False

16380 ProductRow = Range("PRO.Product." & ThisOne).Row
16390 ProductCol = Range("PRO.Product." & ThisOne).Column
16400 Load AddProduct
'16401 AddProduct.ToggleButton1.Value = True
16410 AddProduct.Show
16420 AddProduct.Hide
16430 Unload AddProduct
16440 ShowHide
16450 ShutDown
16460 Call ProductCodeSummary
16470 Exit Sub
error_proc:
16480     If MsgBox("Error has occured with subroutine [EditProductSubroutine]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16490     ShutDown

End Sub
Sub RemoveProductSubroutine(ThisOne As Integer)
      Dim DeleteRow As Integer
      Dim FirstCol As Integer
      Dim DimCol As Integer
      Dim VolCol As Integer
      Dim CombinedCol As Integer
      Dim DimStart As Range
16500 On Error GoTo error_proc
16510 Form.Unprotect Password:="fruitbasket"
16520 StartUp

16530 DeleteRow = Range("Delete.Product." & ThisOne).Row
16540 FirstCol = Range("PRO.Product." & ThisOne).Column
16550 VolCol = Range("PRO.Volume").Column
16560 DimCol = Range("PRO.AvgHeight").Column
16570 CombinedCol = Range("PRO.Combined").Column

16580 Range(Range("PRO.Product." & ThisOne).address & ":" & Cells(DeleteRow, VolCol - 1).address) = ""
16590 Range(Cells(DeleteRow, VolCol + 2).address & ":" & Cells(DeleteRow, CombinedCol + 5).address) = ""

16600 Set DimStart = Form.Cells(DeleteRow, DimCol)
          
16610 DimStart = "Height"
16620 DimStart.Offset(0, 2) = "Width"
16630 DimStart.Offset(0, 5) = "Length"
16640 DimStart.Offset(0, 8) = "Height"
16650 DimStart.Offset(0, 11) = "Width"
16660 DimStart.Offset(0, 14) = "Length"

16670 Sheet23.Range("B" & ThisOne & ":AI" & ThisOne).Offset(3, 0).ClearContents

16680 Application.Calculate
16690 ShowHideRows
16700 ShutDown
16710 Call ProductCodeSummary
16720 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
16730 Form.EnableSelection = xlNoRestrictions
16740 Exit Sub
error_proc:
16750     If MsgBox("Error has occured with subroutine [RemoveProduct]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16760     ShutDown

End Sub

Sub AddProductSub2()
      Dim OneCell As Range
      Dim DataRowFlag As Boolean
      Dim ProductSlot As Boolean
16770 On Error GoTo error_proc
16780 StartUp
16790 NewProductFlag = True

16800 ProductCol = Range("PRO.Product.1").Column
16810 DataRowFlag = True
16820 ProductSlot = False

16830 For Each OneCell In Range(Range("PRO.Product.1"), Range("PRO.Product.30"))
16840     If DataRowFlag = True And OneCell.Value = 0 Then 'This is the first row without a product
16850         ProductRow = OneCell.Row
16860         ProductSlot = True
16870         GoTo FoundEmptyProduct
16880     End If
16890     DataRowFlag = Not (DataRowFlag)
16900 Next OneCell
FoundEmptyProduct:
      'If ProductSlot Then
      '    Load AddProduct
      '    AddProduct.Show
      '    AddProduct.Hide
      '    Unload AddProduct
      'Else
      '    MsgBox "Maximum number (30) of product slots on this form have been filled." & vbCr & vbCr _
      '    & "Please start a fresh form if you wish to add further products.", vbOKOnly, "No More Product Slots Available"
      'End If

16910 ShowHide
16920 ShutDown
16930 Exit Sub
error_proc:
16940     If MsgBox("Error has occured with subroutine [AddProductSub]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16950     ShutDown
End Sub

Attribute VB_Name = "AddUNAUNB"
Sub AddUNAUNB1()
      On Error GoTo error_proc
17001 If Sheet2.Range("Unsorted_Added").Value = False Then
17002 AddProduct.ProductCode.Value = "UNA"
17003 AddProduct.AddNewProductUN_Click
17004 AddProduct.ProductCode.Value = "UNB"
17005 AddProduct.AddNewProductUN_Click
17006 AddProduct.ProductCode.Value = "UNG"
17007 AddProduct.AddNewProductUN_Click
17008 AddProduct.ProductCode.Value = "UNH"
17009 AddProduct.AddNewProductUN_Click
17010 AddProduct.ProductCode.Value = "STL"
17011 AddProduct.AddNewProductUN_Click
17012 AddProduct.ProductCode.Value = "BPL"
17013 AddProduct.AddNewProductUN_Click
17014 AddProduct.ProductCode.Value = Empty
17015 AddProduct.Product.Value = Empty
17016 AddProduct.Class.Value = Empty
17017 Sheet2.Range("Unsorted_Added").Value = True
17018 End If
17019 Exit Sub
error_proc:
17020     If MsgBox("Error has occured with subroutine [AddUNAUNB]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
17021     ShutDown
End Sub

Sub AddD2D()
      On Error GoTo error_proc
17020 If Sheet2.Range("D2D_Added").Value = False Then
17021 AddProduct.ProductCode.Value = "HDS"
17022 AddProduct.AddNewProductUN_Click
17023 AddProduct.ProductCode.Value = "HDL"
17024 AddProduct.AddNewProductUN_Click
17025 AddProduct.ProductCode.Value = "HDO"
17026 AddProduct.AddNewProductUN_Click
17027 AddProduct.ProductCode.Value = "HD1"
17028 AddProduct.AddNewProductUN_Click
17029 AddProduct.ProductCode.Value = "HD2"
17030 AddProduct.AddNewProductUN_Click
17031 AddProduct.ProductCode.Value = "HD3"
17032 AddProduct.AddNewProductUN_Click
17033 AddProduct.ProductCode.Value = "HD4"
17034 AddProduct.AddNewProductUN_Click
17035 AddProduct.ProductCode.Value = "HD5"
17036 AddProduct.AddNewProductUN_Click
17037 AddProduct.ProductCode.Value = "HD6"
17038 AddProduct.AddNewProductUN_Click
17039 AddProduct.ProductCode.Value = "HD7"
17040 AddProduct.AddNewProductUN_Click
17041 AddProduct.ProductCode.Value = "HD8"
17042 AddProduct.AddNewProductUN_Click
17043 AddProduct.ProductCode.Value = "HDK"
17044 AddProduct.AddNewProductUN_Click
17045 AddProduct.ProductCode.Value = "HDP"
17046 AddProduct.AddNewProductUN_Click
17047 AddProduct.ProductCode.Value = "HDQ"
17048 AddProduct.AddNewProductUN_Click
17049 AddProduct.ProductCode.Value = "CAN"
17050 AddProduct.AddNewProductUN_Click
17051 AddProduct.ProductCode.Value = Empty
17052 AddProduct.Product.Value = Empty
17053 AddProduct.Class.Value = Empty
17054 Sheet2.Range("D2D_Added").Value = True
17055 End If
17056 Exit Sub
error_proc:
17057     If MsgBox("Error has occured with subroutine [AddD2D]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
17058     ShutDown
End Sub

Sub AddSTLBPL()
      On Error GoTo error_proc
17059 If Sheet2.Range("STL_ADDED").Value = False Then
17060 AddProduct.ProductCode.Value = "STL"
17061 AddProduct.AddNewProductUN_Click
17062 AddProduct.ProductCode.Value = "BPL"
17063 AddProduct.AddNewProductUN_Click
17064 AddProduct.ProductCode.Value = Empty
17065 AddProduct.Product.Value = Empty
17066 AddProduct.Class.Value = Empty
17067 Sheet2.Range("STL_ADDED").Value = True
17068 End If
17069 Exit Sub
error_proc:
17070     If MsgBox("Error has occured with subroutine [AddSTLBPL]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
17071     ShutDown
End Sub

Sub AddT2()
MsgBox "This is functionality currently being testted for a future form version"
Exit Sub
    Sheet2.Range("T2_K") = InputBox("Please enter the reference of your pricing approval...", "Pricing Approval Reference", "T2_")
    Sheet2.Calculate
    Call ImportT2
    Sheet2.Calculate
    DoEvents
    If MsgBox("Please review the below customer details match the details on this form and click 'Yes' to proceed with importing the products listed or 'No' to abort." & _
        vbNewLine & Sheet2.Range("R76").Value & _
        vbNewLine & Sheet2.Range("R77").Value & _
        vbNewLine & Sheet2.Range("R78").Value & _
        vbNewLine & Sheet2.Range("R79").Value & _
        vbNewLine & Sheet2.Range("R80").Value & _
        vbNewLine & Sheet2.Range("R81").Value & _
        vbNewLine & Sheet2.Range("R82").Value & _
        vbNewLine & Sheet2.Range("R83").Value & _
        vbNewLine & Sheet2.Range("R84").Value, vbYesNo, "CHECK CUSTOMER DETAILS") = vbYes Then
        If Sheet2.Range("U69").Value <> 0 Then
            AddProduct.ProductCode.Value = Sheet2.Range("U69").Value
            AddProduct.AnnualVolume.Value = Sheet2.Range("V69").Value
            AddProduct.CalculatorRate.Value = Sheet2.Range("Z69").Value
            AddProduct.AverageWeight.Value = Sheet2.Range("W69").Value
            AddProduct.AverageHeight.Value = Sheet2.Range("X92").Value
            AddProduct.AverageWidth.Value = Sheet2.Range("Y92").Value
            AddProduct.AverageLength.Value = Sheet2.Range("Z92").Value
            AddProduct.MaxHeight.Value = Sheet2.Range("S92").Value
            AddProduct.MaxWidth.Value = Sheet2.Range("T92").Value
            AddProduct.MaxLength.Value = Sheet2.Range("U92").Value
            AddProduct.TierCombo.Value = "Tier 2"
            AddProduct.AgreedRate.Value = InputBox("Please enter the agreed sale price for " & Sheet2.Range("T69").Value, "Agreed Price", Sheet2.Range("Y69").Value)
            AddProduct.AddNewProductT2_Click
            AddProduct.ProductCode.Value = Empty
            AddProduct.Product.Value = Empty
            AddProduct.Class.Value = Empty
        End If
        If Sheet2.Range("U70").Value <> 0 Then
            AddProduct.ProductCode.Value = Sheet2.Range("U70").Value
            AddProduct.AnnualVolume.Value = Sheet2.Range("V70").Value
            AddProduct.CalculatorRate.Value = Sheet2.Range("Z70").Value
            AddProduct.AverageWeight.Value = Sheet2.Range("W70").Value
            AddProduct.AverageHeight.Value = Sheet2.Range("X93").Value
            AddProduct.AverageWidth.Value = Sheet2.Range("Y93").Value
            AddProduct.AverageLength.Value = Sheet2.Range("Z93").Value
            AddProduct.MaxHeight.Value = Sheet2.Range("S93").Value
            AddProduct.MaxWidth.Value = Sheet2.Range("T93").Value
            AddProduct.MaxLength.Value = Sheet2.Range("U93").Value
            AddProduct.TierCombo.Value = "Tier 2"
            AddProduct.AgreedRate.Value = InputBox("Please enter the agreed sale price for " & Sheet2.Range("T70").Value, "Agreed Price", Sheet2.Range("Y70").Value)
            AddProduct.AddNewProductT2_Click
            AddProduct.ProductCode.Value = Empty
            AddProduct.Product.Value = Empty
            AddProduct.Class.Value = Empty
        End If
    Else
    End If
End Sub




Attribute VB_Name = "AlphaNumericOnlyFunction"
Function AlphaNumericOnly(strSource As String) As String
          Dim i As Integer
          Dim strResult As String

17090     For i = 1 To Len(strSource)
17100         Select Case Asc(Mid(strSource, i, 1))
                  Case 32, 48 To 57, 65 To 90, 97 To 122: 'include 32 if you want to include space
17110                 strResult = strResult & Mid(strSource, i, 1)
17120         End Select
17130     Next
17140     AlphaNumericOnly = strResult
End Function
Attribute VB_Name = "Base64"
Option Explicit

Public Function EncodeBase64(rng As Range) As String
          
          ' DON'T FORGET TO ADD A REFERENCE TO MS XML 6.0 (Tools, References)
          
          Dim arrData() As Byte
17150     arrData = StrConv(rng.Value, vbFromUnicode)
          
          Dim objXML As MSXML2.DOMDocument60
          Dim objNode As MSXML2.IXMLDOMElement
          
17160     Set objXML = New MSXML2.DOMDocument60
17170     Set objNode = objXML.createElement("b64")
          
17180     objNode.DataType = "bin.base64"
17190     objNode.nodeTypedValue = arrData
17200     EncodeBase64 = objNode.text
          
17210     Set objNode = Nothing
17220     Set objXML = Nothing

End Function
Attribute VB_Name = "ButtonFunctionality"
Global OKFlag
Global OutMail As Object
Option Explicit
Dim strURL As String
Dim strPath As String
Dim strFile As String
#If VBA7 Then
    Declare PtrSafe Function InternetGetConnectedStateEx Lib "wininet.dll" (ByRef lpdwFlags As LongPtr, ByVal lpszConnectionName As String, ByVal dwNameLen As Integer, ByVal dwReserved As Long) As Long
    Private Declare PtrSafe Function URLDownloadToFile Lib "urlmon" _
    Alias "URLDownloadToFileA" (ByVal pCaller As LongPtr, _
    ByVal szURL As String, ByVal szFileName As String, _
    ByVal dwReserved As LongPtr, ByVal lpfnCB As LongPtr) As LongPtr
    Dim Ret As LongPtr
#Else
    Declare Function InternetGetConnectedStateEx Lib "wininet.dll" (ByRef lpdwFlags As Long, ByVal lpszConnectionName As String, ByVal dwNameLen As Integer, ByVal dwReserved As Long) As Long
    Private Declare Function URLDownloadToFile Lib "urlmon" _
    Alias "URLDownloadToFileA" (ByVal pCaller As Long, _
    ByVal szURL As String, ByVal szFileName As String, _
    ByVal dwReserved As Long, ByVal lpfnCB As Long) As Long
    Dim Ret As Long
#End If
' This code provides the functionality for the "Download latest form" button

Sub DownloadLatest()

      Dim Ans As Integer
17230 On Error GoTo Error1
17240  Ans = MsgBox("To view this web page you must be connnected to the Royal Mail network. Click Yes to continue.", vbExclamation + vbYesNo)
17250     Select Case Ans
              Case vbYes
17260         ThisWorkbook.FollowHyperlink "https://intranet.royalmailgroup.com/CustomerExperience/Pages/Account-Set-Up-Made-Easier.aspx"
17270     Case vbNo
17280     End Select
17290  Exit Sub
Error1:
17300 MsgBox "You are not connected to the Royal Mail network. If you work for an agency, please obtain the latest version from MoveIt.", vbExclamation

End Sub
Sub TandCGenerator()
      Dim OutApp As Object
      Dim strbody As String

17310 On Error GoTo error_proc

17320 If Form.Range("User.Type") = 1 Then
      '    If MsgBox("This will generate a link to send Terms & Conditions directly to the customer. Please only proceed if you have received instructions as part of the appropriate trial group." & vbNewLine & vbNewLine & "Do you want to continue?", vbYesNo, "T&Cs direct to customer") = vbNo Then Exit Sub
17330 End If

17340 If Form.Range("SST.TCDate").Value <> "" Then
17350     If MsgBox("T&Cs were previously sent at the following date and time: " & Form.Range("SST.TCDate") & "." & vbNewLine & vbNewLine & "Are you sure you want to send them again?", vbYesNo, "T&Cs Resend") = vbNo Then Exit Sub
17360 End If

17370 StartUp
17380 Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
17390         With Application
17400             .ScreenUpdating = False
17410             .EnableEvents = False
17420         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
17430         Set OutApp = CreateObject("Outlook.Application")
17440         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
17450         strbody = ThisWorkbook.Sheets("Email Body and Attachments").Range("TNC.String").Value _
       '           & "Royal Mail"
                  
17460         strbody = Application.WorksheetFunction.Substitute(strbody, "###URL###", Sheet24.Cells(32, 3))
17470         strbody = Application.WorksheetFunction.Substitute(strbody, "###CLIENTNAME###", Sheet24.Cells(6, 3))
17480         strbody = Application.WorksheetFunction.Substitute(strbody, "###ORDERID###", Sheet24.Cells(8, 3))
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
17490        With OutMail
17500            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
17510            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
17520            .BCC = ""
17530            .Importance = 2
17540             .Subject = ThisWorkbook.Sheets("Email Body and Attachments").Range("TNC.Subject").Value
17550             .HTMLbody = strbody
17560             .DISPLAY
         'ADD Attachments
17570         If ThisWorkbook.Sheets("T&C Control").Range("DirectDebit").Value = True Then
17580             If Not ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value = "Direct Debit (Single Sig)" Then
17590                 strFile = "How to complete your Direct Debit Mandate.pdf"
17600                 strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
17610                 strPath = Environ$("temp") & "\" & strFile
17620                 Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
17621                 If DoesFileExists(Environ$("temp") & "\" & strFile) = False Then
17622                     strURL = "https://drive.google.com/uc?export=download&id=19s17NaOqf3h__EgGDbqv057Rn-bhpezT"
17623                     strPath = Environ$("temp") & "\" & strFile
17624                     Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
17625                     .Attachments.Add (Environ$("temp") & "\" & strFile)
17626                     Kill Environ$("temp") & "\" & strFile
17627                        Call DDMandate2
17628                 Else
17640                 .Attachments.Add (Environ$("temp") & "\" & strFile)
17641                 Kill Environ$("temp") & "\" & strFile
17650                     Call DDMandate
17651                 End If
17660             End If
17670         End If
       '       If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
        '              .Attachments.Add ("https://portal.royalmailgroup.com/sites/A346/ASUME%20CONTENT/Royal%20Mail%2024%2048%20Price%20confirmation%20letter.pdf")
        '      End If
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
17680         .DISPLAY
17690         End With
      'Special pricing moved to Account Live 19/04/201
17700 GoTo SkipSP:
       'ADD Special Pricing Letters
17710         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
17720             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
17730                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
17740                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
17750                     Else
                          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          'Worksheets("RM TRACKED 24 48 LETTER S").Activate
17760                     Call SavePDF
                          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
17770                     Sheets("Form").Activate
17780                 End If
17790             Else
17800                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
17810                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
17820                 Else
                          'Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          'Worksheets("RM TRACKED 24 48 LETTER").Activate
17830                     Call SavePDF
                          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
17840                     Sheets("Form").Activate
17850                 End If
17860             End If
17870         End If
              
17880         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
17890             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
17900                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
17910                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
17920                     Else
                                  'Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  'Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
17930                             Call SavePDF
                                  'Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
17940                             Sheets("Form").Activate
17950                     End If
17960             Else
17970                 If Sheet2.Range("Special.HV").Value <> "On" Then
17980                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
17990                 Else
                          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          'Worksheets("RM TRACKED HV 24 48 LETTER").Activate
18000                     Call SavePDF
                          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
18010                     Sheets("Form").Activate
18020                 End If
18030             End If
18040         End If

              
18050         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
18060             If Sheet2.Range("Special.Flat").Value <> "On" Then
18070                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
18080             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
18090                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
18100             End If
18110         End If
              
18120         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
18130             If Sheet2.Range("Special.Returns").Value <> "On" Then
18140                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
18150             Else
                      'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
18160                 Call SavePDF
                      'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
18170                 Sheets("Form").Activate
18180             End If
18190         End If
              
18200         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
18210             If Sheet2.Range("Special.LBT").Value <> "On" Then
18220                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
18230             Else
                      'Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      'Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
18240                 Call SavePDF
                      'Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
18250                 Sheets("Form").Activate
18260             End If
18270         End If
              
18280         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
18290             If Sheet2.Range("Special.SoW").Value <> "On" Then
18300                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
18310             Else
18320                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
18330                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
18340                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
18350                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
18360                         Call SavePDF
18370                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
18380                         Sheets("Form").Activate
18390                     End If
18400                 Else
18410                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
18420                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
18430                     Call SavePDF
18440                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
18450                     Sheets("Form").Activate
18460                 End If
18470             End If
18480         End If
              
18490         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
18500                     MsgBox "A special pricing letter is required for a non templated product, hence the pricing letter cannot be generated here. Please ensure the customer has/is receiving a pricing confirmation by other means."
18510         End If
         ''''''''''''''
SkipSP:

18520     Set OutMail = Nothing
18530     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
18540     With Application
18550         .ScreenUpdating = True
18560         .EnableEvents = True
18570     End With
      'End If

18580 Form.Unprotect Password:="fruitbasket"
18590 Form.Range("SST.TCDate") = Now()
18600 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True

18610 ShutDown
18620 Exit Sub
error_proc:
18630     If MsgBox("Error has occured with subroutine [TandCGenerator]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
18640     ShutDown

End Sub
Sub MMGenerator()
      Dim OutApp As Object
      Dim strbody As String

18650 On Error GoTo error_proc

      'MsgBox "The Mailmark T&Cs have now been integrated with the main T&Cs email. This button is no longer in use."

18660 Call ALSelect

18670 Exit Sub

18680 StartUp
18690 Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
18700         With Application
18710             .ScreenUpdating = False
18720             .EnableEvents = False
18730         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
18740         Set OutApp = CreateObject("Outlook.Application")
18750         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
18760             strbody = "<font face=calibri>" & ThisWorkbook.Sheets("Email Body and Attachments").Range("TNC.MM").Value _
                      & Application.Username _
                      & "<br><br>Royal Mail Setting up Services Team<br><br>Drake House, Breakwater Road, PLYMOUTH, PL9 7HJ<br><br>Email: " _
                      & OutApp.GetNamespace("MAPI").accounts.Item(1).DisplayName
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
18770        With OutMail
18780            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
18790            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
18800            .BCC = ""
18810            .Importance = 2
18820             .Subject = ThisWorkbook.Sheets("Email Body and Attachments").Range("TNC.Subject").Value
18830             .HTMLbody = strbody
18840             .DISPLAY
         'ADD Attachments
18850         If ThisWorkbook.Sheets("T&C Control").Range("DirectDebit").Value = True Then
18860             strFile = "How to complete your Direct Debit Mandate.pdf"
18870             strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
18880             strPath = Environ$("temp") & "\" & strFile
18890             Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
18900             .Attachments.Add (Environ$("temp") & "\" & strFile)
18910             Kill Environ$("temp") & "\" & strFile
18920                 Call DDMandate
18930         End If
18940         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
18950             Call CRL
                  'strFile = "Royal Mail 24 48 Price confirmation letter.pdf"
                  'strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
                  'strPath = Environ$("temp") & "\" & strFile
                  'Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
                  '.Attachments.Add (Environ$("temp") & "\" & strFile)
                  'Kill Environ$("temp") & "\" & strFile
18960         End If
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
18970         .DISPLAY
18980         End With
         
18990     Set OutMail = Nothing
19000     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
19010     With Application
19020         .ScreenUpdating = True
19030         .EnableEvents = True
19040     End With
      'End If

19050 ShutDown
19060 Exit Sub
error_proc:
19070     If MsgBox("Error has occured with subroutine [MMGenerator]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19080     ShutDown
End Sub
Sub StartUp()
19090 On Error GoTo error_proc
19100 Form.Unprotect Password:="fruitbasket"
19110 Application.EnableEvents = False
19120 Application.Calculation = xlCalculationManual
19130 Application.ScreenUpdating = False
19140 Exit Sub
error_proc:
19150     If MsgBox("Error has occured with subroutine [StartUp]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19160     ShutDown
End Sub
Sub ShutDown()
19170 On Error GoTo error_proc
19180 Application.EnableEvents = True
19190 Application.Calculation = xlCalculationAutomatic
19200 Application.ScreenUpdating = True
19210 Application.StatusBar = False
19220 Form.Protect Password:="fruitbasket"
19230 Exit Sub
error_proc:
19240     If MsgBox("Error has occured with subroutine [ShutDown]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19250     ShutDown
End Sub
Sub SavePDF()

      Dim TempPDFPath As String
      Dim TempPDFName As String
      Dim PDFFullPath As String
19260 On Error GoTo error_proc
      'Where PDF will be saved temporarily

19270 TempPDFPath = Environ$("temp") & "\"
19280 TempPDFName = AlphaNumericOnly(ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value) & "-" & ActiveSheet.name & "-" & Format(Now, "dd-mmm-yy h-mm-ss") & ".pdf"
19290 PDFFullPath = TempPDFPath & TempPDFName

      'Exporting the activesheet as PDF

19300     With ActiveSheet
19310         .ExportAsFixedFormat _
              Type:=xlTypePDF, _
              filename:=PDFFullPath, _
              Quality:=xlQualityStandard, _
              IncludeDocProperties:=True, _
              IgnorePrintAreas:=False, _
              OpenAfterPublish:=False
19320     End With

      'Attach to existing outlook (only to be used with T&C functionality)
19330 With OutMail
19340     .Attachments.Add PDFFullPath
19350 End With
      'Delete the file
19360     Kill PDFFullPath
19370 Exit Sub
error_proc:
19380     If MsgBox("Error has occured with subroutine [SavePDF]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19390     ShutDown
End Sub
Sub DDMandate()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
19400 On Error GoTo error_proc
      'Download and create word document
19410 Set DDWordApp = CreateObject("Word.Application")
19420 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared Documents/DSQ_Resources/Royal%20Mail%20Group%20Ltd%20DDI.docx", ReadOnly:=False)
      'Replace with Order ID
19430 With DDWordDoc.Range.Find
19440     .ClearFormatting
19450     .text = "1-XXXXXXXXX"
19460     .Replacement.text = Range("CUS.Order").Value
19470     .MatchWholeWord = True
19480     .MatchCase = False
19490     .Forward = True
19500     .Wrap = wdFindStop
19510     .Execute Replace:=wdReplaceAll
19520 End With

      'Save in local hard disk
19530     TempFilePath = Environ$("temp") & "\"
19540     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_Royal Mail Direct Debit Mandate_" & Format(Now, "dd-mmm-yy h-mm-ss")
19550     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
19560     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
19570     DDWordDoc.Close
          
      'Attach to existing outlook
19580 With OutMail
19590     .Attachments.Add TempFilePath & tempfilename & ".pdf"
19600 End With
      'Delete the file
19610     Set DDWordApp = Nothing
19620     Set DDWordDoc = Nothing
19630     Kill TempFilePath & tempfilename & ".pdf"
19640     Kill TempFilePath & tempfilename & ".doc"
19650 Exit Sub
error_proc:
19660     If MsgBox("Error has occured with subroutine [DDmandate]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19670     ShutDown
End Sub

Sub DDMandate2()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
19680 On Error GoTo error_proc
      'Download and create word document
19681                     strFile = "Royal Mail Group Ltd DDI.docx"
19682                     strURL = "https://drive.google.com/uc?export=download&id=1eDZkQmHBYCNWd402eVOqRkHazTTF4CT0"
19683                     strPath = Environ$("temp") & "\" & strFile
19684                     Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
19685 Set DDWordApp = CreateObject("Word.Application")
19686 Set DDWordDoc = DDWordApp.Documents.Open(strPath, ReadOnly:=False)
      'Replace with Order ID
19687 With DDWordDoc.Range.Find
19688     .ClearFormatting
19689     .text = "1-XXXXXXXXX"
19690     .Replacement.text = Range("CUS.Order").Value
19691     .MatchWholeWord = True
19692     .MatchCase = False
19693     .Forward = True
19694     .Wrap = wdFindStop
19695     .Execute Replace:=wdReplaceAll
19696 End With

      'Save in local hard disk
19697     TempFilePath = Environ$("temp") & "\"
19698     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_Royal Mail Direct Debit Mandate_" & Format(Now, "dd-mmm-yy h-mm-ss")
19699     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
19700     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
19701     DDWordDoc.Close
          
      'Attach to existing outlook
19702 With OutMail
19703     .Attachments.Add TempFilePath & tempfilename & ".pdf"
19704 End With
      'Delete the file
19705     Set DDWordApp = Nothing
19706     Set DDWordDoc = Nothing
19707     Kill TempFilePath & tempfilename & ".pdf"
19708     Kill TempFilePath & tempfilename & ".doc"
19709 Exit Sub
error_proc:
19710     If MsgBox("Error has occured with subroutine [DDmandate2]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19711     ShutDown
End Sub

Sub NewWB()

      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileFullPath As String
      Dim wb1 As Workbook
      Dim wb2 As Workbook
19712 On Error GoTo error_proc
      'Where File will be saved temporarily

19713 TempFilePath = Environ$("temp") & "\Special Pricing Letters"
19714 tempfilename = AlphaNumericOnly(ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value) & "_" & ActiveSheet.name & "_" & Format(Now, "dd-mmm-yy h-mm-ss") & ".xlsx"
19715 FileFullPath = TempFilePath & "\" & tempfilename

      'Makes a directory if it does not exist

19720 If Len(Dir(TempFilePath, vbDirectory)) = 0 Then
19730     MkDir TempFilePath
19740 End If

      'Create new workbook
19750 Set wb1 = ActiveWorkbook
19760 Set wb2 = Workbooks.Add
19770 wb1.ActiveSheet.Visible = True
19780 wb1.ActiveSheet.Copy Before:=wb2.Sheets(1)
19790 wb1.ActiveSheet.Visible = False
19800 Application.DisplayAlerts = False
19810 wb2.Sheets("Sheet1").Delete
19820 wb2.SaveAs FileFullPath
19830 Application.DisplayAlerts = True

      'Return to original form for macro to continue
19840 wb1.Activate
19850 wb1.Sheets("Form").Activate
19860 Exit Sub
error_proc:
19870     If MsgBox("Error has occured with subroutine [NewWB]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19880     ShutDown

End Sub
Sub TnCProducts()

      'Code to fill products in email body
      Dim c As Range
19890 On Error GoTo error_proc
19900 Range("TNC.ProductString") = ""

19910 For Each c In Range("TNC.ProductList")
19920     If Not (c.Value = "") And InStr(Range("TNC.ProductString"), c.Value) = 0 Then
19930         Range("TNC.ProductString") = Range("TNC.ProductString") & Chr(149) & " " & c.Value & "<br>"
19940     End If
19950 Next c

19960 Application.Calculate
19970 Exit Sub
error_proc:
19980     If MsgBox("Error has occured with subroutine [TnCProducts]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
19990     ShutDown

End Sub

Sub WaitForm()

      'puts the form in the XL memory for easy access - not strictly necessary
20000 Load WaitForm1

      'shows form and continues with code.  The key part of this is the (vbModeless) part
      'if you do not include this part XL will wait until the form is dismissed before
      'continuing the code
20010 WaitForm1.Show (vbModeless)

      'Ensures that XL refreshes the screen with all of the forms contents
20020 DoEvents

      'Insert code here to be run whilst form is displayed
      'just a function to show how the form works - ERASE when using code
20030 Call TandCGenerator

      'hides form - put at the end of your routine
20040 WaitForm1.Hide

      'unloads the form from the XL memory
20050 Unload WaitForm1

End Sub

Sub ALGenerator1()
      Dim OutApp As Object
      Dim strbody As String

20060 On Error GoTo error_proc
20070 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
20080         With Application
20090             .ScreenUpdating = False
20100             .EnableEvents = False
20110         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
20120         Set OutApp = CreateObject("Outlook.Application")
20130         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
20140         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body1").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
20150        With OutMail
20160            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
20170            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
20180            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
20181            If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
20182            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
20190            .Importance = 2
20200             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject").Value
20210             .HTMLbody = strbody
'20220             .DISPLAY
         'ADD Attachments
      '            .Attachments.Add ("https://my.royalmailgroup.com/personal/james_valentine_royalmail_com/Documents/Shared%20with%20Everyone/SPL/Royal%20Mail%20Click%20and%20Drop%20Guides.zip")
20230             strFile = "New Royal Mail Account Guides.zip"
20240             strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
20250             strPath = Environ$("temp") & "\" & strFile
20260             Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
20270             .Attachments.Add (Environ$("temp") & "\" & strFile)
20280             Kill Environ$("temp") & "\" & strFile
20290         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
20300             Call CRL
                  'strFile = "Royal Mail 24 48 Price confirmation letter.pdf"
                  'strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
                  'strPath = Environ$("temp") & "\" & strFile
                  'Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
                  '.Attachments.Add (Environ$("temp") & "\" & strFile)
                  'Kill Environ$("temp") & "\" & strFile
20310         End If
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'20320         .DISPLAY
20330         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
       
20340         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
20350             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
20360                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
20370                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
20380                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
20390                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
20400                 End If
20410             Else
20420                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
20430                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
20440                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
20450                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
20460                 End If
20470             End If
20480         End If
              
20490         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
20500             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
20510                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
20520                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
20530                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
20540                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
20550                     End If
20560             Else
20570                 If Sheet2.Range("Special.HV").Value <> "On" Then
20580                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
20590                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
20600                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
20610                 End If
20620             End If
20630         End If
              
20640         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
20650             If Sheet2.Range("Special.LBT").Value <> "On" Then
20660                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
20670             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
20680                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
20690             End If
20700         End If

              
20710         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
20720             If Sheet2.Range("Special.Flat").Value <> "On" Then
20730                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
20740             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
20750                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
20760             End If
20770         End If
              
20780         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
20790             If Sheet2.Range("Special.Returns").Value <> "On" Then
20800                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
20810             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
20820                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
20830             End If
20840         End If
              
20850         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
20860             If Sheet2.Range("Special.LBT").Value <> "On" Then
20870                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
20880             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
20890                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
20900             End If
20910         End If
              
20920         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
20930             If Sheet2.Range("Special.SoW").Value <> "On" Then
20940                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
20950             Else
20960                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
20970                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
20980                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
20990                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
21000                         Call SavePDF
21010                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
21020                         Sheets("Form").Activate
21030                     End If
21040                 Else
21050                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
21060                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
21070                     Call SavePDF
21080                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
21090                     Sheets("Form").Activate
21100                 End If
21110             End If
21120         End If
              
21130         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
21140                 Call INTCNT
21150         End If

21151         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
21152                 Call INTRT
21153         End If
              
21160         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
21170                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
21180         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
21190     Set OutMail = Nothing
21200     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
21210     With Application
21220         .ScreenUpdating = True
21230         .EnableEvents = True
21240     End With
      'End If

21250 ShutDown
21260 Exit Sub
error_proc:
21270     If MsgBox("Error has occured with subroutine [ALGenerator1]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
21280     ShutDown

End Sub


Sub ALGenerator2()
      Dim OutApp As Object
      Dim strbody As String

21290 On Error GoTo error_proc
21300 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
21310         With Application
21320             .ScreenUpdating = False
21330             .EnableEvents = False
21340         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
21350         Set OutApp = CreateObject("Outlook.Application")
21360         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
21370         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body2").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
21380        With OutMail
21390            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
21400            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
21410            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
21411            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
21412            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
21420            .Importance = 2
21430             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject").Value
21440             .HTMLbody = strbody
'21450             .DISPLAY
         'ADD Attachments
      '            .Attachments.Add ("https://my.royalmailgroup.com/personal/james_valentine_royalmail_com/Documents/Shared%20with%20Everyone/SPL/Royal%20Mail%20Click%20and%20Drop%20Guides.zip")
21460         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
21470             Call CRL
                  'strFile = "Royal Mail 24 48 Price confirmation letter.pdf"
                  'strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
                  'strPath = Environ$("temp") & "\" & strFile
                  'Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
                  '.Attachments.Add (Environ$("temp") & "\" & strFile)
                  'Kill Environ$("temp") & "\" & strFile
21480         End If
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'21490         .DISPLAY
21500         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
       
21510         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
21520             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
21530                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
21540                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
21550                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
21560                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
21570                 End If
21580             Else
21590                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
21600                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
21610                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
21620                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
21630                 End If
21640             End If
21650         End If
              
21660         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
21670             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
21680                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
21690                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
21700                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
21710                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
21720                     End If
21730             Else
21740                 If Sheet2.Range("Special.HV").Value <> "On" Then
21750                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
21760                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
21770                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
21780                 End If
21790             End If
21800         End If
              
21810         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
21820             If Sheet2.Range("Special.LBT").Value <> "On" Then
21830                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
21840             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
21850                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
21860             End If
21870         End If

              
21880         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
21890             If Sheet2.Range("Special.Flat").Value <> "On" Then
21900                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
21910             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
21920                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
21930             End If
21940         End If
              
21950         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
21960             If Sheet2.Range("Special.Returns").Value <> "On" Then
21970                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
21980             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
21990                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
22000             End If
22010         End If
              
22020         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
22030             If Sheet2.Range("Special.LBT").Value <> "On" Then
22040                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
22050             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
22060                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
22070             End If
22080         End If
              
22090         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
22100             If Sheet2.Range("Special.SoW").Value <> "On" Then
22110                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
22120             Else
22130                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
22140                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
22150                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
22160                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
22170                         Call SavePDF
22180                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
22190                         Sheets("Form").Activate
22200                     End If
22210                 Else
22220                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
22230                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
22240                     Call SavePDF
22250                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
22260                     Sheets("Form").Activate
22270                 End If
22280             End If
22290         End If
              
22300         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
22310                 Call INTCNT
22320         End If

22321         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
22322                 Call INTRT
22323         End If
              
22330         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
22340                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
22350         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
22360     Set OutMail = Nothing
22370     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
22380     With Application
22390         .ScreenUpdating = True
22400         .EnableEvents = True
22410     End With
      'End If

22420 ShutDown
22430 Exit Sub
error_proc:
22440     If MsgBox("Error has occured with subroutine [ALGenerator2]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
22450     ShutDown

End Sub


Sub ALGenerator3()
      Dim OutApp As Object
      Dim strbody As String

22460 On Error GoTo error_proc
22470 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
22480         With Application
22490             .ScreenUpdating = False
22500             .EnableEvents = False
22510         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
22520         Set OutApp = CreateObject("Outlook.Application")
22530         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
22540         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body3").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
22550        With OutMail
22560            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
22570            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
22580            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
20581            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
20582            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
22590            .Importance = 2
22600             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject").Value
22610             .HTMLbody = strbody
'22620             .DISPLAY
         'ADD Attachments
      '            .Attachments.Add ("https://my.royalmailgroup.com/personal/james_valentine_royalmail_com/Documents/Shared%20with%20Everyone/SPL/Royal%20Mail%20Click%20and%20Drop%20Guides.zip")
22630         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
22640             Call CRL
                  'strFile = "Royal Mail 24 48 Price confirmation letter.pdf"
                  'strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
                  'strPath = Environ$("temp") & "\" & strFile
                  'Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
                  '.Attachments.Add (Environ$("temp") & "\" & strFile)
                  'Kill Environ$("temp") & "\" & strFile
22650         End If
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'22660         .DISPLAY
22670         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
       
22680         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
22690             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
22700                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
22710                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
22720                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
22730                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
22740                 End If
22750             Else
22760                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
22770                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
22780                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
22790                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
22800                 End If
22810             End If
22820         End If
              
22830         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
22840             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
22850                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
22860                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
22870                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
22880                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
22890                     End If
22900             Else
22910                 If Sheet2.Range("Special.HV").Value <> "On" Then
22920                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
22930                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
22940                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
22950                 End If
22960             End If
22970         End If
              
22980         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
22990             If Sheet2.Range("Special.LBT").Value <> "On" Then
23000                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
23010             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
23020                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
23030             End If
23040         End If

              
23050         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
23060             If Sheet2.Range("Special.Flat").Value <> "On" Then
23070                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
23080             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
23090                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
23100             End If
23110         End If
              
23120         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
23130             If Sheet2.Range("Special.Returns").Value <> "On" Then
23140                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
23150             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
23160                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
23170             End If
23180         End If
              
23190         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
23200             If Sheet2.Range("Special.LBT").Value <> "On" Then
23210                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
23220             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
23230                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
23240             End If
23250         End If
              
23260         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
23270             If Sheet2.Range("Special.SoW").Value <> "On" Then
23280                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
23290             Else
23300                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
23310                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
23320                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
23330                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
23340                         Call SavePDF
23350                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
23360                         Sheets("Form").Activate
23370                     End If
23380                 Else
23390                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
23400                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
23410                     Call SavePDF
23420                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
23430                     Sheets("Form").Activate
23440                 End If
23450             End If
23460         End If
              
23470         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
23480                 Call INTCNT
23490         End If

23491         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
23492                 Call INTRT
23943         End If
              
23500         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
23510                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
23520         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
23530     Set OutMail = Nothing
23540     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
23550     With Application
23560         .ScreenUpdating = True
23570         .EnableEvents = True
23580     End With
      'End If

23590 ShutDown
23600 Exit Sub
error_proc:
23610     If MsgBox("Error has occured with subroutine [ALGenerator3]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
23620     ShutDown

End Sub

Sub ALGenerator4()
      Dim OutApp As Object
      Dim strbody As String

23630 On Error GoTo error_proc
23640 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
23650         With Application
23660             .ScreenUpdating = False
23670             .EnableEvents = False
23680         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
23690         Set OutApp = CreateObject("Outlook.Application")
23700         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
23710         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body4").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
23720        With OutMail
23730            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
23740            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
23750            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
23751            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
23752            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
23760            .Importance = 2
23770             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject2").Value
23780             .HTMLbody = strbody
'23790             .DISPLAY
         'ADD Attachments
23800             strFile = "Royal Mail Click and Drop Guides.zip"
                  
23810             strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
23820             strPath = Environ$("temp") & "\" & strFile
23830             Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
23840             .Attachments.Add (Environ$("temp") & "\" & strFile)
23850             Kill Environ$("temp") & "\" & strFile
                  
23860         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
23870             Call CRL
                  'strFile = "Royal Mail 24 48 Price confirmation letter.pdf"
                  'strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
                  'strPath = Environ$("temp") & "\" & strFile
                  'Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
                  '.Attachments.Add (Environ$("temp") & "\" & strFile)
                  'Kill Environ$("temp") & "\" & strFile
23880         End If
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'23890         .DISPLAY
23900         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
    
23910         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
23920             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
23930                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
23940                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
23950                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
23960                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
23970                 End If
23980             Else
23990                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
24000                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
24010                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
24020                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
24030                 End If
24040             End If
24050         End If
              
24060         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
24070             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
24080                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
24090                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
24100                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
24110                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
24120                     End If
24130             Else
24140                 If Sheet2.Range("Special.HV").Value <> "On" Then
24150                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
24160                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
24170                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
24180                 End If
24190             End If
24200         End If
              
24210         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
24220             If Sheet2.Range("Special.LBT").Value <> "On" Then
24230                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
24240             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
24250                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
24260             End If
24270         End If

              
24280         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
24290             If Sheet2.Range("Special.Flat").Value <> "On" Then
24300                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
24310             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
24320                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
24330             End If
24340         End If
              
24350         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
24360             If Sheet2.Range("Special.Returns").Value <> "On" Then
24370                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
24380             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
24390                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
24400             End If
24410         End If
              
24420         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
24430             If Sheet2.Range("Special.LBT").Value <> "On" Then
24440                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
24450             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
24460                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
24470             End If
24480         End If
              
24490         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
24500             If Sheet2.Range("Special.SoW").Value <> "On" Then
24510                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
24520             Else
24530                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
24540                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
24550                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
24560                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
24570                         Call SavePDF
24580                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
24590                         Sheets("Form").Activate
24600                     End If
24610                 Else
24620                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
24630                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
24640                     Call SavePDF
24650                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
24660                     Sheets("Form").Activate
24670                 End If
24680             End If
24690         End If
              
24700         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
24710                 Call INTCNT
24720         End If

24721         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
24722                 Call INTRT
24723         End If
              
24730         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
24740                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
24750         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
24760     Set OutMail = Nothing
24770     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
24780     With Application
24790         .ScreenUpdating = True
24800         .EnableEvents = True
24810     End With
      'End If

24820 ShutDown
24830 Exit Sub
error_proc:
24840     If MsgBox("Error has occured with subroutine [ALGenerator4]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
24850     ShutDown

End Sub

Sub ALGenerator5()
      Dim OutApp As Object
      Dim strbody As String

24860 On Error GoTo error_proc
24870 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
24880         With Application
24890             .ScreenUpdating = False
24900             .EnableEvents = False
24910         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
24920         Set OutApp = CreateObject("Outlook.Application")
24930         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
24940         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body5").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
24950        With OutMail
24960            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
24970            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
24980            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
24981            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
24982            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
24990            .Importance = 2
25000             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject3").Value
25010             .HTMLbody = strbody
'25020             .DISPLAY
         'ADD Attachments
25030             strFile = "Royal Mail DMO Guides.zip"
25040             strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
25050             strPath = Environ$("temp") & "\" & strFile
25060             Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
25070             .Attachments.Add (Environ$("temp") & "\" & strFile)
25080             Kill Environ$("temp") & "\" & strFile
25090         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
25100             Call CRL
                  'strFile = "Royal Mail 24 48 Price confirmation letter.pdf"
                  'strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
                  'strPath = Environ$("temp") & "\" & strFile
                  'Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
                  '.Attachments.Add (Environ$("temp") & "\" & strFile)
                  'Kill Environ$("temp") & "\" & strFile
25110         End If
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'25120         .DISPLAY
25130         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
       
25140         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
25150             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
25160                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
25170                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
25180                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
25190                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
25200                 End If
25210             Else
25220                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
25230                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
25240                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
25250                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
25260                 End If
25270             End If
25280         End If
              
25290         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
25300             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
25310                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
25320                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
25330                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
25340                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
25350                     End If
25360             Else
25370                 If Sheet2.Range("Special.HV").Value <> "On" Then
25380                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
25390                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
25400                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
25410                 End If
25420             End If
25430         End If
              
25440         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
25450             If Sheet2.Range("Special.LBT").Value <> "On" Then
25460                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
25470             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
25480                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
25490             End If
25500         End If

              
25510         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
25520             If Sheet2.Range("Special.Flat").Value <> "On" Then
25530                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
25540             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
25550                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
25560             End If
25570         End If
              
25580         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
25590             If Sheet2.Range("Special.Returns").Value <> "On" Then
25600                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
25610             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
25620                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
25630             End If
25640         End If
              
25650         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
25660             If Sheet2.Range("Special.LBT").Value <> "On" Then
25670                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
25680             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
25690                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
25700             End If
25710         End If
              
25720         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
25730             If Sheet2.Range("Special.SoW").Value <> "On" Then
25740                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
25750             Else
25760                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
25770                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
25780                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
25790                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
25800                         Call SavePDF
25810                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
25820                         Sheets("Form").Activate
25830                     End If
25840                 Else
25850                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
25860                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
25870                     Call SavePDF
25880                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
25890                     Sheets("Form").Activate
25900                 End If
25910             End If
25920         End If
              
25930         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
25940                 Call INTCNT
25950         End If

25951         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
25952                 Call INTRT
25953         End If
              
25960         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
25970                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
25980         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
25990     Set OutMail = Nothing
26000     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
26010     With Application
26020         .ScreenUpdating = True
26030         .EnableEvents = True
26040     End With
      'End If

26050 ShutDown
26060 Exit Sub
error_proc:
26070     If MsgBox("Error has occured with subroutine [ALGenerator5]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
26080     ShutDown

End Sub

Sub ALGenerator6()
      Dim OutApp As Object
      Dim strbody As String

26090 On Error GoTo error_proc
26100 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
26110         With Application
26120             .ScreenUpdating = False
26130             .EnableEvents = False
26140         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
26150         Set OutApp = CreateObject("Outlook.Application")
26160         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
26170         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body6").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
26180        With OutMail
26190            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
26200            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
26210            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
26211            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
26212            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
26220            .Importance = 2
26230             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject2").Value
26240             .HTMLbody = strbody
'26250             .DISPLAY
         'ADD Attachments
                  
26260         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
26270             Call CRL
26280         End If
26281                  strFile = "Mail_Presentation_Guide_Amazon_MFN.pdf"
26282                  strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
26283                  strPath = Environ$("temp") & "\" & strFile
26284                  Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
26285                  .Attachments.Add (Environ$("temp") & "\" & strFile)
26286                  Kill Environ$("temp") & "\" & strFile

26287                  strFile = "International_Mail_Presentation_Guide_Amazon_MFN.pdf"
26288                  strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
26289                  strPath = Environ$("temp") & "\" & strFile
26290                  Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
26291                  .Attachments.Add (Environ$("temp") & "\" & strFile)
26292                  Kill Environ$("temp") & "\" & strFile
              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'26293         .DISPLAY
26300         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
       
26310         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
26320             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
26330                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
26340                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
26350                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
26360                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
26370                 End If
26380             Else
26390                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
26400                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
26410                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
26420                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
26430                 End If
26440             End If
26450         End If
              
26460         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
26470             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
26480                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
26490                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
26500                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
26510                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
26520                     End If
26530             Else
26540                 If Sheet2.Range("Special.HV").Value <> "On" Then
26550                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
26560                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
26570                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
26580                 End If
26590             End If
26600         End If
              
26610         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
26620             If Sheet2.Range("Special.LBT").Value <> "On" Then
26630                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
26640             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
26650                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
26660             End If
26670         End If

              
26680         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
26690             If Sheet2.Range("Special.Flat").Value <> "On" Then
26700                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
26710             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
26720                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
26730             End If
26740         End If
              
26750         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
26760             If Sheet2.Range("Special.Returns").Value <> "On" Then
26770                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
26780             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
26790                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
26800             End If
26810         End If
              
26820         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
26830             If Sheet2.Range("Special.LBT").Value <> "On" Then
26840                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
26850             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
26860                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
26870             End If
26880         End If
              
26890         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
26900             If Sheet2.Range("Special.SoW").Value <> "On" Then
26910                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
26920             Else
26930                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
26940                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
26950                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
26960                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
26970                         Call SavePDF
26980                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
26990                         Sheets("Form").Activate
27000                     End If
27010                 Else
27020                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
27030                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
27040                     Call SavePDF
27050                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
27060                     Sheets("Form").Activate
27070                 End If
27080             End If
27090         End If
              
27100         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
27110             If ThisWorkbook.Sheets("CONTROL.Letters").Range("IntErr").Value = True Then
27120             MsgBox "The level of discount offered for International Country Priced products on this form appears to be inconsistant. The automatically generated letter will refer to the maximum offered discount only."
27130             End If
27140             Call INTCNT
27150         End If

27151         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
27152                 Call INTRT
27153         End If
              
27160         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
27170                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
27180         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
27190     Set OutMail = Nothing
27200     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27210     With Application
27220         .ScreenUpdating = True
27230         .EnableEvents = True
27240     End With
      'End If

27250 ShutDown
27260 Exit Sub
error_proc:
27270     If MsgBox("Error has occured with subroutine [ALGenerator6]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27280     ShutDown

End Sub

Sub MSGenerator1()
      Dim OutApp As Object
      Dim strbody As String

27281 On Error GoTo error_proc
27282 StartUp
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27283         With Application
27284             .ScreenUpdating = False
27285             .EnableEvents = False
27286         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27287         Set OutApp = CreateObject("Outlook.Application")
27288         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
27289         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("MS Email").Range("MSBody1").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
27290        With OutMail
27291            .To = "swindon.stock.centre@postoffice.co.uk"
27292            .Importance = 2
27293             .Subject = ThisWorkbook.Sheets("MS Email").Range("MSSubject1").Value
27294             .HTMLbody = strbody
27295             .DISPLAY
27296        End With
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27297     Set OutMail = Nothing
27298     Set OutApp = Nothing
         
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27299     With Application
27300         .ScreenUpdating = True
27301         .EnableEvents = True
27302     End With
      'End If

27303 ShutDown
27304 Exit Sub
error_proc:
27305     If MsgBox("Error has occured with subroutine [MSGenerator1]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27306     ShutDown
End Sub

Sub ALGenerator7()
      Dim OutApp As Object
      Dim strbody As String

27307 On Error GoTo error_proc
27308 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27309         With Application
27310             .ScreenUpdating = False
27311             .EnableEvents = False
27312         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27313         Set OutApp = CreateObject("Outlook.Application")
27314         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
27315         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body6").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
27316        With OutMail
27317            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
27318            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
27319            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
27320            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
27321            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
27322            .Importance = 2
27323             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject2").Value
27324             .HTMLbody = strbody
'27325             .DISPLAY
         'ADD Attachments
                  
27326         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
27327             Call CRL
27328         End If
27329             strFile = "New Royal Mail Account Guides.zip"
27330             strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
27331             strPath = Environ$("temp") & "\" & strFile
27332             Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
27333             .Attachments.Add (Environ$("temp") & "\" & strFile)
27334             Kill Environ$("temp") & "\" & strFile
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'27335         .DISPLAY
27336         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
       
       
27337         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
27338             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
27339                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
27340                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
27341                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
27342                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
27343                 End If
27344             Else
27346                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
27347                    MsgBox "A special pricing letter is required, please add manually to T&Cs email"
27348                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
27349                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
27350                 End If
27351             End If
27352         End If
              
27353         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
27354             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
27355                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
27356                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
27357                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
27358                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
27359                     End If
27360             Else
27361                 If Sheet2.Range("Special.HV").Value <> "On" Then
27362                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
27363                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
27364                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
27365                 End If
27366             End If
27367         End If
              
27368         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
27369             If Sheet2.Range("Special.LBT").Value <> "On" Then
27370                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
27371             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
27372                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
27373             End If
27374         End If

              
27375         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
27376             If Sheet2.Range("Special.Flat").Value <> "On" Then
27377                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
27378             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
27379                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
27380             End If
27381         End If
              
27382         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
27383             If Sheet2.Range("Special.Returns").Value <> "On" Then
27384                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
27385             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
27386                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
27387             End If
27388         End If
              
27389         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
27390             If Sheet2.Range("Special.LBT").Value <> "On" Then
27391                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
27392             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
2739                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
27393             End If
27394         End If
              
27395         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
27396             If Sheet2.Range("Special.SoW").Value <> "On" Then
27397                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
27398             Else
27399                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
27400                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
27401                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
27402                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
27403                         Call SavePDF
27404                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
27405                         Sheets("Form").Activate
27406                     End If
27407                 Else
27408                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
27409                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
27410                     Call SavePDF
27411                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
27412                     Sheets("Form").Activate
27413                 End If
27414             End If
27415         End If
              
27416         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
27417             If ThisWorkbook.Sheets("CONTROL.Letters").Range("IntErr").Value = True Then
27418             MsgBox "The level of discount offered for International Country Priced products on this form appears to be inconsistant. The automatically generated letter will refer to the maximum offered discount only."
27419             End If
27420             Call INTCNT
27421         End If

27422        If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
27423                 Call INTRT
27424         End If
              
27425         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
27426                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
27427         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
27428     Set OutMail = Nothing
27429     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27430     With Application
27431         .ScreenUpdating = True
27432         .EnableEvents = True
27433     End With
      'End If

27434 ShutDown
27435 Exit Sub
error_proc:
27436     If MsgBox("Error has occured with subroutine [ALGenerator6]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27437     ShutDown

End Sub

Sub ALGenerator8()
      Dim OutApp As Object
      Dim strbody As String

36090 On Error GoTo error_proc
36100 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
36110         With Application
36120             .ScreenUpdating = False
36130             .EnableEvents = False
36140         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
36150         Set OutApp = CreateObject("Outlook.Application")
36160         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
36170         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body6").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
36180        With OutMail
36190            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
36200            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
36210            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
36211            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
36212            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
36220            .Importance = 2
36230             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject2").Value
36240             .HTMLbody = strbody
'36250             .DISPLAY
         'ADD Attachments
                  
36360         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
36370             Call CRL
36280         End If

      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'36290         .DISPLAY
36300         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If
       
36310         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
36320             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
36330                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
36340                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
36350                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
36351                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
36352                 End If
36353             Else
36354                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
36455                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
36456                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
36420                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
36430                 End If
36440             End If
36450         End If
              
36460         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
36470             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
36480                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
36490                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
36500                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
36510                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
36520                     End If
36530             Else
36540                 If Sheet2.Range("Special.HV").Value <> "On" Then
36550                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
36560                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
36570                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
36580                 End If
36590             End If
36600         End If
              
36610         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
36620             If Sheet2.Range("Special.LBT").Value <> "On" Then
36630                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
36640             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
36650                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
36660             End If
36670         End If

              
36680         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
36690             If Sheet2.Range("Special.Flat").Value <> "On" Then
36700                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
36710             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
36720                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
36730             End If
36740         End If
              
36750         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
36760             If Sheet2.Range("Special.Returns").Value <> "On" Then
36770                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
36780             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
36790                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
36800             End If
36810         End If
              
36820         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
36830             If Sheet2.Range("Special.LBT").Value <> "On" Then
36840                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
36850             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
36860                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
36870             End If
36880         End If
              
36890         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
36900             If Sheet2.Range("Special.SoW").Value <> "On" Then
36910                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
36920             Else
36930                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
36940                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
36950                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
36960                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
36970                         Call SavePDF
36980                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
36990                         Sheets("Form").Activate
37000                     End If
37010                 Else
37020                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
37030                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
37040                     Call SavePDF
37050                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
37060                     Sheets("Form").Activate
37070                 End If
37080             End If
37090         End If
              
37100         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
37110             If ThisWorkbook.Sheets("CONTROL.Letters").Range("IntErr").Value = True Then
37120             MsgBox "The level of discount offered for International Country Priced products on this form appears to be inconsistant. The automatically generated letter will refer to the maximum offered discount only."
37130             End If
37140             Call INTCNT
37150         End If

37151         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
37152                 Call INTRT
37153         End If
              
37160         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
37170                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
37180         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
37190     Set OutMail = Nothing
37200     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
37210     With Application
37220         .ScreenUpdating = True
37230         .EnableEvents = True
37240     End With
      'End If

37250 ShutDown
37360 Exit Sub
error_proc:
37370     If MsgBox("Error has occured with subroutine [ALGenerator6]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
37280     ShutDown

End Sub

Sub ALGenerator9()
      Dim OutApp As Object
      Dim strbody As String

46090 On Error GoTo error_proc
46100 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
46110         With Application
46140             .ScreenUpdating = False
46141             .EnableEvents = False
46142         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
46150         Set OutApp = CreateObject("Outlook.Application")
46160         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
46170         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body6").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
46180        With OutMail
46190            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
46400            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
46210            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
46211            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
46212            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
46240            .Importance = 2
46230             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject2").Value
46231             .HTMLbody = strbody

40230             strFile = "New Royal Mail Account Guides.zip"
40240             strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\" & strFile
40250             strPath = Environ$("temp") & "\" & strFile
40460             Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)
40470             .Attachments.Add (Environ$("temp") & "\" & strFile)
40280             Kill Environ$("temp") & "\" & strFile
'46250             .DISPLAY
         'ADD Attachments
                  
46460         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
46470             Call CRL
46280         End If

              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'46290         .DISPLAY
46300         End With
      'Special pricing moved to Account Live 19/04/4017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
       
       
56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If

46310         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
46320             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
46330                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
46340                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
46350                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
46360                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
46370                 End If
46380             Else
46390                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
46401                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
46410                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
46440                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
46430                 End If
46441             End If
46450         End If
              
46461         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
46471             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
46480                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
46490                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
46500                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
46510                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
46540                     End If
46530             Else
46541                 If Sheet2.Range("Special.HV").Value <> "On" Then
46550                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
46560                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
46570                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
46580                 End If
46590             End If
46600         End If
              
46610         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
46640             If Sheet2.Range("Special.LBT").Value <> "On" Then
46630                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
46641             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
46650                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
46660             End If
46670         End If

              
46680         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
46690             If Sheet2.Range("Special.Flat").Value <> "On" Then
46700                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
46710             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
46740                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
46730             End If
46741         End If
              
46750         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
46760             If Sheet2.Range("Special.Returns").Value <> "On" Then
46770                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
46780             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
46790                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
46800             End If
46810         End If
              
46840         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
46830             If Sheet2.Range("Special.LBT").Value <> "On" Then
46841                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
46850             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
46860                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
46870             End If
46880         End If
              
46890         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
46900             If Sheet2.Range("Special.SoW").Value <> "On" Then
46910                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
46940             Else
46930                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
46941                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
46950                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
46960                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
46970                         Call SavePDF
46980                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
46990                         Sheets("Form").Activate
47000                     End If
47010                 Else
47040                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
47030                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
47041                     Call SavePDF
47050                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
47060                     Sheets("Form").Activate
47070                 End If
47080             End If
47090         End If
              
47100         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
47110             If ThisWorkbook.Sheets("CONTROL.Letters").Range("IntErr").Value = True Then
47140             MsgBox "The level of discount offered for International Country Priced products on this form appears to be inconsistant. The automatically generated letter will refer to the maximum offered discount only."
47130             End If
47141             Call INTCNT
47150         End If

47151         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
47152                 Call INTRT
47153         End If
              
47160         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
47170                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
47180         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
47190     Set OutMail = Nothing
47400     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
47210     With Application
47240         .ScreenUpdating = True
47230         .EnableEvents = True
47241     End With
      'End If

47250 ShutDown
47460 Exit Sub
error_proc:
47470     If MsgBox("Error has occured with subroutine [ALGenerator6]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
47280     ShutDown

End Sub

Sub ALGenerator10()
      Dim OutApp As Object
      Dim strbody As String

56090 On Error GoTo error_proc
56100 StartUp
      'Call TnCProducts
      'OKFlag = False
      'Load TandCForm
      'TandCForm.Show
      'Unload TandCForm

      'If OKFlag = True Then
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
56110         With Application
56120             .ScreenUpdating = False
56130             .EnableEvents = False
56140         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
56150         Set OutApp = CreateObject("Outlook.Application")
56160         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
56170         strbody = "<font face=calibri>" & ThisWorkbook.Sheets("New AL Email").Range("AL.Body6").Value
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
56180        With OutMail
56190            .To = ThisWorkbook.Sheets("Form").Range("MCC.Email").Value
56200            .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
56210            If ThisWorkbook.Sheets("CONTROL.Letters").Range("AnyLetter") Then .BCC = "CPL@royalmail.com" Else .BCC = ""
56211            If Range("Letters.Req.Int") = True Then .BCC = "internationalpricing@royalmail.com; " & .BCC
56212            If ThisWorkbook.Sheets("ListValues").Range("COPY_BUAM") = True Then .BCC = "barcodeunsortedaccountmail@royalmail.com; " & .BCC
56220            .Importance = 2
56230             .Subject = ThisWorkbook.Sheets("New AL Email").Range("AL.Subject2").Value
56240             .HTMLbody = strbody
'56250             .DISPLAY
         'ADD Attachments
                  
56560         If ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then
56570             Call CRL
56280         End If

              
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'56290         .DISPLAY
56300         End With
      'Special pricing moved to Account Live 19/04/2017
      'GoTo SkipSP:
       'ADD Special Pricing Letters
56310         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Tracked").Value = True Then
      '            MsgBox "A special pricing letter is required, please add manually to T&Cs email"
      '            GoTo SkipSP
56320             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
56330                 If Sheet2.Range("Special.Seasonal").Value <> "On" Then
56340                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56350                     Else
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Activate
56360                     Call RMTS
                          ''Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
                          'Sheets("Form").Activate
56370                 End If
56380             Else
56390                 If Sheet2.Range("Special.Tracked").Value <> "On" Then
56400                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56410                 Else
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED 24 48 LETTER").Activate
56420                     Call RMT
                          ''Worksheets("RM TRACKED 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
56430                 End If
56440             End If
56450         End If
              
56460         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.HV").Value = True Then
56470             If ThisWorkbook.Sheets("Form").Range("CUS.Seasonal").Value = True Then
56480                     If Sheet2.Range("Special.HVSeasonal").Value <> "On" Then
56490                             MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56500                     Else
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = True
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Activate
56510                             Call RMTHVS
                                  ''Worksheets("RM TRACKED HV 24 48 LETTER S").Visible = False
                                  'Sheets("Form").Activate
56520                     End If
56530             Else
56540                 If Sheet2.Range("Special.HV").Value <> "On" Then
56550                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56561                 Else
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = True
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Activate
56571                     Call RMTHV
                          ''Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
                          'Sheets("Form").Activate
56580                 End If
56590             End If
56600         End If
              
56610         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.HVLBT").Value = True Then
56620             If Sheet2.Range("Special.LBT").Value <> "On" Then
56630                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56640             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56650                 Call RMTLBHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56660             End If
56670         End If

              
56680         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.FlatRate").Value = True Then
56690             If Sheet2.Range("Special.Flat").Value <> "On" Then
56700                 MsgBox "The flat rate pricing letter is currently being reviewed and cannot be generated at this time. Please follow the agreed interim process."
56710             Else
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = True
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Activate
56720                 Call RM24FR
                      ''Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
                      'Sheets("Form").Activate
56730             End If
56740         End If
              
56750         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.TrackedReturns").Value = True Then
56760             If Sheet2.Range("Special.Returns").Value <> "On" Then
56770                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56780             Else
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = True
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Activate
56790                 Call RMTR
                      ''Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
                      'Sheets("Form").Activate
56800             End If
56810         End If
              
56820         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.TrackedLBT").Value = True Then
56830             If Sheet2.Range("Special.LBT").Value <> "On" Then
56840                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56850             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56860                 Call RMTLB
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56870             End If
56880         End If

56881         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Age").Value = True Then
56882             If Sheet2.Range("Special.A").Value <> "On" Then
56883                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56884             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56885                 Call RMTA
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56886             End If
56887         End If

56888         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.AgeHV").Value = True Then
56889             If Sheet2.Range("Special.AHV").Value <> "On" Then
56890                     MsgBox "A special pricing letter is required, please add manually to T&Cs email"
56891             Else
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = True
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Activate
56892                 Call RMTAHV
                      ''Worksheets("RM TRACKED 24 48 LETTER LBT").Visible = False
                      'Sheets("Form").Activate
56893             End If
56894         End If



              
56895         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.SOW").Value = True Then
56900             If Sheet2.Range("Special.SoW").Value <> "On" Then
56910                     MsgBox "A Share of Wallet special pricing letter is required, please add manually to T&Cs email"
56920             Else
56930                 If ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWError") Then
56940                     If MsgBox("A Share of Wallet letter is required, but a potential problem has been detected." & vbNewLine & ThisWorkbook.Sheets("CONTROL.Letters").Range("Special.SOWErrorType").Value & vbNewLine & "Do you want to continue anyway?", vbYesNo, "Share of Wallet Error") = vbYes Then
56950                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
56960                         Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
56970                         Call SavePDF
56980                         Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
56990                         Sheets("Form").Activate
57000                     End If
57010                 Else
57020                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = True
57030                     Worksheets("RM TRACKED 24 48 LETTER SOW").Activate
57040                     Call SavePDF
57050                     Worksheets("RM TRACKED 24 48 LETTER SOW").Visible = False
57060                     Sheets("Form").Activate
57070                 End If
57080             End If
57090         End If
              
57100         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.Int").Value = True Then
57110             If ThisWorkbook.Sheets("CONTROL.Letters").Range("IntErr").Value = True Then
57120             MsgBox "The level of discount offered for International Country Priced products on this form appears to be inconsistant. The automatically generated letter will refer to the maximum offered discount only."
57130             End If
57140             Call INTCNT
57150         End If

57151         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.IntRt").Value = True Then
57152                 Call INTRT
57153         End If
              
57160         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Letters.Req.None").Value = True Then
57170                     MsgBox "There is no template for one of the included special priced products (eg. Annual VRD products). The Special Pricing Team should be sending a letter to the customer."
57180         End If
         ''''''''''''''
SkipSP:
21181     OutMail.DISPLAY
57190     Set OutMail = Nothing
57200     Set OutApp = Nothing
          
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
57210     With Application
57220         .ScreenUpdating = True
57230         .EnableEvents = True
57240     End With
      'End If

57250 ShutDown
57560 Exit Sub
error_proc:
57570     If MsgBox("Error has occured with subroutine [ALGenerator6]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form v44.2&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
57280     ShutDown

End Sub





Attribute VB_Name = "CHAccounts"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_dtnext_due As Date
Private m_dtnext_made_up_to As Date
Private m_boverdue As Boolean
Private m_objaccounting_reference_date As CHDate
Private m_objlast_accounts As CHLastAccounts

Private m_oProperties       As Collection

Private Sub Class_Initialize()

10        Set m_oProperties = New Collection
20        m_oProperties.Add "next_due"
30        m_oProperties.Add "next_made_up_to"
40        m_oProperties.Add "overdue"
          
End Sub
Public Function Construct(model As Object) As CHAccounts

          Dim prop As Variant
          
50        For Each prop In m_oProperties
60            On Error Resume Next
70                CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
80            On Error GoTo 0
90        Next prop
          
100       remainderMapping model
          
       
110       Set Construct = Me
          
End Function
Private Sub remainderMapping(model As Object)
        
120       Set m_objaccounting_reference_date = New CHDate
130       m_objaccounting_reference_date.Construct model.accounting_reference_date
          
140       Set m_objlast_accounts = New CHLastAccounts
150       m_objlast_accounts.Construct model.last_accounts
        
End Sub

Public Property Get next_due() As Date: next_due = m_dtnext_due: End Property

Public Property Let next_due(ByVal dtNewValue As Date): m_dtnext_due = dtNewValue: End Property

Public Property Get next_made_up_to() As Date: next_made_up_to = m_dtnext_made_up_to: End Property

Public Property Let next_made_up_to(ByVal dtNewValue As Date): m_dtnext_made_up_to = dtNewValue: End Property

Public Property Get overdue() As Boolean: overdue = m_boverdue: End Property

Public Property Let overdue(ByVal bNewValue As Boolean): m_boverdue = bNewValue: End Property

Public Property Get accounting_reference_date() As CHDate: Set accounting_reference_date = m_objaccounting_reference_date: End Property

Public Property Set accounting_reference_date(ByVal objNewValue As CHDate): Set m_objaccounting_reference_date = objNewValue: End Property


Public Property Get last_accounts() As CHLastAccounts: Set last_accounts = m_objlast_accounts: End Property

Public Property Set last_accounts(ByVal objNewValue As CHLastAccounts): Set m_objlast_accounts = objNewValue: End Property
Attribute VB_Name = "CHAddress"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_saddress_line_1 As String
Private m_saddress_line_2 As String
Private m_scare_of As String
Private m_scountry As String
Private m_setag As String
Private m_slocality As String
Private m_spo_box As String
Private m_spostal_code As String
Private m_spremises As String
Private m_sregion As String

Private m_oProperties As Collection

Private Sub Class_Initialize()
          
160       Set m_oProperties = New Collection
          
170       m_oProperties.Add "address_line_1"
180       m_oProperties.Add "address_line_2"
190       m_oProperties.Add "care_of"
200       m_oProperties.Add "country"
210       m_oProperties.Add "etag"
220       m_oProperties.Add "locality"
230       m_oProperties.Add "po_box"
240       m_oProperties.Add "postal_code"
250       m_oProperties.Add "premises"
260       m_oProperties.Add "region"
          
End Sub
Public Function Construct(addressModel As Object) As CHAddress
          
          Dim prop As Variant
          
270       For Each prop In m_oProperties
280           On Error Resume Next
290               CallByName Me, prop, VbLet, CallByName(addressModel, prop, VbGet)
300           On Error GoTo 0
310       Next prop
          
320       Set Construct = Me
          
End Function

Public Property Get address_line_1() As String: address_line_1 = m_saddress_line_1: End Property

Public Property Let address_line_1(ByVal sNewValue As String): m_saddress_line_1 = sNewValue: End Property

Public Property Get address_line_2() As String: address_line_2 = m_saddress_line_2: End Property

Public Property Let address_line_2(ByVal sNewValue As String): m_saddress_line_2 = sNewValue: End Property

Public Property Get care_of() As String: care_of = m_scare_of: End Property

Public Property Let care_of(ByVal sNewValue As String): m_scare_of = sNewValue: End Property

Public Property Get Country() As String: Country = m_scountry: End Property

Public Property Let Country(ByVal sNewValue As String): m_scountry = sNewValue: End Property

Public Property Get etag() As String: etag = m_setag: End Property

Public Property Let etag(ByVal sNewValue As String): m_setag = sNewValue: End Property

Public Property Get locality() As String: locality = m_slocality: End Property

Public Property Let locality(ByVal sNewValue As String): m_slocality = sNewValue: End Property

Public Property Get po_box() As String: po_box = m_spo_box: End Property

Public Property Let po_box(ByVal sNewValue As String): m_spo_box = sNewValue: End Property

Public Property Get postal_code() As String: postal_code = m_spostal_code: End Property

Public Property Let postal_code(ByVal sNewValue As String): m_spostal_code = sNewValue: End Property

Public Property Get premises() As String: premises = m_spremises: End Property

Public Property Let premises(ByVal sNewValue As String): m_spremises = sNewValue: End Property

Public Property Get region() As String: region = m_sregion: End Property

Public Property Let region(ByVal sNewValue As String): m_sregion = sNewValue: End Property

Attribute VB_Name = "CHAnnualReturn"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_dtlast_made_up_to As Date
Private m_dtnext_due As Date
Private m_dtnext_made_up_to As Date
Private m_boverdue As Boolean


Private m_oProperties       As Collection
Private Sub Class_Initialize()

330       Set m_oProperties = New Collection
340       m_oProperties.Add "last_made_up_to"
350       m_oProperties.Add "next_due"
360       m_oProperties.Add "next_made_up_to"
370       m_oProperties.Add "overdue"
          
End Sub
Public Function Construct(model As Object) As CHAnnualReturn

          Dim prop As Variant
          
380       For Each prop In m_oProperties
390           On Error Resume Next
400               CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
410           On Error GoTo 0
420       Next prop
          
430       remainderMapping model
          
440       Set Construct = Me
          
End Function
Private Sub remainderMapping(model As Object)
    
        
End Sub

Public Property Get last_made_up_to() As Date: last_made_up_to = m_dtlast_made_up_to: End Property

Public Property Let last_made_up_to(ByVal dtNewValue As Date): m_dtlast_made_up_to = dtNewValue: End Property

Public Property Get next_due() As Date: next_due = m_dtnext_due: End Property

Public Property Let next_due(ByVal dtNewValue As Date): m_dtnext_due = dtNewValue: End Property

Public Property Get next_made_up_to() As Date: next_made_up_to = m_dtnext_made_up_to: End Property

Public Property Let next_made_up_to(ByVal dtNewValue As Date): m_dtnext_made_up_to = dtNewValue: End Property

Public Property Get overdue() As Boolean: overdue = m_boverdue: End Property

Public Property Let overdue(ByVal bNewValue As Boolean): m_boverdue = bNewValue: End Property

Attribute VB_Name = "CHCompany"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_bcan_file As Boolean
Private m_scompany_name As String
Private m_scompany_number As String
Private m_scompany_status As String
Private m_scompany_status_detail As String
Private m_dtdate_of_creation As Date
Private m_dtdate_of_dissolution As Date
Private m_setag As String
Private m_bhas_been_liquidated As Boolean
Private m_bhas_charges As Boolean
Private m_bhas_insolvency_history As Boolean
Private m_bis_community_interest_company As Boolean
Private m_sjurisdiction As String
Private m_dtlast_full_members_list_date As Date
Private m_bregistered_office_is_in_dispute As Boolean
Private m_scompany_type As String
Private m_bundeliverable_registered_office_address As Boolean
Private m_objaddress As CHAddress
Private m_objannual_return As CHAnnualReturn
Private m_objaccounts As CHAccounts
Private m_objconfirmation_statement As CHConfirmationStatement
Private m_objofficer_summary As CHOfficerSummary
Private m_objOfficers As CHOfficerList
Private m_objrequest As CompaniesHouseRequest




Private m_oProperties       As Collection

Private Sub Class_Initialize()

450       Set m_oProperties = New Collection
460       m_oProperties.Add "can_file"
470       m_oProperties.Add "company_name"
480       m_oProperties.Add "company_number"
490       m_oProperties.Add "company_status"
500       m_oProperties.Add "company_status_detail"
510       m_oProperties.Add "date_of_creation"
520       m_oProperties.Add "date_of_dissolution"
530       m_oProperties.Add "etag"
540       m_oProperties.Add "has_been_liquidated"
550       m_oProperties.Add "has_charges"
560       m_oProperties.Add "has_insolvency_history"
570       m_oProperties.Add "is_community_interest_company"
580       m_oProperties.Add "jurisdiction"
590       m_oProperties.Add "last_full_members_list_date"
600       m_oProperties.Add "registered_office_is_in_dispute"
610       m_oProperties.Add "undeliverable_registered_office_address"
          
End Sub

Public Function Construct(model As Object) As CHCompany

          Dim prop As Variant
          
620       For Each prop In m_oProperties
630           On Error Resume Next
640               CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
650           On Error GoTo 0
660       Next prop
          
670       remainderMapping model
          
680       Set Construct = Me
          
End Function

Private Sub remainderMapping(model As Object)
          
690       On Error Resume Next
700           Me.company_type = CallByName(model, "type", VbGet)
          
              'Registered Office Address
710           Set m_objaddress = New CHAddress
720           m_objaddress.Construct model.registered_office_address
              
              'Annual Return
730           Set m_objannual_return = New CHAnnualReturn
740           m_objannual_return.Construct model.annual_return
              
              'Accounts
750           Set m_objaccounts = New CHAccounts
760           m_objaccounts.Construct model.accounts
              
              'Officers
770           Set m_objofficer_summary = New CHOfficerSummary
780           m_objofficer_summary.Construct model.officer_summary
              
              'Confirmation Statement
790           Set m_objconfirmation_statement = New CHConfirmationStatement
800           m_objconfirmation_statement.Construct model.confirmation_statement
              
810       On Error GoTo 0
          
          
End Sub

Public Property Get officers() As CHOfficerList

          Dim parser As CompaniesHouseResponseParser
820       Set parser = New CompaniesHouseResponseParser
          
830       Set m_objOfficers = New CHOfficerList
840       m_objOfficers.Construct parser.parse(Me.request.BaseQuery("company/" & Me.company_number & "/officers"))
          
850       Set officers = m_objOfficers
          

End Property


Public Property Get can_file() As Boolean: can_file = m_bcan_file: End Property

Public Property Let can_file(ByVal bNewValue As Boolean): m_bcan_file = bNewValue: End Property

Public Property Get company_name() As String: company_name = m_scompany_name: End Property

Public Property Let company_name(ByVal sNewValue As String): m_scompany_name = sNewValue: End Property

Public Property Get company_number() As String: company_number = m_scompany_number: End Property

Public Property Let company_number(ByVal sNewValue As String): m_scompany_number = sNewValue: End Property

Public Property Get company_status() As String: company_status = m_scompany_status: End Property

Public Property Let company_status(ByVal sNewValue As String): m_scompany_status = sNewValue: End Property

Public Property Get company_status_detail() As String: company_status_detail = m_scompany_status_detail: End Property

Public Property Let company_status_detail(ByVal sNewValue As String): m_scompany_status_detail = sNewValue: End Property

Public Property Get date_of_creation() As Date: date_of_creation = m_dtdate_of_creation: End Property

Public Property Let date_of_creation(ByVal dtNewValue As Date): m_dtdate_of_creation = dtNewValue: End Property

Public Property Get date_of_dissolution() As Date: date_of_dissolution = m_dtdate_of_dissolution: End Property

Public Property Let date_of_dissolution(ByVal dtNewValue As Date): m_dtdate_of_dissolution = dtNewValue: End Property

Public Property Get etag() As String: etag = m_setag: End Property

Public Property Let etag(ByVal sNewValue As String): m_setag = sNewValue: End Property

Public Property Get has_been_liquidated() As Boolean: has_been_liquidated = m_bhas_been_liquidated: End Property

Public Property Let has_been_liquidated(ByVal bNewValue As Boolean): m_bhas_been_liquidated = bNewValue: End Property

Public Property Get has_charges() As Boolean: has_charges = m_bhas_charges: End Property

Public Property Let has_charges(ByVal bNewValue As Boolean): m_bhas_charges = bNewValue: End Property

Public Property Get has_insolvency_history() As Boolean: has_insolvency_history = m_bhas_insolvency_history: End Property

Public Property Let has_insolvency_history(ByVal bNewValue As Boolean): m_bhas_insolvency_history = bNewValue: End Property

Public Property Get is_community_interest_company() As Boolean: is_community_interest_company = m_bis_community_interest_company: End Property

Public Property Let is_community_interest_company(ByVal bNewValue As Boolean): m_bis_community_interest_company = bNewValue: End Property

Public Property Get jurisdiction() As String: jurisdiction = m_sjurisdiction: End Property

Public Property Let jurisdiction(ByVal sNewValue As String): m_sjurisdiction = sNewValue: End Property

Public Property Get last_full_members_list_date() As Date: last_full_members_list_date = m_dtlast_full_members_list_date: End Property

Public Property Let last_full_members_list_date(ByVal dtNewValue As Date): m_dtlast_full_members_list_date = dtNewValue: End Property

Public Property Get registered_office_is_in_dispute() As Boolean: registered_office_is_in_dispute = m_bregistered_office_is_in_dispute: End Property

Public Property Let registered_office_is_in_dispute(ByVal bNewValue As Boolean): m_bregistered_office_is_in_dispute = bNewValue: End Property

Public Property Get company_type() As String: company_type = m_scompany_type: End Property

Public Property Let company_type(ByVal sNewValue As String): m_scompany_type = sNewValue: End Property

Public Property Get undeliverable_registered_office_address() As Boolean: undeliverable_registered_office_address = m_bundeliverable_registered_office_address: End Property

Public Property Let undeliverable_registered_office_address(ByVal bNewValue As Boolean): m_bundeliverable_registered_office_address = bNewValue: End Property

Public Property Get registered_office_address() As CHAddress: Set registered_office_address = m_objaddress: End Property

Public Property Get accounts() As CHAccounts: Set accounts = m_objaccounts: End Property

Public Property Get confirmation_statement() As CHConfirmationStatement: Set confirmation_statement = m_objconfirmation_statement: End Property

Public Property Get annual_return() As CHAnnualReturn: Set annual_return = m_objannual_return: End Property

Public Property Get officer_summary() As CHOfficerSummary: Set officer_summary = m_objofficer_summary: End Property

Public Property Get request() As CompaniesHouseRequest: Set request = m_objrequest: End Property

Public Property Set request(ByVal objNewValue As CompaniesHouseRequest): Set m_objrequest = objNewValue: End Property
Attribute VB_Name = "CHConfirmationStatement"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_dtnext_due As Date
Private m_dtnext_made_up_to As Date
Private m_dtlast_made_up_to As Date
Private m_boverdue As Boolean

Private m_oProperties       As Collection

Private Sub Class_Initialize()

860       Set m_oProperties = New Collection
870       m_oProperties.Add "next_due"
880       m_oProperties.Add "next_made_up_to"
890       m_oProperties.Add "last_made_up_to"
900       m_oProperties.Add "overdue"
          
End Sub
Public Function Construct(model As Object) As CHAccounts

          Dim prop As Variant
          
910       For Each prop In m_oProperties
920           On Error Resume Next
930               CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
940           On Error GoTo 0
950       Next prop
          
960       remainderMapping model
          
       
970       Set Construct = Me
          
End Function
Private Sub remainderMapping(model As Object)
  
End Sub

Public Property Get next_due() As Date: next_due = m_dtnext_due: End Property

Public Property Let next_due(ByVal dtNewValue As Date): m_dtnext_due = dtNewValue: End Property

Public Property Get next_made_up_to() As Date: next_made_up_to = m_dtnext_made_up_to: End Property

Public Property Let next_made_up_to(ByVal dtNewValue As Date): m_dtnext_made_up_to = dtNewValue: End Property

Public Property Get last_made_up_to() As Date: next_made_up_to = m_dtlast_made_up_to: End Property

Public Property Let last_made_up_to(ByVal dtNewValue As Date): m_dtlast_made_up_to = dtNewValue: End Property

Public Property Get overdue() As Boolean: overdue = m_boverdue: End Property

Public Property Let overdue(ByVal bNewValue As Boolean): m_boverdue = bNewValue: End Property

Attribute VB_Name = "CHDate"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_lday As Long
Private m_lmonth As Long
Private m_lyear As Long

Private m_oProperties As Collection


Private Sub Class_Initialize()
          
980       Set m_oProperties = New Collection
          
990       m_oProperties.Add "day"
1000      m_oProperties.Add "month"
1010      m_oProperties.Add "year"
          
End Sub

Public Function Construct(model As Object) As CHDate

          Dim prop As Variant
          
1020      For Each prop In m_oProperties
1030          On Error Resume Next
1040              CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
1050          On Error GoTo 0
1060      Next prop
          
1070      Set Construct = Me
          
End Function

Public Property Get day() As Long: day = m_lday: End Property

Public Property Let day(ByVal lNewValue As Long): m_lday = lNewValue: End Property

Public Property Get month() As Long: month = m_lmonth: End Property

Public Property Let month(ByVal lNewValue As Long): m_lmonth = lNewValue: End Property

Public Property Get year() As Long: year = m_lyear: End Property

Public Property Let year(ByVal lNewValue As Long): m_lyear = lNewValue: End Property
Attribute VB_Name = "CHLastAccounts"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_dtmade_up_to As Date
Private m_saccount_type As String
Private m_oProperties       As Collection

Private Sub Class_Initialize()

1080      Set m_oProperties = New Collection
1090      m_oProperties.Add "made_up_to"

          
End Sub
Public Function Construct(model As Object) As CHLastAccounts
          Dim prop As Variant
          
1100      For Each prop In m_oProperties
1110          On Error Resume Next
1120              CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
1130          On Error GoTo 0
1140      Next prop
          
1150      remainderMapping model
          
1160      Set Construct = Me
          
End Function
Private Sub remainderMapping(model As Object)
              
1170      On Error Resume Next
1180          Me.account_type = CallByName(model, "type", VbGet)
1190      On Error GoTo 0
          
End Sub

Public Property Get made_up_to() As Date: made_up_to = m_dtmade_up_to: End Property

Public Property Let made_up_to(ByVal dtNewValue As Date): m_dtmade_up_to = dtNewValue: End Property

Public Property Get account_type() As String: account_type = m_saccount_type: End Property

Public Property Let account_type(ByVal sNewValue As String): m_saccount_type = sNewValue: End Property
Attribute VB_Name = "CHOfficer"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_dtappointed_on As Date
Private m_sname As String
Private m_sofficer_role As String
Private m_objdate_of_birth As CHDate
Private m_oProperties       As Collection

Private Sub Class_Initialize()

1200      Set m_oProperties = New Collection
1210      m_oProperties.Add "appointed_on"
1220      m_oProperties.Add "name"
1230      m_oProperties.Add "officer_role"
          
End Sub

Public Function Construct(model As Object) As CHOfficer
          Dim prop As Variant
          
1240      For Each prop In m_oProperties
1250          On Error Resume Next
1260              CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
1270          On Error GoTo 0
1280      Next prop
          
1290      remainderMapping model
          
1300      Set Construct = Me
          
End Function
Private Sub remainderMapping(model As Object)
          
1310      Set m_objdate_of_birth = New CHDate
1320      m_objdate_of_birth.Construct model.date_of_birth
          
End Sub

Public Property Get appointed_on() As Date: appointed_on = m_dtappointed_on: End Property

Public Property Let appointed_on(ByVal dtNewValue As Date): m_dtappointed_on = dtNewValue: End Property

Public Property Get name() As String: name = m_sname: End Property

Public Property Let name(ByVal sNewValue As String): m_sname = sNewValue: End Property

Public Property Get officer_role() As String: officer_role = m_sofficer_role: End Property

Public Property Let officer_role(ByVal sNewValue As String): m_sofficer_role = sNewValue: End Property

Public Property Get date_of_birth() As CHDate: Set date_of_birth = m_objdate_of_birth: End Property
Attribute VB_Name = "CHOfficerList"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private m_lactive_count As Long
Private m_setag As String
Private m_litems_per_page As Long
Private m_skind As String
Private m_lresigned_count As Long
Private m_lstart_index As Long
Private m_ltotal_results As Long

Private m_oOfficers         As Collection
Private m_oProperties       As Collection

Private Sub Class_Initialize()
1330      Set m_oProperties = New Collection
1340      m_oProperties.Add "active_count"
1350      m_oProperties.Add "etag"
1360      m_oProperties.Add "items_per_page"
1370      m_oProperties.Add "kind"
1380      m_oProperties.Add "resigned_count"
1390      m_oProperties.Add "start_index"
1400      m_oProperties.Add "total_results"
End Sub
Public Function Construct(model As Object) As CHOfficerList
          Dim prop As Variant
          
1410      For Each prop In m_oProperties
1420          On Error Resume Next
1430              CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
1440          On Error GoTo 0
1450      Next prop
          
1460      remainderMapping model
          
1470      Set Construct = Me
          
End Function
Private Sub remainderMapping(model As Object)
          
1480      Set m_oOfficers = New Collection
          
          
          Dim x As Long
          Dim Item As CHOfficerListItem
1490      Set model = CallByName(model, "items", VbGet)
          'Add the officers
1500      For x = 0 To Me.active_count - 1
1510          Set Item = New CHOfficerListItem
1520          Item.Construct CallByName(model, x, VbGet)
1530          m_oOfficers.Add Item
1540      Next x
          
End Sub

Public Property Get NewEnum() As IUnknown
Attribute NewEnum.VB_UserMemId = -4
1550      Set NewEnum = m_oOfficers.[_NewEnum]
End Property

Public Property Get Item(Index As Variant) As CHOfficer
Attribute Item.VB_UserMemId = 0
1560      Set Item = m_oOfficers.Item(Index)
End Property


Public Property Get active_count() As Long: active_count = m_lactive_count: End Property

Public Property Let active_count(ByVal lNewValue As Long): m_lactive_count = lNewValue: End Property

Public Property Get etag() As String: etag = m_setag: End Property

Public Property Let etag(ByVal sNewValue As String): m_setag = sNewValue: End Property

Public Property Get items_per_page() As Long: items_per_page = m_litems_per_page: End Property

Public Property Let items_per_page(ByVal lNewValue As Long): m_litems_per_page = lNewValue: End Property

Public Property Get kind() As String: kind = m_skind: End Property

Public Property Let kind(ByVal sNewValue As String): m_skind = sNewValue: End Property

Public Property Get resigned_count() As Long: resigned_count = m_lresigned_count: End Property

Public Property Let resigned_count(ByVal lNewValue As Long): m_lresigned_count = lNewValue: End Property

Public Property Get start_index() As Long: start_index = m_lstart_index: End Property

Public Property Let start_index(ByVal lNewValue As Long): m_lstart_index = lNewValue: End Property

Public Property Get total_results() As Long: total_results = m_ltotal_results: End Property

Public Property Let total_results(ByVal lNewValue As Long): m_ltotal_results = lNewValue: End Property
Attribute VB_Name = "CHOfficerListItem"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private m_dtappointed_on As Date
Private m_scountry_of_residence As String
Private m_sname As String
Private m_snationality As String
Private m_soccupation As String
Private m_sofficer_role As String
Private m_dtresigned_on As Date
Private m_objaddress As CHAddress
Private m_objdate_of_birth As CHDate



Private m_oProperties       As Collection

Private Sub Class_Initialize()
1570      Set m_oProperties = New Collection
1580      m_oProperties.Add "appointed_on"
1590      m_oProperties.Add "country_of_residence"
1600      m_oProperties.Add "name"
1610      m_oProperties.Add "nationality"
1620      m_oProperties.Add "occupation"
1630      m_oProperties.Add "officer_role"
1640      m_oProperties.Add "resigned_on"
End Sub
Public Function Construct(model As Object) As CHOfficerListItem
          Dim prop As Variant
          
1650      For Each prop In m_oProperties
1660          On Error Resume Next
1670              CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
1680          On Error GoTo 0
1690      Next prop
          
1700      remainderMapping model
          
1710      Set Construct = Me
          
End Function
Private Sub remainderMapping(model As Object)
          
1720      On Error Resume Next
1730          Set m_objdate_of_birth = New CHDate
1740          m_objdate_of_birth.Construct model.date_of_birth
1750      On Error GoTo 0
          
1760      Set m_objaddress = New CHAddress
1770      m_objaddress.Construct model.address
          
End Sub

Public Property Get appointed_on() As Date: appointed_on = m_dtappointed_on: End Property

Public Property Let appointed_on(ByVal dtNewValue As Date): m_dtappointed_on = dtNewValue: End Property

Public Property Get country_of_residence() As String: country_of_residence = m_scountry_of_residence: End Property

Public Property Let country_of_residence(ByVal sNewValue As String): m_scountry_of_residence = sNewValue: End Property

Public Property Get name() As String: name = m_sname: End Property

Public Property Let name(ByVal sNewValue As String): m_sname = sNewValue: End Property

Public Property Get nationality() As String: nationality = m_snationality: End Property

Public Property Let nationality(ByVal sNewValue As String): m_snationality = sNewValue: End Property

Public Property Get occupation() As String: occupation = m_soccupation: End Property

Public Property Let occupation(ByVal sNewValue As String): m_soccupation = sNewValue: End Property

Public Property Get officer_role() As String: officer_role = m_sofficer_role: End Property

Public Property Let officer_role(ByVal sNewValue As String): m_sofficer_role = sNewValue: End Property

Public Property Get resigned_on() As Date: resigned_on = m_dtresigned_on: End Property

Public Property Let resigned_on(ByVal dtNewValue As Date): m_dtresigned_on = dtNewValue: End Property

Public Property Get address() As CHAddress: Set address = m_objaddress: End Property

Public Property Set address(ByVal objNewValue As CHAddress): Set m_objaddress = objNewValue: End Property

Public Property Get date_of_birth() As CHDate: Set date_of_birth = m_objdate_of_birth: End Property

Public Property Set date_of_birth(ByVal objNewValue As CHDate): Set m_objdate_of_birth = objNewValue: End Property
Attribute VB_Name = "CHOfficerSummary"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_lactive_count     As Long
Private m_lresigned_count   As Long
Private m_oProperties       As Collection
Private m_oOfficers         As Collection

Private Sub Class_Initialize()

1780      Set m_oProperties = New Collection
1790      m_oProperties.Add "active_count"
1800      m_oProperties.Add "resigned_count"
          
1810      Set m_oOfficers = New Collection
          
End Sub

Public Function Construct(model As Object) As CHOfficerSummary

          Dim prop As Variant
          
1820      For Each prop In m_oProperties
1830          On Error Resume Next
1840              CallByName Me, prop, VbLet, CallByName(model, prop, VbGet)
1850          On Error GoTo 0
1860      Next prop
          
1870      remainderMapping model
          
1880      Set Construct = Me

End Function
Private Sub remainderMapping(model As Object)
          
          
          Dim x As Long
          Dim Item As CHOfficer
          
          'Add the officers
1890      For x = 0 To Me.active_count - 1
1900          Set Item = New CHOfficer
1910          Item.Construct CallByName(model, x, VbGet)
1920          m_oOfficers.Add Item
1930      Next x
          
End Sub

Public Property Get NewEnum() As IUnknown
Attribute NewEnum.VB_UserMemId = -4
1940      Set NewEnum = m_oOfficers.[_NewEnum]
End Property

Public Property Get Item(Index As Variant) As CHOfficer
Attribute Item.VB_UserMemId = 0
1950      Set Item = m_oOfficers.Item(Index)
End Property


Public Property Get active_count() As Long: active_count = m_lactive_count: End Property

Public Property Let active_count(ByVal lNewValue As Long): m_lactive_count = lNewValue: End Property

Public Property Get resigned_count() As Long: resigned_count = m_lresigned_count: End Property

Public Property Let resigned_count(ByVal lNewValue As Long): m_lresigned_count = lNewValue: End Property
Attribute VB_Name = "CHSearchResultCompany"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_skind             As String
Private m_litems_per_page   As Long
Private m_lpage_number      As Long
Private m_lstart_index      As Long
Private m_ltotal_results    As Long
Private m_oItems            As Collection

Private m_oProperties       As Collection

Private Sub Class_Initialize()

1960      Set m_oItems = New Collection
          
1970      Set m_oProperties = New Collection
1980      m_oProperties.Add "kind"
1990      m_oProperties.Add "items_per_page"
2000      m_oProperties.Add "page_number"
2010      m_oProperties.Add "start_index"
2020      m_oProperties.Add "total_results"

          
End Sub

Private Sub Class_Terminate()
2030      Set m_oItems = Nothing
End Sub

Public Property Get NewEnum() As IUnknown
Attribute NewEnum.VB_UserMemId = -4
2040      Set NewEnum = m_oItems.[_NewEnum]
End Property

Public Property Get Item(Index As Variant) As CHSearchResultItemCompany
Attribute Item.VB_UserMemId = 0
2050      Set Item = m_oItems.Item(Index)
End Property

Public Function Construct(responseModel As Object) As CHSearchResultCompany
          
          Dim Item    As CHSearchResultItemCompany
          Dim jItem   As Object
          Dim prop    As Variant
          Dim x       As Long
          Dim length  As Long
          
2060      For Each prop In m_oProperties
2070          On Error Resume Next
2080          CallByName Me, prop, VbLet, CallByName(responseModel, prop, VbGet)
2090      Next prop
          
2100      If Me.items_per_page >= Me.total_results Then length = Me.total_results Else length = Me.items_per_page
          
2110      For x = 0 To length - 1
2120          Set Item = New CHSearchResultItemCompany
2130          Set jItem = CallByName(CallByName(responseModel, "items", VbGet), x, VbGet)
2140          Item.Construct jItem
2150          m_oItems.Add Item
2160      Next x

End Function

Public Property Get kind() As String: kind = m_skind: End Property

Public Property Let kind(ByVal sNewValue As String): m_skind = sNewValue: End Property

Public Property Get items_per_page() As Long: items_per_page = m_litems_per_page: End Property

Public Property Let items_per_page(ByVal lNewValue As Long): m_litems_per_page = lNewValue: End Property

Public Property Get page_number() As Long: page_number = m_lpage_number: End Property

Public Property Let page_number(ByVal lNewValue As Long): m_lpage_number = lNewValue: End Property

Public Property Get start_index() As Long: start_index = m_lstart_index: End Property

Public Property Let start_index(ByVal lNewValue As Long): m_lstart_index = lNewValue: End Property

Public Property Get total_results() As Long: total_results = m_ltotal_results: End Property

Public Property Let total_results(ByVal lNewValue As Long): m_ltotal_results = lNewValue: End Property
Attribute VB_Name = "CHSearchResultItemCompany"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_lappointment_count As Long
Private m_sdescription As String
Private m_skind As String
Private m_ssnippit As String
Private m_stitle As String
Private m_scompany_number As String
Private m_scompany_status As String
Private m_scompany_type As String
Private m_sdate_of_creation As String
Private m_objaddress As CHAddress

Private m_oProperties As Collection

Private Sub Class_Initialize()
          
2170      Set m_oProperties = New Collection
          
2180      m_oProperties.Add "appointment_count"
2190      m_oProperties.Add "description"
2200      m_oProperties.Add "kind"
2210      m_oProperties.Add "snippit"
2220      m_oProperties.Add "title"
2230      m_oProperties.Add "company_number"
2240      m_oProperties.Add "company_status"
2250      m_oProperties.Add "company_type"
2260      m_oProperties.Add "date_of_creation"
          
End Sub

Public Function Construct(itemModel As Object) As CHSearchResultItemCompany
          
          Dim prop As Variant
          
2270      For Each prop In m_oProperties
2280          On Error Resume Next
2290              CallByName Me, prop, VbLet, CallByName(itemModel, prop, VbGet)
2300          On Error GoTo 0
2310      Next prop
          
2320      On Error Resume Next
2330          Set m_objaddress = New CHAddress
2340          m_objaddress.Construct itemModel.address
2350      On Error GoTo 0
          
2360      Set Construct = Me

End Function

Public Property Get Properties() As Collection: Set Properties = m_oProperties: End Property

Public Property Get appointment_count() As Long: appointment_count = m_lappointment_count: End Property

Public Property Let appointment_count(ByVal lNewValue As Long): m_lappointment_count = lNewValue: End Property

Public Property Get description() As String: description = m_sdescription: End Property

Public Property Let description(ByVal sNewValue As String): m_sdescription = sNewValue: End Property

Public Property Get kind() As String: kind = m_skind: End Property

Public Property Let kind(ByVal sNewValue As String): m_skind = sNewValue: End Property

Public Property Get snippit() As String: snippit = m_ssnippit: End Property

Public Property Let snippit(ByVal sNewValue As String): m_ssnippit = sNewValue: End Property

Public Property Get Title() As String: Title = m_stitle: End Property

Public Property Let Title(ByVal sNewValue As String): m_stitle = sNewValue: End Property

Public Property Get company_number() As String: company_number = m_scompany_number: End Property

Public Property Let company_number(ByVal sNewValue As String): m_scompany_number = sNewValue: End Property

Public Property Get company_status() As String: company_status = m_scompany_status: End Property

Public Property Let company_status(ByVal sNewValue As String): m_scompany_status = sNewValue: End Property

Public Property Get company_type() As String: company_type = m_scompany_type: End Property

Public Property Let company_type(ByVal sNewValue As String): m_scompany_type = sNewValue: End Property

Public Property Get date_of_creation() As String: date_of_creation = m_sdate_of_creation: End Property

Public Property Let date_of_creation(ByVal sNewValue As String): m_sdate_of_creation = sNewValue: End Property

Public Property Get address() As CHAddress: Set address = m_objaddress: End Property
Attribute VB_Name = "CHSearchResultItemOfficer"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_lappointment_count    As Long
Private m_sdescription          As String
Private m_skind                 As String
Private m_ssnippet              As String
Private m_stitle                As String
Private m_objaddress            As CHAddress
Private m_objdate_of_birth      As CHDate

Private m_oProperties       As Collection

Private Sub Class_Initialize()

2370      Set m_oProperties = New Collection
          
2380      m_oProperties.Add "appointment_count"
2390      m_oProperties.Add "description"
2400      m_oProperties.Add "kind"
2410      m_oProperties.Add "snippet"
2420      m_oProperties.Add "title"
2430      m_oProperties.Add "address"
          
End Sub

Public Function Construct(itemModel As Object) As CHSearchResultItemOfficer
          
          Dim prop As Variant
          
2440      For Each prop In m_oProperties
2450          On Error Resume Next
2460              CallByName Me, prop, VbLet, CallByName(itemModel, prop, VbGet)
2470          On Error GoTo 0
2480      Next prop
          
2490      On Error Resume Next
2500          Set m_objaddress = New CHAddress
2510          m_objaddress.Construct itemModel.address
2520      On Error GoTo 0
          
2530      On Error Resume Next
2540          Set m_objdate_of_birth = New CHDate
2550          m_objdate_of_birth.Construct itemModel.date_of_birth
2560      On Error GoTo 0
          
2570      Set Construct = Me

End Function

Public Property Get appointment_count() As Long: appointment_count = m_lappointment_count: End Property

Public Property Let appointment_count(ByVal lNewValue As Long): m_lappointment_count = lNewValue: End Property

Public Property Get description() As String: description = m_sdescription: End Property

Public Property Let description(ByVal sNewValue As String): m_sdescription = sNewValue: End Property

Public Property Get kind() As String: kind = m_skind: End Property

Public Property Let kind(ByVal sNewValue As String): m_skind = sNewValue: End Property

Public Property Get snippet() As String: snippet = m_ssnippet: End Property

Public Property Let snippet(ByVal sNewValue As String): m_ssnippet = sNewValue: End Property

Public Property Get Title() As String: Title = m_stitle: End Property

Public Property Let Title(ByVal sNewValue As String): m_stitle = sNewValue: End Property

Public Property Get address() As CHAddress: Set address = m_objaddress: End Property

Public Property Get date_of_birth() As CHDate: Set date_of_birth = m_objdate_of_birth: End Property
Attribute VB_Name = "CHSearchResultOfficer"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private m_skind             As String
Private m_litems_per_page   As Long
Private m_lpage_number      As Long
Private m_lstart_index      As Long
Private m_ltotal_results    As Long
Private m_oItems            As Collection

Private m_oProperties       As Collection

Private Sub Class_Initialize()

2580      Set m_oItems = New Collection
          
2590      Set m_oProperties = New Collection
2600      m_oProperties.Add "kind"
2610      m_oProperties.Add "items_per_page"
2620      m_oProperties.Add "page_number"
2630      m_oProperties.Add "start_index"
2640      m_oProperties.Add "total_results"

          
End Sub

Private Sub Class_Terminate()
2650      Set m_oItems = Nothing
End Sub

Public Property Get NewEnum() As IUnknown
Attribute NewEnum.VB_UserMemId = -4
2660      Set NewEnum = m_oItems.[_NewEnum]
End Property

Public Property Get Item(Index As Variant) As CHSearchResultItemCompany
Attribute Item.VB_UserMemId = 0
2670      Set Item = m_oItems.Item(Index)
End Property

Public Function Construct(responseModel As Object) As CHSearchResultOfficer
          
          Dim Item    As CHSearchResultItemOfficer
          Dim jItem   As Object
          Dim prop    As Variant
          Dim x       As Long
          
2680      For Each prop In m_oProperties
2690          On Error Resume Next
2700          CallByName Me, prop, VbLet, CallByName(responseModel, prop, VbGet)
2710      Next prop
          
2720      For x = 0 To responseModel.items_per_page - 1
2730          Set Item = New CHSearchResultItemOfficer
2740          Set jItem = CallByName(CallByName(responseModel, "items", VbGet), x, VbGet)
2750          Item.Construct jItem
2760          m_oItems.Add Item
2770      Next x

End Function

Public Property Get kind() As String: kind = m_skind: End Property

Public Property Let kind(ByVal sNewValue As String): m_skind = sNewValue: End Property

Public Property Get items_per_page() As Long: items_per_page = m_litems_per_page: End Property

Public Property Let items_per_page(ByVal lNewValue As Long): m_litems_per_page = lNewValue: End Property

Public Property Get page_number() As Long: page_number = m_lpage_number: End Property

Public Property Let page_number(ByVal lNewValue As Long): m_lpage_number = lNewValue: End Property

Public Property Get start_index() As Long: start_index = m_lstart_index: End Property

Public Property Let start_index(ByVal lNewValue As Long): m_lstart_index = lNewValue: End Property

Public Property Get total_results() As Long: total_results = m_ltotal_results: End Property

Public Property Let total_results(ByVal lNewValue As Long): m_ltotal_results = lNewValue: End Property

Attribute VB_Name = "CH_API_Constants"
Option Explicit

Public Const BASE_URL_API = "https://api.companieshouse.gov.uk/"
Public Const API_KEY = "7PMHAs4OapDWffKjEb-jyYH8ZoG4wJ0Q9VqkgxNC"

Attribute VB_Name = "COMScript64"
Sub Test()

    Dim oSC As Object

    Set oSC = CreateObjectx86("MSScriptControl.ScriptControl") ' create ActiveX via x86 mshta host
    Debug.Print TypeName(oSC) ' ScriptControl
    ' do some stuff

    CreateObjectx86 , True ' close mshta host window at the end

End Sub

Function CreateObjectx86(Optional sProgID, Optional bClose = False)

    Static oWnd As Object
    Dim bRunning As Boolean

    #If Win64 Then
        bRunning = InStr(TypeName(oWnd), "HTMLWindow") > 0
        If bClose Then
            If bRunning Then oWnd.Close
            Exit Function
        End If
        If Not bRunning Then
            Set oWnd = CreateWindow()
            oWnd.execScript "Function CreateObjectx86(sProgID): Set CreateObjectx86 = CreateObject(sProgID): End Function", "VBScript"
        End If
        Set CreateObjectx86 = oWnd.CreateObjectx86(sProgID)
    #Else
        Set CreateObjectx86 = CreateObject(sProgID)
    #End If

End Function

Function CreateWindow()

    ' source http://forum.script-coding.com/viewtopic.php?pid=75356#p75356
    Dim sSignature, oShellWnd, oProc

    On Error Resume Next
    sSignature = Left(CreateObject("Scriptlet.TypeLib").GUID, 38)
    CreateObject("WScript.Shell").Run "%systemroot%\syswow64\mshta.exe about:""about:<head><script>moveTo(-32000,-32000);document.title='x86Host'</script><hta:application showintaskbar=no /><object id='shell' classid='clsid:8856F961-340A-11D0-A96B-00C04FD705A2'><param name=RegisterAsBrowser value=1></object><script>shell.putproperty('" & sSignature & "',document.parentWindow);</script></head>""", 0, False
    Do
        For Each oShellWnd In CreateObject("Shell.Application").Windows
            Set CreateWindow = oShellWnd.GetProperty(sSignature)
            If Err.Number = 0 Then Exit Function
            Err.Clear
        Next
    Loop

End Function


Attribute VB_Name = "CheckBoxes"
Option Explicit
Sub CheckBox35_Click()
27290 On Error GoTo error_proc
27300 Form.Unprotect Password:="fruitbasket"
27310 If Range("CHK.Salesperson") = True Then
27320     Range("CHK.CMC") = False
27321     Range("CHK.D2D") = False
27330     Range("CHK.SettingUp") = False
27340     Range("CHK.CustomerSolutions") = False
27350     Range("CHK.CollectionSetUp") = False
27360     Range("CHK.Operations") = False
27370     Range("CHK.SpecialPricing") = False
27380     SpecialPricing.Visible = False
27390     Range("CHK.Finance") = False
27400     FinanceAccountSetup.Visible = False
27410     Sheets("Collection Schedule").Visible = False
          
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
          
27420     Call PrintArea(Range("PrintAreaWide"), xlLandscape)
27430 End If
27440 Exit Sub
error_proc:
27450     If MsgBox("Error has occured with subroutine [CheckBox35]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27460     ShutDown
End Sub
Sub CheckBox36_Click()
27470 On Error GoTo error_proc
27480 Form.Unprotect Password:="fruitbasket"
27490 If Range("CHK.CMC") = True Then
27500     Range("CHK.Salesperson") = False
27510     Range("CHK.SettingUp") = False
27511     Range("CHK.D2D") = False
27520     Range("CHK.CustomerSolutions") = False
27530     Range("CHK.CollectionSetUp") = False
27540     Range("CHK.Operations") = False
27550     Range("CHK.SpecialPricing") = False
27560     SpecialPricing.Visible = False
27570     Range("CHK.Finance") = False
27580     FinanceAccountSetup.Visible = False
27590     Sheets("Collection Schedule").Visible = False
          
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
          
27600     Range("CHK.OpsAssessment") = False
          'Range("CHK.CreditCheck") = True
          'Range("CHK.CollectionSetupChange") = False TEST FIX FOR COLLECTIONS DISSAPERING AFTER GOING TO CMC
27610     Call PrintArea(Range("PrintAreaWide"), xlLandscape)
27620 End If
27630 Exit Sub
error_proc:
27640     If MsgBox("Error has occured with subroutine [CheckBox36]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27650     ShutDown
End Sub
Sub CheckBox37_Click()
27660 On Error GoTo error_proc
27670 Form.Unprotect Password:="fruitbasket"
27680 If Range("CHK.SettingUp") = True Then
27690     Range("CHK.Salesperson") = False
27691     Range("CHK.D2D") = False
27700     Range("CHK.CMC") = False
27710     Range("CHK.CustomerSolutions") = False
27720     Range("CHK.CollectionSetUp") = False
27730     Range("CHK.Operations") = False
27740     Range("CHK.SpecialPricing") = False
27750     SpecialPricing.Visible = False
27760     Range("CHK.Finance") = False
27770     FinanceAccountSetup.Visible = False
27780     Sheets("Collection Schedule").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
          
27790     Call CopyAccountNumber
27800     Call ProductCodeSummary
27810     Call PrintArea(Range("PrintAreaWide"), xlPortrait)
27820 End If
27830 Exit Sub
error_proc:
27840     If MsgBox("Error has occured with subroutine [CheckBox37]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27850     ShutDown
End Sub
Sub CheckBox38_Click()
27860 On Error GoTo error_proc
27870 Form.Unprotect Password:="fruitbasket"
27880 If Range("CHK.CustomerSolutions") = True Then
27890     Range("CHK.Salesperson") = False
27900     Range("CHK.CMC") = False
27901     Range("CHK.D2D") = False
27910     Range("CHK.SettingUp") = False
27920     Range("CHK.CollectionSetUp") = False
27930     Range("CHK.Operations") = False
27940     Range("CHK.SpecialPricing") = False
27950     SpecialPricing.Visible = False
27960     Range("CHK.Finance") = False
27970     FinanceAccountSetup.Visible = False
27980     Sheets("Collection Schedule").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
          
27990     Range("CHK.OpsAssessment") = False
28000     Range("CHK.CreditCheck") = False
          'Range("CHK.CollectionSetupChange") = False
          'Range("CHK.COSSSetup") = True
28010     Call CopyAccountNumber
28020     Call PrintArea(Range("PrintAreaWide"), xlLandscape)
28030 End If
28040 Exit Sub
error_proc:
28050     If MsgBox("Error has occured with subroutine [CheckBox38]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28060     ShutDown
End Sub
Sub CheckBox39_Click()
28070 On Error GoTo error_proc
28080 Form.Unprotect Password:="fruitbasket"
28090 If Range("CHK.CollectionSetUp") = True Then
28100     Range("CHK.Salesperson") = False
28110     Range("CHK.CMC") = False
28111     Range("CHK.D2D") = False
28120     Range("CHK.SettingUp") = False
28130     Range("CHK.CustomerSolutions") = False
28140     Range("CHK.Operations") = False
28150     Range("CHK.SpecialPricing") = False
28160     SpecialPricing.Visible = False
28170     Range("CHK.Finance") = False
28180     FinanceAccountSetup.Visible = False
          'Sheets("Collection Schedule").Visible = False
          
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
          
28190     Range("CHK.OpsAssessment") = False
28200     Range("CHK.CreditCheck") = False
          'Range("CHK.CollectionSetupChange") = True
28210     Range("CHK.COSSSetup") = False
28220     Call PrintArea(Range("PrintAreaNarrow"), xlPortrait)
      'Go to collections sheet
28230     Sheets("Collection Schedule").Visible = True
28240     Sheets("Collection Schedule").Activate
28250     Call Collections_Autofill
28260 End If
28270 Exit Sub
error_proc:
28280     If MsgBox("Error has occured with subroutine [CheckBox39]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28290     ShutDown
End Sub
Sub CheckBox40_Click()
28300 On Error GoTo error_proc
28310 Form.Unprotect Password:="fruitbasket"
28320 If Range("CHK.Operations") = True Then
28330     Range("CHK.Salesperson") = False
28340     Range("CHK.CMC") = False
28341     Range("CHK.D2D") = False
28350     Range("CHK.SettingUp") = False
28360     Range("CHK.CustomerSolutions") = False
28370     Range("CHK.CollectionSetUp") = False
28380     Range("CHK.SpecialPricing") = False
28390     SpecialPricing.Visible = False
28400     Range("CHK.Finance") = False
28410     FinanceAccountSetup.Visible = False
28420     Sheets("Collection Schedule").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
          'Range("CHK.OpsAssessment") = True
          'Range("CHK.CreditCheck") = False
          'Range("CHK.CollectionSetupChange") = False
28430     Range("CHK.COSSSetup") = False
28440     Call PrintArea(Range("PrintAreaNarrow"), xlPortrait)
28450 End If
28460 Exit Sub
error_proc:
28470     If MsgBox("Error has occured with subroutine [CheckBox40]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28480     ShutDown
End Sub
Sub CheckBox41_Click()
28490 On Error GoTo error_proc
28500 Form.Unprotect Password:="fruitbasket"
28510 If Range("CHK.SpecialPricing") = True Then
28520     Range("CHK.Salesperson") = False
28521     Range("CHK.D2D") = False
28530     Range("CHK.CMC") = False
28540     Range("CHK.SettingUp") = False
28550     Range("CHK.CustomerSolutions") = False
28560     Range("CHK.CollectionSetUp") = False
28570     Range("CHK.Operations") = False
28580     Range("CHK.Finance") = False
28590     FinanceAccountSetup.Visible = False
28600     Sheets("Collection Schedule").Visible = False
28610     Call PrintArea(Range("PrintAreaNarrow"), xlPortrait)
          
28620     SpecialPricing.Visible = True
28630     SpecialPricing.Select
28640 End If
28650 Exit Sub
error_proc:
28660     If MsgBox("Error has occured with subroutine [CheckBox41]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28670     ShutDown
End Sub
Sub CheckBox42_Click()
28680 On Error GoTo error_proc
28690 Form.Unprotect Password:="fruitbasket"
28700 If Range("CHK.Finance") = True Then
28710     Range("CHK.Salesperson") = False
28711     Range("CHK.D2D") = False
28720     Range("CHK.CMC") = False
28730     Range("CHK.SettingUp") = False
28740     Range("CHK.CustomerSolutions") = False
28750     Range("CHK.CollectionSetUp") = False
28760     Range("CHK.Operations") = False
28770     Range("CHK.SpecialPricing") = False
28780     SpecialPricing.Visible = False
28790     Sheets("Collection Schedule").Visible = False
28800     Call PrintArea(Range("PrintAreaNarrow"), xlPortrait)
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
28810     FinanceAccountSetup.Visible = True
28820     FinanceAccountSetup.Select
28830 End If
28840 Exit Sub
error_proc:
28850     If MsgBox("Error has occured with subroutine [CheckBox42]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28860     ShutDown
End Sub
Sub CHK_NewCustomerSetup_Click()
28870 On Error GoTo error_proc
28880 If Range("CHK.NewCustomerSetup") = True Then
28890     Range("CHK.NewAccountExistingCust") = False
28900     Range("CHK.AccountAddOn") = False
28901     Range("CHK.ShippingSolutionSetup") = True
28910     If MsgBox("STL & BPL product lines will be automaically added as these are no longer open products." & vbNewLine & vbNewLine & "Do you also want to automatically add UNA/UNB/UNG/UNH? (OBA users only)", vbYesNo, "Add Unsorted Products") = vbYes Then AddUNAUNB1 Else AddSTLBPL
28920 End If
28930 Exit Sub
error_proc:
28940     If MsgBox("Error has occured with subroutine [CHK_NewCustomerSetup_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28950     ShutDown
End Sub

Sub CHK_D2DSales_Click()
28951 On Error GoTo error_proc
28952     If MsgBox("Do you want automatically add HDS (Door to Door) and the other required supporting codes?) ", vbYesNo, "Add D2D Products") = vbYes Then AddD2D
28954 Exit Sub
error_proc:
28955     If MsgBox("Error has occured with subroutine [CHK_D2DSales_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28956     ShutDown
End Sub
Sub CHK_NewAccountExistingCust_Click()
28960 On Error GoTo error_proc
28970 If Range("CHK.NewAccountExistingCust") = True Then
28980     Range("CHK.NewCustomerSetup") = False
28990     Range("CHK.AccountAddOn") = False
29000     If MsgBox("STL & BPL product lines will be automaically added as these are no longer open products." & vbNewLine & vbNewLine & "Do you also want to automatically add UNA/UNB/UNG/UNH? (OBA users only)", vbYesNo, "Add Unsorted Products") = vbYes Then AddUNAUNB1 Else AddSTLBPL
29010 End If
29020 Exit Sub
error_proc:
29030     If MsgBox("Error has occured with subroutine [CHK_NewAccountExistingCust_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29040     ShutDown
End Sub
Sub CHK_AccountAddOn_Click()
29050 On Error GoTo error_proc
29060 If Range("CHK.AccountAddOn") = True Then
29070     Range("CHK.NewCustomerSetup") = False
29080     Range("CHK.NewAccountExistingCust") = False
29090 End If
29100 Exit Sub
error_proc:
29110     If MsgBox("Error has occured with subroutine [CHK_AccountAddOn_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29120     ShutDown
End Sub
Sub SelectMondayToFriday()
29130 On Error GoTo error_proc
29140 Form.Range("COL.Days.Mon") = True
29150 Form.Range("COL.Days.Tues") = True
29160 Form.Range("COL.Days.Wed") = True
29170 Form.Range("COL.Days.Thurs") = True
29180 Form.Range("COL.Days.Fri") = True
29190 Exit Sub
error_proc:
29200     If MsgBox("Error has occured with subroutine [SelectMondaytoFriday]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29210     ShutDown
End Sub
Sub CHK_CombinedApp_Inland_Click()
29220 On Error GoTo error_proc
29230 If Range("CHK.CombinedApp.Inland") = True Then
29240     Range("CHK.CombinedApp.Intl") = False
29250     Range("CHK.CombinedApp.InlandAndIntl") = False
29260 End If
29270 Exit Sub
error_proc:
29280     If MsgBox("Error has occured with subroutine [CHK_CombinedApp_Inland_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29290     ShutDown
End Sub
Sub CHK_CombinedApp_Intl_Click()
29300 On Error GoTo error_proc
29310 If Range("CHK.CombinedApp.Intl") = True Then
29320     Range("CHK.CombinedApp.Inland") = False
29330     Range("CHK.CombinedApp.InlandAndIntl") = False
29340 End If
29350 Exit Sub
error_proc:
29360     If MsgBox("Error has occured with subroutine [CHK_CombinedApp_Intl_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29370     ShutDown
End Sub
Sub CHK_CombinedApp_InlandAndIntl_Click()
29380 On Error GoTo error_proc
29390 If Range("CHK.CombinedApp.InlandAndIntl") = True Then
29400     Range("CHK.CombinedApp.Intl") = False
29410     Range("CHK.CombinedApp.Inland") = False
29420 End If
29430 Exit Sub
error_proc:
29440     If MsgBox("Error has occured with subroutine [CHK_CombinedApp_InlandAndIntl_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29450     ShutDown
End Sub
Sub NameCheckboxes()
      Dim cb As Object
29460 On Error GoTo error_proc
29470 For Each cb In Form.Shapes
29480     Debug.Print cb.name
29490 Next cb
29500 Exit Sub
error_proc:
29510     If MsgBox("Error has occured with subroutine [NameCheckBoxes]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29520     ShutDown
End Sub
Sub ShowCheckboxes()
      Dim cb As CheckBox
29530 On Error GoTo error_proc
29540 For Each cb In Form.CheckBoxes
29550     cb.Visible = True
29560 Next cb
29570 Exit Sub
error_proc:
29580     If MsgBox("Error has occured with subroutine [ShowCheckBoxes]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
29590     ShutDown
End Sub
Sub Collections_Autofill()
29600 On Error GoTo error_proc
29610 Sheets("Collection Schedule").Unprotect Password:="fruitbasket"
29620 Range("COLSchedule.Header") = Range("COL.Service")
29630 Range("COLSchedule.CusName") = Range("CUS.AccountName")
29640 Range("COLSchedule.ContactName") = Range("COL.PostTitle") & " " & Range("COL.PostFirstName") & " " & Range("COL.PostLastName")
29650 Range("COLSchedule.JobTitle") = Range("COL.PostJobTitle")
29660 Range("COLSchedule.ContactNumber") = Range("COL.PostPhone")
29670 Range("COLSchedule.Address1") = Range("COL.CollectionAddress1")
29680 Range("COLSchedule.Address2") = Range("COL.CollectionAddress2")
29690 Range("COLSchedule.Address3") = Range("COL.CollectionAddress3")
29700 Range("COLSchedule.AddressTown") = Range("COL.CollectionTown")
29710 Range("COLSchedule.AddressPostCode") = Range("COL.CollectionPostcode")
29720 Range("COLSchedule.Email") = Range("COL.PostEmail")
29730 Range("COLSchedule.BIL.Address1") = Range("BIL.Address1")
29740 Range("COLSchedule.BIL.Address2") = Range("BIL.Address2")
29750 Range("COLSchedule.BIL.Address3") = Range("BIL.Address3")
29760 Range("COLSchedule.BIL.AddressTown") = Range("BIL.Town")
29770 Range("COLSchedule.BIL.AddressPostCode") = Range("BIL.Postcode")
29780 Range("COLSchedule.FirstPostingDate") = Range("CUS.FirstPostingDate")
29790 Range("COLSchedule.Comments") = Range("ADD.Information")
29800 Range("COLSchedule.RMSAPBillingNo") = Range("CUS.RMSAPBillingNo")
29810 Range("COLSchedule.ServiceReq") = Range("COL.Service")
29820 Range("COLSchedule.BIL.Contact") = Range("BIL.Phone")
29830 Range("COLSchedule.SiebelNo") = Range("SST.SiebelNo")

      'Code for days
      Dim DaysWithoutComma As String
29840 If Range("COL.Days.Mon") Then
29850 DaysWithoutComma = "Mon, "
29860 End If
29870 If Range("COL.Days.Tues") Then
29880 DaysWithoutComma = DaysWithoutComma & "Tues, "
29890 End If
29900 If Range("COL.Days.Wed") Then
29910 DaysWithoutComma = DaysWithoutComma & "Wed, "
29920 End If
29930 If Range("COL.Days.Thurs") Then
29940 DaysWithoutComma = DaysWithoutComma & "Thurs, "
29950 End If
29960 If Range("COL.Days.Fri") Then
29970 DaysWithoutComma = DaysWithoutComma & "Fri, "
29980 End If
29990 If Range("COL.Days.Sat") Then
30000 DaysWithoutComma = DaysWithoutComma & "Sat, "
30010 End If
30020 If Range("COL.Days.Sun") Then
30030 DaysWithoutComma = DaysWithoutComma & "Sun, "
30040 End If
30050 If Not DaysWithoutComma = "" Then
30060 Range("COLSchedule.Days") = Left(DaysWithoutComma, Len(DaysWithoutComma) - 2)
30070 Else: Range("COLSchedule.Days") = ""
30080 End If

30090 Range("COLSchedule.ReqTime0") = Range("COL.ReqTime0")
30100 Range("COLSchedule.CloseTime") = Range("COL.CloseTime")
30110 Range("COLSchedule.Access") = Range("COL.Access")

30120 If Range("COL.Packaging") = "Other (please specify)" Then
30130 Range("COLSchedule.Packaging") = Range("COL.Packaging.Other")
30140 Else: Range("COLSchedule.Packaging") = Range("COL.Packaging")
30150 End If

30160 If Range("COL.ContType") = "Other (please specify)" Then
30170 Range("COLSchedule.ContType.Other") = Range("COL.ContType.Other")
30180 Else: Range("COLSchedule.ContType") = Range("COL.ContType")
30190 End If

30200 Range("COLSchedule.NoLongerUsed") = Range("COL.NoLongerUsed")
30210 Range("COLSchedule.Breakdown") = Range("COL.Breakdown")
30220 Range("COLSchedule.SecureVehicle") = Range("COL.SecureVehicle")

30230 If IsEmpty(Range("COL.Restricted")) Then
30240 Range("COLSchedule.Restricted") = "None"
30250     ElseIf Not (IsEmpty(Range("COL.RestrictedDetails"))) Then
30260     Range("COLSchedule.Restricted") = Range("COL.Restricted") & "% (" & Range("COL.RestrictedDetails") & ")"
30270     Else: Range("COLSchedule.Restricted") = Range("COL.Restricted") & "%"
30280 End If

30290 Range("COLSchedule.HealthSafety") = Range("COL.HealthSafety")
30300 Range("COLSchedule.EntryPoint") = Range("COL.EntryPoint")

30310 Range("COLSchedule.AvgVolume") = _
      "Letters: " & Range("COL.AvgVolume.Letter") & Chr(10) & _
      "Large letters: " & Range("COL.AvgVolume.LargeLetter") & Chr(10) & _
      "Letterboxable: " & Chr(10) & _
      "Small parcels: " & Range("COL.AvgVolume.Smallparcel") & Chr(10) & _
      "Medium parcels: " & Range("COL.AvgVolume.MediumParcel")


30320 Range("COLSchedule.VolProfile") = Range("COL.VolProfile")
30330 Range("COLSchedule.ExplainSeasonal") = Range("COL.ExplainSeasonal")
30340 Range("COLSchedule.VolForecast") = Range("COL.VolForecast")
30350 Range("COLSchedule.Point") = Range("COL.Point")

30360 Range("COLSchedule.FalltoEarth") = _
      "UK Mainland: " & Range("COL.FalltoEarthUK") * 100 & "%" & Chr(10) & _
      "Highlands & Islands: " & Range("COL.FalltoEarthHIGH") * 100 & "%" & Chr(10) & _
      "Northern Ireland: " & Range("COL.FalltoEarthNI") * 100 & "%" & Chr(10) & _
      "International: " & Range("COL.FalltoEarthInt") * 100 & "%"

      'Sheets("Collection Schedule").Protect Password:="fruitbasket"
30370 Exit Sub
error_proc:
30380     If MsgBox("Error has occured with subroutine [Collections_Autofill]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
30390     ShutDown
End Sub
Sub SUSHide_Click()
30400 On Error GoTo error_proc
30410     If Range("CHK.SettingUp") Then
30420         Range("CHK.SUSHide") = Not (Range("CHK.SUSHide"))
30430     If Range("CHK.SUSHide") Then
30440         Rows("10:12").EntireRow.Hidden = False
30450             Else
30460         Rows("10:12").EntireRow.Hidden = True
30470         End If
30480     End If
30490 Exit Sub
error_proc:
30500     If MsgBox("Error has occured with subroutine [SUSHide_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
30501     ShutDown
End Sub

Sub SUSHide2_Click()
30502 On Error GoTo error_proc
30503     If Range("CHK.D2D") Then
30504         Range("CHK.SUSHide2") = Not (Range("CHK.SUSHide2"))
30505     If Range("CHK.SUSHide2") Then
30506         Rows("8:10").EntireRow.Hidden = False
30507             Else
30508         Rows("8:10").EntireRow.Hidden = True
30509         End If
30510     End If
30511 Exit Sub
error_proc:
30512     If MsgBox("Error has occured with subroutine [SUSHide2_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
30513     ShutDown
End Sub

Sub D2D_Click()
30511 On Error GoTo error_proc
30512 Form.Unprotect Password:="fruitbasket"

30513 If Range("CHK.D2D") = True Then
30514     Range("CHK.SettingUp") = False
30515     Range("CHK.Salesperson") = False
30516     Range("CHK.CMC") = False
30517     Range("CHK.CustomerSolutions") = False
30518     Range("CHK.CollectionSetUp") = False
30519     Range("CHK.Operations") = False
30520     Range("CHK.SpecialPricing") = False
30521     SpecialPricing.Visible = False
30522     Range("CHK.Finance") = False
30523     FinanceAccountSetup.Visible = False
30524     Sheets("Collection Schedule").Visible = False
30525     Sheet7.Visible = True
30526     Sheet12.Visible = True
          'Worksheets("RM TRACKED 24 48 LETTER S").Visible = False
          'Worksheets("RM TRACKED 24 48 LETTER").Visible = False
          'Worksheets("RM TRACKED HV 24 48 LETTER").Visible = False
          'Worksheets("RM 24 48 FLAT RATE LETTER").Visible = False
          'Worksheets("RM TRACKED RETURNS 24 48 LETTER").Visible = False
          
30527     Call CopyAccountNumber
30528     Call ProductCodeSummary
30529     Call PrintArea(Range("PrintAreaWide"), xlPortrait)
30530 End If
30531 Exit Sub
error_proc:
30532     If MsgBox("Error has occured with subroutine [D2D]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
30533     ShutDown
End Sub
Attribute VB_Name = "CheckVersion"
Const PROCESSOR_ARCHITECTURE_AMD64 = 9

#If VBA7 Then

Type SYSTEM_INFO
    wProcessorArchitecture As Integer
    wReserved As Integer
    dwPageSize As Long
    lpMinimumApplicationAddress As LongPtr
    lpMaximumApplicationAddress As LongPtr
    dwActiveProcessorMask As LongPtr
    dwNumberOrfProcessors As Long
    dwProcessorType As Long
    dwAllocationGranularity As Long
    wProcessorLevel As Integer
    wProcessorRevision As Integer
End Type

Declare PtrSafe Sub GetSystemInfo Lib "kernel32" ( _
    lpSystemInfo As SYSTEM_INFO)

Declare PtrSafe Function GetCurrentProcess Lib "kernel32" () As LongPtr
Declare PtrSafe Function IsWow64Process Lib "kernel32" ( _
    ByVal hProcess As LongPtr, _
    ByRef Wow64Process As Boolean) As Boolean

#Else

Type SYSTEM_INFO
    wProcessorArchitecture As Integer
    wReserved As Integer
    dwPageSize As Long
    lpMinimumApplicationAddress As Long
    lpMaximumApplicationAddress As Long
    dwActiveProcessorMask As Long
    dwNumberOrfProcessors As Long
    dwProcessorType As Long
    dwAllocationGranularity As Long
    dwReserved As Long
End Type

Declare Sub GetSystemInfo Lib "kernel32" ( _
    lpSystemInfo As SYSTEM_INFO)

Declare Function GetCurrentProcess Lib "kernel32" () As Long
Declare Function IsWow64Process Lib "kernel32" ( _
    ByVal hProcess As Long, _
    ByRef Wow64Process As Boolean) As Boolean

#End If

Function IsOffice64Bit() As Boolean
          Dim SI As SYSTEM_INFO

30520     IsOffice64Bit = False
30530     GetSystemInfo SI
30540     If SI.wProcessorArchitecture = PROCESSOR_ARCHITECTURE_AMD64 Then
30550         IsWow64Process GetCurrentProcess(), IsOffice64Bit
30560         IsOffice64Bit = Not IsOffice64Bit
30570     End If
End Function
Attribute VB_Name = "ClearFunctionality"
Option Explicit
Sub ClearForm()
      Dim Counter As Integer
      Dim answer As VbQueryClose
30580 On Error GoTo error_proc
30590 answer = MsgBox("Are you sure you want to clear the entire sheet?" & vbCr & vbCr & "This action cannot be undone!", vbYesNo + vbQuestion, "This action will clear the Sheet!")

30600 If answer = vbYes Then

      'Load WaitFornm
30610 Load WaitForm1
30620 WaitForm1.Show (vbModeless)
30630 DoEvents

      'Insert code here to be run whilst form is displayed
30640     StartUp
30650     Form.Unprotect Password:="fruitbasket"
30651     Form.Range("Priority") = False
30652     FinanceAccountSetup.Unprotect Password:="fruitbasket"
30653     FinanceAccountSetup.Range("Priority.Fin") = False
30654     FinanceAccountSetup.Protect Password:="fruitbasket"
30660     ClearCustomer
30670     ClearMCC
30680     ClearSalesContact
30690     ClearSoleTrader
30700     ClearBillingInvoicing
30701     ClearD2D
30710     ClearPrePay
30720     ClearCreditCheck
30730     ClearShipping
30740     ClearBusinessMail
30750     ClearMailMark
30760     ClearCollection
30770     ClearAddInfo
30780     ClearCMC
30790     ClearSettingupServices
30800     ClearCAPTeam
30810     ClearProducts
30820     ClearCustomerAccountSetupOutput
30830     ClearSoldTo
30840     For Counter = 1 To 9
30850         Call ClearPartner(Counter)
30860     Next Counter
30870     Sheet25.Range("N2:V7").ClearContents
30871     Sheet7.Range("Sector.All").ClearContents
30880     Reset
30890     ShowHide
30900     ShutDown
30910 Else
          'Do Nothing
30920 End If
          
30930 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
30940 Form.EnableSelection = xlNoRestrictions

      'hides form - put at the end of your routine
30950 WaitForm1.Hide
30960 Unload WaitForm1

30970 Exit Sub
error_proc:
30980     If MsgBox("Error has occured with subroutine [ClearForm]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
30990     ShutDown
End Sub

Sub ClearCustomer()
31000 On Error GoTo error_proc
31010 Form.Range("CAP.SoldtoNo").MergeArea.ClearContents
31020 Form.Range("CUS.PPI").MergeArea.ClearContents
31030 Range("CAP.PosterNo").MergeArea.ClearContents
31040 Form.Range("CUS.CustName").MergeArea.ClearContents
31050 Form.Range("CUS.AccountName").MergeArea.ClearContents
31060 Form.Range("CUS.CustNature").MergeArea.Value = ""
31070 Form.Range("CUS.RMSAPBillingNo").MergeArea.ClearContents
31080 Form.Range("CUS.Posting.LocationNo").MergeArea.ClearContents
31090 Form.Range("CUS.UKVATNo").MergeArea.ClearContents
31091 Form.Range("CUS.EORI").MergeArea.ClearContents
31100 Form.Range("CUS.RMLegalEntityNo").MergeArea.ClearContents
31110 Form.Range("CUS.EUVATNo").MergeArea.ClearContents
31120 Form.Range("CUS.Address1").MergeArea.Value = ""
31130 Form.Range("CUS.Address2").MergeArea.Value = ""
31140 Form.Range("CUS.Address3").MergeArea.Value = ""
31150 Form.Range("CUS.Town").MergeArea.Value = ""
31160 Form.Range("CUS.Postcode").MergeArea.Value = ""
31170 Form.Range("CUS.Country").MergeArea.Value = "United Kingdom"
31180 Form.Unprotect Password:="fruitbasket"
31181 Form.Range("CUS.ContactID").MergeArea.Value = ""
31190 Form.Range("CUS.Seasonal") = False
31200 Form.Range("CUS.CompanyRegNo").MergeArea.ClearContents
31210 Form.Range("CUS.RMLegalEntityNo").MergeArea.Locked = False
31220             Sheet18.Range("B1") = ""
31230             Sheet18.Range("B2") = ""
31240             Sheet18.Range("B3") = ""
31250             Sheet18.Range("B4") = ""
31260             Sheet18.Range("B5") = ""
31270             Sheet18.Range("B6") = ""
31280             Sheet18.Range("B7") = ""
31290             Sheet18.Range("B8") = ""
31300             Sheet18.Range("B9") = ""
31310             Sheet18.Range("B10") = ""
31320             Sheet18.Range("B11") = ""
31330             Sheet18.Range("F1") = ""
      'Call IfNotLimitedCompany
31340 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
31350 Form.EnableSelection = xlNoRestrictions
31360 Exit Sub
error_proc:
31370     If MsgBox("Error has occured with subroutine [ClearCustomer]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
31380     ShutDown

End Sub
Sub ClearMCC()
31390 On Error GoTo error_proc
31400 Form.Unprotect Password:="fruitbasket"
31410 Form.Range("MCC.Title").MergeArea.ClearContents
31420 Form.Range("MCC.FirstName").MergeArea.Value = ""
31430 Form.Range("MCC.LastName").MergeArea.Value = ""
31440 Form.Range("MCC.JobTitle").MergeArea.Value = ""
31450 Form.Range("MCC.WorkPhone").MergeArea.Value = ""
31460 Form.Range("MCC.Email").MergeArea.Value = ""
31470 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
31480 Form.EnableSelection = xlNoRestrictions
31490 Exit Sub
error_proc:
31500     If MsgBox("Error has occured with subroutine [ClearMCC]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
31510     ShutDown

End Sub
Sub ClearSalesContact()
31520 On Error GoTo error_proc
31530 Form.Unprotect Password:="fruitbasket"
31540 Form.Range("SAL.ContactName").MergeArea.Value = ""
31550 Form.Range("SAL.ContactEmail").MergeArea.Value = ""
31560 Form.Range("SAL.ContactPhone").MergeArea.ClearContents
31570 Form.Range("CUS.TopAccount").MergeArea.ClearContents
31580 Form.Range("CUS.Order").MergeArea.ClearContents
31590 Form.Range("CUS.FirstPostingDate").MergeArea.ClearContents
31600 Form.Range("CUS.Opportunity").MergeArea.ClearContents
31610 Form.Range("CUS.FastTrackRequired") = False
31620 Form.Range("CUS.ReadytoPostSupport") = False
31630 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
31640 Form.EnableSelection = xlNoRestrictions
31650 Exit Sub
error_proc:
31660     If MsgBox("Error has occured with subroutine [x]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
31670     ShutDown

End Sub
Sub ClearSoleTrader()
31680 On Error GoTo error_proc
31690 Form.Unprotect Password:="fruitbasket"
31700 Form.Range("SOT.Title").MergeArea.ClearContents
31710 Form.Range("SOT.FirstName").MergeArea.ClearContents
31720 Form.Range("SOT.LastName").MergeArea.ClearContents
31730 Form.Range("SOT.Job").MergeArea.ClearContents
31740 Form.Range("SOT.DoB").MergeArea.ClearContents
31750 Form.Range("SOT.Address1").MergeArea.ClearContents
31760 Form.Range("SOT.Address2").MergeArea.ClearContents
31770 Form.Range("SOT.Address3").MergeArea.ClearContents
31780 Form.Range("SOT.Town").MergeArea.ClearContents
31790 Form.Range("SOT.Postcode").MergeArea.ClearContents
31800 Form.Range("SOT.Country").MergeArea = "United Kingdom"
31810 Form.Range("SOT.Phone").MergeArea.ClearContents
31820 Form.Range("SOT.Email").MergeArea.ClearContents
31830 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
31840 Form.EnableSelection = xlNoRestrictions
31850 Exit Sub
error_proc:
31860     If MsgBox("Error has occured with subroutine [ClearSoleTrader]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
31870     ShutDown
End Sub
Sub ClearBillingInvoicing()
31880 On Error GoTo error_proc
31890 Form.Unprotect Password:="fruitbasket"
31900 Form.Range("BIL.Title").MergeArea.Value = ""
31910 Form.Range("BIL.FirstName").MergeArea.Value = ""
31920 Form.Range("BIL.LastName").MergeArea.Value = ""
31930 Form.Range("BIL.Name").MergeArea.Value = ""
31940 Form.Range("BIL.Address1").MergeArea.Value = ""
31950 Form.Range("BIL.Address2").MergeArea.Value = ""
31960 Form.Range("BIL.Address3").MergeArea.Value = ""
31970 Form.Range("BIL.Town").MergeArea.Value = ""
31980 Form.Range("BIL.Postcode").MergeArea.Value = ""
31990 Form.Range("BIL.Country").MergeArea.Value = "United Kingdom"
32000 Form.Range("BIL.Phone").MergeArea.ClearContents
32010 Form.Range("BIL.Email").MergeArea.Value = ""
32020 Form.Range("BIL.PayMethod").MergeArea.ClearContents
32030 Form.Range("BIL.OtherPayMethod").MergeArea.ClearContents
32040 Form.Range("BIL.OptOut") = False
32050 Call IfNotOther
32060 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
32070 Form.EnableSelection = xlNoRestrictions
32080 Exit Sub
error_proc:
32090     If MsgBox("Error has occured with subroutine [ClearBillingInvoicing]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
32100     ShutDown
End Sub

Sub ClearD2D()
'32101 On Error GoTo error_proc
32102 Form.Unprotect Password:="fruitbasket"
32103 Form.Range("D2D.TP").MergeArea.Value = ""
32104 Form.Range("D2D.Frequency").MergeArea.Value = ""
32105 Form.Range("D2D.Type").MergeArea.Value = ""
32106 Form.Range("D2D.TPName").MergeArea.Value = ""
32107 Form.Range("D2D.Address1").MergeArea.Value = ""
32108 Form.Range("D2D.Address2").MergeArea.Value = ""
32109 Form.Range("D2D.Address3").MergeArea.Value = ""
32110 Form.Range("D2D.Town").MergeArea.Value = ""
32111 Form.Range("D2D.PC").MergeArea.Value = ""
32112 Form.Range("D2D.Country").MergeArea.Value = "United Kingdom"
32113 Form.Range("D2D.Weight").MergeArea.ClearContents
32114 Form.Range("D2D.Size").MergeArea.Value = ""
32115 Form.Range("D2D.Fold").MergeArea.ClearContents
32116 Form.Range("D2D.Thick").MergeArea.ClearContents
32117 Form.Range("D2D.ExactThick").MergeArea.ClearContents
32118 Form.Range("D2D.Variations").MergeArea.ClearContents
32119 Form.Range("D2D.Distribution").MergeArea.ClearContents
32120 Form.Range("D2D.Where").MergeArea.ClearContents
32121 Form.Range("D2D.Targeting").MergeArea.ClearContents
32122 Form.Range("D2D.Info").MergeArea.ClearContents
32123 Form.Range("D2D.Other").MergeArea.ClearContents
32124 Form.Range("D2D.Format").MergeArea.Value = ""
32125 Form.Range("D2D.Code").MergeArea.ClearContents
32126 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
32127 Form.EnableSelection = xlNoRestrictions
32128 Exit Sub
error_proc:
32129     If MsgBox("Error has occured with subroutine [ClearD2D]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
32130    ShutDown
End Sub
Sub ClearPrePay()
32131 On Error GoTo error_proc
32132 Form.Unprotect Password:="fruitbasket"
32133 Form.Range("PRE.CreditFail") = False
32140 Form.Range("PRE.CustNotified") = False
32150 Form.Range("PRE.CustEmailInstruct") = False
32160 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
32170 Form.EnableSelection = xlNoRestrictions
32180 Exit Sub
error_proc:
32190     If MsgBox("Error has occured with subroutine [ClearPrepay]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
32200     ShutDown

End Sub
Sub ClearCreditCheck()
32210 On Error GoTo error_proc
32220 Form.Unprotect Password:="fruitbasket"
32230 Form.Range("CRE.ScriptRead") = False
32240 Form.Range("CRE.CreditRequired").MergeArea.ClearContents
32250 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
32260 Form.EnableSelection = xlNoRestrictions
32270 Exit Sub
error_proc:
32280     If MsgBox("Error has occured with subroutine [ClearCreditCheck]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
32290     ShutDown
End Sub
Sub ClearShipping()
32300 On Error GoTo error_proc
32310 Form.Unprotect Password:="fruitbasket"
32320 Form.Range("SHP.SolutionReq").MergeArea.ClearContents
32330 Form.Range("SHP.ContactName").MergeArea.Value = ""
32340 Form.Range("SHP.ContactPhone").MergeArea.Value = ""
32350 Form.Range("SHP.ContactEmail").MergeArea.Value = ""
32360 Form.Range("SHP.Address1").MergeArea.Value = ""
32370 Form.Range("SHP.Address2").MergeArea.Value = ""
32380 Form.Range("SHP.Address3").MergeArea.Value = ""
32381 Form.Range("SHP.CSTName").MergeArea.Value = ""
32382 Form.Range("SHP.DevName").MergeArea.Value = ""
32390 Form.Range("SHP.Town").MergeArea.Value = ""
32400 Form.Range("SHP.Postcode").MergeArea.Value = ""
32410 Form.Range("SHP.Country").MergeArea.Value = "United Kingdom"
32420 Form.Range("SHP.TPIntegrator").MergeArea.ClearContents
32430 Form.Range("SHP.PostMethod").MergeArea.ClearContents
32440 Form.Range("SHP.OBAEmail").MergeArea.ClearContents
32450 Form.Range("SHP.OBAName").MergeArea.ClearContents
32460 Form.Range("SHP.LocalCollect") = False
32470 Form.Range("SHP.ds") = False
32480 Form.Range("SHP.ftp") = False
32490 Form.Range("SHP.OS").MergeArea.ClearContents
32500 Form.Range("SHP.Printer").MergeArea.ClearContents
32510 Form.Range("SHP.TrackedReturns") = False
32520 Form.Range("SHP.TrackLabels").MergeArea.ClearContents
32530 Form.Range("SHP.ReturnAddress1").MergeArea.Value = ""
32540 Form.Range("SHP.ReturnAddress2").MergeArea.Value = ""
32550 Form.Range("SHP.ReturnAddress3").MergeArea.Value = ""
32551 Form.Range("SHP.Amazon").MergeArea.Value = ""
32560 Form.Range("SHP.ReturnTown").MergeArea.Value = ""
32570 Form.Range("SHP.ReturnPostcode").MergeArea.Value = ""
32580 Form.Range("SHP.ReturnCountry").MergeArea.Value = "United Kingdom"
32590 ShowHide
32600 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
32610 Form.EnableSelection = xlNoRestrictions
32620 Exit Sub
error_proc:
32630     If MsgBox("Error has occured with subroutine [ClearShipping]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
32640     ShutDown

End Sub
Sub ClearBusinessMail()
32650 On Error GoTo error_proc
32660 Form.Unprotect Password:="fruitbasket"
32670 Form.Range("BMA.MeterManf").MergeArea.ClearContents
32680 Form.Range("BMA.MeterSupplier").MergeArea.ClearContents
32690 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
32700 Form.EnableSelection = xlNoRestrictions
32710 Exit Sub
error_proc:
32720     If MsgBox("Error has occured with subroutine [ClearBusinessMail]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
32730     ShutDown
End Sub
Sub ClearMailMark()
32740 On Error GoTo error_proc
32750 Form.Unprotect Password:="fruitbasket"
32760 Form.Range("MMK.Registered").MergeArea.Value = ""
32770 Form.Range("MMK.BillPayer").MergeArea.Value = ""
32780 Form.Range("MMK.BarcodeType").MergeArea.ClearContents
32790 Form.Range("MMK.ProducerHouse").MergeArea.ClearContents
32800 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
32810 Form.EnableSelection = xlNoRestrictions
32820 Exit Sub
error_proc:
32830     If MsgBox("Error has occured with subroutine [ClearMailMark]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
32840     ShutDown
End Sub
Sub ClearCollection()
32850 On Error GoTo error_proc
32860 Form.Unprotect Password:="fruitbasket"
32870 Application.EnableEvents = False
32880 Form.Range("COL.Name").MergeArea.ClearContents
32890 Form.Range("COL.PostTitle").MergeArea.ClearContents
32900 Form.Range("COL.PostFirstName").MergeArea.ClearContents
32910 Form.Range("COL.PostLastName").MergeArea.ClearContents
32920 Form.Range("COL.PostJobTitle ").MergeArea.ClearContents
32930 Form.Range("COL.PostPhone").MergeArea.ClearContents
32940 Form.Range("COL.PostEmail").MergeArea.ClearContents
32950 Form.Range("COL.Address1").MergeArea.Value = ""
32960 Form.Range("COL.Address2").MergeArea.Value = ""
32970 Form.Range("COL.Address3").MergeArea.Value = ""
32980 Form.Range("COL.Town").Value = ""
32990 Form.Range("COL.Postcode").MergeArea.Value = ""
33000 Form.Range("COL.Country").MergeArea.Value = "United Kingdom"
33010 Form.Range("COL.CollectionAddress1").MergeArea.Value = ""
33020 Form.Range("COL.CollectionAddress2").MergeArea.Value = ""
33030 Form.Range("COL.CollectionAddress3").MergeArea.Value = ""
33040 Form.Range("COL.CollectionTown").Value = ""
33050 Form.Range("COL.CollectionPostcode").MergeArea.Value = ""
33060 Form.Range("COL.CollectionCountry").MergeArea.Value = "United Kingdom"
33070 Form.Range("COL.SetupChange") = "Collection setup"
33080 Form.Range("COL.CloseTime").MergeArea.ClearContents
33090 Form.Range("COL.Service").MergeArea.ClearContents
33100 Form.Range("COL.Point").MergeArea.ClearContents
33110 Form.Range("COL.Days.Mon") = False
33120 Form.Range("COL.Days.Tues") = False
33130 Form.Range("COL.Days.Wed") = False
33140 Form.Range("COL.Days.Thurs") = False
33150 Form.Range("COL.Days.Fri") = False
33160 Form.Range("COL.Days.Sat") = False
33170 Form.Range("COL.Days.Sun") = False
33171 Form.Range("COL.Existing") = False
33180 Form.Range("COL.ReqTime0").MergeArea.ClearContents
33190 Form.Range("COL.Access").MergeArea.ClearContents
33200 Form.Range("COL.Floor").MergeArea.ClearContents
33210 Form.Range("COL.ConfirmDiscuss") = False
33220 Form.Range("COL.Packaging").MergeArea.ClearContents
33230 Form.Range("COL.ContType").MergeArea.ClearContents
33240 Form.Range("COL.Packaging.Other").MergeArea.ClearContents
33250 Form.Range("COL.ContType.Other").MergeArea.ClearContents
33260 Form.Range("COL.SecureVehicle") = "No"
33270 Form.Range("COL.NoLongerUsed").MergeArea.ClearContents
33280 Form.Range("COL.Restricted").ClearContents
33290 Form.Range("COL.RestrictedDetails").MergeArea.ClearContents
33300 Form.Range("COL.HealthSafety").MergeArea.ClearContents
33310 Form.Range("COL.EntryPoint").MergeArea.ClearContents
33320 Form.Range("COL.AvgVolume.Letter").MergeArea.ClearContents
33330 Form.Range("COL.AvgVolume.LargeLetter").MergeArea.ClearContents
33340 Form.Range("COL.AvgVolume.SmallParcel").MergeArea.ClearContents
33350 Form.Range("COL.AvgVolume.MediumParcel").MergeArea.ClearContents
33360 Form.Range("COL.VolProfile").MergeArea.ClearContents
33370 Form.Range("COL.ExplainSeasonal").MergeArea.ClearContents
33380 Form.Range("COL.VolForecast").MergeArea.ClearContents
33390 Form.Range("COL.Breakdown").MergeArea.ClearContents
33400 Form.Range("COL.FalltoEarthUK").MergeArea.ClearContents
33410 Form.Range("COL.FalltoEarthHIGH").MergeArea.ClearContents
33420 Form.Range("COL.FalltoEarthNI").MergeArea.ClearContents
33430 Form.Range("COL.FalltoEarthInt").MergeArea.ClearContents
33440 Form.Range("COL.OpsAssessmentComplete").Value = False
33450 Form.Range("SHP.Existing").Value = "None"

33460 Form.Range("COL.RestrictedDetails").MergeArea.Locked = True

33470 Application.EnableEvents = True
33480 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
33490 Form.EnableSelection = xlNoRestrictions
33500 Application.EnableEvents = True
33510 Exit Sub
error_proc:
33520     If MsgBox("Error has occured with subroutine [ClearCollection]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
33530     ShutDown
End Sub
Sub ClearAddInfo()
33540 On Error GoTo error_proc
33550 Form.Unprotect Password:="fruitbasket"
33560 Form.Range("ADD.Information").MergeArea.ClearContents
33570 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
33580 Form.EnableSelection = xlNoRestrictions
33590 Exit Sub
error_proc:
33600     If MsgBox("Error has occured with subroutine [ClearAddInfo]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
33610     ShutDown
End Sub
Sub ClearCMC()
33620 On Error GoTo error_proc
33630 Form.Unprotect Password:="fruitbasket"
33640 Form.Range("CMC.CreditRef").MergeArea.ClearContents
33650 Form.Range("CMC.CreditOutcome").MergeArea.ClearContents
33660 Form.Range("CMC.ReasonCode").MergeArea.ClearContents
33670 Form.Range("CMC.ControlCode").MergeArea.ClearContents
33680 Form.Range("CMC.PayTerms").MergeArea.ClearContents
33690 Form.Range("CMC.InvoiceDates").MergeArea.ClearContents
33700 Form.Range("CMC.DDMand").Value = ""
33710 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
33720 Form.EnableSelection = xlNoRestrictions
33730 Exit Sub
error_proc:
33740     If MsgBox("Error has occured with subroutine [ClearCMC]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
33750     ShutDown
End Sub
Sub ClearSettingupServices()
33760 On Error GoTo error_proc
33770 Form.Unprotect Password:="fruitbasket"
33780 Form.Range("SST.SiebelNo").MergeArea.ClearContents
33790 Form.Range("SST.SiebelCreat").MergeArea.ClearContents
33800 Form.Range("SST.Licence1stClass").MergeArea.ClearContents
33810 Form.Range("SST.Licence2ndClass").MergeArea.ClearContents
33820 Form.Range("SST.SignupStat").MergeArea.ClearContents
33830 Form.Range("SST.TCDate").MergeArea.ClearContents
33840 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
33850 Form.EnableSelection = xlNoRestrictions
33860 Exit Sub
error_proc:
33870     If MsgBox("Error has occured with subroutine [ClearSettingUpServices]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
33880     ShutDown
End Sub
Sub ClearCAPTeam()
33890 On Error GoTo error_proc
33900 Form.Unprotect Password:="fruitbasket"
33910 Form.Range("CAP.TROccurance").MergeArea.ClearContents
33920 Form.Range("CAP.TRLicenceNo").MergeArea.ClearContents
33930 Form.Range("CAP.TRSunrise").MergeArea.ClearContents
33940 Form.Range("CAP.TRName").MergeArea.ClearContents
33950 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
33960 Form.EnableSelection = xlNoRestrictions
33970 Exit Sub
error_proc:
33980     If MsgBox("Error has occured with subroutine [ClearCAPTeam]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
33990     ShutDown
End Sub

Sub ClearSoldTo()
34000 On Error GoTo error_proc
34010 Form.Unprotect Password:="fruitbasket"
34020 Form.Range("Sold.Title").MergeArea.ClearContents
34030 Form.Range("Sold.FirstName").MergeArea.ClearContents
34040 Form.Range("Sold.LastName").MergeArea.ClearContents
34050 Form.Range("Sold.Name").MergeArea.ClearContents
34060 Form.Range("Sold.Address1").MergeArea.ClearContents
34070 Form.Range("Sold.Address2").MergeArea.ClearContents
34080 Form.Range("Sold.Address3").MergeArea.ClearContents
34090 Form.Range("Sold.Town").MergeArea.ClearContents
34100 Form.Range("Sold.Postcode").MergeArea.ClearContents
34110 Form.Range("Sold.Country").MergeArea.Value = "United Kingdom"
34120 Form.Range("Sold.Phone").MergeArea.ClearContents
34130 Form.Range("Sold.Email").MergeArea.ClearContents
34140 Form.Range("Sold.VAT").MergeArea.ClearContents
34150 Form.Range("Sold.EUVAT").MergeArea.ClearContents
34160 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
34170 Form.EnableSelection = xlNoRestrictions
34180 Exit Sub
error_proc:
34190     If MsgBox("Error has occured with subroutine [ClearSoldTo]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
34200     ShutDown
End Sub

Sub ClearPartner(ThisOne As Integer)
      Dim intRowStartSoleTrader As Integer
      Dim FirstRow As Integer
34210 On Error GoTo error_proc
34220 Form.Unprotect Password:="fruitbasket"
34230 Form.Range("PAR.Title." & ThisOne).MergeArea.ClearContents
34240 Form.Range("PAR.FirstName." & ThisOne).MergeArea.ClearContents
34250 Form.Range("PAR.LastName." & ThisOne).MergeArea.ClearContents
34260 Form.Range("PAR.DoB." & ThisOne).MergeArea.ClearContents
34270 Form.Range("PAR.Address1." & ThisOne).MergeArea.ClearContents
34280 Form.Range("PAR.Address2." & ThisOne).MergeArea.ClearContents
34290 Form.Range("PAR.Address3." & ThisOne).MergeArea.ClearContents
34300 Form.Range("PAR.Town." & ThisOne).MergeArea.ClearContents
34310 Form.Range("PAR.PostCode." & ThisOne).MergeArea.ClearContents
34320 Form.Range("PAR.Country." & ThisOne) = "United Kingdom"

34330 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
34340 Form.EnableSelection = xlNoRestrictions
34350 Exit Sub
error_proc:
34360     If MsgBox("Error has occured with subroutine [ClearPartner]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
34370     ShutDown
End Sub
Sub ClearProducts()
      Dim OneCell As Range
      Dim ProductsStartRow As Integer
      Dim ThisRowFlag As Boolean
      Dim Count As Integer
34380 On Error GoTo error_proc
34390 Form.Unprotect Password:="fruitbasket"
34400 StartUp
34410 ProductsStartRow = Range("LOC.Products").Row

34420 Range(Range("PRO.Product.1").address & ":" & Range("PRO.Volume").Offset(60, -1).address) = ""
34430 Range(Range("PRO.Volume").Offset(0, 2).address & ":" & Range("PRO.Combined").Offset(60, 3).address) = ""

34440 ThisRowFlag = True
34450 For Each OneCell In Range(Range("PRO.AvgHeight"), Range("PRO.AvgHeight").Offset(59, 0))
34460     If ThisRowFlag = True Then
34470         OneCell = "Height"
34480         OneCell.Offset(0, 2) = "Width"
34490         OneCell.Offset(0, 5) = "Length"
34500         OneCell.Offset(0, 8) = "Height"
34510         OneCell.Offset(0, 11) = "Width"
34520         OneCell.Offset(0, 14) = "Length"
34530         ThisRowFlag = False
34540     Else
34550         ThisRowFlag = True
34560     End If
34570 Next OneCell

34580 Range("CHK.CombinedApp.Inland") = False
34590 Range("CHK.CombinedApp.Intl") = False
34600 Range("CHK.CombinedApp.InlandAndIntl") = False
34610 Range("SP.BMA") = False
34620 Range("SP.Plan") = False
34630 Range("SP.Hybrid") = False
34640 Range("SP.Physical") = False
34650 Range("PRO.CodeSummary").MergeArea.ClearContents
34660 Range("PRO.Discount").ClearContents
34661 Range("Pro.Serv").ClearContents
34662 Range("Pro.Freq").ClearContents
34663 Range("Pro.Country").ClearContents
34664 Range("PRO.FTEAll").ClearContents
34670 Call ClearCustomerAccountSetupOutput

34680 Sheet23.Range("B3:AI33").ClearContents

34690 Application.Calculate
34700 ShowHideRows
34710 ShutDown
34720 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
34730 Form.EnableSelection = xlNoRestrictions
34740 Sheet2.Range("Unsorted_Added").Value = False
34741 Sheet2.Range("D2D_Added").Value = False
34742 Sheet2.Range("STL_ADDED").Value = False
34750 Exit Sub
error_proc:
34760     If MsgBox("Error has occured with subroutine [ClearProducts]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
34770     ShutDown
End Sub

Sub ClearCustomerAccountSetupOutput()

      Dim c As Range
34780 On Error GoTo error_proc
34790 FinanceAccountSetup.Unprotect Password:="fruitbasket"

34800 For Each c In Range("PRO.ContractNoList.FIN")
34810     c.Value = ""
34820 Next c

34830 Range("CUS.RMSAPBillingNo.FIN").MergeArea.ClearContents
34840 Range("CUS.RMLegalEntityNo.FIN").MergeArea.ClearContents
34850 Range("CUS.PPI.FIN").MergeArea.ClearContents
34860 Range("CUS.Posting.LocationNo.FIN").MergeArea.ClearContents
34870 Range("CAP.SoldtoNo.FIN").MergeArea.ClearContents
34880 Range("CAP.OffCodes.FIN").MergeArea.ClearContents
34890 Range("CAP.PosterNo.FIN").MergeArea.ClearContents

34900 FinanceAccountSetup.Protect Password:="fruitbasket"
34910 Exit Sub
error_proc:
34920     If MsgBox("Error has occured with subroutine [ClearCustomerAccountSetupOutput]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
34930     ShutDown
End Sub
Sub WaitFormClear()

      'puts the form in the XL memory for easy access - not strictly necessary
34940 Load WaitForm1

      'shows form and continues with code.  The key part of this is the (vbModeless) part
      'if you do not include this part XL will wait until the form is dismissed before
      'continuing the code
34950 WaitForm1.Show (vbModeless)

      'Ensures that XL refreshes the screen with all of the forms contents
34960 DoEvents

      'Insert code here to be run whilst form is displayed
      'just a function to show how the form works - ERASE when using code
34970 Call ClearForm

      'hides form - put at the end of your routine
34980 WaitForm1.Hide

      'unloads the form from the XL memory
34990 Unload WaitForm1

End Sub
Attribute VB_Name = "CompaniesHouseAPI"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private request As CompaniesHouseRequest
Private urlEndPoints As EndPoints
Private parser As CompaniesHouseResponseParser

Private Type EndPoints
    SearchCompany As String
    SearchOfficer As String
    CompanyProfile As String
    OfficerProfile As String
End Type

Public Enum searchType
    company
    officer
End Enum


Public Property Let companiesHouseApiKey(RHS As String)
2780      request.companiesHouseApiKey = RHS
End Property

Public Property Let companiesHouseBaseUrl(RHS As String)
2790      request.companiesHouseBaseUrl = RHS
End Property

Private Sub Class_Initialize()
2800      Set request = New CompaniesHouseRequest
2810      Set parser = New CompaniesHouseResponseParser
          
2820      urlEndPoints.SearchCompany = "search/companies"
2830      urlEndPoints.SearchOfficer = "search/officers"
2840      urlEndPoints.CompanyProfile = "company/"

          
End Sub

Public Function companySearch(CompanyName As String, itemsPerPage As Long, startIndex As Long) As CHSearchResultCompany

2850    Set companySearch = New CHSearchResultCompany
        
2860    companySearch.Construct parser.parse(search(CompanyName, itemsPerPage, startIndex, company))
          
          
End Function

Public Function officerSearch(CompanyName As String, itemsPerPage As Long, startIndex As Long) As CHSearchResultOfficer

2870    Set officerSearch = New CHSearchResultOfficer
2880    officerSearch.Construct parser.parse(search(CompanyName, itemsPerPage, startIndex, officer))

End Function

Public Function search(term As String, itemsPerPage As Long, startIndex As Long, typeOfSearch As searchType) As String

          Dim requestUrl As String
          
2890      Select Case typeOfSearch
              Case Is = searchType.company
2900              requestUrl = urlEndPoints.SearchCompany
2910          Case Is = searchType.officer
2920              requestUrl = urlEndPoints.SearchOfficer
2930      End Select
          
2940      requestUrl = requestUrl & "?" & _
              "q=" & term & _
              "&items_per_page=" & itemsPerPage & _
              "&start_index=" & startIndex
              
          
2950      search = request.BaseQuery(requestUrl)
              
End Function

Public Function companyById(companyId As String) As CHCompany
        
2960      Set companyById = New CHCompany
2970      companyById.Construct parser.parse(request.BaseQuery(urlEndPoints.CompanyProfile & companyId))
2980      Set companyById.request = request
          
          
End Function
Attribute VB_Name = "CompaniesHouseGET"
Option Explicit


Sub getData()
35000 On Error GoTo error_proc
          Dim api     As CompaniesHouseAPI
          Dim company As CHCompany
          Dim CRN As String
35010     Set api = New CompaniesHouseAPI

35020             Sheet18.Range("B1") = ""
35030             Sheet18.Range("B2") = ""
35040             Sheet18.Range("B3") = ""
35050             Sheet18.Range("B4") = ""
35060             Sheet18.Range("B5") = ""
35070             Sheet18.Range("B6") = ""
35080             Sheet18.Range("B7") = ""
35090             Sheet18.Range("B8") = ""
35100             Sheet18.Range("B9") = ""
35110             Sheet18.Range("B10") = ""
35120             Sheet18.Range("B11") = ""
35130             Sheet18.Range("F11") = ""

35140     api.companiesHouseBaseUrl = CH_API_Constants.BASE_URL_API
35150     api.companiesHouseApiKey = CH_API_Constants.API_KEY
              
35160         If Len(Form.Range("CUS.CompanyRegNo")) > 0 Then
35170             CRN = Format(Form.Range("CUS.CompanyRegNo"), "00000000")
35180             Set company = api.companyById(CRN)
35190             Sheet18.Range("B1") = company.company_name
35200             Sheet18.Range("B2") = company.registered_office_address.address_line_1
35210             Sheet18.Range("B3") = company.registered_office_address.address_line_2
35220             Sheet18.Range("B4") = company.registered_office_address.care_of
35230             Sheet18.Range("B5") = company.registered_office_address.Country
35240             Sheet18.Range("B6") = company.registered_office_address.etag
35250             Sheet18.Range("B7") = company.registered_office_address.locality
35260             Sheet18.Range("B8") = company.registered_office_address.po_box
35270             Sheet18.Range("B9") = company.registered_office_address.postal_code
35280             Sheet18.Range("B10") = company.registered_office_address.premises
35290             Sheet18.Range("B11") = company.registered_office_address.region
35300         End If
              
35310         Set api = Nothing
35320         Set company = Nothing
35321         If IsOffice64Bit Then CreateObjectx86 , True
35330 Exit Sub
error_proc:
35340     If MsgBox("Error has occured with subroutine [Companies House getData]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
35350     ShutDown
End Sub


Attribute VB_Name = "CompaniesHouseRequest"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private encodedAPIkey   As String
Private request         As Object
Private baseURl         As String

Public Enum ResponseStatus
    Error = 0
    Success = -1
End Enum

Private Type RequestResponse
    status As ResponseStatus
    responseText As String
End Type

Public Property Let companiesHouseApiKey(RHS As String)

2990      encodedAPIkey = EncodeBase64(RHS)

End Property

Public Property Let companiesHouseBaseUrl(RHS As String)

3000      If Right(RHS, 1) <> "/" Then RHS = RHS & "/"
3010      baseURl = RHS

End Property

Public Function BaseQuery(qry As String) As String

3020      If request Is Nothing Then Set request = CreateObject("MSXML2.XMLHTTP.6.0")

3030      With request
3040          .Open "GET", baseURl & qry, False
3050          .setRequestHeader "Authorization", "Basic " & encodedAPIkey
3060          .send
3070          BaseQuery = .responseText
3080      End With

End Function

Private Function EncodeBase64(text As String) As String

          Dim arrData() As Byte
3090      arrData = StrConv(text, vbFromUnicode)

          Dim objXML As Object
          Dim objNode As Object

3100      Set objXML = CreateObject("MSXML2.DOMDocument")
3110      Set objNode = objXML.createElement("b64")

3120      objNode.DataType = "bin.base64"
3130      objNode.nodeTypedValue = arrData
3140      EncodeBase64 = objNode.text

End Function

Attribute VB_Name = "CompaniesHouseResponseParser"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private scriptControl As Object

Private Sub Class_Initialize()
3150    If IsOffice64Bit Then
3151        Set scriptControl = CreateObjectx86("MSScriptControl.ScriptControl")
3152    Else
3153        Set scriptControl = CreateObject("MSScriptControl.ScriptControl")
3160    End If
3161    scriptControl.Language = "JScript"
End Sub

Public Function parse(json As String) As Object
3170      Set parse = scriptControl.Eval("(" + json + ")")
End Function

Attribute VB_Name = "ControlLetters"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Attribute VB_Name = "CopyAddress"
Option Explicit
Sub SoleTraderAddress()
35360 On Error GoTo error_proc
35370 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
35380     MsgBox "The Customer details have not yet been filled in at the top of the form", vbOKOnly, "Customer details missing"

35390 ElseIf Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Or Form.Range("MCC.JobTitle") = "" _
          Or Form.Range("MCC.WorkPhone") = "" Or Form.Range("MCC.Email") = "" Then
          
35400     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"

35410 Else
35420     Form.Range("SOT.Title") = Form.Range("MCC.Title")
35430     Form.Range("SOT.FirstName") = Form.Range("MCC.FirstName")
35440     Form.Range("SOT.LastName") = Form.Range("MCC.LastName")
35450     Form.Range("SOT.Job") = Form.Range("MCC.JobTitle")
35460     Form.Range("SOT.Phone") = Form.Range("MCC.WorkPhone")
35470     Form.Range("SOT.Email") = Form.Range("MCC.Email")
          
35480     Form.Range("SOT.Address1") = Form.Range("CUS.Address1")
35490     Form.Range("SOT.Address2") = Form.Range("CUS.Address2")
35500     Form.Range("SOT.Address3") = Form.Range("CUS.Address3")
          
35510     Form.Range("SOT.Town") = Form.Range("CUS.Town")
35520     Form.Range("SOT.Postcode") = Form.Range("CUS.Postcode")
35530     Form.Range("SOT.Country") = Form.Range("CUS.Country")

35531     Sheet25.Range("SOT.PAF1") = Sheet25.Range("CUS.PAF1")
35532     Sheet25.Range("SOT.PAF2") = Sheet25.Range("CUS.PAF2")
35533     Sheet25.Range("SOT.PAF3") = Sheet25.Range("CUS.PAF3")
35534     Sheet25.Range("SOT.PAF4") = Sheet25.Range("CUS.PAF4")
35535     Sheet25.Range("SOT.PAF5") = Sheet25.Range("CUS.PAF5")
35536     Sheet25.Range("SOT.PAF6") = Sheet25.Range("CUS.PAF6")

35540 End If
35550 Exit Sub
error_proc:
35560     If MsgBox("Error has occured with subroutine [SoleTraderAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
35570     ShutDown
End Sub
Sub PartnerAddress()
35580 On Error GoTo error_proc
35590 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
35600     MsgBox "The Customer details have not yet been filled in at the top of the form", vbOKOnly, "Customer details missing"

35610 ElseIf Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Then
          
35620     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"

35630 Else
35640     Form.Range("PAR.Title.1") = Form.Range("MCC.Title")
35650     Form.Range("PAR.FirstName.1") = Form.Range("MCC.FirstName")
35660     Form.Range("PAR.LastName.1") = Form.Range("MCC.LastName")
          
35670     Form.Range("PAR.Address1.1") = Form.Range("CUS.Address1")
35680     Form.Range("PAR.Address2.1") = Form.Range("CUS.Address2")
35690     Form.Range("PAR.Address3.1") = Form.Range("CUS.Address3")
          
35700     Form.Range("PAR.Town.1") = Form.Range("CUS.Town")
35710     Form.Range("PAR.Postcode.1") = Form.Range("CUS.Postcode")
35720     Form.Range("PAR.Country.1") = Form.Range("CUS.Country")

35730 End If
35740 Exit Sub
error_proc:
35750     If MsgBox("Error has occured with subroutine [PartnerAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
35760     ShutDown

End Sub
Sub BillingAddress()
35770 On Error GoTo error_proc
35780 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
35790     MsgBox "The customer address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"

35800 ElseIf Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Or Form.Range("CUS.CustName") = "" _
          Or Form.Range("MCC.WorkPhone") = "" Or Form.Range("MCC.Email") = "" Then
          
35810     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"

35820 Else
35830     Form.Range("BIL.Title") = Form.Range("MCC.Title")
35840     Form.Range("BIL.FirstName") = Form.Range("MCC.FirstName")
35850     Form.Range("BIL.LastName") = Form.Range("MCC.LastName")
          
35860     Form.Range("BIL.Name") = Form.Range("CUS.CustName")
35870     Form.Range("BIL.Phone") = Form.Range("MCC.WorkPhone")
35880     Form.Range("BIL.Email") = Form.Range("MCC.Email")
          
35890     Form.Range("BIL.Address1") = Form.Range("CUS.Address1")
35900     Form.Range("BIL.Address2") = Form.Range("CUS.Address2")
35910     Form.Range("BIL.Address3") = Form.Range("CUS.Address3")
          
35920     Form.Range("BIL.Town") = Form.Range("CUS.Town")
35930     Form.Range("BIL.Postcode") = Form.Range("CUS.Postcode")
35940     Form.Range("BIL.Country") = Form.Range("CUS.Country")

35941     Sheet25.Range("BIL.PAF1") = Sheet25.Range("CUS.PAF1")
35942     Sheet25.Range("BIL.PAF2") = Sheet25.Range("CUS.PAF2")
35943     Sheet25.Range("BIL.PAF3") = Sheet25.Range("CUS.PAF3")
35944     Sheet25.Range("BIL.PAF4") = Sheet25.Range("CUS.PAF4")
35945     Sheet25.Range("BIL.PAF5") = Sheet25.Range("CUS.PAF5")
35946     Sheet25.Range("BIL.PAF6") = Sheet25.Range("CUS.PAF6")

35950 End If
35960 Exit Sub
error_proc:
35970     If MsgBox("Error has occured with subroutine [BillingAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
35980     ShutDown
End Sub
Sub OBAAddress()
      Dim FirstName As Range
      Dim LastName As Range
35990 On Error GoTo error_proc
36000 If Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Or Form.Range("MCC.Email") = "" Then
          
36010     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"

36020 Else
36030     Set FirstName = Form.Range("MCC.FirstName")
36040     Set LastName = Form.Range("MCC.LastName")
      'Provision for removing up to 2 spaces at the end of data entry field
36050     If Right(FirstName, 1) = " " Then FirstName = Left(FirstName, Len(FirstName) - 1)
36060     If Right(FirstName, 1) = " " Then FirstName = Left(FirstName, Len(FirstName) - 1)
36070     If Right(LastName, 1) = " " Then LastName = Left(LastName, Len(LastName) - 1)
36080     If Right(LastName, 1) = " " Then LastName = Left(LastName, Len(LastName) - 1)

36090     Form.Range("SHP.OBAName") = Form.Range("MCC.Title") & " " & Form.Range("MCC.FirstName") & " " & Form.Range("MCC.LastName")
36100     Form.Range("SHP.OBAEmail") = Form.Range("MCC.Email")
36110 End If
36120 Exit Sub
error_proc:
36130     If MsgBox("Error has occured with subroutine [OBAAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
36140     ShutDown

End Sub
Sub ShippingAddress()
36150 On Error GoTo error_proc

36160 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
36170     MsgBox "The customer address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"

36180 ElseIf Form.Range("CUS.CustName") = "" Or Form.Range("MCC.WorkPhone") = "" _
          Or Form.Range("MCC.Email") = "" Then
          
36190     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"

36200 Else
36210     Form.Range("SHP.ContactName") = Form.Range("CUS.CustName")
36220     Form.Range("SHP.ContactPhone") = Form.Range("MCC.WorkPhone")
36230     Form.Range("SHP.ContactEmail") = Form.Range("MCC.Email")
          
36240     Form.Range("SHP.Address1") = Form.Range("CUS.Address1")
36250     Form.Range("SHP.Address2") = Form.Range("CUS.Address2")
36260     Form.Range("SHP.Address3") = Form.Range("CUS.Address3")
          
36270     Form.Range("SHP.Town") = Form.Range("CUS.Town")
36280     Form.Range("SHP.Postcode") = Form.Range("CUS.Postcode")
36290     Form.Range("SHP.Country") = Form.Range("CUS.Country")

36291     Sheet25.Range("SHP.PAF1") = Sheet25.Range("CUS.PAF1")
36292     Sheet25.Range("SHP.PAF2") = Sheet25.Range("CUS.PAF2")
36293     Sheet25.Range("SHP.PAF3") = Sheet25.Range("CUS.PAF3")
36294     Sheet25.Range("SHP.PAF4") = Sheet25.Range("CUS.PAF4")
36295     Sheet25.Range("SHP.PAF5") = Sheet25.Range("CUS.PAF5")
36296     Sheet25.Range("SHP.PAF6") = Sheet25.Range("CUS.PAF6")

36300 End If
36310 Exit Sub
error_proc:
36320     If MsgBox("Error has occured with subroutine [ShippingAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
36330     ShutDown
End Sub
Sub ReturnAddress()
36340 On Error GoTo error_proc
36350 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
36360     MsgBox "The customer address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"

36370 Else
36380     Form.Range("SHP.ReturnAddress1") = Form.Range("CUS.Address1")
36390     Form.Range("SHP.ReturnAddress2") = Form.Range("CUS.Address2")
36400     Form.Range("SHP.ReturnAddress3") = Form.Range("CUS.Address3")
          
36410     Form.Range("SHP.ReturnTown") = Form.Range("CUS.Town")
36420     Form.Range("SHP.ReturnPostcode") = Form.Range("CUS.Postcode")
36430     Form.Range("SHP.ReturnCountry") = Form.Range("CUS.Country")

36431     Sheet25.Range("SHP.PAF7") = Sheet25.Range("CUS.PAF1")
36432     Sheet25.Range("SHP.PAF8") = Sheet25.Range("CUS.PAF2")
36433     Sheet25.Range("SHP.PAF9") = Sheet25.Range("CUS.PAF3")
36434     Sheet25.Range("SHP.PAF10") = Sheet25.Range("CUS.PAF4")
36435     Sheet25.Range("SHP.PAF11") = Sheet25.Range("CUS.PAF5")
36436     Sheet25.Range("SHP.PAF12") = Sheet25.Range("CUS.PAF6")

36440 End If
36450 Exit Sub
error_proc:
36460     If MsgBox("Error has occured with subroutine [ReturnAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
36470     ShutDown

End Sub
Sub PosterAddress()
36480 On Error GoTo error_proc
36490 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
36500     MsgBox "The customer address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"
36510 End If
36520 If Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Or Form.Range("MCC.JobTitle") = "" _
          Or Form.Range("MCC.WorkPhone") = "" Or Form.Range("MCC.Email") = "" Then
          
36530     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"
36540 End If
36550     Form.Range("COL.PostTitle") = Form.Range("MCC.Title")
36560     Form.Range("COL.PostFirstName") = Form.Range("MCC.FirstName")
36570     Form.Range("COL.PostLastName") = Form.Range("MCC.LastName")
36580     Form.Range("COL.PostJobTitle") = Form.Range("MCC.JobTitle")
36590     Form.Range("COL.PostPhone") = Form.Range("MCC.WorkPhone")
36600     Form.Range("COL.PostEmail") = Form.Range("MCC.Email")
          
36610     Form.Range("COL.Name") = Form.Range("CUS.AccountName")
36620     Form.Range("COL.Address1") = Form.Range("CUS.Address1")
36630     Form.Range("COL.Address2") = Form.Range("CUS.Address2")
36640     Form.Range("COL.Address3") = Form.Range("CUS.Address3")
          
36650     Form.Range("COL.Town") = Form.Range("CUS.Town")
36660     Form.Range("COL.Postcode") = Form.Range("CUS.Postcode")
36670     Form.Range("COL.Country") = Form.Range("CUS.Country")

36671     Sheet25.Range("COL.PAF1") = Sheet25.Range("CUS.PAF1")
36672     Sheet25.Range("COL.PAF2") = Sheet25.Range("CUS.PAF2")
36673     Sheet25.Range("COL.PAF3") = Sheet25.Range("CUS.PAF3")
36674     Sheet25.Range("COL.PAF4") = Sheet25.Range("CUS.PAF4")
36675     Sheet25.Range("COL.PAF5") = Sheet25.Range("CUS.PAF5")
36676     Sheet25.Range("COL.PAF6") = Sheet25.Range("CUS.PAF6")

36680 Exit Sub
error_proc:
36690     If MsgBox("Error has occured with subroutine [PosterAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
36700     ShutDown
End Sub
Sub CollectionAddress()
36710 On Error GoTo error_proc
36720 If Form.Range("COL.Address1") = "" Or Form.Range("COL.Town") = "" _
          Or Form.Range("COL.Postcode") = "" Or Form.Range("COL.Country") = "" Then
          
36730     MsgBox "The poster address has not yet been filled in above", vbOKOnly, "Poster address details missing"

36740 Else
36750     Form.Range("COL.CollectionAddress1") = Form.Range("COL.Address1")
36760     Form.Range("COL.CollectionAddress2") = Form.Range("COL.Address2")
36770     Form.Range("COL.CollectionAddress3") = Form.Range("COL.Address3")
          
36780     Form.Range("COL.CollectionTown") = Form.Range("COL.Town")
36790     Form.Range("COL.CollectionPostcode") = Form.Range("COL.Postcode")
36800     Form.Range("COL.CollectionCountry") = Form.Range("COL.Country")

36801     Sheet25.Range("COL.PAF7") = Sheet25.Range("CUS.PAF1")
36802     Sheet25.Range("COL.PAF8") = Sheet25.Range("CUS.PAF2")
36803     Sheet25.Range("COL.PAF9") = Sheet25.Range("CUS.PAF3")
36804     Sheet25.Range("COL.PAF10") = Sheet25.Range("CUS.PAF4")
36805     Sheet25.Range("COL.PAF11") = Sheet25.Range("CUS.PAF5")
36806     Sheet25.Range("COL.PAF12") = Sheet25.Range("CUS.PAF6")

36810 End If
36820 Exit Sub
error_proc:
36830     If MsgBox("Error has occured with subroutine [CollectionAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
36840     ShutDown

End Sub

Sub PosterBillingAddress()
36850 On Error GoTo error_proc
36860 If Form.Range("BIL.Address1") = "" Or Form.Range("BIL.Town") = "" _
          Or Form.Range("BIL.Postcode") = "" Or Form.Range("BIL.Country") = "" Then
          
36870     MsgBox "The billing address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"
36880 End If
36890 If Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Or Form.Range("MCC.JobTitle") = "" _
          Or Form.Range("MCC.WorkPhone") = "" Or Form.Range("MCC.Email") = "" Then
          
36900     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"
36910 End If
36920     Form.Range("COL.Name") = Form.Range("BIL.Name")
36930     Form.Range("COL.PostTitle") = Form.Range("MCC.Title")
36940     Form.Range("COL.PostFirstName") = Form.Range("MCC.FirstName")
36950     Form.Range("COL.PostLastName") = Form.Range("MCC.LastName")
36960     Form.Range("COL.PostJobTitle") = Form.Range("MCC.JobTitle")
36970     Form.Range("COL.PostPhone") = Form.Range("MCC.WorkPhone")
36980     Form.Range("COL.PostEmail") = Form.Range("MCC.Email")
          
36990     Form.Range("COL.Address1") = Form.Range("BIL.Address1")
37000     Form.Range("COL.Address2") = Form.Range("BIL.Address2")
37010     Form.Range("COL.Address3") = Form.Range("BIL.Address3")
          
37020     Form.Range("COL.Town") = Form.Range("BIL.Town")
37030     Form.Range("COL.Postcode") = Form.Range("BIL.Postcode")
37040     Form.Range("COL.Country") = Form.Range("BIL.Country")

37041     Sheet25.Range("COL.PAF1") = Sheet25.Range("BIL.PAF1")
37042     Sheet25.Range("COL.PAF2") = Sheet25.Range("BIL.PAF2")
37043     Sheet25.Range("COL.PAF3") = Sheet25.Range("BIL.PAF3")
37044     Sheet25.Range("COL.PAF4") = Sheet25.Range("BIL.PAF4")
37045     Sheet25.Range("COL.PAF5") = Sheet25.Range("BIL.PAF5")
37046     Sheet25.Range("COL.PAF6") = Sheet25.Range("BIL.PAF6")

37050 Exit Sub
error_proc:
37060     If MsgBox("Error has occured with subroutine [PosterAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
37070     ShutDown
End Sub

Sub SoldToAddressBilling()
37080 On Error GoTo error_proc
37090 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
37100     MsgBox "The customer address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"
37110 End If
37120 If Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Or Form.Range("MCC.JobTitle") = "" _
          Or Form.Range("MCC.WorkPhone") = "" Or Form.Range("MCC.Email") = "" Then
          
37130     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"
37140 End If
37150     Form.Range("Sold.Title") = Form.Range("MCC.Title")
37160     Form.Range("Sold.FirstName") = Form.Range("MCC.FirstName")
37170     Form.Range("Sold.LastName") = Form.Range("MCC.LastName")
          
37180     Form.Range("Sold.Name") = Form.Range("BIL.Name")
37190     Form.Range("Sold.Phone") = Form.Range("BIL.Phone")
37200     Form.Range("Sold.Email") = Form.Range("BIL.Email")
          
37210     Form.Range("Sold.Address1") = Form.Range("BIL.Address1")
37220     Form.Range("Sold.Address2") = Form.Range("BIL.Address2")
37230     Form.Range("Sold.Address3") = Form.Range("BIL.Address3")
          
37240     Form.Range("Sold.Town") = Form.Range("BIL.Town")
37250     Form.Range("Sold.Postcode") = Form.Range("BIL.Postcode")
37260     Form.Range("Sold.Country") = Form.Range("BIL.Country")
37270     Form.Range("Sold.VAT") = Form.Range("CUS.UKVATNo")
37280     Form.Range("Sold.EUVAT") = Form.Range("CUS.EUVATNo")

37281     Sheet25.Range("Sold.PAF1") = Sheet25.Range("BIL.PAF1")
37282     Sheet25.Range("Sold.PAF2") = Sheet25.Range("BIL.PAF2")
37283     Sheet25.Range("Sold.PAF3") = Sheet25.Range("BIL.PAF3")
37284     Sheet25.Range("Sold.PAF4") = Sheet25.Range("BIL.PAF4")
37285     Sheet25.Range("Sold.PAF5") = Sheet25.Range("BIL.PAF5")
37286     Sheet25.Range("Sold.PAF6") = Sheet25.Range("BIL.PAF6")

37290 Exit Sub
error_proc:
37300     If MsgBox("Error has occured with subroutine [SoldToAddressBilling]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
37310     ShutDown
End Sub

Sub SoldToAddress()
37320 On Error GoTo error_proc
37330 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
37340     MsgBox "The customer address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"
37350 End If
37360 If Form.Range("MCC.Title") = "" Or Form.Range("MCC.FirstName") = "" _
          Or Form.Range("MCC.LastName") = "" Or Form.Range("MCC.JobTitle") = "" _
          Or Form.Range("MCC.WorkPhone") = "" Or Form.Range("MCC.Email") = "" Then
          
37370     MsgBox "The main customer contact details have not yet been filled in at the top of the form", vbOKOnly, "Main Customer Contact details missing"
37380 End If
37390     Form.Range("Sold.Title") = Form.Range("BIL.Title")
37400     Form.Range("Sold.FirstName") = Form.Range("BIL.FirstName")
37410     Form.Range("Sold.LastName") = Form.Range("BIL.LastName")
          
37420     Form.Range("Sold.Name") = Form.Range("CUS.CustName")
37430     Form.Range("Sold.Phone") = Form.Range("MCC.WorkPhone")
37440     Form.Range("Sold.Email") = Form.Range("MCC.Email")
          
37450     Form.Range("Sold.Address1") = Form.Range("CUS.Address1")
37460     Form.Range("Sold.Address2") = Form.Range("CUS.Address2")
37470     Form.Range("Sold.Address3") = Form.Range("CUS.Address3")
          
37480     Form.Range("Sold.Town") = Form.Range("CUS.Town")
37490     Form.Range("Sold.Postcode") = Form.Range("CUS.Postcode")
37500     Form.Range("Sold.Country") = Form.Range("CUS.Country")
37510     Form.Range("Sold.VAT") = Form.Range("CUS.UKVATNo")
37520     Form.Range("Sold.EUVAT") = Form.Range("CUS.EUVATNo")

37521     Sheet25.Range("Sold.PAF1") = Sheet25.Range("CUS.PAF1")
37522     Sheet25.Range("Sold.PAF2") = Sheet25.Range("CUS.PAF2")
37523     Sheet25.Range("Sold.PAF3") = Sheet25.Range("CUS.PAF3")
37524     Sheet25.Range("Sold.PAF4") = Sheet25.Range("CUS.PAF4")
37525     Sheet25.Range("Sold.PAF5") = Sheet25.Range("CUS.PAF5")
37526     Sheet25.Range("Sold.PAF6") = Sheet25.Range("CUS.PAF6")

37530 Exit Sub
error_proc:
37540     If MsgBox("Error has occured with subroutine [SoldToAddress]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
37550     ShutDown
End Sub

Sub D2DBilling()
37551 On Error GoTo error_proc
37552 If Form.Range("BIL.Address1") = "" Or Form.Range("BIL.Town") = "" _
          Or Form.Range("BIL.Postcode") = "" Or Form.Range("BIL.Country") = "" Then
          
37553     MsgBox "The Billing address has not yet been filled in on the form", vbOKOnly, "Billing address details missing"
37554 End If
          
37555     Form.Range("D2D.Address1") = Form.Range("BIL.Address1")
37556     Form.Range("D2D.Address2") = Form.Range("BIL.Address2")
37557     Form.Range("D2D.Address3") = Form.Range("BIL.Address3")
          
37558     Form.Range("D2D.Town") = Form.Range("BIL.Town")
37559     Form.Range("D2D.PC") = Form.Range("BIL.Postcode")
37560     Form.Range("D2D.Country") = Form.Range("BIL.Country")

37561     Sheet25.Range("D2D.PAF1") = Sheet25.Range("BIL.PAF1")
37562     Sheet25.Range("D2D.PAF2") = Sheet25.Range("BIL.PAF2")
37563     Sheet25.Range("D2D.PAF3") = Sheet25.Range("BIL.PAF3")
37564     Sheet25.Range("D2D.PAF4") = Sheet25.Range("BIL.PAF4")
37565     Sheet25.Range("D2D.PAF5") = Sheet25.Range("BIL.PAF5")
37566     Sheet25.Range("D2D.PAF6") = Sheet25.Range("BIL.PAF6")

37567 Exit Sub
error_proc:
37568     If MsgBox("Error has occured with subroutine [D2DBilling]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
37569     ShutDown
End Sub

Sub D2DCustomer()
37570 On Error GoTo error_proc
37571 If Form.Range("CUS.Address1") = "" Or Form.Range("CUS.Town") = "" _
          Or Form.Range("CUS.Postcode") = "" Or Form.Range("CUS.Country") = "" Then
          
37572     MsgBox "The customer address has not yet been filled in at the top of the form", vbOKOnly, "Customer address details missing"
37573 End If
          
37574     Form.Range("D2D.Address1") = Form.Range("CUS.Address1")
37575     Form.Range("D2D.Address2") = Form.Range("CUS.Address2")
37576     Form.Range("D2D.Address3") = Form.Range("CUS.Address3")
          
37577     Form.Range("D2D.Town") = Form.Range("CUS.Town")
37578     Form.Range("D2D.PC") = Form.Range("CUS.Postcode")
37579     Form.Range("D2D.Country") = Form.Range("CUS.Country")

37580     Sheet25.Range("D2D.PAF1") = Sheet25.Range("CUS.PAF1")
37581     Sheet25.Range("D2D.PAF2") = Sheet25.Range("CUS.PAF2")
37582     Sheet25.Range("D2D.PAF3") = Sheet25.Range("CUS.PAF3")
37583     Sheet25.Range("D2D.PAF4") = Sheet25.Range("CUS.PAF4")
37584     Sheet25.Range("D2D.PAF5") = Sheet25.Range("CUS.PAF5")
37585     Sheet25.Range("D2D.PAF6") = Sheet25.Range("CUS.PAF6")

37586 Exit Sub
error_proc:
37587     If MsgBox("Error has occured with subroutine [D2DCustomer]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
37588     ShutDown
End Sub

Attribute VB_Name = "ExportRanges"
Sub Copy_All_Defined_Names()
      'Work in progress for v5
         ' Loop through all of the defined names in the active
         ' workbook.
37590      For Each x In ActiveWorkbook.Names
            ' Add each defined name from the active workbook to
            ' the target workbook ("Book2.xls" or "Book2.xlsm").
            ' "x.value" refers to the cell references the
            ' defined name points to.
37591       Workbooks("Test.xlsx").Names.Add name:=x.name, _
               RefersTo:=x.Value
37592    Next x
End Sub

Sub FindFormulas()
      'Admin function
37593 Do While Len(ActiveCell) > 0
37600     ActiveCell.Offset(0, 4).Value = "'" & Worksheets(ActiveCell.Offset(0, 2).Value).Range(ActiveCell.Offset(0, 3)).Formula
37610     ActiveCell.Offset(1, 0).Select
37620 Loop

End Sub


Attribute VB_Name = "FinanceAccountSetup"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Private Sub Worksheet_Activate()
19900 On Error GoTo error_proc
19910 ActiveWindow.Zoom = 100
19920 ActiveSheet.DisplayPageBreaks = False
19930 FinanceAccountSetup.Unprotect Password:="fruitbasket"

19940 Rows("154:156").RowHeight = Form.Range("659:659").RowHeight

19950 Me.Calculate
19960 Call CopyPartnerNames
19970 Call CopyAccountNumber

      Dim c As Range
19980 For Each c In Range("PRO.ProductCode.FIN")
19990     If Not c.Value = 0 Then
20000         c.EntireRow.Hidden = False
20010     Else
20020         c.EntireRow.Hidden = True
20030     End If
20040 Next c

      'This hides the relevant sections when Add-Ons are selected

20050 If Sheets("Form").Range("CHK.AccountAddOn") Or Sheets("Form").Range("CHK.D2DSalesAddOn") Then
20060     ActiveSheet.Range("A9:A89").EntireRow.Hidden = True
20070     ActiveSheet.Range("A131:A140").EntireRow.Hidden = True
20080     ActiveSheet.Range("A70:A88").EntireRow.Hidden = False
20090     ActiveSheet.Range("A80").EntireRow.Hidden = True
          'Show Account name
20100     ActiveSheet.Range("A58:A59").EntireRow.Hidden = False
          'Range("CUS.CompanyRegNo.FIN").EntireRow.Hidden = True
20110     Else
20120         ActiveSheet.Range("A9:A89").EntireRow.Hidden = False
20130         ActiveSheet.Range("A131:A140").EntireRow.Hidden = False
20140         If Not ThisWorkbook.Sheets("T&C Control").Range("CRL").Value = True Then ActiveSheet.Range("A139").EntireRow.Hidden = True
              'Range("CUS.CompanyRegNo.FIN").EntireRow.Hidden = False
20150 End If

      'Set page break
20160 ActiveSheet.ResetAllPageBreaks
20170 If Not Sheets("Form").Range("CHK.AccountAddOn") And Not Sheets("Form").Range("CHK.D2DSalesAddOn") Then
20180     ActiveSheet.Rows(89).PageBreak = xlPageBreakManual
20190 End If

20200 FinanceAccountSetup.Protect Password:="fruitbasket"
20210 FinanceAccountSetup.EnableSelection = xlNoRestrictions
20220 Exit Sub
error_proc:
20230     If MsgBox("Error has occured with subroutine [FinanceAccountSetup_Activate]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
20240     ShutDown
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
20250 On Error GoTo error_proc
20260 If Not Intersect(Target, Range("PRO.ContractNoList.FIN")) Is Nothing Then
20270     Call CopytoForm
20280 End If
20290 If Not Intersect(Target, Range("CUS.PPI.FIN")) Is Nothing Then
20300     Form.Range("CUS.PPI").Value = UCase(Range("CUS.PPI.FIN").Value)
20310 End If
20320 Exit Sub
error_proc:
20330     If MsgBox("Error has occured with subroutine [FinanceAccountSetup_Change]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
20340     ShutDown

End Sub
Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)
20350 On Error GoTo error_proc
20360 Select Case Target.SubAddress
          Case "CopyMode.FIN"
20370         FinanceAccountSetup.Unprotect Password:="fruitbasket"
20380         Range("CopyMode.FIN") = Not (Range("CopyMode.FIN"))
20390         FinanceAccountSetup.Protect Password:="fruitbasket"
          Case "Priority.Fin"
20391         Form.Unprotect Password:="fruitbasket"
20392         FinanceAccountSetup.Unprotect Password:="fruitbasket"
20393         Range("Priority.Fin") = Not (Range("Priority.Fin"))
20394         Form.Range("Priority") = Range("Priority.Fin")
20395         FinanceAccountSetup.Protect Password:="fruitbasket"
20396         Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
20397     Case "Button.SUS1"
20398         Form.Activate
20399         Form.Range("Button.10").Select
20400         ActiveCell.Hyperlinks(1).Follow
20401     Case "Button.SUS2"
20402         Form.Activate
20403         Form.Range("Button.10").Select
20404         ActiveCell.Hyperlinks(1).Follow
20405     Case "Button.Sales1"
20406         Form.Activate
20407         Call SUS_SALES
20409 End Select
20410 Exit Sub
error_proc:
20420     If MsgBox("Error has occured with subroutine [FinanceAccountSetup_FollowHyperLink]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
20430     ShutDown

End Sub
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
20440 On Error GoTo error_proc
20450     If Range("CopyMode.FIN") = True _
              And Not (Target.address = Range("CopyMode.FIN").address) And Target.Cells(1, 1).text <> "" Then
20460             Target.Cells(1, 1).Copy
20470     End If
20480 Exit Sub
error_proc:
20490     If MsgBox("Error has occured with subroutine [FinanceAccountSetup_SelectionChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
20500     ShutDown


End Sub

Attribute VB_Name = "FinanceCopy"
Option Explicit

Sub CopyAccountNumber()

37630 On Error GoTo error_proc
37640 If Sheets("Form").Range("CHK.Finance") Then
37650     If Sheets("Form").Range("CHK.NewCustomerSetup") Or Sheets("Form").Range("CHK.D2DSales") Then
37660     Range("CUS.RMSAPBillingNo.FIN").MergeArea.Locked = False
37670     Range("CUS.RMLegalEntityNo.FIN").MergeArea.Locked = False
37680     Range("CUS.PPI.FIN").MergeArea.Locked = False
37690         ElseIf Sheets("Form").Range("CHK.NewAccountExistingCust") Or Sheets("Form").Range("CHK.D2DSalesEx") Then
37700         Range("CUS.RMSAPBillingNo.FIN").MergeArea.Locked = False
37710         Range("CUS.RMLegalEntityNo.FIN").MergeArea.Locked = True
      '        Range("CUS.PPI.FIN").MergeArea.Locked = True
37720         Range("CUS.RMLegalEntityNo.FIN") = Range("CUS.RMLegalEntityNo")
37730         Range("CUS.PPI.FIN") = UCase(Range("CUS.PPI"))
37740             ElseIf Sheets("Form").Range("CHK.AccountAddOn") Or Sheets("Form").Range("CHK.D2DSalesAddOn") Then
37750             Range("CUS.RMSAPBillingNo.FIN").MergeArea.Locked = True
37760             Range("CUS.RMLegalEntityNo.FIN").MergeArea.Locked = True
      '            Range("CUS.PPI.FIN").MergeArea.Locked = True
37770             If Not Range("CHK.PrePay") Then Range("CUS.RMLegalEntityNo.FIN") = Range("CUS.RMLegalEntityNo")
37780             Range("CUS.PPI.FIN") = Range("CUS.PPI")
37790             Range("CUS.RMSAPBillingNo.FIN") = Range("CUS.RMSAPBillingNo")
37800     End If
          
37810     Range("CUS.Posting.LocationNo.FIN").MergeArea.Locked = False
37820     Range("CAP.SoldtoNo.FIN").MergeArea.Locked = False
37830 End If

37840 If Sheets("Form").Range("CHK.SettingUp") Or Sheets("Form").Range("CHK.CustomerSolutions") Or Sheets("Form").Range("CHK.D2D") Then
37850     If Sheets("Form").Range("CHK.NewCustomerSetup") Or Sheets("Form").Range("CHK.D2DSales") Then
37860     If Not Range("CHK.PrePay") Then Range("CUS.RMLegalEntityNo") = Range("CUS.RMLegalEntityNo.FIN")
37870     Range("CUS.PPI") = UCase(Range("CUS.PPI.FIN"))
37880     Range("CUS.RMSAPBillingNo") = Range("CUS.RMSAPBillingNo.FIN")
37890         ElseIf Sheets("Form").Range("CHK.NewAccountExistingCust") Or Sheets("Form").Range("CHK.D2DSalesEx") Then
37900         Range("CUS.RMSAPBillingNo") = Range("CUS.RMSAPBillingNo.FIN")
37910     End If
          
37920     Range("CUS.Posting.LocationNo") = Range("CUS.Posting.LocationNo.FIN")
37930     Range("CAP.SoldtoNo") = Range("CAP.SoldtoNo.FIN")
37940     Range("CAP.PosterNo") = Range("CAP.PosterNo.FIN")
37950 End If
37960 Exit Sub
error_proc:
37970     If MsgBox("Error has occured with subroutine [CopyAccountNumber]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
37980     ShutDown

End Sub
Sub CopytoForm()

37990 On Error GoTo error_proc

38000 StartUp

      Dim c As Range
      Dim i As Integer

38010 i = 1
38020 For Each c In Range("PRO.ContractNoList.FIN")
38030     If c.Value = "" Then
38040         GoTo Skip
38050     End If
38060     Sheets("Form").Range("PRO.ContractNo.1").Cells(i, 1).Value = c.Cells.Value
Skip:
38070     i = i + 2
38080 Next c

38090 ShutDown
38100 Exit Sub
error_proc:
38110     If MsgBox("Error has occured with subroutine [CopytoForm]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
38120     ShutDown
End Sub
Sub CopyContractNo()

      Dim c As Range
      Dim first As Integer
38130 On Error GoTo error_proc

38140 Range("PRO.ContractNo.FIN").Value = Sheets("Form").Range("PRO.ContractNo").Value
38150 first = True
38160 For Each c In Sheets("Form").Range("PRO.ContractNo")
38170     If Not first Then
38180         If Not c.Value = "" Then
38190         Range("PRO.ContractNo.FIN").Value = Range("PRO.ContractNo.FIN").Value & ", " & c.Value
38200         End If
38210     End If
38220     first = False
38230 Next c
38240 Exit Sub
error_proc:
38250     If MsgBox("Error has occured with subroutine [CopyContractNo]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
38260     ShutDown

End Sub
Sub CopyPartnerNames()

      Dim rng As Range

38270 On Error GoTo error_proc
38280 Set rng = Range("CUS.Partner.FIN")

38290 rng = ""

38300 On Error Resume Next
38310 If Not Sheets("Form").Range("PAR.LastName.1") = "" Then
38320     rng = rng & Sheets("Form").Range("PAR.FirstName.1") & " " & Sheets("Form").Range("PAR.LastName.1") & ", "
38330 End If
38340 If Not Sheets("Form").Range("PAR.LastName.2") = "" Then
38350     rng = rng & Sheets("Form").Range("PAR.FirstName.2") & " " & Sheets("Form").Range("PAR.LastName.2") & ", "
38360 End If
38370 If Not Sheets("Form").Range("PAR.LastName.3") = "" Then
38380     rng = rng & Sheets("Form").Range("PAR.FirstName.3") & " " & Sheets("Form").Range("PAR.LastName.3") & ", "
38390 End If
38400 If Not Sheets("Form").Range("PAR.LastName.4") = "" Then
38410     rng = rng & Sheets("Form").Range("PAR.FirstName.4") & " " & Sheets("Form").Range("PAR.LastName.4") & ", "
38420 End If
38430 If Not Sheets("Form").Range("PAR.LastName.5") = "" Then
38440     rng = rng & Sheets("Form").Range("PAR.FirstName.5") & " " & Sheets("Form").Range("PAR.LastName.5") & ", "
38450 End If
38460 If Not Sheets("Form").Range("PAR.LastName.6") = "" Then
38470     rng = rng & Sheets("Form").Range("PAR.FirstName.6") & " " & Sheets("Form").Range("PAR.LastName.6") & ", "
38480 End If
38490 If Not Sheets("Form").Range("PAR.LastName.7") = "" Then
38500     rng = rng & Sheets("Form").Range("PAR.FirstName.7") & " " & Sheets("Form").Range("PAR.LastName.7") & ", "
38510 End If
38520 If Not Sheets("Form").Range("PAR.LastName.8") = "" Then
38530     rng = rng & Sheets("Form").Range("PAR.FirstName.8") & " " & Sheets("Form").Range("PAR.LastName.8") & ", "
38540 End If
38550 If Not Sheets("Form").Range("PAR.LastName.9") = "" Then
38560     rng = rng & Sheets("Form").Range("PAR.FirstName.9") & " " & Sheets("Form").Range("PAR.LastName.9") & ", "
38570 End If

38580 If Len(rng) > 2 Then rng = Left(rng, Len(rng) - 2)
      'Old formula in cell > =CONCATENATE(IF(PAR.LastName.1="","",CONCATENATE(PAR.FirstName.1," ",PAR.LastName.1,", ")),IF(PAR.LastName.2="","",CONCATENATE(PAR.FirstName.2," ",PAR.LastName.2,", ")),IF(PAR.LastName.3="","",CONCATENATE(PAR.FirstName.3," ",PAR.LastName.3,", ")),IF(PAR.LastName.4="","",CONCATENATE(PAR.FirstName.4," ",PAR.LastName.4,", ")),IF(PAR.LastName.5="","",CONCATENATE(PAR.FirstName.5," ",PAR.LastName.5,", ")),IF(PAR.LastName.6="","",CONCATENATE(PAR.FirstName.6," ",PAR.LastName.6,", ")),IF(PAR.LastName.7="","",CONCATENATE(PAR.FirstName.7," ",PAR.LastName.7,", ")),IF(PAR.LastName.8="","",CONCATENATE(PAR.FirstName.8," ",PAR.LastName.8,", ")),IF(PAR.LastName.9="","",CONCATENATE(PAR.FirstName.9," ",PAR.LastName.9,", ")))
38590 Exit Sub
error_proc:
38600     If MsgBox("Error has occured with subroutine [CopyPartnerNames]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
38610     ShutDown
End Sub
Attribute VB_Name = "Form"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
'---------------------------------------------------------------------------------------
' Sheet    : Form
' Author    : 918740
' Date      : This is the code to support OLE objects i.e. buttons and checkboxes within
'             main input worksheet "Form"
'---------------------------------------------------------------------------------------

Private Sub Worksheet_Activate()
20510 On Error GoTo error_proc
20520 ShowHide
20530 ActiveSheet.DisplayPageBreaks = False
20540 Exit Sub
error_proc:
20550     If MsgBox("Error has occured with subroutine [Form_Activate]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
20560     ShutDown
End Sub

Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)
      Dim Counter As Integer

20570 On Error GoTo Proc_Error
20580 Form.Unprotect Password:="fruitbasket"
      'StartUp
20589 Select Case Target.SubAddress

          Case "Chk.D2D"
20590       If Range("Chk.D2D") Then
20592       Else
20593           Range("Chk.D2D") = True
20594           Call D2D_Click
20595           Call SUSHide2_Click
20596       End If
20597     Case "Chk.D2DSales"
20598       If Range("Chk.D2DSales") Then
20559           Range("Chk.D2DSales") = Not (Range("Chk.D2DSales"))
20600       Else
20601       'If MsgBox("This feature is currently in testing with specific users. Please only proceed if you're authorised to do so. Do you wish to continue?", vbYesNo, "Door to Door Trial") = vbNo Then GoTo Exit_Proc
20602           Range("Chk.D2DSales") = True
20603           If Range("Chk.D2DSalesAddOn") Then Range("Chk.D2DSalesAddOn") = Not (Range("Chk.D2DSalesAddOn"))
20604           If Range("Chk.D2DSalesEx") Then Range("Chk.D2DSalesEx") = Not (Range("Chk.D2DSalesEx"))
20605           Call CHK_D2DSales_Click
20606       End If
20607     Case "Chk.D2DSalesAddOn"
20608       If Range("Chk.D2DSalesAddOn") Then
20609           Range("Chk.D2DSalesAddOn") = Not (Range("Chk.D2DSalesAddOn"))
20610       Else
20611       'If MsgBox("This feature is currently in testing with specific users. Please only proceed if you're authorised to do so. Do you wish to continue?", vbYesNo, "Door to Door Trial") = vbNo Then GoTo Exit_Proc
20612           Range("Chk.D2DSalesAddOn") = True
20613           If Range("Chk.D2DSales") Then Range("Chk.D2DSales") = Not (Range("Chk.D2DSales"))
20614           If Range("Chk.D2DSalesEx") Then Range("Chk.D2DSalesEx") = Not (Range("Chk.D2DSalesEx"))
20615           Call CHK_D2DSales_Click
20616       End If

20617     Case "Chk.D2DSalesEx"
20618       If Range("Chk.D2DSalesEx") Then
20619           Range("Chk.D2DSalesEx") = Not (Range("Chk.D2DSalesEx"))
20620       Else
20621       'If MsgBox("This feature is currently in testing with specific users. Please only proceed if you're authorised to do so. Do you wish to continue?", vbYesNo, "Door to Door Trial") = vbNo Then GoTo Exit_Proc
20622           Range("Chk.D2DSalesEx") = True
20623           If Range("Chk.D2DSales") Then Range("Chk.D2DSales") = Not (Range("Chk.D2DSales"))
20624           If Range("Chk.D2DSalesAddOn") Then Range("Chk.D2DSalesAddOn") = Not (Range("Chk.D2DSalesAddOn"))
20625           Call CHK_D2DSales_Click
20626       End If
          
          
          ' User type buttons
20631     Case "SP.Save"
20632         SaveSPDetails
20633     Case "SP.Load"
20634         ImportSP
20635     Case "CHK.Salesperson"
20636         Sheet12.Visible = False
20640         If Range("CHK.SUSHide") Then
20650         Range("CHK.Salesperson") = Not (Range("CHK.Salesperson"))
20660         If Range("CHK.Salesperson") Then
20670             CheckBox35_Click
20680         Else
20690             Range("CHK.Salesperson") = True
20700         End If
20710         End If
20720     Case "CHK.CustomerSolutions"
20730         Range("CHK.CustomerSolutions") = Not (Range("CHK.CustomerSolutions"))
20740         If Range("CHK.CustomerSolutions") Then
20750             CheckBox38_Click
20760         Else
20770             Range("CHK.CustomerSolutions") = True
20780         End If
20790     Case "CHK.CMC"
20800         If Range("CHK.SUSHide") Then
20810         Range("CHK.CMC") = Not (Range("CHK.CMC"))
20820         If Range("CHK.CMC") Then
20830             CheckBox36_Click
20840         Else
20850             Range("CHK.CMC") = True
20860         End If
20870         End If
20880     Case "CHK.CollectionSetUp"
20890         Range("CHK.CollectionSetUp") = Not (Range("CHK.CollectionSetUp"))
20900         If Range("CHK.CollectionSetUp") Then
20910             CheckBox39_Click
20920         Else
20930             Range("CHK.CollectionSetUp") = True
20940         End If
20950     Case "CHK.SettingUp"
20960         Range("CHK.SettingUp") = Not (Range("CHK.SettingUp"))
20970         If Range("CHK.SettingUp") Then
20980             CheckBox37_Click
20990             Call SUSHide_Click
21000         Else
21010             Range("CHK.SettingUp") = True
21020         End If
21030     Case "CHK.Operations"
21040         Range("CHK.Operations") = Not (Range("CHK.Operations"))
21050         If Range("CHK.Operations") Then
21060             CheckBox40_Click
21070         Else
21080             Range("CHK.Operations") = True
21090         End If
21100      Case "CHK.SpecialPricing"
21110         Range("CHK.SpecialPricing") = Not (Range("CHK.SpecialPricing"))
21120         If Range("CHK.SpecialPricing") Then
21130             CheckBox41_Click
21140             subSpecialPricing
21150         Else
21160             Range("CHK.SpecialPricing") = True
21170         End If
21180     Case "CH.Chk"
21190         If Len(Form.Range("CUS.CompanyRegNo")) > 0 Then
21200             If MsgBox("Do you want to check for Companies House details? (You must be online)", vbYesNo, "Check Companies House") = vbYes Then
21210                 'If IsOffice64Bit Then
21220                 'MsgBox ("It looks like you are using a 64-bit version of Excel. Automated Companies House checks are only possible in 32-bit Excel")
21230                 'Else
21240                 getData
21250                 If Len(Sheet18.Range("CH.Name")) > 0 Then
21260                     If Range("CH.Check").Value < 4 Then
21270                         If MsgBox("Do you want to automatically update the company details?", vbYesNo, "Update from Companies House") = vbYes Then
21280                            Range("CUS.CustName") = Sheet18.Range("CH.Name")
21290                            Range("CUS.Address1") = Sheet18.Range("CH.Address1")
21300                            Range("CUS.Address2") = Sheet18.Range("CH.Address2")
21310                            Range("CUS.Address3") = ""
21320                            Range("CUS.Town") = Sheet18.Range("CH.Town")
21330                            Range("CUS.Postcode") = Sheet18.Range("CH.Postcode")
21340                         End If
21350                     Else
21360                         MsgBox ("The existing details have been successfully matched")
21370                     End If
21380                 Else
21390                     MsgBox ("No matching details found for Company Registration Number or other connection error")
21400                 End If
21410                 'End If
21420             End If
21430         Else
21440             MsgBox "Please enter a Company Registration Number first"
21450         End If
21460      Case "CHK.Finance"
21470         Range("CHK.Finance") = Not (Range("CHK.Finance"))
21480         If Range("CHK.Finance") Then
21490             CheckBox42_Click
21500         Else
21510             Range("CHK.Finance") = True
21520         End If
21521      Case "D2D.Sector"
21522             Sheet7.Visible = xlSheetVisible
21523             Sheet7.Activate
21524             Sheet7.Range("A6").Activate

21525      Case "MCC.WP"
'21526           MsgBox "This is a preview of future functionality.  Please click 'Cancel' unless you've been asked to take part in a test."

21527     If Form.Range("CHK.NewCustomerSetup") Then WP_Form.Show Else MsgBox "Welcome packs are currently only available for new customers."

          'Email buttons
21530     Case "Button.1"
21540         If Form.Range("CHK.OpsAssessment") Then Call SEND_FOR_OPERATIONS_ASSESSMENT
21550     Case "Button.2"
21560         If Form.Range("CHK.CreditCheck") Then Call SEND_FOR_CREDIT_CHECK
21570     Case "Button.3"
21571     If ControlLetters.Range("Chk.Transposed") Then MsgBox ("A 24/1c product on this form has a lower or equal price than the equivalent 48/2c product. Please check that the prices/profiles have not been transposed. If the profiles/prices are correct then it is safe to proceed.")
21572     If ControlLetters.Range("Tracked") Then MsgBox "Please ensure you attach your Tracked pricing approval to the email to CE Account Set-up. This must be the PDF from the relevant pricing calculator for Tier 1 & 2. Applications without this attachment will be returned to you."
21573     If Sheet23.Range("LBT1Check") = True And ThisWorkbook.Sheets("Form").Range("CHK.AccountAddOn").Value = True Then MsgBox "In addition to the normal Tracked prcing approval, for Letterboxable Tier 1 set ups for existing accounts you must attach a manager's authorisation if the customer already uses a Tracked service."
21580     If Form.Range("CHK.NewAccountExistingCust") Or Form.Range("CHK.AccountAddOn") Then
21590         Call SUS_EMAIL_SEND
21591     Else
21592         If Form.Range("CHK.NewCustomerSetup") Then
21593           If Form.Range("SST.TCDate") <> "" Then
21594               Call SUS_EMAIL_SEND
21595           Else
21596               MsgBox "You must send the terms and conditions to the customer first."
21597               ShutDown
21598               Exit Sub
21599           End If
21600         End If
21601     End If
21602   If Form.Range("Chk.D2DSales") Or Form.Range("Chk.D2DSalesAddOn") Then
21603       Call SUS_D2D_EMAIL_SEND
21604   End If
21610     Case "Button.4"
21620         If Not Form.Range("pro.product.1") = "" Then
21621           If Not Form.Range("SST.TCDate") = "" Then Call SUS_EMAIL_SEND
21622     End If
21630     Case "Button.5"
21640         Call RETURN_TO_SALES
21650     Case "Button.6"
21660         Call SEND_FOR_FINANCE_ACCOUNT_SETUP
21670     Case "Button.7"
21680         If Worksheets("T&C Control").Range("SpecialPricing.Flag") Then Call SEND_FOR_SPECIAL_PRICING
          
21690     Case "Button.8"
21700         If Form.Range("CHK.CollectionSetupChange") Then Call COLLECTIONS_EMAIL_SEND
21710     Case "Button.9"
21720         If Form.Range("SHP.SolutionReq").Value = "Tracking API" Or Form.Range("SHP.SolutionReq").Value = "API Shipping" Or Form.Range("SHP.SolutionReq").Value = "Local Collect" Or Form.Range("SHP.SolutionReq").Value = "International Shipping" Or Form.Range("SHP.SolutionReq").Value = "Intersoft iShipper" Or Form.Range("SHP.SolutionReq").Value = "Pro Shipping" Then Call SEND_FOR_API_SETUP
21721     Case "Button.MS"
21722         Call MSGenerator1
21730     Case "Button.10"
21740         If Form.Range("CHK.Salesperson") Then
          ' Do nothing
21750     Else
21760         Call SUS_FINANCE
21770     End If
21780     Case "Button.11"
21790         If Form.Range("SHP.SolutionReq").Value = "COSS" And Form.Range("CHK.ShippingSolutionSetup") Then Call SEND_FOR_ACCOUNT_SETUP_CST
21800         If Form.Range("SHP.SolutionReq").Value = "Tracking API" Or Form.Range("SHP.SolutionReq").Value = "3PI-API Shipping" Or Form.Range("SHP.SolutionReq").Value = "API Shipping" Or Form.Range("SHP.SolutionReq").Value = "Local Collect" Or Form.Range("SHP.SolutionReq").Value = "International Shipping" Or Form.Range("SHP.SolutionReq").Value = "Intersoft iShipper" Or Form.Range("SHP.SolutionReq").Value = "Pro Shipping" Then Call SEND_FOR_API_SETUP
21810         If Form.Range("SHP.SolutionReq").Value = "DMO" And Form.Range("CHK.ShippingSolutionSetup") Then Call SEND_FOR_ACCOUNT_SETUP_DMO
21820     Case "Button.13"
21830         If Form.Range("SHP.SolutionReq").Value = "COSS" Then Call UPDATE_COSS_SETUP
              
          ' Sheet buttons
21840     Case "Copy.Mode"
21850         Range("Copy.Mode") = Not (Range("Copy.Mode"))
21860         Range("Copy.Mode.2") = Not (Range("Copy.Mode.2"))
21870     Case "Copy.Mode.2"
21880         Range("Copy.Mode.2") = Not (Range("Copy.Mode.2"))
21890         Range("Copy.Mode") = Not (Range("Copy.Mode"))
21900     Case "CUS.FastTrackRequired"
'21910         If Range("CHK.AccountAddOn") Then Range("CUS.FastTrackRequired") = Not (Range("CUS.FastTrackRequired"))
21920     Case "CUS.ReadytoPostSupport"
21930         Range("CUS.ReadytoPostSupport") = Not (Range("CUS.ReadytoPostSupport"))
21940     Case "CUS.Seasonal"
21950         Range("CUS.Seasonal") = Not (Range("CUS.Seasonal"))
21960     Case "BIL.OptOut"
21970         Range("BIL.OptOut") = Not (Range("BIL.OptOut"))
21980     Case "PRE.CreditFail"
21990         Range("PRE.CreditFail") = Not (Range("PRE.CreditFail"))
22000     Case "PRE.CustNotified"
22010         Range("PRE.CustNotified") = Not (Range("PRE.CustNotified"))
22020     Case "PRE.CustEmailInstruct"
22030         Range("PRE.CustEmailInstruct") = Not (Range("PRE.CustEmailInstruct"))
22040     Case "CRE.ScriptRead"
22050         Range("CRE.ScriptRead") = Not (Range("CRE.ScriptRead"))
22060     Case "SHP.LocalCollect"
22070         Range("SHP.LocalCollect") = Not (Range("SHP.LocalCollect"))
22080     Case "SHP.Export"
22090     ExportCSTcsv
22100     Case "SHP.ftp"
22110         Range("SHP.ftp") = Not (Range("SHP.ftp"))
22120     Case "SHP.ds"
22130         Range("SHP.ds") = Not (Range("SHP.ds"))
22140     Case "SHP.TrackedReturns"
22150         Range("SHP.TrackedReturns") = Not (Range("SHP.TrackedReturns"))
22160         ShowHide

22170     Case "CHK.CombinedApp.Inland"
22180         Range("CHK.CombinedApp.Inland") = Not (Range("CHK.CombinedApp.Inland"))
22190         If Range("CHK.CombinedApp.Inland") Then CHK_CombinedApp_Inland_Click
22200     Case "CHK.CombinedApp.Intl"
22210         Range("CHK.CombinedApp.Intl").Value = Not (Range("CHK.CombinedApp.Intl"))
22220         If Range("CHK.CombinedApp.Intl") Then CHK_CombinedApp_Intl_Click
22230     Case "CHK.CombinedApp.InlandAndIntl"
22240         Range("CHK.CombinedApp.InlandAndIntl") = Not (Range("CHK.CombinedApp.InlandAndIntl"))
22250         If Range("CHK.CombinedApp.InlandAndIntl") Then CHK_CombinedApp_InlandAndIntl_Click
22260     Case "COL.ConfirmDiscuss"
22270         Range("COL.ConfirmDiscuss") = Not (Range("COL.ConfirmDiscuss"))
22280     Case "COL.Days.Mon"
22290         Range("COL.Days.Mon") = Not (Range("COL.Days.Mon"))
22300     Case "COL.Days.Tues"
22310         Range("COL.Days.Tues") = Not (Range("COL.Days.Tues"))
22320     Case "COL.Days.Wed"
22330         Range("COL.Days.Wed") = Not (Range("COL.Days.Wed"))
22340     Case "COL.Days.Thurs"
22350         Range("COL.Days.Thurs") = Not (Range("COL.Days.Thurs"))
22360     Case "COL.Days.Fri"
22370         Range("COL.Days.Fri") = Not (Range("COL.Days.Fri"))
22380     Case "COL.Days.Sat"
22390         Range("COL.Days.Sat") = Not (Range("COL.Days.Sat"))
22400     Case "COL.Days.Sun"
22410         Range("COL.Days.Sun") = Not (Range("COL.Days.Sun"))
22411     Case "COL.Existing"
22412         Range("COL.Existing") = Not (Range("COL.Existing"))
22420     Case "TandC.Generator"
22430         Call WaitForm
              'Call TandCGenerator
22440     Case "ReplyNeeded.Flag"
22450         Range("ReplyNeeded.Flag") = Not (Range("ReplyNeeded.Flag"))
22460     Case "Revert.Flag"
22470         Range("Revert.Flag") = Not (Range("Revert.Flag"))
22480     Case "MM.Generator"
22490         Call MMGenerator
22500     Case "Return.To.Top"
22510         Form.Range("CHK.Salesperson").Select
22520     Case "COL.OpsAssessmentComplete"
22530         Range("COL.OpsAssessmentComplete") = Not (Range("COL.OpsAssessmentComplete"))
22540     Case "CHK.SUSHide"
22550         Call SUSHide_Click
22551     Case "CHK.SUSHide2"
22552         Call SUSHide2_Click
22553     Case "Priority"
22554           Range("Priority") = Not (Range("Priority"))
22555           FinanceAccountSetup.Unprotect Password:="fruitbasket"
22556           FinanceAccountSetup.Range("Priority.Fin") = Range("Priority")
22557           FinanceAccountSetup.Unprotect Password:="fruitbasket"
22560 End Select
          
      'Only salepeople can do these actions
22570 If Range("CHK.Salesperson") Then
22580     Select Case (Target.SubAddress)
              Case "Plus14Days"
22590             Range("CUS.FirstPostingDate") = Now + 14
22600         Case "Download.Latest"
22610             Call DownloadLatest
22620         Case "Clear.Form"
22630             Call ClearForm
22640         Case "Clear.Customer"
22650             Call ClearCustomer
22660         Case "Clear.MCC"
22670             Call ClearMCC
22680         Case "Clear.Sales"
22690             Call ClearSalesContact
22700         Case "Clear.SoleTrader"
22710             Call ClearSoleTrader
22720         Case "Clear.Partner.1"
22730             Call ClearPartner(1)
22740         Case "Clear.Billing"
22750             Call ClearBillingInvoicing
22751         Case "D2D.Clear"
22752             Call ClearD2D
22760         Case "Clear.PrePay"
22770             Call ClearPrePay
22780         Case "Clear.CreditCheck"
22790             Call ClearCreditCheck
22800         Case "Clear.Shipping"
22810             Call ClearShipping
22820         Case "Clear.BMA"
22830             Call ClearBusinessMail
22840         Case "Clear.MailMark"
22850             Call ClearMailMark
22860         Case "Clear.Collection"
22870             Call ClearCollection
22880         Case "Clear.Information"
22890             Call ClearAddInfo
22900         Case "Clear.CMC"
22910             Call ClearCMC
22920         Case "Clear.SettingUp"
22930             Call ClearSettingupServices
22940         Case "Clear.CAP"
22950             Call ClearCAPTeam
22960         Case "Clear.Products"
22970             Call ClearProducts
22980         Case "Clear.Sold"
22990             Call ClearSoldTo
                  
23000         Case "Postcode.Customer"
23010             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
23020                 Call PostcodeSearch(Form.Range("CUS.Postcode"))
23030                 Form.Range("CUS.Address1") = Sheet25.Range("Postcode.Line1")
23040                 Form.Range("CUS.Address2") = Sheet25.Range("Postcode.Line2")
23050                 Form.Range("CUS.Address3") = Sheet25.Range("Postcode.Line3")
23060                 Form.Range("CUS.Town") = Sheet25.Range("Postcode.Town")
23070                 Form.Range("CUS.Postcode") = Sheet25.Range("Postcode.Postcode")
23080                 Form.Range("CUS.Country") = Sheet25.Range("Postcode.Country")
23090                 Sheet25.Range("N2") = Sheet25.Range("Postcode.Line1")
23100                 Sheet25.Range("N3") = Sheet25.Range("Postcode.Line2")
23110                 Sheet25.Range("N4") = Sheet25.Range("Postcode.Line3")
23120                 Sheet25.Range("N5") = Sheet25.Range("Postcode.Town")
23130                 Sheet25.Range("N6") = Sheet25.Range("Postcode.Postcode")
23140                 Sheet25.Range("N7") = Sheet25.Range("Postcode.Country")
23150             Else
23160                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
23170             End If
              
23180         Case "D2D.Postcode"
23181             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
23182                 Call PostcodeSearch(Form.Range("D2D.PC"))
23183                 Form.Range("D2D.Address1") = Sheet25.Range("Postcode.Line1")
23184                 Form.Range("D2D.Address2") = Sheet25.Range("Postcode.Line2")
23185                 Form.Range("D2D.Address3") = Sheet25.Range("Postcode.Line3")
23186                 Form.Range("D2D.Town") = Sheet25.Range("Postcode.Town")
23187                 Form.Range("D2D.PC") = Sheet25.Range("Postcode.Postcode")
23188                 Form.Range("D2D.Country") = Sheet25.Range("Postcode.Country")
23189                 Sheet25.Range("U2") = Sheet25.Range("Postcode.Line1")
23190                 Sheet25.Range("U3") = Sheet25.Range("Postcode.Line2")
23191                 Sheet25.Range("U4") = Sheet25.Range("Postcode.Line3")
23192                 Sheet25.Range("U5") = Sheet25.Range("Postcode.Town")
23193                 Sheet25.Range("U6") = Sheet25.Range("Postcode.Postcode")
23194                 Sheet25.Range("U7") = Sheet25.Range("Postcode.Country")
23195             Else
23196                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
23197             End If

23198         Case "Postcode.Billing"
23199             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
23200                 Call PostcodeSearch(Form.Range("BIL.Postcode"))
23210                 Form.Range("BIL.Address1") = Sheet25.Range("Postcode.Line1")
23220                 Form.Range("BIL.Address2") = Sheet25.Range("Postcode.Line2")
23230                 Form.Range("BIL.Address3") = Sheet25.Range("Postcode.Line3")
23240                 Form.Range("BIL.Town") = Sheet25.Range("Postcode.Town")
23250                 Form.Range("BIL.Postcode") = Sheet25.Range("Postcode.Postcode")
23260                 Form.Range("BIl.Country") = Sheet25.Range("Postcode.Country")
23270                 Sheet25.Range("O2") = Sheet25.Range("Postcode.Line1")
23280                 Sheet25.Range("O3") = Sheet25.Range("Postcode.Line2")
23290                 Sheet25.Range("O4") = Sheet25.Range("Postcode.Line3")
23300                 Sheet25.Range("O5") = Sheet25.Range("Postcode.Town")
23310                 Sheet25.Range("O6") = Sheet25.Range("Postcode.Postcode")
23320                 Sheet25.Range("O7") = Sheet25.Range("Postcode.Country")
23330             Else
23340                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
23350             End If
                  
23360         Case "Postcode.Posting"
23370             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
23380                 Call PostcodeSearch(Form.Range("COL.Postcode"))
23390                 Form.Range("COL.Address1") = Sheet25.Range("Postcode.Line1")
23400                 Form.Range("COL.Address2") = Sheet25.Range("Postcode.Line2")
23410                 Form.Range("COL.Address3") = Sheet25.Range("Postcode.Line3")
23420                 Form.Range("COL.Town") = Sheet25.Range("Postcode.Town")
23430                 Form.Range("COL.Postcode") = Sheet25.Range("Postcode.Postcode")
23440                 Form.Range("COL.Country") = Sheet25.Range("Postcode.Country")
23450                 Sheet25.Range("P2") = Sheet25.Range("Postcode.Line1")
23460                 Sheet25.Range("P3") = Sheet25.Range("Postcode.Line2")
23470                 Sheet25.Range("P4") = Sheet25.Range("Postcode.Line3")
23480                 Sheet25.Range("P5") = Sheet25.Range("Postcode.Town")
23490                 Sheet25.Range("P6") = Sheet25.Range("Postcode.Postcode")
23500                 Sheet25.Range("P7") = Sheet25.Range("Postcode.Country")
23510             Else
23520                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
23530             End If
                  
23540         Case "Postcode.Collection"
23550             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
23560                 Call PostcodeSearch(Form.Range("COL.CollectionPostcode"))
23570                 Form.Range("COL.CollectionAddress1") = Sheet25.Range("Postcode.Line1")
23580                 Form.Range("COL.CollectionAddress2") = Sheet25.Range("Postcode.Line2")
23590                 Form.Range("COL.CollectionAddress3") = Sheet25.Range("Postcode.Line3")
23600                 Form.Range("COL.CollectionTown") = Sheet25.Range("Postcode.Town")
23610                 Form.Range("COL.CollectionPostcode") = Sheet25.Range("Postcode.Postcode")
23620                 Form.Range("COL.CollectionCountry") = Sheet25.Range("Postcode.Country")
23630                 Sheet25.Range("Q2") = Sheet25.Range("Postcode.Line1")
23640                 Sheet25.Range("Q3") = Sheet25.Range("Postcode.Line2")
23650                 Sheet25.Range("Q4") = Sheet25.Range("Postcode.Line3")
23660                 Sheet25.Range("Q5") = Sheet25.Range("Postcode.Town")
23670                 Sheet25.Range("Q6") = Sheet25.Range("Postcode.Postcode")
23680                 Sheet25.Range("Q7") = Sheet25.Range("Postcode.Country")
23690             Else
23700                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
23710             End If
                  
23720         Case "Postcode.Shipping"
23730             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
23740                 Call PostcodeSearch(Form.Range("SHP.Postcode"))
23750                 Form.Range("SHP.Address1") = Sheet25.Range("Postcode.Line1")
23760                 Form.Range("SHP.Address2") = Sheet25.Range("Postcode.Line2")
23770                 Form.Range("SHP.Address3") = Sheet25.Range("Postcode.Line3")
23780                 Form.Range("SHP.Town") = Sheet25.Range("Postcode.Town")
23790                 Form.Range("SHP.Postcode") = Sheet25.Range("Postcode.Postcode")
23800                 Form.Range("SHP.Country") = Sheet25.Range("Postcode.Country")
23810                 Sheet25.Range("R2") = Sheet25.Range("Postcode.Line1")
23820                 Sheet25.Range("R3") = Sheet25.Range("Postcode.Line2")
23830                 Sheet25.Range("R4") = Sheet25.Range("Postcode.Line3")
23840                 Sheet25.Range("R5") = Sheet25.Range("Postcode.Town")
23850                 Sheet25.Range("R6") = Sheet25.Range("Postcode.Postcode")
23860                 Sheet25.Range("R7") = Sheet25.Range("Postcode.Country")
23870             Else
23880                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
23890             End If
                  
23900         Case "Postcode.Return"
23910             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
23920                 Call PostcodeSearch(Form.Range("SHP.ReturnPostcode"))
23930                 Form.Range("SHP.ReturnAddress1") = Sheet25.Range("Postcode.Line1")
23940                 Form.Range("SHP.ReturnAddress2") = Sheet25.Range("Postcode.Line2")
23950                 Form.Range("SHP.ReturnAddress3") = Sheet25.Range("Postcode.Line3")
23960                 Form.Range("SHP.ReturnTown") = Sheet25.Range("Postcode.Town")
23970                 Form.Range("SHP.ReturnPostcode") = Sheet25.Range("Postcode.Postcode")
23980                 Form.Range("SHP.ReturnCountry") = Sheet25.Range("Postcode.Country")
23990                 Sheet25.Range("S2") = Sheet25.Range("Postcode.Line1")
24000                 Sheet25.Range("S3") = Sheet25.Range("Postcode.Line2")
24010                 Sheet25.Range("S4") = Sheet25.Range("Postcode.Line3")
24020                 Sheet25.Range("S5") = Sheet25.Range("Postcode.Town")
24030                 Sheet25.Range("S6") = Sheet25.Range("Postcode.Postcode")
24040                 Sheet25.Range("S7") = Sheet25.Range("Postcode.Country")
24050             Else
24060                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
24070             End If
                  
24080         Case "Postcode.SoldTo"
24090             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
24100                 Call PostcodeSearch(Form.Range("Sold.Postcode"))
24110                 Form.Range("Sold.Address1") = Sheet25.Range("Postcode.Line1")
24120                 Form.Range("Sold.Address2") = Sheet25.Range("Postcode.Line2")
24130                 Form.Range("Sold.Address3") = Sheet25.Range("Postcode.Line3")
24140                 Form.Range("Sold.Town") = Sheet25.Range("Postcode.Town")
24150                 Form.Range("Sold.Postcode") = Sheet25.Range("Postcode.Postcode")
24160                 Form.Range("Sold.Country") = Sheet25.Range("Postcode.Country")
24170                 Sheet25.Range("T2") = Sheet25.Range("Postcode.Line1")
24180                 Sheet25.Range("T3") = Sheet25.Range("Postcode.Line2")
24190                 Sheet25.Range("T4") = Sheet25.Range("Postcode.Line3")
24200                 Sheet25.Range("T5") = Sheet25.Range("Postcode.Town")
24210                 Sheet25.Range("T6") = Sheet25.Range("Postcode.Postcode")
24220                 Sheet25.Range("T7") = Sheet25.Range("Postcode.Country")
24221             Else
24222                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
24223             End If

24224         Case "Postcode.Sole"
24225             If MsgBox("This feature will only work if you are online and connected to the internal Royal Mail Intranet. You must be looking up a UK address. Do you wish to continue?", vbYesNo, "Postcodes Online Lookup") = vbYes Then
24226                 Call PostcodeSearch(Form.Range("Sold.Postcode"))
24227                 Form.Range("SOT.Address1") = Sheet25.Range("Postcode.Line1")
24228                 Form.Range("SOT.Address2") = Sheet25.Range("Postcode.Line2")
24229                 Form.Range("SOT.Address3") = Sheet25.Range("Postcode.Line3")
24230                 Form.Range("SOT.Town") = Sheet25.Range("Postcode.Town")
24231                 Form.Range("SOT.Postcode") = Sheet25.Range("Postcode.Postcode")
24232                 Form.Range("SOT.Country") = Sheet25.Range("Postcode.Country")
24233                 Sheet25.Range("V2") = Sheet25.Range("Postcode.Line1")
24234                 Sheet25.Range("V3") = Sheet25.Range("Postcode.Line2")
24235                 Sheet25.Range("V4") = Sheet25.Range("Postcode.Line3")
24236                 Sheet25.Range("V5") = Sheet25.Range("Postcode.Town")
24237                 Sheet25.Range("V6") = Sheet25.Range("Postcode.Postcode")
24238                 Sheet25.Range("V7") = Sheet25.Range("Postcode.Country")
24239             Else
24240                 If MsgBox("Did you know you can also check postcodes and addresses online at http://www.royalmail.com/find-a-postcode?" & vbNewLine & vbNewLine & "Do you want to go there now?", vbYesNo, "Link to external website") = vbYes Then ThisWorkbook.FollowHyperlink address:="http:/www.royalmail.com/find-a-postcode"
24250             End If
              
24260         Case "Address.SoldTo"
24270             Call SoldToAddress
24280         Case "Address.SoldToBilling"
24290             Call SoldToAddressBilling
24300         Case "Address.SoleTrader"
24310             Call SoleTraderAddress
24320         Case "Address.Partner.1"
24330             Call PartnerAddress
24340         Case "Address.Billing"
24350             Call BillingAddress
24351         Case "D2D.Billing"
24352             Call D2DBilling
24353         Case "D2D.Customer"
24354             Call D2DCustomer
24360         Case "Address.Shipping"
24370             Call ShippingAddress
24380         Case "Address.OBA"
24390             Call OBAAddress
24400         Case "Address.Return"
24410             Call ReturnAddress
24420         Case "Address.Poster"
24430             Call PosterAddress
24440         Case "Address.PosterBilling"
24450             Call PosterBillingAddress
24460         Case "Address.Collection"
24470             Call CollectionAddress
24480         Case "Account.Name"
24490             Range("CUS.CustName") = Range("CUS.AccountName")
24500         Case "Sales.UserName"
24510             Range("SAL.ContactName") = Range("Control.UserName")
24520         Case "MondayToFriday"
24530             Call SelectMondayToFriday
24540         Case "Add.Product"
24550             Call AddProductSub
24560             Call ProductCodeSummary
24561         Case "Add.Tier2"
24562             Call AddT2
              ' Form to use show field buttons
24570         Case "CHK.OpsAssessment"
24580             Range("CHK.OpsAssessment") = Not (Range("CHK.OpsAssessment"))
                  
24590         Case "CHK.CreditCheck"
24600             Range("CHK.CreditCheck") = Not (Range("CHK.CreditCheck"))
                  
24610         Case "CHK.MultiSite"
24620             Range("CHK.MultiSite") = Not (Range("CHK.MultiSite"))
24630         If Range("CHK.MultiSite") Then
24640             Sheet17.Visible = xlSheetVisible
24650         Else
24660             Range("CHK.MultiSite") = False
24670             Sheet17.Visible = xlSheetHidden
24680         End If
              
24690         Case "CHK.Trial"
24700             Range("CHK.Trial") = Not (Range("CHK.Trial"))
24710         If Range("CHK.Trial") Then
24720         Else
24730         End If
              
24740         Case "SP.BMA"
24750                 If Range("CHK.Multisite") Then Range("SP.BMA") = Not (Range("SP.BMA"))
24760                 If Range("SP.BMA") Then If (Range("SP.Physical") = False And Range("SP.Plan") = False And Range("SP.Hybrid") = False) Then MsgBox "This option is currently only for Scottish Procurement Contacts. Please only continue with this selection if you are completing a Scottish Procurement set up and have received appropriate instruction.", vbInformation, "Scottish Procurement Check"
24770         Case "SP.Physical"
24780                 If Range("CHK.Multisite") Then Range("SP.Physical") = Not (Range("SP.Physical"))
24790                 If Range("SP.Physical") Then If (Range("SP.BMA") = False And Range("SP.Plan") = False And Range("SP.Hybrid") = False) Then MsgBox "This option is currently only for Scottish Procurement Contacts. Please only continue with this selection if you are completing a Scottish Procurement set up and have received appropriate instruction.", vbInformation, "Scottish Procurement Check"
24800         Case "SP.Plan"
24810                 If Range("CHK.Multisite") Then Range("SP.Plan") = Not (Range("SP.Plan"))
24820                 If Range("SP.Plan") Then If (Range("SP.BMA") = False And Range("SP.Physical") = False And Range("SP.Hybrid") = False) Then MsgBox "This option is currently only for Scottish Procurement Contacts. Please only continue with this selection if you are completing a Scottish Procurement set up and have received appropriate instruction.", vbInformation, "Scottish Procurement Check"
24830         Case "SP.Hybrid"
24840                 If Range("CHK.Multisite") Then Range("SP.Hybrid") = Not (Range("SP.Hybrid"))
24850                 If Range("SP.Hybrid") Then If (Range("SP.BMA") = False And Range("SP.Plan") = False And Range("SP.Physical") = False) Then MsgBox "This option is currently only for Scottish Procurement Contacts. Please only continue with this selection if you are completing a Scottish Procurement set up and have received appropriate instruction.", vbInformation, "Scottish Procurement Check"
24860         Case "CHK.NewCustomerSetup"
24870             Range("CHK.NewCustomerSetup") = Not (Range("CHK.NewCustomerSetup"))
24880             If Range("CHK.NewCustomerSetup").Value = True Then
24890                 CHK_NewCustomerSetup_Click
24900                 Range("CHK.Trial") = True
24910                 Range("ReplyNeeded.Flag") = True
24920                 Range("CHK.MM").Value = False
24930             Else
24940                 If Range("CHK.NewAccountExistingCust") = False And Range("CHK.AccountAddOn") = False Then
24950                     Range("CHK.DMOorOBA").Value = False
24960                     Range("CHK.BMASetup").Value = False
24970                     Range("CHK.MM").Value = False
24980                 End If
24990                 Range("CHK.Trial") = False
25000                 Range("ReplyNeeded.Flag") = False
25010             End If
              
25020         Case "CHK.NewAccountExistingCust"
25030             Range("CHK.NewAccountExistingCust") = Not (Range("CHK.NewAccountExistingCust"))
25040             If Range("CHK.NewAccountExistingCust").Value = True Then
25050                 CHK_NewAccountExistingCust_Click
25060                 Range("ReplyNeeded.Flag") = True
25070                 Range("CHK.MM").Value = False
25080             Else
25090                 If Range("CHK.NewCustomerSetup") = False And Range("CHK.AccountAddOn") = False Then
25100                     Range("CHK.DMOorOBA").Value = False
25110                     Range("CHK.BMASetup").Value = False
25120                     Range("CHK.MM").Value = False
25130                 End If
25140                 Range("ReplyNeeded.Flag") = False
25150             End If
              
25160         Case "CHK.AccountAddOn"
25170             Range("CHK.AccountAddOn") = Not (Range("CHK.AccountAddOn"))
25180             If Range("CHK.AccountAddOn").Value = True Then
25190                 CHK_AccountAddOn_Click
25200                 Range("ReplyNeeded.Flag") = False
25210             Else
25220                 If Range("CHK.NewCustomerSetup") = False And Range("CHK.NewAccountExistingCust") = False Then
25230                     Range("CHK.DMOorOBA").Value = False
25240                     Range("CHK.BMASetup").Value = False
25250                     Range("CHK.MM").Value = False
25260                 End If
25270                 Range("ReplyNeeded.Flag") = False
25280             End If
              
25290         Case "CHK.DMOorOBA"
25300             Range("CHK.DMOorOBA") = Not (Range("CHK.DMOorOBA"))
                  
25310             If Range("CHK.DMOorOBA") Then
25320                 If Range("CHK.NewCustomerSetup") Or Range("CHK.NewAccountExistingCust") Or Range("CHK.AccountAddOn") Then
25330                     Range("CHK.COSSSetup").Value = False
25340                 Else
25350                     MsgBox "You cannot select DMO or OBA Setup unless you have first selected either New Customer Setup, New Account for Existing Customer or Account Add-On"
25360                     Range("CHK.DMOorOBA").Value = False
25370                 End If
25380             End If
                  
25390         Case "CHK.BMASetup"
25400             Range("CHK.BMASetup") = Not (Range("CHK.BMASetup"))
25410             If Range("CHK.BMASetup") Then
25420                 If Range("CHK.NewCustomerSetup") Or Range("CHK.NewAccountExistingCust") Or Range("CHK.AccountAddOn") Then
                          'Do nothing
25430                 Else
25440                     MsgBox "You cannot select BMA Setup unless you have first selected either New Customer Setup, New Account for Existing Customer or Account Add-On"
25450                     Range("CHK.BMASetup").Value = False
25460                 End If
25470             End If
                  
25480         Case "CHK.MM"
25490             Range("CHK.MM") = Not (Range("CHK.MM"))
25500             If Range("CHK.MM") Then
25510                 If Range("CHK.AccountAddOn") Then
                      'Do nothing
25520                 Else
                          'MsgBox "You cannot select Mailmark unless you have first selected Account Add-On"
                          'Range("CHK.MM").Value = False
25530                 End If
25540             End If
                  
25550         Case "CHK.PricingSheet"
25560             Range("CHK.PricingSheet") = Not (Range("CHK.PricingSheet"))
25570         Case "CHK.PrePay"
25580             Range("CHK.PrePay") = Not (Range("CHK.PrePay"))
25590         Case "CHK.ShippingSolutionSetup"
25600             If Not (Range("Chk.NewCustomerSetup") Or Range("Chk.NewAccountExistingCust") Or Range("Chk.AccountAddOn")) Then
25610                 If Not (Range("CHK.ShippingSolutionSetup")) Then
      '                MsgBox "Please select New Customer Setup, New Account for Existing Customer, or Account Add-On first."
25620                  MsgBox "Please continue only if you intend to request a standalone shipping solution migration. If not, select New/Add On."
25630                  Range("CHK.ShippingSolutionSetup") = Not (Range("CHK.ShippingSolutionSetup"))
25640                  Range("CHK.COSSSetup") = False
25650                  Range("CHK.DMOorOBA") = False
25660                 Else
25670                  Range("CHK.ShippingSolutionSetup") = Not (Range("CHK.ShippingSolutionSetup"))
25680                  Range("CHK.COSSSetup") = False
25690                  Range("CHK.DMOorOBA") = False
25700                 End If
25710             Else
25720                 If Range("CHK.ShippingSolutionSetup") Then
25730                     Range("CHK.COSSSetup") = False
25740                     Range("CHK.DMOorOBA") = False
25750                     Range("CHK.ShippingSolutionSetup") = Not (Range("CHK.ShippingSolutionSetup"))
25760                 Else
25770                     If Range("SHP.SolutionReq") = "COSS" Or Range("SHP.SolutionReq") = "API Shipping" Or Range("SHP.SolutionReq") = "Tracking API" Or Range("SHP.SolutionReq") = "Local Collect" Or Range("SHP.SolutionReq") = "Pro Shipping" Then Range("CHK.COSSSetup") = True
25780                     If Range("SHP.SolutionReq") = "DMO" Or Range("SHP.SolutionReq") = "OBA" Then Range("CHK.DMOorOBA") = True
25790                     Range("CHK.ShippingSolutionSetup") = Not (Range("CHK.ShippingSolutionSetup"))
25800                 End If
25810             End If
25820         Case "CHK.CollectionSetupChange"
25830             Range("CHK.CollectionSetupChange") = Not (Range("CHK.CollectionSetupChange"))
25840         Case "CHK.COSSSetup"
25850             Range("CHK.COSSSetup") = Not (Range("CHK.COSSSetup"))
25860             If Range("CHK.COSSSetup") Then Range("CHK.DMOorOBA").Value = False
25870     End Select
25880     Call WhichPrintArea
25890 End If

25900 For Counter = 2 To 9
25910     If Target.SubAddress = "Add.Partner." & Counter Then Range("Flag.Partner." & Counter) = True
25920     If Target.SubAddress = "Remove.Partner." & Counter Then Call subRemovePartner(Counter)
25930     If Target.SubAddress = "Clear.Partner." & Counter Then Call ClearPartner(Counter)
25940 Next Counter

25950 If Form.Range("CHK.Salesperson") Then
25960     For Counter = 1 To 30
25970         If Target.SubAddress = "Add.Product." & Counter Then Call EditProductSubroutine(Counter)
25980         If Target.SubAddress = "Delete.Product." & Counter Then Call RemoveProductSubroutine(Counter)
25990     Next Counter
26000 End If

26010 If Form.Range("CHK.Salesperson") Then
26020     If Target.SubAddress = "Delete.ProductS.1" Then MsgBox "You must have at least one product. If you have selected the wrong product please use the 'Edit Product' option."
26030 End If

26040 ShowHide

Exit_Proc:
26050     Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
26060     Form.EnableSelection = xlNoRestrictions
26070     On Error GoTo 0
26080     Exit Sub

Proc_Error:
26090     If MsgBox("Error has occured with subroutine [FollowHyperlink]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
26100     Resume Exit_Proc
26110     Resume
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)

      Dim Ranges(5) As String
      Dim Endings(2) As String
      Dim Counter As Integer
      Dim RangeCounter As Integer
      Dim EndCounter As Integer
      Dim ChoicesCol As Integer
      Dim ClassCol As Integer
      Dim ProductRow As Integer
      'on error GoTo error_proc

26120 Ranges(1) = "CUS"
26130 Ranges(2) = "SOT"
26140 Ranges(3) = "BIL"
26150 Ranges(4) = "SHP"
26160 Ranges(5) = "COL"

26170 Endings(1) = "Town"
26180 Endings(2) = "Postcode"

26190 For RangeCounter = 1 To 5
26200     For EndCounter = 1 To 2
26210         Call UPPERCASE(Ranges(RangeCounter) & "." & Endings(EndCounter), Target)
26220     Next EndCounter
26230 Next RangeCounter

26240 Call UPPERCASE("SHP.ReturnTown", Target)
26250 Call UPPERCASE("SHP.ReturnPostcode", Target)

26260 For Counter = 1 To 9
26270     Call UPPERCASE("PAR.Town." & Counter, Target)
26280     Call UPPERCASE("PAR.PostCode." & Counter, Target)
26290 Next Counter
          
      ' Mailmark email address registered dropdown
26300 If Not Intersect(Target, Range("MMK.Registered")) Is Nothing Then
26310     If Form.Range("MMK.Registered").Value = "No" Then
26320         MsgBox "The customer must register their email address on www.royalmail.com. You cannot submit this form until they have done so."
26330     End If
26340 End If

      'Shipping solution dropdown
26350 If Not Intersect(Target, Range("SHP.SolutionReq")) Is Nothing Then
26360     If Form.Range("SHP.SolutionReq").Value = "OBA" Or Form.Range("SHP.SolutionReq").Value = "Click and Drop & OBA" Then
26370         If Not (Range("Chk.NewCustomerSetup") Or Range("Chk.NewAccountExistingCust") Or Range("Chk.AccountAddOn")) Then
26380         MsgBox "Please select New Customer Setup, New Account for Existing Customer, or Account Add-On first."
26390         End If
26400     End If
26410     If Range("SHP.SolutionReq") = "Pro Shipping" Then
26420         If MsgBox("Click & Drop is Royal Mail's preferred Shipping Solution. If Pro-Shipping is required please attach authorisation from Chris Vaughan or Darren Hatton. Click 'Yes' to continue with Pro-Shipping or 'No' to change to Click & Drop.", vbYesNo, "Are you sure you want Pro-Shipping?") = vbNo Then
26430         Range("SHP.SolutionReq") = "Click and Drop & OBA"
26440         End If
26450     End If
26460     If Range("SHP.Show") Then
              'Range("SHP.SolutionReq").Locked = True
26470     End If
26480 End If
              
      'Companies House
26490 If Not Intersect(Target, Range("CUS.CompanyRegNo")) Is Nothing Then
26500     If Sheet18.Range("CH.RegNoChk") <> Range("CUS.CompanyRegNo") Then
26510             Sheet18.Range("B1") = ""
26520             Sheet18.Range("B2") = ""
26530             Sheet18.Range("B3") = ""
26540             Sheet18.Range("B4") = ""
26550             Sheet18.Range("B5") = ""
26560             Sheet18.Range("B6") = ""
26570             Sheet18.Range("B7") = ""
26580             Sheet18.Range("B8") = ""
26590             Sheet18.Range("B9") = ""
26600             Sheet18.Range("B10") = ""
26610             Sheet18.Range("B11") = ""
26620             Sheet18.Range("F1") = ""
26630     End If
26640     If Len(Form.Range("CUS.CompanyRegNo")) > 0 Then
26650         If MsgBox("Do you want to check for Companies House details? (You must be online)", vbYesNo, "Check Companies House") = vbYes Then
26660             'If IsOffice64Bit Then
26670             'MsgBox ("It looks like you are using a 64-bit version of Excel. Automated Companies House checks are only possible in 32-bit Excel")
26680             'Else
26690             getData
26700             If Len(Sheet18.Range("CH.Name")) > 0 Then
26710                     If Range("CH.Check").Value < 4 Then
26720                         If MsgBox("Do you want to automatically update the company details?", vbYesNo, "Update from Companies House") = vbYes Then
26730                            Range("CUS.CustName") = Sheet18.Range("CH.Name")
26740                            Range("CUS.Address1") = Sheet18.Range("CH.Address1")
26750                            Range("CUS.Address2") = Sheet18.Range("CH.Address2")
26760                            Range("CUS.Address3") = ""
26770                            Range("CUS.Town") = Sheet18.Range("CH.Town")
26780                            Range("CUS.Postcode") = Sheet18.Range("CH.Postcode")
26790                         End If
26800                     Else
26810                         MsgBox ("The existing details have been successfully matched")
26820                     End If
26830             Else
26840                     MsgBox ("No matching details found for Company Registration Number or other connection error")
26850             End If
26860             'End If
26870         End If
26880     End If
26890 Sheet18.Range("CH.RegNoChk") = Range("CUS.CompanyRegNo")
26900 End If
              
      'If Not Intersect(Target, Range("COL.PostJobTitle")) Is Nothing Then Call Character35(Range("COL.PostJobTitle"))

26910 If Not Intersect(Target, Range("User.Choose")) Is Nothing Then ShowHide

26920 If Form.Range("User.Type") = 1 Or Form.Range("User.Type") = 3 Then
26930     If Not Intersect(Target, Range("CHK.OpsAssessment")) Is Nothing Then ShowHide
26940     If Not Intersect(Target, Range("CHK.CreditCheck")) Is Nothing Then ShowHide
26950     If Not Intersect(Target, Range("CHK.NewCustomerSetup")) Is Nothing Then ShowHide
26960     If Not Intersect(Target, Range("CHK.NewAccountExistingCust")) Is Nothing Then ShowHide
26970     If Not Intersect(Target, Range("CHK.AccountAddOn")) Is Nothing Then ShowHide
26980     If Not Intersect(Target, Range("CHK.DMOorOBA")) Is Nothing Then ShowHide
26990     If Not Intersect(Target, Range("CHK.BMASetup")) Is Nothing Then ShowHide
27000     If Not Intersect(Target, Range("CHK.MM")) Is Nothing Then ShowHide
27010     If Not Intersect(Target, Range("CHK.CollectionSetupChange")) Is Nothing Then ShowHide
27020     If Not Intersect(Target, Range("CHK.COSSSetup")) Is Nothing Then ShowHide
27021     If Not Intersect(Target, Range("D2D.TP")) Is Nothing Then ShowHide
27030 End If
          
27040 If Not Intersect(Target, Range("COL.Restricted")) Is Nothing Then
27050     StartUp
27060     If Form.Range("COL.Restricted").Value > 0 Then
27070         Form.Range("COL.RestrictedDetails").MergeArea.Locked = False
27080     Else
27090         Form.Range("COL.RestrictedDetails").MergeArea.Value = ""
27100         Form.Range("COL.RestrictedDetails").MergeArea.Locked = True
27110     End If
27120     ShutDown
27130 End If
          
27140 If Not Intersect(Target, Range("CUS.CustNature")) Is Nothing Then ShowHide
        
27150 If Not Intersect(Target, Range("BIL.PayMethod")) Is Nothing Then
27160     Select Case Range("BIL.PayMethod")
              Case "Prepaid": IfPrePay
27170         Case "BACS": IfNotPrePay
27180         Case "Direct Debit (Single Sig)": IfNotPrePay
27190         Case "Direct Debit (Multi Sig)": IfNotOther
27200         Case "Other": IfNotPrePay
27210     End Select
27220 End If
          
27230 If Not Intersect(Target, Range("BIL.PayMethod")) Is Nothing Then
27240     Select Case Range("BIL.PayMethod")
              Case "Prepaid": IfNotOther
27250         Case "BACS": IfNotOther
27260         Case "Direct Debit (Single Sig)": IfNotOther
27270         Case "Direct Debit (Multi Sig)": IfNotOther
27280         Case "Other": IfOther
27290     End Select
27300 End If
          
27310 If Not Intersect(Target, Range("SHP.SolutionReq")) Is Nothing _
          Or Not Intersect(Target, Range("COL.Floor")) Is Nothing Then
27320     ShowHide
27330 End If
          
27340 If Not Intersect(Target, Range("COL.Packaging")) Is Nothing Then
27350     StartUp
27360     If Range("COL.Packaging") = "Other (please specify)" Then
27370         Range("COL.Packaging.Other").MergeArea.Locked = False
27380     Else
27390         Range("COL.Packaging.Other").MergeArea.ClearContents
27400         Range("COL.Packaging.Other").MergeArea.Locked = True
27410     End If
27420     ShowHide
27430 End If

27440 If Not Intersect(Target, Range("COL.ContType")) Is Nothing Then
27450     StartUp
27460     If Range("COL.ContType") = "Other (please specify)" Then
27470         Range("COL.ContType.Other").MergeArea.Locked = False
27480     Else
27490         Range("COL.ContType.Other").MergeArea.ClearContents
27500         Range("COL.ContType.Other").MergeArea.Locked = True
27510     End If
27520     ShowHide
27530 End If

27540 For Counter = 1 To 30
27550     If Not Intersect(Target, Range("PRO.Product." & Counter)) Is Nothing Then
27560         ChoicesCol = Form.Range("Form.Class.Choices").Column
27570         ClassCol = Form.Range("PRO.Class").Column
27580         ProductRow = Target.Row
27590         Form.Cells(ProductRow, ClassCol).Value = Form.Cells(ProductRow, ChoicesCol + 1)
27600         ShowHide
27610     End If
27620 Next Counter
              
      ' Shipping solution required dropdown
27630 If Not Intersect(Target, Range("SHP.SolutionReq")) Is Nothing Then
27640     If Range("SHP.SolutionReq") = "COSS" Or Range("SHP.SolutionReq") = "API Shipping" Or Range("SHP.SolutionReq") = "Tracking API" Or Range("SHP.SolutionReq") = "Local Collect" Or Range("SHP.SolutionReq") = "Pro Shipping" Or Range("SHP.SolutionReq") = "International Shipping" Or Range("SHP.SolutionReq") = "3PI-API Shipping" Then
27650         Range("CHK.COSSSetup") = True
27660         Range("CHK.DMOorOBA") = False
27670     ElseIf Range("SHP.SolutionReq").Value = "DMO" Or Range("SHP.SolutionReq").Value = "OBA" Then
27680         Range("CHK.DMOorOBA") = True
27690         Range("CHK.COSSSetup") = False
27700     Else
27710         Range("CHK.DMOorOBA") = False
27720         Range("CHK.COSSSetup") = False
27730     End If
27740 End If

      ' Collection type dropdown
27750 If Not Intersect(Target, Range("COL.SetupChange")) Is Nothing Then ShowHide

      'Extend Additional Information Field
27760 If Not Intersect(Target, Range("ADD.Information")) Is Nothing Then
27770     Form.Unprotect Password:="fruitbasket"
27780     If Len(Range("Add.Information")) > 500 Then
27790         Rows("659:661").RowHeight = Round(Len(Range("Add.Information"))) * 0.05
27800     Else
27810         Rows("659:661").RowHeight = 15
27820     End If
27830     Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
27840 End If

27850 Exit Sub
error_proc:
27860     If MsgBox("Error has occured with subroutine [Form_WorksheetChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27870     ShutDown

              
End Sub
Sub Character35(ThisRange As Range)
27880 On Error GoTo error_proc

27890 If Len(ThisRange.text) > 35 Then
27900     MsgBox "This field is limited to a maximum of 35 characters.", vbExclamation, "35 Character Limit"
27910     ThisRange = Left(ThisRange.text, 35)
27920 End If
27930 Exit Sub
error_proc:
27940     If MsgBox("Error has occured with subroutine [Form_Character35]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27950     ShutDown
End Sub

Sub UPPERCASE(myR As String, Target As Range)
      Dim changed As Range, c As Range
      Dim cVal
27960 On Error GoTo error_proc

27970 Set changed = Intersect(Target, Range(myR))
27980     If Not changed Is Nothing Then
27990         Application.EnableEvents = False
28000         For Each c In changed
28010             cVal = c.Value
28020             Select Case True
                      Case IsEmpty(cVal), IsNumeric(cVal), _
                              IsDate(cVal), IsError(cVal)
                          ' Do nothing
28030                 Case Else
28040                     c.Value = UCase(cVal)
28050             End Select
28060         Next c
28070         Application.EnableEvents = True
28080     End If
28090 Exit Sub
error_proc:
28100     If MsgBox("Error has occured with subroutine [Form_UPPERCASE]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28110     ShutDown
End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
28120 On Error GoTo error_proc
28130 If Range("CHK.CMC") Or Range("CHK.SettingUp") _
          Or Range("CHK.CustomerSolutions") Or Range("CHK.CollectionSetUp") Then
28140     If Range("Copy.Mode") And ActiveSheet.ProtectContents = True _
              And Target.Cells(1, 1).text <> "" Then
28150             Target.Cells(1, 1).Copy
28160     End If
28170 End If
28180 Exit Sub
error_proc:
28190     If MsgBox("Error has occured with subroutine [Form_SelectionChange]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28200     ShutDown
End Sub

Attribute VB_Name = "Hyperlinks"
Sub FollowHyperlink()
Attribute FollowHyperlink.VB_Description = "Follow hyperlink"
Attribute FollowHyperlink.VB_ProcData.VB_Invoke_Func = "m\n14"
On Error Resume Next
   ActiveCell.Hyperlinks(1).Follow
End Sub

Attribute VB_Name = "ImportTier1"
Sub ImportTier1CSV()
Attribute ImportTier1CSV.VB_ProcData.VB_Invoke_Func = " \n14"
      Dim ws As Worksheet
      Dim qt As QueryTable
      Dim fl As String

39280 On Error GoTo error_proc

39290 ImportCleanUp
39300 fl = GetFile

39310 If CountLines(fl) = 1 And CountFields(fl) = 34 Then

39320     With Sheet23.QueryTables.Add(Connection:= _
          "TEXT;" & fl, Destination:=Sheet23.Range( _
          "$B$3"))
39330         .name = "Tier1Import"
39340         .FieldNames = True
39350         .RowNumbers = False
39360         .FillAdjacentFormulas = False
39370         .PreserveFormatting = True
39380         .RefreshOnFileOpen = False
39390         .RefreshStyle = xlOverwriteCells
39400         .SavePassword = False
39410         .SaveData = True
39420         .AdjustColumnWidth = False
39430         .RefreshPeriod = 0
39440         .TextFilePromptOnRefresh = False
39450         .TextFilePlatform = 1252
39460         .TextFileStartRow = 1
39470         .TextFileParseType = xlDelimited
39480         .TextFileTextQualifier = xlTextQualifierDoubleQuote
39490         .TextFileConsecutiveDelimiter = False
39500         .TextFileTabDelimiter = False
39510         .TextFileSemicolonDelimiter = False
39520         .TextFileCommaDelimiter = True
39530         .TextFileSpaceDelimiter = False
39540         .TextFileColumnDataTypes = Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, _
              1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
39550         .TextFileTrailingMinusNumbers = True
39560         .Refresh BackgroundQuery:=False
39570     End With

39580     For Each ws In ThisWorkbook.Worksheets
39590         For Each qt In ws.QueryTables
39600             qt.Delete
39610         Next qt
39620     Next ws

39630 Else

39640     MsgBox ("The file is not in the expected format and cannot be imported.")
39650     Exit Sub

39660 End If

39670 Exit Sub

error_proc:
39680     If MsgBox("Error has occured with subroutine [ImportTier1CSV]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
39690     ShutDown
End Sub

Function GetFile() As String
          Dim filename__path As Variant
39700     filename__path = Application.GetOpenFilename(filefilter:="Csv (*.CSV), *.CSV", Title:="Select File To Be Opened")
39710     If filename__path = False Then Exit Function
39720     GetFile = filename__path
End Function

Function CountLines(PathStr As String) As Long
          
          Dim fso As Object
          Dim ts As Object
          Dim StartAt As Date
          Dim EndAt As Date
        
39730     Set fso = CreateObject("Scripting.FileSystemObject")
39740     Set ts = fso.OpenTextFile(PathStr)
          
39750     Do Until ts.AtEndOfStream
39760         CountLines = CountLines + 1
39770         ts.ReadLine
39780     Loop
          
39790     ts.Close
39800     Set ts = Nothing
39810     Set fso = Nothing
              
End Function

Function CountFields(PathStr As String) As Long

          Dim MyData As String
          Dim strData() As String
          Dim TempAr() As String

          '~~> Open the text file in one go
39820     Open PathStr For Binary As #1
39830     MyData = Space$(LOF(1))
39840     Get #1, , MyData
39850     Close #1
39860     strData() = Split(MyData, vbCrLf)

          '~~> Check for any empty headers and replace ",," by ","
39870     Do While InStr(1, strData(0), ",,") > 0
39880         strData(0) = Replace(strData(0), ",,", ",")
39890     Loop

          '~~> Split the headers to find the number of columns
39900     TempAr() = Split(strData(0), ",")
39910     CountFields = UBound(TempAr)

End Function

Sub ImportCleanUp()
39920 Sheet23.Range("B3:AI3").ClearContents
End Sub

Attribute VB_Name = "ImportTier2"
Sub ImportT2()
ActiveWorkbook.Queries.Item("Parcels Approvals Register").Formula = Sheet2.Range("T2_F").Value
ActiveWorkbook.Connections("Query - Parcels Approvals Register").Refresh
End Sub

Attribute VB_Name = "LDAPLookup"
Sub ExportRange()
      'Work in progress for v5
      Dim Query1 As String
      Dim Query2 As String
      Dim i As Integer
      Dim rc As Integer

39930 i = 2
39940 rc = 0

39950 Query2 = " AND Name='" & Environ("username") & "'"

39960 Set objConnection = CreateObject("ADODB.Connection")
39970 Set objCommand = CreateObject("ADODB.Command")
39980 objConnection.Provider = "ADsDSOObject"
39990 objConnection.Open "Active Directory Provider"
40000 Set objCommand.ActiveConnection = objConnection

40010 objCommand.Properties("Page Size") = 1
      'Debug.Print Now()
40020 Query1 = "Select department, l, title, telephonenumber, givenname, sn, initials, displayname, name," _
      & "physicalDeliveryOfficeName, streetAddress, st, postalCode, c, company, manager, displayname, mobile, info, homePhone, facsimileTelephoneNumber, mail FROM 'LDAP://dc=rmgp,dc=royalmailgroup,dc=net'" _
      & "WHERE objectCategory='user'"

40030 objCommand.CommandText = Query1 & Query2

40040 Set objRecordset = objCommand.Execute
      'Debug.Print Now()
40050 If objRecordset.EOF Then Exit Sub

40060 objRecordset.MoveFirst
       
      'Sheet15.Cells(1, 1).Value = "User Name"
      'Sheet15.Cells(1, 2).Value = "Last"
      'Sheet15.Cells(1, 4).Value = "Initials"
      'Sheet15.Cells(1, 5).Value = "Company"
      'Sheet15.Cells(1, 6).Value = "Office"
      'Sheet15.Cells(1, 7).Value = "Address"
      'Sheet15.Cells(1, 8).Value = "City"
      'Sheet15.Cells(1, 9).Value = "County"
      'Sheet15.Cells(1, 10).Value = "Post Code"
      'Sheet15.Cells(1, 11).Value = "Country"
      'Sheet15.Cells(1, 12).Value = "Business Phone"
      'Sheet15.Cells(1, 13).Value = "Title"
      'Sheet15.Cells(1, 14).Value = "Department"
      'Sheet15.Cells(1, 15).Value = "Manager"
      'Sheet15.Cells(1, 16).Value = "Display Name"
      'Sheet15.Cells(1, 17).Value = "Mobile"
      'Sheet15.Cells(1, 18).Value = "Info"
      'Sheet15.Cells(1, 19).Value = "Home Phone"
      'Sheet15.Cells(1, 20).Value = "Fax"
      'Sheet15.Cells(1, 21).Value = "Email"

      'Do Until objRecordset.EOF
          'Sheet15.Cells(i, 1).Value = objRecordset.Fields("Name").Value
          'Sheet15.Cells(i, 2).Value = objRecordset.Fields("sn").Value
          'Sheet15.Cells(i, 3).Value = objRecordset.Fields("givenname").Value
          'Sheet15.Cells(i, 4).Value = objRecordset.Fields("initials").Value
          'Sheet15.Cells(i, 5).Value = objRecordset.Fields("company").Value
          'Sheet15.Cells(i, 6).Value = objRecordset.Fields("physicalDeliveryOfficeName").Value
          'Sheet15.Cells(i, 7).Value = objRecordset.Fields("streetAddress").Value
          'Sheet15.Cells(i, 8).Value = objRecordset.Fields("l").Value
          'Sheet15.Cells(i, 9).Value = objRecordset.Fields("st").Value
          'Sheet15.Cells(i, 10).Value = objRecordset.Fields("postalCode").Value
          'Sheet15.Cells(i, 11).Value = objRecordset.Fields("c").Value
40070     Sheet15.Cells(i, 12).Value = objRecordset.Fields("telephoneNumber").Value
          'Sheet15.Cells(i, 13).Value = objRecordset.Fields("title").Value
          'Sheet15.Cells(i, 14).Value = objRecordset.Fields("department").Value
          'Sheet15.Cells(i, 15).Value = objRecordset.Fields("manager").Value
40080     Sheet15.Cells(i, 16).Value = objRecordset.Fields("displayname").Value
40090     Sheet15.Cells(i, 17).Value = objRecordset.Fields("mobile").Value
          'Sheet15.Cells(i, 18).Value = objRecordset.Fields("info").Value
40100     Sheet15.Cells(i, 19).Value = objRecordset.Fields("homePhone").Value
          'Sheet15.Cells(i, 20).Value = objRecordset.Fields("facsimileTelephoneNumber").Value
40110     Sheet15.Cells(i, 21).Value = objRecordset.Fields("mail").Value
       
40120     i = i + 1
          'objRecordset.MoveNext
      'Loop
      'Debug.Print Now()
      'rc = rc + objRecordset.RecordCount

End Sub


Attribute VB_Name = "Minor_Functions"
Function GetURL(rng As Range) As String
40130     On Error Resume Next
40140     GetURL = rng.Hyperlinks(1).address
End Function

Function Username() As String
40150 Username = Application.Username
End Function
Attribute VB_Name = "PAF"
Public PostCode As String
Public DP As Long

Sub Reset()
40160     Sheet25.Range("A:F").ClearContents
End Sub

Sub PostcodeSearch(pc As Range)
40170 PostCode = InputBox("Please enter a Postcode", "Postcode", pc)
40180 If PostCode = "" Then Exit Sub

40190 PAFLink

40200 If IsEmpty(Sheet25.Range("D13")) Then Exit Sub

40210 x = Split(Sheet25.Range("D13").Value)
40220 For i = 0 To UBound(x)
40230 Sheet25.Cells(13, i + 5) = x(i)
40240 Next i

40250 Sheet25.Range("D1:D15").Replace What:="&nbsp;", Replacement:="", LookAt:=xlPart, _
      SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
      ReplaceFormat:=False

End Sub


Sub PAFLink()
      Dim strResponse As String
      Dim Position As Integer
      Dim Position2 As Integer
      Dim PosStop As Integer
      Dim PosStop2 As Integer
      Dim PosLen2 As Integer
      Dim PosLen As Integer
      Dim Output As String
      Dim Output2 As String
      Dim i As Integer
      Dim OrganisationS As Integer
      Dim DepartmentS As Integer
      Dim POBoxS As Integer
      Dim SubBuildingS As Integer
      Dim BuildingS As Integer
      Dim BuildingNumberS As Integer
      Dim DepThoroughfareS As Integer
      Dim ThoroughfareS As Integer
      Dim DblDepLocalityS As Integer
      Dim DependantLocalityS As Integer
      Dim PostTownS As Integer
      Dim CountyS As Integer
      Dim PostcodeS As Integer
      Dim DPSuffixS As Integer
      Dim PostcodeTypeS As Integer
      Dim OrganisationF As Integer
      Dim DepartmentF As Integer
      Dim POBoxF As Integer
      Dim SubBuildingF As Integer
      Dim BuildingF As Integer
      Dim BuildingNumberF As Integer
      Dim DepThoroughfareF As Integer
      Dim ThoroughfareF As Integer
      Dim DblDepLocalityF As Integer
      Dim DependantLocalityF As Integer
      Dim PostTownF As Integer
      Dim CountyF As Integer
      Dim PostcodeF As Integer
      Dim DPSuffixF As Integer
      Dim PostcodeTypeF As Integer
      Dim ExistingPC As String

40260 On Error Resume Next

40270 Sheet25.Range("A:F").ClearContents

40280 Sheet25.Cells(1, 3).Value = "Organisation"
40290 Sheet25.Cells(2, 3).Value = "Department"
40300 Sheet25.Cells(3, 3).Value = "PO Box"
40310 Sheet25.Cells(4, 3).Value = "Sub Building"
40320 Sheet25.Cells(5, 3).Value = "Building"
40330 Sheet25.Cells(6, 3).Value = "Building Number"
40340 Sheet25.Cells(7, 3).Value = "Dep Thoroughfare"
40350 Sheet25.Cells(8, 3).Value = "Thoroughfare"
40360 Sheet25.Cells(9, 3).Value = "Dbl Dep Locality"
40370 Sheet25.Cells(10, 3).Value = "Dependant Locality"
40380 Sheet25.Cells(11, 3).Value = "PostTown"
40390 Sheet25.Cells(12, 3).Value = "County"
40400 Sheet25.Cells(13, 3).Value = "Postcode"
40410 Sheet25.Cells(14, 3).Value = "DP Suffix"
40420 Sheet25.Cells(15, 3).Value = "Postcode Type"

40430 Application.ScreenUpdating = False

40440 With CreateObject("MSXML2.XMLHTTP")
40450     .Open "POST", "http://pol.intranet.point/AF-proc.asp", False
40460     .setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
40470     .send ("Postcode=" & PostCode & "&Premise=&procid=AF&search=Search")
40480     Do: DoEvents: Loop Until .readyState = 4
40490     strResponse = .responseText
40500     .abort
40510 End With

40520 Position = 0
40530 i = 1

40540 If InStr(1, strResponse, "Address Label") = 0 Then

40550 Do
40560     Position = InStr(Position + 1, strResponse, "<option value='")
40570     PosStop = InStr(Position + 15, strResponse, "'")
40580     PosLen = PosStop - Position - 15

40590     If Position > 0 Then
40600         Position2 = InStr(Position, strResponse, ">") + 1
40610         PosStop2 = InStr(Position2, strResponse, "<")
40620         PosLen2 = PosStop2 - Position2
40630         Output = Mid(strResponse, Position + 15, PosLen)
40640         Output2 = Mid(strResponse, Position2, PosLen2)
40650         Sheet25.Cells(i, 2).Value = Output
40660         Sheet25.Cells(i, 1).Value = Output2
40670     End If

40680     i = i + 1
40690 Loop While Position <> 0

40700 PAF_DP_Select.Show

40710 Else

40720 OrganisationS = InStr(1, strResponse, "Organisation</td>") + 50
40730 OrganisationF = InStr(OrganisationS + 1, strResponse, "</tr>") - 5 - OrganisationS
40740 Sheet25.Cells(1, 4).Value = Mid(strResponse, OrganisationS, OrganisationF)

40750 DepartmentS = InStr(1, strResponse, "Department</td>") + 48
40760 DepartmentF = InStr(DepartmentS + 1, strResponse, "</tr>") - 5 - DepartmentS
40770 Sheet25.Cells(2, 4).Value = Mid(strResponse, DepartmentS, DepartmentF)

40780 POBoxS = InStr(1, strResponse, "PO Box</td>") + 44
40790 POBoxF = InStr(POBoxS + 1, strResponse, "</tr>") - 5 - POBoxS
40800 Sheet25.Cells(3, 4).Value = Mid(strResponse, POBoxS, POBoxF)

40810 SubBuildingS = InStr(1, strResponse, "Sub Building</td>") + 50
40820 SubBuildingF = InStr(SubBuildingS + 1, strResponse, "</tr>") - 5 - SubBuildingS
40830 Sheet25.Cells(4, 4).Value = Mid(strResponse, SubBuildingS, SubBuildingF)

40840 BuildingS = InStr(1, strResponse, ">Building</td>") + 47
40850 BuildingF = InStr(BuildingS + 1, strResponse, "</tr>") - 5 - BuildingS
40860 Sheet25.Cells(5, 4).Value = Mid(strResponse, BuildingS, BuildingF)

40870 BuildingNumberS = InStr(1, strResponse, "Building Number</td>") + 53
40880 BuildingNumberF = InStr(BuildingNumberS + 1, strResponse, "</tr>") - 5 - BuildingNumberS
40890 Sheet25.Cells(6, 4).Value = Mid(strResponse, BuildingNumberS, BuildingNumberF)

40900 DepThoroughfareS = InStr(1, strResponse, "Dep Thoroughfare</td>") + 54
40910 DepThoroughfareF = InStr(DepThoroughfareS + 1, strResponse, "</tr>") - 5 - DepThoroughfareS
40920 Sheet25.Cells(7, 4).Value = Mid(strResponse, DepThoroughfareS, DepThoroughfareF)

40930 ThoroughfareS = InStr(1, strResponse, ">Thoroughfare</td>") + 51
40940 ThoroughfareF = InStr(ThoroughfareS + 1, strResponse, "</tr>") - 5 - ThoroughfareS
40950 Sheet25.Cells(8, 4).Value = Mid(strResponse, ThoroughfareS, ThoroughfareF)

40960 DblDepLocalityS = InStr(1, strResponse, "Dbl Dep Locality</td>") + 54
40970 DblDepLocalityF = InStr(DblDepLocalityS + 1, strResponse, "</tr>") - 5 - DblDepLocalityS
40980 Sheet25.Cells(9, 4).Value = Mid(strResponse, DblDepLocalityS, DblDepLocalityF)

40990 DependantLocalityS = InStr(1, strResponse, "Dependant Locality</td>") + 56
41000 DependantLocalityF = InStr(DependantLocalityS + 1, strResponse, "</tr>") - 5 - DependantLocalityS
41010 Sheet25.Cells(10, 4).Value = Mid(strResponse, DependantLocalityS, DependantLocalityF)

41020 PostTownS = InStr(1, strResponse, "PostTown</td>") + 46
41030 PostTownF = InStr(PostTownS + 1, strResponse, "</tr>") - 5 - PostTownS
41040 Sheet25.Cells(11, 4).Value = Mid(strResponse, PostTownS, PostTownF)

41050 CountyS = InStr(1, strResponse, "County</td>") + 44
41060 CountyF = InStr(CountyS + 1, strResponse, "</tr>") - 5 - CountyS
41070 Sheet25.Cells(12, 4).Value = Mid(strResponse, CountyS, CountyF)

41080 PostcodeS = InStr(1, strResponse, "Postcode</td>") + 46
41090 PostcodeF = InStr(PostcodeS + 1, strResponse, "</tr>") - 5 - PostcodeS
41100 Sheet25.Cells(13, 4).Value = Mid(strResponse, PostcodeS, PostcodeF)

41110 DPSuffixS = InStr(1, strResponse, "DP Suffix</td>") + 47
41120 DPSuffixF = InStr(DPSuffixS + 1, strResponse, "</tr>") - 5 - DPSuffixS
41130 Sheet25.Cells(14, 4).Value = Mid(strResponse, DPSuffixS, DPSuffixF)

41140 PostcodeTypeS = InStr(1, strResponse, "Postcode Type</td>") + 41
41150 PostcodeTypeF = InStr(PostcodeTypeS + 1, strResponse, "</tr>") - 5 - PostcodeTypeS
41160 Sheet25.Cells(15, 4).Value = Mid(strResponse, PostcodeTypeS, PostcodeTypeF)

41170 End If


End Sub

Sub DPSelect()
      Dim strResponse As String
      Dim i As Integer
      Dim OrganisationS As Integer
      Dim DepartmentS As Integer
      Dim POBoxS As Integer
      Dim SubBuildingS As Integer
      Dim BuildingS As Integer
      Dim BuildingNumberS As Integer
      Dim DepThoroughfareS As Integer
      Dim ThoroughfareS As Integer
      Dim DblDepLocalityS As Integer
      Dim DependantLocalityS As Integer
      Dim PostTownS As Integer
      Dim CountyS As Integer
      Dim PostcodeS As Integer
      Dim DPSuffixS As Integer
      Dim PostcodeTypeS As Integer
      Dim OrganisationF As Integer
      Dim DepartmentF As Integer
      Dim POBoxF As Integer
      Dim SubBuildingF As Integer
      Dim BuildingF As Integer
      Dim BuildingNumberF As Integer
      Dim DepThoroughfareF As Integer
      Dim ThoroughfareF As Integer
      Dim DblDepLocalityF As Integer
      Dim DependantLocalityF As Integer
      Dim PostTownF As Integer
      Dim CountyF As Integer
      Dim PostcodeF As Integer
      Dim DPSuffixF As Integer
      Dim PostcodeTypeF As Integer
      Dim ExistingPC As String

41180 On Error Resume Next

41190 Sheet25.Range("A:D").ClearContents

41200 Sheet25.Cells(1, 3).Value = "Organisation"
41210 Sheet25.Cells(2, 3).Value = "Department"
41220 Sheet25.Cells(3, 3).Value = "PO Box"
41230 Sheet25.Cells(4, 3).Value = "Sub Building()"
41240 Sheet25.Cells(5, 3).Value = "Building"
41250 Sheet25.Cells(6, 3).Value = "Building Number"
41260 Sheet25.Cells(7, 3).Value = "Dep Thoroughfare"
41270 Sheet25.Cells(8, 3).Value = "Thoroughfare"
41280 Sheet25.Cells(9, 3).Value = "Dbl Dep Locality"
41290 Sheet25.Cells(10, 3).Value = "Dependant Locality"
41300 Sheet25.Cells(11, 3).Value = "PostTown"
41310 Sheet25.Cells(12, 3).Value = "County"
41320 Sheet25.Cells(13, 3).Value = "Postcode"
41330 Sheet25.Cells(14, 3).Value = "DP Suffix"
41340 Sheet25.Cells(15, 3).Value = "Postcode Type"

41350 Application.ScreenUpdating = False

41360 With CreateObject("MSXML2.XMLHTTP")
41370     .Open "POST", "http://pol.intranet.point/AF-proc.asp", False
41380     .setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
41390     .send ("selectdp=" & DP & "&Select=View Label&selectdp&Premise&procid=AF&ReturnValue=0&Postcode=" & PostCode & "&Recoded")
41400     Do: DoEvents: Loop Until .readyState = 4
41410     strResponse = .responseText
41420     .abort
41430 End With

41440 Position = 0
41450 i = 1

41460 OrganisationS = InStr(1, strResponse, "Organisation</td>") + 50
41470 OrganisationF = InStr(OrganisationS + 1, strResponse, "</tr>") - 5 - OrganisationS
41480 Sheet25.Cells(1, 4).Value = Mid(strResponse, OrganisationS, OrganisationF)

41490 DepartmentS = InStr(1, strResponse, "Department</td>") + 48
41500 DepartmentF = InStr(DepartmentS + 1, strResponse, "</tr>") - 5 - DepartmentS
41510 Sheet25.Cells(2, 4).Value = Mid(strResponse, DepartmentS, DepartmentF)

41520 POBoxS = InStr(1, strResponse, "PO Box</td>") + 44
41530 POBoxF = InStr(POBoxS + 1, strResponse, "</tr>") - 5 - POBoxS
41540 Sheet25.Cells(3, 4).Value = Mid(strResponse, POBoxS, POBoxF)

41550 SubBuildingS = InStr(1, strResponse, "Sub Building</td>") + 50
41560 SubBuildingF = InStr(SubBuildingS + 1, strResponse, "</tr>") - 5 - SubBuildingS
41570 Sheet25.Cells(4, 4).Value = Mid(strResponse, SubBuildingS, SubBuildingF)

41580 BuildingS = InStr(1, strResponse, ">Building</td>") + 47
41590 BuildingF = InStr(BuildingS + 1, strResponse, "</tr>") - 5 - BuildingS
41600 Sheet25.Cells(5, 4).Value = Mid(strResponse, BuildingS, BuildingF)

41610 BuildingNumberS = InStr(1, strResponse, "Building Number</td>") + 53
41620 BuildingNumberF = InStr(BuildingNumberS + 1, strResponse, "</tr>") - 5 - BuildingNumberS
41630 Sheet25.Cells(6, 4).Value = Mid(strResponse, BuildingNumberS, BuildingNumberF)

41640 DepThoroughfareS = InStr(1, strResponse, "Dep Thoroughfare</td>") + 54
41650 DepThoroughfareF = InStr(DepThoroughfareS + 1, strResponse, "</tr>") - 5 - DepThoroughfareS
41660 Sheet25.Cells(7, 4).Value = Mid(strResponse, DepThoroughfareS, DepThoroughfareF)

41670 ThoroughfareS = InStr(1, strResponse, ">Thoroughfare</td>") + 51
41680 ThoroughfareF = InStr(ThoroughfareS + 1, strResponse, "</tr>") - 5 - ThoroughfareS
41690 Sheet25.Cells(8, 4).Value = Mid(strResponse, ThoroughfareS, ThoroughfareF)

41700 DblDepLocalityS = InStr(1, strResponse, "Dbl Dep Locality</td>") + 54
41710 DblDepLocalityF = InStr(DblDepLocalityS + 1, strResponse, "</tr>") - 5 - DblDepLocalityS
41720 Sheet25.Cells(9, 4).Value = Mid(strResponse, DblDepLocalityS, DblDepLocalityF)

41730 DependantLocalityS = InStr(1, strResponse, "Dependant Locality</td>") + 56
41740 DependantLocalityF = InStr(DependantLocalityS + 1, strResponse, "</tr>") - 5 - DependantLocalityS
41750 Sheet25.Cells(10, 4).Value = Mid(strResponse, DependantLocalityS, DependantLocalityF)

41760 PostTownS = InStr(1, strResponse, "PostTown</td>") + 46
41770 PostTownF = InStr(PostTownS + 1, strResponse, "</tr>") - 5 - PostTownS
41780 Sheet25.Cells(11, 4).Value = Mid(strResponse, PostTownS, PostTownF)

41790 CountyS = InStr(1, strResponse, "County</td>") + 44
41800 CountyF = InStr(CountyS + 1, strResponse, "</tr>") - 5 - CountyS
41810 Sheet25.Cells(12, 4).Value = Mid(strResponse, CountyS, CountyF)

41820 PostcodeS = InStr(1, strResponse, "Postcode</td>") + 46
41830 PostcodeF = InStr(PostcodeS + 1, strResponse, "</tr>") - 5 - PostcodeS
41840 Sheet25.Cells(13, 4).Value = Mid(strResponse, PostcodeS, PostcodeF)

41850 DPSuffixS = InStr(1, strResponse, "DP Suffix</td>") + 47
41860 DPSuffixF = InStr(DPSuffixS + 1, strResponse, "</tr>") - 5 - DPSuffixS
41870 Sheet25.Cells(14, 4).Value = Mid(strResponse, DPSuffixS, DPSuffixF)

41880 PostcodeTypeS = InStr(1, strResponse, "Postcode Type</td>") + 41
41890 PostcodeTypeF = InStr(PostcodeTypeS + 1, strResponse, "</tr>") - 5 - PostcodeTypeS
41900 Sheet25.Cells(15, 4).Value = Mid(strResponse, PostcodeTypeS, PostcodeTypeF)

End Sub

Attribute VB_Name = "PAF_DP_Select"
Attribute VB_Base = "0{9B4C62B0-83A6-4CE3-915D-A184F9060854}{4BC8AEB4-B1A3-4564-9E92-C3D956BD2A52}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
      Dim i As Integer
      Dim x As Variant

15260 If ListBox1.text = "" Then
15270     Unload UserForm1
15280     Exit Sub
15290 End If

15300 DP = Application.WorksheetFunction.VLookup(ListBox1.text, Sheet25.Range("A:B"), 2, False)
15310 Unload PAF_DP_Select

15320 DPSelect

15330 x = Split(Sheet25.Range("D13").Value)

15340 For i = 0 To UBound(x)
15350 Sheet25.Cells(13, i + 5) = x(i)
15360 Next i

End Sub

Private Sub UserForm_Initialize()
      Dim i As Integer

15370 i = 1

15380 Do
15390     ListBox1.AddItem (Sheet25.Cells(i, 1))
15400     i = i + 1
15410 Loop Until IsEmpty(Sheet25.Cells(i, 1))

End Sub
Attribute VB_Name = "PricingLetters"
Sub RM24FR()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
41910 Set DDWordApp = CreateObject("Word.Application")
41920 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMFR18_2.docx", ReadOnly:=False)

      'Replace
41930 With DDWordDoc.Range.Find
41940     .ClearFormatting
41950     .text = "[CUS]"
41960     .Replacement.text = Range("CUS.CustName").Value
41970     .MatchWholeWord = True
41980     .MatchCase = True
41990     .Forward = True
42000     .Wrap = wdFindStop
42010     .Execute Replace:=wdReplaceAll
42020 End With

42030 With DDWordDoc.Range.Find
42040     .ClearFormatting
42050     .text = "[NAME]"
42060     .Replacement.text = Range("CONTROL.Letters!S19").Value
42070     .MatchWholeWord = True
42080     .MatchCase = True
42090     .Forward = True
42100     .Wrap = wdFindStop
42110     .Execute Replace:=wdReplaceAll
42120 End With


42130 With DDWordDoc.Range.Find
42140     .ClearFormatting
42150     .text = "[DATE]"
42160     .Replacement.text = Format(Now, "dd/mm/yy")
42170     .MatchWholeWord = True
42180     .MatchCase = True
42190     .Forward = True
42200     .Wrap = wdFindStop
42210     .Execute Replace:=wdReplaceAll
42220 End With

42230 With DDWordDoc.Range.Find
42240     .ClearFormatting
42250     .text = "[ORDERID]"
42260     .Replacement.text = Range("CUS.Order").Value
42270     .MatchWholeWord = True
42280     .MatchCase = True
42290     .Forward = True
42300     .Wrap = wdFindStop
42310     .Execute Replace:=wdReplaceAll
42320 End With

42330 With DDWordDoc.Range.Find
42340     .ClearFormatting
42350     .text = "[ACCNUM]"
42360     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
42370     .MatchWholeWord = True
42380     .MatchCase = True
42390     .Forward = True
42400     .Wrap = wdFindStop
42410     .Execute Replace:=wdReplaceAll
42420 End With

42430 With DDWordDoc.Range.Find
42440     .ClearFormatting
42450     .text = "[RM24#]"
42460     .Replacement.text = Range("Control.RM24Contract").Value
42470     .MatchWholeWord = True
42480     .MatchCase = True
42490     .Forward = True
42500     .Wrap = wdFindStop
42510     .Execute Replace:=wdReplaceAll
42520 End With

42530 With DDWordDoc.Range.Find
42540     .ClearFormatting
42550     .text = "[RM48#]"
42560     .Replacement.text = Range("Control.RM48Contract").Value
42570     .MatchWholeWord = True
42580     .MatchCase = True
42590     .Forward = True
42600     .Wrap = wdFindStop
42610     .Execute Replace:=wdReplaceAll
42620 End With

42630 With DDWordDoc.Range.Find
42640     .ClearFormatting
42650     .text = "[ADD1]"
42660     .Replacement.text = Range("LET.Address1").Value
42670     .MatchWholeWord = True
42680     .MatchCase = True
42690     .Forward = True
42700     .Wrap = wdFindStop
42710     .Execute Replace:=wdReplaceAll
42720 End With

42730 With DDWordDoc.Range.Find
42740     .ClearFormatting
42750     .text = "[ADD2]"
42760     .Replacement.text = Range("LET.Address2").Value
42770     .MatchWholeWord = True
42780     .MatchCase = True
42790     .Forward = True
42800     .Wrap = wdFindStop
42810     .Execute Replace:=wdReplaceAll
42820 End With

42830 With DDWordDoc.Range.Find
42840     .ClearFormatting
42850     .text = "[ADD3]"
42860     .Replacement.text = Range("LET.Address3").Value
42870     .MatchWholeWord = True
42880     .MatchCase = True
42890     .Forward = True
42900     .Wrap = wdFindStop
42910     .Execute Replace:=wdReplaceAll
42920 End With

42930 With DDWordDoc.Range.Find
42940     .ClearFormatting
42950     .text = "[ADD4]"
42960     .Replacement.text = Range("LET.Address4").Value
42970     .MatchWholeWord = True
42980     .MatchCase = True
42990     .Forward = True
43000     .Wrap = wdFindStop
43010     .Execute Replace:=wdReplaceAll
43020 End With

43030 With DDWordDoc.Range.Find
43040     .ClearFormatting
43050     .text = "[ADD5]"
43060     .Replacement.text = Range("LET.Address5").Value
43070     .MatchWholeWord = True
43080     .MatchCase = True
43090     .Forward = True
43100     .Wrap = wdFindStop
43110     .Execute Replace:=wdReplaceAll
43120 End With

43130 With DDWordDoc.Range.Find
43140     .ClearFormatting
43150     .text = "[URM24PLL]"
43160 If Range("CONTROL.Letters!N57").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N57").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
43170     .MatchWholeWord = True
43180     .MatchCase = True
43190     .Forward = True
43200     .Wrap = wdFindStop
43210     .Execute Replace:=wdReplaceAll
43220 End With

43230 With DDWordDoc.Range.Find
43240     .ClearFormatting
43250     .text = "[URM48PLL]"
43260 If Range("CONTROL.Letters!N52").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N52").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
43270     .MatchWholeWord = True
43280     .MatchCase = True
43290     .Forward = True
43300     .Wrap = wdFindStop
43310     .Execute Replace:=wdReplaceAll
43320 End With


43330 With DDWordDoc.Range.Find
43340     .ClearFormatting
43350     .text = "[S8RM24PLL]"
43360 If Range("CONTROL.Letters!N48").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N48").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
43370     .MatchWholeWord = True
43380     .MatchCase = True
43390     .Forward = True
43400     .Wrap = wdFindStop
43410     .Execute Replace:=wdReplaceAll
43420 End With

43430 With DDWordDoc.Range.Find
43440     .ClearFormatting
43450     .text = "[S8RM48PLL]"
43460 If Range("CONTROL.Letters!N49").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N49").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
43470     .MatchWholeWord = True
43480     .MatchCase = True
43490     .Forward = True
43500     .Wrap = wdFindStop
43510     .Execute Replace:=wdReplaceAll
43520 End With

43530 With DDWordDoc.Range.Find
43540     .ClearFormatting
43550     .text = "[URM24WLL]"
43560 If Range("CONTROL.Letters!Y57").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y57").Value Else .Replacement.text = "-"
43570     .MatchWholeWord = True
43580     .MatchCase = True
43590     .Forward = True
43600     .Wrap = wdFindStop
43610     .Execute Replace:=wdReplaceAll
43620 End With

43630 With DDWordDoc.Range.Find
43640     .ClearFormatting
43650     .text = "[URM48WLL]"
43660 If Range("CONTROL.Letters!Y52").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y52").Value Else .Replacement.text = "-"
43670     .MatchWholeWord = True
43680     .MatchCase = True
43690     .Forward = True
43700     .Wrap = wdFindStop
43710     .Execute Replace:=wdReplaceAll
43720 End With


43730 With DDWordDoc.Range.Find
43740     .ClearFormatting
43750     .text = "[S8RM24WLL]"
43760 If Range("CONTROL.Letters!Y48").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y48").Value Else .Replacement.text = "-"
43770     .MatchWholeWord = True
43780     .MatchCase = True
43790     .Forward = True
43800     .Wrap = wdFindStop
43810     .Execute Replace:=wdReplaceAll
43820 End With

43830 With DDWordDoc.Range.Find
43840     .ClearFormatting
43850     .text = "[S8RM48WLL]"
43860 If Range("CONTROL.Letters!Y49").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y49").Value Else .Replacement.text = "-"
43870     .MatchWholeWord = True
43880     .MatchCase = True
43890     .Forward = True
43900     .Wrap = wdFindStop
43910     .Execute Replace:=wdReplaceAll
43920 End With

43930 With DDWordDoc.Range.Find
43940     .ClearFormatting
43950     .text = "[URM24PP]"
43960 If Range("CONTROL.Letters!N62").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N62").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
43970     .MatchWholeWord = True
43980     .MatchCase = True
43990     .Forward = True
44000     .Wrap = wdFindStop
44010     .Execute Replace:=wdReplaceAll
44020 End With

44030 With DDWordDoc.Range.Find
44040     .ClearFormatting
44050     .text = "[URM48PP]"
44060 If Range("CONTROL.Letters!N85").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N85").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
44070     .MatchWholeWord = True
44080     .MatchCase = True
44090     .Forward = True
44100     .Wrap = wdFindStop
44110     .Execute Replace:=wdReplaceAll
44120 End With


44130 With DDWordDoc.Range.Find
44140     .ClearFormatting
44150     .text = "[S8RM24PP]"
44160 If Range("CONTROL.Letters!N53").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N53").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
44170     .MatchWholeWord = True
44180     .MatchCase = True
44190     .Forward = True
44200     .Wrap = wdFindStop
44210     .Execute Replace:=wdReplaceAll
44220 End With

44230 With DDWordDoc.Range.Find
44240     .ClearFormatting
44250     .text = "[S8RM48PP]"
44260 If Range("CONTROL.Letters!N54").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N54").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
44270     .MatchWholeWord = True
44280     .MatchCase = True
44290     .Forward = True
44300     .Wrap = wdFindStop
44310     .Execute Replace:=wdReplaceAll
44320 End With

44330 With DDWordDoc.Range.Find
44340     .ClearFormatting
44350     .text = "[URM24WP]"
44360 If Range("CONTROL.Letters!Y62").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y62").Value Else .Replacement.text = "-"
44370     .MatchWholeWord = True
44380     .MatchCase = True
44390     .Forward = True
44400     .Wrap = wdFindStop
44410     .Execute Replace:=wdReplaceAll
44420 End With

44430 With DDWordDoc.Range.Find
44440     .ClearFormatting
44450     .text = "[URM48WP]"
44460 If Range("CONTROL.Letters!Y85").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y85").Value Else .Replacement.text = "-"
44470     .MatchWholeWord = True
44480     .MatchCase = True
44490     .Forward = True
44500     .Wrap = wdFindStop
44510     .Execute Replace:=wdReplaceAll
44520 End With


44530 With DDWordDoc.Range.Find
44540     .ClearFormatting
44550     .text = "[S8RM24WP]"
44560 If Range("CONTROL.Letters!Y53").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y53").Value Else .Replacement.text = "-"
44570     .MatchWholeWord = True
44580     .MatchCase = True
44590     .Forward = True
44600     .Wrap = wdFindStop
44610     .Execute Replace:=wdReplaceAll
44620 End With

44630 With DDWordDoc.Range.Find
44640     .ClearFormatting
44650     .text = "[S8RM48WP]"
44660 If Range("CONTROL.Letters!Y54").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y54").Value Else .Replacement.text = "-"
44670     .MatchWholeWord = True
44680     .MatchCase = True
44690     .Forward = True
44700     .Wrap = wdFindStop
44710     .Execute Replace:=wdReplaceAll
44720 End With

48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If


      'Save in local hard disk
45030     TempFilePath = Environ$("temp") & "\"
45040     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Flat_Rate_" & Format(Now, "dd-mmm-yy h-mm-ss")
45050     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
45060     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
45070     DDWordDoc.Close

          
      'Attach to existing outlook
45080 With OutMail
45090     .Attachments.Add TempFilePath & tempfilename & ".pdf"
45100 End With
      'Delete the file
45110     Set DDWordApp = Nothing
45120     Set DDWordDoc = Nothing
45130     Kill TempFilePath & tempfilename & ".pdf"
45140     Kill TempFilePath & tempfilename & ".doc"
45150 Exit Sub
error_proc:
45160     If MsgBox("Error has occured with subroutine [RM24FR]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
45170     ShutDown
End Sub

Sub CRL()
      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
45180 Set DDWordApp = CreateObject("Word.Application")
45190 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/CRL18_2.docx", ReadOnly:=False)

      'Replace
45200 With DDWordDoc.Range.Find
45210     .ClearFormatting
45220     .text = "[CUS]"
45230     .Replacement.text = Range("CUS.CustName").Value
45240     .MatchWholeWord = True
45250     .MatchCase = True
45260     .Forward = True
45270     .Wrap = wdFindStop
45280     .Execute Replace:=wdReplaceAll
45290 End With

45300 With DDWordDoc.Range.Find
45310     .ClearFormatting
45320     .text = "[NAME]"
45330     .Replacement.text = Range("CONTROL.Letters!S19").Value
45340     .MatchWholeWord = True
45350     .MatchCase = True
45360     .Forward = True
45370     .Wrap = wdFindStop
45380     .Execute Replace:=wdReplaceAll
45390 End With


45400 With DDWordDoc.Range.Find
45410     .ClearFormatting
45420     .text = "[DATE]"
45430     .Replacement.text = Format(Now, "dd/mm/yy")
45440     .MatchWholeWord = True
45450     .MatchCase = True
45460     .Forward = True
45470     .Wrap = wdFindStop
45480     .Execute Replace:=wdReplaceAll
45490 End With

45500 With DDWordDoc.Range.Find
45510     .ClearFormatting
45520     .text = "[ORDERID]"
45530     .Replacement.text = Range("CUS.Order").Value
45540     .MatchWholeWord = True
45550     .MatchCase = True
45560     .Forward = True
45570     .Wrap = wdFindStop
45580     .Execute Replace:=wdReplaceAll
45590 End With

45600 With DDWordDoc.Range.Find
45610     .ClearFormatting
45620     .text = "[ACCNUM]"
45630     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
45640     .MatchWholeWord = True
45650     .MatchCase = True
45660     .Forward = True
45670     .Wrap = wdFindStop
45680     .Execute Replace:=wdReplaceAll
45690 End With

45700 With DDWordDoc.Range.Find
45710     .ClearFormatting
45720     .text = "[ADD1]"
45730     .Replacement.text = Range("LET.Address1").Value
45740     .MatchWholeWord = True
45750     .MatchCase = True
45760     .Forward = True
45770     .Wrap = wdFindStop
45780     .Execute Replace:=wdReplaceAll
45790 End With

45800 With DDWordDoc.Range.Find
45810     .ClearFormatting
45820     .text = "[ADD2]"
45830     .Replacement.text = Range("LET.Address2").Value
45840     .MatchWholeWord = True
45850     .MatchCase = True
45860     .Forward = True
45870     .Wrap = wdFindStop
45880     .Execute Replace:=wdReplaceAll
45890 End With

45900 With DDWordDoc.Range.Find
45910     .ClearFormatting
45920     .text = "[ADD3]"
45930     .Replacement.text = Range("LET.Address3").Value
45940     .MatchWholeWord = True
45950     .MatchCase = True
45960     .Forward = True
45970     .Wrap = wdFindStop
45980     .Execute Replace:=wdReplaceAll
45990 End With

46000 With DDWordDoc.Range.Find
46010     .ClearFormatting
46020     .text = "[ADD4]"
46030     .Replacement.text = Range("LET.Address4").Value
46040     .MatchWholeWord = True
46050     .MatchCase = True
46060     .Forward = True
46070     .Wrap = wdFindStop
46080     .Execute Replace:=wdReplaceAll
46090 End With

46100 With DDWordDoc.Range.Find
46110     .ClearFormatting
46120     .text = "[ADD5]"
46130     .Replacement.text = Range("LET.Address5").Value
46140     .MatchWholeWord = True
46150     .MatchCase = True
46160     .Forward = True
46170     .Wrap = wdFindStop
46180     .Execute Replace:=wdReplaceAll
46190 End With


46200 With DDWordDoc.Range.Find
46210     .ClearFormatting
46220     .text = "[FTE1]"
46230     .Replacement.text = "96"
46240     .MatchWholeWord = True
46250     .MatchCase = True
46260     .Forward = True
46270     .Wrap = wdFindStop
46280     .Execute Replace:=wdReplaceAll
46290 End With

46300 With DDWordDoc.Range.Find
46310     .ClearFormatting
46320     .text = "[FTE2]"
46330     .Replacement.text = "1"
46340     .MatchWholeWord = True
46350     .MatchCase = True
46360     .Forward = True
46370     .Wrap = wdFindStop
46380     .Execute Replace:=wdReplaceAll
46390 End With

46400 With DDWordDoc.Range.Find
46410     .ClearFormatting
46420     .text = "[FTE3]"
46430     .Replacement.text = "3"
46440     .MatchWholeWord = True
46450     .MatchCase = True
46460     .Forward = True
46470     .Wrap = wdFindStop
46480     .Execute Replace:=wdReplaceAll
46490 End With

      'Save in local hard disk
46500     TempFilePath = Environ$("temp") & "\"
46510     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_" & Format(Now, "dd-mmm-yy h-mm-ss")
46520     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
46530     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
46540     DDWordDoc.Close

          
      'Attach to existing outlook
46550 With OutMail
46560     .Attachments.Add TempFilePath & tempfilename & ".pdf"
46570 End With
      'Delete the file
46580     Set DDWordApp = Nothing
46590     Set DDWordDoc = Nothing
46600     Kill TempFilePath & tempfilename & ".pdf"
46610     Kill TempFilePath & tempfilename & ".doc"
46620 Exit Sub
error_proc:
46630     If MsgBox("Error has occured with subroutine [CRL18]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
46640     ShutDown

End Sub

Sub RMT()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
46650 Set DDWordApp = CreateObject("Word.Application")
46660 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMT18_2.docx", ReadOnly:=False)

      'Replace
46670 With DDWordDoc.Range.Find
46680     .ClearFormatting
46690     .text = "[CUS]"
46700     .Replacement.text = Range("CUS.CustName").Value
46710     .MatchWholeWord = True
46720     .MatchCase = True
46730     .Forward = True
46740     .Wrap = wdFindStop
46750     .Execute Replace:=wdReplaceAll
46760 End With

46770 With DDWordDoc.Range.Find
46780     .ClearFormatting
46790     .text = "[NAME]"
46800     .Replacement.text = Range("CONTROL.Letters!S19").Value
46810     .MatchWholeWord = True
46820     .MatchCase = True
46830     .Forward = True
46840     .Wrap = wdFindStop
46850     .Execute Replace:=wdReplaceAll
46860 End With


46870 With DDWordDoc.Range.Find
46880     .ClearFormatting
46890     .text = "[DATE]"
46900     .Replacement.text = Format(Now, "dd/mm/yy")
46910     .MatchWholeWord = True
46920     .MatchCase = True
46930     .Forward = True
46940     .Wrap = wdFindStop
46950     .Execute Replace:=wdReplaceAll
46960 End With

46970 With DDWordDoc.Range.Find
46980     .ClearFormatting
46990     .text = "[ORDERID]"
47000     .Replacement.text = Range("CUS.Order").Value
47010     .MatchWholeWord = True
47020     .MatchCase = True
47030     .Forward = True
47040     .Wrap = wdFindStop
47050     .Execute Replace:=wdReplaceAll
47060 End With

47070 With DDWordDoc.Range.Find
47080     .ClearFormatting
47090     .text = "[ACCNUM]"
47100     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
47110     .MatchWholeWord = True
47120     .MatchCase = True
47130     .Forward = True
47140     .Wrap = wdFindStop
47150     .Execute Replace:=wdReplaceAll
47160 End With

47170 With DDWordDoc.Range.Find
47180     .ClearFormatting
47190     .text = "[RM24#]"
47200     .Replacement.text = Range("CONTROL.Letters!K143").Value
47210     .MatchWholeWord = True
47220     .MatchCase = True
47230     .Forward = True
47240     .Wrap = wdFindStop
47250     .Execute Replace:=wdReplaceAll
47260 End With

47270 With DDWordDoc.Range.Find
47280     .ClearFormatting
47290     .text = "[RM48#]"
47300     .Replacement.text = Range("CONTROL.Letters!K144").Value
47310     .MatchWholeWord = True
47320     .MatchCase = True
47330     .Forward = True
47340     .Wrap = wdFindStop
47350     .Execute Replace:=wdReplaceAll
47360 End With

47370 With DDWordDoc.Range.Find
47380     .ClearFormatting
47390     .text = "[ADD1]"
47400     .Replacement.text = Range("LET.Address1").Value
47410     .MatchWholeWord = True
47420     .MatchCase = True
47430     .Forward = True
47440     .Wrap = wdFindStop
47450     .Execute Replace:=wdReplaceAll
47460 End With

47470 With DDWordDoc.Range.Find
47480     .ClearFormatting
47490     .text = "[ADD2]"
47500     .Replacement.text = Range("LET.Address2").Value
47510     .MatchWholeWord = True
47520     .MatchCase = True
47530     .Forward = True
47540     .Wrap = wdFindStop
47550     .Execute Replace:=wdReplaceAll
47560 End With

47570 With DDWordDoc.Range.Find
47580     .ClearFormatting
47590     .text = "[ADD3]"
47600     .Replacement.text = Range("LET.Address3").Value
47610     .MatchWholeWord = True
47620     .MatchCase = True
47630     .Forward = True
47640     .Wrap = wdFindStop
47650     .Execute Replace:=wdReplaceAll
47660 End With

47670 With DDWordDoc.Range.Find
47680     .ClearFormatting
47690     .text = "[ADD4]"
47700     .Replacement.text = Range("LET.Address4").Value
47710     .MatchWholeWord = True
47720     .MatchCase = True
47730     .Forward = True
47740     .Wrap = wdFindStop
47750     .Execute Replace:=wdReplaceAll
47760 End With

47770 With DDWordDoc.Range.Find
47780     .ClearFormatting
47790     .text = "[ADD5]"
47800     .Replacement.text = Range("LET.Address5").Value
47810     .MatchWholeWord = True
47820     .MatchCase = True
47830     .Forward = True
47840     .Wrap = wdFindStop
47850     .Execute Replace:=wdReplaceAll
47860 End With


47870 With DDWordDoc.Range.Find
47880     .ClearFormatting
47890     .text = "[24P]"
47900 If Range("CONTROL.Letters!N77").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N77").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
47910     .MatchWholeWord = True
47920     .MatchCase = True
47930     .Forward = True
47940     .Wrap = wdFindStop
47950     .Execute Replace:=wdReplaceAll
47960 End With

47970 With DDWordDoc.Range.Find
47980     .ClearFormatting
47990     .text = "[48P]"
48000 If Range("CONTROL.Letters!N78").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N78").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
48010     .MatchWholeWord = True
48020     .MatchCase = True
48030     .Forward = True
48040     .Wrap = wdFindStop
48050     .Execute Replace:=wdReplaceAll
48060 End With

48070 With DDWordDoc.Range.Find
48080     .ClearFormatting
48090     .text = "[24V]"
48100 If Range("CONTROL.Letters!M77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M77").Value Else .Replacement.text = "-"
48110     .MatchWholeWord = True
48120     .MatchCase = True
48130     .Forward = True
48140     .Wrap = wdFindStop
48150     .Execute Replace:=wdReplaceAll
48160 End With

48170 With DDWordDoc.Range.Find
48180     .ClearFormatting
48190     .text = "[48V]"
48200 If Range("CONTROL.Letters!M78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M78").Value Else .Replacement.text = "-"
48210     .MatchWholeWord = True
48220     .MatchCase = True
48230     .Forward = True
48240     .Wrap = wdFindStop
48250     .Execute Replace:=wdReplaceAll
48260 End With

48270 With DDWordDoc.Range.Find
48280     .ClearFormatting
48290     .text = "[24W]"
48300 If Range("CONTROL.Letters!Y77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y77").Value Else .Replacement.text = "-"
48310     .MatchWholeWord = True
48320     .MatchCase = True
48330     .Forward = True
48340     .Wrap = wdFindStop
48350     .Execute Replace:=wdReplaceAll
48360 End With

48370 With DDWordDoc.Range.Find
48380     .ClearFormatting
48390     .text = "[48W]"
48400 If Range("CONTROL.Letters!Y78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y78").Value Else .Replacement.text = "-"
48410     .MatchWholeWord = True
48420     .MatchCase = True
48430     .Forward = True
48440     .Wrap = wdFindStop
48450     .Execute Replace:=wdReplaceAll
48460 End With

48470 With DDWordDoc.Range.Find
48480     .ClearFormatting
48490     .text = "[24S]"
48500 If Range("CONTROL.Letters!R77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R77").Value Else .Replacement.text = "-"
48510     .MatchWholeWord = True
48520     .MatchCase = True
48530     .Forward = True
48540     .Wrap = wdFindStop
48550     .Execute Replace:=wdReplaceAll
48560 End With

48570 With DDWordDoc.Range.Find
48580     .ClearFormatting
48590     .text = "[48S]"
48600 If Range("CONTROL.Letters!R78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R78").Value Else .Replacement.text = "-"
48610     .MatchWholeWord = True
48620     .MatchCase = True
48630     .Forward = True
48640     .Wrap = wdFindStop
48650     .Execute Replace:=wdReplaceAll
48660 End With

48670 With DDWordDoc.Range.Find
48680     .ClearFormatting
48690     .text = "[TV]"
48700 If (Range("CONTROL.Letters!M78").Value + Range("CONTROL.Letters!M77").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M78").Value + Range("CONTROL.Letters!M77").Value) Else .Replacement.text = "-"
48710     .MatchWholeWord = True
48720     .MatchCase = True
48730     .Forward = True
48740     .Wrap = wdFindStop
48750     .Execute Replace:=wdReplaceAll
48760 End With


48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
49070     TempFilePath = Environ$("temp") & "\"
49080     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
49090     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
49100     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
49110     DDWordDoc.Close

          
      'Attach to existing outlook
49120 With OutMail
49130     .Attachments.Add TempFilePath & tempfilename & ".pdf"
49140 End With
      'Delete the file
49150     Set DDWordApp = Nothing
49160     Set DDWordDoc = Nothing
49170     Kill TempFilePath & tempfilename & ".pdf"
49180     Kill TempFilePath & tempfilename & ".doc"
49190 Exit Sub
error_proc:
49200     If MsgBox("Error has occured with subroutine [RMT]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
49210     ShutDown
End Sub

Sub RMTA()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
46650 Set DDWordApp = CreateObject("Word.Application")
46660 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMT19AV.docx", ReadOnly:=False)

      'Replace
46670 With DDWordDoc.Range.Find
46680     .ClearFormatting
46690     .text = "[CUS]"
46700     .Replacement.text = Range("CUS.CustName").Value
46710     .MatchWholeWord = True
46720     .MatchCase = True
46730     .Forward = True
46740     .Wrap = wdFindStop
46750     .Execute Replace:=wdReplaceAll
46760 End With

46770 With DDWordDoc.Range.Find
46780     .ClearFormatting
46790     .text = "[NAME]"
46800     .Replacement.text = Range("CONTROL.Letters!S19").Value
46810     .MatchWholeWord = True
46820     .MatchCase = True
46830     .Forward = True
46840     .Wrap = wdFindStop
46850     .Execute Replace:=wdReplaceAll
46860 End With


46870 With DDWordDoc.Range.Find
46880     .ClearFormatting
46890     .text = "[DATE]"
46900     .Replacement.text = Format(Now, "dd/mm/yy")
46910     .MatchWholeWord = True
46920     .MatchCase = True
46930     .Forward = True
46940     .Wrap = wdFindStop
46950     .Execute Replace:=wdReplaceAll
46960 End With

46970 With DDWordDoc.Range.Find
46980     .ClearFormatting
46990     .text = "[ORDERID]"
47000     .Replacement.text = Range("CUS.Order").Value
47010     .MatchWholeWord = True
47020     .MatchCase = True
47030     .Forward = True
47040     .Wrap = wdFindStop
47050     .Execute Replace:=wdReplaceAll
47060 End With

47070 With DDWordDoc.Range.Find
47080     .ClearFormatting
47090     .text = "[ACCNUM]"
47100     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
47110     .MatchWholeWord = True
47120     .MatchCase = True
47130     .Forward = True
47140     .Wrap = wdFindStop
47150     .Execute Replace:=wdReplaceAll
47160 End With

47170 With DDWordDoc.Range.Find
47180     .ClearFormatting
47190     .text = "[RM24#]"
47200     .Replacement.text = Range("CONTROL.Letters!K152").Value
47210     .MatchWholeWord = True
47220     .MatchCase = True
47230     .Forward = True
47240     .Wrap = wdFindStop
47250     .Execute Replace:=wdReplaceAll
47260 End With

47270 With DDWordDoc.Range.Find
47280     .ClearFormatting
47290     .text = "[RM48#]"
47300     .Replacement.text = Range("CONTROL.Letters!K153").Value
47310     .MatchWholeWord = True
47320     .MatchCase = True
47330     .Forward = True
47340     .Wrap = wdFindStop
47350     .Execute Replace:=wdReplaceAll
47360 End With

47370 With DDWordDoc.Range.Find
47380     .ClearFormatting
47390     .text = "[ADD1]"
47400     .Replacement.text = Range("LET.Address1").Value
47410     .MatchWholeWord = True
47420     .MatchCase = True
47430     .Forward = True
47440     .Wrap = wdFindStop
47450     .Execute Replace:=wdReplaceAll
47460 End With

47470 With DDWordDoc.Range.Find
47480     .ClearFormatting
47490     .text = "[ADD2]"
47500     .Replacement.text = Range("LET.Address2").Value
47510     .MatchWholeWord = True
47520     .MatchCase = True
47530     .Forward = True
47540     .Wrap = wdFindStop
47550     .Execute Replace:=wdReplaceAll
47560 End With

47570 With DDWordDoc.Range.Find
47580     .ClearFormatting
47590     .text = "[ADD3]"
47600     .Replacement.text = Range("LET.Address3").Value
47610     .MatchWholeWord = True
47620     .MatchCase = True
47630     .Forward = True
47640     .Wrap = wdFindStop
47650     .Execute Replace:=wdReplaceAll
47660 End With

47670 With DDWordDoc.Range.Find
47680     .ClearFormatting
47690     .text = "[ADD4]"
47700     .Replacement.text = Range("LET.Address4").Value
47710     .MatchWholeWord = True
47720     .MatchCase = True
47730     .Forward = True
47740     .Wrap = wdFindStop
47750     .Execute Replace:=wdReplaceAll
47760 End With

47770 With DDWordDoc.Range.Find
47780     .ClearFormatting
47790     .text = "[ADD5]"
47800     .Replacement.text = Range("LET.Address5").Value
47810     .MatchWholeWord = True
47820     .MatchCase = True
47830     .Forward = True
47840     .Wrap = wdFindStop
47850     .Execute Replace:=wdReplaceAll
47860 End With


47870 With DDWordDoc.Range.Find
47880     .ClearFormatting
47890     .text = "[24P]"
47900 If Range("CONTROL.Letters!N73").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N73").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
47910     .MatchWholeWord = True
47920     .MatchCase = True
47930     .Forward = True
47940     .Wrap = wdFindStop
47950     .Execute Replace:=wdReplaceAll
47960 End With

47970 With DDWordDoc.Range.Find
47980     .ClearFormatting
47990     .text = "[48P]"
48000 If Range("CONTROL.Letters!N74").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N74").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
48010     .MatchWholeWord = True
48020     .MatchCase = True
48030     .Forward = True
48040     .Wrap = wdFindStop
48050     .Execute Replace:=wdReplaceAll
48060 End With

48070 With DDWordDoc.Range.Find
48080     .ClearFormatting
48090     .text = "[24V]"
48100 If Range("CONTROL.Letters!M73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M73").Value Else .Replacement.text = "-"
48110     .MatchWholeWord = True
48120     .MatchCase = True
48130     .Forward = True
48140     .Wrap = wdFindStop
48150     .Execute Replace:=wdReplaceAll
48160 End With

48170 With DDWordDoc.Range.Find
48180     .ClearFormatting
48190     .text = "[48V]"
48200 If Range("CONTROL.Letters!M74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M74").Value Else .Replacement.text = "-"
48210     .MatchWholeWord = True
48220     .MatchCase = True
48230     .Forward = True
48240     .Wrap = wdFindStop
48250     .Execute Replace:=wdReplaceAll
48260 End With

48270 With DDWordDoc.Range.Find
48280     .ClearFormatting
48290     .text = "[24W]"
48300 If Range("CONTROL.Letters!Y73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y73").Value Else .Replacement.text = "-"
48310     .MatchWholeWord = True
48320     .MatchCase = True
48330     .Forward = True
48340     .Wrap = wdFindStop
48350     .Execute Replace:=wdReplaceAll
48360 End With

48370 With DDWordDoc.Range.Find
48380     .ClearFormatting
48390     .text = "[48W]"
48400 If Range("CONTROL.Letters!Y74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y74").Value Else .Replacement.text = "-"
48410     .MatchWholeWord = True
48420     .MatchCase = True
48430     .Forward = True
48440     .Wrap = wdFindStop
48450     .Execute Replace:=wdReplaceAll
48460 End With

48470 With DDWordDoc.Range.Find
48480     .ClearFormatting
48490     .text = "[24S]"
48500 If Range("CONTROL.Letters!R73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R73").Value Else .Replacement.text = "-"
48510     .MatchWholeWord = True
48520     .MatchCase = True
48530     .Forward = True
48540     .Wrap = wdFindStop
48550     .Execute Replace:=wdReplaceAll
48560 End With

48570 With DDWordDoc.Range.Find
48580     .ClearFormatting
48590     .text = "[48S]"
48600 If Range("CONTROL.Letters!R74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R74").Value Else .Replacement.text = "-"
48610     .MatchWholeWord = True
48620     .MatchCase = True
48630     .Forward = True
48640     .Wrap = wdFindStop
48650     .Execute Replace:=wdReplaceAll
48660 End With

48670 With DDWordDoc.Range.Find
48680     .ClearFormatting
48690     .text = "[TV]"
48700 If (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value) Else .Replacement.text = "-"
48710     .MatchWholeWord = True
48720     .MatchCase = True
48730     .Forward = True
48740     .Wrap = wdFindStop
48750     .Execute Replace:=wdReplaceAll
48760 End With


48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
49070     TempFilePath = Environ$("temp") & "\"
49080     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
49090     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
49100     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
49110     DDWordDoc.Close

          
      'Attach to existing outlook
49120 With OutMail
49130     .Attachments.Add TempFilePath & tempfilename & ".pdf"
49140 End With
      'Delete the file
49150     Set DDWordApp = Nothing
49160     Set DDWordDoc = Nothing
49170     Kill TempFilePath & tempfilename & ".pdf"
49180     Kill TempFilePath & tempfilename & ".doc"
49190 Exit Sub
error_proc:
49200     If MsgBox("Error has occured with subroutine [RMTA]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
49210     ShutDown
End Sub

Sub RMTAHV()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
46650 Set DDWordApp = CreateObject("Word.Application")
46660 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMT19AVH.docx", ReadOnly:=False)

      'Replace
46670 With DDWordDoc.Range.Find
46680     .ClearFormatting
46690     .text = "[CUS]"
46700     .Replacement.text = Range("CUS.CustName").Value
46710     .MatchWholeWord = True
46720     .MatchCase = True
46730     .Forward = True
46740     .Wrap = wdFindStop
46750     .Execute Replace:=wdReplaceAll
46760 End With

46770 With DDWordDoc.Range.Find
46780     .ClearFormatting
46790     .text = "[NAME]"
46800     .Replacement.text = Range("CONTROL.Letters!S19").Value
46810     .MatchWholeWord = True
46820     .MatchCase = True
46830     .Forward = True
46840     .Wrap = wdFindStop
46850     .Execute Replace:=wdReplaceAll
46860 End With


46870 With DDWordDoc.Range.Find
46880     .ClearFormatting
46890     .text = "[DATE]"
46900     .Replacement.text = Format(Now, "dd/mm/yy")
46910     .MatchWholeWord = True
46920     .MatchCase = True
46930     .Forward = True
46940     .Wrap = wdFindStop
46950     .Execute Replace:=wdReplaceAll
46960 End With

46970 With DDWordDoc.Range.Find
46980     .ClearFormatting
46990     .text = "[ORDERID]"
47000     .Replacement.text = Range("CUS.Order").Value
47010     .MatchWholeWord = True
47020     .MatchCase = True
47030     .Forward = True
47040     .Wrap = wdFindStop
47050     .Execute Replace:=wdReplaceAll
47060 End With

47070 With DDWordDoc.Range.Find
47080     .ClearFormatting
47090     .text = "[ACCNUM]"
47100     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
47110     .MatchWholeWord = True
47120     .MatchCase = True
47130     .Forward = True
47140     .Wrap = wdFindStop
47150     .Execute Replace:=wdReplaceAll
47160 End With

47170 With DDWordDoc.Range.Find
47180     .ClearFormatting
47190     .text = "[RM24#]"
47200     .Replacement.text = Range("CONTROL.Letters!K155").Value
47210     .MatchWholeWord = True
47220     .MatchCase = True
47230     .Forward = True
47240     .Wrap = wdFindStop
47250     .Execute Replace:=wdReplaceAll
47260 End With

47270 With DDWordDoc.Range.Find
47280     .ClearFormatting
47290     .text = "[RM48#]"
47300     .Replacement.text = Range("CONTROL.Letters!K156").Value
47310     .MatchWholeWord = True
47320     .MatchCase = True
47330     .Forward = True
47340     .Wrap = wdFindStop
47350     .Execute Replace:=wdReplaceAll
47360 End With

47370 With DDWordDoc.Range.Find
47380     .ClearFormatting
47390     .text = "[ADD1]"
47400     .Replacement.text = Range("LET.Address1").Value
47410     .MatchWholeWord = True
47420     .MatchCase = True
47430     .Forward = True
47440     .Wrap = wdFindStop
47450     .Execute Replace:=wdReplaceAll
47460 End With

47470 With DDWordDoc.Range.Find
47480     .ClearFormatting
47490     .text = "[ADD2]"
47500     .Replacement.text = Range("LET.Address2").Value
47510     .MatchWholeWord = True
47520     .MatchCase = True
47530     .Forward = True
47540     .Wrap = wdFindStop
47550     .Execute Replace:=wdReplaceAll
47560 End With

47570 With DDWordDoc.Range.Find
47580     .ClearFormatting
47590     .text = "[ADD3]"
47600     .Replacement.text = Range("LET.Address3").Value
47610     .MatchWholeWord = True
47620     .MatchCase = True
47630     .Forward = True
47640     .Wrap = wdFindStop
47650     .Execute Replace:=wdReplaceAll
47660 End With

47670 With DDWordDoc.Range.Find
47680     .ClearFormatting
47690     .text = "[ADD4]"
47700     .Replacement.text = Range("LET.Address4").Value
47710     .MatchWholeWord = True
47720     .MatchCase = True
47730     .Forward = True
47740     .Wrap = wdFindStop
47750     .Execute Replace:=wdReplaceAll
47760 End With

47770 With DDWordDoc.Range.Find
47780     .ClearFormatting
47790     .text = "[ADD5]"
47800     .Replacement.text = Range("LET.Address5").Value
47810     .MatchWholeWord = True
47820     .MatchCase = True
47830     .Forward = True
47840     .Wrap = wdFindStop
47850     .Execute Replace:=wdReplaceAll
47860 End With


47870 With DDWordDoc.Range.Find
47880     .ClearFormatting
47890     .text = "[24P]"
47900 If Range("CONTROL.Letters!N71").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N71").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
47910     .MatchWholeWord = True
47920     .MatchCase = True
47930     .Forward = True
47940     .Wrap = wdFindStop
47950     .Execute Replace:=wdReplaceAll
47960 End With

47970 With DDWordDoc.Range.Find
47980     .ClearFormatting
47990     .text = "[48P]"
48000 If Range("CONTROL.Letters!N72").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N72").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
48010     .MatchWholeWord = True
48020     .MatchCase = True
48030     .Forward = True
48040     .Wrap = wdFindStop
48050     .Execute Replace:=wdReplaceAll
48060 End With

48070 With DDWordDoc.Range.Find
48080     .ClearFormatting
48090     .text = "[24V]"
48100 If Range("CONTROL.Letters!M71").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M71").Value Else .Replacement.text = "-"
48110     .MatchWholeWord = True
48120     .MatchCase = True
48130     .Forward = True
48140     .Wrap = wdFindStop
48150     .Execute Replace:=wdReplaceAll
48160 End With

48170 With DDWordDoc.Range.Find
48180     .ClearFormatting
48190     .text = "[48V]"
48200 If Range("CONTROL.Letters!M72").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M72").Value Else .Replacement.text = "-"
48210     .MatchWholeWord = True
48220     .MatchCase = True
48230     .Forward = True
48240     .Wrap = wdFindStop
48250     .Execute Replace:=wdReplaceAll
48260 End With

48270 With DDWordDoc.Range.Find
48280     .ClearFormatting
48290     .text = "[24W]"
48300 If Range("CONTROL.Letters!Y71").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y71").Value Else .Replacement.text = "-"
48310     .MatchWholeWord = True
48320     .MatchCase = True
48330     .Forward = True
48340     .Wrap = wdFindStop
48350     .Execute Replace:=wdReplaceAll
48360 End With

48370 With DDWordDoc.Range.Find
48380     .ClearFormatting
48390     .text = "[48W]"
48400 If Range("CONTROL.Letters!Y72").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y72").Value Else .Replacement.text = "-"
48410     .MatchWholeWord = True
48420     .MatchCase = True
48430     .Forward = True
48440     .Wrap = wdFindStop
48450     .Execute Replace:=wdReplaceAll
48460 End With

48470 With DDWordDoc.Range.Find
48480     .ClearFormatting
48490     .text = "[24S]"
48500 If Range("CONTROL.Letters!R71").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R71").Value Else .Replacement.text = "-"
48510     .MatchWholeWord = True
48520     .MatchCase = True
48530     .Forward = True
48540     .Wrap = wdFindStop
48550     .Execute Replace:=wdReplaceAll
48560 End With

48570 With DDWordDoc.Range.Find
48580     .ClearFormatting
48590     .text = "[48S]"
48600 If Range("CONTROL.Letters!R72").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R72").Value Else .Replacement.text = "-"
48610     .MatchWholeWord = True
48620     .MatchCase = True
48630     .Forward = True
48640     .Wrap = wdFindStop
48650     .Execute Replace:=wdReplaceAll
48660 End With

48670 With DDWordDoc.Range.Find
48680     .ClearFormatting
48690     .text = "[TV]"
48700 If (Range("CONTROL.Letters!M72").Value + Range("CONTROL.Letters!M71").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M72").Value + Range("CONTROL.Letters!M71").Value) Else .Replacement.text = "-"
48710     .MatchWholeWord = True
48720     .MatchCase = True
48730     .Forward = True
48740     .Wrap = wdFindStop
48750     .Execute Replace:=wdReplaceAll
48760 End With


48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
49070     TempFilePath = Environ$("temp") & "\"
49080     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
49090     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
49100     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
49110     DDWordDoc.Close

          
      'Attach to existing outlook
49120 With OutMail
49130     .Attachments.Add TempFilePath & tempfilename & ".pdf"
49140 End With
      'Delete the file
49150     Set DDWordApp = Nothing
49160     Set DDWordDoc = Nothing
49170     Kill TempFilePath & tempfilename & ".pdf"
49180     Kill TempFilePath & tempfilename & ".doc"
49190 Exit Sub
error_proc:
49200     If MsgBox("Error has occured with subroutine [RMTA]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
49210     ShutDown
End Sub

Sub RMTS()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
49220 Set DDWordApp = CreateObject("Word.Application")
49230 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMTS18_2.docx", ReadOnly:=False)

      'Replace
49240 With DDWordDoc.Range.Find
49250     .ClearFormatting
49260     .text = "[CUS]"
49270     .Replacement.text = Range("CUS.CustName").Value
49280     .MatchWholeWord = True
49290     .MatchCase = True
49300     .Forward = True
49310     .Wrap = wdFindStop
49320     .Execute Replace:=wdReplaceAll
49330 End With

49340 With DDWordDoc.Range.Find
49350     .ClearFormatting
49360     .text = "[NAME]"
49370     .Replacement.text = Range("CONTROL.Letters!S19").Value
49380     .MatchWholeWord = True
49390     .MatchCase = True
49400     .Forward = True
49410     .Wrap = wdFindStop
49420     .Execute Replace:=wdReplaceAll
49430 End With


49440 With DDWordDoc.Range.Find
49450     .ClearFormatting
49460     .text = "[DATE]"
49470     .Replacement.text = Format(Now, "dd/mm/yy")
49480     .MatchWholeWord = True
49490     .MatchCase = True
49500     .Forward = True
49510     .Wrap = wdFindStop
49520     .Execute Replace:=wdReplaceAll
49530 End With

49540 With DDWordDoc.Range.Find
49550     .ClearFormatting
49560     .text = "[ORDERID]"
49570     .Replacement.text = Range("CUS.Order").Value
49580     .MatchWholeWord = True
49590     .MatchCase = True
49600     .Forward = True
49610     .Wrap = wdFindStop
49620     .Execute Replace:=wdReplaceAll
49630 End With

49640 With DDWordDoc.Range.Find
49650     .ClearFormatting
49660     .text = "[ACCNUM]"
49670     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
49680     .MatchWholeWord = True
49690     .MatchCase = True
49700     .Forward = True
49710     .Wrap = wdFindStop
49720     .Execute Replace:=wdReplaceAll
49730 End With

49740 With DDWordDoc.Range.Find
49750     .ClearFormatting
49760     .text = "[RM24#]"
49770     .Replacement.text = Range("CONTROL.Letters!K135").Value
49780     .MatchWholeWord = True
49790     .MatchCase = True
49800     .Forward = True
49810     .Wrap = wdFindStop
49820     .Execute Replace:=wdReplaceAll
49830 End With

49840 With DDWordDoc.Range.Find
49850     .ClearFormatting
49860     .text = "[RM48#]"
49870     .Replacement.text = Range("CONTROL.Letters!K136").Value
49880     .MatchWholeWord = True
49890     .MatchCase = True
49900     .Forward = True
49910     .Wrap = wdFindStop
49920     .Execute Replace:=wdReplaceAll
49930 End With

49940 With DDWordDoc.Range.Find
49950     .ClearFormatting
49960     .text = "[ADD1]"
49970     .Replacement.text = Range("LET.Address1").Value
49980     .MatchWholeWord = True
49990     .MatchCase = True
50000     .Forward = True
50010     .Wrap = wdFindStop
50020     .Execute Replace:=wdReplaceAll
50030 End With

50040 With DDWordDoc.Range.Find
50050     .ClearFormatting
50060     .text = "[ADD2]"
50070     .Replacement.text = Range("LET.Address2").Value
50080     .MatchWholeWord = True
50090     .MatchCase = True
50100     .Forward = True
50110     .Wrap = wdFindStop
50120     .Execute Replace:=wdReplaceAll
50130 End With

50140 With DDWordDoc.Range.Find
50150     .ClearFormatting
50160     .text = "[ADD3]"
50170     .Replacement.text = Range("LET.Address3").Value
50180     .MatchWholeWord = True
50190     .MatchCase = True
50200     .Forward = True
50210     .Wrap = wdFindStop
50220     .Execute Replace:=wdReplaceAll
50230 End With

50240 With DDWordDoc.Range.Find
50250     .ClearFormatting
50260     .text = "[ADD4]"
50270     .Replacement.text = Range("LET.Address4").Value
50280     .MatchWholeWord = True
50290     .MatchCase = True
50300     .Forward = True
50310     .Wrap = wdFindStop
50320     .Execute Replace:=wdReplaceAll
50330 End With

50340 With DDWordDoc.Range.Find
50350     .ClearFormatting
50360     .text = "[ADD5]"
50370     .Replacement.text = Range("LET.Address5").Value
50380     .MatchWholeWord = True
50390     .MatchCase = True
50400     .Forward = True
50410     .Wrap = wdFindStop
50420     .Execute Replace:=wdReplaceAll
50430 End With

50440 With DDWordDoc.Range.Find
50450     .ClearFormatting
50460     .text = "[24P]"
50470 If Range("CONTROL.Letters!N73").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N73").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
50480     .MatchWholeWord = True
50490     .MatchCase = True
50500     .Forward = True
50510     .Wrap = wdFindStop
50520     .Execute Replace:=wdReplaceAll
50530 End With

50540 With DDWordDoc.Range.Find
50550     .ClearFormatting
50560     .text = "[48P]"
50570 If Range("CONTROL.Letters!N74").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N74").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
50580     .MatchWholeWord = True
50590     .MatchCase = True
50600     .Forward = True
50610     .Wrap = wdFindStop
50620     .Execute Replace:=wdReplaceAll
50630 End With

50640 With DDWordDoc.Range.Find
50650     .ClearFormatting
50660     .text = "[24V]"
50670 If Range("CONTROL.Letters!M73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M73").Value Else .Replacement.text = "-"
50680     .MatchWholeWord = True
50690     .MatchCase = True
50700     .Forward = True
50710     .Wrap = wdFindStop
50720     .Execute Replace:=wdReplaceAll
50730 End With

50740 With DDWordDoc.Range.Find
50750     .ClearFormatting
50760     .text = "[48V]"
50770 If Range("CONTROL.Letters!M74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M74").Value Else .Replacement.text = "-"
50780     .MatchWholeWord = True
50790     .MatchCase = True
50800     .Forward = True
50810     .Wrap = wdFindStop
50820     .Execute Replace:=wdReplaceAll
50830 End With

50840 With DDWordDoc.Range.Find
50850     .ClearFormatting
50860     .text = "[24W]"
50870 If Range("CONTROL.Letters!Y73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y73").Value Else .Replacement.text = "-"
50880     .MatchWholeWord = True
50890     .MatchCase = True
50900     .Forward = True
50910     .Wrap = wdFindStop
50920     .Execute Replace:=wdReplaceAll
50930 End With

50940 With DDWordDoc.Range.Find
50950     .ClearFormatting
50960     .text = "[48W]"
50970 If Range("CONTROL.Letters!Y74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y74").Value Else .Replacement.text = "-"
50980     .MatchWholeWord = True
50990     .MatchCase = True
51000     .Forward = True
51010     .Wrap = wdFindStop
51020     .Execute Replace:=wdReplaceAll
51030 End With

51040 With DDWordDoc.Range.Find
51050     .ClearFormatting
51060     .text = "[24S]"
51070 If Range("CONTROL.Letters!R73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R73").Value Else .Replacement.text = "-"
51080     .MatchWholeWord = True
51090     .MatchCase = True
51100     .Forward = True
51110     .Wrap = wdFindStop
51120     .Execute Replace:=wdReplaceAll
51130 End With

51140 With DDWordDoc.Range.Find
51150     .ClearFormatting
51160     .text = "[48S]"
51170 If Range("CONTROL.Letters!R74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R74").Value Else .Replacement.text = "-"
51180     .MatchWholeWord = True
51190     .MatchCase = True
51200     .Forward = True
51210     .Wrap = wdFindStop
51220     .Execute Replace:=wdReplaceAll
51230 End With

51240 With DDWordDoc.Range.Find
51250     .ClearFormatting
51260     .text = "[TV]"
51270 If (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value) Else .Replacement.text = "-"
51280     .MatchWholeWord = True
51290     .MatchCase = True
51300     .Forward = True
51310     .Wrap = wdFindStop
51320     .Execute Replace:=wdReplaceAll
51330 End With


48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If


      'Save in local hard disk
51640     TempFilePath = Environ$("temp") & "\"
51650     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_Seasoanl" & Format(Now, "dd-mmm-yy h-mm-ss")
51660     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
51670     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
51680     DDWordDoc.Close

          
      'Attach to existing outlook
51690 With OutMail
51700     .Attachments.Add TempFilePath & tempfilename & ".pdf"
51710 End With
      'Delete the file
51720     Set DDWordApp = Nothing
51730     Set DDWordDoc = Nothing
51740     Kill TempFilePath & tempfilename & ".pdf"
51750     Kill TempFilePath & tempfilename & ".doc"
51760 Exit Sub
error_proc:
51770     If MsgBox("Error has occured with subroutine [RMTS]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
51780     ShutDown
End Sub

Sub RMTLB()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
51790 Set DDWordApp = CreateObject("Word.Application")
51800 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMTLB18_2.docx", ReadOnly:=False)

      'Replace
51810 With DDWordDoc.Range.Find
51820     .ClearFormatting
51830     .text = "[CUS]"
51840     .Replacement.text = Range("CUS.CustName").Value
51850     .MatchWholeWord = True
51860     .MatchCase = True
51870     .Forward = True
51880     .Wrap = wdFindStop
51890     .Execute Replace:=wdReplaceAll
51900 End With

51910 With DDWordDoc.Range.Find
51920     .ClearFormatting
51930     .text = "[NAME]"
51940     .Replacement.text = Range("CONTROL.Letters!S19").Value
51950     .MatchWholeWord = True
51960     .MatchCase = True
51970     .Forward = True
51980     .Wrap = wdFindStop
51990     .Execute Replace:=wdReplaceAll
52000 End With


52010 With DDWordDoc.Range.Find
52020     .ClearFormatting
52030     .text = "[DATE]"
52040     .Replacement.text = Format(Now, "dd/mm/yy")
52050     .MatchWholeWord = True
52060     .MatchCase = True
52070     .Forward = True
52080     .Wrap = wdFindStop
52090     .Execute Replace:=wdReplaceAll
52100 End With

52110 With DDWordDoc.Range.Find
52120     .ClearFormatting
52130     .text = "[ORDERID]"
52140     .Replacement.text = Range("CUS.Order").Value
52150     .MatchWholeWord = True
52160     .MatchCase = True
52170     .Forward = True
52180     .Wrap = wdFindStop
52190     .Execute Replace:=wdReplaceAll
52200 End With

52210 With DDWordDoc.Range.Find
52220     .ClearFormatting
52230     .text = "[ACCNUM]"
52240     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
52250     .MatchWholeWord = True
52260     .MatchCase = True
52270     .Forward = True
52280     .Wrap = wdFindStop
52290     .Execute Replace:=wdReplaceAll
52300 End With

52310 With DDWordDoc.Range.Find
52320     .ClearFormatting
52330     .text = "[RM24#]"
52340 If Range("CONTROL.Letters!L77").Value <> "" Then .Replacement.text = Range("CONTROL.Letters!L77").Value Else .Replacement.text = ""
52350     .MatchWholeWord = True
52360     .MatchCase = True
52370     .Forward = True
52380     .Wrap = wdFindStop
52390     .Execute Replace:=wdReplaceAll
52400 End With

52410 With DDWordDoc.Range.Find
52420     .ClearFormatting
52430     .text = "[RM48#]"
52440 If Range("CONTROL.Letters!L78").Value <> "" Then .Replacement.text = Range("CONTROL.Letters!L78").Value Else .Replacement.text = ""
52450     .MatchWholeWord = True
52460     .MatchCase = True
52470     .Forward = True
52480     .Wrap = wdFindStop
52490     .Execute Replace:=wdReplaceAll
52500 End With

52510 With DDWordDoc.Range.Find
52520     .ClearFormatting
52530     .text = "[ADD1]"
52540     .Replacement.text = Range("LET.Address1").Value
52550     .MatchWholeWord = True
52560     .MatchCase = True
52570     .Forward = True
52580     .Wrap = wdFindStop
52590     .Execute Replace:=wdReplaceAll
52600 End With

52610 With DDWordDoc.Range.Find
52620     .ClearFormatting
52630     .text = "[ADD2]"
52640     .Replacement.text = Range("LET.Address2").Value
52650     .MatchWholeWord = True
52660     .MatchCase = True
52670     .Forward = True
52680     .Wrap = wdFindStop
52690     .Execute Replace:=wdReplaceAll
52700 End With

52710 With DDWordDoc.Range.Find
52720     .ClearFormatting
52730     .text = "[ADD3]"
52740     .Replacement.text = Range("LET.Address3").Value
52750     .MatchWholeWord = True
52760     .MatchCase = True
52770     .Forward = True
52780     .Wrap = wdFindStop
52790     .Execute Replace:=wdReplaceAll
52800 End With

52810 With DDWordDoc.Range.Find
52820     .ClearFormatting
52830     .text = "[ADD4]"
52840     .Replacement.text = Range("LET.Address4").Value
52850     .MatchWholeWord = True
52860     .MatchCase = True
52870     .Forward = True
52880     .Wrap = wdFindStop
52890     .Execute Replace:=wdReplaceAll
52900 End With

52910 With DDWordDoc.Range.Find
52920     .ClearFormatting
52930     .text = "[ADD5]"
52940     .Replacement.text = Range("LET.Address5").Value
52950     .MatchWholeWord = True
52960     .MatchCase = True
52970     .Forward = True
52980     .Wrap = wdFindStop
52990     .Execute Replace:=wdReplaceAll
53000 End With

53010 With DDWordDoc.Range.Find
53020     .ClearFormatting
53030     .text = "[24P]"
53040 If Range("CONTROL.Letters!N77").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N77").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
53050     .MatchWholeWord = True
53060     .MatchCase = True
53070     .Forward = True
53080     .Wrap = wdFindStop
53090     .Execute Replace:=wdReplaceAll
53100 End With

53110 With DDWordDoc.Range.Find
53120     .ClearFormatting
53130     .text = "[48P]"
53140 If Range("CONTROL.Letters!N78").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N78").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
53150     .MatchWholeWord = True
53160     .MatchCase = True
53170     .Forward = True
53180     .Wrap = wdFindStop
53190     .Execute Replace:=wdReplaceAll
53200 End With

53210 With DDWordDoc.Range.Find
53220     .ClearFormatting
53230     .text = "[24V]"
53240 If Range("CONTROL.Letters!M77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M77").Value Else .Replacement.text = "-"
53250     .MatchWholeWord = True
53260     .MatchCase = True
53270     .Forward = True
53280     .Wrap = wdFindStop
53290     .Execute Replace:=wdReplaceAll
53300 End With

53310 With DDWordDoc.Range.Find
53320     .ClearFormatting
53330     .text = "[48V]"
53340 If Range("CONTROL.Letters!M78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M78").Value Else .Replacement.text = "-"
53350     .MatchWholeWord = True
53360     .MatchCase = True
53370     .Forward = True
53380     .Wrap = wdFindStop
53390     .Execute Replace:=wdReplaceAll
53400 End With

53410 With DDWordDoc.Range.Find
53420     .ClearFormatting
53430     .text = "[24W]"
53440 If Range("CONTROL.Letters!Y77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y77").Value Else .Replacement.text = "-"
53450     .MatchWholeWord = True
53460     .MatchCase = True
53470     .Forward = True
53480     .Wrap = wdFindStop
53490     .Execute Replace:=wdReplaceAll
53500 End With

53510 With DDWordDoc.Range.Find
53520     .ClearFormatting
53530     .text = "[48W]"
53540 If Range("CONTROL.Letters!Y78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y78").Value Else .Replacement.text = "-"
53550     .MatchWholeWord = True
53560     .MatchCase = True
53570     .Forward = True
53580     .Wrap = wdFindStop
53590     .Execute Replace:=wdReplaceAll
53600 End With

53610 With DDWordDoc.Range.Find
53620     .ClearFormatting
53630     .text = "[24S]"
53640 If Range("CONTROL.Letters!R77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R77").Value Else .Replacement.text = "-"
53650     .MatchWholeWord = True
53660     .MatchCase = True
53670     .Forward = True
53680     .Wrap = wdFindStop
53690     .Execute Replace:=wdReplaceAll
53700 End With

53710 With DDWordDoc.Range.Find
53720     .ClearFormatting
53730     .text = "[48S]"
53740 If Range("CONTROL.Letters!R78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R78").Value Else .Replacement.text = "-"
53750     .MatchWholeWord = True
53760     .MatchCase = True
53770     .Forward = True
53780     .Wrap = wdFindStop
53790     .Execute Replace:=wdReplaceAll
53800 End With

53810 With DDWordDoc.Range.Find
53820     .ClearFormatting
53830     .text = "[TV]"
53840 If (Range("CONTROL.Letters!M81").Value + Range("CONTROL.Letters!M82").Value + Range("CONTROL.Letters!M77").Value + Range("CONTROL.Letters!M78").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M82").Value + Range("CONTROL.Letters!M81").Value + Range("CONTROL.Letters!M77").Value + Range("CONTROL.Letters!M78").Value) Else .Replacement.text = "-"
53850     .MatchWholeWord = True
53860     .MatchCase = True
53870     .Forward = True
53880     .Wrap = wdFindStop
53890     .Execute Replace:=wdReplaceAll
53900 End With

53910 With DDWordDoc.Range.Find
53920     .ClearFormatting
53930     .text = "[L24P]"
53940 If Range("CONTROL.Letters!N81").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N81").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
53950     .MatchWholeWord = True
53960     .MatchCase = True
53970     .Forward = True
53980     .Wrap = wdFindStop
53990     .Execute Replace:=wdReplaceAll
54000 End With

54010 With DDWordDoc.Range.Find
54020     .ClearFormatting
54030     .text = "[L48P]"
54040 If Range("CONTROL.Letters!N82").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N82").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
54050     .MatchWholeWord = True
54060     .MatchCase = True
54070     .Forward = True
54080     .Wrap = wdFindStop
54090     .Execute Replace:=wdReplaceAll
54100 End With

54110 With DDWordDoc.Range.Find
54120     .ClearFormatting
54130     .text = "[L24V]"
54140 If Range("CONTROL.Letters!M81").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M81").Value Else .Replacement.text = "-"
54150     .MatchWholeWord = True
54160     .MatchCase = True
54170     .Forward = True
54180     .Wrap = wdFindStop
54190     .Execute Replace:=wdReplaceAll
54200 End With

54210 With DDWordDoc.Range.Find
54220     .ClearFormatting
54230     .text = "[L48V]"
54240 If Range("CONTROL.Letters!M82").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M82").Value Else .Replacement.text = "-"
54250     .MatchWholeWord = True
54260     .MatchCase = True
54270     .Forward = True
54280     .Wrap = wdFindStop
54290     .Execute Replace:=wdReplaceAll
54300 End With

54310 With DDWordDoc.Range.Find
54320     .ClearFormatting
54330     .text = "[L24W]"
54340 If Range("CONTROL.Letters!Y81").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y81").Value Else .Replacement.text = "-"
54350     .MatchWholeWord = True
54360     .MatchCase = True
54370     .Forward = True
54380     .Wrap = wdFindStop
54390     .Execute Replace:=wdReplaceAll
54400 End With

54410 With DDWordDoc.Range.Find
54420     .ClearFormatting
54430     .text = "[L48W]"
54440 If Range("CONTROL.Letters!Y82").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y82").Value Else .Replacement.text = "-"
54450     .MatchWholeWord = True
54460     .MatchCase = True
54470     .Forward = True
54480     .Wrap = wdFindStop
54490     .Execute Replace:=wdReplaceAll
54500 End With

54510 With DDWordDoc.Range.Find
54520     .ClearFormatting
54530     .text = "[L24S]"
54540 If Range("CONTROL.Letters!R81").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R81").Value Else .Replacement.text = "-"
54550     .MatchWholeWord = True
54560     .MatchCase = True
54570     .Forward = True
54580     .Wrap = wdFindStop
54590     .Execute Replace:=wdReplaceAll
54600 End With

54610 With DDWordDoc.Range.Find
54620     .ClearFormatting
54630     .text = "[L48S]"
54640 If Range("CONTROL.Letters!R82").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R82").Value Else .Replacement.text = "-"
54650     .MatchWholeWord = True
54660     .MatchCase = True
54670     .Forward = True
54680     .Wrap = wdFindStop
54690     .Execute Replace:=wdReplaceAll
54700 End With



48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
55010     TempFilePath = Environ$("temp") & "\"
55020     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
55030     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
55040     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
55050     DDWordDoc.Close

          
      'Attach to existing outlook
55060 With OutMail
55070     .Attachments.Add TempFilePath & tempfilename & ".pdf"
55080 End With
      'Delete the file
55090     Set DDWordApp = Nothing
55100     Set DDWordDoc = Nothing
55110     Kill TempFilePath & tempfilename & ".pdf"
55120     Kill TempFilePath & tempfilename & ".doc"
55130 Exit Sub
error_proc:
55140     If MsgBox("Error has occured with subroutine [RMTLB]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
55150     ShutDown
End Sub

Sub RMTLBS()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
55160 Set DDWordApp = CreateObject("Word.Application")
55170 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMTLBS18_2.docx", ReadOnly:=False)

      'Replace
      'Replace
55180 With DDWordDoc.Range.Find
55190     .ClearFormatting
55200     .text = "[CUS]"
55210     .Replacement.text = Range("CUS.CustName").Value
55220     .MatchWholeWord = True
55230     .MatchCase = True
55240     .Forward = True
55250     .Wrap = wdFindStop
55260     .Execute Replace:=wdReplaceAll
55270 End With

55280 With DDWordDoc.Range.Find
55290     .ClearFormatting
55300     .text = "[NAME]"
55310     .Replacement.text = Range("CONTROL.Letters!S19").Value
55320     .MatchWholeWord = True
55330     .MatchCase = True
55340     .Forward = True
55350     .Wrap = wdFindStop
55360     .Execute Replace:=wdReplaceAll
55370 End With


55380 With DDWordDoc.Range.Find
55390     .ClearFormatting
55400     .text = "[DATE]"
55410     .Replacement.text = Format(Now, "dd/mm/yy")
55420     .MatchWholeWord = True
55430     .MatchCase = True
55440     .Forward = True
55450     .Wrap = wdFindStop
55460     .Execute Replace:=wdReplaceAll
55470 End With

55480 With DDWordDoc.Range.Find
55490     .ClearFormatting
55500     .text = "[ORDERID]"
55510     .Replacement.text = Range("CUS.Order").Value
55520     .MatchWholeWord = True
55530     .MatchCase = True
55540     .Forward = True
55550     .Wrap = wdFindStop
55560     .Execute Replace:=wdReplaceAll
55570 End With

55580 With DDWordDoc.Range.Find
55590     .ClearFormatting
55600     .text = "[ACCNUM]"
55610     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
55620     .MatchWholeWord = True
55630     .MatchCase = True
55640     .Forward = True
55650     .Wrap = wdFindStop
55660     .Execute Replace:=wdReplaceAll
55670 End With

55680 With DDWordDoc.Range.Find
55690     .ClearFormatting
55700     .text = "[RM24#]"
55710 If Range("CONTROL.Letters!L73").Value <> "" Then .Replacement.text = Range("CONTROL.Letters!L73").Value Else .Replacement.text = ""
55720     .MatchWholeWord = True
55730     .MatchCase = True
55740     .Forward = True
55750     .Wrap = wdFindStop
55760     .Execute Replace:=wdReplaceAll
55770 End With

55780 With DDWordDoc.Range.Find
55790     .ClearFormatting
55800     .text = "[RM48#]"
55810 If Range("CONTROL.Letters!L74").Value <> "" Then .Replacement.text = Range("CONTROL.Letters!L74").Value Else .Replacement.text = ""
55820     .MatchWholeWord = True
55830     .MatchCase = True
55840     .Forward = True
55850     .Wrap = wdFindStop
55860     .Execute Replace:=wdReplaceAll
55870 End With


55880 With DDWordDoc.Range.Find
55890     .ClearFormatting
55900     .text = "[ADD1]"
55910     .Replacement.text = Range("LET.Address1").Value
55920     .MatchWholeWord = True
55930     .MatchCase = True
55940     .Forward = True
55950     .Wrap = wdFindStop
55960     .Execute Replace:=wdReplaceAll
55970 End With

55980 With DDWordDoc.Range.Find
55990     .ClearFormatting
56000     .text = "[ADD2]"
56010     .Replacement.text = Range("LET.Address2").Value
56020     .MatchWholeWord = True
56030     .MatchCase = True
56040     .Forward = True
56050     .Wrap = wdFindStop
56060     .Execute Replace:=wdReplaceAll
56070 End With

56080 With DDWordDoc.Range.Find
56090     .ClearFormatting
56100     .text = "[ADD3]"
56110     .Replacement.text = Range("LET.Address3").Value
56120     .MatchWholeWord = True
56130     .MatchCase = True
56140     .Forward = True
56150     .Wrap = wdFindStop
56160     .Execute Replace:=wdReplaceAll
56170 End With

56180 With DDWordDoc.Range.Find
56190     .ClearFormatting
56200     .text = "[ADD4]"
56210     .Replacement.text = Range("LET.Address4").Value
56220     .MatchWholeWord = True
56230     .MatchCase = True
56240     .Forward = True
56250     .Wrap = wdFindStop
56260     .Execute Replace:=wdReplaceAll
56270 End With

56280 With DDWordDoc.Range.Find
56290     .ClearFormatting
56300     .text = "[ADD5]"
56310     .Replacement.text = Range("LET.Address5").Value
56320     .MatchWholeWord = True
56330     .MatchCase = True
56340     .Forward = True
56350     .Wrap = wdFindStop
56360     .Execute Replace:=wdReplaceAll
56370 End With

56380 With DDWordDoc.Range.Find
56390     .ClearFormatting
56400     .text = "[24P]"
56410 If Range("CONTROL.Letters!N73").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N73").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
56420     .MatchWholeWord = True
56430     .MatchCase = True
56440     .Forward = True
56450     .Wrap = wdFindStop
56460     .Execute Replace:=wdReplaceAll
56470 End With

56480 With DDWordDoc.Range.Find
56490     .ClearFormatting
56500     .text = "[48P]"
56510 If Range("CONTROL.Letters!N74").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N74").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
56520     .MatchWholeWord = True
56530     .MatchCase = True
56540     .Forward = True
56550     .Wrap = wdFindStop
56560     .Execute Replace:=wdReplaceAll
56570 End With

56580 With DDWordDoc.Range.Find
56590     .ClearFormatting
56600     .text = "[24V]"
56610 If Range("CONTROL.Letters!M73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M73").Value Else .Replacement.text = "-"
56620     .MatchWholeWord = True
56630     .MatchCase = True
56640     .Forward = True
56650     .Wrap = wdFindStop
56660     .Execute Replace:=wdReplaceAll
56670 End With

56680 With DDWordDoc.Range.Find
56690     .ClearFormatting
56700     .text = "[48V]"
56710 If Range("CONTROL.Letters!M74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M74").Value Else .Replacement.text = "-"
56720     .MatchWholeWord = True
56730     .MatchCase = True
56740     .Forward = True
56750     .Wrap = wdFindStop
56760     .Execute Replace:=wdReplaceAll
56770 End With

56780 With DDWordDoc.Range.Find
56790     .ClearFormatting
56800     .text = "[24W]"
56810 If Range("CONTROL.Letters!Y73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y73").Value Else .Replacement.text = "-"
56820     .MatchWholeWord = True
56830     .MatchCase = True
56840     .Forward = True
56850     .Wrap = wdFindStop
56860     .Execute Replace:=wdReplaceAll
56870 End With

56880 With DDWordDoc.Range.Find
56890     .ClearFormatting
56900     .text = "[48W]"
56910 If Range("CONTROL.Letters!Y74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y74").Value Else .Replacement.text = "-"
56920     .MatchWholeWord = True
56930     .MatchCase = True
56940     .Forward = True
56950     .Wrap = wdFindStop
56960     .Execute Replace:=wdReplaceAll
56970 End With

56980 With DDWordDoc.Range.Find
56990     .ClearFormatting
57000     .text = "[24S]"
57010 If Range("CONTROL.Letters!R73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R73").Value Else .Replacement.text = "-"
57020     .MatchWholeWord = True
57030     .MatchCase = True
57040     .Forward = True
57050     .Wrap = wdFindStop
57060     .Execute Replace:=wdReplaceAll
57070 End With

57080 With DDWordDoc.Range.Find
57090     .ClearFormatting
57100     .text = "[48S]"
57110 If Range("CONTROL.Letters!R74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R74").Value Else .Replacement.text = "-"
57120     .MatchWholeWord = True
57130     .MatchCase = True
57140     .Forward = True
57150     .Wrap = wdFindStop
57160     .Execute Replace:=wdReplaceAll
57170 End With

57180 With DDWordDoc.Range.Find
57190     .ClearFormatting
57200     .text = "[TV]"
57210 If (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value + Range("CONTROL.Letters!M77").Value + Range("CONTROL.Letters!M78").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value + Range("CONTROL.Letters!M77").Value + Range("CONTROL.Letters!M78").Value) Else .Replacement.text = "-"
57220     .MatchWholeWord = True
57230     .MatchCase = True
57240     .Forward = True
57250     .Wrap = wdFindStop
57260     .Execute Replace:=wdReplaceAll
57270 End With

57280 With DDWordDoc.Range.Find
57290     .ClearFormatting
57300     .text = "[L24P]"
57310 If Range("CONTROL.Letters!N77").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N77").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
57320     .MatchWholeWord = True
57330     .MatchCase = True
57340     .Forward = True
57350     .Wrap = wdFindStop
57360     .Execute Replace:=wdReplaceAll
57370 End With

57380 With DDWordDoc.Range.Find
57390     .ClearFormatting
57400     .text = "[L48P]"
57410 If Range("CONTROL.Letters!N78").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N78").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
57420     .MatchWholeWord = True
57430     .MatchCase = True
57440     .Forward = True
57450     .Wrap = wdFindStop
57460     .Execute Replace:=wdReplaceAll
57470 End With

57480 With DDWordDoc.Range.Find
57490     .ClearFormatting
57500     .text = "[L24V]"
57510 If Range("CONTROL.Letters!M77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M77").Value Else .Replacement.text = "-"
57520     .MatchWholeWord = True
57530     .MatchCase = True
57540     .Forward = True
57550     .Wrap = wdFindStop
57560     .Execute Replace:=wdReplaceAll
57570 End With

57580 With DDWordDoc.Range.Find
57590     .ClearFormatting
57600     .text = "[L48V]"
57610 If Range("CONTROL.Letters!M78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M78").Value Else .Replacement.text = "-"
57620     .MatchWholeWord = True
57630     .MatchCase = True
57640     .Forward = True
57650     .Wrap = wdFindStop
57660     .Execute Replace:=wdReplaceAll
57670 End With

57680 With DDWordDoc.Range.Find
57690     .ClearFormatting
57700     .text = "[L24W]"
57710 If Range("CONTROL.Letters!Y77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y77").Value Else .Replacement.text = "-"
57720     .MatchWholeWord = True
57730     .MatchCase = True
57740     .Forward = True
57750     .Wrap = wdFindStop
57760     .Execute Replace:=wdReplaceAll
57770 End With

57780 With DDWordDoc.Range.Find
57790     .ClearFormatting
57800     .text = "[L48W]"
57810 If Range("CONTROL.Letters!Y78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y78").Value Else .Replacement.text = "-"
57820     .MatchWholeWord = True
57830     .MatchCase = True
57840     .Forward = True
57850     .Wrap = wdFindStop
57860     .Execute Replace:=wdReplaceAll
57870 End With

57880 With DDWordDoc.Range.Find
57890     .ClearFormatting
57900     .text = "[L24S]"
57910 If Range("CONTROL.Letters!R77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R77").Value Else .Replacement.text = "-"
57920     .MatchWholeWord = True
57930     .MatchCase = True
57940     .Forward = True
57950     .Wrap = wdFindStop
57960     .Execute Replace:=wdReplaceAll
57970 End With

57980 With DDWordDoc.Range.Find
57990     .ClearFormatting
58000     .text = "[L48S]"
58010 If Range("CONTROL.Letters!R78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R78").Value Else .Replacement.text = "-"
58020     .MatchWholeWord = True
58030     .MatchCase = True
58040     .Forward = True
58050     .Wrap = wdFindStop
58060     .Execute Replace:=wdReplaceAll
58070 End With


48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
58380     TempFilePath = Environ$("temp") & "\"
58390     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
58400     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
58410     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
58420     DDWordDoc.Close

          
      'Attach to existing outlook
58430 With OutMail
58440     .Attachments.Add TempFilePath & tempfilename & ".pdf"
58450 End With
      'Delete the file
58460     Set DDWordApp = Nothing
58470     Set DDWordDoc = Nothing
58480     Kill TempFilePath & tempfilename & ".pdf"
58490     Kill TempFilePath & tempfilename & ".doc"
58500 Exit Sub
error_proc:
58510     If MsgBox("Error has occured with subroutine [RMTLBS]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
58520     ShutDown
End Sub

Sub RMTHV()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
58530 Set DDWordApp = CreateObject("Word.Application")
58540 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMTHV18_2.docx", ReadOnly:=False)

      'Replace
58550 With DDWordDoc.Range.Find
58560     .ClearFormatting
58570     .text = "[CUS]"
58580     .Replacement.text = Range("CUS.CustName").Value
58590     .MatchWholeWord = True
58600     .MatchCase = True
58610     .Forward = True
58620     .Wrap = wdFindStop
58630     .Execute Replace:=wdReplaceAll
58640 End With

58650 With DDWordDoc.Range.Find
58660     .ClearFormatting
58670     .text = "[NAME]"
58680     .Replacement.text = Range("CONTROL.Letters!S19").Value
58690     .MatchWholeWord = True
58700     .MatchCase = True
58710     .Forward = True
58720     .Wrap = wdFindStop
58730     .Execute Replace:=wdReplaceAll
58740 End With


58750 With DDWordDoc.Range.Find
58760     .ClearFormatting
58770     .text = "[DATE]"
58780     .Replacement.text = Format(Now, "dd/mm/yy")
58790     .MatchWholeWord = True
58800     .MatchCase = True
58810     .Forward = True
58820     .Wrap = wdFindStop
58830     .Execute Replace:=wdReplaceAll
58840 End With

58850 With DDWordDoc.Range.Find
58860     .ClearFormatting
58870     .text = "[ORDERID]"
58880     .Replacement.text = Range("CUS.Order").Value
58890     .MatchWholeWord = True
58900     .MatchCase = True
58910     .Forward = True
58920     .Wrap = wdFindStop
58930     .Execute Replace:=wdReplaceAll
58940 End With

58950 With DDWordDoc.Range.Find
58960     .ClearFormatting
58970     .text = "[ACCNUM]"
58980     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
58990     .MatchWholeWord = True
59000     .MatchCase = True
59010     .Forward = True
59020     .Wrap = wdFindStop
59030     .Execute Replace:=wdReplaceAll
59040 End With

59050 With DDWordDoc.Range.Find
59060     .ClearFormatting
59070     .text = "[RM24#]"
59080     .Replacement.text = Range("CONTROL.Letters!K146").Value
59090     .MatchWholeWord = True
59100     .MatchCase = True
59110     .Forward = True
59120     .Wrap = wdFindStop
59130     .Execute Replace:=wdReplaceAll
59140 End With

59150 With DDWordDoc.Range.Find
59160     .ClearFormatting
59170     .text = "[RM48#]"
59180     .Replacement.text = Range("CONTROL.Letters!K147").Value
59190     .MatchWholeWord = True
59200     .MatchCase = True
59210     .Forward = True
59220     .Wrap = wdFindStop
59230     .Execute Replace:=wdReplaceAll
59240 End With

59250 With DDWordDoc.Range.Find
59260     .ClearFormatting
59270     .text = "[ADD1]"
59280     .Replacement.text = Range("LET.Address1").Value
59290     .MatchWholeWord = True
59300     .MatchCase = True
59310     .Forward = True
59320     .Wrap = wdFindStop
59330     .Execute Replace:=wdReplaceAll
59340 End With

59350 With DDWordDoc.Range.Find
59360     .ClearFormatting
59370     .text = "[ADD2]"
59380     .Replacement.text = Range("LET.Address2").Value
59390     .MatchWholeWord = True
59400     .MatchCase = True
59410     .Forward = True
59420     .Wrap = wdFindStop
59430     .Execute Replace:=wdReplaceAll
59440 End With

59450 With DDWordDoc.Range.Find
59460     .ClearFormatting
59470     .text = "[ADD3]"
59480     .Replacement.text = Range("LET.Address3").Value
59490     .MatchWholeWord = True
59500     .MatchCase = True
59510     .Forward = True
59520     .Wrap = wdFindStop
59530     .Execute Replace:=wdReplaceAll
59540 End With

59550 With DDWordDoc.Range.Find
59560     .ClearFormatting
59570     .text = "[ADD4]"
59580     .Replacement.text = Range("LET.Address4").Value
59590     .MatchWholeWord = True
59600     .MatchCase = True
59610     .Forward = True
59620     .Wrap = wdFindStop
59630     .Execute Replace:=wdReplaceAll
59640 End With

59650 With DDWordDoc.Range.Find
59660     .ClearFormatting
59670     .text = "[ADD5]"
59680     .Replacement.text = Range("LET.Address5").Value
59690     .MatchWholeWord = True
59700     .MatchCase = True
59710     .Forward = True
59720     .Wrap = wdFindStop
59730     .Execute Replace:=wdReplaceAll
59740 End With

59750 With DDWordDoc.Range.Find
59760     .ClearFormatting
59770     .text = "[24P]"
59780 If Range("CONTROL.Letters!N76").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N76").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
59790     .MatchWholeWord = True
59800     .MatchCase = True
59810     .Forward = True
59820     .Wrap = wdFindStop
59830     .Execute Replace:=wdReplaceAll
59840 End With

59850 With DDWordDoc.Range.Find
59860     .ClearFormatting
59870     .text = "[48P]"
59880 If Range("CONTROL.Letters!N75").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N75").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
59890     .MatchWholeWord = True
59900     .MatchCase = True
59910     .Forward = True
59920     .Wrap = wdFindStop
59930     .Execute Replace:=wdReplaceAll
59940 End With

59950 With DDWordDoc.Range.Find
59960     .ClearFormatting
59970     .text = "[24V]"
59980 If Range("CONTROL.Letters!M76").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M76").Value Else .Replacement.text = "-"
59990     .MatchWholeWord = True
60000     .MatchCase = True
60010     .Forward = True
60020     .Wrap = wdFindStop
60030     .Execute Replace:=wdReplaceAll
60040 End With

60050 With DDWordDoc.Range.Find
60060     .ClearFormatting
60070     .text = "[48V]"
60080 If Range("CONTROL.Letters!M75").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M75").Value Else .Replacement.text = "-"
60090     .MatchWholeWord = True
60100     .MatchCase = True
60110     .Forward = True
60120     .Wrap = wdFindStop
60130     .Execute Replace:=wdReplaceAll
60140 End With

60150 With DDWordDoc.Range.Find
60160     .ClearFormatting
60170     .text = "[24W]"
60180 If Range("CONTROL.Letters!Y76").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y76").Value Else .Replacement.text = "-"
60190     .MatchWholeWord = True
60200     .MatchCase = True
60210     .Forward = True
60220     .Wrap = wdFindStop
60230     .Execute Replace:=wdReplaceAll
60240 End With

60250 With DDWordDoc.Range.Find
60260     .ClearFormatting
60270     .text = "[48W]"
60280 If Range("CONTROL.Letters!Y75").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y75").Value Else .Replacement.text = "-"
60290     .MatchWholeWord = True
60300     .MatchCase = True
60310     .Forward = True
60320     .Wrap = wdFindStop
60330     .Execute Replace:=wdReplaceAll
60340 End With

60350 With DDWordDoc.Range.Find
60360     .ClearFormatting
60370     .text = "[24S]"
60380 If Range("CONTROL.Letters!R76").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R76").Value Else .Replacement.text = "-"
60390     .MatchWholeWord = True
60400     .MatchCase = True
60410     .Forward = True
60420     .Wrap = wdFindStop
60430     .Execute Replace:=wdReplaceAll
60440 End With

60450 With DDWordDoc.Range.Find
60460     .ClearFormatting
60470     .text = "[48S]"
60480 If Range("CONTROL.Letters!R75").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R75").Value Else .Replacement.text = "-"
60490     .MatchWholeWord = True
60500     .MatchCase = True
60510     .Forward = True
60520     .Wrap = wdFindStop
60530     .Execute Replace:=wdReplaceAll
60540 End With

60550 With DDWordDoc.Range.Find
60560     .ClearFormatting
60570     .text = "[TV]"
60580 If (Range("CONTROL.Letters!M76").Value + Range("CONTROL.Letters!M75").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M76").Value + Range("CONTROL.Letters!M75").Value) Else .Replacement.text = "-"
60590     .MatchWholeWord = True
60600     .MatchCase = True
60610     .Forward = True
60620     .Wrap = wdFindStop
60630     .Execute Replace:=wdReplaceAll
60640 End With


48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
60950     TempFilePath = Environ$("temp") & "\"
60960     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
60970     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
60980     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
60990     DDWordDoc.Close

          
      'Attach to existing outlook
61000 With OutMail
61010     .Attachments.Add TempFilePath & tempfilename & ".pdf"
61020 End With
      'Delete the file
61030     Set DDWordApp = Nothing
61040     Set DDWordDoc = Nothing
61050     Kill TempFilePath & tempfilename & ".pdf"
61060     Kill TempFilePath & tempfilename & ".doc"
61070 Exit Sub
error_proc:
61080     If MsgBox("Error has occured with subroutine [RMTHV]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
61090     ShutDown
End Sub

Sub RMTHVS()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
61100 Set DDWordApp = CreateObject("Word.Application")
61110 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMTHVS18_2.docx", ReadOnly:=False)

      'Replace
61120 With DDWordDoc.Range.Find
61130     .ClearFormatting
61140     .text = "[CUS]"
61150     .Replacement.text = Range("CUS.CustName").Value
61160     .MatchWholeWord = True
61170     .MatchCase = True
61180     .Forward = True
61190     .Wrap = wdFindStop
61200     .Execute Replace:=wdReplaceAll
61210 End With

61220 With DDWordDoc.Range.Find
61230     .ClearFormatting
61240     .text = "[NAME]"
61250     .Replacement.text = Range("CONTROL.Letters!S19").Value
61260     .MatchWholeWord = True
61270     .MatchCase = True
61280     .Forward = True
61290     .Wrap = wdFindStop
61300     .Execute Replace:=wdReplaceAll
61310 End With


61320 With DDWordDoc.Range.Find
61330     .ClearFormatting
61340     .text = "[DATE]"
61350     .Replacement.text = Format(Now, "dd/mm/yy")
61360     .MatchWholeWord = True
61370     .MatchCase = True
61380     .Forward = True
61390     .Wrap = wdFindStop
61400     .Execute Replace:=wdReplaceAll
61410 End With

61420 With DDWordDoc.Range.Find
61430     .ClearFormatting
61440     .text = "[ORDERID]"
61450     .Replacement.text = Range("CUS.Order").Value
61460     .MatchWholeWord = True
61470     .MatchCase = True
61480     .Forward = True
61490     .Wrap = wdFindStop
61500     .Execute Replace:=wdReplaceAll
61510 End With

61520 With DDWordDoc.Range.Find
61530     .ClearFormatting
61540     .text = "[ACCNUM]"
61550     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
61560     .MatchWholeWord = True
61570     .MatchCase = True
61580     .Forward = True
61590     .Wrap = wdFindStop
61600     .Execute Replace:=wdReplaceAll
61610 End With

61620 With DDWordDoc.Range.Find
61630     .ClearFormatting
61640     .text = "[RM24#]"
61650     .Replacement.text = Range("CONTROL.Letters!K146").Value
61660     .MatchWholeWord = True
61670     .MatchCase = True
61680     .Forward = True
61690     .Wrap = wdFindStop
61700     .Execute Replace:=wdReplaceAll
61710 End With

61720 With DDWordDoc.Range.Find
61730     .ClearFormatting
61740     .text = "[RM48#]"
61750     .Replacement.text = Range("CONTROL.Letters!K147").Value
61760     .MatchWholeWord = True
61770     .MatchCase = True
61780     .Forward = True
61790     .Wrap = wdFindStop
61800     .Execute Replace:=wdReplaceAll
61810 End With

61820 With DDWordDoc.Range.Find
61830     .ClearFormatting
61840     .text = "[ADD1]"
61850     .Replacement.text = Range("LET.Address1").Value
61860     .MatchWholeWord = True
61870     .MatchCase = True
61880     .Forward = True
61890     .Wrap = wdFindStop
61900     .Execute Replace:=wdReplaceAll
61910 End With

61920 With DDWordDoc.Range.Find
61930     .ClearFormatting
61940     .text = "[ADD2]"
61950     .Replacement.text = Range("LET.Address2").Value
61960     .MatchWholeWord = True
61970     .MatchCase = True
61980     .Forward = True
61990     .Wrap = wdFindStop
62000     .Execute Replace:=wdReplaceAll
62010 End With

62020 With DDWordDoc.Range.Find
62030     .ClearFormatting
62040     .text = "[ADD3]"
62050     .Replacement.text = Range("LET.Address3").Value
62060     .MatchWholeWord = True
62070     .MatchCase = True
62080     .Forward = True
62090     .Wrap = wdFindStop
62100     .Execute Replace:=wdReplaceAll
62110 End With

62120 With DDWordDoc.Range.Find
62130     .ClearFormatting
62140     .text = "[ADD4]"
62150     .Replacement.text = Range("LET.Address4").Value
62160     .MatchWholeWord = True
62170     .MatchCase = True
62180     .Forward = True
62190     .Wrap = wdFindStop
62200     .Execute Replace:=wdReplaceAll
62210 End With

62220 With DDWordDoc.Range.Find
62230     .ClearFormatting
62240     .text = "[ADD5]"
62250     .Replacement.text = Range("LET.Address5").Value
62260     .MatchWholeWord = True
62270     .MatchCase = True
62280     .Forward = True
62290     .Wrap = wdFindStop
62300     .Execute Replace:=wdReplaceAll
62310 End With
62320 With DDWordDoc.Range.Find
62330     .ClearFormatting
62340     .text = "[24P]"
62350 If Range("CONTROL.Letters!N76").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N76").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
62360     .MatchWholeWord = True
62370     .MatchCase = True
62380     .Forward = True
62390     .Wrap = wdFindStop
62400     .Execute Replace:=wdReplaceAll
62410 End With

62420 With DDWordDoc.Range.Find
62430     .ClearFormatting
62440     .text = "[48P]"
62450 If Range("CONTROL.Letters!N75").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N75").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
62460     .MatchWholeWord = True
62470     .MatchCase = True
62480     .Forward = True
62490     .Wrap = wdFindStop
62500     .Execute Replace:=wdReplaceAll
62510 End With

62520 With DDWordDoc.Range.Find
62530     .ClearFormatting
62540     .text = "[24V]"
62550 If Range("CONTROL.Letters!M76").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M76").Value Else .Replacement.text = "-"
62560     .MatchWholeWord = True
62570     .MatchCase = True
62580     .Forward = True
62590     .Wrap = wdFindStop
62600     .Execute Replace:=wdReplaceAll
62610 End With

62620 With DDWordDoc.Range.Find
62630     .ClearFormatting
62640     .text = "[48V]"
62650 If Range("CONTROL.Letters!M75").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M75").Value Else .Replacement.text = "-"
62660     .MatchWholeWord = True
62670     .MatchCase = True
62680     .Forward = True
62690     .Wrap = wdFindStop
62700     .Execute Replace:=wdReplaceAll
62710 End With

62720 With DDWordDoc.Range.Find
62730     .ClearFormatting
62740     .text = "[24W]"
62750 If Range("CONTROL.Letters!Y76").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y76").Value Else .Replacement.text = "-"
62760     .MatchWholeWord = True
62770     .MatchCase = True
62780     .Forward = True
62790     .Wrap = wdFindStop
62800     .Execute Replace:=wdReplaceAll
62810 End With

62820 With DDWordDoc.Range.Find
62830     .ClearFormatting
62840     .text = "[48W]"
62850 If Range("CONTROL.Letters!Y75").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y75").Value Else .Replacement.text = "-"
62860     .MatchWholeWord = True
62870     .MatchCase = True
62880     .Forward = True
62890     .Wrap = wdFindStop
62900     .Execute Replace:=wdReplaceAll
62910 End With

62920 With DDWordDoc.Range.Find
62930     .ClearFormatting
62940     .text = "[24S]"
62950 If Range("CONTROL.Letters!R76").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R76").Value Else .Replacement.text = "-"
62960     .MatchWholeWord = True
62970     .MatchCase = True
62980     .Forward = True
62990     .Wrap = wdFindStop
63000     .Execute Replace:=wdReplaceAll
63010 End With

63020 With DDWordDoc.Range.Find
63030     .ClearFormatting
63040     .text = "[48S]"
63050 If Range("CONTROL.Letters!R75").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R75").Value Else .Replacement.text = "-"
63060     .MatchWholeWord = True
63070     .MatchCase = True
63080     .Forward = True
63090     .Wrap = wdFindStop
63100     .Execute Replace:=wdReplaceAll
63110 End With

63120 With DDWordDoc.Range.Find
63130     .ClearFormatting
63140     .text = "[TV]"
63150 If (Range("CONTROL.Letters!M76").Value + Range("CONTROL.Letters!M71").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M76").Value + Range("CONTROL.Letters!M71").Value) Else .Replacement.text = "-"
63160     .MatchWholeWord = True
63170     .MatchCase = True
63180     .Forward = True
63190     .Wrap = wdFindStop
63200     .Execute Replace:=wdReplaceAll
63210 End With

48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
63520     TempFilePath = Environ$("temp") & "\"
63530     tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
63540     DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
63550     DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
63560     DDWordDoc.Close

          
      'Attach to existing outlook
63570 With OutMail
63580     .Attachments.Add TempFilePath & tempfilename & ".pdf"
63590 End With
      'Delete the file
63600     Set DDWordApp = Nothing
63610     Set DDWordDoc = Nothing
63620     Kill TempFilePath & tempfilename & ".pdf"
63630     Kill TempFilePath & tempfilename & ".doc"
63640 Exit Sub
error_proc:
63650     If MsgBox("Error has occured with subroutine [RMTHVS]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
63660     ShutDown
End Sub

Sub RMTLBHV()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
63670 Set DDWordApp = CreateObject("Word.Application")
63680 Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMTLBHV18_2.docx", ReadOnly:=False)

      'Replace
63690 With DDWordDoc.Range.Find
63700     .ClearFormatting
63710     .text = "[CUS]"
63720     .Replacement.text = Range("CUS.CustName").Value
63730     .MatchWholeWord = True
63740     .MatchCase = True
63750     .Forward = True
63760     .Wrap = wdFindStop
63770     .Execute Replace:=wdReplaceAll
63780 End With

63790 With DDWordDoc.Range.Find
63800     .ClearFormatting
63810     .text = "[NAME]"
63820     .Replacement.text = Range("CONTROL.Letters!S19").Value
63830     .MatchWholeWord = True
63840     .MatchCase = True
63850     .Forward = True
63860     .Wrap = wdFindStop
63870     .Execute Replace:=wdReplaceAll
63880 End With


63890 With DDWordDoc.Range.Find
63900     .ClearFormatting
63910     .text = "[DATE]"
63920     .Replacement.text = Format(Now, "dd/mm/yy")
63930     .MatchWholeWord = True
63940     .MatchCase = True
63950     .Forward = True
63960     .Wrap = wdFindStop
63970     .Execute Replace:=wdReplaceAll
63980 End With

63990 With DDWordDoc.Range.Find
64000     .ClearFormatting
64010     .text = "[ORDERID]"
64020     .Replacement.text = Range("CUS.Order").Value
64030     .MatchWholeWord = True
64040     .MatchCase = True
64050     .Forward = True
64060     .Wrap = wdFindStop
64070     .Execute Replace:=wdReplaceAll
64080 End With

64090 With DDWordDoc.Range.Find
64100     .ClearFormatting
64110     .text = "[ACCNUM]"
64120     .Replacement.text = Range("CUS.RMSAPBillingNo").Value
64130     .MatchWholeWord = True
64140     .MatchCase = True
64150     .Forward = True
64160     .Wrap = wdFindStop
64170     .Execute Replace:=wdReplaceAll
64180 End With

64190 With DDWordDoc.Range.Find
64200     .ClearFormatting
64210     .text = "[RM24#]"
64220 If Range("CONTROL.Letters!L80").Value <> "" Then .Replacement.text = Range("CONTROL.Letters!L80").Value Else .Replacement.text = ""
64230     .MatchWholeWord = True
64240     .MatchCase = True
64250     .Forward = True
64260     .Wrap = wdFindStop
64270     .Execute Replace:=wdReplaceAll
64280 End With

64290 With DDWordDoc.Range.Find
64300     .ClearFormatting
64310     .text = "[RM48#]"
64320 If Range("CONTROL.Letters!L79").Value <> "" Then .Replacement.text = Range("CONTROL.Letters!L79").Value Else .Replacement.text = ""
64330     .MatchWholeWord = True
64340     .MatchCase = True
64350     .Forward = True
64360     .Wrap = wdFindStop
64370     .Execute Replace:=wdReplaceAll
64380 End With


64390 With DDWordDoc.Range.Find
64400     .ClearFormatting
64410     .text = "[ADD1]"
64420     .Replacement.text = Range("LET.Address1").Value
64430     .MatchWholeWord = True
64440     .MatchCase = True
64450     .Forward = True
64460     .Wrap = wdFindStop
64470     .Execute Replace:=wdReplaceAll
64480 End With

64490 With DDWordDoc.Range.Find
64500     .ClearFormatting
64510     .text = "[ADD2]"
64520     .Replacement.text = Range("LET.Address2").Value
64530     .MatchWholeWord = True
64540     .MatchCase = True
64550     .Forward = True
64560     .Wrap = wdFindStop
64570     .Execute Replace:=wdReplaceAll
64580 End With

64590 With DDWordDoc.Range.Find
64600     .ClearFormatting
64610     .text = "[ADD3]"
64620     .Replacement.text = Range("LET.Address3").Value
64630     .MatchWholeWord = True
64640     .MatchCase = True
64650     .Forward = True
64660     .Wrap = wdFindStop
64670     .Execute Replace:=wdReplaceAll
64680 End With

64690 With DDWordDoc.Range.Find
64700     .ClearFormatting
64710     .text = "[ADD4]"
64720     .Replacement.text = Range("LET.Address4").Value
64730     .MatchWholeWord = True
64740     .MatchCase = True
64750     .Forward = True
64760     .Wrap = wdFindStop
64770     .Execute Replace:=wdReplaceAll
64780 End With

64790 With DDWordDoc.Range.Find
64800     .ClearFormatting
64810     .text = "[ADD5]"
64820     .Replacement.text = Range("LET.Address5").Value
64830     .MatchWholeWord = True
64840     .MatchCase = True
64850     .Forward = True
64860     .Wrap = wdFindStop
64870     .Execute Replace:=wdReplaceAll
64880 End With

64890 With DDWordDoc.Range.Find
64900     .ClearFormatting
64910     .text = "[24P]"
64920 If Range("CONTROL.Letters!N80").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N80").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
64930     .MatchWholeWord = True
64940     .MatchCase = True
64950     .Forward = True
64960     .Wrap = wdFindStop
64970     .Execute Replace:=wdReplaceAll
64980 End With

64990 With DDWordDoc.Range.Find
65000     .ClearFormatting
65010     .text = "[48P]"
65020 If Range("CONTROL.Letters!N79").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N79").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
65030     .MatchWholeWord = True
65040     .MatchCase = True
65050     .Forward = True
65060     .Wrap = wdFindStop
65070     .Execute Replace:=wdReplaceAll
65080 End With

65090 With DDWordDoc.Range.Find
65100     .ClearFormatting
65110     .text = "[24V]"
65120 If Range("CONTROL.Letters!M80").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M79").Value Else .Replacement.text = "-"
65130     .MatchWholeWord = True
65140     .MatchCase = True
65150     .Forward = True
65160     .Wrap = wdFindStop
65170     .Execute Replace:=wdReplaceAll
65180 End With

65190 With DDWordDoc.Range.Find
65200     .ClearFormatting
65210     .text = "[48V]"
65220 If Range("CONTROL.Letters!M79").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M79").Value Else .Replacement.text = "-"
65230     .MatchWholeWord = True
65240     .MatchCase = True
65250     .Forward = True
65260     .Wrap = wdFindStop
65270     .Execute Replace:=wdReplaceAll
65280 End With

65290 With DDWordDoc.Range.Find
65300     .ClearFormatting
65310     .text = "[24W]"
65320 If Range("CONTROL.Letters!Y80").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y80").Value Else .Replacement.text = "-"
65330     .MatchWholeWord = True
65340     .MatchCase = True
65350     .Forward = True
65360     .Wrap = wdFindStop
65370     .Execute Replace:=wdReplaceAll
65380 End With

65390 With DDWordDoc.Range.Find
65400     .ClearFormatting
65410     .text = "[48W]"
65420 If Range("CONTROL.Letters!Y79").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y79").Value Else .Replacement.text = "-"
65430     .MatchWholeWord = True
65440     .MatchCase = True
65450     .Forward = True
65460     .Wrap = wdFindStop
65470     .Execute Replace:=wdReplaceAll
65480 End With

65490 With DDWordDoc.Range.Find
65500     .ClearFormatting
65510     .text = "[24S]"
65520 If Range("CONTROL.Letters!R80").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R80").Value Else .Replacement.text = "-"
65530     .MatchWholeWord = True
10        .MatchCase = True
20        .Forward = True
30        .Wrap = wdFindStop
40        .Execute Replace:=wdReplaceAll
50    End With

60    With DDWordDoc.Range.Find
70        .ClearFormatting
80        .text = "[48S]"
90    If Range("CONTROL.Letters!R79").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R79").Value Else .Replacement.text = "-"
100       .MatchWholeWord = True
110       .MatchCase = True
120       .Forward = True
130       .Wrap = wdFindStop
140       .Execute Replace:=wdReplaceAll
150   End With

160   With DDWordDoc.Range.Find
170       .ClearFormatting
180       .text = "[TV]"
190   If (Range("CONTROL.Letters!M80").Value + Range("CONTROL.Letters!M79").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M80").Value + Range("CONTROL.Letters!M79").Value) Else .Replacement.text = "-"
200       .MatchWholeWord = True
210       .MatchCase = True
220       .Forward = True
230       .Wrap = wdFindStop
240       .Execute Replace:=wdReplaceAll
250   End With

48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If


      'Save in local hard disk
560       TempFilePath = Environ$("temp") & "\"
570       tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
580       DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
590       DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
600       DDWordDoc.Close

          
      'Attach to existing outlook
610   With OutMail
620       .Attachments.Add TempFilePath & tempfilename & ".pdf"
630   End With
      'Delete the file
640       Set DDWordApp = Nothing
650       Set DDWordDoc = Nothing
660       Kill TempFilePath & tempfilename & ".pdf"
670       Kill TempFilePath & tempfilename & ".doc"
680   Exit Sub
error_proc:
690       If MsgBox("Error has occured with subroutine [RMTLBHV]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
700       ShutDown
End Sub

Sub SOW()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
710   Set DDWordApp = CreateObject("Word.Application")
720   Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/SOW.docx", ReadOnly:=False)

      'Replace
730   With DDWordDoc.Range.Find
740       .ClearFormatting
750       .text = "[CUS]"
760       .Replacement.text = Range("CUS.CustName").Value
770       .MatchWholeWord = True
780       .MatchCase = True
790       .Forward = True
800       .Wrap = wdFindStop
810       .Execute Replace:=wdReplaceAll
820   End With

830   With DDWordDoc.Range.Find
840       .ClearFormatting
850       .text = "[NAME]"
860       .Replacement.text = Range("CONTROL.Letters!S19").Value
870       .MatchWholeWord = True
880       .MatchCase = True
890       .Forward = True
900       .Wrap = wdFindStop
910       .Execute Replace:=wdReplaceAll
920   End With


930   With DDWordDoc.Range.Find
940       .ClearFormatting
950       .text = "[DATE]"
960       .Replacement.text = Format(Now, "dd/mm/yy")
970       .MatchWholeWord = True
980       .MatchCase = True
990       .Forward = True
1000      .Wrap = wdFindStop
1010      .Execute Replace:=wdReplaceAll
1020  End With

1030  With DDWordDoc.Range.Find
1040      .ClearFormatting
1050      .text = "[ORDERID]"
1060      .Replacement.text = Range("CUS.Order").Value
1070      .MatchWholeWord = True
1080      .MatchCase = True
1090      .Forward = True
1100      .Wrap = wdFindStop
1110      .Execute Replace:=wdReplaceAll
1120  End With

1130  With DDWordDoc.Range.Find
1140      .ClearFormatting
1150      .text = "[ACCNUM]"
1160      .Replacement.text = Range("CUS.RMSAPBillingNo").Value
1170      .MatchWholeWord = True
1180      .MatchCase = True
1190      .Forward = True
1200      .Wrap = wdFindStop
1210      .Execute Replace:=wdReplaceAll
1220  End With

1230  With DDWordDoc.Range.Find
1240      .ClearFormatting
1250      .text = "[RM24#]"
1260      .Replacement.text = Range("CONTROL.Letters!K135").Value
1270      .MatchWholeWord = True
1280      .MatchCase = True
1290      .Forward = True
1300      .Wrap = wdFindStop
1310      .Execute Replace:=wdReplaceAll
1320  End With

1330  With DDWordDoc.Range.Find
1340      .ClearFormatting
1350      .text = "[RM48#]"
1360      .Replacement.text = Range("CONTROL.Letters!K136").Value
1370      .MatchWholeWord = True
1380      .MatchCase = True
1390      .Forward = True
1400      .Wrap = wdFindStop
1410      .Execute Replace:=wdReplaceAll
1420  End With

1430  With DDWordDoc.Range.Find
1440      .ClearFormatting
1450      .text = "[ADD1]"
1460      .Replacement.text = Range("LET.Address1").Value
1470      .MatchWholeWord = True
1480      .MatchCase = True
1490      .Forward = True
1500      .Wrap = wdFindStop
1510      .Execute Replace:=wdReplaceAll
1520  End With

1530  With DDWordDoc.Range.Find
1540      .ClearFormatting
1550      .text = "[ADD2]"
1560      .Replacement.text = Range("LET.Address2").Value
1570      .MatchWholeWord = True
1580      .MatchCase = True
1590      .Forward = True
1600      .Wrap = wdFindStop
1610      .Execute Replace:=wdReplaceAll
1620  End With

1630  With DDWordDoc.Range.Find
1640      .ClearFormatting
1650      .text = "[ADD3]"
1660      .Replacement.text = Range("LET.Address3").Value
1670      .MatchWholeWord = True
1680      .MatchCase = True
1690      .Forward = True
1700      .Wrap = wdFindStop
1710      .Execute Replace:=wdReplaceAll
1720  End With

1730  With DDWordDoc.Range.Find
1740      .ClearFormatting
1750      .text = "[ADD4]"
1760      .Replacement.text = Range("LET.Address4").Value
1770      .MatchWholeWord = True
1780      .MatchCase = True
1790      .Forward = True
1800      .Wrap = wdFindStop
1810      .Execute Replace:=wdReplaceAll
1820  End With

1830  With DDWordDoc.Range.Find
1840      .ClearFormatting
1850      .text = "[ADD5]"
1860      .Replacement.text = Range("LET.Address5").Value
1870      .MatchWholeWord = True
1880      .MatchCase = True
1890      .Forward = True
1900      .Wrap = wdFindStop
1910      .Execute Replace:=wdReplaceAll
1920  End With

1930  With DDWordDoc.Range.Find
1940      .ClearFormatting
1950      .text = "[24P]"
1960  If Range("CONTROL.Letters!N73").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N73").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
1970      .MatchWholeWord = True
1980      .MatchCase = True
1990      .Forward = True
2000      .Wrap = wdFindStop
2010      .Execute Replace:=wdReplaceAll
2020  End With

2030  With DDWordDoc.Range.Find
2040      .ClearFormatting
2050      .text = "[48P]"
2060  If Range("CONTROL.Letters!N74").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N74").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
2070      .MatchWholeWord = True
2080      .MatchCase = True
2090      .Forward = True
2100      .Wrap = wdFindStop
2110      .Execute Replace:=wdReplaceAll
2120  End With

2130  With DDWordDoc.Range.Find
2140      .ClearFormatting
2150      .text = "[24V]"
2160  If Range("CONTROL.Letters!M73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M73").Value Else .Replacement.text = "-"
2170      .MatchWholeWord = True
2180      .MatchCase = True
2190      .Forward = True
2200      .Wrap = wdFindStop
2210      .Execute Replace:=wdReplaceAll
2220  End With

2230  With DDWordDoc.Range.Find
2240      .ClearFormatting
2250      .text = "[48V]"
2260  If Range("CONTROL.Letters!M74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M74").Value Else .Replacement.text = "-"
2270      .MatchWholeWord = True
2280      .MatchCase = True
2290      .Forward = True
2300      .Wrap = wdFindStop
2310      .Execute Replace:=wdReplaceAll
2320  End With

2330  With DDWordDoc.Range.Find
2340      .ClearFormatting
2350      .text = "[24W]"
2360  If Range("CONTROL.Letters!Y73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y73").Value Else .Replacement.text = "-"
2370      .MatchWholeWord = True
2380      .MatchCase = True
2390      .Forward = True
2400      .Wrap = wdFindStop
2410      .Execute Replace:=wdReplaceAll
2420  End With

2430  With DDWordDoc.Range.Find
2440      .ClearFormatting
2450      .text = "[48W]"
2460  If Range("CONTROL.Letters!Y74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y74").Value Else .Replacement.text = "-"
2470      .MatchWholeWord = True
2480      .MatchCase = True
2490      .Forward = True
2500      .Wrap = wdFindStop
2510      .Execute Replace:=wdReplaceAll
2520  End With

2530  With DDWordDoc.Range.Find
2540      .ClearFormatting
2550      .text = "[24S]"
2560  If Range("CONTROL.Letters!R73").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R73").Value Else .Replacement.text = "-"
2570      .MatchWholeWord = True
2580      .MatchCase = True
2590      .Forward = True
2600      .Wrap = wdFindStop
2610      .Execute Replace:=wdReplaceAll
2620  End With

2630  With DDWordDoc.Range.Find
2640      .ClearFormatting
2650      .text = "[48S]"
2660  If Range("CONTROL.Letters!R74").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R74").Value Else .Replacement.text = "-"
2670      .MatchWholeWord = True
2680      .MatchCase = True
2690      .Forward = True
2700      .Wrap = wdFindStop
2710      .Execute Replace:=wdReplaceAll
2720  End With

2730  With DDWordDoc.Range.Find
2740      .ClearFormatting
2750      .text = "[TV]"
2760  If (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value + Range("CONTROL.Letters!M77").Value + Range("CONTROL.Letters!M78").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M74").Value + Range("CONTROL.Letters!M73").Value + Range("CONTROL.Letters!M77").Value + Range("CONTROL.Letters!M78").Value) Else .Replacement.text = "-"
2770      .MatchWholeWord = True
2780      .MatchCase = True
2790      .Forward = True
2800      .Wrap = wdFindStop
2810      .Execute Replace:=wdReplaceAll
2820  End With

2830  With DDWordDoc.Range.Find
2840      .ClearFormatting
2850      .text = "[L24P]"
2860  If Range("CONTROL.Letters!N77").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N77").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
2870      .MatchWholeWord = True
2880      .MatchCase = True
2890      .Forward = True
2900      .Wrap = wdFindStop
2910      .Execute Replace:=wdReplaceAll
2920  End With

2930  With DDWordDoc.Range.Find
2940      .ClearFormatting
2950      .text = "[L48P]"
2960  If Range("CONTROL.Letters!N78").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N78").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
2970      .MatchWholeWord = True
2980      .MatchCase = True
2990      .Forward = True
3000      .Wrap = wdFindStop
3010      .Execute Replace:=wdReplaceAll
3020  End With

3030  With DDWordDoc.Range.Find
3040      .ClearFormatting
3050      .text = "[L24V]"
3060  If Range("CONTROL.Letters!M77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M77").Value Else .Replacement.text = "-"
3070      .MatchWholeWord = True
3080      .MatchCase = True
3090      .Forward = True
3100      .Wrap = wdFindStop
3110      .Execute Replace:=wdReplaceAll
3120  End With

3130  With DDWordDoc.Range.Find
3140      .ClearFormatting
3150      .text = "[L48V]"
3160  If Range("CONTROL.Letters!M78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M78").Value Else .Replacement.text = "-"
3170      .MatchWholeWord = True
3180      .MatchCase = True
3190      .Forward = True
3200      .Wrap = wdFindStop
3210      .Execute Replace:=wdReplaceAll
3220  End With

3230  With DDWordDoc.Range.Find
3240      .ClearFormatting
3250      .text = "[L24W]"
3260  If Range("CONTROL.Letters!Y77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y77").Value Else .Replacement.text = "-"
3270      .MatchWholeWord = True
3280      .MatchCase = True
3290      .Forward = True
3300      .Wrap = wdFindStop
3310      .Execute Replace:=wdReplaceAll
3320  End With

3330  With DDWordDoc.Range.Find
3340      .ClearFormatting
3350      .text = "[L48W]"
3360  If Range("CONTROL.Letters!Y78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y78").Value Else .Replacement.text = "-"
3370      .MatchWholeWord = True
3380      .MatchCase = True
3390      .Forward = True
3400      .Wrap = wdFindStop
3410      .Execute Replace:=wdReplaceAll
3420  End With

3430  With DDWordDoc.Range.Find
3440      .ClearFormatting
3450      .text = "[L24S]"
3460  If Range("CONTROL.Letters!R77").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R77").Value Else .Replacement.text = "-"
3470      .MatchWholeWord = True
3480      .MatchCase = True
3490      .Forward = True
3500      .Wrap = wdFindStop
3510      .Execute Replace:=wdReplaceAll
3520  End With

3530  With DDWordDoc.Range.Find
3540      .ClearFormatting
3550      .text = "[L48S]"
3560  If Range("CONTROL.Letters!R78").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R78").Value Else .Replacement.text = "-"
3570      .MatchWholeWord = True
3580      .MatchCase = True
3590      .Forward = True
3600      .Wrap = wdFindStop
3610      .Execute Replace:=wdReplaceAll
3620  End With

3630  With DDWordDoc.Range.Find
3640      .ClearFormatting
3650      .text = "[R24P]"
3660  If Range("CONTROL.Letters!N79").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N79").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
3670      .MatchWholeWord = True
3680      .MatchCase = True
3690      .Forward = True
3700      .Wrap = wdFindStop
3710      .Execute Replace:=wdReplaceAll
3720  End With

3730  With DDWordDoc.Range.Find
3740      .ClearFormatting
3750      .text = "[R48P]"
3760  If Range("CONTROL.Letters!N80").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N80").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
3770      .MatchWholeWord = True
3780      .MatchCase = True
3790      .Forward = True
3800      .Wrap = wdFindStop
3810      .Execute Replace:=wdReplaceAll
3820  End With

3830  With DDWordDoc.Range.Find
3840      .ClearFormatting
3850      .text = "[R24V]"
3860  If Range("CONTROL.Letters!M79").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M79").Value Else .Replacement.text = "-"
3870      .MatchWholeWord = True
3880      .MatchCase = True
3890      .Forward = True
3900      .Wrap = wdFindStop
3910      .Execute Replace:=wdReplaceAll
3920  End With

3930  With DDWordDoc.Range.Find
3940      .ClearFormatting
3950      .text = "[R48V]"
3960  If Range("CONTROL.Letters!M80").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M80").Value Else .Replacement.text = "-"
3970      .MatchWholeWord = True
3980      .MatchCase = True
3990      .Forward = True
4000      .Wrap = wdFindStop
4010      .Execute Replace:=wdReplaceAll
4020  End With

4030  With DDWordDoc.Range.Find
4040      .ClearFormatting
4050      .text = "[R24W]"
4060  If Range("CONTROL.Letters!Y79").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y79").Value Else .Replacement.text = "-"
4070      .MatchWholeWord = True
4080      .MatchCase = True
4090      .Forward = True
4100      .Wrap = wdFindStop
4110      .Execute Replace:=wdReplaceAll
4120  End With

4130  With DDWordDoc.Range.Find
4140      .ClearFormatting
4150      .text = "[R48W]"
4160  If Range("CONTROL.Letters!Y80").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y80").Value Else .Replacement.text = "-"
4170      .MatchWholeWord = True
4180      .MatchCase = True
4190      .Forward = True
4200      .Wrap = wdFindStop
4210      .Execute Replace:=wdReplaceAll
4220  End With

4230  With DDWordDoc.Range.Find
4240      .ClearFormatting
4250      .text = "[R24S]"
4260  If Range("CONTROL.Letters!R79").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R79").Value Else .Replacement.text = "-"
4270      .MatchWholeWord = True
4280      .MatchCase = True
4290      .Forward = True
4300      .Wrap = wdFindStop
4310      .Execute Replace:=wdReplaceAll
4320  End With

4330  With DDWordDoc.Range.Find
4340      .ClearFormatting
4350      .text = "[R48S]"
4360  If Range("CONTROL.Letters!R80").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R80").Value Else .Replacement.text = "-"
4370      .MatchWholeWord = True
4380      .MatchCase = True
4390      .Forward = True
4400      .Wrap = wdFindStop
4410      .Execute Replace:=wdReplaceAll
4420  End With



48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If

      'Save in local hard disk
4730      TempFilePath = Environ$("temp") & "\"
4740      tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
4750      DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
4760      DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
4770      DDWordDoc.Close

          
      'Attach to existing outlook
4780  With OutMail
4790      .Attachments.Add TempFilePath & tempfilename & ".pdf"
4800  End With
      'Delete the file
4810      Set DDWordApp = Nothing
4820      Set DDWordDoc = Nothing
4830      Kill TempFilePath & tempfilename & ".pdf"
4840      Kill TempFilePath & tempfilename & ".doc"
4850  Exit Sub
error_proc:
4860      If MsgBox("Error has occured with subroutine [SOW]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
4870      ShutDown
End Sub

Sub RMTR()

      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
4880  Set DDWordApp = CreateObject("Word.Application")
4890  Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/RMTR18_2.docx", ReadOnly:=False)

      'Replace
4900  With DDWordDoc.Range.Find
4910      .ClearFormatting
4920      .text = "[CUS]"
4930      .Replacement.text = Range("CUS.CustName").Value
4940      .MatchWholeWord = True
4950      .MatchCase = True
4960      .Forward = True
4970      .Wrap = wdFindStop
4980      .Execute Replace:=wdReplaceAll
4990  End With

5000  With DDWordDoc.Range.Find
5010      .ClearFormatting
5020      .text = "[NAME]"
5030      .Replacement.text = Range("CONTROL.Letters!S19").Value
5040      .MatchWholeWord = True
5050      .MatchCase = True
5060      .Forward = True
5070      .Wrap = wdFindStop
5080      .Execute Replace:=wdReplaceAll
5090  End With


5100  With DDWordDoc.Range.Find
5110      .ClearFormatting
5120      .text = "[DATE]"
5130      .Replacement.text = Format(Now, "dd/mm/yy")
5140      .MatchWholeWord = True
5150      .MatchCase = True
5160      .Forward = True
5170      .Wrap = wdFindStop
5180      .Execute Replace:=wdReplaceAll
5190  End With

5200  With DDWordDoc.Range.Find
5210      .ClearFormatting
5220      .text = "[ORDERID]"
5230      .Replacement.text = Range("CUS.Order").Value
5240      .MatchWholeWord = True
5250      .MatchCase = True
5260      .Forward = True
5270      .Wrap = wdFindStop
5280      .Execute Replace:=wdReplaceAll
5290  End With

5300  With DDWordDoc.Range.Find
5310      .ClearFormatting
5320      .text = "[ACCNUM]"
5330      .Replacement.text = Range("CUS.RMSAPBillingNo").Value
5340      .MatchWholeWord = True
5350      .MatchCase = True
5360      .Forward = True
5370      .Wrap = wdFindStop
5380      .Execute Replace:=wdReplaceAll
5390  End With

5400  With DDWordDoc.Range.Find
5410      .ClearFormatting
5420      .text = "[RM24#]"
5430      .Replacement.text = Range("CONTROL.Letters!L83").Value
5440      .MatchWholeWord = True
5450      .MatchCase = True
5460      .Forward = True
5470      .Wrap = wdFindStop
5480      .Execute Replace:=wdReplaceAll
5490  End With

5500  With DDWordDoc.Range.Find
5510      .ClearFormatting
5520      .text = "[RM48#]"
5530      .Replacement.text = Range("CONTROL.Letters!L84").Value
5540      .MatchWholeWord = True
5550      .MatchCase = True
5560      .Forward = True
5570      .Wrap = wdFindStop
5580      .Execute Replace:=wdReplaceAll
5590  End With

5600  With DDWordDoc.Range.Find
5610      .ClearFormatting
5620      .text = "[ADD1]"
5630      .Replacement.text = Range("LET.Address1").Value
5640      .MatchWholeWord = True
5650      .MatchCase = True
5660      .Forward = True
5670      .Wrap = wdFindStop
5680      .Execute Replace:=wdReplaceAll
5690  End With

5700  With DDWordDoc.Range.Find
5710      .ClearFormatting
5720      .text = "[ADD2]"
5730      .Replacement.text = Range("LET.Address2").Value
5740      .MatchWholeWord = True
5750      .MatchCase = True
5760      .Forward = True
5770      .Wrap = wdFindStop
5780      .Execute Replace:=wdReplaceAll
5790  End With

5800  With DDWordDoc.Range.Find
5810      .ClearFormatting
5820      .text = "[ADD3]"
5830      .Replacement.text = Range("LET.Address3").Value
5840      .MatchWholeWord = True
5850      .MatchCase = True
5860      .Forward = True
5870      .Wrap = wdFindStop
5880      .Execute Replace:=wdReplaceAll
5890  End With

5900  With DDWordDoc.Range.Find
5910      .ClearFormatting
5920      .text = "[ADD4]"
5930      .Replacement.text = Range("LET.Address4").Value
5940      .MatchWholeWord = True
5950      .MatchCase = True
5960      .Forward = True
5970      .Wrap = wdFindStop
5980      .Execute Replace:=wdReplaceAll
5990  End With

6000  With DDWordDoc.Range.Find
6010      .ClearFormatting
6020      .text = "[ADD5]"
6030      .Replacement.text = Range("LET.Address5").Value
6040      .MatchWholeWord = True
6050      .MatchCase = True
6060      .Forward = True
6070      .Wrap = wdFindStop
6080      .Execute Replace:=wdReplaceAll
6090  End With

6100  With DDWordDoc.Range.Find
6110      .ClearFormatting
6120      .text = "[R24P]"
6130  If Range("CONTROL.Letters!N83").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N83").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
6140      .MatchWholeWord = True
6150      .MatchCase = True
6160      .Forward = True
6170      .Wrap = wdFindStop
6180      .Execute Replace:=wdReplaceAll
6190  End With

6200  With DDWordDoc.Range.Find
6210      .ClearFormatting
6220      .text = "[R48P]"
6230  If Range("CONTROL.Letters!N84").Value > 0 Then .Replacement.text = Format(Range("CONTROL.Letters!N84").Value, "|fffd|#,##0.00") Else .Replacement.text = "-"
6240      .MatchWholeWord = True
6250      .MatchCase = True
6260      .Forward = True
6270      .Wrap = wdFindStop
6280      .Execute Replace:=wdReplaceAll
6290  End With

6300  With DDWordDoc.Range.Find
6310      .ClearFormatting
6320      .text = "[R24V]"
6330  If Range("CONTROL.Letters!M83").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M83").Value Else .Replacement.text = "-"
6340      .MatchWholeWord = True
6350      .MatchCase = True
6360      .Forward = True
6370      .Wrap = wdFindStop
6380      .Execute Replace:=wdReplaceAll
6390  End With

6400  With DDWordDoc.Range.Find
6410      .ClearFormatting
6420      .text = "[R48V]"
6430  If Range("CONTROL.Letters!M84").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!M84").Value Else .Replacement.text = "-"
6440      .MatchWholeWord = True
6450      .MatchCase = True
6460      .Forward = True
6470      .Wrap = wdFindStop
6480      .Execute Replace:=wdReplaceAll
6490  End With

6500  With DDWordDoc.Range.Find
6510      .ClearFormatting
6520      .text = "[R24W]"
6530  If Range("CONTROL.Letters!Y83").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y83").Value Else .Replacement.text = "-"
6540      .MatchWholeWord = True
6550      .MatchCase = True
6560      .Forward = True
6570      .Wrap = wdFindStop
6580      .Execute Replace:=wdReplaceAll
6590  End With

6600  With DDWordDoc.Range.Find
6610      .ClearFormatting
6620      .text = "[R48W]"
6630  If Range("CONTROL.Letters!Y84").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!Y84").Value Else .Replacement.text = "-"
6640      .MatchWholeWord = True
6650      .MatchCase = True
6660      .Forward = True
6670      .Wrap = wdFindStop
6680      .Execute Replace:=wdReplaceAll
6690  End With

6700  With DDWordDoc.Range.Find
6710      .ClearFormatting
6720      .text = "[R24S]"
6730  If Range("CONTROL.Letters!R83").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R83").Value Else .Replacement.text = "-"
6740      .MatchWholeWord = True
6750      .MatchCase = True
6760      .Forward = True
6770      .Wrap = wdFindStop
6780      .Execute Replace:=wdReplaceAll
6790  End With

6800  With DDWordDoc.Range.Find
6810      .ClearFormatting
6820      .text = "[R48S]"
6830  If Range("CONTROL.Letters!R84").Value > 0 Then .Replacement.text = Range("CONTROL.Letters!R84").Value Else .Replacement.text = "-"
6840      .MatchWholeWord = True
6850      .MatchCase = True
6860      .Forward = True
6870      .Wrap = wdFindStop
6880      .Execute Replace:=wdReplaceAll
6890  End With

6900  With DDWordDoc.Range.Find
6910      .ClearFormatting
6920      .text = "[TV]"
6930  If (Range("CONTROL.Letters!M84").Value + Range("CONTROL.Letters!M83").Value) > 0 Then .Replacement.text = (Range("CONTROL.Letters!M84").Value + Range("CONTROL.Letters!M83").Value) Else .Replacement.text = "-"
6940      .MatchWholeWord = True
6950      .MatchCase = True
6960      .Forward = True
6970      .Wrap = wdFindStop
6980      .Execute Replace:=wdReplaceAll
6990  End With


48761   If Range("FTELetterCheck") Then
48762     With DDWordDoc.Range.Find
48763         .ClearFormatting
48764         .text = "[FTE1]"
48765         .Replacement.text = Range("FTE1Letter").Value
48766         .MatchWholeWord = True
48767         .MatchCase = True
48768         .Forward = True
48769         .Wrap = wdFindStop
48770         .Execute Replace:=wdReplaceAll
48771     End With
    
48772     With DDWordDoc.Range.Find
48773         .ClearFormatting
48774         .text = "[FTE2]"
48775         .Replacement.text = Range("FTE2Letter").Value
48776         .MatchWholeWord = True
48777         .MatchCase = True
48778         .Forward = True
48779         .Wrap = wdFindStop
48780         .Execute Replace:=wdReplaceAll
48781     End With

48782     With DDWordDoc.Range.Find
48783         .ClearFormatting
48784         .text = "[FTE3]"
48785         .Replacement.text = Range("FTE3Letter").Value
48786         .MatchWholeWord = True
48788         .MatchCase = True
48789         .Forward = True
48790         .Wrap = wdFindStop
48791         .Execute Replace:=wdReplaceAll
48792     End With

48793   Else

48794   MsgBox ("The Fall To Earth values for the letter template are ambiguous. Generic values will be inserted into the letter, please check or correct before sending.")

48800     With DDWordDoc.Range.Find
48801         .ClearFormatting
48802         .text = "[FTE1]"
48803         .Replacement.text = "96"
48810         .MatchWholeWord = True
48820         .MatchCase = True
48830         .Forward = True
48840         .Wrap = wdFindStop
48850         .Execute Replace:=wdReplaceAll
48860     End With
    
48870     With DDWordDoc.Range.Find
48880         .ClearFormatting
48890         .text = "[FTE2]"
48900         .Replacement.text = "1"
48910         .MatchWholeWord = True
48920         .MatchCase = True
48930         .Forward = True
48940         .Wrap = wdFindStop
48950         .Execute Replace:=wdReplaceAll
48960     End With
    
48970     With DDWordDoc.Range.Find
48980         .ClearFormatting
48990         .text = "[FTE3]"
49000         .Replacement.text = "3"
49010         .MatchWholeWord = True
49020         .MatchCase = True
49030         .Forward = True
49040         .Wrap = wdFindStop
49050         .Execute Replace:=wdReplaceAll
49060     End With

49061   End If


      'Save in local hard disk
7300      TempFilePath = Environ$("temp") & "\"
7310      tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_RM_24_48_Tracked_" & Format(Now, "dd-mmm-yy h-mm-ss")
7320      DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
7330      DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
7340      DDWordDoc.Close

          
      'Attach to existing outlook
7350  With OutMail
7360      .Attachments.Add TempFilePath & tempfilename & ".pdf"
7370  End With
      'Delete the file
7380      Set DDWordApp = Nothing
7390      Set DDWordDoc = Nothing
7400      Kill TempFilePath & tempfilename & ".pdf"
7410      Kill TempFilePath & tempfilename & ".doc"
7420  Exit Sub
error_proc:
7430      If MsgBox("Error has occured with subroutine [RMTR]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
7440      ShutDown
End Sub

Sub INTCNT()
      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
7450  Set DDWordApp = CreateObject("Word.Application")
7460  Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/INTCNT18.docx", ReadOnly:=False)

      'Replace
7470  With DDWordDoc.Range.Find
7480      .ClearFormatting
7490      .text = "[CUS]"
7500      .Replacement.text = Range("CUS.CustName").Value
7510      .MatchWholeWord = True
7520      .MatchCase = True
7530      .Forward = True
7540      .Wrap = wdFindStop
7550      .Execute Replace:=wdReplaceAll
7560  End With

7570  With DDWordDoc.Range.Find
7580      .ClearFormatting
7590      .text = "[NAME]"
7600      .Replacement.text = Range("CONTROL.Letters!S19").Value
7610      .MatchWholeWord = True
7620      .MatchCase = True
7630      .Forward = True
7640      .Wrap = wdFindStop
7650      .Execute Replace:=wdReplaceAll
7660  End With


7670  With DDWordDoc.Range.Find
7680      .ClearFormatting
7690      .text = "[DATE]"
7700      .Replacement.text = Format(Now, "dd/mm/yy")
7710      .MatchWholeWord = True
7720      .MatchCase = True
7730      .Forward = True
7740      .Wrap = wdFindStop
7750      .Execute Replace:=wdReplaceAll
7760  End With

7770  With DDWordDoc.Range.Find
7780      .ClearFormatting
7790      .text = "[ORDERID]"
7800      .Replacement.text = Range("CUS.Order").Value
7810      .MatchWholeWord = True
7820      .MatchCase = True
7830      .Forward = True
7840      .Wrap = wdFindStop
7850      .Execute Replace:=wdReplaceAll
7860  End With

7870  With DDWordDoc.Range.Find
7880      .ClearFormatting
7890      .text = "[ACCNUM]"
7900      .Replacement.text = Range("CUS.RMSAPBillingNo").Value
7910      .MatchWholeWord = True
7920      .MatchCase = True
7930      .Forward = True
7940      .Wrap = wdFindStop
7950      .Execute Replace:=wdReplaceAll
7960  End With

7970  With DDWordDoc.Range.Find
7980      .ClearFormatting
7990      .text = "[ADD1]"
8000      .Replacement.text = Range("LET.Address1").Value
8010      .MatchWholeWord = True
8020      .MatchCase = True
8030      .Forward = True
8040      .Wrap = wdFindStop
8050      .Execute Replace:=wdReplaceAll
8060  End With

8070  With DDWordDoc.Range.Find
8080      .ClearFormatting
8090      .text = "[ADD2]"
8100      .Replacement.text = Range("LET.Address2").Value
8110      .MatchWholeWord = True
8120      .MatchCase = True
8130      .Forward = True
8140      .Wrap = wdFindStop
8150      .Execute Replace:=wdReplaceAll
8160  End With

8170  With DDWordDoc.Range.Find
8180      .ClearFormatting
8190      .text = "[ADD3]"
8200      .Replacement.text = Range("LET.Address3").Value
8210      .MatchWholeWord = True
8220      .MatchCase = True
8230      .Forward = True
8240      .Wrap = wdFindStop
8250      .Execute Replace:=wdReplaceAll
8260  End With

8270  With DDWordDoc.Range.Find
8280      .ClearFormatting
8290      .text = "[ADD4]"
8300      .Replacement.text = Range("LET.Address4").Value
8310      .MatchWholeWord = True
8320      .MatchCase = True
8330      .Forward = True
8340      .Wrap = wdFindStop
8350      .Execute Replace:=wdReplaceAll
8360  End With

8370  With DDWordDoc.Range.Find
8380      .ClearFormatting
8390      .text = "[ADD5]"
8400      .Replacement.text = Range("LET.Address5").Value
8410      .MatchWholeWord = True
8420      .MatchCase = True
8430      .Forward = True
8440      .Wrap = wdFindStop
8450      .Execute Replace:=wdReplaceAll
8460  End With

8470  With DDWordDoc.Range.Find
8480      .ClearFormatting
8490      .text = "[C#]"
8500      .Replacement.text = Range("Int.Contract").Value
8510      .MatchWholeWord = True
8520      .MatchCase = True
8530      .Forward = True
8540      .Wrap = wdFindStop
8550      .Execute Replace:=wdReplaceAll
8560  End With

8570  With DDWordDoc.Range.Find
8580      .ClearFormatting
8590      .text = "[D]"
8600      .Replacement.text = Range("Discount").Value
8610      .MatchWholeWord = True
8620      .MatchCase = True
8630      .Forward = True
8640      .Wrap = wdFindStop
8650      .Execute Replace:=wdReplaceAll
8660  End With

8670  With DDWordDoc.Range.Find
8680      .ClearFormatting
8690      .text = "[Tier]"
8700      .Replacement.text = Range("Int.Tier").Value
8710      .MatchWholeWord = True
8720      .MatchCase = True
8730      .Forward = True
8740      .Wrap = wdFindStop
8750      .Execute Replace:=wdReplaceAll
8760  End With



      'Save in local hard disk
8770      TempFilePath = Environ$("temp") & "\"
8780      tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_Int_Country_" & Format(Now, "dd-mmm-yy h-mm-ss")
8790      DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
8800      DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
8801      DDWordDoc.Close

          
      'Attach to existing outlook
8802  With OutMail
8803      .Attachments.Add TempFilePath & tempfilename & ".pdf"
8804  End With
      'Delete the file
8805      Set DDWordApp = Nothing
8806      Set DDWordDoc = Nothing
8807      Kill TempFilePath & tempfilename & ".pdf"
8808      Kill TempFilePath & tempfilename & ".doc"
8809  Exit Sub
error_proc:
8810      If MsgBox("Error has occured with subroutine [INTCNT18]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
8811      ShutDown

End Sub

Sub INTRT()
      Dim DDWordApp As Object
      Dim DDWordDoc As Object
      Dim wdFindStop As Integer
      Const wdReplaceAll = 2
      Dim TempFilePath As String
      Dim tempfilename As String
      ''on error GoTo error_proc
      'Download and create word document
8820  Set DDWordApp = CreateObject("Word.Application")
8821  Set DDWordDoc = DDWordApp.Documents.Open("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/DSQ_Resources/INTTR18.docx", ReadOnly:=False)

      'Replace
8822  With DDWordDoc.Range.Find
8823      .ClearFormatting
8824      .text = "[CUS]"
8825      .Replacement.text = Range("CUS.CustName").Value
8826      .MatchWholeWord = True
8827      .MatchCase = True
8828      .Forward = True
8829      .Wrap = wdFindStop
8830      .Execute Replace:=wdReplaceAll
8831  End With

8832  With DDWordDoc.Range.Find
8833      .ClearFormatting
8834      .text = "[NAME]"
8835      .Replacement.text = Range("CONTROL.Letters!S19").Value
8836      .MatchWholeWord = True
8837      .MatchCase = True
8838      .Forward = True
8839      .Wrap = wdFindStop
8840      .Execute Replace:=wdReplaceAll
8841  End With


8850  With DDWordDoc.Range.Find
8851      .ClearFormatting
8852      .text = "[DATE]"
8853      .Replacement.text = Format(Now, "dd/mm/yy")
8854      .MatchWholeWord = True
8855      .MatchCase = True
8856      .Forward = True
8857      .Wrap = wdFindStop
8858      .Execute Replace:=wdReplaceAll
8859  End With

8860  With DDWordDoc.Range.Find
8861      .ClearFormatting
8862      .text = "[ORDERID]"
8863      .Replacement.text = Range("CUS.Order").Value
8864      .MatchWholeWord = True
8865      .MatchCase = True
8866      .Forward = True
8867      .Wrap = wdFindStop
8868      .Execute Replace:=wdReplaceAll
8869  End With

8870  With DDWordDoc.Range.Find
8871      .ClearFormatting
8872      .text = "[ACCNUM]"
8873      .Replacement.text = Range("CUS.RMSAPBillingNo").Value
8874      .MatchWholeWord = True
8875      .MatchCase = True
8876      .Forward = True
8877      .Wrap = wdFindStop
8878      .Execute Replace:=wdReplaceAll
8879  End With

8880  With DDWordDoc.Range.Find
8881      .ClearFormatting
8882      .text = "[ADD1]"
8883      .Replacement.text = Range("LET.Address1").Value
8884      .MatchWholeWord = True
8885      .MatchCase = True
8886      .Forward = True
8887      .Wrap = wdFindStop
8888      .Execute Replace:=wdReplaceAll
8889  End With
  
8890  With DDWordDoc.Range.Find
8891      .ClearFormatting
8892      .text = "[ADD2]"
8893      .Replacement.text = Range("LET.Address2").Value
8894      .MatchWholeWord = True
8895      .MatchCase = True
8896      .Forward = True
8897      .Wrap = wdFindStop
8898      .Execute Replace:=wdReplaceAll
8899  End With

8900  With DDWordDoc.Range.Find
8901      .ClearFormatting
8902      .text = "[ADD3]"
8903      .Replacement.text = Range("LET.Address3").Value
8904      .MatchWholeWord = True
8905      .MatchCase = True
8906      .Forward = True
8907      .Wrap = wdFindStop
8908      .Execute Replace:=wdReplaceAll
8909  End With

8910  With DDWordDoc.Range.Find
8911      .ClearFormatting
8912      .text = "[ADD4]"
8913      .Replacement.text = Range("LET.Address4").Value
8914      .MatchWholeWord = True
8915      .MatchCase = True
8916      .Forward = True
8917      .Wrap = wdFindStop
8918      .Execute Replace:=wdReplaceAll
8919  End With

8920  With DDWordDoc.Range.Find
8921      .ClearFormatting
8922      .text = "[ADD5]"
8923      .Replacement.text = Range("LET.Address5").Value
8924      .MatchWholeWord = True
8925      .MatchCase = True
8926      .Forward = True
8927      .Wrap = wdFindStop
8928      .Execute Replace:=wdReplaceAll
8929  End With

8930  With DDWordDoc.Range.Find
8931      .ClearFormatting
8932      .text = "[C#]"
8933      .Replacement.text = Range("Int.TrContract").Value
8934      .MatchWholeWord = True
8935      .MatchCase = True
8936      .Forward = True
8937      .Wrap = wdFindStop
8938      .Execute Replace:=wdReplaceAll
8939  End With

8940  With DDWordDoc.Range.Find
8941      .ClearFormatting
8942      .text = "[Frequency]"
8943       If Range("Int.Frequency").Value <> "" Then .Replacement.text = "Returns will be sent back to you, as agreed, on a '" & Range("Int.Frequency").Value & "' basis." Else .Replacement.text = ""
8944      .MatchWholeWord = True
8945      .MatchCase = True
8946      .Forward = True
8947      .Wrap = wdFindStop
8948      .Execute Replace:=wdReplaceAll
8949  End With


      'Save in local hard disk
8990      TempFilePath = Environ$("temp") & "\"
8991      tempfilename = AlphaNumericOnly(Range("CUS.CustName").Value) & "_Int_Tracked_Returns_" & Format(Now, "dd-mmm-yy h-mm-ss")
8992      DDWordDoc.SaveAs TempFilePath & tempfilename & ".doc"
8993      DDWordDoc.ExportAsFixedFormat OutputFileName:=TempFilePath & tempfilename & ".pdf", ExportFormat:=17, OpenAfterExport:=False, OptimizeFor:=0, Range:=0, From:=1, To:=1, _
      Item:=0, IncludeDocProps:=True, KeepIRM:=True, _
      CreateBookmarks:=0, DocStructureTags:=True, _
      BitmapMissingFonts:=True, UseISO19005_1:=False
8994      DDWordDoc.Close

          
      'Attach to existing outlook
8995  With OutMail
8996      .Attachments.Add TempFilePath & tempfilename & ".pdf"
8997  End With
      'Delete the file
8998      Set DDWordApp = Nothing
8999      Set DDWordDoc = Nothing
9000      Kill TempFilePath & tempfilename & ".pdf"
9001      Kill TempFilePath & tempfilename & ".doc"
9002  Exit Sub
error_proc:
9003      If MsgBox("Error has occured with subroutine [INTTR]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
9004      ShutDown

End Sub



Attribute VB_Name = "SPExpImp"
Sub ImportSP()
18180 On Error GoTo Error1
18181 If Not Form.Range("CHK.Salesperson") Then Exit Sub
18190 SPSave1.Range("SAL.Import1").ClearContents
18200 SPSave1.Range("SAL.Import2").ClearContents
18210 SPSave1.Range("SAL.Import3").ClearContents
18220 UpdateVCheckSP
18230 ActiveWorkbook.Connections("SPSave1").Refresh
18240 Form.Range("SAL.ContactName").Value = SPSave1.Range("SAL.Import1").Value
18250 Form.Range("SAL.ContactPhone").Value = SPSave1.Range("SAL.Import2").Value
18260 Form.Range("SAL.ContactEmail").Value = SPSave1.Range("SAL.Import3").Value
18270 Exit Sub
Error1:
18280 If MsgBox("Unable to Import, please contact your administator, James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Sub SaveSPDetails()
18290 On Error GoTo Error1

18300 Application.DisplayAlerts = False
18310 Application.ScreenUpdating = False

18320 ThisWorkbook.Sheets("SalesDetails").Visible = xlSheetVisible
18330 ThisWorkbook.Sheets("SalesDetails").Copy
18340 ActiveWorkbook.SaveAs filename:=Environ$("temp") & "\SPSave.csv", FileFormat:=xlCSV, CreateBackup:=False
18350 ActiveWorkbook.Close SaveChanges:=False
18360 ThisWorkbook.Sheets("SalesDetails").Visible = xlSheetHidden

18370 Application.DisplayAlerts = True
18380 Application.ScreenUpdating = True
18390 Exit Sub
Error1:
18400 If MsgBox("Unable to Save, please contact your administator, James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Sub SaveInt()
      Dim R1 As Boolean
      Dim R2 As Boolean
      Dim R3 As Boolean

18410 On Error GoTo Error1
18420 If ThisWorkbook.Sheets("IntPrc2").Range("IntR1").Value = "NOT PRESENT" Then R1 = True Else R1 = False
18430 If ThisWorkbook.Sheets("IntPrc2").Range("IntR2").Value = "NOT PRESENT" Then R2 = True Else R2 = False
18440 If ThisWorkbook.Sheets("IntPrc2").Range("IntR3").Value = "NOT PRESENT" Then R3 = True Else R3 = False

      'Application.DisplayAlerts = False
      'Application.ScreenUpdating = False

18450 ThisWorkbook.Sheets("IntPrc1").Visible = xlSheetVisible
18460 ThisWorkbook.Sheets("IntPrc1").Copy
18470 ActiveWorkbook.SaveAs filename:=Environ$("temp") & "\IntPrc1.csv", FileFormat:=xlCSV, CreateBackup:=False
18480 ActiveWorkbook.Close SaveChanges:=False
18490 ThisWorkbook.Sheets("IntPrc1").Visible = xlSheetHidden

18500 ThisWorkbook.Sheets("IntPrc2").Visible = xlSheetVisible
18510 ThisWorkbook.Sheets("IntPrc2").Copy
18520 If R1 Then ActiveWorkbook.Sheets("IntPrc2").Rows("2:2").Delete
18530 If R2 Then ActiveWorkbook.Sheets("IntPrc2").Rows("3:3").Delete
18540 If R3 Then ActiveWorkbook.Sheets("IntPrc2").Rows("4:4").Delete
18550 ActiveWorkbook.SaveAs filename:=Environ$("temp") & "\MP7 MP9 MTE ZSDI - 507 - 96 99.csv", FileFormat:=xlCSV, CreateBackup:=False
18560 ActiveWorkbook.Close SaveChanges:=False
18570 ThisWorkbook.Sheets("IntPrc2").Visible = xlSheetHidden

      'Application.DisplayAlerts = True
      'Application.ScreenUpdating = True
18580 Exit Sub
Error1:
18590 If MsgBox("Unable to Save international pricing details, please contact your administator, James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Sub UpdateVCheckSP()
18600     On Error GoTo Error1
18610     With Selection.QueryTable
18620         .Connection = "TEXT;file:///" & Replace(Environ$("temp"), "\", "/") & "/SPSave.csv"
18630         .TextFilePlatform = 437
18640         .TextFileStartRow = 1
18650         .TextFileParseType = xlDelimited
18661         .TextFileTextQualifier = xlTextQualifierDoubleQuote
18670         .TextFileConsecutiveDelimiter = False
18680         .TextFileTabDelimiter = False
18690         .TextFileSemicolonDelimiter = False
18700         .TextFileCommaDelimiter = True
18710         .TextFileSpaceDelimiter = False
18720         .TextFileColumnDataTypes = Array(2, 2, 1, 1, 1, 1, 1)
18730         .TextFileTrailingMinusNumbers = True
18740         .Refresh BackgroundQuery:=False
18750     End With
18760 Exit Sub
Error1:
18770     On Error GoTo 0
End Sub

Sub ExportCSTcsv()
18780 On Error GoTo Error1

18790 Application.DisplayAlerts = False
18800 Application.ScreenUpdating = False

18810 ThisWorkbook.Sheets("CSTOut").Visible = xlSheetVisible
18820 ThisWorkbook.Sheets("CSTOut").Copy
18830 With ActiveWorkbook.Sheets("CSTOut")
18840     Cells.Select
18850     Selection.Copy
18860     Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
              :=False, Transpose:=False
18870     Selection.Replace What:="0", Replacement:="", LookAt:=xlWhole, _
              SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
              ReplaceFormat:=False
18880 End With
18890 ThisWorkbook.Sheets("CSTOut").Visible = xlSheetHidden
18900 ThisWorkbook.Activate

18910 Application.DisplayAlerts = True
18920 Application.ScreenUpdating = True
18930 Exit Sub
Error1:
18940 If MsgBox("Unable to create export, please contact your administator, James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Attribute VB_Name = "SPSave"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "SPSave1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "SendEmails"
Sub SEND_FOR_API_SETUP()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
8920  Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
8930  On Error GoTo error_proc
8940  If Val(Application.Version) >= 12 Then
8950          If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
8960              MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
8970              Exit Sub
8980          End If
8990      End If
9000      With Application
9010          .ScreenUpdating = False
9020          .EnableEvents = False
9030      End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
9040      TempFilePath = Environ$("temp") & "\"
9050      tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
9060      FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

9070      wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
9080      Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user

9090  ActiveWorkbook.Sheets("Form").Range("CHK.CustomerSolutions").Value = True
9100  Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox38_Click")
9110  Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
9120  Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
9130  ActiveWorkbook.Save
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
9140      Set OutApp = CreateObject("Outlook.Application")
9150      Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
9160      strbody = "<font face=arial>NEW SETUP REQUEST FORM:<br><br>Dear Customer Solutions Team,<br><br>Please find attached a  setup request for " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
                     & ".<br><br>PLN: " & Form.Range("CUS.Posting.LocationNo") & "<br><br>" _
                     & ".<br><br>Kind Regards,<br><br>" _
                     & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
          
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
9170      With OutMail
9171        If Form.Range("SHP.SolutionReq").Value = "International Shipping" Or Form.Range("SHP.SolutionReq").Value = "Intersoft iShipper" Then
9172                .To = "shippingsupport@royalmail.com"
9173            ElseIf Form.Range("SHP.SolutionReq").Value = "3PI-API Shipping" Or Form.Range("SHP.SolutionReq").Value = "Pro Shipping" Then
9174                .To = "shippingsupport@royalmail.com"
9175            Else
9176                .To = "customersolutionsteam@royalmail.com"
9177        End If
9190          If Form.Range("SHP.SolutionReq").Value = "API Shipping" Then .cc = "shippingsupport@royalmail.com; " & Form.Range("SAL.ContactEmail").Value Else .cc = Form.Range("SAL.ContactEmail").Value
9200          .BCC = ""
9210           .Subject = "[Confidential] NEW: " & ThisWorkbook.Sheets("Form").Range("SHP.SolutionReq").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
9220          .HTMLbody = strbody
9230          .Attachments.Add ActiveWorkbook.FullName
9260  wb2.Close SaveChanges:=False
9240          .DISPLAY
9250      End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
9270      Kill TempFilePath & tempfilename & FileExtStr

9280      Set OutMail = Nothing
9290      Set OutApp = Nothing

9300      With Application
9310          .ScreenUpdating = True
9320          .EnableEvents = True
9330      End With
9340  Exit Sub
error_proc:
9350      If MsgBox("Error has occured with subroutine [SEND_FOR_API_SETUP]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
9360      ShutDown

End Sub
Sub SEND_FOR_CREDIT_CHECK()

      'Check if all required fills are filled
      Dim c As Range
      Dim rng As Range
      Dim agency As Boolean
      Dim agency7 As Boolean

9370  On Error GoTo error_proc
9380  Set rng = ThisWorkbook.Sheets("Form").Range("Emails.Credit.Check")
9390  For Each c In rng
9400      If c.Value = True Or IsEmpty(c.Value) Or Cells(c.Row, c.Column - 2).Value = 0 Then GoTo Skip
9410          MsgBox "Please fill in all required fields."
9420          ActiveSheet.Range(c.address).Activate
9430          Exit Sub
Skip:
9440  Next

9441        agency = False
9442        agency7 = False
9443        If Dir("C:\program files\7-Zip\7z.exe") = "" Then
9444            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency = True Else agency = False
9445        Else
9446            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency7 = True Else agency7 = False
9447        End If

      'Start macro if no error

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
      Dim FileNameZip As Variant
      Dim oApp As Object
      Dim attach1 As String
9450  Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
9460  If Val(Application.Version) >= 12 Then
9470          If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
9480              MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
9490              Exit Sub
9500          End If
9510      End If
9520      With Application
9530          .ScreenUpdating = False
9540          .EnableEvents = False
9550      End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
9560      TempFilePath = Environ$("temp") & "\"
9570      tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
9580      FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

9590      wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
9600      Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user

9610  ActiveWorkbook.Sheets("Form").Range("CHK.CMC").Value = True
9620  Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox36_Click")
9630  Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
9640  Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
9650  ActiveWorkbook.Save


13651 If agency Then
13652     FileNameZip = Environ$("temp") & "\" & tempfilename & ".zip"
13653     NewZip (FileNameZip)
13654     Set oApp = CreateObject("Shell.Application")
13655     oApp.Namespace(FileNameZip).CopyHere ActiveWorkbook.FullName
13656     On Error Resume Next
13657     Do Until oApp.Namespace(FileNameZip).items.Count = 1
13658     Application.Wait (Now + TimeValue("0:00:01"))
13659     Loop
13660     On Error GoTo error_proc
13661     attach1 = FileNameZip
13662 Else
13663     If agency7 Then
13664  wb2.Close SaveChanges:=False
13665       FileNameZip = Environ$("temp") & "\7ZIP" & tempfilename & ".zip"
13666       E_Zip_ActiveWorkbook (tempfilename)
'13666       Application.Wait (Now + TimeValue("0:00:05"))
13667       attach1 = FileNameZip
13668     Else
13669       attach1 = ActiveWorkbook.FullName
13670     End If
13771 End If


        
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
9660      Set OutApp = CreateObject("Outlook.Application")
9670      Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
9680      strbody = "<font face=arial>FAO the Credit Management Centre" _
          & "<br><br>" & ThisWorkbook.Sheets("CONTROL").Range("c73").Value _
          & "<br><br><b>Application Summary<br><br>First Posting date:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C71").Value _
          & "<br><b>Company Type:  </B>" & ThisWorkbook.Sheets("Form").Range("CUS.CustNature").Value _
          & "<br><b>Company Name:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B14").Value _
          & "<br><b>Company Registration Number:  </B>" & ThisWorkbook.Sheets("Form").Range("CUS.CompanyRegNo").Value _
          & "<br><b>Trading Address:   </B>" & ThisWorkbook.Sheets("Form").Range("CUS.Address1").Value & ", " & ThisWorkbook.Sheets("Form").Range("CUS.Postcode").Value _
          & "<br><br><b>CREDIT REQUIRED:   </B>" & ThisWorkbook.Sheets("Form").Range("CRE.CreditRequired").Value _
          & "<br><br><b>Sole trader / partnerships information only<br><br><b>Proprietor full name (as would appear on their passport):   </B>" & ThisWorkbook.Sheets("Form").Range("SOT.Title").Value & " " & ThisWorkbook.Sheets("Form").Range("SOT.FirstName").Value & " " & ThisWorkbook.Sheets("Form").Range("SOT.LastName").Value _
          & "<br><b>Proprietor home address:  </B>" & ThisWorkbook.Sheets("Form").Range("SOT.Address1").Value & ", " & ThisWorkbook.Sheets("Form").Range("SOT.Postcode").Value _
          & "<br><b>Proprietor date of birth:  </B>" & ThisWorkbook.Sheets("Form").Range("SOT.Address1").Value _
          & "<br><br>I confirm that all the required fields have been completed in the attached form and all necessary information has been supplied to support this application." _
          & "<br><br>Many Thanks<br><br>" _
          & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
9690      With OutMail
9700          .To = "credit.referencing@royalmail.com"
9710          .cc = ""
9720          .BCC = ""
9730          .Subject = "[Confidential] " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
9740          .HTMLbody = strbody
9750          .Attachments.Add attach1
9780           If Not agency7 Then wb2.Close SaveChanges:=False
9760          .DISPLAY
9770      End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
9790      Kill TempFilePath & tempfilename & FileExtStr
14101     If agency Then Kill FileNameZip
14102     If agency7 Then Kill FileNameZip

9800      Set OutMail = Nothing
9810      Set OutApp = Nothing
9811      Set oApp = Nothing

9820      With Application
9830          .ScreenUpdating = True
9840          .EnableEvents = True
9850      End With
9860  Exit Sub
error_proc:
9870      If MsgBox("Error has occured with subroutine [SEND_FOR_CREDIT_CHECK]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
9880      ShutDown
End Sub
Sub COLLECTIONS_EMAIL_SEND()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object

9890  On Error GoTo error_proc

9900  Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
9910  If Val(Application.Version) >= 12 Then
9920          If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
9930              MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
9940              Exit Sub
9950          End If
9960      End If
9970      With Application
9980          .ScreenUpdating = False
9990          .EnableEvents = False
10000     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
10010 ActiveWorkbook.Sheets("Form").Range("CHK.CollectionSetUp").Value = True
10020 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox39_Click")
10030 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
10040 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
10050 ActiveWorkbook.Save

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
10060     TempFilePath = Environ$("temp") & "\"
10070     tempfilename = "Collections Schedule - " & ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(Now, "dd-mmm-yy")
10080     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

10090     Set wb2 = Workbooks.Add
10100     wb1.Sheets("Collection Schedule").Copy Before:=wb2.Sheets(1)
10110     Application.DisplayAlerts = False
10120     wb2.Sheets("Sheet1").Delete
10130     On Error Resume Next
10140     wb2.Sheets("Sheet2").Delete
10150     wb2.Sheets("Sheet3").Delete
10160     On Error GoTo error_proc
10170     Application.DisplayAlerts = True
10180     If FileExtStr = ".xlsb" Then
10190         wb2.SaveAs TempFilePath & tempfilename & FileExtStr, FileFormat:=XlFileFormat.xlExcel12
10200     Else
10210         wb2.SaveAs TempFilePath & tempfilename & FileExtStr, FileFormat:=XlFileFormat.xlOpenXMLWorkbookMacroEnabled
10220     End If

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
10230     Set OutApp = CreateObject("Outlook.Application")
10240     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
10250     strbody = "<font face=arial>Attached is a new Collection request for " & Range("CUS.AccountName") & ". Please update the attached schedule in the allocated section with the FIR code, confirmed start date & collection time. The updated schedule should be returned within <b><Font color=""red"">48 Hours</b></font> to this email address." _
          & "<br>This request is part of a new customer setup and the expected first posting date is the same as the requested Collection start date." _
          & "<br>The customer is aware that the requested Collection time is not guaranteed (unless the service stated is a Timed Collection). " _
          & "<br><br>Regards,<br><br>" _
          & "Customer On-Boarding Team" _
          & "<br>Royal Mail"
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
10260     With OutMail
10270         .To = ""
10280         .cc = ""
10290         .BCC = ""
10300         .Subject = "[Confidential] Collection Schedule for " & Range("CUS.AccountName") & " (" & Range("CUS.TopAccount") & ") for Opportunity " & Range("CUS.Opportunity") & " and SR " & Range("SST.SiebelNo") & " Postcode " & Range("COL.CollectionPostcode") & " FIR# " & Range("Barcode_FIR")
10310         .HTMLbody = strbody
10320         .Attachments.Add ActiveWorkbook.FullName
10350 wb2.Close SaveChanges:=False
10330         .DISPLAY
10340     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
10360     Kill TempFilePath & tempfilename & FileExtStr

10370     Set OutMail = Nothing
10380     Set OutApp = Nothing

10390     With Application
10400         .ScreenUpdating = True
10410         .EnableEvents = True
10420     End With
10430 Exit Sub
error_proc:
10440     If MsgBox("Error has occured with subroutine [COLLECTIONS_EMAIL_SEND]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
10450     ShutDown

End Sub
Sub SEND_FOR_ACCOUNT_SETUP_CST()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
10460 On Error GoTo error_proc
10470 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
10480 If Val(Application.Version) >= 12 Then
10490         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
10500             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
10510             Exit Sub
10520         End If
10530     End If
10540     With Application
10550         .ScreenUpdating = False
10560         .EnableEvents = False
10570     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
10580     TempFilePath = Environ$("temp") & "\"
10590     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
10600     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

10610     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
10620     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
10630 ActiveWorkbook.Sheets("Form").Range("CHK.CustomerSolutions").Value = True
10640 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox38_Click")
10650 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
10660 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
10670 ActiveWorkbook.Save

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
10680     Set OutApp = CreateObject("Outlook.Application")
10690     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
10700     strbody = "<font face=arial>NEW SETUP REQUEST FORM:<br><br>Dear Customer Solutions Team,<br><br>Please find attached a setup request for " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
                     & ".<br><br>Kind Regards,<br><br>" _
                     & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
          
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
10710     With OutMail
10721        If Form.Range("SHP.SolutionReq").Value = "International Shipping" Then
10722                .To = "shippingsupport@royalmail.com"
10723            ElseIf Form.Range("SHP.SolutionReq").Value = "3PI-API Shipping" Or Form.Range("SHP.SolutionReq").Value = "Pro Shipping" Then
10724               .To = "shippingsupport@royalmail.com"
10725            Else
10726                .To = "customersolutionsteam@royalmail.com"
10727        End If
10730         If Form.Range("SHP.SolutionReq").Value = "API Shipping" Then .cc = "customersolutionsteam@royalmail.com" Else .cc = ""
10740         .BCC = ""
10750         .Subject = "[Confidential] NEW: " & ThisWorkbook.Sheets("Form").Range("SHP.SolutionReq").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
10760         .HTMLbody = strbody
10770         .Attachments.Add ActiveWorkbook.FullName
10800 wb2.Close SaveChanges:=False
10780         .DISPLAY
10790     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
10810     Kill TempFilePath & tempfilename & FileExtStr

10820     Set OutMail = Nothing
10830     Set OutApp = Nothing

10840     With Application
10850         .ScreenUpdating = True
10860         .EnableEvents = True
10870     End With
10880 Exit Sub
error_proc:
10890     If MsgBox("Error has occured with subroutine [SEND_FOR_ACCOUNT_SETUP_CST]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
10900     ShutDown

End Sub

Sub SEND_FOR_ACCOUNT_SETUP_DMO()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
10910 On Error GoTo error_proc
10920 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
10930 If Val(Application.Version) >= 12 Then
10940         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
10950             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
10960             Exit Sub
10970         End If
10980     End If
10990     With Application
11000         .ScreenUpdating = False
11010         .EnableEvents = False
11020     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
11030     TempFilePath = Environ$("temp") & "\"
11040     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
11050     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

11060     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
11070     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
11080 ActiveWorkbook.Sheets("Form").Range("CHK.CustomerSolutions").Value = True
11090 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox38_Click")
11100 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
11110 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
11120 ActiveWorkbook.Save

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
11130     Set OutApp = CreateObject("Outlook.Application")
11140     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
11150     strbody = "<font face=arial>NEW SETUP REQUEST FORM:<br><br>Dear Team,<br><br>Please find attached a DMO setup request for " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
                     & ".<br><br>Kind Regards,<br><br>" _
                     & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
          
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
11160     With OutMail
11170         .To = "barcodes.on.all.parcels@royalmail.com"
11180         .cc = ""
11190         .BCC = ""
11200         .Subject = "[Confidential] NEW: " & ThisWorkbook.Sheets("Form").Range("SHP.SolutionReq").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
11210         .HTMLbody = strbody
11220         .Attachments.Add ActiveWorkbook.FullName
11250 wb2.Close SaveChanges:=False
11230         .DISPLAY
11240     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
11260     Kill TempFilePath & tempfilename & FileExtStr

11270     Set OutMail = Nothing
11280     Set OutApp = Nothing

11290     With Application
11300         .ScreenUpdating = True
11310         .EnableEvents = True
11320     End With
11330 Exit Sub
error_proc:
11340     If MsgBox("Error has occured with subroutine [SEND_FOR_ACCOUNT_SETUP_CST]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
11350     ShutDown

End Sub
Sub SEND_FOR_FINANCE_ACCOUNT_SETUP()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
      Dim TR As Boolean
      Dim TR1 As String
      Dim IT As Boolean
      Dim IT1 As String
      Dim D2D As Boolean
      Dim TR2 As Boolean
11360 On Error GoTo error_proc
11370 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
11380 If Val(Application.Version) >= 12 Then
11390         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
11400             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
11410             Exit Sub
11420         End If
11430     End If
11440     With Application
11450         .ScreenUpdating = False
11460         .EnableEvents = False
11470     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
11480     TempFilePath = Environ$("temp") & "\"
11490     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
11500     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

11510     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
11520     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
11530     With Application
          '    .ScreenUpdating = True
11540         .EnableEvents = True
11550     End With

11561     ActiveWorkbook.Sheets("Form").Range("CHK.Finance").Hyperlinks(1).Follow

'11570 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox42_Click")
      'ActiveWorkbook.Sheets("Form").Range("CHK.SettingUp").Value = True
      'Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox37_Click")
      'Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
      'Application.Run ("'" & ActiveWorkbook.Name & "'!BeforeSave")
12020 ActiveWorkbook.Save


11580     With Application
       '       .ScreenUpdating = False
11590         .EnableEvents = False
11600     End With
          
11601 If Range("Chk.D2DSales") = True Then D2D = True Else D2D = False
11602 If Range("Chk.D2DSalesAddOn") = True Then D2D = True
          
11610 If Range("Tracked") = True Then TR = True Else TR = False
11620 If Range("Letters.Req.Int") = True Then IT = True Else IT = False
11630 If TR Then TR1 = ", Inland Tracked Pricing Tier: " & ThisWorkbook.Sheets("T1 Import").Range("B44").Value Else TR1 = ""
11631 If Range("LBT1Check") = True And ThisWorkbook.Sheets("Form").Range("CHK.AccountAddOn").Value = True Then TR2 = True Else TR2 = False
11632 If TR2 Then TR1 = TR1 & " - Note: Tier 1 Letterboxable New Customer checks required"
11640 If IT Then
11650         If ThisWorkbook.Sheets("CONTROL.Letters").Range("Discount").Value = 0 Then
11660             IT1 = ", International Country Pricing Tier: 2A"
11670             Else
11680             IT1 = ", International Country Pricing Tier: 2B"
11690         End If
11700     Else
11710     IT1 = ""
11720 End If
          
          
'11730 ActiveWorkbook.Save
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
11740     Set OutApp = CreateObject("Outlook.Application")
11750     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
11760     strbody = "<font face=arial>Dear Customer Account Setup Team,<br><br>Please find attached the above-mentioned request form for " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
                     & ".<br><br>Kind Regards,<br><br>" _
                     & Application.Username _
                     & "<br><br>Royal Mail"
          
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
11770     With OutMail
11780         If D2D Then .To = "D2Dsetup@royalmail.com" Else .To = "account.setup.team@royalmail.com"
11790         .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
11800         .BCC = ""
11810             If ThisWorkbook.Sheets("Form").Range("CHK.NewCustomerSetup").Value = True Then
11820                 .Subject = "[Confidential] NEW - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
11821             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.D2DSales").Value = True Then
11822                 .Subject = "[Confidential] NEW - Customer (D2D): " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
11830             ElseIf ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value = "Pre-Pay" Then
11840                 .Subject = "[Confidential] PREPAID - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
11850             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.BMASetup").Value = True Then
11860                 .Subject = "[Confidential] FRANKING - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value
11870             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.NewAccountExistingCust").Value = True Then
11880                 If Not IsEmpty(ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value) Then
11890                     .Subject = "[Confidential] NEW ACCOUNT - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                          ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                          ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                          ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                          ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                          ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                          TR1 & IT1
11900                 Else
11910                     .Subject = "[Confidential] NEW ACCOUNT - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                          ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                          ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                          ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                          ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                          TR1 & IT1
11920                 End If
11930             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.AccountAddOn").Value = True Then
11940                 .Subject = "[Confidential] ADD ON - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Account Number: " & ThisWorkbook.Sheets("Form").Range("CUS.RMSAPBillingNo").Value & _
                      TR1 & IT1
11941             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.D2DSalesAddOn").Value = True Then
11942                 .Subject = "[Confidential] ADD ON - Customer (D2D): " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Account Number: " & ThisWorkbook.Sheets("Form").Range("CUS.RMSAPBillingNo").Value & _
                      TR1 & IT1
11950             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.DMOorOBA").Value = True Then
11960                 .Subject = "[Confidential] NEW DMO USER - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value
11970             End If
11971          If Form.Range("Priority") Then .Subject = "PRIORITY - " & .Subject
11980         .HTMLbody = strbody
11990         .Attachments.Add ActiveWorkbook.FullName
12021     wb2.Close SaveChanges:=False
12000         .DISPLAY
12010     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
12030     Kill TempFilePath & tempfilename & FileExtStr

12040     Set OutMail = Nothing
12050     Set OutApp = Nothing

12060     With Application
12070         .ScreenUpdating = True
12080         .EnableEvents = True
12090     End With
12100 Exit Sub
error_proc:
12110     If MsgBox("Error has occured with subroutine [SEND_FOR_FINANCE_ACCOUNT_SETUP]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12120     ShutDown

End Sub
Sub SEND_FOR_OPERATIONS_ASSESSMENT()

      'Check if all required fills are filled
      Dim c As Range
      Dim rng As Range
12130 On Error GoTo error_proc
12140 Set rng = ThisWorkbook.Sheets("Form").Range("Emails.COL.Check")
12150 For Each c In rng
12160     If c.Value = True Or IsEmpty(c.Value) Or Cells(c.Row, c.Column - 2).Value = 0 Then GoTo Skip
12170         MsgBox "Please fill in all required fields."
12180         ActiveSheet.Range(c.address).Activate
12190         Exit Sub
Skip:
12200 Next
12210     If Range("Email.ProductCheck") = False Then
12220         MsgBox "Please fill in all required fields."
12230         Range("Email.ProductCheck").Activate
12240         Exit Sub
12250     End If

      'Start macro if no error
      Dim wb1 As Workbook
      Dim TempPDFPath As String
      Dim TempPDFName As String
      Dim PDFFullPath As String
      Dim OutApp As Object
      Dim OutMail As Object
12260 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
12270 If Val(Application.Version) >= 12 Then
12280         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
12290             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
12300             Exit Sub
12310         End If
12320     End If
12330     With Application
12340         .ScreenUpdating = False
12350         .EnableEvents = False
12360     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
12370 ActiveWorkbook.Sheets("Form").Range("CHK.Operations").Value = True
12380 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox40_Click")
12390 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
      'ActiveWorkbook.Save
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Save as PDF
12400 TempPDFPath = Environ$("temp") & "\"
12410 TempPDFName = AlphaNumericOnly(ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value) & "-" & ActiveSheet.name & "-" & Format(Now, "dd-mmm-yy h-mm-ss") & ".pdf"
12420 PDFFullPath = TempPDFPath & TempPDFName
12430 Sheets("Form").Activate

12440 If IsEmpty(Range("PRO.Product.9").Value) Then
12450     Range("Print.OpsView2").EntireRow.PageBreak = xlPageBreakManual
12460 ElseIf IsEmpty(Range("PRO.Product.21").Value) Then
12470     Range("Print.OpsView").EntireRow.PageBreak = xlPageBreakManual
12480 End If

12490     With ActiveSheet
12500         .ExportAsFixedFormat _
              Type:=xlTypePDF, _
              filename:=PDFFullPath, _
              Quality:=xlQualityStandard, _
              IncludeDocProperties:=True, _
              IgnorePrintAreas:=False, _
              OpenAfterPublish:=True
12510     End With
          
12520 ActiveSheet.ResetAllPageBreaks
12530 ActiveSheet.DisplayPageBreaks = False
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
12540    Set OutApp = CreateObject("Outlook.Application")
12550    Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
12560     strbody = "<font face=arial>Dear Operations Capacity Team,<br><br>Please find attached an Operations assessment request for " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
                     & ".<br><br>Kind Regards,<br><br>" _
                     & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
          
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
12570    With OutMail
12580         .To = "capacity.management@royalmail.com"
12590         .cc = ""
12600         .BCC = ""
12610         .Subject = "[Confidential] " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
12620         .HTMLbody = strbody
12630         .Attachments.Add PDFFullPath
12640         .DISPLAY
12650     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Delete the file
12660     Kill PDFFullPath
          
      'Return to Sales view
12670     ActiveWorkbook.Sheets("Form").Range("CHK.Salesperson").Value = True
12680     Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox35_Click")
12690     Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")

12700     Set OutMail = Nothing
12710     Set OutApp = Nothing

12720     With Application
12730         .ScreenUpdating = True
12740         .EnableEvents = True
12750     End With
12760 Exit Sub
error_proc:
12770     If MsgBox("Error has occured with subroutine [SEND_FOR_OPS_ASSESSMENT]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
12780     ShutDown
End Sub
Sub SEND_FOR_SPECIAL_PRICING()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
12790 On Error GoTo error_proc
12800 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
12810 If Val(Application.Version) >= 12 Then
12820         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
12830             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
12840             Exit Sub
12850         End If
12860     End If
12870     With Application
12880         .ScreenUpdating = False
12890         .EnableEvents = False
12900     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
12910     TempFilePath = Environ$("temp") & "\"
12920     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
12930     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

12940     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
12950     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
12960 ActiveWorkbook.Sheets("Form").Range("CHK.SpecialPricing").Value = True
12970 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox41_Click")
12980 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
12990 Application.Run ("'" & ActiveWorkbook.name & "'!subSpecialPricing")
13000 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
13010 ActiveWorkbook.Save

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
13020      Set OutApp = CreateObject("Outlook.Application")
13030      Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'NO EMAIL BODY TEXT
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
13040      With OutMail
13050          If Form.Range("CHK.NewCustomerSetup") Or Form.Range("CHK.NewAccountExistingCust") Then .To = "newsetups@royalmail.com" Else .To = "special.pricing.team@royalmail.com"
13060          .cc = ""
13070          .BCC = ""
13080          .Subject = "[Confidential] " & ThisWorkbook.Sheets("Form").Range("SHP.SolutionReq").Value & ", " & _
                           ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
13090          .Attachments.Add ActiveWorkbook.FullName
13120 wb2.Close SaveChanges:=False
13100          .DISPLAY
13110      End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
13130     Kill TempFilePath & tempfilename & FileExtStr

13140      Set OutMail = Nothing
13150      Set OutApp = Nothing

13160     With Application
13170         .ScreenUpdating = True
13180         .EnableEvents = True
13190     End With
13200 Exit Sub
error_proc:
13210     If MsgBox("Error has occured with subroutine [SEND_FOR_SPECIAL_PRICING]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
13220     ShutDown

End Sub
Sub SUS_EMAIL_SEND()

      'Check if all required fills are filled
      Dim c As Range
      Dim rng As Range
      Dim ccsales As Boolean
      Dim ccdg As Boolean
      Dim agency As Boolean
      Dim agency7 As Boolean
      Dim cc As String
13230 On Error GoTo error_proc

13240 ccdg = False
13250 If Sheets("Form").Range("CHK.CMC") = True Then ccsales = True Else ccsales = False
13260 If Sheets("CONTROL").Range("PRO.UNO") = True Then ccdg = True
13270 If Sheets("CONTROL").Range("PRO.UNP") = True Then ccdg = True

13280 Set rng = ThisWorkbook.Sheets("Form").Range("Emails.AccountSetup.Check1")
13290 For Each c In rng
13300     If c.Value = True Or IsEmpty(c.Value) Or Cells(c.Row, c.Column - 2).Value = 0 Then GoTo Skip1
13310         MsgBox "Please fill in all required fields."
13320         ActiveSheet.Range(c.address).Activate
13330         Exit Sub
Skip1:
13340 Next

13350 Set rng = ThisWorkbook.Sheets("Form").Range("Emails.AccountSetup.Check2")
13360 For Each c In rng
13370     If c.Value = True Or IsEmpty(c.Value) Or Cells(c.Row, c.Column - 2).Value = 0 Then GoTo Skip2
13380         MsgBox "Please fill in all required fields."
13390         ActiveSheet.Range(c.address).Activate
13400         Exit Sub
Skip2:
13410 Next

13411 If Range("AddressedCheck") Then If MsgBox("Please ensure your customer has agreed to the Partially Addressed Retail Trial Terms and Conditions before proceeding with onboarding." & vbNewLine & vbNewLine & "Do you wish to continue?", vbYesNo, "Partially Addrssed Trial Terms Check") = vbNo Then Exit Sub

      'Start macro if no error
13420 If Form.Range("SHP.TrackLabels").Value = "Tracked Returns Portal" Then
13430     MsgBox "Please attach customer image/logo for Tracked Returns Portal to email before sending"
13440 End If

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
      Dim TCDate As String
      Dim TR As Boolean
      Dim TR1 As String
      Dim IT As Boolean
      Dim IT1 As String
      Dim IT2 As String
      Dim AI As String
      Dim FileNameZip As Variant
      Dim oApp As Object
      Dim attach1 As String

9441        agency = False
9442        agency7 = False
9443        If Dir("C:\program files\7-Zip\7z.exe") = "" Then
9444            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency = True Else agency = False
9445        Else
9446            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency7 = True Else agency7 = False
9447        End If

13450 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
13460 If Val(Application.Version) >= 12 Then
13470         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
13480             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
13490             Exit Sub
13500         End If
13510     End If
13520     With Application
13530         .ScreenUpdating = False
13540         .EnableEvents = False
13550     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
13560     TempFilePath = Environ$("temp") & "\"
13570     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
13580 FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

13590     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
13600     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
13610 ActiveWorkbook.Sheets("Form").Range("CHK.SettingUp").Value = True
13620 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox37_Click")
13630 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
13640 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
13650 ActiveWorkbook.Save

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
13651 If agency Then
13652     FileNameZip = Environ$("temp") & "\" & tempfilename & ".zip"
13653     NewZip (FileNameZip)
13654     Set oApp = CreateObject("Shell.Application")
13655     oApp.Namespace(FileNameZip).CopyHere ActiveWorkbook.FullName
13656     On Error Resume Next
13657     Do Until oApp.Namespace(FileNameZip).items.Count = 1
13658     Application.Wait (Now + TimeValue("0:00:01"))
13659     Loop
13660     On Error GoTo error_proc
13661     attach1 = FileNameZip
13662 Else
13663     If agency7 Then
13664       wb2.Close SaveChanges:=False
13665       FileNameZip = Environ$("temp") & "\7ZIP" & tempfilename & ".zip"
13666       E_Zip_ActiveWorkbook (tempfilename)
'13666       Application.Wait (Now + TimeValue("0:00:05"))
13667       attach1 = FileNameZip
13668     Else
13669       attach1 = ActiveWorkbook.FullName
13670     End If
13771 End If
      
13772     Set OutApp = CreateObject("Outlook.Application")
13773     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
13680 If Form.Range("SST.TCDate") Then
13690     TCDate = ("<br><b>T&Cs sent to customer on: </B><font color=red>" & ThisWorkbook.Sheets("Form").Range("SST.TCDate").Value & "</font>")
13700     Else
13710     TCDate = ""
13720 End If

13730 If Range("Tracked") = True Then TR = True Else TR = False
13740 If TR Then TR1 = "<br><b>Inland Tracked Pricing Tier (If applicable):  </B><font color=red>" & ThisWorkbook.Sheets("T1 Import").Range("B44").Value & "</font>" Else TR1 = ""
13750 If Range("Letters.Req.Int") = True Then IT = True Else IT = False
13760 If IT Then
13770     IT1 = "<br><b>Discount (International Country Pricing Only):  </B>" & ThisWorkbook.Sheets("CONTROL.Letters").Range("Discount").Value & "% discount on all products and destinations"
13780     If ThisWorkbook.Sheets("CONTROL.Letters").Range("Discount").Value = 0 Then IT2 = "<br><b>International Country Pricing Tier:  </B><font color=red> 2A </font>" Else IT2 = "<br><b>International Country Pricing Tier:  </B><font color=red> 2B </font>"
13790     Else
13800     IT1 = ""
13810     IT2 = ""
13820 End If

13821 If Form.Range("ADD.Information").Value <> "" Then AI = "<br><b>Additional Information/Comments:  </B>" & Form.Range("ADD.Information").Value Else AI = ""
          

      'EMAIL BODY TEXT
13830     strbody = "<font face=arial>FAO CE Onboarding Team" _
          & "<br><br>" & ThisWorkbook.Sheets("CONTROL").Range("c73").Value _
          & "<br><br><b>Application Summary<br><br>First Posting date:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C71").Value _
          & "<br><b>Date/Time application submitted:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B74").Value _
          & "<br><b>Calendar Days left until first posting date (approx):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C74").Value _
          & "<br><b>Legal Entity Number (if applicable):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B75").Value _
          & "<br><b>Is there an existing Shipping Solution?:  </B>" & Range("SHP.Existing").Value _
          & "<br><b>Which shipping solution is required:  </B>" & Range("Emails.SHPSol").Value _
          & "<br><b>Is DMO Required:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("Emails.COL.DMOReq").Value _
          & "<br><b>Is a Collection Set-up Required:</b> " & Range("Emails.ColSetUp").Value _
          & "<br><b>Would the cust be interested in Tracked Returns Portal access?:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("B78").Value _
          & "<br><b>Number of Product Items in Application:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B76").Value _
          & "<br><b>Product Code Summary:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("b77").Value _
          & "<br><b>Payment Method (If applicable):  </B>" & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value _
          & TR1 _
          & IT1 _
          & IT2 _
          & TCDate _
          & "<br><b>Contact ID:  </B>" & ThisWorkbook.Sheets("Form").Range("CUS.ContactID").Value _
          & "<br><b>Form Version:  </B>" & ThisWorkbook.Sheets("Form").Range("Form.Version").Value _
          & AI _
          & "<br><br>I confirm that all the required fields have been completed in the attached form and all necessary information has been supplied to support this application." _
          & "<br><br>Many Thanks<br>" _
          & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
13840     With OutMail
13850         .To = "setting.up.services@royalmail.com"
              
13860         If Sheets("Form").Range("CHK.MM") = True Then
13870             If ccsales Then
13880                 If ccdg Then cc = Sheets("Form").Range("SAL.ContactEmail") & "; mailmark@royalmail.com" & "; danny.gates@royalmail.com" Else cc = Sheets("Form").Range("SAL.ContactEmail") & "; mailmark@royalmail.com"
13890             Else
13900                 If ccdg Then cc = "mailmark@royalmail.com" & "; danny.gates@royalmail.com" Else cc = "mailmark@royalmail.com"
13910             End If
13920         Else
13930             If ccsales = True Then
13940                 If ccdg Then cc = Sheets("Form").Range("SAL.ContactEmail") & "; danny.gates@royalmail.com" Else cc = Sheets("Form").Range("SAL.ContactEmail")
13950             Else
13960                 If ccdg Then cc = "danny.gates@royalmail.com" Else cc = ""
13970             End If
13980         End If
13981         If Range("AddressedCheck") Then cc = "shaun.roberts@marketreach.co.uk; " & cc
13982         .cc = cc
13990         .BCC = ""
14000         If ccdg Then
14010             .Subject = "ADVANCED LOCAL AUTHORISATION - " & ThisWorkbook.Sheets("CONTROL").Range("B72").Value & ThisWorkbook.Sheets("CONTROL").Range("C71").Value
14020         Else
14030             .Subject = ThisWorkbook.Sheets("CONTROL").Range("B72").Value & ThisWorkbook.Sheets("CONTROL").Range("C71").Value
14040         End If
14050         .HTMLbody = strbody
14060         .Attachments.Add attach1
14061         If Not agency7 Then wb2.Close SaveChanges:=False
14070         .DISPLAY
14080     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
14100     Kill TempFilePath & tempfilename & FileExtStr
14101     If agency Then Kill FileNameZip
14102     If agency7 Then Kill FileNameZip

14110     Set OutMail = Nothing
14120     Set OutApp = Nothing
9811      Set oApp = Nothing


14130     With Application
14140         .ScreenUpdating = True
14150         .EnableEvents = True
14160     End With
14170 Exit Sub
error_proc:
14180     If MsgBox("Error has occured with subroutine [SUS_EMAIL_SEND]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14190     ShutDown
End Sub
Sub SUS_FINANCE()


      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
      Dim ToAddress As String
      Dim Tracked As Boolean
      Dim IT As Boolean
      Dim IT1 As String
      Dim D2D As Boolean
      Dim AnyLetter As Boolean
      Dim TR1 As String
      Dim TR2 As Boolean
      Dim cc As String
14200 On Error GoTo error_proc
14210 Set wb1 = ActiveWorkbook


      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14220 If Val(Application.Version) >= 12 Then
14230         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
14240             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
14250             Exit Sub
14260         End If
14270     End If
14280     With Application
14290         .ScreenUpdating = False
14300         .EnableEvents = False
14310     End With
          
14311 If Range("Chk.D2DSales") = True Then D2D = True Else D2D = False
14312 If Range("Chk.D2DSalesAddOn") = True Then D2D = True

14320 If Range("Letters.Req.Int") = True Then IT = True Else IT = False
14330 If Range("Tracked") = True Then Tracked = True Else Tracked = False
14331 If Range("AnyLetter") = True Then AnyLetter = True Else AnyLetter = False
14340 If IT Then IT1 = "<br><b>Discount (International Country Pricing Only):  </B>" & ThisWorkbook.Sheets("CONTROL.Letters").Range("Discount").Value & "% discount on all products and destinations" Else IT1 = ""
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14350     TempFilePath = Environ$("temp") & "\"
14360     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
14370     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

14380     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
14390     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
14400 SaveInt
14410 ActiveWorkbook.Sheets("Form").Range("CHK.SettingUp").Value = True
14420 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox37_Click")
14430 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
14440 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
14450 ActiveWorkbook.Save

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14451 If Range("LBT1Check") = True And ThisWorkbook.Sheets("Form").Range("CHK.AccountAddOn").Value = True Then TR2 = True Else TR2 = False
14452 If TR2 Then TR1 = "<br><b>Note:  </B>" & "Tier 1 Letterboxable New Customer checks required" Else TR1 = ""

14460 '    If ThisWorkbook.Sheets("Form").Range("SST.SiebelCreat").Value <> "" Then
14461 '              If D2D Then ToAddress = "doortodoor@royalmail.com; " And ThisWorkbook.Sheets("Form").Range("SST.SiebelCreat").Value Else ToAddress = ThisWorkbook.Sheets("Form").Range("SST.SiebelCreat").Value
14662 '           Else
14663               If D2D Then
14664                   If Range("CHK.NewAccountExistingCust") Or Range("CHK.NewAccountExistingCust") Or Range("CHK.AccountAddOn") Then ToAddress = "settingupservices@royalmail.com; doortodoor@royalmail.com" Else ToAddress = "doortodoor@royalmail.com"
14665               Else
14666                   ToAddress = "setting.up.services@royalmail.com"
14667               End If
14668 '           End If
14470     Set OutApp = CreateObject("Outlook.Application")
14480     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
      
14481 If D2D Then
14482   strbody = "<font face=arial>FAO D2D Onboarding Team" _
          & "<br><br>We have set up " _
          & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
          & "'s account on SAP." _
          & "<br><br><b>Application Summary<br><br>First Posting date:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C71").Value _
          & "<br><b>Date/Time application submitted:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B74").Value _
          & "<br><b>Calendar Days left until first posting date (approx):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C74").Value _
          & "<br><b>Legal Entity Number (if applicable):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B75").Value _
          & "<br><b>Which shipping solution is required:  </B>" & Range("Emails.SHPSol").Value _
          & "<br><b>Is DMO Required:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("Emails.COL.DMOReq").Value _
          & "<br><b>Is a Collection Set-up Required:</B> " & Range("Emails.ColSetUp").Value _
          & "<br><b>Would the cust be interested in Tracked Returns Portal access?:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("B78").Value _
          & "<br><b>Number of Product Items in Application:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B76").Value _
          & "<br><b>Product Code Summary:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("b77").Value _
          & "<br><b>Payment Method:  </B>" & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value _
          & IT1 _
          & TR1 _
          & "<br><br>I confirm that all the required fields have been completed in the attached form and all necessary information has been supplied to support this application." _
          & "<br><br>Many Thanks<br><br>Customer Account Setup Team"
14483 Else
14490   strbody = "<font face=arial>FAO CE Onboarding Team" _
          & "<br><br>We have set up " _
          & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
          & "'s account on SAP." _
          & "<br><br><b>Application Summary<br><br>First Posting date:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C71").Value _
          & "<br><b>Date/Time application submitted:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B74").Value _
          & "<br><b>Calendar Days left until first posting date (approx):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C74").Value _
          & "<br><b>Legal Entity Number (if applicable):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B75").Value _
          & "<br><b>Which shipping solution is required:  </B>" & Range("Emails.SHPSol").Value _
          & "<br><b>Is DMO Required:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("Emails.COL.DMOReq").Value _
          & "<br><b>Is a Collection Set-up Required:</B> " & Range("Emails.ColSetUp").Value _
          & "<br><b>Would the cust be interested in Tracked Returns Portal access?:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("B78").Value _
          & "<br><b>Number of Product Items in Application:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B76").Value _
          & "<br><b>Product Code Summary:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("b77").Value _
          & "<br><b>Payment Method (If applicable):  </B>" & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value _
          & IT1 _
          & TR1 _
          & "<br><br>I confirm that all the required fields have been completed in the attached form and all necessary information has been supplied to support this application." _
          & "<br><br>Many Thanks<br><br>Customer Account Setup Team"
14491 End If
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
14500     With OutMail
14510         .To = ToAddress
14520         If IT Then
14530             cc = "Specialist.Billing.Pricing@royalmail.com; newsetups@royalmail.com; internationalpricing@royalmail.com; SPTInternational@royalmail.com; "
14531             If Tracked Then cc = cc & "; rfeetrackedsetup@royalmail.com; "
14540         ElseIf Tracked Then
14541             cc = "rfeetrackedsetup@royalmail.com; newsetups@royalmail.com; "
14550         ElseIf AnyLetter Then
14551             cc = "newsetups@royalmail.com; "
14552         Else
14553             cc = ""
14554         End If
14555         cc = cc & "Account.Setup.Team@royalmail.com; "
14556         If Sheet2.Range("COPY_PREPAID").Value = True Then cc = cc & "prepaid.accounts@royalmail.com; "
14557         .cc = cc

14570         .BCC = ""
'14580         .Subject = ThisWorkbook.Sheets("CONTROL").Range("B72").Value & ThisWorkbook.Sheets("CONTROL").Range("C71").Value

14571             If ThisWorkbook.Sheets("Form").Range("CHK.NewCustomerSetup").Value = True Then
14572                 .Subject = "[Confidential] NEW - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
14573             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.D2DSales").Value = True Then
14574                 .Subject = "[Confidential] NEW - Customer (D2D): " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
14575             ElseIf ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value = "Pre-Pay" Then
14576                 .Subject = "[Confidential] PREPAID - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
14577             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.BMASetup").Value = True Then
14578                 .Subject = "[Confidential] FRANKING - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value
14579             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.NewAccountExistingCust").Value = True Then
14580                 If Not IsEmpty(ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value) Then
14581                     .Subject = "[Confidential] NEW ACCOUNT - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                          ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                          ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                          ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                          ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                          ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                          TR1 & IT1
14582                 Else
14583                     .Subject = "[Confidential] NEW ACCOUNT - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                          ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                          ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                          ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                          ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                          TR1 & IT1
14584                 End If
14585             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.AccountAddOn").Value = True Then
14586                 .Subject = "[Confidential] ADD ON - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Account Number: " & ThisWorkbook.Sheets("Form").Range("CUS.RMSAPBillingNo").Value & _
                      TR1 & IT1
14587             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.D2DSalesAddOn").Value = True Then
14588                 .Subject = "[Confidential] ADD ON - Customer (D2D): " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Account Number: " & ThisWorkbook.Sheets("Form").Range("CUS.RMSAPBillingNo").Value & _
                      TR1 & IT1
14589             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.DMOorOBA").Value = True Then
14590                 .Subject = "[Confidential] NEW DMO USER - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value
14591             End If

14592         If Form.Range("Priority") Then .Subject = "PRIORITY - " & .Subject
14593         .HTMLbody = strbody
14600         .Attachments.Add ActiveWorkbook.FullName
14610         If IT Then .Attachments.Add Environ$("temp") & "\IntPrc1.csv"
14620         If IT Then .Attachments.Add Environ$("temp") & "\MP7 MP9 MTE ZSDI - 507 - 96 99.csv"
14650 wb2.Close SaveChanges:=False
14630         .DISPLAY
14640     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
14660     Kill TempFilePath & tempfilename & FileExtStr
14670     Kill Environ$("temp") & "\IntPrc1.csv"
14680     Kill Environ$("temp") & "\MP7 MP9 MTE ZSDI - 507 - 96 99.csv"

14690     Set OutMail = Nothing
14700     Set OutApp = Nothing

14710     With Application
14720         .ScreenUpdating = True
14730         .EnableEvents = True
14740     End With
14750 Exit Sub
error_proc:
14760     If MsgBox("Error has occured with subroutine [SUS_FINANCE]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14770     ShutDown
End Sub

Sub SUS_SALES()


      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
      Dim ToAddress As String
      Dim Tracked As Boolean
      Dim IT As Boolean
      Dim IT1 As String
      Dim D2D As Boolean
      Dim AnyLetter As Boolean
      Dim TR1 As String
      Dim TR2 As Boolean
      Dim cc As String
14200 On Error GoTo error_proc
14210 Set wb1 = ActiveWorkbook


      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14220 If Val(Application.Version) >= 12 Then
14230         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
14240             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
14250             Exit Sub
14260         End If
14270     End If
14280     With Application
14290         .ScreenUpdating = False
14300         .EnableEvents = False
14310     End With
          
14311 If Range("Chk.D2DSales") = True Then D2D = True Else D2D = False
14312 If Range("Chk.D2DSalesAddOn") = True Then D2D = True

14320 If Range("Letters.Req.Int") = True Then IT = True Else IT = False
14330 If Range("Tracked") = True Then Tracked = True Else Tracked = False
14331 If Range("AnyLetter") = True Then AnyLetter = True Else AnyLetter = False
14340 If IT Then IT1 = "<br><b>Discount (International Country Pricing Only):  </B>" & ThisWorkbook.Sheets("CONTROL.Letters").Range("Discount").Value & "% discount on all products and destinations" Else IT1 = ""
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14350     TempFilePath = Environ$("temp") & "\"
14360     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
14370     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

14380     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
14390     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
14400 SaveInt
14410 ActiveWorkbook.Sheets("Form").Range("CHK.SettingUp").Value = True
14420 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox37_Click")
14430 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
14440 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
14450 ActiveWorkbook.Save

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14451 If Range("LBT1Check") = True And ThisWorkbook.Sheets("Form").Range("CHK.AccountAddOn").Value = True Then TR2 = True Else TR2 = False
14452 If TR2 Then TR1 = "<br><b>Note:  </B>" & "Tier 1 Letterboxable New Customer checks required" Else TR1 = ""

14460 '    If ThisWorkbook.Sheets("Form").Range("SST.SiebelCreat").Value <> "" Then
14461 '              If D2D Then ToAddress = "doortodoor@royalmail.com; " And ThisWorkbook.Sheets("Form").Range("SST.SiebelCreat").Value Else ToAddress = ThisWorkbook.Sheets("Form").Range("SST.SiebelCreat").Value
14662 '           Else
14663               If D2D Then
14664                   If Range("CHK.NewAccountExistingCust") Or Range("CHK.NewAccountExistingCust") Or Range("CHK.AccountAddOn") Then ToAddress = "settingupservices@royalmail.com; doortodoor@royalmail.com" Else ToAddress = "doortodoor@royalmail.com"
14665               Else
14666                   ToAddress = "account.setup.team@royalmail.com"
14667               End If
14668 '           End If
14470     Set OutApp = CreateObject("Outlook.Application")
14480     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
      
14481 If D2D Then
14482   strbody = "<font face=arial>AWAITING DDM MANDATE" _
          & "<br><br>We have intially set up " _
          & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
          & "'s account on SAP, but we are waiting on the customer to complete/return the DDM mandate before the account/service can be made live." _
          & "<br><br><b>Application Summary<br><br>First Posting date:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C71").Value _
          & "<br><b>Date/Time application submitted:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B74").Value _
          & "<br><b>Calendar Days left until first posting date (approx):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C74").Value _
          & "<br><b>Legal Entity Number (if applicable):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B75").Value _
          & "<br><b>Which shipping solution is required:  </B>" & Range("Emails.SHPSol").Value _
          & "<br><b>Is DMO Required:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("Emails.COL.DMOReq").Value _
          & "<br><b>Is a Collection Set-up Required:</B> " & Range("Emails.ColSetUp").Value _
          & "<br><b>Would the cust be interested in Tracked Returns Portal access?:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("B78").Value _
          & "<br><b>Number of Product Items in Application:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B76").Value _
          & "<br><b>Product Code Summary:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("b77").Value _
          & "<br><b>Payment Method:  </B>" & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value _
          & IT1 _
          & TR1 _
          & "<br><br>I confirm that all the required fields have been completed in the attached form and all necessary information has been supplied to support this application." _
          & "<br><br>Many Thanks<br><br>Customer Account Setup Team"
14483 Else
14490   strbody = "<font face=arial>AWAITING DDM MANDATE" _
          & "<br><br>We have intially set up " _
          & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
          & "'s account on SAP, but we are waiting on the customer to complete/return the DDM mandate before the account/service can be made live." _
          & "<br><br><b>Application Summary<br><br>First Posting date:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C71").Value _
          & "<br><b>Date/Time application submitted:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B74").Value _
          & "<br><b>Calendar Days left until first posting date (approx):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C74").Value _
          & "<br><b>Legal Entity Number (if applicable):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B75").Value _
          & "<br><b>Which shipping solution is required:  </B>" & Range("Emails.SHPSol").Value _
          & "<br><b>Is DMO Required:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("Emails.COL.DMOReq").Value _
          & "<br><b>Is a Collection Set-up Required:</B> " & Range("Emails.ColSetUp").Value _
          & "<br><b>Would the cust be interested in Tracked Returns Portal access?:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("B78").Value _
          & "<br><b>Number of Product Items in Application:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B76").Value _
          & "<br><b>Product Code Summary:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("b77").Value _
          & "<br><b>Payment Method (If applicable):  </B>" & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value _
          & IT1 _
          & TR1 _
          & "<br><br>I confirm that all the required fields have been completed in the attached form and all necessary information has been supplied to support this application." _
          & "<br><br>Many Thanks<br><br>Customer Account Setup Team"
14491 End If
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
14500     With OutMail
14510         .To = ToAddress
14511         .cc = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
14570         .BCC = ""
'14580         .Subject = ThisWorkbook.Sheets("CONTROL").Range("B72").Value & ThisWorkbook.Sheets("CONTROL").Range("C71").Value

14571             If ThisWorkbook.Sheets("Form").Range("CHK.NewCustomerSetup").Value = True Then
14572                 .Subject = "AWAITING DDM MANDATE [Confidential] NEW - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
14573             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.D2DSales").Value = True Then
14574                 .Subject = "AWAITING DDM MANDATE [Confidential] NEW - Customer (D2D): " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
14575             ElseIf ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value = "Pre-Pay" Then
14576                 .Subject = "AWAITING DDM MANDATE [Confidential] PREPAID - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                      ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                      TR1 & IT1
14577             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.BMASetup").Value = True Then
14578                 .Subject = "AWAITING DDM MANDATE [Confidential] FRANKING - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value
14579             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.NewAccountExistingCust").Value = True Then
14580                 If Not IsEmpty(ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value) Then
14581                     .Subject = "AWAITING DDM MANDATE [Confidential] NEW ACCOUNT - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                          ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                          ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                          ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                          ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                          ", Credit Reference: " & ThisWorkbook.Sheets("Form").Range("CMC.CreditRef").Value & _
                          TR1 & IT1
14582                 Else
14583                     .Subject = "AWAITING DDM MANDATE [Confidential] NEW ACCOUNT - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                          ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                          ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                          ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                          ", Legal Entity" & ThisWorkbook.Sheets("Form").Range("CUS.RMLegalEntityNo").Value & _
                          TR1 & IT1
14584                 End If
14585             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.AccountAddOn").Value = True Then
14586                 .Subject = "AWAITING DDM MANDATE [Confidential] ADD ON - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Account Number: " & ThisWorkbook.Sheets("Form").Range("CUS.RMSAPBillingNo").Value & _
                      TR1 & IT1
14587             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.D2DSalesAddOn").Value = True Then
14588                 .Subject = "AWAITING DDM MANDATE [Confidential] ADD ON - Customer (D2D): " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & _
                      ", Payment Method: " & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value & _
                      ", Siebel Order: " & ThisWorkbook.Sheets("Form").Range("CUS.Order").Value & _
                      ", Sign-Up Status: " & ThisWorkbook.Sheets("Form").Range("SST.SignupStat").Value & _
                      ", Account Number: " & ThisWorkbook.Sheets("Form").Range("CUS.RMSAPBillingNo").Value & _
                      TR1 & IT1
14589             ElseIf ThisWorkbook.Sheets("Form").Range("CHK.DMOorOBA").Value = True Then
14590                 .Subject = "AWAITING DDM MANDATE [Confidential] NEW DMO USER - Customer: " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value
14591             End If

14592         If Form.Range("Priority") Then .Subject = "PRIORITY - " & .Subject
14593         .HTMLbody = strbody
14600         .Attachments.Add ActiveWorkbook.FullName
14610         If IT Then .Attachments.Add Environ$("temp") & "\IntPrc1.csv"
14620         If IT Then .Attachments.Add Environ$("temp") & "\MP7 MP9 MTE ZSDI - 507 - 96 99.csv"
14650 wb2.Close SaveChanges:=False
14630         .DISPLAY
14640     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
14660     Kill TempFilePath & tempfilename & FileExtStr
14670     Kill Environ$("temp") & "\IntPrc1.csv"
14680     Kill Environ$("temp") & "\MP7 MP9 MTE ZSDI - 507 - 96 99.csv"

14690     Set OutMail = Nothing
14700     Set OutApp = Nothing

14710     With Application
14720         .ScreenUpdating = True
14730         .EnableEvents = True
14740     End With
14750 Exit Sub
error_proc:
14760     If MsgBox("Error has occured with subroutine [SUS_FINANCE]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
14770     ShutDown
End Sub
Sub RETURN_TO_SALES()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
      Dim FileNameZip As Variant
      Dim oApp As Object
      Dim attach1 As String
      Dim agency As Boolean
      Dim agency7 As Boolean
     
14780 On Error GoTo error_proc

14790 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14800 If Val(Application.Version) >= 12 Then
14810         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
14820             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
14830             Exit Sub
14840         End If
14850     End If
14860     With Application
14870         .ScreenUpdating = False
14880         .EnableEvents = False
14890     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
14900     TempFilePath = Environ$("temp") & "\"
14910     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
14920     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

14930     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
14940     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
14950 ActiveWorkbook.Sheets("Form").Range("CHK.Salesperson").Value = True
14960 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox35_Click")
14970 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
14980 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
14990 ActiveWorkbook.Save


9441        agency = False
9442        agency7 = False
9443        If Dir("C:\program files\7-Zip\7z.exe") = "" Then
9444            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency = True Else agency = False
9445        Else
9446            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency7 = True Else agency7 = False
9447        End If

13651 If agency Then
13652     FileNameZip = Environ$("temp") & "\" & tempfilename & ".zip"
13653     NewZip (FileNameZip)
13654     Set oApp = CreateObject("Shell.Application")
13655     oApp.Namespace(FileNameZip).CopyHere ActiveWorkbook.FullName
13656     On Error Resume Next
13657     Do Until oApp.Namespace(FileNameZip).items.Count = 1
13658     Application.Wait (Now + TimeValue("0:00:01"))
13659     Loop
13660     On Error GoTo error_proc
13661     attach1 = FileNameZip
13662 Else
13663     If agency7 Then
13664       wb2.Close SaveChanges:=False
13665       FileNameZip = Environ$("temp") & "\7ZIP" & tempfilename & ".zip"
13666       E_Zip_ActiveWorkbook (tempfilename)
'13666       Application.Wait (Now + TimeValue("0:00:05"))
13667       attach1 = FileNameZip
13668     Else
13669       attach1 = ActiveWorkbook.FullName
13670     End If
13771 End If

      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15000     Set OutApp = CreateObject("Outlook.Application")
15010     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
15020     strbody = "<font face=arial>Dear " _
                     & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value _
                     & ",<br><br> " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
                     & " has had a credit check. Please find attached their Customer Onboarding Form with the outcome for you to action.<br><br>Kind Regards,<br><br>" _
                     & Application.Username _
                     & "<br>Credit Management Centre"
          
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
15030     With OutMail
15040         .To = ThisWorkbook.Sheets("Form").Range("SAL.ContactEmail").Value
15050         .cc = ""
15060         .BCC = ""
15070         .Subject = "[Confidential] " & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
15080         .HTMLbody = strbody
15090         .Attachments.Add attach1
15120         If Not agency7 Then wb2.Close SaveChanges:=False
15100         .DISPLAY
15110     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
15130     Kill TempFilePath & tempfilename & FileExtStr

14101     If agency Then Kill FileNameZip
14102     If agency7 Then Kill FileNameZip

9811      Set oApp = Nothing

15140     Set OutMail = Nothing
15150     Set OutApp = Nothing

15160     With Application
15170         .ScreenUpdating = True
15180         .EnableEvents = True
15190     End With
15200 Exit Sub
error_proc:
15210     If MsgBox("Error has occured with subroutine [RETURN_TO_SALES]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
15220     ShutDown

End Sub

Sub UPDATE_COSS_SETUP()

      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
15230 On Error GoTo error_proc
15240 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15250 If Val(Application.Version) >= 12 Then
15260         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
15270             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
15280             Exit Sub
15290         End If
15300     End If
15310     With Application
15320         .ScreenUpdating = False
15330         .EnableEvents = False
15340     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15350     TempFilePath = Environ$("temp") & "\"
15360     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
15370     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

15380     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
15390     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
15400 ActiveWorkbook.Sheets("Form").Range("CHK.CustomerSolutions").Value = True
15410 Application.Run ("'" & ActiveWorkbook.name & "'!CheckBox38_Click")
15420 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
15421 ActiveWorkbook.Save


      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15430     Set OutApp = CreateObject("Outlook.Application")
15440     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'EMAIL BODY TEXT
15450     strbody = "<font face=arial>UPDATE TO SETUP REQUEST:<br><br>Dear Customer Solutions Team,<br><br>Please find attached an updated Customer Onboarding Form for " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value _
                     & "<br><br>Royal Mail SAP Billing Account Number(s): " _
                     & ThisWorkbook.Sheets("Form").Range("CUS.RMSAPBillingNo").Value _
                     & "<br><br>PPI Number: " _
                     & UCase(ThisWorkbook.Sheets("Form").Range("CUS.PPI").Value) _
                     & "<br><br>Kind Regards,<br><br>" _
                     & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
          
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
15460     With OutMail
15471        If Form.Range("SHP.SolutionReq").Value = "International Shipping" Then
15472                .To = "shippingsupport@royalmail.com"
15473            ElseIf Form.Range("SHP.SolutionReq").Value = "3PI-API Shipping" Or Form.Range("SHP.SolutionReq").Value = "Pro Shipping" Then
15474               .To = "shippingsupport@royalmail.com"
15475            Else
15476                .To = "customersolutionsteam@royalmail.com"
15477        End If
15480         If Form.Range("SHP.SolutionReq").Value = "API Shipping" Then .cc = "shippingsupport@royalmail.com; " Else .cc = ""
15490         .BCC = ""
15500         .Subject = "[Confidential] UPDATE: " & _
                          ThisWorkbook.Sheets("Form").Range("SHP.SolutionReq").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.CustName").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.TopAccount").Value & ", " & _
                          ThisWorkbook.Sheets("Form").Range("CUS.Opportunity").Value
15510         .HTMLbody = strbody
15520         .Attachments.Add ActiveWorkbook.FullName
15550 wb2.Close SaveChanges:=False
15530         .DISPLAY
15540     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
15560     Kill TempFilePath & tempfilename & FileExtStr

15570     Set OutMail = Nothing
15580     Set OutApp = Nothing

15590     With Application
15600         .ScreenUpdating = True
15610         .EnableEvents = True
15620     End With
15630 Exit Sub
error_proc:
15640     If MsgBox("Error has occured with subroutine [UPDATE_COSS_SETUP]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
15650     ShutDown
End Sub

Sub BeforeSave()
15660 Form.Unprotect Password:="fruitbasket"
15661 Form.Range("Net.Status").Value = ""
15662 Sheet13.Visible = xlSheetVisible
15663 Sheet13.Select
15664 Sheet2.Visible = xlSheetHidden
15665 Sheet3.Range("A2").ClearContents
15666 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
15667 Form.EnableSelection = xlNoRestrictions
End Sub

Sub SUS_D2D_EMAIL_SEND()

      'Check if all required fills are filled
      Dim c As Range
      Dim rng As Range
      Dim agency As Boolean
      Dim agency7 As Boolean
15670 On Error GoTo error_proc

15672 Set rng = ThisWorkbook.Sheets("Form").Range("Emails.AccountSetup.Check1")
15673 For Each c In rng
15674     If c.Value = True Or IsEmpty(c.Value) Or Cells(c.Row, c.Column - 2).Value = 0 Then GoTo Skip1
15675         MsgBox "Please fill in all required fields."
15676         ActiveSheet.Range(c.address).Activate
15677         Exit Sub
Skip1:
15678 Next

15679 Set rng = ThisWorkbook.Sheets("Form").Range("Emails.AccountSetup.Check2")
15680 For Each c In rng
15681     If c.Value = True Or IsEmpty(c.Value) Or Cells(c.Row, c.Column - 2).Value = 0 Then GoTo Skip2
15682         MsgBox "Please fill in all required fields."
15683         ActiveSheet.Range(c.address).Activate
15684         Exit Sub
Skip2:
15685 Next


      Dim wb1 As Workbook
      Dim wb2 As Workbook
      Dim TempFilePath As String
      Dim tempfilename As String
      Dim FileExtStr As String
      Dim OutApp As Object
      Dim OutMail As Object
      Dim TCDate As String
      Dim TR As Boolean
      Dim TR1 As String
      Dim IT As Boolean
      Dim IT1 As String
      Dim IT2 As String
      Dim FileNameZip As Variant
      Dim oApp As Object
      Dim attach1 As String
      
9441        agency = False
9442        agency7 = False
9443        If Dir("C:\program files\7-Zip\7z.exe") = "" Then
9444            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency = True Else agency = False
9445        Else
'9446            If Right(Form.Range("SAL.ContactEmail").Value, 5) = ".info" Then agency7 = True Else agency7 = False
9446        agency7 = True
9447        End If

15686 Set wb1 = ActiveWorkbook
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15687 If Val(Application.Version) >= 12 Then
15688         If wb1.FileFormat = 51 And wb1.HasVBProject = True Then
15689             MsgBox "There is VBA code in this xlsx file, there will" & vbNewLine & _
                         "be no VBA code in the file you send. Save the" & vbNewLine & _
                         "file first as xlsm and then try the macro again.", vbInformation
15690             Exit Sub
15691         End If
15693     End If
15694     With Application
15695         .ScreenUpdating = False
15696         .EnableEvents = False
15697     End With
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15698     TempFilePath = Environ$("temp") & "\"
15699     tempfilename = ThisWorkbook.Sheets("CONTROL").Range("E14").Value & "_" & Format(DateValue(Now), "dd-mm-yyyy") & "_" & Format(TimeValue(Now), "hh-mm-ss")
15700     FileExtStr = "." & LCase(Right(wb1.name, _
                                         Len(wb1.name) - InStrRev(wb1.name, ".", , 1)))

15701     wb1.SaveCopyAs TempFilePath & tempfilename & FileExtStr
15702     Set wb2 = Workbooks.Open(TempFilePath & tempfilename & FileExtStr)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'Code to pre-set workbook to user
15703 ActiveWorkbook.Sheets("Form").Range("CHK.D2D").Value = True
15704 Application.Run ("'" & ActiveWorkbook.name & "'!D2D_Click")
15705 Application.Run ("'" & ActiveWorkbook.name & "'!ShowHide")
15706 Application.Run ("'" & ActiveWorkbook.name & "'!BeforeSave")
15707 ActiveWorkbook.Save

13651 If agency Then
13652     FileNameZip = Environ$("temp") & "\" & tempfilename & ".zip"
13653     NewZip (FileNameZip)
13654     Set oApp = CreateObject("Shell.Application")
13655     oApp.Namespace(FileNameZip).CopyHere ActiveWorkbook.FullName
13656     On Error Resume Next
13657     Do Until oApp.Namespace(FileNameZip).items.Count = 1
13658     Application.Wait (Now + TimeValue("0:00:01"))
13659     Loop
13660     On Error GoTo error_proc
13661     attach1 = FileNameZip
13662 Else
13663     If agency7 Then
13664       wb2.Close SaveChanges:=False
13665       FileNameZip = Environ$("temp") & "\7ZIP" & tempfilename & ".zip"
13666       E_Zip_ActiveWorkbook (tempfilename)
'13666       Application.Wait (Now + TimeValue("0:00:05"))
13667       attach1 = FileNameZip
13668     Else
13669       attach1 = ActiveWorkbook.FullName
13670     End If
13771 End If
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15708     Set OutApp = CreateObject("Outlook.Application")
15709     Set OutMail = OutApp.CreateItem(0)
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
15710 If Form.Range("SST.TCDate") Then
15711     TCDate = ("<br><b>T&Cs sent to customer on: </B><font color=red>" & ThisWorkbook.Sheets("Form").Range("SST.TCDate").Value & "</font>")
15712     Else
15713     TCDate = ""
15714 End If

15715 If Range("Tracked") = True Then TR = True Else TR = False
15716 If TR Then TR1 = "<br><b>Inland Tracked Pricing Tier (If applicable):  </B><font color=red>" & ThisWorkbook.Sheets("T1 Import").Range("B44").Value & "</font>" Else TR1 = ""
15717 If Range("Letters.Req.Int") = True Then IT = True Else IT = False
15718 If IT Then
15719     IT1 = "<br><b>Discount (International Country Pricing Only):  </B>" & ThisWorkbook.Sheets("CONTROL.Letters").Range("Discount").Value & "% discount on all products and destinations"
15720     If ThisWorkbook.Sheets("CONTROL.Letters").Range("Discount").Value = 0 Then IT2 = "<br><b>International Country Pricing Tier:  </B><font color=red> 2A </font>" Else IT2 = "<br><b>International Country Pricing Tier:  </B><font color=red> 2B </font>"
15721     Else
15723     IT1 = ""
15724     IT2 = ""
15725 End If
          

      'EMAIL BODY TEXT
15726     strbody = "<font face=arial>FAO CE Door to Door Team" _
          & "<br><br>" & ThisWorkbook.Sheets("CONTROL").Range("c73").Value _
          & "<br><br><b>Application Summary<br><br>First Posting date:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C71").Value _
          & "<br><b>Date/Time application submitted:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B74").Value _
          & "<br><b>Calendar Days left until first posting date (approx):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("C74").Value _
          & "<br><b>Legal Entity Number (if applicable):  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B75").Value _
          & "<br><b>Is there an existing Shipping Solution?:  </B>" & Range("SHP.Existing").Value _
          & "<br><b>Which shipping solution is required:  </B>" & Range("Emails.SHPSol").Value _
          & "<br><b>Is DMO Required:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("Emails.COL.DMOReq").Value _
          & "<br><b>Is a Collection Set-up Required:</b> " & Range("Emails.ColSetUp").Value _
          & "<br><b>Would the cust be interested in Tracked Returns Portal access?:   </B>" & ThisWorkbook.Sheets("CONTROL").Range("B78").Value _
          & "<br><b>Number of Product Items in Application:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("B76").Value _
          & "<br><b>Product Code Summary:  </B>" & ThisWorkbook.Sheets("CONTROL").Range("b77").Value _
          & "<br><b>Payment Method (If applicable):  </B>" & ThisWorkbook.Sheets("Form").Range("BIL.PayMethod").Value _
          & TR1 _
          & IT1 _
          & IT2 _
          & TCDate _
          & "<br><br>I confirm that all the required fields have been completed in the attached form and all necessary information has been supplied to support this application." _
          & "<br><br>Many Thanks<br>" _
          & ThisWorkbook.Sheets("Form").Range("SAL.ContactName").Value
      ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
      'FORMAT EMAIL
15727     With OutMail
15728         .To = "doortodoor@royalmail.com"
              .cc = Sheets("Form").Range("SAL.ContactEmail")
              .Subject = ThisWorkbook.Sheets("CONTROL").Range("B72").Value & ThisWorkbook.Sheets("CONTROL").Range("C71").Value
15729         .HTMLbody = strbody
15730         .Attachments.Add attach1
15733         If Not agency7 Then wb2.Close SaveChanges:=False
15731         .DISPLAY
15732     End With
     ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''

          'Delete the file
15734     Kill TempFilePath & tempfilename & FileExtStr
14101     If agency Then Kill FileNameZip
14102     If agency7 Then Kill FileNameZip

15735     Set OutMail = Nothing
15736     Set OutApp = Nothing
9811      Set oApp = Nothing


15737     With Application
15738         .ScreenUpdating = True
15739         .EnableEvents = True
15740     End With
15741 Exit Sub
error_proc:
15742     If MsgBox("Error has occured with subroutine [SUS_D2D_EMAIL_SEND]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
15743     ShutDown
End Sub



Attribute VB_Name = "SevenZIP"

#If VBA7 Then
    Private Declare PtrSafe Function OpenProcess Lib "kernel32" _
        (ByVal dwDesiredAccess As Long, _
        ByVal bInheritHandle As Long, _
        ByVal dwProcessId As Long) As Long
    
    Private Declare PtrSafe Function GetExitCodeProcess Lib "kernel32" _
        (ByVal hProcess As Long, _
        lpExitCode As Long) As Long
#Else
    Private Declare Function OpenProcess Lib "kernel32" _
        (ByVal dwDesiredAccess As Long, _
        ByVal bInheritHandle As Long, _
        ByVal dwProcessId As Long) As Long
    
    Private Declare Function GetExitCodeProcess Lib "kernel32" _
        (ByVal hProcess As Long, _
        lpExitCode As Long) As Long
#End If


Public Const PROCESS_QUERY_INFORMATION = &H400
Public Const STILL_ACTIVE = &H103


Public Sub ShellAndWait(ByVal PathName As String, Optional WindowState)
    Dim hProg As Long
    Dim hProcess As Long, ExitCode As Long
    'fill in the missing parameter and execute the program
    If IsMissing(WindowState) Then WindowState = 1
    hProg = Shell(PathName, WindowState)
    'hProg is a "process ID under Win32. To get the process handle:
    hProcess = OpenProcess(PROCESS_QUERY_INFORMATION, False, hProg)
    Do
        'populate Exitcode variable
        GetExitCodeProcess hProcess, ExitCode
        DoEvents
    Loop While ExitCode = STILL_ACTIVE
End Sub


Function bIsBookOpen(ByRef szBookName As String) As Boolean
' Rob Bovey
    On Error Resume Next
    bIsBookOpen = Not (Application.Workbooks(szBookName) Is Nothing)
End Function



'With this example you browse to the folder you want to zip
'The zip file will be saved in: DefPath = Application.DefaultFilePath
'Normal if you have not change it this will be your Documents folder
'You can change this folder to this if you want to use another folder
'DefPath = "C:\Users\Ron\ZipFolder"
'There is no need to change the code before you test it

Sub A_Zip_Folder_And_SubFolders_Browse()
    Dim PathZipProgram As String, NameZipFile As String, FolderName As String
    Dim ShellStr As String, strDate As String, DefPath As String
    Dim Fld As Object

    'Path of the Zip program
    PathZipProgram = "C:\program files\7-Zip\"
    If Right(PathZipProgram, 1) <> "\" Then
        PathZipProgram = PathZipProgram & "\"
    End If

    'Check if this is the path where 7z is installed.
    If Dir(PathZipProgram & "7z.exe") = "" Then
        MsgBox "Please find your copy of 7z.exe and try again"
        Exit Sub
    End If

    'Create Path and name of the new zip file
    'The zip file will be saved in: DefPath = Application.DefaultFilePath
    'Normal if you have not change it this will be your Documents folder
    'You can change the folder if you want to another folder like this
    'DefPath = "C:\Users\Ron\ZipFolder"
    DefPath = Application.DefaultFilePath
    If Right(DefPath, 1) <> "\" Then
        DefPath = DefPath & "\"
    End If

    'Create date/Time string, also the name of the Zip in this example
    strDate = Format(Now, "yyyy-mm-dd h-mm-ss")

    'Set NameZipFile to the full path/name of the Zip file
    'If you want to add the word "MyZip" before the date/time use
    'NameZipFile = DefPath & "MyZip " & strDate & ".zip"
    NameZipFile = DefPath & strDate & ".zip"

    'Browse to the folder with the files that you want to Zip
    Set Fld = CreateObject("Shell.Application").BrowseForFolder(0, "Select folder to Zip", 512)
    If Not Fld Is Nothing Then
        FolderName = Fld.Self.Path
        If Right(FolderName, 1) <> "\" Then
            FolderName = FolderName & "\"
        End If

        'Zip all the files in the folder and subfolders, -r is Include subfolders
        ShellStr = PathZipProgram & "7z.exe a -r" _
                 & " " & Chr(34) & NameZipFile & Chr(34) _
                 & " " & Chr(34) & FolderName & "*.*" & Chr(34)

        'Note: you can replace the ShellStr with one of the example ShellStrings
        'below to test one of the examples


        'Zip the txt files in the folder and subfolders, use "*.xl*" for all excel files
        '        ShellStr = PathZipProgram & "7z.exe a -r" _
                 '                 & " " & Chr(34) & NameZipFile & Chr(34) _
                 '                 & " " & Chr(34) & FolderName & "*.txt" & Chr(34)

        'Zip all files in the folder and subfolders with a name that start with Week
        '        ShellStr = PathZipProgram & "7z.exe a -r" _
                 '                 & " " & Chr(34) & NameZipFile & Chr(34) _
                 '                 & " " & Chr(34) & FolderName & "Week*.*" & Chr(34)

        'Zip every file with the name ron.xlsx in the folder and subfolders
        '        ShellStr = PathZipProgram & "7z.exe a -r" _
                 '                 & " " & Chr(34) & NameZipFile & Chr(34) _
                 '                 & " " & Chr(34) & FolderName & "ron.xlsx" & Chr(34)

        'Add -ppassword -mhe of you want to add a password to the zip file(only .7z files)
        '                ShellStr = PathZipProgram & "7z.exe a -r -ppassword -mhe" _
                         '                                  & " " & Chr(34) & NameZipFile & Chr(34) _
                         '                                  & " " & Chr(34) & FolderName & "*.*" & Chr(34)

        'Add -seml if you want to open a mail with the zip attached
        '                ShellStr = PathZipProgram & "7z.exe a -r -seml" _
                         '                                  & " " & Chr(34) & NameZipFile & Chr(34) _
                         '                                  & " " & Chr(34) & FolderName & "*.*" & Chr(34)

        ShellAndWait ShellStr, vbHide

        MsgBox "You will find the zip file here: " & NameZipFile
    End If
End Sub



'With this example you zip a fixed folder: FolderName = "C:\Users\Ron\Desktop\TestFolder"
'Note this folder must exist, this is the only thing that you must change before you test it
'The zip file will be saved in: DefPath = Application.DefaultFilePath
'Normal if you have not change it this will be your Documents folder
'You can change this folder to this if you want to use another folder
'DefPath = "C:\Users\Ron\ZipFolder"

Sub B_Zip_Fixed_Folder_And_SubFolders()
    Dim PathZipProgram As String, NameZipFile As String, FolderName As String
    Dim ShellStr As String, strDate As String, DefPath As String

    'Path of the Zip program
    PathZipProgram = "C:\program files\7-Zip\"
    If Right(PathZipProgram, 1) <> "\" Then
        PathZipProgram = PathZipProgram & "\"
    End If

    'Check if this is the path where 7z is installed.
    If Dir(PathZipProgram & "7z.exe") = "" Then
        MsgBox "Please find your copy of 7z.exe and try again"
        Exit Sub
    End If

    'Create Path and name of the new zip file
    'The zip file will be saved in: DefPath = Application.DefaultFilePath
    'Normal if you have not change it this will be your Documents folder
    'You can change the folder if you want to another folder like this
    'DefPath = "C:\Users\Ron\ZipFolder"
    DefPath = Application.DefaultFilePath
    If Right(DefPath, 1) <> "\" Then
        DefPath = DefPath & "\"
    End If

    'Create date/Time string, also the name of the Zip in this example
    strDate = Format(Now, "yyyy-mm-dd h-mm-ss")

    'Set NameZipFile to the full path/name of the Zip file
    'If you want to add the word "MyZip" before the date/time use
    'NameZipFile = DefPath & "MyZip " & strDate & ".zip"
    NameZipFile = DefPath & strDate & ".zip"

    'Fill in the folder name
    FolderName = "C:\Users\Ron\Desktop\TestFolder"
    If Right(FolderName, 1) <> "\" Then
        FolderName = FolderName & "\"
    End If

    'Zip all the files in the folder and subfolders, -r is Include subfolders
    ShellStr = PathZipProgram & "7z.exe a -r" _
             & " " & Chr(34) & NameZipFile & Chr(34) _
             & " " & Chr(34) & FolderName & "*.*" & Chr(34)

    'Note: you can replace the ShellStr with one of the example ShellStrings
    'in the first macro example on this page

    ShellAndWait ShellStr, vbHide

    MsgBox "You will find the zip file here: " & NameZipFile
End Sub



'With this example you browse to the folder you want and select the files that you want to zip
'Use the Ctrl key to select more then one file or select blocks of files with the shift key pressed.
'With Ctrl a you select all files in the dialog.
'The name of the zip file will be the Date/Time, you can change the NameZipFile string
'If you want to add the word "MyZip" before the date/time use
'NameZipFile = DefPath & "MyZip " & strDate & ".zip"
'The zip file will be saved in: DefPath = Application.DefaultFilePath
'Normal if you have not change it this will be your Documents folder
'You can change this folder to this if you want to use another folder
'DefPath = "C:\Users\Ron\ZipFolder"
'No need to change the code before you test it

Sub C_Zip_File_Or_Files_Browse()
    Dim PathZipProgram As String, NameZipFile As String, FolderName As String
    Dim ShellStr As String, strDate As String, DefPath As String
    Dim NameList As String, sFileNameXls As String
    Dim vArr As Variant, FileNameXls As Variant, iCtr As Long

    'Path of the Zip program
    PathZipProgram = "C:\program files\7-Zip\"
    If Right(PathZipProgram, 1) <> "\" Then
        PathZipProgram = PathZipProgram & "\"
    End If

    'Check if this is the path where 7z is installed.
    If Dir(PathZipProgram & "7z.exe") = "" Then
        MsgBox "Please find your copy of 7z.exe and try again"
        Exit Sub
    End If

    'Create Path and name of the new zip file
    'The zip file will be saved in: DefPath = Application.DefaultFilePath
    'Normal if you have not change it this will be your Documents folder
    'You can change the folder if you want to another folder like this
    'DefPath = "C:\Users\Ron\ZipFolder"
    DefPath = Application.DefaultFilePath
    If Right(DefPath, 1) <> "\" Then
        DefPath = DefPath & "\"
    End If

    'Create date/Time string, also the name of the Zip in this example
    strDate = Format(Now, "yyyy-mm-dd h-mm-ss")

    'Set NameZipFile to the full path/name of the Zip file
    'If you want to add the word "MyZip" before the date/time use
    'NameZipFile = DefPath & "MyZip " & strDate & ".zip"
    NameZipFile = DefPath & strDate & ".zip"

    FileNameXls = Application.GetOpenFilename(filefilter:="Excel Files, *.xl*", _
                                              MultiSelect:=True, Title:="Select the files that you want to add to the new zip file")

    If IsArray(FileNameXls) = False Then
        'do nothing
    Else
        NameList = ""
        For iCtr = LBound(FileNameXls) To UBound(FileNameXls)
            NameList = NameList & " " & Chr(34) & FileNameXls(iCtr) & Chr(34)
            vArr = Split(FileNameXls(iCtr), "\")
            sFileNameXls = vArr(UBound(vArr))

            If bIsBookOpen(sFileNameXls) Then
                MsgBox "You can't zip a file that is open!" & vbLf & _
                       "Please close: " & FileNameXls(iCtr)
                Exit Sub
            End If
        Next iCtr

        'Zip every file you have selected with GetOpenFilename
        ShellStr = PathZipProgram & "7z.exe a" _
                 & " " & Chr(34) & NameZipFile & Chr(34) _
                 & " " & NameList

        ShellAndWait ShellStr, vbHide

        MsgBox "You will find the zip file here: " & NameZipFile
    End If

End Sub



'With this example you browse to the folder you want and select the files that you want to
'add or update to/in a existing zip file, if the zip file not exist it will be created for you.
'Use the Ctrl key to select more then one file or select blocks of files with the shift key pressed.
'With Ctrl a you select all files in the dialog.
'The zip file will be saved in: DefPath = Application.DefaultFilePath
'Normal if you have not change it this will be your Documents folder
'You can change the folder if you want to another folder like this :
'DefPath = "C:\Users\Ron\ZipFolder"
'Change this code line if you want to change the name of the zip file :
'NameZipFile = DefPath & "ron.zip
'There is no need to change the code before you test it

Sub D_Zip_File_Or_Files_Browse_Add_Update()
'Update older files in the archive and add files that are not in the archive
'Change NameZipFile in the code to your zip file before you run the code
    Dim PathZipProgram As String, NameZipFile As String, FolderName As String
    Dim ShellStr As String, DefPath As String
    Dim NameList As String, sFileNameXls As String
    Dim vArr As Variant, FileNameXls As Variant, iCtr As Long

    'Path of the Zip program
    PathZipProgram = "C:\program files\7-Zip\"
    If Right(PathZipProgram, 1) <> "\" Then
        PathZipProgram = PathZipProgram & "\"
    End If

    'Check if this is the path where 7z is installed.
    If Dir(PathZipProgram & "7z.exe") = "" Then
        MsgBox "Please find your copy of 7z.exe and try again"
        Exit Sub
    End If

    'Create Path and name of the existing/new zip file
    'If the zip file not exist the code create it for you
    'The zip file will be saved in: DefPath = Application.DefaultFilePath
    'Normal if you have not change it this will be your Documents folder
    'You can change the folder if you want to another folder like this
    'DefPath = "C:\Users\Ron\ZipFolder"
    DefPath = Application.DefaultFilePath
    If Right(DefPath, 1) <> "\" Then
        DefPath = DefPath & "\"
    End If
    'Set NameZipFile to the full path/name of the Zip file
    'Change this code line if you want to change the name of the zip file
    NameZipFile = DefPath & "ron.zip"

    FileNameXls = Application.GetOpenFilename(filefilter:="Excel Files, *.xl*", _
                                              MultiSelect:=True, Title:="Select the files that you want to update or add to the zip file")

    If IsArray(FileNameXls) = False Then
        'do nothing
    Else
        NameList = ""
        For iCtr = LBound(FileNameXls) To UBound(FileNameXls)
            NameList = NameList & " " & Chr(34) & FileNameXls(iCtr) & Chr(34)
            vArr = Split(FileNameXls(iCtr), "\")
            sFileNameXls = vArr(UBound(vArr))

            If bIsBookOpen(sFileNameXls) Then
                MsgBox "You can't zip a file that is open!" & vbLf & _
                       "Please close: " & FileNameXls(iCtr)
                Exit Sub
            End If
        Next iCtr

        'Zip every file you have selected with GetOpenFilename
        ShellStr = PathZipProgram & "7z.exe u" _
                 & " " & Chr(34) & NameZipFile & Chr(34) _
                 & " " & NameList

        ShellAndWait ShellStr, vbHide

        MsgBox "You will find the zip file here: " & NameZipFile
    End If

End Sub



'With this example you zip the ActiveWorkbook
'The name of the zip file will be the name of the workbook + Date/Time
'The zip file will be saved in: DefPath = Application.DefaultFilePath
'Normal if you have not change it this will be your Documents folder
'You can change this folder to this if you want to use another folder
'DefPath = "C:\Users\Ron\ZipFolder"
'There is no need to change the code before you test it

Sub E_Zip_ActiveWorkbook(filename As String)
    Dim PathZipProgram As String, NameZipFile As String
    Dim ShellStr As String, strDate As String, DefPath As String
    Dim FileNameXls As String, TempFilePath As String, tempfilename As String
    Dim MyWb As Workbook, FileExtStr As String

    'Path of the Zip program
    PathZipProgram = "C:\program files\7-Zip\"
    If Right(PathZipProgram, 1) <> "\" Then
        PathZipProgram = PathZipProgram & "\"
    End If
    'Check if this is the path where 7z is installed.
    If Dir(PathZipProgram & "7z.exe") = "" Then
        MsgBox "Please find your copy of 7z.exe and try again"
        Exit Sub
    End If

    'Build the path and name for the new xls? file
    Set MyWb = ActiveWorkbook
    'If ActiveWorkbook.Path = "" Then Exit Sub

    TempFilePath = Environ$("temp") & "\"
    FileExtStr = "." & LCase(Right(MyWb.name, _
                                   Len(MyWb.name) - InStrRev(MyWb.name, ".", , 1)))
    'TempFileName = Left(MyWb.name, Len(MyWb.name) - Len(FileExtStr))
    'tempfilename = filename

    'Use SaveCopyAs to make a copy of the file
    'FileNameXls = TempFilePath & tempfilename & FileExtStr
    'MyWb.SaveCopyAs FileNameXls
    FileNameXls = TempFilePath & filename & FileExtStr

    'Build the path and name for the new zip file
    'The name of the zip file will be the name of the workbook + Date/Time
    'The zip file will be saved in: DefPath = Application.DefaultFilePath
    'Normal if you have not change it this will be your Documents folder.
    'You can change this folder to this if you want to use another folder
    'DefPath = "C:\Users\Ron\ZipFolder"
    'DefPath = Application.DefaultFilePath
    DefPath = Environ$("temp")
    If Right(DefPath, 1) <> "\" Then
        DefPath = DefPath & "\"
    End If
    'strDate = Format(Now, "yyyy-mm-dd h-mm-ss")
    'NameZipFile = DefPath & TempFileName & " " & strDate & ".zip"
    NameZipFile = DefPath & "7ZIP" & filename & ".zip"

'Debug.Print NameZipFile
'Debug.Print FileNameXls


    'Zip FileNameXls (copy of the ActiveWorkbook)
    ShellStr = PathZipProgram & "7z.exe a -pbpmimecast" _
             & " " & Chr(34) & NameZipFile & Chr(34) _
             & " " & Chr(34) & FileNameXls & Chr(34)
    ShellAndWait ShellStr, vbHide
'Debug.Print ShellStr
    'Delete the file that you saved with SaveCopyAs and add to the zip file
'    Kill TempFilePath & filename & FileExtStr

'    MsgBox "You will find the zip file here: " & NameZipFile
End Sub

Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)

28210 On Error GoTo error_proc
              
28220         ThisWorkbook.Workbook_Open

28230 Exit Sub

error_proc:
28240     If MsgBox("Error has occured with subroutine [Worksheet_FollowHyperlink]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28250     ShutDown

End Sub

Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)

28260 On Error GoTo error_proc

28270     If Target.SubAddress = "Before.Save" Then BeforeSave
          
28280 Exit Sub

error_proc:
28290     If MsgBox("Error has occured with subroutine [Worksheet_FollowHyperlink]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28300     ShutDown

End Sub

Attribute VB_Name = "Sheet20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet24"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet26"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet27"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet28"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)
28310     ActiveWindow.ScrollRow = ActiveCell.Row
End Sub
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)

66000   On Error GoTo error_proc

66010   If Target.SubAddress = "Sector.Home" Then Form.Activate
          
66020   Exit Sub

error_proc:
66030   If MsgBox("Error has occured with subroutine [Worksheet_FollowHyperlink]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
66040   ShutDown

End Sub
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
28320 Sheets("Collection Schedule").Range("COLSchedule.CusName").Activate
End Sub
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ShowHideRoutine"
Option Explicit
Sub ShowHide()
      Dim rngRangeToHide As Range
      Dim rngRangeToShow As Range
      Dim c As Range
      Dim d As Range
      Dim i As Integer
      Dim j As Integer
      Dim protectionsetting As Boolean

17200 On Error GoTo error_proc

17210 protectionsetting = Form.ProtectContents
17220 StartUp

17230 If Form.Range("A4").Value = 0 Then
17240     Form.Range("A4").EntireRow.Hidden = True
17250 Else
17260     Form.Range("A4").EntireRow.Hidden = False
17270 End If

17280 i = 1
17290 j = 1

17300 If Range("Special.Hide") = False Then

17310     For Each c In Range("Form.Visible")
17320         If c.Value = 1 Then
17330             If i = 1 Then
17340                 Set rngRangeToShow = c
17350             Else
17360                 Set rngRangeToShow = Union(rngRangeToShow, c)
17370             End If
17380             i = i + 1
17390         Else
17400             If j = 1 Then
17410                 Set rngRangeToHide = c
17420             Else
17430                 Set rngRangeToHide = Union(rngRangeToHide, c)
17440             End If
17450             j = j + 1
17460         End If
          'Debug.Print c.Row
17470     Next c
17480     rngRangeToHide.EntireRow.Hidden = True
17490     rngRangeToShow.EntireRow.Hidden = False
17500     Form.Range("A14").EntireRow.Hidden = True
17510 Else
17520     For Each c In Range("Form.Visible")
17530         If j = 1 Then
17540             Set rngRangeToHide = c
17550         Else
17560             Set rngRangeToHide = Union(rngRangeToHide, c)
17570         End If
17580         j = j + 1
17590     Next c
          
17600     For Each d In Range("Form.Visible.Email")
17610         If d.Value = 1 Then
17620             If i = 1 Then
17630                 Set rngRangeToShow = d
17640             Else
17650                 Set rngRangeToShow = Union(rngRangeToShow, d)
17660             End If
17670             i = i + 1
17680         End If
17690     Next d
          
17700     rngRangeToHide.EntireRow.Hidden = True
17710     If Not rngRangeToShow Is Nothing Then
17720         rngRangeToShow.EntireRow.Hidden = False
17730     End If
17740     Form.Range("A14").EntireRow.Hidden = False
17750 End If

17751 If Form.Range("Chk.D2DSales") = False And Form.Range("Chk.D2DSalesAddOn") = False Then Sheet7.Visible = xlSheetHidden

17760 ShutDown
17770 If protectionsetting = False Then Form.Unprotect Password:="fruitbasket"

17780 Exit Sub
error_proc:
17790     If MsgBox("Error has occured with subroutine [ShowHide]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
17800     ShutDown
          
End Sub
Sub ShowHideRows()

17810 StartUp

17820 On Error Resume Next
17830 Form.Range("Products.ShowHide").SpecialCells(xlCellTypeFormulas, 1).EntireRow.Hidden = False
17840 Form.Range("Products.ShowHide").SpecialCells(xlCellTypeFormulas, 4).EntireRow.Hidden = True
17850 On Error GoTo 0

17860 ShutDown

End Sub
Sub WhichPrintArea()
17870 GoTo Skippy
17880 If Range("CHK.SettingUp") Or Range("CHK.Operations") Then
17890     Call PrintArea(Range("PrintAreaNarrow"), xlPortrait)
17900 Else
17910     Call PrintArea(Range("PrintAreaWide"), xlLandscape)
17920 End If
Skippy:
End Sub
Sub PrintArea(ThisRange As Range, ThisOrientation As String)
17930 If Not (Range("CHK.Operations")) And Not (Range("CHK.SettingUp")) Then
17940     GoTo Skippy2
17950 Else
      Dim vPage As Long, hPage As Long
17960 With Form.PageSetup
17970     .PrintArea = ThisRange.address
17980     .PrintTitleRows = ""
      '    .PrintTitleColumns = "$B:$B"
17990     .Zoom = 100
18000     .Orientation = ThisOrientation
18010     vPage = Form.VPageBreaks.Count + 1
18020     hPage = Form.HPageBreaks.Count + 1
18030     .Zoom = False
18040     .FitToPagesWide = Application.WorksheetFunction.RoundUp(vPage * 0.3, 0)
18050     .FitToPagesTall = False
18060 End With
Skippy2:
18070 End If
End Sub

Sub ProductCodeSummary()
      'Product code summary for SUS
      Dim c As Range
18080 Range("PRO.CodeSummary").MergeArea.ClearContents
18090 For Each c In Range("PRO.Code.List")
18100     If Not c.Value = "" Then
18110         If IsEmpty(Range("PRO.CodeSummary")) Then
18120         Range("PRO.CodeSummary").Value = c.Value
18130         Else
18140         Range("PRO.CodeSummary").Value = Range("PRO.CodeSummary") & "; " & c.Value
18150         End If
18160     End If
18170 Next c
          
End Sub
Attribute VB_Name = "ShowHidebasedonInputs"
Option Explicit
'---------------------------------------------------------------------------------------
' Module    : ShowHidebasedonInputs
' Author    : 918740
' Date      : 01/04/2016
' Purpose   :  Different fields should be visible to the user depending on inputs
'           For example  depending on whether the
'           customer being set up is a Limited company, a partnership of a Sole Trader.
'           This form should do that.  the macros here are called by macro Worksheet_Change
'           which is in the code for sheet "CustomerOnboardingForm"
'---------------------------------------------------------------------------------------
Sub IfNotPrePay()
      Dim intRowPayMethodSelect As Integer
      Dim Flag As Integer
      Dim RowCount As Integer

15750 On Error GoTo error_proc
15751 StartUp
15760 Flag = 0

15770 If Form.Range("CUS.RMLegalEntityNo").Value = "1000177806" Then Flag = 1

15780 Form.Range("CUS.RMLegalEntityNo").MergeArea.Locked = False
15790 Form.Range("CUS.RMLegalEntityNo").MergeArea.Value = ""

15800 Form.Range("CUS.RMLegalEntityNo").MergeArea.Select
15810 With Selection.Interior
15820     .Pattern = xlSolid
15830     .PatternColorIndex = xlAutomatic
15840     .Color = 10092543
15850     .TintAndShade = 0
15860     .PatternTintAndShade = 0
15870 End With

15880 If Flag = 1 And Not Range("CHK.NewCustomerSetup") Then MsgBox "Royal Mail Legal Entity Number cleared based on selection"

15890 Form.Range("BIL.PayMethod").Select

      ' Hide pre-pay section of form

15900 ShowHide
15910 ShutDown
15920 Exit Sub
error_proc:
15930     If MsgBox("Error has occured with subroutine [IfNotPrePay]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
15940     ShutDown

End Sub
Sub IfPrePay()
      Dim intRowPayMethodSelect As Integer
      Dim RowCount As Integer

15950 On Error GoTo error_proc
15960 StartUp
15970 Form.Range("CUS.RMLegalEntityNo").MergeArea.Value = "1000177806"
15980 Form.Range("CUS.RMLegalEntityNo").MergeArea.Select
15990 With Selection.Interior
16000     .Pattern = xlSolid
16010     .PatternColorIndex = xlAutomatic
16020     .ThemeColor = xlThemeColorDark1
16030     .TintAndShade = -0.149998474074526
16040     .PatternTintAndShade = 0
16050 End With

16060 Form.Range("CUS.RMLegalEntityNo").MergeArea.Locked = True
16070 If Not Range("CHK.NewCustomerSetup") Then
16080     MsgBox "Royal Mail Legal Entity Number updated based on selection"
16090 End If
16100 If Not Range("Chk.D2DSales") Then MsgBox "You cannot select Prepaid unless the customer has failed a Credit check, see checkboxes below"
16110 Form.Range("BIL.PayMethod").Select

16120 intRowPayMethodSelect = Range("BIL.PayMethod").Row

      ' Unhide prepay section of form
16130 ShowHide
16140 ShutDown
16150 Exit Sub
error_proc:
16160     If MsgBox("Error has occured with subroutine [IfPrePay]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16170     ShutDown
End Sub
Sub IfOther()
16180 On Error GoTo error_proc
16190 StartUp

16200 Form.Range("BIL.OtherPayMethod").MergeArea.Locked = False
16210 Form.Range("BIL.OtherPayMethod").Select
16220 With Selection.Interior
16230     .Pattern = xlSolid
16240     .PatternColorIndex = xlAutomatic
16250     .Color = 10092543
16260     .TintAndShade = 0
16270     .PatternTintAndShade = 0
16280 End With
          
16290 ShutDown
16300 Exit Sub
error_proc:
16310     If MsgBox("Error has occured with subroutine [IfOther]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16320     ShutDown

End Sub
Sub IfNotOther()
16330 On Error GoTo error_proc
16340 StartUp

16350 Form.Range("BIL.OtherPayMethod").Select
16360 With Selection.Interior
16370     .Pattern = xlSolid
16380     .PatternColorIndex = xlAutomatic
16390     .ThemeColor = xlThemeColorDark1
16400     .TintAndShade = -0.149998474074526
16410     .PatternTintAndShade = 0
16420 End With
16430 Form.Range("BIL.OtherPayMethod").MergeArea.Locked = True
16440 ShutDown
16450 Exit Sub
error_proc:
16460     If MsgBox("Error has occured with subroutine [IfNotOther]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
16470     ShutDown
End Sub

Sub subRemovePartner(Partner As Integer)
      Dim Counter As Integer
16480 On Error GoTo error_proc
16490 Form.Unprotect Password:="fruitbasket"
16500 Application.ScreenUpdating = False

16510 If Partner <= 8 Then
16520     For Counter = Partner To 8
16530         If Range("PAR.Title." & Counter + 1) <> "" Then
16540             Range("PAR.Title." & Counter) = Range("PAR.Title." & Counter + 1)
16550         Else
16560             Range("PAR.Title." & Counter) = ""
16570         End If
              
16580         If Range("PAR.FirstName." & Counter + 1) <> "" Then
16590             Range("PAR.FirstName." & Counter) = Range("PAR.FirstName." & Counter + 1)
16600         Else
16610             Range("PAR.FirstName." & Counter) = ""
16620         End If
              
16630         If Range("PAR.LastName." & Counter + 1) <> "" Then
16640             Range("PAR.LastName." & Counter) = Range("PAR.LastName." & Counter + 1)
16650         Else
16660             Range("PAR.LastName." & Counter) = ""
16670         End If
              
16680         If Range("PAR.DoB." & Counter + 1) <> "" Then
16690             Range("PAR.DoB." & Counter) = Range("PAR.DoB." & Counter + 1)
16700         Else
16710             Range("PAR.DoB." & Counter) = ""
16720         End If
              
16730         If Range("PAR.Address1." & Counter + 1) <> "" Then
16740             Range("PAR.Address1." & Counter) = Range("PAR.Address1." & Counter + 1)
16750         Else
16760             Range("PAR.Address1." & Counter) = ""
16770         End If
              
16780         If Range("PAR.Address2." & Counter + 1) <> "" Then
16790             Range("PAR.Address2." & Counter) = Range("PAR.Address2." & Counter + 1)
16800         Else
16810             Range("PAR.Address2." & Counter) = ""
16820         End If
              
16830         If Range("PAR.Address3." & Counter + 1) <> "" Then
16840             Range("PAR.Address3." & Counter) = Range("PAR.Address3." & Counter + 1)
16850         Else
16860             Range("PAR.Address3." & Counter) = ""
16870         End If
              
16880         If Range("PAR.Town." & Counter + 1) <> "" Then
16890             Range("PAR.Town." & Counter) = Range("PAR.Town." & Counter + 1)
16900         Else
16910             Range("PAR.Town." & Counter) = ""
16920         End If
              
16930         If Range("PAR.PostCode." & Counter + 1) <> "" Then
16940             Range("PAR.PostCode." & Counter) = Range("PAR.PostCode." & Counter + 1)
16950         Else
16960             Range("PAR.PostCode." & Counter) = ""
16970         End If
              
16980         If Range("PAR.Country." & Counter + 1) <> "" Then
16990             Range("PAR.Country." & Counter) = Range("PAR.Country." & Counter + 1)
17000         Else
17010             Range("PAR.Country." & Counter) = ""
17020         End If
              
17030         Range("Flag.Partner." & Counter) = Range("Flag.Partner." & Counter + 1)
17040     Next Counter
17050 End If

17060 Range("PAR.Title.9") = ""
17070 Range("PAR.FirstName.9") = ""
17080 Range("PAR.LastName.9") = ""
17099 Range("PAR.DoB.9") = ""
17100 Range("PAR.Address1.9") = ""
17110 Range("PAR.Address2.9") = ""
17120 Range("PAR.Address3.9") = ""
17130 Range("PAR.Town.9") = ""
17140 Range("PAR.PostCode.9") = ""
17150 Range("PAR.Country.9") = ""
17160 Range("Flag.Partner.9") = False
17170 Exit Sub
error_proc:
17180     If MsgBox("Error has occured with subroutine [subRemovePartner]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
17190     ShutDown

End Sub

Attribute VB_Name = "SpecialPricing"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Private Sub Worksheet_FollowHyperlink(ByVal Target As Hyperlink)

28330 On Error GoTo error_proc
28340 StartUp

28350 Select Case Target.SubAddress
          Case "SpecialPricing.RunReport"
28360         Call subSpecialPricing

28370 End Select

28380 ShutDown
28390 Exit Sub
error_proc:
28400     If MsgBox("Error has occured with subroutine [SpecialPricing_FollowHyperlink]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28410     ShutDown
          
End Sub

Attribute VB_Name = "TCControl"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "TestNetwork"
#If VBA7 Then
    Declare PtrSafe Function InternetGetConnectedStateEx Lib "wininet.dll" (ByRef lpdwFlags As LongPtr, ByVal lpszConnectionName As String, ByVal dwNameLen As Integer, ByVal dwReserved As Long) As Long
    Private Declare PtrSafe Function URLDownloadToFile Lib "urlmon" _
    Alias "URLDownloadToFileA" (ByVal pCaller As LongPtr, _
    ByVal szURL As String, ByVal szFileName As String, _
    ByVal dwReserved As LongPtr, ByVal lpfnCB As LongPtr) As LongPtr
    Dim Ret As LongPtr
#Else
    Declare Function InternetGetConnectedStateEx Lib "wininet.dll" (ByRef lpdwFlags As Long, ByVal lpszConnectionName As String, ByVal dwNameLen As Integer, ByVal dwReserved As Long) As Long
    Private Declare Function URLDownloadToFile Lib "urlmon" _
    Alias "URLDownloadToFileA" (ByVal pCaller As Long, _
    ByVal szURL As String, ByVal szFileName As String, _
    ByVal dwReserved As Long, ByVal lpfnCB As Long) As Long
    Dim Ret As Long
#End If

Public Function IsInternetConnected() As Boolean
#If VBA7 Then
          Dim lngReturnStatus As LongPtr
#Else
          Dim lngReturnStatus As Long
#End If

      Dim strConnType As String
18950 IsInternetConnected = False
18960 lngReturnStatus = InternetGetConnectedStateEx(lngReturnStatus, strConnType, 254, 0)
18970 If lngReturnStatus = 1 Then IsInternetConnected = True
End Function


Sub TestConnectionVCheck()
      Dim lWaitUntil As Long
      Dim Sec As Integer
      Dim NewV As Single
      Dim OldV As Single
      Dim Retried As Boolean

18980 On Error GoTo Error1

18981 Retried = False

Retry:

18990 If DoesFileExists(Environ$("temp") & "\" & "Change log.htm") = True Then
19000         Kill Environ$("temp") & "\" & "Change log.htm"
19010 End If

19020 Form.Unprotect Password:="fruitbasket"

19030 If IsInternetConnected() = False Then
      'If no network connection at all
19040     Form.Range("Net.Status").Value = "No Internet"
19050 Else
19060     DownloadVCheck
19070     If DoesFileExists(Environ$("temp") & "\" & "Change log.htm") = False Then
19071       If Retried = False Then
19072          Select Case MsgBox("You do not have an open connection the SharePoint site used for this form." & vbNewLine & vbNewLine & "If you are conencted to the RM network (directly or by VPN) you can click 'Yes' to attempt to establish a connection." & vbNewLine & vbNewLine & "If you click 'No' we will attempt an external web check (for agencies only - doesn't work on RM connections) - CPM/Tennysons please click 'No'." & vbNewLine & vbNewLine & "To cancel the check altogether click 'Cancel'." & vbNewLine & vbNewLine & "Do you want to try to establish the SharePoint connection?", vbYesNoCancel, "SharePoint Not Conneted")
               Case Is = vbYes
19073          ThisWorkbook.FollowHyperlink ("https://portal.royalmailgroup.com/sites/A145/Shared%20Documents/Forms/Standard%20View.aspx?ExplorerWindowUrl=%2Fsites%2FA145%2FShared%20Documents%2FDSQ%5FResources")
19074          MsgBox ("Please wait for the SharePoint to load and a file explorer window to open, then close both the windows, and then click 'OK' to retry the SharePoint connection.")
19075          Retried = True
19076          GoTo Retry
19077          Case Is = vbCancel
19078          End
19079          End Select
              'If no access to SharePoint
19080         Form.Range("Net.Status").Value = "No Sharepoint"
19090         DownloadVCheckWeb
19100         UpdateVCheck
19110         ActiveWorkbook.Connections("VersionFromSharpoint").Refresh
19120         OldV = Mid(Form.Range("H3").Value, 2, 5)
19130         NewV = Trim(Sheet3.Range("A2").Value)
19131         On Error GoTo Error1
19140         If OldV < NewV Then
19150                     MsgBox ("This is not the latest version of the setup form. The latest version is " & Sheet3.Range("A2") & " released on " & Sheet3.Range("B2") & ". It contains the following update: " & Sheet3.Range("C2") & ". Please obtain the latest form before starting this setup.  This form will close when you click OK.")
19160                     ThisWorkbook.Close (SaveChanges = False)
19170         Else
19180                     MsgBox ("Congratulations! You are using the latest version of the form.")
19190         End If
19191       Else
19192         MsgBox ("It has not been possible to complete the SharePoint version check at this time")
19193         Form.Range("Net.Status").Value = "Not Tested"
19194         End If
19200     Else
              'if Sharepoint connection possible
19210                 UpdateVCheck
19220                 ActiveWorkbook.Connections("VersionFromSharpoint").Refresh
19230                 Form.Range("Net.Status").Value = "Sharepoint OK"
19240                 OldV = Mid(Form.Range("H3").Value, 2, 5)
19250                 NewV = Trim(Sheet3.Range("A2").Value)
19260                 If OldV < NewV Then
19270                     MsgBox ("This is not the latest version of the setup form. The latest version is " & Sheet3.Range("A2") & " released on " & Sheet3.Range("B2") & ". It contains the following update: " & Sheet3.Range("C2") & ". When you click OK this form will close and the system will attempt to download and open the latest version.  In the case of problems please obtain the latest version from the 'Get Me Posting' SharePoint page.")
19280                     DownloadNewV
19290                     Workbooks.Open (Environ$("temp") & "\" & "Customer Onboarding Form.xlsb")
19300                     If ThisWorkbook.ReadOnly Then ThisWorkbook.Saved = True
19310                     ThisWorkbook.Close (SaveChanges = False)
19320                 Else
19330                     MsgBox ("Congratulations! You are using the latest version of the form.")
19340                 End If
19350     End If
19360 End If

19370 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
19380 Form.EnableSelection = xlNoRestrictions
19390 Exit Sub
Error1:
19400 Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
19410 Form.EnableSelection = xlNoRestrictions
19420 If MsgBox("It has not been possible to complete the online version check at this time. To report this error please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form Online Version Check") = vbYes Then ThisWorkbook.FollowHyperlink _
("mailto:james.valentine@royalmail.com?subject=Error with the Online Version Check in the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Sub DownloadVCheck()
          Dim strURL As String
          Dim strPath As String
19430 On Error GoTo Error1
          '~~> URL of the Path
19440     strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\Change log.htm"
          '~~> Destination for the file
19450     strPath = Environ$("temp") & "\" & "Change log.htm"

19460     Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)

19470     If Ret = 0 Then
      '        MsgBox "File successfully downloaded"
19480     Else
      '        If MsgBox("Unable to download the file")
19490     End If
19500 Exit Sub
Error1:
19510 If MsgBox("It has not been possible to complete the Sharepoint version check at this time. To report this error please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Sub DownloadNewV()
          Dim strURL As String
          Dim strPath As String
19520 On Error GoTo Error1
19530     If DoesFileExists(Environ$("temp") & "\" & "Customer Onboarding Form.xlsb") = True Then
19540         Kill Environ$("temp") & "\" & "Customer Onboarding Form.xlsb"
19550     End If
          
          '~~> URL of the Path
19560     strURL = "\\portal.royalmailgroup.com@SSL\DavWWWRoot\sites\A145\Shared Documents\DSQ_Resources\Customer Onboarding Form.xlsb"
          '~~> Destination for the file
19570     strPath = Environ$("temp") & "\" & "Customer Onboarding Form.xlsb"

19580     Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)

19590     If Ret = 0 Then
      '        MsgBox "File successfully downloaded"
19600     Else
      '        If MsgBox("Unable to download the file"
19610     End If
19620 Exit Sub
Error1:
19630 If MsgBox("It has not been possible to get the new version from Sharepoint at this time. To report this error please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Sub DownloadVCheckWeb()
          Dim strURL As String
          Dim strPath As String
19640 On Error GoTo Error1
          '~~> URL of the Path
19650     strURL = "https://drive.google.com/uc?export=download&id=0B0iJ1F348f1uV0RkRENhNkRkcms"
          '~~> Destination for the file
19660     strPath = Environ$("temp") & "\" & "Change log.htm"

19670     Ret = URLDownloadToFile(0, strURL, strPath, 0, 0)

19680     If Ret = 0 Then
      '        MsgBox "File successfully downloaded"
19690     Else
      '        If MsgBox("Unable to download the file"
19700     End If
19710 Exit Sub
Error1:
19720     If MsgBox("It has not been possible to complete the online version check at this time. To report this error please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
End Sub

Public Function DoesFileExists(strFullPath As String) As Boolean
19730     On Error GoTo Error1
19740     If Not Dir(strFullPath, vbDirectory) = vbNullString Then DoesFileExists = True
Error1:
19750     On Error GoTo 0
End Function

Sub UpdateVCheck()
19760     On Error GoTo Error1
19770     With Sheet3.QueryTables(1)
19780         .Connection = _
              "URL;file:///" & Replace(Environ$("temp"), "\", "/") & "/Change%20log.htm"
19790         .WebSelectionType = xlAllTables
19800         .WebFormatting = xlWebFormattingNone
19810         .WebPreFormattedTextToColumns = True
19820         .WebConsecutiveDelimitersAsOne = True
19830         .WebSingleBlockTextImport = False
19840         .WebDisableDateRecognition = False
19850         .WebDisableRedirections = False
19860         .Refresh (BackgroundQuery = False)
19870     End With
19880 Exit Sub
Error1:
19890     On Error GoTo 0
End Sub

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Sub Workbook_Open()
28420 On Error GoTo error_proc

28430 If Application.ProtectedViewWindows.Count > 0 Then
28440     MsgBox ("Please disable protected view first and then select continue.")
28450     Exit Sub
28460 End If

28470 If Application.Version < 14 Then
28480     MsgBox ("Your version of Excel is not compatible with this form. This form works with Excel 2010 and later. You may continue, but with your system is untested and may be unpredictable.")
28490 End If
         
28500 If Not Sheets("Form").Range("CHK.Finance") Then ThisWorkbook.Sheets("Form").Activate Else ThisWorkbook.Sheets("Customer Account Setup Output").Activate
28501 Form.Unprotect Password:="fruitbasket"
28502 If Dir("C:\program files\7-Zip\7z.exe") = "" Then Form.Range("Chk.7zip").Value = "7-Zip Not Found" Else Form.Range("Chk.7zip").Value = "7-Zip Ready"

28510 Sheet13.Visible = xlSheetHidden

      'If form is blank check version
28520 If Len(Form.Range("SAL.ContactName")) = 0 Then

28531   Form.Range("Net.Status").Value = "Not Tested"
28540   If MsgBox("Welcome to " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & " of the Customer Onboarding Form." & vbNewLine & "This version contains a number of important fixes." & vbNewLine & vbNewLine & "Do you want to check for a newer form version? (You must be online - please note, there is a known issue with this check on RM connections. You may see an error number 13, it is safe to proceed after seeing this, a fix is being worked on)", vbYesNo, "Check Vesion") = vbYes Then TestConnectionVCheck
28550   Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
28560 Else
28570   Form.Unprotect Password:="fruitbasket"
28580   Form.Range("Net.Status").Value = ""
28590   Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
28600 End If

28601   Form.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True

28610 StartUp
          
      'Set the user name for the letters control sheet
28620 ControlLetters.Range("Control.Username").Value = Replace(Application.Username, ".", " ")
          
      'Set the signature for the letters control sheet

28630 ControlLetters.Range("Control.SignatureName").Value = Replace(Range("Control.Username").Value, ".", " ")
28640 ControlLetters.Range("Control.SignatureName").Value = StrConv(Range("Control.SignatureName").Value, vbProperCase)

28650 Form.Range("CHK.PricingSheet").Formula = "=SpecialPricing.Flag"
28660 Form.Range("CHK.PrePay").Formula = "=BIL.PayMethod=""Pre pay"""

28670 Form.Range("Revert.Flag") = False

28680 ShutDown
28690 AddProductSub2

28700 ActiveWindow.Zoom = 100

28710 Exit Sub
error_proc:
28720     If MsgBox("Error has occured with subroutine [WorkBook_Open]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
28730     ShutDown

End Sub
Attribute VB_Name = "WP_Form"
Attribute VB_Base = "0{0C81D074-2BA1-4DE9-914E-FEE151B2D866}{48BE2229-AACF-4883-95EA-54B3C1A837C7}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub Cancel_Click()
Unload WP_Form
End Sub

Private Sub OK_Click()
      Dim OutApp As Object
      Dim strbody As String
      Dim Product1 As String
      Dim Product2 As String
      Dim Product3 As String
      Dim Product4 As String
      Dim Product5 As String
      Dim Product6 As String
      Dim Product7 As String
      Dim Product8 As String
      Dim SAddress As String
      Dim SAddress2 As String
      Dim SAddress3 As String
   
27270 On Error GoTo error_proc
27271 If CheckBox1 Then Product1 = "- WEL-STAND<br>" Else Product1 = ""
27272 If CheckBox2 Then Product2 = "- WEL-TRACK<br>" Else Product2 = ""
27273 If CheckBox3 Then Product3 = "- WEL-SD<br>" Else Product3 = ""
27274 If CheckBox4 Then Product4 = "- WEL-INT<br>" Else Product4 = ""
27275 If CheckBox5 Then Product5 = "- WEL-RET<br>" Else Product5 = ""
27276 If CheckBox6 Then Product6 = "- WEL-MARK<br>" Else Product6 = ""
27277 If CheckBox7 Then Product7 = "- WEL-BUS<br>" Else Product7 = ""
27278 If CheckBox8 Then Product8 = "- WEL-D2D<br>" Else Product8 = ""
27279 If Address2.Value <> "" Then SAddress2 = "<br>" & Address2.Value Else SAddress2 = ""
27280 If Address3.Value <> "" Then SAddress3 = "<br>" & Address3.Value Else SAddress3 = ""
27282 StartUp
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27283         With Application
27284             .ScreenUpdating = False
27285             .EnableEvents = False
27286         End With
          '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27287         Set OutApp = CreateObject("Outlook.Application")
27288         Set OutMail = OutApp.CreateItem(0)
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'EMAIL BODY TEXT
27289         strbody = "Please send a Welcome Pack to:-" _
& "<br><br>Contact ID: " & ContactID.Value _
& "<br>Name: " & Title.Value _
& " " & FirstName.Value _
& " " & LastName.Value _
& "<br>Job Title: " & JobTitle.Value _
& "<br>Company Name: " & CompanyName.Value _
& "<br><br>Address: " & Address1.Value _
& SAddress2 _
& SAddress3 _
& "<br>Town: " & Town.Value _
& "<br>Post Code: " & PostCode.Value _
& "<br>Country: " & Country.Value _
& "<br><br>Product to be included:- <br><br>" _
& Product1 _
& Product2 _
& Product3 _
& Product4 _
& Product5 _
& Product6 _
& Product7 _
& Product8 _
& "<br><br>Kind Regards<br><br>" _
& Form.Range("SAL.ContactName")

          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
          'FORMAT EMAIL
27290        With OutMail
27291            .To = "rm_welcome@clientmail.eu.com"
27292            .Importance = 2
27293             .Subject = "Request for a Welcome Pack"
27294             .HTMLbody = strbody
27295             .DISPLAY
27296        End With
      '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27297     Set OutMail = Nothing
27298     Set OutApp = Nothing
         
          ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
27299     With Application
27300         .ScreenUpdating = True
27301         .EnableEvents = True
27302     End With
      'End If
Unload WP_Form
27303 ShutDown
27304 Exit Sub
error_proc:
27305     If MsgBox("Error has occured with subroutine [OK_Click]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
27306     ShutDown
End Sub


Private Sub UserForm_Initialize()

Title = Form.Range("MCC.Title").Value
FirstName = Form.Range("MCC.FirstName").Value
LastName = Form.Range("MCC.LastName").Value
JobTitle = Form.Range("MCC.JobTitle").Value
ContactID = Form.Range("CUS.ContactID").Value
Address1 = Form.Range("CUS.Address1").Value
Address2 = Form.Range("CUS.Address2").Value
Address3 = Form.Range("CUS.Address3").Value
Town = Form.Range("CUS.Town").Value
PostCode = Form.Range("CUS.Postcode").Value
Country = Form.Range("CUS.Country").Value
CompanyName = Form.Range("CUS.CustName").Value

End Sub
Attribute VB_Name = "WaitForm1"
Attribute VB_Base = "0{B41CF5A9-D7A7-4969-872B-753A1A4B9219}{5E287F66-1A9F-4D58-BC22-8112C81B4A43}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Attribute VB_Name = "ZIP"
Sub NewZip(sPath)
'Create empty Zip File
'Changed by keepITcool Dec-12-2005
    If Len(Dir(sPath)) > 0 Then Kill sPath
    Open sPath For Output As #1
    Print #1, Chr$(80) & Chr$(75) & Chr$(5) & Chr$(6) & String(18, 0)
    Close #1
End Sub


Function bIsBookOpen(ByRef szBookName As String) As Boolean
' Rob Bovey
    On Error Resume Next
    bIsBookOpen = Not (Application.Workbooks(szBookName) Is Nothing)
End Function


Function Split97(sStr As Variant, sdelim As String) As Variant
'Tom Ogilvy
    Split97 = Evaluate("{""" & _
                       Application.Substitute(sStr, sdelim, """,""") & """}")
End Function

Attribute VB_Name = "frmSpecialPricing"
Option Explicit
Sub subSpecialPricing()

      Dim icountSpecial As Integer
      Dim icountTotal As Integer
      Dim iheaderrow As Integer
      Dim ilastcolumn As Integer

      Dim i As Integer 'stores vertical row
      Dim j As Integer 'stores horizontal column
      Dim strFieldRangename As String
      Dim iProductOffset As Integer

      'on error GoTo error_proc
38620 Application.EnableEvents = True
38630 SpecialPricing.Unprotect Password:="fruitbasket"

38640 iheaderrow = Range("SpecialPricing.HeaderRow").Row
38650 ilastcolumn = Range("SpecialPricing.MaxColumns").Value

38660 icountSpecial = 0
38670 icountTotal = 0

      'Clear out old products
38680 Range(Range("SpecialPricing.HeaderRow").Offset(1, -1), Range("SpecialPricing.HeaderRow").Offset(30, 32)).ClearContents

      'Row position
38690 Do While icountTotal <= Range("SpecialPricing.ProductCount").Value

38700 i = iheaderrow + 1 + icountSpecial

38710 iProductOffset = icountTotal * 2
38720     If Range("PRO.SpecialPricingCheck").Offset(iProductOffset, 0).Value = "Active" Then
              'Column position
38730         For j = 3 To ilastcolumn
          
                  'If the code is to print it then do the print
38740             If SpecialPricing.Cells(3, j).Value = True Then
38750                 strFieldRangename = SpecialPricing.Cells(2, j).Value
                      'Does the data come from product or generic
38760                 If SpecialPricing.Cells(4, j).Value = True Then
38770                     SpecialPricing.Cells(i, j).Value = Range(strFieldRangename).Offset(iProductOffset, 0).Value
38780                 Else
                          'If refers to Fall to Earth then re-calibrate to exclude international
38790                     If Form.Range("Col.FalltoEarthTotal") = 0 Then GoTo FalltoEarth
                          
38800                     If strFieldRangename = "COL.FalltoEarthUK" Or strFieldRangename = "COL.FalltoEarthHIGH" Or strFieldRangename = "COL.FalltoEarthNI" Then
38810                     SpecialPricing.Cells(i, j).Value = Range(strFieldRangename).Value / (Range("COL.FalltoEarthUK").Value + Range("COL.FalltoEarthHIGH").Value + Range("COL.FalltoEarthNI").Value)
FalltoEarth:
                          'If seasonal then change values
38820                     ElseIf strFieldRangename = "CUS.Seasonal" Then
38830                         If Range(strFieldRangename).Value = True Then
38840                             SpecialPricing.Cells(i, j).Value = "Seasonal"
38850                         Else
38860                             SpecialPricing.Cells(i, j).Value = "Non-Seasonal"
38870                         End If
38880                     Else
38890                     End If
38900                     SpecialPricing.Cells(i, j).Value = Range(strFieldRangename).Value
38910                 End If
38920             Else
                  'All custom fileds where Code Print set to false are handled here
                      
                      'Status
38930                 If j = 7 Then SpecialPricing.Cells(i, j).Value = "Active"
                      
                      'Product Code
38940                 If j = 9 Then SpecialPricing.Cells(i, j).Value = Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3)
                      
                      'Setup date
38950                  If j = 12 Then SpecialPricing.Cells(i, j).Value = Date
                      
                      'Tariff
38960                  If j = 13 Then SpecialPricing.Cells(i, j).Value = "'19-20"
                       
                      'Address
38970                  If j = 14 Then
                       ' Concatenate all the parts of the address taking a new line for each
38980                     SpecialPricing.Cells(i, j).Value = Range("BIL.Address1").Value & Chr(10) & _
                          Range("BIL.Address2").Value & Chr(10) & Range("BIL.Address3").Value & Chr(10) & Range("BIL.Town").Value _
                          & Chr(10) & Range("BIL.Postcode").Value
38990                 End If
                      
                      'Postcode
39000                 If j = 15 Then SpecialPricing.Cells(i, j).Value = Range("BIL.Postcode").Value
                      
                      ' Litres volume
39010                 If j = 20 Then SpecialPricing.Cells(i, j).Value = Range("PRO.Volume").Offset(iProductOffset, 0).Value
   
39011                 If Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TPL" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TPL" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TPM" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TPN" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TPS" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TRL" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TRM" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TRN" Or _
                            Left(Range("PRO.Product.1").Offset(iProductOffset, 0).Value, 3) = "TRS" _
                      Then
39012                       If j = 21 Then SpecialPricing.Cells(i, j).Value = (Range("PRO.FTE1").Offset(iProductOffset, 0).Value) / 100
39013                       If j = 22 Then SpecialPricing.Cells(i, j).Value = (Range("PRO.FTE2").Offset(iProductOffset, 0).Value) / 100
39014                       If j = 23 Then SpecialPricing.Cells(i, j).Value = (Range("PRO.FTE3").Offset(iProductOffset, 0).Value) / 100
39015                 Else
                          'UK Fall to earth
39020                     If j = 21 Then SpecialPricing.Cells(i, j).Value = (Range("COL.FalltoEarthUK").Value / (Range("COL.FalltoEarthUK").Value + Range("COL.FalltoEarthHIGH").Value + Range("COL.FalltoEarthNI").Value))
                          
                          'Highlands and Islands fall to earth
39030                     If j = 22 Then SpecialPricing.Cells(i, j).Value = (Range("COL.FalltoEarthHIGH").Value / (Range("COL.FalltoEarthUK").Value + Range("COL.FalltoEarthHIGH").Value + Range("COL.FalltoEarthNI").Value))
                          
                          'Northern Ireland fall to earth
39040                     If j = 23 Then SpecialPricing.Cells(i, j).Value = (Range("COL.FalltoEarthNI").Value / (Range("COL.FalltoEarthUK").Value + Range("COL.FalltoEarthHIGH").Value + Range("COL.FalltoEarthNI").Value))
                              
                          'Sales advisor name
39050                     If j = 24 Then SpecialPricing.Cells(i, j).Value = Range("SAL.ContactName").Value
39051                 End If
                      
                      ' Opt Out of Auto Renewal
39060                  If j = 27 Then
39070                     If Range("BIL.OptOut") = "False" Then
39080                         SpecialPricing.Cells(i, j).Value = "Auto"
39090                     Else
39100                         SpecialPricing.Cells(i, j).Value = "Manual"
39110                     End If
39120                 End If
                      
'39130                 If j = 29 Then SpecialPricing.Cells(i, j).Value = "'" & Range("PRO.AvgHeight").Offset(iProductOffset, 0).Value _
                          & " x " & Range("PRO.AvgWidth").Offset(iProductOffset, 0).Value _
                          & " x " & Range("PRO.AvgLength").Offset(iProductOffset, 0).Value
                      
'39140                 If j = 30 Then SpecialPricing.Cells(i, j).Value = "'" & Range("PRO.MaxHeight").Offset(iProductOffset, 0).Value _
                          & " x " & Range("PRO.MaxWidth").Offset(iProductOffset, 0).Value _
                          & " x " & Range("PRO.MaxLength").Offset(iProductOffset, 0).Value
                      
39150                 If j = 29 Then SpecialPricing.Cells(i, j).Value = Range("COL.EntryPoint").Value
39151                 If j = 30 Then SpecialPricing.Cells(i, j).Value = Left(Range("PRO.TierS").Offset(iProductOffset, 0), 6)
39152                 If j = 28 Then SpecialPricing.Cells(i, j).Value = "New Customer"
39153                 If j = 10 Then SpecialPricing.Cells(i, j).Value = "01"

39160             End If
39170         Next j
39180     icountSpecial = icountSpecial + 1
39190     Else
39200     End If
39210     icountTotal = icountTotal + 1
39220 Loop
39230 SpecialPricing.Protect Password:="fruitbasket", DrawingObjects:=True, Contents:=True, Scenarios:=True
39240 SpecialPricing.EnableSelection = xlNoRestrictions
          
39250 Exit Sub
error_proc:
39260     If MsgBox("Error has occured with subroutine [SpecialPricing]. Please contact your administrator: James Valentine." & vbNewLine & vbNewLine & "ERROR TECHNICAL DETAILS" & vbNewLine & "Error number: " & Str(Err.Number) & vbNewLine & "Source: " & Err.Source & vbNewLine & "Description: " & Err.description & vbNewLine & "Line: " & Erl & vbNewLine & "DLL Error: " & Err.LastDllError & vbNewLine & vbNewLine & "Do you want to send the details of this error now?", vbYesNo, "Error with Customer Onboarding Form") = vbYes Then ThisWorkbook.FollowHyperlink ("mailto:james.valentine@royalmail.com?subject=Error with the Customer Onboarding Form " & ThisWorkbook.Sheets("Form").Range("Form.Version").Value & "&body=ERROR TECHNICAL DETAILS" & "%0D%0A" & "Error number: " & Str(Err.Number) & "%0D%0A" & "Source: " & Err.Source & "%0D%0A" & "Description: " & Err.description & "%0D%0A" & "Line: " & Erl & "%0D%0A" & "DLL Error: " & Err.LastDllError)
39270     ShutDown
End Sub


' InQuest injected base64 decoded content
' "'Qw

INQUEST-PP=macro
