Attribute VB_Name = "Create_01_Invoice"
''PrType                            = "Product code"                        - [PROD_ART]                -
''Ticket_No                         = "Ticket number"                       - [TICKETNO]                -
''City_Otkuda                       = "City of departure"                   - [ORG_STADT]               -
''City_Kuda                         = "Destination city"                    - [DEST_STADT]              -
''Data_Vilet                        = "Date from"                           - [VON_DAT]                 -
''Data_prilet                       = "Date to"                             - [BIS_DAT]                 -
''Pass_LName                        = "Participants surname"                - [TN_NACHNAM]              -
''Pass_Name                         = "Participants first name"             - [TN_VORNAME]              -
''BF_No                             = "Booking  file number   + sequence"   - [VOR_NRS]                 -
''Segment_Count                     = "Flight segments"                     - [SEGMENTE]                -
''Hotel_Name                        = "Hotel"                               - [HOT_NAME]                -
''Hotel_City                        = "Location"                            - [HOT_ORT]                 -
''Description                       = "Service description 1"               - [LB1]                     -
''Book_Fee                          = "Booking fee"                         - [BG_BETRAG]               -
''Book_Fee_VAT                      = "VAT on booking fee"                  - [BG_MWST]                 -
''Tarif                             = "Gross sum of service"                - [BL_SUMME]                -
''Tax                               = "Tax"                                 - [TAX_SUMME]               -
''Tarif_VAT                         = "VAT on gross"                        - [BL_MWST]                 -
''Tax_VAT                           = "VAT on  taxes"                       - [TAX_MWST]                -
''Service_Total                     = Tarif + Tax                           - [BL_SUMME]+ [TAX_SUMME]   -
''Service_Total_VAT                 = Tarif_VAT + Tax_VAT                   - [BL_MWST] + [TAX_MWST]    -
''Cl_Comm                           = "Customer commission"                 - [KP_SUMME]                -
''Cl_Comm_VAT                       = "VAT on  customer  commis- sion"      - [KP_MWST]                 -
''Total_BF                          = "Invoice amount"                      - [RE_SUMME]                -
''City_Rail_Dep                     = "RusFrom"                             - [SD1_From]                -
''City_Rail_to                      = "RusTo"                               - [SD1_To]                  -
''Suppl_Fee                         = "Surcharges"                          - [ZL_SUMME]                -
''Suppl_Fee_VAT                     = "VAT on surcharges (sum 1 - 3)"       - [ZL_MWST]                 -
''Suppl_fee_total                   = Suppl_Fee + Suppl_Fee_VAT
''Suppl_Fee (no VAT)          (137) = Round(Suppl_Fee, 2)
''VAT 18%                     (138) = Round(Suppl_Fee_VAT, 2)
''VAT TOTAL                   (139) = Round(Service_Total_VAT + Cl_Comm_VAT + Suppl_Fee_VAT + Book_Fee_VAT, 2)
''Suppl_Fee (VAT)             (140) = Cells(i, 137) + Cells(i, 138)
''CWT FEE (VAT)               (141) = Book_Fee + Book_Fee_VAT
''Amount of service (NO VAT)  (142) = Service_Total
''VAT 18%                     (143) = Service_Total_VAT
''Amount of service (VAT)     (144) = Service_Total + Service_Total_VAT

Public Sub Create_Invoice()
On Error GoTo Error:

Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then

    Application.ScreenUpdating = False
     
    Dim i As Double
    Dim Stroka1 As String, Stroka4 As Double, Stroka5 As Double, Stroka7 As String, Stroka8 As Double, Stroka9 As Double
    Dim Stroka1Ref As String
    Dim K_Nummer As String
    Dim Stroka5_Itog As Double, Stroka8_Itog As Double, Stroka9_Itog As Double
    Dim i_Row As Double
    Dim InvoiceSheets As String, TableSheets As String
    
    i_Row = 23
    
    TableSheets = FindTableSheets
    
    If TableSheets <> "" And WorksheetIsExist("!Invoice") Then
       InvoiceSheets = Replace(TableSheets, "Tables ", "Invoice ", 1, -1, vbTextCompare)
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| InvoiceSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(InvoiceSheets) Then
          Application.DisplayAlerts = False
          Sheets(InvoiceSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !Invoice
       Sheets("!Invoice").Copy After:=Sheets(Sheets.Count)
       Sheets("!Invoice (2)").Name = InvoiceSheets
       
       If WorksheetIsExist(TableSheets) And WorksheetIsExist(InvoiceSheets) Then
          
          Sheets(InvoiceSheets).Unprotect password:="123"
          Sheets(InvoiceSheets).Visible = True
          K_Nummer = GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)

         ' LOGO BEGIN *****************************************************************************************************************************************************************
         Set objConn = CreateObject("ADODB.Connection")
         Set objRecordset = CreateObject("ADODB.Recordset")
         objConn.ConnectionString = "Provider=SQLOLEDB;Data Source=10.200.32.10;Initial Catalog=p1minfoweekly;UID=p1minfoweekly_Manager;PWD=p1minfoweekly_Manager"
         objConn.ConnectionTimeOut = 10
         objConn.CommandTimeout = 0
         objConn.Open
         objRecordset.Open "SELECT TOP 1 * FROM OpenQuery(PostgreSQL35W, 'SELECT ""Global"" FROM ""main_carlsonw"" WHERE ""InvoiceNum"" = ''" + Sheets(TableSheets).Cells(2, 1).Text + "'';')", objConn
         If Not objRecordset.EOF Then
            If (Trim(NullSTR(objRecordset.Fields.Item(0).value))) = "|fffd||fffd|" Then
               Sheets(InvoiceSheets).Shapes.AddPicture "\\10.200.32.11\users\Everyone\Logo.png", True, True, 550, 5, 100, 100
            End If
         End If
         objRecordset.Close
         objConn.Close
         Set objConn = Nothing
         Set objRecordset = Nothing
         ' LOGO END *****************************************************************************************************************************************************************
         
         '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
          Sheets(InvoiceSheets).Cells(7, 4) = "|fffd||fffd||fffd||fffd|  " + Sheets(TableSheets).Cells(2, 3).Text + "  INVOI|fffd|E"
          Sheets(InvoiceSheets).Cells(8, 4) = "|fffd||fffd| " + Format(Sheets(TableSheets).Cells(2, 4), "DD.MM.YYYY")
          Dim Temp_K_Nummer_Info As String
          Temp_K_Nummer_Info = Get_K_Nummer_Info(K_Nummer)
          Sheets(InvoiceSheets).Cells(14, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Get_Info("name_ru", Temp_K_Nummer_Info)
          Sheets(InvoiceSheets).Cells(16, 3) = "|fffd||fffd||fffd||fffd||fffd|/Address: " + Get_Info("COUNTRY", Temp_K_Nummer_Info) + " " + Get_Info("POSTCODE", Temp_K_Nummer_Info) + " " + Get_Info("CITY", Temp_K_Nummer_Info) + " " + Get_Info("STREET", Temp_K_Nummer_Info)
          Sheets(InvoiceSheets).Cells(17, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd|) / INN: " + Get_Info("VAT_ID", Temp_K_Nummer_Info)
          Sheets(InvoiceSheets).Cells(18, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|), |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd|.|fffd|.) - |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|" + Get_Info("Contract_Date", Temp_K_Nummer_Info)
          Sheets(InvoiceSheets).Cells(12, 4) = Get_NameProject(Get_Info("References", Temp_K_Nummer_Info))
          '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 5 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|.
          Sheets(InvoiceSheets).Cells(28, 3) = Get_Info("PaymentDeadline", Temp_K_Nummer_Info)
'          'Please send us payment within 5 working days.
'          Sheets(InvoiceSheets).Cells(30, 3) = Replace(Sheets(InvoiceSheets).Cells(28, 3).Text, "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "Please send us payment within", 1, -1, vbTextCompare)
'          Sheets(InvoiceSheets).Cells(30, 3) = Replace(Sheets(InvoiceSheets).Cells(30, 3).Text, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|.", "banking days.", 1, -1, vbTextCompare)
    
          'Twinsen 05.02.2016
          'Nadezhda Molchanova |fffd||fffd| 04.02.2016 15:39 |fffd||fffd| |fffd||fffd||fffd||fffd| A00518 |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|):
          If Get_Info("CUST_NO", Temp_K_Nummer_Info) = "A00518" Then
             Sheets(InvoiceSheets).Rows("7:7").Insert Shift:=xlDown
             Sheets(InvoiceSheets).Rows("7:7").Insert Shift:=xlDown
             Sheets(InvoiceSheets).Rows("7:7").Insert Shift:=xlDown
             i_Row = 26
             Sheets(InvoiceSheets).Cells(7, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|:"
             Sheets(InvoiceSheets).Cells(7, 4) = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|  115054, |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd|.53 |fffd||fffd||fffd| 5, 2 |fffd||fffd||fffd||fffd|"
             Sheets(InvoiceSheets).Cells(8, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|:"
             Sheets(InvoiceSheets).Cells(8, 4) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ""|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| , |fffd||fffd||fffd| ."" (|fffd||fffd||fffd| )"
             Sheets(InvoiceSheets).Cells(9, 4) = "117485 |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| , 30/1, |fffd||fffd||fffd|. 2"
          End If
          ''*****************
          'Twinsen 14.04.2017
          UpdateTEXT InvoiceSheets, Sheets(TableSheets).Cells(2, 4)
          If Mid(Sheets(InvoiceSheets).Cells(17, 3), 1, 48) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd|) / INN: " Then Sheets(InvoiceSheets).Cells(17, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd|) / INN: " + Get_Info("VAT_ID", Temp_K_Nummer_Info)
          If Mid(Sheets(InvoiceSheets).Cells(20, 3), 1, 48) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd|) / INN: " Then Sheets(InvoiceSheets).Cells(20, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd|) / INN: " + Get_Info("VAT_ID", Temp_K_Nummer_Info)
          
          If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
             i = 2
             While Sheets(TableSheets).Cells(i, 2).Text <> Empty
                StrokaInfo = ""
                Stroka1 = ""
                Stroka4 = 0
                Stroka5 = 0
                Stroka7 = ""
                Stroka8 = 0
                Stroka9 = 0
                Stroka1Ref = Get_Stroka1Ref(TableSheets, i)
          
                Select Case ProductType(Sheets(TableSheets).Cells(i, 8).Text)
             'Air***
                   Case "Air"
'                      If Sheets(TableSheets).Cells(i, 13) < 2 Then
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      Else
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + " - " + Sheets(TableSheets).Cells(i, 15).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      End If
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 70).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             'Hotel***
                   Case "Hotel"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " + _
                                Sheets(TableSheets).Cells(i, 19).Text + " " + Sheets(TableSheets).Cells(i, 20).Text + " |fffd|."
             'VISA***
                   Case "VISA"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; " + _
                                Sheets(TableSheets).Cells(i, 10).Text
             '|fffd||fffd||fffd||fffd| Rail
                   Case "Rail"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 45).Text + " - " + Sheets(TableSheets).Cells(i, 46).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Other
                   Case "Other"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             '|fffd||fffd||fffd||fffd| Fee
                   Case "Fee"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + ";" + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Else!!!
                   Case Else
                      Stroka1 = ""
                End Select
                Stroka4 = Sheets(TableSheets).Cells(i, 21)
                Stroka5 = Sheets(TableSheets).Cells(i, 21)
                Stroka8 = Sheets(TableSheets).Cells(i, 22)
                Stroka9 = Stroka5 + Stroka8
                If Sheets(TableSheets).Cells(i, 22) = 0 Then
                   Stroka7 = "0%"
                Else
                   If ProductType(Sheets(TableSheets).Cells(i, 8).Text) = "Air" Then
                      Stroka7 = "10%"
                   Else
                      Stroka7 = VatNDS
                   End If
                End If
    '''*********************************************************************************************************************
          
                If Stroka1 <> "" Then
                  'Twinsen c 16.10.2015 Stroka1Ref
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                  'Twinsen c 19.10.2016 Nadezhda Molchanova |fffd||fffd||fffd| A00086 |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| Amount of service (VAT) |fffd||fffd||fffd||fffd||fffd| 0
                   If Not (K_Nummer = "A00086" And Stroka9 = 0) Then
                      AddStroka InvoiceSheets, i_Row, Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                  End If
                Else
                   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "]"
                End If
          
    '''*********************************************************************************************************************
          
                Dim Fee_Value As Double
                Dim Fee_VAT As Double
                Fee_Value = 0
                Fee_VAT = 0
       
             '***1***[ClComm]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 39) <> 0 Then
                   StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   Fee_Value = Sheets(TableSheets).Cells(i, 39)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 40)
                   Stroka4 = 0 - Fee_Value
                   Stroka8 = 0 - Fee_VAT
                   Stroka9 = Stroka4 + Stroka8
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka InvoiceSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
       
             '***2.1***[Supplier Fee]
          '***'Supplier Fee - |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - 24/25/26
                If Sheets(TableSheets).Cells(i, 26) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 24)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 25)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Supplier Fee "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka InvoiceSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
       
             '***2.2***[Surcharge 2]
          '***'Surcharge 2 - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 27/28/29
                If Sheets(TableSheets).Cells(i, 29) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 27)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 28)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Surcharge 2 "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka InvoiceSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If
    
              '***2.3***[Additional Fee for CC]
          '***'Additional Fee for CC - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 30/31/32
                If Sheets(TableSheets).Cells(i, 32) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 30)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 31)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Additional Fee for CC "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka InvoiceSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If
       
             '***3***[BookFee]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 33) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 33)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 34)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "CWT Charge "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   'c 19.04.2016 Nadezhda Molchanova
                   If Fee_VAT = 0 And K_Nummer = "A00086" Then Stroka7 = 0
                   Stroka9 = Stroka4 + Stroka8
             
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka InvoiceSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
    
    '''*********************************************************************************************************************
    
                i = i + 1
             Wend
             
             Sheets(InvoiceSheets).Rows(Str(i_Row)).Delete Shift:=xlUp
             Sheets(InvoiceSheets).Cells(i_Row, 7) = Round(Stroka5_Itog, 2)
             Sheets(InvoiceSheets).Cells(i_Row, 9) = Round(Stroka8_Itog, 2)
             Sheets(InvoiceSheets).Cells(i_Row, 10) = Round(Stroka9_Itog, 2)
             Sheets(InvoiceSheets).Activate
             Sheets(InvoiceSheets).Cells(1, 1).Select
             Application.ScreenUpdating = True
          Else
             MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
             '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| InvoiceSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
             If WorksheetIsExist(InvoiceSheets) Then
                Application.DisplayAlerts = False
                Sheets(InvoiceSheets).Delete
                Application.DisplayAlerts = True
             End If
          End If
       Else
          If WorksheetIsExist(TableSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
          If WorksheetIsExist(InvoiceSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !Invoice"
       End If
    Else
       If TableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
       If WorksheetIsExist("!Invoice") = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| !Invoice"
    End If

End If

    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_Invoice " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Sub AddStroka(InInvoiceSheets As String, InI_Row As Double, InStroka1 As String, InStroka4 As Double, InStroka5 As Double, InStroka7 As String, InStroka8 As Double, InStroka9 As Double, InPrType As String)
  '|fffd| 1 |fffd||fffd||fffd||fffd||fffd| 2015 ( 04 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ERD ) (23 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HIS)
  If InStr(1, ProductTypeNoNDS, "[" + InPrType + "]", vbTextCompare) Then
     If InStroka8 = 0 Then InStroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
  End If
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   Sheets(InInvoiceSheets).Rows(Str(InI_Row)).Copy
   Sheets(InInvoiceSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   Sheets(InInvoiceSheets).Cells(InI_Row, 2) = Sheets(InInvoiceSheets).Cells(InI_Row - 1, 2) + 1
   Sheets(InInvoiceSheets).Cells(InI_Row, 3) = InStroka1
   Sheets(InInvoiceSheets).Cells(InI_Row, 6) = InStroka4
   Sheets(InInvoiceSheets).Cells(InI_Row, 7) = InStroka5
   
   If InStroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|" Then
      Sheets(InInvoiceSheets).Cells(InI_Row, 9) = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
   Else
      Sheets(InInvoiceSheets).Cells(InI_Row, 9) = InStroka8
   End If
   Sheets(InInvoiceSheets).Cells(InI_Row, 10) = InStroka9
End Sub

Attribute VB_Name = "Create_02_Bulk"
Public Sub Create_All_Bulk()
Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd|?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then
   Create_Bulk
End If
End Sub

Private Sub Create_Bulk()
On Error GoTo Error:

    Application.ScreenUpdating = False
    
    Dim i As Double
    Dim Stroka1 As String, Stroka4 As Double, Stroka5 As Double, Stroka7 As String, Stroka8 As Double, Stroka9 As Double
    Dim Stroka1Ref As String
    Dim K_Nummer As String, B_Nummer As String
    Dim Stroka5_Itog As Double, Stroka8_Itog As Double, Stroka9_Itog As Double
    Dim i_Row As Double
    Dim BulkSheets As String, TableSheets As String
    
    i_Row = 23
    
    TableSheets = FindTableSheets
    
    If TableSheets <> "" And WorksheetIsExist("!Bulk") Then
       
       BulkSheets = Replace(TableSheets, "Tables ", "Bulk ", 1, -1, vbTextCompare)
       B_Nummer = Replace(TableSheets, "Tables ", "", 1, -1, vbTextCompare)

       '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       K_Nummer = GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| BulkSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(BulkSheets) Then
          Application.DisplayAlerts = False
          Sheets(BulkSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !Bulk
       Sheets("!Bulk").Copy After:=Sheets(Sheets.Count)
       Sheets("!Bulk (2)").Name = BulkSheets
       
       If WorksheetIsExist(TableSheets) And WorksheetIsExist(BulkSheets) Then
          
          Sheets(BulkSheets).Unprotect password:="123"
          Sheets(BulkSheets).Visible = True
          
          '|fffd||fffd||fffd||fffd| A00086 |fffd||fffd||fffd| ILO A00242 |fffd||fffd||fffd| UNHCR A00241
          ' Tatyana Burova 4 |fffd||fffd||fffd||fffd| 2019 |fffd|. 16:08
          ' LOGO BEGIN *****************************************************************************************************************************************************************
          If K_Nummer = "A00086" Or K_Nummer = "A00242" Or K_Nummer = "A00241" Then
             Sheets(BulkSheets).Shapes.AddPicture "\\10.200.32.11\users\Bulks\!Finished\USD.png", True, True, 590, 70, 252, 67
          End If
          ' LOGO END *****************************************************************************************************************************************************************
          
          '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
          Sheets(BulkSheets).Cells(6, 1) = "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|" + B_Nummer + " |fffd||fffd| " + Format(Sheets(TableSheets).Cells(2, 4), "DD.MM.YYYY")
          Sheets(BulkSheets).Cells(11, 2) = "|fffd||fffd||fffd|/|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|:                 7705857799/770501001"
          Dim Temp_K_Nummer_Info As String
          Temp_K_Nummer_Info = Get_K_Nummer_Info(K_Nummer)
          
          'Sheets(BulkSheets).Cells(2, 12) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|:     -"
          'Sheets(BulkSheets).Cells(2, 13) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|:      -"
          Sheets(BulkSheets).Cells(15, 2) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|:                       " + Get_Info("name_ru", Temp_K_Nummer_Info)
          Sheets(BulkSheets).Cells(16, 2) = "|fffd||fffd||fffd||fffd||fffd|:                            " + Get_Info("COUNTRY", Temp_K_Nummer_Info) + " " + Get_Info("POSTCODE", Temp_K_Nummer_Info) + " " + Get_Info("CITY", Temp_K_Nummer_Info) + " " + Get_Info("STREET", Temp_K_Nummer_Info)
          Sheets(BulkSheets).Cells(17, 2) = "|fffd||fffd||fffd|/|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|                " + Get_Info("VAT_ID", Temp_K_Nummer_Info)

          'Twinsen 05.02.2016
          'Nadezhda Molchanova |fffd||fffd| 04.02.2016 15:39 |fffd||fffd| |fffd||fffd||fffd||fffd| A00518 |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|):
          If Get_Info("CUST_NO", Temp_K_Nummer_Info) = "A00518" Then
             Sheets(BulkSheets).Cells(12, 2) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|:     |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|  115054, |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd|.53 |fffd||fffd||fffd| 5, 2 |fffd||fffd||fffd||fffd|"
             Sheets(BulkSheets).Cells(13, 2) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|:      |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ""|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| , |fffd||fffd||fffd| ."" (|fffd||fffd||fffd| )" + Chr(13) + Chr(10) + "                                  117485 |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| , 30/1, |fffd||fffd||fffd|. 2"
             Sheets(BulkSheets).Rows("13:13").RowHeight = 27
          End If
          ''*****************

          If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
             i = 2
             While Sheets(TableSheets).Cells(i, 2).Text <> Empty
                StrokaInfo = ""
                Stroka1 = ""
                Stroka4 = 0
                Stroka5 = 0
                Stroka7 = ""
                Stroka8 = 0
                Stroka9 = 0
                Stroka1Ref = Get_Stroka1Ref(TableSheets, i)
                
                tempProductType = ProductType(Sheets(TableSheets).Cells(i, 8).Text)
                
                Select Case ProductType(Sheets(TableSheets).Cells(i, 8).Text)
             'Air***
                   Case "Air"
'                      If Sheets(TableSheets).Cells(i, 13) < 2 Then
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      Else
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + " - " + Sheets(TableSheets).Cells(i, 15).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      End If
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 70).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             'Hotel***
                   Case "Hotel"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " + _
                                Sheets(TableSheets).Cells(i, 19).Text + " " + Sheets(TableSheets).Cells(i, 20).Text + " |fffd|."
             'VISA***
                   Case "VISA"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; " + _
                                Sheets(TableSheets).Cells(i, 10).Text
             '|fffd||fffd||fffd||fffd| Rail
                   Case "Rail"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 45).Text + " - " + Sheets(TableSheets).Cells(i, 46).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Other
                   Case "Other"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             '|fffd||fffd||fffd||fffd| Fee
                   Case "Fee"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + ";" + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Else!!!
                   Case Else
                      Stroka1 = ""
                End Select
                              
                Stroka4 = Sheets(TableSheets).Cells(i, 21)
                Stroka5 = Sheets(TableSheets).Cells(i, 21)
                Stroka8 = Sheets(TableSheets).Cells(i, 22)
                Stroka9 = Stroka5 + Stroka8
                If Sheets(TableSheets).Cells(i, 22) = 0 Then
                   Stroka7 = "0%"
                Else
                   If ProductType(Sheets(TableSheets).Cells(i, 8).Text) = "Air" Then
                      Stroka7 = "10%"
                   Else
                      Stroka7 = VatNDS
                   End If
                End If
    
        '''*********************************************************************************************************************
    
                If Stroka1 <> "" Then
                   'Twinsen c 16.10.2015 Stroka1Ref
                   '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                   'Twinsen c 19.10.2016 Nadezhda Molchanova |fffd||fffd||fffd| A00086 |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| Amount of service (VAT) |fffd||fffd||fffd||fffd||fffd| 0
                   If tempProductType <> "Air" And tempProductType <> "Rail" Then
                      If Not (K_Nummer = "A00086" And Stroka9 = 0) Then
                         AddStroka BulkSheets, i_Row, Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                         '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                         Stroka5_Itog = Stroka5_Itog + Stroka5
                         Stroka8_Itog = Stroka8_Itog + Stroka8
                         Stroka9_Itog = Stroka9_Itog + Stroka9
                         i_Row = i_Row + 1
                      End If
                   End If
                Else
                   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Bulk |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "]"
                End If
    '''*********************************************************************************************************************
                
                Dim Fee_Value As Double
                Dim Fee_VAT As Double
                Fee_Value = 0
                Fee_VAT = 0
       
             '***1***[ClComm]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 39) <> 0 Then
                   StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   Fee_Value = Sheets(TableSheets).Cells(i, 39)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 40)
                   Stroka4 = 0 - Fee_Value
                   Stroka8 = 0 - Fee_VAT
                   Stroka9 = Stroka4 + Stroka8
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Bulk |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
             
             '***2.1***[Supplier Fee]
          '***'Supplier Fee - |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - 24/25/26
                If Sheets(TableSheets).Cells(i, 26) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 24)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 25)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Supplier Fee "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Bulk |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
       
             '***2.2***[Surcharge 2]
          '***'Surcharge 2 - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 27/28/29
                If Sheets(TableSheets).Cells(i, 29) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 27)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 28)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Surcharge 2 "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Bulk |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If
    
              '***2.3***[Additional Fee for CC]
          '***'Additional Fee for CC - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 30/31/32
                If Sheets(TableSheets).Cells(i, 32) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 30)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 31)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Additional Fee for CC "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Bulk |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If
       
             '***3***[BookFee]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 33) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 33)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 34)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "CWT Charge "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   'c 19.04.2016 Nadezhda Molchanova
                   If Fee_VAT = 0 And K_Nummer = "A00086" Then Stroka7 = 0
                   Stroka9 = Stroka4 + Stroka8
             
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Bulk |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
    
    '''*********************************************************************************************************************
    
1:              i = i + 1
             Wend
             
             Sheets(BulkSheets).Rows(Str(i_Row)).Delete Shift:=xlUp
             Sheets(BulkSheets).Cells(i_Row, 8) = Round(Stroka5_Itog, 2)
             Sheets(BulkSheets).Cells(i_Row, 11) = Round(Stroka8_Itog, 2)
             Sheets(BulkSheets).Cells(i_Row, 12) = Round(Stroka9_Itog, 2)
             
             'Twinsen 30.09.2017
             If CDate(Sheets(TableSheets).Cells(2, 4)) >= "01.10.2017" Then
                Sheets(BulkSheets).Activate
                Sheets(BulkSheets).Range("D20:E" + Trim(Str(i_Row))).Insert Shift:=xlToRight
                Sheets(BulkSheets).Range("E20:E" + Trim(Str(i_Row))).Delete Shift:=xlToLeft
                Sheets(BulkSheets).Range("P20:P" + Trim(Str(i_Row))).Select
                Selection.Copy
                Sheets(BulkSheets).Range("D20").Select
                ActiveSheet.Paste
                Sheets(BulkSheets).Cells(20, 4) = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
                Sheets(BulkSheets).Cells(22, 4) = "1|fffd|"
                If Sheets(BulkSheets).Cells(i_Row + 3, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" And Sheets(BulkSheets).Cells(i_Row + 6, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
                   Sheets(BulkSheets).Cells(i_Row + 4, 3).Select
                   Selection.Copy
                   Sheets(BulkSheets).Cells(i_Row + 7, 3).Select
                   ActiveSheet.Paste
                End If
             End If
             
             'Twinsen 26.06.2017
             If CDate(Sheets(TableSheets).Cells(2, 4)) >= "01.07.2017" Then
                Sheets(BulkSheets).Rows("5:5").Insert Shift:=xlDown
                Sheets(BulkSheets).Rows("5:5").Insert Shift:=xlDown
                Sheets(BulkSheets).Cells(5, 12) = "(|fffd| |fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| "
                Sheets(BulkSheets).Cells(6, 12) = "|fffd||fffd| 25.05.2017 |fffd| 625)"
                Sheets(BulkSheets).Rows("21:21").Insert Shift:=xlDown
                Sheets(BulkSheets).Cells(21, 2) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|): -"
             End If
             
             'Twinsen 14.04.2017
             UpdateTEXT BulkSheets, Sheets(TableSheets).Cells(2, 4)
             If Mid(Sheets(BulkSheets).Cells(17, 2), 1, 18) = "|fffd||fffd||fffd|/|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then Sheets(BulkSheets).Cells(17, 2) = "|fffd||fffd||fffd|/|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|                " + Get_Info("VAT_ID", Temp_K_Nummer_Info)
             If Mid(Sheets(BulkSheets).Cells(19, 2), 1, 18) = "|fffd||fffd||fffd|/|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then Sheets(BulkSheets).Cells(19, 2) = "|fffd||fffd||fffd|/|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|                " + Get_Info("VAT_ID", Temp_K_Nummer_Info)
             
             Sheets(BulkSheets).Activate
             Sheets(BulkSheets).Cells(1, 1).Select
             Application.ScreenUpdating = True
          Else
             MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
             '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| BulkSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
             If WorksheetIsExist(BulkSheets) Then
                Application.DisplayAlerts = False
                Sheets(BulkSheets).Delete
                Application.DisplayAlerts = True
             End If
          End If
       Else
          If WorksheetIsExist(TableSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
          If WorksheetIsExist(BulkSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !Bulk"
       End If
    Else
       If TableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
       If WorksheetIsExist("!Bulk") = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| !Bulk"
    End If

    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_Bulk " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Sub AddStroka(InBulkSheets As String, InI_Row As Double, InStroka1 As String, InStroka4 As Double, InStroka5 As Double, InStroka7 As String, InStroka8 As Double, InStroka9 As Double, InPrType As String)
  '|fffd| 1 |fffd||fffd||fffd||fffd||fffd| 2015 ( 04 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ERD ) (23 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HIS)
  If InStr(1, ProductTypeNoNDS, "[" + InPrType + "]", vbTextCompare) Then
     If InStroka8 = 0 Then InStroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
  End If
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   Sheets(InBulkSheets).Rows(Str(InI_Row)).Copy
   Sheets(InBulkSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   Sheets(InBulkSheets).Cells(InI_Row, 2) = Sheets(InBulkSheets).Cells(InI_Row - 1, 2) + 1
   Sheets(InBulkSheets).Cells(InI_Row, 3) = InStroka1
   'Sheets(InBulkSheets).Cells(InI_Row, 7) = InStroka4
   Sheets(InBulkSheets).Cells(InI_Row, 8) = InStroka5
   Sheets(InBulkSheets).Cells(InI_Row, 10) = InStroka7
   If Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|" Then
      Sheets(InBulkSheets).Cells(InI_Row, 11) = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
   Else
      Sheets(InBulkSheets).Cells(InI_Row, 11) = InStroka8
   End If
   Sheets(InBulkSheets).Cells(InI_Row, 12) = InStroka9
End Sub

Attribute VB_Name = "Create_03_Consignment"
Public Sub Create_ALL_Consignment()
Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then
   Create_Consignment (0)
   Create_Consignment (1)
End If
End Sub

Private Sub Create_Consignment(InAirRail As Boolean)
On Error GoTo Error:

    Application.ScreenUpdating = False
    
    Dim i As Double
    Dim Stroka1 As String, Stroka4 As Double, Stroka5 As Double, Stroka7 As String, Stroka8 As Double, Stroka9 As Double
    Dim Stroka1Ref As String
    Dim K_Nummer As String, B_Nummer As String
    Dim Stroka5_Itog As Double, Stroka8_Itog As Double, Stroka9_Itog As Double
    Dim i_Row As Double
    Dim ConsignmentSheets As String, TableSheets As String
    
    i_Row = 19
    
    TableSheets = FindTableSheets
    
    If TableSheets <> "" And WorksheetIsExist("!Consignment") Then
       '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| Air/Rail
       If InAirRail Then
          '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| 'C'
          ConsignmentSheets = Replace(TableSheets, "Tables ", "Consignment C", 1, -1, vbTextCompare)
          B_Nummer = Replace(TableSheets, "Tables ", "C", 1, -1, vbTextCompare)
       Else
          ConsignmentSheets = Replace(TableSheets, "Tables ", "Consignment ", 1, -1, vbTextCompare)
          B_Nummer = Replace(TableSheets, "Tables ", "", 1, -1, vbTextCompare)
       End If
       '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       K_Nummer = GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ConsignmentSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(ConsignmentSheets) Then
          Application.DisplayAlerts = False
          Sheets(ConsignmentSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !Consignment
       Sheets("!Consignment").Copy After:=Sheets(Sheets.Count)
       Sheets("!Consignment (2)").Name = ConsignmentSheets
       
       If WorksheetIsExist(TableSheets) And WorksheetIsExist(ConsignmentSheets) Then
          
          Sheets(ConsignmentSheets).Unprotect password:="123"
          Sheets(ConsignmentSheets).Visible = True
          
          '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
          Sheets(ConsignmentSheets).Cells(13, 6) = B_Nummer
          Sheets(ConsignmentSheets).Cells(13, 8) = Format(Sheets(TableSheets).Cells(2, 4), "DD.MM.YYYY")
          
Project:
          'Sheets(ConsignmentSheets).Cells(11, 2) = "|fffd||fffd||fffd|/|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|:                 7705857799/770501001"
          Dim Temp_K_Nummer_Info As String
          Temp_K_Nummer_Info = Get_K_Nummer_Info(K_Nummer)
          
          Sheets(ConsignmentSheets).Cells(7, 3) = Get_Info("name_ru", Temp_K_Nummer_Info) + " " + Get_Info("COUNTRY", Temp_K_Nummer_Info) + " " + Get_Info("POSTCODE", Temp_K_Nummer_Info) + " " + Get_Info("CITY", Temp_K_Nummer_Info) + " " + Get_Info("STREET", Temp_K_Nummer_Info)
          Sheets(ConsignmentSheets).Cells(9, 3) = Get_Info("name_ru", Temp_K_Nummer_Info) + " " + Get_Info("COUNTRY", Temp_K_Nummer_Info) + " " + Get_Info("POSTCODE", Temp_K_Nummer_Info) + " " + Get_Info("CITY", Temp_K_Nummer_Info) + " " + Get_Info("STREET", Temp_K_Nummer_Info)
          Sheets(ConsignmentSheets).Cells(10, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " + Get_Info("Contract_Date", Temp_K_Nummer_Info)
          Sheets(ConsignmentSheets).Cells(13, 10) = Get_NameProject(Get_Info("References", Temp_K_Nummer_Info))

          'Twinsen 05.02.2016
          'Nadezhda Molchanova |fffd||fffd| 04.02.2016 15:39 |fffd||fffd| |fffd||fffd||fffd||fffd| A00518 |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|):
          If Get_Info("CUST_NO", Temp_K_Nummer_Info) = "A00518" Then
             Sheets(ConsignmentSheets).Cells(4, 3) = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|  115054, |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd|.53 |fffd||fffd||fffd| 5, 2 |fffd||fffd||fffd||fffd| |fffd||fffd||fffd|.: +7 495 725-78-88"
             Sheets(ConsignmentSheets).Cells(7, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ""|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| , |fffd||fffd||fffd| ."" (|fffd||fffd||fffd| ) " + Chr(13) + Chr(10) + "117485 |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| , 30/1, |fffd||fffd||fffd|. 2"
          End If
          ''*****************
          'Twinsen 14.04.2017
          UpdateTEXT ConsignmentSheets, Sheets(TableSheets).Cells(2, 4)

          If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
             i = 2
             While Sheets(TableSheets).Cells(i, 2).Text <> Empty
                StrokaInfo = ""
                Stroka1 = ""
                Stroka4 = 0
                Stroka5 = 0
                Stroka7 = ""
                Stroka8 = 0
                Stroka9 = 0
                Stroka1Ref = Get_Stroka1Ref(TableSheets, i)
          
                tempProductType = ProductType(Sheets(TableSheets).Cells(i, 8).Text)
                
                Select Case ProductType(Sheets(TableSheets).Cells(i, 8).Text)
             'Air***
                   Case "Air"
'                      If Sheets(TableSheets).Cells(i, 13) < 2 Then
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      Else
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + " - " + Sheets(TableSheets).Cells(i, 15).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      End If
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 70).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             'Hotel***
                   Case "Hotel"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " + _
                                Sheets(TableSheets).Cells(i, 19).Text + " " + Sheets(TableSheets).Cells(i, 20).Text + " |fffd|."
             'VISA***
                   Case "VISA"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; " + _
                                Sheets(TableSheets).Cells(i, 10).Text
             '|fffd||fffd||fffd||fffd| Rail
                   Case "Rail"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 45).Text + " - " + Sheets(TableSheets).Cells(i, 46).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Other
                   Case "Other"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             '|fffd||fffd||fffd||fffd| Fee
                   Case "Fee"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + ";" + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Else!!!
                   Case Else
                      Stroka1 = ""
                End Select
                
                '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| Air/Rail
                If InAirRail Then
                   If tempProductType <> "Air" And tempProductType <> "Rail" Then GoTo 1
                Else
                   If tempProductType = "Air" Or tempProductType = "Rail" = True Then GoTo 1
                End If
                
                Stroka4 = Sheets(TableSheets).Cells(i, 21)
                Stroka5 = Sheets(TableSheets).Cells(i, 21)
                Stroka8 = Sheets(TableSheets).Cells(i, 22)
                Stroka9 = Stroka5 + Stroka8
                If Sheets(TableSheets).Cells(i, 22) = 0 Then
                   Stroka7 = "0%"
                Else
                   If ProductType(Sheets(TableSheets).Cells(i, 8).Text) = "Air" Then
                      Stroka7 = "10%"
                   Else
                      Stroka7 = VatNDS
                   End If
                End If
          
    '''*********************************************************************************************************************
          
                If Stroka1 <> "" Then
                  'Twinsen c 16.10.2015 Stroka1Ref
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                   AddStroka ConsignmentSheets, i_Row, Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                   Stroka5_Itog = Stroka5_Itog + Stroka5
                   Stroka8_Itog = Stroka8_Itog + Stroka8
                   Stroka9_Itog = Stroka9_Itog + Stroka9
                   i_Row = i_Row + 1
                Else
                   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "]"
                End If

    '''*********************************************************************************************************************
          
                Dim Fee_Value As Double
                Dim Fee_VAT As Double
                Fee_Value = 0
                Fee_VAT = 0
                
               '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| Air/Rail
                If InAirRail Then GoTo 1
                
             '***1***[ClComm]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 39) <> 0 Then
                   StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   Fee_Value = Sheets(TableSheets).Cells(i, 39)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 40)
                   Stroka4 = 0 - Fee_Value
                   Stroka8 = 0 - Fee_VAT
                   Stroka9 = Stroka4 + Stroka8
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ConsignmentSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If

             '***2.1***[Supplier Fee]
          '***'Supplier Fee - |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - 24/25/26
                If Sheets(TableSheets).Cells(i, 26) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 24)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 25)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Supplier Fee "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ConsignmentSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If

             '***2.2***[Surcharge 2]
          '***'Surcharge 2 - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 27/28/29
                If Sheets(TableSheets).Cells(i, 29) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 27)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 28)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Surcharge 2 "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ConsignmentSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If

              '***2.3***[Additional Fee for CC]
          '***'Additional Fee for CC - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 30/31/32
                If Sheets(TableSheets).Cells(i, 32) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 30)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 31)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Additional Fee for CC "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ConsignmentSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If

             '***3***[BookFee]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 33) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 33)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 34)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "CWT Charge "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   'c 19.04.2016 Nadezhda Molchanova
                   If Fee_VAT = 0 And K_Nummer = "A00086" Then Stroka7 = 0
                   Stroka9 = Stroka4 + Stroka8

                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ConsignmentSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
    
    '''*********************************************************************************************************************
    
1:              i = i + 1
             Wend
             
             Sheets(ConsignmentSheets).Rows(Str(i_Row)).Delete Shift:=xlUp
             Sheets(ConsignmentSheets).Cells(i_Row, 12) = Round(Stroka5_Itog, 2)
             Sheets(ConsignmentSheets).Cells(i_Row, 14) = Round(Stroka8_Itog, 2)
             Sheets(ConsignmentSheets).Cells(i_Row, 15) = Round(Stroka9_Itog, 2)
             Sheets(ConsignmentSheets).Cells(i_Row + 1, 12) = Round(Stroka5_Itog, 2)
             Sheets(ConsignmentSheets).Cells(i_Row + 1, 14) = Round(Stroka8_Itog, 2)
             Sheets(ConsignmentSheets).Cells(i_Row + 1, 15) = Round(Stroka9_Itog, 2)
             Sheets(ConsignmentSheets).Activate
             
             '"|fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
             Sheets(ConsignmentSheets).Cells(i_Row + 4, 3) = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(i_Row - 19)
             '"|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| "  + Trim(Str(AKT_Itog)) + " |fffd||fffd||fffd|."
             Sheets(ConsignmentSheets).Cells(i_Row + 10, 1) = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| " + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(Stroka9_Itog)
             
             Sheets(ConsignmentSheets).Cells(1, 1).Select
             Application.ScreenUpdating = True
          Else
             MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
             '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ConsignmentSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
             If WorksheetIsExist(ConsignmentSheets) Then
                Application.DisplayAlerts = False
                Sheets(ConsignmentSheets).Delete
                Application.DisplayAlerts = True
             End If
          End If
       Else
          If WorksheetIsExist(TableSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
          If WorksheetIsExist(ConsignmentSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !Consignment"
       End If
    Else
       If TableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
       If WorksheetIsExist("!Invoice") = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| !Consignment"
    End If

    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_Consignment " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Sub AddStroka(InConsignmentSheets As String, InI_Row As Double, InStroka1 As String, InStroka4 As Double, InStroka5 As Double, InStroka7 As String, InStroka8 As Double, InStroka9 As Double, InPrType As String)
  '|fffd| 1 |fffd||fffd||fffd||fffd||fffd| 2015 ( 04 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ERD ) (23 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HIS)
  If InStr(1, ProductTypeNoNDS, "[" + InPrType + "]", vbTextCompare) Then
     If InStroka8 = 0 Then InStroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
  End If
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   Sheets(InConsignmentSheets).Rows(Str(InI_Row)).Copy
   Sheets(InConsignmentSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   If InI_Row <> 19 Then Sheets(InConsignmentSheets).Cells(InI_Row, 1) = Sheets(InConsignmentSheets).Cells(InI_Row - 1, 1) + 1
   Sheets(InConsignmentSheets).Cells(InI_Row, 2) = InStroka1
   Sheets(InConsignmentSheets).Cells(InI_Row, 11) = InStroka4
   Sheets(InConsignmentSheets).Cells(InI_Row, 12) = InStroka5
   Sheets(InConsignmentSheets).Cells(InI_Row, 13) = InStroka7
   If Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|" Then
      Sheets(InConsignmentSheets).Cells(InI_Row, 14) = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
   Else
      Sheets(InConsignmentSheets).Cells(InI_Row, 14) = InStroka8
   End If
   Sheets(InConsignmentSheets).Cells(InI_Row, 15) = InStroka9
   
End Sub




Attribute VB_Name = "Create_04_Short"
Public Sub Create_ALL_Short()
Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then
   Create_Short (0)
   Create_Short (1)
End If
End Sub

Private Sub Create_Short(InAirRail As Boolean)
On Error GoTo Error:

    Application.ScreenUpdating = False
    
    Dim i As Double
    Dim Stroka1 As String, Stroka4 As Double, Stroka5 As Double, Stroka7 As String, Stroka8 As Double, Stroka9 As Double
    Dim Stroka1Ref As String
    Dim K_Nummer As String, B_Nummer As String
    Dim Stroka5_Itog As Double, Stroka8_Itog As Double, Stroka9_Itog As Double
    Dim i_Row As Double
    Dim ShortSheets As String, TableSheets As String
    Dim AKT_Itog As Double, AKT_Itog_TotalService As Double, AKT_Itog_CWT_FEE As Double, AKT_Itog_Supplier_FEE As Double, AKT_Itog_CC_FEE As Double
    Dim AKT_Itog_VAT As Double, AKT_Itog_TotalService_VAT As Double, AKT_Itog_CWT_FEE_VAT As Double, AKT_Itog_Supplier_FEE_VAT As Double, AKT_Itog_CC_FEE_VAT As Double
    
    i_Row = 10
    
    TableSheets = FindTableSheets
    
    If TableSheets <> "" And WorksheetIsExist("!AKT") Then
       '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| Air/Rail
       If InAirRail Then
          '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| '.1' |fffd||fffd||fffd| '.2'
          ShortSheets = Replace(TableSheets, "Tables ", "Short ", 1, -1, vbTextCompare) + ".2"
          B_Nummer = Replace(TableSheets, "Tables ", "", 1, -1, vbTextCompare) + ".2"
       Else
          ShortSheets = Replace(TableSheets, "Tables ", "Short ", 1, -1, vbTextCompare) + ".1"
          B_Nummer = Replace(TableSheets, "Tables ", "", 1, -1, vbTextCompare) + ".1"
       End If
       '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       K_Nummer = GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ShortSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(ShortSheets) Then
          Application.DisplayAlerts = False
          Sheets(ShortSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !AKT
       Sheets("!AKT").Copy After:=Sheets(Sheets.Count)
       Sheets("!AKT (2)").Name = ShortSheets
       
       If WorksheetIsExist(TableSheets) And WorksheetIsExist(ShortSheets) Then
          
          Sheets(ShortSheets).Unprotect password:="123"
          Sheets(ShortSheets).Visible = True
    
          If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
             i = 2
             While Sheets(TableSheets).Cells(i, 2).Text <> Empty
'*********************************************************************************************************************
                StrokaInfo = ""
                Stroka1 = ""
                Stroka4 = 0
                Stroka5 = 0
                Stroka7 = ""
                Stroka8 = 0
                Stroka9 = 0
                Stroka1Ref = Get_Stroka1Ref(TableSheets, i)
          
                tempProductType = ProductType(Sheets(TableSheets).Cells(i, 8).Text)
                
                Select Case ProductType(Sheets(TableSheets).Cells(i, 8).Text)
             'Air***
                   Case "Air"
'                      If Sheets(TableSheets).Cells(i, 13) < 2 Then
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      Else
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + " - " + Sheets(TableSheets).Cells(i, 15).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      End If
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 70).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             'Hotel***
                   Case "Hotel"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " + _
                                Sheets(TableSheets).Cells(i, 19).Text + " " + Sheets(TableSheets).Cells(i, 20).Text + " |fffd|."
             'VISA***
                   Case "VISA"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; " + _
                                Sheets(TableSheets).Cells(i, 10).Text
             '|fffd||fffd||fffd||fffd| Rail
                   Case "Rail"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(i, 11).Text), NullSTR(Sheets(TableSheets).Cells(i, 12).Text)) + "; " + _
                                Sheets(TableSheets).Cells(i, 45).Text + " - " + Sheets(TableSheets).Cells(i, 46).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Other
                   Case "Other"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             '|fffd||fffd||fffd||fffd| Fee
                   Case "Fee"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + ";" + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Else!!!
                   Case Else
                      Stroka1 = ""
                End Select
                
                '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd| Air/Rail
                If InAirRail Then
                   If tempProductType <> "Air" And tempProductType <> "Rail" Then GoTo 1
                Else
                   If tempProductType = "Air" Or tempProductType = "Rail" = True Then GoTo 1
                End If
                
               '(|fffd||fffd|23) [Amount of service (VAT)]
                AKT_Itog_TotalService = AKT_Itog_TotalService + Sheets(TableSheets).Cells(i, 23)
               '(|fffd||fffd|22) [VAT 18%]
                AKT_Itog_TotalService_VAT = AKT_Itog_TotalService_VAT + Sheets(TableSheets).Cells(i, 22)
               
               '(|fffd||fffd|.35)[CWT FEE (VAT)] + (|fffd||fffd|29)[Surcharge2 (VAT)] - Comission Return ((|fffd||fffd|.39)[Customer commission]+(|fffd||fffd|.40)[VAT on customer commission])
               '35+29-(39+40)
                AKT_Itog_CWT_FEE = AKT_Itog_CWT_FEE + (Sheets(TableSheets).Cells(i, 35) + Sheets(TableSheets).Cells(i, 29) - (Sheets(TableSheets).Cells(i, 39) + Sheets(TableSheets).Cells(i, 40)))
               '(|fffd||fffd|.34)[VAT 18%] + (|fffd||fffd|28)[Surcharge2 ( VAT)] - (|fffd||fffd|. 40)[VAT on  customer  commission]
               '34+28-40
                AKT_Itog_CWT_FEE_VAT = AKT_Itog_CWT_FEE_VAT + Sheets(TableSheets).Cells(i, 34) + Sheets(TableSheets).Cells(i, 28) - Sheets(TableSheets).Cells(i, 40)
               
               '(|fffd||fffd|25)[VAT 18%]
                AKT_Itog_Supplier_FEE = AKT_Itog_Supplier_FEE + Sheets(TableSheets).Cells(i, 26)
               '(|fffd||fffd|26)[Supplier_Fee (VAT)]
                AKT_Itog_Supplier_FEE_VAT = AKT_Itog_Supplier_FEE_VAT + Sheets(TableSheets).Cells(i, 25)
               
               '|fffd||fffd|32[Additional Fee for CC (VAT)]
                AKT_Itog_CC_FEE = AKT_Itog_CC_FEE + Sheets(TableSheets).Cells(i, 32)
               '|fffd||fffd|31[VAT 18%]
                AKT_Itog_CC_FEE_VAT = AKT_Itog_CC_FEE_VAT + Sheets(TableSheets).Cells(i, 31)
                
                Stroka4 = Sheets(TableSheets).Cells(i, 21)
                Stroka5 = Sheets(TableSheets).Cells(i, 21)
                Stroka8 = Sheets(TableSheets).Cells(i, 22)
                Stroka9 = Stroka5 + Stroka8
                If Sheets(TableSheets).Cells(i, 22) = 0 Then
                   Stroka7 = "0%"
                Else
                   If ProductType(Sheets(TableSheets).Cells(i, 8).Text) = "Air" Then
                      Stroka7 = "10%"
                   Else
                      Stroka7 = VatNDS
                   End If
                End If
          
    '''*********************************************************************************************************************
          
                If Stroka1 <> "" Then
                  'Twinsen c 16.10.2015 Stroka1Ref
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                  'Twinsen c 19.10.2016 Nadezhda Molchanova |fffd||fffd||fffd| A00086 |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| Amount of service (VAT) |fffd||fffd||fffd||fffd||fffd| 0
                   If Not (K_Nummer = "A00086" And Stroka9 = 0) Then
                      AddStroka ShortSheets, i_Row, Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   End If
                Else
                   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "]"
                End If

    '''*********************************************************************************************************************
          
                Dim Fee_Value As Double
                Dim Fee_VAT As Double
                Fee_Value = 0
                Fee_VAT = 0
              
             '***1***[ClComm]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 39) <> 0 Then
                   StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   Fee_Value = Sheets(TableSheets).Cells(i, 39)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 40)
                   Stroka4 = 0 - Fee_Value
                   Stroka8 = 0 - Fee_VAT
                   Stroka9 = Stroka4 + Stroka8
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ShortSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If

             '***2.1***[Supplier Fee]
          '***'Supplier Fee - |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - 24/25/26
                If Sheets(TableSheets).Cells(i, 26) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 24)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 25)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Supplier Fee "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ShortSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If

             '***2.2***[Surcharge 2]
          '***'Surcharge 2 - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 27/28/29
                If Sheets(TableSheets).Cells(i, 29) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 27)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 28)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Surcharge 2 "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ShortSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If

              '***2.3***[Additional Fee for CC]
          '***'Additional Fee for CC - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 30/31/32
                If Sheets(TableSheets).Cells(i, 32) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 30)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 31)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Additional Fee for CC "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka4 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ShortSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If

             '***3***[BookFee]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 33) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 33)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 34)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "CWT Charge "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka4 = Fee_Value
                   Stroka8 = Fee_VAT
                   Stroka5 = Stroka4
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   'c 19.04.2016 Nadezhda Molchanova
                   If Fee_VAT = 0 And K_Nummer = "A00086" Then Stroka7 = 0
                   Stroka9 = Stroka4 + Stroka8

                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka ShortSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka4, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8)
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                      Stroka5_Itog = Stroka5_Itog + Stroka5
                      Stroka8_Itog = Stroka8_Itog + Stroka8
                      Stroka9_Itog = Stroka9_Itog + Stroka9
                      i_Row = i_Row + 1
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Consignment |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
                
'*********************************************************************************************************************
1:              i = i + 1
             Wend
             
             Sheets(ShortSheets).Rows(Str(i_Row)).Delete Shift:=xlUp
             Sheets(ShortSheets).Cells(i_Row, 4) = Round(Stroka8_Itog, 2)
             Sheets(ShortSheets).Cells(i_Row, 5) = Round(Stroka9_Itog, 2)
             Sheets(ShortSheets).Activate
             
             '*** |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
             'Twinsen 24.10.2017 Molchanova, Nadezhda CWT-RU
             '|fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd|:
'             If K_Nummer = "A00330" Or K_Nummer = "B00211" Then
'                Sheets(ShortSheets).Cells(3, 1) = Sheets(ShortSheets).Cells(3, 1) + " |fffd|" + B_Nummer
'             End If
             
             Sheets(ShortSheets).Cells(4, 1) = B_Nummer + " " + Format(Sheets(TableSheets).Cells(2, 4), "OT DD/MM/YYYY |fffd|.")
             Dim Temp_K_Nummer_Info As String
             Temp_K_Nummer_Info = Get_K_Nummer_Info(K_Nummer)
             Sheets(ShortSheets).Cells(6, 1) = "        |fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - " + Get_Info("name_ru", Temp_K_Nummer_Info) + ", |fffd| |fffd||fffd||fffd||fffd| " + Get_Info("Signature", Temp_K_Nummer_Info) + ", |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| _______________, |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|, |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & _
                                               "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|., |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & _
                                               "|fffd||fffd||fffd| |fffd| |fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " + Get_Info("Contract_Date", Temp_K_Nummer_Info) + " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| "
             Sheets(ShortSheets).Cells(7, 1) = Get_NameProject(Get_Info("References", Temp_K_Nummer_Info))
             '***
            'AKT_Itog_TotalService |fffd| AKT_Itog_TotalService_VAT
             If Right(B_Nummer, 2) = ".2" Then
                '|fffd| 11.02.2016 Nadezhda Molchanova
                Sheets(ShortSheets).Cells(6, 1) = Sheets(ShortSheets).Cells(6, 1) + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|."
                Sheets(ShortSheets).Cells(i_Row + 3, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Trim(Format(AKT_Itog_TotalService, "# ##0.00")) + " |fffd||fffd||fffd|."
             Else
                '|fffd| 11.02.2016 Nadezhda Molchanova
                Sheets(ShortSheets).Cells(6, 1) = Sheets(ShortSheets).Cells(6, 1) + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|."
                Sheets(ShortSheets).Cells(i_Row + 3, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Trim(Format(AKT_Itog_TotalService, "# ##0.00")) + " |fffd||fffd||fffd|."
             End If
             '|fffd| 13.04.2016 Nadezhda Molchanova
             If Right(B_Nummer, 2) = ".2" And K_Nummer = "B00590" Then
                Sheets(ShortSheets).Cells(6, 1) = Left(Sheets(ShortSheets).Cells(6, 1), Len(Sheets(ShortSheets).Cells(6, 1)) - 1) + ", |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|."
             End If
             
             Sheets(ShortSheets).Cells(i_Row + 4, 1) = "(" + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(AKT_Itog_TotalService) + ") |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| " + Trim(Format(AKT_Itog_TotalService_VAT, "# ##0.00")) + " |fffd||fffd||fffd|."
            'AKT_Itog_CWT_FEE |fffd| AKT_Itog_CWT_FEE_VAT
             Sheets(ShortSheets).Cells(i_Row + 6, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Trim(Format(AKT_Itog_CWT_FEE, "# ##0.00")) + " |fffd||fffd||fffd|."
             Sheets(ShortSheets).Cells(i_Row + 7, 1) = "(" + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(AKT_Itog_CWT_FEE) + ") |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| " + Trim(Format(AKT_Itog_CWT_FEE_VAT, "# ##0.00")) + " |fffd||fffd||fffd|."
            'AKT_Itog_Supplier_FEE |fffd| AKT_Itog_Supplier_FEE_VAT
             Sheets(ShortSheets).Cells(i_Row + 9, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Trim(Format(AKT_Itog_Supplier_FEE, "# ##0.00")) + " |fffd||fffd||fffd|."
             Sheets(ShortSheets).Cells(i_Row + 10, 1) = "(" + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(AKT_Itog_Supplier_FEE) + ") |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| " + Trim(Format(AKT_Itog_Supplier_FEE_VAT, "# ##0.00")) + " |fffd||fffd||fffd|."
            'AKT_Itog_CC_FEE |fffd| AKT_Itog_CC_FEE_VAT
             Sheets(ShortSheets).Cells(i_Row + 12, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Trim(Format(AKT_Itog_CC_FEE, "# ##0.00")) + " |fffd||fffd||fffd|."
             Sheets(ShortSheets).Cells(i_Row + 13, 1) = "(" + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(AKT_Itog_CC_FEE) + ") |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| " + Trim(Format(AKT_Itog_CC_FEE_VAT, "# ##0.00")) + " |fffd||fffd||fffd|."
            AKT_Itog = AKT_Itog_TotalService + AKT_Itog_CWT_FEE + AKT_Itog_Supplier_FEE + AKT_Itog_CC_FEE
            AKT_Itog_VAT = AKT_Itog_TotalService_VAT + AKT_Itog_CWT_FEE_VAT + AKT_Itog_Supplier_FEE_VAT + AKT_Itog_CC_FEE_VAT
             Sheets(ShortSheets).Cells(i_Row + 15, 1) = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Trim(Format(AKT_Itog, "# ##0.00")) + " |fffd||fffd||fffd|."
             Sheets(ShortSheets).Cells(i_Row + 16, 1) = "(" + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(AKT_Itog) + ") |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| " + Trim(Format(AKT_Itog_VAT, "# ##0.00")) + " |fffd||fffd||fffd|."
             '***
             'Sheets(ShortSheets).Cells(i_Row + 18, 1) = "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|" + B_Nummer + " |fffd||fffd| " + Format(Sheets(TableSheets).Cells(2, 4), "DD/MM/YYYY/") + " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|" + B_Nummer + " |fffd||fffd| " + Format(Sheets(TableSheets).Cells(2, 4), "DD/MM/YYYY/")
             '|fffd| 11.02.2016 Nadezhda Molchanova
             ''Sheets(ShortSheets).Cells(i_Row + 18, 1) = "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|" + B_Nummer + " |fffd||fffd| " + Format(Sheets(TableSheets).Cells(2, 4), "DD/MM/YYYY/")
             Sheets(ShortSheets).Cells(i_Row + 18, 1) = ""
             '***
             'Twinsen 16.11.2015 |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd| "Short C") Nadezhda Molchanova
             If Right(B_Nummer, 2) = ".2" Then
                Sheets(ShortSheets).Range("C9:C" + Trim(Str(i_Row))).Delete Shift:=xlToLeft
             Else
                '|fffd| 11.02.2016 Nadezhda Molchanova
                Sheets(ShortSheets).Rows(Trim(Str(i_Row + 2)) + ":" + Trim(Str(i_Row + 13))).Delete Shift:=xlUp
             End If
             '***
             Sheets(ShortSheets).Cells(1, 1).Select
             
             'Twinsen 14.04.2017
             UpdateTEXT ShortSheets, Sheets(TableSheets).Cells(2, 4)
             
    
             Application.ScreenUpdating = True
          Else
             MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
             '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ShortSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
             If WorksheetIsExist(ShortSheets) Then
                Application.DisplayAlerts = False
                Sheets(BulkConsignment).Delete
                Application.DisplayAlerts = True
             End If
          End If
       Else
          If WorksheetIsExist(TableSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"
          If WorksheetIsExist(ShortSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !AKT"
       End If
    Else
       If TableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"
       If WorksheetIsExist("!Invoice") = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| !AKT"
    End If
    
    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_Short " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Sub AddStroka(InShortSheets As String, InI_Row As Double, InStroka1 As String, InStroka4 As Double, InStroka5 As Double, InStroka7 As String, InStroka8 As Double, InStroka9 As Double, InPrType As String)
  '|fffd| 1 |fffd||fffd||fffd||fffd||fffd| 2015 ( 04 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ERD ) (23 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HIS)
  If InStr(1, ProductTypeNoNDS, "[" + InPrType + "]", vbTextCompare) Then
     If InStroka8 = 0 Then InStroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
  End If
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   Sheets(InShortSheets).Rows(Str(InI_Row)).Copy
   Sheets(InShortSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   If InI_Row = 10 Then
      Sheets(InShortSheets).Cells(InI_Row, 1) = 1
   Else
      Sheets(InShortSheets).Cells(InI_Row, 1) = Sheets(InShortSheets).Cells(InI_Row - 1, 1) + 1
   End If
   Sheets(InShortSheets).Cells(InI_Row, 2) = InStroka1 + Chr(10)
   Sheets(InShortSheets).Cells(InI_Row, 3) = InStroka7
   If Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|" Then
      Sheets(InShortSheets).Cells(InI_Row, 4) = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
   Else
      Sheets(InShortSheets).Cells(InI_Row, 4) = InStroka8
   End If
   Sheets(InShortSheets).Cells(InI_Row, 5) = InStroka9
End Sub




Attribute VB_Name = "Create_05_AgentReport"
Dim Stroka5_Itog As Double, Stroka8_Itog As Double, Stroka9_Itog As Double, i_Row As Double

Public Sub Create_AgentReport()
On Error GoTo Error:

Dim TableSheets As String
TableSheets = FindTableSheets

Select Case GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)
   Case "A00124", "A00513", "B00282", "B00105", "A01193"
      Create_AgentReport2
   Case "A01340", "A01342"
      Create_AgentReportKWS
   Case "A01309", "B00658" 'BIOCAD |fffd||fffd||fffd| KWS + |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      Create_AgentReportKWS
   Case "A00330" '01.03.2018 AMGEN MICE "Anastasia CWT-RU Krylova" <a.krylova@carlsonwagonlit.ru>;
      Create_AgentReportAMGEN
   Case Else
      Create_AgentReport1
End Select

    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_AgentReport " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

Public Sub Create_AgentReportAMGEN()
On Error GoTo Error:

Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| AMGEN?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then
   Dim AgentReportSheets As String, TableSheets As String
   TableSheets = FindTableSheets
   If TableSheets <> "" Then
      If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
         '**************************************************************************************************************************
         AgentReportSheets = Replace(TableSheets, "Tables ", "AMGEN_", 1, -1, vbTextCompare)
         '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| AgentReportSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
         If WorksheetIsExist(AgentReportSheets) Then
            Application.DisplayAlerts = False
            Sheets(AgentReportSheets).Delete
            Application.DisplayAlerts = True
         End If
         Sheets.Add After:=Sheets(Sheets.Count)
         Sheets(Sheets.Count).Name = AgentReportSheets
        'Sheets(TableSheets).Range("C:F,H:K,N:R,W:W,AV:AV,BR:BR,BV:BV").Copy
         Sheets(TableSheets).Range("C:F,H:K,N:R,AJ:AJ,AV:AV,BR:BR,BV:BV").Copy
         Sheets(AgentReportSheets).Range("A1").Select
         ActiveSheet.Paste
      Else
         MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
      End If
   Else
      If TableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
   End If


End If

    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_AgentReport1 " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub


Public Sub Create_AgentReport1()
On Error GoTo Error:

Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then

    Application.ScreenUpdating = False
     
    Dim i As Double
    Dim Stroka1 As String, Stroka4 As Double, Stroka5 As Double, Stroka7 As String, Stroka8 As Double, Stroka9 As Double
    Dim Stroka1Ref As String
    Dim K_Nummer As String
    Dim Stroka5_Itog As Double, Stroka8_Itog As Double, Stroka9_Itog As Double
    Dim i_Row As Double
    Dim AgentReportSheets As String, TableSheets As String
    
    i_Row = 28
    
    TableSheets = FindTableSheets
    
    If TableSheets <> "" And WorksheetIsExist("!AgentReport") Then
       AgentReportSheets = Replace(TableSheets, "Tables ", "AgentReport ", 1, -1, vbTextCompare)
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| AgentReportSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(AgentReportSheets) Then
          Application.DisplayAlerts = False
          Sheets(AgentReportSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !AgentReport
       Sheets("!AgentReport").Copy After:=Sheets(Sheets.Count)
       Sheets("!AgentReport (2)").Name = AgentReportSheets
       
       If WorksheetIsExist(TableSheets) And WorksheetIsExist(AgentReportSheets) Then
          
          Sheets(AgentReportSheets).Unprotect password:="123"
          Sheets(AgentReportSheets).Visible = True
          K_Nummer = GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)
          
         '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
          Sheets(AgentReportSheets).Cells(8, 3) = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " + Sheets(TableSheets).Cells(2, 3).Text + " |fffd||fffd| " + Format(Sheets(TableSheets).Cells(2, 4), "DD.MM.YYYY")
          Dim Temp_K_Nummer_Info As String
          Temp_K_Nummer_Info = Get_K_Nummer_Info(K_Nummer)
          Sheets(AgentReportSheets).Cells(2, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Get_Info("name_ru", Temp_K_Nummer_Info)
          Sheets(AgentReportSheets).Cells(3, 3) = "|fffd||fffd||fffd||fffd||fffd|: " + Get_Info("COUNTRY", Temp_K_Nummer_Info) + " " + Get_Info("POSTCODE", Temp_K_Nummer_Info) + " " + Get_Info("CITY", Temp_K_Nummer_Info) + " " + Get_Info("STREET", Temp_K_Nummer_Info)
          Sheets(AgentReportSheets).Cells(5, 3) = "|fffd||fffd||fffd| / |fffd||fffd||fffd|: " + Get_Info("VAT_ID", Temp_K_Nummer_Info)
          'Sheets(AgentReportSheets).Cells(13, 3) = Get_Info("name_ru", Temp_K_Nummer_Info) + ", |fffd| |fffd||fffd||fffd||fffd| " + Get_Info("Signature", Temp_K_Nummer_Info) + ", |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
          Sheets(AgentReportSheets).Cells(13, 3) = Get_Info("name_ru", Temp_K_Nummer_Info) + ", |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|" + Get_Info("Contract_Date", Temp_K_Nummer_Info)
          'Sheets(AgentReportSheets).Cells(14, 3) = "|fffd|" + Get_Info("Contract_Date", Temp_K_Nummer_Info)
          Sheets(AgentReportSheets).Cells(15, 3) = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + Get_NameProject(Get_Info("References", Temp_K_Nummer_Info))
          '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 5 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|.
         ' Sheets(AgentReportSheets).Cells(28, 3) = Get_Info("PaymentDeadline", Temp_K_Nummer_Info)
          If K_Nummer = "B00646" Or K_Nummer = "A01266" Or K_Nummer = "A00313" Then Sheets(AgentReportSheets).Cells(26, 16) = "|fffd||fffd||fffd| EPFIA"
          
          'Twinsen 14.04.2017
          UpdateTEXT AgentReportSheets, Sheets(TableSheets).Cells(2, 4)
          Sheets(AgentReportSheets).Cells(5, 3) = "|fffd||fffd||fffd| / |fffd||fffd||fffd|: " + Get_Info("VAT_ID", Temp_K_Nummer_Info)
          
          If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
             i = 2
             While Sheets(TableSheets).Cells(i, 2).Text <> Empty
                Stroka1 = ""
                Stroka1Ref = Get_Stroka1Ref(TableSheets, i)
                'Product code + Service Descriptions
                If Sheets(TableSheets).Cells(i, 10).Text <> "" Then
                   TextInfo = Sheets(TableSheets).Cells(i, 9).Text + "; " + Sheets(TableSheets).Cells(i, 10).Text + "; "
                Else
                   TextInfo = Sheets(TableSheets).Cells(i, 9).Text + "; "
                End If
               
                Select Case ProductType(Sheets(TableSheets).Cells(i, 8).Text)
             'Air***
                   Case "Air"
'                      If Sheets(TableSheets).Cells(i, 13) < 2 Then
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + TextInfo + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      Else
'                         Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + TextInfo + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + _
'                                   Sheets(TableSheets).Cells(i, 15).Text + " - " + Sheets(TableSheets).Cells(i, 16).Text + " - " + Sheets(TableSheets).Cells(i, 15).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
'                      End If
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + TextInfo + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + _
                                Sheets(TableSheets).Cells(i, 70).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             'Hotel***
                   Case "Hotel"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + TextInfo + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " + _
                                Sheets(TableSheets).Cells(i, 19).Text + " " + Sheets(TableSheets).Cells(i, 20).Text + " |fffd|."
             '|fffd||fffd||fffd||fffd| Rail
                   Case "Rail"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + TextInfo + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + Sheets(TableSheets).Cells(i, 11).Text + "; " + _
                                Sheets(TableSheets).Cells(i, 45).Text + " - " + Sheets(TableSheets).Cells(i, 46).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             '|fffd||fffd||fffd||fffd| Other
                   Case "Other"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text + "; " + Sheets(TableSheets).Cells(i, 18).Text
             '|fffd||fffd||fffd||fffd| Fee
                   Case "Fee"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + ";" + TextInfo + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + ";" + _
                                Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(i, 16).Text + "; " + Sheets(TableSheets).Cells(i, 17).Text
             'VISA***
                   Case "VISA"
                      Stroka1 = Sheets(TableSheets).Cells(i, 2).Text + "; " + Sheets(TableSheets).Cells(i, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(i, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(i, 6).Text) + "; " + "C " + _
                                Sheets(TableSheets).Cells(i, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(i, 18).Text + "; " + _
                                Sheets(TableSheets).Cells(i, 10).Text
             '|fffd||fffd||fffd||fffd| Else!!!
                   Case Else
                      Stroka1 = ""
                End Select

    '''*********************************************************************************************************************
          
                If Stroka1 <> "" Then
                  'Twinsen c 16.10.2015 Stroka1Ref
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                   If K_Nummer = "B00646" Or K_Nummer = "|fffd|01266" Or K_Nummer = "A00313" Then TempRef = Sheets(TableSheets).Cells(i, 59).Text
                   AddStroka AgentReportSheets, i_Row, Stroka1 + Stroka1Ref, Sheets(TableSheets).Cells(i, 11), Sheets(TableSheets).Cells(i, 21), Sheets(TableSheets).Cells(i, 22), Sheets(TableSheets).Cells(i, 23), Sheets(TableSheets).Cells(i, 24), Sheets(TableSheets).Cells(i, 25), Sheets(TableSheets).Cells(i, 26), Sheets(TableSheets).Cells(i, 33), Sheets(TableSheets).Cells(i, 34), Sheets(TableSheets).Cells(i, 35), Sheets(TableSheets).Cells(i, 36), Sheets(TableSheets).Cells(i, 37), TempRef
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
                   i_Row = i_Row + 1
                Else
                   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_AgentReport |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "]"
                End If
          
    '''*********************************************************************************************************************
    
                i = i + 1
             Wend
             
             Sheets(AgentReportSheets).Rows(Str(i_Row)).Delete Shift:=xlUp
             Sheets(AgentReportSheets).Activate
             '
             For Ix = 5 To 15
                Sheets(AgentReportSheets).Cells(i_Row, Ix).FormulaR1C1 = "=SUM(R[-" + Trim(Str(i - 2)) + "]C:R[-1]C)"
             Next Ix
             '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| (5+8), |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| (4+7)
             Sheets(AgentReportSheets).Cells(22, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - " + Trim(Str(Sheets(AgentReportSheets).Cells(i_Row, 7) + Sheets(AgentReportSheets).Cells(i_Row, 10))) + "|fffd||fffd||fffd|. |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| - " + Trim(Str(Sheets(AgentReportSheets).Cells(i_Row, 6) + Sheets(AgentReportSheets).Cells(i_Row, 9))) + "|fffd||fffd||fffd|."
             '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 11, |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 10
             Sheets(AgentReportSheets).Cells(23, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - " + Trim(Str(Sheets(AgentReportSheets).Cells(i_Row, 13))) + "|fffd||fffd||fffd|. |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| - " + Trim(Str(Sheets(AgentReportSheets).Cells(i_Row, 12))) + "|fffd||fffd||fffd|."
             '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 12, |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 13
             'Sheets(AgentReportSheets).Cells(24, 3) = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - " + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(Sheets(AgentReportSheets).Cells(i_Row, 14)) + " |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| - " + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(Sheets(AgentReportSheets).Cells(i_Row, 15))
             Sheets(AgentReportSheets).Cells(24, 3) = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - " + Trim(Str(Sheets(AgentReportSheets).Cells(i_Row, 14))) + "|fffd||fffd||fffd|. |fffd| |fffd|.|fffd|. |fffd||fffd||fffd| - " + Trim(Str(Sheets(AgentReportSheets).Cells(i_Row, 15))) + "|fffd||fffd||fffd|."

             Sheets(AgentReportSheets).Cells(i_Row + 10, 4) = Get_Info("name_ru", Temp_K_Nummer_Info)
             Sheets(AgentReportSheets).Cells(i_Row + 12, 4) = Get_Info("Signature", Temp_K_Nummer_Info)
             
             
             Sheets(AgentReportSheets).Cells(1, 1).Select
             Application.ScreenUpdating = True
          Else
             MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
             '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| AgentReportSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
             If WorksheetIsExist(AgentReportSheets) Then
                Application.DisplayAlerts = False
                Sheets(AgentReportSheets).Delete
                Application.DisplayAlerts = True
             End If
          End If
       Else
          If WorksheetIsExist(TableSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
          If WorksheetIsExist(AgentReportSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !AgentReport"
       End If
    Else
       If TableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
       If WorksheetIsExist("!AgentReport") = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| !AgentReport"
    End If

End If

    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_AgentReport1 " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Sub AddStroka(InAgentReportSheets As String, InI_Row As Double, InStroka1 As String, InStroka2 As String, InStroka3 As Double, InStroka4 As Double, InStroka5 As Double, InStroka6 As Double, InStroka7 As Double, InStroka8 As Double, InStroka9 As Double, InStroka10 As Double, InStroka11 As Double, InStroka12 As Double, InStroka13 As Double, InStroka14)
   InI_Row = InI_Row
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   Sheets(InAgentReportSheets).Rows(Str(InI_Row)).Copy
   Sheets(InAgentReportSheets).Rows(Str(InI_Row)).Insert Shift:=xlUp
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   Sheets(InAgentReportSheets).Cells(InI_Row, 2) = Sheets(InAgentReportSheets).Cells(InI_Row - 1, 2) + 1
   Sheets(InAgentReportSheets).Cells(InI_Row, 3) = InStroka1
   Sheets(InAgentReportSheets).Cells(InI_Row, 4) = InStroka2
   Sheets(InAgentReportSheets).Cells(InI_Row, 5) = InStroka3
   Sheets(InAgentReportSheets).Cells(InI_Row, 6) = InStroka4
   Sheets(InAgentReportSheets).Cells(InI_Row, 7) = InStroka5
   Sheets(InAgentReportSheets).Cells(InI_Row, 8) = InStroka6
   Sheets(InAgentReportSheets).Cells(InI_Row, 9) = InStroka7
   Sheets(InAgentReportSheets).Cells(InI_Row, 10) = InStroka8
   Sheets(InAgentReportSheets).Cells(InI_Row, 11) = InStroka9
   Sheets(InAgentReportSheets).Cells(InI_Row, 12) = InStroka10
   Sheets(InAgentReportSheets).Cells(InI_Row, 13) = InStroka11
   Sheets(InAgentReportSheets).Cells(InI_Row, 14) = InStroka12
   Sheets(InAgentReportSheets).Cells(InI_Row, 15) = InStroka13
   Sheets(InAgentReportSheets).Cells(InI_Row, 16) = InStroka14
End Sub

Public Sub Create_AgentReport2()
On Error GoTo Error:

Dim AgentReportSheets As String, TableSheets As String

TableSheets = FindTableSheets

If TableSheets <> "" Then
   If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
     '**************************************************************************************************************************
      AgentReportSheets = Replace(TableSheets, "Tables ", "", 1, -1, vbTextCompare) + "_1"
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| AgentReportSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(AgentReportSheets) Then
          Application.DisplayAlerts = False
          Sheets(AgentReportSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !AgentReport
       Sheets(TableSheets).Copy After:=Sheets(Sheets.Count)
       Sheets(TableSheets + " (2)").Name = AgentReportSheets
       i = 2
       While Sheets(AgentReportSheets).Cells(i, 2).Text <> Empty
          tempProductType = ProductType(Sheets(AgentReportSheets).Cells(i, 8).Text)
          If tempProductType = "Air" Or tempProductType = "Rail" Then
             Sheets(AgentReportSheets).Cells(i, 24) = 0
             Sheets(AgentReportSheets).Cells(i, 25) = 0
             Sheets(AgentReportSheets).Cells(i, 26) = 0
             Sheets(AgentReportSheets).Cells(i, 27) = 0
             Sheets(AgentReportSheets).Cells(i, 28) = 0
             Sheets(AgentReportSheets).Cells(i, 29) = 0
             Sheets(AgentReportSheets).Cells(i, 30) = 0
             Sheets(AgentReportSheets).Cells(i, 31) = 0
             Sheets(AgentReportSheets).Cells(i, 32) = 0
             Sheets(AgentReportSheets).Cells(i, 33) = 0
             Sheets(AgentReportSheets).Cells(i, 34) = 0
             Sheets(AgentReportSheets).Cells(i, 35) = 0
             Sheets(AgentReportSheets).Cells(i, 36) = Sheets(AgentReportSheets).Cells(i, 23)
             Sheets(AgentReportSheets).Cells(i, 37) = Sheets(AgentReportSheets).Cells(i, 22)
             Sheets(AgentReportSheets).Cells(i, 39) = 0
             Sheets(AgentReportSheets).Cells(i, 40) = 0
             i = i + 1
          Else
             Sheets(AgentReportSheets).Rows(Str(i)).Delete Shift:=xlUp
          End If
       Wend
      '**************************************************************************************************************************
      '**************************************************************************************************************************
       AgentReportSheets = Replace(TableSheets, "Tables ", "", 1, -1, vbTextCompare) + "_2"
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| AgentReportSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(AgentReportSheets) Then
          Application.DisplayAlerts = False
          Sheets(AgentReportSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !AgentReport
       Sheets(TableSheets).Copy After:=Sheets(Sheets.Count)
       Sheets(TableSheets + " (2)").Name = AgentReportSheets
       i = 2
       While Sheets(AgentReportSheets).Cells(i, 2).Text <> Empty
          tempProductType = ProductType(Sheets(AgentReportSheets).Cells(i, 8).Text)
          If tempProductType = "Air" Or tempProductType = "Rail" Then
             Sheets(AgentReportSheets).Cells(i, 21) = 0
             Sheets(AgentReportSheets).Cells(i, 22) = 0
             Sheets(AgentReportSheets).Cells(i, 23) = 0
             'Total VAT
             Sheets(AgentReportSheets).Cells(i, 37) = (Sheets(AgentReportSheets).Cells(i, 22) + Sheets(AgentReportSheets).Cells(i, 25) + Sheets(AgentReportSheets).Cells(i, 28) + Sheets(AgentReportSheets).Cells(i, 31) + Sheets(AgentReportSheets).Cells(i, 34)) - Sheets(AgentReportSheets).Cells(i, 40)
             'Total service
             Sheets(AgentReportSheets).Cells(i, 36) = (Sheets(AgentReportSheets).Cells(i, 23) + Sheets(AgentReportSheets).Cells(i, 26) + Sheets(AgentReportSheets).Cells(i, 29) + Sheets(AgentReportSheets).Cells(i, 32) + Sheets(AgentReportSheets).Cells(i, 35)) - Sheets(AgentReportSheets).Cells(i, 39)
          End If
          i = i + 1
       Wend
      '**************************************************************************************************************************
      
   Else
      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
   End If
       
End If


    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_AgentReport2 " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

'************************************************************************************************************
'************************************************************************************************************
'************************************************************************************************************
Public Sub Create_AgentReportKWS()
Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| KWS?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then
   Create_AgentReport3
End If
End Sub

Private Sub Create_AgentReport3()
On Error GoTo Error:

    Application.ScreenUpdating = False
    Dim i As Double
    Dim Stroka1 As String, Stroka5 As Double, Stroka7 As String, Stroka8 As Double, Stroka9 As Double
    Dim Stroka1Ref As String
    Dim K_Nummer As String, B_Nummer As String
    
    Dim BulkSheets As String, TableSheets As String, PivotSheets As String
    
    Stroka5_Itog = 0
    Stroka8_Itog = 0
    Stroka9_Itog = 0
    i_Row = 2
    
    TableSheets = FindTableSheets
    
    If TableSheets <> "" And WorksheetIsExist("!AgentReport_VAT") Then
       
       BulkSheets = Replace(TableSheets, "Tables ", "Report_VAT_", 1, -1, vbTextCompare)
       B_Nummer = Replace(TableSheets, "Tables ", "", 1, -1, vbTextCompare)
              
       '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       K_Nummer = GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| BulkSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|.
       If WorksheetIsExist(BulkSheets) Then
          Application.DisplayAlerts = False
          Sheets(BulkSheets).Delete
          Application.DisplayAlerts = True
       End If
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !Invoice_JV
       Sheets("!AgentReport_VAT").Copy After:=Sheets(Sheets.Count)
       Sheets("!AgentReport_VAT (2)").Name = BulkSheets
       
       If WorksheetIsExist(TableSheets) And WorksheetIsExist(BulkSheets) Then
          
          Sheets(BulkSheets).Unprotect password:="123"
          Sheets(BulkSheets).Visible = True
    
          If Sheets(TableSheets).Cells(2, 2).Text <> Empty Then
             i = 2
             While Sheets(TableSheets).Cells(i, 2).Text <> Empty
                StrokaInfo = ""
                Stroka1 = ""
                Stroka5 = 0
                Stroka7 = ""
                Stroka8 = 0
                Stroka9 = 0
                
                Stroka1Ref = Get_Stroka1Ref(TableSheets, i)
                Stroka1 = Get_Stroka1(TableSheets, i)
                Stroka5 = Sheets(TableSheets).Cells(i, 21)
                Stroka8 = Sheets(TableSheets).Cells(i, 22)
                Stroka9 = Stroka5 + Stroka8
                If Sheets(TableSheets).Cells(i, 22) = 0 Then
                   Stroka7 = "0%"
                Else
                   If ProductType(Sheets(TableSheets).Cells(i, 8).Text) = "Air" Then
                      Stroka7 = "10%"
                   Else
                      Stroka7 = VatNDS
                   End If
                End If
        '''*********************************************************************************************************************
    
                If Stroka1 <> "" Then
                  'Twinsen c 16.10.2015 Stroka1Ref
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                   AddStroka03 BulkSheets, i_Row, Stroka1 + Stroka1Ref, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8), Sheets(TableSheets).Cells(i, 47), TableSheets, i
                Else
                   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice_JV |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "]"
                End If

    '''*********************************************************************************************************************
                
                Dim Fee_Value As Double
                Dim Fee_VAT As Double
                Fee_Value = 0
                Fee_VAT = 0
       
             '***1***[ClComm]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 39) <> 0 Then
                   StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   Fee_Value = Sheets(TableSheets).Cells(i, 39)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 40)
                   Stroka5 = 0 - Fee_Value
                   Stroka8 = 0 - Fee_VAT
                   Stroka9 = Stroka5 + Stroka8
                     If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka03 BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8), Sheets(TableSheets).Cells(i, 47), TableSheets, i
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice_JV |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
             
             '***2.1***[Supplier Fee]
          '***'Supplier Fee - |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - 24/25/26
                If Sheets(TableSheets).Cells(i, 26) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 24)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 25)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Supplier Fee "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka5 = Fee_Value
                   Stroka8 = Fee_VAT
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka5 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka03 BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8), Sheets(TableSheets).Cells(i, 47), TableSheets, i
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice_JV |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
       
             '***2.2***[Surcharge 2]
          '***'Surcharge 2 - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 27/28/29
                If Sheets(TableSheets).Cells(i, 29) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 27)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 28)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Surcharge 2 "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka5 = Fee_Value
                   Stroka8 = Fee_VAT
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka5 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka03 BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8), Sheets(TableSheets).Cells(i, 47), TableSheets, i
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice_JV |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If
    
              '***2.3***[Additional Fee for CC]
          '***'Additional Fee for CC - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| - 30/31/32
                If Sheets(TableSheets).Cells(i, 32) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 30)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 31)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "Additional Fee for CC "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd| "
                   End If
                   Stroka5 = Fee_Value
                   Stroka8 = Fee_VAT
                   If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka5 + Stroka8
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka03 BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8), Sheets(TableSheets).Cells(i, 47), TableSheets, i
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice_JV |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| c|fffd||fffd||fffd|"
                   End If
                End If
       
             '***3***[BookFee]
          '***|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Sheets(TableSheets).Cells(i, 33) <> 0 Then
                   Fee_Value = Sheets(TableSheets).Cells(i, 33)
                   Fee_VAT = Sheets(TableSheets).Cells(i, 34)
                   If (K_Nummer = "B00103") Or (K_Nummer = "B00130") Or (K_Nummer = "A00324") Then
                     '|fffd||fffd||fffd| B00103 |fffd| B00130 |fffd| A00324
                      StrokaInfo = "CWT Charge "
                   Else
                     '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      StrokaInfo = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
                   End If
                   Stroka5 = Fee_Value
                   Stroka8 = Fee_VAT
                    If Fee_VAT <> 0 Then
                      Stroka7 = VatNDS
                   Else
                      Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
                   End If
                   Stroka9 = Stroka5 + Stroka8
             
                   If Stroka1 <> "" Then
                     'Twinsen c 16.10.2015 Stroka1Ref
                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                      AddStroka03 BulkSheets, i_Row, StrokaInfo + Stroka1 + Stroka1Ref, Stroka5, Stroka7, Stroka8, Stroka9, Sheets(TableSheets).Cells(i, 8), Sheets(TableSheets).Cells(i, 47), TableSheets, i
                   Else
                      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Create_Invoice_JV |fffd||fffd||fffd||fffd||fffd||fffd|[" + Str(i_Row) + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                   End If
                End If
    
    '''*********************************************************************************************************************
    
                i = i + 1
             Wend
             
             Sheets(BulkSheets).Rows(Str(i_Row)).Delete Shift:=xlUp
             Sheets(BulkSheets).Cells(i_Row, 3) = Round(Stroka5_Itog, 2)
             Sheets(BulkSheets).Cells(i_Row, 5) = Round(Stroka8_Itog, 2)
             Sheets(BulkSheets).Cells(i_Row, 6) = Round(Stroka9_Itog, 2)
             Sheets(BulkSheets).Activate
             
             '*** BIOCAD |fffd||fffd||fffd| KWS + |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Twinsen 07.06.2017
             If K_Nummer = "A01309" Or K_Nummer = "B00658" Then
                If i_Row > 0 Then
                   ActiveSheet.PivotTables("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|1").ChangePivotCache _
                   ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:=BulkSheets + "!R1C1:R" + Trim(Str(i_Row - 1)) + "C7", Version:=xlPivotTableVersion12)
                   ActiveSheet.PivotTables("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|1").PivotCache.Refresh
                End If
             Else
                ActiveSheet.PivotTables("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|1").PivotSelect "", xlDataAndLabel, True
                Selection.Delete Shift:=xlToLeft
             End If
             '***
             
             Sheets(BulkSheets).Cells(1, 1).Select
             Application.ScreenUpdating = True
                          
          Else
             MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
             '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| BulkSheets, |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
             If WorksheetIsExist(BulkSheets) Then
                Application.DisplayAlerts = False
                Sheets(BulkSheets).Delete
                Application.DisplayAlerts = True
             End If
          End If
       Else
          If WorksheetIsExist(TableSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
          If WorksheetIsExist(BulkSheets) = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| !AgentReport_VAT"
       End If
    Else
       If TableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *] c |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
       If WorksheetIsExist("!AgentReport_VAT") = False Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| !AgentReport_VAT"
    End If

    Exit Sub

Error:
    Application.ScreenUpdating = True
    Call MsgBox("ERROR Sub Create_AgentReport3 " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear

End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Sub AddStroka03(InBulkSheets As String, InI_Row As Double, InStroka1 As String, InStroka5 As Double, InStroka7 As String, InStroka8 As Double, InStroka9 As Double, InPrType As String, InStroka16 As String, InTableSheets As String, InTableSheets_I_Row As Double)
On Error GoTo Error:
   
  '|fffd| 1 |fffd||fffd||fffd||fffd||fffd| 2015 ( 04 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ERD ) (23 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HIS)
  If InStr(1, ProductTypeNoNDS, "[" + InPrType + "]", vbTextCompare) Then
     If InStroka8 = 0 Then InStroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
  End If
  
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   Sheets(InBulkSheets).Rows(Str(InI_Row)).Copy
   Sheets(InBulkSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   If Sheets(InBulkSheets).Cells(InI_Row - 1, 1) = "|fffd| |fffd|/|fffd|" Then
      Sheets(InBulkSheets).Cells(InI_Row, 1) = 1
   Else
      Sheets(InBulkSheets).Cells(InI_Row, 1) = Sheets(InBulkSheets).Cells(InI_Row - 1, 1) + 1
   End If
   Sheets(InBulkSheets).Cells(InI_Row, 2) = InStroka1
   Sheets(InBulkSheets).Cells(InI_Row, 3) = InStroka5
   Sheets(InBulkSheets).Cells(InI_Row, 4) = InStroka7
   If Stroka7 = "|fffd||fffd||fffd| |fffd||fffd||fffd|" Then
      Sheets(InBulkSheets).Cells(InI_Row, 5) = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
   Else
      Sheets(InBulkSheets).Cells(InI_Row, 5) = InStroka8
   End If
   Sheets(InBulkSheets).Cells(InI_Row, 6) = InStroka9
   Sheets(InBulkSheets).Cells(InI_Row, 7) = InStroka16 'Cost Center
   
   '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| ALL_Itog
   Stroka5_Itog = Stroka5_Itog + InStroka5
   Stroka8_Itog = Stroka8_Itog + InStroka8
   Stroka9_Itog = Stroka9_Itog + InStroka9
   
   If InStroka9 = 0 Then
      i_Row = i_Row + 1
      Exit Sub
   End If
   
   Dim TempRealVat As Double
   TempRealVat = Round(((InStroka9 / InStroka5) - 1) * 100, 4)
     'Temp
      Sheets(InBulkSheets).Cells(InI_Row, 8) = TempRealVat / 100 'RealVat
      TempTotalServiceVAT = Sheets(InBulkSheets).Cells(InI_Row, 5)
      TempTotalVAT = Sheets(InBulkSheets).Cells(InI_Row, 6)
      TempVat10 = FindVAT(ToDouble(Sheets(InBulkSheets).Cells(InI_Row, 3)), ToDouble(Sheets(InBulkSheets).Cells(InI_Row, 5)), 0.1)
      TempTypeSeparation = GetTypeSeparation(InPrType, TempRealVat)
      
      '****************************************************************************************************************************
      If InPrType = "RDD" Then
         If Len(Sheets(InTableSheets).Cells(InTableSheets_I_Row, 77).Text) = 10 Then
            ''|fffd||fffd||fffd||fffd| Ticket issue date.
            If CDate(Sheets(InTableSheets).Cells(InTableSheets_I_Row, 77)) > CDate("31.12.2016") Then
               If TempTypeSeparation = "10%0%" Then TempTypeSeparation = "18%0%"
            End If
         Else
            ''|fffd||fffd||fffd| Ticket issue date, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Invoice Data
            If CDate(Sheets(InTableSheets).Cells(InTableSheets_I_Row, 4)) > CDate("31.12.2016") Then
               If TempTypeSeparation = "10%0%" Then TempTypeSeparation = "18%0%"
            End If
         End If
      End If
      '****************************************************************************************************************************
      
      Select Case TempTypeSeparation
         Case "0%10%18%"
            If TempRealVat > 9.99 And TempRealVat < 10.01 Then Sheets(InBulkSheets).Cells(InI_Row, 4) = "10%"
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 20%!", vbCritical, "ERROR!"
            Exit Sub
            If TempRealVat > 17.99 And TempRealVat < 18.01 Then Sheets(InBulkSheets).Cells(InI_Row, 4) = "18%"
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Interior.Pattern = xlNone
         Case "10%18%"
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Copy
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
            i_Row = i_Row + 1
          ''10%
            Sheets(InBulkSheets).Cells(InI_Row - 1, 4) = 0.1
            Sheets(InBulkSheets).Cells(InI_Row - 1, 3) = TempVat10
            Sheets(InBulkSheets).Cells(InI_Row - 1, 5) = Round(Sheets(InBulkSheets).Cells(InI_Row - 1, 3) * 0.1, 2)
            Sheets(InBulkSheets).Cells(InI_Row - 1, 6) = Sheets(InBulkSheets).Cells(InI_Row - 1, 3) + Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
          ''18%
            Sheets(InBulkSheets).Cells(InI_Row, 4) = 0.18
            Sheets(InBulkSheets).Cells(InI_Row, 3) = TempTotalVAT - TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 3)
            Sheets(InBulkSheets).Cells(InI_Row, 5) = TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
            Sheets(InBulkSheets).Cells(InI_Row, 6) = TempTotalVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 6)
            ''Color
            Sheets(InBulkSheets).Rows(Str(InI_Row - 1)).Interior.Color = 65535
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Interior.Color = 65535
         Case "10%0%"
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Copy
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
            i_Row = i_Row + 1
          ''10%
            Sheets(InBulkSheets).Cells(InI_Row - 1, 4) = 0.1
            Sheets(InBulkSheets).Cells(InI_Row - 1, 5) = Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
            Sheets(InBulkSheets).Cells(InI_Row - 1, 6) = Round((Sheets(InBulkSheets).Cells(InI_Row - 1, 5) / 10) * 110, 2)
            Sheets(InBulkSheets).Cells(InI_Row - 1, 3) = Sheets(InBulkSheets).Cells(InI_Row - 1, 6) - Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
          ''0%
            Sheets(InBulkSheets).Cells(InI_Row, 4) = 0
            Sheets(InBulkSheets).Cells(InI_Row, 3) = TempTotalVAT - TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 3)
            Sheets(InBulkSheets).Cells(InI_Row, 5) = TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
            Sheets(InBulkSheets).Cells(InI_Row, 6) = TempTotalVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 6)
            ''Color
            Sheets(InBulkSheets).Rows(Str(InI_Row - 1)).Interior.ThemeColor = xlThemeColorAccent2
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Interior.ThemeColor = xlThemeColorAccent2
         Case "18%0%"
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Copy
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
            i_Row = i_Row + 1
          ''18%
            Sheets(InBulkSheets).Cells(InI_Row - 1, 4) = 0.18
            Sheets(InBulkSheets).Cells(InI_Row - 1, 5) = Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
            Sheets(InBulkSheets).Cells(InI_Row - 1, 6) = Round((Sheets(InBulkSheets).Cells(InI_Row - 1, 5) / 18) * 118, 2)
            Sheets(InBulkSheets).Cells(InI_Row - 1, 3) = Sheets(InBulkSheets).Cells(InI_Row - 1, 6) - Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
          ''0%
            Sheets(InBulkSheets).Cells(InI_Row, 4) = 0
            Sheets(InBulkSheets).Cells(InI_Row, 3) = TempTotalVAT - TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 3)
            Sheets(InBulkSheets).Cells(InI_Row, 5) = TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
            Sheets(InBulkSheets).Cells(InI_Row, 6) = TempTotalVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 6)
            ''Color
            Sheets(InBulkSheets).Rows(Str(InI_Row - 1)).Interior.ThemeColor = xlThemeColorAccent2
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Interior.ThemeColor = xlThemeColorAccent2
         Case "18%NotNDS"
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Copy
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Insert Shift:=xlDown
            i_Row = i_Row + 1
          ''18%
            Sheets(InBulkSheets).Cells(InI_Row - 1, 4) = 0.18
            Select Case Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
            Case 28.28
                       Sheets(InBulkSheets).Cells(InI_Row - 1, 3) = 157.12
                       Sheets(InBulkSheets).Cells(InI_Row - 1, 5) = 28.28
                       Sheets(InBulkSheets).Cells(InI_Row - 1, 6) = 185.4
            Case 29.39
                       Sheets(InBulkSheets).Cells(InI_Row - 1, 3) = 163.31
                       Sheets(InBulkSheets).Cells(InI_Row - 1, 5) = 29.39
                       Sheets(InBulkSheets).Cells(InI_Row - 1, 6) = 192.7
            End Select
          ''|fffd||fffd||fffd| |fffd||fffd||fffd|
            Sheets(InBulkSheets).Cells(InI_Row, 4) = "|fffd||fffd||fffd| |fffd||fffd||fffd|"
            Sheets(InBulkSheets).Cells(InI_Row, 3) = TempTotalVAT - TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 3)
            Sheets(InBulkSheets).Cells(InI_Row, 5) = TempTotalServiceVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 5)
            Sheets(InBulkSheets).Cells(InI_Row, 6) = TempTotalVAT - Sheets(InBulkSheets).Cells(InI_Row - 1, 6)
            ''Color
            Sheets(InBulkSheets).Rows(Str(InI_Row - 1)).Interior.Color = 65535
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Interior.Color = 65535
         Case Else
            Call MsgBox("ERROR Type Separation VAT fop PrType [" + InPrType + "]", vbCritical)
            Sheets(InBulkSheets).Rows(Str(InI_Row)).Interior.Color = 255
      End Select
      
   i_Row = i_Row + 1
   
Exit Sub
Error:
    Call MsgBox("ERROR Sub AddStroka03 " + Str(Err.Number) + " " + Err.Description, vbCritical)
    Err.Clear
End Sub

Function GetTypeSeparation(InPrType As String, InRealVat As Double) As String
On Error GoTo Error:
If InRealVat < 0 Then
   GetTypeSeparation = "ERROR"
Else
    'Molchanova, Nadezhda CWT-RU |fffd||fffd| 22.12.2015 16:05 RE: |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| Lilly
    Select Case InPrType
      '(AIR INT) |fffd| (RAIL)
       Case "AER", "DAI", "DRD", "DRI", "EIE", "EII", "EIN", "EIR", "EOR", "ERI", "GIP", "LCC", "NAD", "PII", "PIN", "PMI", "RAE", "RAI", "RPD", "RPI", "RWB", "SUI", "VAI"
          If (InRealVat <> 0) And (InRealVat < 17.99 Or InRealVat > 18.01) Then
             GetTypeSeparation = "18%0%" '|fffd||fffd||fffd||fffd||fffd||fffd|  (18% |fffd| 0%)
          Else
             GetTypeSeparation = "0%10%18%"
          End If
      '(AIR DOM |fffd| RAIL DOM)
       Case "AAD", "AWB", "CHR", "DAD", "ECR", "EDI", "EDN", "EDR", "ERD", "GDP", "LCD", "PDI", "PDN", "PMD", "PSI", "SUD", "VAD", "RAD", "RDD"
          If (InRealVat <> 0) And (InRealVat < 17.99 Or InRealVat > 18.01) And (InRealVat < 9.99 Or InRealVat > 10.01) Then
             If InRealVat > 10 Then
                GetTypeSeparation = "10%18%" '(10% |fffd| 18%)
             Else
                GetTypeSeparation = "10%0%" '(10% |fffd| 0%)
             End If
          Else
             GetTypeSeparation = "0%10%18%"
          End If
       'Molchanova, Nadezhda CWT-RU (RFD) 27.09.2016
       Case "RFD"
          If (InRealVat <> 0) And (InRealVat < 17.99 Or InRealVat > 18.01) And (InRealVat < 9.99 Or InRealVat > 10.01) Then
             GetTypeSeparation = "18%NotNDS"
          Else
             GetTypeSeparation = "0%10%18%"
          End If
       Case Else
          If (InRealVat <> 0) And (InRealVat < 17.99 Or InRealVat > 18.01) And (InRealVat < 9.99 Or InRealVat > 10.01) Then
             GetTypeSeparation = "ERROR"
          Else
             GetTypeSeparation = "0%10%18%"
          End If
    End Select
End If
Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function GetTypeSeparation " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

Private Function ToDouble(InText As Variant) As Double
On Error GoTo Error:

   If IsNumeric(InText) Then
      ToDouble = CDbl(InText)
   Else
      ToDouble = 0
   End If

Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function ToDouble " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function




Attribute VB_Name = "FindETicket"
'|fffd||fffd||fffd||fffd|1
Public Const TempPuth As String = "\\10.200.32.27\ETicket\"

Public Const TempPuthTempETicketsDir As String = "C:\TempETickets\"
Public Const TempPuth_To_WEB_site As String = "\\10.200.32.27\ETicket\To_WEB_site\"

''|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Function FindETicketFile(InTicketNumber As String, InPath As String) As String
On Error GoTo Error:
 
   FindETicketFile = "No File!"
   
   '|fffd||fffd||fffd||fffd||fffd|, |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| (05 |fffd||fffd||fffd||fffd||fffd||fffd| 2019 |fffd|. 11:17)
   '1 |fffd||fffd||fffd|. 2019 |fffd|., |fffd| 16:59, Pavluk, Anastasia |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd|
   
   K_Nummer = GetK_Nummer(Sheets(FindTableSheets).Cells(1, 1).Text)
   If InStr(1, "[A01500][B00092][B00677]", K_Nummer, vbTextCompare) = 0 Then
      AllPath = Array(InPath + "Amadeus\", InPath + "Sabre\", InPath + "Sirena\", InPath + "UFS\")
   Else
      AllPath = Array(InPath + "UFS\", InPath + "Amadeus\", InPath + "Sirena\", InPath + "Sabre\")
   End If
   
   For i = 1 To 4
      If ExistFile(AllPath(i - 1) + InTicketNumber + ".pdf") Then
         FindETicketFile = AllPath(i - 1) + InTicketNumber + ".pdf"
         Exit Function
      Else
         If ExistFile(AllPath(i - 1) + InTicketNumber + ".html") Then
            FindETicketFile = AllPath(i - 1) + InTicketNumber + ".html"
            Exit Function
         End If
      End If
   Next i
   Exit Function
   
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindETicketFile " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

''|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd| BSP_HOT |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| NDS |fffd||fffd| SQL Twinsen 10.11.2015
Private Function FindNDS_BSP_HOT(InTicketNumber As String) As String
On Error GoTo Error:
  
   Set objConn = CreateObject("ADODB.Connection")
   ConnectString = "Provider=SQLOLEDB;Data Source=10.200.32.10;Initial Catalog=p1minfoweekly;UID=p1minfoweekly_Manager;PWD=p1minfoweekly_Manager"
   objConn.ConnectionString = ConnectString
   objConn.ConnectionTimeOut = 10
   objConn.CommandTimeout = 0
   objConn.Open
   Set objRecordset = objConn.Execute("SELECT TOP 1 [VAT] FROM [dbo].[Reports_BSP_HOT] WHERE [DOCUMENT NUMBER] = '" + InTicketNumber + "'")
   If Not objRecordset.EOF Then
      FindNDS_BSP_HOT = Trim(Str(objRecordset.Fields.Item(0).value))
   Else
      FindNDS_BSP_HOT = "No Data!"
   End If
   Set objRecordset = Nothing
   objConn.Close
   Set objConn = Nothing
   Exit Function
Error:
   Set objRecordset = Nothing
   objConn.Close
   Set objConn = Nothing
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindNDS_BSP_HOT " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

''|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Function FindNDS(InTicketNumber As String, InPath As String) As String
On Error GoTo Error:
   FindNDS = FindNDS_BSP_HOT(InTicketNumber)
   If FindNDS = "No Data!" Or FindNDS = "0" Then
       Dim FSO As FileSystemObject
       Dim f As File
       Dim fStream, nds
       
       Set FSO = New FileSystemObject
    
       FindNDS = "No File!"
       AllPath = Array(InPath + "Amadeus\", InPath + "Sabre\", InPath + "Sirena\", InPath + "UFS\")
    
       For i = 1 To 4
          If ExistFile(AllPath(i - 1) + InTicketNumber + ".txt") Then
             Set f = FSO.GetFile(AllPath(i - 1) + InTicketNumber + ".txt")
             Set fStream = f.OpenAsTextStream(ForReading)
             nds = Replace(fStream.ReadLine, ",", ".")
             FindNDS = nds
             fStream.Close
             Set f = Nothing
             Set FSO = Nothing
             Set fStream = Nothing
             Exit Function
          End If
       Next i
   End If
   Exit Function
   
Error:
   Set f = Nothing
   Set FSO = Nothing
   Set fStream = Nothing
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindNDSFile " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

''|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Function FindETicketDate(InTicketNumber As String, InPath As String) As String
On Error GoTo Error:

   Dim FSO As FileSystemObject
   Dim f As File
   Dim fStream, nds
   
   Set FSO = New FileSystemObject

   FindETicketDate = "No File!"
   AllPath = InPath + "ETicketDate\"

      If ExistFile(AllPath + InTicketNumber + ".txt") Then
         Set f = FSO.GetFile(AllPath + InTicketNumber + ".txt")
         Set fStream = f.OpenAsTextStream(ForReading)
         TicketDate = fStream.ReadLine
         FindETicketDate = TicketDate
         fStream.Close
         Set f = Nothing
         Set FSO = Nothing
         Set fStream = Nothing
         Exit Function
      End If

   Exit Function
   
Error:
   Set f = Nothing
   Set FSO = Nothing
   Set fStream = Nothing
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindETicketDate " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function


Sub FindAllTickets()
On Error GoTo Error:

TempTime = Now()
Dim TableSheets As String
TableSheets = FindTableSheets

Dim TempFindETicketFile, TempVATFindInTheFile As Variant

If TableSheets <> "" Then
   If ExistDir(TempPuth + "Amadeus\") And ExistDir(TempPuth + "Sabre\") And ExistDir(TempPuth + "Sirena\") And ExistDir(TempPuth + "UFS\") Then
      i = 2
      longString = ""
      While Sheets(TableSheets).Cells(i, 1).Text <> Empty
      
      If TestProductTypeForETickets(Sheets(TableSheets).Cells(i, 8).Text) Then
         
         If Len(Sheets(TableSheets).Cells(i, 11).Text) >= 10 Then
         'NDS
            TempVATFindInTheFile = FindNDS(Sheets(TableSheets).Cells(i, 11).Text, TempPuth)
            '|fffd| 1 |fffd||fffd||fffd||fffd||fffd| 2015 |fffd||fffd||fffd| [EDR] |fffd| [ERI] ( 04 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ERD ) (23 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HIS) |fffd||fffd||fffd||fffd||fffd||fffd| VAT 18% = 0
            If InStr(1, ProductTypeNoNDS, "[" + Sheets(TableSheets).Cells(i, 8) + "]", vbTextCompare) Then
               TempVATFindInTheFile = 0
            End If
            '|fffd| 12 |fffd||fffd||fffd||fffd| 2016 |fffd||fffd||fffd| [RFD] |fffd||fffd||fffd||fffd||fffd||fffd| VAT = 28.28
            If Sheets(TableSheets).Cells(i, 8) = "RFD" Then
               If CDate(Sheets(TableSheets).Cells(i, 4)) < CDate("01.01.2017") Then
                  TempVATFindInTheFile = 28.28
               Else
                 '|fffd| 01 |fffd||fffd||fffd||fffd||fffd||fffd| 2017 |fffd||fffd||fffd| [RFD] VAT = ?
                  Select Case Sheets(TableSheets).Cells(i, 23)
                  Case 185.4
                       TempVATFindInTheFile = 28.28
                  Case 192.7
                       TempVATFindInTheFile = 29.39
                  Case Is > 192.7
                       TempVATFindInTheFile = 29.39
                  Case Else
                       TempVATFindInTheFile = 0
                  End Select
               End If
            End If
            '|fffd| 12 |fffd||fffd||fffd||fffd| 2016 |fffd||fffd||fffd| [RFI] |fffd||fffd||fffd||fffd||fffd||fffd| VAT = 0
            If Sheets(TableSheets).Cells(i, 8) = "RFI" Then
               TempVATFindInTheFile = 0
            End If
            If TempVATFindInTheFile = "No File!" Then
               Sheets(TableSheets).Cells(i, 22) = "No file!"
               NDS_OK = 0
            Else
               TempVATFindInTheFile = CDbl(Replace(TempVATFindInTheFile, ".", ",", 1, -1, vbTextCompare))
              '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| Total |fffd||fffd||fffd||fffd||fffd||fffd| 0, |fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 0.
               If Sheets(TableSheets).Cells(i, 23) < 0 Then TempVATFindInTheFile = TempVATFindInTheFile * -1
              '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| Total = 0, |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| = 0.
               If Sheets(TableSheets).Cells(i, 23) = 0 Then TempVATFindInTheFile = 0
              '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| Total |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|, |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
              '|fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| P1 |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| 10% |fffd||fffd| Total, |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| = 0
               If Sheets(TableSheets).Cells(i, 23) < 0 Then
                  If Sheets(TableSheets).Cells(i, 23) * -1 < TempVATFindInTheFile * -1 And Sheets(TableSheets).Cells(i, 22) <> 0 Then TempVATFindInTheFile = (Sheets(TableSheets).Cells(i, 23) / 110) * 10
               Else
                  If Sheets(TableSheets).Cells(i, 23) < TempVATFindInTheFile And Sheets(TableSheets).Cells(i, 22) <> 0 Then TempVATFindInTheFile = (Sheets(TableSheets).Cells(i, 23) / 110) * 10
               End If
               TempVATFindInTheFile = CDbl(Format(TempVATFindInTheFile, "#,##0.00"))
               Sheets(TableSheets).Cells(i, 22) = TempVATFindInTheFile
               NDS_OK = 1
            End If
         'File
            TempFindETicketFile = FindETicketFile(Sheets(TableSheets).Cells(i, 11).Text, TempPuth)
            If TempFindETicketFile = "No File!" Then
               ETicketFile = 0
            Else
               ETicketFile = 1
            End If
         'ETicketDate
            If Sheets(TableSheets).Cells(i, 77) = "" Or Sheets(TableSheets).Cells(i, 77) = "No File!" Then
               TempFindETicketDate = FindETicketDate(Sheets(TableSheets).Cells(i, 11).Text, TempPuth)
               Sheets(TableSheets).Cells(i, 77) = TempFindETicketDate
               If TempFindETicketDate = "No File!" Then
                  Sheets(TableSheets).Cells(i, 77).Interior.Color = 65535
                  ETicketDate = 0
               Else
                  Sheets(TableSheets).Cells(i, 77).Interior.Color = 15466495
                  ETicketDate = 1
               End If
            End If
         '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
            If NDS_OK + ETicketFile = 2 Then
               Sheets(TableSheets).Range("A" + Trim(i) + ":BX" + Trim(i)).Interior.Pattern = xlNone
               If NDS_OK = 1 Then
                  Sheets(TableSheets).Cells(i, 22).Interior.Color = 15466495
               End If
            Else
               Sheets(TableSheets).Range("A" + Trim(i) + ":BX" + Trim(i)).Interior.Color = 255
            End If
         Else
            Sheets(TableSheets).Range("A" + Trim(i) + ":BX" + Trim(i)).Interior.Color = 255
         End If
         '|fffd| 14 |fffd||fffd||fffd||fffd| 2016 |fffd||fffd||fffd| [AER][AEX], [RAI] |fffd| [RPI] |fffd||fffd||fffd||fffd||fffd||fffd| VAt 18% = 0 |fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| (Nadezhda Molchanova | Senior Accountant)
         If Sheets(TableSheets).Cells(i, 8) = "AER" Or Sheets(TableSheets).Cells(i, 8) = "AEX" Or Sheets(TableSheets).Cells(i, 8) = "RAI" Or Sheets(TableSheets).Cells(i, 8) = "RPI" Then
            Sheets(TableSheets).Cells(i, 22) = 0
            Sheets(TableSheets).Range("A" + Trim(i) + ":BX" + Trim(i)).Interior.Color = xlNone
         End If
      Else
         Sheets(TableSheets).Range("A" + Trim(i) + ":BX" + Trim(i)).Interior.Color = 6750054
      End If
         i = i + 1
      Wend
   Else
      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|! [\\10.200.32.27\ETicket\]", vbCritical
      Exit Sub
   End If
Else
   Exit Sub
End If

MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd|! " + Format(TempTime - Now(), "(hh:mm:ss)"), vbInformation

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub FindAllTickets " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub


Sub CopyAllTickets()
On Error GoTo Error:

Dim zFilename As String, TempPassword As String, longString As String, TableSheets As String, TempFindETicketFile As Variant, TempETicketsDir As String
TableSheets = FindTableSheets
K_Nummer = GetK_Nummer(Sheets(TableSheets).Cells(1, 1).Text)


'AirCode BEGIN
GetAirCodeTF = False
If K_Nummer = "B00677" Or K_Nummer = "B00676" Or K_Nummer = "A00283" Or K_Nummer = "A00194" Then
   If MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Air Code?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|") = vbYes Then
      Sheets(TableSheets).Cells(1, 80) = "Air Code"
      GetAirCodeTF = True
   End If
End If
'AirCode END

TempTime = Now()
longString = ""


If TableSheets <> "" Then
   If ExistDir(TempPuth) Then
      If CreateTempETicketsDir(TempPuthTempETicketsDir) Then
         i = 2
         While Sheets(TableSheets).Cells(i, 1).Text <> Empty
            If TestProductTypeForETickets(Sheets(TableSheets).Cells(i, 8).Text) Then
               If Sheets(TableSheets).Cells(i, 11).Text = "" Then Sheets(TableSheets).Cells(i, 11) = "no ticket number"
               longString = longString & Sheets(TableSheets).Cells(i, 11).Text
               TempFindETicketFile = FindETicketFile(Sheets(TableSheets).Cells(i, 11).Text, TempPuth)
               If ExistFile(TempFindETicketFile) Then
                  FileCopy TempFindETicketFile, TempPuthTempETicketsDir + Sheets(TableSheets).Cells(i, 11).Text + "." + Right(TempFindETicketFile, Len(TempFindETicketFile) - InStr(Len(TempPuth_To_WEB_site), TempFindETicketFile, ".", vbTextCompare))
                  Sheets(TableSheets).Cells(i, 11).Interior.Color = xlNone
               Else
                  MsgBox "|fffd||fffd||fffd||fffd||fffd| " + Sheets(TableSheets).Cells(i, 11).Text + " |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|!", vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!"
                  Sheets(TableSheets).Cells(i, 11).Interior.Color = 255
               End If
               'BEGIN Twinsen 06.06.2016
               If InStr(1, TempFindETicketFile, ".html", vbTextCompare) > 0 Then TempFindKrsFile = Replace(TempFindETicketFile, ".html", "R.html")
               If InStr(1, TempFindETicketFile, ".pdf", vbTextCompare) > 0 Then TempFindKrsFile = Replace(TempFindETicketFile, ".pdf", "R.pdf")
               If ExistFile(TempFindKrsFile) And TempFindETicketFile <> "No File!" Then
                  FileCopy TempFindKrsFile, TempPuthTempETicketsDir + Sheets(TableSheets).Cells(i, 11).Text + "R." + Right(TempFindKrsFile, Len(TempFindKrsFile) - InStr(Len(TempPuth_To_WEB_site), TempFindKrsFile, ".", vbTextCompare))
               End If
               'END Twinsen 06.06.2016
               
               'BEGIN Twinsen 18.08.2017
               If K_Nummer = "A01447" Then
                  If Sheets(TableSheets).Cells(i, 49).Text <> Empty Then
                     If ExistFile("\\10.200.32.11\Users\Everyone\Jaguar Landrover\Travel requests\2018\" + Sheets(TableSheets).Cells(i, 49).Text + ".pdf") Then
                        FileCopy "\\10.200.32.11\Users\Everyone\Jaguar Landrover\Travel requests\2018\" + Sheets(TableSheets).Cells(i, 49).Text + ".pdf", TempPuthTempETicketsDir + Sheets(TableSheets).Cells(i, 49).Text + ".pdf"
                     Else
                        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd| [\\10.200.32.11\Users\Everyone\Jaguar Landrover\Travel requests\2018\" + Sheets(TableSheets).Cells(i, 49).Text + ".pdf]" + " |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|!", vbCritical
                     End If
                  Else
                     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd| BF [" + Sheets(TableSheets).Cells(i, 2).Text + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Travel requests! [0603*]", vbCritical
                  End If
               End If
               'END Twinsen 18.08.2017
               
               'AirCode BEGIN
               If GetAirCodeTF Then Sheets(TableSheets).Cells(i, 80) = GetAirCode(NullSTR(Sheets(TableSheets).Cells(i, 11).Text))
               'AirCode END
               
            End If
            i = i + 1
         Wend
      Else
         MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! " + TempPuthTempETicketsDir, vbCritical
      End If
   Else
      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|! " + TempPuth, vbCritical
      'MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|!", vbCritical
   End If
   
   TempPassword = GetCodCustomer(Sheets(TableSheets).Cells(2, 38).Text)
     
   TempFind7Zip = Find7Zip
   If Find7Zip <> "" Then
      If longString <> "" And TempPassword <> "" Then
         zFilename = MD5_string(longString)
         TempPassword = MD5_string(TempPassword)
         
         Dim oShell As WshShell
         Set oShell = CreateObject("Wscript.Shell")
         '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| Run |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Wscript.Shell
        'oShell.Run """" + Find7Zip + """ a -sfx " & TempPuthTempETicketsDir & zFilename & ".exe " & TempPuthTempETicketsDir & " -p" & TempPassword & " -mhe", 1, True
        '.EXE
         If ExistFile(TempPuthTempETicketsDir & zFilename & ".exe") Then Kill (TempPuthTempETicketsDir & zFilename & ".exe")
         oShell.Run """" + Find7Zip + """ a -sfx " & TempPuthTempETicketsDir & zFilename & ".exe " & TempPuthTempETicketsDir & " -p" & TempPassword, 1, True
         If ExistFile(TempPuth_To_WEB_site & zFilename & ".exe") Then Kill (TempPuth_To_WEB_site & zFilename & ".exe")
         If ExistFile(TempPuthTempETicketsDir & zFilename & ".exe") Then FileCopy TempPuthTempETicketsDir & zFilename & ".exe", TempPuth_To_WEB_site & zFilename & ".exe"
        '.ZIP
         If ExistFile(TempPuthTempETicketsDir & zFilename & ".exe") Then Kill (TempPuthTempETicketsDir & zFilename & ".exe")
         If ExistFile(TempPuthTempETicketsDir & zFilename & ".zip") Then Kill (TempPuthTempETicketsDir & zFilename & ".zip")
         oShell.Run """" + Find7Zip + """ a -tzip " & TempPuthTempETicketsDir & zFilename & ".zip " & TempPuthTempETicketsDir & " -p" & TempPassword, 1, True
         If ExistFile(TempPuth_To_WEB_site & zFilename & ".zip") Then Kill (TempPuth_To_WEB_site & zFilename & ".zip")
         If ExistFile(TempPuthTempETicketsDir & zFilename & ".zip") Then FileCopy TempPuthTempETicketsDir & zFilename & ".zip", TempPuth_To_WEB_site & zFilename & ".zip"
         '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
         Set oShell = Nothing
         
         'Call SaveInfoFile(zFilename, TempPassword, "http://www.cwtruss.ru/" + zFilename + ".exe")
         Call SaveInfoFile(zFilename, TempPassword, "http://www.cwtruss.ru/" + zFilename + ".exe" + Chr(13) + Chr(10) + "URL:http://www.cwtruss.ru/" + zFilename + ".zip")
      Else
         MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 7zip!"
      End If
   Else
      MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 7zip!"
   End If
   
   If GetAirCodeTF = True Then
      Sheets(TableSheets).Columns("CB:CB").Interior.ThemeColor = xlThemeColorAccent6
      Sheets(TableSheets).Range("CB1").Interior.Color = 12632256
      Sheets(TableSheets).Columns("CB:CB").Cut
      Sheets(TableSheets).Columns("K:K").Insert Shift:=xlToRight
   End If
   
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd|! " + Format(TempTime - Now(), "(hh:mm:ss)"), vbInformation
   CreateTempETicketsDir (TempPuthTempETicketsDir)
   'password = InputBox("|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| " + TempPassword, "URL", "http://www.cwtruss.ru/" + zFilename + ".exe")
   
End If

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub CopyAllTickets " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub

''OK |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Private Function ExistFile(ByVal strFileName As String) As Boolean
On Error GoTo Error:

  ExistFile = False
  ExistFile = (Dir(strFileName, vbNormal) <> "")

  Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function ExistFile " + Str(Err.Number) + " " + Err.Description + " FileName[" + strFileName + "]", vbCritical
   Err.Clear
End Function

''OK |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Private Function ExistDir(ByVal dirName As String) As Boolean
On Error GoTo Error:
  ExistDir = False
    If Right(dirName, 1) = "\" Then dirName = Left(dirName, Len(dirName) - 1)
    If Left(dirName, 2) = "\\" Then
      ExistDir = (Dir(dirName + "\", vbDirectory) <> "")
      Else
      ExistDir = (Dir(dirName, vbDirectory) <> "")
    End If

   Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function ExistDir " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 'Amount of service (NO VAT)' |fffd| 'Total VAT'
Sub UpdateVAT()
On Error GoTo Error:

Dim TableSheets As String
TableSheets = FindTableSheets

If TableSheets <> "" Then
   If CheckSheetForErrors(TableSheets) Then
      Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 'Amount of service (NO VAT)' |fffd| 'Total VAT'?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      If Response = vbYes Then
         TempTime = Now()
         i = 2
         While Sheets(TableSheets).Cells(i, 1).Text <> Empty
            If TestProductTypeForETickets(Sheets(TableSheets).Cells(i, 8).Text) Then
               'Amount of service (NO VAT) 21
               Sheets(TableSheets).Cells(i, 21) = Sheets(TableSheets).Cells(i, 23) - Sheets(TableSheets).Cells(i, 22)
               'Total VAT
               Sheets(TableSheets).Cells(i, 37) = (Sheets(TableSheets).Cells(i, 22) + Sheets(TableSheets).Cells(i, 25) + Sheets(TableSheets).Cells(i, 28) + Sheets(TableSheets).Cells(i, 31) + Sheets(TableSheets).Cells(i, 34)) - Sheets(TableSheets).Cells(i, 40)
            End If
            i = i + 1
         Wend
         MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd|! " + Format(TempTime - Now(), "(hh:mm:ss)"), vbInformation
      End If
   Else
      MsgBox "|fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 'Amount of service (NO VAT)' |fffd| 'Total VAT' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation
   End If
End If

Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub UpdateVAT " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub

''|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Private Function CheckSheetForErrors(InTableSheets As String) As Boolean
On Error GoTo Error:

   CheckSheetForErrors = False
   If InTableSheets <> "" Then
      CheckSheetForErrors = True
      i = 2
      While Sheets(InTableSheets).Cells(i, 1).Text <> Empty
         If Sheets(InTableSheets).Cells(i, 22).Interior.Color = 255 Then CheckSheetForErrors = False
         i = i + 1
      Wend
   End If

   Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function CheckSheetForErrors " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

Function TestProductTypeForETickets(InNameProductType As String) As Boolean
On Error GoTo Error:

   TestProductTypeForETickets = False

   If ProductType(InNameProductType) = "Air" Or ProductType(InNameProductType) = "Rail" Then TestProductTypeForETickets = True

   Exit Function
   
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function TestProductTypeForETickets " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

'|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 7zip! |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|...
Function Find7Zip() As String
On Error GoTo Error:

   Find7Zip = ""
   If ExistFile("C:\Program Files\7-Zip\7z.exe") Then
      Find7Zip = "C:\Program Files\7-Zip\7z.exe"
   Else
      If ExistFile("C:\Program Files (x86)\7-Zip\7z.exe") Then
         Find7Zip = "C:\Program Files (x86)\7-Zip\7z.exe"
      End If
   End If
   Exit Function
   
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function Find7Zip " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear

End Function

Function CreateTempETicketsDir(InNameETicketsDir As String) As Boolean
On Error GoTo Error:

   CreateTempETicketsDir = False
   
   If ExistDir(InNameETicketsDir) Then
      Set Tempfs = CreateObject("Scripting.FileSystemObject")
      If Right(InNameETicketsDir, 1) = "\" Then
         Call Tempfs.DeleteFolder(Left(InNameETicketsDir, Len(InNameETicketsDir) - 1))
      Else
         Call Tempfs.DeleteFolder(InNameETicketsDir)
      End If
      Set Tempfs = Nothing
   End If
   MkDir (InNameETicketsDir)
   If ExistDir(InNameETicketsDir) Then CreateTempETicketsDir = True
  
   Exit Function
   
Error:
   Set Tempfs = Nothing
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function CreateTempETicketsDir " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

Private Function GetCodCustomer(InNameCustomer As String) As String
On Error GoTo Error:

   If InNameCustomer <> "" And InStr(1, InNameCustomer, ",", vbTextCompare) Then
      GetCodCustomer = Left(InNameCustomer, InStr(1, InNameCustomer, ",", vbTextCompare) - 1)
   Else
      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Customer is null [Cells(2, 38)]", vbCritical
      GetCodCustomer = ""
   End If

   Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function GetCodCustomer " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

''|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| INFO |fffd||fffd||fffd||fffd|
Private Sub SaveInfoFile(InFileName As String, InPassword As String, InURL As String)
On Error GoTo Error:

Set FSO = CreateObject("Scripting.FilesystemObject")

   If ExistFile(TempPuthTempETicketsDir + InFileName + ".txt") Then Kill (TempPuthTempETicketsDir + InFileName + ".txt")
   Set Textfile = FSO.OpenTextFile(TempPuthTempETicketsDir + InFileName + ".txt", 2, True) '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
   Textfile.WriteLine "URL:" + InURL & vbCrLf & "Password:" + InPassword
   Textfile.Close

Set FSO = Nothing
Set Textfile = Nothing

    'Windows Script Host Object Model
    Dim oShell As WshShell
    Set oShell = CreateObject("Wscript.Shell")
    oShell.Run "notepad.exe " + TempPuthTempETicketsDir + InFileName + ".txt", 1, False
    Set oShell = Nothing


    Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function SaveInfoFile " + Str(Err.Number) + " " + Err.Description, vbCritical
   Set FSO = Nothing
   Set Textfile = Nothing
   Err.Clear

End Sub

Function GetAirCode(InTicketno As String) As String
On Error GoTo Error:
GetAirCode = ""
If Len(InTicketno) > 0 Then
'***SQL SERVER***
   Set objConn = CreateObject("ADODB.Connection")
   Set objRecordset = CreateObject("ADODB.Recordset")
   objConn.ConnectionString = "Provider=SQLOLEDB;Data Source=10.200.32.10;Initial Catalog=p1minfoweekly;UID=p1minfoweekly_Manager;PWD=p1minfoweekly_Manager"
   objConn.ConnectionTimeOut = 10
   objConn.CommandTimeout = 0
   objConn.Open
   objRecordset.Open "SELECT TOP 1 * FROM OpenQuery(PostgreSQL35W, 'SELECT ""AirCode"" FROM ""main_carlsonw"" WHERE ""TICKETNO"" = ''" + InTicketno + "'';')", objConn
   If Not objRecordset.EOF Then
      GetAirCode = Trim(NullSTR(objRecordset.Fields.Item(0).value))
   End If
   objRecordset.Close
   objConn.Close
   Set objConn = Nothing
   Set objRecordset = Nothing
End If

    Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function GetAirCode " + Str(Err.Number) + " " + Err.Description, vbCritical
   objRecordset.Close
   objConn.Close
   Set objConn = Nothing
   Set objRecordset = Nothing
   Err.Clear

End Function


Attribute VB_Name = "FindSupplier"
'|fffd||fffd| 14 |fffd| 72-73-74

Sub FindAllSupplier()
On Error GoTo Error:

Response = MsgBox("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then
   TempTime = Now()
   Application.ScreenUpdating = False
   Call GetSupplierName
   Application.ScreenUpdating = True
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd|! " + Format(TempTime - Now(), "(hh:mm:ss)"), vbInformation
End If

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub FindAllSupplier " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub

Public Sub GetSupplierName()
On Error GoTo Error:

Set objConn = CreateObject("ADODB.Connection")
ConnectString = "Provider=SQLOLEDB;Data Source=10.200.32.10;Initial Catalog=CWT;UID=CWT_Manager;PWD=CWT_Manager"
objConn.ConnectionString = ConnectString
objConn.ConnectionTimeOut = 10
objConn.CommandTimeout = 0
objConn.Open

Dim TableSheets As String
TableSheets = FindTableSheets

If TableSheets <> "" Then
   Dim i As Double
   i = 2
   While Sheets(TableSheets).Cells(i, 1).Text <> Empty
   
       ''********************************************************************************************************
       AddSupplierInfo True, TableSheets, i, "", "", ""
       If ProductType(Sheets(TableSheets).Cells(i, 8).Text) = "Air" Or ProductType(Sheets(TableSheets).Cells(i, 8).Text) = "Rail" Then
          '14-Supplier Name
          Dim InNameSearch As String
          InNameSearch = Sheets(TableSheets).Cells(i, 14).Text
          '11-Ticket number
          Dim InETicketNum As String
          InETicketNum = Sheets(TableSheets).Cells(i, 11).Text
          If Len(InETicketNum) > 0 Then
               '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| E-Ticket Number
               Set objRecordset1 = objConn.Execute("SELECT * FROM [dbo].[GetSupplierNameSearch] ('" + InETicketNum + "')")
               If Not objRecordset1.EOF Then
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                  Set objRecordset2 = objConn.Execute("SELECT * FROM [dbo].[GetSupplierNameRusInnKpp] ('" + objRecordset1.Fields.Item(0).value + "')")
                  If Not objRecordset2.EOF Then
                     AddSupplierInfo False, TableSheets, i, Trim(objRecordset2.Fields.Item(0).value), Trim(objRecordset2.Fields.Item(1).value), Trim(objRecordset2.Fields.Item(2).value)
                  Else
                     AddSupplierInfo False, TableSheets, i, objRecordset1.Fields.Item(0).value, "0", "0"
                     AddErrorFindSupplierLog objRecordset1.Fields.Item(0).value
                  End If
                  Set objRecordset2 = Nothing
               Else
                  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                  Set objRecordset2 = objConn.Execute("SELECT * FROM [dbo].[GetSupplierNameRusInnKpp] ('" + InNameSearch + "')")
                  If Not objRecordset2.EOF Then
                     AddSupplierInfo False, TableSheets, i, Trim(objRecordset2.Fields.Item(0).value), Trim(objRecordset2.Fields.Item(1).value), Trim(objRecordset2.Fields.Item(2).value)
                  Else
                     AddSupplierInfo False, TableSheets, i, InNameSearch, "0", "0"
                     AddErrorFindSupplierLog InNameSearch
                  End If
                  Set objRecordset2 = Nothing
               End If
               ''********************************************************************************************************
               Set objRecordset1 = Nothing
          Else
             AddSupplierInfo False, TableSheets, i, InNameSearch, "0", "0"
          End If
       End If
       i = i + 1
   Wend
End If

objConn.Close
Set objConn = Nothing

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub GetSupplierNameSearch " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear

End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 74
'|fffd||fffd||fffd| 73
'|fffd||fffd||fffd| 72
Sub AddSupplierInfo(InClear As Boolean, InConsignmentSheets As String, InI_Row As Double, InNameRus As String, InINN As String, InKPP As String)
On Error GoTo Error:

If InClear Then
   Sheets(InConsignmentSheets).Cells(InI_Row, 74) = ""
   Sheets(InConsignmentSheets).Cells(InI_Row, 73) = ""
   Sheets(InConsignmentSheets).Cells(InI_Row, 72) = ""
Else
   If Len(Trim(InNameRus)) > 0 Then
      If Len(Trim(Sheets(InConsignmentSheets).Cells(InI_Row, 74).Text)) = 0 Then
         Sheets(InConsignmentSheets).Cells(InI_Row, 74) = InNameRus
         Sheets(InConsignmentSheets).Cells(InI_Row, 73) = InKPP
         Sheets(InConsignmentSheets).Cells(InI_Row, 72) = InINN
      Else
         Sheets(InConsignmentSheets).Cells(InI_Row, 74) = " /" + Sheets(InConsignmentSheets).Cells(InI_Row, 74) + InNameRus
         Sheets(InConsignmentSheets).Cells(InI_Row, 73) = " /" + Sheets(InConsignmentSheets).Cells(InI_Row, 73) + InKPP
         Sheets(InConsignmentSheets).Cells(InI_Row, 72) = " /" + Sheets(InConsignmentSheets).Cells(InI_Row, 72) + InINN
      End If
   End If
End If

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub AddSupplierInfo " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub

Sub AddErrorFindSupplierLog(InName As String)
On Error GoTo Error:

If Len(Trim(InName)) > 0 Then

    Set objConn = CreateObject("ADODB.Connection")
    ConnectString = "Provider=SQLOLEDB;Data Source=10.200.32.10;Initial Catalog=CWT;UID=CWT_Manager;PWD=CWT_Manager"
    objConn.ConnectionString = ConnectString
    objConn.ConnectionTimeOut = 10
    objConn.CommandTimeout = 0
    objConn.Open

    Set objRecordset1 = objConn.Execute("SELECT * FROM [dbo].[Suppliers_RU_FindError] WHERE NameSearch = '" + InName + "'")
    If objRecordset1.EOF Then
       objConn.Execute ("INSERT INTO [dbo].[Suppliers_RU_FindError] ([NameSearch]) Values ('" + InName + "')")
    Else
       objConn.Execute ("UPDATE [dbo].[Suppliers_RU_FindError] SET [NumberOfRequests] = (SELECT [NumberOfRequests] FROM [dbo].[Suppliers_RU_FindError] WHERE NameSearch = '" + InName + "')+1 WHERE NameSearch = '" + InName + "'")
    End If
    objConn.Close
    Set objConn = Nothing
   
End If

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub AddErrorFindSupplierLog " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub
Attribute VB_Name = "MD5"
' A VB6/VBA procedure for the MD5 message-digest algorithm
' as described in RFC 1321 by R. Rivest, April 1992

' First published 16 September 2005.
'************************* COPYRIGHT NOTICE*************************
' This code was originally written in Visual Basic by David Ireland
' and is copyright (c) 2005 D.I. Management Services Pty Limited,
' all rights reserved.

' You are free to use this code as part of your own applications
' provided you keep this copyright notice intact and acknowledge
' its authorship with the words:

'   "Contains cryptography software by David Ireland of
'   DI Management Services Pty Ltd <www.di-mgt.com.au>."

' If you use it as part of a web site, please include a link
' to our site in the form
' <A HREF="http://www.di-mgt.com.au/crypto.html">Cryptography
' Software Code</a>

' This code may only be used as part of an application. It may
' not be reproduced or distributed separately by any means without
' the express written permission of the author.

' David Ireland and DI Management Services Pty Limited make no
' representations concerning either the merchantability of this
' software or the suitability of this software for any particular
' purpose. It is provided "as is" without express or implied
' warranty of any kind.

' The latest version of this source code can be downloaded from
' www.di-mgt.com.au/crypto.html.
' Comments and bug reports to http://www.di-mgt.com.au/contact.html
'****************** END OF COPYRIGHT NOTICE*************************

' POSSIBLE SPEED-UPS
' 1. Use memory copy functions from Win32 API to copy bytes into
'    32-bit words directly.
' 2. Write 16 x specific Rotate_Left_By_n functions with hardcoded
'    multiplicands for each possible shift S11..S44;
'    i.e. for n = 4-7, 9-12, 14-17, 20-23.

Private Const MD5_BLK_LEN As Long = 64
' Constants for MD5Transform routine
Private Const S11 As Long = 7
Private Const S12 As Long = 12
Private Const S13 As Long = 17
Private Const S14 As Long = 22
Private Const S21 As Long = 5
Private Const S22 As Long = 9
Private Const S23 As Long = 14
Private Const S24 As Long = 20
Private Const S31 As Long = 4
Private Const S32 As Long = 11
Private Const S33 As Long = 16
Private Const S34 As Long = 23
Private Const S41 As Long = 6
Private Const S42 As Long = 10
Private Const S43 As Long = 15
Private Const S44 As Long = 21
' Constants for unsigned word addition
Private Const OFFSET_4 = 4294967296#
Private Const MAXINT_4 = 2147483647

' TEST FUNCTIONS...
' MD5 test suite:
' MD5 ("") = d41d8cd98f00b204e9800998ecf8427e
' MD5 ("a") = 0cc175b9c0f1b6a831c399e269772661
' MD5 ("abc") = 900150983cd24fb0d6963f7d28e17f72
' MD5 ("message digest") = f96b697d7cb7938d525a2f31aaf161d0
' MD5 ("abcdefghijklmnopqrstuvwxyz") = c3fcd3d76192e4007dfb496cca67e13b
' MD5 ("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789") =
' d174ab98d277d9f5a5611c2c9f419d9f
' MD5 ("123456789012345678901234567890123456789012345678901234567890123456
' 78901234567890") = 57edf4a22be3c955ac49da2e2107b67a

' MD5 (1 million x 'a') = 7707d6ae4e027c70eea2a935c2296f21

' MAIN EXPORTED MD5 FUNCTIONS...

Public Function MD5_string(strMessage As String) As String
' Returns 32-char hex string representation of message digest
' Input as a string (max length 2^29-1 bytes)
    Dim abMessage() As Byte
    Dim mLen As Long
    ' Cope with the empty string
    If Len(strMessage) > 0 Then
        abMessage = StrConv(strMessage, vbFromUnicode)
        ' Compute length of message in bytes
        mLen = UBound(abMessage) - LBound(abMessage) + 1
    End If
    MD5_string = MD5_bytes(abMessage, mLen)
End Function

Public Function MD5_bytes(abMessage() As Byte, mLen As Long) As String
' Returns 32-char hex string representation of message digest
' Input as an array of bytes of length mLen bytes

    Dim nBlks As Long
    Dim nBits As Long
    Dim block(MD5_BLK_LEN - 1) As Byte
    Dim state(3) As Long
    Dim wb(3) As Byte
    Dim sHex As String
    Dim index As Long
    Dim partLen As Long
    Dim i As Long
    Dim j As Long

    ' Catch length too big for VB arithmetic (268 million!)
    If mLen >= &HFFFFFFF Then Error 6     ' overflow

    ' Initialise
    ' Number of complete 512-bit/64-byte blocks to process
    nBlks = mLen \ MD5_BLK_LEN

    ' Load magic initialization constants
    state(0) = &H67452301
    state(1) = &HEFCDAB89
    state(2) = &H98BADCFE
    state(3) = &H10325476

    ' Main loop for each complete input block of 64 bytes
    index = 0
    For i = 0 To nBlks - 1
        Call md5_transform(state, abMessage, index)
        index = index + MD5_BLK_LEN
    Next

    ' Construct final block(s) with padding
    partLen = mLen Mod MD5_BLK_LEN
    index = nBlks * MD5_BLK_LEN
    For i = 0 To partLen - 1
        block(i) = abMessage(index + i)
    Next
    block(partLen) = &H80
    ' Make sure padding (and bit-length) set to zero
    For i = partLen + 1 To MD5_BLK_LEN - 1
        block(i) = 0
    Next
    ' Two cases: partLen is < or >= 56
    If partLen >= MD5_BLK_LEN - 8 Then
        ' Need two blocks
        Call md5_transform(state, block, 0)
        For i = 0 To MD5_BLK_LEN - 1
            block(i) = 0
        Next
    End If
    ' Append number of bits in little-endian order
    nBits = mLen * 8
    block(MD5_BLK_LEN - 8) = nBits And &HFF
    block(MD5_BLK_LEN - 7) = nBits \ &H100 And &HFF
    block(MD5_BLK_LEN - 6) = nBits \ &H10000 And &HFF
    block(MD5_BLK_LEN - 5) = nBits \ &H1000000 And &HFF
    ' (NB we don't try to cope with number greater than 2^31)

    ' Final padded block with bit length
    Call md5_transform(state, block, 0)

    ' Decode 4 x 32-bit words into 16 bytes with LSB first each time
    ' and return result as a hex string
    MD5_bytes = ""
    For i = 0 To 3
        Call uwSplit(state(i), wb(3), wb(2), wb(1), wb(0))
        For j = 0 To 3
            If wb(j) < 16 Then
                sHex = "0" & Hex(wb(j))
            Else
                sHex = Hex(wb(j))
            End If
            MD5_bytes = MD5_bytes & sHex
        Next
    Next

End Function

' INTERNAL FUNCTIONS...

Private Sub md5_transform(state() As Long, buf() As Byte, ByVal index As Long)
' Updates 4 x 32-bit values in state
' Input: the next 64 bytes in buf starting at offset index
' Assumes at least 64 bytes are present after offset index
    Dim a As Long
    Dim b As Long
    Dim c As Long
    Dim d As Long
    Dim j As Integer
    Dim x(15) As Long

    a = state(0)
    b = state(1)
    c = state(2)
    d = state(3)

    ' Decode the next 64 bytes into 16 words with LSB first
    For j = 0 To 15
        x(j) = uwJoin(buf(index + 3), buf(index + 2), buf(index + 1), buf(index))
        index = index + 4
    Next

    ' Round 1
    a = FF(a, b, c, d, x(0), S11, &HD76AA478)   ' 1
    d = FF(d, a, b, c, x(1), S12, &HE8C7B756)   ' 2
    c = FF(c, d, a, b, x(2), S13, &H242070DB)   ' 3
    b = FF(b, c, d, a, x(3), S14, &HC1BDCEEE)   ' 4
    a = FF(a, b, c, d, x(4), S11, &HF57C0FAF)   ' 5
    d = FF(d, a, b, c, x(5), S12, &H4787C62A)   ' 6
    c = FF(c, d, a, b, x(6), S13, &HA8304613)   ' 7
    b = FF(b, c, d, a, x(7), S14, &HFD469501)   ' 8
    a = FF(a, b, c, d, x(8), S11, &H698098D8)   ' 9
    d = FF(d, a, b, c, x(9), S12, &H8B44F7AF)   ' 10
    c = FF(c, d, a, b, x(10), S13, &HFFFF5BB1)  ' 11
    b = FF(b, c, d, a, x(11), S14, &H895CD7BE)  ' 12
    a = FF(a, b, c, d, x(12), S11, &H6B901122)  ' 13
    d = FF(d, a, b, c, x(13), S12, &HFD987193)  ' 14
    c = FF(c, d, a, b, x(14), S13, &HA679438E)  ' 15
    b = FF(b, c, d, a, x(15), S14, &H49B40821)  ' 16

    ' Round 2
    a = GG(a, b, c, d, x(1), S21, &HF61E2562)   ' 17
    d = GG(d, a, b, c, x(6), S22, &HC040B340)   ' 18
    c = GG(c, d, a, b, x(11), S23, &H265E5A51)  ' 19
    b = GG(b, c, d, a, x(0), S24, &HE9B6C7AA)   ' 20
    a = GG(a, b, c, d, x(5), S21, &HD62F105D)   ' 21
    d = GG(d, a, b, c, x(10), S22, &H2441453)   ' 22
    c = GG(c, d, a, b, x(15), S23, &HD8A1E681)  ' 23
    b = GG(b, c, d, a, x(4), S24, &HE7D3FBC8)   ' 24
    a = GG(a, b, c, d, x(9), S21, &H21E1CDE6)   ' 25
    d = GG(d, a, b, c, x(14), S22, &HC33707D6)  ' 26
    c = GG(c, d, a, b, x(3), S23, &HF4D50D87)   ' 27
    b = GG(b, c, d, a, x(8), S24, &H455A14ED)   ' 28
    a = GG(a, b, c, d, x(13), S21, &HA9E3E905)  ' 29
    d = GG(d, a, b, c, x(2), S22, &HFCEFA3F8)   ' 30
    c = GG(c, d, a, b, x(7), S23, &H676F02D9)   ' 31
    b = GG(b, c, d, a, x(12), S24, &H8D2A4C8A)  ' 32

    ' Round 3
    a = HH(a, b, c, d, x(5), S31, &HFFFA3942)   ' 33
    d = HH(d, a, b, c, x(8), S32, &H8771F681)   ' 34
    c = HH(c, d, a, b, x(11), S33, &H6D9D6122)  ' 35
    b = HH(b, c, d, a, x(14), S34, &HFDE5380C)  ' 36
    a = HH(a, b, c, d, x(1), S31, &HA4BEEA44)   ' 37
    d = HH(d, a, b, c, x(4), S32, &H4BDECFA9)   ' 38
    c = HH(c, d, a, b, x(7), S33, &HF6BB4B60)   ' 39
    b = HH(b, c, d, a, x(10), S34, &HBEBFBC70)  ' 40
    a = HH(a, b, c, d, x(13), S31, &H289B7EC6)  ' 41
    d = HH(d, a, b, c, x(0), S32, &HEAA127FA)   ' 42
    c = HH(c, d, a, b, x(3), S33, &HD4EF3085)   ' 43
    b = HH(b, c, d, a, x(6), S34, &H4881D05)    ' 44
    a = HH(a, b, c, d, x(9), S31, &HD9D4D039)   ' 45
    d = HH(d, a, b, c, x(12), S32, &HE6DB99E5)  ' 46
    c = HH(c, d, a, b, x(15), S33, &H1FA27CF8)  ' 47
    b = HH(b, c, d, a, x(2), S34, &HC4AC5665)   ' 48

    ' Round 4
    a = II(a, b, c, d, x(0), S41, &HF4292244)   ' 49
    d = II(d, a, b, c, x(7), S42, &H432AFF97)   ' 50
    c = II(c, d, a, b, x(14), S43, &HAB9423A7)  ' 51
    b = II(b, c, d, a, x(5), S44, &HFC93A039)   ' 52
    a = II(a, b, c, d, x(12), S41, &H655B59C3)  ' 53
    d = II(d, a, b, c, x(3), S42, &H8F0CCC92)   ' 54
    c = II(c, d, a, b, x(10), S43, &HFFEFF47D)  ' 55
    b = II(b, c, d, a, x(1), S44, &H85845DD1)   ' 56
    a = II(a, b, c, d, x(8), S41, &H6FA87E4F)   ' 57
    d = II(d, a, b, c, x(15), S42, &HFE2CE6E0)  ' 58
    c = II(c, d, a, b, x(6), S43, &HA3014314)   ' 59
    b = II(b, c, d, a, x(13), S44, &H4E0811A1)  ' 60
    a = II(a, b, c, d, x(4), S41, &HF7537E82)   ' 61
    d = II(d, a, b, c, x(11), S42, &HBD3AF235)  ' 62
    c = II(c, d, a, b, x(2), S43, &H2AD7D2BB)   ' 63
    b = II(b, c, d, a, x(9), S44, &HEB86D391)   ' 64

    state(0) = uwAdd(state(0), a)
    state(1) = uwAdd(state(1), b)
    state(2) = uwAdd(state(2), c)
    state(3) = uwAdd(state(3), d)

End Sub

' FF, GG, HH, and II transformations for rounds 1, 2, 3, and 4

Private Function AddRotAdd(f As Long, a As Long, b As Long, x As Long, s As Integer, ac As Long) As Long
' Common routine for FF, GG, HH and II
' #define AddRotAdd(f, a, b, c, d, x, s, ac) { \
'  (a) += f + (x) + (UINT4)(ac); \
'  (a) = ROTATE_LEFT ((a), (s)); \
'  (a) += (b); \
'  }
    Dim temp As Long
    temp = uwAdd(a, f)
    temp = uwAdd(temp, x)
    temp = uwAdd(temp, ac)
    temp = uwRol(temp, s)
    AddRotAdd = uwAdd(temp, b)
End Function

Private Function FF(a As Long, b As Long, c As Long, d As Long, x As Long, s As Integer, ac As Long) As Long
' Returns new value of a
' #define F(x, y, z) (((x) & (y)) | ((~x) & (z)))
' #define FF(a, b, c, d, x, s, ac) { \
'  (a) += F ((b), (c), (d)) + (x) + (UINT4)(ac); \
'  (a) = ROTATE_LEFT ((a), (s)); \
'  (a) += (b); \
'  }
    Dim t As Long
    Dim t2 As Long
    ' F ((b), (c), (d)) = (((b) & (c)) | ((~b) & (d)))
    t = b And c
    t2 = (Not b) And d
    t = t Or t2
    FF = AddRotAdd(t, a, b, x, s, ac)
End Function

Private Function GG(a As Long, b As Long, c As Long, d As Long, x As Long, s As Integer, ac As Long) As Long
' #define G(b, c, d) (((b) & (d)) | ((c) & (~d)))
    Dim t As Long
    Dim t2 As Long
    t = b And d
    t2 = c And (Not d)
    t = t Or t2
    GG = AddRotAdd(t, a, b, x, s, ac)
End Function

Private Function HH(a As Long, b As Long, c As Long, d As Long, x As Long, s As Integer, ac As Long) As Long
' #define H(b, c, d) ((b) ^ (c) ^ (d))
    Dim t As Long
    t = b Xor c Xor d
    HH = AddRotAdd(t, a, b, x, s, ac)
End Function

Private Function II(a As Long, b As Long, c As Long, d As Long, x As Long, s As Integer, ac As Long) As Long
' #define I(b, c, d) ((c) ^ ((b) | (~d)))
    Dim t As Long
    t = b Or (Not d)
    t = c Xor t
    II = AddRotAdd(t, a, b, x, s, ac)
End Function

' Unsigned 32-bit word functions suitable for VB/VBA

Private Function uwRol(w As Long, s As Integer) As Long
' Return 32-bit word w rotated left by s bits
' avoiding problem with VB sign bit
    Dim i As Integer
    Dim t As Long

    uwRol = w
    For i = 1 To s
        t = uwRol And &H3FFFFFFF
        t = t * 2
        If (uwRol And &H40000000) <> 0 Then
            t = t Or &H80000000
        End If
        If (uwRol And &H80000000) <> 0 Then
            t = t Or &H1
        End If
        uwRol = t
    Next
End Function

Private Function uwJoin(a As Byte, b As Byte, c As Byte, d As Byte) As Long
' Join 4 x 8-bit bytes into one 32-bit word a.b.c.d
    uwJoin = ((a And &H7F) * &H1000000) Or (b * &H10000) Or (CLng(c) * &H100) Or d
    If a And &H80 Then
        uwJoin = uwJoin Or &H80000000
    End If
End Function

Private Sub uwSplit(ByVal w As Long, a As Byte, b As Byte, c As Byte, d As Byte)
' Split 32-bit word w into 4 x 8-bit bytes
    a = CByte(((w And &HFF000000) \ &H1000000) And &HFF)
    b = CByte(((w And &HFF0000) \ &H10000) And &HFF)
    c = CByte(((w And &HFF00) \ &H100) And &HFF)
    d = CByte((w And &HFF) And &HFF)
End Sub

Private Function uwAdd(wordA As Long, wordB As Long) As Long
' Adds words A and B avoiding overflow
    Dim myUnsigned As Double

    myUnsigned = LongToUnsigned(wordA) + LongToUnsigned(wordB)
    ' Cope with overflow
    If myUnsigned > OFFSET_4 Then
        myUnsigned = myUnsigned - OFFSET_4
    End If
    uwAdd = UnsignedToLong(myUnsigned)

End Function

'****************************************************
' These two functions from Microsoft Article Q189323
' "HOWTO: convert between Signed and Unsigned Numbers"

Private Function UnsignedToLong(value As Double) As Long
    If value < 0 Or value >= OFFSET_4 Then Error 6 ' Overflow
    If value <= MAXINT_4 Then
        UnsignedToLong = value
    Else
        UnsignedToLong = value - OFFSET_4
    End If
End Function

Private Function LongToUnsigned(value As Long) As Double
    If value < 0 Then
        LongToUnsigned = value + OFFSET_4
    Else
        LongToUnsigned = value
    End If
End Function

' End of Microsoft-article functions
'****************************************************

Attribute VB_Name = "MarkLatin"
Sub MarkAllLatinPassengers()
On Error GoTo Error:

Response = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Passenger Surname |fffd| Firstname?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
If Response = vbYes Then
   TempTime = Now()
   Application.ScreenUpdating = False
   Mark_LAT
   Application.ScreenUpdating = True
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd|! " + Format(TempTime - Now(), "(hh:mm:ss)"), vbInformation
End If

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub MarkAllLatinPassengers " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Private Sub Mark_LAT()
Dim c As Range, i As Long, i1 As Long
Dim TableSheets As String
Dim IsMark As Boolean
On Error GoTo Error:
TableSheets = FindTableSheets
If TableSheets <> "" Then
   i = 2
   While Sheets(TableSheets).Cells(i, 1).Text <> Empty
      Sheets(TableSheets).Range("E" + Trim(Str(i)) + ":F" + Trim(Str(i))).Select
      For Each c In Selection
         IsMark = False
         For i1 = 1 To Len(c)
            If Mid$(c, i1, 1) Like "[A-Za-z]" Then
               c.Characters(Start:=i1, Length:=1).Font.ColorIndex = 6
               IsMark = True
            Else
               c.Characters(Start:=i1, Length:=1).Font.ColorIndex = -4105
            End If
         Next i1
         If IsMark Then
            c.Interior.Color = 176
         Else
            c.Interior.Pattern = xlNone
         End If
      Next c
      i = i + 1
   Wend
   Sheets(TableSheets).Range("A1").Select
End If

   Exit Sub
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Sub Mark_LAT " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Sub



Attribute VB_Name = "SumText"
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 0 |fffd||fffd| 999999999999
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Dim |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| As Boolean
Dim |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| As Boolean
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Dim |fffd||fffd||fffd||fffd||fffd|(32) As String
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Const |fffd||fffd||fffd||fffd||fffd||fffd| As Boolean = True
Const |fffd||fffd||fffd||fffd| As Boolean = False
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'
Function |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = (|fffd||fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd||fffd|)) * 100
If (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)) >= 0.5 Then
    If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| >= 99.5 Then
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = 0
        |fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd| + 1
    Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|) + 1
    End If
Else
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
End If
|fffd||fffd||fffd||fffd||fffd||fffd||fffd| = CStr(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = CStr(Fix(|fffd||fffd||fffd||fffd||fffd|))
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = UCase(Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 1, 1)) + _
                       Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = Len(|fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
If |fffd||fffd||fffd||fffd||fffd| = 1 Then
    |fffd||fffd||fffd||fffd||fffd| = "0" & |fffd||fffd||fffd||fffd||fffd|
    |fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd| + 1
End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 10, 11, 12, 13,
' 14, 15, 16, 17, 18, 19 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
If Mid(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd| - 1, 1) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
    Select Case Mid(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd|"
    Case 1
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 2, 3, 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd|"
    Case 2, 3, 4
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 5, 6, 7, 8,
' 9, 0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If Len(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd| = "0" + |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
End If
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + " " + |fffd||fffd||fffd||fffd||fffd||fffd||fffd| + " "
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 10, 11, 12, 13,
' 14, 15, 16, 17, 18, 19 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
If Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 1, 1) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
    Select Case Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 1
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 2, 3, 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 2, 3, 4
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 5, 6, 7, 8,
' 9, 0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End If
End Function
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd|
'
Function |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = (|fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd|)) * 100
If (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)) >= 0.5 Then
    If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| >= 99.5 Then
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = 0
        |fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd| + 1
    Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|) + 1
    End If
Else
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
End If
|fffd||fffd||fffd||fffd||fffd| = CStr(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = CStr(Fix(|fffd||fffd||fffd||fffd|))
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = UCase(Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 1, 1)) + _
                       Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
If Len(|fffd||fffd||fffd||fffd||fffd|) = 1 Then
    |fffd||fffd||fffd||fffd||fffd| = "0" + |fffd||fffd||fffd||fffd||fffd|
End If
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + " " + |fffd||fffd||fffd||fffd||fffd| + " "
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 10, 11, 12, 13,
' 14, 15, 16, 17, 18, 19 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
If Mid(|fffd||fffd||fffd||fffd||fffd|, 1, 1) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
    Select Case Mid(|fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd|"
    Case 1
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 2, 3, 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd|"
    Case 2, 3, 4
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 5, 6, 7, 8,
' 9, 0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End If
End Function
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'
Function |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = (|fffd||fffd||fffd||fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|)) * 100
If (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)) >= 0.5 Then
    If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| >= 99.5 Then
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = 0
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd| + 1
    Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|) + 1
    End If
Else
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
End If
|fffd||fffd||fffd||fffd||fffd| = CStr(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = CStr(Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|))
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = UCase(Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 1, 1)) + _
                       Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = Len(|fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
If |fffd||fffd||fffd||fffd||fffd| = 1 Then
    |fffd||fffd||fffd||fffd||fffd| = "0" & |fffd||fffd||fffd||fffd||fffd|
    |fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd| + 1
End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 10, 11, 12, 13,
' 14, 15, 16, 17, 18, 19 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
If Mid(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd| - 1, 1) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
    Select Case Mid(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 1
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 2, 3, 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 2, 3, 4
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 5, 6, 7, 8,
' 9, 0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    Case Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
If Len(|fffd||fffd||fffd||fffd||fffd|) = 1 Then
    |fffd||fffd||fffd||fffd||fffd| = "0" + |fffd||fffd||fffd||fffd||fffd|
End If
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + " " + |fffd||fffd||fffd||fffd||fffd| + " "
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 10, 11, 12, 13,
' 14, 15, 16, 17, 18, 19 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
If Mid(|fffd||fffd||fffd||fffd||fffd|, 1, 1) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
    Select Case Mid(|fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd|"
    Case 1
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 2, 3, 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd|"
    Case 2, 3, 4
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 5, 6, 7, 8,
' 9, 0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End If
End Function
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'
Function |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = (|fffd||fffd||fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd||fffd||fffd|)) * 100
If (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)) >= 0.5 Then
    If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| >= 99.5 Then
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = 0
        |fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd| + 1
    Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|) + 1
    End If
Else
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
End If
|fffd||fffd||fffd||fffd||fffd||fffd||fffd| = CStr(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = CStr(Fix(|fffd||fffd||fffd||fffd||fffd||fffd|))
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = UCase(Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 1, 1)) + _
                       Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = Len(|fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
If |fffd||fffd||fffd||fffd||fffd| = 1 Then
    |fffd||fffd||fffd||fffd||fffd| = "0" & |fffd||fffd||fffd||fffd||fffd|
    |fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd| + 1
End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 10, 11, 12, 13,
' 14, 15, 16, 17, 18, 19 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
If Mid(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd| - 1, 1) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
    Select Case Mid(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 1
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 2, 3, 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 2, 3, 4
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 5, 6, 7, 8,
' 9, 0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If Len(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd| = "0" + |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
End If
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + " " + |fffd||fffd||fffd||fffd||fffd||fffd||fffd| + " "
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 10, 11, 12, 13,
' 14, 15, 16, 17, 18, 19 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
If Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 1, 1) = 1 Then
    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
    Select Case Mid(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|, 2)
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 1
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 2, 3, 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case 2, 3, 4
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| 5, 6, 7, 8,
' 9, 0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Case Else
        |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + "|fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End If
End Function
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'
Function |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|, Optional |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd|(1) = "|fffd||fffd||fffd|":       |fffd||fffd||fffd||fffd||fffd|(2) = "|fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(3) = "|fffd||fffd||fffd|":       |fffd||fffd||fffd||fffd||fffd|(4) = "|fffd||fffd||fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(5) = "|fffd||fffd||fffd|":       |fffd||fffd||fffd||fffd||fffd|(6) = "|fffd||fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(7) = "|fffd||fffd||fffd|":       |fffd||fffd||fffd||fffd||fffd|(8) = "|fffd||fffd||fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(9) = "|fffd||fffd||fffd||fffd||fffd|":     |fffd||fffd||fffd||fffd||fffd|(10) = "|fffd|"
|fffd||fffd||fffd||fffd||fffd|(11) = "|fffd|":        |fffd||fffd||fffd||fffd||fffd|(12) = "|fffd|"
|fffd||fffd||fffd||fffd||fffd|(13) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|":  |fffd||fffd||fffd||fffd||fffd|(14) = "|fffd||fffd||fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(15) = "|fffd||fffd||fffd||fffd||fffd|":    |fffd||fffd||fffd||fffd||fffd|(16) = "|fffd||fffd||fffd||fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(17) = "|fffd||fffd||fffd|":      |fffd||fffd||fffd||fffd||fffd|(18) = "|fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(19) = "|fffd||fffd||fffd|":      |fffd||fffd||fffd||fffd||fffd|(20) = "|fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(21) = "|fffd||fffd||fffd||fffd|":     |fffd||fffd||fffd||fffd||fffd|(22) = "|fffd||fffd||fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(23) = "|fffd|":        |fffd||fffd||fffd||fffd||fffd|(24) = "|fffd|"
|fffd||fffd||fffd||fffd||fffd|(25) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|":  |fffd||fffd||fffd||fffd||fffd|(26) = "|fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(27) = " ":        |fffd||fffd||fffd||fffd||fffd|(28) = "":
|fffd||fffd||fffd||fffd||fffd|(29) = "|fffd||fffd||fffd||fffd||fffd|":    |fffd||fffd||fffd||fffd||fffd|(30) = "|fffd||fffd||fffd|"
|fffd||fffd||fffd||fffd||fffd|(31) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|": |fffd||fffd||fffd||fffd||fffd|(32) = "|fffd||fffd||fffd||fffd| "
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|:      |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|:   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = Fix(|fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
|fffd||fffd||fffd||fffd||fffd| = Len(|fffd||fffd||fffd||fffd||fffd|)
' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
For |fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd| To 1 Step -1
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + _
                   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(Mid(|fffd||fffd||fffd||fffd||fffd|, _
                   |fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd| + 1, 1), _
                   |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
Next |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|
If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = "" Then
   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(32)
End If
End Function
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'
Private Function |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd|) As String
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If (|fffd||fffd||fffd||fffd||fffd| <> 0) And ((|fffd||fffd||fffd||fffd||fffd| = 11) Or _
    (|fffd||fffd||fffd||fffd||fffd| = 12)) Then
   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|
End If
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If (|fffd||fffd||fffd||fffd||fffd| <> 0) And ((|fffd||fffd||fffd||fffd||fffd| = 8) Or _
    (|fffd||fffd||fffd||fffd||fffd| = 9)) Then
   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|
End If
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If (|fffd||fffd||fffd||fffd||fffd| <> 0) And ((|fffd||fffd||fffd||fffd||fffd| = 5) Or _
    (|fffd||fffd||fffd||fffd||fffd| = 6)) Then
   |fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|
End If
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Then
   Select Case |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd| "
   Case 0
     |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(29) + |fffd||fffd||fffd||fffd||fffd|(12) + _
                    |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
   Case 1
     |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(1) + |fffd||fffd||fffd||fffd||fffd|(10) + _
                    |fffd||fffd||fffd||fffd||fffd|(13) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
   Case 2
     |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(18) + |fffd||fffd||fffd||fffd||fffd|(13) + _
                    |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
   Case Else
     |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) + |fffd||fffd||fffd||fffd||fffd|(13) + _
                    |fffd||fffd||fffd||fffd||fffd|(27)
   End Select
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
   Select Case |fffd||fffd||fffd||fffd||fffd|
   Case 4
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd| "
     |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(22) + _
                    |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
   Case 7
     |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(25) + _
                    |fffd||fffd||fffd||fffd||fffd|(26) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
   Case 10
     |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(31) + _
                    |fffd||fffd||fffd||fffd||fffd|(26) + |fffd||fffd||fffd||fffd||fffd|(27)
   End Select
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|:    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
  |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|:        |fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
' |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd| |fffd||fffd||fffd||fffd|
' |fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Else
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
   If (|fffd||fffd||fffd||fffd||fffd| = 2) Or (|fffd||fffd||fffd||fffd||fffd| = 5) Or _
        (|fffd||fffd||fffd||fffd||fffd| = 8) Or (|fffd||fffd||fffd||fffd||fffd| = 11) Then
     Select Case |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
     Case 1
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" |fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
     Case 2, 3
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) + |fffd||fffd||fffd||fffd||fffd|(14) + _
                      |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd| "
     Case 4
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(15) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
     Case 9
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(16) + |fffd||fffd||fffd||fffd||fffd|(17) + _
                      |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd| "
     Case 5, 6, 7, 8
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) + |fffd||fffd||fffd||fffd||fffd|(12) + _
                      |fffd||fffd||fffd||fffd||fffd|(29) + |fffd||fffd||fffd||fffd||fffd|(27)
     End Select
   End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
   If (|fffd||fffd||fffd||fffd||fffd| = 3) Or (|fffd||fffd||fffd||fffd||fffd| = 6) Or _
        (|fffd||fffd||fffd||fffd||fffd| = 9) Or (|fffd||fffd||fffd||fffd||fffd| = 12) Then
     Select Case |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd| "
     Case 1
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(17) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd| "
     Case 2
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(18) + |fffd||fffd||fffd||fffd||fffd|(19) + _
                      |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd| "
     Case 3
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(3) + |fffd||fffd||fffd||fffd||fffd|(30) + _
                      |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
     Case 4
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(4) + |fffd||fffd||fffd||fffd||fffd|(11) + _
                      |fffd||fffd||fffd||fffd||fffd|(30) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd| "|fffd||fffd||fffd| "
     Case 5, 6, 7, 8, 9
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) + |fffd||fffd||fffd||fffd||fffd|(12) + _
                      |fffd||fffd||fffd||fffd||fffd|(20) + |fffd||fffd||fffd||fffd||fffd|(27)
     End Select
   End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   If (|fffd||fffd||fffd||fffd||fffd| = 1) Or (|fffd||fffd||fffd||fffd||fffd| = 4) Or _
        (|fffd||fffd||fffd||fffd||fffd| = 7) Or (|fffd||fffd||fffd||fffd||fffd| = 10) Then
     Select Case |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd| " |fffd||fffd||fffd| "|fffd||fffd||fffd||fffd| "
     Case 1
       If (|fffd||fffd||fffd|) Or _
        (|fffd||fffd||fffd||fffd||fffd| = 7) Or (|fffd||fffd||fffd||fffd||fffd| = 10) Then
          |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(1) + |fffd||fffd||fffd||fffd||fffd|(10) + _
                      |fffd||fffd||fffd||fffd||fffd|(27)
       Else
          |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(21) + |fffd||fffd||fffd||fffd||fffd|(27)
       End If
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd| " |fffd||fffd||fffd| "|fffd||fffd||fffd| "
     Case 2
       If (|fffd||fffd||fffd|) Or _
        (|fffd||fffd||fffd||fffd||fffd| = 7) Or (|fffd||fffd||fffd||fffd||fffd| = 10) Then
          |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) + |fffd||fffd||fffd||fffd||fffd|(27)
       Else
          |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(18) + |fffd||fffd||fffd||fffd||fffd|(27)
       End If
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd| "
     Case 3
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd| "
     Case 4
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(4) + |fffd||fffd||fffd||fffd||fffd|(11) + _
                      |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
     Case 5, 6, 7, 8, 9
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) + |fffd||fffd||fffd||fffd||fffd|(12) + _
                      |fffd||fffd||fffd||fffd||fffd|(27)
     End Select
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
     If |fffd||fffd||fffd||fffd||fffd| = 4 Then
       Select Case |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd| " |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       Case 0
         If |fffd||fffd||fffd||fffd||fffd||fffd| Then
           |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(22) + |fffd||fffd||fffd||fffd||fffd|(27)
         End If
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 1
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(21) + |fffd||fffd||fffd||fffd||fffd|(27) + _
                |fffd||fffd||fffd||fffd||fffd|(22) + |fffd||fffd||fffd||fffd||fffd|(23) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 2
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(18) + |fffd||fffd||fffd||fffd||fffd|(27) + _
                |fffd||fffd||fffd||fffd||fffd|(22) + |fffd||fffd||fffd||fffd||fffd|(24) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 3, 4
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(22) + _
                        |fffd||fffd||fffd||fffd||fffd|(24) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd| "
       Case 5, 6, 7, 8, 9
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(22) + _
                        |fffd||fffd||fffd||fffd||fffd|(27)
       End Select
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       |fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
     End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
     If |fffd||fffd||fffd||fffd||fffd| = 7 Then
       Select Case |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|,
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       Case 0
         If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Then
           |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(25) + |fffd||fffd||fffd||fffd||fffd|(26) + _
                          |fffd||fffd||fffd||fffd||fffd|(27)
         End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 1
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(25) + _
                        |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 2, 3, 4
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(25) + _
                        |fffd||fffd||fffd||fffd||fffd|(23) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 5, 6, 7, 8, 9
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(25) + _
                        |fffd||fffd||fffd||fffd||fffd|(26) + |fffd||fffd||fffd||fffd||fffd|(27)
       End Select
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
     End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
     If |fffd||fffd||fffd||fffd||fffd| = 10 Then
       Select Case |fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|,
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       Case 0
         If |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Then
           |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd|(31) + |fffd||fffd||fffd||fffd||fffd|(26) + _
                          |fffd||fffd||fffd||fffd||fffd|(27)
         End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 1
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(31) + _
                        |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 2, 3, 4
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(31) + _
                        |fffd||fffd||fffd||fffd||fffd|(23) + |fffd||fffd||fffd||fffd||fffd|(27)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "
       Case 5, 6, 7, 8, 9
         |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| + |fffd||fffd||fffd||fffd||fffd|(31) + _
                        |fffd||fffd||fffd||fffd||fffd|(26) + |fffd||fffd||fffd||fffd||fffd|(27)
       End Select
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
       |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| = |fffd||fffd||fffd||fffd|
     End If
   End If
End If
End Function







Attribute VB_Name = "Twinsen"
'|fffd||fffd||fffd||fffd||fffd| !BulkTables_NEWFORMAT
Public VatNDS As String

Const ConstConnectString = "Provider=SQLOLEDB;Data Source=10.200.32.10;Initial Catalog=p1minfoweekly;UID=p1minfoweekly_Manager;PWD=p1minfoweekly_Manager"

'|fffd| 1 |fffd||fffd||fffd||fffd||fffd| 2015 (04 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 2015 ERD) (23 |fffd||fffd||fffd||fffd||fffd||fffd||fffd|  2015 HIS) (EVI,VWV,HDI |fffd||fffd||fffd||fffd||fffd||fffd| 2017) HNG
Public Const ProductTypeNoNDS = "[EDR][ERI][ERD][HIS][INS][EVI][VWV][HDI][CAI][PNS][HIC][HDG][PNS][HRL][HNG][CAD][VIS]"

Function WorksheetIsExist(iName$) As Boolean
    Dim iList As Worksheet
    For Each iList In Worksheets
        If iList.Name = iName$ Then
           WorksheetIsExist = True
           Exit Function
        End If
    Next
    WorksheetIsExist = False
End Function

'**********************************************************************************************************************
'|fffd||fffd| 08.04.2014 Kurakina, Sofiya CWT-RU
''Air
'"[AAD][AWB][DAD][EDI][EDN][EDR][ERD][GDP][LCD][PDI][PDN][PMD][PSI][SUD][VAD][DAI][EIE][EII][EIN][EIR][EOR][ERI][GIP][LCC][NAD][PAT][PII][PIN][PMI][SUI][VAI][CVV][CHR]"
''Rail
'"[AER][AEX][DRD][DRI][RAD][RDD][RFD][RFI][RAE][RAI][RPD][RPI][RWB][RWW][CWE]"
''Hotel
'"[CDC][CIC][GHD][GHU][HDB][HDC][HDG][HDI][HDS][HIC][HIS][HNG][PNS][RCD][RCI][RHD][RHI][RRB][HRL][VWV][VWS][HRN]"
''Fee
'"[CCI][CEE][CEI][CEO][CRC][CRR][CRT][CRW][CWC][CWI][CWO][CWR][CWT][CWV]"
''Other
'"[EVD][EVI][GOI][KON][GTA][GTH][INS][CCC][DOW][FRI][GOD][MRK][PCM][TSD][TSI][VCW][VIP][CAD][CAI][CRB][CRD][CRI][RTD][RTI][TRF][VDS][VIN][VIS][GMD][GMI]"
'"+MOM [APF][ARD][ARO][ATB][DPZ][ENT][EXC][FOT][HCP][KOD][ORG][ORV][REG][RG2][SOP]
Function ProductType(InCodProductType As String) As String
On Error GoTo Error:
ProductType = ""
If InCodProductType <> "" Then
'Air
   ProductTypeList = "[ADM][AAD][AWB][DAD][EDI][EDN][EDR][ERD][GDP][LCD][PDI][PDN][PMD][PSI][SUD][VAD][DAI][EIE][EII][EIN][EIR][EOR][ERI][GIP][LCC][NAD][PAT][PII][PIN][PMI][SUI][VAI][CVV][ECR][CWV][CHR]"
      If InStr(1, ProductTypeList, "[" + InCodProductType + "]", vbTextCompare) Then ProductType = "Air"
'Rail
   ProductTypeList = "[AER][AEX][DRD][DRI][RAD][RDD][RFD][RFI][RAE][RAI][RPD][RPI][RWB][RWW][CWE]"
      If InStr(1, ProductTypeList, "[" + InCodProductType + "]", vbTextCompare) Then ProductType = "Rail"
'Hotel
   ProductTypeList = "[CDC][CIC][GHD][GHU][HDB][HDC][HDG][HDI][HDS][HIC][HIS][HNG][PNS][RCD][RCI][RHD][RHI][RRB][HRL][HRN]"
      If InStr(1, ProductTypeList, "[" + InCodProductType + "]", vbTextCompare) Then ProductType = "Hotel"
'VISA
   ProductTypeList = "[VWV][VWS]"
      If InStr(1, ProductTypeList, "[" + InCodProductType + "]", vbTextCompare) Then ProductType = "VISA"
'Fee
   ProductTypeList = "[CCI][CEE][CEI][CEO][CRC][CRR][CRT][CRW][CWC][CWI][CWO][CWR][CWT]"
      If InStr(1, ProductTypeList, "[" + InCodProductType + "]", vbTextCompare) Then ProductType = "Fee"
'Other
  ProductTypeList = "[EVD][EVI][GOI][KON][GTA][GTH][INS][CCC][DOW][FRI][GOD][MRK][PCM][TSD][TSI][VCW][VIP][CAD][CAI][CRB][CRD][CRI][RTD][RTI][TRF][VDS][VIN][VIS][GMD][GMI][APF][ARD][ARO][ATB][DPZ][ENT][EXC][FOT][HCP][KOD][ORG][ORV][REG][RG2][SOP][OFZ][SOS][ARJ][VDA][BUI][CAT][COP][DOC][INT][PAP][PRK][PTR][RG1][TET][TRS][LUG]"
      If InStr(1, ProductTypeList, "[" + InCodProductType + "]", vbTextCompare) Then ProductType = "Other"
End If

   If ProductType = "" Then
      MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function ProductType [" + InCodProductType + "] " + Str(Err.Number) + " " + Err.Description, vbCritical
   End If
   Exit Function
   
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function ProductType " + Str(Err.Number) + " " + Err.Description, vbCritical
   
   Err.Clear
End Function
'**********************************************************************************************************************
''OK |fffd||fffd||fffd| string'|fffd|
Function NullSTR(ByVal InTempStr) As String
On Error GoTo Error:

If IsNull(InTempStr) Then
NullSTR = ""
Else
NullSTR = Trim(InTempStr)
End If

    Exit Function
Error:

    MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function NullSTR " + Str(Err.Number) + " " + Err.Description, vbCritical
    Err.Clear
End Function
'**********************************************************************************************************************
Function GetK_Nummer(InString As String) As String

If InString <> "" And Right(InString, 14) = "Booking Number" Then
   InString = Trim(Mid(InString, 1, Len(InString) - 14))
   GetK_Nummer = InString
Else
   GetK_Nummer = "XXXXXX"
End If

End Function
'**********************************************************************************************************************

Function Get_NameProject(InReferences As String) As String
Get_NameProject = ""
Dim TableSheets As String
TableSheets = FindTableSheets
i = 1
While Sheets(TableSheets).Cells(1, i).Text <> Empty
   If Sheets(TableSheets).Cells(1, i).Text = InReferences Then
      'If Len(Sheets(TableSheets).Cells(2, i).Text) > 0 Then Get_NameProject = "Project: " + Sheets(TableSheets).Cells(2, i).Text
      'c 21.01.2016 Twinsen
      If Len(Sheets(TableSheets).Cells(2, i).Text) > 0 Then Get_NameProject = InReferences + ": " + Sheets(TableSheets).Cells(2, i).Text
      Exit Function
   End If
   i = i + 1
Wend
End Function

Function Get_Info(InName As String, InK_Nummer_Info As String) As String
If InStr(1, InK_Nummer_Info, InName, vbTextCompare) > 0 Then
   iBegin = InStr(1, InK_Nummer_Info, "|" + InName, vbTextCompare) + Len(InName) + 2
   iEnd = InStr(iBegin, InK_Nummer_Info, "]", vbTextCompare)
   Get_Info = Mid(InK_Nummer_Info, iBegin, iEnd - iBegin)
Else
   Get_Info = "ERROR_" + InName
End If
End Function

Function Get_K_Nummer_Info(InK_Nummer As String) As String
If Not IsNull(InK_Nummer) And InK_Nummer <> "" Then
'***SQL SERVER***
   Set objConn = CreateObject("ADODB.Connection")
   Set objRecordset = CreateObject("ADODB.Recordset")
   ConnectString = ConstConnectString
   objConn.ConnectionString = ConnectString
   objConn.ConnectionTimeOut = 10
   objConn.CommandTimeout = 0
   objConn.Open
   objRecordset.Open "Select [CUST_NO],[VAT_ID],[name_ru],[COUNTRY],[POSTCODE],[CITY],[STREET],[References],[PaymentDeadline],[Contract_Date],[Signature] " & _
                     "FROM dbo.[Clients_RU] " & _
                     "WHERE [CUST_NO]='" + InK_Nummer + "'", objConn
   If Not objRecordset.EOF Then
      For i = 0 To 10
      Get_K_Nummer_Info = Get_K_Nummer_Info + "|" + Trim(objRecordset.Fields.Item(i).Name) + "[" + Trim(NullSTR(objRecordset.Fields.Item(i).value)) + "]"
      Next i
      
   Else
      Get_K_Nummer_Info = ""
   End If
   objRecordset.Close
   objConn.Close
   Set objConn = Nothing
   Set objRecordset = Nothing
End If
End Function

Function AllCityNameRus(InVOR_NRSL As String) As String
If Not IsNull(InVOR_NRSL) And InVOR_NRSL <> "" Then
'***SQL SERVER***
   Set objConn = CreateObject("ADODB.Connection")
   Set objRecordset = CreateObject("ADODB.Recordset")
   ConnectString = ConstConnectString
   objConn.ConnectionString = ConnectString
   objConn.ConnectionTimeOut = 10
   objConn.CommandTimeout = 0
   objConn.Open
   objRecordset.Open "SELECT [dbo].[GetAllCityNameRus] ([dbo].[GetAllIATASegments]('" + InVOR_NRSL + "'))", objConn
   If Not objRecordset.EOF Then
      AllCityNameRus = Trim(objRecordset.Fields.Item(0).value)
   Else
      AllCityNameRus = ""
   End If
   objRecordset.Close
   objConn.Close
   Set objConn = Nothing
   Set objRecordset = Nothing
End If
End Function

'|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Function FindTableSheets() As String
On Error GoTo Error:
   Dim i As Integer
   FindTableSheets = ""
   For i = 1 To ThisWorkbook.Worksheets.Count
      If InStr(1, ThisWorkbook.Worksheets(i).Name, "Tables", vbTextCompare) > 0 Then
         If Sheets(ThisWorkbook.Worksheets(i).Name).Cells(1, 11).Text = "Air Code" Then Sheets(ThisWorkbook.Worksheets(i).Name).Columns("K:K").Delete Shift:=xlToLeft
         If (Sheets(ThisWorkbook.Worksheets(i).Name).Cells(1, 2).Text = "Booking Number + Seq + Serv") And (Sheets(ThisWorkbook.Worksheets(i).Name).Cells(1, 9).Text = "Product code") And (Sheets(ThisWorkbook.Worksheets(i).Name).Cells(1, 11).Text = "Ticket number") And (Sheets(ThisWorkbook.Worksheets(i).Name).Cells(1, 21).Text = "Amount of service (NO VAT)") And (Sheets(ThisWorkbook.Worksheets(i).Name).Cells(1, 36).Text = "Total service") And (Sheets(ThisWorkbook.Worksheets(i).Name).Cells(1, 37).Text = "Total VAT") Then
            FindTableSheets = ThisWorkbook.Worksheets(i).Name
            If Mid(FindTableSheets, 1, 11) = "Tables 2018" Then VatNDS = "18%" Else VatNDS = "20%"
         Else
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindTableSheets |fffd||fffd||fffd||fffd| [" + ThisWorkbook.Worksheets(i).Name + "] |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|", vbCritical
         End If
      End If
   Next i
   If FindTableSheets = "" Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindTableSheets |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| [Tables *]", vbCritical
Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindTableSheets " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

Function Get_Stroka1Ref(TableSheets As String, InI_Row As Double) As String
On Error GoTo Error:
Get_Stroka1Ref = ";"
If Sheets(TableSheets).Cells(1, 47) <> "0601*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 47))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 47)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 47)) + ";"
If Sheets(TableSheets).Cells(1, 48) <> "0602*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 48))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 48)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 48)) + ";"
If Sheets(TableSheets).Cells(1, 49) <> "0603*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 49))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 49)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 49)) + ";"
If Sheets(TableSheets).Cells(1, 50) <> "0604*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 50))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 50)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 50)) + ";"
If Sheets(TableSheets).Cells(1, 51) <> "0605*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 51))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 51)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 51)) + ";"
If Sheets(TableSheets).Cells(1, 52) <> "0606*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 52))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 52)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 52)) + ";"
If Sheets(TableSheets).Cells(1, 53) <> "0607*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 53))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 53)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 53)) + ";"
If Sheets(TableSheets).Cells(1, 54) <> "0608*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 54))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 54)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 54)) + ";"
If Sheets(TableSheets).Cells(1, 55) <> "0609*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 55))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 55)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 55)) + ";"
If Sheets(TableSheets).Cells(1, 56) <> "0610*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 56))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 56)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 56)) + ";"
If Sheets(TableSheets).Cells(1, 57) <> "0611*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 57))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 57)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 57)) + ";"
If Sheets(TableSheets).Cells(1, 58) <> "0612*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 58))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 58)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 58)) + ";"
If Sheets(TableSheets).Cells(1, 59) <> "0613*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 59))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 59)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 59)) + ";"
If Sheets(TableSheets).Cells(1, 60) <> "0614*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 60))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 60)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 60)) + ";"
If Sheets(TableSheets).Cells(1, 61) <> "0615*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 61))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 61)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 61)) + ";"
If Sheets(TableSheets).Cells(1, 62) <> "0616*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 62))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 62)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 62)) + ";"
If Sheets(TableSheets).Cells(1, 63) <> "0617*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 63))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 63)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 63)) + ";"
If Sheets(TableSheets).Cells(1, 64) <> "0618*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 64))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 64)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 64)) + ";"
If Sheets(TableSheets).Cells(1, 65) <> "0619*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 65))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 65)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 65)) + ";"
If Sheets(TableSheets).Cells(1, 66) <> "0620*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 66))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 66)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 66)) + ";"
If Sheets(TableSheets).Cells(1, 67) <> "0621*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 67))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 67)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 67)) + ";"
If Sheets(TableSheets).Cells(1, 68) <> "0622*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 68))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 68)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 68)) + ";"
If Sheets(TableSheets).Cells(1, 69) <> "0623*" And Len(Trim(Sheets(TableSheets).Cells(InI_Row, 69))) > 0 Then Get_Stroka1Ref = Get_Stroka1Ref + Trim(Sheets(TableSheets).Cells(1, 69)) + ":" + Trim(Sheets(TableSheets).Cells(InI_Row, 69)) + ";"

If Get_Stroka1Ref = ";" Then
   Get_Stroka1Ref = ""
Else
   Get_Stroka1Ref = Trim(Get_Stroka1Ref)
End If
Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function Get_Stroka1Ref " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

Function Get_TicketsAndReissue(InTickets As String, InReissue As String) As String
On Error GoTo Error:
Get_TicketsAndReissue = ""
If Len(InTickets) > 0 And Len(InReissue) > 0 Then
   Get_TicketsAndReissue = InTickets + "/" + InReissue
Else
   If Len(InTickets) > 0 Then Get_TicketsAndReissue = InTickets
End If
Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function Get_TicketsAndReissue " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

'SumAmountNoVAT
'SumAmountVAT
Function FindVAT(SumAmountNoVAT As Double, SumAmountVAT As Double, InRate As Double) As Variant
On Error GoTo Error:
If InRate = 0.18 Or InRate = 0.1 Then
   If InRate = 0.18 Then
      VAT01 = 0.18
      VAT02 = 0.1
   Else
      VAT01 = 0.1
      VAT02 = 0.18
   End If
   FindVAT = (SumAmountVAT - (SumAmountNoVAT * VAT02)) / (VAT01 - VAT02)
   FindVAT = Round(FindVAT, 2)
Else
   FindVAT = "InRate not in (0.1 or 0.18)!"
End If
Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function FindVAT " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

Function Get_Stroka1(TableSheets As String, InI_Row As Double) As String
On Error GoTo Error:

Select Case ProductType(Sheets(TableSheets).Cells(InI_Row, 8).Text)
   'Air
      Case "Air"
                      Get_Stroka1 = Sheets(TableSheets).Cells(InI_Row, 2).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(InI_Row, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(InI_Row, 6).Text) + "; " + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(InI_Row, 11).Text), NullSTR(Sheets(TableSheets).Cells(InI_Row, 12).Text)) + "; " + _
                                    Sheets(TableSheets).Cells(InI_Row, 70).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 17).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 18).Text
   'Hotel
      Case "Hotel"
                      Get_Stroka1 = Sheets(TableSheets).Cells(InI_Row, 2).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(InI_Row, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(InI_Row, 6).Text) + "; " + "C " + _
                                    Sheets(TableSheets).Cells(InI_Row, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(InI_Row, 18).Text + "; |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " + _
                                    Sheets(TableSheets).Cells(InI_Row, 19).Text + " " + Sheets(TableSheets).Cells(InI_Row, 20).Text + " |fffd|."
   'VISA
      Case "VISA"
                      Get_Stroka1 = Sheets(TableSheets).Cells(InI_Row, 2).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(InI_Row, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(InI_Row, 6).Text) + "; " + "C " + _
                                    Sheets(TableSheets).Cells(InI_Row, 17).Text + " |fffd||fffd| " + Sheets(TableSheets).Cells(InI_Row, 18).Text + "; " + _
                                    Sheets(TableSheets).Cells(InI_Row, 10).Text
   'Rail
      Case "Rail"
                      Get_Stroka1 = Sheets(TableSheets).Cells(InI_Row, 2).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(InI_Row, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(InI_Row, 6).Text) + ";" + Get_TicketsAndReissue(NullSTR(Sheets(TableSheets).Cells(InI_Row, 11).Text), NullSTR(Sheets(TableSheets).Cells(InI_Row, 12).Text)) + "; " + _
                                    Sheets(TableSheets).Cells(InI_Row, 45).Text + " - " + Sheets(TableSheets).Cells(InI_Row, 46).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 17).Text
   'Other
      Case "Other"
                      Get_Stroka1 = Sheets(TableSheets).Cells(InI_Row, 2).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(InI_Row, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(InI_Row, 6).Text) + ";" + _
                                    Sheets(TableSheets).Cells(InI_Row, 10).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 11).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 16).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 17).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 18).Text
   'Fee
      Case "Fee"
                      Get_Stroka1 = Sheets(TableSheets).Cells(InI_Row, 2).Text + ";" + Sheets(TableSheets).Cells(InI_Row, 9).Text + "; " + Trim(Sheets(TableSheets).Cells(InI_Row, 5).Text) + " " + Trim(Sheets(TableSheets).Cells(InI_Row, 6).Text) + ";" + _
                                    Sheets(TableSheets).Cells(i, 10).Text + "; " + Sheets(TableSheets).Cells(i, 11).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 16).Text + "; " + Sheets(TableSheets).Cells(InI_Row, 17).Text
   'Else!!!
      Case Else
                      Get_Stroka1 = ""
End Select

Exit Function
Error:
   MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd| Function Get_Stroka1 " + Str(Err.Number) + " " + Err.Description, vbCritical
   Err.Clear
End Function

'Twinsen 14.04.2017
'|fffd||fffd||fffd| |fffd||fffd||fffd||fffd| > |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|. > |fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|. > |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.
'Twinsen 30.05.2017
'OLD > NEW
'|fffd|/|fffd| 40702 810 1 00001168001 > |fffd|/|fffd| 40702 810 2 01700004440
'|fffd||fffd| "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|", |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd| |fffd|30101 810 1 00000000185, |fffd||fffd||fffd| 044525185 > |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd| |fffd|30101 810 3 00000000985, |fffd||fffd||fffd| 044525985
'Twinsen 01.06.2017
'TempAllOldBank

Sub UpdateTEXT(InSheetsName As String, InInvoiceDate As Date)

Set objConn = CreateObject("ADODB.Connection")
Set objRecordset = CreateObject("ADODB.Recordset")
ConnectString = ConstConnectString
objConn.ConnectionString = ConnectString
objConn.ConnectionTimeOut = 10
objConn.CommandTimeout = 0
objConn.Open
objRecordset.Open "SELECT [dbo].[OldBank] ()", objConn
If Not objRecordset.EOF Then
   TempAllOldBank = Trim(NullSTR(objRecordset.Fields.Item(0).value))
Else
   TempAllOldBank = ""
End If
objRecordset.Close
objConn.Close
Set objConn = Nothing
Set objRecordset = Nothing
TableSheetsName = FindTableSheets
If TableSheetsName <> "" Then T_K_Nummer = GetK_Nummer(Sheets(TableSheetsName).Cells(1, 1).Text)

'dirName
If InInvoiceDate >= "04.04.2017" Then dirName1 = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|." Else dirName1 = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|."
If InInvoiceDate >= "04.04.2017" Then dirName2 = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|." Else dirName2 = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|."
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.
If InInvoiceDate >= "01.08.2019" Then dirName1 = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|."
If InInvoiceDate >= "01.08.2019" Then dirName2 = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|."

'CompName
If InInvoiceDate >= "11.04.2017" Then CompName = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|" Else CompName = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"

'BEGIN |fffd| 17/08/2017 ***
'|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd| "129347  |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd|.2, |fffd||fffd||fffd||fffd| 2, |fffd||fffd||fffd|. 1"
'OLD
'115184, |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|., |fffd|.16, |fffd||fffd|.501-506
'115184, |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|., |fffd|.16, |fffd||fffd|.501-506
'115184 |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 16, |fffd||fffd||fffd||fffd| 501-506
'115184, |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 16, |fffd||fffd||fffd||fffd| 501-506
'NEW
'129347 |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd|.2, |fffd||fffd||fffd||fffd| 2, |fffd||fffd||fffd|. 1
If InInvoiceDate >= "17.08.2017" Then AdrString = "129347 |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd|.2, |fffd||fffd||fffd||fffd| 2, |fffd||fffd||fffd|. 1" Else AdrString = "115184, |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 16, |fffd||fffd||fffd||fffd| 501-506"
'|fffd| |fffd||fffd||fffd|
'OLD 770501001
'NEW 771601001
If InInvoiceDate >= "17.08.2017" Then KPPString = "771601001" Else KPPString = "770501001"
'END |fffd| 17/08/2017 ***

If WorksheetIsExist(InSheetsName) Then
   Sheets(InSheetsName).Activate
   Cells.Select
   
   'CompName
   Selection.Replace What:="|fffd||fffd||fffd| |fffd||fffd||fffd||fffd|", Replacement:=CompName, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|", Replacement:=CompName, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   'DirName1
   Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.", Replacement:=dirName1, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.", Replacement:=dirName1, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   'DirName2
   Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.", Replacement:=dirName2, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.", Replacement:=dirName2, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   
   '13.06.2019 "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|." = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|."
   If InInvoiceDate >= "03.06.2019" Then Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.", Replacement:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|.", LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   
   'AdrString
   Selection.Replace What:="115184, |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|., |fffd|.16, |fffd||fffd|.501-506", Replacement:=AdrString, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   Selection.Replace What:="115184, |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|., |fffd|.16, |fffd||fffd|.501-506", Replacement:=AdrString, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   Selection.Replace What:="115184 |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 16, |fffd||fffd||fffd||fffd| 501-506", Replacement:=AdrString, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   Selection.Replace What:="115184, |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 16, |fffd||fffd||fffd||fffd| 501-506", Replacement:=AdrString, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   
   'KPPString
   Selection.Replace What:="770501001", Replacement:=KPPString, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   
   'Bank
   If InStr(1, TempAllOldBank, "[" + T_K_Nummer + "]", vbTextCompare) = 0 Then
      'Bank
      If InInvoiceDate >= "29.05.2017" Then RSBank = "|fffd|/|fffd| 40702 810 2 01700004440" Else RSBank = "|fffd|/|fffd| 40702 810 1 00001168001"
      If InInvoiceDate >= "29.05.2017" Then InfoBank = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ""|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"", |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd| |fffd|30101 810 3 00000000985, |fffd||fffd||fffd| 044525985" Else InfoBank = "|fffd||fffd| ""|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"", |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd| |fffd|30101 810 1 00000000185, |fffd||fffd||fffd| 044525185"
      'Bank
      Selection.Replace What:="|fffd|/|fffd| 40702 810 2 01700004440", Replacement:=RSBank, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
      Selection.Replace What:="|fffd|/|fffd| 40702 810 1 00001168001", Replacement:=RSBank, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
      Selection.Replace What:="|fffd||fffd| ""|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"", |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd| |fffd|30101 810 1 00000000185, |fffd||fffd||fffd| 044525185", Replacement:=InfoBank, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
      Selection.Replace What:="|fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ""|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"", |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd| |fffd|30101 810 3 00000000985, |fffd||fffd||fffd| 044525985", Replacement:=InfoBank, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   End If
   
   'Twinsen 30.09.2017
   If InInvoiceDate >= "01.10.2017" Then
      Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|): -", Replacement:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)(|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|): -", LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
      Selection.Replace What:="|fffd||fffd| 25.05.2017 |fffd| 625)", Replacement:="|fffd||fffd| 19.08.2017 |fffd| 981)", LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
      Selection.Replace What:="|fffd||fffd||fffd||fffd||fffd|" + Chr(10) + "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd| |fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd|", Replacement:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd|", LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, ReplaceFormat:=False
   End If
   
   Sheets(InSheetsName).Cells(1, 1).Select
End If

End Sub

'Function AllIATA(InVOR_NRSL As String) As String
'If Not IsNull(InVOR_NRSL) And InVOR_NRSL <> "" Then
''***SQL SERVER***
'   Set objConn = CreateObject("ADODB.Connection")
'   Set objRecordset = CreateObject("ADODB.Recordset")
'   ConnectString = ConstConnectString
'   objConn.ConnectionString = ConnectString
'   objConn.ConnectionTimeOut = 10
'   objConn.CommandTimeout = 0
'   objConn.Open
'   objRecordset.Open "SELECT TOP 1 [ABFLUG1]+[ZIELFLUG1]+[ABFLUG2]+[ZIELFLUG2]+[ABFLUG3]+[ZIELFLUG3]+[ABFLUG4]+[ZIELFLUG4]+[ABFLUG5]+[ZIELFLUG5]+[ABFLUG6]+[ZIELFLUG6]+[ABFLUG7]+[ZIELFLUG7]+[ABFLUG8]+[ZIELFLUG8]+[ABFLUG9]+[ZIELFLUG9]+[ABFLUG0]+[ZIELFLUG0] " & _
'                     "FROM dbo.p1minfoweekly " & _
'                     "WHERE [VOR_NRSL]='" + InVOR_NRSL + "'", objConn
'   If Not objRecordset.EOF Then
'      InAllIATA = Trim(objRecordset.Fields.Item(0).value)
'   Else
'      InAllIATA = ""
'   End If
'   objRecordset.Close
'   objConn.Close
'   Set objConn = Nothing
'   Set objRecordset = Nothing
''***All IATA***
'   If Not IsNull(InAllIATA) And InAllIATA <> "" Then
'      AllIATA = Left(InAllIATA, 3)
'      For i = 1 To (Len(InAllIATA) / 3) - 1
'         If Right(AllIATA, 3) <> Mid(InAllIATA, (i * 3) + 1, 3) Then AllIATA = AllIATA + "-" + Mid(InAllIATA, (i * 3) + 1, 3)
'      Next i
'   Else
'      AllIATA = ""
'   End If
'Else
'   AllIATA = ""
'End If
'End Function
Attribute VB_Name = "|fffd||fffd||fffd||fffd|11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|24"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd|7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

' InQuest injected base64 decoded content
' 4om8{

INQUEST-PP=macro
