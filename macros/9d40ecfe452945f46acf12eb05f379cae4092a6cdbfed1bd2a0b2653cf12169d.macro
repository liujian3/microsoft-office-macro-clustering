Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Const MenuType = "Worksheet Menu Bar"   ' |fffd||fffd||fffd|j|fffd||fffd||fffd|[|fffd|^|fffd|C|fffd|v
Dim MainMenu As CommandBarControl       ' |fffd||fffd||fffd|C|fffd||fffd||fffd||fffd||fffd|j|fffd||fffd||fffd|[
Dim SubMenu As CommandBarControl        ' |fffd|T|fffd|u|fffd||fffd||fffd|j|fffd||fffd||fffd|[
'*************************
'   |fffd|A|fffd|h|fffd|C|fffd||fffd||fffd||1c9||fffd||fffd||fffd|
'*************************
Private Sub Workbook_Open()
    
    
    main_frm_fgt_open_flg = False
    first_frm_fgt_open_flg = False
    test_start_flg = False
    test_flg = False
    
    Dim ii As String
    ii = Application.Version
    If ii = "11.0" Then
        Col_MAX = 256
        Sheets_MAX = 256
    ElseIf ii = "12.0" Then
        Col_MAX = 16384
       Sheets_MAX = 256
    End If
    
    Set MainMenu = Application.CommandBars(MenuType).Controls.Add(msoControlPopup, , , , True)
    MainMenu.Caption = XLANAME_K
    
    ' |fffd|T|fffd|u|fffd||fffd||fffd|j|fffd||fffd||fffd|[|fffd||1c9||fffd|
    Set SubMenu = MainMenu.Controls.Add
    SubMenu.Caption = "Start"  'SubMenu.Caption = "|fffd|J|fffd|n"
    SubMenu.OnAction = "first_frm_fgt_show"
    
    ' |fffd|T|fffd|u|fffd||fffd||fffd|j|fffd||fffd||fffd|[|fffd||1c9||fffd|
    Set SubMenu = MainMenu.Controls.Add
    SubMenu.Caption = "Version"  'SubMenu.Caption = "|fffd|o|fffd|[|fffd|W|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    SubMenu.OnAction = "ver_proc_k"
    
End Sub
'*************************
'   |fffd|A|fffd|h|fffd|C|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'*************************
Private Sub Workbook_BeforeClose(Cancel As Boolean)
    
    ' |fffd||fffd||fffd|C|fffd||fffd||fffd||fffd||fffd|j|fffd||fffd||fffd|[|fffd||fffd||fffd|
    For Each MainMenu In Application.CommandBars(MenuType).Controls
        If MainMenu.Caption = XLANAME_K Then
            MainMenu.Delete
        End If
    Next MainMenu
    
End Sub
Attribute VB_Name = "api_mdl_e"
Option Explicit

Declare Function CreateFile Lib "kernel32" Alias "CreateFileA" (ByVal lpFileName As String, ByVal dwDesiredAccess As Long, ByVal dwShareMode As Long, ByVal lpSecurityAttributes As Long, ByVal dwCreationDisposition As Long, ByVal dwFlagsAndAttributes As Long, ByVal hTemplateFile As Long) As Long
                                        '|fffd|V|fffd||fffd||fffd|A|fffd||fffd||fffd|||fffd|[|fffd|g|fffd||303|I|fffd|[|fffd|v|fffd||fffd||fffd||590||fffd||fffd||312||fffd|`
Declare Function CloseHandle Lib "kernel32" (ByVal hObject As Long) As Long
                                        '|fffd|V|fffd||fffd||fffd|A|fffd||fffd||fffd|||fffd|[|fffd|g|fffd||303|N|fffd||fffd||fffd|[|fffd|Y|fffd||590||fffd||fffd||312||fffd|`
Declare Function SetCommState Lib "kernel32" (ByVal hCommDev As Long, lpDCB As DCB) As Long
                                        '|fffd|V|fffd||fffd||fffd|A|fffd||fffd||fffd|||fffd|[|fffd|g|fffd||310||752||fffd||590||fffd||fffd||312||fffd|`
Declare Function SetCommTimeouts Lib "kernel32" (ByVal hFile As Long, lpCommTimeouts As COMMTIMEOUTS) As Long
                                        '|fffd|^|fffd|C|fffd||fffd||fffd|A|fffd|E|fffd|g|fffd||310||752||fffd||590||fffd||fffd||312||fffd|`
Declare Function ReadFile Lib "kernel32" (ByVal hFile As Long, lpBuffer As Any, ByVal nNumberOfBytesToRead As Long, lpNumberOfBytesRead As Long, lpOverlapped As Long) As Long
                                        '|fffd|f|fffd|[|fffd|^|fffd||311||fffd||fffd|M|fffd||590||fffd||fffd||312||fffd|`
Declare Function WriteFile Lib "kernel32" (ByVal hFile As Long, lpBuffer As Any, ByVal nNumberOfBytesToWrite As Long, lpNumberOfBytesWritten As Long, lpOverlapped As Long) As Long
                                        '|fffd|f|fffd|[|fffd|^|fffd||30e||fffd|M|fffd||590||fffd||fffd||312||fffd|`

Type DCB                                'DCB|fffd|\|fffd||fffd||fffd||fffd|
    DCBlength As Long                   '|fffd|\|fffd||fffd||fffd||302||303|T|fffd|C|fffd|Y
    BaudRate As Long                    '|fffd|{|fffd|[|fffd||fffd||fffd|[|fffd|g|fffd|ibps|fffd|j|fffd||310||752||fffd|
    fBitFields As Long                  '|fffd|r|fffd|b|fffd|g|fffd|P|fffd||282||303|t|fffd|B|fffd|[|fffd||fffd||fffd|h|fffd||fffd|`
    wReserved As Integer                '|fffd|\|fffd||fffd|i0|fffd||fffd||fffd|Z|fffd|b|fffd|g|fffd||fffd||fffd||fffd|j
    XonLim As Integer                   '|fffd||fffd|M|fffd|o|fffd|b|fffd|t|fffd|@|fffd||fffd||fffd||303|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||fffd|o|fffd|C|fffd|g|fffd||242||202||fffd||fffd||fffd||fffd||fffd|Xon|fffd||fffd||fffd||fffd||fffd||115c2||90a9||fffd||fffd||fffd|w|fffd||fffd|
    XoffLim As Integer                  '|fffd||fffd|M|fffd|o|fffd|b|fffd|t|fffd|@|fffd||30b||c2ac2||fffd||fffd||fffd||fffd|o|fffd|C|fffd|g|fffd||242||202||fffd||fffd||fffd||fffd||fffd|Xoff|fffd||fffd||fffd||fffd||fffd||115c2||90a9||fffd||fffd||fffd|w|fffd||fffd|
    ByteSize As Byte                    '1|fffd|f|fffd|[|fffd|^|fffd||303|r|fffd|b|fffd|g|fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|
    Parity As Byte                      '|fffd|p|fffd||fffd||fffd|e|fffd|B|fffd||315||fffd||fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|
    StopBits As Byte                    '|fffd|X|fffd|g|fffd|b|fffd|v|fffd|r|fffd|b|fffd|g|fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|
    XonChar As Byte                     'Xon|fffd||fffd||fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|
    XoffChar As Byte                    'Xoff|fffd||fffd||fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|
    ErrorChar As Byte                   '|fffd|p|fffd||fffd||fffd|e|fffd|B|fffd|G|fffd||fffd||fffd|[|fffd||30f||a347||fffd||24e|g|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|
    EofChar As Byte                     '|fffd||fffd|o|fffd|C|fffd|i|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||30f||a347||fffd||303|f|fffd|[|fffd|^|fffd|I|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30e|w|fffd||fffd|
    EvtChar As Byte                     '|fffd|C|fffd|x|fffd||fffd||fffd|g|fffd||10d90||fffd||fffd||fffd||fffd||9576||fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|
End Type

Type COMMTIMEOUTS                       'COMMTIMEOUTS|fffd|\|fffd||fffd||fffd||302||312||fffd|`
    ReadIntervalTimeout As Long         '|fffd||fffd||fffd||fffd||fffd||313||1c2||74d||fffd||fffd||742||311||482||fffd||fffd||fffd||fffd||fffd|
    ReadTotalTimeoutMultiplier As Long  '|fffd||1c2||74d||fffd||fffd||742||302|P|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||30e||fffd||fffd||fffd|
    ReadTotalTimeoutConstant As Long    '|fffd||1c2||74d||fffd||fffd||742||312||8414||fffd||fffd||fffd||fffd|
    WriteTotalTimeoutMultiplier As Long '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||742||302|P|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||30e||fffd||fffd||fffd|
    WriteTotalTimeoutConstant As Long   '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||742||312||8414||fffd||fffd||fffd||fffd|
End Type
 
Declare Function FindWindow Lib "user32" _
            Alias "FindWindowA" _
                (ByVal lpClassName As String, _
                 ByVal lpWindowName As String) As Long
Public hWndMe As Long
Public Const USERFORM_CLASSNAME = "ThunderDFrame"
Public comname As Variant
'Public hComm As Long '|fffd|i|fffd|P|fffd|j|fffd|||fffd|[|fffd|g|fffd||303|n|fffd||fffd||fffd|h|fffd||fffd|
























 


Attribute VB_Name = "comm_mdl_e"
Option Explicit

'**************************
'   |fffd||fffd||fffd|W|fffd||fffd||fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd|L|fffd||8414|
'**************************
' ASCII|fffd|R|fffd|[|fffd|h
Private Const LF = &HA
Private Const CR = &HD
Private Const BS = &H8
Private Const dot = &H2E
' |fffd||fffd||fffd||311||fffd|
Private Const COM_TIMOUT = 30000  ' |fffd||290|M|fffd|^|fffd|C|fffd||fffd||fffd|A|fffd|E|fffd|g|fffd|p|fffd|p|fffd||fffd||fffd||fffd||fffd|[|fffd|^

'**************************
'   |fffd||fffd||fffd|W|fffd||fffd||fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd|L|fffd||3d0||fffd|
'**************************
Private l_cmd As String             ' |fffd||fffd||fffd|M|fffd|R|fffd|}|fffd||fffd||fffd|h
Private l_retry As String           ' |fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||fffd||fffd|g|fffd||fffd||fffd|C|fffd|J|fffd|E|fffd||fffd||fffd|g

'***************************
'|fffd|V|fffd||fffd||fffd|A|fffd||fffd|
'***************************
Public hComm As Long '|fffd|i|fffd|P|fffd|j|fffd|||fffd|[|fffd|g|fffd||303|n|fffd||fffd||fffd|h|fffd||fffd|
Private stDCB As DCB  '|fffd|i|fffd|Q|fffd|jDCB|fffd|\|fffd||fffd||fffd||302||fffd||3d0||fffd||fffd||24a||fffd||fffd||fffd|t|fffd||fffd||fffd||fffd|
Private timeOut As COMMTIMEOUTS '|fffd|i|fffd|R|fffd|jCOMMTIMEOUTS|fffd|\|fffd||fffd||fffd||302||fffd||3d0||fffd||fffd||24a||fffd||fffd||fffd|t|fffd||fffd||fffd||fffd|
Private comname As Variant
Public SZZ_receive_flg As Boolean   'SZZ|fffd||fffd|M|fffd|t|fffd||fffd||fffd|O|fffd|@|fffd||fffd|M|fffd||30f||a347||fffd|FTrue;|fffd||fffd|M|fffd||fffd||fffd||102||fffd||fffd||202||fffd||fffd||a347||fffd|FFalse

Public Function load_zero_padding(para As String, after_len As Integer)
    para = Trim(para)
    
    If Not Mid(para, 1, 1) = "-" Then
        para = "+" & para
    End If
    
    load_zero_padding = para
    
    Do While Not Len(load_zero_padding) >= after_len
        load_zero_padding = Mid(load_zero_padding, 1, 1) & "0" & Mid(load_zero_padding, 2, Len(load_zero_padding))
    Loop

End Function
Public Function else_zero_padding(para As String, after_len As Integer)
    para = Trim(para)
    else_zero_padding = para
    
    Do While Not Len(else_zero_padding) >= after_len
        else_zero_padding = "0" & Mid(else_zero_padding, 1, Len(else_zero_padding))
    Loop

End Function
Public Function send_load(load As Variant, limit_len As Integer, load_num As String) As String
    Dim bairitu(5) As Integer
    
    If fg_type_num = "02" Or fg_type_num = "03" Then
        bairitu(0) = 1000       '0.000*1000|fffd||fffd|0000(N)
        bairitu(1) = 10         '000.0*10|fffd||fffd|0000(kg)
        bairitu(2) = 10         '(g)
        bairitu(3) = 1000       '(lb)
        bairitu(4) = 100        '(Oz)
    ElseIf fg_type_num = "04" Then
        bairitu(0) = 100        '00.00*100|fffd||fffd|0000(N)
        bairitu(1) = 1          '0000*1|fffd||fffd|0000(kg)
        bairitu(2) = 1          '(g)
        bairitu(3) = 1000       '(lb)
        bairitu(4) = 100        '(Oz)
    ElseIf fg_type_num = "05" Then
        bairitu(0) = 100        '00.00*100|fffd||fffd|0000(N)
        bairitu(1) = 1000       '0.000*1000|fffd||fffd|0000(Kg)
        bairitu(2) = 1000       '(g)
        bairitu(3) = 1000       '(lb)
    ElseIf fg_type_num = "06" Then
        bairitu(0) = 100        '00.00*100|fffd||fffd|0000(N)
        bairitu(1) = 1000       '0.000*1000|fffd||fffd|0000(Kg)
        bairitu(2) = 1000       '(g)
        bairitu(3) = 100        '(lb)
    ElseIf fg_type_num = "07" Or fg_type_num = "08" Then
        bairitu(0) = 10         '000.0*10|fffd||fffd|0000(N)
        bairitu(1) = 100        '00.00*100|fffd||fffd|0000(Kg)
        bairitu(2) = 100        '(g)
        bairitu(3) = 100        '(lb)
    ElseIf fg_type_num = "09" Then
        bairitu(0) = 10         '000.0*10|fffd||fffd|0000(N)
        bairitu(1) = 100        '00.00*100|fffd||fffd|0000(Kg)
        bairitu(2) = 100        '(g)
        bairitu(3) = 10         '(lb)
    Else
        bairitu(0) = 1          '0000*1|fffd||fffd|0000(N)
        bairitu(1) = 10         '000.0*10|fffd||fffd|0000(Kg)
        bairitu(2) = 10         '(g)
        bairitu(3) = 10         '(lb)
    End If

    send_load = Val(load) * bairitu(unit_num)

    If Not InStr(send_load, ".") = 0 Or Len(send_load) > limit_len Or send_load > 9999 Then       '1000|fffd|{|fffd||fffd||fffd||fffd||fffd||302||fffd|0|fffd||209||fffd||fffd||302||182||fffd|
        range_error = range_error & " " & "|fffd|u" & load_num & "|fffd|v"
    End If
    
End Function
Public Function send_speed(load As Variant, after_len As Integer, speed_num As String) As String
    send_speed = Val(load) * 10
    
    If Not InStr(send_speed, ".") = 0 Or Len(send_speed) > after_len Then
        range_error = range_error & " " & "|fffd|u" & speed_num & "|fffd|v"
    End If

End Function
Public Function send_else(load As Variant, after_len As Integer, else_num As String) As String
    send_else = Trim(load)
    
    If Not InStr(send_else, ".") = 0 Or Len(send_else) > after_len Then
        range_error = range_error & " " & "|fffd|u" & else_num & "|fffd|v"
    End If

End Function
'**********************
'   |fffd||290|M|fffd|||fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
'**********************
Public Function comm_init_proc()
    Dim com_job As String
    
    Application.EnableCancelKey = xlDisabled
    
    comm_init_proc = False
    
    l_retry = 0                                                                                 '|fffd||fffd||fffd|g|fffd||fffd||fffd|C|fffd||5050f||fffd||fffd||fffd||fffd||fffd|
    
    Select Case com_port_num
        Case 0
            com_job = COM1
        Case 1
            com_job = COM2
        Case 2
            com_job = COM3
        Case 3
            com_job = COM4
        Case 4
            com_job = COM5
        Case 5
            com_job = COM6
        Case 6
            com_job = COM7
        Case 7
            com_job = COM8
        Case 8
            com_job = COM9
        Case 9
            com_job = COM10
        Case 10
            com_job = COM11
        Case 11
            com_job = COM12
        Case 12
            com_job = COM13
        Case 13
            com_job = COM14
        Case 14
            com_job = COM15
    End Select
 
    comname = "\\.\" & com_job                                                                  'COM10|fffd||20f||fffd||350||64ea||fffd||fffd|\\.\|fffd||fffd||fffd||202||fffd||fffd||18a|J|fffd||fffd||fffd||702||fffd||fffd||fffd|
    
    hComm = CreateFile(comname, GENERIC_READ Or GENERIC_WRITE, 0, 0, OPEN_EXISTING, 0, 0)       '|fffd|||fffd|[|fffd|g|fffd||303|I|fffd|[|fffd|v|fffd||fffd|
    
    If hComm = -1 Then                                                                          '|fffd|||fffd|[|fffd|g|fffd||303|I|fffd|[|fffd|v|fffd||fffd||fffd||fffd||fffd|s|fffd||fffd|
        dummy_handle = CloseHandle(before_hcomm)
        hComm = CreateFile(comname, GENERIC_READ Or GENERIC_WRITE, 0, 0, OPEN_EXISTING, 0, 0)   '|fffd|||fffd|[|fffd|g|fffd||303|I|fffd|[|fffd|v|fffd||fffd|
        
        If hComm = -1 Then                                                                      '|fffd|||fffd|[|fffd|g|fffd||303|I|fffd|[|fffd|v|fffd||fffd||fffd||fffd||fffd|s|fffd||fffd|
            MsgBox MES7, vbOKOnly + vbCritical, OBI_STR                                      '|fffd|x|fffd||fffd||fffd||fffd||fffd|b|fffd|Z|fffd|[|fffd|W |fffd|A|fffd|C|fffd|R|fffd||fffd||fffd||fffd|\|fffd||fffd| '"|fffd|f|fffd|o|fffd|C|fffd|X|fffd||fffd||fffd|J|fffd||fffd||fffd||fffd||102||fffd||fffd||702||fffd||fffd||fffd|BCOM|fffd|||fffd|[|fffd|g|fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
            comm_init_proc = True
            comm_error_flg = True
            CloseHandle (hComm)
            Exit Function                                                                       '|fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|
        Else
            before_hcomm = hComm
        End If
    
    Else
        before_hcomm = hComm
    End If
         
    With stDCB
        .BaudRate = 38400                                                                       '|fffd|]|fffd||fffd||fffd||fffd||fffd|x|fffd||30e|w|fffd||fffd|
        .ByteSize = 8                                                                           '|fffd|r|fffd|b|fffd|g|fffd||fffd||fffd||30e|w|fffd||fffd|
        .fBitFields = &H3001                                                                    '|fffd|o|fffd|C|fffd|i|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||303|t|fffd||fffd||fffd|O|fffd||fffd|L|fffd||fffd||fffd||242||fffd|RTS|fffd||310||fffd||fffd||fffd||fffd||752||80b7||fffd||fffd|i|fffd||fffd||fffd||fffd||20a|O|fffd||fffd|False|fffd||242||fffd||fffd||fffd|j
        .Parity = 0                                                                             '|fffd|p|fffd||fffd||fffd|e|fffd|B|fffd||310||752||fffd|i|fffd|p|fffd||fffd||fffd|e|fffd|B|fffd||202||fffd|)
        .StopBits = 0                                                                           '|fffd|X|fffd|g|fffd|b|fffd|v|fffd|r|fffd|b|fffd|g|fffd||fffd||fffd||fffd||fffd|w|fffd||fffd|(1|fffd|r|fffd|b|fffd|g)
    End With
    
    dummy_handle = SetCommState(hComm, stDCB)                                                   '|fffd|K|fffd|v|fffd||215||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                                                                                                '|fffd|^|fffd|C|fffd||fffd||fffd|A|fffd|E|fffd|g|fffd||310||752||fffd|
    With timeOut
        .ReadIntervalTimeout = 100                                                              '|fffd||fffd||fffd||fffd||fffd||313||1c2||74d||fffd||fffd||751||482||fffd||fffd||fffd||fffd||501|i500ms|fffd|j
        .ReadTotalTimeoutMultiplier = 0                                                         '|fffd||1c2||74d||fffd||fffd||742||302|P|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||30e||fffd||fffd||fffd|
        .ReadTotalTimeoutConstant = 100                                                         '|fffd||1c2||74d||fffd||fffd||742||312||8414||fffd||fffd||fffd||501|i500ms|fffd|j
        .WriteTotalTimeoutMultiplier = 0                                                        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||742||302|P|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||30e||fffd||fffd||fffd|
        .WriteTotalTimeoutConstant = 100                                                        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||742||312||8414||fffd||fffd||fffd||501|i500ms|fffd|j
    End With
    
    dummy_handle = SetCommTimeouts(hComm, timeOut)                                              '|fffd|^|fffd|C|fffd||fffd||fffd|A|fffd|E|fffd|g|fffd||310||752||fffd|
    
    Exit Function
    
End Function
'**********************
'   |fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd|M|fffd||fffd||fffd||fffd|
'**********************
Public Sub cmd_send_proc(cmd As String)
    'Dim zero As String
    'Dim tuch As String
    'Dim work As String
    'Dim torikomi As String
    'Dim per As String
    Dim wData As String                             '|fffd||fffd||fffd|M|fffd|f|fffd|[|fffd|^|fffd||315||3d0||fffd||fffd||933e||fffd|i|fffd||fffd||fffd||fffd||fffd||3d0||fffd||fffd||182||fffd||fffd||112||fffd|`|fffd|j
    Dim wLen As Long                                '|fffd||fffd||fffd|M|fffd||fffd||fffd||a0bd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||315||3d0||fffd||fffd||933e|
    Dim dLen As Long                                '|fffd||fffd||fffd|M|fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||315||3d0||fffd||fffd||933e|
    'Dim pato As Integer
    
    l_cmd = cmd                                     ' |fffd||fffd||fffd|M|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||6d1||fffd|
    range_error = ""
    
    '|fffd||fffd|090401SATO|fffd||1c9||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    l_buf_c_rx_ctn = ""
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
    If cmd = SSA Then
        cmd = cmd & test_direction_num & main_frm_fgt.ComboBox_torikomikankaku.ListIndex
    ElseIf cmd = SAA Then
        cmd = cmd & 11
    End If

    wData = Trim(cmd) & Chr(13)          ' |fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd|M

    dLen = LenB(StrConv(wData, vbFromUnicode)) '|fffd|i26|fffd|jANSI+DBCS|fffd||fffd||fffd||fffd||fffd||142||303|o|fffd|C|fffd|g|fffd||fffd||fffd||24a||fffd||fffd|Z
    dummy_handle = WriteFile(hComm, ByVal wData, dLen, wLen, 0) '|fffd|i27|fffd|j|fffd|f|fffd|[|fffd|^|fffd||311||fffd||fffd|M(|fffd|Q|fffd||516||682||303|p|fffd||fffd||fffd||fffd||fffd|[|fffd|^|fffd||fffd|Byval|fffd||fffd||fffd||82||fffd|
   
End Sub

'**************************
'   |fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd|M|fffd||fffd||fffd||fffd|m|fffd|F
'**************************
Public Function send_ok(cmd As String) As Boolean
    Dim b_ok As Boolean
    
    b_ok = True
    If l_cmd = cmd Then
        b_ok = False
    End If
    send_ok = b_ok
    
End Function
Public Function send_comp(cmd As String) As Boolean
    'Dim before_sec As Integer
    'Dim now_sec As Integer
    'before_sec = 0
    send_comp = True
    
    If send_ok(cmd) = True Then
        cmd_retry = 0
    Else
        Do
            If cmd_retry <= 1 Then                '2|fffd||fffd||702||14d||111||fffd||fffd|M
                cmd_retry = cmd_retry + 1
                comm_mdl_e.cmd_receive_proc
                If comm_mdl_e.send_ok(cmd) Then
                    Exit Do
                End If
            Else
            'MsgBox cmd & "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd|M|fffd||24e||fffd||fffd|s|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|B" & vbCr & "|fffd||691||fffd||fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B", vbOKOnly + vbExclamation, "TNT_DSP"
                MsgBox MES33, vbCritical, OBI_STR                '"|fffd|t|fffd|H|fffd|[|fffd|X|fffd|Q|fffd|[|fffd|W|fffd||fffd||fffd||fffd||fffd|o|fffd||142||fffd||fffd||702||fffd||fffd||fffd|B|fffd|t|fffd|H|fffd|[|fffd|X|fffd|Q|fffd|[|fffd|W|fffd||313|d|fffd||fffd||fffd|A|fffd|y|fffd||443|{|fffd|[|fffd||fffd||fffd|[|fffd|g|fffd||752||fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
                cmd_retry = 0
                send_comp = False
                Exit Function
            End If
        Loop

    End If
        
End Function
Public Sub cmd_receive_proc()
    Dim bb As Integer
    Dim rData As String                                                                         '|fffd||fffd|M|fffd|f|fffd|[|fffd|^|fffd||315||3d0||fffd||fffd||933e||fffd|i|fffd||fffd||fffd||fffd||fffd||3d0||fffd||fffd||182||fffd||fffd||112||fffd|`|fffd|j
    Dim rLen As Long                                                                            '|fffd||fffd|M|fffd||fffd||fffd||a0bd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||315||3d0||fffd||fffd||933e|
    Dim s_work As String
    Dim l_cnt As Long
    Dim msec_buf As String                                                                      '|fffd|^|fffd|C|fffd|}|fffd|C|fffd|x|fffd||fffd||fffd|g|fffd||fffd||fffd||303|o|fffd|b|fffd|t|fffd|@|fffd||fffd||fffd|p
    Dim bit_num As Long                                                                         'long_buf|fffd||313||1ce||fffd|p|fffd||3d0||fffd|
    Dim buf_len As Long                                                                         'long_buf|fffd||315||fffd||fffd||fffd||fffd||fffd|
    Dim buf_cl_flg As Boolean                                                                   'long_buf|fffd|N|fffd||fffd||fffd|A|fffd|t|fffd||fffd||fffd|O
    Dim cr_p As Long                                                                            'cr|fffd||302||fffd||fffd||fffd|||fffd|C|fffd||fffd||fffd|g
    Dim l_buf_c_rx As String
    Dim wait_time As Long
    'Dim test_again_cmd As Integer
    Dim cell_output_flg As Boolean  'False:|fffd|g|fffd||fffd||fffd|K|fffd||209||fffd||fffd||fffd||fffd||243|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||742||fffd||fffd||fffd||fffd||202||fffd||fffd|ATrue:|fffd|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
    'Dim load_data As Double
    Dim ii As Long
    'Dim sub_data_cnt As Long
    Dim g_buf_kari As Long
    
    
    '++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    bb = 1 '|fffd|R|fffd|[|fffd|h|fffd||182||fffd||fffd||108||4d6||fffd||fffd||356||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||192||290|M|fffd||142||fffd||fffd||202||fffd||fffd||202||fffd|
    If bb = 2 Then
        comname = "COM1"
        hComm = CreateFile(comname, GENERIC_READ Or GENERIC_WRITE, 0, 0, OPEN_EXISTING, 0, 0)   '|fffd|||fffd|[|fffd|g|fffd||303|I|fffd|[|fffd|v|fffd||fffd|
    End If
    '+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    
    rData = Space(190)                                                                          '100|fffd||fffd||fffd||fffd||fffd||fffd||fffd||317||308||fffd|m|fffd||fffd|
    dummy_handle = ReadFile(hComm, ByVal rData, 190, rLen, 0)                                   '|fffd|f|fffd|[|fffd|^|fffd||30e||fffd|M(|fffd|Q|fffd||516||682||303|p|fffd||fffd||fffd||fffd||fffd|[|fffd|^|fffd||fffd|Byval|fffd||fffd||fffd||82||fffd||fffd||fffd|j
    bit_num = 1
    s_work = ""                                                                                 '|fffd||fffd||197|p|fffd||3d0||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    msec_buf = RTrim(rData)                                                                     '|fffd||fffd||fffd||742||303|o|fffd|b|fffd|t|fffd|@|fffd|R|fffd|s|fffd|[|fffd||fffd||fffd|o|fffd|b|fffd|t|fffd|@|fffd|N|fffd||fffd||fffd|A
    
    
    If msec_buf = "" Then
        timer_use_flg = True
    Else
        timer_use_flg = False
    End If
    
    long_buf = long_buf & msec_buf                                                              '|fffd|o|fffd|b|fffd|t|fffd|@|fffd|i|fffd|[|fffd||3d0||fffd||fffd||252||1c9||fffd|
    buf_cl_flg = True                                                                           'long_buf|fffd|N|fffd||fffd||fffd|A|fffd|t|fffd||fffd||fffd|O
    
    
    '|fffd||fffd|090401SATO|fffd||1c9||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    l_buf_c_rx = l_buf_c_rx_ctn
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
    Do
        DoEvents  '090401sato|fffd||693||fffd|
        bit_num = 1
        buf_len = Len(long_buf)
        If buf_len <> 0 Then                                                                    '|fffd|o|fffd|b|fffd|t|fffd|@|fffd||fffd||fffd|e|fffd||fffd||fffd||fffd||fffd||fffd||a347|
            Do
                s_work = Mid(long_buf, bit_num, 1)                                              '|fffd||a576||fffd||fffd||fffd||93||1c2||74e||fffd||fffd|
                l_buf_c_rx = l_buf_c_rx & s_work                                                'l_buf_c_rx|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||182||fffd||fffd||113||1c2||74e||fffd||fffd|o|fffd|b|fffd|t|fffd|@|fffd||242||202||fffd|
                bit_num = bit_num + 1
                If bit_num > buf_len Then
                    long_buf = ""
                    Exit Do
                End If
                If (s_work = vbCr) Then                                                         '|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|?(<CR>?)
                    cr_p = InStr(1, long_buf, vbCr)                                             'long_buf|fffd||30d||fffd||fffd||fffd||fffd||fffd|cr|fffd||fffd|T|fffd||fffd|
                    long_buf = Mid(long_buf, cr_p + 1, buf_len)                                 'VBCR|fffd||fffd||fffd||fffd||fffd||fffd||fffd||182||fffd||fffd||702||14f||fffd|
                    Exit Do
                End If
            Loop
        Else
            Exit Do
        End If
        
        
        
        If (s_work = vbCr) Then                                                                 '|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|?(<CR>?)
'******************************************************************************************************************
'|fffd|v|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd|M
'******************************************************************************************************************
            Select Case Left(l_buf_c_rx, 3)
                Case SZA
                
                    SZZ_receive_flg = False
                    y_flg = False
                    
                    
                    If Len(l_buf_c_rx) = 19 Then
                        
                        If (test_flg = True And SER_flg = False) Then                               '|fffd|f|fffd|[|fffd|^|fffd||fffd|o
                            
                            g_buf_data(0) = Mid(l_buf_c_rx, 6, 7)                                   '|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[
                            g_buf_data(1) = Mid(l_buf_c_rx, 13, 6)
                            
                            
                            
'#if NSCA_V103
                            If length_type_num = MM_UNIT Then
                                g_buf_data(0) = 100 * Val(g_buf_data(0))                               'Val(Mid())|fffd||152||fffd||fffd||692|l|fffd||fffd||fffd||fffd||fffd||182||fffd||fffd||241|A|fffd|G|fffd||fffd||fffd|[|fffd||fffd||fffd||142||fffd|B
                            
                            Else
                                g_buf_data(0) = 1000 * Val(g_buf_data(0))
                            
                            End If
'#endif
                            
                            
                            
                            g_buf_data(1) = Val(g_buf_data(1))
                            
                            
                            
                            '|fffd||fffd||fffd||fffd||fffd||3ce|ZON|fffd||fffd||fffd||fffd||a347||fffd|A|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||741|GOFF|fffd||fffd||fffd||fffd||fffd||a347||fffd|A|fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||fffd|
                            If set_distance_flg = True Then
                                move_data_zero(sub_data_cnt) = Abs(g_buf_data(0))
                                
                                If sub_data_cnt = 0 Then
                                    move_data(sub_data_cnt) = 0
                                
                                Else
                                    
'#if NSCA_V103
                                    If length_type_num = MM_UNIT Then
                                        move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 100)
                                        g_buf_kari = 100 * move_data(sub_data_cnt)
                                        move_data(sub_data_cnt) = g_buf_kari / 100
                                        
                                    Else
                                        move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 1000)
                                        g_buf_kari = 1000 * move_data(sub_data_cnt)
                                        move_data(sub_data_cnt) = g_buf_kari / 1000
                                    
                                    End If
'#endif
                                    
                                    
                                
                                End If
                                
                                
                            ElseIf set_distance_flg = False Or test_mode_num = 0 Then
                    
                                
'#if NSCA_V103
                                If length_type_num = MM_UNIT Then
                                    move_data(sub_data_cnt) = g_buf_data(0) / 100
                                    
                                Else
                                    move_data(sub_data_cnt) = g_buf_data(0) / 1000
                                
                                End If
'#endif
                            
                                                       
                            End If
                            
                            
                            test_end_flg = False
                            
                            
                            If main_frm_fgt.OptionButton_toriga_heni.Value = True Then   '|fffd|g|fffd||fffd||fffd|K|fffd||355||3c8||291|I|fffd||fffd||fffd||fffd|
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(move_data(sub_data_cnt)) >= triger Or data_cnt <> 0 Then  'Or test_times_cont <> 0
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                                
                                
                            ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(g_buf_data(1)) >= triger Or data_cnt <> 0 Then    '|fffd|g|fffd||fffd||fffd|K|fffd||349||5cf|d|fffd|I|fffd||fffd||fffd||fffd|'Or test_times_cont <> 0
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                                
                                
                            End If
                            
                            If cell_output_flg = True Then
                                move_data(data_cnt) = move_data(sub_data_cnt)
                                
                                
                                If set_AbsValue_flg = True Then
                                    weight_data(data_cnt) = Abs(g_buf_data(1))                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                Else
                                    weight_data(data_cnt) = g_buf_data(1)                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                End If
                                
                                
                                If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                                    outp_mdl_e.cell_output                                              '|fffd||fffd||fffd|e|fffd||3cd|X|fffd|v
                                End If
                                
                                
                                data_end_flg = False
                                data_cnt = data_cnt + 1                                             '|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|{|fffd|P
                                data_cont_go_forsingle = data_cont_go_forsingle + 1                 'Sing|fffd||fffd||fffd|[|fffd|h|fffd||fffd||fffd||309||fffd||fffd|H|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|J|fffd|E|fffd||fffd||fffd|^
                                
                            End If
                            
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Measuring"  'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||c486|"
                            
                            before_test_times = test_times_cont
                            sub_data_cnt = sub_data_cnt + 1
                            
                            If graph_on_flg = True Then
                                
                                If data_cnt >= 32000 Or sub_data_cnt - data_cnt - 1 = 32000 Then
                                    
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    long_buf = SZZ & vbCr     'or|fffd|@long_buf =""
                                    
                                End If
                                
                            ElseIf graph_on_flg = False Then
                                
                                If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
                                    
                                    If data_cnt >= (Rows_Max - 1) Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                        comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                        MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                        long_buf = SZZ & vbCr     'or|fffd|@long_buf =""
                                    
                                    End If
                                
                                ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
                                    
                                    If (s_row + data_cnt) >= Rows_Max Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                        comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                        MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                        long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                    
                                End If
                                
                            End If
                            
                        End If
                    Else
                    
                    End If
                    
                    If data_cnt > 0 Then
                        C_P_aru_flg(test_times_cont) = True
                    End If
                    
                    l_cmd = ""
                

                Case SZB
                    
                    SZZ_receive_flg = False
                    y_flg = False
                    
                    If Len(l_buf_c_rx) = 19 Then
                        
                        If (test_flg = True And SER_flg = False) Then                                                  '|fffd|f|fffd|[|fffd|^|fffd||fffd|o
                            g_buf_data(0) = Mid(l_buf_c_rx, 6, 7)                                  '|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[
                            g_buf_data(1) = Mid(l_buf_c_rx, 13, 6)
                            
'#if NSCA_V103
                            If length_type_num = MM_UNIT Then
                                g_buf_data(0) = 100 * Val(g_buf_data(0))                               'Val(Mid())|fffd||152||fffd||fffd||692|l|fffd||fffd||fffd||fffd||fffd||182||fffd||fffd||241|A|fffd|G|fffd||fffd||fffd|[|fffd||fffd||fffd||142||fffd|B
                            
                            Else
                                g_buf_data(0) = 1000 * Val(g_buf_data(0))
                            
                            End If
'#endif
                            
                            
                            
                            
                            g_buf_data(1) = Val(g_buf_data(1))
                            
                            '|fffd||fffd||fffd||fffd||fffd||3ce|ZON|fffd||fffd||fffd||fffd||a347||fffd|A|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||741|GOFF|fffd||fffd||fffd||fffd||fffd||a347||fffd|A|fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||fffd|
                            If set_distance_flg = True Then
                                move_data_zero(sub_data_cnt) = Abs(g_buf_data(0))
                                
                                If sub_data_cnt = 0 Then
                                    move_data(sub_data_cnt) = 0
                                Else
                                    
                                    
                                    
'#if NSCA_V103
                                    If length_type_num = MM_UNIT Then
                                        move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 100)
                                        g_buf_kari = 100 * move_data(sub_data_cnt)
                                        move_data(sub_data_cnt) = g_buf_kari / 100
                                    Else
                                        move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 1000)
                                        g_buf_kari = 1000 * move_data(sub_data_cnt)
                                        move_data(sub_data_cnt) = g_buf_kari / 1000
                                       
                                    End If
'#endif
                                    
                                    
                                    
                                    
                                End If
                            
                            ElseIf set_distance_flg = False Or test_mode_num = 0 Then
                                
'#if NSCA_V103
                                If length_type_num = MM_UNIT Then
                                    move_data(sub_data_cnt) = g_buf_data(0) / 100
                                Else
                                    move_data(sub_data_cnt) = g_buf_data(0) / 1000
                                       
                                End If
'#endif


                            End If
                            
                            data_end_flg = False
                            test_end_flg = False
                            
                            If main_frm_fgt.OptionButton_toriga_heni.Value = True Then   '|fffd|g|fffd||fffd||fffd|K|fffd||355||3c8||291|I|fffd||fffd||fffd||fffd|
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(move_data(sub_data_cnt)) >= triger Or data_cnt <> 0 Then
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(g_buf_data(1)) >= triger Or data_cnt <> 0 Then    '|fffd|g|fffd||fffd||fffd|K|fffd||349||5cf|d|fffd|I|fffd||fffd||fffd||fffd|'Or test_times_cont <> 0
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            End If
                            
                            If cell_output_flg = True Then
                                'main_frm_fgt.state_lbl.ForeColor
                                'main_frm_fgt.state_lbl.Caption = "|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||fffd|"
                                'move_data(data_cnt) = move_data(data_cnt) + g_buf_data(0)                        '|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                move_data(data_cnt) = move_data(sub_data_cnt)
                                If set_AbsValue_flg = True Then
                                    weight_data(data_cnt) = Abs(g_buf_data(1))                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                Else
                                    weight_data(data_cnt) = g_buf_data(1)                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                End If
                                
                                If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                                    outp_mdl_e.cell_output                                              '|fffd||fffd||fffd|e|fffd||3cd|X|fffd|v
                                End If
                                'data_end_flg = False
                                data_cnt = data_cnt + 1                                             '|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|{|fffd|P
                            
                            End If
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Measuring"  'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||c486|"
                            
                            before_test_times = test_times_cont
                            sub_data_cnt = sub_data_cnt + 1
                            
                            If graph_on_flg = True Then
                                
                                If data_cnt >= 32000 Or sub_data_cnt - data_cnt - 1 = 32000 Then
                                    'test_flg = False
                                    'long_buf = ""|fffd|^|fffd|C|fffd|~|fffd||fffd||fffd|O|fffd||fffd||fffd||fffd||fffd||fffd||fffd||60a4|
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    
                                    '|fffd||fffd||fffd|M|fffd||fffd||fffd|x|fffd||342|Q|fffd|O|fffd||fffd|/|fffd|b|fffd||20f||fffd||fffd||fffd||fffd||fffd||fffd||fffd||181|A
                                    'SSB|fffd||fffd||fffd|M|fffd||fffd||fffd||10e||fffd||fffd||fffd||fffd||fffd||fffd|~|fffd||7c2||fffd||702||141|ASZA|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||a347||fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd|B|fffd||fffd||fffd||fffd|SZZvbCr|fffd||242||10b||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd|A|fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd||fffd|[|fffd|v|fffd||fffd||fffd||7532||fffd||fffd||fffd|B
                                    'Long_buf|fffd||fffd||fffd|N|fffd||fffd||fffd|A|fffd||fffd||fffd||702||fffd||fffd|B
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    'comm_mdl_e.cmd_receive_proc
                                    'Exit Sub
                                End If
                                
                            ElseIf graph_on_flg = False Then
                                
                                If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
                                    If data_cnt >= (Rows_Max - 1) Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
                                    If (s_row + data_cnt) >= Rows_Max Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                End If
                                
                            End If
                            
                            'sub_data_cnt = sub_data_cnt + 1
                            
                        End If
                    End If
                    
                    If data_cnt > 0 Then
                        C_P_aru_flg(test_times_cont) = True
                    End If
                    
                    l_cmd = ""
                    
                    
                    
                Case SZC
                
                    SZZ_receive_flg = False
                    y_flg = False
                    
                    If Len(l_buf_c_rx) = 19 Then
                        
                        If (test_flg = True And SER_flg = False) Then                                                  '|fffd|f|fffd|[|fffd|^|fffd||fffd|o
                            g_buf_data(0) = Mid(l_buf_c_rx, 6, 7)                                  '|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[
                            g_buf_data(1) = Mid(l_buf_c_rx, 13, 6)
                            
                            
                            
'#if NSCA_V103
                            If length_type_num = MM_UNIT Then
                                g_buf_data(0) = 100 * Val(g_buf_data(0))                                'Val(Mid())|fffd||152||fffd||fffd||692|l|fffd||fffd||fffd||fffd||fffd||182||fffd||fffd||241|A|fffd|G|fffd||fffd||fffd|[|fffd||fffd||fffd||142||fffd|B
                            Else
                                g_buf_data(0) = 1000 * Val(g_buf_data(0))
                                   
                            End If
'#endif
                            
                            
                            
                            
                            g_buf_data(1) = Val(g_buf_data(1))
                            
                            '|fffd||fffd||fffd||fffd||fffd||3ce|ZON|fffd||fffd||fffd||fffd||a347||fffd|A|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||741|GOFF|fffd||fffd||fffd||fffd||fffd||a347||fffd|A|fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||fffd|
                            If set_distance_flg = True Then
                                move_data_zero(sub_data_cnt) = Abs(g_buf_data(0))
                                
                                If sub_data_cnt = 0 Then
                                    move_data(sub_data_cnt) = 0
                                Else
                                    
                                    
'#if NSCA_V103
                                If length_type_num = MM_UNIT Then
                                    move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 100)
                                    g_buf_kari = 100 * move_data(sub_data_cnt)
                                    move_data(sub_data_cnt) = g_buf_kari / 100
                                
                                Else
                                    move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 1000)
                                    g_buf_kari = 1000 * move_data(sub_data_cnt)
                                    move_data(sub_data_cnt) = g_buf_kari / 1000
                                       
                                End If
'#endif
                                                                  
                                End If
                                
                                
                            ElseIf set_distance_flg = False Or test_mode_num = 0 Then
                                
                                                              
'#if NSCA_V103
                                If length_type_num = MM_UNIT Then
                                    move_data(sub_data_cnt) = g_buf_data(0) / 100
                                    
                                Else
                                    move_data(sub_data_cnt) = g_buf_data(0) / 1000
                                       
                                End If
'#endif
                                
                                
                            End If
                            
                            data_end_flg = False
                            test_end_flg = False
                            
                            If main_frm_fgt.OptionButton_toriga_heni.Value = True Then   '|fffd|g|fffd||fffd||fffd|K|fffd||355||3c8||291|I|fffd||fffd||fffd||fffd|
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(move_data(sub_data_cnt)) >= triger Or data_cnt <> 0 Then
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(g_buf_data(1)) >= triger Or data_cnt <> 0 Then    '|fffd|g|fffd||fffd||fffd|K|fffd||349||5cf|d|fffd|I|fffd||fffd||fffd||fffd|
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            End If
                            
                            If cell_output_flg = True Then
                                'main_frm_fgt.state_lbl.ForeColor
                                'main_frm_fgt.state_lbl.Caption = "|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||fffd|"
                                'move_data(data_cnt) = move_data(data_cnt) + g_buf_data(0)                        '|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                move_data(data_cnt) = move_data(sub_data_cnt)
                                If set_AbsValue_flg = True Then
                                    weight_data(data_cnt) = Abs(g_buf_data(1))                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                Else
                                    weight_data(data_cnt) = g_buf_data(1)                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                End If
                                
                                If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                                    outp_mdl_e.cell_output                                              '|fffd||fffd||fffd|e|fffd||3cd|X|fffd|v
                                End If
                                'data_end_flg = False
                                data_cnt = data_cnt + 1                                             '|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|{|fffd|P
                           
                            End If
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Measuring"  'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||c486|"
                            
                            before_test_times = test_times_cont
                            sub_data_cnt = sub_data_cnt + 1
                            
                            If graph_on_flg = True Then
                                
                                If data_cnt >= 32000 Or sub_data_cnt - data_cnt - 1 = 32000 Then
                                    'test_flg = False
                                    'long_buf = ""|fffd|^|fffd|C|fffd|~|fffd||fffd||fffd|O|fffd||fffd||fffd||fffd||fffd||fffd||fffd||60a4|
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    
                                    '|fffd||fffd||fffd|M|fffd||fffd||fffd|x|fffd||342|Q|fffd|O|fffd||fffd|/|fffd|b|fffd||20f||fffd||fffd||fffd||fffd||fffd||fffd||fffd||181|A
                                    'SSB|fffd||fffd||fffd|M|fffd||fffd||fffd||10e||fffd||fffd||fffd||fffd||fffd||fffd|~|fffd||7c2||fffd||702||141|ASZA|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||a347||fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd|B|fffd||fffd||fffd||fffd|SZZvbCr|fffd||242||10b||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd|A|fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd||fffd|[|fffd|v|fffd||fffd||fffd||7532||fffd||fffd||fffd|B
                                    'Long_buf|fffd||fffd||fffd|N|fffd||fffd||fffd|A|fffd||fffd||fffd||702||fffd||fffd|B
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    'comm_mdl_e.cmd_receive_proc
                                    'Exit Sub
                                End If
                                
                            ElseIf graph_on_flg = False Then
                                
                                If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
                                    If data_cnt >= (Rows_Max - 1) Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
                                    If (s_row + data_cnt) >= Rows_Max Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                End If
                                
                            End If
                            
                            'sub_data_cnt = sub_data_cnt + 1
                            
                        End If
                    End If
                    If data_cnt > 0 Then
                        C_P_aru_flg(test_times_cont) = True
                    End If
                    l_cmd = ""
                Case SZD
                    SZZ_receive_flg = False
                    y_flg = False
                    If Len(l_buf_c_rx) = 19 Then
                        
                        If (test_flg = True And SER_flg = False) Then                                                  '|fffd|f|fffd|[|fffd|^|fffd||fffd|o
                            g_buf_data(0) = Mid(l_buf_c_rx, 6, 7)                                  '|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[
                            g_buf_data(1) = Mid(l_buf_c_rx, 13, 6)
                            
                            
                            
'#if NSCA_V103
                            If length_type_num = MM_UNIT Then
                                g_buf_data(0) = 100 * Val(g_buf_data(0))                                'Val(Mid())|fffd||152||fffd||fffd||692|l|fffd||fffd||fffd||fffd||fffd||182||fffd||fffd||241|A|fffd|G|fffd||fffd||fffd|[|fffd||fffd||fffd||142||fffd|B
                                g_buf_data(1) = Val(g_buf_data(1))
                            
                            Else
                                g_buf_data(0) = 1000 * Val(g_buf_data(0))                                'Val(Mid())|fffd||152||fffd||fffd||692|l|fffd||fffd||fffd||fffd||fffd||182||fffd||fffd||241|A|fffd|G|fffd||fffd||fffd|[|fffd||fffd||fffd||142||fffd|B
                                g_buf_data(1) = Val(g_buf_data(1))
                                   
                            End If
'#endif

                            
                            '|fffd||fffd||fffd||fffd||fffd||3ce|ZON|fffd||fffd||fffd||fffd||a347||fffd|A|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||741|GOFF|fffd||fffd||fffd||fffd||fffd||a347||fffd|A|fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||fffd|
                            If set_distance_flg = True Then
                                move_data_zero(sub_data_cnt) = Abs(g_buf_data(0))
                                
                                If sub_data_cnt = 0 Then
                                    move_data(sub_data_cnt) = 0
                                Else
                                    
                                    
                                    
'#if NSCA_V103
                                If length_type_num = MM_UNIT Then
                                    move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 100)
                                    g_buf_kari = 100 * move_data(sub_data_cnt)
                                    move_data(sub_data_cnt) = g_buf_kari / 100
                                    
                                Else
                                    move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 1000)
                                    g_buf_kari = 1000 * move_data(sub_data_cnt)
                                    move_data(sub_data_cnt) = g_buf_kari / 1000
                                       
                                End If
'#endif
                                    
                                End If
                            ElseIf set_distance_flg = False Or test_mode_num = 0 Then
                                
                                
'#if NSCA_V103
                                If length_type_num = MM_UNIT Then
                                    move_data(sub_data_cnt) = g_buf_data(0) / 100
                                Else
                                    move_data(sub_data_cnt) = g_buf_data(0) / 1000
                                       
                                End If
'#endif
                                
                            End If
                            
                            data_end_flg = False
                            test_end_flg = False
                            
                            If main_frm_fgt.OptionButton_toriga_heni.Value = True Then   '|fffd|g|fffd||fffd||fffd|K|fffd||355||3c8||291|I|fffd||fffd||fffd||fffd|
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(move_data(sub_data_cnt)) >= triger Or data_cnt <> 0 Then 'Or test_times_cont <> 0
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(g_buf_data(1)) >= triger Or data_cnt <> 0 Then    '|fffd|g|fffd||fffd||fffd|K|fffd||349||5cf|d|fffd|I|fffd||fffd||fffd||fffd|
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            End If
                            
                            If cell_output_flg = True Then
                                'main_frm_fgt.state_lbl.ForeColor
                                'main_frm_fgt.state_lbl.Caption = "|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||fffd|"
                                'move_data(data_cnt) = move_data(data_cnt) + g_buf_data(0)                        '|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                move_data(data_cnt) = move_data(sub_data_cnt)
                                If set_AbsValue_flg = True Then
                                    weight_data(data_cnt) = Abs(g_buf_data(1))                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                Else
                                    weight_data(data_cnt) = g_buf_data(1)                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                End If
                                
                                If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                                    outp_mdl_e.cell_output                                              '|fffd||fffd||fffd|e|fffd||3cd|X|fffd|v
                                End If
                                'data_end_flg = False
                                data_cnt = data_cnt + 1                                             '|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|{|fffd|P
                            
                            End If
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Measuring"  'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||c486|"
                            
                            before_test_times = test_times_cont
                            sub_data_cnt = sub_data_cnt + 1
                            
                            If graph_on_flg = True Then
                                
                                If data_cnt >= 32000 Or sub_data_cnt - data_cnt - 1 = 32000 Then
                                    'test_flg = False
                                    'long_buf = ""|fffd|^|fffd|C|fffd|~|fffd||fffd||fffd|O|fffd||fffd||fffd||fffd||fffd||fffd||fffd||60a4|
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    
                                    '|fffd||fffd||fffd|M|fffd||fffd||fffd|x|fffd||342|Q|fffd|O|fffd||fffd|/|fffd|b|fffd||20f||fffd||fffd||fffd||fffd||fffd||fffd||fffd||181|A
                                    'SSB|fffd||fffd||fffd|M|fffd||fffd||fffd||10e||fffd||fffd||fffd||fffd||fffd||fffd|~|fffd||7c2||fffd||702||141|ASZA|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||a347||fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd|B|fffd||fffd||fffd||fffd|SZZvbCr|fffd||242||10b||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd|A|fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd||fffd|[|fffd|v|fffd||fffd||fffd||7532||fffd||fffd||fffd|B
                                    'Long_buf|fffd||fffd||fffd|N|fffd||fffd||fffd|A|fffd||fffd||fffd||702||fffd||fffd|B
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    'comm_mdl_e.cmd_receive_proc
                                    'Exit Sub
                                End If
                                
                            ElseIf graph_on_flg = False Then
                                
                                If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
                                    If data_cnt >= (Rows_Max - 1) Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
                                    If (s_row + data_cnt) >= Rows_Max Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                End If
                                
                            End If
                            
                            'sub_data_cnt = sub_data_cnt + 1
                            
                        End If
                    End If
                    
                    If data_cnt > 0 Then
                        C_P_aru_flg(test_times_cont) = True
                    End If
                    l_cmd = ""
                
                Case SZE
                    
                    SZZ_receive_flg = False
                    y_flg = False
                    
                    If Len(l_buf_c_rx) = 19 Then
                        
                        If (test_flg = True And SER_flg = False) Then                                                  '|fffd|f|fffd|[|fffd|^|fffd||fffd|o
                            g_buf_data(0) = Mid(l_buf_c_rx, 6, 7)                                  '|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[
                            g_buf_data(1) = Mid(l_buf_c_rx, 13, 6)
                            
                            
                            
'#if NSCA_V103
                            If length_type_num = MM_UNIT Then
                                g_buf_data(0) = 100 * Val(g_buf_data(0))                                'Val(Mid())|fffd||152||fffd||fffd||692|l|fffd||fffd||fffd||fffd||fffd||182||fffd||fffd||241|A|fffd|G|fffd||fffd||fffd|[|fffd||fffd||fffd||142||fffd|B
                            Else
                                g_buf_data(0) = 1000 * Val(g_buf_data(0))
                            End If
'#endif
                            
                            
                            g_buf_data(1) = Val(g_buf_data(1))
                            
                            '|fffd||fffd||fffd||fffd||fffd||3ce|ZON|fffd||fffd||fffd||fffd||a347||fffd|A|fffd||693||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||741|GOFF|fffd||fffd||fffd||fffd||fffd||a347||fffd|A|fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||fffd|
                            If set_distance_flg = True Then
                                move_data_zero(sub_data_cnt) = Abs(g_buf_data(0))
                                
                                If sub_data_cnt = 0 Then
                                    move_data(sub_data_cnt) = 0
                                Else
                                    
'#if NSCA_V103
                                    If length_type_num = MM_UNIT Then
                                        move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 100)
                                        g_buf_kari = 100 * move_data(sub_data_cnt)
                                        move_data(sub_data_cnt) = g_buf_kari / 100
                                    Else
                                        move_data(sub_data_cnt) = move_data(sub_data_cnt - 1) + Abs((move_data_zero(sub_data_cnt) - move_data_zero(sub_data_cnt - 1)) / 1000)
                                        g_buf_kari = 1000 * move_data(sub_data_cnt)
                                        move_data(sub_data_cnt) = g_buf_kari / 1000
                                           
                                    End If
'#endif
                                    
                                
                                
                                End If
                            
                            
                            ElseIf set_distance_flg = False Or test_mode_num = 0 Then
                                
'#if NSCA_V103
                                If length_type_num = MM_UNIT Then
                                    move_data(sub_data_cnt) = g_buf_data(0) / 100
                                Else
                                    move_data(sub_data_cnt) = g_buf_data(0) / 1000
                                       
                                End If
'#endif
                                
                            
                            End If
                            
                            data_end_flg = False
                            test_end_flg = False
                            
                            If main_frm_fgt.OptionButton_toriga_heni.Value = True Then   '|fffd|g|fffd||fffd||fffd|K|fffd||355||3c8||291|I|fffd||fffd||fffd||fffd|
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(move_data(sub_data_cnt)) >= triger Or data_cnt <> 0 Then  'Or test_times_cont <> 0
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            
                            ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
                                '|fffd|f|fffd|[|fffd|^|fffd||303|Z|fffd||fffd||fffd||58e||fffd||835e||fffd||74a|J|fffd|n|fffd||341|A
                                '|fffd||fffd||835e||fffd||743|f|fffd|[|fffd|^|fffd||343|g|fffd||fffd||fffd|K|fffd||20f||339e||fffd|i|fffd||fffd|triger|fffd|j|fffd|A
                                '|fffd|g|fffd||fffd||fffd|K|fffd||fffd||fffd|o|fffd||fffd||fffd||102||fffd||fffd||fffd|idata_cnt<>0|fffd|j|fffd|A
                                '|fffd||fffd||fffd||fffd||fffd|Q|fffd||fffd||682||fffd||fffd||fffd|itest_times_cnt<>0|fffd|j    ''|fffd||fffd||fffd||682||242||182||80aa||fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||102||202||fffd||fffd||102||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||74a|J|fffd|n
                                
                                If Abs(g_buf_data(1)) >= triger Or data_cnt <> 0 Then    '|fffd|g|fffd||fffd||fffd|K|fffd||349||5cf|d|fffd|I|fffd||fffd||fffd||fffd|
                                    cell_output_flg = True
                                Else
                                    cell_output_flg = False
                                End If
                            
                            End If
                            
                            If cell_output_flg = True Then
                                
                                move_data(data_cnt) = move_data(sub_data_cnt)
                                
                                If set_AbsValue_flg = True Then
                                    weight_data(data_cnt) = Abs(g_buf_data(1))                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                Else
                                    weight_data(data_cnt) = g_buf_data(1)                               '|fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|i|fffd|[
                                End If
                                
                                If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                                    outp_mdl_e.cell_output                                              '|fffd||fffd||fffd|e|fffd||3cd|X|fffd|v
                                End If
                                
                                'data_end_flg = False
                                data_cnt = data_cnt + 1                                             '|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|{|fffd|P
                            
                            End If
                            
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Measuring"  'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||c486|"
                            
                            before_test_times = test_times_cont
                            sub_data_cnt = sub_data_cnt + 1
                            
                            If graph_on_flg = True Then
                                
                                If data_cnt >= 32000 Or sub_data_cnt - data_cnt - 1 = 32000 Then
                                    'test_flg = False
                                    'long_buf = ""|fffd|^|fffd|C|fffd|~|fffd||fffd||fffd|O|fffd||fffd||fffd||fffd||fffd||fffd||fffd||60a4|
                                    comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                    MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                    
                                    '|fffd||fffd||fffd|M|fffd||fffd||fffd|x|fffd||342|Q|fffd|O|fffd||fffd|/|fffd|b|fffd||20f||fffd||fffd||fffd||fffd||fffd||fffd||fffd||181|A
                                    'SSB|fffd||fffd||fffd|M|fffd||fffd||fffd||10e||fffd||fffd||fffd||fffd||fffd||fffd|~|fffd||7c2||fffd||702||141|ASZA|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||a347||fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd|B|fffd||fffd||fffd||fffd|SZZvbCr|fffd||242||10b||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd|A|fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd||fffd|[|fffd|v|fffd||fffd||fffd||7532||fffd||fffd||fffd|B
                                    'Long_buf|fffd||fffd||fffd|N|fffd||fffd||fffd|A|fffd||fffd||fffd||702||fffd||fffd|B
                                    long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    'comm_mdl_e.cmd_receive_proc
                                    'Exit Sub
                                End If
                                
                            ElseIf graph_on_flg = False Then
                                
                                If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
                                    
                                    If data_cnt >= (Rows_Max - 1) Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                        comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                        MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                        long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                
                                ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
                                    
                                    If (s_row + data_cnt) >= Rows_Max Or (sub_data_cnt - data_cnt) = Rows_Max Then
                                        comm_mdl_e.cmd_send_proc (SSB)                                      'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                                        MsgBox MES11, vbExclamation, OBI_STR                                '"1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
                                        long_buf = SZZ & vbCr      'or|fffd|@long_buf =""
                                    End If
                                
                                End If
                                
                            End If
                            
                            'sub_data_cnt = sub_data_cnt + 1
                            
                        End If
                        
                    End If
                    
                    If data_cnt > 0 Then
                        C_P_aru_flg(test_times_cont) = True
                    End If
                    
                    l_cmd = ""

                
                
                Case SZF
                    SZZ_receive_flg = False
                    y_flg = False
                    
                    If Len(l_buf_c_rx) = 19 Then
                        
                        If (test_flg = True And SER_flg = False) Then                                                  '|fffd|f|fffd|[|fffd|^|fffd||fffd|o
                            data_end_flg = False
                            test_end_flg = False
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Measuring"  'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||c486|"
                                                                                   
                        End If
                        
                    End If
                    
                    l_cmd = ""

                Case SZY                                                                        'SSC|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd||10a|J)|fffd||fffd||fffd|M
                    
                    SZZ_receive_flg = False
                    
                    data_end_flg = True
                    
                    If graph_on_flg = True Then
                        
                        outp_mdl_e.toukeisheet_blank_check
                        
                        If toukeisheet_blank_check_flg = False Then '|fffd||fffd||82||303|f|fffd|[|fffd|^|fffd||fffd||fffd|o|fffd||342||fffd||fffd||102||fffd||fffd||202||fffd||fffd||a347||fffd|A|fffd||fffd||fffd|L|fffd||30f||fffd||fffd||fffd||fffd||34d|s|fffd||fffd||202||fffd||fffd|B
                            
                                                                                
'MAX/MIN|fffd|l|fffd||64fe|+++++++++++++++++++++++++++++++++++++++++++++++++++++++USA
                            max_min_culc (0)
                            
                            'max_load(test_times_cont) = weight_data(0)
                            'min_load(test_times_cont) = weight_data(0)
                        
                            'If data_cnt > 0 Then
                            '    For ii = 0 To data_cnt - 1
                            '        If max_load(test_times_cont) <= weight_data(ii) Then
                            '            max_load(test_times_cont) = weight_data(ii)
                            '            max_load_cell(test_times_cont) = move_data(ii)
                            '        End If
                            '        If min_load(test_times_cont) >= weight_data(ii) Then
                            '            min_load(test_times_cont) = weight_data(ii)
                            '
                            '        End If
                            '        load_data = load_data + weight_data(ii)
                            '    Next
                            'Else
                            '    max_load(test_times_cont) = 0
                            '    min_load(test_times_cont) = 0
                            'End If
                            'max_gf = max_load(test_times_cont)
                                                 
'++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                                        
                            
                            
                            ave_load(test_times_cont) = load_data / data_cnt      '|fffd||fffd||fffd||3d2|l|fffd||64fe|
                                                        
                            If limit_chk_flg = 0 Then
                                
                                If max_gf <= max_limit And max_gf >= min_limit Then
                                    limit_chk_text = "OK"
                                
                                ElseIf max_gf > max_limit Then
                                    limit_chk_text = "HIGH"
                                
                                ElseIf max_gf < min_limit Then
                                    limit_chk_text = "LOW"
                                
                                End If
                                
                            ElseIf limit_chk_flg = 1 Then
                                limit_chk_text = "Invalid"   'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
                            
                            End If
                            
                            
'#If USA = 1 Then
    
                            If M_limit_chk_flg = 0 Then
                                
                                If M_max_gf <= M_max_limit And M_max_gf >= M_min_limit Then
                                    M_limit_chk_text = "OK"
                                
                                ElseIf M_max_gf > M_max_limit Then
                                    M_limit_chk_text = "HIGH"
                                
                                ElseIf M_max_gf < M_min_limit Then
                                    M_limit_chk_text = "LOW"
                                
                                End If
                                
                            ElseIf M_limit_chk_flg = 1 Then
                                M_limit_chk_text = "Invalid"   'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
                            
                            End If
'#End If
                            
                            
                            
                            If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                                outp_mdl_e.toukei_cell_output         '|fffd||fffd||fffd|v|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|G|fffd|N|fffd|Z|fffd||fffd||fffd||58f|o|fffd||fffd|   '|fffd||fffd||fffd||342||30d||c42c||fffd||fffd||fffd|f|fffd||34a||590||fffd||fffd||24a||702||fffd||142||fffd||fffd||fffd|B
                                'toukei_sheet_cont = toukei_sheet_cont + 1
                            
                            End If
                            
                        ElseIf toukeisheet_blank_check_flg = True Then
                            
                            If sample_flg(test_times_cont) = True Then
                                toukei_sheet_cont = toukei_sheet_cont + 1
                            
                            End If
                            
                        End If
                    Else
                        
                        If test_mode_num = 3 Or test_mode_num = 4 Then
                            
                            
'MAX/MIN|fffd|l|fffd||64fe|+++++++++++++++++++++++++++++++++++++++++++++++++++++++USA
                            max_min_culc (1)
                                                                                    
                            'max_load(test_times_cont) = weight_data(0)
                            'min_load(test_times_cont) = weight_data(0)
                                                    
                            'If data_cnt > 0 Then
                            '    For ii = 0 To data_cnt - 1
                            '        If weight_data(ii) >= max_load(test_times_cont) Then
                            '            max_load(test_times_cont) = weight_data(ii)
                            '            max_load_cell(test_times_cont) = move_data(ii)
                            '
                            '        End If
                            '    Next
                            'Else
                            '    max_load(test_times_cont) = 0
                            '    min_load(test_times_cont) = 0
                            'End If
                            
'++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                
                        End If
                                        
                        If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                            dataonly_cellout_cnt = dataonly_cellout_cnt + 1
                            y_flg = True
                        End If
                        
                        
                    End If
                    
                    If (test_mode_num = 3 Or test_mode_num = 4) And graph_on_flg = False Then
                        
                        If (s_col + 2 * dataonly_cellout_cnt) >= Col_MAX Then
                            outp_mdl_e.Sheet_move
                            dataonly_cellout_cnt = 0
                            s_col = 1
                        End If
                        
                    End If
                    
                    test_times_cont = test_times_cont + 1
            
                    main_frm_fgt.state_lbl.BackColor = &H80FFC0
                    main_frm_fgt.state_lbl.ForeColor = &H0&
                    main_frm_fgt.state_lbl.Caption = "Measuring"  'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||c486|"
                    
                    If test_times_cont >= cont_num Then
                        'test_end_flg = True     '|fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||741|A|fffd||fffd||fffd||fffd|
                        'data_end_flg = True
                        comm_mdl_e.cmd_send_proc (SSB)     '
                        stop_end_flg = True
                        Exit Sub
                    
                    Else
                        
                        If graph_on_flg = True Then
                            
                            If data_end_flg = True Then
                                
                                If sample_flg(test_times_cont) = True Then
                                    outp_mdl_e.Sheet_move
                                    outp_mdl_e.st_header
                                
                                End If
                            
                            End If
                        
                        End If
                        comm_mdl_e.cmd_send_proc (SSC)
                        'comm_mdl_e.cmd_receive_proc
                    
                    End If
                    
                    move_data(0) = 0
                    data_cnt = 0                            '|fffd||fffd||4e38c||fffd||fffd|I|fffd||fffd||fffd||fffd||fffd||fffd||181|Adata_cont|fffd||34f||fffd||fffd||fffd||fffd||fffd|
                    load_data = 0
                    sub_data_cnt = 0
                    max_gf = 0
                    min_gf = 0
                    l_cmd = ""
                    
                Case SZZ
                    
                    SZZ_receive_flg = True
                    
                    If C_P_max_make_flg = True Then
                        
                        If main_stop_flg = True Then
                            dataonly_cellout_cnt = dataonly_cellout_cnt + 1
                        End If
                       
                        
                        '|fffd||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd||fffd||fffd|A|fffd|O|fffd||fffd||fffd|t|fffd||fffd|MAX|fffd|V|fffd|[|fffd|g|fffd||c42c|
                        '|fffd|f|fffd|[|fffd|^|fffd||635e||fffd||fffd||fffd||fffd||fffd||fffd|MAX|fffd|V|fffd|[|fffd|g|fffd||c42c|
                        '|fffd|f|fffd|[|fffd|^|fffd||635e||fffd||fffd||fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd|t|fffd||c42c|
                        
                        If delete_sheet_flg = True And test_flg = True And graph_on_flg = True Then
                            ActiveSheet.Cells.Clear
                            Cells.ColumnWidth = 8.38
                            ActiveSheet.Cells(1, 1).Activate
                        
                        ElseIf delete_sheet_flg = True And test_flg = True And graph_on_flg = False Then
                            
                        Else
                            
                            data_end_flg = True
                            
                            If graph_on_flg = True Then
                                
                                outp_mdl_e.toukeisheet_blank_check
                                
                                If test_times_cont < cont_num Or test_mode_num = 0 Or test_mode_num = 2 Then    '|fffd|\|fffd|t|fffd|g|fffd||752||fffd||fffd|<|fffd|{|fffd||310||752||fffd||5050e||fffd||fffd||241|A|fffd|d|fffd||fffd||fffd||fffd||835e||fffd||756|h|fffd|~
                                    
                                    If toukeisheet_blank_check_flg = False Then  '|fffd||fffd||82||303|f|fffd|[|fffd|^|fffd||fffd||fffd|o|fffd||342||fffd||fffd||102||fffd||fffd||202||fffd||fffd||a347||fffd|A|fffd||fffd||fffd|L|fffd||30f||fffd||fffd||fffd||fffd||34d|s|fffd||fffd||202||fffd||fffd|B
                                        
                                        
                                        
'MAX/MIN|fffd|l|fffd||64fe|+++++++++++++++++++++++++++++++++++++++++++++USA

                                        max_min_culc (0)
                                                                                                                  
                                        'max_load(test_times_cont) = weight_data(0)
                                        'min_load(test_times_cont) = weight_data(0)
                                        
                                        'For ii = 0 To data_cnt - 1
                                            
                                        '    If max_load(test_times_cont) <= weight_data(ii) Then
                                        '        max_load(test_times_cont) = weight_data(ii)
                                        '        max_load_cell(test_times_cont) = move_data(ii)
                                        '    End If
                                            
                                        '    If min_load(test_times_cont) >= weight_data(ii) Then
                                        '       min_load(test_times_cont) = weight_data(ii)
                                        '    End If
                                            
                                        '    load_data = load_data + weight_data(ii)
                                            
                                        'Next
                                        
                                        'max_gf = max_load(test_times_cont)
                                  
'++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                        
                                        
                                        
                                        ave_load(test_times_cont) = load_data / data_cnt       '|fffd||fffd||fffd||3d2|l|fffd||64fe|
                                                                                
                                        If limit_chk_flg = 0 Then
                                            If max_gf <= max_limit And max_gf >= min_limit Then
                                                limit_chk_text = "OK"
                                            ElseIf max_gf > max_limit Then
                                                limit_chk_text = "HIGH"
                                            ElseIf max_gf < min_limit Then
                                                limit_chk_text = "LOW"
                                            End If
                                        ElseIf limit_chk_flg = 1 Then
                                            limit_chk_text = "Invalid"  'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
                                        End If
                                        
                                        
                                        'USA
                                        If M_limit_chk_flg = 0 Then
                                            If M_max_gf <= M_max_limit And M_max_gf >= M_min_limit Then
                                                M_limit_chk_text = "OK"
                                            ElseIf M_max_gf > M_max_limit Then
                                                M_limit_chk_text = "HIGH"
                                            ElseIf M_max_gf < M_min_limit Then
                                                M_limit_chk_text = "LOW"
                                            End If
                                        
                                        ElseIf M_limit_chk_flg = 1 Then
                                            M_limit_chk_text = "Invalid"  'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
                                        
                                        End If
                                        'endif
                                                                                
                                                                                
                                        If test_mode_num = 0 Or test_mode_num = 2 Or sample_flg(test_times_cont) = True Then
                                            outp_mdl_e.toukei_cell_output         '|fffd||fffd||fffd|v|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|G|fffd|N|fffd|Z|fffd||fffd||fffd||58f|o|fffd||fffd|   '|fffd||fffd||fffd||342||30d||c42c||fffd||fffd||fffd|f|fffd||34a||590||fffd||fffd||24a||702||fffd||142||fffd||fffd||fffd|B
                                        End If
                                    
                                    
                                    ElseIf toukeisheet_blank_check_flg = True Then
                                        
                                        If sample_flg(test_times_cont) = True Then
                                            toukei_sheet_cont = toukei_sheet_cont + 1
                                        End If
                                    
                                    End If
                                    
                                End If
                                
                                If test_mode_num = 0 Or test_mode_num = 2 Then
                                    outp_mdl_e.mk_fig
                                    If test_mode_num = 2 Then
                                        max_output_single                               '|fffd||fffd||fffd||fffd||fffd||fffd|
                                    End If
                                ElseIf (test_mode_num = 3 Or test_mode_num = 4) Then
                                    'If cont_num >= 2 Then
                                        'MAX|fffd|V|fffd|[|fffd|g|fffd||c42c|      '|fffd||c42c||fffd|v
                                        'max_sheet_cont = max_sheet_cont + 1
                                        outp_mdl_e.toukeisheet_max_output
                                        outp_mdl_e.mk_multigraph '|fffd|O|fffd||fffd||fffd|t|fffd||c42c|'|fffd|O|fffd||fffd||fffd|t|fffd|d|fffd||2cd||fffd||fffd||d0b9|
                                    'End If
                                End If
                                
                            ElseIf graph_on_flg = False Then
                                
                                If (test_mode_num = 2 Or test_mode_num = 3 Or test_mode_num = 4) Then
                                    
                                    
'MAX/MIN|fffd|l|fffd||64fe|+++++++++++++++++++++++++++++++++++++++++++++

                                    max_min_culc (1)
                                    
                                    'max_load(test_times_cont) = weight_data(0)
                                    'min_load(test_times_cont) = weight_data(0)
                                    
                                    'For ii = 0 To data_cnt - 1
                                        
                                    '    If max_load(test_times_cont) <= weight_data(ii) Then
                                    '        max_load(test_times_cont) = weight_data(ii)
                                    '        max_load_cell(test_times_cont) = move_data(ii)
                                    '    End If
                                    
                                    'Next
                                   
'++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
                                    
                                End If
                                
                                
                                If (test_mode_num = 3 Or test_mode_num = 4) Then
                                    If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
                                        Worksheets(off_last_sheet).Cells(1, intXCnt_used + 3).Activate
                                    ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
                                        If s_col + 2 * dataonly_cellout_cnt > Col_MAX Then
                                            Worksheets(off_last_sheet).Cells(s_row, s_col + 2 * (dataonly_cellout_cnt - 1)).Activate
                                        Else
                                            Worksheets(off_last_sheet).Cells(s_row, s_col + 2 * dataonly_cellout_cnt).Activate
                                        End If
                                    End If
                                    
                                    outp_mdl_e.toukeisheet_max_output
                                End If
                                
                                If test_times_cont = cont_num And test_times_cont <> 0 Then
                                    dataonly_cellout_cnt = dataonly_cellout_cnt - 1
                                End If
                                
                                If test_mode_num = 3 Or test_mode_num = 4 Then
                                    ActiveSheet.Cells(1, 1).Activate
                                
                                ElseIf test_mode_num = 0 Or test_mode_num = 2 Then
                                    
                                    If test_mode_num = 2 Then
                                        max_output_single                               '|fffd||fffd||fffd||fffd||fffd||fffd|
                                    End If
                                    
                                    If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
                                        
                                        If intXCnt_used + 3 > Col_MAX Then
                                            ActiveSheet.Cells(1, intXCnt_used + 1).Activate
                                            ma_si_colend_flg = True
                                        Else
                                            ActiveSheet.Cells(1, intXCnt_used + 3).Activate
                                        End If
                                    
                                    ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
                                        
                                        If s_col + 2 > 256 Then
                                            ActiveSheet.Cells(s_row, s_col).Activate
                                            ma_si_colend_flg = True
                                        Else
                                            ActiveSheet.Cells(s_row, s_col + 2).Activate
                                        End If
                                    
                                    End If
                                
                                End If
                                'dataonly_cellout_cnt = dataonly_cellout_cnt + 1
                            
                            End If
                        
                        End If
                    
                    End If
                    
                    
                    test_times = test_times + 1
                    '|fffd||fffd||fffd||fffd||fffd||fffd|
                    test_end_flg = True
                    dataonly_cellout_cnt = 0
                    data_cont_go_forsingle = 0  '|fffd||fffd||fffd|H|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||303|N|fffd||fffd||fffd|A   For|fffd|@Sing|fffd||fffd||fffd|[|fffd|h
                    'data_end_flg = True
                    before_test_times = 0
                    test_times_cont = 0       '|fffd||fffd||fffd||fffd||fffd||50503|J|fffd|E|fffd||fffd||fffd|^|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                    toukei_sheet_cont = 0
                    move_data(0) = 0
                    data_cnt = 0
                    sub_data_cnt = 0
                    max_gf = 0
                    min_gf = 0
                    load_data = 0
                    test_flg = False
                    stop_end_flg = False
                    'test_times = test_times + 1
                    
                    If main_frm_fgt_open_flg = True Then
                        main_frm_fgt.Enabled_True
                        
                        If SER_flg = False Then
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Available"
                        Else: SER_flg = True
                            main_frm_fgt.state_lbl.BackColor = &H80FFC0
                            main_frm_fgt.state_lbl.ForeColor = &H0&
                            main_frm_fgt.state_lbl.Caption = "Available"
                        
                        End If
                        
                    End If
                    
                    interruption_flg = False
                    'main_frm_fgt.state_lbl.Caption = "|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd||fffd|~|fffd||fffd|"
                
                    'comm_mdl_e.cmd_send_proc (SSB)                                              'SSB|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||fffd||fffd||fffd||fffd|~|fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
                    'l_cmd = ""
                    Exit Sub
                    
'******************************************************************************************************************
'SEA|fffd||fffd|M
'******************************************************************************************************************
                Case SEA
                    l_cmd = ""
'******************************************************************************************************************
'******************************************************************************************************************
'SSA|fffd||fffd||fffd||fffd|M(|fffd||fffd||fffd|F0-PUSH|fffd||fffd||fffd||fffd||fffd|A1-PULL|fffd||fffd||fffd||fffd|)
'******************************************************************************************************************
                Case SSA  'SSA    ' |fffd||fffd|M|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd|
                    test_direction_num = Val(Mid(l_buf_c_rx, 4, 1))
                    data_cnt = 0
                    
                    If test_direction_num = 0 Then
                        test_start_direction = "PUSH"
                    
                    ElseIf test_direction_num = 1 Then
                        test_start_direction = "PULL"
                    
                    End If
                    
                    l_cmd = ""
'******************************************************************************************************************
'SSB|fffd||fffd|M            '|fffd|r|fffd||fffd||fffd||14b||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd||fffd||fffd||fffd||181|ASSZ|fffd||fffd|M|fffd||fffd||fffd||90a9||fffd||201|H|fffd||2ce||fffd|M|fffd||fffd||fffd||fffd|
'******************************************************************************************************************
                Case SSB
                    If SZZ_receive_flg = True Then
                        main_frm_fgt.Enabled_True
                        main_frm_fgt.CmdBtn_Push.SetFocus
                    End If
                    
                    l_cmd = ""
                    
                Case SSC
                    l_cmd = ""
                
                Case SSD
                    test_mode_num = Val(Mid(l_buf_c_rx, 4, 1))          '|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd||fffd||fffd|[|fffd|h|fffd||64fe|
                    Select Case test_mode_num
                        Case 0
                            test_mode_name = "MANU mode"
                        Case 1
                            test_mode_name = "JOG mode"
                        Case 2
                            test_mode_name = "SING mode"
                        Case 3
                            test_mode_name = "CONT mode"
                        Case 4
                            test_mode_name = "PROG mode"
                        Case 9
                            'Exit Sub
                    End Select
                    l_cmd = ""
                Case SAI
                    l_cmd = ""
                Case SAJ
                    l_cmd = ""
                Case "DPA"
                    l_cmd = ""
                    test_times_stand = Val(Mid(l_buf_c_rx, 9, 4))          '|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd|{|fffd||302||30c|J|fffd||502||fffd||fffd||50502||30e||64fe|
                Case DCR
                    l_cmd = ""
                    test_times_stand = Val(Mid(l_buf_c_rx, 12, 4))          '|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd|{|fffd||302||30c|J|fffd||502||fffd||fffd||50502||30e||64fe|
                Case SAA
                    l_cmd = ""
'******************************************************************************************************************
'|fffd||fffd||fffd||311||fffd||fffd||fffd|M
'******************************************************************************************************************
                Case SBW
                    l_cmd = ""
                Case SQW
                    l_cmd = ""
                Case SSA
                    l_cmd = ""
                Case SOB
                    l_cmd = ""
                Case SOA
                    l_cmd = ""
                Case POW
                    l_cmd = ""
                Case PTW
                    l_cmd = ""
                Case SPW
                    l_cmd = ""
                Case SER
                    SER_flg = True
                    Select Case Mid(l_buf_c_rx, 4, 2)
                        Case 0
                        Case 10
'                            MsgBox "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g|fffd|G|fffd||fffd||fffd|[", vbExclamation, OBI_STR
                        Case 80
                            MsgBox "On emergency stop switch.", vbCritical, OBI_STR
                            'MsgBox "|fffd||fffd||fffd||fffd|~|fffd|{|fffd|^|fffd||fffd|ON", vbCritical, OBI_STR
                            'main_frm_fgt.state_lbl.ForeColor
                            'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd||fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||fffd||fffd|o"
                        Case 81
                            MsgBox "On limit switch(PUSH).", vbCritical, OBI_STR
                            'MsgBox "|fffd||fffd||fffd|~|fffd|b|fffd|g|fffd|X|fffd|C|fffd|b|fffd|`|fffd|iPUSH|fffd|jON", vbCritical, OBI_STR
                            delete_sheet_flg = True
                            'main_frm_fgt.state_lbl.ForeColor
                            'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd|~|fffd|b|fffd|g|fffd|X|fffd|C|fffd|b|fffd|`|fffd||fffd||fffd|o|fffd|iPUSH|fffd|j"
                        Case 82
                            MsgBox "On limit switch(PULL).", vbCritical, OBI_STR
                            'MsgBox "|fffd||fffd||fffd|~|fffd|b|fffd|g|fffd|X|fffd|C|fffd|b|fffd|`|fffd|iPULL|fffd|jON", vbCritical, OBI_STR
                            delete_sheet_flg = True
                            'main_frm_fgt.state_lbl.ForeColor
                            'main_frm_fgt.state_lbl.Caption = "|fffd||fffd||fffd|~|fffd|b|fffd|g|fffd|X|fffd|C|fffd|b|fffd|`|fffd||fffd||fffd|o|fffd|iPULL|fffd|j"
                        Case 83
                            MsgBox "FG_OVER(PUSH) ON.", vbCritical, OBI_STR
                            'main_frm_fgt.state_lbl.ForeColor
                            'main_frm_fgt.state_lbl.Caption = "|fffd|I|fffd|[|fffd|o|fffd||fffd||fffd|[|fffd|h|fffd||fffd||fffd|o|fffd|iPUSH|fffd|j"
                        Case 84
                            MsgBox "FG_OVER(PULL) ON.", vbCritical, OBI_STR
                            'main_frm_fgt.state_lbl.ForeColor
                            'main_frm_fgt.state_lbl.Caption = "|fffd|I|fffd|[|fffd|o|fffd||fffd||fffd|[|fffd|h|fffd||fffd||fffd|o|fffd|iPULL|fffd|j"
                        Case 85
                            MsgBox "ALARM is happened.", vbCritical, OBI_STR
                            'MsgBox "ALARM|fffd||fffd||fffd||fffd|", vbCritical, OBI_STR
                        Case 2
                            'MsgBox "|fffd|\|fffd||fffd|iEEPROM|fffd||fffd||fffd||fffd||fffd||fffd||fffd||743|G|fffd||fffd||fffd|[|fffd|j", vbExclamation, OBI_STR
                        Case 3
                            'MsgBox "|fffd|\|fffd||fffd|iEEPROM|fffd||1cf|o|fffd||fffd||fffd|G|fffd||fffd||fffd|[|fffd|j", vbExclamation, OBI_STR
                        Case 4
                            MsgBox "Can not be controlled by computer.", vbExclamation, OBI_STR
                            'MsgBox "|fffd|p|fffd|\|fffd|R|fffd||fffd||fffd||fffd||fffd||fffd||310||fffd||fffd||fffd|s|fffd||fffd|", vbExclamation, OBI_STR
                        Case 11
                            'MsgBox "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd|s|fffd||fffd|", vbExclamation, OBI_STR
                            MsgBox "Activating Test Stand or setting parameter. Please press the STOP or ZERO key.", vbExclamation, OBI_STR
                            'MsgBox "|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd||fffd||c486||fffd|A|fffd||fffd||fffd||343|p|fffd||fffd||fffd||fffd||fffd|[|fffd|^|fffd|[|fffd||752||8486||fffd||142||fffd||fffd|BStop|fffd|L|fffd|[|fffd||fffd||fffd||fffd||fffd|ZERO|fffd|L|fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ", vbExclamation, OBI_STR
                            connection_error
                        Case 12
                            'MsgBox "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd|s|fffd|s|fffd||fffd|", vbExclamation, OBI_STR
                            MsgBox "Activating Test Stand or setting parameter. Please press the STOP or ZERO key.", vbExclamation, OBI_STR
                            'MsgBox "|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd||fffd||c486||fffd|A|fffd||fffd||fffd||343|p|fffd||fffd||fffd||fffd||fffd|[|fffd|^|fffd|[|fffd||752||8486||fffd||142||fffd||fffd|BStop|fffd|L|fffd|[|fffd||fffd||fffd||fffd||fffd|ZERO|fffd|L|fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ", vbExclamation, OBI_STR"
                            connection_error
                        Case 13
                            MsgBox "Repeat Count is reached(only for CONT mode and PROG mode).", vbExclamation, OBI_STR
                            'MsgBox "|fffd|J|fffd||502||fffd||fffd||50513||fffd||fffd|B|fffd|iCONT|fffd||fffd||fffd|[|fffd|h|fffd|APROG|fffd||fffd||fffd|[|fffd|h|fffd||302||741|j", vbExclamation, OBI_STR
                        Case 20
                            MsgBox "Force gauge is not detected.", vbExclamation, OBI_STR
                            'MsgBox "|fffd|t|fffd|H|fffd|[|fffd|X|fffd|Q|fffd|[|fffd|W|fffd||fffd||fffd||fffd||fffd|o", vbExclamation, OBI_STR
                            connection_error
                    End Select
        
                    
                    l_cmd = ""

                Case TAA
                    l_cmd = ""
                Case TAE
                    l_cmd = ""
                Case "SQR"
                    'sel_val = Trim(Mid(l_buf_c_rx, 4, 1))
                    l_cmd = ""
                Case POR
                    l_cmd = ""
                Case PTR
                    l_cmd = ""
                Case TNH
                    If Mid(l_buf_c_rx, 5, 1) <> Chr(13) Then
                        unit_num = Val(Mid(l_buf_c_rx, 4, 2))   '|fffd|\|fffd||fffd||fffd|P|fffd||28e||64fe|
                    ElseIf Mid(l_buf_c_rx, 5, 1) = Chr(13) Then
                        unit_num = Val(Mid(l_buf_c_rx, 4, 1))   '|fffd|\|fffd||fffd||fffd|P|fffd||28e||64fe|
                        'l_cmd = ""
                    End If
                    l_cmd = ""
                Case TNE
                    fg_type_num = Mid(l_buf_c_rx, 4, 2) '|fffd|^|fffd||fffd||fffd||635e|
                    l_cmd = ""
                    
                    
'#If NSCA_V103 = 1 Then
                Case TBE
                    length_type_num = Mid(l_buf_c_rx, 4, 1) '|fffd||fffd||fffd||fffd||fffd|P|fffd||28e||635e|
                    l_cmd = ""

'#End If
                    
                    
                
            End Select
            
            l_buf_c_rx = ""                                                                 '|fffd||fffd|M|fffd|o|fffd|b|fffd|t|fffd|@|fffd||fffd||fffd||fffd||fffd||fffd|
        
        '|fffd||fffd|090401SATO|fffd||1c9||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            l_buf_c_rx_ctn = "" '|fffd|c|fffd||8576||fffd||fffd||fffd||fffd||fffd||fffd|
        Else
            l_buf_c_rx_ctn = l_buf_c_rx
        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        
        End If
    Loop

End Sub

Public Sub OnTimer()
    
    'If SER_flg = True Or test_flg = False Then
    '    Exit Sub
    'End If
    timer_mdl_e.TimerInterval = 0         ' |fffd|^|fffd|C|fffd|}disable
    comm_mdl_e.cmd_receive_proc           ' |fffd|||fffd|e|fffd|g|fffd|Q|fffd|[|fffd|W|fffd|{|fffd||302||fffd||fffd||fffd||303|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd|M|fffd||fffd||fffd||fffd|
    If timer_mdl_e.m_Timer_disable_flg = False Then
        timer_mdl_e.TimerInterval = K_TIMER   ' |fffd|^|fffd|C|fffd|}enable
    End If
End Sub

Public Sub connection_error()
    If test_flg = True Then
        main_frm_fgt.state_lbl.BackColor = &H0&
        main_frm_fgt.state_lbl.ForeColor = &HFF&
        main_frm_fgt.state_lbl.Caption = "Communication Error"
        'main_frm_fgt.state_lbl.Caption = "|fffd||290|M|fffd||64f||fffd|"
    End If
End Sub

Public Sub max_min_culc(flg As Boolean)
    Dim ii As Long
    Dim P_first_flg As Boolean
    Dim M_first_flg As Boolean
    
    max_load(test_times_cont) = 0
    M_max_load(test_times_cont) = 0
                
    p_nodata_flg(test_times_cont) = True
    m_nodata_flg(test_times_cont) = True
    
    P_first_flg = True
    M_first_flg = True
    
    
    If data_cnt > 0 Then
    
        For ii = 0 To data_cnt - 1
                                            
            If weight_data(ii) > 0 Then                                 '|fffd|@|fffd|{|fffd||312|l|fffd||30f||a347|
                                                    
                If P_first_flg = True Then                              '|fffd||fffd||fffd|l|fffd||30f||a347|
                    max_load(test_times_cont) = weight_data(ii)
                    min_load(test_times_cont) = weight_data(ii)
                    P_first_flg = False
                
                End If
                                    
                p_nodata_flg(test_times_cont) = False
                
                If weight_data(ii) >= max_load(test_times_cont) Then
                    max_load(test_times_cont) = weight_data(ii)
                    max_load_cell(test_times_cont) = move_data(ii)
                
                End If
                
                If weight_data(ii) <= min_load(test_times_cont) Then
                    min_load(test_times_cont) = weight_data(ii)
                End If
                
            ElseIf weight_data(ii) < 0 Then                             '|fffd|@-|fffd||312|l|fffd||30f||a347|
                                
                If M_first_flg = True Then                              '|fffd||fffd||fffd|l|fffd||30f||a347|
                    M_max_load(test_times_cont) = Abs(weight_data(0))
                    M_min_load(test_times_cont) = Abs(weight_data(0))
                    M_first_flg = False
                
                End If
                                     
                m_nodata_flg(test_times_cont) = False
                
                If Abs(weight_data(ii)) >= M_max_load(test_times_cont) Then
                    M_max_load(test_times_cont) = Abs(weight_data(ii))
                    M_max_load_cell(test_times_cont) = move_data(ii)
                
                End If
                
                If Abs(weight_data(ii)) <= M_min_load(test_times_cont) Then
                    M_min_load(test_times_cont) = Abs(weight_data(ii))
                End If
                                                    
            Else    '0|fffd||30f||a347|
                
                P_first_flg = False
                M_first_flg = False
                
                p_nodata_flg(test_times_cont) = False
                m_nodata_flg(test_times_cont) = False
                
                min_load(test_times_cont) = 0
                M_min_load(test_times_cont) = 0
            
            End If
                
            load_data = load_data + weight_data(ii)
        
        Next
                                    
    End If
                                                            
    max_gf = max_load(test_times_cont)
    M_max_gf = M_max_load(test_times_cont)
        
End Sub
Attribute VB_Name = "first_frm_fgt"
Attribute VB_Base = "0{853056F5-EF71-41A9-9D83-C8D2E8AD4334}{2A7D6728-5505-4506-A8FF-B49765EFD02F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit

'**********************
'   Cancel|fffd|{|fffd|^|fffd||fffd||fffd||fffd||fffd||fffd|
'   |fffd||fffd||fffd||fffd||fffd|@|fffd|F|fffd||202||fffd|
'   |fffd||7c2||fffd|l|fffd|F|fffd||202||fffd|
'**********************
Private Sub Cancel_btn_Click()
    'c_first_frm_flg = 0
    first_frm_fgt_open_flg = False
    first_frm_fgt.Hide
    Unload first_frm_fgt
'    Unload first_frm_TNP
End Sub

'**********************
'   OK|fffd|{|fffd|^|fffd||fffd||fffd||fffd||fffd||fffd|
'   |fffd||fffd||fffd||fffd||fffd|@|fffd|F|fffd||202||fffd|
'   |fffd||7c2||fffd|l|fffd|F|fffd||202||fffd|
'**********************
Private Sub Ok_btn_Click()
    'Dim dummy As Long
    'first_btn_false
    'c_first_frm_flg = 1
    'first_frm_flg = 1
    'stop_btn_push_flg = False       ' STOP|fffd|{|fffd|^|fffd||fffd||fffd||356||fffd||fffd||fffd||fffd||fffd||fffd||fffd||502||182||fffd||fffd||fffd|
    ' COM|fffd|||fffd|[|fffd|g|fffd||50d||fffd||fffd|I|fffd||fffd|
    
    Dim strFileName As String
    Dim intFileNo As Integer
    Dim strData As String
    
    Dim fs As Object
    Dim aa As Object
    
    Dim com_port_num1 As Integer
 
    mae_cell_flg = False
    Select Case Trim(Com_box.Text)
        Case "COM1" 'Or "|fffd||fffd|COM1"
            com_port_num = 0
        Case "*COM1"
            com_port_num = 0
            
        Case "COM2" 'Or "|fffd||fffd|COM2"
            com_port_num = 1
        Case "*COM2"
            com_port_num = 1
            
        Case "COM3" 'Or "|fffd||fffd|COM3"
            com_port_num = 2
        Case "*COM3"
            com_port_num = 2
            
        Case "COM4" 'Or "|fffd||fffd|COM4"
            com_port_num = 3
        Case "*COM4"
            com_port_num = 3
            
        Case "COM5" 'Or "|fffd||fffd|COM5"
            com_port_num = 4
        Case "*COM5"
            com_port_num = 4
            
        Case "COM6" 'Or "|fffd||fffd|COM6"
            com_port_num = 5
        Case "*COM6"
            com_port_num = 5
            
        Case "COM7" 'Or "|fffd||fffd|COM7"
            com_port_num = 6
        Case "*COM7"
            com_port_num = 6
            
        Case "COM8" 'Or "|fffd||fffd|COM8"
            com_port_num = 7
        Case "*COM8"
            com_port_num = 7
            
        Case "COM9" 'Or "|fffd||fffd|COM9"
            com_port_num = 8
        Case "*COM9"
            com_port_num = 8
            
        Case "COM10" 'Or "|fffd||fffd|COM10"
            com_port_num = 9
        Case "*COM10"
            com_port_num = 9
            
        Case "COM11" 'Or "|fffd||fffd|COM11"
            com_port_num = 10
        Case "*COM11"
            com_port_num = 10
            
        Case "COM12" 'Or "|fffd||fffd|COM12"
            com_port_num = 11
        Case "*COM12"
            com_port_num = 11
            
        Case "COM13" 'Or "|fffd||fffd|COM13"
            com_port_num = 12
        Case "*COM13"
            com_port_num = 12
            
        Case "COM14" 'Or "|fffd||fffd|COM14"
            com_port_num = 13
        Case "*COM14"
            com_port_num = 13
            
        Case "COM15" 'Or "|fffd||fffd|COM15"
            com_port_num = 14
        Case "*COM15"
            com_port_num = 14
            
    End Select
    
    '|fffd||290|M|fffd|||fffd|[|fffd|g|fffd|I|fffd||fffd||fffd||30a|m|fffd|F
    If comm_mdl_e.comm_init_proc Then                           '|fffd||290|M|fffd|||fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
        UserForm_Initialize
        Com_box.ListIndex = com_port_num
        Exit Sub                                                '|fffd|G|fffd||fffd||fffd|[|fffd||202||727d||fffd||fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|
    End If
    
    '**************
    '|fffd||fffd||fffd||fffd||fffd||fffd||282||310||752||80aa||fffd|O|fffd||fffd||188||642||202||fffd||a347||fffd|Afgt-vc|fffd|t|fffd|@|fffd|C|fffd||fffd||fffd||24c||fffd||fffd||752||fffd||fffd||6d1||fffd|
    '**************
    
'NSCA_V104
    no_folder = FGT_VC_D
'else
    'no_folder = "C:\Program Files\FGT-VC"
'endif
   
   
    If file_folda(no_folder) = False Then                       'SM|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||202||fffd||fffd||fffd||38d||c42c|
        MkDir no_folder
    End If
    
'NSCA_V104
    strFileName = FGT_VC_D & INI_FILE
'else
    'strFileName = "C:\Program Files\FGT-VC\fgt-vc.ini"
'endif

    
    
    '|fffd||d3dc||fffd||fffd||fffd||fffd||fffd||a347||fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd|B
    
    
'NSCA_V104
    If Dir(strFileName) <> INI_FILE_NAME Then
'else
    'If Dir(strFileName) <> "fgt-vc.ini" Then
'endif
    
        Com_box.ListIndex = com_port_num
        Set fs = CreateObject("Scripting.FileSystemObject")
        
'NSCA_V104
        Set aa = fs.CreateTextFile(FGT_VC_D & INI_FILE, True)
'else
        'Set aa = fs.CreateTextFile("C:\Program Files\FGT-VC\fgt-vc.ini", True)

'endif
        
        aa.Close
        intFileNo = FreeFile
        Open strFileName For Output As #intFileNo
        Print #intFileNo, com_port_num
        Close intFileNo
    Else
        intFileNo = FreeFile
        Open strFileName For Input As #intFileNo
        Line Input #intFileNo, strData
        Close intFileNo
        If strData = "" Then
            strData = Com_box.ListIndex
            Open strFileName For Output As #intFileNo
            Print #intFileNo, strData
            Close intFileNo
        End If
        com_port_num1 = Val(strData)
        If com_port_num <> com_port_num1 Then
            Open strFileName For Output As #intFileNo
            Print #intFileNo, com_port_num      '|fffd||33d1||fffd||fffd||fffd||fffd||fffd||1c2||fffd||fffd||fffd||fffd|A|fffd|m|fffd|F|fffd|K|fffd|v|fffd|@|fffd||fffd|OK
            Close intFileNo
        End If
        'Close intFileNo
        'Com_box.ListIndex = Val(strData)
    End If
    '**************
    
    
    
    'hWndMe = FindWindow(USERFORM_CLASSNAME, Me.Caption)         '|fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd||242||10e|g|fffd|p
    
    'timer_mdl_e.hWnd = hWndMe                                   'UserForm|fffd||fffd|hWnd|fffd||752||fffd|
    'timer_mdl_e.TimerId = 1                                     '|fffd|^|fffd|C|fffd|}ID|fffd||752||fffd|
    'timer_mdl_e.TimerInterval = K_TIMER                         '|fffd|^|fffd|C|fffd|}|fffd||50a|u|fffd||752||fffd|
    
    '|fffd||691||fffd||fffd|m|fffd|F
    comm_mdl_e.cmd_send_proc (TBC)                              'TBC|fffd|R|fffd|}|fffd||fffd||fffd|h(|fffd||691||fffd||fffd|R|fffd|}|fffd||fffd||fffd|h)|fffd||fffd||fffd|M
    comm_mdl_e.cmd_receive_proc
    If comm_mdl_e.send_comp(TBC) = False Then
        dummy_handle = CloseHandle(hComm)
        Exit Sub
    End If
    If SER_flg = True Then
    
        SER_flg = False
        UserForm_Initialize
        Exit Sub
    End If

    '|fffd|||fffd|[|fffd|g|fffd||752||fffd|t|fffd||fffd||fffd|[|fffd||fffd||fffd||fffd||fffd|B|fffd||fffd|
    first_frm_fgt.Hide
    Unload first_frm_fgt
    'first_frm_flg = False
'    Unload first_frm_TNP
    'main_frm_fgt.Show vbModeless
    main_frm_fgt.Show
    
End Sub

Private Sub UserForm_Activate()
    first_frm_fgt_open_flg = True
End Sub


'**********************
'   |fffd||fffd||fffd|[|fffd|U|fffd|[|fffd|t|fffd|H|fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'   |fffd||fffd||fffd||fffd||fffd|@|fffd|F|fffd||202||fffd|
'   |fffd||7c2||fffd|l|fffd|F|fffd||202||fffd|
'**********************
Private Sub UserForm_Initialize()
    Dim ii As Integer
    Dim name_com0 As String
    Dim name_com1 As String
    Dim com_port As String
    Dim strFileName As String
    Dim intFileNo As Integer
    Dim strData As String
    
    Dim fs As Object
    Dim aa As Object
    Com_box.Clear
    Do
        ii = ii + 1
        If ii <= 15 Then
            name_com0 = "COM" & ii
            comname = "\\.\" & name_com0
            hComm = CreateFile(comname, GENERIC_READ Or GENERIC_WRITE, 0, 0, OPEN_EXISTING, 0, 0)       '|fffd|||fffd|[|fffd|g|fffd||303|I|fffd|[|fffd|v|fffd||fffd|
            If hComm = -1 Then
                If ii < 10 Then
                    name_com1 = "      " & name_com0 & "   "
                Else
                    name_com1 = "      " & name_com0 & "   "
                End If
            Else
                If ii < 10 Then
                    name_com1 = "    *" & name_com0 & "   "
                Else
                    name_com1 = "    *" & name_com0 & "   "
                End If
                CloseHandle (hComm)
            End If
            Com_box.AddItem name_com1
        Else
            Exit Do
        End If
    Loop
    Com_box.ListIndex = 0
    
    'On Error Resume Next
    On Error Resume Next
    '********
    '|fffd||fffd||fffd||fffd||fffd||752||fffd||341|Afgt-vc|fffd|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd||fffd||1c2||74d||fffd||fffd||fffd|
    '********
    
'NSCA_V104
    no_folder = FGT_VC_D
'else
    'no_folder = "C:\Program Files\FGT-VC"
'endif
    
    If file_folda(no_folder) = False Then                       'SM|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||202||fffd||fffd||fffd||38d||c42c|
        MkDir no_folder
    End If
    
'NSCA_V104
    strFileName = FGT_VC_D & INI_FILE
'else
    'strFileName = "C:\Program Files\FGT-VC\fgt-vc.ini"
'endif
    
'NSCA_V104
    If Dir(strFileName) <> INI_FILE_NAME Then
'else
    'If Dir(strFileName) <> "fgt-vc.ini" Then
'endif
        
        Com_box.ListIndex = com_port_num
        Set fs = CreateObject("Scripting.FileSystemObject")
        
'NSCA_V104
        Set aa = fs.CreateTextFile(FGT_VC_D & INI_FILE, True)
'else
        'Set aa = fs.CreateTextFile( "C:\Program Files\FGT-VC\fgt-vc.ini", True)
'endif


        aa.Close
        intFileNo = FreeFile
        Open strFileName For Output As #intFileNo
        Print #intFileNo, com_port_num
        Close intFileNo

    Else
        intFileNo = FreeFile
        Open strFileName For Input As #intFileNo
        Line Input #intFileNo, strData
        Close intFileNo
        If strData = "" Then
            strData = Com_box.ListIndex
            Open strFileName For Output As #intFileNo
            Print #intFileNo, strData
            Close intFileNo
        End If
        
        Com_box.ListIndex = Val(strData)
    End If
    
   
    '********
End Sub

'**********************
'   |fffd||fffd||fffd|[|fffd|U|fffd|[|fffd|t|fffd|H|fffd|[|fffd||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd|[|fffd|h
'   |fffd||fffd||fffd||fffd||fffd|@|fffd|FCancel      0 |fffd||20a|O|fffd||312|l|fffd||fffd||752||80b7||fffd||fffd||181|A|fffd||1c2||74d||fffd||fffd||702||fffd||102||fffd||fffd||90b7||fffd||5c2||102||303||fffd||fffd|[|fffd|U|fffd|[
'                       |fffd|t|fffd|H|fffd|[|fffd||fffd||fffd||fffd| QueryClose |fffd|C|fffd|x|fffd||fffd||fffd|g|fffd||fffd||fffd|~|fffd||fffd||fffd|A|fffd||fffd||fffd|[|fffd|U|fffd|[ |fffd|t|fffd|H|fffd|[|fffd||fffd||fffd||fffd|
'                       |fffd|A|fffd|v|fffd||fffd||fffd|P|fffd|[|fffd|V|fffd||fffd||fffd||fffd||fffd||fffd||82||fffd||fffd||202||fffd||fffd||60a4||fffd||242||fffd||fffd||702||fffd|
'           CloseMode   QueryClose |fffd|C|fffd|x|fffd||fffd||fffd|g|fffd||314||fffd||fffd||fffd||fffd||fffd||fffd|R|fffd||fffd|\|fffd||fffd|
'   |fffd||7c2||fffd|l|fffd|F|fffd||202||fffd|
'**********************
Public Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    Dim bRet As Boolean
    Dim dummy As Long
    
    dummy = CloseHandle(hComm)
    'hComm = -1
    'c_first_frm_flg = 0
    Unload first_frm_fgt
    first_frm_fgt_open_flg = False
    
End Sub

'|fffd|A|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||30e||fffd|M|fffd||fffd|MEM|fffd|L|fffd|[|fffd|f|fffd|[|fffd|^|fffd||30e||fffd|M|fffd||fffd||fffd||241|A|fffd|^|fffd|C|fffd|}|fffd||150||fffd||fffd||40b5||fffd||702||fffd||fffd|B
'|fffd||457|l|fffd||fffd||fffd||102||fffd||fffd||702||fffd||fffd|B
'Public Sub OnTimer()
    
'    timer_mdl_e.TimerInterval = 0         ' |fffd|^|fffd|C|fffd|}disable
'    comm_mdl_e.cmd_receive_proc           ' |fffd|||fffd|e|fffd|g|fffd|Q|fffd|[|fffd|W|fffd|{|fffd||302||fffd||fffd||fffd||303|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd|M|fffd||fffd||fffd||fffd|
'    If timer_mdl_e.m_Timer_disable_flg = False Then
'        timer_mdl_e.TimerInterval = K_TIMER   ' |fffd|^|fffd|C|fffd|}enable
'    End If
'End Sub
Attribute VB_Name = "graph_mdl_e"
Option Explicit



Public graph_frm_lbl(3, 9) As String        ' AT_graph_frm |fffd|O|fffd||fffd||fffd|t|fffd|t|fffd|H|fffd|[|fffd||fffd||fffd|p
Public graph_frm_cell(3, 41) As String      ' |fffd|O|fffd||fffd||fffd|t|fffd|V|fffd|[|fffd|g|fffd|o|fffd||357|p
Public graph_frm_mes(3, 11) As String       ' message|fffd|p


Public Const MAX_PILE_UP = 10               '|fffd||fffd|MAX|fffd|d|fffd||2cd||fffd||fffd||d0b9||fffd||fffd|
Public Const MID_SHEET_2 = "TV"             '|fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||14f||fffd||fffd||fffd|2|fffd||fffd||fffd||fffd|
Public Const MAX_TEST_TYPE = 1              '|fffd||fffd|e|fffd|X|fffd|g|fffd||fffd||790||fffd|
'Public Const DATA_START_CELL = 30           '|fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||318|A|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||fffd|n|fffd||7c2||303|Z|fffd||fffd|
Public Const GRAPH_SHEET_NAME = "GRAPH0"    '|fffd||fffd|O|fffd||fffd||fffd|t|fffd|V|fffd|[|fffd|g|fffd||316||fffd||fffd|O
Public Const MK_GRAPH_SHEET_FLG = True      '|fffd||fffd||fffd|V|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd|t|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||9068|TRUE|fffd|@|fffd||fffd||fffd||fffd||fffd||303|V|fffd|[|fffd|g|fffd||24f||33d1||fffd||fffd||fffd||fffd|FALSE
Public Const SHEET_UNIT_Y = 6               '|fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||312|P|fffd||295|\|fffd||fffd||fffd||fffd||fffd|@Y|fffd||fffd||fffd|W
Public Const SHEET_UNIT_X = 2               '|fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||312|P|fffd||295|\|fffd||fffd||fffd||fffd||fffd|@X|fffd||fffd||fffd|W
Public Const G_CONT_Y = 27                  '|fffd||fffd|O|fffd||fffd||fffd|t|fffd|V|fffd|[|fffd|g|fffd|@|fffd|A|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||fffd|n|fffd||fffd|Y|fffd||fffd||fffd|W
Public Const G_CONT_X = 8                   '|fffd||fffd|O|fffd||fffd||fffd|t|fffd|V|fffd|[|fffd|g|fffd|@|fffd|A|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||fffd|n|fffd||fffd|X|fffd||fffd||fffd|W

Public Const G_CHA = 53
Public Const G_AKA = 3
Public Const G_DAIDAI = 46
Public Const G_KIRO = 44
Public Const G_MIDORI = 10
Public Const G_AO = 5
Public Const G_MURASAKI = 13
Public Const G_HAI = 48
Public Const G_MOMO = 7
Public Const G_KURO = 1

Public Const G_JAPANESE = 0
Public Const G_ENGLISH = 1
Public Const G_CHAINESE = 2

Public Const G_CAP_GRAPH = 0
Public Const G_CAP_SHEET_CHOICE = 1
Public Const G_CAP_MAKE_SHEET = 2
Public Const G_CAP_CANCEL = 3
Public Const G_CAP_GRAPH_KSN = 4
Public Const G_CAP_PREVIEW = 5
Public Const G_TITLE = 6
Public Const G_REMARKS = 7
Public Const G_REMARKS_INPUT = 8

Public Const G_TEST_MODE = 0
Public Const G_CELL_ANGLE_TEST = 1
Public Const G_CELL_TORQUE_TEST = 2
Public Const G_CELL_BREAK_TEST = 3
Public Const G_CELL_GRAPH_KSN_SHEET = 4
Public Const G_CELL_TYPE = 5
Public Const G_CELL_UNIT = 6
Public Const G_CELL_T_SHEET = 7
Public Const G_CELL_TEST_DATE = 8
Public Const G_SAMPLING_RATE = 9
Public Const G_RAMP_TIME = 10
Public Const G_ROTATION_DIRECTION = 11
Public Const G_ROTATION_SPEED = 12
Public Const G_ROTATION_ANGLE = 13
Public Const G_MAX_ROTATION_ANGLE = 14
Public Const G_DETECTION_TORQUE = 15
Public Const G_DETECTION_TORQUE_M = 16
Public Const G_DETECTION_TORQUE_CM = 17
Public Const G_DETECTION_TORQUE_MM = 18
Public Const G_RATE_OF_SECOND = 19
Public Const G_RATE_OF_CHANGE = 20
Public Const G_BREAK_DETECTION = 21
Public Const G_IGNORE_ZONE = 22
Public Const G_CELL_MAX_TORQUE = 23
Public Const G_CELL_MAX_TORQUE_M = 24
Public Const G_CELL_MAX_TORQUE_CM = 25
Public Const G_CELL_MAX_TORQUE_MM = 26
Public Const G_CELL_MAX_T_ANGLE = 27
Public Const G_CELL_BREAK_TORQUE = 28
Public Const G_CELL_BREAK_TORQUE_M = 29
Public Const G_CELL_BREAK_TORQUE_CM = 30
Public Const G_CELL_BREAK_TORQUE_MM = 31
Public Const G_CELL_BREAK_T_ANGLE = 32
Public Const G_CELL_ANGLE = 33
Public Const G_CELL_TORQUE = 34
Public Const T_10_second = 35
Public Const T_20_second = 36
Public Const T_50_second = 37
Public Const T_100_second = 38
Public Const KSN_OPEN = 39
Public Const KSN_CLOSE = 40
Public Const G_MODEL = 0
Public Const G_MODEL_2 = 1
Public Const G_UNIT = 2
Public Const G_UNIT_2 = 3
Public Const G_SHEET = 4
Public Const G_SHEET_2 = 5
Public Const NO_DATA = 6
Public Const NO_DATA_2 = 7
Public Const NO_SHEET = 8
Public Const P_SHEET_SELECT = 9
Public Const CANT_S_SHEET = 10
Public test_list(MAX_TEST_TYPE + 1, 256) As String
Public get_sheet_num(MAX_TEST_TYPE + 1) As Integer

Public g_data_num(MAX_PILE_UP + 1) As Long
Public g_keiretu_name(MAX_PILE_UP + 1) As String
Public g_Sheet_name(MAX_PILE_UP + 1) As String

Public ksn_Max_Torque(MAX_TEST_TYPE + 1) As String
Public ksn_Max_T_Angle(MAX_TEST_TYPE + 1) As String

Public Date_Time(MAX_TEST_TYPE + 1) As String
Public ksn_g_title As String
Public ksn_g_remarks As String
Public ksn_g_test_mode As Integer
Public ksn_sampling_rate(MAX_TEST_TYPE + 1) As String
Public ksn_ramp_rate(MAX_TEST_TYPE + 1) As String
Public ksn_r_direction(MAX_TEST_TYPE + 1) As String
Public ksn_r_speed(MAX_TEST_TYPE + 1) As String
Public ksn_r_angle(MAX_TEST_TYPE + 1) As String
Public ksn_detection_t(MAX_TEST_TYPE + 1) As String
Public ksn_second_rate(MAX_TEST_TYPE + 1) As String
Public ksn_change_rate(MAX_TEST_TYPE + 1) As String
Public ksn_b_detection(MAX_TEST_TYPE + 1) As String
Public ksn_b_ignore(MAX_TEST_TYPE + 1) As String
Public format_err_flg As Boolean        'false =|fffd||64f||fffd||202||fffd||fffd|@true=|fffd|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g|fffd||64f||fffd|

Public ksn_unit(MAX_TEST_TYPE + 1) As String
Public ksn_model(MAX_TEST_TYPE + 1) As String

Attribute VB_Name = "main_frm_fgt"
Attribute VB_Base = "0{D3F3B9CA-1E24-4891-8B0C-226A126C5B2C}{BB6DAD06-602D-4ECB-8175-E00818935EE6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Public unit_name As String          '|fffd|P|fffd||296||fffd|
Public torikomikankaku As String    '|fffd||635e||fffd||50a|u
Public blank_check_flg As Boolean

Private Sub CheckBox_AbsValue_Change()

'#If USA = 1 Then
    
    If CheckBox_AbsValue.Value = True Then
        Frame91.Enabled = False
        Label409.Enabled = False
        M_TextBox_MAX_limit.Enabled = False
        M_TextBox_MIN_limit.Enabled = False
        Label406.Enabled = False
        Label407.Enabled = False
        
    Else
        Frame91.Enabled = True
        Label409.Enabled = True
        M_TextBox_MAX_limit.Enabled = True
        M_TextBox_MIN_limit.Enabled = True
        Label406.Enabled = True
        Label407.Enabled = True
    
    End If

'#End If

End Sub

Private Sub CheckBox_AbsValue_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    
    If KeyCode = vbKeyDown Then
        CheckBox_Distance.SetFocus
    End If
    
End Sub

Private Sub CheckBox_Distance_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    
    If KeyCode = vbKeyDown Then
        TextBox_MAX_limit.SetFocus
    ElseIf KeyCode = vbKeyUp Then
        CheckBox_AbsValue.SetFocus
    End If
    
End Sub

Private Sub CheckBox1_Click()
    
    If CheckBox1.Value = True Then
        graph_on_flg = True
        CellSelect_lbl.Enabled = False
        CmdBtn_CellSelect.Enabled = False
        
        If Val(TextBox_sample_num.Text) > 250 Then                                              '|fffd|`|fffd|F|fffd|b|fffd|N|fffd|{|fffd|b|fffd|N|fffd|X|fffd||311|I|fffd||fffd||fffd||341|A|fffd|J|fffd||502||fffd||fffd||50502||fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd||313||fffd||fffd||34c||fffd||182||202||fffd||fffd||fffd||fffd||fffd|
            MsgBox MES28 & 0 & MES27 & 250 & " for Sampling Number.", vbExclamation, OBI_STR    'MsgBox "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd|l|fffd||fffd|" & 0 & MES27 & 250 & MES28, vbExclamation, OBI_STR
            TextBox_sample_num.Text = 0
            Exit Sub
        End If
                
    ElseIf CheckBox1.Value = False Then
        graph_on_flg = False
        CellSelect_lbl.Enabled = True
        CmdBtn_CellSelect.Enabled = True
    
    End If

End Sub

Private Sub CmdBtn_CellSelect_Click()
 
    Dim buf As Range
    Dim ref_bb As String
    Dim cell As String
    Dim def As Variant
    Dim ref_sheet_name As String
    
    ref_bb = ""
    main_frm_fgt.Hide
    
    If CellSelect_lbl.Caption <> "" Then
        cell = CellSelect_lbl.Caption
        def = Application.ConvertFormula(Formula:=cell, fromReferenceStyle:=xlA1, toReferenceStyle:=xlA1, ToAbsolute:=xlAbsolute)
    Else
        def = ""
    End If
    
    On Error Resume Next
    
    Set buf = Application.InputBox(Prompt:="Input the cell position.", Type:=8, title:="Setting Cell Position Menu", Default:=def)
    ref_sheet_name = buf.Worksheet.name
    
    If ref_sheet_name <> "" Then
        
        If Left(ref_sheet_name, 3) = "VC-" And buf.Worksheet.Cells(1, 1).Cells(1, 1) = "Date" Then
            MsgBox "The test datas can not be filled in the sheet of " & ref_sheet_name & ".", vbExclamation, OBI_STR       'MsgBox ref_sheet_name & "|fffd||241|A|fffd|v|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||1cb|L|fffd||fffd||fffd||90b1||fffd||182||34f|o|fffd||fffd||fffd||702||fffd||fffd||fffd|B", vbExclamation, OBI_STR
            main_frm_fgt.Show
            Exit Sub
            
        ElseIf Left(ref_sheet_name, 4) = "MAX-" And buf.Worksheet.Cells(1, 1).Cells(1, 1) = "Date" Then
            MsgBox "The test datas can not be filled in the sheet of " & ref_sheet_name & ".", vbExclamation, OBI_STR       'MsgBox ref_sheet_name & "|fffd||241|A|fffd|v|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||1cb|L|fffd||fffd||fffd||90b1||fffd||182||34f|o|fffd||fffd||fffd||702||fffd||fffd||fffd|B", vbExclamation, OBI_STR
            main_frm_fgt.Show
            Exit Sub
        
        End If
    
    End If
    
    ref_bb = buf.Address(0, 0)
    
    If ref_bb = "" And def <> "" Then
        ref_bb = Application.ConvertFormula(Formula:=def, fromReferenceStyle:=xlA1, toReferenceStyle:=xlA1, ToAbsolute:=xlRelative)
    End If
    
    main_frm_fgt.CellSelect_lbl.Caption = ref_bb
    
    buf.Worksheet.Activate
    buf.Worksheet.Range(main_frm_fgt.CellSelect_lbl.Caption).Select
    s_row = ActiveCell.row                                  '|fffd|J|fffd|n|fffd||292|u|fffd|Z|fffd||fffd| |fffd|s
    s_col = ActiveCell.Column                               '|fffd|J|fffd|n|fffd||292|u|fffd|Z|fffd||fffd| |fffd||fffd|
    
    main_frm_fgt.Show
End Sub

Private Sub CmdBtn_CellSelect_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Or KeyCode = vbKeyTab Then
        CmdBtn_Push.SetFocus
    ElseIf KeyCode = vbKeyUp Then
        Comdbtn_Peak_reset.SetFocus
    End If
End Sub

Private Sub CmdBtn_Pull_Click()
    Dim i As Integer
    Dim intRet As Variant
    Dim row
    
    l_buf_c_rx_ctn = ""
    
    CmdBtn_Push.Enabled = False
    Enabled_False
    
    For i = 0 To 9999
        off_cel(i) = ""
        C_P_aru_flg(i) = False
    Next
    
    main_stop_flg = False
    data_cnt = 0
    array_initialize
    delete_sheet_flg = False
    test_flg = True
    test_direction_num = 1
    stop_end_flg = False
    data_end_flg = True                 '|fffd|O|fffd||fffd||fffd|tON|fffd||fffd||fffd||302||74e|g|fffd||fffd|
    SER_flg = False
    C_P_max_make_flg = False
    test_start_direction = "PULL"
    set_flg_check                       '|fffd|O|fffd||fffd||fffd|t|fffd|t|fffd||fffd||fffd|O|fffd|A|fffd||fffd||392|l|fffd|t|fffd||fffd||fffd|O|fffd|A|fffd||fffd||fffd||fffd||fffd||3ce|Z|fffd|t|fffd||fffd||fffd|O|fffd||30e||64fe|
    
    If CellSelect_lbl.Caption <> "" Then
        mae_cell_flg = True
    End If
    
    If TextBox_MAX_limit.Text = "" Then
        TextBox_MAX_limit.Text = "0"
    End If
    
    If TextBox_MIN_limit.Text = "" Then
        TextBox_MIN_limit.Text = "0"
    End If
    
'if USA
    If M_TextBox_MAX_limit.Text = "" Then
        M_TextBox_MAX_limit.Text = "0"
    End If
    
    If M_TextBox_MIN_limit.Text = "" Then
        M_TextBox_MIN_limit.Text = "0"
    End If
'endif
                  
    If comm_mdl_e.comm_init_proc Then                       ' |fffd||290|M|fffd|||fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
        Enabled_True
        communication_error
        Exit Sub                                            '|fffd|G|fffd||fffd||fffd|[|fffd||202||727d||fffd||fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|
    End If

    comm_mdl_e.cmd_send_proc (TBC)                          '|fffd|^|fffd||fffd||fffd||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TBC) = False Then
        Enabled_True
        communication_error
        Exit Sub
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    End If

    comm_mdl_e.cmd_send_proc (TBD)                          '|fffd|\|fffd||fffd||fffd|P|fffd||28e||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TBD) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If







'#If NSCA_V103 = 1 Then
    comm_mdl_e.cmd_send_proc (TBE)                          '|fffd||fffd||fffd||fffd||fffd|P|fffd||28e||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TBE) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If

'#End If





    comm_mdl_e.cmd_send_proc (SSD)                          '|fffd||fffd||fffd||c0c2||fffd|[|fffd|h|fffd||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(SSD) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If
    
    If test_mode_num = 1 Or test_mode_num = 9 Then
        MsgBox "The command can not be executed, please check the mode of stand.", vbExclamation, OBI_STR   'MsgBox "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd||fffd|s|fffd||142||fffd||fffd||702||fffd||fffd||fffd|B|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd||303||fffd||fffd|[|fffd|h|fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B", vbExclamation, OBI_STR
        Enabled_True
        Exit Sub
    
    End If
    
    blank_check         '|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd||18c|J|fffd||502||fffd||fffd||50502||30b||d74c3|`|fffd|F|fffd|b|fffd|N
    
    If blank_check_flg = False Then
        Enabled_True
        Exit Sub
    End If
    
    If Val(TextBox_kurikaishikaisu.Text) < Val(TextBox_sample_num.Text) Then
        MsgBox MES67, vbExclamation, OBI_STR
        Enabled_True
        Exit Sub
    End If
    
    input_type_set
    limit_chk   '|fffd||327a||fffd||fffd||fffd|l|fffd||fffd||fffd||343|`|fffd|F|fffd|b|fffd|N
        
    If limit_chk_flg = 2 Then
        MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Limit value.", vbExclamation, OBI_STR  'MsgBox "|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
        TextBox_MAX_limit.Text = 0
        TextBox_MIN_limit.Text = 0
        Enabled_True
        Exit Sub
    
    ElseIf limit_chk_flg = 3 Then
        MsgBox MES66, vbExclamation, OBI_STR
        TextBox_MAX_limit.Text = 0
        TextBox_MIN_limit.Text = 0
        test_flg = False
        Enabled_True
        Exit Sub
    
    ElseIf limit_chk_flg = 1 Then
        
        limit_chk_text = "Invalid"  'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
    
    End If
    

'if USA
    If M_limit_chk_flg = 2 Then
        MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Limit value.", vbExclamation, OBI_STR  'MsgBox "|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
        M_TextBox_MAX_limit.Text = 0
        M_TextBox_MIN_limit.Text = 0
        Enabled_True
        Exit Sub
    
    ElseIf M_limit_chk_flg = 3 Then
        MsgBox MES66, vbExclamation, OBI_STR
        M_TextBox_MAX_limit.Text = 0
        M_TextBox_MIN_limit.Text = 0
        test_flg = False
        Enabled_True
        Exit Sub
    
    ElseIf M_limit_chk_flg = 1 Then
        M_limit_chk_text = "Invalid"  'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
    
    End If
'endif
    
    If test_mode_num = 3 Or test_mode_num = 4 Then
        test_torikomikaisu              '|fffd||635e||fffd||5050e||64fe|
        
        comm_mdl_e.cmd_send_proc (SAI)  '|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd|{|fffd||302||310||752||fffd|l|fffd||313||1cf|o|fffd||fffd||fffd||183|\|fffd|t|fffd|g|fffd||310||752||fffd|l|fffd||fffd|r                         'goto debug mode for read stand's setting times
        comm_mdl_e.cmd_receive_proc
        
        If comm_mdl_e.send_comp(SAI) = False Then
            Enabled_True
            communication_error
            Exit Sub
        End If
        
        If SER_flg = True Then
            Enabled_True
            Exit Sub
        End If

        If test_mode_num = 4 Then
            comm_mdl_e.cmd_send_proc (DPAR)                          'read stand's setting times
            comm_mdl_e.cmd_receive_proc
            
            If comm_mdl_e.send_comp(DPAR) = False Then
                Enabled_True
                communication_error
                Exit Sub
            End If
            
            If SER_flg = True Then
                Enabled_True
                Exit Sub
            End If
            
        ElseIf test_mode_num = 3 Then
            comm_mdl_e.cmd_send_proc (DCR)                          'read stand's setting times
            comm_mdl_e.cmd_receive_proc
            
            If comm_mdl_e.send_comp(DCR) = False Then
                Enabled_True
                communication_error
                Exit Sub
            End If
            
            If SER_flg = True Then
                Enabled_True
                Exit Sub
            End If

        End If
        
        comm_mdl_e.cmd_send_proc (SAJ)                          'move out from debug mode
        comm_mdl_e.cmd_receive_proc
        
        If comm_mdl_e.send_comp(SAJ) = False Then
            Enabled_True
            communication_error
            Exit Sub
        End If
        
        If SER_flg = True Then
            Enabled_True
            Exit Sub
        End If
        
        If test_times_stand < cont_num Then
            If test_times_stand <> 0 Then
                intRet = MsgBox("The Repeat Count exceeds number(" & test_times_stand & "times) that is setted by Test Stand. Do you want to continue?", vbYesNo + vbQuestion, OBI_STR) 'intRet = MsgBox("|fffd|J|fffd||502||fffd||fffd||50502||fffd||fffd|{|fffd||310||752||8486||fffd||30c|J|fffd||502||fffd||fffd||fffd|(" & test_times_stand & ")|fffd||12d02||fffd||fffd||102||fffd||fffd||702||fffd||fffd|B|fffd||fffd||fffd|s|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|H", vbYesNo + vbQuestion, OBI_STR)
                
                If intRet = vbYes Then                                  'Yes |fffd||fffd||fffd|s
                    cont_num = test_times_stand
                Else                                                    'No  |fffd|I|fffd||fffd|
                    Enabled_True
                    Exit Sub
                End If
                
            Else: test_times_stand = 0
                
            End If
        End If
    End If
   
   
    '*********************************************************************
    
    
    If test_mode_num = 3 Or test_mode_num = 4 Then                      'CONT|fffd||fffd||fffd|[|fffd|h|fffd|APROG|fffd||fffd||fffd|[|fffd|h|fffd||242||109||fffd||fffd||fffd||fffd||682||303|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||90a9||fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||702||fffd||fffd|B
        sample_flg_set
    End If
    
    newbook_create                                                      '|fffd||fffd||fffd||742||303|V|fffd|[|fffd|g|fffd||fffd|+|fffd||fffd||fffd||fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd|256|fffd||a347||fffd|A|fffd|V|fffd|K|fffd|u|fffd|b|fffd|N|fffd||c42c|
    
    If test_mode_num = 0 Or test_mode_num = 2 Or test_mode_num = 3 Or test_mode_num = 4 Then
        comm_mdl_e.cmd_send_proc (SAA)                                  'LCD|fffd||255|\|fffd||fffd||fffd||fffd||fffd||102||fffd||fffd||fffd||50502||fffd||fffd|N|fffd||fffd||fffd|A
        comm_mdl_e.cmd_receive_proc
        
        If comm_mdl_e.send_comp(SAA) = False Then
            Enabled_True
            communication_error
            Exit Sub
        End If
        
        If SER_flg = True Then
            Enabled_True
            Exit Sub
        End If
        
    End If
    
    If graph_on_flg = True Then
        
        If data_end_flg = True Then
            outp_mdl_e.Sheet_move
            outp_mdl_e.st_header
        End If
    
    ElseIf ma_si_colend_flg = True Then
        
        row = ActiveCell.row
        outp_mdl_e.Sheet_move
        ActiveSheet.Cells(row, 1).Activate
    
    End If
       
    comm_mdl_e.cmd_send_proc (SSA)              '|fffd||fffd||fffd||fffd||fffd|J|fffd|n
    CmdBtn_stop.Enabled = True                  '|fffd||fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||302||757|L|fffd||fffd||fffd|@|fffd||fffd||fffd||fffd||fffd|J|fffd|n|fffd||fffd||fffd||fffd|ASTOP|fffd|{|fffd|^|fffd||fffd||fffd|L|fffd||fffd||fffd||242||fffd||fffd||fffd|B
    CmdBtn_stop.SetFocus
    
    comm_mdl_e.cmd_receive_proc                 '------------|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||fffd||fffd||fffd||fffd||fffd||fffd|K|fffd|v|fffd|i0217|fffd||112||fffd||fffd||fffd||fffd|j
    
    If SER_flg = True Or test_flg = False Then
        Exit Sub
    End If
    
    If comm_mdl_e.send_comp(SSA) = False Then
        Enabled_True
        communication_error
        Exit Sub
    End If
    
    hWndMe = FindWindow(USERFORM_CLASSNAME, Me.Caption) ' |fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd||242||10e|g|fffd|p
    timer_mdl_e.hWnd = hWndMe                           ' UserForm|fffd||fffd|hWnd|fffd||752||fffd|
    timer_mdl_e.TimerId = 1                             '   |fffd|^|fffd|C|fffd|}ID|fffd||752||fffd|
    timer_mdl_e.m_Timer_disable_flg = False
    timer_mdl_e.TimerInterval = K_TIMER                 '   |fffd|^|fffd|C|fffd|}|fffd||50a|u|fffd||752||fffd|
    
End Sub

Private Sub CmdBtn_Pull_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyUp Then
        CmdBtn_Push.SetFocus
    ElseIf KeyCode = vbKeyDown Then
        ComboBox_torikomikankaku.SetFocus
    End If
End Sub

Private Sub CmdBtn_Push_Click()

    Dim intRet As Variant
    Dim a As Integer
    Dim i As Integer
    Dim row As Long
    
    
    l_buf_c_rx_ctn = ""
    CmdBtn_Pull.Enabled = False
    Enabled_False
    
    main_frm_fgt.state_lbl.BackColor = &H80FFC0
    main_frm_fgt.state_lbl.ForeColor = &H0&
    main_frm_fgt.state_lbl.Caption = "Available"
    
    For i = 0 To 9999
        off_cel(i) = ""
        C_P_aru_flg(i) = False
    Next
    
    main_stop_flg = False
    data_cnt = 0
    array_initialize
    delete_sheet_flg = False
    test_flg = True
    test_direction_num = 0
    stop_end_flg = False
    data_end_flg = True
    SER_flg = False
    C_P_max_make_flg = False
    test_start_direction = "PUSH"
    
    If CellSelect_lbl.Caption <> "" Then
        mae_cell_flg = True
    End If
    
    If TextBox_MAX_limit.Text = "" Then
        TextBox_MAX_limit.Text = "0"
    End If
    
    If TextBox_MIN_limit.Text = "" Then
        TextBox_MIN_limit.Text = "0"
    End If
    
'if USA
    If M_TextBox_MAX_limit.Text = "" Then
        M_TextBox_MAX_limit.Text = "0"
    End If
    
    If M_TextBox_MIN_limit.Text = "" Then
        M_TextBox_MIN_limit.Text = "0"
    End If
'endif
    
    If TextBox_toriga.Text = "" Then
        TextBox_toriga.Text = "0"
    End If
    
    set_flg_check                                           '|fffd|O|fffd||fffd||fffd|t|fffd|t|fffd||fffd||fffd|O|fffd|A|fffd||fffd||392|l|fffd|t|fffd||fffd||fffd|O|fffd|A|fffd||fffd||fffd||fffd||fffd||3ce|Z|fffd|t|fffd||fffd||fffd|O|fffd||30e||64fe|
    
    If comm_mdl_e.comm_init_proc Then                       ' |fffd||290|M|fffd|||fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
        Enabled_True
        communication_error
        Exit Sub                                            '|fffd|G|fffd||fffd||fffd|[|fffd||202||727d||fffd||fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|
    
    End If

    comm_mdl_e.cmd_send_proc (TBC)                          '|fffd|^|fffd||fffd||fffd||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TBC) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If

    comm_mdl_e.cmd_send_proc (TBD)                          '|fffd|\|fffd||fffd||fffd|P|fffd||28e||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TBD) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If


'#If NSCA_V103 = 1 Then
    comm_mdl_e.cmd_send_proc (TBE)                          '|fffd||fffd||fffd||fffd||fffd|P|fffd||28e||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TBE) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If

'#End If



    comm_mdl_e.cmd_send_proc (SSD)                          '|fffd||fffd||fffd||c0c2||fffd|[|fffd|h|fffd||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(SSD) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If
    
    If test_mode_num = 1 Or test_mode_num = 9 Then
        MsgBox "The command can not be executed, please check the mode of stand.", vbExclamation, OBI_STR       'MsgBox "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd||fffd|s|fffd||142||fffd||fffd||702||fffd||fffd||fffd|B|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd||303||fffd||fffd|[|fffd|h|fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B", vbExclamation, OBI_STR
        Enabled_True
        Exit Sub
    End If
        
    blank_check         '|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd||18c|J|fffd||502||fffd||fffd||50502||30b||d74c3|`|fffd|F|fffd|b|fffd|N
    
    If blank_check_flg = False Then
        Enabled_True
        Exit Sub
    End If
    
    If Val(TextBox_kurikaishikaisu.Text) < Val(TextBox_sample_num.Text) Then
        MsgBox MES67, vbExclamation, OBI_STR
        Enabled_True
        Exit Sub
    End If
    
    input_type_set
    limit_chk           '|fffd||327a||fffd||fffd||fffd|l|fffd||fffd||fffd||343|`|fffd|F|fffd|b|fffd|N
            
    If limit_chk_flg = 2 Then                                                                                       'MsgBox "***|fffd||fffd||fffd||fffd|***|fffd|l|fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Limit value.", vbExclamation, OBI_STR  'MsgBox "|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd| " & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
        TextBox_MAX_limit.Text = 0
        TextBox_MIN_limit.Text = 0
        Enabled_True
        Exit Sub
    
    ElseIf limit_chk_flg = 3 Then
        MsgBox MES66, vbExclamation, OBI_STR
        TextBox_MAX_limit.Text = 0
        TextBox_MIN_limit.Text = 0
        test_flg = False
        Enabled_True
        Exit Sub
    
    ElseIf limit_chk_flg = 1 Then
        limit_chk_text = "Invalid"  'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
    
    End If
    
    
'if USA
    If M_limit_chk_flg = 2 Then
        MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Limit value.", vbExclamation, OBI_STR  'MsgBox "|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd| " & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
        M_TextBox_MAX_limit.Text = 0
        M_TextBox_MIN_limit.Text = 0
        Enabled_True
        Exit Sub
        
    ElseIf M_limit_chk_flg = 3 Then
        MsgBox MES66, vbExclamation, OBI_STR
        M_TextBox_MAX_limit.Text = 0
        M_TextBox_MIN_limit.Text = 0
        test_flg = False
        Enabled_True
        Exit Sub
        
    ElseIf M_limit_chk_flg = 1 Then
        M_limit_chk_text = "Invalid"  'limit_chk_text = "|fffd||fffd||fffd||fffd||202||fffd|"
    End If
    
'endif
    
    
    If test_mode_num = 3 Or test_mode_num = 4 Then
        test_torikomikaisu  '|fffd||635e||fffd||5050e||64fe|
        
        comm_mdl_e.cmd_send_proc (SAI)                         '|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd|{|fffd||302||310||752||fffd|l|fffd||313||1cf|o|fffd||fffd||fffd||183|\|fffd|t|fffd|g|fffd||310||752||fffd|l|fffd||fffd|r 'goto debug mode for read stand's setting times
        comm_mdl_e.cmd_receive_proc
        
        If comm_mdl_e.send_comp(SAI) = False Then
            Enabled_True
            Exit Sub
        End If
        
        If SER_flg = True Then
            Enabled_True
            Exit Sub
        End If
        
        If test_mode_num = 4 Then
            comm_mdl_e.cmd_send_proc (DPAR)                          'read stand's setting times
            comm_mdl_e.cmd_receive_proc
            
            If comm_mdl_e.send_comp(DPAR) = False Then
                Enabled_True
                communication_error
                Exit Sub
            End If
            
            If SER_flg = True Then
                Enabled_True
                Exit Sub
            End If
            
        ElseIf test_mode_num = 3 Then
            comm_mdl_e.cmd_send_proc (DCR)                          'read stand's setting times
            comm_mdl_e.cmd_receive_proc
            
            If comm_mdl_e.send_comp(DCR) = False Then
                Enabled_True
                communication_error
                Exit Sub
            End If
            
            If SER_flg = True Then
                Enabled_True
                Exit Sub
            End If
            
        End If
        
        comm_mdl_e.cmd_send_proc (SAJ)                          'move out from debug mode
        comm_mdl_e.cmd_receive_proc
        
        If comm_mdl_e.send_comp(SAJ) = False Then
            Enabled_True
            communication_error
            Exit Sub
        End If
        
        If SER_flg = True Then
            Enabled_True
            Exit Sub
        End If
        
        If test_times_stand < cont_num Then
            If test_times_stand <> 0 Then
                intRet = MsgBox("The Repeat Count exceeds number(" & test_times_stand & "times) that is setted by Test Stand. Do you want to continue?", vbYesNo + vbQuestion, OBI_STR)  'intRet = MsgBox("|fffd|J|fffd||502||fffd||fffd||50502||fffd||fffd|{|fffd||310||752||8486||fffd||30c|J|fffd||502||fffd||fffd||50501|i" & test_times_stand & "|fffd|j|fffd||12d02||fffd||fffd||102||fffd||fffd||702||fffd||fffd|B|fffd||fffd||fffd|s|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|H", vbYesNo + vbQuestion, OBI_STR)
               
                If intRet = vbYes Then                                  'Yes |fffd||fffd||fffd|s
                    cont_num = test_times_stand
                Else                                                    'No  |fffd|I|fffd||fffd|
                    Enabled_True
                    Exit Sub
                End If
                
            Else: test_times_stand = 0
                
            End If
        End If
    
    
    End If
    '*********************************************************************
    
    'CONT|fffd||fffd||fffd|[|fffd|h|fffd|APROG|fffd||fffd||fffd|[|fffd|h|fffd||242||109||fffd||fffd||fffd||fffd||682||303|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||90a9||fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||702||fffd||fffd|B
    If test_mode_num = 3 Or test_mode_num = 4 Then
        sample_flg_set
    End If
    
    newbook_create  '|fffd||fffd||fffd||742||303|V|fffd|[|fffd|g|fffd||fffd|+|fffd||fffd||fffd||fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd|256|fffd||a347||fffd|A|fffd|V|fffd|K|fffd|u|fffd|b|fffd|N|fffd||c42c|
    
    If test_mode_num = 0 Or test_mode_num = 2 Or test_mode_num = 3 Or test_mode_num = 4 Then
        comm_mdl_e.cmd_send_proc (SAA)                          'LCD|fffd||255|\|fffd||fffd||fffd||fffd||fffd||102||fffd||fffd||fffd||50502||fffd||fffd|N|fffd||fffd||fffd|A
        comm_mdl_e.cmd_receive_proc
        
        If comm_mdl_e.send_comp(SAA) = False Then
            Enabled_True
            communication_error
            Exit Sub
        End If
        
        If SER_flg = True Then
            Enabled_True
            Exit Sub
        End If
    
    End If
    
    
    'CmdBtn_stop.Enabled = True      '|fffd||fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||302||757|L|fffd||fffd|
    If graph_on_flg = True Then
        
        If data_end_flg = True Then
            outp_mdl_e.Sheet_move
            outp_mdl_e.st_header
        End If
    
    ElseIf ma_si_colend_flg = True Then
        row = ActiveCell.row
        outp_mdl_e.Sheet_move
        ActiveSheet.Cells(row, 1).Activate
    
    End If
    
    cell_chk
    
    comm_mdl_e.cmd_send_proc (SSA)           '|fffd||fffd||fffd||fffd||fffd|J|fffd|n
    CmdBtn_stop.Enabled = True      '|fffd||fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||302||757|L|fffd||fffd||fffd|@|fffd||fffd||fffd||fffd||fffd|J|fffd|n|fffd||fffd||fffd||fffd|ASTOP|fffd|{|fffd|^|fffd||fffd||fffd|L|fffd||fffd||fffd||242||fffd||fffd||fffd|B
    CmdBtn_stop.SetFocus
    comm_mdl_e.cmd_receive_proc              '------------|fffd|f|fffd|[|fffd|^|fffd||fffd|M|fffd||fffd||fffd||fffd||fffd||fffd||fffd|K|fffd|v|fffd|i0217|fffd||112||fffd||fffd||fffd||fffd|j
    
    If SER_flg = True Or test_flg = False Then
        Exit Sub
    End If
    
    If comm_mdl_e.send_comp(SSA) = False Then
        Enabled_True
        communication_error
        Exit Sub
        
    End If
    
    hWndMe = FindWindow(USERFORM_CLASSNAME, Me.Caption) ' |fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd||242||10e|g|fffd|p
    timer_mdl_e.hWnd = hWndMe                           ' UserForm|fffd||fffd|hWnd|fffd||752||fffd|
    timer_mdl_e.TimerId = 1                             '   |fffd|^|fffd|C|fffd|}ID|fffd||752||fffd|
    timer_mdl_e.m_Timer_disable_flg = False
    timer_mdl_e.TimerInterval = K_TIMER                 '   |fffd|^|fffd|C|fffd|}|fffd||50a|u|fffd||752||fffd|
    
    a = a

End Sub

Private Sub CmdBtn_Push_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Then
        CmdBtn_Pull.SetFocus
    
    ElseIf KeyCode = vbKeyUp Then
        
        If CmdBtn_CellSelect.Enabled = True Then
            CmdBtn_CellSelect.SetFocus
        Else
            Comdbtn_Peak_reset.SetFocus
        End If
        
    End If
End Sub

Private Sub CmdBtn_stop_Click()
    CmdBtn_stop.Enabled = False
    stop_end_flg = True
    
    If y_flg = False Then
        main_stop_flg = True
    End If
    
    comm_mdl_e.cmd_send_proc (SSB)                              '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|A|fffd||fffd||835e||fffd||74f|I|fffd||fffd|
    
    If comm_mdl_e.send_comp(SSB) = False Then
        Enabled_True
        communication_error
        Exit Sub
        
    End If

End Sub

Private Sub ComboBox_torikomikankaku_Change()
    
    Select Case ComboBox_torikomikankaku.ListIndex
        Case 0
            torikomikankaku = FRE_10
            ComboBox_torikomikankaku.Font.Size = 9
            
        Case 1
            torikomikankaku = FRE_20
            ComboBox_torikomikankaku.Font.Size = 9
            
        Case 2
            torikomikankaku = FRE_50
            ComboBox_torikomikankaku.Font.Size = 9
            
        Case 3
            torikomikankaku = FRE_100
            ComboBox_torikomikankaku.Font.Size = 8
            
    End Select
    
End Sub

Private Sub Comdbtn_Peak_reset_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Or KeyCode = vbKeyTab Then
        If CmdBtn_CellSelect.Enabled = True Then
            CmdBtn_CellSelect.SetFocus
        Else
            CmdBtn_Push.SetFocus
        End If
    End If
End Sub

Private Sub Comdbtn_Zero_set_Click()
    
    If comm_mdl_e.comm_init_proc Then                       ' |fffd||290|M|fffd|||fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
        communication_error
        Exit Sub                                            '|fffd|G|fffd||fffd||fffd|[|fffd||202||727d||fffd||fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|
    End If
    
    comm_mdl_e.cmd_send_proc (TAA)
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TAA) = False Then               '|fffd||fffd||fffd||708||fffd||fffd||fffd||fffd|R|fffd|}|fffd||fffd||fffd|h
        communication_error
        Exit Sub
    End If
    
    If SER_flg = True Then
        main_frm_fgt.state_lbl.BackColor = &H0&
        main_frm_fgt.state_lbl.ForeColor = &HFF&
        main_frm_fgt.state_lbl.Caption = "Communication Error"
        SER_flg = False
        Exit Sub
    End If
    
    main_frm_fgt.state_lbl.BackColor = &H80FFC0
    main_frm_fgt.state_lbl.ForeColor = &H0&
    main_frm_fgt.state_lbl.Caption = "Available"
    
End Sub


Private Sub OptionButton_toriga_heni_Click()
    Dim dot_after_len As Long   '|fffd||fffd||fffd||fffd||fffd|_|fffd||3305||fffd||fffd|
    Dim str_len As Long
    Dim buf As String
    
    buf = TextBox_toriga.Text
    str_len = Len(buf)
    
    If OptionButton_toriga_heni.Value = True Then
        OptionButton_toriga_kajyuu.Value = False
                
'#if NSCA_V103
        If length_type_num = MM_UNIT Then
            
            TextBox_toriga.MaxLength = 5
            
            If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > 400 Then
                MsgBox MES28 & 0 & MES27 & "400.0" & " for Trigger(Distance).", vbExclamation, OBI_STR      'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j|fffd|l|fffd||fffd|" & 0 & MES27 & "400.0" & MES28, vbExclamation, OBI_STR
                TextBox_toriga.Text = 0
            
            End If
            
            dot_after_len = InStr(buf, ".")
            
            If (str_len - dot_after_len) > 1 And dot_after_len <> 0 Then
                TextBox_toriga.Text = 0
            End If
            
        Else
            
            TextBox_toriga.MaxLength = 6
            
            
            If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > 15.7 Then
                MsgBox MES28 & 0 & MES27 & "15.700" & " for Trigger(Distance).", vbExclamation, OBI_STR      'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j|fffd|l|fffd||fffd|" & 0 & MES27 & "400.0" & MES28, vbExclamation, OBI_STR
                TextBox_toriga.Text = 0
            
            End If
            
            dot_after_len = InStr(buf, ".")
            
            If (str_len - dot_after_len) > 3 And dot_after_len <> 0 Then
                TextBox_toriga.Text = 0
            End If
            
        End If
'#endif
        
    Else
        OptionButton_toriga_kajyuu.Value = True
        
        
        TextBox_toriga.MaxLength = 5
        
        
        If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > rate_load Then
            MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Trigger(Force).", vbExclamation, OBI_STR   'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||5cf|d|fffd|j|fffd|l|fffd||fffd| " & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
            TextBox_toriga.Text = 0
        End If
        
        dot_after_len = InStr(buf, ".")
        
        If (str_len - dot_after_len) > input_point_len And dot_after_len <> 0 Then
            TextBox_toriga.Text = 0
        End If
        
    End If
        
End Sub

Private Sub OptionButton_toriga_heni_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    
    If KeyCode = vbKeyUp Then
        OptionButton_toriga_kajyuu.SetFocus
    End If
    
End Sub

Private Sub OptionButton_toriga_kajyuu_Click()
    Dim dot_after_len As Long   '|fffd||fffd||fffd||fffd||fffd|_|fffd||3305||fffd||fffd|
    Dim str_len As Long
    Dim buf As String
    
    buf = TextBox_toriga.Text
    str_len = Len(buf)
    
    If OptionButton_toriga_kajyuu.Value = True Then
        
        TextBox_toriga.MaxLength = 5
        
        
        OptionButton_toriga_heni.Value = False
        
        If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > rate_load Then
            
            MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Trigger(Force).", vbExclamation, OBI_STR           'MsgBox "0|fffd|`400.0|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
            TextBox_toriga.Text = 0                                                                                                 'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||5cf|d|fffd|j|fffd|l|fffd||fffd|" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
        
        End If
        
        dot_after_len = InStr(buf, ".")
        If (str_len - dot_after_len) > input_point_len And dot_after_len <> 0 Then
            TextBox_toriga.Text = 0
        End If
        
    Else
        OptionButton_toriga_heni.Value = True
        

'#if NSCA_V103
         If length_type_num = MM_UNIT Then
             
            TextBox_toriga.MaxLength = 5
             
             
             If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > 400 Then
             
                 MsgBox MES28 & 0 & MES27 & "400.0" & " for Trigger(Distance).", vbExclamation, OBI_STR      'MsgBox "0|fffd|`400.0|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
             
                 TextBox_toriga.Text = 0                                                                     'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j|fffd|l|fffd||fffd|" & 0 & MES27 & "400.0" & MES28, vbExclamation, OBI_STR
             
             End If
             
             dot_after_len = InStr(buf, ".")
             
             If (str_len - dot_after_len) > 1 And dot_after_len <> 0 Then
                 TextBox_toriga.Text = 0
                 
             End If
             
         Else
             
            TextBox_toriga.MaxLength = 6
             
             
            If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > 15.7 Then
            
                MsgBox MES28 & 0 & MES27 & "15.700" & " for Trigger(Distance).", vbExclamation, OBI_STR      'MsgBox "0|fffd|`400.0|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
            
                TextBox_toriga.Text = 0                                                                     'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j|fffd|l|fffd||fffd|" & 0 & MES27 & "400.0" & MES28, vbExclamation, OBI_STR
            
            End If
            
            dot_after_len = InStr(buf, ".")
            
            If (str_len - dot_after_len) > 3 And dot_after_len <> 0 Then
                TextBox_toriga.Text = 0
                
            End If
             
         End If
'#endif
        
        
        
        
        
        
        
        
        
        
        
    End If
    
End Sub

Private Sub OptionButton_toriga_kajyuu_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Then
        OptionButton_toriga_heni.SetFocus
    End If
End Sub

Private Sub TextBox_kurikaishikaisu_AfterUpdate()
    Do While Left(TextBox_kurikaishikaisu.Text, 1) = "0"
        If Len(TextBox_kurikaishikaisu.Text) = 1 Then
            Exit Do
        ElseIf Left(TextBox_kurikaishikaisu.Text, 1) = "0" Then
            TextBox_kurikaishikaisu.Text = Mid(TextBox_kurikaishikaisu.Text, 2)
        End If
    Loop
End Sub

Private Sub TextBox_kurikaishikaisu_Change()
    Dim buf As String
    Dim ii As Integer
    Dim str_len As Integer
    Dim buf_char As Integer
    
    buf = TextBox_kurikaishikaisu.Text
    str_len = Len(buf)
    
    'If buf = "" Then
    '    MsgBox "|fffd|J|fffd||502||fffd||fffd||50502||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B", vbExclamation, OBI_STR
    '    Exit Sub
    'End If
    
    For ii = 1 To str_len
        buf_char = Asc(Mid(buf, ii, 1))
        If buf_char < 48 Or buf_char > 57 Then
            TextBox_kurikaishikaisu.Text = cont_num
        Else
            If Val(TextBox_kurikaishikaisu.Text) < 1 Or Val(TextBox_kurikaishikaisu.Text) > 9999 Then
                '"1|fffd|`9999|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
                MsgBox MES28 & 1 & MES27 & 9999 & " for Repeat Count.", vbExclamation, OBI_STR
                'MsgBox "|fffd|J|fffd||502||fffd||fffd||50502||fffd|" & 1 & MES27 & 9999 & MES28, vbExclamation, OBI_STR
                TextBox_kurikaishikaisu.Text = cont_num
                Exit Sub
            End If
        End If
    Next ii
    If TextBox_kurikaishikaisu.Text = "" Then
        cont_num = 1
    Else
        cont_num = Val(TextBox_kurikaishikaisu.Text)
    End If
End Sub




Private Sub TextBox_MAX_limit_AfterUpdate()
    If Len(TextBox_MAX_limit.Text) > 1 Then
        Do While Left(TextBox_MAX_limit.Text, 1) = "0"
            If Left(TextBox_MAX_limit.Text, 1) = "0" Then
                If Mid(TextBox_MAX_limit.Text, 2, 1) <> "." Then
                    TextBox_MAX_limit.Text = Mid(TextBox_MAX_limit.Text, 2)
                ElseIf Mid(TextBox_MAX_limit.Text, 2, 1) = "." Then
                    Exit Do
                End If
            End If
        Loop
    End If
End Sub

Private Sub TextBox_MAX_limit_Change()
    Dim buf As String
    Dim ii As Integer
    Dim str_len As Integer
    Dim buf_char As Integer
    Dim dot As Integer
    Dim dot_after_len As Long   '|fffd||fffd||fffd||fffd||fffd|_|fffd||3305||fffd||fffd|
        
    'buf = Val(TextBox_MAX_limit.Text)
    buf = TextBox_MAX_limit.Text
    str_len = Len(buf)
    
    input_type_set
    
    For ii = 1 To str_len
        buf_char = Asc(Mid(buf, ii, 1))
        If (buf_char <> 46 And buf_char < 48) Or buf_char > 57 Then
            TextBox_MAX_limit.Text = max_limit
        Else
            If buf_char = 46 Then
                dot = dot + 1
            End If
            
            If dot > 1 Then
                TextBox_MAX_limit.Text = max_limit
            ElseIf dot = 1 Then
                If Left(buf, 1) = "." Then
                    TextBox_MAX_limit.Text = "0."
                End If
            End If
            
            If Val(TextBox_MAX_limit.Text) < 0 Or Val(TextBox_MAX_limit.Text) > rate_load Then
                MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Upper limit.", vbExclamation, OBI_STR
                'MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
                TextBox_MAX_limit.Text = max_limit
                Exit Sub
            End If
            
            dot_after_len = InStr(buf, ".")
            
            If (str_len - dot_after_len) > input_point_len And dot_after_len <> 0 Then
                TextBox_MAX_limit.Text = max_limit
            End If
            
        End If
    Next ii
    max_limit = Val(TextBox_MAX_limit.Text)
End Sub

Private Sub TextBox_MAX_limit_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Then
        TextBox_MIN_limit.SetFocus
    ElseIf KeyCode = vbKeyUp Then
        CheckBox_Distance.SetFocus
    End If
End Sub




Private Sub TextBox_MIN_limit_AfterUpdate()
    If Len(TextBox_MIN_limit.Text) > 1 Then
        Do While Left(TextBox_MIN_limit.Text, 1) = "0"
            If Left(TextBox_MIN_limit.Text, 1) = "0" Then
                If Mid(TextBox_MIN_limit.Text, 2, 1) <> "." Then
                    TextBox_MIN_limit.Text = Mid(TextBox_MIN_limit.Text, 2)
                ElseIf Mid(TextBox_MIN_limit.Text, 2, 1) = "." Then
                    Exit Do
                End If
            End If
        Loop
    End If
End Sub

Private Sub TextBox_MIN_limit_Change()
    Dim buf As String
    Dim ii As Integer
    Dim str_len As Integer
    Dim buf_char As Integer
    Dim dot As Integer
    Dim dot_after_len As Long
    
    'buf = Val(TextBox_MIN_limit.Text)
    buf = TextBox_MIN_limit.Text
    str_len = Len(buf)
    
    input_type_set
    
    For ii = 1 To str_len
        buf_char = Asc(Mid(buf, ii, 1))
        If (buf_char <> 46 And buf_char < 48) Or buf_char > 57 Then
            TextBox_MIN_limit.Text = min_limit
        Else
            If buf_char = 46 Then
                dot = dot + 1
            End If
            If dot > 1 Then
                TextBox_MIN_limit.Text = min_limit
            ElseIf dot = 1 Then
                If Left(buf, 1) = "." Then
                    TextBox_MIN_limit.Text = "0."
                End If
            End If
            
            If Val(TextBox_MIN_limit.Text) < 0 Or Val(TextBox_MIN_limit.Text) > rate_load Then
                MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Lower limit.", vbExclamation, OBI_STR
                'MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
                TextBox_MIN_limit.Text = min_limit
                Exit Sub
            End If
            
            dot_after_len = InStr(buf, ".")
            If (str_len - dot_after_len) > input_point_len And dot_after_len <> 0 Then
                TextBox_MIN_limit.Text = min_limit
            End If
            
        End If
    Next ii
    min_limit = Val(TextBox_MIN_limit.Text)
    
End Sub

Private Sub TextBox_MIN_limit_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Then
        Comdbtn_Zero_set.SetFocus
    ElseIf KeyCode = vbKeyUp Then
        TextBox_MAX_limit.SetFocus
    End If
End Sub






Private Sub M_TextBox_MAX_limit_AfterUpdate()
    If Len(M_TextBox_MAX_limit.Text) > 1 Then
        Do While Left(M_TextBox_MAX_limit.Text, 1) = "0"
            If Left(M_TextBox_MAX_limit.Text, 1) = "0" Then
                If Mid(M_TextBox_MAX_limit.Text, 2, 1) <> "." Then
                    M_TextBox_MAX_limit.Text = Mid(M_TextBox_MAX_limit.Text, 2)
                ElseIf Mid(M_TextBox_MAX_limit.Text, 2, 1) = "." Then
                    Exit Do
                End If
            End If
        Loop
    End If
End Sub

Private Sub M_TextBox_MAX_limit_Change()
    Dim buf As String
    Dim ii As Integer
    Dim str_len As Integer
    Dim buf_char As Integer
    Dim dot As Integer
    Dim dot_after_len As Long   '|fffd||fffd||fffd||fffd||fffd|_|fffd||3305||fffd||fffd|
        
    buf = M_TextBox_MAX_limit.Text
    str_len = Len(buf)
    
    input_type_set
    
    For ii = 1 To str_len
        buf_char = Asc(Mid(buf, ii, 1))
        If (buf_char <> 46 And buf_char < 48) Or buf_char > 57 Then
            M_TextBox_MAX_limit.Text = M_max_limit
        Else
            If buf_char = 46 Then
                dot = dot + 1
            End If
            If dot > 1 Then
                M_TextBox_MAX_limit.Text = M_max_limit
            ElseIf dot = 1 Then
                If Left(buf, 1) = "." Then
                    M_TextBox_MAX_limit.Text = "0."
                End If
            End If
            
            If Val(M_TextBox_MAX_limit.Text) < 0 Or Val(M_TextBox_MAX_limit.Text) > rate_load Then
                MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Upper limit.", vbExclamation, OBI_STR
                'MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
                M_TextBox_MAX_limit.Text = M_max_limit
                Exit Sub
            End If
            
            dot_after_len = InStr(buf, ".")
            If (str_len - dot_after_len) > input_point_len And dot_after_len <> 0 Then
                M_TextBox_MAX_limit.Text = M_max_limit
            End If
            
        End If
    Next ii
    
    
    M_max_limit = Val(M_TextBox_MAX_limit.Text)

End Sub

Private Sub M_TextBox_MAX_limit_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Then
        M_TextBox_MIN_limit.SetFocus
    ElseIf KeyCode = vbKeyUp Then
        CheckBox_Distance.SetFocus
    End If
End Sub




Private Sub M_TextBox_MIN_limit_AfterUpdate()
    If Len(M_TextBox_MIN_limit.Text) > 1 Then
        Do While Left(M_TextBox_MIN_limit.Text, 1) = "0"
            If Left(M_TextBox_MIN_limit.Text, 1) = "0" Then
                If Mid(M_TextBox_MIN_limit.Text, 2, 1) <> "." Then
                    M_TextBox_MIN_limit.Text = Mid(M_TextBox_MIN_limit.Text, 2)
                ElseIf Mid(M_TextBox_MIN_limit.Text, 2, 1) = "." Then
                    Exit Do
                End If
            End If
        Loop
    End If
End Sub

Private Sub M_TextBox_MIN_limit_Change()
    Dim buf As String
    Dim ii As Integer
    Dim str_len As Integer
    Dim buf_char As Integer
    Dim dot As Integer
    Dim dot_after_len As Long
    
    'buf = Val(TextBox_MIN_limit.Text)
    buf = M_TextBox_MIN_limit.Text
    str_len = Len(buf)
    
    input_type_set
    
    For ii = 1 To str_len
        buf_char = Asc(Mid(buf, ii, 1))
        If (buf_char <> 46 And buf_char < 48) Or buf_char > 57 Then
            M_TextBox_MIN_limit.Text = M_min_limit
        Else
            If buf_char = 46 Then
                dot = dot + 1
            End If
            If dot > 1 Then
                M_TextBox_MIN_limit.Text = M_min_limit
            ElseIf dot = 1 Then
                If Left(buf, 1) = "." Then
                    M_TextBox_MIN_limit.Text = "0."
                End If
            End If
            
            If Val(M_TextBox_MIN_limit.Text) < 0 Or Val(M_TextBox_MIN_limit.Text) > rate_load Then
                MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Lower limit.", vbExclamation, OBI_STR
                'MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
                M_TextBox_MIN_limit.Text = M_min_limit
                Exit Sub
            End If
            
            dot_after_len = InStr(buf, ".")
            If (str_len - dot_after_len) > input_point_len And dot_after_len <> 0 Then
                M_TextBox_MIN_limit.Text = M_min_limit
            End If
            
        End If
    Next ii
    M_min_limit = Val(M_TextBox_MIN_limit.Text)
    
End Sub

Private Sub M_TextBox_MIN_limit_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    
    If KeyCode = vbKeyDown Then
        Comdbtn_Zero_set.SetFocus
    ElseIf KeyCode = vbKeyUp Then
        M_TextBox_MAX_limit.SetFocus
    End If
    
End Sub






























Private Sub TextBox_sample_num_AfterUpdate()
    Do While Left(TextBox_sample_num.Text, 1) = "0"
        If Len(TextBox_sample_num.Text) = 1 Then
            Exit Do
        ElseIf Left(TextBox_sample_num.Text, 1) = "0" Then
            TextBox_sample_num.Text = Mid(TextBox_sample_num.Text, 2)
        End If
    Loop
End Sub

Private Sub TextBox_sample_num_Change()
    Dim buf As String
    Dim ii As Integer
    Dim str_len As Integer
    Dim buf_char As Integer
    
    buf = TextBox_sample_num.Text
    str_len = Len(buf)
    
    'If buf = "" Then
    '    MsgBox "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B", vbExclamation, OBI_STR
    '    Exit Sub
    'End If
    
    For ii = 1 To str_len
        buf_char = Asc(Mid(buf, ii, 1))
        If buf_char < 48 Or buf_char > 57 Then
            TextBox_sample_num.Text = sample_num
        Else
            If CheckBox1.Value = False Then
                If Val(TextBox_sample_num.Text) < 0 Or Val(TextBox_sample_num.Text) > 9999 Then
                    'MsgBox "0|fffd|`9999|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
                    MsgBox MES28 & 0 & MES27 & 9999 & " for Sampling Number.", vbExclamation, OBI_STR
                    'MsgBox "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd|l|fffd||fffd|" & 0 & MES27 & 9999 & MES28, vbExclamation, OBI_STR
                    TextBox_sample_num.Text = sample_num
                    Exit Sub
                End If
            Else
                If Val(TextBox_sample_num.Text) < 0 Or Val(TextBox_sample_num.Text) > 250 Then
                    'MsgBox "0|fffd|`250|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
                    MsgBox MES28 & 0 & MES27 & 250 & " for Sampling Number.", vbExclamation, OBI_STR
                    'MsgBox "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd|l|fffd||fffd|" & 0 & MES27 & 250 & MES28, vbExclamation, OBI_STR
                    TextBox_sample_num.Text = sample_num
                    Exit Sub
                End If
            End If
        End If
    Next ii
    sample_num = Val(TextBox_sample_num.Text)

End Sub

Private Sub TextBox_sample_num_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = vbKeyDown Then
        OptionButton_toriga_kajyuu.SetFocus
    End If
End Sub

Private Sub TextBox_toriga_AfterUpdate()
    If Len(TextBox_toriga.Text) > 1 Then
        Do While Left(TextBox_toriga.Text, 1) = "0"
            If Left(TextBox_toriga.Text, 1) = "0" Then
                If Mid(TextBox_toriga.Text, 2, 1) <> "." Then
                    TextBox_toriga.Text = Mid(TextBox_toriga.Text, 2)
                ElseIf Mid(TextBox_toriga.Text, 2, 1) = "." Then
                    Exit Do
                End If
            End If
        Loop
    End If
End Sub

Private Sub TextBox_toriga_Change()
    Dim buf As String
    Dim ii As Integer
    Dim str_len As Integer
    Dim buf_char As Integer
    Dim dot As Integer
    Dim dot_after_len As Long
    
    buf = TextBox_toriga.Text
    str_len = Len(buf)
    
    For ii = 1 To str_len
        buf_char = Asc(Mid(buf, ii, 1))
        If (buf_char <> 46 And buf_char < 48) Or buf_char > 57 Then
            TextBox_toriga.Text = triger
        Else
            If buf_char = 46 Then
                dot = dot + 1
            End If
            If dot > 1 Then
                TextBox_toriga.Text = triger
            ElseIf dot = 1 Then
                If Left(buf, 1) = "." Then
                    TextBox_toriga.Text = "0."
                End If
            End If
            
            '''|fffd||fffd||fffd||343|`|fffd|F|fffd|b|fffd|N|fffd||fffd||fffd|s|fffd||fffd||fffd|B
            '''|fffd||5cf|d|fffd|I|fffd||fffd||fffd||fffd|
            
            
            If OptionButton_toriga_kajyuu.Value = True Then
                
                If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > rate_load Then            'MsgBox "0|fffd|`400.0|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
                    MsgBox MES28 & 0 & MES27 & rate_load & "(" & unit_name & ")" & " for Trigger(Force).", vbExclamation, OBI_STR           'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||5cf|d|fffd|j" & 0 & MES27 & rate_load & "(" & unit_name & ")" & MES28, vbExclamation, OBI_STR
                    TextBox_toriga.Text = triger
                    Exit Sub
                End If
                                
                dot_after_len = InStr(buf, ".")
                If (str_len - dot_after_len) > input_point_len And dot_after_len <> 0 Then
                    TextBox_toriga.Text = triger
                    Exit Sub
                End If
                
                
                
                
            ElseIf OptionButton_toriga_heni.Value = True Then
                
                
                '''|fffd||3c8||291|I|fffd||fffd||fffd||fffd|
                
                
'#if NSCA_V103
                If length_type_num = MM_UNIT Then
                    If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > 400 Then
                        MsgBox MES28 & 0 & MES27 & "400.0" & " for Trigger(Distance).", vbExclamation, OBI_STR      'MsgBox "0|fffd|`400.0|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
                        TextBox_toriga.Text = triger                                                                'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j" & 0 & MES27 & "400.0" & MES28, vbExclamation, OBI_STR
                        Exit Sub
                    End If
                    
                    dot_after_len = InStr(buf, ".")
                    If (str_len - dot_after_len) > 1 And dot_after_len <> 0 Then
                        TextBox_toriga.Text = triger
                        Exit Sub
                    End If
                    
                Else
                    If Val(TextBox_toriga.Text) < 0 Or Val(TextBox_toriga.Text) > 15.7 Then
                        MsgBox MES28 & 0 & MES27 & "15.700" & " for Trigger(Distance).", vbExclamation, OBI_STR      'MsgBox "0|fffd|`400.0|fffd||702||142||310||fffd||fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"          '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v_090212
                        TextBox_toriga.Text = triger                                                                'MsgBox "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j" & 0 & MES27 & "400.0" & MES28, vbExclamation, OBI_STR
                        Exit Sub
                    End If
                    
                    dot_after_len = InStr(buf, ".")
                    If (str_len - dot_after_len) > 3 And dot_after_len <> 0 Then
                        TextBox_toriga.Text = triger
                        Exit Sub
                    End If
                    
                End If
'#endif
                
                

            
            
            
            
            
            
            
            End If
            
            
            
        End If
    Next ii
    triger = Val(TextBox_toriga.Text)
    
End Sub



Private Sub UserForm_Activate()
    '|fffd||fffd|090401SATO|fffd||1c9||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    l_buf_c_rx_ctn = ""
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    main_frm_fgt_open_flg = True
    
    'first_frm_fgt_open_flg = False
    If test_flg = True Then '|fffd||fffd||fffd|[|fffd|_|fffd||fffd||fffd|X|fffd|\|fffd||fffd||fffd||fffd||fffd|A|fffd||fffd||fffd|[|fffd||fffd||fffd||fffd||fffd|\|fffd||fffd||fffd||142||fffd||fffd||702||fffd||fffd||fffd|
        'main_frm_fgt.Hide   '|fffd||fffd|U|fffd||82||fffd||fffd||101|A|fffd||10a|J
        'main_frm_fgt.Show
        'Enabled_False
    Else: test_flg = False
        'main_frm_fgt.Hide
        'main_frm_fgt.Show vbModeless
        'Enabled_True
    End If
    
    '#If USA = 1 Then
    If CheckBox_AbsValue.Value = True Then
        Frame91.Enabled = False
        Label409.Enabled = False
        M_TextBox_MAX_limit.Enabled = False
        M_TextBox_MIN_limit.Enabled = False
        Label406.Enabled = False
        Label407.Enabled = False
        
    Else
        Frame91.Enabled = True
        Label409.Enabled = True
        M_TextBox_MAX_limit.Enabled = True
        M_TextBox_MIN_limit.Enabled = True
        Label406.Enabled = True
        Label407.Enabled = True
    
    End If

'#End If
    
End Sub

Private Sub UserForm_Initialize()
    
    test_flg = False
    graph_on_flg = False
    SER_flg = False
    test_end_flg = False
    main_frm_fgt_open_flg = True
    
    '|fffd|G|fffd|N|fffd|Z|fffd||fffd||fffd|o|fffd|[|fffd|W|fffd||fffd||fffd||fffd||fffd||30e||64fe||fffd|A2003|fffd||30f||a347|11.0|fffd|A2007|fffd||30f||a347|12.0
    Dim ii As String
    ii = Application.Version
    If ii = "11.0" Then
        Col_MAX = 256
        Sheets_MAX = 256
        Rows_Max = 65536
    ElseIf ii = "12.0" Then
        Col_MAX = 16384
        Sheets_MAX = 256
        Rows_Max = 1048576
    Else
        Col_MAX = 256
        Sheets_MAX = 256
        Rows_Max = 65536
    End If
    
    With ComboBox_torikomikankaku                           '|fffd||635e||fffd||fffd||fffd||fffd||fffd|@|fffd||fffd||fffd||692||1c9||fffd|
        .AddItem FRE_10
        .AddItem FRE_20
        .AddItem FRE_50
'        .AddItem FRE_100
        .ListIndex = 2
    End With

    If comm_mdl_e.comm_init_proc Then                       '|fffd||290|M|fffd|||fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
        Exit Sub                                            '|fffd|G|fffd||fffd||fffd|[|fffd||202||727d||fffd||fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|
    End If
    
    comm_mdl_e.cmd_send_proc (TBC)                          '|fffd|^|fffd||fffd||fffd||64fe|
    comm_mdl_e.cmd_receive_proc
    If comm_mdl_e.send_comp(TBC) = False Then
        Exit Sub
    End If
    If SER_flg = True Then
        Exit Sub
    End If
    
    comm_mdl_e.cmd_send_proc (TBD)                          '|fffd|\|fffd||fffd||fffd|P|fffd||28e||64fe|
    comm_mdl_e.cmd_receive_proc
    If comm_mdl_e.send_comp(TBD) = False Then
        Exit Sub
    End If
    
    
    If SER_flg = True Then
        Exit Sub
    End If
    
    
'#If NSCA_V103 Then
    comm_mdl_e.cmd_send_proc (TBE)                          '|fffd||fffd||fffd||fffd||fffd|P|fffd||28e||64fe|
    comm_mdl_e.cmd_receive_proc
    
    If comm_mdl_e.send_comp(TBE) = False Then
        Enabled_True
        communication_error
        Exit Sub
    
    End If
    
    If SER_flg = True Then
        Enabled_True
        Exit Sub
    
    End If

'#End If




    input_type_set
    Label_Rate.Caption = "FG*-" & rate_load_kg
    
    triger = Val(TextBox_toriga.Text)
    'sample_num = Val(TextBox_sample_num.text)
    'sample_num = Val(TextBox_sample_num.text)
    
End Sub
Private Sub Comdbtn_Peak_reset_Click()
    If comm_mdl_e.comm_init_proc Then                       '|fffd||290|M|fffd|||fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
        communication_error
        Exit Sub                                            '|fffd|G|fffd||fffd||fffd|[|fffd||202||727d||fffd||fffd||fffd||fffd||fffd||fffd||fffd|I|fffd||fffd|
    End If
    comm_mdl_e.cmd_send_proc (TAE)
    comm_mdl_e.cmd_receive_proc
    If comm_mdl_e.send_comp(TAE) = False Then               '|fffd|s|fffd|[|fffd|N|fffd||fffd||fffd|Z|fffd|b|fffd|g|fffd|R|fffd|}|fffd||fffd||fffd|h
        communication_error
        Exit Sub
    End If
    
    If SER_flg = True Then
        main_frm_fgt.state_lbl.BackColor = &H0&
        main_frm_fgt.state_lbl.ForeColor = &HFF&
        main_frm_fgt.state_lbl.Caption = "Communication Error"
        'main_frm_fgt.state_lbl.Caption = "|fffd||290|M|fffd||64f||fffd|"
        SER_flg = False
        Exit Sub
    End If
    
    main_frm_fgt.state_lbl.BackColor = &H80FFC0
    main_frm_fgt.state_lbl.ForeColor = &H0&
    main_frm_fgt.state_lbl.Caption = "Available"
    'main_frm_fgt.state_lbl.Caption = "|fffd||fffd|~|fffd||fffd|"
End Sub
Public Sub Enabled_False()
    'Dim ii As Boolean
    
    'main_frm_fgt.Enabled = False
    CmdBtn_Pull.Enabled = False
    'CmdBtn_stop.Enabled = True      '|fffd||fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||302||757|L|fffd||fffd|
    CmdBtn_Push.Enabled = False
    CmdBtn_CellSelect.Enabled = False
    Comdbtn_Zero_set.Enabled = False
    Comdbtn_Peak_reset.Enabled = False
    ComboBox_torikomikankaku.Enabled = False
    TextBox_kurikaishikaisu.Enabled = False
    CheckBox1.Enabled = False
    CheckBox_AbsValue.Enabled = False
    CheckBox_Distance.Enabled = False
    OptionButton_toriga_heni.Enabled = False
    OptionButton_toriga_kajyuu.Enabled = False
    TextBox_toriga.Enabled = False
    TextBox_sample_num.Enabled = False
    CellSelect_lbl.Enabled = False
    TextBox_MAX_limit.Enabled = False
    TextBox_MIN_limit.Enabled = False
    
'if USA
    M_TextBox_MAX_limit.Enabled = False
    M_TextBox_MIN_limit.Enabled = False
'endif
    
    
     
    'Comdbtn_Zero_set.Enabled = False
    'Comdbtn_Peak_reset.Enabled = False
    Label_Rate.Caption = "FG*-" & rate_load_kg
    'CmdBtn_stop.Enabled = True      '|fffd||fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||302||757|L|fffd||fffd|
    'main_frm_fgt.Enabled = False
    'UserForm_Activate
    'DoEvents
    
End Sub
'Public Sub enabled_false_Button()

'End Sub
Public Sub Enabled_True()
    'Dim ii As Boolean
    
    'CmdBtn_Pull.Enabled = True
    CmdBtn_stop.Enabled = False      '|fffd||fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||302||756||fffd||fffd||fffd|
    'CmdBtn_Push.Enabled = True
    'CmdBtn_CellSelect.Enabled = True
    ComboBox_torikomikankaku.Enabled = True
    TextBox_kurikaishikaisu.Enabled = True
    CheckBox1.Enabled = True
    CheckBox_AbsValue.Enabled = True
    CheckBox_Distance.Enabled = True
    OptionButton_toriga_heni.Enabled = True
    OptionButton_toriga_kajyuu.Enabled = True
    TextBox_toriga.Enabled = True
    TextBox_sample_num.Enabled = True
    'CellSelect_lbl.Enabled = True
    CellSelect_lbl.Caption = ""
    TextBox_MAX_limit.Enabled = True
    TextBox_MIN_limit.Enabled = True
    
'if USA
    If set_AbsValue_flg = False Then
        M_TextBox_MAX_limit.Enabled = True
        M_TextBox_MIN_limit.Enabled = True
    End If
    
'endif
    
    Label_Rate.Caption = "FG*-" & rate_load_kg
    Comdbtn_Zero_set.Enabled = True
    Comdbtn_Peak_reset.Enabled = True
    CmdBtn_Pull.Enabled = True
    CmdBtn_Push.Enabled = True
    
    If CheckBox1.Value = True Then
        CmdBtn_CellSelect.Enabled = False
        CellSelect_lbl.Enabled = False
    ElseIf CheckBox1.Value = False Then
        CmdBtn_CellSelect.Enabled = True
        CellSelect_lbl.Enabled = True
    End If
    CmdBtn_Push.SetFocus
    
    'DoEvents

End Sub
Private Sub limit_chk()
    
    max_limit = Val(TextBox_MAX_limit.Text)
    min_limit = Val(TextBox_MIN_limit.Text)
    
    If max_limit >= min_limit And max_limit <= rate_load And min_limit >= 0 Then
        limit_chk_flg = 0
        If max_limit = 0 And min_limit = 0 Then
            limit_chk_flg = 1                   '|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd||356||fffd||fffd||fffd|
        End If
    ElseIf max_limit > rate_load Or min_limit < 0 Then
        limit_chk_flg = 2                       '|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd||fffd||342||354||348||34a|O|fffd||182||202||fffd||fffd||fffd||fffd||fffd|
    ElseIf max_limit < min_limit Then
        limit_chk_flg = 3                       '|fffd||fffd||fffd||fffd|l|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|
    End If
    


'#If USA = 1 Then
     
    M_max_limit = Val(M_TextBox_MAX_limit.Text)
    M_min_limit = Val(M_TextBox_MIN_limit.Text)
    
    If M_max_limit >= M_min_limit And M_max_limit <= rate_load And M_min_limit >= 0 Then
        M_limit_chk_flg = 0
        If M_max_limit = 0 And M_min_limit = 0 Then
            M_limit_chk_flg = 1                 '|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd||356||fffd||fffd||fffd|
        End If
    ElseIf M_max_limit > rate_load Or M_min_limit < 0 Then
        M_limit_chk_flg = 2                     '|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd||fffd||342||354||348||34a|O|fffd||182||202||fffd||fffd||fffd||fffd||fffd|
    ElseIf M_max_limit < M_min_limit Then
        M_limit_chk_flg = 3                     '|fffd||fffd||fffd||fffd|l|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd||fffd|
    End If
    
'#End If
    
End Sub
Public Sub input_type_set() '|fffd||5cf|d|fffd||fffd||fffd||343|^|fffd|C|fffd|v|fffd|I|fffd||fffd|
'********************************************************************************
'|fffd|C|fffd|O|fffd||fffd|FG|fffd||242||351||389||fffd||fffd||fffd||fffd||102||702||fffd||fffd||fffd|B|fffd|v|fffd|C|fffd||fffd||fffd|B|fffd|v|fffd|m|fffd|F|fffd|B090329ryu
'********************************************************************************
    Dim type_para As Variant
    Select Case fg_type_num
        Case "02"                                                       'FGP-0.2
            rate_load_kg = "0.5"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(3, 2, 0.099, N_STR, FGP02)
                Case 2                                                  'kg(g)
                    type_para = Array(1, 200, 9.9, G_STR, FGP02)
                Case 1                                                  'LB
                    type_para = Array(3, 0.5, 0.099, LB_STR, FGP02)
                Case 3                                                  'OZ
                    type_para = Array(2, 8, 0.99, OZ_STR, FGP02)
            End Select
        
        Case "03"                                                       'FGP-0.5
            rate_load_kg = "1"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(3, 5, 0.099, N_STR, FGP05)
                Case 2                                                  'kg(g)
                    type_para = Array(1, 500, 9.9, G_STR, FGP05)
                Case 1                                                  'LB
                    type_para = Array(3, 1, 0.099, LB_STR, FGP05)
                Case 3                                                  'OZ
                    type_para = Array(2, 16, 0.99, OZ_STR, FGP05)
            End Select
        
        Case "04"                                                       'FGP-1
            rate_load_kg = "2"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(2, 10, 0.99, N_STR, FGP1)
                Case 2                                                  'kg(g)
                    type_para = Array(0, 1000, 99, G_STR, FGP1)
                Case 1                                                  'LB
                    type_para = Array(3, 2, 0.99, LB_STR, FGP1)
                Case 3                                                  'OZ
                    type_para = Array(2, 32, 0.99, OZ_STR, FGP1)
            End Select
        
        Case "05"                                                       'FGP-2
            rate_load_kg = "5"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(2, 20, 0.99, N_STR, FGP2)
                Case 1                                                  'kg
                    type_para = Array(3, 2, 0.099, KG_STR, FGP2)
                Case 2                                                  'LB
                    type_para = Array(3, 5, 0.099, LB_STR, FGP2)
                Case 3                                                  'LB
                    type_para = Array(3, 5, 0.099, LB_STR, FGP2)
            End Select
        
        Case "06"                                                       'FGP-5
            rate_load_kg = "10"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(2, 50, 0.99, N_STR, FGP5)
                Case 1                                                  'kg
                    type_para = Array(3, 5, 0.099, KG_STR, FGP5)
                Case 2                                                  'LB
                    type_para = Array(2, 10, 0.99, LB_STR, FGP5)
                Case 3                                                  'LB
                    type_para = Array(2, 10, 0.99, LB_STR, FGP5)
            End Select
        
        Case "07"                                                       'FGP-10
            rate_load_kg = "20"
             Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(1, 100, 9.9, N_STR, FGP10)
                Case 1                                                  'kg
                    type_para = Array(2, 10, 0.99, KG_STR, FGP10)
                Case 2                                                  'LB
                    type_para = Array(2, 20, 0.99, LB_STR, FGP10)
                Case 3                                                  'LB
                    type_para = Array(2, 20, 0.99, LB_STR, FGP10)
            End Select
            
        Case "08"                                                       'FGP-20
            rate_load_kg = "50"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(1, 200, 9.9, N_STR, FGP20)
                Case 1                                                  'kg
                    type_para = Array(2, 20, 0.99, KG_STR, FGP20)
                Case 2                                                  'LB
                    type_para = Array(2, 50, 0.99, LB_STR, FGP20)
                Case 3                                                  'LB
                    type_para = Array(2, 50, 0.99, LB_STR, FGP20)
            End Select
        
        Case "09"                                                       'FGP-50
            rate_load_kg = "100"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(1, 500, 9.9, N_STR, FGP50)
                Case 1                                                  'kg
                    type_para = Array(2, 50, 0.99, KG_STR, FGP50)
                Case 2                                                  'LB
                    type_para = Array(1, 100, 9.9, LB_STR, FGP50)
                Case 3                                                  'LB
                    type_para = Array(1, 100, 9.9, LB_STR, FGP50)
            End Select
        
        Case "0A"                                                       'FGC-100HB
            rate_load_kg = "200H"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(0, 1000, 99, N_STR, FGC100HB)
                Case 1                                                  'kg
                    type_para = Array(1, 100, 9.9, KG_STR, FGC100HB)
                Case 2                                                  'LB
                    type_para = Array(1, 200, 9.9, LB_STR, FGC100HB)
                Case 3                                                  'LB
                    type_para = Array(1, 200, 9.9, LB_STR, FGC100HB)
            End Select
        
        Case "0B"                                                       'FGC-150HB
            rate_load_kg = "300H"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(0, 1500, 99, N_STR, FGC150HB)
                Case 1                                                  'kg
                    type_para = Array(1, 150, 9.9, KG_STR, FGC150HB)
                Case 2                                                  'LB
                    type_para = Array(1, 300, 9.9, LB_STR, FGC150HB)
                Case 3                                                  'LB
                    type_para = Array(1, 300, 9.9, LB_STR, FGC150HB)
            End Select
        
        Case "0C"                                                       'FGC-250HB
            rate_load_kg = "500H"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(0, 2500, 99, N_STR, FGC250HB)
                Case 1                                                  'kg
                    type_para = Array(1, 250, 9.9, KG_STR, FGC250HB)
                Case 2                                                  'LB
                    type_para = Array(1, 500, 9.9, LB_STR, FGC250HB)
                Case 3                                                  'LB
                    type_para = Array(1, 500, 9.9, LB_STR, FGC250HB)
            End Select
        
        Case "0D"                                                       'FGC-500HB
            rate_load_kg = "1000H"
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(0, 5000, 99, N_STR, FGC500HB)
                Case 1                                                  'kg
                    type_para = Array(1, 500, 9.9, KG_STR, FGC500HB)
                Case 2                                                  'LB
                    type_para = Array(0, 1000, 99, LB_STR, FGC500HB)
                Case 3                                                  'LB
                    type_para = Array(0, 1000, 99, LB_STR, FGC500HB)
            End Select
        Case "1A"
            rate_load_kg = 200
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(0, 1000, 99, N_STR, "FGPX-100")
                Case 1                                                  'kg
                    type_para = Array(1, 100, 9.9, KG_STR, "FGPX-100")
                Case 2                                                  'LB
                    type_para = Array(1, 200, 9.9, LB_STR, "FGPX-100")
                Case 3                                                  'LB
                    type_para = Array(1, 200, 9.9, LB_STR, "FGPX-100")
            End Select
        Case Else
            Select Case unit_num
                Case 0                                                  'N
                    type_para = Array(0, 9999, 99, N_STR, "")
                Case 1                                                  'kg
                    type_para = Array(1, 999.9, 9.9, KG_STR, "")
                Case 2                                                  'LB
                    type_para = Array(0, 9999, 99, LB_STR, "")
                Case 3                                                  'LB
                    type_para = Array(0, 9999, 99, LB_STR, "")
            End Select
    End Select
    
    input_point_len = type_para(0)
    rate_load = type_para(1)
    'input_2_max = type_para(2)
    unit_name = type_para(3)
    fg_type_name = type_para(4)
    'indicate_unit = "(" & indicate_unit & ")"
End Sub
'***************************************************************************
'|fffd|f|fffd|[|fffd|^|fffd||635e||fffd||50502||30e||64fe|
'***************************************************************************
Public Sub test_torikomikaisu()
    sample_num = Val(TextBox_sample_num.Text)
    cont_num = Val(TextBox_kurikaishikaisu.Text)
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    Dim timer_before As Double
    Dim timer_current As Double

    timer_before = Timer
    
    If test_flg = True Then                    '|fffd|~|fffd|{|fffd|^|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|SSB|fffd||fffd||fffd||fffd||fffd||103|X|fffd|^|fffd||fffd||fffd|hSTOP
        interruption_flg = True
        comm_mdl_e.cmd_send_proc (SSB)
        Do While interruption_flg = True
            comm_mdl_e.cmd_receive_proc
            timer_current = Timer
            If timer_current - timer_before >= 3 Then
                Exit Do
            End If
        Loop
        test_flg = False
    End If
    first_frm_fgt_open_flg = False
    main_frm_fgt_open_flg = False
    test_times = 0
    max_sheet_cont = 0
    max_limit = 0
    min_limit = 0
    
'#If USA = 1 Then
    M_max_limit = 0
    M_min_limit = 0
'#End If
    
    dataonly_cellout_cnt = 0
    data_cnt = 0
    'triger = 0
    
    CloseHandle (hComm)
    
End Sub
Public Sub add_pages_cal()
    If test_mode_num = 0 Or test_mode_num = 2 Then
        addsheet_pages = 1
    ElseIf test_mode_num = 3 Or test_mode_num = 4 Then
        If graph_on_flg = True Then
            If cont_num >= sample_num Then
                addsheet_pages = sample_num + 1
            Else
                addsheet_pages = cont_num + 1
            End If
            If addsheet_pages >= 251 Then
                addsheet_pages = 251
            End If
        Else
            If cont_num >= sample_num Then
                If CellSelect_lbl.Caption = "" Then
                    addsheet_pages = Application.RoundUp(sample_num, 100) + 1
                ElseIf CellSelect_lbl.Caption <> "" Then
                    addsheet_pages = Application.RoundUp(sample_num, 100) + 2
                End If
            Else
                If CellSelect_lbl.Caption = "" Then
                    addsheet_pages = Application.RoundUp(cont_num, 6) + 1
                ElseIf CellSelect_lbl.Caption <> "" Then
                    addsheet_pages = Application.RoundUp(cont_num, 100) + 2
                End If
            End If
            If addsheet_pages >= 102 Then
                addsheet_pages = 102
            End If
        End If
    End If
End Sub

'|fffd|V|fffd|[|fffd|g|fffd|v|fffd|Z|fffd|A256|fffd||fffd||fffd||fffd||fffd||fffd||a347|FALSE
Public Sub pages_cal()
    Dim sheet_pages_total As Integer
    sheet_pages_total = ActiveWorkbook.Worksheets.Count
        
    add_pages_cal
    If (addsheet_pages + sheet_pages_total) >= 256 Then
        addsheet_flg = False
    Else
        addsheet_flg = True
    End If
End Sub
Public Sub newbook_create()

    pages_cal
    If addsheet_flg = False Then
        main_mdl_e.Book_Name_jdg
        ActiveWorkbook.Save                                                         '|fffd||6d1||fffd||fffd||fffd||fffd||fffd|
        Workbooks.Add
        ActiveWorkbook.SaveAs Filename:=sm_folder & "\" & File_name                 '|fffd||fffd||fffd||742||303|u|fffd|b|fffd|N|fffd||16f11|O|fffd||fffd||3c2||fffd||fffd||115||6d1||fffd|

        Worksheets(1).name = "VC-1"
        Application.DisplayAlerts = False
        
        Do While Val(Worksheets.Count) > 1                                              '|fffd|c|fffd||fffd||303|V|fffd|[|fffd|g|fffd||351|S|fffd||fffd||fffd||fffd||fffd||fffd|
            On Error Resume Next
            Worksheets(2).Delete
        Loop
        MsgBox MES4 & File_name & ".", vbExclamation, OBI_STR                             '"|fffd||24b|L|fffd|^|fffd||fffd||fffd||702||fffd||fffd|B"
        Application.DisplayAlerts = True
        '|fffd||fffd||fffd||30f||fffd||fffd||fffd||fffd||fffd|
        test_times = 0
        max_sheet_cont = 0
        dataonly_cellout_cnt = 0
    End If
End Sub
'*************************************
'|fffd||752||fffd|t|fffd||fffd||fffd|O|fffd||312|l|fffd||64fe|
'*************************************
Public Sub set_flg_check()

    If CheckBox1.Value = True Then
        graph_on_flg = True
        dataonly_cellout_cnt = 0
    Else
        graph_on_flg = False
    End If

    If CheckBox_AbsValue.Value = True Then
        set_AbsValue_flg = True
    Else
        set_AbsValue_flg = False
    End If
    
    If CheckBox_Distance.Value = True Then
        set_distance_flg = True
    Else
        set_distance_flg = False
    End If
End Sub
'****************************************
'|fffd||fffd||fffd||fffd||fffd||682||303|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||835e||fffd||782||fffd||fffd|isample_flg()|fffd|j
'****************************************
Public Sub sample_flg_set()
    Dim y_cnt As Long
    Dim i_loop As Long
    'Dim row As Integer
    
    y_cnt = 0
    
    If cont_num > 250 And sample_num = 0 And CheckBox1.Value = True Then
        sample_num = 250
    End If
    If sample_num > cont_num Or sample_num = 0 Then
        sample_num = cont_num
    End If
        
    If sample_num > 1 Then
        For i_loop = 0 To cont_num - 2
            If (i_loop + 1) = (Int(y_cnt * (cont_num - 1) / (sample_num - 1)) + 1) Then
                sample_flg(i_loop) = True
                y_cnt = y_cnt + 1
            Else
                sample_flg(i_loop) = False
            End If
            'y_cnt = y_cnt + 1
    '        MsgBox i_loop + 1 & "|fffd||fffd||682||fffd|" & sample_flg(i_loop)
        Next i_loop
        sample_flg(cont_num - 1) = True
'    MsgBox i_loop + 1 & "|fffd||fffd||682||fffd|" & sample_flg(i_loop)
    ElseIf sample_num = 1 Then
        sample_flg(0) = True
    End If
    
End Sub
Public Sub blank_check()

    If TextBox_kurikaishikaisu.Text = "" Or TextBox_sample_num.Text = "" Then
        blank_check_flg = False
        If TextBox_kurikaishikaisu.Text = "" Then
            MsgBox "Please input Repeat Count.", vbExclamation, OBI_STR
            'MsgBox "|fffd|J|fffd||502||fffd||fffd||50502||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B", vbExclamation, OBI_STR
        ElseIf TextBox_sample_num.Text = "" Then
            MsgBox "Please input Sampling Number.", vbExclamation, OBI_STR
            'MsgBox "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B", vbExclamation, OBI_STR
        End If
    ElseIf TextBox_kurikaishikaisu.Text <> "" And TextBox_sample_num.Text <> "" Then
        blank_check_flg = True
    End If

End Sub

Public Sub array_initialize()
    Dim i As Long
    
    For i = 0 To 9999
        max_load(i) = 0
        min_load(i) = 0
        
        
        p_nodata_flg(i) = 0
        m_nodata_flg(i) = 0
        
        
        max_load_cell(i) = 0
        M_max_load(i) = 0
        M_min_load(i) = 0
        M_max_load_cell(i) = 0
        
        ave_load(i) = 0
        sample_flg(i) = False
    Next
End Sub

Public Sub communication_error()
    main_frm_fgt.state_lbl.BackColor = &H0&
    main_frm_fgt.state_lbl.ForeColor = &HFF&
    main_frm_fgt.state_lbl.Caption = "Communication Error"
    'main_frm_fgt.state_lbl.Caption = "|fffd||290|M|fffd||64f||fffd|"
    CloseHandle (hComm)
End Sub

Public Sub cell_chk()
    If ActiveSheet.Cells.Column >= 256 Then
        outp_mdl_e.Sheet_move
    End If
End Sub
Attribute VB_Name = "main_mdl_e"
Option Explicit

'**************************
'   |fffd||fffd||fffd|W|fffd||fffd||fffd|[|fffd||fffd||fffd||50b||fffd||fffd|L|fffd||8414|
'**************************
' |fffd|o|fffd|[|fffd|W|fffd||fffd||fffd||fffd|
Public Const XLANAME_K = "FGT-VC_EN"
Public Const VERSION_K = "Ver1.04"
Public Const INFO = "Version"
Public Const URL = "URL: http://www.nidec-shimpo.co.jp"
Public Const CORP = "Copyright(C) Nidec-Shimpo Corporation 2012. All Rights Reserved. "

Public Const USA = 1
Public Const NSCA_V103 = 1
Public Const NSCA_V104 = 1

'|fffd|\|fffd||fffd||fffd|F|fffd|R|fffd|[|fffd|h
Public Const COLOR_FLESH = &HC0E0FF
Public Const COLOR_GREEN = &HFF00&
Public Const COLOR_RED = &HFF&
Public Const COLOR_YELLOW = &HFFFF&
Public Const COLOR_BLUE = &HFF0000

'|fffd||fffd||fffd|M|fffd|R|fffd|}|fffd||fffd||fffd|h

Public Const GENERIC_READ = &H80000000
Public Const GENERIC_WRITE = &H40000000
Public Const OPEN_EXISTING = 3

Public Const SZA = "SZA"        '|fffd|f|fffd|[|fffd|^|fffd||fffd|M
Public Const SZB = "SZB"        '|fffd||fffd||fffd|[|fffd|N|fffd|f|fffd|[|fffd|^|fffd||fffd|M
Public Const SZC = "SZC"
Public Const SZD = "SZD"
Public Const SZE = "SZE"
Public Const SZF = "SZF"
Public Const SSE = "SSE"        '|fffd||fffd||fffd||fffd|I|fffd||fffd|
Public Const SSA = "SSA"        '|fffd||fffd||fffd||84ee||fffd||fffd|J|fffd|n
Public Const SSB = "SSB"        '|fffd||fffd||fffd||84ee||fffd||fffd||fffd|~
Public Const TBC = "TBC"        '|fffd|^|fffd||fffd||fffd|v|fffd||fffd|
Public Const SNE = "SNE"        '|fffd|^|fffd||fffd||fffd||fffd|M
Public Const SQW = "SQW"        '|fffd|Z|fffd||fffd||fffd||50d||fffd||fffd||752||fffd|
Public Const SEA = "SEA"
Public Const OB = "OB"          '|fffd||fffd|M|fffd||fffd||fffd||fffd||fffd|G|fffd||fffd||fffd|[|fffd||fffd||fffd|M|fffd||fffd|
Public Const SBW = "SBW"
Public Const SPT = "SPT"        '|fffd||fffd||fffd||fffd|I|fffd||fffd|
Public Const PTW = "PTW"        '|fffd||fffd||fffd||fffd||752||fffd|
Public Const POW = "POW"        '|fffd||fffd||fffd||fffd||752||fffd|
Public Const SOA = "SOA"        '|fffd||fffd||fffd|_|fffd||fffd||fffd|A|fffd||fffd||fffd||fffd|J|fffd|n
Public Const SOB = "SOB"        '|fffd||fffd||fffd|_|fffd||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd|~
Public Const SOE = "SOE"        '|fffd||fffd||fffd|_|fffd||fffd||fffd|A|fffd||fffd||fffd||c2ae||fffd||fffd|
Public Const TAA = "TAA"        '|fffd||fffd||fffd||708||fffd||fffd||fffd||fffd||fffd||fffd|s
Public Const TAE = "TAE"        '|fffd|s|fffd|[|fffd|N|fffd||fffd||fffd|Z|fffd|b|fffd|g|fffd||fffd||fffd|s
Public Const SRW = "SRW"        '|fffd|P|fffd||281|A|fffd||fffd||fffd||fffd|
Public Const SRR = "SRR"        '|fffd|P|fffd||281|A|fffd||fffd||fffd||fffd|
Public Const SPW = "SPW"        '|fffd||fffd||fffd||c0c2||fffd|[|fffd|h|fffd||3cd|X
Public Const POR = "POR"        '|fffd||510|M
Public Const PTR = "PTR"        '|fffd||510|M
Public Const SER = "SER"
Public Const SSD = "SSD"
Public Const SSC = "SSC"
Public Const TBD = "TBD"
Public Const TET = "TET"
Public Const TDz = "TDz"
Public Const SZY = "SZY"
Public Const SZZ = "SZZ"
Public Const TNH = "TNH"
Public Const TNE = "TNE"
Public Const SAA = "SAA"
Public Const SAI = "SAI"
Public Const SAJ = "SAJ"
Public Const DPAR = "DPAR"
Public Const DCR = "DCR"



'#If NSCA_V103 = 1 Then

Public Const TBE = "TBE"        '|fffd||fffd||fffd||fffd||fffd|P|fffd||297|v|fffd||fffd|

Public Const MM_UNIT = 0
Public Const INCH_UNIT = 1


'#End If

'|fffd||fffd||fffd||311||fffd||fffd||8414|
Public Const FRE_10 = "10times/sec"  'FRE_10 = "10|fffd||fffd|/|fffd|b"
Public Const FRE_20 = "20times/sec"  'FRE_20 = "20|fffd||fffd|/|fffd|b"
Public Const FRE_50 = "50times/sec"  'FRE_50 = "50|fffd||fffd|/|fffd|b"
Public Const FRE_100 = "100times/sec"  'FRE_100 = "100|fffd||fffd|/|fffd|b"
Public Const FRE_STR = "times/sec"  'FRE_STR = "|fffd||fffd|/|fffd|b"
       
Public Const UNI_N = "N|fffd|n|fffd|P|fffd||fffd|"
Public Const UNI_KG = "kg|fffd|n|fffd|P|fffd||fffd|"
Public Const N_STR = "N"
Public Const KG_STR = "kg"
Public Const G_STR = "g"
Public Const OZ_STR = "oz"
Public Const LB_STR = "lb"

Public Const COM1 = "COM1"
Public Const COM2 = "COM2"
Public Const COM3 = "COM3"
Public Const COM4 = "COM4"
Public Const COM5 = "COM5"
Public Const COM6 = "COM6"
Public Const COM7 = "COM7"
Public Const COM8 = "COM8"
Public Const COM9 = "COM9"
Public Const COM10 = "COM10"
Public Const COM11 = "COM11"
Public Const COM12 = "COM12"
Public Const COM13 = "COM13"
Public Const COM14 = "COM14"
Public Const COM15 = "COM15"

Public Const FGP02 = "FGP-0.2"
Public Const FGP05 = "FGP-0.5"
Public Const FGP1 = "FGP-1"
Public Const FGP2 = "FGP-2"
Public Const FGP5 = "FGP-5"
Public Const FGP10 = "FGP-10"
Public Const FGP20 = "FGP-20"
Public Const FGP50 = "FGP-50"
Public Const FGP100 = "FGP-100"
Public Const FGC100HB = "FGC-100HB"
Public Const FGC150HB = "FGC-150HB"
Public Const FGC250HB = "FGC-250HB"
Public Const FGC500HB = "FGC-500HB"

Public Const TOUKEI_START_CELL = 21
Public Const KEISOKU = 0
Public Const TOUKEI = 1
Public Const DATA_START = 24

Public Const HAKURI_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
Public Const LEAK_STR = "|fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd|"
Public Const HAKAI_STR = "|fffd|j|fffd||ce38c||fffd|"
Public Const ATUHIKI_STR = "|fffd||fffd||fffd|k|fffd|E|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"

Public Const PULL_STR = "PULL"
Public Const PUSH_STR = "PUSH"

Public Const TOUKEI_STR = "|fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g"

Public Const HAKURI_TOUKEI_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g"
Public Const LEAK_TOUKEI_STR = "|fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g"
Public Const HAKAI_TOUKEI_STR = "|fffd|j|fffd||ce38c||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g"
Public Const ATUHIKI_TOUKEI_STR = "|fffd||fffd||fffd|k|fffd|E|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g"

Public Const DATA_CNT_STR = "Number of data"  'DATA_CNT_STR = "|fffd|f|fffd|[|fffd|^|fffd||fffd|"



Public Const HENI_STR = "Distance(mm)"  'HENI_STR = "|fffd||3c8||281|imm) "
Public Const HENI_STR_INCH = "Distance(inch)"  'HENI_STR = "|fffd||3c8||281|iinch) "



Public Const HAKURIRYOKU_STR = "|fffd||fffd||fffd||fffd||fffd||fffd|"
Public Const KAJYU_STR = "Force"  'KAJYU_STR = "|fffd||5cf|d"
Public Const HEIKIN_STR = "|fffd||fffd||fffd||3c9||5cf|d"
Public Const SAIDAI_STR = "Maximum Force"  'SAIDAI_STR = "|fffd||151||fffd||5cf|d|fffd|l"
Public Const SAIDAI_ICH_STR = "|fffd||151||fffd||5cf|d|fffd||292|u(mm)"
Public Const SAIDAI_DATA_STR = "|fffd||151||fffd||5cf|d|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd|"
Public Const SAISYOU_STR = "Minimum Force"  'SAISYOU_STR = "|fffd||14f||fffd||fffd||5cf|d|fffd|l"
Public Const SAISYOU_ICH_STR = "|fffd||14f||fffd||fffd||5cf|d|fffd||292|u(mm)"
Public Const SAISYOU_DATA_STR = "|fffd||14f||fffd||fffd||5cf|d|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd|"
Public Const HENSA_STR = "Standard Deviation"  'HENSA_STR = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
Public Const HANTEI_STR = "Result"  'HANTEI_STR = "|fffd||fffd||fffd||fffd|"
Public Const NO_HANTEI_STR = "Invalid"  'NO_HANTEI_STR = "|fffd||fffd||fffd||fffd||202||fffd|"
Public Const NG_STR = "NG"
Public Const OK_STR = "OK"
Public Const HAKAI_KAJYU_STR = "|fffd|j|fffd||fffd||5cf|d"
Public Const HAKAI_KAJYU_ICH_STR = "|fffd|j|fffd||fffd||5cf|d|fffd||292|u(mm)"

Public Const TEST_DAY_STR = "Date"  'TEST_DAY_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
Public Const SHAIN_STR = "|fffd||fffd||fffd||fffd||fffd|"

Public Const KANRI_STR = "|fffd||1d7||fffd||fffd||50d||fffd|"
Public Const OND_STR = "|fffd||fffd||fffd|x (|fffd||fffd|)"
Public Const SHITUDO_STR = "|fffd||fffd||fffd|x (%)"
Public Const BIKOU_STR = "|fffd||fffd||fffd|l"
Public Const TORIKOMI_SYUKI_STR = "Sampling Rate"  'TORIKOMI_SYUKI_STR = "|fffd||635e||fffd||fffd||fffd||fffd|"
Public Const SEL_NUM_STR = "SEL No."  'SEL_NUM_STR = "SEL|fffd||50d||fffd|"
Public Const TEST_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
Public Const TEST_SPEED_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|x(mm/min)"
Public Const MOVE_DIST_STR = "|fffd||693||fffd||fffd||fffd||fffd||fffd|(mm)"
Public Const MAX_LIMIT_STR = "Upper limit"  'MAX_LIMIT_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
Public Const MIN_LIMIT_STR = "Lower limit"  'MIN_LIMIT_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
Public Const CAL_START_POSITION = "|fffd|Z|fffd|o|fffd|J|fffd|n|fffd||292|u(mm)"
Public Const CAL_END_POSITION = "|fffd|Z|fffd|o|fffd|I|fffd||fffd||fffd||292|u(mm)"
Public Const PULLPUSH_STR = "Direction"  'PULLPUSH_STR = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"

Public Const STRT_LIMIT_STR = "|fffd|v|fffd||fffd||fffd|J|fffd|n(mm)"
Public Const STOP_LIMIT_STR = "|fffd|v|fffd||fffd||fffd|I|fffd||fffd|(mm)"
Public Const DEST_END_PER_STR = "|fffd|j|fffd||fffd|I|fffd||fffd||fffd||5cf|d|fffd||fffd|(%)"
Public Const LEAK_LOAD_STR = "|fffd||fffd||fffd|[|fffd|N|fffd||5cf|d"
Public Const BEFORE_LOAD_STR = "|fffd||fffd||fffd|x|fffd||611||589||5cf|d|fffd||fffd|(%)"
Public Const LEAK_TIME_SEC_STR = "|fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd|(sec)"
Public Const BEFORE_LEAK_SPEED_STR = "|fffd||fffd||fffd|[|fffd|N|fffd|O|fffd||fffd||fffd|x(mm/min)"
Public Const HOME_SPEED_STR = "|fffd||fffd||fffd|_|fffd||fffd||fffd|A|fffd||fffd||fffd|x(mm/min)"
Public Const HOME_POINT_STR = "|fffd||fffd||fffd|_|fffd||292|u(mm)"
Public Const ZERO_SPEED_STR = "|fffd|[|fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd|x(mm/min)"
Public Const ZERO_LOAD_STR = "|fffd|[|fffd||fffd||fffd||fffd||fffd|o|fffd||5cf|d"
Public Const TUCH_LOAD_STR = "|fffd||690|G|fffd||fffd||fffd|o|fffd||5cf|d"
Public Const RETURN_STR = "|fffd||7c2||84ee||fffd||fffd|"
Public Const STATE_KEISOKU_STR = "|fffd|v|fffd||fffd||fffd||fffd|"
Public Const STATE_TEISI_STR = "Available"  'STATE_TEISI_STR = "|fffd||fffd|~|fffd||fffd|"
Public Const STATE_FUKA_STR = "|fffd|v|fffd||fffd||fffd|s|fffd||fffd|"
Public Const STATE_HOME_STR = "|fffd||fffd||fffd|_|fffd||fffd||fffd|A|fffd||fffd|"
Public Const BANGOU_STR = "|fffd||50d||fffd|"
Public Const KEISOKUSHEET_STR = "Sheet"  'KEISOKUSHEET_STR = "|fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g"
Public Const ON_STR = "ON"
Public Const OFF_STR = "OFF"

Public Const CSV_FILE_STR = "CSV|fffd|t|fffd|@|fffd|C|fffd||fffd|(*.csv),*.csv"
Public Const CSV_PARAMETER_STR = "CSV_parameter_1.csv"
Public Const CSV_SELECT_STR = "CSV|fffd|t|fffd|@|fffd|C|fffd||fffd||fffd|I|fffd||fffd|"
Public Const CSV_SAVE_STR = "CSV|fffd|t|fffd|@|fffd|C|fffd||fffd| |fffd||6d1||fffd||fffd||fffd||30e|w|fffd||fffd|"

'************************
'|fffd||fffd||fffd|j|fffd|`|fffd||fffd||fffd|[|fffd||fffd||fffd|p|fffd||1c9||fffd|081113
'************************
Public Const SAMPLE = "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd|"
Public Const SAMPLE_CHANGE_LBL = "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd||3cd|X"
Public Const PLACE_SET = "|fffd||fffd||fffd||fffd||a3ca||fffd|Z|fffd|b|fffd|g|fffd||fffd|"
Public Const PLACE_SET_CHANGE_LBL = "|fffd||fffd||fffd||fffd||a3ca||fffd|Z|fffd|b|fffd|g|fffd||fffd||fffd||3cd|X"
Public Const TEST_PLACE = "|fffd||fffd||fffd||fffd||a3ca||fffd||fffd|"
Public Const TEST_PLACE_CHANGE_LBL = "|fffd||fffd||fffd||fffd||a3ca||fffd||fffd||fffd||3cd|X"
Public Const PASS = "suncs013"
Public Const LOCK_ON = "|fffd||3cd|X|fffd||fffd||fffd|b|fffd|NON"
Public Const LOCK_OFF = "|fffd||3cd|X|fffd||fffd||fffd|b|fffd|NOFF"
Public Const TEST_NO = "|fffd||fffd||fffd||fffd||fffd||50d||fffd|"
Public Const ITEM = "|fffd||fffd||fffd||fffd|"
Public Const AVG_STR = "Average"  'AVG_STR = "|fffd||fffd||fffd||3d2|l"
Public Const MAX_STR = "Maximum"  'MAX_STR = "|fffd||151||fffd|l"
Public Const MIN_STR = "Minimum"  'MIN_STR = "|fffd||14f||fffd||fffd|l"
Public Const HIGH_STR = "HIGH"
Public Const LO_STR = "LO"
Public Const fg_type = "|fffd|^|fffd||fffd||fffd||fffd||fffd|"
Public Const UNIT_N = "(N)"
Public Const UNIT_g = "(g)"
Public Const UNIT_kg = "(kg)"
Public Const JOGAI_STR = "|fffd||fffd||fffd|O|fffd|f|fffd|[|fffd|^|fffd|I|fffd||fffd|"
Public Const TEST_END_POSITION = "|fffd|v|fffd||fffd||fffd|I|fffd||fffd||fffd||292|u"
Public Const name_none = "NONE"
'************************




Public Const OBI_STR = "FGT-VC"

'|fffd|f|fffd|[|fffd|^|fffd|o|fffd|b|fffd|t|fffd|@
Public Const DAT_BUF_SIZ = 7                '|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[|fffd|o|fffd|b|fffd|t|fffd|@|fffd|T|fffd|C|fffd|Y
'|fffd|^|fffd|C|fffd|}|fffd||fffd||fffd||fffd|
Public Const K_TIMER = 10                   '|fffd|^|fffd|C|fffd|}|fffd|C|fffd|x|fffd||fffd||fffd|g|fffd||50a|u100ms

'|fffd||fffd||fffd|b|fffd|Z|fffd|[|fffd|W|fffd|p
Public Const MES1 = "|fffd|V|fffd|K|fffd|u|fffd|b|fffd|N|fffd||fffd||fffd||c42c||fffd||fffd||fffd||702||fffd||fffd|B"
Public Const MES2 = "FILE|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES3 = "SETUP_CSV|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES4 = "Making "  'MES4 = "|fffd||24b|L|fffd|^|fffd||fffd||fffd||702||fffd||fffd|B"
Public Const MES5 = "|fffd||fffd||fffd|M|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B"
Public Const MES6 = "An error is occurred."  'MES6 = "|fffd||fffd||80aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|B"
Public Const MES7 = "The device is not opened, please check the COM port."  'MES7 = "|fffd|f|fffd|o|fffd|C|fffd|X|fffd||fffd||fffd|J|fffd||fffd||fffd||fffd||102||fffd||fffd||702||fffd||fffd||fffd|BCOM|fffd|||fffd|[|fffd|g|fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES8 = "|fffd||313||fffd||fffd||352|l|fffd||fffd||fffd|s|fffd||fffd||fffd||142||fffd||fffd|B"
Public Const MES9 = "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd|M|fffd||24e||fffd||fffd|s|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|B"
Public Const MES10 = "|fffd||691||fffd||fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES11 = "Data exceed the capacity in one sheet, measuring stopped."  'MES11 = "1Sheet|fffd||24a|i|fffd|[|fffd||142||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||348||342||12d02||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|v|fffd||fffd||fffd||1218e|~|fffd||fffd||fffd||702||fffd||fffd|B"
Public Const MES12 = "|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||508||10a2||fffd||142||fffd||fffd|B"
Public Const MES13 = "SEL|fffd||50d||fffd||fffd||fffd||fffd||348||34a|O|fffd||142||fffd||fffd|B"
Public Const MES14 = "|fffd||752||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES15 = "|fffd||fffd||fffd||fffd|s|fffd||82||142||fffd||fffd|B"
Public Const MES16 = "|fffd|A|fffd||fffd||fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||142||fffd||fffd|B"
Public Const MES17 = ".csv|fffd||24f||fffd||fffd||fffd||fffd||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES18 = "|fffd||752||fffd|l|fffd||fffd||fffd|s|fffd||fffd||fffd||142||fffd||fffd|B|fffd||fffd||fffd||fffd||fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES19 = ".csv|fffd||fffd||1c2||74d||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES20 = "|fffd||fffd||fffd||303|t|fffd|@|fffd|C|fffd||fffd||fffd||242||355|s|fffd||fffd||fffd||210||752||fffd|l|fffd||fffd||fffd||702||702||fffd||102||fffd||fffd||702||fffd||fffd|B|fffd||fffd||fffd||303|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd||fffd||752||fffd|l|fffd||fffd||1c2||74d||fffd||fffd||782||fffd||fffd||182||34f|o|fffd||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES21 = "CSV_first_option.csv|fffd||fffd||1c2||74d||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES22 = "CSV_first_option.csv|fffd||24f||fffd||fffd||fffd||fffd||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES23 = "CSV_option.csv|fffd||fffd||1c2||74d||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES24 = "CSV_option.csv|fffd||24f||fffd||fffd||fffd||fffd||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES25 = "|fffd||c42c||fffd||fffd||fffd||fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||d3dc||fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|H"
Public Const MES26 = "|fffd||341|@"
Public Const MES27 = " to "  'MES27 = "|fffd|`"
Public Const MES28 = "Please input from "  'MES28 = "|fffd|l|fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES29 = "Sheet|fffd||fffd||fffd||30f||fffd||fffd||fffd||fffd||fffd||fffd|s|fffd||fffd||fffd||142||fffd||fffd|B"
Public Const MES30 = "|fffd|V|fffd|K|fffd||243|u|fffd|b|fffd|N|fffd||fffd||fffd|J|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES31 = "SETUP_CSV|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||fffd|"
Public Const MES32 = "|fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES33 = "Failed communication with FGS-VC, please check the connection and power supply."  'MES33 = "FGS|fffd||VC|fffd||182||312||290|M|fffd||24e||fffd||fffd|s|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd||691||fffd||fffd|y|fffd||453|d|fffd||fffd||fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||109||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES34 = "|fffd|y|fffd||443|t|fffd|H|fffd|[|fffd|X|fffd|Q|fffd|[|fffd|W|fffd||303|{|fffd|[|fffd||fffd||fffd|[|fffd|g|fffd||752||fffd|(|fffd|t|fffd|@|fffd||fffd||fffd|N|fffd|V|fffd||fffd||fffd||fffd||fffd||752||fffd|F04)|fffd||fffd||fffd|m|fffd|F|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES35 = "Irregular setting"  'MES35 = "|fffd||fffd||fffd||30f||fffd||fffd||fffd||fffd||142||353||fffd||fffd||342||142||fffd||fffd||702||fffd||fffd||fffd|"
Public Const MES36 = "<"
Public Const MES37 = ">"

'***********************
'|fffd||fffd||fffd|j|fffd|`|fffd||fffd||fffd|[|fffd||fffd||fffd|p|fffd||1c9||fffd|
'***********************
Public Const MES38 = "CSV_sample_name.csv|fffd||fffd||1c2||74d||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES39 = "CSV_sample_name.csv|fffd||24f||fffd||fffd||fffd||fffd||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES40 = "CSV_place_set.csv|fffd||fffd||1c2||74d||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES41 = "CSV_place_set.csv|fffd||24f||fffd||fffd||fffd||fffd||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES42 = "CSV_test_place.csv|fffd||fffd||1c2||74d||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES43 = "CSV_test_place.csv|fffd||24f||fffd||fffd||fffd||fffd||fffd||fffd||7c2||702||fffd||fffd||fffd|B"
Public Const MES44 = "|fffd|p|fffd|X|fffd||fffd||fffd|[|fffd|h|fffd||fffd||fffd||10a2||fffd||702||fffd||fffd|B"
Public Const MES45 = "|fffd|p|fffd|X|fffd||fffd||fffd|[|fffd|h|fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES46 = "|fffd||48f|W|fffd||142||fffd||fffd||fffd|"
Public Const MES47 = "|fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES48 = "|fffd|v|fffd|Z|fffd||fffd||fffd||73dc||fffd|O|fffd||fffd||fffd||fffd|s|fffd||fffd|I|fffd||fffd||fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES49 = "|fffd||303|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd||702||fffd||fffd|B"
Public Const MES50 = "|fffd||fffd||fffd||30d|s|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|H"
Public Const MES51 = "|fffd||303|f|fffd|[|fffd|^|fffd||34f||fffd||fffd|O|fffd||3c2||742||142||fffd||fffd|B"
Public Const MES52 = "|fffd|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g|fffd||64f||fffd||142||fffd||fffd|B"
Public Const MES53 = "|fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd||30b|L|fffd||fffd||fffd||94|\|fffd||fffd||fffd||fffd||fffd||12d09||7c2||fffd||fffd||702||fffd||fffd||fffd||fffd|B|fffd|V|fffd|K|fffd|u|fffd|b|fffd|N|fffd||fffd||fffd|J|fffd||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES54 = "|fffd|I|fffd||fffd||fffd||142||fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES55 = "|fffd|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g|fffd||64f||fffd||302||fffd||fffd||7c1|A|fffd|I|fffd||fffd||fffd||142||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES56 = "|fffd|d|fffd||2cd||fffd||fffd||d0b9||fffd|I|fffd||12182||142||fffd||fffd|B|fffd||fffd||fffd|O|fffd||fffd||fffd||102||fffd||fffd||fffd||b0b5||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|H"
Public Const MES57 = "|fffd||fffd||fffd||fffd||fffd||50d||fffd||fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES58 = "|fffd||fffd|"
Public Const MES59 = "|fffd|V|fffd|[|fffd|g|fffd||fffd|I|fffd||fffd||fffd||142||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES60 = "|fffd|u|fffd|b|fffd|N|fffd||fffd|I|fffd||fffd||fffd||142||fffd||fffd||702||fffd||fffd||fffd|B"
Public Const MES61 = "|fffd||fffd||fffd||fffd||342||fffd||fffd||102||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B"
Public Const MES63 = "|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd|s|fffd||fffd||fffd||142||fffd||fffd|B"
Public Const MES64 = "|fffd|N|fffd||fffd||fffd||fffd||fffd||303|u|fffd|b|fffd|N|fffd||fffd||fffd||188||642||202||fffd||702||fffd||fffd|B|fffd|v|fffd||fffd||fffd||11c4d|s|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|H"
Public Const MES65 = "|fffd|O|fffd||fffd||fffd|t|fffd||153||fffd||fffd||342||142||fffd||fffd||fffd|1|fffd|n|fffd||fffd||303|f|fffd|[|fffd|^|fffd|v|fffd|f|fffd||fffd||fffd||12d09||7c2||fffd||fffd||702||fffd||fffd||fffd||fffd|B"

Public Const MES66 = "Irregular setting|fffd|FUpper limit < Lower limit."  'MES66 = "|fffd||fffd||fffd||30f||fffd||fffd||fffd||fffd||142||353||fffd||fffd||342||142||fffd||fffd||702||fffd||fffd||fffd|F|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l < |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l|fffd|B"
Public Const MES67 = "Irregular setting|fffd|FRepeat Count < Sampling Number."  'MES67 = "|fffd||fffd||fffd||30f||fffd||fffd||fffd||fffd||142||353||fffd||fffd||342||142||fffd||fffd||702||fffd||fffd||fffd|F|fffd|J|fffd||502||fffd||fffd||fffd| < |fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd||fffd|B"


'NSCA_V104
Public Const FGT_VC_D = "C:\FGT-VC_EN"
Public Const FGT_VC_FILE = "\FILE"
Public Const INI_FILE = "\fgt-vc.ini"
Public Const INI_FILE_NAME = "fgt-vc.ini"



'**************************
'   |fffd||fffd||fffd|W|fffd||fffd||fffd|[|fffd||fffd||fffd||50b||fffd||fffd|L|fffd||3d0||fffd|
'**************************

Public g_buf_data(DAT_BUF_SIZ) As String    ' |fffd|f|fffd|[|fffd|^|fffd|i|fffd|[|fffd||fffd|
Public move_data(1050000) As Double           ' |fffd||693||fffd||fffd||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd|i|fffd|[(|fffd||3c8||fffd|)
Public move_data_zero(1050000) As Double      ' |fffd|[|fffd||fffd||fffd|_|fffd||fffd||fffd||fffd||30b||fffd||fffd||fffd||fffd|f|fffd|[|fffd|^|fffd|i|fffd|[|fffd|iREN|fffd||1c9||fffd|090310|fffd|j
Public weight_data(1050000) As Double         ' |fffd||5cf|d|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[
Public g_stop As Boolean                    ' |fffd|\|fffd||fffd||fffd||fffd|~
Public Sheet_del As Boolean                 ' |fffd||fffd||fffd|[|fffd|N|fffd|V|fffd|[|fffd|g|fffd||33d1||fffd||fffd||fffd||fffd||fffd||fffd||3d0||fffd|
Public Sheet_max As Boolean                 ' |fffd||fffd||fffd|[|fffd|N|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||151||fffd|l|fffd||fffd||fffd||fffd||3d0||fffd|
Public data_cnt As Long                     ' |fffd||fffd||fffd||311||fffd||fffd||fffd||303|f|fffd|[|fffd|^|fffd||fffd|(|fffd|G|fffd|N|fffd|Z|fffd||fffd||fffd|s|fffd||fffd|)
Public limit_jdg As Integer                 ' |fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd|
Public next_sheet_flg As Boolean            ' |fffd|V|fffd|[|fffd|g|fffd||693||fffd||fffd||fffd||fffd||fffd|p|fffd||3d0||fffd|
Public long_buf As String                   ' |fffd|o|fffd|b|fffd|t|fffd|@|fffd||fffd||fffd|e|fffd||a39e||fffd|i|fffd|[|fffd|p
Public first_Z As Boolean                   ' |fffd||14f||fffd||fffd||fffd|Z|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||fffd||fffd||fffd|M|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|o
Public book_open As Integer                 ' |fffd|u|fffd|b|fffd|N|fffd||317|L|fffd||fffd||fffd||fffd||fffd||fffd|p|fffd||3d0||fffd|
Public File_name As String                  ' |fffd|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd|
Public File_name_num As String              ' |fffd|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd||318|A|fffd||fffd|
Public B_start As Long                      ' B|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||303|f|fffd|[|fffd|^|fffd||30d||14f||fffd||fffd||303|Z|fffd||fffd||fffd||30d||fffd||fffd|W
Public B_stop As Long                       ' B|fffd|R|fffd|}|fffd||fffd||fffd|h|fffd||303|f|fffd|[|fffd|^|fffd||fffd||fffd|I|fffd||fffd||fffd||fffd||fffd||fffd|Z|fffd||fffd||fffd||30d||fffd||fffd|W
Public first_start_limit_over As Boolean    ' |fffd|v|fffd||fffd||fffd|J|fffd|n|fffd||292|u|fffd|t|fffd||fffd||fffd|O
Public sub_data_cnt As Long                 ' |fffd|S|fffd|f|fffd|[|fffd|^|fffd|J|fffd|E|fffd||fffd||fffd|g
Public before_hcomm As Long                 ' hcom|fffd|n|fffd||fffd||fffd|h|fffd||fffd||fffd|l
Public cmd_retry As Integer                 ' |fffd||fffd||fffd|g|fffd||fffd||fffd|C|fffd|J|fffd|E|fffd||fffd||fffd|g
Public fg_type_num As String                ' FG|fffd||303|^|fffd|C|fffd|v|fffd|l
Public input_point_len As Integer           ' |fffd||fffd||fffd||fffd||fffd|_|fffd||292|u
Public input_max_lange As Double            ' |fffd||fffd||fffd||349||94|\|fffd||348||fffd|MAX |fffd|i|fffd||fffd|j
Public input_2_min  As Double               ' |fffd||fffd||fffd||349||94|\|fffd||348||fffd|MIN |fffd|i|fffd||fffd||fffd|j
Public input_2_max As Double                ' |fffd||fffd||fffd||349||94|\|fffd||348||fffd|MAX |fffd|i|fffd||fffd||fffd|j
Public range_error As String                ' |fffd||fffd||fffd|M|fffd|p|fffd||fffd||fffd||fffd||fffd|[|fffd|^|fffd||348||343|G|fffd||fffd||fffd|[|fffd|p|fffd||3d0||fffd|
Public send_end As Boolean                  ' |fffd||fffd||fffd|M|fffd||fffd||fffd||fffd||fffd|t|fffd||fffd||fffd|O
Public start_limit_val As Double            ' |fffd||fffd||fffd||fffd|J|fffd|n|fffd||292|u(start_limit|fffd||312|l|fffd||fffd||fffd|i|fffd|[)
Public stop_limit_val As Double             ' |fffd||fffd||fffd||fffd||fffd|~|fffd||292|u(stop_limit|fffd||312|l|fffd||fffd||fffd|i|fffd|[)
Public dummy_handle As Variant              ' |fffd|_|fffd|~|fffd|[|fffd|n|fffd||fffd||fffd|h|fffd||fffd|
Public indicate_unit As String              ' |fffd|\|fffd||fffd||fffd|P|fffd||fffd|

'|fffd||fffd||fffd|v|fffd|p|fffd||3d0||fffd|
Public weight_avg As Double                 ' |fffd||fffd||fffd||fffd||5cf|d|fffd||fffd||fffd||3d2|l
Public max_gf As Double                     ' |fffd||151||fffd|l
Public min_gf As Double                     ' |fffd||14f||fffd||fffd|l

'if USA
Public M_max_gf As Double
Public M_min_gf As Double
'endif

Public dest_gf As Double                    ' |fffd|j|fffd||fffd||5cf|d
Public max_data_cnt As Long                 ' |fffd||151||fffd|l|fffd||fffd|No
Public min_data_cnt As Long                 ' |fffd||14f||fffd||fffd|l|fffd||fffd|No
Public max_move_gf As Double                ' |fffd||151||fffd||5cf|d|fffd||292|u
Public min_move_gf As Double                ' |fffd||14f||fffd||fffd||5cf|d|fffd||292|u
Public w_varp As Double                     ' |fffd|W|fffd||fffd||fffd||38d||fffd|


'|fffd||fffd||fffd||290||752||fffd|p|fffd||3d0||fffd|
Public sel_val As Integer                   ' |fffd|Z|fffd||fffd||fffd||50d||fffd|
Public test_name_num As Integer             ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public test_speed_val As Double             ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|x

Public move_dist_val As Double              ' |fffd||693||fffd||fffd||fffd||fffd||fffd|
Public max_limit As Double                  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|l
Public min_limit As Double                  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l


'#If USA = 1 Then

Public M_max_limit As Double                 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|l
Public M_min_limit As Double                 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l

'#End If

Public pull_push_flg As Integer             ' |fffd||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd|t|fffd||fffd||fffd|O

Public torikomi_num As Integer              ' |fffd||fffd||835e||fffd||74e||fffd||fffd||fffd|
Public unit_num As Integer                  ' |fffd|P|fffd||281|@0:N,1:kg,2:lb,3:Oz
Public com_port_num As Integer              ' COM|fffd|||fffd|[|fffd|g|fffd||50d||fffd|

Public kiten_num As Integer                 ' |fffd||fffd|_|fffd||292|u
Public home_speed_val As Double             ' |fffd||fffd||fffd|_|fffd||fffd||fffd|A|fffd||fffd||fffd|x
Public home_point_val As Double             ' |fffd||fffd||fffd|_|fffd||292|u

Public zero_load As Double                  ' |fffd|[|fffd||fffd||fffd||fffd||fffd|o|fffd||5cf|d
Public zero_speed As Double                 ' |fffd|[|fffd||fffd||fffd||fffd||fffd|o|fffd||fffd||fffd|x
Public tuch_load As Double                  ' |fffd||690|G|fffd||fffd||fffd|o|fffd||5cf|d

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|p|fffd||3d0||fffd|
Public start_limit As Double                ' |fffd||fffd||fffd||fffd|J|fffd|n|fffd||292|u
Public stop_limit As Double                 ' |fffd||fffd||fffd||fffd||fffd|~|fffd||292|u

'|fffd|j|fffd||ce38c||fffd||fffd|p|fffd||3d0||fffd|
Public dest_end_per As Double               ' |fffd||14f|I|fffd|j|fffd||fffd|
Public return_val As Integer                ' |fffd||7c2||84ee||fffd||fffd|ON/OFF

'|fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd||fffd|p|fffd||3d0||fffd|
Public leak_load As Double                  ' |fffd||fffd||fffd|[|fffd|N|fffd||5cf|d
Public before_load As Double                ' |fffd||fffd||fffd|[|fffd|N|fffd|O|fffd||5cf|d
Public leak_time_sec As Long                ' |fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd|(|fffd|b)
Public all_leak_time As Long                ' |fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(X|fffd||fffd|)
Public before_leak_speed As Double          ' |fffd||fffd||fffd|[|fffd|N|fffd|O|fffd||fffd||fffd|x

'|fffd||fffd||fffd|k|fffd|E|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|p|fffd||3d0||fffd|
Public return_val_2 As Integer              ' |fffd||7c2||84ee||fffd||fffd|ON/OFF

Public mk_fig_job As Integer                ' |fffd|O|fffd||fffd||fffd|t|fffd||c42c||fffd|p|fffd||3d0||fffd|
Public SER_flg As Boolean                   ' |fffd|G|fffd||fffd||fffd|[|fffd|t|fffd||fffd||fffd|O

Public main_select_frm_open_flg As Boolean  ' |fffd||fffd||fffd|C|fffd||fffd||fffd||fffd||295|\|fffd||fffd||fffd|t|fffd||fffd||fffd|O
Public main_frm_fgt_open_flg As Boolean  ' |fffd||fffd||fffd|C|fffd||fffd||fffd||fffd||295|\|fffd||fffd||fffd|t|fffd||fffd||fffd|O
Public first_frm_fgt_open_flg As Boolean  ' |fffd||fffd||fffd||fffd||fffd||fffd||295|\|fffd||fffd||fffd|t|fffd||fffd||fffd|O
Public test_start_flg As Boolean            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|J|fffd|n|fffd|t|fffd||fffd||fffd|O

Public toukei_on_flg As Boolean             ' |fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd||c42c|ON/OFF|fffd|t|fffd||fffd||fffd|O
Public graph_on_flg As Boolean              ' |fffd|O|fffd||fffd||fffd|t|fffd||c42c|ON/OFF|fffd|t|fffd||fffd||fffd|O

Public toukei_row_1 As Long                 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|@|fffd||fffd|
Public toukei_row_2 As Long                 ' |fffd|j|fffd||ce38c||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g  |fffd||fffd|
Public toukei_row_3 As Long                 ' |fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|@|fffd||fffd|
Public toukei_row_4 As Long                 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|@|fffd||fffd|

Public hakuri_toukei_start_cell  As Long    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|@|fffd||fffd||fffd||34a|J|fffd|n|fffd|Z|fffd||fffd|
Public hakai_toukei_start_cell  As Long     ' |fffd|j|fffd||ce38c||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g  |fffd||fffd||fffd||34a|J|fffd|n|fffd|Z|fffd||fffd|
Public leak_toukei_start_cell  As Long      ' |fffd||fffd||fffd|[|fffd|N|fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|@|fffd||fffd||fffd||34a|J|fffd|n|fffd|Z|fffd||fffd|
Public atuhiki_toukei_start_cell  As Long   ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|@|fffd||fffd||fffd||34a|J|fffd|n|fffd|Z|fffd||fffd|

Public fg_type_name As String               ' FG|fffd|@|fffd||d5bc|

'******************************************************************
'|fffd||fffd||fffd|j|fffd|`|fffd||fffd||fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd||3cd|X2008.11.12
'******************************************************************
Public sample_name(31) As Variant           '|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|i|fffd|[|fffd|p
Public place_set_name(51) As Variant        '|fffd||fffd||fffd||fffd||a3ca||fffd|Z|fffd|b|fffd|g|fffd||fffd||fffd|i|fffd|[|fffd|p
Public test_place_name(51, 31) As Variant   '|fffd||fffd||fffd||fffd||a3ca||fffd||fffd||fffd|i|fffd|[|fffd|p(1,1)|fffd|`(50,30)|fffd||24a|i|fffd|[(1,0)|fffd|`(50,0)|fffd||351|I|fffd||12182||314||50d||fffd||fffd|i|fffd|[
Public test_sel_num(51, 31) As Integer      '|fffd||fffd||fffd||fffd||a3ca||fffd||303|Z|fffd||fffd||fffd||50d||fffd||fffd|i|fffd|[|fffd|p(1,1)|fffd|`(50,30)|fffd||24a|i|fffd|[
Public sample_name_num As Integer           '|fffd|I|fffd||12182||303|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd||50d||fffd|
Public place_set_num As Integer             '|fffd|I|fffd||12182||311||fffd||fffd||fffd||a3ca||fffd|Z|fffd|b|fffd|g|fffd||50d||fffd|
Public test_place_num(51) As Integer        '|fffd|I|fffd||12182||311||fffd||fffd||fffd||a3ca||fffd||50d||fffd||fffd|i|fffd|[|fffd|p(1|fffd|`50|fffd||24a|i|fffd|[)
Public before_test_num As String
Public before_sample_name As String
Public before_test_place As String

Public div_x As String
Public change_flg_num As Integer            '|fffd||3cd|X|fffd||fffd||fffd||9340||fffd||694||50d||fffd|(0:|fffd||3cd|X|fffd||fffd||fffd||142||202||fffd||fffd||a347||fffd|A1:|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|A2:|fffd||fffd||fffd||fffd||a3ca||fffd|Z|fffd|b|fffd|g|fffd|A3:|fffd||fffd||fffd||fffd||a3ca|)

Public calc_start As Double
Public calc_end As Double

Public T_cel_row As Integer                 '|fffd||fffd||fffd|v|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd||fffd||748||292|u
Public cal_position_flg As Boolean          '|fffd|Z|fffd|o|fffd|J|fffd|n|fffd||292|u|fffd||fffd||fffd|B|fffd|t|fffd||fffd||fffd|O
Public c_test_number As String
Public c_sample_name As String
Public c_test_place As String
Public Check_k As Integer                   '|fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd|`|fffd|F|fffd|b|fffd|N|fffd|p
Public Check_t As Integer                   '|fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|`|fffd|F|fffd|b|fffd|N|fffd|p
Public e_sheet_name(255) As String
Public tv_sheet_num As Integer
Public re_k_sheet_name As String            '|fffd||10c|v|fffd|Z|fffd||fffd||fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g
Public no_folder As String                  'NO|fffd|t|fffd|H|fffd||fffd||fffd|_
Public sm_folder As String                  'SM|fffd|t|fffd|H|fffd||fffd||fffd|_
Public editing_flg As Boolean
Public re_data(65000) As Double             '|fffd||10c|v|fffd|Z|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[|fffd|p
Public re_position(65000) As Double         '|fffd||10c|v|fffd|Z|fffd||292|u|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[|fffd|p
Public re_max_move_gf As Double             '|fffd||10c|v|fffd|Z|fffd|p|fffd||151||fffd||5cf|d|fffd||292|u
Public re_min_move_gf As Double             '|fffd||10c|v|fffd|Z|fffd|p|fffd||14f||fffd||fffd||5cf|d|fffd||292|u
Public t_re_data(30) As Double              '|fffd||fffd||fffd|v|fffd||10c|v|fffd|Z|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[|fffd|p
Public t_re_avg_data(30) As Double          '|fffd||fffd||fffd|v|fffd||fffd||fffd||3c9||5cf|d|fffd||10c|v|fffd|Z|fffd|f|fffd|[|fffd|^|fffd|i|fffd|[|fffd|p
Public not_before_name_flg As Boolean       '|fffd|O|fffd||fffd||303|t|fffd|@|fffd|C|fffd||fffd||fffd|A|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||188||10a4||fffd|t|fffd||fffd||fffd|O
Public before_tes_num_fldr As String        '|fffd|O|fffd||fffd||fffd|NO|fffd|t|fffd|H|fffd||fffd||fffd|_
Public before_smpl_fldr As String           '|fffd|O|fffd||fffd||fffd|SM|fffd|t|fffd|H|fffd||fffd||fffd|_
Public no_tokei_sheet_flg As Boolean        '|fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||202||fffd||fffd|t|fffd||fffd||fffd|O
Public l_index As Integer                   '|fffd||fffd||fffd|X|fffd|g|fffd|C|fffd||fffd||fffd|f|fffd|b|fffd|N|fffd|X|fffd|p|fffd|d|fffd||2cd||fffd||fffd||d0b9||fffd||fffd||fffd||80ca||fffd|X|fffd|g
Public l_index2 As Integer                  '|fffd||fffd||fffd|X|fffd|g|fffd|C|fffd||fffd||fffd|f|fffd|b|fffd|N|fffd|X|fffd|p|fffd|d|fffd||2cd||fffd||fffd||d0b9||fffd|I|fffd||fffd||fffd||fffd||fffd|X|fffd|g
Public chosen_flg As Boolean                '|fffd|I|fffd||12183|t|fffd||fffd||fffd|Otrue:|fffd|I|fffd||fffd|
Public change_txt_str As String             '|fffd||fffd||fffd||343|`|fffd|F|fffd|b|fffd|N|fffd|p|fffd|O|fffd||fffd|l|fffd||6d1||fffd|(|fffd||3cd|X|fffd||fffd||fffd|)
Public test_name_text_str As String         '|fffd||fffd||fffd||343|`|fffd|F|fffd|b|fffd|N|fffd|p|fffd|O|fffd||fffd|l|fffd||6d1||fffd|(|fffd||fffd||fffd||fffd||fffd||50d||fffd|)
Public test_read_flg As Boolean             '|fffd||752||fffd||1c2||74d||fffd||fffd||743|t|fffd||fffd||fffd|O
Public now_book As String                   'Initialize|fffd||fffd||fffd||303|u|fffd|b|fffd|N|fffd||fffd||fffd||fffd||6ce||fffd|
Public main_now_book As String              '|fffd|N|fffd||fffd||fffd||fffd||fffd||303|u|fffd|b|fffd|N|fffd||fffd||fffd||6ce||fffd|(Excel2003|fffd|p)
Public main_now_book2 As String             '|fffd|N|fffd||fffd||fffd||fffd||fffd||303|u|fffd|b|fffd|N|fffd||fffd||fffd||6ce||fffd|(Excel2007|fffd|p)
Public DATA_START_CELL As Long
Public DATA_STOP_CELL As Long
Public wake_flg As Boolean                  '|fffd|O|fffd||fffd||fffd|t|fffd||fffd|2|fffd||fffd||255||fffd||fffd||fffd||fffd||115|`|fffd||fffd||fffd|p|fffd||303|t|fffd||fffd||fffd|O
Public g_wake_num As Integer

Public test_mode_num As Integer             '0:MANU,1:JOG,2:SING,3:CONT,4:PROG
Public test_direction_num As Integer        '0:PUSH 1:PULL  |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public test_times_cont As Integer           '|fffd||fffd||fffd||fffd||fffd||50503|J|fffd|E|fffd||fffd||fffd|^
Public before_test_times As Integer         '|fffd|O|fffd||fffd||30e||fffd||fffd||fffd||fffd||50516||682||fffd||6ce||fffd||fffd||3d0||fffd|
Public limit_chk_text As String             '|fffd||327a||fffd||fffd||fffd||fffd||fffd||fffd||30c||fffd||fffd||281|@|fffd|@OK|fffd|@HIGHT|fffd|@LOW

'if USA
Public M_limit_chk_text As String
'endif

Public test_start_direction As String       '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public test_mode_name As String             'test mode
Public test_times As Integer                '
Public data_end_flg As Boolean              '|fffd|f|fffd|[|fffd|^|fffd||30f|I|fffd|[|fffd|t|fffd||fffd||fffd|O|fffd|FFALSE|fffd|F|fffd||142||342||202||fffd||fffd|ATRUE|fffd|F|fffd||142||fffd||fffd||fffd|
Public test_end_flg As Boolean              '|fffd|f|fffd|[|fffd|^|fffd||635e||fffd||fffd||fffd||fffd||fffd|t|fffd||fffd||fffd|O
'Public cont_num As Integer            '|fffd|f|fffd|[|fffd|^|fffd||635e||fffd||fffd| |fffd|\|fffd|t|fffd|g|fffd||752||fffd|l
Public test_times_stand As Integer          '|fffd|X|fffd|^|fffd||fffd||fffd|h|fffd|{|fffd||302||30c|J|fffd||502||fffd||fffd||50512|l

'Public cont_num As Integer           '|fffd||fffd||fffd|C|fffd||fffd||fffd||fffd||282||253||fffd||fffd||342||fffd||fffd||fffd||fffd|J|fffd||502||fffd||fffd||fffd|
'Public sample_num As Integer             '|fffd||fffd||fffd|C|fffd||fffd||fffd||fffd||282||253||fffd||fffd||342||fffd||fffd||fffd||fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd|
Public triger As Double
Public limit_chk_flg As Integer

'#If USA = 1 Then
Public M_limit_chk_flg As Integer
'#End If

Public rate_load As Double  '|fffd||fffd|i|fffd||5cf|d
Public rate_load_kg As String     '|fffd||fffd|i|fffd||5cf|d(kg)
Public test_flg As Boolean     'true:testing, false:test is stopping
Public s_row As Long
Public s_col As Long

Public max_load(10000) As Double              '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30d||151||fffd||5cf|d|fffd|l
Public min_load(10000) As Double              '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30d||14f||fffd||fffd||5cf|d|fffd|l

Public M_max_load(10000) As Double              '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30d||151||fffd||5cf|d|fffd|l
Public M_min_load(10000) As Double              '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30d||14f||fffd||fffd||5cf|d|fffd|l

Public ave_load(10000) As Double              '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||315||fffd||fffd||3c9||5cf|d|fffd|l
Public load_data As Double

Public vc_sheet_num As Integer              '|fffd|O|fffd||4e38c||fffd||fffd||fffd||fffd||fffd|VC-|fffd|V|fffd|[|fffd|gNo.
Public MAX_sheet_num As Integer             '|fffd|O|fffd||4e38c||fffd||fffd||fffd||fffd||fffd|MAX-|fffd|V|fffd|[|fffd|gNo.
Public max_sheet_cont As Integer            '|fffd|}|fffd|b|fffd|N|fffd|X|fffd|V|fffd|[|fffd|g|fffd|J|fffd|E|fffd||fffd||fffd|^|fffd|[
Public stop_end_flg As Boolean              '|fffd||fffd||fffd||fffd||fffd|I|fffd||fffd||fffd|t|fffd||fffd||fffd|O
Public max_load_cell(10000) As String       '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30d||151||fffd|l|fffd||fffd|Cell|fffd|A|fffd|h|fffd||fffd||fffd|X|fffd||6ce||fffd|

Public M_max_load_cell(10000) As String     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30d||151||fffd|l|fffd||fffd|Cell|fffd|A|fffd|h|fffd||fffd||fffd|X|fffd||6ce||fffd|


Public dataonly_cellout_cnt As Integer      '|fffd|O|fffd||fffd||fffd|tOFF|fffd||fffd||fffd|A|fffd|f|fffd|[|fffd|^|fffd||302||743|G|fffd|N|fffd|Z|fffd||fffd||fffd||fffd||fffd||34e||fffd||fffd||30e||fffd||fffd||fffd||fffd||fffd||fffd||50502||303|J|fffd|E|fffd||fffd||fffd|^
Public addsheet_pages As Integer            '|fffd||fffd||fffd||fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd|
Public addsheet_flg As Boolean              '|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd|t|fffd||fffd||fffd|O

Public set_AbsValue_flg As Boolean          '|fffd||fffd||392|l|fffd|t|fffd||fffd||fffd|O
Public set_distance_flg As Boolean          '|fffd||fffd||fffd||fffd||fffd||3ce|Z|fffd|t|fffd||fffd||fffd|O
Public sample_flg(10000) As Boolean           '|fffd|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||743|t|fffd||fffd||fffd|O|fffd|A|fffd||fffd||fffd|FTRUE|fffd|A|fffd||fffd||fffd||202||fffd||fffd|FFALSE
Public sample_num As Long                '|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd|
Public cont_num As Long                  '|fffd|J|fffd||502||fffd||fffd||fffd|
Public toukei_sheet_cont As Integer         '|fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd|J|fffd|E|fffd||fffd||fffd|^|fffd|[
'Public return_flg_single As Boolean        'sing|fffd||fffd||fffd|[|fffd|h|fffd||302|Q|fffd||fffd||681|i|fffd||7c2||84ee||fffd||fffd|/|fffd||fffd||fffd|H|fffd|j|fffd||303|t|fffd||fffd||fffd|O|fffd|AFALSE|fffd|F|fffd||fffd||fffd|H|fffd|GTRUE|fffd|F|fffd||fffd||fffd|H
Public data_cont_go_forsingle As Long    'Sing|fffd||fffd||fffd|[|fffd|h|fffd||fffd||fffd||fffd||fffd|H|fffd|f|fffd|[|fffd|^|fffd||fffd|
Public lngYCnt_used As Long     '|fffd|g|fffd|p|fffd||3c2||74d||14f|I|fffd|sNo.
Public intXCnt_used As Long  '|fffd|g|fffd|p|fffd||3c2||74d||14f|I|fffd||fffd|No.

Public Col_MAX As Long             '|fffd||fffd||83|V|fffd|[|fffd|g|fffd||24d||151||fffd||fffd|
Public Sheets_MAX As Long          '|fffd||fffd||83|u|fffd|b|fffd|N|fffd||30d||151||fffd|V|fffd|[|fffd|g|fffd||fffd|
Public Rows_Max As Long            '|fffd||fffd||83|V|fffd|[|fffd|g|fffd||24d||151||fffd|s|fffd||fffd|

Public off_sheet_strt As String
Public off_cel(10000) As String



Public off_last_sheet As String
Public mae_cell_flg As Boolean
Public ksn_flg(10) As Boolean
Public ksn_make_ok_flg As Boolean
Public ma_si_colend_flg As Boolean
Public delete_sheet_flg As Boolean
Public load_triger_a As Long
Public interruption_flg As Boolean

Public last_selected_sheet As String
Public comm_error_flg As Boolean
Public y_flg As Boolean
Public main_stop_flg As Boolean

Public max_s_row As Long
Public s_max_value As Double

Public sing_data(70000) As Double
Public sing_data_M(70000) As Double

Public sing_data_cnt As Long
Public before_timer As Double
Public now_timer As Double
Public timer_use_flg As Boolean

Public C_P_max_make_flg As Boolean

Public C_P_data(10000) As Double
Public C_P_cnt As Long

Public C_P_data_M(10000) As Double
Public C_P_cnt_M As Long

Public C_P_aru_flg(10000) As Boolean


Public p_nodata_flg(10000) As Boolean
Public m_nodata_flg(10000) As Boolean

'|fffd|f|fffd|o|fffd|b|fffd|O|fffd|p***************************************
Public debug_buf As String
Public debug_aa As Double
Public debug_bb As Double
Public debug_cc As Double
'*************************************************

'|fffd||fffd|090401SATO|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public l_buf_c_rx_ctn As String    ' |fffd||fffd|M|fffd|f|fffd|[|fffd|^ |fffd|p|fffd|P|fffd|b|fffd|g|fffd||fffd||fffd|f|fffd||fffd||fffd||30e|c|fffd||8576||fffd||fffd|
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|



'#If NSCA_V103 = 1 Then
                
Public length_type_num As Byte
                    

'#End If




'**************************
'   |fffd||fffd||fffd|W|fffd||fffd||fffd|[|fffd||fffd||fffd||50b||fffd||fffd|L|fffd||590||fffd|
'**************************
Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long) ' |fffd|E|fffd|F|fffd|C|fffd|g|fffd|p|fffd||590||fffd|

'*************************
'   |fffd||fffd||fffd|C|fffd||fffd||fffd||fffd||295|\|fffd||fffd|
'*************************
Private Sub first_frm_fgt_show()
    Dim myBook As Workbook
    Dim sheet_a As Integer
    Dim name As String
    'Dim no_folder As String
    
    SER_flg = False
    
    
'NSCA_V104
    no_folder = FGT_VC_D
    sm_folder = FGT_VC_D & FGT_VC_FILE
'else
    'no_folder = "C:\Program Files\FGT-VC"
    'sm_folder = "C:\Program Files\FGT-VC\FILE"
'endif


    If file_folda(no_folder) = False Then                       'SM|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||202||fffd||fffd||fffd||38d||c42c|
        MkDir no_folder
    End If
    If file_folda(sm_folder) = False Then                       'SM|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||fffd||fffd||202||fffd||fffd||fffd||38d||c42c|
        MkDir sm_folder
    End If
    
    On Error Resume Next
    main_mdl_e.Book_Name_jdg
    
    If first_frm_fgt_open_flg = False Then
        sheet_a = 1
        book_open = 0
    
        For Each myBook In Workbooks
            book_open = book_open + 1
        Next myBook

        If book_open = 0 Then
            Workbooks.Add
            ActiveWorkbook.SaveAs Filename:=sm_folder & "\" & File_name
            
            Worksheets(1).name = "VC-" & sheet_a
            Application.DisplayAlerts = False
            Do While Val(Worksheets.Count) > 1                                              'VC-1|fffd||20a|O|fffd||303|V|fffd|[|fffd|g|fffd||351|S|fffd||fffd||fffd||fffd||fffd||fffd|
                On Error Resume Next
                Worksheets(2).Delete
            Loop
            MsgBox MES4 & File_name & ".", vbExclamation, OBI_STR                                 '"|fffd||24b|L|fffd|^|fffd||fffd||fffd||702||fffd||fffd|B"
            Application.DisplayAlerts = True
        Else
            sheet_name_change (sheet_a)
        End If
        first_frm_fgt.Show
    End If
    
End Sub

Public Function file_folda(myDir As String) As Boolean                      '|fffd|t|fffd|H|fffd||fffd||fffd|_|fffd||30c||fffd||fffd||fffd|


    If Len(Dir(myDir, vbDirectory Or vbHidden Or vbSystem)) > 0 _
        And Len(Dir(myDir, vbHidden Or vbSystem)) = 0 = True Then
        file_folda = True
    Else
        file_folda = False
    End If
End Function

'************************
'|fffd|@|fffd|u|fffd|b|fffd|N|fffd||fffd||fffd||fffd||fffd||fffd|
'  |fffd|u|fffd|b|fffd|N|fffd||fffd||fffd||752||fffd|iFile_name|fffd|j
'************************

Public Sub Book_Name_jdg()
    Dim n_date As String
    Dim buf As String
    Dim year_str As String
    Dim month_str As String
    Dim day_str As String
    
    File_name_num = 1
    
    year_str = Year(Now)
    
    month_str = Month(Now)
    If Len(month_str) = 1 Then
        month_str = "0" & month_str
    End If
    
    day_str = day(Now)
    If Len(day_str) = 1 Then
        day_str = "0" & day_str
    End If
    n_date = year_str & month_str & day_str
    
    Do
        File_name = "VC" & n_date & "-" & File_name_num
        buf = Dir(sm_folder & "\" & File_name & ".*")

        If buf = "" Then
            Exit Do
        Else
            File_name_num = File_name_num + 1
        End If
    Loop
    
    File_name = "VC" & n_date & "-" & File_name_num
    
End Sub

'*************************
'        Version
'*************************
Private Sub ver_proc_k()
    Dim ver As String
    ver = XLANAME_K & " " & VERSION_K
    MsgBox ver & vbCrLf & vbCrLf & CORP & vbCrLf & vbCrLf & URL, vbOKOnly, INFO
End Sub

Public Function sheet_name_change(sheet_a As Integer) As Boolean

    Dim name As String

    Dim len_name As Integer
    Dim len_File As Integer
    
    Dim cell_char As String
    Dim lngYCnt As Long
    Dim intXCnt As Long
    Dim lngYCnt0 As Long
    Dim intXCnt0 As Long
    
    Dim editing_flg As Boolean  '|fffd||48f|W|fffd|t|fffd||fffd||fffd|O
    Dim newbook_flg As Boolean  '|fffd|V|fffd|K|fffd|u|fffd|b|fffd|N|fffd|t|fffd||fffd||fffd|O
    
    Dim i_loop As Long
    
    name = ActiveWorkbook.name
    main_mdl_e.Book_Name_jdg
    
    For i_loop = 1 To Val(Worksheets.Count)
        lngYCnt = Worksheets(i_loop).UsedRange.Cells.row
        intXCnt = Worksheets(i_loop).UsedRange.Cells.Column
        lngYCnt0 = Worksheets(i_loop).UsedRange.Cells.Rows.Count
        intXCnt0 = Worksheets(i_loop).UsedRange.Cells.Columns.Count
        lngYCnt = lngYCnt + lngYCnt0 - 1
        intXCnt = intXCnt + intXCnt0 - 1
        cell_char = Worksheets(i_loop).Cells(1, 1).Value
        If lngYCnt = 1 And intXCnt = 1 And cell_char = "" Then
            editing_flg = False     '|fffd||fffd|t|fffd|@|fffd|C|fffd||fffd|
        Else
            editing_flg = True      '|fffd||48f|W|fffd||fffd||fffd||303|t|fffd|@|fffd|C|fffd||fffd|
            Exit For
        End If
    Next
    
    len_name = InStr(name, "-")
    len_File = InStr(File_name, "-")
    
    If len_name <> 0 Then
        If Left(name, len_name - 1) <> Left(File_name, len_File - 1) Then
            not_before_name_flg = True      '|fffd|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd||303|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd||fffd||142||342||202||fffd||fffd||a347|
        Else
            not_before_name_flg = False     '|fffd|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd||303|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd||fffd||20f||a347|
        End If
    Else
        not_before_name_flg = True
    End If
    
    If not_before_name_flg = False And editing_flg = False Then
        newbook_flg = True  '|fffd|V|fffd|K|fffd|u|fffd|b|fffd|N
    Else
        newbook_flg = False '|fffd||48f|W|fffd||fffd||fffd|u|fffd|b|fffd|N
    End If
    
    If newbook_flg = True Then
            Worksheets(1).name = "VC-" & sheet_a
            Application.DisplayAlerts = False
            Do While Val(Worksheets.Count) > 1                                              '|fffd|c|fffd||fffd||303|V|fffd|[|fffd|g|fffd||351|S|fffd||fffd||fffd||fffd||fffd||fffd|
                On Error Resume Next
                Worksheets(2).Delete
            Loop
            MsgBox MES4 & name & ".", vbExclamation, OBI_STR                                 '"|fffd||24b|L|fffd|^|fffd||fffd||fffd||702||fffd||fffd|B"
            Application.DisplayAlerts = True
        
    Else
        If not_before_name_flg = True Then
            If Mid(ActiveWorkbook.name, 1, 4) <> "Book" Then
                ActiveWorkbook.Save                                                         '|fffd||6d1||fffd||fffd||fffd||fffd||fffd|
            'End If
            ElseIf Mid(ActiveWorkbook.name, 1, 4) = "Book" Then
                'If editing_flg = False Then
                    ActiveWorkbook.Close                                                         '|fffd||6d1||fffd||fffd||fffd||fffd||fffd|
                'Else
                    'ActiveWorkbook.Close
                    'ActiveWorkbook.Close
                'End If
            End If
            
            'ActiveWorkbook.Save                                                         '|fffd||6d1||fffd||fffd||fffd||fffd||fffd|
            Workbooks.Add
            'MsgBox File_name & MES4, vbExclamation, OBI_STR                             '"|fffd||24b|L|fffd|^|fffd||fffd||fffd||702||fffd||fffd|B"
            ActiveWorkbook.SaveAs Filename:=sm_folder & "\" & File_name                 '|fffd||fffd||fffd||742||303|u|fffd|b|fffd|N|fffd||16f11|O|fffd||fffd||3c2||fffd||fffd||115||6d1||fffd|
    
            Worksheets(1).name = "VC-" & sheet_a
            Application.DisplayAlerts = False
            
            Do While Val(Worksheets.Count) > 1                                              '|fffd|c|fffd||fffd||303|V|fffd|[|fffd|g|fffd||351|S|fffd||fffd||fffd||fffd||fffd||fffd|
                On Error Resume Next
                Worksheets(2).Delete
            Loop
            MsgBox MES4 & File_name & ".", vbExclamation, OBI_STR                             '"|fffd||24b|L|fffd|^|fffd||fffd||fffd||702||fffd||fffd|B"
            Application.DisplayAlerts = True
        ElseIf not_before_name_flg = False Then
            ActiveWorkbook.Save
            outp_mdl_e.Sheet_move
        End If
            
    End If

End Function

Public Sub t_sheet_check()
    Dim i As Integer
    Dim a As Variant
    Dim b As Variant
    Dim C As Variant
    
    With Worksheets(TOUKEI_STR)
    T_cel_row = 44
    For i = 0 To 29
        a = .Cells(14 + i, 1)
        b = .Cells(14 + i, 2)
        C = .Cells(14 + i, 3)
        If .Cells(14 + i, 1) = "" And .Cells(14 + i, 2) = "" And .Cells(14 + i, 3) = "" Then
            T_cel_row = 14 + i
            Exit Sub
        End If
    
    Next
    
    End With
End Sub




Attribute VB_Name = "outp_mdl_e"
Option Explicit
Private sheet_num As Integer
Private Sheet_next As Integer
Private Sheet_flg As String
Private sheet_name As String                            '|fffd||fffd||fffd||742||303|V|fffd|[|fffd|g|fffd||fffd|
Private Sheet_first_name As String
Dim sheet_plot As String
'|fffd|O|fffd||fffd||752||fffd||6ce||fffd||fffd|p|fffd||3d0||fffd|
Private old_torikomi_num As Integer
Private old_sel_val As Integer
Private old_test_speed_val As Double
Private old_move_dist_val As Double
Private old_max_limit As Double
Private old_min_limit As Double
Private old_pull_push_flg As Integer
Private old_start_limit As Double
Private old_stop_limit As Double
Private old_dest_end_per As Double
Private old_leak_load As Double
Private old_before_load As Double
Private old_leak_time_sec As Long
Private old_before_leak_speed As Double
Public maker_flg As Boolean     '|fffd|n|fffd||fffd||c42c||fffd|t|fffd||fffd||fffd|O
Public sheet_num_start As Integer      '|fffd||fffd||fffd||682||303|V|fffd|[|fffd|gnum|fffd|iMAX|fffd|V|fffd|[|fffd|g|fffd||183|O|fffd||fffd||fffd|t|fffd||c42c||fffd|p|fffd|j
Public sheet_name_start As Integer      '|fffd||fffd||fffd||682||303|V|fffd|[|fffd|gname|fffd|iMAX|fffd|V|fffd|[|fffd|g|fffd||183|O|fffd||fffd||fffd|t|fffd||c42c||fffd|p|fffd|j
Public toukeisheet_blank_check_flg As Boolean

'**********************
'|fffd|@|fffd|O|fffd||fffd||fffd|t|fffd|`|fffd||fffd|   'FGT-VS|fffd|p
'**********************
Public Sub mk_fig()

    Dim sheet_num As Integer                                    '|fffd|V|fffd|[|fffd|g|fffd||fffd|6|fffd||fffd||fffd||fffd||fffd||682||fffd||fffd||fffd||314||50d||fffd|
    'Dim Sheet_first_name As String                              '|fffd|V|fffd|[|fffd|g|fffd||fffd|5|fffd||fffd||fffd||fffd||fffd||682||702||142||315||fffd||fffd||fffd||fffd||fffd|
    Dim cnt_job As Integer
    Dim dummy_flg As Boolean
    Dim start_cell As Long
    'Dim cnt_job_2 As Integer
    Dim row As Long
    Dim i_loop As Long
    
    If ActiveSheet.Cells(24, 1).Value = "" Then
        GoTo Stack_Err
    End If
    
    'Dim sheet_name As String
    Dim datas_sheet As Integer  '|fffd|f|fffd|[|fffd|^|fffd||fffd|
    datas_sheet = Val(ActiveSheet.Cells(9, 2))
        
    On Error GoTo Stack_Err
    'start_cell = DATA_START                                     '|fffd||348||34a|J|fffd|n|fffd|Z|fffd||fffd||fffd||752||fffd|
    'sheet_num = Val(Mid(ActiveSheet.name, 4, 3))
    'Sheet_first_name = Mid(ActiveSheet.name, 1, 3)
    'sheet_plot = Sheet_first_name & sheet_num                   '|fffd|O|fffd||fffd||fffd|t|fffd||16102||7cd||fffd||fffd||783|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
    
    sheet_name = Trim(ActiveSheet.name)
    start_cell = DATA_START                                     '|fffd||348||34a|J|fffd|n|fffd|Z|fffd||fffd||fffd||752||fffd|
    
    ActiveSheet.ChartObjects.Add(300, 5, 490, 250).Select       '|fffd|O|fffd||fffd||fffd|t|fffd|`|fffd||fffd|
    
    With ActiveChart
        On Error Resume Next
        mk_fig_job = 1
        'cnt_job_2 = 1
        .ChartType = xlXYScatter                                '|fffd|O|fffd||fffd||fffd|t|fffd|^|fffd|C|fffd|v|fffd||752||fffd|
        
        If limit_chk_flg = 0 Then
            
            For i_loop = 0 To (datas_sheet - 1)
                ActiveSheet.Cells(start_cell + i_loop, 16) = max_limit
                ActiveSheet.Cells(start_cell + i_loop, 17) = min_limit
            Next
        
            dummy_flg = data_plot(start_cell, 1, start_cell + datas_sheet - 1, 16, xlThin, xlDash, 7) '+|fffd||fffd||fffd||fffd||fffd||fffd||80c9||fffd|C|fffd||fffd|
            dummy_flg = data_plot(start_cell, 1, start_cell + datas_sheet - 1, 17, xlThin, xlDash, 5) '+|fffd||fffd||fffd||fffd||fffd||fffd||fffd||80c9||fffd|C|fffd||fffd|
                            
        End If
    
        If M_limit_chk_flg = 0 Then
            
            For i_loop = 0 To (datas_sheet - 1)
                ActiveSheet.Cells(start_cell + i_loop, 18) = -1 * M_max_limit
                ActiveSheet.Cells(start_cell + i_loop, 19) = -1 * M_min_limit
            Next
            
            If set_AbsValue_flg = False Then
                dummy_flg = data_plot(start_cell, 1, start_cell + datas_sheet - 1, 18, xlThin, xlDash, 7) '-|fffd||fffd||fffd||fffd||fffd||fffd||80c9||fffd|C|fffd||fffd|
                dummy_flg = data_plot(start_cell, 1, start_cell + datas_sheet - 1, 19, xlThin, xlDash, 5) '-|fffd||fffd||fffd||fffd||fffd||fffd||fffd||80c9||fffd|C|fffd||fffd|
            End If
            
        End If
        
        'SING|fffd||fffd||fffd|[|fffd|h|fffd||242||101|A|fffd||fffd||fffd|H|fffd||350||510|F|fffd|A|fffd||fffd||fffd|H|fffd||350||90|F|fffd||155|\|fffd||fffd|
        If test_mode_num = 2 Then
            'if|fffd|@|fffd||fffd||fffd|H|fffd|@|fffd||510|F
            dummy_flg = data_plot(start_cell, 1, start_cell + data_cont_go_forsingle - 1, 2, xlMedium, xlContinuous, 3)
            'if  |fffd||fffd||fffd|H  |fffd||90|F
            dummy_flg = data_plot(start_cell + data_cont_go_forsingle - 1, 1, start_cell + datas_sheet - 1, 2, xlMedium, xlContinuous, 5)
        Else
            dummy_flg = data_plot(start_cell, 1, start_cell + datas_sheet - 1, 2, xlMedium, xlContinuous, 3)
        End If
        
        .ChartArea.Select
        .Legend.Select
        Selection.Delete
        .Axes(xlCategory, xlPrimary).HasTitle = True
        
        
'#If NSCA_V103 Then
        If length_type_num = MM_UNIT Then
            .Axes(xlCategory, xlPrimary).AxisTitle.Characters.Text = HENI_STR
        
        Else
            .Axes(xlCategory, xlPrimary).AxisTitle.Characters.Text = HENI_STR_INCH
        
        End If
        
'#End If
        
        .Axes(xlValue, xlPrimary).HasTitle = True
        .Axes(xlValue, xlPrimary).AxisTitle.Characters.Text = KAJYU_STR & "(" & main_frm_fgt.unit_name & ")"
    
        .Axes(xlValue).MajorGridlines.Border.ColorIndex = 57                        '|fffd||23d5||fffd||fffd||fffd|J|fffd||fffd||fffd|[
        .Axes(xlValue).MajorGridlines.Border.LineStyle = xlDot
        .PlotArea.Interior.ColorIndex = 2
        If main_frm_fgt.OptionButton_toriga_heni.Value = True Then
       '     ActiveChart.Axes(xlCategory).MinimumScale = triger
        ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
       '     ActiveChart.Axes(xlCategory).MinimumScale = load_triger_a
        End If
        For cnt_job = 1 To mk_fig_job - 1 Step 1
            .SeriesCollection(cnt_job).MarkerStyle = 0                              '|fffd|}|fffd|[|fffd|J|fffd|[|fffd|X|fffd|^|fffd|C|fffd||fffd|
        Next cnt_job
    
    End With
        
    ActiveSheet.Cells(1, 1).Select
    'B_start = 0
    'B_stop = 0
    
    Exit Sub

Stack_Err:
 '   ActiveWorkbook.Save
    Exit Sub
End Sub
'|fffd|O|fffd||fffd||fffd|t|fffd||30f|d|fffd||2cd||fffd||fffd||d0b9|     '|fffd|C|fffd||fffd||fffd|v
Public Sub mk_multigraph()
    Dim i_loop As Integer
    Dim j_loop As Integer
    Dim k_loop As Integer
    Dim l_loop As Integer                   '|fffd||fffd|
    Dim dummy_make As Boolean               '|fffd||fffd|
    Dim sheet_num_VM As Integer             'VC|fffd|V|fffd|[|fffd|g|fffd||fffd|MAX|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||6ce||fffd||fffd|p
    
    Dim t_sheet_num As Integer              '|fffd|d|fffd||2cd||fffd||fffd||d0b9||fffd|y|fffd|[|fffd|W|fffd||fffd|
    Dim dummy_graph_sheet_name As String
    
    Dim Y_GRAPH_NAME As String  '|fffd|O|fffd||fffd||fffd|t|fffd||fffd|Y|fffd||fffd||fffd||fffd|
    Dim X_GRAPH_NAME As String  '|fffd|O|fffd||fffd||fffd|t|fffd||fffd|X|fffd||fffd||fffd||fffd|
    
    g_wake_num = 1
    DoEvents
    On Error GoTo error
    
    format_err_flg = False                                                      '|fffd|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g|fffd|G|fffd||fffd||fffd|[|fffd|t|fffd||fffd||fffd|O|fffd||fffd||fffd||fffd||fffd||fffd|
    
    If toukei_sheet_cont >= 10 Then
        t_sheet_num = 10
    Else
        t_sheet_num = toukei_sheet_cont
    End If
    
    Y_GRAPH_NAME = KAJYU_STR & "(" & main_frm_fgt.unit_name & ")"
    
    
    
     
'#If NSCA_V103 Then
        If length_type_num = MM_UNIT Then
            X_GRAPH_NAME = HENI_STR                                             '|fffd||fffd|
        
        Else
            X_GRAPH_NAME = HENI_STR_INCH
        
        End If
        
'#End If
     
     
     
    g_keiretu_name(0) = ""  '(0)|fffd||fffd|""|fffd||152||fffd||182||fffd||fffd||fffd|
    
    ActiveSheet.Select
    dummy_graph_sheet_name = ActiveSheet.name
    
    If test_times = 0 Then
        MAX_sheet_num = 1
    Else
        MAX_sheet_num = MAX_sheet_num + max_sheet_cont - 1
    End If
    
    For i_loop = 0 To t_sheet_num - 1 '|fffd|I|fffd||fffd||fffd||fffd||fffd|X|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd|
        
        g_Sheet_name(i_loop) = "VC-" & (sheet_num_start + i_loop)                   '|fffd||10a|m|fffd|F|fffd|v090224REN|fffd||fffd|OK
        g_keiretu_name(i_loop) = g_Sheet_name(i_loop)                               'for series's name
        Worksheets(g_Sheet_name(i_loop)).Activate                                   '|fffd|d|fffd||2cd||fffd||fffd||d0b9||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd|I|fffd||fffd|
        start_stop_cell_get                                                         '|fffd||fffd||fffd|Z|fffd|o|fffd|J|fffd|n|fffd|I|fffd||fffd||fffd||292|u|fffd||30e||64fe|
        g_data_num(i_loop) = DATA_STOP_CELL - (DATA_START_CELL - 1)                 '|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd|
        
        If ActiveSheet.Cells(29, 1).Value = "" Then
            ksn_flg(i_loop) = False
        
        Else
            ksn_flg(i_loop) = True
            Range("A" & DATA_START_CELL & ":B" & DATA_STOP_CELL).Select   '|fffd|A|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||303|R|fffd|s|fffd|[
            Selection.Copy
            Range("A1").Select
            Sheets(dummy_graph_sheet_name).Select
            
            With ActiveSheet '|fffd|A|fffd||fffd||fffd|f|fffd|[|fffd|^|fffd||313|\|fffd||fffd|t|fffd||fffd|
                .Cells(G_CONT_Y - 2, i_loop * 2 + G_CONT_X) = g_keiretu_name(i_loop)            '|fffd|n|fffd||fffd|
                .Cells(G_CONT_Y - 1, i_loop * 2 + G_CONT_X) = X_GRAPH_NAME                      'Y|fffd||fffd||fffd||fffd|
                .Cells(G_CONT_Y - 1, i_loop * 2 + G_CONT_X + 1) = Y_GRAPH_NAME                  'X|fffd||fffd||fffd||fffd|
                .Cells(G_CONT_Y + k_loop, i_loop * 2 + G_CONT_X).Activate
                .Paste
            
            End With
        
        End If
        
    Next
    
    Application.CutCopyMode = False
    Sheets(dummy_graph_sheet_name).Select
    ksn_make_ok_flg = False
    
    For i_loop = 0 To t_sheet_num - 1
        
        If ksn_flg(i_loop) = True Then
            ksn_make_ok_flg = True
        End If
        
    Next
    
    If ksn_make_ok_flg = True Then
        If mk_ksn_graph(t_sheet_num, G_CONT_Y, G_CONT_X, Y_GRAPH_NAME, X_GRAPH_NAME) Then        '|fffd|O|fffd||fffd||fffd|t|fffd||c42c|
        
        End If
        
    End If
    
    Exit Sub
    

error:


End Sub
Private Function mk_ksn_graph(ksn_num As Integer, cont_y As Long, cont_x As Long, Y_name As String, x_name As String) As Boolean
'************|fffd|d|fffd||2cd||fffd||fffd||d0b9||fffd|O|fffd||fffd||fffd|t|fffd||30d||c42c|********************
    Dim i_loop As Integer
    Dim dummy_plot As Boolean
    Dim color_index(11) As Integer
    Dim keiretu_num As Integer
    
    If ksn_make_ok_flg = False Then
        Exit Function
    End If
    
    If ksn_num = 1 Then
        If Worksheets(g_Sheet_name(0)).Cells(25, 1).Value = "" Then
            Exit Function
        End If
    End If
    
    mk_ksn_graph = True
    
    ActiveSheet.ChartObjects.Add(360, 5, 490, 250).Select
    ActiveChart.ChartType = xlXYScatterLinesNoMarkers
    
    color_index(0) = G_CHA
    color_index(1) = G_AKA
    color_index(2) = G_DAIDAI
    color_index(3) = G_KIRO
    color_index(4) = G_MIDORI
    color_index(5) = G_AO
    color_index(6) = G_MURASAKI
    color_index(7) = G_HAI
    color_index(8) = G_MOMO
    color_index(9) = G_KURO
    
    wake_flg = False
    
    For i_loop = 0 To ksn_num - 1
        If ksn_flg(i_loop) = True Then
        
            If Worksheets(g_Sheet_name(i_loop)).Cells(25, 1).Value = "" Then
                Exit For
            End If
            
            If g_data_num(i_loop) > 32000 Then
                dummy_plot = g_data_plot(i_loop, cont_y, (cont_x + i_loop * 2), (cont_y + 31999), (cont_x + i_loop * 2 + 1), _
                                        xlMedium, xlContinuous, color_index(i_loop), ActiveSheet.name)
                wake_flg = True
                dummy_plot = g_data_plot(i_loop, (cont_y + 32000), (cont_x + i_loop * 2), (cont_y + g_data_num(i_loop) - 1), (cont_x + i_loop * 2 + 1), _
                                        xlMedium, xlContinuous, color_index(i_loop), ActiveSheet.name)
                wake_flg = False
            Else
                dummy_plot = g_data_plot(i_loop, cont_y, (cont_x + i_loop * 2), (cont_y + g_data_num(i_loop) - 1), (cont_x + i_loop * 2 + 1), _
                                        xlMedium, xlContinuous, color_index(i_loop), ActiveSheet.name)
            End If
        End If
        
    Next i_loop
    
    With ActiveChart
        
        On Error Resume Next
        
        If toukei_sheet_cont > 1 Then
            If Worksheets(g_Sheet_name(toukei_sheet_cont - 1)).Cells(25, 1).Value = "" Then
                .SeriesCollection(toukei_sheet_cont).Delete
                .ChartTitle.Delete
                
            End If
        End If
        
        .Axes(xlCategory, xlPrimary).HasTitle = True
        .Axes(xlValue, xlPrimary).HasTitle = True
        .Axes(xlCategory, xlPrimary).AxisTitle.Characters.Text = x_name
        .Axes(xlValue, xlPrimary).AxisTitle.Characters.Text = Y_name
        .HasLegend = True
        .PlotArea.Interior.ColorIndex = 2
        .Axes(xlValue).MajorGridlines.Border.LineStyle = xlDot
        
        If main_frm_fgt.OptionButton_toriga_heni.Value = True Then
        
        ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
        
        End If
        
        ActiveSheet.Cells(1, 1).Select
        
        If .ChartTitle.Characters.Text <> "" Then
            .ChartTitle.Delete
        End If
        
    End With

    
    
End Function


Private Function data_plot(start_p As Long, start_c As Long, stop_p As Long, stop_c As Long, weight_p As Long, line_s As Integer, color_p As Integer)
    
    '|fffd|n|fffd||fffd||c42c||fffd||590||fffd|++++++++++++++++++++++++++++++++++++++++
    '   start_p |fffd|F|fffd|J|fffd|n|fffd|Z|fffd||fffd||fffd|s     start_c |fffd|F|fffd|J|fffd|n|fffd|Z|fffd||fffd||fffd||fffd|
    '   stop_p|fffd|@|fffd|F|fffd|I|fffd||fffd||fffd|Z|fffd||fffd||fffd|s     stop_c|fffd|@|fffd|F|fffd|I|fffd||fffd||fffd|Z|fffd||fffd||fffd||fffd|
    '   weight_p|fffd|F|fffd||fffd||fffd||311||fffd||fffd||fffd|       line_s|fffd|@|fffd|F|fffd||fffd||fffd|C|fffd||fffd||fffd|X|fffd|^|fffd|C|fffd||fffd|
    '   color_P |fffd|F|fffd|F
    '++++++++++++++++++++++++++++++++++++++++++++++++++++
    
    data_plot = True
    
    On Error GoTo DATA_ERROR
    
    With ActiveChart
        .SeriesCollection.NewSeries
        .SeriesCollection(mk_fig_job).XValues = ActiveSheet.Range(ActiveSheet.Cells(start_p, start_c), ActiveSheet.Cells(stop_p, start_c))
        .SeriesCollection(mk_fig_job).Values = ActiveSheet.Range(ActiveSheet.Cells(start_p, stop_c), ActiveSheet.Cells(stop_p, stop_c))
        .SeriesCollection(mk_fig_job).Border.Weight = weight_p
        .SeriesCollection(mk_fig_job).Border.LineStyle = line_s
        .SeriesCollection(mk_fig_job).Border.ColorIndex = color_p
        On Error Resume Next
        .Location where:=xlLocationAsObject, name:=sheet_name
    
    End With
    
    mk_fig_job = mk_fig_job + 1
    Exit Function
    
DATA_ERROR:
    data_plot = False
End Function
''**************************
' |fffd||fffd||fffd|[|fffd|N|fffd|V|fffd|[|fffd|g|fffd||308||693||fffd| FGT-VC|fffd|p
'**************************
Public Sub Sheet_move()
    
    Dim Answer As String
    Dim lngYCnt As Long
    Dim intXCnt As Long
    Dim lngYCnt0 As Long
    Dim intXCnt0 As Long
    Dim cell_char As String
    Dim new_sheet_flg As Boolean
    Dim vc_sheet_numMAX As Integer  'VC-|fffd|V|fffd|[|fffd|g|fffd||151||5414|
    Dim vc_sheet_pages As Integer 'vc|fffd|V|fffd|[|fffd|g|fffd||fffd|
    Dim sheet_num_total As Integer
    Dim vc_sheet_num_total As Integer
    Dim i_loop As Integer
    
    ma_si_colend_flg = False
    's_row = 0
    's_col = 0
    Sheet_del = True
    Sheet_max = False
    sheet_num = 0
    'Sheet_first_name = Mid(ActiveSheet.name, 1, 3) & test_name_num & "-"
    Sheet_first_name = "VC-"  'VC-|fffd||255||3cd|X|fffd|K|fffd|v
    sheet_num_total = ActiveWorkbook.Worksheets.Count
    
    For i_loop = 1 To sheet_num_total
        If Mid(ActiveWorkbook.Worksheets(i_loop).name, 1, 3) = Sheet_first_name Then
            vc_sheet_num_total = vc_sheet_num_total + 1
            vc_sheet_pages = Val(Mid(ActiveWorkbook.Worksheets(i_loop).name, 4, 3))
            If vc_sheet_numMAX < vc_sheet_pages Then
                vc_sheet_numMAX = vc_sheet_pages
            End If
        End If
    Next
    
    'Sheet_next = vc_sheet_numMAX + 1
    
    lngYCnt = ActiveSheet.UsedRange.Cells.row
    intXCnt = ActiveSheet.UsedRange.Cells.Column
    lngYCnt0 = ActiveSheet.UsedRange.Cells.Rows.Count
    intXCnt0 = ActiveSheet.UsedRange.Cells.Columns.Count
    lngYCnt = lngYCnt + lngYCnt0 - 1
    intXCnt = intXCnt0 + intXCnt - 1
    cell_char = ActiveSheet.Cells(1, 1).Value
    
    If lngYCnt = 1 And intXCnt = 1 And cell_char = "" And Mid(ActiveSheet.name, 1, 3) = "VC-" Then
        new_sheet_flg = True
        Exit Sub
    Else
        new_sheet_flg = False
    End If
    
    Sheet_next = sheet_num + vc_sheet_numMAX                                              '|fffd||fffd||fffd||303|V|fffd|[|fffd|g|fffd||314||50d||fffd|
    sheet_name = Sheet_first_name & vc_sheet_numMAX
    Sheet_flg = Sheet_first_name & Sheet_next                               '|fffd||fffd||fffd||303|V|fffd|[|fffd|g|fffd||fffd|
    
    Do
        If check_Sheet(Sheet_flg) Then                                      '|fffd||fffd||fffd||303|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||30f||a347|
            Sheet_next = Sheet_next + 1
            Sheet_flg = Sheet_first_name & Sheet_next
        Else
            Exit Do
        End If
    Loop

    If Sheets.Count >= 255 Then                                             '|fffd||402||182||82||303|t|fffd|@|fffd|C|fffd||fffd||fffd||243||fffd||fffd|[|fffd|N|fffd|V|fffd|[|fffd|g|fffd||fffd|256|fffd||82||702||fffd|
        'ActiveSheet.Cells(DATA_START + 1, 1).Select
        Sheet_max = True
        
        '|fffd|Q|fffd|T|fffd|T|fffd||12d02||fffd||fffd||fffd||a347||fffd|A|fffd|V|fffd|K|fffd|u|fffd|b|fffd|N|fffd||fffd||fffd|J|fffd||fffd|
        ActiveWorkbook.Save                                                         '|fffd||6d1||fffd||fffd||fffd||fffd||fffd|
        Workbooks.Add
        ActiveWorkbook.SaveAs Filename:=sm_folder & "\" & File_name                 '|fffd||fffd||fffd||742||303|u|fffd|b|fffd|N|fffd||16f11|O|fffd||fffd||3c2||fffd||fffd||115||6d1||fffd|

        Worksheets(1).name = "VC-1"
        Application.DisplayAlerts = False
        
        Do While Val(Worksheets.Count) > 1                                              '|fffd|c|fffd||fffd||303|V|fffd|[|fffd|g|fffd||351|S|fffd||fffd||fffd||fffd||fffd||fffd|
            On Error Resume Next
            Worksheets(2).Delete
        Loop
        
        MsgBox MES4 & File_name & ".", vbExclamation, OBI_STR                             '"|fffd||24b|L|fffd|^|fffd||fffd||fffd||702||fffd||fffd|B"
        Application.DisplayAlerts = True
        '|fffd||fffd||fffd||30f||fffd||fffd||fffd||fffd||fffd|
        test_times = 0
        max_sheet_cont = 0
        dataonly_cellout_cnt = 0
        
        Exit Sub
    End If
    
    Worksheets.Add after:=Worksheets(Sheets.Count)                          '|fffd||fffd||fffd||742||303|V|fffd|[|fffd|g|fffd||30c||fffd||243|V|fffd|[|fffd|g|fffd||1c9||fffd|
    ActiveSheet.name = Sheet_first_name & Sheet_next                        '|fffd||fffd||fffd||303|V|fffd|[|fffd|g|fffd||fffd||fffd||255||3cd|X

    last_selected_sheet = ActiveSheet.name

    Worksheets(Sheet_first_name & Sheet_next).Activate                      '|fffd|V|fffd||fffd||fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd||fffd|A|fffd|N|fffd|e|fffd|B|fffd|u|fffd||fffd|
    ActiveSheet.Cells(1, 1).Select                                          '|fffd|Z|fffd||fffd||fffd||fffd||fffd||fffd||fffd||292|u
End Sub

'************************
'  |fffd||fffd||fffd||303|V|fffd|[|fffd|g|fffd||317|L|fffd||fffd||fffd||fffd||fffd||fffd|
'************************
Private Function check_Sheet(sheet)                                         '|fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||317|L|fffd||fffd||fffd||314||fffd||fffd||fffd|
    Dim sn As Object
    Dim vsn_name As String
    
    vsn_name = Mid(sheet, 1, 3)
    
    For Each sn In Sheets
        If LCase(vsn_name) = LCase(Mid(sn.name, 1, 3)) Then                 '|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            Sheet_next = Val(Mid(sn.name, 4, 3)) + 1
        End If
    Next sn

End Function
Public Function check_Sheet_toukei(sheet) As Boolean                                  '|fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||317|L|fffd||fffd||fffd||314||fffd||fffd||fffd|
    Dim sn As Object
    Dim vsn_name As String
    Dim sheet_existence As Boolean
    
    no_tokei_sheet_flg = False
    vsn_name = sheet
    sheet_existence = False
    
    For Each sn In Sheets
        If LCase(vsn_name) = LCase(sn.name) Then                            '|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            sheet_existence = True
        End If
    Next sn
    
    If sheet_existence = False Then
        no_tokei_sheet_flg = True
        check_Sheet_toukei = False
    Else
        check_Sheet_toukei = True
    End If
    
End Function
Private Sub outp_toukei_sheet()                                             '|fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|g|fffd||58f|o|fffd||fffd|
    Dim head_row As Long
    On Error Resume Next
    Columns("A:E").Select
    Selection.ColumnWidth = 18

    head_row = head_row_out()
    head_row = head_row + 1
    hakuri_toukei_start_cell = head_row
    hakai_toukei_start_cell = head_row
    leak_toukei_start_cell = head_row
    atuhiki_toukei_start_cell = head_row
    
End Sub

Private Function head_row_out() As Long
    Dim head As Long
    head = T_cel_row  '|fffd||fffd|
'    head_row_out = enter_para(TOUKEI)                                       '|fffd|w|fffd|b|fffd|_|fffd|[|fffd|L|fffd||fffd||fffd|s+1|fffd||fffd||fffd||fffd|J|fffd|n
    st_header

End Function

'*******************************************************
'MAX|fffd|V|fffd|[|fffd|g|fffd||30d||c42c||fffd|@FGT-VC|fffd|p      |fffd|f|fffd|[|fffd|^|fffd||313||fffd||fffd||34d||fffd||fffd||fffd|
'*******************************************************
'*******************************************************


Public Sub toukeisheet_max_output()
'USA
    'Dim output_job As Integer
    Dim dummy_name As String
    Dim sheet_pages As Integer
    Dim ii As Integer
    
    Dim max_data As Double
    Dim min_data As Double
    Dim ave_data As Double
    Dim standard_hensa As Double
    
    Dim max_data_M As Double
    Dim min_data_M As Double
    Dim ave_data_M As Double
    Dim standard_hensa_M As Double
    
    Dim sheet_name_before_maxsheet As String
    Dim sheet_num_before_maxsheet As Integer
    Dim sheet_name_forlink As String    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|gname
    Dim y_cont As Integer
    Dim sheet_name_first As String      '|fffd||fffd||fffd||4e38c||fffd||fffd||30f||fffd||fffd||7c2||303|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||742||303|V|fffd|[|fffd|g|fffd||316||fffd||fffd|O
    Dim sheet_num_total As Integer
    Dim maxsheet_num As Integer
    Dim i_loop As Integer
    Dim j_loop As Integer
    Dim k_loop As Integer
    
    '***********|fffd||fffd||fffd||fffd||fffd||fffd|**************
    C_P_cnt = 0
    C_P_cnt_M = 0
    max_data = 0
    min_data = 0
    ave_data = 0
    standard_hensa = 0
    '*******************************
    
    sheet_num_total = ActiveWorkbook.Worksheets.Count
    
    For i_loop = 1 To sheet_num_total
        
        If Mid(ActiveWorkbook.Worksheets(i_loop).name, 1, 4) = "MAX-" Then
            maxsheet_num = Val(Mid(ActiveWorkbook.Worksheets(i_loop).name, 5, 3))
            
            If max_sheet_cont < maxsheet_num Then
                max_sheet_cont = maxsheet_num
            End If
        
        End If
    
    Next
        
    If test_times_cont < cont_num Then
        test_times_cont = test_times_cont + 1
    End If
    
    sheet_name_before_maxsheet = ActiveSheet.name
    sheet_num_before_maxsheet = Val(Mid(sheet_name_before_maxsheet, 4, 3))
    sheet_num_start = sheet_num_before_maxsheet - toukei_sheet_cont + 1
    dummy_name = "MAX-" & (max_sheet_cont + 1)
    sheet_pages = Val(ActiveWorkbook.Worksheets.Count)
    
    If graph_on_flg = False Then
        sheet_num_start = Mid(off_sheet_strt, 4)
    End If

    sheet_name_first = "VC-" & sheet_num_start
    Worksheets.Add before:=Worksheets(sheet_name_first)
    ActiveSheet.name = dummy_name
    
    For j_loop = 0 To 9999
        C_P_data(j_loop) = 0
        C_P_data_M(j_loop) = 0
    Next
        
    On Error Resume Next
    
    With ActiveSheet
        
        max_sheet_header
        
        .Cells(1, 2) = "'" & Date
        .Cells(3, 2) = "FG*-" & rate_load_kg
        .Cells(4, 2) = main_frm_fgt.unit_name
        
        .Cells(15, 2) = cont_num
        .Cells(16, 2) = sample_num
        
        
        If graph_on_flg = True Then
            
            For ii = 0 To test_times_cont - 1
               
                .Cells(27 + ii, 1) = ii + 1
                .Cells(27 + ii, 1).HorizontalAlignment = xlCenter
                                
                '|fffd||fffd||fffd||fffd||fffd|N|fffd||1c9||fffd||fffd|v
                
                If (test_mode_num = 3 Or test_mode_num = 4) And sample_flg(ii) = True Then
                    
                    sheet_name_forlink = "VC-" & (sheet_num_start + y_cont)
                    
                    With Worksheets(sheet_name_forlink)
                        .Select
                        .Activate
                        .Cells(26, 2) = dummy_name
                        .Cells(26, 2).Select
                        .Hyperlinks.Add Anchor:=Selection, Address:="", _
                            SubAddress:="'" & dummy_name & "'!A1", TextToDisplay:=dummy_name
                        Worksheets(dummy_name).Select
                        Worksheets(dummy_name).Activate
                    End With
                    
                    .Cells(27 + ii, 2).Select
                    .Hyperlinks.Add Anchor:=Selection, Address:="", _
                            SubAddress:="'" & (sheet_name_forlink & "'") & "!A1", TextToDisplay:=sheet_name_forlink
                    y_cont = y_cont + 1
                
                End If
                
                
                If sample_flg(ii) = True Then
                    .Cells(27 + ii, 2) = sheet_name_forlink
                End If
                                
                .Cells(27 + ii, 2).HorizontalAlignment = xlCenter
                                
  '&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
                If p_nodata_flg(ii) = True Then
                    .Cells(27 + ii, 3) = "NO DATA"
                    .Cells(27 + ii, 4) = "NO DATA"
                
                Else
                    .Cells(27 + ii, 3) = max_load_cell(ii)
                    .Cells(27 + ii, 4) = max_load(ii)
                
                End If
                
                If m_nodata_flg(ii) = True Then
                    .Cells(27 + ii, 5) = "NO DATA"
                    .Cells(27 + ii, 6) = "NO DATA"
                
                Else
                    .Cells(27 + ii, 5) = M_max_load_cell(ii)
                    .Cells(27 + ii, 6) = M_max_load(ii)
                
                End If
                
                .Cells(27 + ii, 3).HorizontalAlignment = xlCenter
                .Cells(27 + ii, 4).HorizontalAlignment = xlCenter
                .Cells(27 + ii, 5).HorizontalAlignment = xlCenter
                .Cells(27 + ii, 6).HorizontalAlignment = xlCenter
                
                                
                If Worksheets(sheet_name_forlink).Cells(25, 1).Value = "" Then
                    .Cells(27 + ii, 3) = ""
                    .Cells(27 + ii, 4) = ""
                    .Cells(27 + ii, 5) = ""
                    .Cells(27 + ii, 6) = ""
                
                End If
                                                        
                .Range(Cells(26 + ii, 1), Cells(26 + ii, 6)).Borders.LineStyle = True
                
            Next
                     
            .Range(Cells(26 + test_times_cont, 1), Cells(26 + test_times_cont, 6)).Borders.LineStyle = 1
            .Range(Cells(26, 1), Cells(26, 6)).Borders(xlEdgeBottom).LineStyle = xlDouble  '|fffd||fffd|d|fffd||fffd|
                                
            For k_loop = 0 To test_times_cont - 1
                
                If .Cells(27 + k_loop, 4) <> "" And .Cells(27 + k_loop, 4) <> "NO DATA" Then
                    C_P_data(C_P_cnt) = .Cells(27 + k_loop, 4)
                    C_P_cnt = C_P_cnt + 1
               
                End If
                
                If .Cells(27 + k_loop, 6) <> "NO DATA" Then
                    C_P_data_M(C_P_cnt_M) = .Cells(27 + k_loop, 6)
                    C_P_cnt_M = C_P_cnt_M + 1
               
                End If
                
            Next
            
            
        Else
            max_output_graph_off
        
        End If
       
       
        max_data = Max_weight(C_P_data(), C_P_cnt)
        min_data = Min_weight(C_P_data(), C_P_cnt)
        ave_data = weight_average(C_P_data(), C_P_cnt)
        standard_hensa = Weight_varp(C_P_data(), C_P_cnt, ave_data)
        
        .Cells(6, 2) = max_data
        .Cells(7, 2) = min_data
        .Cells(8, 2) = calc_round(ave_data, (input_point_len + 1))
        .Cells(9, 2) = calc_round(standard_hensa, (input_point_len + 1))
                
        max_data_M = Max_weight(C_P_data_M(), C_P_cnt_M)
        min_data_M = Min_weight(C_P_data_M(), C_P_cnt_M)
        ave_data_M = weight_average(C_P_data_M(), C_P_cnt_M)
        standard_hensa_M = Weight_varp(C_P_data_M(), C_P_cnt_M, ave_data_M)
                                    
        .Cells(10, 2) = max_data_M
        .Cells(11, 2) = min_data_M
        .Cells(12, 2) = calc_round(ave_data_M, (input_point_len + 1))
        .Cells(13, 2) = calc_round(standard_hensa_M, (input_point_len + 1))
       
 
 
 'else

 '    Dim dummy_name As String
 '    Dim sheet_pages As Integer
 '    Dim ii As Integer
 '    Dim max_data As Double
 '    Dim min_data As Double
 '    Dim ave_data As Double
 '    Dim standard_hensa As Double
 '    Dim sheet_name_before_maxsheet As String
 '    Dim sheet_num_before_maxsheet As Integer
 '    Dim sheet_name_forlink As String    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|v|fffd|V|fffd|[|fffd|gname
 '    Dim y_cont As Integer
 '    Dim sheet_name_first As String      '|fffd||fffd||fffd||4e38c||fffd||fffd||30f||fffd||fffd||7c2||303|f|fffd|[|fffd|^|fffd||fffd||835e||fffd||742||303|V|fffd|[|fffd|g|fffd||316||fffd||fffd|O
 '    Dim sheet_num_total As Integer
 '    Dim maxsheet_num As Integer
 '    Dim i_loop As Integer
 '    Dim j_loop As Integer
 '    Dim k_loop As Integer
    
    '***********|fffd||fffd||fffd||fffd||fffd||fffd|**************
  '   C_P_cnt = 0
  '   max_data = 0
  '   min_data = 0
  '   ave_data = 0
  '   standard_hensa = 0
    '*******************************
    
    ' sheet_num_total = ActiveWorkbook.Worksheets.Count
    
   '  For i_loop = 1 To sheet_num_total
        
   '      If Mid(ActiveWorkbook.Worksheets(i_loop).name, 1, 4) = "MAX-" Then
   '          maxsheet_num = Val(Mid(ActiveWorkbook.Worksheets(i_loop).name, 5, 3))
            
     '        If max_sheet_cont < maxsheet_num Then
      '           max_sheet_cont = maxsheet_num
      '       End If
        
     '    End If
    
     'Next
        
    ' If test_times_cont < cont_num Then
      '   test_times_cont = test_times_cont + 1
    ' End If
    
    ' sheet_name_before_maxsheet = ActiveSheet.name
     'sheet_num_before_maxsheet = Val(Mid(sheet_name_before_maxsheet, 4, 3))
     'sheet_num_start = sheet_num_before_maxsheet - toukei_sheet_cont + 1
    ' dummy_name = "MAX-" & (max_sheet_cont + 1)
     'sheet_pages = Val(ActiveWorkbook.Worksheets.Count)
    
     'If graph_on_flg = False Then
     '    sheet_num_start = Mid(off_sheet_strt, 4)
     'End If

     'sheet_name_first = "VC-" & sheet_num_start
     'Worksheets.Add before:=Worksheets(sheet_name_first)
     'ActiveSheet.name = dummy_name
    
     'For j_loop = 0 To 9999
     '    C_P_data(j_loop) = 0
     'Next
    
     'On Error Resume Next
    
     'With ActiveSheet
        
        ' max_sheet_header
        
        ' .Cells(1, 2) = "'" & Date
       '  .Cells(3, 2) = "FG*-" & rate_load_kg
       '  .Cells(4, 2) = main_frm_fgt.unit_name
        
        '.Cells(11, 2) = cont_num
        '.Cells(12, 2) = sample_num
        
         'If graph_on_flg = True Then
            
         '    For ii = 0 To test_times_cont - 1
               
        '         .Cells(27 + ii, 1) = ii + 1
         '        .Cells(27 + ii, 1).HorizontalAlignment = xlCenter
                                
                '|fffd||fffd||fffd||fffd||fffd|N|fffd||1c9||fffd||fffd|v
                
           '      If (test_mode_num = 3 Or test_mode_num = 4) And sample_flg(ii) = True Then
                    
             '        sheet_name_forlink = "VC-" & (sheet_num_start + y_cont)
                    
              '       With Worksheets(sheet_name_forlink)
               '          .Select
               '          .Activate
                '         .Cells(21, 2) = dummy_name
               '          .Cells(21, 2).Select
                '         .Hyperlinks.Add Anchor:=Selection, Address:="", _
                '             SubAddress:="'" & dummy_name & "'!A1", TextToDisplay:=dummy_name
                 '        Worksheets(dummy_name).Select
                '         Worksheets(dummy_name).Activate
                 '    End With
                    
                '     .Cells(27 + ii, 2).Select
                '     .Hyperlinks.Add Anchor:=Selection, Address:="", _
                 '            SubAddress:="'" & (sheet_name_forlink & "'") & "!A1", TextToDisplay:=sheet_name_forlink
                   '  y_cont = y_cont + 1
                
                ' End If
                
                
                ' If sample_flg(ii) = True Then
                 '    .Cells(27 + ii, 2) = sheet_name_forlink
                 'End If
                
                
                 '.Cells(27 + ii, 2).HorizontalAlignment = xlCenter
                ' .Cells(27 + ii, 3) = max_load_cell(ii)
                ' .Cells(27 + ii, 3).HorizontalAlignment = xlCenter
                ' .Cells(27 + ii, 4) = max_load(ii)
                ' .Cells(27 + ii, 4).HorizontalAlignment = xlCenter
                
                
                 'If Worksheets(sheet_name_forlink).Cells(25, 1).Value = "" Then
                    
                 '    .Cells(27 + ii, 3) = ""
                  '   .Cells(27 + ii, 4) = ""
                
                ' End If
                
                
                 '.Range(Cells(26 + ii, 1), Cells(26 + ii, 4)).Borders.LineStyle = True
            
            ' Next
            
            
             '.Range(Cells(26 + test_times_cont, 1), Cells(26 + test_times_cont, 4)).Borders.LineStyle = 1
            ' .Range(Cells(26, 1), Cells(26, 4)).Borders(xlEdgeBottom).LineStyle = xlDouble  '|fffd||fffd|d|fffd||fffd|
            
            
            ' For k_loop = 0 To test_times_cont - 1
                
             '    If .Cells(27 + k_loop, 4) <> "" Then
              '       C_P_data(C_P_cnt) = .Cells(27 + k_loop, 4)
              '       C_P_cnt = C_P_cnt + 1
              '
              '  End If
                
             'Next
            
            
         'Else
           '  max_output_graph_off
        
         'End If
       
       
         'max_data = Max_weight(C_P_data(), C_P_cnt)
         'min_data = Min_weight(C_P_data(), C_P_cnt)
         'ave_data = weight_average(C_P_data(), C_P_cnt)
         'standard_hensa = Weight_varp(C_P_data(), C_P_cnt, ave_data)
        
         '.Cells(6, 2) = max_data
         '.Cells(7, 2) = min_data
         '.Cells(8, 2) = calc_round(ave_data, (input_point_len + 1))
         '.Cells(9, 2) = calc_round(standard_hensa, (input_point_len + 1))
        

         '.Cells(10, 2) = max_data
         '.Cells(11, 2) = min_data
         '.Cells(12, 2) = calc_round(ave_data, (input_point_len + 1))
         '.Cells(13, 2) = calc_round(standard_hensa, (input_point_len + 1))
 'endif
 
 
 
 
 
 
 
 
 
        
    End With

End Sub


'***********************
'   |fffd|Z|fffd||fffd||fffd||582||30f|o|fffd||34f||fffd||fffd||fffd|    FGT-VS|fffd|p
'***********************
Public Sub cell_output()
    '|fffd|O|fffd||fffd||fffd|tOFF|fffd||fffd||fffd|A|fffd|w|fffd|b|fffd|_|fffd|f|fffd|[|fffd|^|fffd||313||fffd||fffd||342||202||fffd||fffd|A|fffd|f|fffd|[|fffd|^|fffd||302||fffd|
    '|fffd|O|fffd||fffd||fffd|tON|fffd||fffd||fffd|A|fffd|w|fffd|b|fffd|_|fffd|f|fffd|[|fffd|^|fffd||183|e|fffd|X|fffd|g|fffd|f|fffd|[|fffd|^|fffd||182||fffd||fffd||fffd||fffd||fffd|
    
    'activesheet|fffd||308||68d|s|fffd||fffd||fffd|v  sheet_move
    
    Dim row As Long
    Dim col As Long
    Dim i As Integer
    Dim lngYCnt0 As Long
    Dim intXCnt0 As Long
    Dim lngYCnt1 As Long
    Dim intXCnt1 As Long
    Dim a As String
    Dim b As String
    
    If (test_mode_num = 3 Or test_mode_num = 4) And sample_flg(test_times_cont) = False Then
        Exit Sub
    End If
    
    C_P_max_make_flg = True             'ryu
    
    If graph_on_flg = False Then
        
        If Mid(ActiveSheet.Cells(1, 1).Value, 1, 4) = "Date" Then
            outp_mdl_e.Sheet_move
            dataonly_cellout_cnt = 0
        
        End If
        
        If data_cnt = 0 Then
            
            If test_times_cont = 0 Then
                off_sheet_strt = ActiveSheet.name
                
            End If
            
            last_selected_sheet = ActiveSheet.name
            lngYCnt0 = ActiveSheet.UsedRange.Cells.row
            intXCnt0 = ActiveSheet.UsedRange.Cells.Column
            lngYCnt1 = ActiveSheet.UsedRange.Cells.Rows.Count
            intXCnt1 = ActiveSheet.UsedRange.Cells.Columns.Count
            lngYCnt_used = lngYCnt1 + lngYCnt0 - 1       '|fffd|g|fffd|p|fffd||3c2||74d||14f|I|fffd|sNo.|fffd||30e||64fe||fffd|i|fffd||fffd||fffd||fffd|J|fffd|n|fffd||fffd||fffd|j
            intXCnt_used = intXCnt1 + intXCnt0 - 1       '|fffd|g|fffd|p|fffd||3c2||74d||14f|I|fffd||fffd|No.|fffd||30e||64fe||fffd|i|fffd||fffd||fffd||fffd|J|fffd|n|fffd||fffd||fffd|j
            
            If lngYCnt_used = 1 And intXCnt_used = 1 And (ActiveSheet.Cells(1, 1).Value = "") Then
                lngYCnt_used = 0
                intXCnt_used = 0
                
            End If
            
        End If
        
        If main_frm_fgt.CellSelect_lbl.Caption = "" And mae_cell_flg = False Then
            
            If intXCnt_used >= (Col_MAX - 1) Then
                outp_mdl_e.Sheet_move
            End If
            
            If data_cnt = 0 Then
                
                
                
'#If NSCA_V103 Then
                If length_type_num = MM_UNIT Then
                    ActiveSheet.Cells(1, intXCnt_used + 1) = HENI_STR '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v
                
                Else
                    ActiveSheet.Cells(1, intXCnt_used + 1) = HENI_STR_INCH '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v
                
                End If
        
'#End If
                
                
                
                ActiveSheet.Cells(1, intXCnt_used + 2) = "Force" & "(" & main_frm_fgt.unit_name & ")"  '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v
                off_cel(test_times_cont) = ActiveSheet.name
                off_last_sheet = ActiveSheet.name
                b = off_cel(test_times_cont)
                a = Range(Cells(1, intXCnt_used + 1), Cells(1, intXCnt_used + 1)).Address(ReferenceStyle:=xlA1, RowAbsolute:=False)
                off_cel(test_times_cont) = off_cel(test_times_cont) & "'!" & Mid(a, 2)
                
            End If
            
            ActiveSheet.Cells(2 + data_cnt, intXCnt_used + 1) = move_data(data_cnt)
            ActiveSheet.Cells(2 + data_cnt, intXCnt_used + 2) = weight_data(data_cnt)
            ActiveSheet.Cells(2 + data_cnt, intXCnt_used + 1).Select
            
        ElseIf main_frm_fgt.CellSelect_lbl.Caption <> "" Or mae_cell_flg = True Then
            
            If mae_cell_flg = True And main_frm_fgt.CellSelect_lbl.Caption = "" And data_cnt = 0 Then
                If (test_mode_num = 3 Or test_mode_num = 4) And test_times_cont > 0 Then
                    s_col = s_col
                Else
                    s_row = ActiveCell.row                                  '|fffd|J|fffd|n|fffd||292|u|fffd|Z|fffd||fffd| |fffd|s
                    s_col = ActiveCell.Column                               '|fffd|J|fffd|n|fffd||292|u|fffd|Z|fffd||fffd| |fffd||fffd|
                End If
            End If
            
            If (s_col + 2 * dataonly_cellout_cnt) >= Col_MAX Then
                outp_mdl_e.Sheet_move
                dataonly_cellout_cnt = 0
                s_col = 1
            End If
            
            If data_cnt = 0 Then
                
                
                
                
                
'#If NSCA_V103 Then
            If length_type_num = MM_UNIT Then
                ActiveSheet.Cells(s_row, s_col + 2 * dataonly_cellout_cnt) = HENI_STR  '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v
            
            Else
                ActiveSheet.Cells(s_row, s_col + 2 * dataonly_cellout_cnt) = HENI_STR_INCH  '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v
            
            End If
        
'#End If
                
                ActiveSheet.Cells(s_row, s_col + 2 * dataonly_cellout_cnt + 1) = "Force" & "(" & main_frm_fgt.unit_name & ")" '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v
                off_cel(test_times_cont) = ActiveSheet.name
                off_last_sheet = ActiveSheet.name
                b = off_cel(test_times_cont)
                a = Range(Cells(s_row, s_col + 2 * dataonly_cellout_cnt), Cells(s_row, s_col + 2 * dataonly_cellout_cnt)).Address(ReferenceStyle:=xlA1, RowAbsolute:=False)

                off_cel(test_times_cont) = off_cel(test_times_cont) & "'!" & Mid(a, 2)
                
            End If
            
            If s_row < Rows_Max Then

                ActiveSheet.Cells(s_row + 1 + data_cnt, s_col + 2 * dataonly_cellout_cnt) = move_data(data_cnt)
                ActiveSheet.Cells(s_row + 1 + data_cnt, s_col + 2 * dataonly_cellout_cnt + 1) = weight_data(data_cnt)
                ActiveSheet.Cells(s_row + 1 + data_cnt, s_col + 2 * dataonly_cellout_cnt).Select
            
            End If
            
        End If
        
    ElseIf graph_on_flg = True Then
    

        If main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
            If data_cnt = 0 Then
                
                If test_times_cont = 0 Then
                    load_triger_a = Fix(move_data(data_cnt))
                Else
                    
                    If move_data(data_cnt) < load_triger_a Then
                        load_triger_a = Fix(move_data(data_cnt))
                    End If
                
                End If
            End If
        End If
                
        '|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||fffd|
        
        If test_mode_num = 0 Or test_mode_num = 2 Then
            ActiveSheet.Cells(24 + data_cnt, 1) = move_data(data_cnt)
            ActiveSheet.Cells(24 + data_cnt, 2) = weight_data(data_cnt)
            ActiveSheet.Cells(24 + data_cnt, 1).Select
        
        ElseIf test_mode_num = 3 Or test_mode_num = 4 Then
            ActiveSheet.Cells(29 + data_cnt, 1) = move_data(data_cnt)
            ActiveSheet.Cells(29 + data_cnt, 2) = weight_data(data_cnt)
            ActiveSheet.Cells(29 + data_cnt, 1).Select
        
        End If
        
        
    End If

End Sub
'*****************************************************
''''''''''FGVT-VC|fffd|\|fffd|t|fffd|g|fffd|p
'*****************************************************
Public Sub st_header()
    With ActiveSheet
        On Error Resume Next
        Columns("A:A").ColumnWidth = 14                     '|fffd|Z|fffd||fffd||fffd||315||fffd||fffd||752||fffd|
        Columns("B:B").ColumnWidth = 19
        Columns("P:S").ColumnWidth = 0.05

        
        If test_mode_num = 0 Or test_mode_num = 2 Then
            
            '|fffd|R|fffd|[|fffd|h|fffd||255||3cd|X|fffd|v
            .Cells(1, 1) = TEST_DAY_STR                                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            .Cells(1, 2) = "'" & Now()
            
            .Cells(3, 1) = "Direction"                                      '.Cells(3, 1) = "|fffd||693||fffd||fffd|J|fffd|n|fffd||fffd||fffd||fffd|"
            .Cells(3, 2) = test_start_direction
            
            .Cells(4, 1) = "Test mode"                                      '.Cells(4, 1) = "|fffd||fffd||fffd||c0c2||fffd|[|fffd|h"
            .Cells(4, 2) = test_mode_name
            
            .Cells(5, 1) = "Force Gauge"                                    '.Cells(5, 1) = "|fffd||691||fffd|FG"
            .Cells(5, 2) = "FG*-" & rate_load_kg
            
            .Cells(6, 1) = "Force Unit"                                     '.Cells(6, 1) = "|fffd||5cf|d|fffd|P|fffd||fffd|"
            .Cells(6, 2) = main_frm_fgt.unit_name
            
            .Cells(7, 1) = "Sampling Rate"                                  '.Cells(7, 1) = "|fffd||635e||fffd||50a|u"
            .Cells(7, 2) = main_frm_fgt.torikomikankaku
            
            If main_frm_fgt.OptionButton_toriga_heni.Value = True Then      '|fffd|g|fffd||fffd||fffd|K|fffd||355||3c8||291|I|fffd||fffd||fffd||fffd|
                .Cells(8, 1) = "Trigger(Distance)"                          '.Cells(8, 1) = "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j"
            ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
                .Cells(8, 1) = "Trigger(Force)"                             '.Cells(8, 1) = "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||5cf|d|fffd|j"
            End If
            
            .Cells(8, 2) = triger
            .Cells(9, 1) = "Number of data"                                 '.Cells(9, 1) = "|fffd|f|fffd|[|fffd|^|fffd||fffd|"
                        
            
'USA
            .Cells(10, 1) = "'+ Maximum"            '.Cells(12, 1) = "|fffd||151||fffd|l"
            .Cells(11, 1) = "'+ Minimum"            '.Cells(13, 1) = "|fffd||14f||fffd||fffd|l"
            
            
            .Cells(12, 1) = "'- Maximum"            '.Cells(12, 1) = "|fffd||151||fffd|l"
            .Cells(13, 1) = "'- Minimum"            '.Cells(13, 1) = "|fffd||14f||fffd||fffd|l"
            
            
            .Cells(14, 1) = "Average"               '.Cells(14, 1) = "|fffd||fffd||fffd||3d2|l"
            
            .Cells(16, 1) = "'+ Upper limit"        '.Cells(16, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(16, 2) = max_limit
            .Cells(17, 1) = "'+ Lower limit"        '.Cells(17, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(17, 2) = min_limit
            .Cells(18, 1) = "'+ Result"             '.Cells(18, 1) = "|fffd||fffd||fffd||fffd|"
            
            
            .Cells(19, 1) = "'- Upper limit"        '.Cells(16, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(20, 1) = "'- Lower limit"        '.Cells(17, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(21, 1) = "'- Result"             '.Cells(18, 1) = "|fffd||fffd||fffd||fffd|"
            
            
            If set_AbsValue_flg = True Then
                .Cells(19, 2) = "Invalid"
                .Cells(20, 2) = "Invalid"
            Else
                .Cells(19, 2) = M_max_limit
                .Cells(20, 2) = M_min_limit
            End If
            
            
            
            
'#If NSCA_V103 Then
            If length_type_num = MM_UNIT Then
                .Cells(23, 1) = HENI_STR          '.Cells(24, 1) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
            
            Else
                .Cells(23, 1) = HENI_STR_INCH          '.Cells(24, 1) = "|fffd||3c8||281|iinch|fffd|j"
            
            End If
        
'#End If
            
            
            .Cells(23, 2) = "Force" & "(" & main_frm_fgt.unit_name & ")"
'endif
            
            
            '.Cells(10, 1) = MAX_STR
            '.Cells(11, 1) = MIN_STR
            '.Cells(12, 1) = "Average"  '.Cells(12, 1) = "|fffd||fffd||fffd||3d2|l"
            '.Cells(14, 1) = "Upper limit"  '.Cells(14, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            '.Cells(14, 2) = max_limit
            '.Cells(15, 1) = "Lower limit"  '.Cells(15, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            '.Cells(15, 2) = min_limit
            '.Cells(16, 1) = "Result"  '.Cells(16, 1) = "|fffd||fffd||fffd||fffd|"
            '.Cells(20, 1) = "Distance(mm)"  '.Cells(20, 1) = "|fffd||3c8||281|imm) "
            '.Cells(20, 2) = "Force" & "(" & main_frm_fgt.unit_name & ")"  '.Cells(20, 2) = "|fffd||5cf|d" & "(" & main_frm_fgt.unit_name & ")"
        
        
                
        ElseIf test_mode_num = 3 Or test_mode_num = 4 Then
            
            
            .Cells(1, 1) = TEST_DAY_STR                                     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            .Cells(1, 2) = "'" & Now()
            
            If test_mode_num = 3 Then
                .Cells(3, 1) = "Direction"                                  '.Cells(3, 1) = "|fffd||693||fffd||fffd|J|fffd|n|fffd||fffd||fffd||fffd|"
                .Cells(3, 2) = test_start_direction
            End If
            
            .Cells(4, 1) = "Test mode"                                      '.Cells(4, 1) = "|fffd||fffd||fffd||c0c2||fffd|[|fffd|h"
            .Cells(4, 2) = test_mode_name
            
            .Cells(5, 1) = "Force Gauge"                                    '.Cells(5, 1) = "|fffd||691||fffd|FG"
            .Cells(5, 2) = "FG*-" & rate_load_kg
            
            .Cells(6, 1) = "Force Unit"                                     '.Cells(6, 1) = "|fffd||5cf|d|fffd|P|fffd||fffd|"
            .Cells(6, 2) = main_frm_fgt.unit_name
            
            .Cells(7, 1) = "Sampling Rate"                                  '.Cells(7, 1) = "|fffd||635e||fffd||50a|u"
            .Cells(7, 2) = main_frm_fgt.torikomikankaku
            
            .Cells(8, 1) = "Repeat Count"                                   '.Cells(8, 1) = "|fffd|J|fffd||502||fffd||fffd||fffd|"
            .Cells(8, 2) = cont_num
            
            .Cells(9, 1) = "Sampling Number"                                '.Cells(9, 1) = "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd|"
            .Cells(9, 2) = sample_num
            
            If main_frm_fgt.OptionButton_toriga_heni.Value = True Then      '|fffd|g|fffd||fffd||fffd|K|fffd||355||3c8||291|I|fffd||fffd||fffd||fffd|
                .Cells(10, 1) = "Trigger(Distance)"                         '.Cells(10, 1) = "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||3c8||281|j"
            ElseIf main_frm_fgt.OptionButton_toriga_kajyuu.Value = True Then
                .Cells(10, 1) = "Trigger(Force)"                            '.Cells(10, 1) = "|fffd|g|fffd||fffd||fffd|K|fffd|i|fffd||5cf|d|fffd|j"
            End If
            .Cells(10, 2) = triger
            

'USA
            .Cells(11, 1) = "Number of data"    '.Cells(11, 1) = "|fffd|f|fffd|[|fffd|^|fffd||fffd|"
            
            .Cells(12, 1) = "'+ Maximum"         '.Cells(12, 1) = "|fffd||151||fffd|l"
            .Cells(13, 1) = "'+ Minimum"         '.Cells(13, 1) = "|fffd||14f||fffd||fffd|l"
                       
            .Cells(14, 1) = "'- Maximum"         '.Cells(12, 1) = "|fffd||151||fffd|l"
            .Cells(15, 1) = "'- Minimum"         '.Cells(13, 1) = "|fffd||14f||fffd||fffd|l"
                    
            .Cells(16, 1) = "Average"           '.Cells(14, 1) = "|fffd||fffd||fffd||3d2|l"
            
            .Cells(18, 1) = "'+ Upper limit"       '.Cells(16, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(18, 2) = max_limit
            .Cells(19, 1) = "'+ Lower limit"       '.Cells(17, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(19, 2) = min_limit
            .Cells(20, 1) = "'+ Result"            '.Cells(18, 1) = "|fffd||fffd||fffd||fffd|"
                                            
            .Cells(21, 1) = "'- Upper limit"       '.Cells(16, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(22, 1) = "'- Lower limit"       '.Cells(17, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|l"
            .Cells(23, 1) = "'- Result"            '.Cells(18, 1) = "|fffd||fffd||fffd||fffd|"
            
            If set_AbsValue_flg = True Then
                .Cells(21, 2) = "Invalid"
                .Cells(22, 2) = "Invalid"
            
            Else
                .Cells(21, 2) = M_max_limit
                .Cells(22, 2) = M_min_limit
            
            End If
            
            .Cells(25, 1) = "Count"                 '.Cells(20, 1) = "|fffd||fffd|"
            .Cells(25, 2) = test_times_cont + 1
            
            .Cells(26, 1) = "MAX Sheet"             '.Cells(21, 1) = "MAX|fffd|V|fffd|[|fffd|g"
            
            
            
            
            
            
'#If NSCA_V103 Then
            If length_type_num = MM_UNIT Then
                .Cells(28, 1) = HENI_STR                '.Cells(24, 1) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
            
            Else
                .Cells(28, 1) = HENI_STR_INCH                '.Cells(24, 1) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
            
            End If
        
'#End If
            
            
            .Cells(28, 2) = "Force" & "(" & main_frm_fgt.unit_name & ")"  '.Cells(24, 2) = "|fffd||5cf|d" & "(" & main_frm_fgt.unit_name & ")"
            
'endif

        End If
        
    End With
End Sub

'*****************************************************
''''''''''FGVT-VC|fffd|\|fffd|t|fffd|g|fffd|p
'*****************************************************
Public Sub toukei_cell_output()
    Dim dummy_name As String
    
    With ActiveSheet
        If graph_on_flg = True Then
            If test_mode_num = 0 Or test_mode_num = 2 Then
                
                If .Cells(24, 1).Value = "" Then
                    GoTo when_blank
                End If
                                    
                .Cells(9, 2) = data_cnt
                
                If p_nodata_flg(test_times_cont) = True Then
                    .Cells(10, 2) = "NO DATA"
                    .Cells(11, 2) = "NO DATA"
                
                Else
                    .Cells(10, 2) = max_load(test_times_cont)
                    .Cells(11, 2) = min_load(test_times_cont)
                    
                End If
                
                If m_nodata_flg(test_times_cont) = True Then
                    .Cells(12, 2) = "NO DATA"
                    .Cells(13, 2) = "NO DATA"
                
                Else
                    .Cells(12, 2) = M_max_load(test_times_cont)
                    .Cells(13, 2) = M_min_load(test_times_cont)
                
                End If
                                
                .Cells(14, 1) = "Average"
                .Cells(14, 2) = calc_round(ave_load(test_times_cont), (input_point_len + 1))
                
                .Cells(18, 2) = limit_chk_text
                
                If set_AbsValue_flg = True Then
                    .Cells(21, 2) = "Invalid"
            
                Else
                    .Cells(21, 2) = M_limit_chk_text
                
                End If
                                                                                                                                       
            ElseIf test_mode_num = 3 Or test_mode_num = 4 Then
                
                If .Cells(29, 1).Value = "" Then
                    GoTo when_blank
                End If
                
                .Cells(11, 2) = data_cnt
                
                If p_nodata_flg(test_times_cont) = True Then
                    .Cells(12, 2) = "NO DATA"
                    .Cells(13, 2) = "NO DATA"
                
                Else
                    .Cells(12, 2) = max_load(test_times_cont)
                    .Cells(13, 2) = min_load(test_times_cont)
                
                End If
                
                If m_nodata_flg(test_times_cont) = True Then
                    .Cells(14, 2) = "NO DATA"
                    .Cells(15, 2) = "NO DATA"
                    
                Else
                    .Cells(14, 2) = M_max_load(test_times_cont)
                    .Cells(15, 2) = M_min_load(test_times_cont)
                
                End If
                                                                
                .Cells(16, 2) = calc_round(ave_load(test_times_cont), (input_point_len + 1))
                .Cells(20, 2) = limit_chk_text
                                
                If set_AbsValue_flg = True Then
                    .Cells(23, 2) = "Invalid"
                
                Else
                    .Cells(23, 2) = M_limit_chk_text
                
                End If
                
                .Cells(25, 2) = test_times_cont + 1    '|fffd|C|fffd||fffd||fffd|v|fffd||fffd|OK
                
            End If
                       
            .Cells(1, 1).Select
            
        End If
        
    End With

    toukei_sheet_cont = toukei_sheet_cont + 1
    
    Exit Sub

when_blank:
    toukei_sheet_cont = toukei_sheet_cont + 1

End Sub

'*******************************************************
'|fffd|v|fffd||fffd||fffd|J|fffd|n|fffd|I|fffd||fffd||fffd||292|u|fffd||312|l|fffd||183|Z|fffd||fffd||fffd||30e||64fe|
'*******************************************************
Public Sub start_stop_cell_get()
   
    Dim data_end As Long                 '|fffd|v|fffd||fffd||fffd|I|fffd||fffd||fffd||292|u|fffd|Z|fffd||fffd|
    'Dim i_loop As Long
    'Dim j_loop As Long
    
    'start_value = Val(ActiveSheet.Cells(17, 2))
    'stop_value = Val(ActiveSheet.Cells(18, 2))
    data_end = Val(ActiveSheet.Cells(11, 2).Value)                         '|fffd|f|fffd|[|fffd|^|fffd||fffd||fffd||64fe|
    DATA_START_CELL = 29
    DATA_STOP_CELL = DATA_START_CELL + data_end - 1
    
    
End Sub

Private Function get_sheet_para(i_cnt As Integer) As Boolean  '|fffd||fffd|

    '|fffd||fffd||fffd||fffd||fffd||141|A|fffd|O|fffd||fffd||fffd|t|fffd|V|fffd|[|fffd|g|fffd||253|\|fffd||fffd|t|fffd||fffd||fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|g|fffd||303|p|fffd||fffd||fffd||fffd||fffd|[|fffd|^|fffd||fffd||fffd||64fe|
    
    get_sheet_para = True
    ksn_g_test_mode = Int(Val(Mid(g_Sheet_name(i_cnt), 4, 1)))
    
    Select Case ksn_g_test_mode     '|fffd|p|fffd|x|fffd||fffd||fffd||fffd|
        Case 1  '|fffd||fffd||fffd||fffd||fffd|@
            
        Case 2  '|fffd||fffd||fffd||fffd||fffd|A
            
        Case 3
        
        Case 4
        
        Case 5
        
        Case 6
        
        Case 7
        
        Case 8
        
        Case 9
        
        Case Else
    End Select
End Function
Private Function ActiveSheet_bityousei()  '|fffd||fffd|
    '|fffd|O|fffd||fffd||fffd|t|fffd|V|fffd|[|fffd|g|fffd||303|Z|fffd||fffd||fffd||fffd||fffd||fffd||fffd||12c90||fffd|
    
    With ActiveSheet
        .Cells(1, 6) = "'" & ksn_g_title
        .Cells(1, 6).HorizontalAlignment = xlCenter
        .Cells(1, 6).Font.Bold = True
        .Cells(1, 6).Font.Size = 12
        .Cells(2, 2) = "'" & ksn_g_remarks
'        .Cells(1, 1).Select
    End With
    
    Columns("A:T").ColumnWidth = 14

    
End Function
Private Function g_data_plot(NewSeries_num As Integer, start_p As Long, start_c As Long, stop_p As Long, stop_c As Long, weight_p As Long, line_s As Integer, color_p As Integer, graph_plot_sheet As String)
    g_data_plot = True
    On Error GoTo DATA_ERROR
    Dim a_col As Integer
    
    'If maker_flg = True Then
        ActiveChart.SeriesCollection.NewSeries

    With ActiveChart.SeriesCollection(g_wake_num)
        .XValues = ActiveSheet.Range(ActiveSheet.Cells(start_p, start_c), ActiveSheet.Cells(stop_p, start_c))
        .Values = ActiveSheet.Range(ActiveSheet.Cells(start_p, stop_c), ActiveSheet.Cells(stop_p, stop_c))
        
        .name = g_keiretu_name(NewSeries_num)    'Worksheets(g_keiretu_name(NewSeries_num)).Cells(20, 2).Value
        
        ActiveSheet.Cells(start_p - 3, start_c) = Worksheets(g_keiretu_name(NewSeries_num)).Cells(25, 2).Value
                
        .Border.Weight = weight_p
        .Border.LineStyle = line_s
        .Border.ColorIndex = color_p
        .MarkerStyle = xlNone                   '-4142uni
        
        On Error Resume Next
        .Location where:=xlLocationAsObject, name:=graph_plot_sheet
    End With
    If wake_flg = True Then
        ActiveChart.Legend.LegendEntries(NewSeries_num + 1).Delete
    '    Selection.Delete
    End If
    g_wake_num = g_wake_num + 1
Exit Function

DATA_ERROR:
    g_data_plot = False
End Function
Public Sub toukeisheet_blank_check()

    If test_mode_num = 0 Or test_mode_num = 2 Then
        If ActiveSheet.Cells(24, 1).Value = "" Then
            toukeisheet_blank_check_flg = True
        Else
            toukeisheet_blank_check_flg = False
        End If
    ElseIf test_mode_num = 3 Or test_mode_num = 4 Then
        If ActiveSheet.Cells(29, 1).Value = "" Then
            toukeisheet_blank_check_flg = True
        Else
            toukeisheet_blank_check_flg = False
        End If
    End If
    
End Sub

Public Sub max_output_graph_off()

    Dim ii As Long
    Dim len_a As Integer
    Dim test_num As Integer
    Dim test_num_M As Integer
    
    test_num = 0
    test_num_M = 0
    
    With ActiveSheet
            
        For ii = 0 To test_times_cont - 1
            .Cells(19 + ii, 1) = ii + 1
            .Cells(19 + ii, 1).HorizontalAlignment = xlCenter
            
            If off_cel(ii) <> "" Then
                len_a = InStr(off_cel(ii), "'")
                .Cells(19 + ii, 2) = Left(off_cel(ii), len_a - 1)
                .Cells(19 + ii, 2).HorizontalAlignment = xlCenter
                
                If (test_mode_num = 3 Or test_mode_num = 4) And sample_flg(ii) = True Then
                    .Cells(19 + ii, 2).Select
                    .Hyperlinks.Add Anchor:=Selection, Address:="", _
                            SubAddress:="'" & off_cel(ii) ', 'TextToDisplay:=ii + 1
    
                End If
                
            End If
            
            
            If C_P_aru_flg(ii) = True Then
                
                If p_nodata_flg(ii) = True Then
                    .Cells(19 + ii, 3) = "NO DATA"
                    .Cells(19 + ii, 4) = "NO DATA"
                Else
                    .Cells(19 + ii, 3) = max_load_cell(ii)
                    .Cells(19 + ii, 4) = max_load(ii)
                    
                    C_P_data(test_num) = max_load(ii)
                    test_num = test_num + 1
                    
                End If
                
                If m_nodata_flg(ii) = True Then
                    .Cells(19 + ii, 5) = "NO DATA"
                    .Cells(19 + ii, 6) = "NO DATA"
                Else
                    .Cells(19 + ii, 5) = M_max_load_cell(ii)
                    .Cells(19 + ii, 6) = M_max_load(ii)
                    C_P_data_M(test_num_M) = M_max_load(ii)
                    test_num_M = test_num_M + 1
                                        
                End If
                
                .Cells(19 + ii, 3).HorizontalAlignment = xlCenter
                .Cells(19 + ii, 4).HorizontalAlignment = xlCenter
                .Cells(19 + ii, 5).HorizontalAlignment = xlCenter
                .Cells(19 + ii, 6).HorizontalAlignment = xlCenter
                
            End If
            
        Next
        
        C_P_cnt = test_num
        C_P_cnt_M = test_num_M
        
        .Range(Cells(18, 1), Cells(18 + test_times_cont, 6)).Borders.LineStyle = 1
        .Range(Cells(18, 1), Cells(18, 6)).Borders(xlEdgeBottom).LineStyle = xlDouble  '|fffd||fffd|d|fffd||fffd|
    
    End With
End Sub
'******************************
'SING|fffd||fffd||fffd|[|fffd|h|fffd||fffd|MAX|fffd|V|fffd|[|fffd|g
'******************************
Public Sub max_output_single()
    Dim s_cnt As Integer
    Dim i_loop As Integer
    Dim s_make_flg As Boolean
    
    s_make_flg = True
    
    s_cnt = Worksheets.Count

    For i_loop = 1 To s_cnt
        
        If Worksheets(i_loop).name = "MAX-S" Then
            s_make_flg = False
            Exit For
        End If
        
    Next
    
    off_last_sheet = ActiveSheet.name
    
    If s_make_flg = True Then
        single_max_sheet_make
        max_s_row = 16
    
    Else
        Worksheets("MAX-S").Select
        cell_Position
    
    End If
    
    sing_max_sheet_toukei_output
    toukei_of_toukei
    ActiveSheet.Cells(1, 1).Activate
    Worksheets(off_last_sheet).Select
    
End Sub
'******************************
'SING|fffd||fffd||fffd|[|fffd|h|fffd||fffd|MAX|fffd|V|fffd|[|fffd|g|fffd||1c9||fffd|
'******************************
Public Sub single_max_sheet_make()
    Worksheets.Add before:=Worksheets(off_last_sheet)
    ActiveSheet.name = "MAX-S"
    max_sheet_header
    
End Sub
'***************************************
'|fffd||151||fffd|l|fffd|V|fffd|[|fffd|g|fffd||303|w|fffd|b|fffd|_|fffd|[(SING|fffd|ACONT|fffd|APROG)
'***************************************
Public Sub max_sheet_header()
    Dim row As Integer
    
    
'USA
    Columns("A:A").ColumnWidth = 17                     '|fffd|Z|fffd||fffd||fffd||315||fffd||fffd||752||fffd|
    Columns("B:Z").ColumnWidth = 14
    
    
    If test_mode_num <> 2 Then
        If graph_on_flg = True Then
            row = 26
        Else
            row = 18
        End If
    Else
        row = 15
    End If

    
    With ActiveSheet
        .Cells(1, 1) = "Date"                               '.Cells(1, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        
        .Cells(3, 1) = "Force Gauge"                        '.Cells(3, 1) = "|fffd||691||fffd|FG"
        .Cells(4, 1) = "Force Unit"                         '.Cells(4, 1) = "|fffd||5cf|d|fffd|P|fffd||fffd|"
    
        .Cells(6, 1) = "+Maximum"                           '.Cells(6, 1) = "|fffd||151||fffd|l"
        .Cells(7, 1) = "+Minimum"                           '.Cells(7, 1) = "|fffd||14f||fffd||fffd|l"
        .Cells(8, 1) = "+Average"                           '.Cells(8, 1) = "|fffd||fffd||fffd||3d2|l"
        .Cells(9, 1) = "+Standard Deviation"                '.Cells(9, 1) = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
        

        .Cells(10, 1) = "-Maximum"                          '.Cells(6, 1) = "|fffd||151||fffd|l"
        .Cells(11, 1) = "-Minimum"                          '.Cells(7, 1) = "|fffd||14f||fffd||fffd|l"
        .Cells(12, 1) = "-Average"                          '.Cells(8, 1) = "|fffd||fffd||fffd||3d2|l"
        .Cells(13, 1) = "-Standard Deviation"               '.Cells(9, 1) = "|fffd|W|fffd||fffd||fffd||38d||fffd|"

        
        If test_mode_num <> 2 Then
            .Cells(15, 1) = "Repeat Count"                  '.Cells(11, 1) = "|fffd|J|fffd||502||fffd||fffd||fffd|"
            .Cells(15, 2) = cont_num
            .Cells(16, 1) = "Sampling Number"               '.Cells(12, 1) = "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd|"
            .Cells(16, 2) = sample_num
        
        End If
        
        .Cells(row, 1) = "Count"                            '.Cells(row, 1) = "|fffd||fffd|"
        .Cells(row, 1).HorizontalAlignment = xlCenter
        .Cells(row, 2) = "Sheet name"                       '.Cells(row, 2) = "|fffd|V|fffd|[|fffd|g|fffd||fffd|"
        .Cells(row, 2).HorizontalAlignment = xlCenter
        
        
        
        
'#If NSCA_V103 Then
        If length_type_num = MM_UNIT Then
            .Cells(row, 3) = "+" & HENI_STR               '.Cells(row, 3) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
        
        Else
            .Cells(row, 3) = "+" & HENI_STR_INCH               '.Cells(row, 3) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
        
        End If
        
'#End If
        
        .Cells(row, 3).HorizontalAlignment = xlCenter
        .Cells(row, 4) = "+Maximum Force"                    '.Cells(row, 4) = "|fffd||151||fffd||5cf|d|fffd|l"
        .Cells(row, 4).HorizontalAlignment = xlCenter
        


        
'#If NSCA_V103 Then
        If length_type_num = MM_UNIT Then
            .Cells(row, 5) = "-" & HENI_STR                     '.Cells(row, 3) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
        
        Else
            .Cells(row, 5) = "-" & HENI_STR_INCH               '.Cells(row, 3) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
        
        End If
        
'#End If
        
        
        
        
        .Cells(row, 5).HorizontalAlignment = xlCenter
        .Cells(row, 6) = "-Maximum Force"                    '.Cells(row, 4) = "|fffd||151||fffd||5cf|d|fffd|l"
        .Cells(row, 7).HorizontalAlignment = xlCenter
        .Range(Cells(row, 1), Cells(row, 6)).Borders.LineStyle = 1

                       
    End With

'else
        
    'Columns("A:A").ColumnWidth = 14    '|fffd|Z|fffd||fffd||fffd||315||fffd||fffd||752||fffd|
    'Columns("B:B").ColumnWidth = 12
    'Columns("C:C").ColumnWidth = 12
    'Columns("D:D").ColumnWidth = 12
    
    'If test_mode_num <> 2 Then
    '    If graph_on_flg = True Then
    '        row = 26
    '    Else
    '        row = 14
    '    End If
    'Else
    '    row = 11
    'End If
    
    
    'With ActiveSheet
    '.Cells(1, 1) = "Date"                           '.Cells(1, 1) = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    
    '.Cells(3, 1) = "Force Gauge"                    '.Cells(3, 1) = "|fffd||691||fffd|FG"
    '.Cells(4, 1) = "Force Unit"                     '.Cells(4, 1) = "|fffd||5cf|d|fffd|P|fffd||fffd|"
    
    '.Cells(6, 1) = "Maximum"                        '.Cells(6, 1) = "|fffd||151||fffd|l"
    '.Cells(7, 1) = "Minimum"                        '.Cells(7, 1) = "|fffd||14f||fffd||fffd|l"
    '.Cells(8, 1) = "Average"                        '.Cells(8, 1) = "|fffd||fffd||fffd||3d2|l"
    '.Cells(9, 1) = "Standard Deviation"             '.Cells(9, 1) = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
    'If test_mode_num <> 2 Then
    '    .Cells(11, 1) = "Repeat Count"              '.Cells(11, 1) = "|fffd|J|fffd||502||fffd||fffd||fffd|"
    '    .Cells(11, 2) = cont_num
    '    .Cells(12, 1) = "Sampling Number"           '.Cells(12, 1) = "|fffd|T|fffd||fffd||fffd|v|fffd||fffd||fffd||fffd||fffd|O|fffd||fffd|"
    '    .Cells(12, 2) = sample_num
    'End If
    
    '.Cells(row, 1) = "Count"                        '.Cells(row, 1) = "|fffd||fffd|"
    '.Cells(row, 1).HorizontalAlignment = xlCenter
    '.Cells(row, 2) = "Sheet name"                   '.Cells(row, 2) = "|fffd|V|fffd|[|fffd|g|fffd||fffd|"
    '.Cells(row, 2).HorizontalAlignment = xlCenter
    '.Cells(row, 3) = "Distance(mm)"                 '.Cells(row, 3) = "|fffd||3c8||281|i|fffd||fffd||fffd||fffd||fffd|j"
    '.Cells(row, 3).HorizontalAlignment = xlCenter
    '.Cells(row, 4) = "Maximum Force"                '.Cells(row, 4) = "|fffd||151||fffd||5cf|d|fffd|l"
    '.Cells(row, 4).HorizontalAlignment = xlCenter
    '.Range(Cells(row, 1), Cells(row, 4)).Borders.LineStyle = 1
    'End With

'endif
    
    
    
  
End Sub
'**********************
'MAX|fffd|V|fffd|[|fffd|g|fffd||24f|o|fffd||fffd|
'**********************
Public Sub sing_max_sheet_toukei_output()
    Dim max_data As Double
    Dim ave_data As Double
    Dim standard_hensa As Double
    Dim data_num As Long
    Dim s_max_henni As Double
    
    '***********|fffd||fffd||fffd||fffd||fffd||fffd|**************
    max_data = 0
    ave_data = 0
    standard_hensa = 0
    '*******************************
    
    With ActiveSheet
    
        .Cells(1, 2) = "'" & Date
        .Cells(3, 2) = "FG*-" & rate_load_kg
        .Cells(4, 2) = main_frm_fgt.unit_name
        
        '|fffd||151||fffd|l|fffd||30e||64fe|
        s_max_value = max_load(0)
        s_max_henni = max_load_cell(0)
        
        data_num = max_s_row - 15
        
        .Cells(max_s_row, 1) = data_num
        .Cells(max_s_row, 1).HorizontalAlignment = xlCenter
        .Cells(max_s_row, 2) = off_last_sheet
        .Cells(max_s_row, 2).Select
        
        If graph_on_flg = True Then
            .Hyperlinks.Add Anchor:=Selection, Address:="", _
                        SubAddress:="'" & off_last_sheet & "'!A1"
        Else
        
            .Hyperlinks.Add Anchor:=Selection, Address:="", _
                        SubAddress:="'" & off_cel(0)
        End If
        
        
        If p_nodata_flg(0) = True Then
            .Cells(max_s_row, 3) = "NO DATA"
            .Cells(max_s_row, 4) = "NO DATA"
            
        Else
            .Cells(max_s_row, 3) = s_max_henni
            .Cells(max_s_row, 4) = s_max_value
        
        End If
        
        
        If m_nodata_flg(0) = True Then
            .Cells(max_s_row, 5) = "NO DATA"
            .Cells(max_s_row, 6) = "NO DATA"
        
        Else
            .Cells(max_s_row, 5) = M_max_load_cell(0)
            .Cells(max_s_row, 6) = M_max_load(0)
        
        End If
        
        .Cells(max_s_row, 2).HorizontalAlignment = xlCenter
        .Cells(max_s_row, 3).HorizontalAlignment = xlCenter
        .Cells(max_s_row, 4).HorizontalAlignment = xlCenter
        .Cells(max_s_row, 5).HorizontalAlignment = xlCenter
        .Cells(max_s_row, 6).HorizontalAlignment = xlCenter
        .Range(Cells(15 + data_num, 1), Cells(15 + data_num, 6)).Borders.LineStyle = 1
        .Range(Cells(15, 1), Cells(15, 6)).Borders(xlEdgeBottom).LineStyle = xlDouble  '|fffd||fffd|d|fffd||fffd|
        
    End With
    
End Sub
'************************************
'SING|fffd||fffd||fffd|[|fffd|h|fffd||fffd|MAX|fffd|V|fffd|[|fffd|g|fffd||fffd||fffd||fffd||fffd||fffd||fffd||748||292|u|fffd||fffd||fffd||fffd|
'************************************
Public Sub cell_Position()
    Dim i_loop As Long
    
    i_loop = 16
    With ActiveSheet
    
        Do
            If .Cells(i_loop, 1) = "" Or .Cells(i_loop, 2) = "" Then
                Exit Do
            End If
            
              i_loop = i_loop + 1
            If i_loop = 35537 Then
              Exit Do
            End If
        Loop
        
        max_s_row = i_loop
    End With
End Sub
'******************************
'MAX|fffd|V|fffd|[|fffd|g|fffd||313||fffd||fffd|v|fffd|v|fffd|Z
'******************************
Public Sub toukei_of_toukei()
    Dim i_loop As Long
    Dim j_loop As Long
    Dim sing_avg As Double
    Dim sing_max As Double
    Dim sing_min As Double
    Dim sing_stdev As Double
    Dim kari_data_cnt As Long
    
    Dim kari_data_cnt_M As Long
    Dim sing_avg_M As Double
    Dim sing_max_M As Double
    Dim sing_min_M As Double
    Dim sing_stdev_M As Double
    
    Dim p_data_cnt As Long
    Dim m_data_cnt As Long
    
    Dim dumy_cel_1 As Variant
    Dim dumy_cel_2 As Variant
                
                
    kari_data_cnt = 0
    kari_data_cnt_M = 0
    
    With ActiveSheet
        
        For i_loop = 0 To 69999             '|fffd||fffd||fffd||fffd||fffd||fffd|
            sing_data(i_loop) = 0
        Next
        
        sing_data_cnt = max_s_row - 15
                        
        For j_loop = 0 To sing_data_cnt - 1
            
            dumy_cel_1 = ActiveSheet.Cells(16 + j_loop, 4)
            dumy_cel_2 = Val(ActiveSheet.Cells(16 + j_loop, 4))
            
            If dumy_cel_1 = dumy_cel_2 And ActiveSheet.Cells(16 + j_loop, 4) <> "NO DATA" Then
                sing_data(j_loop - kari_data_cnt) = Val(ActiveSheet.Cells(16 + j_loop, 4))
            Else
                kari_data_cnt = kari_data_cnt + 1
            End If
                                            
            dumy_cel_1 = ActiveSheet.Cells(16 + j_loop, 6)
            dumy_cel_2 = Val(ActiveSheet.Cells(16 + j_loop, 6))
                        
            If dumy_cel_1 = dumy_cel_2 And ActiveSheet.Cells(16 + j_loop, 6) <> "NO DATA" Then
                sing_data_M(j_loop - kari_data_cnt_M) = Val(ActiveSheet.Cells(16 + j_loop, 6))
            Else
                kari_data_cnt_M = kari_data_cnt_M + 1
            End If
                       
        Next j_loop
        
        
        p_data_cnt = sing_data_cnt - kari_data_cnt
        
        sing_avg = weight_average(sing_data(), p_data_cnt)
        sing_max = Max_weight(sing_data(), p_data_cnt)
        sing_min = Min_weight(sing_data(), p_data_cnt)
        sing_stdev = Weight_varp(sing_data(), p_data_cnt, sing_avg)
                
        .Cells(6, 2) = sing_max
        .Cells(7, 2) = sing_min
        .Cells(8, 2) = calc_round(sing_avg, (input_point_len + 1))
        .Cells(9, 2) = calc_round(sing_stdev, (input_point_len + 1))
                                                            
        m_data_cnt = sing_data_cnt - kari_data_cnt_M
        
        sing_avg_M = weight_average(sing_data_M(), m_data_cnt)
        sing_max_M = Max_weight(sing_data_M(), m_data_cnt)
        sing_min_M = Min_weight(sing_data_M(), m_data_cnt)
        sing_stdev_M = Weight_varp(sing_data_M(), m_data_cnt, sing_avg_M)
               
        .Cells(10, 2) = sing_max_M
        .Cells(11, 2) = sing_min_M
        .Cells(12, 2) = calc_round(sing_avg_M, (input_point_len + 1))
        .Cells(13, 2) = calc_round(sing_stdev_M, (input_point_len + 1))
    
       
                                            
    End With
End Sub

'******************************
'|fffd||fffd||fffd||3d2|l|fffd|v|fffd|Z
'******************************
Public Function weight_average(cal_data() As Double, cal_data_cnt As Long) As Double                            '|fffd||fffd||fffd||3cc|v|fffd|Z
    Dim job_cnt As Long
    weight_average = cal_data(0)
    For job_cnt = 1 To cal_data_cnt - 1 Step 1
        weight_average = weight_average + cal_data(job_cnt)
    Next job_cnt
    If cal_data_cnt = 0 Then
        weight_average = 0
    Else
        weight_average = weight_average / cal_data_cnt              '|fffd||fffd||fffd||311||fffd||fffd||fffd||153||fffd||fffd||fffd||a0bd||fffd||5cf|d|fffd|l|fffd|f|fffd|[|fffd|^|fffd||315||fffd||fffd||fffd|
    End If
    
End Function

'******************************
'|fffd||151||fffd|l|fffd|v|fffd|Z
'******************************
Public Function Max_weight(cal_data() As Double, cal_data_cnt As Long) As Double
    Max_weight = cal_data(0)                           '|fffd||5cf|d|fffd||151||fffd|l
    Dim job_cnt As Long
    
    For job_cnt = 0 To cal_data_cnt - 1 Step 1
        If cal_data(job_cnt) >= Max_weight Then
            Max_weight = cal_data(job_cnt)
            max_move_gf = move_data(job_cnt)
            re_max_move_gf = re_position(job_cnt)
            max_data_cnt = (job_cnt + 1) + (sub_data_cnt - cal_data_cnt)
        End If
    Next job_cnt
    

    If Max_weight > max_limit Then
        limit_jdg = 0                               '|fffd||5cf|d|fffd||348||354||fffd||fffd||fffd|
    End If

    If Max_weight < min_limit Then
        limit_jdg = 3
    End If
    
    If max_limit = 0 And min_limit = 0 Then
        limit_jdg = 2
    End If

End Function

'******************************
'|fffd||14f||fffd||fffd|l|fffd|v|fffd|Z
'******************************
Public Function Min_weight(cal_data() As Double, cal_data_cnt As Long) As Double                                '|fffd||5cf|d|fffd||14f||fffd||fffd|l
    Dim job_cnt As Long
    Min_weight = cal_data(0)
    For job_cnt = 0 To cal_data_cnt - 1 Step 1
        If cal_data(job_cnt) <= Min_weight Then
            Min_weight = cal_data(job_cnt)
            min_move_gf = move_data(job_cnt)
            re_min_move_gf = re_position(job_cnt)
            min_data_cnt = (job_cnt + 1) + (sub_data_cnt - cal_data_cnt)
        End If
    Next job_cnt
'    If Min_weight < min_limit Then
'        limit_jdg = 0                                   '|fffd||5cf|d|fffd||348||354||fffd||fffd||fffd|
'    End If
    If max_limit = 0 And min_limit = 0 Then
        limit_jdg = 2
    End If
End Function

'******************************
'|fffd|W|fffd||fffd||fffd||38d||fffd||fffd|l|fffd|v|fffd|Z
'******************************
Public Function Weight_varp(cal_data() As Double, cal_data_cnt As Long, cal_avg As Double) As Double                '|fffd||5cf|d|fffd||315||fffd||fffd|U
    Dim job_cnt As Long
    Weight_varp = 0
    If cal_data_cnt = 0 Then
        Weight_varp = 0
    Else
        Weight_varp = (cal_data(0) - cal_avg) ^ 2
        
        For job_cnt = 1 To cal_data_cnt - 1 Step 1
                Weight_varp = Weight_varp + (cal_data(job_cnt) - cal_avg) ^ 2
        Next job_cnt
        Weight_varp = Sqr(Weight_varp / cal_data_cnt)                 '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||7c1|A|fffd|W|fffd||fffd||fffd||38d||fffd||fffd||155|\|fffd||fffd|
    End If
End Function

Public Function calc_round(input_val As Double, dot As Byte) As Double
                                                        '|fffd|l|fffd||30c||713||fffd||fffd||590||fffd||fffd|@val|fffd|F|fffd|l|fffd|Adot|fffd|F|fffd|l|fffd||30c||713||fffd||fffd||fffd||fffd||9305||fffd|i10|fffd||fffd||fffd||702||141|j
    Dim minus_flg As Byte
    Dim input_val_dash As Double
    If dot > 10 Then
        dot = 10
    End If
    input_val_dash = input_val
    If input_val < 0 Then
        minus_flg = 1
        input_val_dash = input_val * -1
    End If
    
    calc_round = input_val_dash * (10 ^ dot)
    calc_round = Int(calc_round + 0.5)
    calc_round = calc_round / (10 ^ dot)
    
    If minus_flg = 1 Then
        calc_round = calc_round * -1
    End If

End Function

Attribute VB_Name = "timer_mdl_e"
Option Explicit

'**********************
'   |fffd|`|fffd|o|fffd|h|fffd||590||fffd||fffd||312||fffd|`
'**********************

'**********************************
'   |fffd|^|fffd|C|fffd|}|fffd|[|fffd||fffd||fffd||c42c||fffd||fffd||fffd||fffd|`|fffd|o|fffd|h|fffd||590||fffd|
'**********************************
Private Declare Function SetTimer Lib "user32" _
                (ByVal hWnd As Long, _
                 ByVal nIDEvent As Long, _
                 ByVal uElapse As Long, _
                 ByVal lpTimerFunc As Long) As Long

'**********************************
'   |fffd|^|fffd|C|fffd|}|fffd|[|fffd||fffd|j|fffd||fffd||fffd||fffd||fffd||fffd|`|fffd|o|fffd|h|fffd||590||fffd|
'**********************************
Private Declare Function KillTimer Lib "user32" _
                (ByVal hWnd As Long, _
                 ByVal nIDEvent As Long) As Long

'******************************************
'   |fffd|^|fffd|C|fffd|}|fffd|[|fffd||fffd||fffd|W|fffd||fffd||fffd|[|fffd||fffd||fffd||303|v|fffd||fffd||fffd|p|fffd|e|fffd|B(|fffd||3d0||fffd|)
'******************************************
Private m_hWnd     As Long              ' |fffd||598|A|fffd|t|fffd||fffd||fffd||fffd||fffd||fffd|E|fffd|B|fffd||fffd||fffd|h|fffd|E|fffd|n|fffd||fffd||fffd|h|fffd||fffd|
Private m_Id       As Long              ' |fffd|^|fffd|C|fffd|}|fffd|[ID
Private m_Interval As Long              ' |fffd|^|fffd|C|fffd||fffd||fffd|A|fffd|E|fffd|g|fffd|l(1000|fffd||fffd||fffd||302|P|fffd|b|fffd|P|fffd||fffd|)
Public m_Timer_disable_flg As Boolean

Public Property Let hWnd(N As Long)
    m_hWnd = N
End Property

Public Property Let TimerId(N As Long)
    m_Id = N
End Property

Public Property Let TimerInterval(N As Long)
Dim NewId As Long
Dim rc    As Long

    If N <> 0 Then
        NewId = SetTimer(m_hWnd, m_Id, N, AddressOf TimerProc)
        If m_hWnd = 0 Then m_hWnd = NewId
    Else
        rc = KillTimer(m_hWnd, m_Id)
    End If
End Property

'*******************************
'   TimerProc|fffd|R|fffd|[|fffd||fffd||fffd|o|fffd|b|fffd|N|fffd||590||fffd|
'*******************************
Private Sub TimerProc(ByVal hWnd As Long, _
                   ByVal uMsg As Long, _
                   ByVal idEvent As Long, _
                   ByVal dwTime As Long)
    Dim rc    As Long
    
    On Error GoTo EX
    If SER_flg = True Or test_flg = False Then
        rc = KillTimer(m_hWnd, m_Id)
        On Error Resume Next
        main_frm_fgt.Show
        Exit Sub
    End If
    Call comm_mdl_e.OnTimer    ' |fffd|^|fffd|C|fffd|}|fffd|[|fffd||fffd||fffd||fffd||fffd||fffd||fffd|L|fffd|q|fffd||fffd||fffd||fffd|v|fffd||fffd||fffd|V|fffd|[|fffd|W|fffd||fffd||fffd||fffd||fffd|R|fffd|[|fffd||fffd||fffd||fffd||fffd||fffd|
    Exit Sub
    
EX:
    MsgBox MES6, vbExclamation, OBI_STR '"|fffd||fffd||80aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|B"
End Sub

 
   

' InQuest injected base64 decoded content
' y:-jT

INQUEST-PP=macro
