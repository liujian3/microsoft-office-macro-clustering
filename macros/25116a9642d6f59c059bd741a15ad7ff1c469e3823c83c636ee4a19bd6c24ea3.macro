Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Const PARAMDATA = 1
Const WORKSHEETFANAME = 2
Const WORKSHEETFAGRP = 3
Const WORKSHEETFABAL = 5
Const STARTROW = 12

'Criteria labels
Const COMPANY = "A4"
Const ASSETGRP = "A4"
Const CC = "A5"
Const STATUS = "A6"
Const CU = "A6"         'FC 40.650.140: Enhancement on Asset balance list
Const REFDATE = "A7"    ''tanj42445 - 20070215 - BR 21.779.402
Const PERSON = "A8"     'FC 40.650.140: Enhancement on Asset balance list
Const ASSETCODE = "E4"
Const ITEMCODE = "E5"
Const WAREHOUSE = "E6"
Const ASSETBS = "E7"    'FC 40.650.140: Enhancement on Asset balance list

'Criteria values
Const VALASSETGRP = "B4"
Const VALCC = "B5"
Const VALSTATUS = "B6"
Const VALCU = "B6"      'FC 40.650.140: Enhancement on Asset balance list
Const VALREFDATE = "B7" ''tanj42445 - 20070215 - BR 21.779.402
Const VALPERSON = "B8"  'FC 40.650.140: Enhancement on Asset balance list
Const VALASSETCODE = "F4"
Const VALITEMCODE = "F5"
Const VALWAREHOUSE = "F6"
Const VALASSETBS = "F7" 'FC 40.650.140: Enhancement on Asset balance list

'Term label
Const SUBTOTAL = "B18"
Const TOTAL = "B19"
Const GRANDTOTAL = "B20"
''FC20.702.613[chee112204] - [ISSUE]    : Asset status with different depreciation types
''                         - [SOLUTION] : Since Add 1 more Column for WriteOff, adjust the column
'     LASTCOLUMN_BL = "K" => "L"
'     LASTCOLUMN_GP = "H" => "I"
'FC 40.650.140: Enhancement on Asset balance list
'Const LASTCOLUMN_BL = "L"
'Const LASTCOLUMN_GP = "I"
Const LASTCOLUMN_BL = "Z"       'this last column is possible to expand, to include analytical value: project, CC, CU, warehouse and warehouse location
Const LASTCOLUMN_GP = "K"
Dim LASTCOLUMN_BL_VAR As String 'use LASTCOLUMN_BL_VAR to replace LASTCOLUMN_BL to cater for analytical value, some functions may not need to change as it was already obsololete

'Color
Const COLOR_CHARTAREA = 38   'Also data
Const COLOR_COMP_COL = 39    'Also company name and column headers
Const COLOR_TITLE = 40  'Also Report title

Dim App                             As esl.Application
Dim goCompany                       As esl.COMPANY

'Header column labels - For Grouping sheet
Dim HLABELASSETGRP                  As String
Dim HLABELLEDGER                    As String
Dim HLABELPURCHVAL                  As String
Dim HLABELOPENBALANCE               As String
Dim HLABELINVESTMENTYEARLY          As String
Dim HLABELCUMDEPRYEARLY             As String
Dim HLABELBOOKVALUEYEARLY           As String
Dim HLABELCUMDEPR                   As String
''FC20.702.613[chee112204] - Add Write Off (HLABELWRITEOFF) for Grp
Dim HLABELWRITEOFF                  As String
Dim HLABELDISPOSAL                  As String
Dim HLABELBOOKVALUE                 As String
Dim HLABELRESOURCE                  As String

'FC 40.650.140: Enhancement on Asset balance list
Dim HLABELPREVYEARREVALUATION       As String
Dim HLABELCURRYEARREVALUATION       As String
Dim HLABELCURRMONTHDEPR             As String

'Header column labels - For balance list sheet
Dim HLABELASSETCODE_BL              As String
Dim HLABELDESC_BL                   As String
Dim HLABELSTARTDATE_BL              As String
Dim HLABELENDDATE_BL                As String
Dim HLABELPURCHVAL_BL               As String
Dim HLABELOPENBALANCE_BL            As String
Dim HLABELINVESTMENTYEARLY_BL       As String
Dim HLABELCUMDEPRYEARLY_BL          As String
Dim HLABELBOOKVALUEYEARLY_BL        As String
Dim HLABELCUMDEPR_BL                As String
''FC20.702.613[chee112204] - Add Write Off (HLABELWRITEOFF_BL) for Balance List
Dim HLABELWRITEOFF_BL               As String
Dim HLABELDISPOSAL_BL               As String
Dim HLABELBOOKVALUE_BL              As String
Dim HLABELRESOURCE_BL               As String

'FC 40.650.140: Enhancement on Asset balance list
Dim HLABELASSETGRP_BL               As String
Dim HLABELITEMCODE_BL               As String
Dim HLABELASSETBS_BL                As String
Dim HLABELDEPRBS_BL                 As String
Dim HLABELPURCHASEDATE_BL           As String
Dim HLABELACQUISITIONDATE_BL        As String
Dim HLABELSTATUS_BL                 As String
Dim HLABELINVESTMENTSTARTYEAR_BL     As String
Dim HLABELINVESTMENTEND_BL          As String
Dim HLABELRESIDUALVALUE_BL          As String
Dim HLABELPREVYEARREVALUATION_BL    As String
Dim HLABELCURRYEARREVALUATION_BL    As String
Dim HLABELCURRMONTHDEPR_BL          As String
Dim HLABELWRITEOFFINVESTMENT_BL     As String
Dim HLABELDISPOSALINVESTMENT_BL     As String
Dim HLABELPROJECT_BL                As String
Dim HLABELCOSTCENTER_BL             As String
Dim HLABELCOSTUNIT_BL               As String
Dim HLABELWAREHOUSE_BL              As String
Dim HLABELWAREHOUSELOCATION_BL      As String

'To clear Residual value grand total
Dim RVGTCELLPREFIX                  As String

Dim AssetGroup_From                 As String
Dim AssetGroup_To                   As String
Dim AssetCode_From                  As String
Dim AssetCode_To                    As String
Dim ItemCode_From                   As String
Dim ItemCode_To                     As String
Dim sWarehouse                      As String
Dim CostCenter_From                 As String
Dim CostCenter_To                   As String
Dim sFY                             As String
Dim sFP                             As String

Dim AssetGroup_All                  As Integer
Dim Assetcode_All                   As Integer
Dim Itemcode_All                    As Integer
Dim Warehouse_All                   As Integer
Dim CostCenter_All                  As Integer
Dim stActive                        As Integer
Dim stDepreciated                   As Integer
Dim stSold                          As Integer
Dim stBlocked                       As Integer
Dim stInactive                      As Integer
''FC20.144.656[chee112204] - Add 2 more status (Transfer & WriteOff)
Dim stTransfer                      As Integer
Dim stWriteOff                      As Integer
''END - FC20.144.656
Dim GrpLastRow                      As Long
Dim BalLastRow                      As Long

''tanj42445 - 20050809 - FC 16.061.117
Dim RefDate_All As Integer
Dim dtRefDate As Date

'FC 40.650.140: Enhancement on Asset balance list
Dim CostUnit_From                 As String
Dim CostUnit_To                   As String
Dim CostUnit_All                  As Integer
Dim AssetBS_From                  As String
Dim AssetBS_To                    As String
Dim AssetBS_All                   As Integer
Dim sPerson                       As String
Dim Person_All                    As Integer

Dim dicBalAnalytical              As Dictionary
Enum BalAAIndex
    idxCellValue = 0
    idxCellLabel
    idxCellWidth
    idxCellTerm
End Enum

'BR 41.654.489/41.657.975
'#1. Select reference date lower than assets sold or written off date: Columns |fffd|Written-off investment|fffd|/|fffd|Sold investment|fffd| should NOT fill with the investment value
'#2. Select reference date higher than assets sold or written off date: Column |fffd|Investment: Start yyyy|fffd| should NOT filled with investment value
'#3. Only investments which have been entered before 02.01.yyyy (dd.mm.yyyy) should be displayed in column 'Investment: Start yyyy'
'#4. Change column headers: |fffd|Disposal|fffd| and |fffd|Disposal investment|fffd| to |fffd|Sold|fffd| and |fffd|Sold investment|fffd|

Public Sub OnRefreshInitialize(ByRef poCompany As Object)
    'Create instance
    Set App = New esl.Application
    
    ThisWorkbook.Worksheets(WORKSHEETFANAME).Name = App.Term.String(8369, "Balance list")
    ThisWorkbook.Worksheets(WORKSHEETFAGRP).Name = App.Term.String(5514, "Asset group")
    ThisWorkbook.Worksheets(4).Name = App.Term.String(9772, "Details")
    Set goCompany = New esl.COMPANY
    Debug.Assert Not poCompany Is Nothing
    Set goCompany = poCompany
End Sub

Public Sub OnRefreshBeforeReports()
    Dim lLastRow As Long
    Dim vnt As Variant
    
    'BR 29.236.652
    PrinterSettings
    
    GetSlicData
    'FC 40.650.140: Enhancement on Asset balance list. Add call to InitCol2 and ShowAnalyticalValue
    'InitCol
    InitCol2
    Call ShowAnalyticalValue(sWorksheet:=4, lHeaderRow:=11)
    Worksheets(WORKSHEETFANAME).Activate
    Call FillColor(WORKSHEETFANAME)
    Worksheets(WORKSHEETFAGRP).Activate
    Call FillColor(WORKSHEETFAGRP)
    Worksheets(4).Activate
    Call FillColor(WORKSHEETFABAL)
    
    With ThisWorkbook
        .Colors(1) = RGB(227, 238, 240)
        .Colors(52) = RGB(200, 220, 225)
        .Colors(53) = RGB(173, 190, 201)
        
        'Asset group
        'BR 16.045.792 - Replace the ASCII Chr(255) to "" and Checking FROM and TO Column
        If .Names("AssetGroup.From").RefersToRange.Value = "" And IIf(InStr(.Names("AssetGroup.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("AssetGroup.To").RefersToRange.Value) = "" Then
            Worksheets(WORKSHEETFAGRP).Range(VALASSETGRP).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALASSETGRP).Value = App.Term.String(5614, "All")
        Else
            'BR 31.915.980: Format it to string
            Worksheets(4).Range(VALASSETGRP).NumberFormat = "@"
            
            ''tanj42445 - 20060303 - BR 18.445.055
            ''Issue: 'From' & 'To' keyword are not term
            If AssetGroup_From <> "" And AssetGroup_To <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALASSETGRP).Value = AssetGroup_From & " - " & AssetGroup_To
                Worksheets(4).Range(VALASSETGRP).Value = AssetGroup_From & " - " & AssetGroup_To
            ElseIf AssetGroup_From <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALASSETGRP).Value = App.Term.String(5007, "From") & " " & AssetGroup_From
                Worksheets(4).Range(VALASSETGRP).Value = App.Term.String(5007, "From") & " " & AssetGroup_From
            Else
               Worksheets(WORKSHEETFAGRP).Range(VALASSETGRP).Value = App.Term.String(8165, "To") & " " & AssetGroup_To
               Worksheets(4).Range(VALASSETGRP).Value = App.Term.String(8165, "To") & " " & AssetGroup_To
            End If
        End If
        
        'Asset code
        'BR 16.045.792 - Replace the ASCII Chr(255) to "" and Checking FROM and TO Column
        If .Names("AssetCode.From").RefersToRange.Value = "" And IIf(InStr(.Names("AssetCode.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("AssetCode.To").RefersToRange.Value) = "" Then
            Worksheets(WORKSHEETFAGRP).Range(VALASSETCODE).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALASSETCODE).Value = App.Term.String(5614, "All")
        Else
            'BR 31.915.980: Format it to string
            Worksheets(4).Range(VALASSETCODE).NumberFormat = "@"
            
            ''tanj42445 - 20060303 - BR 18.445.055
            ''Issue: 'From' & 'To' keyword are not term
            If AssetCode_From <> "" And AssetCode_To <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALASSETCODE).Value = AssetCode_From & " - " & AssetCode_To
                Worksheets(4).Range(VALASSETCODE).Value = AssetCode_From & " - " & AssetCode_To
            ElseIf AssetCode_From <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALASSETCODE).Value = App.Term.String(5007, "From") & " " & AssetCode_From
                Worksheets(4).Range(VALASSETCODE).Value = App.Term.String(5007, "From") & " " & AssetCode_From
            Else
                Worksheets(WORKSHEETFAGRP).Range(VALASSETCODE).Value = App.Term.String(8165, "To") & " " & AssetCode_To
                Worksheets(4).Range(VALASSETCODE).Value = App.Term.String(8165, "To") & " " & AssetCode_To
            End If
        End If
        
        'ItemCode
        'BR 16.045.792 - Replace the ASCII Chr(255) to ""
        If .Names("ItemCode.From").RefersToRange.Value = "" And IIf(InStr(.Names("ItemCode.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("ItemCode.To").RefersToRange.Value) = "" Then
            Worksheets(WORKSHEETFAGRP).Range(VALITEMCODE).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALITEMCODE).Value = App.Term.String(5614, "All")
        Else
            'BR 31.915.980: Format it to string
            Worksheets(4).Range(VALITEMCODE).NumberFormat = "@"
        
            ''tanj42445 - 20060303 - BR 18.445.055
            ''Issue: 'From' & 'To' keyword are not term
            If ItemCode_From <> "" And ItemCode_To <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALITEMCODE).Value = ItemCode_From & " - " & ItemCode_To
                Worksheets(4).Range(VALITEMCODE).Value = ItemCode_From & " - " & ItemCode_To
            ElseIf ItemCode_From <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALITEMCODE).Value = App.Term.String(5007, "From") & " " & ItemCode_From
                Worksheets(4).Range(VALITEMCODE).Value = App.Term.String(5007, "From") & " " & ItemCode_From
            Else
                Worksheets(WORKSHEETFAGRP).Range(VALITEMCODE).Value = App.Term.String(8165, "To") & " " & ItemCode_To
                Worksheets(4).Range(VALITEMCODE).Value = App.Term.String(8165, "To") & " " & ItemCode_To
            End If
        End If
        
        'CostCenter
        'BR 16.045.792 - Replace the ASCII Chr(255) to ""
        If .Names("CostCenter.From").RefersToRange.Value = "" And IIf(InStr(.Names("CostCenter.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("CostCenter.To").RefersToRange.Value) = "" Then
            Worksheets(WORKSHEETFAGRP).Range(VALCC).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALCC).Value = App.Term.String(5614, "All")
        Else
            'BR13.935.935:Format it to string
            Worksheets(4).Range(VALCC).NumberFormat = "@"
            
            ''tanj42445 - 20060303 - BR 18.445.055
            ''Issue: 'From' & 'To' keyword are not term
            If CostCenter_From <> "" And CostCenter_To <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALCC).Value = CostCenter_From & " - " & CostCenter_To
                Worksheets(4).Range(VALCC).Value = CostCenter_From & " - " & CostCenter_To
            ElseIf CostCenter_From <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALCC).Value = App.Term.String(5007, "From") & " " & CostCenter_From
                Worksheets(4).Range(VALCC).Value = App.Term.String(5007, "From") & " " & CostCenter_From
            Else
                Worksheets(WORKSHEETFAGRP).Range(VALCC).Value = App.Term.String(8165, "To") & " " & CostCenter_To
                Worksheets(4).Range(VALCC).Value = App.Term.String(8165, "To") & " " & CostCenter_To
            End If
        End If

        
        'Warehouse
        If .Names("mutWarehouseAll").RefersToRange.Value = 0 Then
            'FC 40.650.140: Enhancement on Asset balance list, format string
            Worksheets(WORKSHEETFAGRP).Range(VALWAREHOUSE).NumberFormat = "@"
            Worksheets(4).Range(VALWAREHOUSE).NumberFormat = "@"
            Worksheets(WORKSHEETFAGRP).Range(VALWAREHOUSE).Value = sWarehouse
            Worksheets(4).Range(VALWAREHOUSE).Value = sWarehouse
        Else
            Worksheets(WORKSHEETFAGRP).Range(VALWAREHOUSE).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALWAREHOUSE).Value = App.Term.String(5614, "All")
        End If
        
        ''tanj42445 - 20070215 - BR 21.779.402
        ''Reference Date
        If Not RefDate_All Then
            'FC 40.650.140: Enhancement on Asset balance list, format date
            Worksheets(WORKSHEETFAGRP).Range(VALREFDATE).NumberFormat = "m/d/yyyy"
            Worksheets(4).Range(VALREFDATE).NumberFormat = "m/d/yyyy"
            Worksheets(WORKSHEETFAGRP).Range(VALREFDATE).Value = dtRefDate
            Worksheets(4).Range(VALREFDATE).Value = dtRefDate
        Else
            Worksheets(WORKSHEETFAGRP).Range(VALREFDATE).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALREFDATE).Value = App.Term.String(5614, "All")
        End If
        ''End BR 21.779.402
        
        'FC 40.650.140: Enhancement on Asset balance list
        'Cost Unit
        If .Names("CostUnit.From").RefersToRange.Value = "" And IIf(InStr(.Names("CostUnit.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("CostUnit.To").RefersToRange.Value) = "" Then
            Worksheets(WORKSHEETFAGRP).Range(VALCU).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALCU).Value = App.Term.String(5614, "All")
        Else
            Worksheets(4).Range(VALCU).NumberFormat = "@"

            If CostUnit_From <> "" And CostUnit_To <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALCU).Value = CostUnit_From & " - " & CostUnit_To
                Worksheets(4).Range(VALCU).Value = CostUnit_From & " - " & CostUnit_To
            ElseIf CostUnit_From <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALCU).Value = App.Term.String(5007, "From") & " " & CostUnit_From
                Worksheets(4).Range(VALCU).Value = App.Term.String(5007, "From") & " " & CostUnit_From
            Else
                Worksheets(WORKSHEETFAGRP).Range(VALCU).Value = App.Term.String(8165, "To") & " " & CostUnit_To
                Worksheets(4).Range(VALCU).Value = App.Term.String(8165, "To") & " " & CostUnit_To
            End If
        End If
        
        'Asset balance sheet GL
        If AssetBS_From = "" And AssetBS_To = "" Then
            Worksheets(WORKSHEETFAGRP).Range(VALASSETBS).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALASSETBS).Value = App.Term.String(5614, "All")
        Else
            Worksheets(4).Range(VALASSETBS).NumberFormat = "@"

            If AssetBS_From <> "" And AssetBS_To <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALASSETBS).Value = AssetBS_From & " - " & AssetBS_To
                Worksheets(4).Range(VALASSETBS).Value = AssetBS_From & " - " & AssetBS_To
            ElseIf AssetBS_From <> "" Then
                Worksheets(WORKSHEETFAGRP).Range(VALASSETBS).Value = App.Term.String(5007, "From") & " " & AssetBS_From
                Worksheets(4).Range(VALASSETBS).Value = App.Term.String(5007, "From") & " " & AssetBS_From
            Else
                Worksheets(WORKSHEETFAGRP).Range(VALASSETBS).Value = App.Term.String(8165, "To") & " " & AssetBS_To
                Worksheets(4).Range(VALASSETBS).Value = App.Term.String(8165, "To") & " " & AssetBS_To
            End If
        End If
        
        'Person
        If Not Person_All Then
            Worksheets(WORKSHEETFAGRP).Range(VALPERSON).NumberFormat = "@"
            Worksheets(4).Range(VALPERSON).NumberFormat = "@"
            Worksheets(WORKSHEETFAGRP).Range(VALPERSON).Value = Trim(sPerson)
            Worksheets(4).Range(VALPERSON).Value = Trim(sPerson)
        Else
            Worksheets(WORKSHEETFAGRP).Range(VALPERSON).Value = App.Term.String(5614, "All")
            Worksheets(4).Range(VALPERSON).Value = App.Term.String(5614, "All")
        End If
        
    End With
    
    'Define criteria columns
    With Worksheets(WORKSHEETFAGRP)
        .Range("A2").Value = App.Term.String(201, "Group by") & ": " & App.Term.String(5514, "Asset group")
        .Range(ASSETGRP).Value = App.Term.String(2560, "Group")
        .Range(ASSETCODE).Value = App.Term.String(6057, "Serial number")
        .Range(ITEMCODE).Value = App.Term.String(1102, "Item code")
        .Range(WAREHOUSE).Value = App.Term.String(1391, "Warehouse")
        .Range(CC).Value = App.Term.String(8494, "Cost center")
        ''tanj42445 - 20070215 - BR 21.779.402
        .Range(REFDATE).Value = App.Term.String(1274, "Reference date")
        'FC 40.650.140: Enhancement on Asset balance list
        .Range(CU).Value = App.Term.String(1194, "Cost unit")
        .Range(PERSON).Value = App.Term.String(12, "Person")
        .Range(ASSETBS).Value = App.Term.String(24467, "Assets") & " (" & App.Term.String(4448, "B/S") & ")"    'App.Term.String(31770, "B/S assets acct.")
    End With
    
    With Worksheets(4)
        .Range("A2").Value = App.Term.String(8369, "Balance list")
        .Range(ASSETGRP).Value = App.Term.String(2560, "Group")
        .Range(ASSETCODE).Value = App.Term.String(6057, "Serial number")
        .Range(ITEMCODE).Value = App.Term.String(1102, "Item code")
        .Range(WAREHOUSE).Value = App.Term.String(1391, "Warehouse")
        .Range(CC).Value = App.Term.String(8494, "Cost center")
        ''tanj42445 - 20070215 - BR 21.779.402
        .Range(REFDATE).Value = App.Term.String(1274, "Reference date")
        'FC 40.650.140: Enhancement on Asset balance list
        .Range(CU).Value = App.Term.String(1194, "Cost unit")
        .Range(PERSON).Value = App.Term.String(12, "Person")
        .Range(ASSETBS).Value = App.Term.String(24467, "Assets") & " (" & App.Term.String(4448, "B/S") & ")"    'App.Term.String(31770, "B/S assets acct.")
    End With
    
    'copy criteria data to grouping sheet
    'tham14341[10.098.040]: DON'T USE COPY FUNCTION. Different Office version behave differently.
    'it works in Office XP but not in Office 2K
    'Call CopyDataToDisp
    
    'Generating SQL query dynamically
    Call GenerateSQLQuery(WORKSHEETFANAME)
    Call GenerateSQLQuery(WORKSHEETFAGRP)
    
    'Define balance list header
    With Worksheets(4)
        'FC 40.650.140: Enhancement on Asset balance list
        '.Range(HLABELASSETCODE_BL).Value = App.Term.String(6057, "Serial number")
        '.Range(HLABELDESC_BL).Value = App.Term.String(4243, "Description")
        '.Range(HLABELSTARTDATE_BL).Value = App.Term.String(3392, "Start date")
        '.Range(HLABELENDDATE_BL).Value = App.Term.String(22526, "End date")
        ''BR 13.935.595 - Change name
        ''.Range(HLABELPURCHVAL_BL).Value = App.Term.String(12884, "Purchase amount")
        '.Range(HLABELPURCHVAL_BL).Value = App.Term.String(8688, "Investment")
        ''.Range(HLABELOPENBALANCE_BL).Value = App.Term.String(5635, "Book value") & " (" & App.Term.String(1313, "Opening balance") & " " & sFY & ")"
        ''.Range(HLABELINVESTMENTYEARLY_BL).Value = App.Term.String(8688, "Investment") & " " & sFY
        '.Range(HLABELINVESTMENTYEARLY_BL).Value = App.Term.String(4240, "Revaluation")
        '.Range(HLABELCUMDEPRYEARLY_BL).Value = App.Term.String(8540, "Depreciation") & " " & sFY
        '.Range(HLABELCUMDEPR_BL).Value = App.Term.String(8540, "Depreciation")
        '''FC20.702.613[chee112204] - Add Write Off Label (Balance List)
        '''BR23.238.330[chee112204] - [ISSUE]    : Wrong term is used in new asset transcaction type
        '''                           [SOLUTION] : Change the Status "WriteOff (8948)" TO "WrittenOff(35098)"
        '.Range(HLABELWRITEOFF_BL).Value = App.Term.String(35098, "WrittenOff")
        '''END - FC20.702.613
        '.Range(HLABELDISPOSAL_BL).Value = App.Term.String(31490, "Disposal")
        '.Range(HLABELBOOKVALUE_BL).Value = App.Term.String(5635, "Book value")
        '.Range(HLABELRESOURCE_BL).Value = App.Term.String(12, "Resource")
        
        .Range(HLABELASSETGRP_BL).Value = App.Term.String(2560, "Group")
        .Range(HLABELASSETCODE_BL).Value = App.Term.String(6057, "Serial number")
        .Range(HLABELDESC_BL).Value = App.Term.String(4243, "Description")
        .Range(HLABELITEMCODE_BL).Value = App.Term.String(1102, "Item code")
        .Range(HLABELASSETBS_BL).Value = App.Term.String(24467, "Assets") & " (" & App.Term.String(4448, "B/S") & ")"
        .Range(HLABELDEPRBS_BL).Value = App.Term.String(8540, "Depreciation") & " (" & App.Term.String(4448, "B/S") & ")"
        .Range(HLABELSTARTDATE_BL).Value = App.Term.String(3392, "Start date")
        .Range(HLABELENDDATE_BL).Value = App.Term.String(22526, "End date")
        .Range(HLABELPURCHASEDATE_BL).Value = App.Term.String(2355, "Entry date")
        .Range(HLABELACQUISITIONDATE_BL).Value = App.Term.String(39217, "Investment date ")
        .Range(HLABELSTATUS_BL).Value = App.Term.String(4332, "Status")
        .Range(HLABELPURCHVAL_BL).Value = App.Term.String(8688, "Investment")
        'BR 41.204.906: #3. "Investment YYYY" to "Investment: Start YYYY"  >> use "Start"(TERMS26237)
        .Range(HLABELINVESTMENTSTARTYEAR_BL).Value = App.Term.String(8688, "Investment") & ": " & App.Term.String(26237, "Start") & " " & sFY
        .Range(HLABELINVESTMENTEND_BL).Value = App.Term.String(39211, "Investment end value")
        .Range(HLABELRESIDUALVALUE_BL).Value = App.Term.String(2275, "Residual value")
        .Range(HLABELPREVYEARREVALUATION_BL).Value = App.Term.String(4240, "Revaluation") & " < " & sFY
        'BR 41.204.906: #1. "Revaluation >=YYYY" to "Revaluation YYYY"
        .Range(HLABELCURRYEARREVALUATION_BL).Value = App.Term.String(4240, "Revaluation") & " " & sFY
        .Range(HLABELCUMDEPRYEARLY_BL).Value = App.Term.String(8540, "Depreciation") & " " & sFY
        'BR 41.204.906: #2. "Depreciation MM" to "Depreciation MM/YYYY"
        .Range(HLABELCURRMONTHDEPR_BL).Value = App.Term.String(8540, "Depreciation") & " " & Format$(sFP, "00") & "/" & sFY
        .Range(HLABELCUMDEPR_BL).Value = App.Term.String(8540, "Depreciation")
        .Range(HLABELBOOKVALUE_BL).Value = App.Term.String(5635, "Book value")
        .Range(HLABELWRITEOFF_BL).Value = App.Term.String(35098, "Written Off")
        .Range(HLABELWRITEOFFINVESTMENT_BL).Value = App.Term.String(35098, "Written Off") & " " & LCase$(App.Term.String(8688, "Investment"))
        'BR 41.654.489/41.657.975: Refer remark at top
        .Range(HLABELDISPOSAL_BL).Value = App.Term.String(6437, "Sold")
        .Range(HLABELDISPOSALINVESTMENT_BL).Value = App.Term.String(6437, "Sold") & " " & LCase$(App.Term.String(8688, "Investment"))
        .Range(HLABELRESOURCE_BL).Value = App.Term.String(12, "Resource")
        'Show analytical according to license/setting
        '.Range(HLABELPROJECT_BL).Value = App.Term.String(8657, "Project")
        '.Range(HLABELCOSTCENTER_BL).Value = App.Term.String(8494, "Cost center")
        '.Range(HLABELCOSTUNIT_BL).Value = App.Term.String(1194, "Cost unit")
        '.Range(HLABELWAREHOUSE_BL).Value = App.Term.String(1391, "Warehouse")
        '.Range(HLABELWAREHOUSELOCATION_BL).Value = App.Term.String(2585, "Warehouse location")
        For Each vnt In dicBalAnalytical.Items
            .Range(vnt(idxCellLabel)).Value = vnt(idxCellTerm)
        Next
    End With
    'Call CopyBalanceHeader
    
    'Define grouping header
    With Worksheets(WORKSHEETFAGRP)
        'FC 40.650.140: Enhancement on Asset balance list
        '.Range(HLABELASSETGRP).Value = App.Term.String(2560, "Group")
        '.Range(HLABELLEDGER).Value = App.Term.String(31263, "GL account")
        ''BR 13.935.595 - Change name
        ''.Range(HLABELPURCHVAL).Value = App.Term.String(12884, "Purchase amount")
        '.Range(HLABELPURCHVAL).Value = App.Term.String(8688, "Investment")
        ''.Range(HLABELOPENBALANCE).Value = App.Term.String(5635, "Book value") & " (" & App.Term.String(1313, "Opening balance") & " " & sFY & ")"
        ''.Range(HLABELINVESTMENTYEARLY).Value = App.Term.String(8688, "Investment") & " " & sFY
        '.Range(HLABELINVESTMENTYEARLY).Value = App.Term.String(4240, "Revalulation")
        '.Range(HLABELCUMDEPRYEARLY).Value = App.Term.String(8540, "Depreciation") & " " & sFY
        '.Range(HLABELCUMDEPR).Value = App.Term.String(8540, "Depreciation")
        ' ''FC20.702.613[chee112204] - Add Write Off Label (Grp)
        ' ''BR23.238.330[chee112204] - [ISSUE]    : Wrong term is used in new asset transcaction type
        '''                           [SOLUTION] : Change the Status "WriteOff (8948)" TO "WrittenOff(35098)"
        '.Range(HLABELWRITEOFF).Value = App.Term.String(35098, "WrittenOff")
        '''END - FC20.702.613
        '.Range(HLABELDISPOSAL).Value = App.Term.String(31490, "Disposal")
        '.Range(HLABELBOOKVALUE).Value = App.Term.String(5635, "Book value")
        
        .Range(HLABELASSETGRP).Value = App.Term.String(2560, "Group")
        .Range(HLABELLEDGER).Value = App.Term.String(31263, "GL account")
        .Range(HLABELPURCHVAL).Value = App.Term.String(8688, "Investment")
        .Range(HLABELPREVYEARREVALUATION).Value = App.Term.String(4240, "Revaluation") & " < " & sFY
        'BR 41.204.906: #1. "Revaluation >=YYYY" to "Revaluation YYYY"
        .Range(HLABELCURRYEARREVALUATION).Value = App.Term.String(4240, "Revaluation") & " " & sFY
        .Range(HLABELCUMDEPRYEARLY).Value = App.Term.String(8540, "Depreciation") & " " & sFY
        'BR 41.204.906: #2. "Depreciation MM" to "Depreciation MM/YYYY"
        .Range(HLABELCURRMONTHDEPR).Value = App.Term.String(8540, "Depreciation") & " " & Format$(sFP, "00") & "/" & sFY
        .Range(HLABELCUMDEPR).Value = App.Term.String(8540, "Depreciation")
        .Range(HLABELBOOKVALUE).Value = App.Term.String(5635, "Book value")
        .Range(HLABELWRITEOFF).Value = App.Term.String(35098, "Written Off")
        'BR 41.654.489/41.657.975: Refer remark at top
        .Range(HLABELDISPOSAL).Value = App.Term.String(6437, "Sold")
    End With
        
    'Clear report data
    'Select the last used rows and columns
    lLastRow = Worksheets(WORKSHEETFANAME).UsedRange.Rows.Count + 1
    Call DeleteCellValue(WORKSHEETFANAME, lLastRow)
    lLastRow = Worksheets(WORKSHEETFAGRP).UsedRange.Rows.Count + 1
    Call DeleteCellValue(WORKSHEETFAGRP, lLastRow)
    Call DeleteCellValue(WORKSHEETFABAL, lLastRow)
    lLastRow = Worksheets(4).UsedRange.Rows.Count + 1
    Call DeleteCellValue(4, lLastRow)
    Worksheets(WORKSHEETFANAME).Range("A12:A" & lLastRow).NumberFormat = "@" 'G/L account
    Worksheets(WORKSHEETFAGRP).Range("A12:A" & lLastRow).NumberFormat = "@" 'G/L account
End Sub

Public Sub OnRefreshAfterReports()
    Dim i As Integer
    Dim j As Integer
    Dim iBeforeGroupingLastNr As Integer
    Dim iAfterGroupingLastNr As Integer

    'Check if resultset is empty
    If IsEmpty(Worksheets(4).Range("A12").Value) And IsEmpty(Worksheets(WORKSHEETFAGRP).Range("A12").Value) Then
        App.Message 0, App.Term.String(8075, "No data which meets the criteria entered"), App.Term.String(32457, "Asset year end totals"), edlgInfo
        Application.DisplayAlerts = False
        Application.Quit
        Set App = Nothing
        Exit Sub
    End If
    DoEvents
    
    If GrpLastRow = 0 And BalLastRow = 0 Then
        GrpLastRow = Worksheets(WORKSHEETFAGRP).UsedRange.Rows.Count + 3
        BalLastRow = Worksheets(4).UsedRange.Rows.Count + 2
    End If
    
    If Not IsEmpty(Worksheets(WORKSHEETFAGRP).Range("A12").Value) Then
        
        ''tanj42445 - 20050811 - BR 16.122.545
        ''Overwrite the book value with formula.
        For i = 12 To GrpLastRow
            If Worksheets(WORKSHEETFAGRP).Range("A" & i).Value <> "" Then
                'FC 40.650.140: Enhancement on Asset balance list, adjust Book value formula after reordering columns
                'Ver. 1: Book value = Investment + Revaluation - Depreciation - Written off - Disposal
                'Ver. 2: Book value = Investment + [Revaluation < YYYY] + [Revaluation YYYY] - Depreciation - Written off - Disposal
                '''FC20.702.613[chee112204] - ADD a WriteOff Column, Adjust Column From "H" => "I" ; "G" => "H"
                ''Worksheets(WORKSHEETFAGRP).Range("H" & i).Value = "=C" & i & "+D" & i & "-F" & i & "-G" & i
                'Worksheets(WORKSHEETFAGRP).Range("I" & i).Value = "=C" & i & "+D" & i & "-F" & i & "-G" & i & "-H" & i
                '''END - FC20.702.613
                Worksheets(WORKSHEETFAGRP).Range("I" & i).Value = "=C" & i & "+D" & i & "+E" & i & "-H" & i & "-J" & i & "-K" & i
            End If
        Next i
        ''End BR 16.122.545
        
        'Clear unnecessary data
        'FC 40.650.140: Enhancement on Asset balance list, adjust cell range to clear off after reordering columns
        '''FC20.702.613[chee112204] - ADD a WriteOff Column, Adjust Column FROM I12M => J12N
        ''Range("I12:M" & Worksheets(WORKSHEETFAGRP).UsedRange.Rows.Count + 1).Select
        'Range("J12:N" & Worksheets(WORKSHEETFAGRP).UsedRange.Rows.Count + 1).Select
        '''END - FC20.702.613
        Range("L12:O" & Worksheets(WORKSHEETFAGRP).UsedRange.Rows.Count + 1).Select
        Selection.ClearContents
        'Define layout
        Call FormatReportLayoutFA(WORKSHEETFAGRP, GrpLastRow)
        'Include grouping and sorting order
        Call SortAndGrpReport(WORKSHEETFAGRP, GrpLastRow)
        Call FormatCell(WORKSHEETFAGRP)
    End If
    
    If Not IsEmpty(Worksheets(4).Range("A12").Value) Then
        'Define layout
        Call FormatReportLayoutFA(4, BalLastRow)
        Call FormatCell(4)
        
        ''tanj42445 - 20050701 - BR 15.651.523
        ''Overwrite book value with calculation
        For i = 12 To BalLastRow - 2
            'FC 40.650.140: Enhancement on Asset balance list, adjust Book value formula after reordering columns
            'Ver. 1: Book value = Investment + Revaluation - Depreciation - Written off - Disposal
            'Ver. 2: Book value = Investment + [Revaluation < YYYY] + [Revaluation YYYY] - Depreciation - Written off - Disposal
            '''FC20.702.613[chee112204] - ADD a WriteOff Column, Addjust Column FROM "J" => "K"; "I" => "J"
            ''Worksheets(4).Range("J" & i).Value = "=E" & i & "+F" & i & "-H" & i & "-I" & i
            'Worksheets(4).Range("K" & i).Value = "=E" & i & "+F" & i & "-H" & i & "-I" & i & "-J" & i
            '''END - FC20.702.613
            Worksheets(4).Range("U" & i).Value = "=L" & i & "+P" & i & "+Q" & i & "-T" & i & "-V" & i & "-X" & i
            'Investment end value = |fffd|Investment|fffd| + |fffd|Revaluation < YYYY|fffd| + |fffd|Revaluation YYYY|fffd| |fffd| |fffd|Written off investment|fffd| |fffd| |fffd|Sold investment|fffd| (calculate in formula!!)
            Worksheets(4).Range("N" & i).Value = "=L" & i & "+P" & i & "+Q" & i & "-W" & i & "-Y" & i
        Next i
        ''End BR 15.651.523
    End If
    
    If Not IsEmpty(Worksheets(4).Range("A12").Value) Then
        Worksheets(4).Activate
        Range("A12:A" & BalLastRow).Select
        With Selection
            .HorizontalAlignment = xlLeft
            .VerticalAlignment = xlBottom
            .WrapText = False
            .Orientation = 0
            .AddIndent = False
            .IndentLevel = 0
            .ShrinkToFit = False
            .ReadingOrder = xlContext
            .MergeCells = False
        End With
        Range("A2").Select
    Else
        Worksheets(WORKSHEETFAGRP).Activate
    End If
    
    Set App = Nothing

End Sub

Sub GetSlicData()
    Dim i As Integer
    With ThisWorkbook
        AssetGroup_All = .Names("AssetGroup.All").RefersToRange.Value
        AssetGroup_From = .Names("AssetGroup.From").RefersToRange.Value
        
        'BR 16.045.792 - Replace the ASCII Chr(255) to ""
        AssetGroup_To = IIf(InStr(.Names("AssetGroup.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("AssetGroup.To").RefersToRange.Value)
        
        Assetcode_All = .Names("AssetCode.All").RefersToRange.Value
        AssetCode_From = .Names("AssetCode.From").RefersToRange.Value
        
        'BR 16.045.792 - Replace the ASCII Chr(255) to ""
        AssetCode_To = IIf(InStr(.Names("AssetCode.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("AssetCode.To").RefersToRange.Value)
        
        Itemcode_All = .Names("ItemCode.All").RefersToRange.Value
        ItemCode_From = .Names("ItemCode.From").RefersToRange.Value
        
        'BR 16.045.792 - Replace the ASCII Chr(255) to ""
        ItemCode_To = IIf(InStr(.Names("ItemCode.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("ItemCode.To").RefersToRange.Value)
        
        If goCompany.GetOpt(50) Then
            CostCenter_All = .Names("CostCenter.All").RefersToRange.Value
            CostCenter_From = .Names("CostCenter.From").RefersToRange.Value
            
            'BR 16.045.792 - Replace the ASCII Chr(255) to ""
            CostCenter_To = IIf(InStr(.Names("CostCenter.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("CostCenter.To").RefersToRange.Value)
            
            'FC 40.650.140: Enhancement on Asset balance list
            CostUnit_All = .Names("CostUnit.All").RefersToRange.Value
            CostUnit_From = .Names("CostUnit.From").RefersToRange.Value
            CostUnit_To = IIf(InStr(.Names("CostUnit.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("CostUnit.To").RefersToRange.Value)
        Else
            CostCenter_All = True
            'FC 40.650.140: Enhancement on Asset balance list
            CostUnit_All = True
        End If
        
        If goCompany.GetOpt(32) Then
            Warehouse_All = .Names("mutWarehouseAll").RefersToRange.Value
            sWarehouse = .Names("fipWarehouse").RefersToRange.Value
        Else
            Warehouse_All = True
        End If
        


        ''tanj42445 - 20050809 - FC 16.061.117
        RefDate_All = .Names("mutRefDateAll").RefersToRange.Value
        dtRefDate = .Names("fipRefDate").RefersToRange.Value
        If .Names("fipRefDate").RefersToRange.Value = "" Then RefDate_All = -1
        ''End FC 16.061.117
        
        stActive = .Names("FipSActive").RefersToRange.Value
        stDepreciated = .Names("FipSDepreciated").RefersToRange.Value
        stSold = .Names("FipSSold").RefersToRange.Value
        stBlocked = .Names("FipSBlocked").RefersToRange.Value
        stInactive = .Names("FipSExit").RefersToRange.Value
        ''FC20.702.613[chee112204] - [ISSUE]    : Asset status with different depreciation types
        ''                           [SOLUTION] : Shift Position
        stWriteOff = .Names("FipSWriteOff").RefersToRange.Value
        
        ''FC20.144.656[chee112204] - Add 2 more Status (Transfer & WriteOff) For Germany & Austria License
        If goCompany.GetOpt(601) Or goCompany.GetOpt(610) Then
           stTransfer = .Names("FipSTransfer").RefersToRange.Value
           ''FC20.702.613[chee112204] - Shift Position
           'stWriteOff = .Names("FipSWriteOff").RefersToRange.Value
        Else
           stTransfer = 0
           ''FC20.702.613[chee112204] - Need not to prefill
           'stWriteOff = 0
        End If
        ''END - FC20.144.656
        
        
        'FC 40.650.140: Enhancement on Asset balance list
        Person_All = .Names("mutResourceAll").RefersToRange.Value
        sPerson = .Names("fipResource").RefersToRange.Value
        If Trim(.Names("fipResource").RefersToRange.Value) = "" Then Person_All = -1
        
        AssetBS_All = .Names("AssetBS.All").RefersToRange.Value
        If Not AssetBS_All Then
            AssetBS_From = .Names("AssetBS.From").RefersToRange.Value
            AssetBS_To = IIf(InStr(.Names("AssetBS.To").RefersToRange.Value, Chr(255)) = 1, "", .Names("AssetBS.To").RefersToRange.Value)
        End If
    End With
End Sub

Sub InitCol()
    'group header
    HLABELASSETGRP = "A11"
    HLABELLEDGER = "B11"
    HLABELPURCHVAL = "C11"
    'HLABELOPENBALANCE = "D11"
    HLABELINVESTMENTYEARLY = "D11"
    HLABELCUMDEPRYEARLY = "E11"
    HLABELCUMDEPR = "F11"
    ''FC20.702.613[chee112204] - Add WrtieOff Column, adjust Disposal column "G11" => "H11"; BookValue column "H11"=> "I11"
    HLABELWRITEOFF = "G11"
    HLABELDISPOSAL = "H11"
    HLABELBOOKVALUE = "I11"
    
    'balance list header
    HLABELASSETCODE_BL = "A11"
    HLABELDESC_BL = "B11"
    HLABELSTARTDATE_BL = "C11"
    HLABELENDDATE_BL = "D11"
    HLABELPURCHVAL_BL = "E11"
    'HLABELOPENBALANCE_BL = "F11"
    HLABELINVESTMENTYEARLY_BL = "F11"
    HLABELCUMDEPRYEARLY_BL = "G11"
    HLABELCUMDEPR_BL = "H11"
    ''FC20.702.613[chee112204] - Add WrtieOff Column, adjust Disposal Column "I11" => "J11"; BookValue column "J11"=> "K11"; Resource column "K11"=> "L11"
    HLABELWRITEOFF_BL = "I11"
    HLABELDISPOSAL_BL = "J11"
    HLABELBOOKVALUE_BL = "K11"
    HLABELRESOURCE_BL = "L11"
End Sub

Sub FillColor(sWorksheet)
    Dim i As Integer
    Dim LastCell As String
    
    If sWorksheet = WORKSHEETFANAME Or sWorksheet = WORKSHEETFABAL Then
        'FC 40.650.140: Enhancement on Asset balance list
        'LastCell = LASTCOLUMN_BL
        LastCell = LASTCOLUMN_BL_VAR
    ElseIf sWorksheet = WORKSHEETFAGRP Then
        LastCell = LASTCOLUMN_GP
    End If
    
    Range("A1").Select
    Selection.Interior.Color = RGB(200, 220, 225)
    
    Range("A2").Select
    Selection.Interior.Color = RGB(200, 220, 225)
    
    Range("A11:" & LastCell & "11").Select
    Selection.Interior.Color = RGB(173, 190, 201)
    For i = 1 To 2
        Range("A" & CStr(i) & ":" & LastCell & CStr(i)).Select
        With Selection
            .HorizontalAlignment = xlCenter
            .VerticalAlignment = xlBottom
            .WrapText = False
            .Orientation = 0
            .AddIndent = False
            .ShrinkToFit = False
            .MergeCells = False
        End With
        Selection.Merge
        With Selection.Interior
            If i = 1 Then
                .Color = RGB(173, 190, 201)
            Else
                .Color = RGB(200, 220, 225)
            End If
            .Pattern = xlSolid
        End With
        'If i = 2 Then ActiveCell.FormulaR1C1 = App.Term.String(8369, "Balance list")
    Next
End Sub

Sub DeleteCellValue(sWorksheet, lLastRow)
    Dim sLastCell As String
    
    On Error GoTo ErrHdl
    Worksheets(sWorksheet).Activate
    
    If sWorksheet = WORKSHEETFANAME Or sWorksheet = 4 Then
        'FC 40.650.140: Enhancement on Asset balance list
        'sLastCell = LASTCOLUMN_BL
        sLastCell = LASTCOLUMN_BL_VAR
        Cells.Select
        Selection.Borders(xlDiagonalDown).LineStyle = xlNone
        Selection.Borders(xlDiagonalUp).LineStyle = xlNone
        Selection.Borders(xlEdgeLeft).LineStyle = xlNone
        Selection.Borders(xlEdgeTop).LineStyle = xlNone
        Selection.Borders(xlEdgeBottom).LineStyle = xlNone
        Selection.Borders(xlEdgeRight).LineStyle = xlNone
        Selection.Borders(xlInsideVertical).LineStyle = xlNone
        Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    Else
        sLastCell = LASTCOLUMN_GP
    End If
    
    With Worksheets(sWorksheet)
        .Range("A12:" & sLastCell & "12").Select
        Selection.ClearContents
               
        .Range("A12:" & sLastCell & lLastRow).Select
        Selection.Rows.Ungroup
        Selection.Rows.Ungroup
        Selection.Rows.Ungroup
        'Selection.Rows.Ungroup
        'unbold all cell
        .Range("A12:" & sLastCell & lLastRow).Font.Bold = False
        '.Range("A13:" & sLastCell & lLastRow).Font.FontStyle = "Normal"
        
        '.Range("A13").Select
        '.Range("A13:" & sLastCell & lLastRow).Select
        Cells.Select
        Selection.Delete
        
        'Set focus back to cell
        .Range("A12").Select
    End With

Exit Sub
ErrHdl:
    With Worksheets(sWorksheet)
        'unbold all cell
        .Range("A13:" & sLastCell & lLastRow).Font.Bold = False
        '.Range("A13:" & sLastCell & lLastRow).Font.FontStyle = "Normal"
        
        'Set focus back to cell
        .Range("A13").Select
        .Range("A13:" & sLastCell & lLastRow).Select
        Selection.Delete
        
        'Set focus back to cell
        .Range("A12").Select
    End With
End Sub

'Define report layout
Sub FormatReportLayoutFA(sWorksheet, lLastRow)
    Dim i As Integer
    Dim vnt As Variant
    'foon36643- 20060307 - BR 18.463.432
    'Issue: Precision not correct
    'Solution: Get precision from currency calculator.
    'get the precision from the CurrencyCalculator.CurrencyAmountPrecision
    Dim sFormat As String
    Dim nPrecision As Integer
    nPrecision = goCompany.CurrencyCalculator.CurrencyAmountPrecision(goCompany.CurrencyCalculator.DefaultCurrency)
    sFormat = "#,##0." & String(nPrecision, "0")
    'BR 18.463.432 end
    
    'Activate worksheet
    Worksheets(sWorksheet).Activate

    'Disable some stuff:
    With ActiveWindow
        .DisplayWorkbookTabs = True
        .DisplayGridlines = False
        .FreezePanes = False
        .DisplayZeros = True
        .Zoom = 100
    End With

    Application.DisplayFormulaBar = True
    Application.ScreenUpdating = True
    Application.StatusBar = ""
        
    'Define column width:
    With Worksheets(sWorksheet)
        If sWorksheet = 4 Then
            'FC 40.650.140: Enhancement on Asset balance list
            '.Columns("A").ColumnWidth = 25# 'serial no
            '.Columns("B").ColumnWidth = 30# 'desc
            '.Columns("C").ColumnWidth = 15# 'start date
            '.Columns("D").ColumnWidth = 15# 'end date
            '.Columns("E").ColumnWidth = 20# 'purch value
            ''.Columns("F").ColumnWidth = 35# 'opening bal
            '.Columns("F").ColumnWidth = 20# 'investment yearly
            '.Columns("G").ColumnWidth = 20# 'cum. depr. yearly
            '.Columns("H").ColumnWidth = 18# 'cum. depr.
            '''FC20.702.613[chee112204] - Add WrtieOff Column, adjust Disposal column "I" => "J" ; Book Value column "J" =>"K"; Resoure column "K" =>"L"
            '.Columns("I").ColumnWidth = 18# 'WriteOff
            '.Columns("J").ColumnWidth = 18# 'disposal.
            '.Columns("K").ColumnWidth = 18# 'book value
            '.Columns("L").ColumnWidth = 30# 'resource
            '
            ''Define data format:
            '.Range("C12:C" & lLastRow).NumberFormat = "m/d/yyyy"
            '.Range("D12:D" & lLastRow).NumberFormat = "m/d/yyyy"
            ''foon36643- 20060307 - BR 18.463.432
            '.Range("E12:E" & lLastRow).NumberFormat = sFormat
            '.Range("F12:F" & lLastRow).NumberFormat = sFormat
            '.Range("G12:G" & lLastRow).NumberFormat = sFormat
            '.Range("H12:H" & lLastRow).NumberFormat = sFormat
            '.Range("I12:I" & lLastRow).NumberFormat = sFormat
            '.Range("J12:J" & lLastRow).NumberFormat = sFormat
            '.Range("K12:K" & lLastRow).NumberFormat = sFormat
            '''FC20.702.613[chee112204] - Add 1 more Column
            '.Range("L12:L" & lLastRow).NumberFormat = sFormat
            ''BR 18.463.432 end
            
            .Columns("A").ColumnWidth = 25# 'asset group
            .Columns("B").ColumnWidth = 25# 'serial no
            .Columns("C").ColumnWidth = 30# 'desc
            .Columns("D").ColumnWidth = 25# 'item code
            .Columns("E").ColumnWidth = 15# 'asset balance sheet gl
            .Columns("F").ColumnWidth = 20# 'depr. balance sheet gl
            .Columns("G").ColumnWidth = 15# 'start date
            .Columns("H").ColumnWidth = 15# 'end date
            .Columns("I").ColumnWidth = 15# 'entry date
            .Columns("J").ColumnWidth = 16# 'investement date/purchase date
            .Columns("K").ColumnWidth = 15# 'status
            .Columns("L").ColumnWidth = 20# 'purch value
            .Columns("M").ColumnWidth = 25# 'investment start year value
            .Columns("N").ColumnWidth = 21# 'investment end value
            .Columns("O").ColumnWidth = 20# 'residual value
            .Columns("P").ColumnWidth = 20# 'revaluation < yyyy
            .Columns("Q").ColumnWidth = 20# 'revaluation yyyy
            .Columns("R").ColumnWidth = 20# 'cum. depr. yearly
            .Columns("S").ColumnWidth = 25# 'current month depr.
            .Columns("T").ColumnWidth = 18# 'cum. depr.
            .Columns("U").ColumnWidth = 18# 'book value
            .Columns("V").ColumnWidth = 18# 'WriteOff
            .Columns("W").ColumnWidth = 25# 'WriteOff investment
            .Columns("X").ColumnWidth = 18# 'disposal.
            .Columns("Y").ColumnWidth = 25# 'disposal. investment
            .Columns("Z").ColumnWidth = 30# 'resource
            'Show analytical according to license/setting
            '.Columns("AA").ColumnWidth = 15# 'project
            '.Columns("AB").ColumnWidth = 15# 'cost center
            '.Columns("AC").ColumnWidth = 15# 'cost unit
            '.Columns("AD").ColumnWidth = 15# 'warehouse
            '.Columns("AE").ColumnWidth = 20# 'warehouse location
            For Each vnt In dicBalAnalytical.Items
                .Columns(vnt(idxCellValue)).ColumnWidth = vnt(idxCellWidth)
            Next
            
           'Define data format:
            .Range("G12:G" & lLastRow).NumberFormat = "m/d/yyyy"
            .Range("H12:H" & lLastRow).NumberFormat = "m/d/yyyy"
            .Range("I12:I" & lLastRow).NumberFormat = "m/d/yyyy"
            .Range("J12:J" & lLastRow).NumberFormat = "m/d/yyyy"
            .Range("L12:L" & lLastRow).NumberFormat = sFormat
            .Range("M12:M" & lLastRow).NumberFormat = sFormat
            .Range("N12:N" & lLastRow).NumberFormat = sFormat
            .Range("O12:O" & lLastRow).NumberFormat = sFormat
            .Range("P12:P" & lLastRow).NumberFormat = sFormat
            .Range("Q12:Q" & lLastRow).NumberFormat = sFormat
            .Range("R12:R" & lLastRow).NumberFormat = sFormat
            .Range("S12:S" & lLastRow).NumberFormat = sFormat
            .Range("T12:T" & lLastRow).NumberFormat = sFormat
            .Range("U12:U" & lLastRow).NumberFormat = sFormat
            .Range("V12:V" & lLastRow).NumberFormat = sFormat
            .Range("W12:W" & lLastRow).NumberFormat = sFormat
            .Range("X12:X" & lLastRow).NumberFormat = sFormat
            .Range("Y12:Y" & lLastRow).NumberFormat = sFormat

        Else
            'FC 40.650.140: Enhancement on Asset balance list
            '.Columns("A").ColumnWidth = 40# 'asset group
            '.Columns("B").ColumnWidth = 30# 'gl
            '.Columns("C").ColumnWidth = 20# 'purch value
            ''.Columns("D").ColumnWidth = 35# 'opening bal
            '.Columns("D").ColumnWidth = 20# 'investment yearly
            '.Columns("E").ColumnWidth = 20# 'cum. depr. yearly
            '.Columns("F").ColumnWidth = 18# 'cum. depr.
            '''FC20.702.613[chee112204] - Add WrtieOff Column, adjust Disposal Column "G" => "H"; bookValue Column "H"=>"I"
            '.Columns("G").ColumnWidth = 18# 'writeOff
            '.Columns("H").ColumnWidth = 18# 'disposal
            '.Columns("I").ColumnWidth = 18# 'book value
            '
            ''Define data format:
            ''foon36643- 20060307 - BR 18.463.432
            '.Range("C12:C" & lLastRow).NumberFormat = sFormat
            '.Range("D12:D" & lLastRow).NumberFormat = sFormat
            '.Range("E12:E" & lLastRow).NumberFormat = sFormat
            '.Range("F12:F" & lLastRow).NumberFormat = sFormat
            '.Range("G12:G" & lLastRow).NumberFormat = sFormat
            '.Range("H12:H" & lLastRow).NumberFormat = sFormat
            '''FC20.702.613[chee112204] - Add 1 more Column
            '.Range("I12:I" & lLastRow).NumberFormat = sFormat
            ''BR 18.463.432 end
            
            .Columns("A").ColumnWidth = 40# 'asset group
            .Columns("B").ColumnWidth = 30# 'gl
            .Columns("C").ColumnWidth = 20# 'purch value
            .Columns("D").ColumnWidth = 20# 'revaluation < yyyy
            .Columns("E").ColumnWidth = 20# 'revaluation yyyy
            .Columns("F").ColumnWidth = 20# 'cum. depr. yearly
            .Columns("G").ColumnWidth = 25# 'current month depr.
            .Columns("H").ColumnWidth = 18# 'cum. depr.
            .Columns("I").ColumnWidth = 18# 'book value
            .Columns("J").ColumnWidth = 18# 'writeOff
            .Columns("K").ColumnWidth = 18# 'disposal
                    
            'Define data format:
            .Range("C12:C" & lLastRow).NumberFormat = sFormat
            .Range("D12:D" & lLastRow).NumberFormat = sFormat
            .Range("E12:E" & lLastRow).NumberFormat = sFormat
            .Range("F12:F" & lLastRow).NumberFormat = sFormat
            .Range("G12:G" & lLastRow).NumberFormat = sFormat
            .Range("H12:H" & lLastRow).NumberFormat = sFormat
            .Range("I12:I" & lLastRow).NumberFormat = sFormat
            .Range("J12:J" & lLastRow).NumberFormat = sFormat
            .Range("K12:K" & lLastRow).NumberFormat = sFormat
        End If
        
        'Set rowwidth
        .Range("A12").RowHeight = 20#
    End With
End Sub

'If duplicate cell value found for G/L or Assetgroup then suppress it
'If subtotal or grandtotal field then bold it

Sub FormatCell(sWorksheet)
    Dim i As Long
    Dim sLastCell As String
    Dim lLastRow As Long
        
    If sWorksheet = 4 Then
        'FC 40.650.140: Enhancement on Asset balance list
        'sLastCell = LASTCOLUMN_BL
        sLastCell = LASTCOLUMN_BL_VAR
    Else
        sLastCell = LASTCOLUMN_GP
    End If
    Worksheets(sWorksheet).Activate
    lLastRow = Worksheets(sWorksheet).UsedRange.Rows.Count + 1
    With Worksheets(sWorksheet)
        .Range("A4:" & sLastCell & lLastRow).Select
        Selection.Font.Name = "Verdana"
        'Selection.Font.FontStyle = "Normal"
        Selection.Font.Size = 9
        .Range("A12:" & sLastCell & "12").Font.Bold = False
        .Range("A11:" & sLastCell & "11").Font.Bold = True
        
        If sWorksheet = WORKSHEETFAGRP Then
            For i = 12 To lLastRow
                If .Rows(i).Summary Then
                     If i = lLastRow Then
                        Call AdjRowGrdTotal(i)
                        Call Insertcolour("A" & i + 1 & ":" & sLastCell & i + 1, 53)
                        Call DrawLine("A", sLastCell, i + 1)
                        .Range("C" & i + 1 & ":" & sLastCell & i + 1).Font.Bold = True
                    Else
                        Call Insertcolour("A" & i & ":" & sLastCell & i, 52)
                        .Range("C" & i & ":" & sLastCell & i).Font.Bold = True
                    End If
                ElseIf .Range("A" & i).Value = "" Then
                    Call AdjRowGrdTotal(i - 1)
                    Call Insertcolour("A" & i & ":" & sLastCell & i, 53)
                    Call DrawLine("A", sLastCell, i)
                    .Range("C" & i + 1 & ":" & sLastCell & i + 1).Font.Bold = True
                    Exit For
                End If
            Next
        Else
            .Range("A" & BalLastRow & ":" & sLastCell & BalLastRow).Font.Bold = True
            'label total n fill color for row total
            .Range("A" & BalLastRow).Value = App.Term.String(8904, "Total")
            'Sum total
            'FC 40.650.140: Enhancement on Asset balance list. Adjust formula after reordering columns
            '.Range("E" & BalLastRow).Formula = "=SUM(E12:E" & BalLastRow - 1 & ")"
            '.Range("F" & BalLastRow).Formula = "=SUM(F12:F" & BalLastRow - 1 & ")"
            '.Range("G" & BalLastRow).Formula = "=SUM(G12:G" & BalLastRow - 1 & ")"
            '.Range("H" & BalLastRow).Formula = "=SUM(H12:H" & BalLastRow - 1 & ")"
            '.Range("I" & BalLastRow).Formula = "=SUM(I12:I" & BalLastRow - 1 & ")"
            '.Range("J" & BalLastRow).Formula = "=SUM(J12:J" & BalLastRow - 1 & ")"
            '''FC20.702.613[chee112204] - Add 1 more Column, Change J => K
            '.Range("K" & BalLastRow).Formula = "=SUM(K12:K" & BalLastRow - 1 & ")"
            ''Call Insertcolour("A" & BalLastRow & ":J" & BalLastRow, 52)
            ''Call DrawLine("E", "J", BalLastRow)
            'Call Insertcolour("A" & BalLastRow & ":K" & BalLastRow, 52)
            'Call DrawLine("E", "K", BalLastRow)
            '''END - FC20.702.613
            .Range("L" & BalLastRow).Formula = "=SUM(L12:L" & BalLastRow - 1 & ")"
            .Range("M" & BalLastRow).Formula = "=SUM(M12:M" & BalLastRow - 1 & ")"
            .Range("N" & BalLastRow).Formula = "=SUM(N12:N" & BalLastRow - 1 & ")"
            .Range("O" & BalLastRow).Formula = "=SUM(O12:O" & BalLastRow - 1 & ")"
            .Range("P" & BalLastRow).Formula = "=SUM(P12:P" & BalLastRow - 1 & ")"
            .Range("Q" & BalLastRow).Formula = "=SUM(Q12:Q" & BalLastRow - 1 & ")"
            .Range("R" & BalLastRow).Formula = "=SUM(R12:R" & BalLastRow - 1 & ")"
            .Range("S" & BalLastRow).Formula = "=SUM(S12:S" & BalLastRow - 1 & ")"
            .Range("T" & BalLastRow).Formula = "=SUM(T12:T" & BalLastRow - 1 & ")"
            .Range("U" & BalLastRow).Formula = "=SUM(U12:U" & BalLastRow - 1 & ")"
            .Range("V" & BalLastRow).Formula = "=SUM(V12:V" & BalLastRow - 1 & ")"
            .Range("W" & BalLastRow).Formula = "=SUM(W12:W" & BalLastRow - 1 & ")"
            .Range("X" & BalLastRow).Formula = "=SUM(X12:X" & BalLastRow - 1 & ")"
            .Range("Y" & BalLastRow).Formula = "=SUM(Y12:Y" & BalLastRow - 1 & ")"
            Call Insertcolour("A" & BalLastRow & ":Y" & BalLastRow, 52)
            Call DrawLine("L", "Y", BalLastRow)
        End If
        
        .Range("A12").Select
    End With

End Sub

Function RetrieveGL(sGL As String) As String
    Dim intPos As Integer
    
    intPos = InStr(1, sGL, App.Term.String(8904, "Total"))
    RetrieveGL = Left(sGL, intPos - 2)
    
End Function

Sub Insertcolour(sRow As String, ClrIndex As Integer)
    Range(sRow).Select
    With Selection.Interior
        .ColorIndex = ClrIndex
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
    End With
End Sub

Sub DrawLine(StartCol, EndCol, lRow)
    'draw line
    Range(StartCol & lRow & ":" & EndCol & lRow).Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = xlAutomatic
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlDouble
        .Weight = xlThick
        .ColorIndex = xlAutomatic
    End With
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
End Sub

Sub AdjRowGrdTotal(lRow)
    Rows(lRow & ":" & lRow).Select
    Selection.Insert Shift:=xlDown
    Rows(lRow & ":" & lRow).Select
    Selection.Interior.ColorIndex = RGB(0, 0, 0)
End Sub

Sub SortAndGrpReport(sWorksheet, lLastRow)
    Dim LastRowNr As Long
    Dim bDummy As Boolean
    Dim i As Long
    Dim tmp As String
    
    Worksheets(sWorksheet).Activate
    With Worksheets(sWorksheet)
        .Range("A12").Select
        'Selection.Sort Key1:=.Range("A11"), Order1:=xlAscending, Key2:=.Range("B11"), Order2:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, DataOption1:=xlSortNormal, DataOption2:=xlSortNormal
        
        'FC 40.650.140: Enhancement on Asset balance list, adjust grouping after reordering columns
        ''FC20.702.613[chee112204] - Add 1 more Column (...,9)
        'Selection.SUBTOTAL GroupBy:=1, Function:=xlSum, TotalList:=Array(3, _
        '4, 5, 6, 7, 8, 9), Replace:=False, PageBreaks:=False, SummaryBelowData:=xlSummaryBelow
        Selection.SUBTOTAL GroupBy:=1, Function:=xlSum, TotalList:=Array(3, _
        4, 5, 6, 7, 8, 9, 10, 11), Replace:=False, PageBreaks:=False, SummaryBelowData:=xlSummaryBelow
                
        .Range("A12:" & LASTCOLUMN_GP & lLastRow).Rows.AutoFit
    End With
End Sub

Sub CopyDataToDisp()
    'Copy criteria data
    Worksheets(WORKSHEETFAGRP).Range("A4:" & LASTCOLUMN_GP & "6").Copy _
        Destination:=Worksheets(4).Range("A4:" & LASTCOLUMN_BL & "6")
        
    'Worksheets(WORKSHEETFAGRP).Range("A2").Value = App.Term.String(201, "Group by") & ": " & App.Term.String(5514, "Asset group")
    Worksheets(4).Range("A2").Value = App.Term.String(8369, "Balance list")

End Sub

Sub CopyBalanceHeader()
    'Copy criteria data
    Sheets(WORKSHEETFANAME).Select
    Range("A11:" & LASTCOLUMN_BL & "11").Select
    Selection.Copy
    Sheets(4).Select
    Range("A11").Select
    ActiveSheet.Paste
End Sub

Sub GenerateSQLQuery(sWorksheet As String)
On Error GoTo Failed
    Dim sSQLMain As String
    Dim sSQLSelect As String
    Dim sSqlWhere As String
    Dim sSQLGroup As String
    Dim sSQLOrder As String
    Dim sStatus As String
    Dim clsGeneral As Easzzptran.clsGeneral
    Dim EdlConn As EdlConnection
    Dim QueryCell As String
    Dim bIsFilter As Boolean
    
    Set clsGeneral = New clsGeneral
    Set EdlConn = goCompany
    App.ConnectObject clsGeneral, goCompany, App.Term
    
    ''tanj42445 - 20081213 - BR 29.329.950
    ''Issue: The view current year didnt follow the reference date
    ''Solution: Set the current year base on the reference date
    If Not RefDate_All Then
        clsGeneral.GetPeriodYearFromPerdat EdlConn, sFY, sFP, dtRefDate
    Else
        clsGeneral.GetPeriodYearFromPerdat EdlConn, sFY, sFP, goCompany.ProcessDate
    End If
    ''End BR 29.329.950
    
    ''tanj42445 - Temporary Double Investment Solution
    Dim sEntryGuid As String
    Dim sRecID As String
    
    Dim sInvestment As String
    Dim sRevaluation As String
    Dim sCurYrDep As String
    Dim sDepreciation As String
    Dim sDisposal As String
    Dim sBookValue As String
    ''FC20.702.613[chee112204] - Declare Variable of WriteOff
    Dim sWriteOff As String
    
    ''BR20.060.239[chee112204] - Declare Variable
    Dim SQLstmt As String
    Dim strAssetGrp As String
    Dim strAssetCd As String
    Dim strItemCd As String
    Dim rngDeprBS As String
    Dim rngAssetAC As String
    Dim vRET As Variant
    Dim vv As Long
    
    'FC 40.650.140: Enhancement on Asset balance list
    Dim sPrevYearRevaluation As String
    Dim sCurrYearRevaluation As String
    Dim sCurrMonthDepr As String
    Dim vs As esl.ValueSet
    'BR 41.654.489/41.657.975: Refer remark at top
    Dim sYearDisposal As String
    
    Set vs = New esl.ValueSet
    vs.Add "Period", sFP
    vs.Add "RefDateAll", CBool(RefDate_All)
    vs.Add "PrevYearRevaluation", sPrevYearRevaluation
    vs.Add "CurrYearRevaluation", sCurrYearRevaluation
    vs.Add "CurrMonthDepr", sCurrMonthDepr
    'BR 41.654.489/41.657.975: Refer remark at top
    vs.Add "YearDisposal", sYearDisposal
    
    Call SpecialCase(sRecID, sEntryGuid)
    
    ''tanj42445 - 20050725 - BR 15.848.031
    ''for belgium, no need to exclude transsubtype 'I'
    Dim sTranssubtype As String
    If goCompany.GetOpt(609) Then
        sTranssubtype = "'E','R','V','B'"
    Else
        sTranssubtype = "'E','I','R','V','B'"
    End If
    ''End BR 15.848.031
    
    
       ''BR20.060.239[chee112204] - [ISSUE]    : Amount investment double in balance list assets once change the Asset Group
       ''                           [SOLUTION] : Retrieve the DeprBS and AssetAC in range
       '**SQLstmt = " SELECT Distinct ftrn.DeprBS, ftrn.AssetAC From " & _
                "(SELECT fatran.assetCode , fatran.artcode, fagrp.DeprBS, fagrp.AssetAC From fagrp " & _
                 " LEFT OUTER JOIN fatran ON ((fagrp.AssetGroup = fatran.olddataval  OR fagrp.AssetGroup = newdataval or fagrp.AssetGroup = fatran.assetgroup) "
       
       
'        'Asset Group
'        If Not AssetGroup_All Then
'            bIsFilter = True
'            If AssetGroup_From <> "" And AssetGroup_To <> "" Then
'                SQLstmt = SQLstmt & " AND fatran.assetgroup BETWEEN " & EdlConn.LitString(AssetGroup_From) & " AND " & EdlConn.LitString(AssetGroup_To)
'            ElseIf AssetGroup_From <> "" Then
'                SQLstmt = SQLstmt & " AND fatran.assetgroup >= " & EdlConn.LitString(AssetGroup_From)
'            Else
'                SQLstmt = SQLstmt & " AND fatran.assetgroup <= " & EdlConn.LitString(AssetGroup_To)
'            End If
'        End If
'
'        'AssetCode
'        If Not Assetcode_All Then
'            bIsFilter = True
'            If AssetCode_From <> "" And AssetCode_To <> "" Then
'               SQLstmt = SQLstmt & " AND fatran.assetcode BETWEEN " & EdlConn.LitString(AssetCode_From) & " AND " & EdlConn.LitString(AssetCode_To)
'            ElseIf AssetCode_From <> "" Then
'               SQLstmt = SQLstmt & " AND fatran.assetcode >= " & EdlConn.LitString(AssetCode_From)
'            Else
'               SQLstmt = SQLstmt & " AND fatran.assetcode <= " & EdlConn.LitString(AssetCode_To)
'            End If
'        End If
'
'
'        'ItemCode
'        If Not Itemcode_All Then
'            bIsFilter = True
'            If ItemCode_From <> "" And ItemCode_To <> "" Then
'               SQLstmt = SQLstmt & " AND fatran.artcode BETWEEN " & EdlConn.LitString(ItemCode_From) & " AND " & EdlConn.LitString(ItemCode_To)
'            ElseIf ItemCode_From <> "" Then
'               SQLstmt = SQLstmt & " AND fatran.artcode >= " & EdlConn.LitString(ItemCode_From)
'            Else
'               SQLstmt = SQLstmt & " AND fatran.artcode <= " & EdlConn.LitString(ItemCode_To)
'            End If
'       End If
'
'       SQLstmt = SQLstmt & ")"
'       SQLstmt = SQLstmt & " Where Not fatran.assetCode Is Null Or Not fatran.artcode Is Null"
'       SQLstmt = SQLstmt & " )as ftrn "
'       SQLstmt = SQLstmt & " INNER JOIN ItemNumbers ON (ftrn.assetCode = ItemNumbers.Number and ftrn.artcode = ItemNumbers.ItemCode and ItemNumbers.Classification = 'F')"

        'BR 21.165.796 [chey109859]- [ISSUE]   : Incorrect book value in [Assets-Reports-Balance List] for blocked assets
        '                            [Cause]   : There is no record for the selected item in fatran table, therefore value retrieved is incorrect
        '                            [SOLUTION]: Retrieve value for DeprBS and AssetAC in fagrp table instead of fatran table
        SQLstmt = "SELECT DISTINCT fg.deprbs, fg.assetac FROM (SELECT deprbs,assetac FROM fagrp) AS fg"
        'End BR 21.165.796
        
        vRET = EdlConn.Query(SQLstmt, , edlForce2dim)
        
       If Not IsEmpty(vRET) Then
            For vv = LBound(vRET) To UBound(vRET)
                'Range DepreBS
                If Len(Trim(vRET(vv, 1))) <> 0 Then
                    rngDeprBS = IIf(Len(rngDeprBS) = 0, EdlConn.Literal(vRET(vv, 1)), rngDeprBS & "," & EdlConn.Literal(vRET(vv, 1)))
                End If
                
                'Range AssetAC
                If Len(Trim(vRET(vv, 2))) <> 0 Then
                    rngAssetAC = IIf(Len(rngAssetAC) = 0, EdlConn.Literal(vRET(vv, 2)), rngAssetAC & "," & EdlConn.Literal(vRET(vv, 2)))
                End If
            Next
       Else
           rngDeprBS = "''"
            rngAssetAC = "''"
       End If
       clsGeneral.OverRngDeprBS = rngDeprBS
       clsGeneral.OverRngAssetAC = rngAssetAC
    ''END - BR20.060.239
        
    
    'BR 13.935.595 - Change column names
    '"(SUM(CASE WHEN gmt.bkjrcode = " & EdlConn.LitString(sFY) & " AND (gmt.transsubtype='E' OR (gmt.reknr = ag.AssetAC AND ac.TransactionGuid <> gmt.TransactionGuid AND gmt.transtype IN ('N','C','P') AND gmt.transsubtype NOT IN ('I','V','E'))) THEN gmt.bdr_hfl ELSE 0 END)) AS Revaluation, "
    If sWorksheet = WORKSHEETFAGRP Then
        '"(SUM(CASE WHEN gmt.bkjrcode < " & EdlConn.LitString(sFY) & " AND (gmt.reknr IN (ag.AssetAC,ag.DeprBS) OR ac.TransactionGuid=gmt.TransactionGuid) THEN gmt.bdr_hfl ELSE 0 END)) AS OpenBal, " & vbLf &
        QueryCell = "FACARD_Query"
        ''FC20.702.613[chee112204] - Add ISNULL(descr50_X/gbk.oms25_X,'') if NULL value for descr50_X/gbk.oms25_X return '',
        sSQLSelect = "SELECT RTRIM(ac.AssetGroup) + '   ' + ISNULL(ag.descr50_" & goCompany.MultiLang.DefaultIndex & ",'') AS AssetGroup, LTRIM(gmt.reknr) + '   ' + ISNULL(gbk.oms25_" & goCompany.MultiLang.DefaultIndex & ",'') AS Reknr, " & vbLf
        
        ''tanj42445 - 20050603 - BR 15.082.455
        ''Replace the book value logic from esazzptran.dll
        ''tanj42445 - 20050811 - BR 16.122.545
        ''Use the query from easzzptran, so all share the same calculation
        
        'FC 40.650.140: Enhancement on Asset balance list
        'clsGeneral.GetAssetBalanceListQuery sInvestment, sRevaluation, sCurYrDep, _
        '    sDepreciation, sDisposal, sBookValue, sFY, _
        '    Array("RecId", sRecID, "EntryGuid", sEntryGuid)
        clsGeneral.GetAssetBalanceListQuery sInvestment, sRevaluation, sCurYrDep, _
            sDepreciation, sDisposal, sBookValue, sFY, _
            vs
        'Read syntax from valueset
        sPrevYearRevaluation = vs.Value("PrevYearRevaluation")
        sCurrYearRevaluation = vs.Value("CurrYearRevaluation")
        sCurrMonthDepr = vs.Value("CurrMonthDepr")
        
        ''FC20.702.613[chee112204] - Get Write Off SQL Statement
        sWriteOff = clsGeneral.GStrWriteOFF
    
        ''BR21.764.197[chee112204] - [ISSUE]    : Germany Investment, Disposal and Write off amount show incorrect in Asset Report
        ''                           [SOLUTION] : Adjust the Report's fields accordingly
        ''                                      : [Disposal Amount] Add ==> AND gmt.Type IN (72, 73)
        ''Overwrite disposal query cause it got a bit different from others in Asset Group view
        ''tanj42445 - 20081014 - BR 27.785.932
        ''Issue: The old disposal record is not displaying
        ''Solution: When adding the 'gmt.Type' filter, should include the NULL checking to cater for old record
        ''          Change from 'gmt.Type IN (72, 73)' to '(gmt.Type IN (72,73) OR gmt.Type IS NULL)'
        sDisposal = "(SUM (CASE WHEN gmt.transsubtype = 'I' AND (gmt.Type IN (72,73) OR gmt.Type IS NULL) THEN -gmt.bdr_hfl ELSE 0 END))" & vbCrLf
        
        'FC 40.650.140: Enhancement on Asset balance list
        ''FC20.702.613[chee112204] - Add sWriteOff Field & SQL Server 2005 Workaround ISSUE (IS NOT NULL)
        sSQLSelect = sSQLSelect & _
            sInvestment & " AS [Purchase value], " & vbCrLf _
            & sRevaluation & " AS Revaluation, " & vbCrLf _
            & sCurYrDep & " AS [Yearly depreciation], " & vbCrLf _
            & sDepreciation & " AS Credit, " & vbCrLf _
            & sWriteOff & " AS WriteOff, " & vbCrLf _
            & sDisposal & " AS Disposal, " & vbCrLf _
            & sBookValue & " AS Balance, " & vbCrLf _
            & sPrevYearRevaluation & " AS PrevYearRevaluation, " & vbCrLf _
            & sCurrYearRevaluation & " AS CurrYearRevaluation, " & vbCrLf _
            & sCurrMonthDepr & " AS CurrMonthDepr " & vbCrLf & _
            "FROM ItemNumbers ac " & vbLf & _
            "LEFT OUTER JOIN (" & vbLf & _
            "    SELECT " & vbLf & _
            "    (CASE WHEN ItemNumbers.TransactionGuid IS NOT NULL THEN (SELECT datum FROM gbkmut WHERE gbkmut.TransactionGuid = ItemNumbers.TransactionGuid) ELSE NULL END) AS purchdate, " & vbLf & _
            "    ItemNumbers.ItemCode, ItemNumbers.Number FROM ItemNumbers " & vbLf & _
            ") a ON a.Number=ac.Number AND a.ItemCode=ac.Itemcode " & vbLf & _
            "AND a.ItemCode IS NOT NULL AND ac.Itemcode IS NOT NULL " & vbLf & _
            "INNER JOIN fagrp ag ON ag.assetgroup = ac.AssetGroup " & vbLf & _
            "LEFT OUTER JOIN (gbkmut gmt INNER JOIN grtbk gbk ON gbk.reknr = gmt.reknr AND gbk.omzrek NOT IN ('D','C','V') AND gbk.bal_vw = 'B') ON gmt.facode = ac.Number AND gmt.artcode = ac.ItemCode AND gmt.transtype IN ('N','C','P')" & vbLf & _
            "AND gmt.facode IS NOT NULL AND ac.Number IS NOT NULL AND gmt.artcode IS NOT NULL AND ac.ItemCode IS NOT NULL " & vbLf & _
            "WH%"
        ''End BR 16.122.545
        
        sSQLGroup = " GROUP BY ac.assetgroup, gmt.reknr, ag.descr50_" & goCompany.MultiLang.DefaultIndex & ", gbk.oms25_" & goCompany.MultiLang.DefaultIndex
        sSQLOrder = " ORDER BY ac.assetgroup"
                
    Else
        '"(SUM(CASE WHEN gmt.bkjrcode < " & EdlConn.LitString(sFY) & " AND (gmt.reknr IN (ag.AssetAC,ag.DeprBS) OR ac.TransactionGuid=gmt.TransactionGuid) THEN gmt.bdr_hfl ELSE 0 END)) AS OpenBal, " & vbLf &
        QueryCell = "FACARD_Bal"
        ''tanj42445 - 20050712 - BR 15.767.814
''        sSQLSelect = "SELECT ac.Number, ac.Description, ac.DateStart, ac.DateEnd, " & vbLf
        sSQLSelect = "SELECT ('''' + ac.Number) as Number, ('''' + ac.Description) as Description, ac.DateStart, ac.DateEnd, " & vbLf
                     ''tanj42445 - 20050603 - BR 15.082.455
                     ''Replace the book value logic from esazzptran.dll
''                     "(SUM(CASE WHEN ac.TransactionGuid=gmt.TransactionGuid OR (gmt.reknr = ag.AssetAC AND gmt.transsubtype NOT IN ('E','I','R','V') AND gmt.transtype IN ('N','C','P')) THEN gmt.bdr_hfl ELSE 0 END)) AS [Purchase value], " & vbLf

        
        'FC 40.650.140: Enhancement on Asset balance list
        ''tanj42445 - 20050726 - The query generation is move to easzzptran
        'clsGeneral.GetAssetBalanceListQuery sInvestment, sRevaluation, sCurYrDep, _
        '    sDepreciation, sDisposal, sBookValue, sFY, _
        '    Array("RecId", sRecID, "EntryGuid", sEntryGuid)
        clsGeneral.GetAssetBalanceListQuery sInvestment, sRevaluation, sCurYrDep, _
            sDepreciation, sDisposal, sBookValue, sFY, _
            vs
        'Read syntax from valueset
        sPrevYearRevaluation = vs.Value("PrevYearRevaluation")
        sCurrYearRevaluation = vs.Value("CurrYearRevaluation")
        sCurrMonthDepr = vs.Value("CurrMonthDepr")
        'BR 41.654.489/41.657.975: Refer remark at top
        sYearDisposal = vs.Value("YearDisposal")

         ''FC20.702.613[chee112204] - Get the WriteOff SQL Statement
         sWriteOff = clsGeneral.GStrWriteOFF
        
        'BR 41.654.489/41.657.975: Refer remark at top
        'BR 41.204.906:
        '   Issue: Assets sold/ written off with book value zero, shows incorrect investment end value and written off investment amount.
        '   Solution: Add checking status to enable showing written off investment amount or disposal investment amount
        'FC 40.650.140: Enhancement on Asset balance list. Investment end value = |fffd|Investment YYYY|fffd| + |fffd|Revaluation YYYY|fffd| |fffd| |fffd|Written off investment|fffd| |fffd| |fffd|Disposal investment|fffd| (calculate in formula!!)
        ''FC20.702.613[chee112204]  :  ADD sWriteOff & SQL Server 2005 Workaround ISSUE (IS NOT NULL)
        ''BR20.060.239[chee112204]  :  Take out "INNER JOIN fagrp ag ON ag.assetgroup = ac.AssetGroup " & vbLf  "
        ''                             After ") a ON a.Number=ac.Number AND a.ItemCode=ac.Itemcode..."
        sSQLSelect = sSQLSelect & _
            sInvestment & " AS [Purchase value], " & vbCrLf _
            & sRevaluation & " AS Revaluation, " & vbCrLf _
            & sCurYrDep & " AS [Yearly depreciation], " & vbCrLf _
            & sDepreciation & " AS Credit, " & vbCrLf _
            & sWriteOff & " AS WriteOff, " & vbCrLf _
            & sDisposal & " AS Disposal, " & vbCrLf _
            & sBookValue & " AS Balance, " & vbCrLf _
                     & "hm.FullName, " & vbLf _
                     & "a.purchdate AS  PurchaseDate, ac.UserDate_03 AS AcquisitionDate, RTRIM(ac.AssetGroup) + '   ' + ISNULL(ag.descr50_" & goCompany.MultiLang.DefaultIndex & ",'') AS AssetGroup, ac.ItemCode, ag.AssetAC, ag.DeprBS, ac.Projectnr, ac.CostCenter, ac.CostUnit, wh.warehouse AS Warehouse, wh.warehouse_location AS WarehouseLocation, ac.ResidualValue, " & vbLf _
                     & "CASE ac.Status WHEN 'A' THEN '" & App.Term.String(2212, "Active") & "' WHEN 'B' THEN '" & App.Term.String(1267, "Blocked") & "' WHEN 'C' THEN '" & App.Term.String(5639, "Depreciated") & "' WHEN 'D' THEN '" & App.Term.String(29544, "Inactive") & "' WHEN 'G' THEN '" & App.Term.String(29, "Not validated") & "' WHEN 'S' THEN '" & App.Term.String(6437, "Sold") & "' WHEN 'T' THEN '" & App.Term.String(18832, "Transfer") & "' WHEN 'W' THEN '" & App.Term.String(35098, "Written Off") & "' ELSE '" & App.Term.String(1067, "Unknown") & "' END AS StatusDescription, " & vbLf
        sSQLSelect = sSQLSelect _
                    & sYearDisposal & " AS YearDisposal, " & vbLf _
                    & "0 AS InvestmentEndValue, " & vbLf _
                    & sPrevYearRevaluation & " AS PrevYearRevaluation, " & vbLf _
                    & sCurrYearRevaluation & " AS CurrYearRevaluation, " & vbLf _
                    & sCurrMonthDepr & " AS CurrMonthDepr, " & vbLf & _
                    "ac.Status " & vbLf & _
                     "FROM ItemNumbers ac " & vbLf & _
                     "LEFT OUTER JOIN " & vbLf & _
                     "(" & vbLf & _
                     "    SELECT" & vbLf & _
                     "    (CASE WHEN ItemNumbers.TransactionGuid IS NOT NULL THEN (SELECT datum FROM gbkmut WHERE gbkmut.TransactionGuid = ItemNumbers.TransactionGuid) ELSE NULL END) AS purchdate, " & vbLf & _
                     "    ItemNumbers.ItemCode, ItemNumbers.Number FROM ItemNumbers " & vbLf & _
                     ") a ON a.Number=ac.Number AND a.ItemCode=ac.Itemcode " & vbLf & _
                     "AND a.Number IS NOT NULL AND ac.Number IS NOT NULL AND a.ItemCode IS NOT NULL AND ac.Itemcode IS NOT NULL " & vbLf & _
                     "LEFT OUTER JOIN fagrp ag ON ag.assetgroup = ac.AssetGroup " & vbLf & _
                     "LEFT OUTER JOIN (gbkmut gmt INNER JOIN grtbk gbk ON gbk.reknr = gmt.reknr AND gbk.omzrek NOT IN ('D','C','V') AND gbk.bal_vw = 'B') ON gmt.facode = ac.Number AND gmt.artcode = ac.ItemCode AND gmt.transtype IN ('N','C','P') " & vbLf & _
                     "AND gmt.facode IS NOT NULL AND ac.Number IS NOT NULL AND gmt.artcode IS NOT NULL AND ac.ItemCode IS NOT NULL " & vbLf & _
                     "LEFT OUTER JOIN humres hm ON hm.res_id = ac.Resource AND hm.res_id IS NOT NULL AND ac.Resource IS NOT NULL " & vbLf & _
                     "LEFT OUTER JOIN cicmpy ci ON ci.crdnr = ac.SupplierNumber AND ci.crdnr IS NOT NULL AND ac.SupplierNumber IS NOT NULL " & vbLf & _
                     "WH%"
        
        ''End - The query generation is move to easzzptran
        
        
        'FC 40.650.140: Enhancement on Asset balance list
        'BR 13.503.562 - make sure query is the same as the one used in eafasal.exe
        'sSQLGroup = " GROUP BY ac.ItemCode, ac.Number, ac.Description, ac.Status, a.purchdate, ac.DateStart, ac.DateEnd, hm.fullname, ac.currqtyunits"
        sSQLGroup = " GROUP BY ac.ItemCode, ac.Number, ac.Description, ac.Status, a.purchdate, ac.DateStart, ac.DateEnd, hm.fullname, ac.currqtyunits, " & vbLf & _
                    " ac.UserDate_03, ac.AssetGroup, ag.descr50_" & goCompany.MultiLang.DefaultIndex & ", ag.AssetAC, ag.DeprBS, ac.Projectnr, ac.CostCenter, ac.CostUnit, wh.warehouse, wh.warehouse_location, ac.ResidualValue"
        sSQLOrder = " ORDER BY ac.Number"
    End If
    
    ''BR20.060.239 - [chee112204] : Not Using fatran which will causing double up amount if change group many time
    ''tanj42445 - 20060607 - BR 19.286.883
    ''Issue: Balance list amount is not correct after asset changing asset group
    ''Solution: Include fatran table to get the old GL data.
    'sSQLSelect = sSQLSelect & vbCrLf _
        & "LEFT OUTER JOIN (SELECT fagrp.assetgroup,  fagrp.DeprBS, fagrp.AssetAC, fatran.assetcode, fatran.artcode " & vbCrLf _
        & "     From fagrp LEFT OUTER JOIN fatran ON fagrp.AssetGroup = fatran.olddataval " & vbCrLf _
        & "     AND fatran.trantype = 'G' AND fatran.valuation = '   3' " & vbCrLf _
        & "     Where Not fatran.assetcode Is Null Or Not fatran.artcode Is Null " & vbCrLf _
        & "     ) ft ON ft.assetcode=ac.Number AND ft.artcode=ac.Itemcode " & vbCrLf
    ''End BR 19.286.883
    ''END - BR20.060.239
    
    
    'BR 13.503.562 - make sure query is the same as the one used in eafasal.exe
                       '" AND (gbk.bal_vw = 'B' OR (gbk.bal_vw = 'W' AND gmt.transsubtype = 'I')) " 'AND gmt.reknr IN (ag.AssetAC, ag.DeprPL, ag.DeprBS)
    sSqlWhere = vbLf & " WHERE ac.Classification = 'F'"
                       
    'Asset Group
    If Not AssetGroup_All Then
        bIsFilter = True
        'BR 14.823.876 - Issue C - Make sure query in this report is same as in balance list in eafasal.exe by remarking the line below
        'sSQLWhere = sSQLWhere & " AND gmt.reknr IN (ag.AssetAC, ag.DeprPL, ag.DeprBS) "
        
        'BR 16.045.792 - Checking the FROM and TO column whether is blank
        If AssetGroup_From <> "" And AssetGroup_To <> "" Then
            sSqlWhere = sSqlWhere & " AND ac.AssetGroup BETWEEN " & EdlConn.LitString(AssetGroup_From) & " AND " & EdlConn.LitString(AssetGroup_To)
        ElseIf AssetGroup_From <> "" Then
            'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
            sSqlWhere = sSqlWhere & " AND ac.AssetGroup >= " & EdlConn.LitString(AssetGroup_From)
        Else
            'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
            sSqlWhere = sSqlWhere & " AND ac.AssetGroup <= " & EdlConn.LitString(AssetGroup_To)
        End If
    End If

    
    'FC 40.650.140: Enhancement on Asset balance list, most of the time have to join to warehouse to show in column details
    Dim strWarehouseClause As String
    ''tanj42445 - 20050712 - BR 15.767.711
    ''Include a subquery to get the warehouse record
    If Not Warehouse_All Then
        bIsFilter = True
''        sSqlWhere = sSqlWhere & " AND gmt.Warehouse = " & EdlConn.LitString(sWarehouse)
        sSqlWhere = sSqlWhere & " AND wh.Warehouse = " & EdlConn.LitString(sWarehouse)
        
'        Dim strWarehouseClause As String
        strWarehouseClause = "INNER JOIN ( " & _
            vbCrLf & "SELECT wh2.facode, wh2.artcode, wh2.warehouse, wh2.warehouse_location " & _
            vbCrLf & "FROM " & _
            vbCrLf & "(SELECT MAX(ID) AS ID, facode, artcode " & _
            vbCrLf & "FROM gbkmut " & _
            vbCrLf & "WHERE facode IS NOT NULL AND artcode IS NOT NULL AND gbkmut.transtype = 'N' " & _
            vbCrLf & "GROUP BY facode, artcode) AS wh1 " & _
            vbCrLf & "INNER JOIN " & _
            vbCrLf & "(SELECT ID, facode, artcode, warehouse, warehouse_location " & _
            vbCrLf & "FROM gbkmut " & _
            vbCrLf & "WHERE facode IS NOT NULL AND artcode IS NOT NULL AND gbkmut.transtype = 'N' " & _
            vbCrLf & ") AS wh2 ON wh1.ID=wh2.ID " & _
            vbCrLf & ") AS wh ON wh.facode=ac.Number AND wh.artcode=ac.ItemCode "
            
        sSQLSelect = Replace(sSQLSelect, "WH%", strWarehouseClause)
    Else
        'FC 40.650.140: Enhancement on Asset balance list
        'sSQLSelect = Replace(sSQLSelect, "WH%", "")
        If goCompany.GetOpt(32) Then
            strWarehouseClause = "LEFT OUTER JOIN ( " & _
                vbCrLf & "SELECT wh2.facode, wh2.artcode, wh2.warehouse, wh2.warehouse_location " & _
                vbCrLf & "FROM " & _
                vbCrLf & "(SELECT MAX(ID) AS ID, facode, artcode " & _
                vbCrLf & "FROM gbkmut " & _
                vbCrLf & "WHERE facode IS NOT NULL AND artcode IS NOT NULL AND gbkmut.transtype = 'N' " & _
                vbCrLf & "GROUP BY facode, artcode) AS wh1 " & _
                vbCrLf & "INNER JOIN " & _
                vbCrLf & "(SELECT ID, facode, artcode, warehouse, warehouse_location " & _
                vbCrLf & "FROM gbkmut " & _
                vbCrLf & "WHERE facode IS NOT NULL AND artcode IS NOT NULL AND gbkmut.transtype = 'N' " & _
                vbCrLf & ") AS wh2 ON wh1.ID=wh2.ID " & _
                vbCrLf & ") AS wh ON wh.facode=ac.Number AND wh.artcode=ac.ItemCode "
        Else
            strWarehouseClause = "LEFT OUTER JOIN ( " & _
                vbCrLf & "SELECT '' AS facode, '' AS artcode, '' AS warehouse, '' AS warehouse_location " & _
                vbCrLf & ") AS wh ON wh.facode=ac.Number AND wh.artcode=ac.ItemCode "
        End If
        sSQLSelect = Replace(sSQLSelect, "WH%", strWarehouseClause)
    End If
    ''End BR 15.767.711
    
    'Cost Center
    'BR 16.045.792 - Checking the FROM and TO column whether is blank
    If Not CostCenter_All Then
        bIsFilter = True
        If CostCenter_From <> "" And CostCenter_To <> "" Then
           sSqlWhere = sSqlWhere & " AND ac.CostCenter BETWEEN " & EdlConn.LitString(CostCenter_From) & " AND " & EdlConn.LitString(CostCenter_To)
        ElseIf CostCenter_From <> "" Then
            'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
           sSqlWhere = sSqlWhere & " AND ac.CostCenter >= " & EdlConn.LitString(CostCenter_From)
        Else
            'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
           sSqlWhere = sSqlWhere & " AND ac.CostCenter <= " & EdlConn.LitString(CostCenter_To)
        End If
    End If
    
    
    'AssetCode
    'BR 16.045.792 - Checking the FROM and TO column whether is blank
    If Not Assetcode_All Then
        bIsFilter = True
        If AssetCode_From <> "" And AssetCode_To <> "" Then
           sSqlWhere = sSqlWhere & " AND ac.Number BETWEEN " & EdlConn.LitString(AssetCode_From) & " AND " & EdlConn.LitString(AssetCode_To)
        ElseIf AssetCode_From <> "" Then
           'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
           sSqlWhere = sSqlWhere & " AND ac.Number >= " & EdlConn.LitString(AssetCode_From)
        Else
          'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
           sSqlWhere = sSqlWhere & " AND ac.Number <= " & EdlConn.LitString(AssetCode_To)
        End If
    End If
    
    
    'ItemCode
    'BR 16.045.792 - Checking the FROM and TO column whether is blank
    If Not Itemcode_All Then
        bIsFilter = True
        If ItemCode_From <> "" And ItemCode_To <> "" Then
           sSqlWhere = sSqlWhere & " AND ac.ItemCode BETWEEN " & EdlConn.LitString(ItemCode_From) & " AND " & EdlConn.LitString(ItemCode_To)
        ElseIf ItemCode_From <> "" Then
          'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
           sSqlWhere = sSqlWhere & " AND ac.ItemCode >= " & EdlConn.LitString(ItemCode_From)
        Else
           'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
           sSqlWhere = sSqlWhere & " AND ac.ItemCode <= " & EdlConn.LitString(ItemCode_To)
        End If
    End If

    If stActive Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'A','G'"
    End If
    If stDepreciated Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'C'"
    End If
    If stSold Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'S'"
    End If
    If stBlocked Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'B'"
    End If
    If stInactive Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'D'"
    End If
    
    ''FC20.144.656[chee112204] - Add 2 more Status
    If stTransfer Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'T'"
    End If
    If stWriteOff Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'W'"
    End If
    ''END - FC20.144.656
    
    ''BR21.692.509[chee112204] - [ISSUE]    : Report show "No data which meets the criteria entered" when no check boxes(Status) are selected
    ''                           [SOLUTION] : Allow user to retrieve all result when they do not select any of the status
    ''                                      : Checking if any Status are selected, the SQL statement need to include the ac.Status
    If Len(sStatus) > 0 Then
       sSqlWhere = sSqlWhere & " AND ac.Status IN (" & sStatus & ")"
    End If
    
    
    ''tanj42445 - 20050809 - FC 16.061.117
    ''New Field Reference Date for filtering
    If Not RefDate_All Then
        sSqlWhere = sSqlWhere & " AND gmt.datum <= " & EdlConn.LitDate(dtRefDate)
    End If
    ''End FC 16.061.117
    
    'FC 40.650.140: Enhancement on Asset balance list
    'Cost unit
    If Not CostUnit_All Then
        bIsFilter = True
        If CostUnit_From <> "" And CostUnit_To <> "" Then
           sSqlWhere = sSqlWhere & " AND ac.CostUnit BETWEEN " & EdlConn.LitString(CostUnit_From) & " AND " & EdlConn.LitString(CostUnit_To)
        ElseIf CostUnit_From <> "" Then
           sSqlWhere = sSqlWhere & " AND ac.CostUnit >= " & EdlConn.LitString(CostUnit_From)
        Else
           sSqlWhere = sSqlWhere & " AND ac.CostUnit <= " & EdlConn.LitString(CostUnit_To)
        End If
    End If
    
    'Asset balance sheet GL
    If Not AssetBS_All Then
        bIsFilter = True
        If AssetBS_From <> "" And AssetBS_To <> "" Then
           sSqlWhere = sSqlWhere & " AND ag.AssetAC BETWEEN " & EdlConn.LitString(AssetBS_From) & " AND " & EdlConn.LitString(AssetBS_To)
        ElseIf AssetBS_From <> "" Then
           sSqlWhere = sSqlWhere & " AND ag.AssetAC >= " & EdlConn.LitString(AssetBS_From)
        Else
           sSqlWhere = sSqlWhere & " AND ag.AssetAC <= " & EdlConn.LitString(AssetBS_To)
        End If
    End If
    
    'Person
    If Not Person_All Then
        sSqlWhere = sSqlWhere & " AND ac.Resource = " & Trim(sPerson)
    End If
    
    If sWorksheet = WORKSHEETFAGRP Then
        'FC 40.650.140: Enhancement on Asset balance list
        'sSQLMain = sSQLSelect & sSqlWhere & vbLf & sSQLGroup & vbLf & sSQLOrder
        sSQLMain = "SELECT X.AssetGroup, X.Reknr, X.[Purchase value], " & vbLf & _
                    "X.PrevYearRevaluation, X.CurrYearRevaluation, X.[Yearly depreciation], X.CurrMonthDepr, X.Credit, X.Balance, X.WriteOff, X.Disposal " & vbLf & _
                    "FROM ( " & vbLf & _
                    sSQLSelect & sSqlWhere & vbLf & sSQLGroup & vbLf & ") X ORDER BY X.AssetGroup"
    Else
        'BR 41.654.489/41.657.975: Refer remark at top
        'BR 41.204.906:
        '   Issue: Assets sold/ written off with book value zero, shows incorrect investment end value and written off investment amount.
        '   Solution: Add checking status to enable showing written off investment amount or disposal investment amount
        'FC 40.650.140: Enhancement on Asset balance list
        ''FC20.702.613[chee112204] : Add X.WriteOff after X.Credit
        'sSQLMain = "SELECT X.Number, X.Description, X.DateStart, X.DateEnd, " & vbLf _
        '    & "X.[Purchase value], X.Revaluation, X.[Yearly depreciation], X.Credit, X.WriteOff, " & vbLf _
        '    & "(CASE WHEN X.Credit > X.[Purchase value] THEN -X.Disposal ELSE X.Disposal END) Disposal, X.Balance, X.FullName " & vbLf _
        '    & "FROM ( " & vbLf _
        '    & sSQLSelect & sSqlWhere & vbLf & sSQLGroup & vbLf & ") X ORDER BY X.Number"
        sSQLMain = " SELECT X.AssetGroup, X.Number, X.Description, X.ItemCode, X.AssetAC, X.DeprBS, X.DateStart, X.DateEnd, X.PurchaseDate, X.AcquisitionDate, X.StatusDescription, " & vbLf & _
                    " X.[Purchase value], (CASE WHEN X.PurchaseDate < " & EdlConn.LitDate(DateSerial(CInt(sFY), 1, 2)) & " AND (X.YearDisposal IS NULL OR X.YearDisposal = " & EdlConn.LitString(sFY) & ") THEN  X.[Purchase value] + X.PrevYearRevaluation ELSE 0 END) AS InvestmentStartYear, " & vbCrLf & _
                    " X.InvestmentEndValue, X.ResidualValue, " & vbLf & _
                    " X.PrevYearRevaluation, X.CurrYearRevaluation, X.[Yearly depreciation], X.CurrMonthDepr, X.Credit, X.Balance, X.WriteOff, " & vbLf & _
                    " (CASE WHEN X.YearDisposal IS NOT NULL AND X.Status = 'W' THEN X.[Purchase value] + X.Revaluation ELSE 0 END) AS WriteOffInvestment, " & vbLf & _
                    " (CASE WHEN X.Credit > X.[Purchase value] THEN -X.Disposal ELSE X.Disposal END) Disposal, " & vbLf & _
                    " (CASE WHEN X.YearDisposal IS NOT NULL AND X.Status = 'S' THEN X.[Purchase value] + X.Revaluation ELSE 0 END) AS DisposalInvestment, " & vbLf & _
                    " X.FullName"
        If dicBalAnalytical.Count > 0 Then
            sSQLMain = sSQLMain & ", " & Join(dicBalAnalytical.Keys, ", ")
        End If
        sSQLMain = sSQLMain & vbLf & _
                    "FROM ( " & vbLf _
                    & sSQLSelect & sSqlWhere & vbLf & sSQLGroup & vbLf & ") X ORDER BY X.Number"
    End If
               
    'Assign SQL query
    ThisWorkbook.Names(QueryCell).RefersToRange.Value = sSQLMain
    
    Set EdlConn = Nothing
    Set clsGeneral = Nothing
    Exit Sub
    
Failed:
    App.Message 0, App.Term.String(0, "Error occurred while creating SQL query!"), App.Term.String(32457, "Asset year end totals"), edlgInfo
    
End Sub

''tanj42445 - Temporary Double Investment Solution
Private Function SpecialCase(ByRef sReturnID As String, ByRef sReturnGUID As String) As String
    Dim sNonAssetGL     As String
    Dim sSelect         As String
    Dim sSqlWhere          As String
    Dim litFrom         As String
    Dim litTo           As String
    Dim vNonAssetGL     As Variant
    Dim vEntryGuid      As Variant
    Dim i               As Long
    Dim j               As Long
    Dim sStatus       As String
    Dim v
    Dim EdlConn As EdlConnection
    Set EdlConn = goCompany
    
    Exit Function
    
    sSelect = "SELECT gmt.reknr FROM ItemNumbers ac " & vbCrLf & _
              "INNER JOIN fagrp fg ON fg.assetgroup = ac.AssetGroup " & vbCrLf & _
              "INNER JOIN gbkmut gmt ON gmt.facode = ac.Number AND gmt.artcode = ac.ItemCode " & vbCrLf & _
              "WHERE gmt.TransactionGuid = ac.TransactionGuid " & vbCrLf & _
              "AND gmt.reknr <> fg.AssetAC "
        
    'Start building where clause. this where clause can be reuse in other select statement
    sSqlWhere = vbLf & " AND ac.Classification = 'F'"
                       
   'Asset Group
    If Not AssetGroup_All Then
        'BR 14.823.876 - Issue C - Make sure query in this report is same as in balance list in eafasal.exe by remarking the line below
        'sSQLWhere = sSQLWhere & " AND gmt.reknr IN (ag.AssetAC, ag.DeprPL, ag.DeprBS) "
        
        'BR 16.045.792 - Checking the FROM and TO column whether is blank
        If AssetGroup_From <> "" And AssetGroup_To <> "" Then
            sSqlWhere = sSqlWhere & " AND ac.AssetGroup BETWEEN " & EdlConn.LitString(AssetGroup_From) & " AND " & EdlConn.LitString(AssetGroup_To)
        ElseIf AssetGroup_From <> "" Then
            'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
            sSqlWhere = sSqlWhere & " AND ac.AssetGroup >= " & EdlConn.LitString(AssetGroup_From)
        Else
            'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
            sSqlWhere = sSqlWhere & " AND ac.AssetGroup <= " & EdlConn.LitString(AssetGroup_To)
        End If
    End If
    
        'WareHouse
    If Not Warehouse_All Then
        sSqlWhere = sSqlWhere & " AND gmt.Warehouse = " & EdlConn.LitString(sWarehouse)
    End If
    
    'Cost Center
    'BR 16.045.792 - Checking the FROM and TO column whether is blank
    If Not CostCenter_All Then
        If CostCenter_From <> "" And CostCenter_To <> "" Then
            sSqlWhere = sSqlWhere & " AND ac.CostCenter BETWEEN " & EdlConn.LitString(CostCenter_From) & " AND " & EdlConn.LitString(CostCenter_To)
        ElseIf CostCenter_From <> "" Then
            'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
            sSqlWhere = sSqlWhere & " AND ac.CostCenter >= " & EdlConn.LitString(CostCenter_From)
        Else
            'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
            sSqlWhere = sSqlWhere & " AND ac.CostCenter <= " & EdlConn.LitString(CostCenter_To)
        End If
    End If
    
    
    'AssetCode
    'BR 16.045.792 - Checking the FROM and TO column whether is blank
    If Not Assetcode_All Then
        If AssetCode_From <> "" And AssetCode_To <> "" Then
            sSqlWhere = sSqlWhere & " AND ac.Number BETWEEN " & EdlConn.LitString(AssetCode_From) & " AND " & EdlConn.LitString(AssetCode_To)
        ElseIf AssetCode_From <> "" Then
            'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
            sSqlWhere = sSqlWhere & " AND ac.Number >= " & EdlConn.LitString(AssetCode_From)
        Else
            'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
            sSqlWhere = sSqlWhere & " AND ac.Number <= " & EdlConn.LitString(AssetCode_To)
        End If
    End If
    
    'Item Code
    'BR 16.045.792 - Checking the FROM and TO column whether is blank
    If Not Itemcode_All Then
        If ItemCode_From <> "" And ItemCode_To <> "" Then
            sSqlWhere = sSqlWhere & " AND ac.ItemCode BETWEEN " & EdlConn.LitString(ItemCode_From) & " AND " & EdlConn.LitString(ItemCode_To)
        ElseIf AssetCode_From <> "" Then
            'BR18.462.157[chee112204] - FROM: Changing comparison operators "=" to ">="
            sSqlWhere = sSqlWhere & " AND ac.ItemCode >= " & EdlConn.LitString(ItemCode_From)
        Else
            'BR18.462.157[chee112204] - TO: Changing comparison operators "=" to "<="
            sSqlWhere = sSqlWhere & " AND ac.ItemCode <= " & EdlConn.LitString(ItemCode_To)
        End If
    End If



   
    
    If stActive Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'A','G'"
    End If
    If stDepreciated Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'C'"
    End If
    If stSold Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'S'"
    End If
    If stBlocked Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'B'"
    End If
    If stInactive Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'D'"
    End If
    
    ''FC20.144.656[chee112204] - Add 2 more Status (Transfer & WriteOff)
    If stTransfer Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'T'"
    End If
    If stWriteOff Then
        If Len(sStatus) > 0 Then sStatus = sStatus & ","
        sStatus = sStatus & "'W'"
    End If
    ''END - FC20.144.656
    
    ''BR21.692.509[chee112204] - [ISSUE]    : Report show "No data which meets the criteria entered" when no check boxes(Status) are selected
    ''                           [SOLUTION] : Allow user to retrieve all result when they do not select any of the status
    ''                                      : Checking if any Status are selected, then SQL statement need to include the ac.Status
    If Len(sStatus) > 0 Then
       sSqlWhere = sSqlWhere & " AND ac.Status IN (" & sStatus & ")"
    End If
    
    sSelect = sSelect & sSqlWhere & " GROUP BY gmt.reknr"
    'Get non-asset GL which used in the original investment entry
    vNonAssetGL = EdlConn.Query(sSelect)
    If Not IsEmpty(vNonAssetGL) Then
        If Not IsArray(vNonAssetGL) Then vNonAssetGL = Array(vNonAssetGL):
        'Get all sublines base on entry guid
        sSelect = "SELECT g.EntryGuid, g.ID, g.reknr, g.facode, g.artcode, g.bdr_hfl FROM " & vbCrLf & _
                  "gbkmut g " & vbCrLf & _
                  "WHERE g.EntryGuid IN (" & vbCrLf
        'Get all entries that booked on asset GL
        sSelect = sSelect & "SELECT gmt.EntryGuid FROM gbkmut gmt " & vbCrLf & _
                  "INNER JOIN ItemNumbers ac ON ac.Number = gmt.facode AND ac.ItemCode = gmt.artcode AND ac.TransactionGuid <> gmt.TransactionGuid " & vbCrLf & _
                  "INNER JOIN fagrp fg ON fg.assetgroup = ac.AssetGroup " & vbCrLf & _
                  "INNER JOIN grtbk gbk ON gbk.reknr = gmt.reknr AND gbk.bal_vw = 'B' " & vbCrLf & _
                  "WHERE gmt.transtype IN ('N','C','P') AND gmt.reknr = fg.AssetAC " & vbCrLf & _
                  "AND gmt.transsubtype NOT IN ('E','I','R','V','B') " & vbCrLf & _
                  sSqlWhere & ")"
        vEntryGuid = EdlConn.Query(sSelect, , edlForce2dim)
        If Not IsEmpty(vEntryGuid) Then
            For i = LBound(vEntryGuid) To UBound(vEntryGuid)
                For j = LBound(vNonAssetGL) To UBound(vNonAssetGL)
                    If vEntryGuid(i, 3) = vNonAssetGL(j) And vEntryGuid(i, 6) < 0 Then
                        If Len(Trim(vEntryGuid(i, 4))) <> 0 Or Len(Trim(vEntryGuid(i, 5))) <> 0 Then
                            sReturnID = sReturnID & "," & vEntryGuid(i, 2)
                        Else
                            sReturnGUID = sReturnGUID & "," & EdlConn.Literal(vEntryGuid(i, 1))
                        End If
                    End If
                Next
            Next
            If Len(sReturnGUID) > 0 Then
                sReturnGUID = " AND gmt.EntryGuid NOT IN (" & Mid(sReturnGUID, 2) & ")"
            Else
                sReturnGUID = ""
            End If
            If Len(sReturnID) > 0 Then
                sReturnID = " OR gmt.ID IN (" & Mid(sReturnID, 2) & ")"
            Else
                sReturnID = ""
            End If
        End If
    End If
End Function

'BR 29.236.652, move the set printer settings here and set resume next when error 1004, "Unable to set the PaperSize property of the PageSetUp class" is hit
Sub PrinterSettings()
On Error GoTo errHandler
    'BR18.779.232[chee112204] : [ISSUE]    - Printersettings did not follow the default printer setting
    '                           [SOLUTION] - Each existing worksheet follow the worksheet(Detail)'s papersize
    Dim xWorksheet As Worksheet
    For Each xWorksheet In ActiveWorkbook.Worksheets
      xWorksheet.PageSetup.PaperSize = CLng(ThisWorkbook.Worksheets(4).PageSetup.PaperSize)
    Next xWorksheet
    'END -  BR18.779.232
    Exit Sub
errHandler:
    If Err.Number = 1004 Then
        Resume Next
    Else
        MsgBox Err.Description
    End If
End Sub

'FC 40.650.140: Enhancement on Asset balance list
Sub InitCol2()
    'group header
    HLABELASSETGRP = "A11"
    HLABELLEDGER = "B11"
    HLABELPURCHVAL = "C11"
    HLABELPREVYEARREVALUATION = "D11"
    HLABELCURRYEARREVALUATION = "E11"
    HLABELCUMDEPRYEARLY = "F11"
    HLABELCURRMONTHDEPR = "G11"
    HLABELCUMDEPR = "H11"
    HLABELBOOKVALUE = "I11"
    HLABELWRITEOFF = "J11"
    HLABELDISPOSAL = "K11"
    
    'balance list header
    HLABELASSETGRP_BL = "A11"
    HLABELASSETCODE_BL = "B11"
    HLABELDESC_BL = "C11"
    HLABELITEMCODE_BL = "D11"
    HLABELASSETBS_BL = "E11"
    HLABELDEPRBS_BL = "F11"
    HLABELSTARTDATE_BL = "G11"
    HLABELENDDATE_BL = "H11"
    HLABELPURCHASEDATE_BL = "I11"
    HLABELACQUISITIONDATE_BL = "J11"
    HLABELSTATUS_BL = "K11"
    HLABELPURCHVAL_BL = "L11"
    HLABELINVESTMENTSTARTYEAR_BL = "M11"
    HLABELINVESTMENTEND_BL = "N11"
    HLABELRESIDUALVALUE_BL = "O11"
    HLABELPREVYEARREVALUATION_BL = "P11"
    HLABELCURRYEARREVALUATION_BL = "Q11"
    HLABELCUMDEPRYEARLY_BL = "R11"
    HLABELCURRMONTHDEPR_BL = "S11"
    HLABELCUMDEPR_BL = "T11"
    HLABELBOOKVALUE_BL = "U11"
    HLABELWRITEOFF_BL = "V11"
    HLABELWRITEOFFINVESTMENT_BL = "W11"
    HLABELDISPOSAL_BL = "X11"
    HLABELDISPOSALINVESTMENT_BL = "Y11"
    HLABELRESOURCE_BL = "Z11"
    HLABELPROJECT_BL = "AA11"
    HLABELCOSTCENTER_BL = "AB11"
    HLABELCOSTUNIT_BL = "AC11"
    HLABELWAREHOUSE_BL = "AD11"
    HLABELWAREHOUSELOCATION_BL = "AE11"
End Sub

Function GetCellValue(sCell As Variant) As String
    Dim iCnt As Integer
    
    GetCellValue = ""

    For iCnt = 1 To Len(CStr(sCell))
        If Mid(sCell, iCnt, 1) Like "[a-zA-Z]" Then
            GetCellValue = GetCellValue & Mid(sCell, iCnt, 1)
        Else
            Exit Function
        End If
    Next
End Function

'FC 40.650.140: Enhancement on Asset balance list. To show analytical value according to license/setting
Sub ShowAnalyticalValue(sWorksheet, lHeaderRow)
    Dim sLastCell As String
    Dim vCells As Variant
    Dim iCnt As Integer
    
    If dicBalAnalytical Is Nothing Then
        Set dicBalAnalytical = New Dictionary
    Else
        dicBalAnalytical.RemoveAll
    End If
    
    'store original propose cells
    vCells = Array(HLABELPROJECT_BL, HLABELCOSTCENTER_BL, HLABELCOSTUNIT_BL, HLABELWAREHOUSE_BL, HLABELWAREHOUSELOCATION_BL)
    
    'init index in cell array and last cell
    iCnt = 0
    sLastCell = LASTCOLUMN_BL
    LASTCOLUMN_BL_VAR = LASTCOLUMN_BL
    
    'project
    If goCompany.GetOpt(280) Then
        sLastCell = GetCellValue(vCells(iCnt))
        dicBalAnalytical.Add "X.Projectnr", Array(sLastCell, sLastCell & lHeaderRow, 15#, App.Term.String(8657, "Project"))
        iCnt = iCnt + 1
    End If
    
    'cost center, cost unit
    If goCompany.GetOpt(50) Then
        sLastCell = GetCellValue(vCells(iCnt))
        dicBalAnalytical.Add "X.CostCenter", Array(sLastCell, sLastCell & lHeaderRow, 15#, App.Term.String(8494, "Cost center"))
        iCnt = iCnt + 1
        
        sLastCell = GetCellValue(vCells(iCnt))
        dicBalAnalytical.Add "X.CostUnit", Array(sLastCell, sLastCell & lHeaderRow, 15#, App.Term.String(1194, "Cost unit"))
        iCnt = iCnt + 1
    End If
    
    'warehouse
    If goCompany.GetOpt(32) Then
        sLastCell = GetCellValue(vCells(iCnt))
        dicBalAnalytical.Add "X.Warehouse", Array(sLastCell, sLastCell & lHeaderRow, 15#, App.Term.String(1391, "Warehouse"))
        iCnt = iCnt + 1
    End If
    
     'warehouse location, check license and also warehouse location setting is turn ON
    If goCompany.GetOpt(34) Then
        On Error GoTo 0
        If goCompany.EvalExpr("[bestel:use_block_locations,b]") Then
            sLastCell = GetCellValue(vCells(iCnt))
            dicBalAnalytical.Add "X.WarehouseLocation", Array(sLastCell, sLastCell & lHeaderRow, 20#, App.Term.String(2585, "Warehouse location"))
        End If
    End If
    
    LASTCOLUMN_BL_VAR = sLastCell
End Sub







' InQuest injected base64 decoded content
' 0CS`@
' :t^~

INQUEST-PP=macro
