Attribute VB_Name = "Classify"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private m_Name As String
Private m_Cnt As Integer
Private m_Values() As Variant

Public Property Get name() As Variant
    name = m_Name
End Property

Public Property Let name(ByVal vNewValue As Variant)
    m_Name = vNewValue
End Property

Public Property Get cnt() As Variant
    cnt = m_Cnt
End Property

Public Sub AddValue(ByVal vNewValue As Variant)
    m_Cnt = m_Cnt + 1
    ReDim Preserve m_Values(1 To m_Cnt)
    m_Values(m_Cnt) = vNewValue
End Sub

Public Property Get Values() As Variant
    Dim i As Long, j As Long
    Dim val() As Variant
    ReDim val(1 To m_Cnt, 1 To 1)
    For i = 1 To m_Cnt
        val(i, 1) = m_Values(i)
    Next i
    Values = val
End Property

Private Sub Class_Initialize()
    m_Cnt = 0
End Sub

Private Sub Class_Terminate()
    ReDim m_Values(0)
End Sub
Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet37"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "mdlCommGrp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' Common Functions
' 2007.01 WZH
'=======================================================

Option Explicit

#If 0 Then '--- moved : 07.2.7 ---
Sub SetDataLabel(ByVal ser As Series, ByVal nameRge As Range, _
                 Optional ByVal fontsize As Integer = 10, _
                 Optional ByVal charcnt As Integer = 32)
    Dim i As Integer
    On Error Resume Next
    ser.ApplyDataLabels Type:= _
            xlDataLabelsShowLabel, AutoText:=True, LegendKey:=False
    ser.DataLabels.Font.Size = fontsize
    For i = 1 To ser.Points.Count
        If getExcelVerNo() < 12 Then
            ser.Points(i).DataLabel.Characters.Text = MidB(nameRge.Range("A1").Offset(i - 1, 0).Value, 1, charcnt)
        Else
            ser.Points(i).DataLabel.Text = MidB(nameRge.Range("A1").Offset(i - 1, 0).Value, 1, charcnt)
        End If
    Next i
    On Error GoTo 0
End Sub

Function SetDict(ByVal strPara As String) As Object
    Dim arys() As String, subarys() As String
    Dim s As String
    Dim i As Integer, j As Integer
    Dim dict As Object
    arys = Split(strPara, "&")
    Set dict = CreateObject("Scripting.dictionary")
    For i = 0 To UBound(arys)
        subarys = Split(arys(i), "=")
        dict(subarys(0)) = subarys(1)
    Next i
    i = 1
    Set SetDict = dict
    Set dict = Nothing
End Function
#End If '--- moved : 07.2.7 ---

Sub SetTicks(ByVal cht As Chart, ByVal strTicks As String)
    Dim i As Integer, j As Integer
    Dim Ticks() As String
    Dim bRevStatus As Boolean
    Dim xSeries As Series
    Dim CateCnt As Integer
    Dim catenum As Integer
    Dim cates() As Integer
    Dim MaxScale As Double, MinScale As Double
    Dim bScreenUpdating As Boolean
    On Error Resume Next
    bScreenUpdating = Application.ScreenUpdating
    Application.ScreenUpdating = False
    bRevStatus = cht.Axes(xlCategory).ReversePlotOrder
    If bRevStatus Then
        cht.Axes(xlCategory).ReversePlotOrder = False
        strTicks = StrReverse(strTicks)
    End If
    Ticks = Split(strTicks, ",")
    catenum = 0
    CateCnt = UBound(Ticks)
    ReDim cates(1 To CateCnt)
    For i = 1 To CateCnt
        catenum = catenum + CInt(Ticks(i - 1))
        cates(i) = CInt(Ticks(i - 1))
        For j = 1 To i - 1
            cates(i) = cates(i) + CInt(Ticks(j - 1))
        Next j
    Next i
    catenum = catenum + CInt(Ticks(CateCnt))
    Set xSeries = cht.SeriesCollection.NewSeries
    xSeries.name = "tick1"
    xSeries.ChartType = xlXYScatterLinesNoMarkers
    cht.Axes(xlValue, xlSecondary).MinimumScale = 0
    cht.Axes(xlValue, xlSecondary).MaximumScale = catenum
    cht.Axes(xlValue, xlSecondary).MinorUnitIsAuto = True
    cht.Axes(xlValue, xlSecondary).MajorUnit = 1
    MaxScale = cht.Axes(xlValue, xlPrimary).MaximumScale
    MinScale = cht.Axes(xlValue, xlPrimary).MinimumScale
    cht.Axes(xlValue, xlPrimary).MaximumScaleIsAuto = False
    cht.Axes(xlValue, xlPrimary).MinimumScaleIsAuto = False
    cht.Axes(xlCategory, xlSecondary).MinimumScale = MinScale
    cht.Axes(xlCategory, xlSecondary).MaximumScale = MaxScale
    xSeries.XValues = "={" & MinScale & "," & MaxScale & "}"
    xSeries.Values = "={" & cates(1) & "," & cates(1) & "}"
    xSeries.Border.ColorIndex = 1
    xSeries.Border.LineStyle = xlDot
    xSeries.Border.Weight = xlThin
    xSeries.MarkerStyle = xlNone
    For i = 2 To CateCnt
        Set xSeries = cht.SeriesCollection.NewSeries
        xSeries.ChartType = xlXYScatterLinesNoMarkers
        xSeries.name = "tick" & i
        xSeries.XValues = "={" & MinScale & "," & MaxScale & "}"
        xSeries.Values = "={" & cates(i) & "," & cates(i) & "}"
        xSeries.Border.ColorIndex = 1
        xSeries.Border.LineStyle = xlDot
        xSeries.Border.Weight = xlThin
        xSeries.MarkerStyle = xlNone
    Next i
    
    cht.Axes(xlValue, xlSecondary).Delete
    cht.Axes(xlCategory, xlSecondary).Delete
    cht.Axes(xlCategory).Select
    cht.Axes(xlCategory).ReversePlotOrder = bRevStatus
    Application.ScreenUpdating = bScreenUpdating
    On Error GoTo 0
End Sub

Attribute VB_Name = "mdlCommPub"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' Common Public
' 2007.1.29 LSQ
'=======================================================
Option Explicit
Option Private Module

'prefix = 'G' : means public used in this file
Public GrgeStr As String
Public GbkName As String
Public GstName As String
Public GrgStr As String

'=== EOF ===

Attribute VB_Name = "mdlDotPlot"
'=======================================================
' Graph for SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_ (DotPlot)
'
' 2008.12.23 WZH
'=======================================================
Option Explicit

Private Const MAXITEMNUM As Integer = 20
Private Const maxCateNum As Integer = 200
Private Const MINCLSSMPNUM As Integer = 2

Private Const ERR_NULLOUT As String = "The output range should not be empty"
Private Const ERR_OVERITEMNUM As String = "The count of items is over "
Private Const ERR_OVERCATENUM As String = "The count of categories is over "
Private Const ERR_NUMDATA As String = "Non-numeric data exists"
Private Const ERR_CLSSMPNUM As String = "The number of sample in each class should be at least "

Type DotPlot_T
    rgeClass As Range
    rgeItem As Range
    RgeOut As Range
    bNewSheet As Boolean
    typeForNoData As Integer
    typeForOut As Integer
    dataMKSize As Integer
    avgMKSize As Integer
    medMKSize As Integer
    typeStdev As Integer
    UniqueCount As Collection
    maxClsCnt As Integer
    minClsCnt As Integer
End Type

Private Function CollectionSort(ByRef oCollection As Collection, Optional bSortAscending As Boolean = True) As Long
    Dim lSort1 As Long, lSort2 As Long
    Dim vTempItem1 As Variant, vTempItem2 As Variant, bSwap As Boolean
    
    On Error GoTo ErrFailed
    For lSort1 = 1 To oCollection.Count - 1
        For lSort2 = lSort1 + 1 To oCollection.Count
            If bSortAscending Then
                If oCollection(lSort1).name > oCollection(lSort2).name Then
                    bSwap = True
                Else
                    bSwap = False
                End If
            Else
                If oCollection(lSort1).name < oCollection(lSort2).name Then
                    bSwap = True
                Else
                    bSwap = False
                End If
            End If
            If bSwap Then
                'Store the items
                If VarType(oCollection(lSort1)) = vbObject Then
                    Set vTempItem1 = oCollection(lSort1)
                Else
                    vTempItem1 = oCollection(lSort1)
                End If
                
                If VarType(oCollection(lSort2)) = vbObject Then
                    Set vTempItem2 = oCollection(lSort2)
                Else
                    vTempItem2 = oCollection(lSort2)
                End If
                
                'Swap the items over
                oCollection.Add vTempItem1, , lSort2
                oCollection.Add vTempItem2, , lSort1
                'Delete the original items
                oCollection.Remove lSort1 + 1
                oCollection.Remove lSort2 + 1
            End If
        Next
    Next
    Exit Function

ErrFailed:
    CollectionSort = Err.Number
    On Error GoTo 0
End Function

Private Sub SetRangeBorder(ByVal rge As Range, _
                                    ByVal leftWgt As XlBorderWeight, _
                                    ByVal topWgt As XlBorderWeight, _
                                    ByVal rightWgt As XlBorderWeight, _
                                    ByVal bottomWgt As XlBorderWeight)
    Dim i As Long
    rge.Borders(xlDiagonalDown).LineStyle = xlNone
    rge.Borders(xlDiagonalUp).LineStyle = xlNone
    With rge.Borders(xlEdgeLeft)
        If leftWgt <> xlNone Then
            .LineStyle = xlContinuous
            .Weight = leftWgt
            .ColorIndex = 1
        Else
            .LineStyle = xlNone
        End If
    End With
    With rge.Borders(xlEdgeTop)
        If topWgt <> xlNone Then
            .LineStyle = xlContinuous
            .Weight = topWgt
            .ColorIndex = 1
        Else
            .LineStyle = xlNone
        End If
    End With
    With rge.Borders(xlEdgeBottom)
        If bottomWgt <> xlNone Then
            .LineStyle = xlContinuous
            .Weight = bottomWgt
            .ColorIndex = 1
        Else
            .LineStyle = xlNone
        End If
    End With
    With rge.Borders(xlEdgeRight)
        If rightWgt <> xlNone Then
            .LineStyle = xlContinuous
            .Weight = rightWgt
            .ColorIndex = 1
        Else
            .LineStyle = xlNone
        End If
    End With
End Sub

'process nonumeric data
Private Sub ProcNoNumeric(ByVal flg As Integer, ByVal rowCnt As Integer, ByVal colcnt As Integer, data As Variant)
    Dim i As Integer, j As Integer
    Dim mdfFlg As Boolean
    For i = 1 To rowCnt
        mdfFlg = False
        For j = 1 To colcnt
            If Not IsNumeric(data(i, j)) Then
                If flg = 1 Then
                    data(i, j) = ""
                Else
                    mdfFlg = True
                    Exit For
                End If
            End If
        Next j
        If mdfFlg Then
            For j = 1 To colcnt
                data(i, j) = ""
            Next j
        End If
    Next i
End Sub

'get category count
Private Function GetUniqueCount(dotPlot As DotPlot_T) As Integer
    Dim rgeClass As Range, rge As Range
    Dim r As Range, o As Range
    Dim t As Integer
    Dim tt As Classify
    Dim maxCnt  As Long, minCnt  As Long
    Dim i As Integer
    
    Set rgeClass = dotPlot.rgeClass
    
    Application.Volatile
    On Error Resume Next
    Set rge = Range(rgeClass(2, 1), rgeClass(rgeClass.Rows.Count, rgeClass.Columns.Count))
    For Each r In rge
        If Trim(CStr(r.Value)) <> vbNullString Then
            Set tt = dotPlot.UniqueCount.Item(CStr(r.Value))
            If tt Is Nothing Then
                Set tt = New Classify
                tt.name = r.Value
                Call tt.AddValue(CInt(r.row - rge.row + 1))
                dotPlot.UniqueCount.Add tt, CStr(r.Value)
            Else
                Call tt.AddValue(CInt(r.row - rge.row + 1))
            End If
            Set tt = Nothing
        End If
    Next
    
    minCnt = dotPlot.UniqueCount(1).cnt
    maxCnt = minCnt
    For i = 2 To dotPlot.UniqueCount.Count
        Set tt = dotPlot.UniqueCount(i)
        If tt.cnt > maxCnt Then maxCnt = tt.cnt
        If tt.cnt < minCnt Then minCnt = tt.cnt
    Next i
    
    dotPlot.maxClsCnt = maxCnt
    dotPlot.minClsCnt = minCnt
    GetUniqueCount = dotPlot.UniqueCount.Count
    Call CollectionSort(dotPlot.UniqueCount)
    On Error GoTo 0
End Function

'check input
Private Function checkData(dotPlot As DotPlot_T) As Boolean
    Dim itemnum As Integer, SmpNum As Integer, minClsCnt As Integer
    Dim newSht As Worksheet
    Dim rge As Range
    If dotPlot.rgeItem Is Nothing Then
       checkData = False
       Exit Function
    End If
    itemnum = dotPlot.rgeItem.Columns.Count
    SmpNum = dotPlot.rgeItem.Rows.Count
    If itemnum > MAXITEMNUM Then
        checkData = False
        Call MsgBox(ERR_OVERITEMNUM & MAXITEMNUM, vbCritical, "Error")
        Exit Function
    End If
    
    Set rge = Range(dotPlot.rgeItem(2, 1), dotPlot.rgeItem(SmpNum, itemnum))
    If dotPlot.typeForNoData = 3 Then
        If Application.WorksheetFunction.Count(rge) <> rge.Rows.Count * rge.Columns.Count Then
            checkData = False
            Call MsgBox(ERR_NUMDATA, vbCritical, "Error")
            Exit Function
        End If
    End If
    If dotPlot.bNewSheet Then
        Set newSht = dotPlot.rgeItem.Worksheet.Parent.Worksheets.Add
        Set dotPlot.RgeOut = newSht.Range("A1")
    ElseIf dotPlot.RgeOut Is Nothing Then
        checkData = False
        Call MsgBox(ERR_NULLOUT, vbCritical, "Error")
        Exit Function
    End If
    If Not dotPlot.rgeClass Is Nothing Then
        Set dotPlot.UniqueCount = New Collection
        itemnum = GetUniqueCount(dotPlot)
        minClsCnt = dotPlot.minClsCnt
        If itemnum > maxCateNum Or minClsCnt < 2 Then
            If dotPlot.bNewSheet Then
                Application.DisplayAlerts = False
                dotPlot.RgeOut.Worksheet.Delete
                dotPlot.rgeItem.Cells(1, 1).Select
                Application.DisplayAlerts = True
            End If
            Set dotPlot.UniqueCount = Nothing
            checkData = False
            If itemnum > maxCateNum Then
                Call MsgBox(ERR_OVERCATENUM & maxCateNum, vbCritical, "Error")
            Else
                Call MsgBox(ERR_CLSSMPNUM & MINCLSSMPNUM, vbCritical, "Error")
            End If
            Exit Function
        End If
    End If
    checkData = True
End Function

'modify series marker
Private Sub SetMarkers(ByVal cht As Chart, dotPlot As DotPlot_T)
    Dim i As Integer, serCnt As Integer, mkCnt As Integer
    Dim ser As Series
    On Error Resume Next
    serCnt = cht.SeriesCollection.Count
    'mkCnt = IIf(dotPlot.typeForOut = 1, 2, IIf(dotPlot.typeForOut = 2, 1, 0))
    For i = 1 To serCnt
        Set ser = cht.SeriesCollection.Item(i)
        If i <= serCnt Then
            ser.MarkerSize = dotPlot.dataMKSize
            ser.Border.LineStyle = xlNone
            With ser
                .MarkerBackgroundColorIndex = 1
                .MarkerForegroundColorIndex = 1
                .MarkerStyle = xlDiamond
                .MarkerSize = 6
                .Border.LineStyle = xlNone
            End With
        Else
            With ser
                .MarkerBackgroundColorIndex = IIf(i = serCnt, 5, 3)
                .MarkerForegroundColorIndex = IIf(i = serCnt, 5, 3)
                .MarkerStyle = xlDiamond
                .MarkerSize = IIf(i = serCnt, dotPlot.medMKSize, dotPlot.avgMKSize)
                .Border.LineStyle = xlNone
            End With
        End If
    Next i
    'For i = 0 To mkCnt - 1
    '    Set ser = cht.SeriesCollection.Item(serCnt - i)
    '    ser.Delete
    'Next i
    On Error GoTo 0
End Sub

Private Function subDotPlot(dotPlot As DotPlot_T) As Range
    If dotPlot.rgeClass Is Nothing Then
        Set subDotPlot = doNoClass(dotPlot)
    Else
        Set subDotPlot = doWithClass(dotPlot)
    End If
End Function

'procedure for data without class item
Private Function doNoClass(dotPlot As DotPlot_T) As Range
    Dim RgeOut As Range, rgeItem As Range
    Dim rge As Range, o As Range, r As Range
    Dim i As Long, j As Long, k As Long
    Dim itemCnt As Long, smpCnt As Long
    Dim data As Variant, itemData As Variant
    
    Set RgeOut = dotPlot.RgeOut
    Set rgeItem = dotPlot.rgeItem
    Set rge = rgeItem.Rows(1)
    Set rgeItem = rgeItem.Worksheet.Range(rgeItem(2, 1), rgeItem(rgeItem.Rows.Count, rgeItem.Columns.Count))
    itemCnt = rgeItem.Columns.Count
    smpCnt = rgeItem.Rows.Count

    itemData = rgeItem.Value
    Call ProcNoNumeric(dotPlot.typeForNoData, smpCnt, itemCnt, itemData)
    
    'RgeOut.Offset(1, 0).Value = "|fffd|f|fffd|[|fffd|^"
    'RgeOut.Offset(smpCnt + 1, 0).Value = "|fffd||fffd||fffd||3d2|l"
    'RgeOut.Offset(smpCnt + 2, 0).Value = "|fffd||fffd||fffd||fffd||fffd|l"
    'RgeOut.Offset(smpCnt + 3, 0).Value = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
    'RgeOut.Offset(smpCnt + 4, 0).Value = "n"
    For i = 1 To itemCnt
        RgeOut.Offset(0, i).Value = rge.Cells(1, i).Value '"Item" & i
        data = rgeItem.Columns(i).Value
        For j = 1 To smpCnt
            data(j, 1) = itemData(j, i)
        Next j
        Range(RgeOut, RgeOut.Offset(smpCnt - 1)).Offset(1, i).Value = data
        'RgeOut.Offset(smpCnt + 1, i).Value = Application.WorksheetFunction.Average(data)
        'RgeOut.Offset(smpCnt + 2, i).Value = Application.WorksheetFunction.Median(data)
        'If dotPlot.typeStdev = 1 Then
        '    RgeOut.Offset(smpCnt + 3, i).Value = Application.WorksheetFunction.StDev(data)
        'Else
        '    RgeOut.Offset(smpCnt + 3, i).Value = Application.WorksheetFunction.StDevP(data)
        'End If
        'RgeOut.Offset(smpCnt + 4, i).Value = Application.WorksheetFunction.Count(data)
        Call SetRangeBorder(RgeOut.Offset(0, i), xlHairline, xlThin, xlHairline, xlThin)
        Call SetRangeBorder(Range(RgeOut.Offset(1, i), RgeOut.Offset(smpCnt, i)), xlHairline, xlThin, xlHairline, xlThin)
        'Call SetRangeBorder(Range(RgeOut.Offset(smpCnt + 1, i), RgeOut.Offset(smpCnt + 4, i)), xlHairline, xlThin, xlHairline, xlThin)
    Next i
    Set doNoClass = Range(RgeOut, RgeOut.Offset(smpCnt, itemCnt))
    Call SetRangeBorder(RgeOut, xlThick, xlThick, xlThin, xlThin)
    'Call SetRangeBorder(Range(RgeOut.Offset(1, 0), RgeOut.Offset(smpCnt, 0)), xlThin, xlThin, xlThin, xlThin)
    'Call SetRangeBorder(Range(RgeOut.Offset(smpCnt + 1, 0), RgeOut.Offset(smpCnt + 4, 0)), xlThin, xlThin, xlThin, xlThin)
    Call SetRangeBorder(doNoClass, xlThick, xlThick, xlThick, xlThick)
End Function

'10.09.27 DZH cmt
'procedure for data with class item
#If 0 Then
Private Function doWithClass(dotPlot As DotPlot_T) As Range
    Dim RgeOut As Range, rgeItem As Range, rgeName As Range
    Dim rge As Range
    Dim r As Range, o As Range
    Dim t As Integer
    Dim tt As Classify, dd As Classify
    Dim val As Variant, data As Variant
    Dim maxCnt As Long
    Dim i As Long, m As Long, k As Long
    
    Set RgeOut = dotPlot.RgeOut
    Set rgeItem = dotPlot.rgeItem
    Set rgeName = rgeItem.Rows(1)
    
    maxCnt = dotPlot.maxClsCnt
    
    Set rge = rgeItem.Worksheet.Range(rgeItem(2, 1), rgeItem(rgeItem.Rows.Count, rgeItem.Columns.Count))
    
    Set o = RgeOut
    'o.Offset(2, 0).Value = "|fffd|f|fffd|[|fffd|^"
    'o.Offset(maxCnt + 2, 0).Value = "|fffd||fffd||fffd||3d2|l"
    'o.Offset(maxCnt + 3, 0).Value = "|fffd||fffd||fffd||fffd||fffd|l"
    'o.Offset(maxCnt + 4, 0).Value = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
    'o.Offset(maxCnt + 5, 0).Value = "n"
    data = rge.Value
    Call ProcNoNumeric(dotPlot.typeForNoData, rge.Rows.Count, rge.Columns.Count, data)
    
    'Call SetRangeBorder(Range(o.Offset(2, 0), o.Offset(maxCnt + 1, 0)), xlThin, xlThin, xlThin, xlThin)
    'Call SetRangeBorder(Range(o.Offset(maxCnt + 2, 0), o.Offset(maxCnt + 5, 0)), xlThin, xlThin, xlThin, xlThin)
    For i = 1 To rge.Columns.Count
        o.Offset(0, 1).Value = rgeName.Cells(1, i) '    data(1, i) '"Item" & i
        For m = 1 To dotPlot.UniqueCount.Count
            Set tt = dotPlot.UniqueCount(m)
            o.Offset(1, m).Value = "|fffd||fffd|" + tt.name + "|fffd|Q"
            Call SetRangeBorder(o.Offset(1, m), xlHairline, xlThin, xlHairline, xlThin)
            'Set dd = New Classify
            val = tt.Values
            For k = 1 To tt.cnt
                o.Offset(k + 1, m).Value = data(val(k, 1), i)
                'Call dd.AddValue((data(val(k, 1), i)))
            Next
            'val = dd.Values
            'o.Offset(maxCnt + 2, m).Value = Application.WorksheetFunction.Average(val)
            'o.Offset(maxCnt + 3, m).Value = Application.WorksheetFunction.Median(val)
            'If dotPlot.typeStdev = 1 Then
            '    o.Offset(maxCnt + 4, m).Value = Application.WorksheetFunction.StDev(val)
            'Else
            '    o.Offset(maxCnt + 4, m).Value = Application.WorksheetFunction.StDevP(val)
            'End If
            'o.Offset(maxCnt + 5, m).Value = dd.cnt
            'Set dd = Nothing
            Call SetRangeBorder(Range(o.Offset(2, m), o.Offset(maxCnt + 1, m)), xlHairline, xlThin, xlHairline, xlThin)
            'Call SetRangeBorder(Range(o.Offset(maxCnt + 2, m), o.Offset(maxCnt + 5, m)), xlHairline, xlThin, xlHairline, xlThin)
        Next m
        Call SetRangeBorder(Range(o.Offset(0, 1), o.Offset(maxCnt + 1, dotPlot.UniqueCount.Count)), xlThin, xlThin, xlThin, xlThin)  '08.12.24 LSQ, old: xlThin, xlThick, xlThin, xlThick
        Set o = o.Offset(0, dotPlot.UniqueCount.Count)
    Next i
    Set doWithClass = Range(RgeOut, RgeOut.Offset(maxCnt + 1, dotPlot.UniqueCount.Count * rge.Columns.Count))
    'Call SetRangeBorder(doWithClass, xlThin, xlThin, xlThin, xlThin) '08.12.24 LSQ, old: xlThick, xlThick, xlThick, xlThick
End Function
#End If

'10.09.27 DZH add
'procedure for data with class item
Private Function doWithClass(dotPlot As DotPlot_T) As Range
    Dim RgeOut As Range, rgeItem As Range, rgeName As Range
    Dim rge As Range
    Dim r As Range, o As Range
    Dim t As Integer
    Dim tt As Classify, dd As Classify
    Dim val As Variant, data As Variant
    Dim maxCnt As Long
    Dim i As Long, m As Long, k As Long, z As Integer
    Dim tmpAry1() As Double
    
    Set RgeOut = dotPlot.RgeOut
    Set rgeItem = dotPlot.rgeItem
    Set rgeName = rgeItem.Rows(1)
    
    maxCnt = dotPlot.maxClsCnt
    
    Set rge = rgeItem.Worksheet.Range(rgeItem(2, 1), rgeItem(rgeItem.Rows.Count, rgeItem.Columns.Count))
    
    Set o = RgeOut
    'o.Offset(2, 0).Value = "|fffd|f|fffd|[|fffd|^"
    'o.Offset(maxCnt + 2, 0).Value = "|fffd||fffd||fffd||3d2|l"
    'o.Offset(maxCnt + 3, 0).Value = "|fffd||fffd||fffd||fffd||fffd|l"
    'o.Offset(maxCnt + 4, 0).Value = "|fffd|W|fffd||fffd||fffd||38d||fffd|"
    'o.Offset(maxCnt + 5, 0).Value = "n"
    data = rge.Value
    Call ProcNoNumeric(dotPlot.typeForNoData, rge.Rows.Count, rge.Columns.Count, data)

    For i = 1 To rge.Columns.Count
        o.Offset(0, 1).Value = rgeName.Cells(1, i) '    data(1, i) '"Item" & i
        z = 1
        For m = 1 To dotPlot.UniqueCount.Count
            Set tt = dotPlot.UniqueCount(m)
            o.Offset(1, m).Value = "|fffd||fffd|" + tt.name + "|fffd|Q"
            
            Call SetRangeBorder(o.Offset(1, m), xlHairline, xlThin, xlHairline, xlThin)
            
            Call SetRangeBorder(o.Offset(1, m + dotPlot.UniqueCount.Count), xlHairline, xlThin, xlHairline, xlThin)
            
            val = tt.Values
            o.Offset(1, m + dotPlot.UniqueCount.Count).Value = 0
         #If 0 Then
            For k = 1 To tt.cnt
                o.Offset(k + 1, m).Value = data(val(k, 1), i)
                o.Offset(k + 1, m + dotPlot.UniqueCount.Count).Value = z
            Next
         #Else
            ReDim tmpAry1(1 To tt.cnt, 1 To 1) As Double
            For k = 1 To tt.cnt
                tmpAry1(k, 1) = data(val(k, 1), i)
            Next
            o.Offset(2, m).Resize(tt.cnt, 1) = tmpAry1
            o.Offset(2, m + dotPlot.UniqueCount.Count).Resize(tt.cnt, 1) = z
         #End If
            z = z + 1
            
            Call SetRangeBorder(Range(o.Offset(2, m), o.Offset(maxCnt + 1, m)), xlHairline, xlThin, xlHairline, xlThin)
            
            Call SetRangeBorder(Range(o.Offset(2, m + dotPlot.UniqueCount.Count), o.Offset(maxCnt + 1, m + dotPlot.UniqueCount.Count)), xlHairline, xlThin, xlHairline, xlThin)
        Next m

        Call SetRangeBorder(Range(o.Offset(0, 1), o.Offset(maxCnt + 1, dotPlot.UniqueCount.Count * 2)), xlThin, xlThin, xlThin, xlThin) '08.12.24 LSQ, old: xlThin, xlThick, xlThin, xlThick

        Set o = o.Offset(0, dotPlot.UniqueCount.Count * 2)
        
    Next i
   
    Set doWithClass = Range(RgeOut, RgeOut.Offset(maxCnt + 1, dotPlot.UniqueCount.Count * 2 * rge.Columns.Count))
   
End Function


'10.09.27 DZh cmt
#If 0 Then
'draw a dot plot
Private Function DrawDotPlot(ByVal rgeGrpOut As Range, ByVal rgeData As Range) As Chart
    Dim cht As Chart
    
    'ThisWorkbook.Worksheets("tmplDotPlot").ChartObjects("grpDotPlot").Copy
    Set cht = Comm_GetTmplGrp(rgeGrpOut, ThisWorkbook.name, "tmplDotPlot", "grpDotPlot")
    'rgeGrpOut.Select
    'ActiveSheet.Paste
    'Set cht = ActiveChart
    Call cht.SetSourceData(rgeData)
    cht.Parent.left = rgeGrpOut.left
    cht.Parent.top = rgeGrpOut.top
    'cht.Parent.Width = rgeGrpOut.Offset(0, 9).Left - rgeGrpOut.Left
    'cht.Parent.Height = rgeGrpOut.Offset(18, 0).Top - rgeGrpOut.Top
    cht.ChartArea.Select
    MatchWorkbookFont
    Set DrawDotPlot = cht
End Function
#End If

'10.09.25 DZH add
'draw a dot plot
'Note: slove the problem that if series's amount over 255  chart can not draw
Private Function DrawDotPlot(ByVal rgeGrpOut As Range, ByVal rgeData As Range) As Chart
    Dim cht As Chart
    
    Dim rowNum As Integer, colNum As Integer
    Dim i As Integer, j As Integer
    Dim tmpRge As Range, rge As Range
    Dim maxNum As Double, minNum As Double
    
    rowNum = rgeData.Rows.Count
    colNum = rgeData.Columns.Count
    
    If colNum Mod 2 = 0 Then
         colNum = colNum / 2
    Else
        MsgBox "Data Range Error"
        Exit Function
    End If
   
    Set rge = rgeData.Offset(1, 0).Resize(rowNum - 1, colNum)
    Set rge = rge.Resize(rowNum - 1, 1)
    
    'copy Chart from Model sheet
    Set cht = Comm_GetTmplGrp(rgeGrpOut, ThisWorkbook.name, "tmplDotPlot", "SR2DotPlot")
    
#If 0 Then 'for 3 or more group use
    If colNum > 2 Then
        For i = 3 To colNum
            cht.SeriesCollection.NewSeries
            cht.SeriesCollection(i + 1).ChartType = xlXYScatter
            ActiveChart.SeriesCollection(i + 1).AxisGroup = 2
        Next
    ElseIf colNum = 1 Then
        cht.SeriesCollection(3).Delete
    End If
#End If
    
    'set bar data range
    With cht.SeriesCollection(1)
        .XValues = rgeData.Resize(1, colNum)
        .Values = rgeData.Offset(0, colNum).Resize(1, colNum)
    End With
    
    'set Dot data range
    For i = 1 To cht.SeriesCollection.Count - 1
        With cht.SeriesCollection(i + 1)
            .XValues = rge.Offset(0, i + colNum - 1)
            .Values = rge.Offset(0, i - 1)
        End With
    Next
    
    'set The fisrt Y-Axes'value = the second Y-Axes's value
    With ActiveChart.Axes(xlValue, xlSecondary)
        .MinimumScaleIsAuto = True
        .MaximumScaleIsAuto = True
        minNum = .MinimumScale
        maxNum = .MaximumScale
    End With
    
    With ActiveChart.Axes(xlValue)
        .MinimumScale = minNum
        .MaximumScale = maxNum
    End With
    
    'for 3 or more group use
     'set The second X-Axes
    'With ActiveChart.Axes(xlCategory)
        '.MajorTickMark = xlNone
        '.MinorTickMark = xlNone
        '.TickLabelPosition = xlLow
    'End With
    
    'set Chart's position
    With cht
        .Parent.left = rgeGrpOut.left
        .Parent.top = rgeGrpOut.top
    End With
    
    cht.ChartArea.Select
    MatchWorkbookFont
    Set DrawDotPlot = cht
End Function

'main entrance for procedure
Public Sub DrawDotPlot_A(ByVal strRgeClass As String, ByVal strRgeItemData As String, ByVal strRgeOut As String, _
                                  ByVal crossAt As Double, Optional ByVal strPara As String = vbNullString)
    Dim dotPlot As DotPlot_T
    Dim rge As Range, rgeGrp As Range
    Dim cht As Chart
    Dim itemCnt As Long, smpCnt As Long
    Dim i As Long, j As Long
    Dim dlg As DialogSheet
    Dim ret As Boolean
    Dim para As Object
    Dim cht_w As Integer, cht_h As Integer
    Dim ChtType As Integer
    
    On Error GoTo DrawDotPlot_err
    Set dotPlot.rgeClass = Range(strRgeClass)
    Set dotPlot.rgeItem = Range(strRgeItemData)
    Set dotPlot.RgeOut = Range(strRgeOut)
    If strPara <> vbNullString Then
        Set para = Comm_SetDict(strPara)
        cht_w = para("Width")
        cht_h = para("Height")
        ChtType = para("ChtType")
    Else
        cht_w = 10
        cht_h = 20
        ChtType = 0
    End If
    dotPlot.bNewSheet = False
    dotPlot.typeForNoData = 1
    dotPlot.typeForOut = 1
    dotPlot.typeStdev = 1
    dotPlot.dataMKSize = 6
    dotPlot.avgMKSize = 6
    dotPlot.medMKSize = 6
    
    If Not checkData(dotPlot) Then
        Exit Sub
    End If
    
    itemCnt = dotPlot.rgeItem.Columns.Count
    Set rgeGrp = dotPlot.RgeOut.Offset(0, itemCnt + 3)
    
    Set rge = subDotPlot(dotPlot)
    If dotPlot.rgeClass Is Nothing Then
        smpCnt = rge.Rows.Count
        Set cht = DrawDotPlot(rgeGrp, Range(rge(1, 2), rge(smpCnt, itemCnt + 1)))
        Call SetMarkers(cht, dotPlot)
    Else
        smpCnt = rge.Rows.Count
        j = (rge.Columns.Count - 1) \ itemCnt
        Set rgeGrp = dotPlot.RgeOut.Offset(0, 1) '08.12.24 LSQ mdf, old = dotPlot.RgeOut
        For i = 1 To itemCnt
            Set cht = DrawDotPlot(rgeGrp, Range(rge(2, 2 + (i - 1) * j), rge(smpCnt, i * j + 1)))
            cht.ChartTitle.Text = dotPlot.rgeItem.Rows(1).Cells(1, i).Text ' "Item" & i
            cht.Axes(xlValue).CrossesAt = crossAt
            Set rgeGrp = rgeGrp.Offset(0, 9)
            Call SetMarkers(cht, dotPlot)
            If ChtType = 1 Then
                cht.Axes(xlCategory).CategoryNames = Array("0", "1")
                With cht.PlotArea.Border
                    .ColorIndex = 1
                    .Weight = xlThin
                    .LineStyle = xlContinuous
                End With
                cht.Axes(xlValue).TickLabels.NumberFormatLocal = "0%"
            End If
        Next i
    End If
    
    Call Comm_setChartPosSize(cht.Parent, dotPlot.RgeOut, cht_h, cht_w)
    
    dotPlot.RgeOut.Select
exit_sub:
    Set dotPlot.UniqueCount = Nothing
    Exit Sub
DrawDotPlot_err:
    Resume exit_sub
End Sub

'=== EOF ===
Attribute VB_Name = "mdlSdsGrp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|SDSKD
' 2007.01 WZH
' 2007.1.29 LSQ mdf
'=======================================================

Option Explicit

Sub nu_DrawSdsCateBar(ByVal strWrkSht As String, _
                   ByVal strGrpOut As String, ByVal strGrpData As String, _
                   ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range, crge As Range
    Dim cht As Chart, serObj As Series
    Dim para As Object
    Dim nAxisNo As Integer
    Dim grpflg As Integer, dataNum As Integer
    Dim i As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    grpflg = CInt(para("GrpFlg"))
    nAxisNo = CInt(para("AxesNo"))
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSDS", "grpCateBar")
    If cht Is Nothing Then
        Exit Sub
    End If
    Set serObj = cht.SeriesCollection(1)
    dataNum = dataRge.Rows.Count
    
    'cht.SetSourceData datarge
    Set xRge = Range(dataRge(1, 1), dataRge(dataNum, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(1, 2), dataRge(dataNum, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If grpflg = 1 Then
        serObj.Interior.ColorIndex = 17
        serObj.Interior.Pattern = xlSolid
    ElseIf grpflg = 2 Then
        serObj.Fill.Patterned Pattern:=msoPatternSmallGrid
        serObj.Fill.Visible = True
        serObj.Fill.ForeColor.SchemeColor = 32
        serObj.Fill.BackColor.SchemeColor = 17
    Else
        Set crge = Range(dataRge(1, 3), dataRge(dataNum, 3))
        For i = 1 To serObj.Points.Count
            If crge(i, 1) = 1 Then
                serObj.Points(i).Interior.ColorIndex = 17
                serObj.Points(i).Interior.Pattern = xlSolid
            Else
                serObj.Points(i).Fill.Patterned Pattern:=msoPatternSmallGrid
                serObj.Points(i).Fill.Visible = True
                serObj.Points(i).Fill.ForeColor.SchemeColor = 32
                serObj.Points(i).Fill.BackColor.SchemeColor = 17
            End If
        Next i
    End If
    cht.ChartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|^" & nAxisNo & "|fffd||fffd|"

    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub nu_DrawSdsCateScore(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart, serObj As Series, pntObj As Point
    Dim xaxis As Integer, yaxis As Integer
    Dim i As Integer
    Dim para As Object
    Dim bFlgCateName As Boolean
    Dim fontsize As Integer, charcnt As Integer
    Dim grpflg As Integer
    Dim nAxisNo As Integer
    Dim dataNumX As Integer, dataNumY As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bFlgCateName = CBool(para("bCateName"))
    xaxis = CInt(para("XAxisNo"))
    yaxis = CInt(para("YAxisNo"))
    fontsize = CInt(para("FontSize"))
    charcnt = CInt(para("CharCnt"))
    grpflg = CInt(para("GrpFlg"))
    dataNumX = CInt(para("XNum"))
    dataNumY = CInt(para("YNum"))
    
    Set para = Nothing
    Set nameRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    Set dataRge = Range(dataRge(1, 2), dataRge(dataRge.Rows.Count, 3))
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSDS", "grpCateScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    Set serObj = cht.SeriesCollection(1)
    
    'cht.SetSourceData datarge
    serObj.name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("B1").Address)
    Set xRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(2, 2), dataRge(dataRge.Rows.Count, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If bFlgCateName Then
        Call Comm_SetDataLabel(serObj, nameRge.Range("A1"), fontsize, charcnt)
    End If
    cht.Axes(xlValue).AxisTitle.Characters.Text = xaxis & "|fffd||fffd|"
    cht.Axes(xlCategory).AxisTitle.Characters.Text = yaxis & "|fffd||fffd|"
    
    If grpflg = 0 Then
    For i = 1 To serObj.Points.Count
        Set pntObj = serObj.Points(i)
        
        If i <= dataNumY Then
            pntObj.MarkerBackgroundColorIndex = xlAutomatic
            pntObj.MarkerForegroundColorIndex = xlAutomatic
            pntObj.MarkerStyle = xlDiamond
        Else
            pntObj.MarkerBackgroundColorIndex = 2
            pntObj.MarkerForegroundColorIndex = 1
            pntObj.MarkerStyle = xlCircle
        End If
    Next i
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSdsCateBar(ByVal strWrkSht As String, _
                   ByVal strGrpOut As String, ByVal strGrpData As String, _
                   ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range, crge As Range
    Dim cht As Chart, srsY As Series, srsX As Series
    Dim para As Object
    Dim nAxisNo As Integer
    Dim grpflg As Integer, dataNum As Integer
    Dim i As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    grpflg = CInt(para("GrpFlg"))
    nAxisNo = CInt(para("AxesNo"))
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSDS", "grpCateBar")
    If cht Is Nothing Then
        Exit Sub
    End If
    Set srsY = cht.SeriesCollection(1)
    Set srsX = cht.SeriesCollection(2)
    
    dataNum = dataRge.Rows.Count
    Set xRge = Range(dataRge(1, 1), dataRge(dataNum, 1))
    Set yRge = xRge.Offset(0, 1)
    
#If 1 Then '10.7.31 LSQ mdf
    If grpflg = 1 Then
        Call setSrsData(srsY, xRge, yRge, "Y")
        srsX.Delete
    ElseIf grpflg = 2 Then
        srsY.Delete
        Set srsX = cht.SeriesCollection(1)
        Call setSrsData(srsX, xRge, yRge, "X")
    Else
        Call setSrsData(srsY, xRge, yRge, "Y")
        Call setSrsData(srsX, xRge, yRge.Offset(0, 1), "X")
    End If
#Else
    'cht.SetSourceData datarge
    Set xRge = Range(dataRge(1, 1), dataRge(dataNum, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(1, 2), dataRge(dataNum, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If grpflg = 1 Then
        serObj.Interior.ColorIndex = 17
        serObj.Interior.Pattern = xlSolid
    ElseIf grpflg = 2 Then
        serObj.Fill.Patterned Pattern:=msoPatternSmallGrid
        serObj.Fill.Visible = True
        serObj.Fill.ForeColor.SchemeColor = 32
        serObj.Fill.BackColor.SchemeColor = 17
    Else
        Set crge = Range(dataRge(1, 3), dataRge(dataNum, 3))
        For i = 1 To serObj.Points.Count
            If crge(i, 1) = 1 Then
                serObj.Points(i).Interior.ColorIndex = 17
                serObj.Points(i).Interior.Pattern = xlSolid
            Else
                serObj.Points(i).Fill.Patterned Pattern:=msoPatternSmallGrid
                serObj.Points(i).Fill.Visible = True
                serObj.Points(i).Fill.ForeColor.SchemeColor = 32
                serObj.Points(i).Fill.BackColor.SchemeColor = 17
            End If
        Next i
    End If
#End If

    cht.ChartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|i" & nAxisNo & "|fffd||fffd||fffd|j"  '10.7.31 LSQ; old : "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|^" & nAxisNo & "|fffd||fffd|"

    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, 18, 7)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub
'
'10.7.31 LSQ add
'
Private Sub setSrsData(ByVal srs As Series, ByVal xRge As Range, ByVal yRge As Range, Optional ByVal srsName As String = "")
    srs.name = srsName
    srs.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    srs.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
End Sub

Sub DrawSdsCateScore(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart, serObj As Series, pntObj As Point
    Dim xaxis As Integer, yaxis As Integer
    Dim i As Integer
    Dim para As Object
    Dim bFlgCateName As Boolean
    Dim fontsize As Integer, charcnt As Integer
    Dim grpflg As Integer
    Dim nAxisNo As Integer
    Dim dataNumX As Integer, dataNumY As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bFlgCateName = CBool(para("bCateName"))
    xaxis = CInt(para("XAxisNo"))
    yaxis = CInt(para("YAxisNo"))
    fontsize = CInt(para("FontSize"))
    charcnt = CInt(para("CharCnt"))
    grpflg = CInt(para("GrpFlg"))
    dataNumX = CInt(para("XNum"))
    dataNumY = CInt(para("YNum"))
    
    Set para = Nothing
    Set nameRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    Set dataRge = Range(dataRge(1, 2), dataRge(dataRge.Rows.Count, 3))
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSDS", "grpCateScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    Set serObj = cht.SeriesCollection(1)
    
    'cht.SetSourceData datarge
    serObj.name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("B1").Address)
    Set xRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(2, 2), dataRge(dataRge.Rows.Count, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If bFlgCateName Then
        Call Comm_SetDataLabel(serObj, nameRge.Range("A1"), fontsize, charcnt)
    End If
    cht.Axes(xlValue).AxisTitle.Characters.Text = xaxis & "|fffd||fffd|"
    cht.Axes(xlCategory).AxisTitle.Characters.Text = yaxis & "|fffd||fffd|"
    
    If grpflg = 0 Then
    For i = 1 To serObj.Points.Count
        Set pntObj = serObj.Points(i)
        
        If i <= dataNumY Then
            pntObj.MarkerBackgroundColorIndex = xlAutomatic
            pntObj.MarkerForegroundColorIndex = xlAutomatic
            pntObj.MarkerStyle = xlDiamond
        Else
            pntObj.MarkerBackgroundColorIndex = 2
            pntObj.MarkerForegroundColorIndex = 1
            pntObj.MarkerStyle = xlCircle
        End If
    Next i
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub


Attribute VB_Name = "mdlSr1Grp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|1|fffd||fffd|
' 2006.12 WZH
' 2007.1.29 LSQ mdf
'=======================================================
Option Explicit

Sub DrawSr1CateScore(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, cateRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim strCates As String
    Dim strCateRge As String

    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    strCates = para("Cates")
    strCateRge = para("CateRge")
    Set cateRge = wrkst.Range(Comm_toXlA1str(strCateRge))
    
    Set dataRge = Union(cateRge, dataRge)
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR1", "grpCateScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    Call SetTicks(cht, strCates)
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr1SmpScore1(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim cht As Chart
    Dim strName As String
    Dim i As Long, rowNum As Long
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim corr As Double
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    strName = para("NameRange")
    bNameDisp = CInt(para("NameDisp"))
    corr = CDbl(para("Cor"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR1", "grpSmpScore1")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.Shapes("relVal").DrawingObject.Caption = "|fffd||fffd||fffd||58c|W|fffd||fffd|=" & corr
    If bNameDisp Then
        Set nameRge = wrkst.Range(Comm_toXlA1str(strName))
        Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("A1"))
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr1SmpScore2(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim cht As Chart
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR1", "grpSmpScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

'=== EOF ===
Attribute VB_Name = "mdlSr2Grp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|2|fffd||fffd|
' 2007.01 WZH
' 2007.1.29 LSQ mdf
'=======================================================

Option Explicit

Sub DrawSr2CateScore1(ByVal strWrkSht As String, _
                      ByVal strGrpOut As String, ByVal strGrpData As String, _
                      ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, xRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim strCates As String
    Dim strXRge As String
    Dim nAxisNo As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    strXRge = para("XRge")
    strCates = para("Cates")
    nAxisNo = CInt(para("AxesNo"))
    
    Set para = Nothing
    
    Set xRge = wrkst.Range(Comm_toXlA1str(strXRge))
    Set dataRge = Union(xRge, dataRge)

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR2", "grpCateScore1")
    If cht Is Nothing Then
        Exit Sub
    End If

    cht.SetSourceData dataRge
    cht.ChartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|O|fffd||fffd||fffd|t|fffd|i" & nAxisNo & "|fffd||fffd||fffd|j"
    Call SetTicks(cht, strCates)
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, IIf(dataRge.Rows.Count < 12, dataRge.Rows.Count + 8, 0))
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr2CateScore2(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                      ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim cht As Chart
    Dim strName As String, strNameX As String, strNameY As String '09.1.30 LSQ
    Dim i As Long, rowNum As Long
    Dim para As Object
    Dim bNameDisp As Boolean
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strName = para("NameRange")
    strNameX = para("AxisXName") '09.1.30 LSQ add
    strNameY = para("AxisYName") '09.1.30 LSQ add
    Set para = Nothing
    Set nameRge = wrkst.Range(toXlA1str(strName))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR2", "grpCateScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.Axes(1).AxisTitle.Caption = strNameX '09.1.30 LSQ add
    cht.Axes(2).AxisTitle.Caption = strNameY '09.1.30 LSQ add
    If bNameDisp Then
        Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("B2"))
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr2SmpScore1(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, xRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim strAxis As String
    Dim strXRge As String
    Dim nAxisNo As Integer
    Dim i As Integer
    Dim colorInx() As Variant
    colorInx = Array(5, 7, 10, 3, 1, 45, 8, 54, 4)
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    nAxisNo = CInt(para("AxesNo"))
    strXRge = para("XRge")
    Set para = Nothing
    
    Set xRge = wrkst.Range(Comm_toXlA1str(strXRge))
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))
    
    Set dataRge = Union(xRge, dataRge)
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR2", "grpSmpScore1")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.SeriesCollection(1).Delete
    'strAxis = Split(strGrpData, ",")(0)
    'Set dataRge = wrkst.Range(toXlA1str(strAxis))
    'Set dataRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    Set dataRge = Range(xRge(2, 1), xRge(xRge.Rows.Count, 1))
    strAxis = Comm_toXlRCstr(dataRge.Address)
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & strAxis
    cht.ChartTitle.Characters.Text = "|fffd||fffd||fffd||283|O|fffd||fffd||fffd|t" & nAxisNo
    
    For i = 1 To cht.SeriesCollection.Count
        With cht.SeriesCollection.Item(i).Border
            .ColorIndex = colorInx((i - 1) Mod 9)
            .Weight = xlThin
            .LineStyle = xlContinuous
        End With
    Next i
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, 20, 10)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr2SmpScore2(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, yRge1 As Range, yRge2 As Range
    Dim cht As Chart
    Dim para As Object
    Dim strAxis As String
    Dim strYRge1 As String
    Dim strYRge2 As String
    Dim i As Integer
    Dim colorInx() As Variant
    colorInx = Array(5, 7, 10, 3, 1, 45, 8, 54, 4)
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    strYRge1 = para("YRge1")
    strYRge2 = para("YRge2")
    Set para = Nothing
    
    Set yRge1 = wrkst.Range(Comm_toXlA1str(strYRge1))
    Set yRge2 = wrkst.Range(Comm_toXlA1str(strYRge2))
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))
    
    Set dataRge = Union(dataRge, yRge1, yRge2)
    
    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR2", "grpSmpScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    cht.SeriesCollection(1).Delete
    strAxis = strGrpData                'Split(strGrpData, ",")(0)
    Set dataRge = wrkst.Range(Comm_toXlA1str(strAxis))
    Set dataRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    strAxis = Comm_toXlRCstr(dataRge.Address)
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & strAxis
    
    For i = 1 To cht.SeriesCollection.Count
        With cht.SeriesCollection.Item(i).Border
            .ColorIndex = colorInx((i - 1) Mod 9)
            .Weight = xlThin
            .LineStyle = xlContinuous
        End With
    Next i
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, 20, 10)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub
'=== EOF ===


Attribute VB_Name = "mdlSr3Grp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|3|fffd||fffd|
' 2007.01 WZH
' 2007.1.29 LSQ mdf
'=======================================================

Option Explicit

'2011.03.16 added
'same as in DLL
Const rowNumGRP As Integer = 17
Const colNumGRP As Integer = 8
'end add

Sub DrawSr3CateBar(ByVal strWrkSht As String, _
                   ByVal strGrpOut As String, ByVal strGrpData As String, _
                   ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart
    Dim para As Object
    Dim nAxisNo As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    nAxisNo = CInt(para("AxesNo"))
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR3-1", "grpCateBar")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    'cht.SetSourceData datarge
    Set xRge = Range(dataRge(1, 1), dataRge(dataRge.Rows.Count, 1))
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(1, 2), dataRge(dataRge.Rows.Count, 2))
    cht.SeriesCollection(1).Values = "='" & GstName & "'!" & ToXlRCStr(yRge.Address)
    cht.ChartTitle.Characters.Text = "|fffd|J|fffd|e|fffd|S|fffd||fffd||fffd|[|fffd|X|fffd|R|fffd|A|fffd|^" & nAxisNo
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge, 20, 10)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3CateScore(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim cht As Chart
    Dim xaxis As String, yaxis As String
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR3-1", "grpCateScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    cht.SetSourceData dataRge
    yaxis = (dataRge(1, 1).Value)
    xaxis = (dataRge(1, 2).Value)
    cht.Axes(xlValue).AxisTitle.Characters.Text = xaxis
    cht.Axes(xlCategory).AxisTitle.Characters.Text = yaxis
    If bNameDisp Then
        Set nameRge = wrkst.Range(Comm_toXlA1str(strNameRge))
        Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("A1"), fontsize, charcnt)
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3SmpScore1(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart
    Dim strAxis As String
    Dim i As Integer, j As Integer
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR3-2", "grpSmpScore1")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    'cht.SetSourceData datarge
    cht.SeriesCollection(1).name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("B1").Address)
    j = CInt(val(dataRge(1, 1)))
    i = CInt(val(dataRge(1, 2)))
    cht.Axes(xlValue).AxisTitle.Characters.Text = i & "|fffd||fffd|"
    cht.Axes(xlCategory).AxisTitle.Characters.Text = j & "|fffd||fffd|"
    
    Set xRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & ToXlRCStr(xRge.Address)
    Set yRge = Range(dataRge(2, 2), dataRge(dataRge.Rows.Count, 2))
    cht.SeriesCollection(1).Values = "='" & GstName & "'!" & ToXlRCStr(yRge.Address)
    If bNameDisp Then
        Set dataRge = wrkst.Range(toXlA1str(strNameRge))
        Call Comm_SetDataLabel(cht.SeriesCollection(1), dataRge.Range("A1"), fontsize, charcnt)
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3SmpScore2(ByVal strWrkSht As String, _
                     ByVal strGrpOut As String, ByVal strGrpData As String, _
                     ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart, serObj As Series
    Dim strAxis As String
    Dim i As Integer, j As Integer
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR3-2", "grpSmpScore2")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    Set serObj = cht.SeriesCollection(1)
    
    'cht.SetSourceData datarge
    serObj.name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("B1").Address)
    j = CInt(val(dataRge(1, 1)))
    i = CInt(val(dataRge(1, 2)))
    cht.Axes(xlValue).AxisTitle.Characters.Text = i & "|fffd||fffd|"
    cht.Axes(xlCategory).AxisTitle.Characters.Text = j & "|fffd||fffd|"
    Set xRge = Range(dataRge(2, 1), dataRge(dataRge.Rows.Count, 1))
    serObj.XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(2, 2), dataRge(dataRge.Rows.Count, 2))
    serObj.Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    If bNameDisp Then
        Set dataRge = wrkst.Range(Comm_toXlA1str(strNameRge))
        Call Comm_SetDataLabel(serObj, dataRge.Range("A1"), fontsize, charcnt)
    End If
    
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

Sub DrawSr3AttrBar(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                   ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, rge As Range, rgeSave As Range
    Dim cht As Chart
    Dim cnt As Integer, iFrom As Integer, i As Integer
    Dim para As Object
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))
    cnt = CInt(para("GrpCnt"))
    iFrom = CInt(para("From"))                              '2011.02.21 added
    Set rge = Range(dataRge(1, 1), dataRge(dataRge.Rows.Count, 2))
    Set rgeSave = outRge '2011.03.16 added
    For i = 1 To cnt
        Set cht = Comm_GetTmplGrp(outRge(i, i), ThisWorkbook.name, "tmplSR3-3", "grpAttrBar")
        If cht Is Nothing Then
            Exit Sub
        End If
        
        cht.SetSourceData rge
        '2009.02.04 mdf
        'cht.Axes(xlValue).AxisTitle.Characters.Text = " " & i & " |fffd||fffd|"
        If iFrom = 0 Then
            cht.ChartTitle.Text = "|fffd||fffd||fffd||fffd||fffd||28f|d|fffd|S|fffd|i|fffd||542c||fffd||fffd|" & i & "|fffd|j"
        Else                                               '2011.02.21 added
            cht.ChartTitle.Text = "|fffd||fffd||fffd||fffd||fffd||28f|d|fffd|S|fffd|i" & i & " |fffd||fffd||fffd|j"
        End If
        cht.Axes(xlValue).HasTitle = False
        'end mdf
        '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
        '2011.03.16 mdf
        'Call Comm_setChartPosSize(cht.Parent, outRge(i, i))
        Call Comm_setChartPosSize(cht.Parent, outRge, rowNumGRP, colNumGRP)
        'end mdf
        cht.ChartArea.Select
        MatchWorkbookFont
        'next data
        '2011.03.16 mdf
        '2011.11.19 reset the data range
        If iFrom = 0 Then
            Set rge = rge.Offset(0, colNumGRP + 1)
        Else
            Set rge = rge.Offset(0, 2)
        End If
        'end 2011.11.19
        Set outRge = outRge.Offset(0, colNumGRP + 1)
        'end mdf
    Next i
    
    '2011.03.16 mdf
    'outRge.Select
    rgeSave.Select
    'end mdf
End Sub

Sub DrawSr3AttrScore(ByVal strWrkSht As String, ByVal strGrpOut As String, _
                     ByVal strGrpData As String, ByVal strPara As String)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, rge As Range, nameRge As Range, rgeSave As Range
    Dim cht As Chart
    Dim strAry() As String
    Dim cnt As Integer, i As Integer, j As Integer
    Dim yaxis As String, xaxis As String
    Dim para As Object
    Dim bNameDisp As Boolean
    Dim strNameRge As String
    Dim charcnt As Integer, fontsize As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    cnt = CInt(para("GrpCnt"))
    bNameDisp = CBool(para("NameDisp"))
    strNameRge = para("NameRange")
    charcnt = CInt(para("CharCnt"))
    fontsize = CInt(para("FontSize"))
    Set para = Nothing
    Set rge = Range(dataRge(1, 1), dataRge(dataRge.Rows.Count, 2))
    Set nameRge = wrkst.Range(Comm_toXlA1str(strNameRge))
    Set rgeSave = outRge    '2011.03.16 added
    For i = 1 To cnt
        Set cht = Comm_GetTmplGrp(outRge(i, i), ThisWorkbook.name, "tmplSR3-3", "grpAttrScore")
        If cht Is Nothing Then
            Exit Sub
        End If
        
        cht.SetSourceData rge
        yaxis = CStr(rge(1, 1))
        xaxis = CStr(rge(1, 2))
        cht.Axes(xlValue).AxisTitle.Characters.Text = xaxis
        cht.Axes(xlCategory).AxisTitle.Characters.Text = yaxis
        If bNameDisp Then
            Call Comm_SetDataLabel(cht.SeriesCollection(1), nameRge.Range("A1"), fontsize, charcnt)
        End If
        '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
        '2011.03.16 mdf
        'Call Comm_setChartPosSize(cht.Parent, outRge(i, i))
        Call Comm_setChartPosSize(cht.Parent, outRge, rowNumGRP, colNumGRP)
        'end mdf
        cht.ChartArea.Select
        MatchWorkbookFont
        'next data
        '2011.03.16 mdf
        'Set rge = rge.Offset(0, 2)
        Set rge = rge.Offset(0, colNumGRP + 1)
        Set outRge = outRge.Offset(0, colNumGRP + 1)
        'end mdf
    Next i
       
    outRge.Select
End Sub
'=== EOF ===




Attribute VB_Name = "mdlSr4Grp"
'=======================================================
' SSS|fffd||fffd||fffd||289||fffd||fffd||fffd||fffd|_Ver2.5
' |fffd||fffd||fffd||289||fffd|4|fffd||fffd|
' 2007.01 WZH
' 2007.1.29 LSQ mdf
'=======================================================

Option Explicit

Sub DrawSr4SmpScore(ByVal strWrkSht As String, _
                    ByVal strGrpOut As String, ByVal strGrpData As String, _
                    ByVal strPara As String, ByVal bCateName As Boolean)
    Dim wrkbk As Workbook
    Dim wrkst As Worksheet
    Dim dataRge As Range, outRge As Range, nameRge As Range
    Dim xRge As Range, yRge As Range
    Dim cht As Chart, serObj As Series, axsVal As Axis, axsCat As Axis
    Dim xaxis As String, yaxis As String
    Dim i As Integer
    Dim para As Object
    Dim fontsize As Integer, charcnt As Integer, dataNum As Integer
    
    'Setting
    On Error Resume Next
    GrgeStr = "'" & strWrkSht & "'!A1"
    Call getRangeInfo(GrgeStr, GbkName, GstName, GrgStr)
    Set wrkbk = Workbooks(GbkName)
    Set wrkst = Workbooks(GbkName).Worksheets(GstName)
    Set para = Comm_SetDict(strPara)
    On Error GoTo 0
    '
    If wrkbk Is Nothing Or wrkst Is Nothing Or para Is Nothing Then
        MsgBox MSG_GRP_DATA_ERR
        Exit Sub
    End If
    
    Set outRge = wrkst.Range(Comm_toXlA1str(strGrpOut))
    Set dataRge = wrkst.Range(Comm_toXlA1str(strGrpData))

    fontsize = CInt(para("FontSize"))
    charcnt = CInt(para("CharCnt"))
    Set para = Nothing

    Set cht = Comm_GetTmplGrp(outRge, ThisWorkbook.name, "tmplSR4", "grpSmpScore")
    If cht Is Nothing Then
        Exit Sub
    End If
    
    Set serObj = cht.SeriesCollection(1)
    Set axsVal = cht.Axes(xlValue)
    Set axsCat = cht.Axes(xlCategory)
    dataNum = dataRge.Rows.Count
    
    'cht.SetSourceData datarge
    cht.SeriesCollection(1).name = "='" & GstName & "'!" & Comm_toXlRCstr(dataRge.Range("C1").Address)
    Set nameRge = Range(dataRge(2, 1), dataRge(dataNum, 1))
    Set xRge = Range(dataRge(2, 2), dataRge(dataNum, 2))
    cht.SeriesCollection(1).XValues = "='" & GstName & "'!" & Comm_toXlRCstr(xRge.Address)
    Set yRge = Range(dataRge(2, 3), dataRge(dataNum, 3))
    cht.SeriesCollection(1).Values = "='" & GstName & "'!" & Comm_toXlRCstr(yRge.Address)
    
    yaxis = CStr(dataRge(1, 2))
    xaxis = CStr(dataRge(1, 3))
    axsVal.HasTitle = True
    axsCat.HasTitle = True
    axsVal.AxisTitle.Characters.Text = xaxis
    axsCat.AxisTitle.Characters.Text = yaxis
    axsVal.AxisTitle.left = 12
    axsVal.AxisTitle.top = 1
    axsVal.AxisTitle.Orientation = xlHorizontal
    If bCateName Then
        Call Comm_SetDataLabel(serObj, nameRge.Range("A1"), fontsize, charcnt)
    Else
        cht.SeriesCollection(1).DataLabels.Delete
    End If
    '|fffd|}|fffd||308||292|u|fffd||183|T|fffd|C|fffd|Y
    Call Comm_setChartPosSize(cht.Parent, outRge)
    
    cht.ChartArea.Select
    MatchWorkbookFont
    
    outRge.Select
End Sub

' InQuest injected base64 decoded content
' ZrH+

INQUEST-PP=macro
