Attribute VB_Name = "Module1"
Public Fname As String
Public ExName As String  '--|fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||fffd||fffd||fffd|Excel|fffd||fffd||fffd||fffd|
Public strURL As String
Public strPath As String

Const ConstUrl As String = "http://naikan-test.tg-group.tokyo-gas.co.jp/bui/"
''Const ConstUrl As String = "http://naikantest/BUI"
'Const ConstUrl As String = "http://10.129.153.163/BUI/"    '--  |fffd|e|fffd|X|fffd|g|fffd|pURL
'Const ConstUrl As String = "http://rp20-web.infoserver.tokyo-gas.co.jp/BUI/"    '--  |fffd|{|fffd||517|pURL

Private Declare Function GdiplusStartup Lib "gdiplus" ( _
        ByRef token As Long, _
        ByRef inputBuf As GdiplusStartupInput, _
        ByVal outputBuf As Long) As Long
Private Declare Sub GdiplusShutdown Lib "gdiplus" ( _
        ByVal token As Long)
Private Declare Function GdipLoadImageFromFile Lib "gdiplus" ( _
        ByVal FileName As Long, _
        ByRef image As Long) As Long
Private Declare Function GdipGetImageDimension Lib "gdiplus" ( _
        ByVal image As Long, _
        ByRef Width As Single, _
        ByRef Height As Single) As Long
    
Private Type GdiplusStartupInput
        GdiplusVersion           As Long
        DebugEventCallback       As Long
        SuppressBackgroundThread As Long
        SuppressExternalCodecs   As Long
End Type

Private Declare PtrSafe Function URLDownloadToFile Lib "urlmon" Alias "URLDownloadToFileA" _
   (ByVal pCaller As Long, _
    ByVal szURL As String, _
    ByVal szFileName As String, _
    ByVal dwReserved As Long, _
    ByVal lpfnCB As Long) As Long
 
' // |fffd||645c||fffd||315||fffd||fffd||18d||fffd||fffd||fffd||fffd||fffd||fffd|s|fffd|N|fffd|Z|fffd||fffd||fffd||14e||64fe||fffd||fffd||fffd||fffd|
Public Function GetImageDimensionFromFile( _
    ByVal sImageFilePath As String, _
    ByRef x As Long, _
    ByRef y As Long _
) As Boolean

    '@ |fffd||389||fffd||fffd|t|fffd|H|fffd|[|fffd|}|fffd|b|fffd|g : BMP, JPG, GIF, TIF, PNG,

    Dim uGdiStartupInput As GdiplusStartupInput
    Dim nGdiToken        As Long
    Dim nStatus          As Long
    Dim hImage           As Long
    Dim xx               As Single
    Dim yy               As Single
  
    x = 0: y = 0
    With uGdiStartupInput
        .GdiplusVersion = 1
    End With
    nStatus = GdiplusStartup(nGdiToken, uGdiStartupInput, 0&)
    If nStatus = 0 Then
       nStatus = GdipLoadImageFromFile(ByVal StrPtr(sImageFilePath), _
                                       hImage)
       If nStatus = 0 Then
          nStatus = GdipGetImageDimension(hImage, xx, yy)
          If nStatus = 0 Then
             GetImageDimensionFromFile = True
             x = xx
             y = yy
          End If
       End If
        Call GdiplusShutdown(nGdiToken)
    End If

End Function

Sub Auto_Open()
Dim lngRes As Long
Dim strFname As String
    Sheets("|fffd||fffd|\|fffd||fffd|").Select
    strPath = ThisWorkbook.Path & "\|fffd||fffd||18e||fffd|.bui"
    ExName = ActiveWorkbook.Name
    '-- |fffd||fffd||18e||fffd|.bui|fffd||303|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd||24e||408||fffd|no|fffd||fffd||fffd||fffd||182||fffd|
    strFname = Mid(ActiveWorkbook.Name, 1, 7) & "|fffd||fffd||18e||fffd|.bui"
    'strFname = "|fffd||fffd||18e||fffd|.bui"
    'strURL = "http://10.129.153.163/BUI/sagyosya/" & strFname
    strURL = ConstUrl & "sagyosya/" & strFname
    
    lngRes = URLDownloadToFile(0, strURL, strPath, 0, 0)
    If lngRes = 0 Then
        Call main
    Else
        MsgBox ("|fffd||fffd||18e||483|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B" & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    End If
End Sub

'==============================================================================================
Function main() As Long
    On Error GoTo Exit_function
    
    Dim sagyosya, List As String
    Dim parm1, parm2, parm3, parm4, parm5, parm6, parm7, parm8, parm9, parm10, parm11, parm12, parm13, parm14 As String
    Dim parm As Variant
    Dim i As Integer
    
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False

    
    ThisWorkbook.Activate
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Select
    Cells.Select
    Selection.Delete Shift:=xlUp


'   |fffd||c42c||fffd||fffd||18e||fffd|Text|fffd||fffd|Open
    Fname = ThisWorkbook.Path & "\|fffd||fffd||18e||fffd|.bui"
    Workbooks.OpenText FileName:=Fname, _
        StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, Comma:=True, Space:=False, Other:=False, _
        FieldInfo:=Array(Array(1, 2), _
        Array(2, 2), Array(3, 2), Array(4, 2), Array(5, 2), Array(6, 2), Array(7, 2), Array(8, 2), _
        Array(9, 2), Array(10, 2), Array(11, 2), Array(12, 2), Array(13, 2), Array(14, 2)), TrailingMinusNumbers:=True
        
    sagyosya = Format(Cells(1, 1), "0000000")
    List = Cells(1, 2)
    parm1 = Cells(1, 3)
    parm2 = Cells(1, 4)
    parm3 = Cells(1, 5)
    parm4 = Cells(1, 6)
    parm5 = Cells(1, 7)
    parm6 = Cells(1, 8)
    parm7 = Cells(1, 9)
    parm8 = Cells(1, 10)
    parm9 = Cells(1, 11)
    parm10 = Cells(1, 12)
    parm11 = Cells(1, 13)
    parm12 = Cells(1, 14)
    parm13 = Cells(1, 15)
    parm14 = Cells(1, 16)
'-------------
    Select Case List
        Case "1"
            Call Kensaku(sagyosya, parm1, parm2, parm3, parm4, parm5, parm6, parm7, parm8, parm9, parm10, parm11, parm12, parm13, parm14)
        Case "2"
            Call Kanri(sagyosya, parm1, parm2, parm3, parm4, parm5, parm6, parm7, parm8, parm9, parm10)
        Case "3"
            Call SessyoIrai(sagyosya, parm1)
        Case "4"
            Call SekkeiIrai(sagyosya, parm1)
        Case "5"
            Call GyomuIrai(sagyosya, parm1, parm2, parm3)
        Case "6"
            Call RpmachingList(sagyosya, parm1, parm2, parm3, parm4, parm5, parm6, parm7, parm8)
        Case "7"
            Call Oukyu(sagyosya, parm1, parm2, parm3)
        Case Else
    End Select
    main = 0


'   |fffd||fffd||18e||482||fffd|Close
    Workbooks("|fffd||fffd||18e||fffd|.bui").Activate
    ActiveWorkbook.Saved = False
    ActiveWorkbook.Close
'   |fffd||fffd||18e||482||30d||d3dc|
    Fname = ThisWorkbook.Path & "\|fffd||fffd||18e||fffd|.bui"
    Kill Fname
    
    ThisWorkbook.Activate
    ActiveWorkbook.Saved = False
    ActiveWorkbook.Close
    Application.DisplayAlerts = True
    
    Application.ScreenUpdating = True
    
    Exit Function

Exit_function:
    MsgBox ("|fffd||fffd||fffd|[|fffd||30d||c42c||fffd||24e||fffd||fffd|s|fffd||fffd||fffd||702||fffd||fffd||fffd||fffd|B" & Err.Number & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    main = Err.Number
End Function

'----------------------------------------
'---  |fffd||fffd||fffd||fffd||fffd||fffd||fffd||282||30d||c42c|
'----------------------------------------

Public Sub Kensaku(syainno, jigyosyo, inpkbn, KeyDate, TatemonoNo, sessyokekka, Gyosei, Tyomei, Banchi, SeSyozoku, SeTanto, SkSyozoku, SkTanto, galileo, Tenken)
    Dim Mrow, Mcol As Long
    Dim Fname As String

    strPath = ThisWorkbook.Path & "\" & syainno & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.bui"
    strURL = ConstUrl & "Kensaku/" & syainno & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.bui"
    
    lngRes = URLDownloadToFile(0, strURL, strPath, 0, 0)
    If lngRes <> 0 Then
        MsgBox ("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||282||fffd||fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B" & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    End If

    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|Text|fffd||fffd|Open
    Fname = ThisWorkbook.Path & "\" & syainno & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.bui"
    Workbooks.OpenText FileName:=Fname, _
        Origin:=932, StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, _
        Comma:=True, Space:=False, Other:=False, FieldInfo:=Array(Array(1, 1), _
        Array(2, 1), Array(3, 1), Array(4, 1), Array(5, 2), Array(6, 1), Array(7, 1), Array(8, 1), _
        Array(9, 1), Array(10, 1), Array(11, 1), Array(12, 1)), TrailingMinusNumbers:=True
    Selection.CurrentRegion.Select
    Selection.NumberFormatLocal = "@"
    Selection.Copy
    
           
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||283|V|fffd|[|fffd|g|fffd||243|R|fffd|s|fffd|[|fffd|A|fffd||48f|W|fffd||fffd||250|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    ThisWorkbook.Activate
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Select
    Cells(1, 1).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Selection.NumberFormatLocal = "@"

'   |fffd|r|fffd||fffd|
    Cells.Select
    Cells.EntireColumn.AutoFit
    
    Selection.CurrentRegion.Select
    Selection.Borders.LineStyle = True                                          '|fffd|r|fffd||fffd|
    
    
'   |fffd||fffd||fffd|o|fffd||fffd||fffd||fffd|
    Rows("1:1").Select
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("A1").Select
    Cells(1, 1) = "|fffd||fffd||fffd|_|fffd||fffd|" & jigyosyo & "|fffd|@|fffd|@|fffd||fffd||10e||fffd||781||fffd|" & inpkbn & "  |fffd||fffd||fffd|p|fffd||fffd||fffd||fffd|" & KeyDate & "|fffd|@|fffd|@|fffd||150|V|fffd||70f||54c||fffd||fffd||281||fffd|" & sessyokekka & "|fffd|@|fffd|@|fffd||fffd||fffd||fffd||fffd||50d||fffd||fffd||fffd|" & TatemonoNo & _
                  "|fffd|@|fffd|s|fffd||fffd||fffd||fffd||6041|" & Gyosei & "|fffd|@|fffd||fffd||fffd||fffd||fffd||fffd|" & Tyomei & "|fffd|@|fffd||fffd||fffd||681||fffd|" & Banchi & _
                  "|fffd|@|fffd||fffd||fffd|S|fffd||70f||54e||48f||fffd||fffd||fffd||fffd||fffd|" & SeSyozoku & "|fffd|@|fffd||fffd||fffd|S|fffd||70f||54e||481||fffd|" & SeTanto & "|fffd|@|fffd||fffd||fffd|S|fffd||74c|v|fffd||48f||fffd||fffd||fffd||fffd||fffd|" & SkSyozoku & "|fffd|@|fffd||fffd||fffd|S|fffd||74c|v|fffd||481||fffd|" & SkTanto & "|fffd|@GALILEO|fffd|H|fffd||fffd||fffd||50d||fffd||fffd||fffd|" & galileo

'   |fffd||1c2||74d||fffd||fffd||42f8c||fffd||fffd||fffd||fffd||fffd||fffd||282||fffd|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Copy

'   |fffd|V|fffd|KBook|fffd||315||6d1||fffd||fffd||fffd|Close
    Fname = ThisWorkbook.Path & "\" & syainno & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.xls"
    ActiveWorkbook.SaveAs FileName:=Fname, FileFormat:=xlExcel8
    ActiveWorkbook.Saved = True
    'ActiveWorkbook.Close
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||282||313||fffd||fffd||343|t|fffd|@|fffd|C|fffd||fffd||fffd||303|N|fffd||fffd||fffd|[|fffd|Y
    Windows(syainno & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.bui").Activate
    ActiveWorkbook.Close
    Kill strPath
    
End Sub


'----------------------------------------
'---  |fffd||1d7||fffd||fffd|\|fffd||30d||c42c|
'----------------------------------------

Public Sub Kanri(syainno, jigyosyo, inpkbn, keyYmd_from_to, _
                 sessyousya_syozoku, sessyousya_nm, _
                 sekkei_syozoku, sekkei_nm, kikan_from_to, kikankbn, keizoku)
Dim i As Integer
Dim kikan As String
    
    strPath = ThisWorkbook.Path & "\" & syainno & "|fffd||1d7||fffd||fffd|\.bui"
    strURL = ConstUrl & "kanri/" & syainno & "|fffd||1d7||fffd||fffd|\.bui"
    
    lngRes = URLDownloadToFile(0, strURL, strPath, 0, 0)
    If lngRes <> 0 Then
        MsgBox ("|fffd||fffd||18e||483|t|fffd|@|fffd|C|fffd||fffd||fffd||fffd||fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B" & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    End If

'   |fffd||1d7||fffd||fffd|\Text|fffd||fffd|Open
    Fname = ThisWorkbook.Path & "\" & syainno & "|fffd||1d7||fffd||fffd|\.bui"
    Workbooks.OpenText FileName:=Fname, _
        Origin:=932, StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, _
        Comma:=True, Space:=False, Other:=False, FieldInfo:=Array(Array(1, 1), _
        Array(2, 1), Array(3, 1), Array(4, 1), Array(5, 1), Array(6, 2), Array(7, 1), Array(8, 1), _
        Array(9, 1), Array(10, 1), Array(11, 1), Array(12, 1), Array(13, 1), Array(14, 1), Array(15 _
        , 1), Array(16, 1), Array(17, 1), Array(18, 1), Array(19, 1), Array(20, 1), Array(21, 1), _
        Array(22, 1), Array(23, 1), Array(24, 1), Array(25, 1), Array(26, 1), Array(27, 1), Array( _
        28, 1), Array(29, 1), Array(30, 1), Array(31, 1), Array(32, 1), Array(33, 1), Array(34, 1), _
        Array(35, 1), Array(36, 1), Array(37, 1), Array(38, 1), Array(39, 1), Array(40, 1), Array( _
        41, 1), Array(42, 1), Array(43, 1), Array(44, 1), Array(45, 1), Array(46, 1), Array(47, 1), _
        Array(48, 1), Array(49, 1), Array(50, 1), Array(51, 1), Array(52, 1), Array(53, 1), Array( _
        54, 1), Array(55, 1), Array(56, 1), Array(57, 1), Array(58, 1), Array(59, 1), Array(60, 1), _
        Array(61, 1), Array(62, 1), Array(63, 1), Array(64, 1), Array(65, 1), Array(66, 1), Array( _
        67, 1), Array(68, 1), Array(69, 1), Array(70, 1), Array(71, 1), Array(72, 1), Array(73, 1)), _
        TrailingMinusNumbers:=True
    
    Selection.CurrentRegion.Select
    Selection.NumberFormatLocal = "@"
    Selection.Copy
    
           
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||283|V|fffd|[|fffd|g|fffd||243|R|fffd|s|fffd|[|fffd|A|fffd||48f|W|fffd||fffd||250|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    ThisWorkbook.Activate
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Select
    Cells(1, 1).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Selection.NumberFormatLocal = "@"

'   |fffd||55752||fffd||fffd||fffd|
    Cells.Select
    Cells.EntireColumn.AutoFit
    
'   |fffd||fffd||fffd||fffd||fffd||fffd|E|fffd||fffd|
    Range("CF:CF, CV:CW").Select                            '|fffd||fffd||10b||fffd||fffd|z,|fffd||fffd||fffd||fffd||fffd||fffd||fffd||3cb||fffd||fffd|z,|fffd|o|fffd||fffd||fffd||fffd||fffd||fffd||fffd||3cb||fffd||fffd|z
    With Selection
        .HorizontalAlignment = xlRight
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .Style = "Comma [0]"
    End With
    
    Range("K:N").Select                                     '|fffd||fffd||110||fffd|,|fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd||fffd|,|fffd|H|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    With Selection
        .HorizontalAlignment = xlRight
    End With
   
    Range("CZ:CZ,DB:DC,DE:DE,DH:DI").Select                 '|fffd||fffd||fffd||fffd||70f||553||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd||113||fffd||fffd||fffd|,|fffd||fffd||109||fffd|,|fffd||fffd||fffd||50b16||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||57390||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||57390||fffd||fffd||fffd||fffd||fffd|
    With Selection
        .HorizontalAlignment = xlRight
        .WrapText = False
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
    End With
'   1|fffd|s|fffd||68d||fffd||fffd||fffd|
    Rows("1:1").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .Orientation = 0
        .AddIndent = False
        .IndentLevel = 0
        .ShrinkToFit = False
        .ReadingOrder = xlContext
        .MergeCells = False
    End With
    
'   |fffd|r|fffd||fffd|
    Selection.CurrentRegion.Select
    Selection.Borders.LineStyle = True                                          '|fffd|r|fffd||fffd|
    
    
'   |fffd||fffd||fffd|o|fffd||fffd||fffd||fffd|
    Rows("1:2").Select
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    If keizoku <> "" Then
        Range("A1") = "|fffd||fffd||fffd|_|fffd||fffd|" & jigyosyo & "|fffd|@|fffd|@|fffd||fffd||fffd|p|fffd||fffd||fffd||fffd|" & keyYmd_from_to
    Else
    
        i = InStr(keyYmd_from_to, "|fffd|N|fffd|x")
        If i = 0 Then
            Select Case kikankbn
                Case "1":  kikan = "    |fffd||70f||553||fffd||fffd||fffd|" & kikan_from_to
                Case "2":  kikan = "    |fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & kikan_from_to
                Case "3":  kikan = "    |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & kikan_from_to
            End Select
            Range("A1") = "|fffd||fffd||fffd|_|fffd||fffd|" & jigyosyo & "|fffd|@|fffd|@|fffd||fffd||10e||fffd||781||fffd|" & inpkbn & "|fffd|@|fffd|@|fffd||fffd||fffd|p|fffd||fffd||fffd||fffd|" & keyYmd_from_to & _
                          "|fffd|@|fffd|@|fffd||fffd||fffd|S|fffd||70f||54e||48f||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & sessyousya_syozoku & "    |fffd||fffd||fffd|S|fffd||70f||54e||496||fffd||fffd||fffd|" & sessyousya_nm & _
                          "    |fffd||fffd||fffd|S|fffd||74c|v|fffd||48f||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & sekkei_syozoku & "    |fffd||fffd||fffd|S|fffd||74c|v|fffd||496||fffd||fffd||fffd|" & sekkei_nm & kikan
        Else
            Range("A1") = "|fffd||fffd||fffd|_|fffd||fffd|" & jigyosyo & "|fffd|@|fffd|@|fffd||fffd||10e||fffd||781||fffd|" & inpkbn & "|fffd|@|fffd|@" & keyYmd_from_to
        End If
    End If
    
    '-- BM|fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd|N|fffd|x|fffd||695|W|fffd||38f||6c2||302||182||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||cbd41|E|fffd||70f||54c||fffd||fffd||281|E|fffd|{|fffd|H|fffd||fffd||fffd||fffd||fffd||fffd||fffd|E|fffd||fffd||fffd|H|fffd||fffd||fffd|E|fffd||fffd||fffd||fffd||fffd||fffd||fffd||30c||fffd||fffd|o|fffd||fffd||fffd|F|fffd|t
    If InStr(Range("A1"), "|fffd||695|W|fffd|N|fffd|x") > 0 Then
        Range("J3,CG3,CQ3:CS3").Interior.Color = 65535
    End If
    
    Range("A2") = Format(Date, "yyyy/mm/dd") & "|fffd||c42c|"
    Range("AF2:AP2").Merge:     Range("AF2") = "BM|fffd||fffd||fffd|P|fffd||fffd||10f||fffd||fffd|"
    Range("AQ2:BK2").Merge:     Range("AQ2") = "|fffd||fffd||fffd||295||281|^|fffd||fffd||fffd||311||fffd||fffd||fffd||fffd|P|fffd||fffd||10f||fffd||fffd|"
    Range("BL2:BT2").Merge:     Range("BL2") = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|P|fffd||fffd||10f||fffd||fffd|"
    Range("BU2:CN2").Merge:     Range("BU2") = "|fffd||70f||54c|o|fffd||7cf||fffd||fffd|"
    Range("CO2:CX2").Merge:     Range("CO2") = "GALILEO|fffd|H|fffd||fffd||fffd||fffd||fffd|i|fffd||fffd||fffd||513||fffd||fffd||142||30d||151||fffd||fffd|GALILEO|fffd|H|fffd||fffd||fffd||50d||fffd||fffd|j"
    Range("AF2:CX2").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlBottom
    End With
    Selection.Borders.LineStyle = True                                          '|fffd|r|fffd||fffd|
    
    
    '|fffd||fffd||fffd||fffd||fffd||317||55742||fffd||fffd|w|fffd||fffd|
    Columns("AP:AP").ColumnWidth = 50
    Columns("BF:BF").ColumnWidth = 50
    Columns("BT:BT").ColumnWidth = 50
    Columns("BL:BM").ColumnWidth = 50
    Columns("CN:CN").ColumnWidth = 50
    Columns("AP:AO").WrapText = True
    Columns("BF:BF").WrapText = True
    Columns("BT:BT").WrapText = True
    Columns("BL:BM").WrapText = True
    Columns("CN:CN").WrapText = True

    Range("N3") = "|fffd|H|fffd||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd||fffd||fffd|"
    Range("X3") = "|fffd||70f||548||2d7||fffd||fffd||fffd|" & vbCrLf & "|fffd||fffd||fffd|s|fffd||fffd|"
    Range("Y3") = "|fffd||70f||548||2d7||fffd||fffd||fffd|" & vbCrLf & "|fffd|[|fffd|i|fffd||fffd|"
    Range("Z3") = "|fffd||74c|v|fffd||2d7||fffd||fffd||fffd|" & vbCrLf & "|fffd||fffd||fffd|s|fffd||fffd|"
    Range("AA3") = "|fffd||74c|v|fffd||2d7||fffd||fffd||fffd|" & vbCrLf & "|fffd|[|fffd|i|fffd||fffd|"
    Range("AD3") = "|fffd|@|fffd||fffd|K|fffd||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd||fffd|N|fffd||fffd|"
    Columns("X:X").ColumnWidth = 13
    Columns("Y:Y").ColumnWidth = 11
    Columns("Z:Z").ColumnWidth = 11
    Columns("AA:AA").ColumnWidth = 11
    Columns("AD:AD").ColumnWidth = 9
   
    
    Range("AK3") = "|fffd||fffd||fffd||4cf||fffd|" & vbCrLf & "|fffd|s|fffd||fffd|"
    Columns("AK:AK").ColumnWidth = 8
    Range("AR3") = "|fffd||fffd||fffd||1cf||fffd||fffd|" & vbCrLf & "|fffd||2d7||fffd||fffd||fffd|" & vbCrLf & "(|fffd||fffd||fffd||295||282||302||fffd|)"
    Range("AT3") = "|fffd|_|fffd||fffd||fffd||48f||fffd||fffd||fffd|" & vbCrLf & "(|fffd||fffd||fffd||295||282||302||fffd|)"
    Range("AU3") = "|fffd|_|fffd||fffd||fffd||48f||fffd||fffd||fffd||fffd||246b|" & vbCrLf & "(|fffd||fffd||fffd||295||282||302||fffd|)"
    Range("AV3") = "|fffd|_|fffd||fffd||fffd||fffd|" & vbCrLf & "(|fffd||fffd||fffd||295||282||302||fffd|)"
    Range("BY3") = "|fffd||70f||550||fffd|" & vbCrLf & "|fffd|X|fffd||594||50d||fffd|"
    Range("CZ3") = "|fffd||fffd||fffd||fffd||70f||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd|"
    Range("DB3") = "|fffd||fffd||fffd||fffd||fffd||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd|"
    Range("DE3") = "|fffd||fffd||fffd||50b16||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd|"
    Range("DH3") = "|fffd||fffd||fffd||57390||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd|"
    Range("DI3") = "|fffd||fffd||fffd||57390||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd|"
    Columns("AR:AR").ColumnWidth = 12
    Columns("BY:BY").ColumnWidth = 9
    Columns("CZ:CZ").ColumnWidth = 9
    Columns("DB:DB").ColumnWidth = 9
    Columns("DE:DE").ColumnWidth = 9
    Columns("DH:DI").ColumnWidth = 9
    
    Range("DC3") = "|fffd||fffd||fffd||513||fffd|" & vbCrLf & "|fffd||fffd||109||fffd|" & vbCrLf & "(|fffd||70f||553||fffd||fffd|w|fffd||fffd||302||fffd|)"
    Range("DF3") = "|fffd||fffd||fffd||513||fffd|" & vbCrLf & "|fffd||fffd||fffd||fffd||fffd|" & vbCrLf & "(|fffd||70f||553||fffd||fffd|w|fffd||fffd||302||fffd|)"
    With Range("AK3:AK3,AR3:AR3,AT3:AV3,DA3:DA3,DD3:DD3")
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .WrapText = True
    End With

    '|fffd||fffd|\|fffd||fffd||fffd|w|fffd||fffd|
    Select Case inpkbn
        Case "BM|fffd||fffd||fffd|P"
            Columns("AQ:BT").EntireColumn.Hidden = True
        Case "|fffd||fffd||fffd||295||289||fffd||fffd|P", "|fffd||fffd||fffd||311||fffd||fffd||fffd||fffd|P"
            Columns("AF:AP").EntireColumn.Hidden = True
            Columns("BL:BT").EntireColumn.Hidden = True
        Case "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|P"
            Columns("AF:BK").EntireColumn.Hidden = True
        Case "|fffd||fffd||fffd|w|fffd||fffd|"
    End Select
    
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Rows("3:3").Select
    Selection.AutoFilter
    Range("A1").Select
    
'   |fffd||1c2||74d||fffd||fffd||42f8c||fffd||fffd||fffd||fffd||fffd||fffd||282||fffd|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Copy
        
'   |fffd|V|fffd|KBook|fffd||315||6d1||fffd||fffd||fffd|Close
    Fname = ThisWorkbook.Path & "\" & syainno & "|fffd||1d7||fffd||fffd|\.xls"
    ActiveWorkbook.SaveAs FileName:=Fname, FileFormat:=xlExcel8
    ActiveWorkbook.Saved = True
'    ActiveWorkbook.Close
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||282||313||fffd||fffd||343|t|fffd|@|fffd|C|fffd||fffd||fffd||303|N|fffd||fffd||fffd|[|fffd|Y
    Windows(syainno & "|fffd||1d7||fffd||fffd|\.bui").Activate
    ActiveWindow.Close
    Kill strPath
    
End Sub


'----------------------------------------
'---  |fffd||70f||548||2d7||fffd||fffd||fffd||fffd||30d||c42c|
'----------------------------------------

Public Sub SessyoIrai(syainno, TatemonoNo)

Dim TatemonoNm, Jyusyo, OkyakuNm, OkyakuTel As String
    
    strPath = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    strURL = ConstUrl & "Iraisyo/" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    
    lngRes = URLDownloadToFile(0, strURL, strPath, 0, 0)
    If lngRes <> 0 Then
        MsgBox ("|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B" & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    End If


'   |fffd||70f||548||2d7||fffd||fffd||fffd|Text|fffd||fffd|Open
    Fname = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    Workbooks.OpenText FileName:=Fname, _
        StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, Comma:=True, Space:=False, Other:=False
    
    TatemonoNm = Cells(1, 1)
    Jyusyo = Cells(1, 2)
    OkyakuNm = Cells(1, 3)
    OkyakuTel = Cells(1, 4)

    ThisWorkbook.Activate
    Sheets("|fffd||70f||548||2d7||fffd||fffd||fffd|").Select
    Range("E12") = TatemonoNm
    Range("E13") = Jyusyo
    Range("H14") = OkyakuNm
    Range("H15") = OkyakuTel
    Range("X1") = Format(Date, "yyyy|fffd|Nm|fffd||fffd|d|fffd||fffd|")

'   |fffd||70f||548||2d7||fffd||fffd||fffd||fffd||fffd|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    Sheets("|fffd||70f||548||2d7||fffd||fffd||fffd|").Copy

'   |fffd|V|fffd|KBook|fffd||315||6d1||fffd||fffd||fffd|Close
    Fname = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||70f||548||2d7||fffd||fffd||fffd|.xls"
    ActiveWorkbook.SaveAs FileName:=Fname, FileFormat:=xlExcel8
    ActiveWorkbook.Saved = True
    'ActiveWorkbook.Close
    
'   |fffd||2d7||fffd||fffd||fffd||fffd||313||fffd||fffd||343|t|fffd|@|fffd|C|fffd||fffd||fffd||303|N|fffd||fffd||fffd|[|fffd|Y
'    Windows(syainno & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui").Activate
    Windows(TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui").Activate
    ActiveWindow.Close

'   |fffd||fffd||197|p|fffd||301|u.bui|fffd|v|fffd||fffd||fffd||d3dc|
    Kill ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    
End Sub

'----------------------------------------
'---  |fffd||74c|v|fffd||2d7||fffd||fffd||fffd||fffd||30d||c42c|
'----------------------------------------

Public Sub SekkeiIrai(syainno, TatemonoNo)

Dim TatemonoNm, Jyusyo, OkyakuNm, OkyakuTel As String
    
    strPath = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    strURL = ConstUrl & "Iraisyo/" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    
    lngRes = URLDownloadToFile(0, strURL, strPath, 0, 0)
    If lngRes <> 0 Then
        MsgBox ("|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B" & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    End If

'   |fffd||74c|v|fffd||2d7||fffd||fffd||fffd|Text|fffd||fffd|Open
    Fname = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    Workbooks.OpenText FileName:=Fname, _
        StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, Comma:=True, Space:=False, Other:=False
    
    TatemonoNm = Cells(1, 1)
    Jyusyo = Cells(1, 2)
    OkyakuNm = Cells(1, 3)
    OkyakuTel = Cells(1, 4)

    ThisWorkbook.Activate
    Sheets("|fffd||74c|v|fffd||2d7||fffd||fffd||fffd|").Select
    Range("X1") = Format(Date, "yyyy|fffd|Nm|fffd||fffd|d|fffd||fffd|")
    Range("E11") = TatemonoNm
    Range("E12") = Jyusyo
'    Range("F25") = TatemonoNo
    Range("F34") = TatemonoNo
    
'   |fffd||74c|v|fffd||2d7||fffd||fffd||fffd||fffd||fffd|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    Sheets("|fffd||74c|v|fffd||2d7||fffd||fffd||fffd|").Copy

'   |fffd|V|fffd|KBook|fffd||315||6d1||fffd||fffd||fffd|Close
    Fname = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||74c|v|fffd||2d7||fffd||fffd||fffd|.xls"
    ActiveWorkbook.SaveAs FileName:=Fname, FileFormat:=xlExcel8
    ActiveWorkbook.Saved = True
    'ActiveWorkbook.Close
    
'   |fffd||2d7||fffd||fffd||fffd||fffd||313||fffd||fffd||343|t|fffd|@|fffd|C|fffd||fffd||fffd||303|N|fffd||fffd||fffd|[|fffd|Y
    Windows(TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui").Activate
    ActiveWindow.Close

'   |fffd||fffd||197|p|fffd||301|u.bui|fffd|v|fffd||fffd||fffd||d3dc|
    Kill ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    
End Sub

'----------------------------------------
'---  |fffd||196||fffd||fffd||2d7||fffd||fffd||fffd||fffd||30d||c42c|
'----------------------------------------

Public Sub GyomuIrai(syainno, TatemonoNo, Tenken, KeyYmd)

Dim TatemonoNm, Jyusyo, OkyakuNm, OkyakuTel As String
Dim Keii, Basyo1, Kasyo1, Naiyo1, Basyo2, Kasyo2, Naiyo2, Basyo3, Kasyo3, Naiyo3, Tenkenymd, NaikanIrai As String
    
    strPath = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    strURL = ConstUrl & "Iraisyo/" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    
    lngRes = URLDownloadToFile(0, strURL, strPath, 0, 0)
    If lngRes <> 0 Then
        MsgBox ("|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^|fffd||fffd||fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B" & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    End If


'   |fffd||70f||548||2d7||fffd||fffd||fffd|Text|fffd||fffd|Open
    Fname = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    Workbooks.OpenText FileName:=Fname, _
        StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, Comma:=True, Space:=False, Other:=False
    
    TatemonoNm = Cells(1, 1)
    Jyusyo = Cells(1, 2)
    OkyakuNm = Cells(1, 3)
    OkyakuTel = Cells(1, 4)
    Keii = Cells(1, 5)
    Basyo1 = Cells(1, 6)
    Kasyo1 = Cells(1, 7)
    Naiyo1 = Cells(1, 8)
    Basyo2 = Cells(1, 9)
    Kasyo2 = Cells(1, 10)
    Naiyo2 = Cells(1, 11)
    Basyo3 = Cells(1, 12)
    Kasyo3 = Cells(1, 13)
    Naiyo3 = Cells(1, 14)
    Tenkenymd = Cells(1, 15)
    NaikanIrai = Cells(1, 16)

    ThisWorkbook.Activate
    Sheets("|fffd||fffd||fffd|P|fffd||196||fffd||fffd||2d7||fffd||fffd||fffd|").Select
    
    ' |fffd||fffd||fffd|o|fffd||fffd||fffd||315||3cd|X
    Select Case Tenken
        Case "2"
            Range("G16") = "|fffd|s|fffd||f347||fffd||a3ca|"
            Range("M16") = "|fffd|s|fffd||f347||fffd||4cf||fffd|"
            Range("T16") = "|fffd|s|fffd||f347||fffd||fffd||fffd|e"
        Case "4"
            Range("G16") = "|fffd||fffd||fffd|P|fffd||a3ca|"
            Range("M16") = "|fffd||fffd||fffd|P|fffd||fffd||fffd|R"
            Range("T16") = "|fffd||fffd||fffd|P|fffd||fffd||fffd|e"
    End Select
    
    Range("H11") = "'" & TatemonoNo
    'Range("U11") = "'" & Mid(KeyYmd, 1, 4) & "/" & Mid(KeyYmd, 5, 2) & "/" & Mid(KeyYmd, 7, 2)
    Range("U11") = Format(Mid(KeyYmd, 1, 4) & "/" & Mid(KeyYmd, 5, 2) & "/" & Mid(KeyYmd, 7, 2), "yyyy|fffd|Nmm|fffd||fffd|dd|fffd||fffd|")
    Range("H12") = TatemonoNm
    Range("H13") = "'" & Jyusyo
    Range("H14") = OkyakuNm
    Range("U14") = "'" & OkyakuTel
    Range("H15") = Keii
    Range("U15") = "'" & Mid(Tenkenymd, 1, 4) & "/" & Mid(Tenkenymd, 5, 2) & "/" & Mid(Tenkenymd, 7, 2)
    Range("G17") = Basyo1
    Range("N17") = Kasyo1
    Range("U17") = Naiyo1
    Range("G18") = Basyo2
    Range("N18") = Kasyo2
    Range("U18") = Naiyo2
    Range("G19") = Basyo3
    Range("N19") = Kasyo3
    Range("U19") = Naiyo3
    Range("K20") = NaikanIrai
    Range("AA1") = Format(Date, "yyyy|fffd|Nm|fffd||fffd|d|fffd||fffd|")
    Range("B58") = "|fffd||1d7||fffd||fffd||50d||fffd||fffd|F" & KeyYmd & "-" & TatemonoNo

'   |fffd||70f||548||2d7||fffd||fffd||fffd||fffd||fffd|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    Sheets("|fffd||fffd||fffd|P|fffd||196||fffd||fffd||2d7||fffd||fffd||fffd|").Copy

'   |fffd|V|fffd|KBook|fffd||315||6d1||fffd||fffd||fffd|Close
    Fname = ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||196||fffd||fffd||2d7||fffd||fffd||fffd|.xls"
    ActiveWorkbook.SaveAs FileName:=Fname, FileFormat:=xlExcel8
    ActiveWorkbook.Saved = True
'    ActiveWorkbook.Close
    
'   |fffd||2d7||fffd||fffd||fffd||fffd||313||fffd||fffd||343|t|fffd|@|fffd|C|fffd||fffd||fffd||303|N|fffd||fffd||fffd|[|fffd|Y
'    Windows(syainno & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui").Activate
    Windows(TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui").Activate
    ActiveWindow.Close

'   |fffd||fffd||197|p|fffd||301|u.bui|fffd|v|fffd||fffd||fffd||d3dc|
    Kill ThisWorkbook.Path & "\" & TatemonoNo & "|fffd||2d7||fffd||fffd|f|fffd|[|fffd|^.bui"
    
End Sub

'----------------------------------------
'---  |fffd|}|fffd|b|fffd|`|fffd||fffd||fffd|O|fffd||fffd||fffd|X|fffd|g|fffd||30d||c42c|
'----------------------------------------

Public Sub RpmachingList(syainno, jigyosyo, inpkbn, keyYmd_from_to, _
                 rakuseikbn, kaizenkbn, siroGSkbn, rsiroGSkbn, maisetukbn)
Dim i As Integer

    
'   |fffd|}|fffd|b|fffd|`|fffd||fffd||fffd|OText|fffd||fffd|Open
    Fname = "d:\Inetpub\wwwroot\BUI\Kanri\" & syainno & "|fffd|}|fffd|b|fffd|`|fffd||fffd||fffd|O|fffd||fffd||fffd|X|fffd|g.bui"
    Workbooks.OpenText FileName:=Fname, _
        Origin:=932, StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, _
        Comma:=True, Space:=False, Other:=False, FieldInfo:=Array(Array(1, 1), _
        Array(2, 1), Array(3, 1), Array(4, 1), Array(5, 1), Array(6, 1), Array(7, 2), Array(8, 1), _
        Array(9, 1), Array(10, 1), Array(11, 1), Array(12, 1), Array(13, 1), Array(14, 1), Array(15 _
        , 1), Array(16, 1), Array(17, 1), Array(18, 1), Array(19, 1), Array(20, 1), Array(21, 1), _
        Array(22, 1), Array(23, 1), Array(24, 1), Array(25, 1), Array(26, 1), Array(27, 1), Array( _
        28, 1), Array(29, 1), Array(30, 1), Array(31, 1), Array(32, 1), Array(33, 1), Array(34, 1), _
        Array(35, 2), Array(36, 1), Array(37, 1), Array(38, 1), Array(39, 1), Array(40, 1), Array( _
        41, 1), Array(42, 1), Array(43, 1), Array(44, 1), Array(45, 1)), _
        TrailingMinusNumbers:=True
    Selection.CurrentRegion.Select
    Selection.NumberFormatLocal = "@"
    Selection.Copy
    
           
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||283|V|fffd|[|fffd|g|fffd||243|R|fffd|s|fffd|[|fffd|A|fffd||48f|W|fffd||fffd||250|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    ThisWorkbook.Activate
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Select
    Cells(1, 1).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Selection.NumberFormatLocal = "@"
    
'   |fffd|r|fffd||fffd|
    Selection.CurrentRegion.Select
    Selection.Borders.LineStyle = True                                          '|fffd|r|fffd||fffd|

'   |fffd||55752||fffd||fffd||fffd|
    Cells.Select
    Cells.EntireColumn.AutoFit
    
'   |fffd||fffd||fffd|o|fffd||fffd||fffd||fffd|
    Rows("1:1").Select
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("A1") = "|fffd||fffd||fffd|o|fffd||fffd||fffd||fffd||fffd|F|fffd|@|fffd||fffd||fffd|_|fffd||fffd|" & jigyosyo & "|fffd|@|fffd|@|fffd||fffd||10e||fffd||781||fffd|" & inpkbn & "|fffd|@|fffd|@|fffd||fffd||fffd|p|fffd||fffd||fffd||fffd|" & keyYmd_from_to & _
                  "|fffd|@|fffd|@|fffd||fffd||fffd||1c9||fffd||fffd|P|fffd||fffd||fffd||fffd||fffd||656a||fffd||fffd|" & rakuseikbn & "|fffd|@|fffd|@NEW REPLACE |fffd||fffd||fffd|P|fffd||656a||fffd||fffd|" & kaizenkbn & _
                  "|fffd|@|fffd|@|fffd||fffd||fffd||1c9||fffd||fffd|P|fffd||fffd||fffd|K|fffd|X|fffd||1cb||656a||fffd||fffd|" & siroGSkbn & "|fffd|@|fffd|@NEW REPLACE|fffd||fffd||fffd|K|fffd|X|fffd||1cb||656a||fffd||fffd|" & rsiroGSkbn & "|fffd|@|fffd|@|fffd||fffd||fffd||754||fffd||fffd|K|fffd|X|fffd||1ce|w|fffd||8041|" & maisetukbn

    Rows("2:2").Select
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("K2:M2").Merge:       Range("K2") = "BM|fffd||fffd||fffd|P|fffd||fffd||10f||fffd||fffd|"
    Range("N2:U2").Merge:       Range("N2") = "|fffd||fffd||fffd||295||281|^|fffd||fffd||fffd||311||fffd||fffd||fffd||fffd|P|fffd||fffd||10f||fffd||fffd|"
    Range("V2:AB2").Merge:      Range("V2") = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|P|fffd||fffd||10f||fffd||fffd|"
    Range("AF2:AR2").Merge:     Range("AF2") = "NEW REPLACE|fffd||fffd||fffd|"
    Range("K2:AR3").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlBottom
    End With
    Selection.Borders.LineStyle = True                                          '|fffd|r|fffd||fffd|
    Range("AC2:AC3").Merge:     Range("AC2") = "|fffd||150|V" & Chr(10) & "GALILEO|fffd|H|fffd||fffd||fffd||50d||fffd|"
    Range("AD2:AD3").Merge:     Range("AD2") = "|fffd||150|V|fffd||fffd||fffd||fffd||fffd||fffd|"
    Range("AE2:AE3").Merge:     Range("AE2") = "|fffd||fffd||fffd||754||fffd||fffd|K|fffd|X" & Chr(10) & "|fffd|w|fffd||80a0||fffd||fffd|"
    Range("AC2:AC3").HorizontalAlignment = xlLeft
    Range("AE2:AE3").HorizontalAlignment = xlLeft
    Columns("AE:AE").EntireColumn.AutoFit
    Cells(1, 1).Select

    
    '|fffd||fffd||fffd||fffd||fffd||317||55742||fffd||fffd|w|fffd||fffd|
    Columns("M:M").ColumnWidth = 50
    Columns("U:U").ColumnWidth = 50
    Columns("AB:AB").ColumnWidth = 50
    Columns("AR:AR").ColumnWidth = 50
    Columns("M:M").WrapText = True
    Columns("U:U").WrapText = True
    Columns("AB:AB").WrapText = True
    Columns("AR:AR").WrapText = True


'   |fffd||1c2||74d||fffd||fffd||42f8c||fffd||fffd||fffd||fffd||fffd||fffd||282||fffd|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Copy


'   |fffd|V|fffd|KBook|fffd||315||6d1||fffd||fffd||fffd|Close
    Fname = "d:\Inetpub\wwwroot\bui\Kanri\" & syainno & "|fffd|}|fffd|b|fffd|`|fffd||fffd||fffd|O|fffd||fffd||fffd|X|fffd|g.xls"
    ActiveWorkbook.SaveAs FileName:=Fname, FileFormat:=xlExcel8
    ActiveWorkbook.Saved = True
    ActiveWorkbook.Close
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||282||313||fffd||fffd||343|t|fffd|@|fffd|C|fffd||fffd||fffd||303|N|fffd||fffd||fffd|[|fffd|Y
    Windows(syainno & "|fffd|}|fffd|b|fffd|`|fffd||fffd||fffd|O|fffd||fffd||fffd|X|fffd|g.bui").Activate
    ActiveWindow.Close
  
    
End Sub

'----------------------------------------
'---  |fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd||1d7||fffd||fffd||fffd||fffd|X|fffd|g|fffd||30d||c42c|
'----------------------------------------

Public Sub Oukyu(syainno, jigyosyo, keyYmd_from_to, taisyo)
Dim i As Integer
    
    strPath = ThisWorkbook.Path & "\" & syainno & "|fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd||1d7||fffd||fffd||fffd||fffd|X|fffd|g.bui"
    strURL = ConstUrl & "oukyu/" & syainno & "|fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd||1d7||fffd||fffd||fffd||fffd|X|fffd|g.bui"
    
    lngRes = URLDownloadToFile(0, strURL, strPath, 0, 0)
    If lngRes <> 0 Then
        MsgBox ("|fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd||1d7||fffd||fffd||fffd||fffd|X|fffd|g|fffd||fffd||fffd|_|fffd|E|fffd||fffd||fffd||fffd||fffd|[|fffd|h|fffd||142||fffd||fffd||702||fffd||fffd||fffd||142||fffd||fffd||fffd||fffd|B" & Chr(13) & "|fffd||fffd||fffd||fffd||fffd|F700-3975|fffd||702||142||fffd||fffd|A|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|B")
    End If
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|Text|fffd||fffd|Open
    
'   |fffd||fffd||fffd|}|fffd||fffd||fffd||fffd|Text|fffd||fffd|Open
    Fname = ThisWorkbook.Path & "\" & syainno & "|fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd||1d7||fffd||fffd||fffd||fffd|X|fffd|g.bui"
    Workbooks.OpenText FileName:=Fname, _
        Origin:=932, StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
        ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, Comma:=True, _
        Space:=False, Other:=False, FieldInfo:=Array(Array(1, 1), Array(2, 1), Array( _
        3, 1), Array(4, 1), Array(5, 1), Array(6, 2), Array(7, 1), Array(8, 1), Array(9, 1), Array(10 _
        , 1), Array(11, 1), Array(12, 1), Array(13, 1), Array(14, 1), Array(15, 1), Array(16, 1), _
        Array(17, 1), Array(18, 1), Array(19, 1), Array(20, 1)), _
        TrailingMinusNumbers:=True
    Selection.CurrentRegion.Select
    Selection.NumberFormatLocal = "@"
    Selection.Copy
        
           
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||283|V|fffd|[|fffd|g|fffd||243|R|fffd|s|fffd|[|fffd|A|fffd||48f|W|fffd||fffd||250|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    ThisWorkbook.Activate
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Select
    Cells(1, 1).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Selection.NumberFormatLocal = "@"

'   |fffd||55752||fffd||fffd||fffd|
    Cells.Select
    Cells.EntireColumn.AutoFit
    
    
'   |fffd|r|fffd||fffd|
    Selection.CurrentRegion.Select
    Selection.Borders.LineStyle = True                                          '|fffd|r|fffd||fffd|
    
    
'   |fffd||fffd||fffd|o|fffd||fffd||fffd||fffd|
    Rows("1:2").Select
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("A1") = "|fffd||fffd||fffd|_|fffd||fffd|" & jigyosyo & "|fffd|@|fffd|@|fffd||fffd||fffd|p|fffd||fffd||fffd||fffd|" & keyYmd_from_to & "|fffd|@|fffd|@|fffd|o|fffd||351||38f||6c1||fffd|" & taisyo
            
    
    '|fffd||fffd||fffd||fffd||fffd||317||55742||fffd||fffd|w|fffd||fffd|
    Columns("P:P").ColumnWidth = 50
    Columns("W:W").ColumnWidth = 50
    Columns("P:P").WrapText = True
    Columns("W:W").WrapText = True
    
    'Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Rows("3:3").Select
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("A3").Select
    Selection.AutoFilter
    Range("A1").Select
    
'   |fffd||1c2||74d||fffd||fffd||42f8c||fffd||fffd||fffd||fffd||fffd||fffd||282||fffd|V|fffd|KBook|fffd||583|R|fffd|s|fffd|[
    Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Copy
        
'   |fffd|V|fffd|KBook|fffd||315||6d1||fffd||fffd||fffd|Close
    Fname = ThisWorkbook.Path & "\" & syainno & "|fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd||1d7||fffd||fffd||fffd||fffd|X|fffd|g.xls"
    ActiveWorkbook.SaveAs FileName:=Fname, FileFormat:=xlExcel8
    ActiveWorkbook.Saved = True
    'ActiveWorkbook.Close
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||282||313||fffd||fffd||343|t|fffd|@|fffd|C|fffd||fffd||fffd||303|N|fffd||fffd||fffd|[|fffd|Y
    Windows(syainno & "|fffd||fffd||fffd|}|fffd||fffd||fffd||fffd||fffd||1d7||fffd||fffd||fffd||fffd|X|fffd|g.bui").Activate
    ActiveWindow.Close
    Kill strPath
    
End Sub


Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True









Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet33"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


INQUEST-PP=macro
