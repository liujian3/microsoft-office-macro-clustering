Attribute VB_Name = "Foglio1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Sub PulisciFoglio()

    If ActiveSheet.FilterMode Then ActiveSheet.ShowAllData
    Sheets("DATI").Range("A7:RF50000").Select
   
    Selection.ClearContents
    Range("A7").Select
End Sub
Sub OrdinaDati()

If ActiveSheet.FilterMode Then ActiveSheet.ShowAllData
Sheets("DATI").Activate
    Sheets("DATI").Range("A7:RF5000").Select
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("A7:A5000") _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("B7:B5000") _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("C7:C5000") _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("D7:D5000") _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("DATI").Sort
        .SetRange Range("A7:RF5000")
        .Header = xlGuess
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    Range("A7").Select
End Sub


Attribute VB_Name = "Foglio10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Modulo_Palinsesto"
Public SENATORE_FORM_EXIT As Boolean   '-MOD FabioGK Nov2019
'
Sub palinsesto2()
    
    Application.Calculation = xlCalculationAutomatic
    Application.ScreenUpdating = False
    Application.CutCopyMode = False
                
    TempoElaborazione = Now()
       
            
            gngtoth = 0: ngngtoth = 0: gngtothh = 0: ngngtothh = 0
            gngtota = 0: ngngtota = 0: gngtotaa = 0: ngngtotaa = 0


    Dim dataincontro As Date
    
    Application.Calculation = xlCalculationAutomatic
    Sheets("CAMP").Select
    SENATORE.Show
    SENATORE.Hide

    If SENATORE_FORM_EXIT Then                  '-MOD FabioGK Nov2019
        MsgBox ("Aggiornamento Interrotto")
        GoTo 100
    End If
 
Sheets("CAMP").Select

For t = 2 To Cells(1, 2) + 1
Sheets("CAMP").Select

naz = Cells(t, 1)
lega = Cells(t, 2)
Shetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)

Sheets("RIS").Select
Cells.Select
    Selection.ClearContents

Cells(1, 1) = naz
Cells(1, 2) = lega

Sheets("DATI").Select

giornatetest = Cells(2, 87)
iniziolega = Cells(1, 2) + 1




Application.Calculation = xlCalculationManual
'---------------------------- Inizio Recupero dati Prossimi Incontri del Campionato in elenco ------------------------

                                                          

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend
Application.Wait (Now + TimeValue("0:00:02"))
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")
Set http1 = Nothing

 controllomain = ">Main<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
 controllomain = ">Torneo"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
controllomain = ">Play Offs<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
 controllomain = ">Apertura<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
 
 ninc = (Len(text1) - Len(Replace(text1, "table-main__daysign", ""))) / Len("table-main__daysign")
 
 
 
 
       controllo1 = "table-main__daysign"
       len1 = Len(controllo1)
       controllotest = "table-main__result"
       posizx = 1
       
      
       For f = 1 To ninc Step 1
       
       posizx1 = InStr(posizx, text1, controllo1) + len1
       posizx2 = InStr(posizx1, text1, controllo1)
       If posizx2 = 0 Then
       contr = "</table>"
       posizx2 = InStr(posizx1, text1, contr)
       End If
       textinc = Trim(Mid(text1, posizx1, posizx2 - posizx1))

       posiztest = InStr(1, textinc, controllotest)
       If posiztest <> 0 Then
       posizx = posizx2
       GoTo 10
       End If
       
       posiztest = InStr(1, textinc, "data-live-cell=")
       If posiztest <> 0 Then
       posizx = posizx2
       GoTo 10
       End If
       
       ' cerco link per h/h
       controllolink1 = "<a href="
       lenlink1 = Len(controllolink1)
       controllolink2 = "class="
       posizl1 = InStr(1, textinc, controllolink1) + lenlink1
       posizl2 = InStr(posizl1, textinc, controllolink2)
       linkhh = Trim(Mid(textinc, posizl1, posizl2 - posizl1))
      
       controllo2 = "</td>"
       controllo3 = "<span>"
       len3 = Len(controllo3)
       controllo4 = "</span>"
       
       ' cerco sq1
       
       posiz3 = InStr(posizl2, textinc, controllo3) + len3
       posiz4 = InStr(posiz3, textinc, controllo4)
       sq1 = Trim(Mid(textinc, posiz3, posiz4 - posiz3))
       
       For x = 6 To Cells(1, 2)
       
      If Cells(x, 5) = sq1 And Cells(x, 169) = "" Or Cells(x, 6) = sq1 And Cells(x, 169) = "" Then
       posizx = posizx2
       GoTo 10
       End If
       Next x
     
       ' cerco sq2
       
       posiz3 = InStr(posiz4, textinc, controllo3) + len3
       posiz4 = InStr(posiz3, textinc, controllo4)
       sq2 = Trim(Mid(textinc, posiz3, posiz4 - posiz3))
       
       For x = 6 To Cells(1, 2)
       
       If Cells(x, 5) = sq2 And Cells(x, 169) = "" Or Cells(x, 6) = sq2 And Cells(x, 169) = "" Then
       posizx = posizx2
       GoTo 10
       End If
       Next x
        
       ' cerco quote
        
        controllo5 = "data-odd="
        len5 = Len(controllo5)
        controllo6 = "></a></td>"
        controllo7 = "colspan="
        len7 = Len(controllo7)
        controllo8 = "</td>"
        
        

        posiz5 = InStr(posiz4, textinc, controllo5) + len5
        If posiz5 = 9 Then
        posizx = posizx2
        GoTo 10
        End If
        posiz6 = InStr(posiz5, textinc, controllo6)
        quota1 = (Trim(Mid(textinc, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, textinc, controllo5) + len5
        posiz6 = InStr(posiz5, textinc, controllo6)
        quotax = (Trim(Mid(textinc, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, textinc, controllo5) + len5
        posiz6 = InStr(posiz5, textinc, controllo6)
        quota2 = (Trim(Mid(textinc, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
        
        
        
        'cerco data
        
        
        posiz1 = InStr(posiz6, textinc, controllo7) + len7 + 2
        posiz2 = InStr(posiz1, textinc, controllo2)
        datainc = Trim(Mid(textinc, posiz1, posiz2 - posiz1))
               
        '----------------- Elaborazione Data ------------------
        If Mid(datainc, 1, 8) = "Tomorrow" Then
           datainc = Replace(datainc, "Tomorrow", Date + 1)
        End If
        
        If Mid(datainc, 1, 5) = "Today" Then
           datainc = Replace(datainc, "Today", Date)
        End If
        
        If Mid(datainc, 1, 9) = "Yesterday" Then
           datainc = Replace(datainc, "Yesterday", Date - 1)
        End If
        
        If Len(datainc) <= 12 And Mid(datainc, 6, 1) = "." Then
           parziale = Mid(datainc, 1, 6)
           anno = Year(Date)
           datainc = Replace(datainc, ". ", "." & anno & " ")
        End If
        '----------------- Fine Elaborazione Data -------------
               
        orainc = Trim(Mid(datainc, 11, 6))
        gg = Mid(datainc, 1, 2)
        mm = Mid(datainc, 4, 2)
        hh = Mid(datainc, 7, 4)
        dataincontro = gg & "/" & mm & "/" & hh
       
        
        Datalimite = Date + Sheets("Dati").[D2].Value
        If dataincontro > Datalimite Then
        GoTo 10
        End If
        
        
        
        rig = Cells(1, 2) + 1
       
        Cells(rig, 1) = dataincontro
        Cells(rig, 2) = orainc
        Cells(rig, 3) = naz
        Cells(rig, 4) = lega
        Cells(rig, 5) = sq1
        Cells(rig, 6) = sq2
        Cells(rig, 7) = quota1
        Cells(rig, 8) = quotax
        Cells(rig, 9) = quota2
                
                
   Application.Calculation = xlCalculationAutomatic
   Calculate
 
'---------------------------- Termina Recupero dati Prossimi Incontri del Campionato in elenco ------------------------
     
 If Foglio3.Cells(3, 15) = "N" Then GoTo 10 ' Controlla se |fffd| richiesta la ricerca dati H/H
 


'---------------------------- Inizio Recupero dati H/H - Testa a Testa ------------------------------------------------
'AGGIORNAMENTO NOVEMBRE 2019


Application.Calculation = xlCalculationManual

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")
Set http1 = Nothing

contrtaglio1 = "<option value=0>Select team</option>"
contrtaglio2 = "</select></li></ul>"
lentaglio2 = Len(contrtaglio2)

posiztaglio1 = InStr(1, text1, contrtaglio1)
posiztaglio2 = InStr(posiztaglio1, text1, contrtaglio2)

text2 = Trim(Mid(text1, posiztaglio1, posiztaglio2 - posiztaglio1))
contrsq = "<option value="
nsq = (Len(text2) - Len(Replace(text2, contrsq, ""))) / Len(contrsq)

       contr1 = "<option value=0>Select team</option>"
       lencontr1 = Len(contr1)
       
       contr2 = "<option value="
       lencontr2 = Len(contr2)
       
       contr3 = ">"
       lencontr3 = Len(contr3)
       
       contr4 = "</option>"
       lencontr4 = Len(contr4)
       
       posiz1 = InStr(1, text2, contr1) + lencontr1
    For i = 1 To nsq
       
       posiz2 = InStr(posiz1, text2, contr2) + lencontr2
       posiz3 = InStr(posiz2, text2, contr3)
       
       IDsq = Trim(Mid(text2, posiz2, posiz3 - posiz2))
       
       posiz4 = posiz3 + lencontr3
       posiz5 = InStr(posiz4, text2, contr4)
       
       contrsq = Trim(Mid(text2, posiz4, posiz5 - posiz4))
       
       posiz6 = posiz5 + lencontr4
      
      If contrsq = sq1 Then
      IDsq1 = IDsq
      End If
      
      If contrsq = sq2 Then
      IDsq2 = IDsq
      End If
      
      posiz1 = posiz6
      
    Next i
      
      
 urlhh = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/" & "mutual-matches/?home=" & IDsq1 & "&away=" & IDsq2 & "&where=0"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", urlhh, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend

texthh = http1.responseText
texthh = Replace(texthh, Chr(34), "")
Set http1 = Nothing


controllohh1b = "Head-to-head:"
         controllohh1 = "</"
         
         controllohh2 = "<!-- right column -->"
         
         posiz1pre = InStr(1, texthh, controllohh1b)
         posiz1 = InStr(posiz1pre, texthh, controllohh1) + 2
         posiz2 = InStr(posiz1, texthh, controllohh2)

                     
        texthh = Trim(Mid(texthh, posiz1, posiz2 - posiz1))
        
        controllohh2 = "class=h-text-center"
        nhh = (Len(texthh) - Len(Replace(texthh, controllohh2, ""))) / Len(controllohh2)
        posin = 1
            
            wsq1h = 0: dsq1h = 0: lsq1h = 0
            wsq1a = 0: dsq1a = 0: lsq1a = 0
            gfsq1h = 0: gssq1h = 0
            gfsq1a = 0: gssq1a = 0
            hhun15 = 0: hhun25 = 0: hhun35 = 0
            hhov15 = 0: hhov25 = 0: hhov35 = 0
        
        For q = 1 To nhh
            posizsq1 = InStr(posin, texthh, sq1)
            posizsq2 = InStr(posin, texthh, sq2)
            controllohh1 = "h-text-center"
            lenhh1 = Len(controllohh1)
            controllohh2 = ":"
            controllohh3 = "<"
            posiz1 = InStr(posin, texthh, controllohh1) + lenhh1
            posiz2 = InStr(posiz1, texthh, controllohh2)
            posiz3 = InStr(posiz2, texthh, controllohh3)
            
            If posiz2 - posiz1 > 3 Then GoTo SaltaH2H 'Sett 2019 - Inserita condizione in cui il risultato del Testa a Testa non sia presente. (Causa sospensione o rinvio)
            ris1 = (Trim(Mid(texthh, posiz1 + 1, posiz2 - (posiz1 + 1))) + 1 - 1)
            ris2 = (Trim(Mid(texthh, posiz2 + 1, posiz3 - (posiz2 + 1))) + 1 - 1)
            totris = ris1 + ris2
            
            If ris1 + ris2 > 1 Then hhov15 = hhov15 + 1
            If ris1 + ris2 > 2 Then hhov25 = hhov25 + 1
            If ris1 + ris2 > 3 Then hhov35 = hhov35 + 1
            If ris1 + ris2 < 2 Then hhun15 = hhun15 + 1
            If ris1 + ris2 < 3 Then hhun25 = hhun25 + 1
            If ris1 + ris2 < 4 Then hhun35 = hhun35 + 1
            
            If posizsq1 < posizsq2 Then
            giosq1h = giosq1h + 1
            gfsq1h = gfsq1h + (ris1 + 1 - 1)
            gssq1h = gssq1h + (ris2 + 1 - 1)
            If ris1 > ris2 Then wsq1h = wsq1h + 1
            If ris1 = ris2 Then dsq1h = dsq1h + 1
            If ris1 < ris2 Then lsq1h = lsq1h + 1
            End If
            If posizsq1 > posizsq2 Then
            giosq1a = giosq1a + 1
            gfsq1a = gfsq1a + (ris2 + 1 - 1)
            gssq1a = gssq1a + (ris1 + 1 - 1)
            If ris1 < ris2 Then wsq1a = wsq1a + 1
            If ris1 = ris2 Then dsq1a = dsq1a + 1
            If ris1 > ris2 Then lsq1a = lsq1a + 1
            End If


              posin = posiz3
SaltaH2H:
        Next q
        
      
            Cells(x, 142) = nhh
            Cells(x, 143) = wsq1h
            Cells(x, 144) = dsq1h
            Cells(x, 145) = lsq1h
            Cells(x, 146) = gfsq1h
            Cells(x, 147) = gssq1h
            Cells(x, 148) = wsq1a
            Cells(x, 149) = dsq1a
            Cells(x, 150) = lsq1a
            Cells(x, 151) = gfsq1a
            Cells(x, 152) = gssq1a
            Cells(x, 153) = lsq1a
            Cells(x, 154) = dsq1a
            Cells(x, 155) = wsq1a
            Cells(x, 156) = gssq1a
            Cells(x, 157) = gfsq1a
            Cells(x, 158) = lsq1h
            Cells(x, 159) = dsq1h
            Cells(x, 160) = wsq1h
            Cells(x, 161) = gssq1h
            Cells(x, 162) = gfsq1h
            nhh = 0
            wsq1h = 0: dsq1h = 0: lsq1h = 0
            wsq1a = 0: dsq1a = 0: lsq1a = 0
            gfsq1h = 0: gssq1h = 0
            gfsq1a = 0: gssq1a = 0
            
                       
          
        
            Cells(x, 163) = hhun15
            Cells(x, 164) = hhun25
            Cells(x, 165) = hhun35
            Cells(x, 166) = hhov15
            Cells(x, 167) = hhov25
            Cells(x, 168) = hhov35
            hhun15 = 0: hhun25 = 0: hhun35 = 0
            hhov15 = 0: hhov25 = 0: hhov35 = 0
            
10          posizx = posizx2
            Next f
TerminaH2H:
 
  
   texthh = ""
   Application.Calculation = xlCalculationAutomatic
   
   Calculate
 '----------------------------- Termina Recupero dati H/H - Testa a Testa -------------------------------------------------------
        
                        
        
  '----------------------------- Avvia Procedura Esterna per recupero dati Campionato -------------------------------------------
20    Call importarisultati
  '----------------------------- Ternima Procedura Esterna per recupero dati Campionato -----------------------------------------
  
  
  
  '----------------------------- Inizio calcolo Statistiche Full Time -------------------------------------------
Application.Calculation = xlCalculationManual
        Sheets("DATI").Select
        
                                       
        
                If Foglio3.Cells(2, 15) = "N" Then GoTo 50

'-------------------------------------- Azzera contatori --------------------------------------------------
hw = 0: hd = 0: hl = 0
aw = 0: ad = 0: al = 0
hgolf = 0: agolf = 0: hgols = 0: agols = 0
hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
hw5 = 0: hd5 = 0: hl5 = 0
aw5 = 0: ad5 = 0: al5 = 0
giornateh = 0: giornatea = 0: giornatetot = 0
hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
serie = 0: g = 0: h = 0
hgol = 0: agol = 0
fts = 0: ftsh = 0: ftsa = 0
cs = 0: csh = 0: csa = 0
gngtoth = 0: ngngtoth = 0: gngtothh = 0: ngngtothh = 0
'-----------------------------------------------------------------------------------------------------------------------


        For x = iniziolega To Cells(1, 2)
        sq = Cells(x, 5)
        Sheets(Shetname).Select
        
 Application.StatusBar = "Calcolo Statistiche FT per: " & sq
 
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
            wdl = ""
            For c = 1 To fin
            If Cells(c, 1) = sq Then
                
                giornatetot = giornatetot + 1
                giornateh = giornateh + 1
                If Cells(c, 6) > Cells(c, 7) Then
                hw = hw + 1
                wdl = wdl & "W"
                wdlh = wdlh & "W"
                End If
                If Cells(c, 6) = Cells(c, 7) Then
                hd = hd + 1
                wdl = wdl & "D"
                wdlh = wdlh & "D"
                End If
                If Cells(c, 6) < Cells(c, 7) Then
                hl = hl + 1
                wdl = wdl & "L"
                wdlh = wdlh & "L"
                End If
                hgolf = hgolf + Cells(c, 6)
                hgols = hgols + Cells(c, 7)
                If giornatetot <= 5 Then
                    golf = Cells(c, 6)
                    gols = Cells(c, 7)
                            Sheets("DATI").Select
                            Cells(x, (386 + giornatetot)) = golf
                            Cells(x, (391 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                        If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtoth = gngtoth + 1
                        If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtoth = ngngtoth + 1
                    
                End If
                If giornateh <= 5 Then
                    golf = Cells(c, 6)
                    gols = Cells(c, 7)
                            Sheets("DATI").Select
                            Cells(x, (406 + giornateh)) = golf
                            Cells(x, (411 + giornateh)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                        If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtothh = gngtothh + 1
                        If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtothh = ngngtothh + 1

                End If

                            
                
                If Cells(c, 6) + Cells(c, 7) < 2 Then hun15 = hun15 + 1
                If Cells(c, 6) + Cells(c, 7) < 3 Then hun25 = hun25 + 1
                If Cells(c, 6) + Cells(c, 7) < 4 Then hun35 = hun35 + 1
                If Cells(c, 6) + Cells(c, 7) > 1 Then hov15 = hov15 + 1
                If Cells(c, 6) + Cells(c, 7) > 2 Then hov25 = hov25 + 1
                If Cells(c, 6) + Cells(c, 7) > 3 Then hov35 = hov35 + 1
                If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then hgol = hgol + 1
                
                If giornateh = giornatetest Then
                hw5 = hw: hd5 = hd: hl5 = hl
                hgolf5 = hgolf: hgols5 = hgols
                hun155 = hun15: hun255 = hun25: hun355 = hun35
                hov155 = hov15: hov255 = hov25: hov355 = hov35
                End If
                
                If Cells(c, 6) = 0 Then fts = fts + 1
                If Cells(c, 7) = 0 Then cs = cs + 1
                If Cells(c, 6) = 0 Then ftsh = ftsh + 1
                If Cells(c, 7) = 0 Then csh = csh + 1
                
                
            End If
            If Cells(c, 2) = sq Then
                giornatetot = giornatetot + 1
                giornatea = giornatea + 1
                If Cells(c, 6) < Cells(c, 7) Then
                aw = aw + 1
                wdl = wdl & "W"
                End If
                If Cells(c, 6) = Cells(c, 7) Then
                ad = ad + 1
                wdl = wdl & "D"
                End If
                If Cells(c, 6) > Cells(c, 7) Then
                al = al + 1
                wdl = wdl & "L"
                End If
                agolf = agolf + Cells(c, 7)
                agols = agols + Cells(c, 6)
                  If giornatetot <= 5 Then
                    golf = Cells(c, 7)
                    gols = Cells(c, 6)
                            Sheets("DATI").Select
                            Cells(x, (386 + giornatetot)) = golf
                            Cells(x, (391 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                        If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtoth = gngtoth + 1
                        If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtoth = ngngtoth + 1

                End If


                
                If Cells(c, 6) + Cells(c, 7) < 2 Then aun15 = aun15 + 1
                If Cells(c, 6) + Cells(c, 7) < 3 Then aun25 = aun25 + 1
                If Cells(c, 6) + Cells(c, 7) < 4 Then aun35 = aun35 + 1
                If Cells(c, 6) + Cells(c, 7) > 1 Then aov15 = aov15 + 1
                If Cells(c, 6) + Cells(c, 7) > 2 Then aov25 = aov25 + 1
                If Cells(c, 6) + Cells(c, 7) > 3 Then aov35 = aov35 + 1
                If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then agol = agol + 1
                If giornatea = giornatetest Then
                aw5 = aw: ad5 = ad: al5 = al
                agolf5 = agolf: agols5 = agols
                aun155 = aun15: aun255 = aun25: aun355 = aun35
                aov155 = aov15: aov255 = aov25: aov355 = aov35
                End If
                If Cells(c, 7) = 0 Then fts = fts + 1
                If Cells(c, 6) = 0 Then cs = cs + 1
                If Cells(c, 7) = 0 Then ftsa = ftsa + 1
                If Cells(c, 6) = 0 Then csa = csa + 1

                       
            End If
                If giornatetot = giornatetest Then
                tot5w = aw + hw
                tot5d = ad + hd
                tot5l = al + hl
                tot5golf = agolf + hgolf
                tot5gols = agols + hgols
                tot5un15 = aun15 + hun15
                tot5un25 = aun25 + hun25
                tot5un35 = aun35 + hun35
                tot5ov15 = aov15 + hov15
                tot5ov25 = aov25 + hov25
                tot5ov35 = aov35 + hov35
                tot5wdlsq1 = wdl
                
                
                
                End If
                
                If giornateh = giornatetest Then h5wdlsq1 = wdlh
                
             
            Next c
            
            wdl = ""
    wdlh = ""
            
            Sheets("DATI").Select
            
            Cells(x, 10) = hw + aw
            Cells(x, 11) = hd + ad
            Cells(x, 12) = hl + al
            Cells(x, 13) = hw
            Cells(x, 14) = hd
            Cells(x, 15) = hl
            Cells(x, 16) = aw
            Cells(x, 17) = ad
            Cells(x, 18) = al
            
            hw = 0: hd = 0: hl = 0
            aw = 0: ad = 0: al = 0
            
            Cells(x, 19) = hgolf + agolf
            Cells(x, 20) = hgols + agols
            Cells(x, 21) = hgolf
            Cells(x, 22) = hgols
            Cells(x, 23) = agolf
            Cells(x, 24) = agols
            hgolf = 0: agolf = 0: hgols = 0: agols = 0
            
            Cells(x, 25) = hun15 + aun15
            Cells(x, 26) = hun25 + aun25
            Cells(x, 27) = hun35 + aun35
            Cells(x, 28) = hun15
            Cells(x, 29) = hun25
            Cells(x, 30) = hun35
            Cells(x, 31) = aun15
            Cells(x, 32) = aun25
            Cells(x, 33) = aun35
            hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
            
            Cells(x, 34) = hov15 + aov15
            Cells(x, 35) = hov25 + aov25
            Cells(x, 36) = hov35 + aov35
            Cells(x, 37) = hov15
            Cells(x, 38) = hov25
            Cells(x, 39) = hov35
            Cells(x, 40) = aov15
            Cells(x, 41) = aov25
            Cells(x, 42) = aov35
            hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
            
            Cells(x, 76) = tot5w
            Cells(x, 77) = tot5d
            Cells(x, 78) = tot5l
            Cells(x, 79) = hw5
            Cells(x, 80) = hd5
            Cells(x, 81) = hl5
            Cells(x, 82) = aw5
            Cells(x, 83) = ad5
            Cells(x, 84) = al5
            
            hw5 = 0: hd5 = 0: hl5 = 0
            aw5 = 0: ad5 = 0: al5 = 0
            giornateh = 0: giornatea = 0: giornatetot = 0
            
            Cells(x, 85) = tot5golf
            Cells(x, 86) = tot5gols
            Cells(x, 87) = hgolf5
            Cells(x, 88) = hgols5
            Cells(x, 89) = agolf5
            Cells(x, 90) = agols5
            hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
            
            Cells(x, 91) = tot5un15
            Cells(x, 92) = tot5un25
            Cells(x, 93) = tot5un35
            Cells(x, 94) = hun155
            Cells(x, 95) = hun255
            Cells(x, 96) = hun355
            Cells(x, 97) = aun155
            Cells(x, 98) = aun255
            Cells(x, 99) = aun355
            hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
            
            Cells(x, 100) = tot5ov15
            Cells(x, 101) = tot5ov25
            Cells(x, 102) = tot5ov35
            Cells(x, 103) = hov155
            Cells(x, 104) = hov255
            Cells(x, 105) = hov355
            Cells(x, 106) = aov155
            Cells(x, 107) = aov255
            Cells(x, 108) = aov355
            hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
            
            Cells(x, 174) = Mid(tot5wdlsq1, 1, 1)
            Cells(x, 175) = Mid(tot5wdlsq1, 2, 1)
            Cells(x, 176) = Mid(tot5wdlsq1, 3, 1)
            Cells(x, 177) = Mid(tot5wdlsq1, 4, 1)
            Cells(x, 178) = Mid(tot5wdlsq1, 5, 1)
            
            Z = 173
            For g = 1 To 5 Step 1
            If Cells(x, (Z + g)) = "D" Then serie = serie + 1
            If Cells(x, (Z + g)) = "W" Then
             For h = g To 5
                If Cells(x, (Z) + h) = "W" Or Cells(x, (Z) + h) = "D" Then serie = serie + 1
                If Cells(x, (Z) + h) = "L" Then Exit For
             Next h
             Exit For
            End If
            If Cells(x, (Z + g)) = "L" Then
            serie = serie * -1
             For h = g To 5
                If Cells(x, (Z) + h) = "L" Or Cells(x, (Z) + h) = "D" Then serie = serie - 1
                If Cells(x, (Z) + h) = "W" Then Exit For
             Next h
            Exit For
            End If
            
            Next g
            
            Cells(x, 352) = serie
            
            serie = 0: g = 0: h = 0
            
            Cells(x, 184) = Mid(h5wdlsq1, 1, 1)
            Cells(x, 185) = Mid(h5wdlsq1, 2, 1)
            Cells(x, 186) = Mid(h5wdlsq1, 3, 1)
            Cells(x, 187) = Mid(h5wdlsq1, 4, 1)
            Cells(x, 188) = Mid(h5wdlsq1, 5, 1)
            h5wdlsq1 = ""
            tot5wdlsq1 = ""
            
            Z = 183
            For g = 1 To 5 Step 1
            If Cells(x, (Z + g)) = "D" Then serie = serie + 1
            If Cells(x, (Z + g)) = "W" Then
             For h = g To 5
                If Cells(x, (Z) + h) = "W" Or Cells(x, (Z) + h) = "D" Then serie = serie + 1
                If Cells(x, (Z) + h) = "L" Then Exit For
             Next h
             Exit For
            End If
            If Cells(x, (Z + g)) = "L" Then
            serie = serie * -1
             For h = g To 5
                If Cells(x, (Z) + h) = "L" Or Cells(x, (Z) + h) = "D" Then serie = serie - 1
                If Cells(x, (Z) + h) = "W" Then Exit For
             Next h
            Exit For
            End If
            
            Next g
            
            Cells(x, 354) = serie
            
            serie = 0: g = 0: h = 0
            
            
            Cells(x, 356) = hgol + agol
            Cells(x, 357) = hgol
            Cells(x, 358) = agol
                        
            hgol = 0: agol = 0
            Cells(x, 375) = fts
            Cells(x, 376) = ftsh
            Cells(x, 377) = ftsa
            fts = 0: ftsh = 0: ftsa = 0
            Cells(x, 381) = cs
            Cells(x, 382) = csh
            Cells(x, 383) = csa
            cs = 0: csh = 0: csa = 0
            
            
            Cells(x, 427) = gngtoth
            Cells(x, 428) = ngngtoth
            Cells(x, 431) = gngtothh
            Cells(x, 432) = ngngtothh
            
            gngtoth = 0: ngngtoth = 0: gngtothh = 0: ngngtothh = 0
               
            
    Next x
    
    
'---------------------------------------- Azzera contatori --------------------------------------------------
hw = 0: hd = 0: hl = 0
aw = 0: ad = 0: al = 0
hgolf = 0: agolf = 0: hgols = 0: agols = 0
hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
hw5 = 0: hd5 = 0: hl5 = 0
aw5 = 0: ad5 = 0: al5 = 0
giornateh = 0: giornatea = 0: giornatetot = 0
hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
serie = 0: g = 0: h = 0
hgol = 0: agol = 0
fts = 0: ftsh = 0: ftsa = 0
cs = 0: csh = 0: csa = 0
gngtota = 0: ngngtota = 0: gngtotaa = 0: ngngtotaa = 0
'-----------------------------------------------------------------------------------------------------------------------

        Sheets("DATI").Select
        For x = iniziolega To Cells(1, 2)
        sq = Cells(x, 6)
        Sheets(Shetname).Select
            
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
            
   Application.StatusBar = "Calcolo Statistiche FT per: " & sq
   
  
            For c = 1 To fin
            If Cells(c, 1) = sq Then
                giornatetot = giornatetot + 1
                giornateh = giornateh + 1
                If Cells(c, 6) > Cells(c, 7) Then
                hw = hw + 1
                wdl = wdl & "W"
                End If
                If Cells(c, 6) = Cells(c, 7) Then
                hd = hd + 1
                wdl = wdl & "D"
                End If
                If Cells(c, 6) < Cells(c, 7) Then
                hl = hl + 1
                wdl = wdl & "L"
                End If
                hgolf = hgolf + Cells(c, 6)
                hgols = hgols + Cells(c, 7)
                If giornatetot <= 5 Then
                    golf = Cells(c, 6)
                    gols = Cells(c, 7)
                            Sheets("DATI").Select
                            Cells(x, (396 + giornatetot)) = golf
                            Cells(x, (401 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                        If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtota = gngtota + 1
                        If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtota = ngngtota + 1

                End If

                
                
                If Cells(c, 6) + Cells(c, 7) < 2 Then hun15 = hun15 + 1
                If Cells(c, 6) + Cells(c, 7) < 3 Then hun25 = hun25 + 1
                If Cells(c, 6) + Cells(c, 7) < 4 Then hun35 = hun35 + 1
                If Cells(c, 6) + Cells(c, 7) > 1 Then hov15 = hov15 + 1
                If Cells(c, 6) + Cells(c, 7) > 2 Then hov25 = hov25 + 1
                If Cells(c, 6) + Cells(c, 7) > 3 Then hov35 = hov35 + 1
                If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then hgol = hgol + 1
                If giornateh = giornatetest Then
                hw5 = hw: hd5 = hd: hl5 = hl
                hgolf5 = hgolf: hgols5 = hgols
                hun155 = hun15: hun255 = hun25: hun355 = hun35
                hov155 = hov15: hov255 = hov25: hov355 = hov35
                End If
                If Cells(c, 6) = 0 Then fts = fts + 1
                If Cells(c, 7) = 0 Then cs = cs + 1
                If Cells(c, 6) = 0 Then ftsh = ftsh + 1
                If Cells(c, 7) = 0 Then csh = csh + 1
                
            End If
            
            If Cells(c, 2) = sq Then
                giornatetot = giornatetot + 1
                giornatea = giornatea + 1
                If Cells(c, 6) < Cells(c, 7) Then
                aw = aw + 1
                wdl = wdl & "W"
                wdla = wdla & "W"
                End If
                If Cells(c, 6) = Cells(c, 7) Then
                ad = ad + 1
                wdl = wdl & "D"
                wdla = wdla & "D"
                End If
                If Cells(c, 6) > Cells(c, 7) Then
                al = al + 1
                wdl = wdl & "L"
                wdla = wdla & "L"
                End If
                agolf = agolf + Cells(c, 7)
                agols = agols + Cells(c, 6)
                
                If giornatetot <= 5 Then
                    golf = Cells(c, 7)
                    gols = Cells(c, 6)
                            Sheets("DATI").Select
                            Cells(x, (396 + giornatetot)) = golf
                            Cells(x, (401 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                       If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtota = gngtota + 1
                       If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtota = ngngtota + 1

                End If
              
                If giornatea <= 5 Then
                    golf = Cells(c, 7)
                    gols = Cells(c, 6)
                            Sheets("DATI").Select
                            Cells(x, (416 + giornatea)) = golf
                            Cells(x, (421 + giornatea)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                       If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtotaa = gngtotaa + 1
                       If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtotaa = ngngtotaa + 1
                
                End If
                

                
                If Cells(c, 6) + Cells(c, 7) < 2 Then aun15 = aun15 + 1
                If Cells(c, 6) + Cells(c, 7) < 3 Then aun25 = aun25 + 1
                If Cells(c, 6) + Cells(c, 7) < 4 Then aun35 = aun35 + 1
                If Cells(c, 6) + Cells(c, 7) > 1 Then aov15 = aov15 + 1
                If Cells(c, 6) + Cells(c, 7) > 2 Then aov25 = aov25 + 1
                If Cells(c, 6) + Cells(c, 7) > 3 Then aov35 = aov35 + 1
                If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then agol = agol + 1
                If giornatea = giornatetest Then
                aw5 = aw: ad5 = ad: al5 = al
                agolf5 = agolf: agols5 = agols
                aun155 = aun15: aun255 = aun25: aun355 = aun35
                aov155 = aov15: aov255 = aov25: aov355 = aov35
                End If
                If Cells(c, 7) = 0 Then fts = fts + 1
                If Cells(c, 6) = 0 Then cs = cs + 1
                If Cells(c, 7) = 0 Then ftsa = ftsa + 1
                If Cells(c, 6) = 0 Then csa = csa + 1
                
            End If
                If giornatetot = giornatetest Then
                tot5w = aw + hw
                tot5d = ad + hd
                tot5l = al + hl
                tot5golf = agolf + hgolf
                tot5gols = agols + hgols
                tot5un15 = aun15 + hun15
                tot5un25 = aun25 + hun25
                tot5un35 = aun35 + hun35
                tot5ov15 = aov15 + hov15
                tot5ov25 = aov25 + hov25
                tot5ov35 = aov35 + hov35
                tot5wdlsq2 = wdl
                End If
                If giornatea = giornatetest Then a5wdlsq2 = wdla
                
            Next c
            wdla = ""
            wdl = ""
            Sheets("DATI").Select
            
            Cells(x, 43) = hw + aw
            Cells(x, 44) = hd + ad
            Cells(x, 45) = hl + al
            Cells(x, 46) = hw
            Cells(x, 47) = hd
            Cells(x, 48) = hl
            Cells(x, 49) = aw
            Cells(x, 50) = ad
            Cells(x, 51) = al
            
            hw = 0: hd = 0: hl = 0
            aw = 0: ad = 0: al = 0
            
            Cells(x, 52) = hgolf + agolf
            Cells(x, 53) = hgols + agols
            Cells(x, 54) = hgolf
            Cells(x, 55) = hgols
            Cells(x, 56) = agolf
            Cells(x, 57) = agols
            hgolf = 0: agolf = 0: hgols = 0: agols = 0
            
            Cells(x, 58) = hun15 + aun15
            Cells(x, 59) = hun25 + aun25
            Cells(x, 60) = hun35 + aun35
            Cells(x, 61) = hun15
            Cells(x, 62) = hun25
            Cells(x, 63) = hun35
            Cells(x, 64) = aun15
            Cells(x, 65) = aun25
            Cells(x, 66) = aun35
            hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
            
            Cells(x, 67) = hov15 + aov15
            Cells(x, 68) = hov25 + aov25
            Cells(x, 69) = hov35 + aov35
            Cells(x, 70) = hov15
            Cells(x, 71) = hov25
            Cells(x, 72) = hov35
            Cells(x, 73) = aov15
            Cells(x, 74) = aov25
            Cells(x, 75) = aov35
            hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
            
            Cells(x, 109) = tot5w
            Cells(x, 110) = tot5d
            Cells(x, 111) = tot5l
            Cells(x, 112) = hw5
            Cells(x, 113) = hd5
            Cells(x, 114) = hl5
            Cells(x, 115) = aw5
            Cells(x, 116) = ad5
            Cells(x, 117) = al5
            
            hw5 = 0: hd5 = 0: hl5 = 0
            aw5 = 0: ad5 = 0: al5 = 0
            giornateh = 0: giornatea = 0: giornatetot = 0
            
            Cells(x, 118) = tot5golf
            Cells(x, 119) = tot5gols
            Cells(x, 120) = hgolf5
            Cells(x, 121) = hgols5
            Cells(x, 122) = agolf5
            Cells(x, 123) = agols5
            hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
            
            Cells(x, 124) = tot5un15
            Cells(x, 125) = tot5un25
            Cells(x, 126) = tot5un35
            Cells(x, 127) = hun155
            Cells(x, 128) = hun255
            Cells(x, 129) = hun355
            Cells(x, 130) = aun155
            Cells(x, 131) = aun255
            Cells(x, 132) = aun355
            hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
            
            Cells(x, 133) = tot5ov15
            Cells(x, 134) = tot5ov25
            Cells(x, 135) = tot5ov35
            Cells(x, 136) = hov155
            Cells(x, 137) = hov255
            Cells(x, 138) = hov355
            Cells(x, 139) = aov155
            Cells(x, 140) = aov255
            Cells(x, 141) = aov355
            hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
            
            
            Cells(x, 179) = Mid(tot5wdlsq2, 1, 1)
            Cells(x, 180) = Mid(tot5wdlsq2, 2, 1)
            Cells(x, 181) = Mid(tot5wdlsq2, 3, 1)
            Cells(x, 182) = Mid(tot5wdlsq2, 4, 1)
            Cells(x, 183) = Mid(tot5wdlsq2, 5, 1)
            
            Z = 178
            For g = 1 To 5 Step 1
            If Cells(x, (Z + g)) = "D" Then serie = serie + 1
            If Cells(x, (Z + g)) = "W" Then
             For h = g To 5
                If Cells(x, (Z) + h) = "W" Or Cells(x, (Z) + h) = "D" Then serie = serie + 1
                If Cells(x, (Z) + h) = "L" Then Exit For
             Next h
             Exit For
            End If
            If Cells(x, (Z + g)) = "L" Then
            serie = serie * -1
             For h = g To 5
                If Cells(x, (Z) + h) = "L" Or Cells(x, (Z) + h) = "D" Then serie = serie - 1
                If Cells(x, (Z) + h) = "W" Then Exit For
             Next h
            Exit For
            End If
            
            Next g
            
            Cells(x, 353) = serie
            
            serie = 0: g = 0: h = 0
            
            
            Cells(x, 189) = Mid(a5wdlsq2, 1, 1)
            Cells(x, 190) = Mid(a5wdlsq2, 2, 1)
            Cells(x, 191) = Mid(a5wdlsq2, 3, 1)
            Cells(x, 192) = Mid(a5wdlsq2, 4, 1)
            Cells(x, 193) = Mid(a5wdlsq2, 5, 1)
            
            tot5wdlsq2 = ""
            a5wdlsq2 = ""
            
            Z = 188
            For g = 1 To 5 Step 1
            If Cells(x, (Z + g)) = "D" Then serie = serie + 1
            If Cells(x, (Z + g)) = "W" Then
             For h = g To 5
                If Cells(x, (Z) + h) = "W" Or Cells(x, (Z) + h) = "D" Then serie = serie + 1
                If Cells(x, (Z) + h) = "L" Then Exit For
             Next h
             Exit For
            End If
            If Cells(x, (Z + g)) = "L" Then
            serie = serie * -1
             For h = g To 5
                If Cells(x, (Z) + h) = "L" Or Cells(x, (Z) + h) = "D" Then serie = serie - 1
                If Cells(x, (Z) + h) = "W" Then Exit For
             Next h
            Exit For
            End If
            
            Next g
            
            Cells(x, 355) = serie
            
            serie = 0: g = 0: h = 0
            
            
            Cells(x, 359) = hgol + agol
            Cells(x, 360) = hgol
            Cells(x, 361) = agol
                        
            hgol = 0: agol = 0
            
            Cells(x, 378) = fts
            Cells(x, 379) = ftsh
            Cells(x, 380) = ftsa
            fts = 0: ftsh = 0: ftsa = 0
            Cells(x, 384) = cs
            Cells(x, 385) = csh
            Cells(x, 386) = csa
            cs = 0: csh = 0: csa = 0
            
            Cells(x, 429) = gngtota
            Cells(x, 430) = ngngtota
            Cells(x, 433) = gngtotaa
            Cells(x, 434) = ngngtotaa
            
            gngtota = 0: ngngtota = 0: gngtotaa = 0: ngngtotaa = 0
            
    Next x
    Application.Calculation = xlCalculationAutomatic
    Calculate
'----------------------------- Termina calcolo Statistiche Full Time -------------------------------------------
                                       
    


'----------------------------- Inizio calcolo Statistiche Half Time -------------------------------------------
Application.Calculation = xlCalculationManual

    If Foglio3.Cells(4, 15) = "N" Then GoTo 50
    
        Sheets("DATI").Select

'---------------------------------------- Azzera contatori --------------------------------------------------
hw = 0: hd = 0: hl = 0
aw = 0: ad = 0: al = 0
hgolf = 0: agolf = 0: hgols = 0: agols = 0
hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
hw5 = 0: hd5 = 0: hl5 = 0
aw5 = 0: ad5 = 0: al5 = 0
giornateh = 0: giornatea = 0: giornatetot = 0
hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
hthgol = 0: htagol = 0
'-----------------------------------------------------------------------------------------------------------------------

        For x = iniziolega To Cells(1, 2)
        sq = Cells(x, 5)
        Sheets(Shetname).Select
            
    Application.StatusBar = "Calcolo Statistiche HT per: " & sq
    
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
            wdl = ""
            For c = 1 To fin
            If Cells(c, 1) = sq Then
                
                giornatetot = giornatetot + 1
                giornateh = giornateh + 1
                If Cells(c, 8) > Cells(c, 9) Then
                hw = hw + 1
                wdl = wdl & "W"
                wdlh = wdlh & "W"
                End If
                If Cells(c, 8) = Cells(c, 9) Then
                hd = hd + 1
                wdl = wdl & "D"
                wdlh = wdlh & "D"
                End If
                If Cells(c, 8) < Cells(c, 9) Then
                hl = hl + 1
                wdl = wdl & "L"
                wdlh = wdlh & "L"
                End If
                hgolf = hgolf + Cells(c, 8)
                hgols = hgols + Cells(c, 9)
                
                If giornatetot <= 5 Then    '-MOD FabioGK Nov2019-v12
                    golf = Cells(c, 8)
                    gols = Cells(c, 9)
                            colpos1 = Range("PS1").Column - 1
                            colpos2 = Range("PX1").Column - 1
                            Sheets("DATI").Select
                            Cells(x, (colpos1 + giornatetot)) = golf
                            Cells(x, (colpos2 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                End If
                If giornateh <= 5 Then    '-MOD FabioGK Nov2019-v12
                    golf = Cells(c, 8)
                    gols = Cells(c, 9)
                            colpos1 = Range("QM1").Column - 1
                            colpos2 = Range("QR1").Column - 1
                            Sheets("DATI").Select
                            Cells(x, (colpos1 + giornateh)) = golf
                            Cells(x, (colpos2 + giornateh)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                End If
                
                If Cells(c, 8) + Cells(c, 9) < 2 Then hun15 = hun15 + 1
                If Cells(c, 8) + Cells(c, 9) < 3 Then hun25 = hun25 + 1
                If Cells(c, 8) + Cells(c, 9) < 4 Then hun35 = hun35 + 1
                If Cells(c, 8) + Cells(c, 9) > 1 Then hov15 = hov15 + 1
                If Cells(c, 8) + Cells(c, 9) > 2 Then hov25 = hov25 + 1
                If Cells(c, 8) + Cells(c, 9) > 3 Then hov35 = hov35 + 1
                If Cells(c, 8) > 0 And Cells(c, 9) > 0 Then hthgol = hthgol + 1
                If giornateh = giornatetest Then
                hw5 = hw: hd5 = hd: hl5 = hl
                hgolf5 = hgolf: hgols5 = hgols
                hun155 = hun15: hun255 = hun25: hun355 = hun35
                hov155 = hov15: hov255 = hov25: hov355 = hov35
                End If
                
                
                
            End If
            If Cells(c, 2) = sq Then
                giornatetot = giornatetot + 1
                giornatea = giornatea + 1
                If Cells(c, 8) < Cells(c, 9) Then
                aw = aw + 1
                wdl = wdl & "W"
                End If
                If Cells(c, 8) = Cells(c, 9) Then
                ad = ad + 1
                wdl = wdl & "D"
                End If
                If Cells(c, 8) > Cells(c, 9) Then
                al = al + 1
                wdl = wdl & "L"
                End If
                agolf = agolf + Cells(c, 9)
                agols = agols + Cells(c, 8)
                If giornatetot <= 5 Then    '-MOD FabioGK Nov2019-v12
                    golf = Cells(c, 9)
                    gols = Cells(c, 8)
                            colpos1 = Range("PS1").Column - 1
                            colpos2 = Range("PX1").Column - 1
                            Sheets("DATI").Select
                            Cells(x, (colpos1 + giornatetot)) = golf
                            Cells(x, (colpos2 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                End If
                If Cells(c, 8) + Cells(c, 9) < 2 Then aun15 = aun15 + 1
                If Cells(c, 8) + Cells(c, 9) < 3 Then aun25 = aun25 + 1
                If Cells(c, 8) + Cells(c, 9) < 4 Then aun35 = aun35 + 1
                If Cells(c, 8) + Cells(c, 9) > 1 Then aov15 = aov15 + 1
                If Cells(c, 8) + Cells(c, 9) > 2 Then aov25 = aov25 + 1
                If Cells(c, 8) + Cells(c, 9) > 3 Then aov35 = aov35 + 1
                If Cells(c, 8) > 0 And Cells(c, 9) > 0 Then htagol = htagol + 1
                If giornatea = giornatetest Then
                aw5 = aw: ad5 = ad: al5 = al
                agolf5 = agolf: agols5 = agols
                aun155 = aun15: aun255 = aun25: aun355 = aun35
                aov155 = aov15: aov255 = aov25: aov355 = aov35
                End If
                       
            End If
                If giornatetot = giornatetest Then
                tot5w = aw + hw
                tot5d = ad + hd
                tot5l = al + hl
                tot5golf = agolf + hgolf
                tot5gols = agols + hgols
                tot5un15 = aun15 + hun15
                tot5un25 = aun25 + hun25
                tot5un35 = aun35 + hun35
                tot5ov15 = aov15 + hov15
                tot5ov25 = aov25 + hov25
                tot5ov35 = aov35 + hov35
                tot5wdlsq1 = wdl
                End If
                
                If giornateh = giornatetest Then h5wdlsq1 = wdlh
                
             
            Next c
            
            wdl = ""
    wdlh = ""
            
            Sheets("DATI").Select
            
            Cells(x, 194) = hw + aw
            Cells(x, 195) = hd + ad
            Cells(x, 196) = hl + al
            Cells(x, 197) = hw
            Cells(x, 198) = hd
            Cells(x, 199) = hl
            Cells(x, 200) = aw
            Cells(x, 201) = ad
            Cells(x, 202) = al
            
            hw = 0: hd = 0: hl = 0
            aw = 0: ad = 0: al = 0
            
            Cells(x, 203) = hgolf + agolf
            Cells(x, 204) = hgols + agols
            Cells(x, 205) = hgolf
            Cells(x, 206) = hgols
            Cells(x, 207) = agolf
            Cells(x, 208) = agols
            hgolf = 0: agolf = 0: hgols = 0: agols = 0
            
            Cells(x, 209) = hun15 + aun15
            Cells(x, 210) = hun25 + aun25
            Cells(x, 211) = hun35 + aun35
            Cells(x, 212) = hun15
            Cells(x, 213) = hun25
            Cells(x, 214) = hun35
            Cells(x, 215) = aun15
            Cells(x, 216) = aun25
            Cells(x, 217) = aun35
            hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
            
            Cells(x, 218) = hov15 + aov15
            Cells(x, 219) = hov25 + aov25
            Cells(x, 220) = hov35 + aov35
            Cells(x, 221) = hov15
            Cells(x, 222) = hov25
            Cells(x, 223) = hov35
            Cells(x, 224) = aov15
            Cells(x, 225) = aov25
            Cells(x, 226) = aov35
            hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
            
            Cells(x, 260) = tot5w
            Cells(x, 261) = tot5d
            Cells(x, 262) = tot5l
            Cells(x, 263) = hw5
            Cells(x, 264) = hd5
            Cells(x, 265) = hl5
            Cells(x, 266) = aw5
            Cells(x, 267) = ad5
            Cells(x, 268) = al5
            
            hw5 = 0: hd5 = 0: hl5 = 0
            aw5 = 0: ad5 = 0: al5 = 0
            giornateh = 0: giornatea = 0: giornatetot = 0
            
            Cells(x, 269) = tot5golf
            Cells(x, 270) = tot5gols
            Cells(x, 271) = hgolf5
            Cells(x, 272) = hgols5
            Cells(x, 273) = agolf5
            Cells(x, 274) = agols5
            hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
            
            Cells(x, 275) = tot5un15
            Cells(x, 276) = tot5un25
            Cells(x, 277) = tot5un35
            Cells(x, 278) = hun155
            Cells(x, 279) = hun255
            Cells(x, 280) = hun355
            Cells(x, 281) = aun155
            Cells(x, 282) = aun255
            Cells(x, 283) = aun355
            hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
            
            Cells(x, 284) = tot5ov15
            Cells(x, 285) = tot5ov25
            Cells(x, 286) = tot5ov35
            Cells(x, 287) = hov155
            Cells(x, 288) = hov255
            Cells(x, 289) = hov355
            Cells(x, 290) = aov155
            Cells(x, 291) = aov255
            Cells(x, 292) = aov355
            hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
            
            Cells(x, 326) = Mid(tot5wdlsq1, 1, 1)
            Cells(x, 327) = Mid(tot5wdlsq1, 2, 1)
            Cells(x, 328) = Mid(tot5wdlsq1, 3, 1)
            Cells(x, 329) = Mid(tot5wdlsq1, 4, 1)
            Cells(x, 330) = Mid(tot5wdlsq1, 5, 1)
            Cells(x, 336) = Mid(h5wdlsq1, 1, 1)
            Cells(x, 337) = Mid(h5wdlsq1, 2, 1)
            Cells(x, 338) = Mid(h5wdlsq1, 3, 1)
            Cells(x, 339) = Mid(h5wdlsq1, 4, 1)
            Cells(x, 340) = Mid(h5wdlsq1, 5, 1)
            h5wdlsq1 = ""
            tot5wdlsq1 = ""
            
            Cells(x, 362) = hthgol + htagol
            Cells(x, 363) = hthgol
            Cells(x, 364) = htagol
                        
            hthgol = 0: htagol = 0
            
    Next x
    
    
'---------------------------------------- Azzera contatori --------------------------------------------------
hw = 0: hd = 0: hl = 0
aw = 0: ad = 0: al = 0
hgolf = 0: agolf = 0: hgols = 0: agols = 0
hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
hw5 = 0: hd5 = 0: hl5 = 0
aw5 = 0: ad5 = 0: al5 = 0
giornateh = 0: giornatea = 0: giornatetot = 0
hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
hthgol = 0: htagol = 0
'------------------------------------------------------------------------------------------------------------

        Sheets("DATI").Select
        For x = iniziolega To Cells(1, 2)
        sq = Cells(x, 6)
        Sheets(Shetname).Select
            
Application.StatusBar = "Calcolo Statistiche HT per: " & sq
            
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
            
            For c = 1 To fin
            If Cells(c, 1) = sq Then
                giornatetot = giornatetot + 1
                giornateh = giornateh + 1
                If Cells(c, 8) > Cells(c, 9) Then
                hw = hw + 1
                wdl = wdl & "W"
                End If
                If Cells(c, 8) = Cells(c, 9) Then
                hd = hd + 1
                wdl = wdl & "D"
                End If
                If Cells(c, 8) < Cells(c, 9) Then
                hl = hl + 1
                wdl = wdl & "L"
                End If
                hgolf = hgolf + Cells(c, 8)
                hgols = hgols + Cells(c, 9)
                If giornatetot <= 5 Then    '-MOD FabioGK Nov2019-v12
                    golf = Cells(c, 8)
                    gols = Cells(c, 9)
                            colpos1 = Range("QC1").Column - 1
                            colpos2 = Range("QH1").Column - 1
                            Sheets("DATI").Select
                            Cells(x, (colpos1 + giornatetot)) = golf
                            Cells(x, (colpos2 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                        If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtoth = gngtoth + 1
                        If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtoth = ngngtoth + 1
                End If
                If Cells(c, 8) + Cells(c, 9) < 2 Then hun15 = hun15 + 1
                If Cells(c, 8) + Cells(c, 9) < 3 Then hun25 = hun25 + 1
                If Cells(c, 8) + Cells(c, 9) < 4 Then hun35 = hun35 + 1
                If Cells(c, 8) + Cells(c, 9) > 1 Then hov15 = hov15 + 1
                If Cells(c, 8) + Cells(c, 9) > 2 Then hov25 = hov25 + 1
                If Cells(c, 8) + Cells(c, 9) > 3 Then hov35 = hov35 + 1
                If Cells(c, 8) > 0 And Cells(c, 9) > 0 Then hthgol = hthgol + 1
                If giornateh = giornatetest Then
                hw5 = hw: hd5 = hd: hl5 = hl
                hgolf5 = hgolf: hgols5 = hgols
                hun155 = hun15: hun255 = hun25: hun355 = hun35
                hov155 = hov15: hov255 = hov25: hov355 = hov35
                End If
            End If
            
            If Cells(c, 2) = sq Then
                giornatetot = giornatetot + 1
                giornatea = giornatea + 1
                If Cells(c, 8) < Cells(c, 9) Then
                aw = aw + 1
                wdl = wdl & "W"
                wdla = wdla & "W"
                End If
                If Cells(c, 8) = Cells(c, 9) Then
                ad = ad + 1
                wdl = wdl & "D"
                wdla = wdla & "D"
                End If
                If Cells(c, 8) > Cells(c, 9) Then
                al = al + 1
                wdl = wdl & "L"
                wdla = wdla & "L"
                End If
                agolf = agolf + Cells(c, 9)
                agols = agols + Cells(c, 8)
                If giornatetot <= 5 Then    '-MOD FabioGK Nov2019-v12
                    golf = Cells(c, 9)
                    gols = Cells(c, 8)
                            colpos1 = Range("QC1").Column - 1
                            colpos2 = Range("QH1").Column - 1
                            Sheets("DATI").Select
                            Cells(x, (colpos1 + giornatetot)) = golf
                            Cells(x, (colpos2 + giornatetot)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                        If Cells(c, 6) > 0 And Cells(c, 7) > 0 Then gngtoth = gngtoth + 1
                        If Cells(c, 6) = 0 Or Cells(c, 7) = 0 Then ngngtoth = ngngtoth + 1
                End If
                If giornatea <= 5 Then    '-MOD FabioGK Nov2019-v12
                    golf = Cells(c, 9)
                    gols = Cells(c, 8)
                            colpos1 = Range("QW1").Column - 1
                            colpos2 = Range("RB1").Column - 1
                            Sheets("DATI").Select
                            Cells(x, (colpos1 + giornatea)) = golf
                            Cells(x, (colpos2 + giornatea)) = gols
                            Sheets(Shetname).Select
                    golf = ""
                    gols = ""
                End If
                If Cells(c, 8) + Cells(c, 9) < 2 Then aun15 = aun15 + 1
                If Cells(c, 8) + Cells(c, 9) < 3 Then aun25 = aun25 + 1
                If Cells(c, 8) + Cells(c, 9) < 4 Then aun35 = aun35 + 1
                If Cells(c, 8) + Cells(c, 9) > 1 Then aov15 = aov15 + 1
                If Cells(c, 8) + Cells(c, 9) > 2 Then aov25 = aov25 + 1
                If Cells(c, 8) + Cells(c, 9) > 3 Then aov35 = aov35 + 1
                If Cells(c, 8) > 0 And Cells(c, 9) > 0 Then htagol = htagol + 1
                If giornatea = giornatetest Then
                aw5 = aw: ad5 = ad: al5 = al
                agolf5 = agolf: agols5 = agols
                aun155 = aun15: aun255 = aun25: aun355 = aun35
                aov155 = aov15: aov255 = aov25: aov355 = aov35
                End If
      
            End If
                If giornatetot = giornatetest Then
                tot5w = aw + hw
                tot5d = ad + hd
                tot5l = al + hl
                tot5golf = agolf + hgolf
                tot5gols = agols + hgols
                tot5un15 = aun15 + hun15
                tot5un25 = aun25 + hun25
                tot5un35 = aun35 + hun35
                tot5ov15 = aov15 + hov15
                tot5ov25 = aov25 + hov25
                tot5ov35 = aov35 + hov35
                tot5wdlsq2 = wdl
                End If
                If giornatea = giornatetest Then a5wdlsq2 = wdla
                
            Next c
            wdla = ""
            wdl = ""
            Sheets("DATI").Select
            
            Cells(x, 227) = hw + aw
            Cells(x, 228) = hd + ad
            Cells(x, 229) = hl + al
            Cells(x, 230) = hw
            Cells(x, 231) = hd
            Cells(x, 232) = hl
            Cells(x, 233) = aw
            Cells(x, 234) = ad
            Cells(x, 235) = al
            
            hw = 0: hd = 0: hl = 0
            aw = 0: ad = 0: al = 0
            
            Cells(x, 236) = hgolf + agolf
            Cells(x, 237) = hgols + agols
            Cells(x, 238) = hgolf
            Cells(x, 239) = hgols
            Cells(x, 240) = agolf
            Cells(x, 241) = agols
            hgolf = 0: agolf = 0: hgols = 0: agols = 0
            
            Cells(x, 242) = hun15 + aun15
            Cells(x, 243) = hun25 + aun25
            Cells(x, 244) = hun35 + aun35
            Cells(x, 245) = hun15
            Cells(x, 246) = hun25
            Cells(x, 247) = hun35
            Cells(x, 248) = aun15
            Cells(x, 249) = aun25
            Cells(x, 250) = aun35
            hun15 = 0: hun25 = 0: hun35 = 0: aun15 = 0: aun25 = 0: aun35 = 0
            
            Cells(x, 251) = hov15 + aov15
            Cells(x, 252) = hov25 + aov25
            Cells(x, 253) = hov35 + aov35
            Cells(x, 254) = hov15
            Cells(x, 255) = hov25
            Cells(x, 256) = hov35
            Cells(x, 257) = aov15
            Cells(x, 258) = aov25
            Cells(x, 259) = aov35
            hov15 = 0: hov25 = 0: hov35 = 0: aov15 = 0: aov25 = 0: aov35 = 0
            
            Cells(x, 293) = tot5w
            Cells(x, 294) = tot5d
            Cells(x, 295) = tot5l
            Cells(x, 296) = hw5
            Cells(x, 297) = hd5
            Cells(x, 298) = hl5
            Cells(x, 299) = aw5
            Cells(x, 300) = ad5
            Cells(x, 301) = al5
            
            hw5 = 0: hd5 = 0: hl5 = 0
            aw5 = 0: ad5 = 0: al5 = 0
            giornateh = 0: giornatea = 0: giornatetot = 0
            
            Cells(x, 302) = tot5golf
            Cells(x, 303) = tot5gols
            Cells(x, 304) = hgolf5
            Cells(x, 305) = hgols5
            Cells(x, 306) = agolf5
            Cells(x, 307) = agols5
            hgolf5 = 0: agolf5 = 0: hgols5 = 0: agols5 = 0
            
            Cells(x, 308) = tot5un15
            Cells(x, 309) = tot5un25
            Cells(x, 310) = tot5un35
            Cells(x, 311) = hun155
            Cells(x, 312) = hun255
            Cells(x, 313) = hun355
            Cells(x, 314) = aun155
            Cells(x, 315) = aun255
            Cells(x, 316) = aun355
            hun155 = 0: hun255 = 0: hun355 = 0: aun155 = 0: aun255 = 0: aun355 = 0
            
            Cells(x, 317) = tot5ov15
            Cells(x, 318) = tot5ov25
            Cells(x, 319) = tot5ov35
            Cells(x, 320) = hov155
            Cells(x, 321) = hov255
            Cells(x, 322) = hov355
            Cells(x, 323) = aov155
            Cells(x, 324) = aov255
            Cells(x, 325) = aov355
            hov155 = 0: hov255 = 0: hov355 = 0: aov155 = 0: aov255 = 0: aov355 = 0
            
            
            Cells(x, 331) = Mid(tot5wdlsq2, 1, 1)
            Cells(x, 332) = Mid(tot5wdlsq2, 2, 1)
            Cells(x, 333) = Mid(tot5wdlsq2, 3, 1)
            Cells(x, 334) = Mid(tot5wdlsq2, 4, 1)
            Cells(x, 335) = Mid(tot5wdlsq2, 5, 1)
            Cells(x, 341) = Mid(a5wdlsq2, 1, 1)
            Cells(x, 342) = Mid(a5wdlsq2, 2, 1)
            Cells(x, 343) = Mid(a5wdlsq2, 3, 1)
            Cells(x, 344) = Mid(a5wdlsq2, 4, 1)
            Cells(x, 345) = Mid(a5wdlsq2, 5, 1)
            
            tot5wdlsq2 = ""
            a5wdlsq2 = ""
            
            
            Cells(x, 365) = hthgol + htagol
            Cells(x, 366) = hthgol
            Cells(x, 367) = htagol
                        
            hthgol = 0: htagol = 0
            
    Next x
Application.Calculation = xlCalculationAutomatic
Calculate
'----------------------------- Termina calcolo Statistiche Half Time -------------------------------------------
    
    
50    Next t

'----------------------------- Avvia Procedura esterna per recupero dati Classifica -------------------------------------------
        If Foglio3.Cells(5, 15) = "S" Then
        Call cercaclassifiche
        End If
'----------------------------- Termina Procedura esterna per recupero dati Classifica -------------------------------------------
        
100:

Tempoimpiegato = Now() - TempoElaborazione
Application.StatusBar = ""
Application.Calculation = xlCalculationAutomatic
Application.ScreenUpdating = True
Application.CutCopyMode = False


    Sheets("DATI").Select
    Sheets("DATI").[F3] = Tempoimpiegato
    
'------------------ FINE PALINSESTO2() -------------------------------
End Sub


Attribute VB_Name = "Modulo_Ris_Class"
Sub importarisultati()

Application.ScreenUpdating = False

Sheets("CAMP").Select
son = Cells(4, 15)
Sheets("RIS").Select



naz = Cells(1, 1)
lega = Cells(1, 2)
Shetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)

Application.StatusBar = "Cerco dati per: " & naz & "  " & lega


'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracsByProcess 8"

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/results/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")
Set http1 = Nothing

Sheets("RIS").Select

Shetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)
For Each foglio In Worksheets
If foglio.Name = Shetname Then
GoTo 10
End If
Next foglio
Sheets.Add after:=Worksheets(Worksheets.Count)
    ActiveSheet.Name = Shetname
    
10     Sheets(Shetname).Select

fin = Range("A" & Rows.Count).End(xlUp).Row


If son = "S" Then
    For y = 1 To fin
       If Cells(y, 8) = "" Then
        Cells.ClearContents
        Exit For
        End If
    Next y
End If

        sq11 = Cells(1, 1): sq21 = Cells(1, 2)
        If Cells(1, 1) = "" Then GoTo 2
        controlloinc1 = "<span>" & sq11 & "</span> - <span>" & sq21 & "</span>"
        controlloinc2 = "<span><strong>" & sq11 & "</strong></span> - <span>" & sq21 & "</span>"
        controlloinc3 = "<span>" & sq11 & "</span> - <span><strong>" & sq21 & "</strong></span>"
        
         posizinc1 = InStr(1, text1, controlloinc1) - 20
         posizinc2 = InStr(1, text1, controlloinc2) - 20
         posizinc3 = InStr(1, text1, controlloinc3) - 20
         
         If posizinc1 = -20 Then posizinc1 = 1000000
         If posizinc2 = -20 Then posizinc2 = 1000000
         If posizinc3 = -20 Then posizinc3 = 1000000
         
         
         If posizinc1 > 0 And posizinc1 < posizinc2 And posizinc1 < posizinc3 Then
         posizinc2 = -20
         posizinc3 = -20
         End If
         If posizinc2 > 0 And posizinc2 < posizinc1 And posizinc2 < posizinc3 Then
         posizinc1 = -20
         posizinc3 = -20
         End If
         If posizinc3 > 0 And posizinc3 < posizinc2 And posizinc3 < posizinc1 Then
         posizinc2 = -20
         posizinc1 = -20
         End If
         
         
                        
         If posizinc1 <> -20 Then
         posizinc = posizinc1
         controlloinc = controlloinc1
         End If
         If posizinc2 <> -20 Then
         posizinc = posizinc2
         controlloinc = controlloinc2
         End If
         If posizinc3 <> -20 Then
         posizinc = posizinc3
         controlloinc = controlloinc3
         End If
         
                        
         posizinc = InStr(1, text1, controlloinc) - 20
         


        text1 = Trim(Mid(text1, 1, posizinc))
        
        ' inizio ricerca dati
        
        
2       controllo1 = "in-match"
        ninc = (Len(text1) - Len(Replace(text1, controllo1, ""))) / Len(controllo1)
        
        If ninc = 0 Then GoTo 60
        ' inizio ricerca dati
        
5       Rows("1:" & ninc).Insert Shift:=xlDown
        posin = 1
        
        
        For t = 1 To ninc
        Application.StatusBar = "Cerco risultati HT per: " & naz & "  " & lega & " : " & t & " di " & ninc
        
        If Cells(1, 1) = "" Then
        x = 1
        GoTo 7
        End If
        If Cells(1, 1) <> "" And Cells(2, 1) = "" Then
        x = 2
        GoTo 7
        End If
        
        Range("A1").End(xlDown).Offset(1, 0).Select
       
        x = ActiveCell.Row
        ' ricerca ris HT
        
7        If son = "N" Then GoTo 20
        
        controllolink1 = "<tr><td class="
        lenlink1 = Len(controllolink1)
        controllolink2 = "class="
        posizlink1 = InStr(posin, text1, controllolink1) + lenlink1 + 20
        posizlink2 = InStr(posizlink1, text1, controllolink2)
        linkhh = Trim(Mid(text1, posizlink1, posizlink2 - posizlink1))
        
        url1 = "https://www.betexplorer.com" & linkhh
        
Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend
texthh = http1.responseText
texthh = Replace(texthh, Chr(34), "")
Set http1 = Nothing
        
        con1 = "js-partial"
        lencon1 = Len(con1)
        con2 = ":"
        con3 = ","
        con4 = "</h2>"
        pos1 = InStr(1, texthh, con1) + lencon1 + 2
        testaw = Trim(Mid(texthh, pos1, 4))
        If testaw = "nbsp" Then
        posx = InStr(1, texthh, "js-eventstage") + 14
        testaw = Trim(Mid(texthh, posx, 7))
        GoTo 20
        End If
        pos2 = InStr(pos1, texthh, con2)
        If pos2 - pos1 > 5 Then GoTo 20
        pos3 = InStr(pos2, texthh, con3)
        pos4 = InStr(pos3, texthh, con2)
        pos5 = InStr(pos4, texthh, con4)
        rsqh1 = Trim(Mid(texthh, pos1, pos2 - pos1))
        rsqa1 = Trim(Mid(texthh, pos2 + 1, pos3 - pos2 - 1))
        rsqh2 = Trim(Mid(texthh, pos3 + 1, pos4 - pos3 - 1))
        rsqa2 = Trim(Mid(texthh, pos4 + 1, pos5 - pos4 - 2))
        
        
        
        
        
        'sq1
        
20      controllo1 = "in-match"
        len1 = Len(controllo1)
        controllo2 = "<span>"
        len2 = Len(controllo2)
        controllo3 = "</span>"
        
        posiz1 = InStr(posin, text1, controllo1) + len1
        posiz2 = InStr(posiz1, text1, controllo2) + len2
        posiz3 = InStr(posiz2, text1, controllo3)
        sq1 = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        teststrong = InStr(1, sq1, "<strong>")
        If teststrong = 1 Then
        sq1 = Replace(sq1, "<strong>", "")
        sq1 = Replace(sq1, "</strong>", "")
        End If
        'sq2
        
        posiz2 = InStr(posiz3, text1, controllo2) + len2
        posiz3 = InStr(posiz2, text1, controllo3)
        sq2 = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        teststrong = InStr(1, sq2, "<strong>")
        If teststrong = 1 Then
        sq2 = Replace(sq2, "<strong>", "")
        sq2 = Replace(sq2, "</strong>", "")
        End If
        
        
        
        
        'risultato
        
        controllo4 = "/soccer/"
        controllo5 = ">"
        controllo6 = ":"
        controllo7 = "<"
        
        posiz1 = InStr(posiz3, text1, controllo4)
        posiz2 = InStr(posiz1, text1, controllo5) + 1
        If Trim(Mid(text1, posiz2, 1)) = "<" Then
        posin = posiz1
        Rows(x).Select
        Selection.Delete Shift:=xlUp
        GoTo 50
        End If
        posiz3 = InStr(posiz2, text1, controllo6)
        
        gsq1 = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        
        posiz4 = InStr(posiz3, text1, controllo7)
        gsq2 = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        ' quote
        
        controllo8 = "data-odd="
        len8 = Len(controllo8)
        controllo9 = ">"
        posiz5 = InStr(posiz4, text1, controllo8) + len8
        posiztest = InStr(posiz4, text1, controllo1)
        
        If posiztest <> 0 And posiztest < posiz5 Or posiz5 = 9 Then
        posiz6 = posiz4
        GoTo 30
        End If
        posiz6 = InStr(posiz5, text1, controllo9)
        quota1 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
        posiz5 = InStr(posiz5, text1, controllo8) + len8
        posiz6 = InStr(posiz5, text1, controllo9)
        quotax = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
        posiz5 = InStr(posiz5, text1, controllo8) + len8
        posiz6 = InStr(posiz5, text1, controllo9)
        quota2 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
       
        ' scrivo dati
        
30       If testaw = "Awarded" Then
        rsqh1 = gsq1: rsqa1 = gsq2: rsqh2 = 0: rsqa2 = 0
        End If
          If testaw = "Abandon" Then
        rsqh1 = gsq1: rsqa1 = gsq2: rsqh2 = 0: rsqa2 = 0
        End If
        Cells(x, 1) = sq1
        Cells(x, 2) = sq2
        Cells(x, 3) = quota1
        Cells(x, 4) = quotax
        Cells(x, 5) = quota2
        Cells(x, 6) = gsq1
        Cells(x, 7) = gsq2
        Cells(x, 8) = rsqh1
        If Cells(x, 8) = "" Then Cells(x, 8) = gsq1
        Cells(x, 9) = rsqa1
        If Cells(x, 9) = "" Then Cells(x, 9) = gsq2
        Cells(x, 10) = rsqh2
        If Cells(x, 10) = "" Then Cells(x, 10) = 0
        Cells(x, 11) = rsqa2
        If Cells(x, 11) = "" Then Cells(x, 11) = 0
        
        
        rsqh1 = "": rsqa1 = "": rsqh2 = "": rsqa2 = ""
        quota1 = "": quotax = "": quota2 = ""
        
        posin = posiz6
        
        

50  Next t

60    Sheets("DATI").Select
Application.StatusBar = ""

End Sub

Sub aggiornaquote()

Application.ScreenUpdating = False

Sheets("DATI").Select
Cells(4, 171) = Now()

For t = 7 To Cells(1, 2)

Inc = Sheets("DATI").[B1].Value


Application.StatusBar = "Aggiornamento Quote Incontro " & t - 7 & " di " & Inc - 7

If Cells(t, 169) <> "" Then GoTo 10

sq1 = Cells(t, 5)
sq2 = Cells(t, 6)
naz = Cells(t, 3)
lega = Cells(t, 4)
Shetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)

If naz = naz1 And lega = lega1 Then GoTo 5

naz1 = naz
lega1 = lega

' carico pagina con fixtures


url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/fixtures/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")
Set http1 = Nothing

5 posiz6 = 1
 
 
        controllo1 = "<span>" & sq1 & "</span> - <span>" & sq2 & "</span>"
        posiz1 = InStr(posiz6, text1, controllo1)
        
        If posiz1 = 0 Then GoTo 10
        
        controllo5 = "data-odd="
        len5 = Len(controllo5)
        controllo6 = "></a></td>"
        
        posiz5 = InStr(posiz1, text1, controllo5) + len5
        If posiz5 = 9 Then End
        posiz6 = InStr(posiz5, text1, controllo6)
        quota1 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, text1, controllo5) + len5
        posiz6 = InStr(posiz5, text1, controllo6)
        quotax = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, text1, controllo5) + len5
        posiz6 = InStr(posiz5, text1, controllo6)
        quota2 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
       Cells(t, 171) = quota1
       Cells(t, 172) = quotax
       Cells(t, 173) = quota2
       
       
       
       
       
10 Next t

Application.StatusBar = ""
Application.StatusBar = ""

End Sub

Sub cercaclassifiche()

Application.ScreenUpdating = False

Sheets("DATI").Select

riga = Sheets("DATI").Range("B1").Value

'--------- Pulizia Area dati da aggiornare -----------
Range("MH7:MM10000").ClearContents
Range("ND7:NF10000").ClearContents
'-------------------------------------------------------------------------


'-----------Ordinamento dati per attaccare in sequenza gli incontri dello stesso campionato---------------
 Range("A7:RF" & riga).Select
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("C7:C" & riga) _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("D7:D" & riga) _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("A7:A" & riga) _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    ActiveWorkbook.Worksheets("DATI").Sort.SortFields.Add Key:=Range("B7:B" & riga) _
        , SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("DATI").Sort
        .SetRange Range("A7:RF" & riga)
        .Header = xlGuess
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
'----------------Fine Ordinamento--------------------------------------------------------

For t = 7 To riga

naz = Cells(t, 3)
lega = Cells(t, 4)

If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)

If naz = naz1 And lega = lega1 Then GoTo 20

naz1 = naz
lega1 = lega

 Application.StatusBar = "Ricerca classifiche per: " & naz & "  " & lega

iniziolega = t
finelega = t
For x = t To Cells(1, 2)
If Cells(x, 3) = naz And Cells(x, 4) = lega Then finelega = finelega + 1
Next x
finelega = finelega - 1


' carico pagina
Application.Calculation = xlCalculationManual

Dim text1 As String

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send

While http1.readyState <> 4
        DoEvents
    Wend

text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")
 
 ' controllo campionato

controllomain = ">Main<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30
controllomain = ">Torneo"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30
controllomain = ">Play Offs<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30
controllomain = ">Apertura<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30

' ricerco link per tabelle

        
       ' controllo1 = "stats-menu-table li0 first"
       ' len1 = Len(controllo1)
       ' controllo2 = ">Overall</a></span></li><li class=stats-menu-home li1><span><a href="
       ' len2 = Len(controllo2)
       ' controllo3 = "?table=table&table_sub=home&"
       ' len3 = Len(controllo3)
       ' controllo4 = "&dcheck=0>"
       '
       ' posiz1 = InStr(1, text1, controllo1) + len1
       ' posiz2 = InStr(posiz1, text1, controllo2) + len2
       ' posiz3 = InStr(posiz2, text1, controllo3)
       ' posiz4 = posiz3 + len3
       '
       ' If posiz3 = 0 Then GoTo 30 ' Inserita modifica Sett 2019
       ' posiz5 = InStr(posiz3, text1, controllo4)
       '
       ' linktot = Trim(Mid(text1, posiz4, posiz5 - posiz4))
       
        controllo1 = "stats-menu-table li0 first"
        len1 = Len(controllo1)
        controllo2 = ">Overall</a></span></li><li class=stats-menu-home li1><span><a href="
        len2 = Len(controllo2)
        controllo3 = "?table=table&table_sub=home&"
        len3 = Len(controllo3)
        controllo4 = "&dcheck=0>"
        
        posiz1 = InStr(1, text1, controllo1) + len1
        posiz2 = InStr(posiz1, text1, controllo2) + len2
        posiz3 = InStr(posiz2, text1, controllo3)
        posiz4 = posiz3 + len3
        posiz5 = InStr(posiz3, text1, controllo4)
    
        linktot = Trim(Mid(text1, posiz4, posiz5 - posiz4))


' carico tabella tot
urltot = url1 & "standings/?table=table&table_sub=overall&" & linktot & "&dcheck=0"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", urltot, False
http1.send

While http1.readyState <> 4
        DoEvents
    Wend

text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")

 k = 1
        
        
        controllo1 = "rank col_rank no"
        len1 = Len(controllo1)
        controllo2 = "title=" 'Tag abbinata alla motivazione, ed esiste solo per le squadre in posizione classifica alta (promozione) o bassa (Relegazione)
        len2 = Len(controllo2)
        controllo3 = ">"
        len3 = Len(controllo3)
        controllo4 = ".</td>"
        controllo5 = "');>"
        controllo6 = "</a>"
        
         nsq = (Len(text1) - Len(Replace(text1, controllo1, ""))) / Len(controllo1) 'Calcola il numero totale delle squadre del campionato
       
        For q = iniziolega To finelega 'Scrive il numero tot squadre campionato
        Cells(q, 370) = nsq
        Next q
        
        
5        posiz1 = InStr(k, text1, controllo1)
        If posiz1 = 0 Then GoTo 10
        
        posiz2 = InStr(posiz1, text1, controllo2) + len2
        posiz3 = InStr(posiz1, text1, controllo3)
        
         If posiz3 < posiz2 Then
         mot = ""
         Else
        mot = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        End If
              
        posiz4 = InStr(posiz3, text1, controllo4)
        
        class = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        posiz5 = InStr(posiz4, text1, controllo5) + 4
        posiz6 = InStr(posiz5, text1, controllo6)
       
        sq = Trim(Mid(text1, posiz5, posiz6 - posiz5))
       
        For q = iniziolega To finelega
        If Cells(q, 5) = sq Then
        Cells(q, 346) = class 'Posizione classifica -> Totale -> Home
        Cells(q, 368) = mot 'Motivazioni Home
        End If
        If Cells(q, 6) = sq Then
        Cells(q, 347) = class 'Posizione classifica -> Totale -> Away
        Cells(q, 369) = mot 'Motivazioni Away
        End If
        Next q
        
        k = posiz6
        
       
        
        GoTo 5



10
Set http1 = Nothing
text1 = ""

' carico tabella home
urlh = url1 & "standings/?table=table&table_sub=home&" & linktot & "&dcheck=0"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", urlh, False
http1.send

While http1.readyState <> 4
        DoEvents
    Wend

text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")

 k = 1
        
        
        controllo1 = "rank col_rank no"
        len1 = Len(controllo1)
        controllo2 = "title=" 'Tag abbinata alla motivazione, ed esiste solo per le squadre in posizione classifica alta (promozione) o bassa (Relegazione)
        len2 = Len(controllo2)
        controllo3 = ">"
        len3 = Len(controllo3)
        controllo4 = ".</td>"
        controllo5 = "');>"
        controllo6 = "</a>"
        
     
15        posiz1 = InStr(k, text1, controllo1)
        If posiz1 = 0 Then GoTo 20
        
        posiz2 = InStr(posiz1, text1, controllo2) + len2
        posiz3 = InStr(posiz1, text1, controllo3)
        
         If posiz3 < posiz2 Then
         mot = ""
         Else
        mot = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        End If
              
        posiz4 = InStr(posiz3, text1, controllo4)
        
        class = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        posiz5 = InStr(posiz4, text1, controllo5) + 4
        posiz6 = InStr(posiz5, text1, controllo6)
       
        sq = Trim(Mid(text1, posiz5, posiz6 - posiz5))
  
        For q = iniziolega To finelega
        If Cells(q, 5) = sq Then
        Cells(q, 348) = class 'Posizione classifica -> Home -> Home
        
        End If
        If Cells(q, 6) = sq Then
        Cells(q, 349) = class 'Posizione classifica -> Home -> Away
       
        End If
        Next q
        
        k = posiz6
        
        GoTo 15



20
Set http1 = Nothing
text1 = ""

' carico tabella away
urla = url1 & "standings/?table=table&table_sub=away&" & linktot & "&dcheck=0"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", urla, False
http1.send

While http1.readyState <> 4
        DoEvents
    Wend

text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")


 k = 1
        
        controllo1 = "rank col_rank no"
        len1 = Len(controllo1)
        controllo2 = "title=" 'Tag abbinata alla motivazione, ed esiste solo per le squadre in posizione classifica alta (promozione) o bassa (Relegazione)
        len2 = Len(controllo2)
        controllo3 = ">"
        len3 = Len(controllo3)
        controllo4 = ".</td>"
        controllo5 = "');>"
        controllo6 = "</a>"
   
        
25        posiz1 = InStr(k, text1, controllo1)
        If posiz1 = 0 Then GoTo 30
        
        posiz2 = InStr(posiz1, text1, controllo2) + len2
        posiz3 = InStr(posiz1, text1, controllo3)
        
         If posiz3 < posiz2 Then
         mot = ""
         Else
        mot = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        End If
              
        posiz4 = InStr(posiz3, text1, controllo4)
        
        class = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        posiz5 = InStr(posiz4, text1, controllo5) + 4
        posiz6 = InStr(posiz5, text1, controllo6)
       
        sq = Trim(Mid(text1, posiz5, posiz6 - posiz5))
        
        
       
        For q = iniziolega To finelega
        If Cells(q, 5) = sq Then
        Cells(q, 350) = class 'Posizione classifica -> Away-> Home
           End If
        If Cells(q, 6) = sq Then
        Cells(q, 351) = class 'Posizione classifica -> Away -> Away
         End If
        Next q
        
        k = posiz6
        
        GoTo 25
        
30

Set http1 = Nothing
text1 = ""

Next t
Application.Calculation = xlCalculationAutomatic

Foglio1.OrdinaDati

Application.StatusBar = ""
End Sub
Sub risultati()
'Ultimo Aggiornamento 20 Ott 2019

Application.Calculation = xlCalculationManual
Dim dataincontro As Date
Dim dataincontro2 As Date

Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

For x = 7 To Cells(1, 2)

dataincontro2 = Cells(x, 1)
oraincontro2 = Cells(x, 2)
orariolimiteincontro = dataincontro2 + (oraincontro2 + 0.083333)

naz = Cells(x, 3)
lega = Cells(x, 4)
sq1 = Cells(x, 5)
sq2 = Cells(x, 6)

If orariolimiteincontro > Now() Then GoTo 10

If Cells(x, 169) = "" Or Cells(x, 170) = "" Or Cells(x, 371) = "" Or Cells(x, 372) = "" Or Cells(x, 373) = "" Or Cells(x, 374) = "" Then 'And orariolimiteincontro < Now() Then

Shetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)

'If naz = naz1 And lega = lega1 Then GoTo 5
Application.StatusBar = "Cerco risultati per: " & naz & "  " & lega
'naz1 = naz
'lega1 = lega



'---Inizio elaborazione Gol Full Time--------------------------
' carico pagina web
'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/results/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")

' cerco incontro
  

5        controllo1 = "<span>" & sq1 & "</span> - <span>" & sq2 & "</span>"
         controlloinc1 = "<span>" & sq1 & "</span> - <span>" & sq2 & "</span>"
         controlloinc2 = "<span><strong>" & sq1 & "</strong></span> - <span>" & sq2 & "</span>"
         controlloinc3 = "<span>" & sq1 & "</span> - <span><strong>" & sq2 & "</strong></span>"
        
         posizinc1 = InStr(1, text1, controlloinc1) - 20
         posizinc2 = InStr(1, text1, controlloinc2) - 20
         posizinc3 = InStr(1, text1, controlloinc3) - 20
                        
         If posizinc1 = -20 Then posizinc1 = 1000000
         If posizinc2 = -20 Then posizinc2 = 1000000
         If posizinc3 = -20 Then posizinc3 = 1000000
         
         
         If posizinc1 > 0 And posizinc1 < posizinc2 And posizinc1 < posizinc3 Then
         posizinc2 = -20
         posizinc3 = -20
         End If
         If posizinc2 > 0 And posizinc2 < posizinc1 And posizinc2 < posizinc3 Then
         posizinc1 = -20
         posizinc3 = -20
         End If
         If posizinc3 > 0 And posizinc3 < posizinc2 And posizinc3 < posizinc1 Then
         posizinc2 = -20
         posizinc1 = -20
         End If
         
         
                        
         If posizinc1 <> -20 Then
         controllo1 = controlloinc1
         End If
         If posizinc2 <> -20 Then
         controllo1 = controlloinc2
         End If
         If posizinc3 <> -20 Then
         controllo1 = controlloinc3
         End If
         



       len1 = Len(controllo1)
        controllo2 = "/>"
        controllo3 = ":"
        controllo4 = "</a>"
        
        posiz1 = InStr(1, text1, controllo1)
        If posiz1 = 0 Then GoTo 10
        Application.StatusBar = "Cerco risultati per: " & naz & "  " & lega & "  " & sq1 & "-" & sq2
        posiz1 = InStr(1, text1, controllo1) + len1 + 11
        
        controllohh1 = "><a href="
        controllohh2 = ">"
        posizhh1 = InStr(posiz1 - 100, text1, controllohh1) + 9
        posizhh2 = InStr(posizhh1, text1, controllohh2)
        linkhh = Trim(Mid(text1, posizhh1, posizhh2 - posizhh1)) 'Estrae Link squadra di casa
        
        'Inserire codice per identificare gli incontri posticipati "POSTP."
        controllopostp1 = "POSTP." '20 Ott 2019
        posizpostp = InStr(posizhh2, text1, controllopostp1) '20 Ott 2019
        
        posiz1 = InStr(posiz1, text1, controllo4) - 10
        posiz1 = InStr(posiz1, text1, controllo2) + 2
        posiz2 = InStr(posiz1, text1, controllo3)
        
        If posizpostp > 0 And posizpostp < posiz1 Then '20 Ott 2019 - Nel caso trovi la stringa POSTP.
        Cells(x, 169) = "" 'Pulisce le celle
        Cells(x, 170) = "" 'Pulisce le celle
        
        Cells(x, 371) = "" 'Pulisce le celle
        Cells(x, 372) = "" 'Pulisce le celle
        Cells(x, 373) = "" 'Pulisce le celle
        Cells(x, 374) = "" 'Pulisce le celle
        GoTo 10 '20 Ott 2019
        End If
        
        golsq1 = Trim(Mid(text1, posiz1, posiz2 - posiz1)) 'Estrae gol squadra di casa
        
        posiz2 = posiz2 + 1
        posiz3 = InStr(posiz2, text1, controllo4)
        
        golsq2 = Trim(Mid(text1, posiz2, posiz3 - posiz2)) 'Estrae gol squadra ospite
        
        controllodata = "h-text-right h-text-no-wrap"
        controllodatabis = "</td></tr>"
        
        lendata = Len(controllodata) + 1
        posiz4 = InStr(posiz3, text1, controllodata) + lendata
        posizdatafin = InStr(posiz4, text1, controllodatabis)
        datainc = Trim(Mid(text1, posiz4, posizdatafin - posiz4)) 'Estrae la data dell'incontro su pagina risultati
           
        'gg = Mid(datainc, 1, 2)
        'mm = Mid(datainc, 4, 2)
        'hh = Mid(datainc, 7, 4)
        'dataincontro = gg & "/" & mm & "/" & hh 'Formatta la data incontro
        
        '----------------- Elaborazione Data ------------------
        If Mid(datainc, 1, 8) = "Tomorrow" Then
           datainc = Replace(datainc, "Tomorrow", Date + 1)
        End If
        
        If Mid(datainc, 1, 5) = "Today" Then
           datainc = Replace(datainc, "Today", Date)
        End If
        
        If Mid(datainc, 1, 9) = "Yesterday" Then
           datainc = Replace(datainc, "Yesterday", Date - 1)
        End If
        
        If Len(datainc) <= 12 And Mid(datainc, 6, 1) = "." Then
           parziale = Mid(datainc, 1, 6)
           anno = Year(Date)
           datainc = datainc & anno
        End If
        '----------------- Fine Elaborazione Data -------------
               
        orainc = Trim(Mid(datainc, 11, 6))
        gg = Mid(datainc, 1, 2)
        mm = Mid(datainc, 4, 2)
        hh = Mid(datainc, 7, 4)
        dataincontro = gg & "/" & mm & "/" & hh
        
        
        
        
        
        
        d = dataincontro2 - dataincontro 'Sottrae la data incontro prelevata da excel a quella prelevata sul web per confronto successivo
  
    text1 = ""
    Set http1 = Nothing
        
        If d > 7 Then GoTo 10
        
        Cells(x, 169) = golsq1 'Scrive i gol su foglio excel
        Cells(x, 170) = golsq2 'Scrive i gol su foglio excel
        'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"
     
     
'---Fine elaborazione Gol Full Time----------------------------------


'---Inizio elaborazione Gol Primo Tempo/Secondo Tempo---------------------
        
        url1 = "https://www.betexplorer.com" & linkhh

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
While http1.readyState <> 4 'Set 2019 - Aggiunta attesa caricamento pagina
      DoEvents
Wend
texthh = http1.responseText
texthh = Replace(texthh, Chr(34), "")
        

        contro1 = "js-partial"
        lencontro1 = Len(contro1)
        contro2 = ":"
        contro3 = ","
        contro4 = "</h2>"
        pos1 = InStr(1, texthh, contro1) + lencontro1 + 2
        pos2 = InStr(pos1, texthh, contro2)
        If pos2 - pos1 > 5 Then GoTo 10
        pos3 = InStr(pos2, texthh, contro3)
        pos4 = InStr(pos3, texthh, contro2)
        pos5 = InStr(pos4, texthh, contro4)
        rsqh1 = Trim(Mid(texthh, pos1, pos2 - pos1))
        rsqa1 = Trim(Mid(texthh, pos2 + 1, pos3 - pos2 - 1))
        rsqh2 = Trim(Mid(texthh, pos3 + 1, pos4 - pos3 - 1))
        rsqa2 = Trim(Mid(texthh, pos4 + 1, pos5 - pos4 - 2))
        
        Cells(x, 371) = rsqh1
        Cells(x, 372) = rsqa1
        Cells(x, 373) = rsqh2
        Cells(x, 374) = rsqa2
   End If
        
10 Next x
Calculate
Application.Calculation = xlCalculationAutomatic
Application.StatusBar = ""

End Sub


Attribute VB_Name = "Questa_cartella_di_lavoro"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()
    Sheets("Data").Visible = xlSheetVeryHidden
End Sub
Attribute VB_Name = "SENATORE"
Attribute VB_Base = "0{084BCBCC-4A66-45E5-B9CB-25999211BA8A}{86691AA7-51F7-425B-AD07-F919F270539F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public SENATORE_FORM_NOMSG As Boolean   '-MOD FabioGK Nov2019
'

Private Sub CommandButton1_Click()
    Dim R
    
    Range("A2:B1000").Select
        Selection.ClearContents
    For R = 0 To ListBox1.ListCount - 1
        If ListBox1.Selected(R) = True Then
            x = LCase(ListBox1.List(R))
            posx = InStr(1, x, " - ")
            Cells((Cells(1, 2) + 2), 1) = Trim(Mid(x, 1, posx))
            Cells((Cells(1, 2) + 1), 2) = Trim(Mid(x, posx + 3))
            
            ListBox1.Selected(R) = False
        End If
    Next
    
    If CheckBox3 = True Then Cells(2, 15) = "S"
    If CheckBox3 = False Then Cells(2, 15) = "N"
    If CheckBox1 = True Then Cells(3, 15) = "S"
    If CheckBox1 = False Then Cells(3, 15) = "N"
    If CheckBox2 = True Then Cells(4, 15) = "S"
    If CheckBox2 = False Then Cells(4, 15) = "N"
    If CheckBox4 = True Then Cells(5, 15) = "S"
    If CheckBox4 = False Then Cells(5, 15) = "N"
    
    SENATORE.Hide
End Sub




Private Sub CommandButton2_Click()
For R = 0 To ListBox1.ListCount - 1
 ListBox1.Selected(R) = True
Next
End Sub

Private Sub CommandButton3_Click()
For R = 0 To ListBox1.ListCount - 1
 ListBox1.Selected(R) = False
Next
End Sub

Private Sub ListBox1_Click()

End Sub

Private Sub UserForm_Activate()
    
    '- MOD FabioGK - Nov2019
    
    Dim R
    
    SENATORE_FORM_EXIT = False
    SENATORE_FORM_NOMSG = True
    
    fin1 = Sheets("CAMP").Range("E" & Rows.Count).End(xlUp).Row
    fin2 = Sheets("CAMP").Range("F" & Rows.Count).End(xlUp).Row
    If fin1 < 2 Or fin2 < 2 Or fin1 <> fin2 Then
        MsgBox ("ERRORE nella lista campionati - Controllare foglio CAMP colonna E e F")
        Unload Me
        Exit Sub
    End If
    
    ListBox1.Clear
    For t = 2 To fin1
        stringa = StrConv(Trim(Sheets("CAMP").Cells(t, "E")), vbUpperCase) & " - " & StrConv(Trim(Sheets("CAMP").Cells(t, "F")), vbProperCase)
        ListBox1.AddItem
        ListBox1.List(t - 2) = stringa
    Next t
    
    For t = 2 To Cells(1, 2) + 1
        stringa = StrConv(Cells(t, 1), vbUpperCase) & " - " & StrConv(Cells(t, 2), vbProperCase)
        For R = 0 To ListBox1.ListCount - 1
            If ListBox1.List(R) = stringa Then
                ListBox1.Selected(R) = True
            End If
        Next
        If Cells(2, 15) = "S" Then CheckBox3 = True
        If Cells(2, 15) = "N" Then CheckBox3 = False
        If Cells(3, 15) = "S" Then CheckBox1 = True
        If Cells(3, 15) = "N" Then CheckBox1 = False
        If Cells(4, 15) = "S" Then CheckBox2 = True
        If Cells(4, 15) = "N" Then CheckBox2 = False
        If Cells(5, 15) = "S" Then CheckBox4 = True
        If Cells(5, 15) = "N" Then CheckBox4 = False
        
    Next t
    SENATORE_FORM_NOMSG = False
End Sub

Private Sub Command_CancellaTutto_Click()
        
    '- MOD FabioGK - Nov2019
        
        messaggio = "CANCELLA TUTTI I FOGLI CAMPIONATO" & Chr(13)
        messaggio = messaggio & Chr(13) & ">>> CANCELLO ??? (necessita riscaricarli)"
        response = MsgBox(messaggio, vbYesNoCancel + vbDefaultButton1, "CANCELLA")
        If response = vbYes Then
            
            fin1 = Range("E" & Rows.Count).End(xlUp).Row
            For t = 2 To fin1
                naz = Trim(Cells(t, 5))   'colonna E
                lega = Trim(Cells(t, 6))  'colonna F
                sheetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
                    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
                If Len(sheetname) > 31 Then sheetname = Left(sheetname, 31)
                
                For Each foglio In Worksheets
                    If foglio.Name = sheetname Then
                        Application.DisplayAlerts = False
                        foglio.Delete
                        Application.DisplayAlerts = True
                    End If
                Next foglio
            Next t
        
        End If
    SENATORE_FORM_EXIT = True
    Unload Me

End Sub

Private Sub Command_Esci_Click()
    SENATORE_FORM_EXIT = True
    Unload Me
End Sub

Private Sub UserForm_Terminate()
    SENATORE_FORM_EXIT = True
End Sub

Private Sub CheckBox2_Click()
    If SENATORE_FORM_NOMSG Then Exit Sub
    'If CheckBox2 Then
        messaggio = "Ricerca 1T/2T - ATTENZIONE:" & Chr(13)
        messaggio = messaggio & Chr(13) & "Per avere dati corretti 1T |fffd| consigliabile cancellare"
        messaggio = messaggio & Chr(13) & "tutti i fogli e lasciare sempre selezionata l'opzione"
        messaggio = messaggio & Chr(13) & "durante tutte le ricerche e aggiornamenti futuri."
        response = MsgBox(messaggio, , "Opzione 1T/2T")
    'End If
End Sub


Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


INQUEST-PP=macro
