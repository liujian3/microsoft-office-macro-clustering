Attribute VB_Name = "Archiv"
Sub Krankentage_berechnen_vom_B|fffd|ro(Art) 'Monatsbl|fffd|tter
Var_zuweisen
Application.ScreenUpdating = False

KK = Array("K", "KN", "KO", "KK", "A", "Ku", "R", "RO", "We")
NB = "."
We = "/"

Z = 4
u = 1



Sprung3:
p = 0: p1 = 0: p2 = 0
Set AT = ThisWorkbook.ActiveSheet
ATNa = AT.Name

p = InStr(1, ATNa, "2019")
p1 = InStr(1, ATNa, "2020")
p2 = InStr(1, ATNa, "2021")


'If p = 0 And p1 = 0 And p2 = 0 Then
'    Msg = MsgBox("Es ist ein falsches Tabellenblatt ausgew|fffd|hlt worden", vbOKOnly, "Fehler-Hinweis")
'    End
'End If


If Art = "M" Then
    If p = 0 And p1 = 0 And p2 = 0 Then
        MSG = MsgBox("Es ist ein falsches Tabellenblatt ausgew|fffd|hlt worden", vbOKOnly, "Fehler-Hinweis")
        End
    End If
    
    MSG = MsgBox("Soll der Monat " & ATNa & " bearbeitet werden?", vbOKCancel, "Bearbeitung des ausgew|fffd|hlten Monats")
    If MSG = vbCancel Then
        End
    End If
End If


If Cells(3, 2) = 1 Then s = 2
If Cells(3, 4) = 1 Then s = 4
'Cells(5, S).Select
'ActiveWindow.FreezePanes = True


If Art = "A" Then
    AnzB = ThisWorkbook.Sheets.Count
    For t = u To AnzB
        If p > 0 Or p1 > 0 Or p2 > 0 Then
            GoTo Bearbeitung
        End If
        
    
    Next t
    GoTo Sprung4:
End If




Bearbeitung:

'Krankheitstage

LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
LS = ActiveSheet.Cells(3, 4).End(xlToRight).Column
LZZ = LZ - Z

KTG = 0

For i = 1 To LZZ ' Schleife Mitarbeiter
    KI = 1
    KIG = 0
    KTV = 0: KIV = 0
    KT = 0: KV = 0
    VKT = 0
    q1 = 0: q2 = 0
    If Left(ATNa, 3) <> "Jan" Then VMKontrolle = 1 Else VMKontrolle = 0
    For j = 4 To LS 'Schleife Tage im Monat
        If j = 4 Then MA = ActiveSheet.Cells(i + Z, 1) 'Mitarbeiter
       'If MA = "Schwarz, Ina" Then Stop
        
        
        W = ActiveSheet.Cells(i + Z, j)    'Eintrag je Tag
        If W <> "F" Then
            If InStr(1, ".", W) > 0 Then
                VMKontrolle = 0
                KI = 1
            Else
                For a = 0 To 8
                    If InStr(1, KK(a), W) > 0 Then
                        KT = KT + 1  'Krankheitstage im Monat z|fffd|hlen, wenn K|fffd|rzel erf|fffd|llt
                        'p = 0
                        
                        If VMKontrolle = 1 Then 'Kontrolle auf Vormonat
                            VMonat = Monate_bestimmen(ATNa)
                            Set EW = ThisWorkbook.Worksheets(VMonat)
                            On Error Resume Next
                                SW = EW.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                                If Err > 0 Then
                                    Err = 0
                                    KI = 1
                                End If
                            On Error GoTo 0
                            KVM = 0
                            LSV = EW.Cells(3, 4).End(xlToRight).Column
                            Freecell = LSV
                            R = EW.Cells(SW, Freecell)
                            Do While R <> "." And R <> "U"
                                R = EW.Cells(SW, Freecell)
                                For B = 0 To 8
                                    If InStr(1, KK(B), R) > 0 Then
                                        VKT = 1
                                        KI = 0
                                        KVM = KVM + 1
                                        'Exit Do
                                        Exit For
                                    End If
                                
                                Next B
                                Freecell = Freecell - 1
                                If Freecell = 0 Then
                                    VMonat = Monate_bestimmen(VMonat)
                                    If InStr(1, VMonat, "2018") Then
                                        Exit Do
                                    Else
                                        Set EW = ThisWorkbook.Worksheets(VMonat)
                                        On Error Resume Next
                                        SW = EW.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                                        If Err > 0 Then
                                            Err = 0
                                            KI = 1
                                        End If
                                        On Error GoTo 0
                                        KVM = 0
                                        LSV = EW.Cells(3, 4).End(xlToRight).Column
                                        Freecell = LSV
                                        R = EW.Cells(SW, Freecell)
                                        Do While R <> "." And R <> "U"
                                            R = EW.Cells(SW, Freecell)
                                            For B = 0 To 8
                                                If InStr(1, KK(B), R) > 0 Then
                                                    VKT = 1
                                                    KI = 0
                                                    KVM = KVM + 1
                                                    'Exit Do
                                                    Exit For
                                                End If
                                            
                                            Next B
                                            Freecell = Freecell - 1
                                        Loop
                                    End If
                                End If
                                R = EW.Cells(SW, Freecell)
                            Loop
                            
                            VMKontrolle = 0
                        Else
                            
                        End If 'Ende Vormonat
                        KIG = KIG + KI
                        KI = 0
                        GoTo Sprung1
                    Else
                    
                    End If

                Next a
            End If
Sprung1:
        End If
    Next j
    'If InStr(1, MA, "Walle") Then Stop
    ActiveSheet.Cells(i + Z, LS + 1) = KT
    KTG = KTG + KT
    ActiveSheet.Cells(i + Z, LS + 3) = KIG
    
    
    If Left(ATNa, 3) = "Jan" Then
        ActiveSheet.Cells(i + Z, LS + 2) = KT
        ActiveSheet.Cells(i + Z, LS + 4) = KIG
        
    Else
        'VMonat = Monate_bestimmen(ATNa)
        BNI = ActiveSheet.Index
        SW = 0
        NoDa = 0
        Do Until SW > 0
            q1 = q1 + 1
            q2 = BNI - q1
            If q2 = 3 Then
                NoDa = 1
                Exit Do
            End If
            Set EW = ThisWorkbook.Sheets(q2)
            BN = EW.Name
            'If InStr(1, MA, "Walle") Then Stop
            LSV = EW.Cells(3, 4).End(xlToRight).Column
            On Error Resume Next
            SW = 0
            SW = EW.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
            If SW > 0 Then
                Err = 0
                'Stop
                On Error GoTo 0
                Exit Do
            End If
            On Error GoTo 0
        Loop
        
        If NoDa = 1 Then
            KTV = 0
            KIV = 0
        Else
            KTV = EW.Cells(SW, LSV + 2)
            KIV = EW.Cells(SW, LSV + 4)
        End If
        ActiveSheet.Cells(i + Z, LS + 2) = KT + KTV
        ActiveSheet.Cells(i + Z, LS + 4) = KIG + KIV
    End If
    
    
   
Next i ' Ende Schleife Mitarbeiter

ActiveSheet.Cells(LZ + 1, LS + 1) = KTG

If Left(ATNa, 3) = "Jan" Then
    ActiveSheet.Cells(LZ + 1, LS + 2) = KTG
Else
    LZV = EW.Cells(5, LSV + 1).End(xlDown).Row
    KTGV = EW.Cells(SW + 1, LSV + 2)
    ActiveSheet.Cells(LZ + 1, LS + 2) = KTGV + KTG
End If

i = i0

Sprung4:
If Art = "A" Then
    u = u + 1
    On Error Resume Next
    If Err > 0 Then
        On Error GoTo 0
    Else
        ThisWorkbook.Sheets(u).Activate
        GoTo Sprung3
    End If
    
End If

Sheets(ATNa).Activate
Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "DieseArbeitsmappe"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
'Option Explicit

Private Sub Workbook_Activate()
    On Error Resume Next
    Workbook_Open
End Sub

Private Sub Workbook_Deactivate()
    On Error Resume Next
    MenuBars(xlWorksheet).Menus("Krankentage").Delete
End Sub

Private Sub Workbook_Open()

    On Error Resume Next
    Application.CommandBars.ActiveMenuBar.Controls("Aktualisieren").Delete
    Application.CommandBars.ActiveMenuBar.Controls("Makro einrichten").Delete
    
    With Application.CommandBars.ActiveMenuBar.Controls.Add(Type:=msoControlPopup, Temporary:=True)
        On Error GoTo 0
        .Caption = "&Aktualisieren"
        'erster Men|fffd|punkt
        With .Controls.Add(Type:=msoControlPopup)
            .Caption = "&Monat aktualisieren"
            With .Controls.Add
                .FaceId = 18
                .Caption = "&einzelnen"
                .OnAction = "Krankentage.Auswahl_Monat_M0"
            End With
            With .Controls.Add
                .FaceId = 53
                .Caption = "&alle"
                .OnAction = "Krankentage.Auswahl_Monat_A0"
            End With
        End With
        'Zweiter Men|fffd|punkt
        With .Controls.Add
            .FaceId = 36
            .Caption = "&Jahres|fffd|bersicht aktualisieren"
            .OnAction = "Jahres|fffd|bersicht.Daten_in_Jahres|fffd|bersicht_einf|fffd|gen"
        End With
    End With
    
    With Application.CommandBars.ActiveMenuBar.Controls.Add(Type:=msoControlPopup, Temporary:=True)
        .Caption = "&Makro einrichten"
         With .Controls.Add(Type:=msoControlPopup)
            .Caption = "&Import-Dateien Format erzeuen"
            With .Controls.Add
                .FaceId = 18
                .Caption = "&einzelnen"
                .OnAction = "Import_formatieren.Auswahl_Monat_M1"
            End With
            With .Controls.Add
                .FaceId = 53
                .Caption = "&alle"
                .OnAction = "Import_formatieren.Auswahl_Monat_A1"
            End With
        End With
        With .Controls.Add
            .FaceId = 36
            .Caption = "&Jahres|fffd|bersicht zur|fffd|cksetzen"
            .OnAction = "Jahres|fffd|bersicht.Jahres|fffd|bersicht_zur|fffd|cksetzen"
        End With
        With .Controls.Add
            .FaceId = 36
            .Caption = "&Mitarbeiter in Jahres|fffd|bersicht |fffd|bernehmen"
            .OnAction = "Jahres|fffd|bersicht.Mitarbeiter_in_Jahres|fffd|bersicht_|fffd|berf|fffd|hren"
        End With
        
        
    End With
End Sub



Private Sub Workbook_SheetBeforeDoubleClick(ByVal Sh As Object, ByVal Target As Range, Cancel As Boolean)
Dim shtFirst%, shtLast%
shtFirst = Worksheets("Januar 2019").Index
AnzB = ThisWorkbook.Worksheets.Count

Z = Target.Row
s = Target.Column
MA = Cells(Z, 1) ' Mitarbeiter


shtLast = Worksheets(AnzB).Index
B = ActiveSheet.Index
If B <= shtLast And B >= shtFirst Then
   'Stop
    With Target
        If .Address = "$A$3" Then
            Worksheets("Jahres|fffd|bersicht").Activate
            End
        End If
    End With
'    LZ = ThisWorkbook.Worksheets(b).Cells(5, 1).End(xlDown).Row
'    If S = 1 And Z > 4 And Z < LZ Then
'        If InStr(1, MA, ",") > 0 Then
'            m = MsgBox("Jahres|fffd|bersicht f|fffd|r " & MA & " anzeigen?", vbOKCancel, "Hinweis")
'            If m = vbCancel Then End
'            Call Jahres|fffd|bersicht_je_Person(MA, Z)
'
'        End If
'        End
'    End If
    
    
End If



If B = 2 Then
    If s = 1 And Z = 1 Then
        ThisWorkbook.Worksheets(3).Activate
    End If
    If s = 1 And Z > 5 Then
        MA = Cells(2, 1)
        W = Cells(Z, 1)
        If InStr(1, W, "20") > 0 Then
            m = MsgBox("Daten f|fffd|r " & MA & " aus " & W & " anzeigen?", vbOKCancel, "Hinweis")
            W = Left(W, 3)
            If m = vbOK Then
                If W = "Jan" Then e = 4
                If W = "Feb" Then e = 5
                If W = "M|fffd|r" Then e = 6
                If W = "Apr" Then e = 7
                If W = "Mai" Then e = 8
                If W = "Jun" Then e = 9
                If W = "Jul" Then e = 10
                If W = "Aug" Then e = 11
                If W = "Sep" Then e = 12
                If W = "Okt" Then e = 13
                If W = "Nov" Then e = 14
                If W = "Dez" Then e = 15
                
                ThisWorkbook.Sheets(e).Activate
                On Error Resume Next
                SW = ActiveSheet.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                If Err > 0 Then
                    MsgBox "Mitarbeiter " & MA & " konnte im Monat " & W & " nicht gefunden werden! Bitte |fffd|berpr|fffd|fen.", vbOKOnly, "Fehler-Hinweis"
                
                
                End If
                ActiveSheet.Cells(SW, 1).EntireRow.Select
                End
            End If
        
        End If
    
    End If
    
End If

If B = 3 Then
    LZ = ThisWorkbook.Worksheets(3).Cells(4, 1).End(xlDown).Row
    If s > 3 And s < 52 And Z > 5 And Z < LZ Then
       
        W = Cells(3, s) 'Monat
       
       
        'If w = "" Then
        Do Until W <> ""
            s = s - 1
            W = Cells(3, s)
        Loop
        
        
       
       
        m = MsgBox("Daten f|fffd|r " & MA & " aus " & W & " anzeigen?", vbOKCancel, "Hinweis")
    
        If m = vbOK Then
            If W = "Jan" Then e = 4
            If W = "Feb" Then e = 5
            If W = "M|fffd|r" Then e = 6
            If W = "Apr" Then e = 7
            If W = "Mai" Then e = 8
            If W = "Jun" Then e = 9
            If W = "Jul" Then e = 10
            If W = "Aug" Then e = 11
            If W = "Sep" Then e = 12
            If W = "Okt" Then e = 13
            If W = "Nov" Then e = 14
            If W = "Dez" Then e = 15
            
            ThisWorkbook.Sheets(e).Activate
            SW = ActiveSheet.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
            ActiveSheet.Cells(SW, 1).EntireRow.Select
            End
        End If
    End If
    If s = 1 Then
        If InStr(1, MA, ",") > 0 Then
            m = MsgBox("Jahres|fffd|bersicht f|fffd|r " & MA & " anzeigen?", vbOKCancel, "Hinweis")
            If m = vbCancel Then End
            Call Jahres|fffd|bersicht_je_Person(MA, Z)
        End If
    End If


End If

End Sub
Attribute VB_Name = "Import_formatieren"
Sub Auswahl_Monat_M1()
    
    BN = ActiveSheet.Name
    p = 0: p1 = 0

    p = InStr(1, BN, "201")
    p1 = InStr(1, BN, "202")
    If p > 0 Or p1 > 0 Then
        
    Else
        MSG = MsgBox("Falsches Tabellenblatt ausgew|fffd|hlt!", vbOKOnly + vbCritical, "Fehler-Hinweis")
       
        End
    End If
    
    MSG = MsgBox("Soll die Monatsdatei " & BN & " hinsichtlich der Struktur und Formatierung bearbeitet werden?", vbOKCancel, "Formatierung einzelner Monate")
    If MSG = vbCancel Then
        End
    End If
    Worksheets(BN).Activate
    Call Aktuelles_Blatt_formatieren
    MsgBox "Formatierung beendet", vbInformation + vbOKOnly, "Makro-Hinweis"
End Sub


Sub Auswahl_Monat_A1()
    
MSG = MsgBox("Sollen alle Monatsdateien hinsichtlich der Struktur und Formatierung bearbeitet werden?", vbOKCancel, "Bearbeitung aller Monate")
If MSG = vbCancel Then
    End
End If
Worksheets(1).Activate
Application.ScreenUpdating = False
AnzB = ThisWorkbook.Sheets.Count
For t = 1 To AnzB
    p = 0: p1 = 0
    ATNa = Worksheets(t).Name
    p = InStr(1, ATNa, "201")
    p1 = InStr(1, ATNa, "202")
    If p > 0 Or p1 > 0 Then
        Worksheets(t).Activate
        Call Aktuelles_Blatt_formatieren
    End If
Next t
Application.ScreenUpdating = True
MsgBox "Formatierung beendet", vbInformation + vbOKOnly, "Makro-Hinweis"
End Sub

Sub Aktuelles_Blatt_formatieren()
Application.ScreenUpdating = False
Set AW = ThisWorkbook
Set AB = AW.ActiveSheet
Set AWE = AW.Worksheets("Einstellungen")
MD1 = AWE.Range("MBereich")
If MD1(3, 2) = "x" Then KBereich = MD1(3, 1)
If MD1(2, 2) = "x" Then KBereich = MD1(2, 1)
If (MD1(3, 2) = "x" And MD1(2, 2) = "x") Or (MD1(3, 2) = "" And MD1(2, 2) = "") Then
    MSG = MsgBox("Die Bereichsauswahl unter ""Einstellungen"" ist nicht eindeutig. Bitte korrigieren! ", vbOKOnly, "Fehler-Hinweis")
    AWE.Activate
    End
End If

'AnzB = AW.Worksheets.Count
'Sheets("November 2019").Select
'Sheets(AB.Name).Copy After:=Sheets(AnzB)
'Sheets("Oktober 2019 (5)").Select
AB.Activate

Startdatum = Cells(2, 1) & " " & Cells(2, 2)
LS = ActiveSheet.Cells(3, 1).End(xlToRight).Column
With Range(Cells(1, 1), Cells(2, LS))
    .UnMerge
    With .Interior
        .Pattern = xlNone
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    .Borders(xlDiagonalDown).LineStyle = xlNone
    .Borders(xlDiagonalUp).LineStyle = xlNone
    .Borders(xlEdgeLeft).LineStyle = xlNone
    .Borders(xlEdgeTop).LineStyle = xlNone
    .Borders(xlEdgeBottom).LineStyle = xlNone
    .Borders(xlEdgeRight).LineStyle = xlNone
    .Borders(xlInsideVertical).LineStyle = xlNone
    .Borders(xlInsideHorizontal).LineStyle = xlNone
    
    .ClearContents
    
End With

Cells(2, 1) = Startdatum

We = Cells(3, LS)
Do Until IsNumeric(We) = True

    Columns(LS).Delete Shift:=xlToLeft
    LS = ActiveSheet.Cells(3, 1).End(xlToRight).Column
    We = Cells(3, LS)
Loop
'For LeZe = 1 To 5
'    Columns(LS1 + LeZe).Delete Shift:=xlToLeft
'Next

SW = Columns(1).Find(What:="Resturlaub gesamt", LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
Range(Cells(SW, 1), Cells(SW, LS)).ClearContents

LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
If Cells(3, 2) = 1 Then
    Range(Cells(3, 2), Cells(LZ + 14, 3)).Insert CopyOrigin:=xlFormatFromLeftOrAbove
End If

With Range(Cells(1, 1), Cells(200, 50)).Font
    .Name = "Calibri"
    .Size = 11
    .Strikethrough = False
    .Superscript = False
    .Subscript = False
    .OutlineFont = False
    .Shadow = False
    .Underline = xlUnderlineStyleNone
    .TintAndShade = 0
    .ThemeFont = xlThemeFontMinor
End With

Cells(4, 1) = Cells(3, 1)
Cells(3, 1) = "'--> Jahres|fffd|bersicht"

BN = ActiveSheet.Name
p = InStr(1, BN, " ")
BN = Left(BN, p - 1)
Cells(1, 1) = "Krankenstand " & Right(Startdatum, 4) & KBereich

Call Wochenenden_bearbeiten
Call Farbkorrektur_nach_Import
Call Formeln_einf|fffd|gen
Call Monatsblatt_Krankentage_vorbereiten
'Application.ScreenUpdating = True


End Sub
Sub Wochenenden_bearbeiten()

LS = Cells(3, 4).End(xlToRight).Column
LZ = Cells(5, 1).End(xlDown).Row
       
For i = 1 To LS
    WT = Cells(4, i)
    If WT = "Sa" Or WT = "So" Then
        For j = 5 To LZ
            t = Cells(j, i)
            If t <> "." And t <> "/" Then
                Cells(j, i).Interior.Color = RGB(0, 64, 128)
                Cells(j, i) = "/"
                Cells(j, i).Font.ThemeColor = xlThemeColorDark1
            End If
        Next j
    End If
    If WT = "NF" Or WT = "HF" Then
    For j = 5 To LZ
            t = Cells(j, i)
            If t <> "." And t <> "/" Then
                Cells(j, i).Interior.Color = RGB(0, 255, 255)
                Cells(j, i) = "F"
                Cells(j, i).Font.ThemeColor = xlThemeColorDark1
            End If
        Next j
    End If

Next i
 
Cells(5, 2).Select
ActiveWindow.FreezePanes = True

For i = 1 To LS
    WT = Cells(3, i)
    If IsNumeric(WT) And WT <> "" Then
        '.Cells(j, i).Interior.Color = 6299648
        Cells(3, i).EntireColumn.ColumnWidth = 3.5
        '.Cells(j, i).Font.ThemeColor = xlThemeColorDark1
    End If
Next i
 
End Sub

Sub Formeln_einf|fffd|gen()
LS = Cells(3, 4).End(xlToRight).Column
LZ = Cells(5, 1).End(xlDown).Row
R = 5
C = LZ
For i = 4 To LS


    'Cells(LZ + 3, i).FormulaR1C1 = "=COUNTIF(R[-87]C:R[-16]C,""BS"")"
    Cells(LZ + 3, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""BS"")"
    Cells(LZ + 4, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""D"")"
    Cells(LZ + 5, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""FS"")"
    Cells(LZ + 6, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""A"")"
    Cells(LZ + 7, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""K"")"
    Cells(LZ + 8, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""KN"")"
    Cells(LZ + 9, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""KO"")"
    Cells(LZ + 10, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""S"")"
    Cells(LZ + 11, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""U"")"
    Cells(LZ + 12, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""WB"")"
   
    'Cells(LZ + 13, i).FormulaR1C1 = "=SUM(R[-4]C:R[-7]C)"
    Cells(LZ + 13, i).FormulaR1C1 = "=SUM(R" & LZ + 13 - 4 & "C:R" & LZ + 13 - 7 & "C)"
    'AnzMit1 = Cells(LZ + 14 + 3, 1)
    'Cells(LZ + 14, i).FormulaR1C1 = "=R[-1]C*100/" & AnzMit1
    Cells(LZ + 14, i).FormulaR1C1 = "=R[-1]C*100/R[3]C[-" & i - 1 & "]"
Next i
   Range(Cells(LZ + 13, 4), Cells(LZ + 14, 38)).NumberFormat = "General"
   Range(Cells(LZ + 14, 4), Cells(LZ + 14, 38)).NumberFormat = "0.0"
   AnzMit = LZ - 4

Cells(LZ + 3, 1) = "Berufsschule"
Cells(LZ + 4, 1) = "Dienstreise"
Cells(LZ + 5, 1) = "Freistellung"
Cells(LZ + 6, 1) = "Summe Mitarbeiter krank nach Arbeitsunfall"
Cells(LZ + 7, 1) = "Summe Mitarbeiter krank"
Cells(LZ + 8, 1) = "Summe Mitarbeiter krank ohne Nachweis"
Cells(LZ + 9, 1) = "Summe Mitarbeiter Krank ohne EFZ"
Cells(LZ + 10, 1) = "Summe Mitarbeiter Sonderurlaub"
Cells(LZ + 11, 1) = "Summe Mitarbeiter Urlaub"
Cells(LZ + 12, 1) = "Summe Mitarbeiter Weiterbildung"
Cells(LZ + 13, 1) = "Summe kranke Mitarbeiter"
Cells(LZ + 14, 1) = "Krankenstand in Prozent"

SW = Columns(1).Find(What:="Summe anwesender Mitarbeiter", LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False).Row

KL = LZ + 20 - SW
KL1 = 3
Cells(LZ + 16, 1) = "Anz. Mitarbeiter:"
Cells(LZ + 17, 1) = AnzMit
Cells(LZ + 18, 1) = "Anz. Arbeitstage:"

Cells(LZ + 20, 1).FormulaR1C1 = "=COUNT(R[-" & KL & "]C[" & KL1 & "]:R[-" & KL & "]C[" & LS - 1 & "])"
MDat = Cells(2, 1)
MDat = Right(MDat, Len(MDat) - InStr(1, MDat, " "))
Cells(LZ + 19, 1) = AnzArbTageMonDat(MDat)

Range(Cells(4, 4), Cells(4, LS + 4)).AutoFilter

With Cells(4, LS + 1)
    If .Comment Is Nothing Then
    Else
        .Comment.Delete
    End If
    .AddComment
    .Comment.Visible = False
    .Comment.Text Text:="Info:" & Chr(10) & "Anzahl Kranktage Mitarbeiter/Monat"
End With
With Cells(4, LS + 2)
    If .Comment Is Nothing Then
    Else
        .Comment.Delete
    End If
    .AddComment
    .Comment.Visible = False
    .Comment.Text Text:="Info:" & Chr(10) & "H|fffd|ufigkeit Krankmeldungen/Monat"
End With
With Cells(4, LS + 3)
    If .Comment Is Nothing Then
    Else
        .Comment.Delete
    End If
    .AddComment
    .Comment.Visible = False
    .Comment.Text Text:="Info:" & Chr(10) & "kummulierte Krankentage/Mitarbeiter im Jahr"
End With
With Cells(4, LS + 4)
    If .Comment Is Nothing Then
    Else
        .Comment.Delete
    End If
    .AddComment
    .Comment.Visible = False
    .Comment.Text Text:="Info:" & Chr(10) & "kummulierte H|fffd|ufigkeit Krankmeldungen im Jahr"
End With

Range(Cells(LZ + 1, 1), Cells(LZ + 2, LS)).Interior.Color = RGB(255, 255, 0)
Range(Cells(LZ + 3, 1), Cells(LZ + 3, LS)).Interior.Color = RGB(255, 0, 255)
Range(Cells(LZ + 4, 1), Cells(LZ + 4, LS)).Interior.Color = RGB(0, 153, 153)
Range(Cells(LZ + 5, 1), Cells(LZ + 5, LS)).Interior.Color = RGB(244, 176, 132)
Range(Cells(LZ + 6, 1), Cells(LZ + 9, LS)).Interior.Color = RGB(255, 0, 0)
Range(Cells(LZ + 10, 1), Cells(LZ + 11, LS)).Interior.Color = RGB(146, 208, 80)
Range(Cells(LZ + 12, 1), Cells(LZ + 12, LS)).Interior.Color = RGB(153, 0, 153)
Range(Cells(LZ + 13, 1), Cells(LZ + 14, LS)).Interior.Color = RGB(255, 0, 0)

Range(Cells(LZ + 16, 1), Cells(LZ + 19, 1)).Interior.Color = RGB(198, 224, 180)


With Range(Cells(LZ + 6, 1), Cells(LZ + 9, LS)).Font
    .ThemeColor = xlThemeColorDark1
    .TintAndShade = 0
End With
With Range(Cells(LZ + 12, 1), Cells(LZ + 14, LS)).Font
    .ThemeColor = xlThemeColorDark1
    .TintAndShade = 0
End With

With Range(Cells(LZ + 2, 1), Cells(LZ + 17, LS + 4)).Font
    .Name = "Calibri"
    .Size = 11
    .Strikethrough = False
    .Superscript = False
    .Subscript = False
    .OutlineFont = False
    .Shadow = False
    .Underline = xlUnderlineStyleNone
    .TintAndShade = 0
    .ThemeFont = xlThemeFontMinor
End With

R = 5
C = LZ
For i = 4 To LS
    If IsNumeric(Cells(SW, i)) Then
        Cells(LZ + 16, i).FormulaR1C1 = "=COUNTIF(R" & R & "C:R" & C & "C,""."")"
    End If
Next i

Cells(LZ + 14, LS + 1).FormulaR1C1 = "=SUM(RC[-" & LS - KL1 & "]:RC[-" & KL1 & "])/R[5]C[-" & LS & "]"
Cells(LZ + 14, LS + 2) = "Durchschnitt"
With Range(Cells(LZ + 14, LS + 1), Cells(LZ + 14, LS + 2))
    .Interior.Color = RGB(255, 0, 0)
    .Font.Color = RGB(255, 255, 255)
End With
Range(Cells(LZ + 14, LS + 2), Cells(LZ + 14, LS + 3)).MergeCells = True
Cells(LZ + 14, LS + 1).HorizontalAlignment = xlCenter
Cells(LZ + 14, LS + 2) = "Durchschnitt"
End Sub

Function AnzArbTageMonDat(Optional ByVal Datum As Date) As Byte
    If Datum = 0 Then Datum = Date
    Datum = DateSerial(Year(Datum), Month(Datum) + 1, -2)
    AnzArbTageMonDat = 20
    For Datum = DateSerial(Year(Datum), Month(Datum), 27) To Datum
        If (Datum Mod 7) < 5 Then AnzArbTageMonDat = AnzArbTageMonDat + 1
    Next
End Function

Sub Daten_aus_Mitarbeiterdatei_|fffd|bernehmen()

Set AW = ThisWorkbook
Set AWE = AW.Worksheets("Einstellungen")
Set AWakt = AW.ActiveSheet

MD1 = AWE.Range("MEinst")
'On Error Resume Next

Set AWM = Workbooks(MD1(1, 1))
Set AWMB = AWM.Worksheets(MD1(2, 1))
If Err > 0 Then
    MSG = MsgBox("Die Mitarbeiterdatei " & MD1(1, 1) & " ist nicht ge|fffd|ffnet. Abbruch!", vbOKOnly, "Fehler-Hinweis")
    End
End If
On Error GoTo 0
AWakt.Activate

TT1 = AWM.Name
TT2 = AWMB.Name

LZ = Cells(5, 1).End(xlDown).Row

For i = 5 To LZ
    MA = Cells(i, 1)
    On Error Resume Next
        'SW = AWMB.Range(Cells(MD1(6, 1), MD1(3, 1)), Cells(MD1(7, 1), MD1(3, 1))).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        SW = AWMB.Columns(MD1(3, 1)).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        If Err > 0 Then
            Err = 0
            e = e + 1
            MSG = MsgBox("Der/Die Mitarbeiter/in " & MA & " konnte nicht in der Mitarbeiterdatei gefunden werden. Abbruch!", vbOKOnly, "Fehler-Hinweis")
            End
        Else
            D1 = AWMB.Cells(SW, MD1(4, 1))
            D2 = AWMB.Cells(SW, MD1(5, 1))
            Cells(i, 2) = D1
            Cells(i, 3) = D2
        End If
Next i
Cells(3, 2) = MD1(4, 2)
Cells(3, 3) = MD1(5, 2)

End Sub

Sub Farbkorrektur_nach_Import()

Dim Farben
Set AW = ThisWorkbook
Set AWE = AW.Worksheets("Einstellungen")
Set AWakt = AW.ActiveSheet

Set FA1 = AWE.Range("MFarben")

Z = FA1.Row
s = FA1.Column
LS1 = FA1.End(xlToRight).Column
LZ1 = FA1.End(xlDown).Row
Farben_S = LS1 - s
Farben_Z = LZ1 - Z

AWE.Activate
Farben = Range(Cells(Z + 1, s), Cells(LZ1, LS1))

AWakt.Activate
LS = Cells(3, 4).End(xlToRight).Column
LZ = Cells(5, 1).End(xlDown).Row

For j = 2 To LS
    WT = Cells(4, j)
    For i = 5 To LZ
        KHG = ""
        KSchrift = ""
        SW = Cells(i, j)
        If SW <> "" Then
            For f2 = 1 To Farben_Z
                For f1 = 4 To Farben_S
                    FF = Farben(f2, f1)
                    If FF = "" Then Exit For
                    If FF = SW Then
                        KSchrift = Farben(f2, 3)
                        If KSchrift = "s" Then SC = 1 Else SC = 2
                        KHG = Farben(f2, 2)
                        FRGB = Split(KHG, ",")
                        
                        'If FF = "F" Then Stop
                        With Cells(i, j)
                            If (SW = "/" Or SW = ".") Then
                                If WT = "HF" Or WT = "NF" Or WT = "Sa" Or WT = "So" Then
                                    .Interior.Color = RGB(FRGB(0), FRGB(1), FRGB(2))
                                    .Font.ColorIndex = SC
                                Else
                                    .Interior.Color = RGB(255, 255, 255)
                                    .Font.ColorIndex = SC  '0
                                End If
                            Else
                                .Interior.Color = RGB(FRGB(0), FRGB(1), FRGB(2))
                                .Font.ColorIndex = SC
                            
                            End If
                        End With
                        
                        Exit For
                    End If
                
                Next f1
                If KHG <> "" Then Exit For
            Next f2
            
        End If
    
    Next i
Next j



End Sub


Sub Monatsblatt_Krankentage_vorbereiten()

TE = Array("krank", "Gesamtes Jahr", "Anzahl Krankmeldung", "Gesamt Krankmeldung")

LS = Cells(3, 4).End(xlToRight).Column
LZ = Cells(5, 1).End(xlDown).Row

Cells(4, LS + 1) = TE(0)
Cells(4, LS + 2) = TE(1)
Cells(4, LS + 3) = TE(2)
Cells(4, LS + 4) = TE(3)

Cells(4, LS + 1).Interior.Color = 255
Cells(4, LS + 2).Interior.Color = 65535
Cells(4, LS + 3).Interior.Color = RGB(219, 160, 97)
Cells(4, LS + 4).Interior.Color = RGB(219, 160, 97)

Range(Cells(3, LS + 1), Cells(3, LS + 4)).Interior.Color = RGB(219, 160, 97)

With Range(Cells(4, LS + 1), Cells(4, LS + 4))
    .ColumnWidth = 7
    
    .HorizontalAlignment = xlCenter
    .VerticalAlignment = xlBottom
    .WrapText = True
    .Orientation = 0
    .AddIndent = False
    .IndentLevel = 0
    .ShrinkToFit = False
    .ReadingOrder = xlContext
    .MergeCells = False
End With
   

Range(Cells(4, LS + 1), Cells(LZ + 1, LS + 1)).Interior.Color = 255
Range(Cells(4, LS + 2), Cells(LZ + 1, LS + 2)).Interior.Color = 65535
Range(Cells(4, LS + 3), Cells(LZ + 1, LS + 4)).Interior.Color = RGB(221, 235, 247)

Range(Cells(4, LS + 1), Cells(LZ + 1, LS + 2)).HorizontalAlignment = xlCenter

Range(Cells(5, LS + 1), Cells(LZ, LS + 2)).Font.Bold = False
            
Cells(LZ + 1, LS + 3).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
Cells(LZ + 1, LS + 4).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
Cells(LZ + 1, LS + 1).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
Cells(LZ + 1, LS + 2).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
 
Range(Cells(1, 1), Cells(2, LS + 4)).Interior.Color = RGB(221, 235, 247)
Range(Cells(1, LS + 5), Cells(2, LS + 15)).Interior.Pattern = xlNone

With Range(Cells(4, LS + 1), Cells(LZ + 1, LS + 4))
    .Borders(xlDiagonalDown).LineStyle = xlNone
    .Borders(xlDiagonalUp).LineStyle = xlNone
    With .Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    .Borders(xlInsideVertical).LineStyle = xlContinuous
    .Borders(xlInsideHorizontal).LineStyle = xlContinuous
End With


Cells(4, LS + 5).Select
End Sub
Attribute VB_Name = "Jahres|fffd|bersicht"
Public J|fffd| As String
'Const J|fffd| = "Jahres|fffd|bersicht"

Sub Var_zuweisen()
J|fffd| = "Jahres|fffd|bersicht"
End Sub

Sub Jahres|fffd|bersicht_zur|fffd|cksetzen()
MBox = MsgBox("Alle Mitarbeiter und Daten im Jahres|fffd|berblick werden entfernt. Daten und Mitarbeiter k|fffd|nnen wieder |fffd|ber das Men|fffd| |fffd|bernommen werden.", vbOKCancel, "Fehler-Hinweis")
If MBox = vbCancel Then
    End
End If

Var_zuweisen
Application.ScreenUpdating = False

Z = 4
Set UB = ThisWorkbook.Worksheets(J|fffd|)
X = 0
UB.Activate
With UB
    LZ = .Cells(4, 1).End(xlDown).Row
'    .Range(.Cells(5, 4), .Cells(LZ, 53)).ClearContents
'    .Range(.Cells(5, 4), .Cells(LZ, 51)).Interior.Pattern = xlNone
End With
TE = "Mitarbeiter/Monat"
SW = UB.Columns(1).Find(What:=TE, LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False).Row

If SW - LZ <> 2 Then
    MBox = MsgBox("Zwischen dem letzten Mitarbeiter und der Berechnung ist nicht nur eine Zeile frei!! Bitte korrigieren oder ist das korrekt?", vbOKCancel, "Makro-Hinweis")
    If MBox = vbCancel Then
        End
    End If
End If

For i = 5 To SW
    If Cells(5, 1).Value = "" Then Exit For
    Rows(5).Delete Shift:=xlUp
Next i
With UB
    LZ = .Cells(4, 1).End(xlDown).Row
    .Range(.Cells(5, 4), .Cells(LZ + 2, 53)).ClearContents
    '.Range(.Cells(5, 4), .Cells(LZ, 51)).Interior.Pattern = xlNone
End With


Cells(5, 1).Activate
Application.ScreenUpdating = True

End Sub


Sub Mitarbeiter_in_Jahres|fffd|bersicht_|fffd|berf|fffd|hren()
MBox = MsgBox("Sollen die Mitarbeiter aller Monate in die Jahres|fffd|bersicht kopiert werden? Vorher bitte Jahres|fffd|bersicht zur|fffd|cksetzen!", vbOKCancel, "Makro-Hinweis")
If MBox = vbCancel Then
    End
End If


Var_zuweisen
Set UB = Worksheets(J|fffd|)
Application.ScreenUpdating = False

AnzB = ThisWorkbook.Worksheets.Count
    For i = 4 To AnzB
        X = X + 1
        If X > 12 Then Exit For
        Sheets(i).Activate
        LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
        For j = 5 To LZ
            MA = "": MA1 = "": MA2 = ""
            MA = ActiveSheet.Cells(j, 1)
            
            On Error Resume Next
                SW = UB.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                
                If Err > 0 Then
                    Err = 0
                    
                    
                    Freecell = 5
                    Do While UB.Cells(Freecell, 1) <> ""
                       Freecell = Freecell + 1
                    Loop
                    'On Error GoTo 0
                    UB.Rows(Freecell + 1).Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
                    
                    LSV = UB.Cells(4, 1).End(xlDown).Row
                    LSV = UB.Cells(4, 1).End(xlDown).Offset(1, 0)
                    
                    UB.Cells(Freecell, 1) = MA
                    If Cells(3, 2) <> 1 Then  'Abfrage welcher Herkunft Mitarbeiter
                        MA1 = ActiveSheet.Cells(j, 2)
                        MA2 = ActiveSheet.Cells(j, 3)
                        
                        UB.Cells(Freecell, 2) = MA1
                        UB.Cells(Freecell, 3) = MA2
                    End If
                Else
                    
                End If
            On Error GoTo 0
        Next j
    Next i
    On Error GoTo 0
    UB.Activate
    LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
    With Range(Cells(5, 1), Cells(LZ, 1)) 'Tabellenname und Bereich anpassen!
        .Sort Key1:=.Cells(5, 1), Order1:=xlAscending, Header:=xlGuess
    End With
    
'    With UB.Sort
'        .Key1 = .Cells(5, 1)
'        .Order1 = xlAscending
'        .SetRange Range(Cells(5, 1), Cells(131, 1))
'        .Header = xlGuess
'        .MatchCase = False
'        .Orientation = xlTopToBottom
'        .SortMethod = xlPinYin
'        .Apply
'    End With
    Range("A5").Select
    Application.ScreenUpdating = True
End Sub


Sub Daten_in_Jahres|fffd|bersicht_einf|fffd|gen()
Application.ScreenUpdating = False
Var_zuweisen
Z = 4
Set UB = ThisWorkbook.Worksheets(J|fffd|)
X = 0
With UB
    LZ = .Cells(5, 1).End(xlDown).Row
    .Range(.Cells(5, 4), .Cells(LZ, 53)).ClearContents
    .Range(.Cells(5, 4), .Cells(LZ, 51)).Interior.Pattern = xlNone
End With

AnzB = ThisWorkbook.Worksheets.Count
    For i = 4 To AnzB  'Schleife Monate
        MKT = 0
        If i > AnzB Then Exit For
        Sheets(i).Activate
        BN = ActiveSheet.Name
        LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
        AnzM = LZ - Z
        For j = 5 To LZ 'Schleife Mitarbeiter
            'AnzM = LZ
            MA = ActiveSheet.Cells(j, 1)
            LSV = ActiveSheet.Cells(3, 4).End(xlToRight).Column
            t = ActiveSheet.Cells(j, LSV + 1)
            KT = ActiveSheet.Cells(j, LSV + 2)
            m = ActiveSheet.Cells(j, LSV + 3)
            KM = ActiveSheet.Cells(j, LSV + 4)
            
            'On Error Resume Next
                SW = UB.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                
                If Err > 0 Then
                    F = MsgBox("Mitarbeiter " & MA & " wurde in der |fffd|bersicht nicht gefunden!", vbOKOnly, "Fehler")
                    
                    Err = 0
                    End
                Else
                    s = i + X 'Spalte f|fffd|r Monat
                    UB.Cells(SW, s) = t
                    'If T = 0 Then UB.Cells(SW, S).Interior.ThemeColor = xlThemeColorAccent6
                    'If T > 3 Then UB.Cells(SW, S).Interior.Color = 39423
                    UB.Cells(SW, s + 1) = KT
                    UB.Cells(SW, s + 2) = m
                    UB.Cells(SW, s + 3) = KM
                    If t > 0 Then MKT = MKT + 1
                End If
            On Error GoTo 0
        Next j
        SuWe = "Summe Mitarbeiter"
        SW1 = UB.Columns(1).Find(What:=SuWe, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        SuWe = "Krankenstand in Prozent"
        SW2 = UB.Columns(1).Find(What:=SuWe, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        SW2a = ActiveSheet.Columns(1).Find(What:=SuWe, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        
        
        KTP = ActiveSheet.Cells(SW2a, LSV + 1).Value
        
        
        UB.Cells(SW1 - 1, s) = MKT
        UB.Cells(SW1, s) = AnzM
        UB.Cells(SW2, s) = KTP
        GT = GT + t
        GM = GM + m
        
        
        With UB
            With .Cells(SW1 - 1, s)
                If .Comment Is Nothing Then
                Else
                    .Comment.Delete
                End If
                .AddComment
                .Comment.Visible = False
                .Comment.Text Text:="Info:" & Chr(10) & "hier aufaddierte Anzahl kranker Mitarbeiter"
            End With
            With .Cells(SW1, s)
                If .Comment Is Nothing Then
                Else
                    .Comment.Delete
                End If
                .AddComment
                .Comment.Visible = False
                .Comment.Text Text:="Info:" & Chr(10) & "Wert aus Monatsblatt"
            End With
            With .Cells(SW2, s)
                If .Comment Is Nothing Then
                Else
                    .Comment.Delete
                End If
                .AddComment
                .Comment.Visible = False
                .Comment.Text Text:="Info:" & Chr(10) & "berechneter Monatsdurchschnitt im Monatsblatt"
            End With
        End With
        X = X + 3
    Next i  'Monate
    On Error GoTo 0
    LZ = UB.Cells(5, 1).End(xlDown).Row
    For a = 5 To LZ
        GT = 0
        GM = 0
        For B = 4 To 48 Step 4
            GT0 = UB.Cells(a, B).Value
            GM0 = UB.Cells(a, B + 2).Value
            
            If GT0 <> "" Then GT = GT + GT0
            If GT0 <> "" Then GM = GM + GM0
        Next B
        UB.Cells(a, 52).Value = GT
        UB.Cells(a, 53).Value = GM
    Next a
    UB.Activate
    'MB = MsgBox("Aktives Blatt: " & ActiveSheet.Name, vbOKOnly, "Hinweis")
    For i = 6 To 52 Step 4
        With UB
        For Each C In .Range(.Cells(4, i), .Cells(LZ + 1, i + 1))
            C.Interior.Color = RGB(221, 235, 247)
        Next
        End With
        'UB.Range(Cells(4, i), Cells(LZ + 1, i + 1)).Interior.Color = RGB(221, 235, 247)
'        With UB.Range(Cells(4, i), Cells(LZ + 1, i + 1)).Interior
'            .Pattern = xlSolid
'            .PatternColorIndex = xlAutomatic
'            .ThemeColor = xlThemeColorAccent5
'            .TintAndShade = 0.799981688894314
'            .PatternTintAndShade = 0
'        End With
    
        
    
    
    
    Next i
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "Krankentage"
'Const P|fffd| = "Personen|fffd|bersicht"
Public J|fffd| As String
'Const J|fffd| = "Jahres|fffd|bersicht"

Sub Var_zuweisen()
P|fffd| = "Personen|fffd|bersicht"
End Sub

Sub Auswahl_Monat_M0()
    
    BN = ActiveSheet.Name
    p = 0: p1 = 0

    p = InStr(1, BN, "201")
    p1 = InStr(1, BN, "202")
    If p > 0 Or p1 > 0 Then
        
    Else
        MSG = MsgBox("Falsches Tabellenblatt ausgew|fffd|hlt!", vbOKOnly + vbCritical, "Fehler-Hinweis")
       
        End
    End If
    
    
    
    MSG = MsgBox("Sollen alle Monatsdatei " & BN & " berechnet werden?", vbOKCancel, "Berechnung einzelner Monate")
    If MSG = vbCancel Then
        End
    End If
    Worksheets(BN).Activate
    Call Krankentage_berechnen
    
End Sub




Sub Auswahl_Monat_A0()
    
MSG = MsgBox("Sollen alle Monatsdateien berechnet werden?", vbOKCancel, "Berechnung aller Monate")
If MSG = vbCancel Then
    End
End If
Worksheets(1).Activate
AnzB = ThisWorkbook.Sheets.Count
For t = 1 To AnzB
    p = 0: p1 = 0
    ATNa = Worksheets(t).Name
    p = InStr(1, ATNa, "201")
    p1 = InStr(1, ATNa, "202")
    If p > 0 Or p1 > 0 Then
        Worksheets(t).Activate
        Call Krankentage_berechnen
    End If
Next t

End Sub





Sub Krankentage_berechnen() 'Monatsbl|fffd|tter
Var_zuweisen
Application.ScreenUpdating = False

KK = Array("K", "KN", "KO", "KK", "A", "Ku", "R", "RO", "We")
NB = "."
We = "/"

Z = 4
u = 4

Sprung3:
Set AT = ThisWorkbook.ActiveSheet
ATNa = AT.Name

If Cells(3, 2) = 1 Then s = 2
If Cells(3, 4) = 1 Then s = 4
'Cells(5, S).Select
'ActiveWindow.FreezePanes = True


'Krankheitstage

LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
LS = ActiveSheet.Cells(3, 4).End(xlToRight).Column
LZZ = LZ - Z

KTG = 0

For i = 1 To LZZ ' Schleife Mitarbeiter
    KI = 1
    KIG = 0
    KTV = 0: KIV = 0
    KT = 0: KV = 0
    VKT = 0
    q1 = 0: q2 = 0
    If Left(ATNa, 3) <> "Jan" Then VMKontrolle = 1 Else VMKontrolle = 0
    For j = 4 To LS 'Schleife Tage im Monat
        If j = 4 Then MA = ActiveSheet.Cells(i + Z, 1) 'Mitarbeiter
       'If MA = "Asilt|fffd|rk, Firat" Then Stop
        
        
        W = ActiveSheet.Cells(i + Z, j)    'Eintrag je Tag
        If W <> "F" Then
            If InStr(1, ".", W) > 0 Then
                VMKontrolle = 0
                KI = 1
            Else
                For a = 0 To 8
                    If InStr(1, W, KK(a)) > 0 Then
                        KT = KT + 1  'Krankheitstage im Monat z|fffd|hlen, wenn K|fffd|rzel erf|fffd|llt
                        'p = 0
                        
                        If VMKontrolle = 1 Then 'Kontrolle auf Vormonat
                            VMonat = Monate_bestimmen(ATNa)
                            Set EW = ThisWorkbook.Worksheets(VMonat)
                            On Error Resume Next
                                SW = EW.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                                If Err > 0 Then
                                    Err = 0
                                    KI = 1
                                End If
                            On Error GoTo 0
                            KVM = 0
                            LSV = EW.Cells(3, 4).End(xlToRight).Column
                            VTK = EW.Cells(SW, LSV + 3)
                             'Do While R = "/" Or R = "."
                            Do
                                R = EW.Cells(SW, LSV)
                           
                                For B = 0 To 8
                                        If InStr(1, KK(B), R) > 0 Then
                                            VKT = 1
                                            KI = 0
                                            KVM = KVM + 1
                                            'Exit Do
                                            Exit For
                                        End If
                                Next B
                                LSV = LSV - 1
                                R = EW.Cells(SW, LSV)
                            Loop Until R = "/" Or R = "."
                            
                            Freecell = LSV
                            R = EW.Cells(SW, Freecell)
'                            Do While R <> "." And R <> "U"
'                                R = EW.Cells(SW, Freecell)
'                                For b = 0 To 8
'                                    If InStr(1, KK(b), R) > 0 Then
'                                        VKT = 1
'                                        KI = 0
'                                        KVM = KVM + 1
'                                        'Exit Do
'                                        Exit For
'                                    End If
'
'                                Next b
'                                Freecell = Freecell - 1
'                                If Freecell = 0 Then
'
'                                Exit Do
'
'
'
'                                End If
'                                R = EW.Cells(SW, Freecell)
'                            Loop
                            
                            VMKontrolle = 0
                        Else
                            
                        End If 'Ende Vormonat
                        KIG = KIG + KI
                        KI = 0
                        GoTo Sprung1
                    Else
                    
                    End If

                Next a
            End If
Sprung1:
        End If
    Next j
    'If InStr(1, MA, "Walle") Then Stop
    ActiveSheet.Cells(i + Z, LS + 1) = KT
    KTG = KTG + KT
    ActiveSheet.Cells(i + Z, LS + 3) = KIG
    
    
    If Left(ATNa, 3) = "Jan" Then
        ActiveSheet.Cells(i + Z, LS + 2) = KT
        ActiveSheet.Cells(i + Z, LS + 4) = KIG
        
    Else
        'VMonat = Monate_bestimmen(ATNa)
        BNI = ActiveSheet.Index
        SW = 0
        NoDa = 0
        Do Until SW > 0
            q1 = q1 + 1
            q2 = BNI - q1
            If q2 = 3 Then
                NoDa = 1
                Exit Do
            End If
            Set EW = ThisWorkbook.Sheets(q2)
            BN = EW.Name
            'If InStr(1, MA, "Walle") Then Stop
            LSV = EW.Cells(3, 4).End(xlToRight).Column
            On Error Resume Next
            SW = 0
            SW = EW.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
            If SW > 0 Then
                Err = 0
                'Stop
                On Error GoTo 0
                Exit Do
            End If
            On Error GoTo 0
        Loop
        
        If NoDa = 1 Then
            KTV = 0
            KIV = 0
        Else
            KTV = EW.Cells(SW, LSV + 2)
            KIV = EW.Cells(SW, LSV + 4)
        End If
        ActiveSheet.Cells(i + Z, LS + 2) = KT + KTV
        ActiveSheet.Cells(i + Z, LS + 4) = KIG + KIV
    End If
      
Next i ' Ende Schleife Mitarbeiter

ActiveSheet.Cells(LZ + 1, LS + 1) = KTG

If Left(ATNa, 3) = "Jan" Then
    ActiveSheet.Cells(LZ + 1, LS + 2) = KTG
Else
    LZV = EW.Cells(5, LSV + 1).End(xlDown).Row
    KTGV = EW.Cells(SW + 1, LSV + 2)
    ActiveSheet.Cells(LZ + 1, LS + 2) = KTGV + KTG
End If

i = i0

Sprung4:


Sheets(ATNa).Activate
Application.ScreenUpdating = True
End Sub

Function Monate_bestimmen(Mon)
Set ES = ThisWorkbook.Worksheets("Einstellungen")
    BZ = ES.Range("Monate").Row
    BS = ES.Range("Monate").Column
    For i = 1 To 15
        If ES.Cells(BZ + i, BS) = Mon Then
            Monate_bestimmen = ES.Cells(BZ + i - 1, BS)
            Exit For
        End If
    Next i
    

End Function

Sub Mitarbeiter_in_Jahres|fffd|bersicht_|fffd|berf|fffd|hren()
Set UB = Worksheets(J|fffd|)
AnzB = ThisWorkbook.Worksheets.Count
    For i = 3 To AnzB
        X = X + 1
        If X > 12 Then Exit For
        Sheets(i).Activate
        LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
        For j = 5 To LZ
            MA = ActiveSheet.Cells(j, 1)
            
            On Error Resume Next
                SW = UB.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                
                If Err > 0 Then
                    Err = 0
                    
                    MA1 = ActiveSheet.Cells(j, 2)
                    MA2 = ActiveSheet.Cells(j, 3)
                    Freecell = 5
                    Do While UB.Cells(Freecell, 1) <> ""
                       Freecell = Freecell + 1
                    Loop
                    'On Error GoTo 0
                    UB.Rows(Freecell + 1).Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
                    
                    LSV = UB.Cells(4, 1).End(xlDown).Row
                    LSV = UB.Cells(4, 1).End(xlDown).Offset(1, 0)
                    UB.Cells(Freecell, 1) = MA
                    UB.Cells(Freecell, 2) = MA1
                    UB.Cells(Freecell, 3) = MA2
                Else
                    
                End If
            On Error GoTo 0
        Next j
    Next i

End Sub

Sub Daten_in_Jahres|fffd|bersicht_einf|fffd|gen()
Z = 4
Set UB = ThisWorkbook.Worksheets(J|fffd|)
X = 0
With UB
    LZ = .Cells(5, 1).End(xlDown).Row
    .Range(.Cells(5, 4), .Cells(LZ, 53)).ClearContents
    .Range(.Cells(5, 4), .Cells(LZ, 51)).Interior.Pattern = xlNone
End With

AnzB = ThisWorkbook.Worksheets.Count
    For i = 4 To AnzB  'Schleife Monate
        MKT = 0
        If i > AnzB Then Exit For
        Sheets(i).Activate
        BN = ActiveSheet.Name
        LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
        AnzM = LZ - Z
        For j = 5 To LZ 'Schleife Mitarbeiter
            'AnzM = LZ
            MA = ActiveSheet.Cells(j, 1)
            LSV = ActiveSheet.Cells(3, 4).End(xlToRight).Column
            t = ActiveSheet.Cells(j, LSV + 1)
            KT = ActiveSheet.Cells(j, LSV + 2)
            m = ActiveSheet.Cells(j, LSV + 3)
            KM = ActiveSheet.Cells(j, LSV + 4)
            
            'On Error Resume Next
                SW = UB.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
                
                If Err > 0 Then
                    F = MsgBox("Mitarbeiter " & MA & " wurde in der |fffd|bersicht nicht gefunden!", vbOKOnly, "Fehler")
                    
                    Err = 0
                    End
                Else
                    s = i + X 'Spalte f|fffd|r Monat
                    UB.Cells(SW, s) = t
                    'If T = 0 Then UB.Cells(SW, S).Interior.ThemeColor = xlThemeColorAccent6
                    'If T > 3 Then UB.Cells(SW, S).Interior.Color = 39423
                    UB.Cells(SW, s + 1) = KT
                    UB.Cells(SW, s + 2) = m
                    UB.Cells(SW, s + 3) = KM
                    If t > 0 Then MKT = MKT + 1
                End If
            On Error GoTo 0
        Next j
        SuWe = "Summe Mitarbeiter"
        SW1 = UB.Columns(1).Find(What:=SuWe, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        SuWe = "Krankenstand in Prozent"
        SW2 = UB.Columns(1).Find(What:=SuWe, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        SW2a = ActiveSheet.Columns(1).Find(What:=SuWe, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        
        
        KTP = ActiveSheet.Cells(SW2a, LSV + 1).Value
        
        
        UB.Cells(SW1 - 1, s) = MKT
        UB.Cells(SW1, s) = AnzM
        UB.Cells(SW2, s) = KTP
        GT = GT + t
        GM = GM + m
        
        X = X + 3
    Next i  'Monate
    On Error GoTo 0
    LZ = UB.Cells(5, 1).End(xlDown).Row
    For a = 5 To LZ
        GT = 0
        GM = 0
        For B = 4 To 48 Step 4
            GT0 = UB.Cells(a, B).Value
            GM0 = UB.Cells(a, B + 2).Value
            
            If GT0 <> "" Then GT = GT + GT0
            If GT0 <> "" Then GM = GM + GM0
        Next B
        UB.Cells(a, 52).Value = GT
        UB.Cells(a, 53).Value = GM
    Next a
    UB.Activate
    'MB = MsgBox("Aktives Blatt: " & ActiveSheet.Name, vbOKOnly, "Hinweis")
    For i = 6 To 64 Step 4
        With UB
        For Each C In .Range(.Cells(4, i), .Cells(LZ + 1, i + 1))
            C.Interior.Color = RGB(221, 235, 247)
        Next
        End With
        'UB.Range(Cells(4, i), Cells(LZ + 1, i + 1)).Interior.Color = RGB(221, 235, 247)
'        With UB.Range(Cells(4, i), Cells(LZ + 1, i + 1)).Interior
'            .Pattern = xlSolid
'            .PatternColorIndex = xlAutomatic
'            .ThemeColor = xlThemeColorAccent5
'            .TintAndShade = 0.799981688894314
'            .PatternTintAndShade = 0
'        End With
    Next i
End Sub

Sub Zwei_Spalten_Einf|fffd|gen()


ThisWorkbook.Activate
'Application.ScreenUpdating = False

AnzB = ThisWorkbook.Worksheets.Count
    For i = 4 To AnzB
        X = X + 1
        If X > 12 Then Exit For
        Sheets(i).Activate
        LZ = ActiveSheet.Cells(5, 1).End(xlDown).Row
        If Cells(3, 2) = 1 Then
            Range(Cells(3, 2), Cells(LZ + 14, 3)).Insert CopyOrigin:=xlFormatFromLeftOrAbove
            
        
        End If

    Next
End Sub
Attribute VB_Name = "Personen_|fffd|bersicht"
Const P|fffd| = "Personen|fffd|bersicht"

Sub Jahres|fffd|bersicht_je_Person(MA, Z)

Set PU = ThisWorkbook.Worksheets(P|fffd|)
Application.ScreenUpdating = False

With PU
    .Range(.Cells(2, 1), .Cells(20, 40)).Clear
    .Cells(4, 1) = "Monate/Tage"
    For i = 1 To 32
        If i < 32 Then .Cells(4, i + 1) = i
        With .Cells(4, i).Interior
            .Pattern = xlSolid
            .PatternColorIndex = xlAutomatic
            .ThemeColor = xlThemeColorDark1
            .TintAndShade = -0.149998474074526
            .PatternTintAndShade = 0
        End With
        
        
        i1 = i
    Next i
    .Cells(4, i1 + 1) = "T"
    .Cells(4, i1 + 2) = "KT"
    .Cells(4, i1 + 3) = "M"
    .Cells(4, i1 + 4) = "KM"
End With

d = 0
e = 0
PU.Cells(2, 1) = MA
For i = 1 To 12 Step 1
    SW = 0
    V = Cells(Z, i * 4)
    BN = ""
    On Error Resume Next
    BN = Sheets(i + 3).Name
    If Err > 0 Then
        Exit For
    End If
    Set EW = ThisWorkbook.Worksheets(i + 3)
    If V <> "" Or V <> 0 Then
        e = e + 1
        c1 = 0
        If EW.Cells(3, 2) = 1 Then c1 = 2: c2 = 32
        If EW.Cells(3, 4) = 1 Then c1 = 4: c2 = 34
        'BN = Sheets(i - d).Name
        PU.Cells(4 + e, 1) = "'" & BN
        LS = EW.Cells(3, 4).End(xlToRight).Column
        
        On Error Resume Next
        SW = EW.Columns(1).Find(What:=MA, LookAt:=xlWhole, SearchOrder:=xlByRows, MatchCase:=False).Row
        If Err > 0 Then
            Err = 0
            e = e + 1
        Else
            On Error GoTo 0
            EW.Range(EW.Cells(SW, c1), EW.Cells(SW, LS)).Copy
            PU.Range(PU.Cells(4 + e, 2), PU.Cells(4 + e, LS - 2)).PasteSpecial
            For h = 1 To c2 - LS
'                PU.Cells(4 + e, LS + h) = "X"
'                PU.Cells(4 + e, LS + h).HorizontalAlignment = xlCenter
'                PU.Cells(4 + e, LS + h).VerticalAlignment = xlCenter
                PU.Cells(4 + e, LS - 2 + h) = "X"
                PU.Cells(4 + e, LS - 2 + h).HorizontalAlignment = xlCenter
                PU.Cells(4 + e, LS - 2 + h).VerticalAlignment = xlCenter
                
                
            Next h
            EW.Range(EW.Cells(SW, LS + 1), EW.Cells(SW, LS + 4)).Copy
            PU.Range(PU.Cells(4 + e, 33), PU.Cells(4 + e, 36)).PasteSpecial
        End If
        
        
    Else
        e = e + 1
        If BN <> "" Then PU.Cells(4 + e, 1) = "'" & BN
    
    End If
    d = d + 1
    Set EW = Nothing
Next i

LZ = PU.Cells(4, 1).End(xlDown).Row
With PU.Range(PU.Cells(4, 33), PU.Cells(LZ, 33 + 3))
    .HorizontalAlignment = xlRight
    .VerticalAlignment = xlCenter
    .WrapText = False
    .Orientation = 0
    .AddIndent = False
    .IndentLevel = 0
    .ShrinkToFit = False
    .ReadingOrder = xlContext
    .MergeCells = False
    .Range("A4").Select


    With .Font
        .Name = "Calibri"
        .Strikethrough = False
        .Superscript = False
        .Subscript = False
        .OutlineFont = False
        .Shadow = False
        .Underline = xlUnderlineStyleNone
        .TintAndShade = 0
        .ThemeFont = xlThemeFontMinor
    End With
    With .Interior
        .PatternColorIndex = xlAutomatic
        .Color = 65535
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    With .Font
        .ThemeColor = xlThemeColorLight1
        .TintAndShade = 0
    End With
    .Borders(xlDiagonalDown).LineStyle = xlNone
    .Borders(xlDiagonalUp).LineStyle = xlNone
    With .Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
End With


With PU.Range(PU.Cells(4, 1), PU.Cells(LZ, 32))
    .Borders(xlDiagonalDown).LineStyle = xlNone
    .Borders(xlDiagonalUp).LineStyle = xlNone
    With .Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With .Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = xlAutomatic
        .TintAndShade = 0
        .Weight = xlThin
    End With
End With


With PU
    With .Cells(4, i1 + 1)
        .AddComment
        .Comment.Visible = False
        .Comment.Text Text:="Info:" & Chr(10) & "Krankentage/Monat"
    End With
    With .Cells(4, i1 + 3)
        .AddComment
        .Comment.Visible = False
        .Comment.Text Text:="Info:" & Chr(10) & "Meldungen/Monat"
    End With
    With .Cells(4, i1 + 2)
        .AddComment
        .Comment.Visible = False
        .Comment.Text Text:="Info:" & Chr(10) & "Gesamte Krankentage kumuliert (Jahr)"
    End With
    With .Cells(4, i1 + 4)
        .AddComment
        .Comment.Visible = False
        .Comment.Text Text:="Info:" & Chr(10) & "Gesamte Meldungen kumuliert (Jahr)"
    End With
    .Cells(1, 1) = "--> Jahres|fffd|bersicht"

End With


PU.Activate
PU.Cells(1, 1).Activate
Application.ScreenUpdating = True


End Sub

Attribute VB_Name = "Tabelle1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "Tabelle12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "UserForm1"
Attribute VB_Base = "0{B4CA519F-7109-4DE5-AD1D-38A9C980A2EA}{578DC2FD-34D0-4C73-A042-50876D0BDBCD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Attribute VB_Name = "Wochentage_bearbeiten"
Sub Wochenenden_bearbeiten()
    MBox = MsgBox("Sollen die Wochenenden bearbeitet werden?", vbOKCancel, "Hinweis")
    If MBbox = vbCancel Then End
    
    Set AW = ThisWorkbook.ActiveSheet
    
    ATNa = AW.Name

    p = 0: p1 = 0: p2 = 0
    p = InStr(1, ATNa, "2019")
    p1 = InStr(1, ATNa, "2020")
    p2 = InStr(1, ATNa, "2021")
    
    If p = 0 And p1 = 0 And p2 = 0 Then
        MSG = MsgBox("Es ist ein falsches Tabellenblatt ausgew|fffd|hlt worden", vbOKOnly, "Fehler-Hinweis")
        End
    End If

    LS = AW.Cells(3, 4).End(xlToRight).Column
    LZ = AW.Cells(5, 1).End(xlDown).Row
    
    
    For i = 1 To LS
        WT = AW.Cells(4, i)
        If WT = "Sa" Or WT = "So" Then
            For j = 5 To LZ
                With AW
                    .Cells(j, i).Interior.Color = 6299648
                    .Cells(j, i) = "/"
                    .Cells(j, i).Font.ThemeColor = xlThemeColorDark1
                End With
            Next j
        End If
    
    Next i
End Sub


Sub Monatsbl|fffd|tter_formatieren()
Application.ScreenUpdating = False
MBox = MsgBox("Sollen die Monatsbl|fffd|tter formatiert werden?", vbOKCancel, "Hinweis")
    If MBox = vbCancel Then End
    
    AnzB = ThisWorkbook.Worksheets.Count
    For B = 1 To AnzB
    
        Set AW = ThisWorkbook.Worksheets(B)
        'AW.Cells(5, 1).Activate
        ATNa = AW.Name
    
        p = 0: p1 = 0: p2 = 0
        p = InStr(1, ATNa, "2019")
        p1 = InStr(1, ATNa, "2020")
        p2 = InStr(1, ATNa, "2021")
        
        If p > 0 Or p1 > 0 Or p2 > 0 Then
            'Msg = MsgBox("Es ist ein falsches Tabellenblatt ausgew|fffd|hlt worden", vbOKOnly, "Fehler-Hinweis")
            'End
            AW.Activate
            LS = AW.Cells(3, 4).End(xlToRight).Column
            LZ = AW.Cells(5, 1).End(xlDown).Row
            
            j = 3
            For i = 1 To LS
                WT = AW.Cells(3, i)
                If IsNumeric(WT) And WT <> "" Then
                        With AW
                            '.Cells(j, i).Interior.Color = 6299648
                            .Cells(3, i).EntireColumn.ColumnWidth = 3.5
                            '.Cells(j, i).Font.ThemeColor = xlThemeColorDark1
                        End With
                End If
            Next i
            For i = 1 To 4
                With AW
                    '.Cells(j, i).Interior.Color = 6299648
                    .Cells(3, LS + i).EntireColumn.ColumnWidth = 9.14
                    '.Cells(j, i).Font.ThemeColor = xlThemeColorDark1
                End With
            Next i
            AW.Cells(3, 1).EntireColumn.ColumnWidth = 30
            AW.Cells(3, 2).EntireColumn.ColumnWidth = 4
            AW.Cells(3, 3).EntireColumn.ColumnWidth = 4
            
            AW.Cells(3, 2).EntireColumn.ColumnWidth = 29
            AW.Cells(3, 3).EntireColumn.ColumnWidth = 15
            
            'AW.Range(cells(3,LS+1),cells(4,LS+4))
            With AW.Range(Cells(3, LS + 2), Cells(4, LS + 4))
                .HorizontalAlignment = xlCenter
                .VerticalAlignment = xlTop
                .Orientation = 0
                .AddIndent = False
                .IndentLevel = 0
                .ShrinkToFit = False
                .ReadingOrder = xlContext
            End With
            
'            Zeichen_ersetzen = Replace(Cells(1, 2), "Fehltage", "Krankenstand")
'            Cells(1, 2) = Zeichen_ersetzen
        
            With AW
                For Each C In .Range(.Cells(5, LS + 3), .Cells(LZ + 1, LS + 4))
                    C.Interior.Color = RGB(221, 235, 247)
                    C.HorizontalAlignment = xlCenter
                    C.Borders(xlDiagonalDown).LineStyle = xlNone
                    C.Borders(xlDiagonalUp).LineStyle = xlNone
                    With C.Borders(xlEdgeLeft)
                        .LineStyle = xlContinuous
                        .ColorIndex = 0
                        .TintAndShade = 0
                        .Weight = xlThin
                    End With
                    With C.Borders(xlEdgeTop)
                        .LineStyle = xlContinuous
                        .ColorIndex = 0
                        .TintAndShade = 0
                        .Weight = xlThin
                    End With
                    With C.Borders(xlEdgeBottom)
                        .LineStyle = xlContinuous
                        .ColorIndex = 0
                        .TintAndShade = 0
                        .Weight = xlThin
                    End With
                    With C.Borders(xlEdgeRight)
                        .LineStyle = xlContinuous
                        .ColorIndex = 0
                        .TintAndShade = 0
                        .Weight = xlThin
                    End With
                    C.Borders(xlInsideVertical).LineStyle = xlNone
                    C.Borders(xlInsideHorizontal).LineStyle = xlNone
                Next
                For Each C In .Range(.Cells(LZ + 1, LS + 1), .Cells(LZ + 1, LS + 4))
                    C.Font.Bold = True
                    
                Next
            End With
        
            AW.Range(Cells(5, LS + 1), Cells(LZ, LS + 2)).Font.Bold = False
            
            AW.Cells(LZ + 1, LS + 3).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
            AW.Cells(LZ + 1, LS + 4).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
            AW.Cells(LZ + 1, LS + 1).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
            AW.Cells(LZ + 1, LS + 2).FormulaR1C1 = "=SUM(R[-" & LZ - 4 & "]C:R[-1]C)"
             
            AW.Range(Cells(1, 1), Cells(2, LS + 4)).Interior.Color = RGB(221, 235, 247)
            AW.Range(Cells(1, LS + 5), Cells(2, LS + 15)).Interior.Pattern = xlNone
        End If
    Next B

    Application.ScreenUpdating = True
End Sub

' InQuest injected base64 decoded content
' x)br

INQUEST-PP=macro
