Attribute VB_Name = "BBLM"
Attribute VB_Base = "0{410B853B-1FF6-4583-85CA-F3D7E9D9A2E2}{80ECE01F-EDCA-43DC-AC87-6BBD7F02AE8E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
BBLM.Hide
    Dim a As Integer
    Dim b As Integer
    Dim N As Long, NameSh As String
NameSh = ActiveSheet.Name
If NameSh = "BBLMBT" Then
    a = TextBox1
    b = TextBox2
    N = Application.Max(Sheets("List TNBT").Range("A3", Sheets("List TNBT").Range("A" & Rows.Count).End(3)))
    If b < a Then MsgBox "There is no print page"
    For a = a To b
        Range("AK2") = a
        FixRow Range("J18")
        FixRow Range("J19")
        AndongBB Range("A1"), Range("A19")
        'ActiveWindow.SelectedSheets.PrintPreview
        ActiveWindow.SelectedSheets.PrintOut , ActivePrinter:=ComboBox1, Copies:=1, Collate:=True
    Next
Else
    'ActiveWindow.SelectedSheets.PrintPreview
    ActiveWindow.SelectedSheets.PrintOut , ActivePrinter:=ComboBox1, Copies:=1, Collate:=True
End If
End Sub
Private Sub CommandButton2_Click()
    Unload Me
End Sub
Sub List_Printer()
    Dim aPrinters As Object
    Dim I As Long, N As Long
    With CreateObject("WScript.Network")
        Set aPrinters = .EnumPrinterConnections
        For I = 1 To aPrinters.Count Step 2
            ComboBox1.AddItem aPrinters.Item(I)
        Next
    End With
End Sub
Sub Get_Default_Printer()
    Dim WSHshell As Object, RegKey As String, RegKeySplit As Variant
    Dim RegDefault As String, MyPrinter As String
    RegKey = _
            "HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\Windows\Device"
    Set WSHshell = CreateObject("WScript.Shell")
    RegDefault = WSHshell.RegRead(RegKey)
    Set WSHshell = Nothing
    'Get name default printer:
    RegKeySplit = Split(RegDefault, ",")
    MyPrinter = RegKeySplit(0)
    ComboBox1.Text = MyPrinter
End Sub
Private Sub Printer_Properties_Click()
    Call Shell("rundll32 printui.dll,PrintUIEntry /p /n """ & ComboBox1.Value & """", vbNormalFocus)
End Sub
Private Sub UserForm_Initialize()
    Call List_Printer
    Call Get_Default_Printer
End Sub

Attribute VB_Name = "BBNT"
Attribute VB_Base = "0{626EFDE7-69A5-4FF0-B412-3EF6084B0CE6}{80BBD3AE-E1A8-40DB-A617-96F9B1B1EC17}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
    Dim a As Integer, b As Integer, N As Long, NameSh As String
NameSh = ActiveSheet.Name
BBNT.Hide
a = TextBox1
b = TextBox2
N = Application.Max(Sheets("ListBBCV").Range("A4", Sheets("ListBBCV").Range("A" & Rows.Count).End(3)))
If b < a Then MsgBox "There is no print page"
If OptionButton1 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_All"), "=", "")
If OptionButton4 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNBCV"), "=", "")
If OptionButton2 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungPYCCV"), "=", "")
If OptionButton3 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT"), "=", "")
For a = a To b
    If a > N Then Exit Sub
    Range("P2") = a
    CandongBB
    ActiveWindow.SelectedSheets.PrintOut , ActivePrinter:=ComboBox1, Copies:=1, Collate:=True
Next
ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_All"), "=", "")
End Sub
Private Sub CommandButton2_Click()
    ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_All"), "=", "")
    Unload Me
End Sub
Private Sub UserForm_Initialize()
    Dim StrPA As String
    OptionButton1 = True
    Call List_Printer
    Call Get_Default_Printer
    tb_vungNTNB.Text = Replace(RefertoName("VungBBNBCV"), "=", "")
    Tb_VungPYCNT.Text = Replace(RefertoName("VungPYCCV"), "=", "")
    Tb_VungBBCV.Text = Replace(RefertoName("VungBBNT"), "=", "")
    StrPA = RefertoPrintArea
    tb_vungAll.Text = StrPA
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
    If Len(StrPA) Then
        ActiveSheet.PageSetup.PrintArea = StrPA
        XoaName "VungBBNT_All"
        ActiveWorkbook.Names.Add "VungBBNT_All", Range(StrPA)
    End If
End Sub
Private Function RefertoPrintArea() As String
    Dim Str As String, Str1 As String, Str2 As String, Str3 As String
    Str1 = Replace(RefertoName("VungBBNBCV"), "=", "")
    Str2 = Replace(RefertoName("VungPYCCV"), "=", "")
    Str3 = Replace(RefertoName("VungBBNT"), "=", "")
    Str = IIf(Len(Str1), Str1 & ",", "") & IIf(Len(Str2), Str2 & ",", "") & IIf(Len(Str3), Str3, "")
    If Right(Str, 1) = "," Then Str = Mid(Str, 1, Len(Str) - 1)
    If Len(Str) Then RefertoPrintArea = Str
End Function
Private Sub Printer_Properties_Click()
    Call Shell("rundll32 printui.dll,PrintUIEntry /p /n """ & ComboBox1.Value & """", vbNormalFocus)
End Sub
Sub List_Printer()
    Dim aPrinters As Object
    Dim I As Long, N As Long
    With CreateObject("WScript.Network")
        Set aPrinters = .EnumPrinterConnections
        For I = 1 To aPrinters.Count Step 2
            ComboBox1.AddItem aPrinters.Item(I)
        Next
    End With
End Sub
Sub Get_Default_Printer()
    Dim WSHshell As Object, RegKey As String, RegKeySplit As Variant
    Dim RegDefault As String, MyPrinter As String
    RegKey = _
            "HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\Windows\Device"
    Set WSHshell = CreateObject("WScript.Shell")
    RegDefault = WSHshell.RegRead(RegKey)
    Set WSHshell = Nothing
    'Get name default printer:
    RegKeySplit = Split(RegDefault, ",")
    MyPrinter = RegKeySplit(0)
    ComboBox1.Text = MyPrinter
End Sub
Sub XoaName(SName As String)
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then Definename.Delete
    Next
End Sub
Function RefertoName(SName As String) As String
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then
            RefertoName = Definename.RefersTo
            Exit Function
        End If
    Next
End Function
Private Sub Image1_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Tat ca cac bien ban ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    tb_vungAll.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNT_All"
    ActiveWorkbook.Names.Add "VungBBNT_All", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub
Private Sub Image2_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban noi bo ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    tb_vungNTNB.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNBCV"
    ActiveWorkbook.Names.Add "VungBBNBCV", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub
Private Sub Image3_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Phieu yec cau nghiem thu ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    Tb_VungPYCNT.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungPYCCV"
    ActiveWorkbook.Names.Add "VungPYCCV", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub
Private Sub Image4_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban cong viec xay dung ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    Tb_VungBBCV.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNT"
    ActiveWorkbook.Names.Add "VungBBNT", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub

Attribute VB_Name = "BBNTHT"
Attribute VB_Base = "0{1F1F79C7-F392-4B95-B086-A12CBC5F624A}{D8BD6C93-B224-4399-AD65-BCD675CEFEF5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_Initialize()
    Dim Str As String
OptionButton1 = True
Call List_Printer
Call Get_Default_Printer
tb_vungNTNB.Text = Replace(RefertoName("VungBBNBCVHT"), "=", "")
Tb_VungPYCNT.Text = Replace(RefertoName("VungPYCCVHT"), "=", "")
Tb_VungBBCV.Text = Replace(RefertoName("VungBBNTHT"), "=", "")
Str = RefertoPrintArea
tb_vungAll.Text = Str
If Len(Str) Then
    ActiveSheet.PageSetup.PrintArea = Str
    XoaName "VungBBNT_AllHT"
    ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
End If
End Sub
Private Sub Printer_Properties_Click()
    Call Shell("rundll32 printui.dll,PrintUIEntry /p /n """ & ComboBox1.Value & """", vbNormalFocus)
End Sub
Sub List_Printer()
    Dim aPrinters As Object
    Dim I As Long, N As Long
    With CreateObject("WScript.Network")
        Set aPrinters = .EnumPrinterConnections
        For I = 1 To aPrinters.Count Step 2
            ComboBox1.AddItem aPrinters.Item(I)
        Next
    End With
End Sub
Sub Get_Default_Printer()
    Dim WSHshell As Object, RegKey As String, RegKeySplit As Variant
    Dim RegDefault As String, MyPrinter As String
    RegKey = _
            "HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\Windows\Device"
    Set WSHshell = CreateObject("WScript.Shell")
    RegDefault = WSHshell.RegRead(RegKey)
    Set WSHshell = Nothing
    'Get name default printer:
    RegKeySplit = Split(RegDefault, ",")
    MyPrinter = RegKeySplit(0)
    ComboBox1.Text = MyPrinter
End Sub
Sub XoaName(SName As String)
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then Definename.Delete
    Next
End Sub
Function RefertoName(SName As String) As String
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then
            RefertoName = Definename.RefersTo
            Exit Function
        End If
    Next
End Function
Private Function RefertoPrintArea() As String
    Dim Str As String, Str1 As String, Str2 As String, Str3 As String
    Str1 = Replace(RefertoName("VungBBNBCVHT"), "=", "")
    Str2 = Replace(RefertoName("VungPYCCVHT"), "=", "")
    Str3 = Replace(RefertoName("VungBBNTHT"), "=", "")
    Str = IIf(Len(Str1), Str1 & ",", "") & IIf(Len(Str2), Str2 & ",", "") & IIf(Len(Str3), Str3, "")
    If Right(Str, 1) = "," Then Str = Mid(Str, 1, Len(Str) - 1)
    If Len(Str) Then RefertoPrintArea = Str
End Function
Private Sub CommandButton1_Click()
    Dim a As Integer, b As Integer, N As Long, NameSh As String
    Dim Str As String
    NameSh = ActiveSheet.Name
    BBNTHT.Hide
    a = TextBox1
    b = TextBox2
    N = Application.Max(Sheets("ListBBCV").Range("A4", Sheets("ListBBCV").Range("A" & Rows.Count).End(3)))
    If b < a Then MsgBox "There is no print page"
    If OptionButton1 = True And Len(Str) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_AllHT"), "=", "")
    If OptionButton4 = True And Len(Str1) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNBCVHT"), "=", "")
    If OptionButton2 = True And Len(Str2) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungPYCCVHT"), "=", "")
    If OptionButton3 = True And Len(Str3) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNTHT"), "=", "")
    For a = a To b
        If a > N Then Exit Sub
        Range("P2") = a
        CandongBB
        ActiveWindow.SelectedSheets.PrintOut , ActivePrinter:=ComboBox1, Copies:=1, Collate:=True
        'ActiveWindow.SelectedSheets.PrintPreview
    Next
    Str = RefertoPrintArea
    If Len(Str) Then ActiveSheet.PageSetup.PrintArea = Str
End Sub
Private Sub CommandButton2_Click()
    Dim Str As String
    Str = RefertoPrintArea
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
    Unload Me
End Sub
Private Sub Image1_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Tat ca cac bien ban ", Title:="Chon vung PrintArea", Type:=8)
    tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    tb_vungAll.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNT_AllHT"
    ActiveWorkbook.Names.Add "VungBBNT_AllHT", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNTHT.Show
End Sub
Private Sub Image2_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban noi bo ", Title:="Chon vung PrintArea", Type:=8)
    tb_vungNTNB.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNBCVHT"
    ActiveWorkbook.Names.Add "VungBBNBCVHT", Rn
    Set Rn = Nothing
    Str = RefertoPrintArea
    tb_vungAll.Text = Str
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
Err:
    BBNTHT.Show
End Sub
Private Sub Image3_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Phieu yec cau nghiem thu ", Title:="Chon vung PrintArea", Type:=8)
    Tb_VungPYCNT.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungPYCCVHT"
    ActiveWorkbook.Names.Add "VungPYCCVHT", Rn
    Set Rn = Nothing
    Str = RefertoPrintArea
    tb_vungAll.Text = Str
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
Err:
    BBNTHT.Show
End Sub
Private Sub Image4_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban cong viec xay dung ", Title:="Chon vung PrintArea", Type:=8)
    Tb_VungBBCV.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNTHT"
    ActiveWorkbook.Names.Add "VungBBNTHT", Rn
    Set Rn = Nothing
    Str = RefertoPrintArea
    tb_vungAll.Text = Str
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
Err:
    BBNTHT.Show
End Sub

Attribute VB_Name = "BBNTHTbdf"
Attribute VB_Base = "0{2923C09F-B5A0-4BED-A04A-F05F656A6F59}{17C0A416-122A-409E-A9B0-9105824993F0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_Initialize()
    Dim Str As String
    OptionButton1 = True
    tb_vungNTNB.Text = Replace(RefertoName("VungBBNBCVHT"), "=", "")
    Tb_VungPYCNT.Text = Replace(RefertoName("VungPYCCVHT"), "=", "")
    Tb_VungBBCV.Text = Replace(RefertoName("VungBBNTHT"), "=", "")
    Str = RefertoPrintArea
    tb_vungAll.Text = Str
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
End Sub
Sub List_Printer()
    Dim aPrinters As Object
    Dim I As Long, N As Long
    With CreateObject("WScript.Network")
        Set aPrinters = .EnumPrinterConnections
        For I = 1 To aPrinters.Count Step 2
            ComboBox1.AddItem aPrinters.Item(I)
        Next
    End With
End Sub
Sub XoaName(SName As String)
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then Definename.Delete
    Next
End Sub
Function RefertoName(SName As String) As String
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then
            RefertoName = Definename.RefersTo
            Exit Function
        End If
    Next
End Function
Private Function RefertoPrintArea() As String
    Dim Str As String, Str1 As String, Str2 As String, Str3 As String
    Str1 = Replace(RefertoName("VungBBNBCVHT"), "=", "")
    Str2 = Replace(RefertoName("VungPYCCVHT"), "=", "")
    Str3 = Replace(RefertoName("VungBBNTHT"), "=", "")
    Str = IIf(Len(Str1), Str1 & ",", "") & IIf(Len(Str2), Str2 & ",", "") & IIf(Len(Str3), Str3, "")
    If Right(Str, 1) = "," Then Str = Mid(Str, 1, Len(Str) - 1)
    If Len(Str) Then RefertoPrintArea = Str
End Function
Private Sub CommandButton1_Click()
    Dim a As Integer, b As Integer, N As Long, NameSh As String
    Dim Str As String
    NameSh = ActiveSheet.Name
    BBNTHT.Hide
    a = TextBox1
    b = TextBox2
    N = Application.Max(Sheets("ListBBCV").Range("A4", Sheets("ListBBCV").Range("A" & Rows.Count).End(3)))
    If b < a Then MsgBox "There is no print page"
    If OptionButton1 = True And Len(Str) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_AllHT"), "=", "")
    If OptionButton4 = True And Len(Str1) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNBCVHT"), "=", "")
    If OptionButton2 = True And Len(Str2) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungPYCCVHT"), "=", "")
    If OptionButton3 = True And Len(Str3) Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNTHT"), "=", "")
    For a = a To b
        If a > N Then Exit Sub
        Range("P2") = a
        CandongBB
        ActiveSheet.ExportAsFixedFormat 0, ThisWorkbook.Path & "\" & a & "." & J & ". " & Name
        'ActiveWindow.SelectedSheets.PrintPreview
    Next
    Str = RefertoPrintArea
    If Len(Str) Then ActiveSheet.PageSetup.PrintArea = Str
End Sub
Private Sub CommandButton2_Click()
    Dim Str As String
    Str = RefertoPrintArea
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
    Unload Me
End Sub
Private Sub Image1_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Tat ca cac bien ban ", Title:="Chon vung PrintArea", Type:=8)
    tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    tb_vungAll.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNT_AllHT"
    ActiveWorkbook.Names.Add "VungBBNT_AllHT", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNTHT.Show
End Sub
Private Sub Image2_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban noi bo ", Title:="Chon vung PrintArea", Type:=8)
    tb_vungNTNB.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNBCVHT"
    ActiveWorkbook.Names.Add "VungBBNBCVHT", Rn
    Set Rn = Nothing
    Str = RefertoPrintArea
    tb_vungAll.Text = Str
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
Err:
    BBNTHT.Show
End Sub
Private Sub Image3_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Phieu yec cau nghiem thu ", Title:="Chon vung PrintArea", Type:=8)
    Tb_VungPYCNT.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungPYCCVHT"
    ActiveWorkbook.Names.Add "VungPYCCVHT", Rn
    Set Rn = Nothing
    Str = RefertoPrintArea
    tb_vungAll.Text = Str
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
Err:
    BBNTHT.Show
End Sub
Private Sub Image4_Click()
    Dim Rn As Range
    Dim Str As String
    On Error GoTo Err
    BBNTHT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban cong viec xay dung ", Title:="Chon vung PrintArea", Type:=8)
    Tb_VungBBCV.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNTHT"
    ActiveWorkbook.Names.Add "VungBBNTHT", Rn
    Set Rn = Nothing
    Str = RefertoPrintArea
    tb_vungAll.Text = Str
    If Len(Str) Then
        ActiveSheet.PageSetup.PrintArea = Str
        XoaName "VungBBNT_AllHT"
        ActiveWorkbook.Names.Add "VungBBNT_AllHT", Range(Str)
    End If
Err:
    BBNTHT.Show
End Sub
Attribute VB_Name = "BBNTbdf"
Attribute VB_Base = "0{A4BE8CDE-AACA-4598-8D5C-EE104C341D90}{4219F2AD-AD7B-45AD-9974-11F945FD6AF5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
    Dim a As Integer, b As Integer, N As Long, NameSh As String
    NameSh = ActiveSheet.Name
    BBNT.Hide
    a = TextBox1
    b = TextBox2
    N = Application.Max(Sheets("ListBBCV").Range("A4", Sheets("ListBBCV").Range("A" & Rows.Count).End(3)))
    If b < a Then MsgBox "There is no print page"
    If OptionButton1 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_All"), "=", "")
    If OptionButton4 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNBCV"), "=", "")
    If OptionButton2 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungPYCCV"), "=", "")
    If OptionButton3 = True Then ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT"), "=", "")
    For a = a To b
        If a > N Then Exit Sub
        Range("P2") = a
        CandongBB
        ActiveSheet.ExportAsFixedFormat 0, ThisWorkbook.Path & "\" & a & "." & J & ". " & Name
    Next
    ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_All"), "=", "")
End Sub
Private Sub CommandButton2_Click()
    ActiveSheet.PageSetup.PrintArea = Replace(RefertoName("VungBBNT_All"), "=", "")
    Unload Me
End Sub
Private Sub UserForm_Initialize()
    Dim StrPA As String
    OptionButton1 = True
    tb_vungNTNB.Text = Replace(RefertoName("VungBBNBCV"), "=", "")
    Tb_VungPYCNT.Text = Replace(RefertoName("VungPYCCV"), "=", "")
    Tb_VungBBCV.Text = Replace(RefertoName("VungBBNT"), "=", "")
    StrPA = RefertoPrintArea
    tb_vungAll.Text = StrPA
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
    If Len(StrPA) Then
        ActiveSheet.PageSetup.PrintArea = StrPA
        XoaName "VungBBNT_All"
        ActiveWorkbook.Names.Add "VungBBNT_All", Range(StrPA)
    End If
End Sub
Private Function RefertoPrintArea() As String
    Dim Str As String, Str1 As String, Str2 As String, Str3 As String
    Str1 = Replace(RefertoName("VungBBNBCV"), "=", "")
    Str2 = Replace(RefertoName("VungPYCCV"), "=", "")
    Str3 = Replace(RefertoName("VungBBNT"), "=", "")
    Str = IIf(Len(Str1), Str1 & ",", "") & IIf(Len(Str2), Str2 & ",", "") & IIf(Len(Str3), Str3, "")
    If Right(Str, 1) = "," Then Str = Mid(Str, 1, Len(Str) - 1)
    If Len(Str) Then RefertoPrintArea = Str
End Function
Sub XoaName(SName As String)
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then Definename.Delete
    Next
End Sub
Function RefertoName(SName As String) As String
    Dim Definename As Name
    For Each Definename In ThisWorkbook.Names
        If UCase(Definename.Name) = UCase(SName) Then
            RefertoName = Definename.RefersTo
            Exit Function
        End If
    Next
End Function
Private Sub Image1_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Tat ca cac bien ban ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    tb_vungAll.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNT_All"
    ActiveWorkbook.Names.Add "VungBBNT_All", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub
Private Sub Image2_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban noi bo ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    tb_vungNTNB.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNBCV"
    ActiveWorkbook.Names.Add "VungBBNBCV", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub
Private Sub Image3_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Phieu yec cau nghiem thu ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    Tb_VungPYCNT.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungPYCCV"
    ActiveWorkbook.Names.Add "VungPYCCV", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub
Private Sub Image4_Click()
    Dim Rn As Range, Str As String
    On Error GoTo Err
    BBNT.Hide
    Set Rn = Application.InputBox(Prompt:="Bien ban cong viec xay dung ", Title:="Chon vung PrintArea", Type:=8)
    'tb_vungAll.Text = Rn.Worksheet.Name & "!" & Rn.Address(, , Application.ReferenceStyle)
    Tb_VungBBCV.Text = Rn.Address(, , Application.ReferenceStyle)
    XoaName "VungBBNT"
    ActiveWorkbook.Names.Add "VungBBNT", Rn
    Set Rn = Nothing
    tb_vungAll.Text = RefertoPrintArea
    ActiveSheet.PageSetup.PrintArea = tb_vungAll.Text
Err:
    BBNT.Show
End Sub
Attribute VB_Name = "ConvertFont"
'Ham TCVN3toUNICODE, VNItoUNICODE duoc viet boi Binh - OverAC
'www.giaiphapexcel.com

Function TCVN3toUNICODE(vnStr As String)
Dim c As String, I As Integer
   For I = 1 To Len(vnStr)
      c = Mid(vnStr, I, 1)
      Select Case c
         Case "a": c = ChrW$(97)
         Case "|fffd|": c = ChrW$(225)
         Case "|fffd|": c = ChrW$(224)
         Case "|fffd|": c = ChrW$(7843)
         Case "|fffd|": c = ChrW$(227)
         Case "|fffd|": c = ChrW$(7841)
         Case "|fffd|": c = ChrW$(259)
         Case "|fffd|": c = ChrW$(7855)
         Case "|fffd|": c = ChrW$(7857)
         Case "|fffd|": c = ChrW$(7859)
         Case "|fffd|": c = ChrW$(7861)
         Case "|fffd|": c = ChrW$(7863)
         Case "|fffd|": c = ChrW$(226)
         Case "|fffd|": c = ChrW$(7845)
         Case "|fffd|": c = ChrW$(7847)
         Case "|fffd|": c = ChrW$(7849)
         Case "|fffd|": c = ChrW$(7851)
         Case "|fffd|": c = ChrW$(7853)
         Case "e": c = ChrW$(101)
         Case "|fffd|": c = ChrW$(233)
         Case "|fffd|": c = ChrW$(232)
         Case "|fffd|": c = ChrW$(7867)
         Case "|fffd|": c = ChrW$(7869)
         Case "|fffd|": c = ChrW$(7865)
         Case "|fffd|": c = ChrW$(234)
         Case "|fffd|": c = ChrW$(7871)
         Case "|fffd|": c = ChrW$(7873)
         Case "|fffd|": c = ChrW$(7875)
         Case "|fffd|": c = ChrW$(7877)
         Case "|fffd|": c = ChrW$(7879)
         Case "o": c = ChrW$(111)
         Case "|fffd|": c = ChrW$(243)
         Case "|fffd|": c = ChrW$(242)
         Case "|fffd|": c = ChrW$(7887)
         Case "|fffd|": c = ChrW$(245)
         Case "|fffd|": c = ChrW$(7885)
         Case "|fffd|": c = ChrW$(244)
         Case "|fffd|": c = ChrW$(7889)
         Case "|fffd|": c = ChrW$(7891)
         Case "|fffd|": c = ChrW$(7893)
         Case "|fffd|": c = ChrW$(7895)
         Case "|fffd|": c = ChrW$(7897)
         Case "|fffd|": c = ChrW$(417)
         Case "|fffd|": c = ChrW$(7899)
         Case "|fffd|": c = ChrW$(7901)
         Case "|fffd|": c = ChrW$(7903)
         Case "|fffd|": c = ChrW$(7905)
         Case "|fffd|": c = ChrW$(7907)
         Case "i": c = ChrW$(105)
         Case "|fffd|": c = ChrW$(237)
         Case "|fffd|": c = ChrW$(236)
         Case "|fffd|": c = ChrW$(7881)
         Case "|fffd|": c = ChrW$(297)
         Case "|fffd|": c = ChrW$(7883)
         Case "u": c = ChrW$(117)
         Case "|fffd|": c = ChrW$(250)
         Case "|fffd|": c = ChrW$(249)
         Case "|fffd|": c = ChrW$(7911)
         Case "|fffd|": c = ChrW$(361)
         Case "|fffd|": c = ChrW$(7909)
         Case "|fffd|": c = ChrW$(432)
         Case "|fffd|": c = ChrW$(7913)
         Case "|fffd|": c = ChrW$(7915)
         Case "|fffd|": c = ChrW$(7917)
         Case "|fffd|": c = ChrW$(7919)
         Case "|fffd|": c = ChrW$(7921)
         Case "y": c = ChrW$(121)
         Case "|fffd|": c = ChrW$(253)
         Case "|fffd|": c = ChrW$(7923)
         Case "|fffd|": c = ChrW$(7927)
         Case "|fffd|": c = ChrW$(7929)
         Case "|fffd|": c = ChrW$(7925)
         Case "|fffd|": c = ChrW$(273)
         Case "A": c = ChrW$(65)
         Case "|fffd|": c = ChrW$(258)
         Case "|fffd|": c = ChrW$(194)
         Case "E": c = ChrW$(69)
         Case "|fffd|": c = ChrW$(202)
         Case "O": c = ChrW$(79)
         Case "|fffd|": c = ChrW$(212)
         Case "|fffd|": c = ChrW$(416)
         Case "I": c = ChrW$(73)
         Case "U": c = ChrW$(85)
         Case "|fffd|": c = ChrW$(431)
         Case "Y": c = ChrW$(89)
         Case "|fffd|": c = ChrW$(272)
      End Select
      TCVN3toUNICODE = TCVN3toUNICODE + c
   Next I
End Function
Function VNItoUNICODE(vnStr As String)
Dim c As String, I As Integer
Dim db As Boolean
   For I = 1 To Len(vnStr)
      db = False
      If I < Len(vnStr) Then
         c = Mid(vnStr, I + 1, 1)
         If c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or _
            c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or _
            c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or _
            c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or _
            c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or _
            c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Or c = "|fffd|" Then db = True
      End If
      If db Then
         c = Mid(vnStr, I, 2)
         Select Case c
            Case "a|fffd|": c = ChrW$(225)
            Case "a|fffd|": c = ChrW$(224)
            Case "a|fffd|": c = ChrW$(7843)
            Case "a|fffd|": c = ChrW$(227)
            Case "a|fffd|": c = ChrW$(7841)
            Case "a|fffd|": c = ChrW$(259)
            Case "a|fffd|": c = ChrW$(7855)
            Case "a|fffd|": c = ChrW$(7857)
            Case "a|fffd|": c = ChrW$(7859)
            Case "a|fffd|": c = ChrW$(7861)
            Case "a|fffd|": c = ChrW$(7863)
            Case "a|fffd|": c = ChrW$(226)
            Case "a|fffd|": c = ChrW$(7845)
            Case "a|fffd|": c = ChrW$(7847)
            Case "a|fffd|": c = ChrW$(7849)
            Case "a|fffd|": c = ChrW$(7851)
            Case "a|fffd|": c = ChrW$(7853)
            Case "e|fffd|": c = ChrW$(233)
            Case "e|fffd|": c = ChrW$(232)
            Case "e|fffd|": c = ChrW$(7867)
            Case "e|fffd|": c = ChrW$(7869)
            Case "e|fffd|": c = ChrW$(7865)
            Case "e|fffd|": c = ChrW$(234)
            Case "e|fffd|": c = ChrW$(7871)
            Case "e|fffd|": c = ChrW$(7873)
            Case "e|fffd|": c = ChrW$(7875)
            Case "e|fffd|": c = ChrW$(7877)
            Case "e|fffd|": c = ChrW$(7879)
            Case "o|fffd|": c = ChrW$(243)
            Case "o|fffd|": c = ChrW$(242)
            Case "o|fffd|": c = ChrW$(7887)
            Case "o|fffd|": c = ChrW$(245)
            Case "o|fffd|": c = ChrW$(7885)
            Case "o|fffd|": c = ChrW$(244)
            Case "o|fffd|": c = ChrW$(7889)
            Case "o|fffd|": c = ChrW$(7891)
            Case "o|fffd|": c = ChrW$(7893)
            Case "o|fffd|": c = ChrW$(7895)
            Case "o|fffd|": c = ChrW$(7897)
            Case "|fffd||fffd|": c = ChrW$(7899)
            Case "|fffd||fffd|": c = ChrW$(7901)
            Case "|fffd||fffd|": c = ChrW$(7903)
            Case "|fffd||fffd|": c = ChrW$(7905)
            Case "|fffd||fffd|": c = ChrW$(7907)
            Case "u|fffd|": c = ChrW$(250)
            Case "u|fffd|": c = ChrW$(249)
            Case "u|fffd|": c = ChrW$(7911)
            Case "u|fffd|": c = ChrW$(361)
            Case "u|fffd|": c = ChrW$(7909)
            Case "|fffd||fffd|": c = ChrW$(7913)
            Case "|fffd||fffd|": c = ChrW$(7915)
            Case "|fffd||fffd|": c = ChrW$(7917)
            Case "|fffd||fffd|": c = ChrW$(7919)
            Case "|fffd||fffd|": c = ChrW$(7921)
            Case "y|fffd|": c = ChrW$(253)
            Case "y|fffd|": c = ChrW$(7923)
            Case "y|fffd|": c = ChrW$(7927)
            Case "y|fffd|": c = ChrW$(7929)
            Case "A|fffd|": c = ChrW$(193)
            Case "A|fffd|": c = ChrW$(192)
            Case "A|fffd|": c = ChrW$(7842)
            Case "A|fffd|": c = ChrW$(195)
            Case "A|fffd|": c = ChrW$(7840)
            Case "A|fffd|": c = ChrW$(258)
            Case "A|fffd|": c = ChrW$(7854)
            Case "A|fffd|": c = ChrW$(7856)
            Case "A|fffd|": c = ChrW$(7858)
            Case "A|fffd|": c = ChrW$(7860)
            Case "A|fffd|": c = ChrW$(7862)
            Case "A|fffd|": c = ChrW$(194)
            Case "A|fffd|": c = ChrW$(7844)
            Case "A|fffd|": c = ChrW$(7846)
            Case "A|fffd|": c = ChrW$(7848)
            Case "A|fffd|": c = ChrW$(7850)
            Case "A|fffd|": c = ChrW$(7852)
            Case "E|fffd|": c = ChrW$(201)
            Case "E|fffd|": c = ChrW$(200)
            Case "E|fffd|": c = ChrW$(7866)
            Case "E|fffd|": c = ChrW$(7868)
            Case "E|fffd|": c = ChrW$(7864)
            Case "E|fffd|": c = ChrW$(202)
            Case "E|fffd|": c = ChrW$(7870)
            Case "E|fffd|": c = ChrW$(7872)
            Case "E|fffd|": c = ChrW$(7874)
            Case "E|fffd|": c = ChrW$(7876)
            Case "E|fffd|": c = ChrW$(7878)
            Case "O|fffd|": c = ChrW$(211)
            Case "O|fffd|": c = ChrW$(210)
            Case "O|fffd|": c = ChrW$(7886)
            Case "O|fffd|": c = ChrW$(213)
            Case "O|fffd|": c = ChrW$(7884)
            Case "O|fffd|": c = ChrW$(212)
            Case "O|fffd|": c = ChrW$(7888)
            Case "O|fffd|": c = ChrW$(7890)
            Case "O|fffd|": c = ChrW$(7892)
            Case "O|fffd|": c = ChrW$(7894)
            Case "O|fffd|": c = ChrW$(7896)
            Case "|fffd||fffd|": c = ChrW$(7898)
            Case "|fffd||fffd|": c = ChrW$(7900)
            Case "|fffd||fffd|": c = ChrW$(7902)
            Case "|fffd||fffd|": c = ChrW$(7904)
            Case "|fffd||fffd|": c = ChrW$(7906)
            Case "U|fffd|": c = ChrW$(218)
            Case "U|fffd|": c = ChrW$(217)
            Case "U|fffd|": c = ChrW$(7910)
            Case "U|fffd|": c = ChrW$(360)
            Case "U|fffd|": c = ChrW$(7908)
            Case "|fffd||fffd|": c = ChrW$(7912)
            Case "|fffd||fffd|": c = ChrW$(7914)
            Case "|fffd||fffd|": c = ChrW$(7916)
            Case "|fffd||fffd|": c = ChrW$(7918)
            Case "|fffd||fffd|": c = ChrW$(7920)
            Case "Y|fffd|": c = ChrW$(221)
            Case "Y|fffd|": c = ChrW$(7922)
            Case "Y|fffd|": c = ChrW$(7926)
            Case "Y|fffd|": c = ChrW$(7928)
         End Select
      Else
         c = Mid(vnStr, I, 1)
         Select Case c
            Case "|fffd|": c = ChrW$(417)
            Case "|fffd|": c = ChrW$(237)
            Case "|fffd|": c = ChrW$(236)
            Case "|fffd|": c = ChrW$(7881)
            Case "|fffd|": c = ChrW$(297)
            Case "|fffd|": c = ChrW$(7883)
            Case "|fffd|": c = ChrW$(432)
            Case "|fffd|": c = ChrW$(7925)
            Case "|fffd|": c = ChrW$(273)
            Case "|fffd|": c = ChrW$(416)
            Case "|fffd|": c = ChrW$(205)
            Case "|fffd|": c = ChrW$(204)
            Case "|fffd|": c = ChrW$(7880)
            Case "|fffd|": c = ChrW$(296)
            Case "|fffd|": c = ChrW$(7882)
            Case "|fffd|": c = ChrW$(431)
            Case "|fffd|": c = ChrW$(7924)
            Case "|fffd|": c = ChrW$(272)
         End Select
      End If
      VNItoUNICODE = VNItoUNICODE + c
      If db Then I = I + 1
   Next I
End Function

Function UNC(strTCVN3 As String)
    UNC = TCVN3toUNICODE(strTCVN3)
End Function
Function VNI(strVNI As String)
    VNI = VNItoUNICODE(strVNI)
End Function

Attribute VB_Name = "Data"
Option Explicit
Sub Stt()
    Dim SrcRng As Range, Arr, I As Long, N As Long
On Error Resume Next
With Sheets("Nhattrinh")
    Set SrcRng = Range([C7], [C65536].End(xlUp))
    Arr = SrcRng.Value
    For I = 1 To UBound(Arr, 1)
        If Arr(I, 1) <> "" Then
            N = N + 1
            Arr(I, 1) = N
        End If
    Next
    SrcRng.Offset(, -2).Value = Arr
End With
End Sub
Sub Kiemtra_ngayTC()
    Dim I, J, dongcuoi As Long
    Dim dic As Object, tArr, R As Long
    Set dic = CreateObject("Scripting.Dictionary")
    Application.ScreenUpdating = False
    With Sheet2
        tArr = .Range("G5", .Range("G" & Rows.Count).End(xlUp)).Resize(, 3).Value
        For I = 1 To UBound(tArr)
            If tArr(I, 3) <> Empty Then
                dic.Item(tArr(I, 1)) = I
            End If
        Next I
    End With
    With Sheets("Nhattrinh")
        dongcuoi = .Range("C65000").End(3).row
        For I = 7 To dongcuoi - 1
            If .Cells(I, 3) <> Empty Then
                With Range("F" & I, "J" & I)
                    .Interior.Pattern = xlNone
                    .Font.Strikethrough = False
                End With
            End If
        Next I
        For I = 7 To dongcuoi - 1
            For J = 6 To 10
                Select Case J
                    Case 6 To 7, 9 To 10
                        R = dic.Item(.Cells(I, J).Value)
                        If R Then
                            .Cells(I, J).Interior.ColorIndex = 8
                            .Cells(I, J).Font.Strikethrough = True
                        End If
                End Select
            Next J
        Next
    End With
    Application.ScreenUpdating = True
    MsgboxUni VNI("|fffd|a|fffd| hoa|fffd|n tha|fffd|nh qua|fffd| tr|fffd|nh kie|fffd|m tra nga|fffd|y thi co|fffd|ng"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
End Sub
Sub Taomoi()
    Dim Ask
    Dim I As Long, DONG As Long, dongcuoi As Long, dongdau As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Ask = MsgboxUni(VNI("Ba|fffd|n co|fffd| muo|fffd|n ta|fffd|o co|fffd|ng tr|fffd|nh m|fffd||fffd|i kho|fffd|ng"), vbYesNo, VNI("Tho|fffd|ng ba|fffd|o"))
    If Ask = vbYes Then
        dongcuoi = Sheets("Nhattrinh").Range("D65536").End(xlUp).row
        If dongcuoi - 20 - 1 > 0 Then
            With Sheets("Nhattrinh")     ' danh muc
                .Range("A16:P" & dongcuoi - 1).ClearContents
                .Range("A16:P" & dongcuoi - 1).Interior.ColorIndex = xlNone
                .Range("A16:P" & dongcuoi - 1).Font.ColorIndex = xlAutomatic
                .Range("A16:P" & dongcuoi - 1).Font .Italic = False
                .Range("A16:P" & dongcuoi - 1).Font .Bold = False
                .Range("C21:C" & dongcuoi - 1).EntireRow.Delete
            End With
            With Sheets("ListBBCV").Range("A4: P" & Sheets("ListBBCV").Range("A65535").End(3) + 1)   ' List bien ban nghiem thu
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
            With Sheets("ListBBHT").Range("A4: P" & Sheets("ListBBHT").Range("A65535").End(3) + 1)   ' List bien ban hoan thanh
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
            With Sheets("ListTN").Range("A4: G" & Sheets("ListTN").Range("A65535").End(3) + 1)   ' List thinghiem
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
            With Sheets("DanhmucBBCV").Range("A4: E" & Sheets("DanhmucBBCV").Range("A65535").End(3) + 1)   ' Danhmuc BBCV
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
            With Sheets("DanhmucBBHT").Range("A4: E" & Sheets("DanhmucBBHT").Range("A65535").End(3) + 1)   ' Danhmuc HTHM
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
            With Sheets("DMnhatky").Range("A4: F" & Sheets("DMnhatky").Range("B65535").End(3) + 1)   ' Danhmuc nhatky
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
            With Sheets("NKchitiet").Range("A4: B" & Sheets("NKchitiet").Range("B65535").End(3) + 1)   ' Danhmuc nhatky
                .ClearContents
                .Borders.LineStyle = xlNone
                .Font .Italic = False
                .Font .Bold = False
            End With
            With Sheets("GhiNhatky").Range("A4: B" & Sheets("GhiNhatky").Range("B65535").End(3) + 1)   ' Danhmuc nhatky
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
        End If
    End If
    Application.ScreenUpdating = True
    Sheets("Nhattrinh").Range("B16").Select
    LuuFileMoi
End Sub
Attribute VB_Name = "FormHelp"
Attribute VB_Base = "0{D70DCF32-F9E4-44E8-A998-1C9A99F94C14}{72395519-AAD6-457A-A035-57D461B70B40}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Dim TopicCount As Integer
Dim CurrentTopic As Integer
Dim HelpSheet As Worksheet
Const HelpSheetName As String = "HelpSheet"
Private Sub ExitButton_Click()
    Unload Me
End Sub
Private Sub UserForm_Initialize()
    Dim row As Integer
    Set HelpSheet = ThisWorkbook.Sheets(HelpSheetName)
    TopicCount = Application.WorksheetFunction.CountA(HelpSheet.Range("A:A"))
    For row = 1 To TopicCount
        ComboBoxTopics.AddItem HelpSheet.Cells(row, 1)
    Next row
    ComboBoxTopics.ListIndex = 0
    CurrentTopic = 1
    UpdateForm
End Sub
Private Sub UpdateForm()
    ComboBoxTopics.ListIndex = CurrentTopic - 1
    Me.Caption = "HelpSheet" & " (" & CurrentTopic & " of " & TopicCount & ")"
    With LabelText
        .Caption = HelpSheet.Cells(CurrentTopic, 2)
        .AutoSize = True
        .Width = 480
        .AutoSize = True
    End With
    With Frame1
        .ScrollHeight = LabelText.Height + 5
        .ScrollTop = 1
    End With
    On Error Resume Next
    If CurrentTopic = 1 Then PreviousButton.Enabled = False _
            Else PreviousButton.Enabled = True
    If CurrentTopic = TopicCount Then NextButton.Enabled = False _
            Else NextButton.Enabled = True
    If NextButton.Enabled Then NextButton.SetFocus _
            Else PreviousButton.SetFocus
End Sub
Private Sub ComboBoxTopics_Click()
    '   Executed when the ComboBox is changed
    CurrentTopic = ComboBoxTopics.ListIndex + 1
    UpdateForm
End Sub
Private Sub PreviousButton_Click()
    '   Executed when the PreviousButton is clicked
    If CurrentTopic <> 1 Then
        CurrentTopic = CurrentTopic - 1
        UpdateForm
    End If
End Sub
Private Sub NextButton_Click()
    '   Executed when the NextButton is clicked
    If CurrentTopic <> TopicCount Then
        CurrentTopic = CurrentTopic + 1
        UpdateForm
    End If
End Sub

Attribute VB_Name = "FormLMBT"
Attribute VB_Base = "0{4B5768D1-CCFE-43C4-B3D4-6E360BBF4AD0}{6799EC45-A104-4CF7-8486-70EEB642F359}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Attribute VB_Name = "Form_Accuweather"
Attribute VB_Base = "0{3E357D57-05EF-4080-A523-9E70BEFAA73F}{8A137147-80BF-4C08-89DB-4937F6BF728E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private sArray, tArray
Dim dic As Object
Private Sub CommandButton1_Click()
    Dim fDate As Date, eDate As Date, fTmp, eTmp
If Len(TbTRam) Then
    fTmp = Split(Ngaydau, "/"): eTmp = Split(Ngaycuoi, "/")
    fDate = DateSerial(fTmp(2), fTmp(1), fTmp(0))
    eDate = DateSerial(eTmp(2), eTmp(1), eTmp(0))
    GetdatawebAccuweather TbTRam, fDate, eDate
    Unload Me
Else
    MsgBox "Nothing"
End If
End Sub
Private Sub ListBox1_Click()
    Dim I As Long
    Dim Str As String, Str1 As String
    Str = "(D" & ChrW$(7919) & " li" & ChrW$(7879) & "u l" & ChrW$(7845) & "y t" & ChrW$(7841) & "i https://www.accuweather.com v" & ChrW$(7899) & "i tr" & ChrW$(7841) & "m "
    Str1 = "t" & ChrW$(7881) & "nh"
    On Error Resume Next
    I = ListBox1.ListIndex
    TbTRam = ListBox1.List(I, 1)
    Range("A3") = Str & " " & ListBox1.List(I, 1) & " " & Str1 & " " & ListBox1.List(I, 0) & ")"
End Sub
Private Sub Ngaydau_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    Dim Msg As Long, TieuDe As String, Noidung As String, N As Long
    TieuDe = VNI("Tho|fffd|ng ba|fffd|o")
    Noidung = VNI("Nga|fffd|y pha|fffd|i la|fffd| |fffd||fffd|nh da|fffd|ng dd/mm/yyy hoa|fffd|c dd-mm-yyyy")
    If IsDate(Ngaydau) = False Then
        Cancel = True
        Msg = MyUniMsgBox(TieuDe, Noidung, msoAlertButtonOK, 4, msoAlertDefaultFirst)
        Ngaydau = ""
    End If
    Me.Ngaydau = Format(Me.Ngaydau, "dd/mm/yyyy")
End Sub
Private Sub Ngaycuoi_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    Dim Msg As Long, TieuDe As String, Noidung As String, N As Long
    TieuDe = VNI("Tho|fffd|ng ba|fffd|o")
    Noidung = VNI("Nga|fffd|y pha|fffd|i la|fffd| |fffd||fffd|nh da|fffd|ng dd/mm/yyy hoa|fffd|c dd-mm-yyyy")
    If IsDate(Ngaycuoi) = False Then
        Cancel = True
        Msg = MyUniMsgBox(TieuDe, Noidung, msoAlertButtonOK, 4, msoAlertDefaultFirst)
        Ngaycuoi = ""
    End If
    Me.Ngaycuoi = Format(Me.Ngaycuoi, "dd/mm/yyyy")
End Sub
Private Sub TextBox3_Change()
    Dim Arr, Arr1
    On Error Resume Next
    If Len(Trim(TextBox3.Value)) = 0 Then Me.ListBox1.List() = sArray: Exit Sub
    Arr = Filter2DArray(sArray, 1, "*" & TextBox3.Value & "*", False)
    If Not IsArray(Arr) Then
        Arr = Filter2DArray(sArray, 2, "*" & TextBox3.Value & "*", False)
        If Not IsArray(Arr) Then ListBox1.Clear: Exit Sub
    End If
    Me.ListBox1.List() = IIf(Trim(TextBox3.Text) = "", sArray, Arr)
    ListBox1.Selected(0) = True
End Sub
Private Sub UserForm_Initialize()
    Dim sArr, dArr, I As Long, J As Long, Tinh As String
    Dim fDate As Date, eDate As Date, fTmp, eTmp
    Dim fNgaydau As String, eNgaycuoi As String
    Set dic = CreateObject("Scripting.Dictionary")
    fNgaydau = Sheet2.Range("E2").Value
    eNgaycuoi = Sheet2.Range("G2").Value
    If Len(fNgaydau) Then
        fTmp = Split(fNgaydau, "/")
        fDate = DateSerial(fTmp(2), fTmp(1), fTmp(0))
        Ngaydau = fDate
    End If
    If Len(eNgaycuoi) Then
        eTmp = Split(eNgaycuoi, "/")
        eDate = DateSerial(eTmp(2), eTmp(1), eTmp(0))
        Ngaycuoi = eDate
    End If
    With Sheet21
        sArr = .Range("A2", .Range("C" & Rows.Count).End(3))
    End With
    ReDim dArr(1 To UBound(sArr, 1), 1 To UBound(sArr, 2))
    For I = 1 To UBound(sArr)
        If sArr(I, 1) <> Empty Then Tinh = sArr(I, 1)
        dArr(I, 1) = Tinh
        For J = 2 To UBound(sArr, 2)
            dArr(I, J) = sArr(I, J)
        Next J
    Next I
    sArray = dArr
    ListBox1.List() = sArray
    TextBox3.SetFocus
End Sub
Attribute VB_Name = "FrmDMHH"
Attribute VB_Base = "0{53D80A67-0021-4D83-BD32-95EF95ACD6FA}{F1642D99-4378-40A7-99AE-76A6C2D5AACA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private sArray, dArray, tArray
Dim dic As Object
Private Sub CMDADD_Click()
On Error Resume Next
    Dim Rw As Long, Er As Long, Ec As Long
Application.ScreenUpdating = False
Rw = ActiveCell.row
If ActiveCell.Column = 3 Then
    Range("A" & Rw & ":P" & Rw).ClearContents
    Cells(Rw, "C") = Mahieu: Cells(Rw, "D") = Noidungcongviec
    Cells(Rw, "K") = MaTieuchuan: Cells(Rw, "L") = Mathinghiem
    Cells(Rw, "H") = "=IF(RC[-1]<>"""",RC[-1]-RC[-2]+1,"""")"
    Cells(Rw, "M") = "=IF(RC[-10]<>"""",COUNTIF(R7C3:RC[-10],RC[-10]),"""")"
    Cells(Rw, "O") = "=IF(RC[-5]<>"""",COUNTIF(R7C10:RC[-5],RC[-5]),"""")"
    If MaTieuchuan = Empty Then
        If Left(Mahieu, 2) = "CP" Then
            With Range("A" & Rw & ":M" & Rw).Font
                .Italic = True
                .Color = -16776961
            End With
        ElseIf Left(Mahieu, 2) = "KT" Then
            With Range("A" & Rw & ":M" & Rw).Font
                .Italic = True
                .Color = -65536
            End With
        ElseIf Left(Mahieu, 2) = "TC" Then
            With Range("A" & Rw & ":M" & Rw).Font
                .Italic = False
                .Color = -6279056
            End With
        End If
    Else
        Cells(Rw, "J") = "=IF(RC[-1]<>"""",RC[-1]+1,"""")"
        With Range("A" & Rw & ":M" & Rw).Font
            .Italic = False
            .Color = 8
        End With
    End If
End If
'------------------------------------------------------------------
Ec = Range("A65535").End(3).row: Er = Range("A" & Ec).End(3).row
If Ec - Er < 5 Then Range("A" & Ec - 1).EntireRow.Insert
'------------------------------------------------------------------
Call Stt
Unload Me
Application.ScreenUpdating = True
End Sub
Private Sub CommandButton1_Click()
    FrmTCNTEDIT.Show
End Sub
Private Sub CommandButton2_Click()
    FrmKQTNEDIT.Show
End Sub
Private Sub ThemMahieumoi_Click()
    Unload Me
    ThemmoiMahieu.Show
End Sub
Private Sub LBDMHH_Change()
    On Error Resume Next
    Dim I As Long
    I = LBDMHH.ListIndex
    Mahieu = LBDMHH.List(I, 0): Noidungcongviec = LBDMHH.List(I, 1)
    MaTieuchuan = LBDMHH.List(I, 2): Mathinghiem = LBDMHH.List(I, 3)
End Sub
Private Sub MaTieuchuan_Change()
    TextBox2 = TieuchuanNT(MaTieuchuan, Sheet4.Range("A3:B300"), 2)
End Sub
Private Sub Mathinghiem_Change()
    TextBox4 = TieuchuanTN(Mathinghiem, Sheet20.Range("A3:B300"), 2)
End Sub
Private Sub TXTFIND_Change()
    On Error Resume Next
    Dim Arr
    If Len(Trim(TXTFIND.Value)) = 0 Then Me.LBDMHH.List() = sArray: Exit Sub
    Arr = Filter2DArray(sArray, 1, "*" & TXTFIND.Value & "*", False)
    If Not IsArray(Arr) Then
        Arr = Filter2DArray(sArray, 2, "*" & TXTFIND.Value & "*", False)
        If Not IsArray(Arr) Then LbMaCV.Clear: Exit Sub
    End If
    Me.LBDMHH.List() = IIf(Trim(TXTFIND.Text) = "", sArray, Arr)
End Sub
Private Sub UserForm_Initialize()
    Set dic = CreateObject("Scripting.Dictionary")
    sArray = Sheet3.Range("A3:D" & Sheet3.[A65536].End(xlUp).row).Value
    LBDMHH.List() = sArray
End Sub
Private Sub UserForm_Terminate()
    Set dic = Nothing
    Erase sArray
End Sub
Private Sub LBDMHH_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll LBDMHH
End Sub

Attribute VB_Name = "FrmKQTNEDIT"
Attribute VB_Base = "0{6C5C44B0-2826-470C-9675-84CCDE54FD0C}{5B9B7B87-6511-4CA9-BA2A-3473DB257915}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private dArray
Dim dic As Object
Private Sub ChonEditthinghiem_Click()
If FrmMCV.Visible = True Then FrmMCV.Txt_KQTN = Mathinghiem
If Mathinghiem = Empty Then
    MsgboxUni VNI("Ch|fffd|a co|fffd| ma|fffd| hie|fffd|u th|fffd| nghie|fffd|m. Ne|fffd|u muo|fffd|n thoa|fffd|t ba|fffd|m nu|fffd|t Close |fffd|e|fffd| ta|fffd|t Form"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
Else
    If Sheets("MaCV").Visible = True Then
        If ActiveCell.Column = 4 Then
            Cells(ActiveCell.row, "D") = Mathinghiem
        End If
    End If
    If Sheets("Nhattrinh").Visible = True Then
        If ActiveCell.Column = 13 Then
            Cells(ActiveCell.row, ActiveCell.Column) = Mathinghiem
        End If
    End If
End If
End Sub



Private Sub LB_KQTN_Change()
    Dim Str As String, rng As Range
    With Me.LB_KQTN
        For I = 0 To .ListCount - 1
            If .Selected(I) Then
                Str = IIf(Str = "", .List(I, 0), Str & "; " & .List(I, 0))
            End If
        Next I
    End With
    If Len(Str) Then
        Set rng = Sheets("KQTN").Range("A3:B" & Sheets("KQTN").Range("A" & Rows.Count).End(xlUp).row + 1)
        Mathinghiem = Str
        Lb_mathinghiem.List() = CoverStringtoArray(";", Str, rng)
    Else
        Mathinghiem = "":  Lb_mathinghiem.Clear
    End If
End Sub
Private Sub TXT_editKQTN_Change()
    Dim Arr
    On Error Resume Next
    If Len(Trim(TXT_editKQTN.Value)) = 0 Then Me.LB_KQTN.List() = dArray: Exit Sub
    Arr = Filter2DArray(sArray, 1, "*" & TXT_editKQTN.Value & "*", False)
    If Not IsArray(Arr) Then
        Arr = Filter2DArray(dArray, 2, "*" & TXT_editKQTN.Value & "*", False)
        If Not IsArray(Arr) Then LbMaCV.Clear: Exit Sub
    End If
    Me.LB_KQTN.List() = IIf(Trim(TXT_editKQTN.Text) = "", dArray, Arr)
End Sub
Private Sub UserForm_Initialize()
    Dim iCount  As Long
    UnhookControlScroll
    Set dic = CreateObject("Scripting.Dictionary")
    With Sheets("KQTN")
        dArray = .Range("A3:C" & .Range("A65535").End(xlUp).row).Value
    End With
    With LB_KQTN
        .List() = dArray
        .MultiSelect = fmMultiSelectSingle
        .Value = ""
        .MultiSelect = fmMultiSelectMulti
    End With
    ' For iCount = 0 To LB_KQTN.ListCount
    'LB_KQTN.Selected(iCount) = False
    'Next iCount
End Sub
Private Sub UserForm_Terminate()
    On Error Resume Next
    Set dic = Nothing
    Erase dArray
End Sub
Private Sub LB_KQTN_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll LB_KQTN
End Sub
Private Sub Lb_mathinghiem_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll Lb_mathinghiem
End Sub

Attribute VB_Name = "FrmMCV"
Attribute VB_Base = "0{2EDC2BFA-1DBD-4AE9-85D5-3650BBD8C468}{D50DC318-B23F-4299-BF39-BF8ECF2C4518}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private sArray, dArray, tArray, ArrTN, ArrBBKT
Dim dic As Object
Private Sub Cb_ChapnhanKQTN_Click()
On Error Resume Next
    Dim I As Long, Rw As Long, Er As Long, Ec As Long, N As Long
    Dim rTxt As String
rTxt = "L" & ChrW$(7845) & "y m" & ChrW$(7851) & "u "
Application.ScreenUpdating = False
Rw = ActiveCell.row
If ActiveCell.Column = 3 Then
    Range("A" & Rw & ":P" & Rw).ClearContents
    With Lb_MaBBTN
        For I = 0 To .ListCount - 1
            If .Selected(I) Then
                N = N + 1
                Cells(Rw, "C").Value = .List(I, 0):  Cells(Rw, "D").Value = rTxt & .List(I, 1)
            End If
        Next I
    End With
    If N Then
        With Range("A" & Rw & ":M" & Rw).Font
            .Italic = True:                    .Color = -16776961
        End With
        Cells(Rw, "H") = "=IF(RC[-1]<>"""",RC[-1]-RC[-2]+1,"""")"
        Cells(Rw, "N") = "=IF(RC[-11]<>"""",COUNTIF(R7C3:RC[-11],RC[-11]),"""")"
        Cells(Rw, "O") = "=IF(RC[-6]<>"""",COUNTIF(R7C[-6]:RC9,RC[-5]),"""")"
        Cells(Rw, "P") = "=IF(RC[-5]<>"""",COUNTIF(R7C11:RC[-5],RC[-5]),"""")"
        '------------------------------------------------------------------
        Ec = Range("A65535").End(3).row: Er = Range("A" & Ec).End(3).row
        If Ec - Er < 15 Then Range("A" & Ec - 1).EntireRow.Insert
        '------------------------------------------------------------------
        Call Stt
        Unload Me
    Else
        MsgboxUni VNI("Ba|fffd|n ch|fffd|a chon no|fffd|i dung co|fffd|ng vie|fffd|c  ^_^"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
    End If
End If
Application.ScreenUpdating = True
End Sub
Private Sub Cb_ChapnhabBBKT_Click()
    On Error Resume Next
    Dim I As Long, Rw As Long, Er As Long, Ec As Long, N As Long
    Application.ScreenUpdating = False
    Rw = ActiveCell.row
    If ActiveCell.Column = 3 Then
        Range("A" & Rw & ":P" & Rw).ClearContents
        With Lb_MaBBKT
            For I = 0 To .ListCount - 1
                If .Selected(I) Then
                    N = N + 1
                    Cells(Rw, "C").Value = .List(I, 0):  Cells(Rw, "D").Value = .List(I, 1)
                End If
            Next I
        End With
        If N Then
            With Range("A" & Rw & ":M" & Rw).Font
                .Italic = True:             .Color = -65536
            End With
            Cells(Rw, "N") = "=IF(RC[-11]<>"""",COUNTIF(R7C3:RC[-11],RC[-11]),"""")"
            Cells(Rw, "O") = "=IF(RC[-6]<>"""",COUNTIF(R7C[-6]:RC9,RC[-5]),"""")"
            Cells(Rw, "P") = "=IF(RC[-5]<>"""",COUNTIF(R7C11:RC[-5],RC[-5]),"""")"
            '------------------------------------------------------------------
            Ec = Range("A65535").End(3).row: Er = Range("A" & Ec).End(3).row
            If Ec - Er < 15 Then Range("A" & Ec - 1).EntireRow.Insert
            '------------------------------------------------------------------
            Call Stt
            Unload Me
        Else
            MsgboxUni VNI("Ba|fffd|n ch|fffd|a chon no|fffd|i dung co|fffd|ng vie|fffd|c  ^_^"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
        End If
    End If
    Application.ScreenUpdating = True
End Sub
Private Sub Cb_Chapnhan_Click()
    On Error Resume Next
    Dim I As Long, Rw As Long, Er As Long, Ec As Long, N As Long
    Application.ScreenUpdating = False
    Rw = ActiveCell.row
    If ActiveCell.Column = 3 Then
        Range("A" & Rw & ":P" & Rw).ClearContents
        With Lb_Mahieu
            For I = 0 To .ListCount - 1
                If .List(I, 0) <> Empty Then
                    N = N + 1
                    Cells(Rw, "C").Value = .List(I, 0):  Cells(Rw, "D").Value = .List(I, 1)
                End If
            Next I
        End With
        If N Then
            If OptionButton1 = False And OptionButton2 = False Then
                MsgboxUni VNI("Click mo|fffd|t trong hai l|fffd||fffd|a cho|fffd|n (Thi co|fffd|ng, Nghie|fffd|m thu)   ^_^"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
                Exit Sub
            End If
            If OptionButton2 = True Then
                Cells(Rw, "J") = "=IF(RC[-1]<>"""",RC[-1],"""")"
                Cells(Rw, "K") = "=IF(RC[-1]<>"""",RC[-1]+1,"""")"
                With Range("A" & Rw & ":M" & Rw).Font
                    .Italic = False:            .Color = 8
                End With
                Cells(Rw, "L") = Txt_TCNT: Cells(Rw, "M") = Txt_KQTN
            Else
                With Range("A" & Rw & ":M" & Rw).Font
                    .Italic = False:            .Color = -6279056
                End With
                Cells(Rw, "H") = "=IF(RC[-1]<>"""",RC[-1]-RC[-2]+1,"""")"
            End If
            '------------------------------------------------------------------
            Ec = Range("A65535").End(3).row: Er = Range("A" & Ec).End(3).row
            If Ec - Er < 15 Then Range("A" & Ec - 1).EntireRow.Insert
            '------------------------------------------------------------------
            Call Stt
            Unload Me
        Else
            MsgboxUni VNI("Ba|fffd|n ch|fffd|a chon no|fffd|i dung co|fffd|ng vie|fffd|c  ^_^"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
        End If
        Cells(Rw, "N") = "=IF(RC[-11]<>"""",COUNTIF(R7C3:RC[-11],RC[-11]),"""")"
        Cells(Rw, "O") = "=IF(RC[-6]<>"""",COUNTIF(R7C[-6]:RC9,RC[-5]),"""")"
        Cells(Rw, "P") = "=IF(RC[-5]<>"""",COUNTIF(R7C11:RC[-5],RC[-5]),"""")"
    End If
    Application.ScreenUpdating = True
End Sub
Private Sub Cb_editKQTN_Click()
    FrmKQTNEDIT.Show
End Sub
Private Sub Cb_editTCNNT_Click()
    FrmTCNTEDIT.Show
End Sub
Private Sub Lb_MaBBKT_Change()
    On Error Resume Next
    Dim Arr1(1 To 1, 1 To 2), I As Long
    I = Lb_MaBBKT.ListIndex
    Arr1(1, 1) = Lb_MaBBKT.List(I, 0)
    Arr1(1, 2) = Lb_MaBBKT.List(I, 1)
    ListBox2.List() = Arr1
End Sub
Private Sub Lb_MaBBTN_Change()
    On Error Resume Next
    Dim Arr(1 To 1, 1 To 2), I As Long
    Dim rTxt As String
    rTxt = "L" & ChrW$(7845) & "y m" & ChrW$(7851) & "u "
    I = Lb_MaBBTN.ListIndex
    Arr(1, 1) = Lb_MaBBTN.List(I, 0)
    Arr(1, 2) = rTxt & Lb_MaBBTN.List(I, 1)
    ListBox3.List() = Arr
End Sub
Private Sub LbMaCV_Click()
    On Error Resume Next
    Dim Arr(1 To 1, 1 To 2), I As Long, Itn As Long, Idx As Long
    Dim rng As Range, Arr1(), Arr2()
    Txt_TCNT = "": Txt_KQTN = ""
    I = LbMaCV.ListIndex
    Arr(1, 1) = LbMaCV.List(I, 0)
    Arr(1, 2) = LbMaCV.List(I, 1)
    Lb_Mahieu.List() = Arr
    Txt_TCNT = LbMaCV.List(I, 2): Txt_KQTN = LbMaCV.List(I, 3)
End Sub
Private Sub TxT_FindBBKT_Change()
    Dim Arr
    On Error Resume Next
    If Len(Trim(TxT_FindBBKT.Value)) = 0 Then Me.Lb_MaBBKT.List() = ArrBBKT: Exit Sub
    Arr = Filter2DArray(ArrBBKT, 1, "*" & TxT_FindBBKT.Value & "*", False)
    If Not IsArray(Arr) Then
        Arr = Filter2DArray(ArrBBKT, 2, "*" & TxT_FindBBKT.Value & "*", False)
        If Not IsArray(Arr) Then LbMaCV.Clear: Exit Sub
    End If
    Me.Lb_MaBBKT.List() = IIf(Trim(TxT_FindBBKT.Text) = "", ArrBBKT, Arr)
    'LbMaCV.Selected(0) = True
End Sub
Private Sub TxT_FindBBTN_Change()
    Dim Arr
    On Error Resume Next
    If Len(Trim(TxT_FindBBTN.Value)) = 0 Then Lb_MaBBTN.List() = ArrTN: Exit Sub
    Arr = Filter2DArray(ArrTN, 1, "*" & TxT_FindBBTN.Value & "*", False)
    If Not IsArray(Arr) Then
        Arr = Filter2DArray(ArrTN, 2, "*" & TxT_FindBBTN.Value & "*", False)
        If Not IsArray(Arr) Then LbMaCV.Clear: Exit Sub
    End If
    Lb_MaBBTN.List() = IIf(Trim(TxT_FindBBTN.Text) = "", ArrTN, Arr)
End Sub
Private Sub Txt_KQTN_Change()
    Dim rng As Range
    If Len(Txt_KQTN) Then
        With Sheets("KQTN")
            Set rng = .Range("A3:B" & .Range("A" & Rows.Count).End(xlUp).row + 1)
        End With
        LbThinghiem.List() = CoverStringtoArray(";", Txt_KQTN, rng)
    Else
        LbThinghiem.Clear
    End If
End Sub
Private Sub Txt_TCNT_Change()
    Dim rng As Range
    If Len(Txt_TCNT) Then
        With Sheets("TCNT")
            Set rng = .Range("A3:B" & .Range("A" & Rows.Count).End(xlUp).row + 1)
        End With
        LBTCNT.List() = CoverStringtoArray(";", Txt_TCNT, rng)
    Else
        LBTCNT.Clear
    End If
End Sub
Private Sub TXTFIND_Change()
    Dim Arr
    On Error Resume Next
    If Len(Trim(TXTFIND.Value)) = 0 Then Me.LbMaCV.List() = sArray: Exit Sub
    Arr = Filter2DArray(sArray, 1, "*" & TXTFIND.Value & "*", False)
    If Not IsArray(Arr) Then
        Arr = Filter2DArray(sArray, 2, "*" & TXTFIND.Value & "*", False)
        If Not IsArray(Arr) Then LbMaCV.Clear: Exit Sub
    End If
    Me.LbMaCV.List() = IIf(Trim(TXTFIND.Text) = "", sArray, Arr)
End Sub
Private Sub UserForm_Initialize()
    UnhookControlScroll
    With Sheets("MaCV")                        '* Ma hieu cong viec
        sArray = .Range("A3", .Range("A" & Rows.Count).End(xlUp)).Resize(, 4).Value
    End With
    With Sheets("MaBBKT")                     '* Bien ban kiem tra
        ArrBBKT = .Range("A3", .Range("A" & Rows.Count).End(xlUp)).Resize(, 4).Value
    End With
    With Sheets("MaTN")                    '* Thi nghiem
        ArrTN = .Range("A3", .Range("A" & Rows.Count).End(xlUp)).Resize(, 4).Value
    End With
    LbMaCV.List() = sArray
    Lb_MaBBKT.List() = ArrBBKT
    Lb_MaBBTN.List() = ArrTN
    FrmMCV.Caption = "                                                                                                                         ---- HSQLCL: 2018 ---                                                            "
    Me.MultiPage1.Page1.Caption = "   M" & ChrW$(227) & " c" & ChrW$(244) & "ng vi" & ChrW$(7879) & "c   "
    Me.MultiPage1.Page2.Caption = "   M" & ChrW$(227) & " bi" & ChrW$(234) & "n b" & ChrW$(7843) & "n ki" & ChrW$(7875) & "m tra   "
    Me.MultiPage1.Page3.Caption = "   M" & ChrW$(227) & " bi" & ChrW$(234) & "n b" & ChrW$(7843) & "n l" & ChrW$(7845) & "y m" & ChrW$(7851) & "u  "
    OptionButton1.Caption = "Thi c" & ChrW$(244) & "ng"
    OptionButton2.Caption = "Nghi" & ChrW$(7879) & "m thu"
    Me.MultiPage1.Value = 0
    Me.TXTFIND.SetFocus
End Sub
Private Sub UserForm_Terminate()
    'Set dic = Nothing
    Erase sArray
End Sub
Private Sub LbMaCV_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll LbMaCV
End Sub
Private Sub Lb_MaBBKT_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll Lb_MaBBKT
End Sub
Private Sub Lb_MaBBTN_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll Lb_MaBBTN
End Sub

Attribute VB_Name = "FrmTCNTEDIT"
Attribute VB_Base = "0{9EECD850-55BB-4BE5-89C3-BF18BA597F27}{AE2A37E5-2866-48D9-AEFE-77794BC128CD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private dArray
Dim dic As Object
Private Sub Chonmahieu()
    Dim lItem As Long, k&
    Dim Arr(), Str As String
    On Error Resume Next
    ReDim Arr(1 To LBTCNT.ListCount, 1 To 1)
    For lItem = 0 To LBTCNT.ListCount - 1
        If LBTCNT.Selected(lItem) = True Then
            Str = Str & ";" & LBTCNT.List(lItem)
        End If
        LBTCNT.Selected(lItem) = False
    Next
    MaTieuchuan = Mid(Str, 2, Len(Str) - 1)
End Sub
Private Sub ChonmaEdittieuchuan()
    On Error Resume Next
    Dim I As Long
    I = LBTCNT.ListIndex
    MaTieuchuan = LBTCNT.List(I, 0): TextBox2 = LBTCNT.List(I, 1)
End Sub
Private Sub CommandButton1_Click()
    If FrmMCV.Visible = True Then FrmMCV.Txt_TCNT = MaTieuchuan
    If MaTieuchuan = Empty Then
        MsgboxUni VNI("Ch|fffd|a co|fffd| ma|fffd| hie|fffd|u. Ne|fffd|u muo|fffd|n thoa|fffd|t ba|fffd|m nu|fffd|t Close |fffd|e|fffd| ta|fffd|t Form"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
    Else
        If Sheets("MaCV").Visible = True Then
            If ActiveCell.Column = 3 Then
                Cells(ActiveCell.row, "C") = MaTieuchuan
            End If
        End If
        If Sheets("Nhattrinh").Visible = True Then
            If ActiveCell.Column = 12 Then
                Cells(ActiveCell.row, ActiveCell.Column) = MaTieuchuan
            End If
        End If
    End If
End Sub
Private Sub LBTCNT_Change()
    Dim Str As String, rng As Range
    MaTieuchuan = ""
    With LBTCNT
        For I = 0 To .ListCount - 1
            If .Selected(I) Then
                Str = IIf(Str = "", .List(I, 0), Str & "; " & .List(I, 0))
            End If
        Next I
    End With
    If Len(Str) Then
        Set rng = Sheets("TCNT").Range("A3:B" & Sheets("TCNT").Range("A" & Rows.Count).End(xlUp).row + 1)
        MaTieuchuan = Str
        LbEditTCNT.List() = CoverStringtoArray(";", Str, rng)
    Else
        MaTieuchuan = "": LbEditTCNT.Clear
    End If
End Sub
Private Sub TXTTCNT_Change()
    Dim Arr
    On Error Resume Next
    If Len(Trim(TXTTCNT.Value)) = 0 Then Me.LBTCNT.List() = dArray: Exit Sub
    Arr = Filter2DArray(sArray, 1, "*" & TXTTCNT.Value & "*", False)
    If Not IsArray(Arr) Then
        Arr = Filter2DArray(dArray, 2, "*" & TXTTCNT.Value & "*", False)
        If Not IsArray(Arr) Then LbMaCV.Clear: Exit Sub
    End If
    Me.LBTCNT.List() = IIf(Trim(TXTTCNT.Text) = "", dArray, Arr)
End Sub
Private Sub UserForm_Initialize()
    Dim iCount As Long
    Set dic = CreateObject("Scripting.Dictionary")
    UnhookControlScroll
    dArray = Sheets("TCNT").Range("A3:C" & Sheets("TCNT").[A65536].End(xlUp).row).Value
    LBTCNT.List() = dArray
    For iCount = 0 To LBTCNT.ListCount
        LBTCNT.Selected(iCount) = False
    Next iCount
End Sub
Private Sub UserForm_Terminate()
    On Error Resume Next
    Set dic = Nothing
    Erase dArray
End Sub
Private Sub LBTCNT_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll LBTCNT
End Sub
Private Sub LbEditTCNT_MouseMove(ByVal Button As Integer, _
            ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
    HookControlScroll LbEditTCNT
End Sub

Attribute VB_Name = "Fun"

Sub WaitFor(NumOfSeconds As Single)
    Dim SngSec As Single
    SngSec = Timer + NumOfSeconds
    Do While Timer < SngSec
        DoEvents
    Loop
End Sub
Function TieuchuanNT(Ma As String, rng As Range, N As Long)
    Dim my_arr, sArr, dic As Object, Tem  As String, R As Long
    Dim J As Long, I As Long
    On Error Resume Next
    Set dic = CreateObject("Scripting.Dictionary")
    sArr = rng.Value
    my_arr = Split(Ma, ";")
    For I = 1 To UBound(sArr)
        Tem = sArr(I, 1)
        If Tem <> Empty Then
            dic.Item(Tem) = I
        End If
    Next I
    For J = 0 To UBound(my_arr)
        Tem = Trim(my_arr(J))
        R = dic.Item(Tem)
        If R Then
            If TieuchuanNT <> Empty Then
                TieuchuanNT = TieuchuanNT & Chr(10) & "+ " & Tem & " " & sArr(R, N)
            Else
                TieuchuanNT = "+ " & Tem & "  " & sArr(R, N)
            End If
        End If
    Next J
End Function
Function TieuchuanTN(Ma As String, rng As Range, N As Long)
    Dim my_arr, sArr, dic As Object, Tem  As String, R As Long
    Dim J As Long, I As Long
    On Error Resume Next
    Set dic = CreateObject("Scripting.Dictionary")
    sArr = rng.Value
    my_arr = Split(Ma, ";")
    For I = 1 To UBound(sArr)
        Tem = sArr(I, 1)
        If Tem <> Empty Then
            dic.Item(Tem) = I
        End If
    Next I
    For J = 0 To UBound(my_arr)
        Tem = Trim(my_arr(J))
        R = dic.Item(Tem)
        If R Then
            If TieuchuanTN <> Empty Then
                TieuchuanTN = TieuchuanTN & Chr(10) & "+ " & " " & sArr(R, N)
            Else
                TieuchuanTN = "+ " & "  " & sArr(R, N)
            End If
        End If
    Next J
End Function
Function TenSheet(Ma As Variant) As String
    On Error Resume Next
    Dim sArr, I As Long
    sArr = Sheets("Tam").Range("Q3:R9").Value
    For I = 1 To UBound(sArr)
        If Ma = sArr(I, 1) Then
            TenSheet = sArr(I, 2)
            Exit For
        End If
    Next I
End Function
Function TachgioBB(Ma As String, N As Long) As String
    On Error Resume Next
    Dim tmp, Tach, gio As String, phut As String
    gio = "gi" & ChrW$(7901): phut = "ph" & ChrW$(250) & "t "
    If Ma <> Empty Then
        tmp = Split(Ma, "-")
        Tach = Split(tmp(N - 1), "h")
        TachgioBB = Tach(0) & " " & gio & " " & Tach(1) & " " & phut
    End If
    If Ma = Empty Then TachgioBB = "......" & " " & gio & " " & "......" & " " & phut
End Function
Function Tachchuoi1(Ma As String, N As Long) As String
    On Error Resume Next
    gio = "gi" & ChrW$(7901): phut = "ph" & ChrW$(250) & "t "
    Dim tmp, Tach, gio As String, phut As String
    tmp = Split(Ma, "-")
    Tach = Split(tmp(N - 1), "h")
    Tachchuoi1 = Tach(0) & " " & gio & " " & Tach(1) & " " & phut
End Function
Function TachLytrinh(Chuoi As String) As String
    Dim I As Long, J As Long, tmp, Tmp1, Chuoitach As String
    On Error Resume Next
    tmp = Split(Chuoi, ";")
    For I = 0 To UBound(tmp)
        If InStrRev(tmp(I), "(") Then
            Tmp1 = Split(tmp(I), "(")
            Chuoitach = Tmp1(0)
            If TachLytrinh <> "" Then
                TachLytrinh = TachLytrinh & ";" & Chuoitach
            Else
                TachLytrinh = Chuoitach
            End If
        End If
    Next I
End Function
Function Doingay(ByVal sDate As Date) As String
    Dim Ngay As String, thang As String, nam As String
    On Error Resume Next
    Ngay = " ng" & ChrW$(224) & "y ": thang = " th" & ChrW$(225) & "ng ": nam = " n" & ChrW$(259) & "m "
    If sDate = Empty Then Doingay = Ngay & "....." & thang & "....." & nam & "....."
    If sDate <> Empty Then Doingay = Ngay & Day(sDate) & thang & Month(sDate) & nam & Year(sDate)
End Function
Function KLBtong(Ma As String, Kt As String) As Double
    Dim tmp, Tmp1, I As Long
    On Error Resume Next
    tmp = Split(Ma, Kt)
    Tmp1 = Split(tmp(1), " ")
    For I = 0 To UBound(Tmp1)
        If IsNumeric(Tmp1(I)) Then
            KLBtong = Tmp1(I)
            Exit For
        End If
    Next I
End Function
Function CotlieuBtong(txt As String) As String
    Dim tmp, aTmp, I As Long, Idx As Long, eTxt As String, Str As String
    aTmp = Array("0,5x1", "1x2", "2x4", "4x6")
    'On Error Resume Next
    txt = LCase(txt)
    tmp = Split(txt, " ")
    For I = 0 To UBound(tmp)
        eTxt = Replace(tmp(I), "*", "x")
        For Idx = LBound(aTmp) To UBound(aTmp)
            If Len(Replace(eTxt, aTmp(Idx), "")) < Len(eTxt) Then Str = aTmp(Idx) & "cm"
            If Len(Str) Then GoTo Ketthuc
        Next Idx
        If Len(Str) Then Exit For
    Next I
Ketthuc:
    If Len(Str) Then CotlieuBtong = Str
End Function
Function KhuonBtong(MacTK As String, Cotlieu As String) As String
    Dim tmp, aTmp, I As Long, Idx As Long, eTxt As String, Str As String
    aTmp = Array("0,5x1", "1x2", "2x4", "4x6")
    If Cotlieu = "" Then
        Str = "7.07x7.07x7.07"
    Else
        If Cotlieu = "4x6cm" Then
            Str = "20x20x20"
        Else
            Select Case CLng(MacTK)
                Case Is < 100
                    Str = "15x30"
                Case Else
                    Str = "15x15x15"
            End Select
        End If
    End If
    If Len(Str) Then KhuonBtong = Str
End Function
Attribute VB_Name = "Fun_Filter2DArray"
Option Explicit
'http://www.giaiphapexcel.com/forum/showthread.php?53566-Th%E1%BA%AFc-m%E1%BA%AFc-g%C3%B3p-%C3%BD-ho%C3%A0n-thi%E1%BB%87n-v%E1%BB%81-h%C3%A0m-UDF-Filter2DArray/page4
Function Filter2DArray(ByVal sArray, ByVal ColIndex As Long, ByVal FindStr As String, ByVal HasTitle As Boolean)
    Dim TmpArr, I As Long, J As Long, Arr, dic, TmpStr, tmp, Chk As Boolean, TmpVal As Double
    On Error Resume Next
    Set dic = CreateObject("Scripting.Dictionary")
    TmpArr = sArray
    ColIndex = ColIndex + LBound(TmpArr, 2) - 1
    Chk = (InStr("><=", Left(FindStr, 1)) > 0)
    For I = LBound(TmpArr, 1) - HasTitle To UBound(TmpArr, 1)
        If Chk And FindStr <> "" Then
            TmpVal = CDbl(TmpArr(I, ColIndex))
            If Evaluate(TmpVal & FindStr) Then dic.Add I, ""
        Else
            If Left(FindStr, 1) = "!" Then
                If Not (UCase(TmpArr(I, ColIndex)) Like UCase(Mid(FindStr, 2, Len(FindStr)))) Then dic.Add I, ""
            Else
                If UCase(TmpArr(I, ColIndex)) Like UCase(FindStr) Then dic.Add I, ""
            End If
        End If
    Next
    If dic.Count > 0 Then
        tmp = dic.Keys
        ReDim Arr(LBound(TmpArr, 1) To UBound(tmp) + LBound(TmpArr, 1) - HasTitle, LBound(TmpArr, 2) To UBound(TmpArr, 2))
        For I = LBound(TmpArr, 1) - HasTitle To UBound(tmp) + LBound(TmpArr, 1) - HasTitle
            For J = LBound(TmpArr, 2) To UBound(TmpArr, 2)
                Arr(I, J) = TmpArr(tmp(I - LBound(TmpArr, 1) + HasTitle), J)
            Next
        Next
        If HasTitle Then
            For J = LBound(TmpArr, 2) To UBound(TmpArr, 2)
                Arr(LBound(TmpArr, 1), J) = TmpArr(LBound(TmpArr, 1), J)
            Next
        End If
    End If
    Filter2DArray = Arr
End Function
Attribute VB_Name = "Fun_My"

Function MaUNICODE(ByVal ch As String) As String
    Dim Ma1, Ma2, Uni1, Uni2
    Dim kq, Kt, kt1, I, J
Ma1 = "225;224;7843;227;7841;259;7855;7857;7859;7861;7863 ;226;7845;7847;7849;7851;7853;233;232;7867;7869;78 65;234;7871;7873;7875;7877;7879;237;236;7881;297;7 883;243;242;7887;245;7885;244;7889;7891;7893;7895; 7897;417;7899;7901;7903;7905;7907;250;249;7911;361 ;7909;432;7913;7915;7917;7919;7921;253;7923;7927;7 929;7925;273;193;192;7842;195;7840;258;7854;7856;7 858;7860;7862;194;7844;7846;7848;7850;7852;201;200 ;7866;7868;7864;202;7870;7872;7874;7876;7878;205;2 04;7880;296;7882;211;210;7886;213;7884;212;7888;78 90;7892;7894;7896;416;7898;7900;7902;7904;7906;218 ;217;7910;360;7908;431;7912;7914;7916;7918;7920;22 1;7922;7926;7928;7924;272"
Ma2 = "ChrW$(225);ChrW$(224);ChrW$(7843);ChrW$(227);ChrW$ (7841);ChrW$(259);ChrW$(7855);ChrW$(7857);ChrW$(78 59);ChrW$(7861);"
Ma2 = Ma2 & "ChrW$(7863);ChrW$(226);ChrW$(7845);ChrW$(7847);Chr W$(7849);ChrW$(7851);ChrW$(7853);ChrW$(233);ChrW$( 232);ChrW$(7867);ChrW$(7869);ChrW$(7865);ChrW$(234 );ChrW$(7871);ChrW$(7873);ChrW$(7875);ChrW$(7877); ChrW$(7879);ChrW$(237);ChrW$(236);ChrW$(7881);ChrW $(297);ChrW$(7883);ChrW$(243);ChrW$(242);ChrW$(788 7);ChrW$(245);ChrW$(7885);ChrW$(244);ChrW$(7889);C hrW$(7891);ChrW$(7893);ChrW$(7895);ChrW$(7897);Chr W$(417);ChrW$(7899);ChrW$(7901);ChrW$(7903);ChrW$( 7905);ChrW$(7907);ChrW$(250);ChrW$(249);ChrW$(7911 );ChrW$(361);ChrW$(7909);ChrW$(432);ChrW$(7913);Ch rW$(7915);ChrW$(7917);ChrW$(7919);ChrW$(7921);ChrW $(253);ChrW$(7923);ChrW$(7927);"
Ma2 = Ma2 & "ChrW$(7929);ChrW$(7925);ChrW$(273);ChrW$(193);ChrW $(192);ChrW$(7842);ChrW$(195);ChrW$(7840);ChrW$(25 8);ChrW$(7854);ChrW$(7856);ChrW$(7858);ChrW$(7860) ;ChrW$(7862);ChrW$(194);ChrW$(7844);ChrW$(7846);Ch rW$(7848);ChrW$(7850);ChrW$(7852);ChrW$(201);ChrW$ (200);ChrW$(7866);ChrW$(7868);ChrW$(7864);ChrW$(20 2);ChrW$(7870);ChrW$(7872);ChrW$(7874);ChrW$(7876) ;ChrW$(7878);ChrW$(205);ChrW$(204);ChrW$(7880);Chr W$(296);ChrW$(7882);ChrW$(211);ChrW$(210);ChrW$(78 86);ChrW$(213);ChrW$(7884);ChrW$(212);ChrW$(7888); ChrW$(7890);ChrW$(7892);ChrW$(7894);ChrW$(7896);Ch rW$(416);ChrW$(7898);ChrW$(7900);ChrW$(7902);ChrW$ (7904);ChrW$(7906);ChrW$(218);"
Ma2 = Ma2 & "ChrW$(217);ChrW$(7910);ChrW$(360);ChrW$(7908);ChrW $(431);ChrW$(7912);ChrW$(7914);ChrW$(7916);ChrW$(7 918);ChrW$(7920);ChrW$(221);ChrW$(7922);ChrW$(7926 );ChrW$(7928);ChrW$(7924);ChrW$(272)"
Uni1 = Split(Ma1, ";")
Uni2 = Split(Ma2, ";")
ch = Replace(ch, " ", " ")
For I = 1 To Len(ch)
    Kt = Mid(ch, I, 1)
    For J = 0 To UBound(Uni1)
        If AscW(Kt) = Uni1(J) Then
            Kt = Chr(34) & "&" & Uni2(J) & "&" & Chr(34)
            Exit For
        End If
    Next
    kq = kq & Kt
Next
If Left(kq, 6) <> "ChrW$(" Then kq = Chr(34) & kq
kq = Replace(kq, "&&", "&")
kq = Replace(kq, "&" & Chr(34) & Chr(34) & "&", "&")
If Right(kq, 2) <> "&" & Chr(34) Then kq = kq & Chr(34)
If Right(kq, 2) = "&" & Chr(34) Then kq = Left(kq, Len(kq) - 2)
MaUNICODE = kq
End Function
'--------------------------------------------------------------------------------
' Procedure : CoverStringtoArray
' Author    : Administrator
' Date      : 14/11/2018
' Purpose   :
'--------------------------------------------------------------------------------
Function CoverStringtoArray(ByVal Delimiter As String, ByVal txt As String, ByVal CriteriaArray)
    Dim aTmp, sArr(), dArr()
    Dim dic As Object, R As Long
    Dim I As Long, k As Long
    Set dic = CreateObject("Scripting.Dictionary")
    If Len(txt) Then
        aTmp = Split(txt, Delimiter)
        sArr = CriteriaArray.Value
        For I = 1 To UBound(sArr)
            dic.Item(sArr(I, 1)) = I
        Next I
        ReDim dArr(1 To UBound(aTmp) + 1, 1 To 2)
        For I = 0 To UBound(aTmp)
            R = dic.Item(Trim(aTmp(I)))
            If R Then
                k = k + 1
                dArr(k, 1) = sArr(R, 1): dArr(k, 2) = sArr(R, 2)
            End If
        Next I
        If k Then CoverStringtoArray = dArr
    End If
End Function
'--------------------------------------------------------------------------------
' Procedure : ArraytoArray
' Author    : Administrator
' Date      : 14/11/2018
' Purpose   :
'--------------------------------------------------------------------------------
Function ArraytoArray(ByVal CriteriaArray As Variant)
    Dim dArr(), N As Long
    Dim I As Long, J As Long, k As Long
    For I = 1 To UBound(CriteriaArray)
        If CriteriaArray(I, 1) <> Empty Then N = N + 1
    Next I
    ReDim dArr(1 To N, 1 To UBound(CriteriaArray, 2))
    For I = 1 To UBound(CriteriaArray)
        If CriteriaArray(I, 1) <> Empty Then
            k = k + 1
            For J = 1 To UBound(CriteriaArray, 2)
                dArr(k, J) = CriteriaArray(I, J)
            Next J
        End If
    Next I
    If k Then ArraytoArray = dArr
End Function
Attribute VB_Name = "HoNgDuc"
Option Explicit
Public Lday, Lmonth As Byte, Lyear As Integer, isLeap, LunarInfo
    'Ho ngoc Duc, truongphu ch|fffd| th|fffd|ch
Sub lunar(d, m, Y)
    Dim DiffADate, Counter, I, Temp, Leap
    ' t|fffd|nh s|fffd| ng|fffd|y t|fffd| m|fffd|c 1/31/1900   'ghi ch|fffd|: d se |fffd|uoc xem nhu month
    DiffADate = DateDiff("d", #1/31/1900#, CDate(m & "-" & d & "-" & Y))
    Counter = -1 'ng|fffd|y 31/1/1900 c|fffd| DateDiff = 0 tuong |fffd|ng |fffd|L l|fffd| ng|fffd|y 1
    'n|fffd|n counter = -1 v|fffd| ng|fffd|y |fffd|L = DateDiff - counter
    Lyear = 1900  'nam bat |fffd||fffd|u t|fffd|nh, Lyear l|fffd| nam |fffd|L tuong |fffd|uong DL
    For I = Lyear To 2199 ' |fffd||fffd|m trong 300 nam k|fffd| ti|fffd|p
        Temp = YearDays(I) 'goi Function YearDays nam |fffd|ang |fffd||fffd|m = s|fffd| ng|fffd|y/nam
        Counter = Counter + Temp 'cong s|fffd| ng|fffd|y d|fffd|n
        If Counter >= DiffADate Then                  'n|fffd|u s|fffd| ng|fffd|y d|fffd|n >= DiffADate
            Counter = Counter - Temp ' tru` s|fffd| ng|fffd|y d|fffd|n 1 nam |fffd|ang t|fffd|nh
            Exit For  'v|fffd| tho|fffd|t v|fffd|ng lap, = |fffd||fffd| c|fffd| gi|fffd| tri Lyear
        End If
        Lyear = Lyear + 1 'nam |fffd|ang |fffd||fffd|m th|fffd|m 1 don vi
    Next
    'so' di phai t|fffd|nh nhu th|fffd| |fffd||fffd| t|fffd|m ch|fffd|nh x|fffd|c nhung ng|fffd|y cu|fffd|i nam |fffd|L m|fffd| |fffd||fffd| sang nam mo'i DL
    'trong truong hop n|fffd|y, xem nhu v|fffd|n nam cu
    Leap = LeapMonth(Lyear) ' goi h|fffd|m LeapMonth, th|fffd|ng nhu|fffd|n l|fffd| th|fffd|ng m|fffd|y?
    isLeap = "" ' set gi|fffd| tri x|fffd|c |fffd|inh cua th|fffd|ng nhu|fffd|n = ""
    Lmonth = 1
    For I = 1 To 12
        If Leap > 0 And I = Leap + 1 And isLeap = "" Then
            isLeap = "(N)" 'n|fffd|u th|fffd|ng nhu|fffd|n c|fffd| v|fffd| I lo'n hon 1 th|fffd| Nhu|fffd|n
            Lmonth = Lmonth - 1 'th|fffd|ng l|fffd|i 1
            I = I - 1 '|fffd||fffd|m l|fffd|i 1
            Temp = LeapDay(Lyear) ' goi h|fffd|m leapday, t|fffd|nh s|fffd| ng|fffd|y nhu|fffd|n
        Else
            Temp = MonthDays(Lyear, I) 'goi h|fffd|m monthdays t|fffd|nh s|fffd| ng|fffd|y thuong
        End If
        If isLeap = "(N)" And I <> Leap Then isLeap = ""
        ' N|fffd|u x|fffd|c dinh Nhu|fffd|n v|fffd| I kh|fffd|c th|fffd|ng nhu|fffd|n th|fffd| X|fffd|c |fffd|inh kh|fffd|ng phai Nhuan
        Counter = Counter + Temp ' cong d|fffd|n ng|fffd|y t|fffd| vi tr|fffd| Exit For khi x|fffd|c |fffd|inh Lyear
        If Counter >= DiffADate Then  'n|fffd|u s|fffd| ng|fffd|y d|fffd|n >= DiffADate
            Counter = Counter - Temp ' tru` s|fffd| ng|fffd|y d|fffd|n 1 th|fffd|ng |fffd|ang t|fffd|nh
            Exit For   'v|fffd| tho|fffd|t v|fffd|ng lap, = |fffd||fffd| c|fffd| gi|fffd| tri Lmonth
        End If
        Lmonth = Lmonth + 1 'th|fffd|ng |fffd|ang |fffd||fffd|m th|fffd|m 1 don vi
    Next
    Lday = DiffADate - Counter 'Ng|fffd|y |fffd|uoc x|fffd|c |fffd|inh
End Sub
Function LeapMonth(Y) ''''''''''''
    If Y >= 1900 Then LeapMonth = LunarInfo(Y - 1900) And &HF Else LeapMonth = 0
    'Th|fffd|ng nhu|fffd|n = LunarInfo(nam |fffd|ang chuy|fffd|n) And &HF = ( tu 0 - 12) ngo|fffd|i ra th|fffd| = 0
End Function
Function LeapDay(Y) ''''''''''
    If LunarInfo(Y - 1900) And &HF Then  'n|fffd|u c|fffd| th|fffd|ng nhu|fffd|n th|fffd|
        If LunarInfo(Y - 1900) And &H10000 Then LeapDay = 30 Else LeapDay = 29
        ' N|fffd|u LunarInfo(nam |fffd|ang chuy|fffd|n) And &H10000 > 0 th|fffd| 30 kh|fffd|ng th|fffd| 29 ng|fffd|y
    Else
        LeapDay = 0
    End If
End Function
Function MonthDays(Y, m) '''''''''''''''
    Dim MonthMask
    MonthMask = Array(32768, 16384, 8192, 4096, 2048, 1024, 512, 256, 128, 64, 32, 16)
    ' Mang loc th|fffd|ng(1-12) = MonthMask(0-11)
    ' N|fffd|u LunarInfo(nam |fffd|ang chuy|fffd|n) And Mang loc th|fffd|ng(th|fffd|ng |fffd|ang chuy|fffd|n) > 0 th|fffd| 30 ngo|fffd|i ra th|fffd| 29
    If LunarInfo(Y - 1900) And MonthMask(m - 1) Then MonthDays = 30 Else MonthDays = 29
End Function
Function YearDays(Y) '''''''''''''
    Dim I, MonthMask
    MonthMask = Array(32768, 16384, 8192, 4096, 2048, 1024, 512, 256, 128, 64, 32, 16)
    YearDays = 348  '12 th|fffd|ng x 29 ng|fffd|y
    For I = 0 To 11 'th|fffd|ng n|fffd|o c|fffd| 30 ng|fffd|y th|fffd| th|fffd|m 1
        If LunarInfo(Y - 1900) And MonthMask(I) Then YearDays = YearDays + 1
    Next
    YearDays = YearDays + LeapDay(Y) ' cong th|fffd|m s|fffd| ng|fffd|y nhu|fffd|n n|fffd|u c|fffd|
End Function
'Ham so chuyen doi tu Duong lich sang Am lich dang ngay,thang,nam
Public Function TransLu(d, m, Y)
    Call Goi
    ' cau tr|fffd|c cua h|fffd|m lunar l|fffd| (d, m, y), VB6 d|fffd|ng (m, d, y) n|fffd|n function TransLu
    ' se doi vi tri c|fffd|u tr|fffd|c khi goi h|fffd|m lunar
    Call lunar(m, d, Y)
    TransLu = Lday & "/" & Lmonth & isLeap & "/" & Lyear
End Function
'Ham so chuyen doi tu Duong lich sang Am lich dang tu mot o
Public Function TransLu1(NT As Date) ' NT = ng|fffd|y th|fffd|ng
    Call lunar(Day(NT), Month(NT), Year(NT)) 'goi h|fffd|m Lunar theo c|fffd|u tr|fffd|c n|fffd|y ?
    ' |fffd||fffd| nghi nhu' h|fffd|m TransLu l|fffd|m: Call lunar(Month(NT), Day(NT), Year(NT))
    'TransLu1 = Lday & "-" & Lmonth & isLeap & "-" & CanchiV(Lyear - 0)
    'H|fffd|m CanchiV bi thi|fffd|u!
End Function
Public Function TransSolar(d, m, Y) As Date 'Ngay thang nam am lich sang duong lich
    Dim iSd As Date
    iSd = DateSerial(Y, m, d) - 70
    Do
        iSd = iSd + 1
    Loop Until TransLu(Day(iSd), Month(iSd), Year(iSd)) = d & "/" & m & "/" & Y
    TransSolar = iSd
End Function
'Cach su dung:
Private Sub Command1_Click()
    If Days = "" Or Months = "" Or Years = "" Then Exit Sub
    NgayAL = TransLu(Days, Months, Years)
End Sub
Private Sub Command2_Click()
    If Years = "" Then Exit Sub
    ThangNhuan = LeapMonth(Years)
End Sub
Private Sub Command3_Click()
    If Years = "" Then Exit Sub
    SoNgayNhuan = LeapDay(Years)
End Sub
Private Sub Command4_Click()
    If Years = "" Or Months = "" Then Exit Sub
    SoNgayThangT = MonthDays(Years, Months)
End Sub
Private Sub Command5_Click()
    If Years = "" Then Exit Sub
    SoNgayNam = YearDays(Years)
End Sub
Sub Goi()
    'Mang do HoNgocDuc tu x|fffd|y dung, chu'a th|fffd|ng tin nam |fffd|L tu 1900-2199
    'nam |fffd||fffd| th|fffd|ng m|fffd|y nhu|fffd|n? g|fffd|m m|fffd|y ng|fffd|y? M|fffd|i th|fffd|ng c|fffd|n lai c|fffd| m|fffd|y ng|fffd|y? nam |fffd||fffd| c|fffd| m|fffd|y ng|fffd|y?
    LunarInfo = Array( _
            &H3C4BD8, &H624AE0, &H4CA570, &H3854D5, &H5CD260, &H44D950, &H315554, &H5656A0, &H409AD0, &H2A55D2, &H504AE0, &H3AA5B6, &H60A4D0, &H48D250, &H33D255, &H58B540, &H42D6A0, &H2CADA2, &H5295B0, &H3F4977, _
            &H644970, &H4CA4B0, &H36B4B5, &H5C6A50, &H466D40, &H2FAB54, &H562B60, &H409570, &H2C52F2, &H504970, &H3A6566, &H5ED4A0, &H48EA50, &H336A95, &H585AD0, &H442B60, &H2F86E3, &H5292E0, &H3DC8D7, &H62C950, _
            &H4CD4A0, &H35D8A6, &H5AB550, &H4656A0, &H31A5B4, &H5625D0, &H4092D0, &H2AD2B2, &H50A950, &H38B557, &H5E6CA0, &H48B550, &H355355, &H584DA0, &H42A5B0, &H2F4573, &H5452B0, &H3CA9A8, &H60E950, &H4C6AA0, _
            &H36AEA6, &H5AAB50, &H464B60, &H30AAE4, &H56A570, &H405260, &H28F263, &H4ED940, &H38DB47, &H5CD6A0, &H4896D0, &H344DD5, &H5A4AD0, &H42A4D0, &H2CD4B4, &H52B250, &H3CD558, &H60B540, &H4AB5A0, &H3755A6, _
            &H5C95B0, &H4649B0, &H30A974, &H56A4B0, &H40AA50, &H29AA52, &H4E6D20, &H39AD47, &H5EAB60, &H489370, &H344AF5, &H5A4970, &H4464B0, &H2C74A3, &H50EA50, &H3D6A58, &H6256A0, &H4AAAD0, &H3696D5, &H5C92E0, _
            &H46C960, &H2ED954, &H54D4A0, &H3EDA50, &H2A7552, &H4E56A0, &H38A7A7, &H5EA5D0, &H4A92B0, &H32AAB5, &H58A950, &H42B4A0, &H2CBAA4, &H50AD50, &H3C55D9, &H624BA0, &H4CA5B0, &H375176, &H5C5270, &H466930, _
            &H307934, &H546AA0, &H3EAD50, &H2A5B52, &H504B60, &H38A6E6, &H5EA4E0, &H48D260, &H32EA65, &H56D520, &H40DAA0, &H2D56A3, &H5256D0, &H3C4AFB, &H6249D0, &H4CA4D0, &H37D0B6, &H5AB250, &H44B520, &H2EDD25, _
            &H54B5A0, &H3E55D0, &H2A55B2, &H5049B0, &H3AA577, &H5EA4B0, &H48AA50, &H33B255, &H586D20, &H40AD60, &H2D4B63, &H525370, &H3E49E8, &H60C970, &H4C54B0, &H3768A6, &H5ADA50, &H445AA0, &H2FA6A4, &H54AAD0, _
            &H4052E0, &H28D2E3, &H4EC950, &H38D557, &H5ED4A0, &H46D950, &H325D55, &H5856A0, &H42A6D0, &H2C55D4, &H5252B0, &H3CA9B8, &H62A930, &H4AB490, &H34B6A6, &H5AAD50, &H4655A0, &H2EAB64, &H54A570, &H4052B0, _
            &H2AB173, &H4E6930, &H386B37, &H5E6AA0, &H48AD50, &H332AD5, &H582B60, &H42A570, &H2E52E4, &H50D160, &H3AE958, &H60D520, &H4ADA90, &H355AA6, &H5A56D0, &H462AE0, &H30A9D4, &H54A2D0, &H3ED150, &H28E952, _
            &H4EB520, &H38D727, &H5EADA0, &H4A55B0, &H362DB5, &H5A45B0, &H44A2B0, &H2EB2B4, &H54A950, &H3CB559, &H626B20, &H4CAD50, &H385766, &H5C5370, &H484570, &H326574, &H5852B0, &H406950, &H2A7953, &H505AA0, _
            &H3BAAA7, &H5EA6D0, &H4A4AE0, &H35A2E5, &H5AA550, &H42D2A0, &H2DE2A4, &H52D550, &H3E5ABB, &H6256A0, &H4C96D0, &H3949B6, &H5E4AB0, &H46A8D0, &H30D4B5, &H56B290, &H40B550, &H2A6D52, &H504DA0, &H3B9567, _
            &H609570, &H4A49B0, &H34A975, &H5A64B0, &H446A90, &H2CBA94, &H526B50, &H3E2B60, &H28AB61, &H4C9570, &H384AE6, &H5CD160, &H46E4A0, &H2EED25, &H54DA90, &H405B50, &H2C36D3, &H502AE0, &H3A93D7, &H6092D0, _
            &H4AC950, &H32D556, &H58B4A0, &H42B690, &H2E5D94, &H5255B0, &H3E25FA, &H6425B0, &H4E92B0, &H36AAB6, &H5C6950, &H4674A0, &H31B2A5, &H54AD50, &H4055A0, &H2AAB73, &H522570, &H3A5377, &H6052B0, &H4A6950, _
            &H346D56, &H585AA0, &H42AB50, &H2E56D4, &H544AE0, &H3CA570, &H2864D2, &H4CD260, &H36EAA6, &H5AD550, &H465AA0, &H30ADA5, &H5695D0, &H404AD0, &H2AA9B3, &H50A4D0, &H3AD2B7, &H5EB250, &H48B540, &H33D556) '' /* Years 2100-2199 */
End Sub

Attribute VB_Name = "Module1"
Sub Macro1()
Attribute Macro1.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Macro1 Macro
'

'
    Range("J80").Select
    ActiveCell.FormulaR1C1 = "=RC[-1]"
    Range("K80").Select
    ActiveCell.FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-1]+1,"""")"
    Range("N80").Select
    ActiveCell.FormulaR1C1 = _
        "=IF(RC[-11]<>"""",COUNTIF(R7C3:RC[-11],RC[-11]),"""")"
    Range("O80").Select
    ActiveCell.FormulaR1C1 = "=IF(RC[-6]<>"""",COUNTIF(R7C[-6]:RC9,RC[-5]),"""")"
    Range("P80").Select
    ActiveCell.FormulaR1C1 = "=IF(RC[-5]<>"""",COUNTIF(R7C11:RC[-5],RC[-5]),"""")"
    Range("P81").Select
End Sub
Sub Macro2()
Attribute Macro2.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Macro2 Macro
'

'
    Range("J90").Select
    ActiveCell.FormulaR1C1 = "=IF(RC[-1]<>"""",RC[-1],"""")"
    Range("J91").Select
End Sub
Sub Macro3()
Attribute Macro3.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Macro3 Macro
'

'
    Range("O4").Select
    ActiveCell.FormulaR1C1 = _
        "=RANK(RC[-5],R4C10:R1500C10,1)+COUNTIF(R4C10:RC[-5],RC[-5])-1"
    Range("O5").Select
End Sub
Attribute VB_Name = "Module2"
Sub Spinner1_Change()
    On Error Resume Next
FixRow Range("J18")
FixRow Range("J19")
AndongBB Range("A1"), Range("A19")
End Sub
Attribute VB_Name = "MsgUnicode"
'****************************************
'Tac gia: Nguyen Duy Tuan
'Tel    : 0904.210.337
'E.Mail : tuanktcdcn@yahoo.com
'Website: www.bluesofts.net
'Bai 7 - http://www.giaiphapexcel.com/forum/showthread.php?9380-S%C6%B0%CC%89-du%CC%A3ng-ti%C3%AA%CC%81ng-vi%C3%AA%CC%A3t-co%CC%81-d%C3%A2%CC%81u-trong-VBA
'****************************************
'Khai bao cac ham API trong thu vien User32.DLL
#If VBA7 And Win64 Then 'Office 64-bit
Private Declare PtrSafe Function GetActiveWindow Lib "user32" () As Long
Private Declare PtrSafe Function MessageBoxW Lib "user32" (ByVal hwnd As LongPtr, ByVal lpText As String, ByVal lpCaption As String, ByVal wType As LongPtr) As Long
#Else ' Office 32-bit
Private Declare Function GetActiveWindow Lib "user32" () As Long
Private Declare Function MessageBoxW Lib "user32" (ByVal hwnd As Long, ByVal lpText As String, ByVal lpCaption As String, ByVal wType As Long) As Long
#End If
Function MsgboxUni(ByVal PromptUni As Variant, Optional ByVal Buttons As VbMsgBoxStyle = vbOKOnly, Optional ByVal TitleUni As Variant = vbNullString) As VbMsgBoxResult
    'Function MsgBoxUni(ByVal PromptUni As Variant, Optional ByVal Buttons As VbMsgBoxStyle = vbOKOnly, Optional ByVal TitleUni As Variant, Optional HelpFile, Optional Context) As VbMsgBoxResult
    'BStrMsg,BStrTitle : La chuoi Unicode
    Dim BStrMsg, BStrTitle
    'H|fffd|m StrConv Chuyen chuoi ve ma Unicode
    BStrMsg = StrConv(PromptUni, vbUnicode)
    BStrTitle = StrConv(TitleUni, vbUnicode)
    MsgboxUni = MessageBoxW(GetActiveWindow, BStrMsg, BStrTitle, Buttons)
End Function
'Neu muon thay the ham MsgBox cua VB, hay dung ham duoi day
'Function MsgBox(ByVal PromptUni As Variant, Optional ByVal Buttons As VbMsgBoxStyle = vbOKOnly, Optional ByVal TitleUni As Variant = vbNullString) As VbMsgBoxResult
'    Dim BStrMsg, BStrTitle
'    BStrMsg = StrConv(PromptUni, vbUnicode)
'    BStrTitle = StrConv(TitleUni, vbUnicode)
'
'    MsgBox = MessageBoxW(GetActiveWindow, BStrMsg, BStrTitle, Buttons)
'End Function
Sub Test()
    'Test trong Excel
    MsgboxUni Range("B3").Value, vbInformation, Range("B4").Value
    MsgBox Range("B3").Value, vbInformation, Range("B4").Value
End Sub
Sub Test2()
    'UNC la ham chuyen tu ma TCVN3 sang Unicode
    MsgboxUni UNC("C|fffd|ng ho|fffd| x|fffd| h|fffd|i ch|fffd| ngh|fffd|a Vi|fffd|t Nam")
End Sub
Sub Test3()
    'VNI la ham chuyen tu ma VNI sang Unicode
    MsgboxUni VNI("Co|fffd|ng hoa|fffd| xa|fffd| ho|fffd|i chu|fffd| ngh|fffd|a Vie|fffd|t Nam")
End Sub
Attribute VB_Name = "NKGS_BANGHI"
Sub XuatnhatkyGS()
    Dim dongcuoi As Long, Ngaydau As Date, Ngaycuoi As Date, Ngay As Date
    Dim sArr, dArr, I As Long, Stt As Long, fdayC As Long
fdayC = Sheets("InNKGS").Range("I1").Value
With Sheets("GhiNhatky")
    dongcuoi = .Range("B" & Rows.Count).End(xlUp).row
    If dongcuoi > 1 Then
        Ngaydau = Application.Min(.Range("A2:A" & dongcuoi))
        Ngaycuoi = Application.Max(.Range("A2:A" & dongcuoi))
        For I = Ngaydau To Ngaycuoi
            Stt = Stt + 1
            Sheets("InNKGS").Range("B" & fdayC).Value = I
            LaydulieuGS Sheets("InNKGS").Range("B" & fdayC).Value
            ActiveSheet.ExportAsFixedFormat 0, ThisWorkbook.Path & "\" & "NKGSTC" & "." & Stt
        Next I
    End If
End With
End Sub
Sub LaydulieuGS(ByVal Ngay As Date)
    Dim sArr, dArr(1 To 5000, 1 To 1), I As Long, k As Long, Ngaythicong As Date
    Dim dongcuoi As Long, fr As Long, fdayC As Long, fttiet As Long, fthietbi As Long, Er As Long, N As Long
    Dim Thoitiet As String, CBKT As String, CNKT As String, Thietbi As String
    Dim NTNB As String, Str1 As String
    NTNB = "   - Nghi" & ChrW$(7879) & "m thu n" & ChrW$(7897) & "i b" & ChrW$(7897) & " "
    Application.ScreenUpdating = False
    fr = Sheets("InNKGS").Range("G1").Value:  Er = Sheets("InNKGS").Range("H1").Value
    fdayC = Sheets("InNKGS").Range("I1").Value: fttiet = Sheets("InNKGS").Range("J1").Value
    fthietbi = Sheets("InNKGS").Range("K1").Value
    With Sheets("GhiNhatky")
        dongcuoi = .Range("B" & Rows.Count).End(xlUp).row
        If dongcuoi > 1 Then
            sArr = .Range("A6:A" & dongcuoi).Resize(, 6).Value
            For I = 1 To UBound(sArr)
                If sArr(I, 1) <> Empty Then Ngaythicong = sArr(I, 1)
                If Ngaythicong > Ngay Then Exit For
                If Ngay = Ngaythicong Then
                    N = N + 1
                    If N = 1 Then
                        Sheets("InNKGS").Range("B" & fdayC) = Ngaythicong
                        With Sheets("InNKGS").Range("A" & fttiet)
                            .Value = "1. " & sArr(I, 2)
                            .Characters(Start:=13, Length:=Len(sArr(I, 2))).Font.Bold = False
                            .Characters(Start:=13, Length:=Len(sArr(I, 2))).Font.Italic = True
                            .Characters(Start:=13, Length:=Len(sArr(I, 2))).Font.Color = -65536
                        End With
                        If I < UBound(sArr) Then
                            With Sheets("InNKGS").Range("A" & fthietbi)
                                If Trim(Split(sArr(I + 1, 2), ":")(1)) <> "" Then
                                    .Value = "     - " & Split(sArr(I + 1, 2), ":")(1)
                                    .Font.Color = -65536
                                    .Font.Italic = True
                                    .HorizontalAlignment = xlJustify
                                    .WrapText = True
                                Else
                                    .RowHeight = 16.5
                                    .Value = ""
                                End If
                            End With
                            FixRow Sheets("InNKGS").Range("A" & fthietbi)
                        End If
                    End If
                    If Left(Trim(sArr(I, 2)), 1) = "-" Then
                        Str1 = Replace(sArr(I, 2), NTNB, "")
                        If Len(Str1) = Len(sArr(I, 2)) Then
                            'If Not InStrRev(sArr(I, 2), NTNB) Then
                            k = k + 1
                            dArr(k, 1) = sArr(I, 2)
                        End If
                    End If
                End If
            Next I
        End If
    End With
    With Sheets("InNKGS")
        .Range("A" & fr + 1 & ":A" & Er - 1).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = False
        .Range("A" & fr + 1 & ":B" & Er - 1).ClearContents
        .Range("A" & fr + 1 & ":B" & Er - 1).Font.Bold = False
        .Range("A" & fr + 1 & ":B" & Er - 1).Font.ColorIndex = xlAutomatic
        .Range("A" & fr + 1 & ":B" & Er - 1).Font.Italic = False
        If k Then
            If k > Er - fr Then
                MsgBox "Du lieu qua nhieu. Chen them dong noi dung cong viec"
                Exit Sub
            End If
            Er = .Range("H1").Value
            .Range("A" & fr + 1 & ":B" & Er - 1).WrapText = True
            .Range("A" & fr + 1 & ":B" & Er - 1).HorizontalAlignment = xlJustify
            .Range("A" & fr + 1).Resize(k, 1) = dArr
            .Range("A" & fr + 1).Resize(k, 1).Font.Italic = True
            .Range("A" & fr + 1).Resize(k, 1).Font.Color = -65536
            For I = fr + 1 To Er - 1
                If Range("C" & I) <> Empty Then FixRow Range("A" & I) Else Exit For
            Next I
            .Range("A" & fr + 1 & ":A" & Er - 1).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
            Application.ScreenUpdating = True
        Else
            Er = .Range("H1").Value
            .Range("A" & fr + 1) = "- C" & ChrW$(244) & "ng tr" & ChrW$(236) & "nh ngh" & ChrW$(7881) & " thi c" & ChrW$(244) & "ng"
            .Range("A" & fr + 1 & ":A" & Er - 1).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
        End If
    End With
End Sub
Sub ChaythuNKGS()
    LaydulieuGS Sheets("InNKGS").Range("E1").Value
End Sub
Attribute VB_Name = "NKTC_Banghi"
Sub Xuatnhatky()
    Dim dongcuoi As Long, Ngaydau As Date, Ngaycuoi As Date, Ngay As Date
    Dim sArr, dArr, I As Long, Stt As Long, fdayC As Long
fdayC = Sheets("InNKTC").Range("I1").Value
With Sheets("GhiNhatky")
    dongcuoi = .Range("B" & Rows.Count).End(xlUp).row
    If dongcuoi > 1 Then
        Ngaydau = Application.Min(.Range("A2:A" & dongcuoi))
        Ngaycuoi = Application.Max(.Range("A2:A" & dongcuoi))
        For I = Ngaydau To Ngaycuoi
            Stt = Stt + 1
            Sheets("InNKTC").Range("B" & fdayC).Value = I
            Laydulieu Sheets("InNKTC").Range("B" & fdayC).Value
            ActiveSheet.ExportAsFixedFormat 0, ThisWorkbook.Path & "\" & "NKTC" & "." & Stt
        Next I
    End If
End With
End Sub
Sub Laydulieu(ByVal Ngay As Date)
    Dim sArr, dArr(1 To 5000, 1 To 1), I As Long, k As Long, Ngaythicong As Date
    Dim dongcuoi As Long, fr As Long, fdayC As Long, fttiet As Long, fthietbi As Long, Er As Long, N As Long
    Dim Thoitiet As String, CBKT As String, CNKT As String, Thietbi As String
    Application.ScreenUpdating = False
    fr = Sheets("InNKTC").Range("G1").Value:  Er = Sheets("InNKTC").Range("H1").Value
    fdayC = Sheets("InNKTC").Range("I1").Value: fttiet = Sheets("InNKTC").Range("J1").Value
    fthietbi = Sheets("InNKTC").Range("K1").Value
    With Sheets("GhiNhatky")
        dongcuoi = .Range("B" & Rows.Count).End(xlUp).row
        If dongcuoi > 1 Then
            sArr = .Range("A6:A" & dongcuoi).Resize(, 6).Value
            For I = 1 To UBound(sArr)
                If sArr(I, 1) <> Empty Then Ngaythicong = sArr(I, 1)
                If Ngaythicong > Ngay Then Exit For
                If Ngay = Ngaythicong Then
                    N = N + 1
                    If N = 1 Then
                        Sheets("InNKTC").Range("B" & fdayC) = Ngaythicong
                        With Sheets("InNKTC").Range("A" & fttiet)
                            .Value = "1. " & sArr(I, 2)
                            .Characters(Start:=13, Length:=Len(sArr(I, 2))).Font.Bold = False
                            .Characters(Start:=13, Length:=Len(sArr(I, 2))).Font.Italic = True
                            .Characters(Start:=13, Length:=Len(sArr(I, 2))).Font.Color = -65536
                        End With
                        If I < UBound(sArr) Then
                            With Sheets("InNKTC").Range("A" & fthietbi)
                                If Trim(Split(sArr(I + 1, 2), ":")(1)) <> "" Then
                                    .Value = "     - " & Split(sArr(I + 1, 2), ":")(1)
                                    .Font.Color = -65536
                                    .Font.Italic = True
                                    .HorizontalAlignment = xlJustify
                                    .WrapText = True
                                Else
                                    .RowHeight = 16.5
                                    .Value = ""
                                End If
                            End With
                            FixRow Sheets("InNKTC").Range("A" & fthietbi)
                        End If
                    End If
                    If Left(Trim(sArr(I, 2)), 1) = "-" Then
                        k = k + 1
                        dArr(k, 1) = sArr(I, 2)
                    End If
                End If
            Next I
        End If
    End With
    With Sheets("InNKTC")
        .Range("A" & fr + 1 & ":A" & Er - 1).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = False
        .Range("A" & fr + 1 & ":B" & Er - 1).ClearContents
        .Range("A" & fr + 1 & ":B" & Er - 1).Font.Bold = False
        .Range("A" & fr + 1 & ":B" & Er - 1).Font.ColorIndex = xlAutomatic
        .Range("A" & fr + 1 & ":B" & Er - 1).Font.Italic = False
        If k Then
            If k > Er - fr Then
                MsgBox "Du lieu qua nhieu. Chen them dong noi dung cong viec"
                Exit Sub
            End If
            Er = .Range("H1").Value
            .Range("A" & fr + 1 & ":B" & Er - 1).WrapText = True
            .Range("A" & fr + 1 & ":B" & Er - 1).HorizontalAlignment = xlJustify
            .Range("A" & fr + 1).Resize(k, 1) = dArr
            .Range("A" & fr + 1).Resize(k, 1).Font.Italic = True
            .Range("A" & fr + 1).Resize(k, 1).Font.Color = -65536
            For I = fr + 1 To Er - 1
                If Range("C" & I) <> Empty Then FixRow Range("A" & I) Else Exit For
            Next I
            .Range("A" & fr + 1 & ":A" & Er - 1).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
            Application.ScreenUpdating = True
        Else
            Er = .Range("H1").Value
            .Range("A" & fr + 1) = "- C" & ChrW$(244) & "ng tr" & ChrW$(236) & "nh ngh" & ChrW$(7881) & " thi c" & ChrW$(244) & "ng"
            .Range("A" & fr + 1 & ":A" & Er - 1).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
        End If
    End With
End Sub
Sub chaythu()
    Laydulieu Sheets("InNKTC").Range("E1").Value
End Sub
Attribute VB_Name = "Nhatky"
Option Explicit
Sub DMNhatky()
    Dim dic As Object, tArr(), R As Long
    Dim sArr, dArr, tmp, I As Long, k As Long
Set dic = CreateObject("Scripting.Dictionary")
With Sheets("tbTHmay")
    tArr = .Range("A2", .Range("A2").End(xlDown)).Resize(, 6).Value
    For I = 1 To UBound(tArr)
        dic.Item(Trim(tArr(I, 1))) = I
    Next I
End With
With Sheets("Nhattrinh")
    sArr = .Range("C7", .Range("C65000").End(3)).Resize(, 9).Value
End With
ReDim dArr(1 To UBound(sArr), 1 To 8)
For I = 1 To UBound(sArr)
    If sArr(I, 1) <> Empty Then
        k = k + 1
        dArr(k, 1) = k
        dArr(k, 2) = sArr(I, 1)
        dArr(k, 3) = sArr(I, 2) & " " & sArr(I, 3)
        dArr(k, 4) = sArr(I, 4): dArr(k, 5) = sArr(I, 5): dArr(k, 6) = sArr(I, 8): dArr(k, 7) = sArr(I, 9)
        If I > 9 Then
            If sArr(I, 9) = Empty Then
                R = dic.Item(Trim(sArr(I, 1)))
                If R Then dArr(k, 8) = tArr(R, 6)
            End If
        End If
    End If
Next I
With Sheets("DMnhatky")
    If k Then
        With .Range("A4:F" & .Range("A65535").End(3).row + 1)
            .ClearContents
            .Borders.LineStyle = xlNone
        End With
        With .Range("A4").Resize(k, 8)
            .Value = dArr
            .Borders.LineStyle = xlContinuous
            .Borders.ThemeColor = 10
            .Borders(xlInsideHorizontal).LineStyle = xlNone
        End With
    End If
End With
Set dic = Nothing
End Sub
Sub Phantichnhatky()
    Application.ScreenUpdating = False
    Dim sArr(), dArr(1 To 100000, 1 To 4), I As Long, J As Long, k As Long, R As Long, Er As Long
    With Sheets("DMnhatky")
        sArr = .Range("B4", .Range("B65535").End(3)).Resize(, 7).Value
        R = UBound(sArr)
    End With
    For I = 1 To R
        If sArr(I, 3) <> Empty And sArr(I, 4) <> Empty And sArr(I, 6) = Empty Then
            For J = sArr(I, 3) To sArr(I, 4)
                k = k + 1: dArr(k, 1) = sArr(I, 1): dArr(k, 2) = sArr(I, 2)
                dArr(k, 3) = J: dArr(k, 4) = sArr(I, 7)
            Next J
        End If
        If sArr(I, 5) = Empty And sArr(I, 6) <> Empty Then
            k = k + 1
            dArr(k, 1) = sArr(I, 1)
            dArr(k, 2) = sArr(I, 2)
            dArr(k, 3) = sArr(I, 6)
        End If
        If sArr(I, 5) <> Empty Then
            k = k + 1
            dArr(k, 1) = sArr(I, 1)
            dArr(k, 2) = "Nghi" & ChrW$(7879) & "m thu " & "n" & ChrW$(7897) & "i b" & ChrW$(7897) & " " & sArr(I, 2)
            dArr(k, 3) = sArr(I, 5)
        End If
        If sArr(I, 5) <> Empty And sArr(I, 6) <> Empty Then
            k = k + 1
            dArr(k, 1) = sArr(I, 1)
            dArr(k, 2) = "Nghi" & ChrW$(7879) & "m thu " & sArr(I, 2)
            dArr(k, 3) = sArr(I, 6)
        End If
    Next I
    With Sheets("NKchitiet")
        Er = .Range("A65535").End(3).row + 1
        With .Range("A4:F" & Er)
            .ClearContents
            .Font.ColorIndex = 0
            .Borders.LineStyle = xlNone
            .Font.Underline = xlUnderlineStyleNone
        End With
        If k Then
            With .Range("A4").Resize(k, 4)
                .Value = dArr
                .Sort Key1:=.Range("C4")
                .Borders.LineStyle = xlContinuous
                .Borders.ThemeColor = 10
                .Borders(xlInsideHorizontal).Weight = xlHairline
                .Rows.AutoFit
            End With
            For I = k + 1 To 3 Step -1
                'If .Range("A" & i) = .Range("A" & i - 1) Then .Range("A" & i).ClearContents
                If Left(.Range("B" & I), 10) = "Nghi" & ChrW$(7879) & "m thu" Then
                    .Range("B" & I).Font.Color = -65536
                    .Range("B" & I).Characters(Start:=1, Length:=10).Font.Underline = xlUnderlineStyleSingle
                End If
                If Left(.Range("B" & I), 8) = "Ki" & ChrW$(7875) & "m tra" Then
                    .Range("B" & I).Font.Color = -65536
                    .Range("B" & I).Characters(Start:=1, Length:=8).Font.Underline = xlUnderlineStyleSingle
                End If
                If Left(.Range("B" & I), 7) = "L" & ChrW$(7845) & "y m" & ChrW$(7851) & "u" Then
                    .Range("B" & I).Font.Color = -16776961
                End If
                If .Range("A" & I) <> Empty Then
                    With .Range("A" & I & ":B" & I).Borders(xlEdgeTop)
                        .LineStyle = xlContinuous
                        .Weight = xlThin
                    End With
                End If
            Next I
        End If
        .PageSetup.PrintArea = "$A$3:$B$" & k + 1
    End With
    Application.ScreenUpdating = True
End Sub
Sub Ghinhatky()
    Dim sArr, dArr(1 To 65535, 1 To 2), tArr, Item
    Dim I As Long, J As Long, k As Long, X As Long, Er As Long, DK As Boolean, Dk1 As Boolean
    Dim NDCV As String, NDnghi As String, Thoitiet As String, ThoitieiTC As String, ThietbiTC As String, NoidungCV As String, Mua As String, Nang As String
    Dim dic As Object, v As Variant, tmp, MayTC As String, Imaytc As Long
    Dim Dic2 As Object, Tem As String, Baoduong As String, NoidungBD As String
    Set dic = CreateObject("Scripting.Dictionary")
    NDCV = "C" & ChrW$(244) & "ng tr" & ChrW$(236) & "nh ngh" & ChrW$(7881) & " kh" & ChrW$(244) & "ng thi c" & ChrW$(244) & "ng"
    NoidungCV = "N" & ChrW$(7897) & "i c" & ChrW$(244) & "ng vi" & ChrW$(7879) & "c thi c" & ChrW$(244) & "ng trong ng" & ChrW$(224) & "y:"
    Thoitiet = "Th" & ChrW$(7901) & "i ti" & ChrW$(7871) & "t:"
    ThietbiTC = "Thi" & ChrW$(7871) & "t b" & ChrW$(7883) & " thi c" & ChrW$(244) & "ng: "
    Mua = " Tr" & ChrW$(7901) & "i m" & ChrW$(432) & "a"
    Nang = " Tr" & ChrW$(7901) & "i n" & ChrW$(7855) & "ng"
    Baoduong = "B" & ChrW$(7843) & "o d" & ChrW$(432) & ChrW$(7905) & "ng"
    NoidungBD = "   - B" & ChrW$(7843) & "o d" & ChrW$(432) & ChrW$(7905) & "ng b" & ChrW$(234) & " t" & ChrW$(244) & "ng"
    With Sheets("Tb_Thoitiet")
        tArr = .Range("G5", .Range("G65535").End(3)).Resize(, 3).Value
    End With
    With Sheets("NKchitiet")
        sArr = .Range("B4", .Range("B65535").End(3)).Resize(, 3).Value
    End With
    For I = 1 To UBound(sArr)
        dic(sArr(I, 2)) = 1
    Next I
    For Each v In dic.Keys()
        Set Dic2 = CreateObject("Scripting.Dictionary")
        DK = False: Dk1 = True
        For J = 1 To UBound(tArr)
            If v = tArr(J, 1) And tArr(J, 3) <> Empty Then
                DK = True
                ThoitieiTC = tArr(J, 2)
                NDnghi = tArr(J, 3)
                Exit For
            End If
        Next J
        If DK = True Then
            k = k + 1
            dArr(k, 1) = v
            dArr(k, 2) = Thoitiet & ThoitieiTC
            k = k + 1
            dArr(k, 2) = NoidungCV
            k = k + 1
            dArr(k, 2) = "   - " & NDnghi
        Else
            If Dk1 = True Then
                k = k + 1
                dArr(k, 1) = v
                dArr(k, 2) = Thoitiet & Nang
                k = k + 1
                Imaytc = k
                k = k + 1
                dArr(k, 2) = NoidungCV
                Dk1 = False
            End If
            For I = 1 To UBound(sArr)
                If v = sArr(I, 2) Then
                    Tem = "   - " & sArr(I, 1)
                    If InStrRev(sArr(I, 1), Baoduong) Then Tem = NoidungBD
                    If Not Dic2.Exists(Tem) Then
                        k = k + 1
                        Dic2.Add Tem, k
                        dArr(k, 2) = Tem
                        If sArr(I, 3) <> Empty Then
                            For Each Item In Split(sArr(I, 3), ";")
                                If Not InStrRev(MayTC, Item) Then
                                    MayTC = IIf(MayTC <> "", MayTC & ";" & Item, Item)
                                End If
                            Next
                        End If
                    End If
                End If
            Next I
        End If
        k = k + 1
        Set Dic2 = Nothing
        dArr(Imaytc, 2) = ThietbiTC & MayTC
        MayTC = ""
    Next v
    With Sheets("GhiNhatky")
        Er = .Range("B65535").End(3).row + 1
        .Range("A6:B" & Er).ClearContents
        .Range("A6:B" & Er).Borders.LineStyle = xlNone
        .Range("A6").Resize(k, 2) = dArr
        With .Range("A6").Resize(k, 2)
            .Borders.LineStyle = xlContinuous
            .Borders.ThemeColor = 10
            .Borders(xlInsideHorizontal).LineStyle = xlNone
        End With
        .PageSetup.PrintArea = "$A$1:$B$" & k + 5
        .PageSetup.PrintTitleRows = "$5:$5"
        .Range("B6:B" & k + 1).EntireRow.AutoFit
    End With
    Set dic = Nothing
End Sub
Sub MayThicong()
    Dim sArr(), tArr(), dArr(), I As Long, k As Long
    Dim dic As Object, sKey As String
    Dim tmp, J As Long, Arr()
    Dim Er As Long, N As Long
    Set dic = CreateObject("Scripting.Dictionary")
    With Sheets("NKchitiet")
        tArr = .Range("C4", .Range("C" & Rows.Count).End(xlUp)).Resize(, 2).Value
    End With
    ReDim sArr(1 To 100000, 1 To 2)
    For I = 1 To UBound(tArr)
        If tArr(I, 2) <> Empty Then
            tmp = Split(tArr(I, 2), ";")
            For J = 0 To UBound(tmp)
                sKey = tArr(I, 1) & "#" & Trim(tmp(J))
                If Not dic.Exists(sKey) Then
                    k = k + 1
                    dic.Add sKey, k
                    sArr(k, 1) = Trim(tmp(J))
                    sArr(k, 2) = 1
                Else
                    sArr(dic.Item(sKey), 2) = sArr(dic.Item(sKey), 2) + 1
                End If
            Next J
        End If
    Next I
    ReDim dArr(1 To k, 1 To 7)
    If dic.Count Then
        dic.RemoveAll: k = 0
        For I = 1 To UBound(sArr)
            If sArr(I, 1) = Empty Then Exit For
            sKey = sArr(I, 1)
            If Not dic.Exists(sKey) Then
                k = k + 1: N = N + 1
                dic.Add sKey, k
                dArr(k, 1) = sArr(I, 1)
                dArr(k, 7) = sArr(I, 2)
            Else
                If sArr(I, 2) > dArr(dic.Item(sKey), 7) Then
                    dArr(dic.Item(sKey), 7) = sArr(I, 2)
                End If
            End If
        Next I
        k = 0
        ReDim Arr(1 To N, 1 To UBound(dArr, 2))
        For I = 1 To UBound(dArr)
            If dArr(I, 1) <> Empty Then
                k = k + 1
                For J = 1 To UBound(dArr, 2)
                    Arr(k, J) = Trim(dArr(I, J))
                Next J
            End If
        Next I
        Arr = Sort2DArray(Arr, 1, True, False)
        With Sheets("Nhanluc")
            .Range("F44:P86").ClearContents
            If k Then
                .Range("F44:E86").EntireRow.Hidden = False
                .Range("F44").Resize(k, 7) = Arr
                Er = .Range("F86").End(xlUp).row
                For I = 44 To Er
                    FixRow .Range("F" & I)
                Next I
                .Range("F" & Er + 1 & ":F86").EntireRow.Hidden = True
            End If
        End With
    End If
    Set dic = Nothing
End Sub
Sub ThaythetenmayTC()
    Dim tArr(), I As Long, Er As Long
    With Sheets("Nhanluc")
        tArr = .Range("F44", .Range("F44").End(xlDown)).Resize(, 13).Value
    End With
    Sheets("NKchitiet").Select
    For I = 1 To UBound(tArr)
        Cells.Replace What:=tArr(I, 1), Replacement:=tArr(I, 13), LookAt:=xlPart, SearchOrder:=xlByRows
    Next I
    MayThicong
    Sheets("Nhanluc").Select
    Er = Range("F86").End(xlUp).row
    For I = 44 To Er
        FixRow Range("F" & I)
    Next I
End Sub
Attribute VB_Name = "Ribbon"
Option Explicit
Sub Taocongtrinhmoi(control As IRibbonControl)
On Error Resume Next
Call Taomoi
End Sub
Sub Thoitietthicong(control As IRibbonControl)
    On Error Resume Next
    Sheet21.Select
End Sub
Sub Tramquantrac(control As IRibbonControl)
    On Error Resume Next
    Sheet2.Select
End Sub
Sub Capnhatthoitiet(control As IRibbonControl)
    On Error Resume Next
    Sheet2.Select
    Form_Accuweather.Show
End Sub
Sub Kiemtrangay(control As IRibbonControl)
    Dim NameSh As String
    NameSh = ActiveSheet.Name
    Select Case NameSh
        Case Is = "Nhattrinh": Call Kiemtra_ngayTC
        Case Else: MsgboxUni VNI("Kho|fffd|ng th|fffd||fffd|c hie|fffd|n tre|fffd|n Sheet na|fffd|y. Va|fffd|o Nha|fffd|t tr|fffd|nh co|fffd|ng vie|fffd|c sa|fffd|u |fffd|o|fffd| ba|fffd|m kie|fffd|m tra nga|fffd|y thi co|fffd|ng"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
    End Select
End Sub
Sub Xuattheongaythang(control As IRibbonControl)
    On Error Resume Next
    Xuattheongaythicong
    MsgboxUni VNI("Qua|fffd| tr|fffd|nh xua|fffd|t d|fffd||fffd| lie|fffd|u |fffd|a|fffd| hoa|fffd|n tha|fffd|nh"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
End Sub
Sub Xuattheohangmuccongtrinh(control As IRibbonControl)
    On Error Resume Next
    Call Xuattheohangmuc
    MsgboxUni VNI("Qua|fffd| tr|fffd|nh xua|fffd|t d|fffd||fffd| lie|fffd|u |fffd|a|fffd| hoa|fffd|n tha|fffd|nh"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
End Sub
Sub XuatBBNTCVXD(control As IRibbonControl)
    On Error Resume Next
    Call XuatBBtoPdf
End Sub
Sub Xuatdulieunhatky(control As IRibbonControl)
    On Error Resume Next
    Application.ScreenUpdating = False
    Call DMNhatky
    Call Phantichnhatky
    Call Ghinhatky
    Application.ScreenUpdating = True
    MsgboxUni VNI("|fffd|a|fffd| xua|fffd|t xong d|fffd||fffd| lie|fffd|u nha|fffd|t ky|fffd| thi co|fffd|ng"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
End Sub
Sub Thongtincongtrinh(control As IRibbonControl)
    Sheets("Thongtin").Select
End Sub
Sub Dulieudauvao(control As IRibbonControl)
    'Sheets("Dulieudauvao").Select
End Sub
Sub Macongviec(control As IRibbonControl)
    Sheets("MaCV").Select
End Sub
Sub Tieuchuannghiemthu(control As IRibbonControl)
    Sheets("TCNT").Select
End Sub
Sub Mathinghiem(control As IRibbonControl)
    Sheets("MaTN").Select
End Sub
Sub Nhattrinh(control As IRibbonControl)
    Sheets("Nhattrinh").Select
End Sub
Sub ListbienbanCVXD(control As IRibbonControl)
    Sheets("ListBBCV").Select
End Sub
Sub ListbienbanHT(control As IRibbonControl)
    Sheets("ListBBHT").Select
End Sub
Sub Listbienbanvatlieu(control As IRibbonControl)
    Sheets("ListNTVL").Select
End Sub
Sub ListbienbanTN(control As IRibbonControl)
    Sheets("List TNBT").Select
End Sub
Sub BienbannghiemthuCVXD(control As IRibbonControl)
    Sheets("BienbanCVXD").Select
End Sub
Sub BienbannghiemthuHT(control As IRibbonControl)
    Sheets("BienbanHT").Select
End Sub
Sub BienbanTNBT(control As IRibbonControl)
    Sheets("BBLMBT").Select
End Sub
Sub DanhmucBBCVXD(control As IRibbonControl)
    Sheets("DanhmucBBCV").Select
End Sub
Sub DanhmucBBHT(control As IRibbonControl)
    Sheets("DanhmucBBHT").Select
End Sub
Sub Lenhkhoicong(control As IRibbonControl)
    Sheets("LenhK.cong").Select
End Sub
Sub Matbang(control As IRibbonControl)
    Sheets("Matbang").Select
End Sub
Sub ChapthuanVL(control As IRibbonControl)
    Sheets("PhieuCTVL").Select
End Sub
Sub KiemtraPTN(control As IRibbonControl)
    Sheets("PhongThinghiem").Select
End Sub
Sub Nhanluc(control As IRibbonControl)
    Sheets("Nhanluc").Select
End Sub
Sub Moccaodo(control As IRibbonControl)
    Sheets("N.thuMoc").Select
End Sub
Sub Dieukienthicong(control As IRibbonControl)
    Sheets("Dieukientruocthicong").Select
End Sub
Sub Biahoso(control As IRibbonControl)
    Sheets("Bia").Select
End Sub
Sub Danhmucnhatky(control As IRibbonControl)
    Sheets("DMnhatky").Select
End Sub
Sub Nhatkychitiet(control As IRibbonControl)
    Sheets("NKchitiet").Select
End Sub
Sub Nhatkytcbanchep(control As IRibbonControl)
    Sheets("GhiNhatky").Select
End Sub
Sub onAction(control As IRibbonControl)
    Sheets("InNKTC").Select
End Sub
Sub Nhatkytcbanin(control As IRibbonControl)
    Sheets("InNKGS").Select
End Sub
Sub Innhatky(control As IRibbonControl)
    On Error Resume Next
    On Error Resume Next
    Dim NameSh As String
    NameSh = ActiveSheet.Name
    Select Case NameSh
        Case Is = "InNKTC"
            Xuatnhatky
            MsgboxUni VNI("|fffd|a|fffd| xua|fffd|t xong d|fffd||fffd| lie|fffd|u nha|fffd|t ky|fffd| thi co|fffd|ng ra file Pdf"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
        Case Is = "InNKGS"
            XuatnhatkyGS
            MsgboxUni VNI("|fffd|a|fffd| xua|fffd|t xong d|fffd||fffd| lie|fffd|u nha|fffd|t ky|fffd| thi co|fffd|ng ra file Pdf"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
        Case Is = "GhiNhatky"
            Xuatnhatky_pdf
            MsgboxUni VNI("|fffd|a|fffd| xua|fffd|t xong d|fffd||fffd| lie|fffd|u nha|fffd|t ky|fffd| thi co|fffd|ng ra file Pdf"), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
        Case Else: MsgboxUni VNI("Kho|fffd|ng th|fffd||fffd|c hie|fffd|n tre|fffd|n Sheet na|fffd|y."), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
    End Select
End Sub
Sub INBBNT(control As IRibbonControl)
    On Error Resume Next
    Dim NameSh As String
    NameSh = ActiveSheet.Name
    Select Case NameSh
        Case Is = "BienbanCVXD": Call BBNT.Show
        Case Is = "BienbanHT": Call BBNTHT.Show
        Case Is = "BBLMBT": Call BBLM.Show
        Case Is = "Bia": Call BBLM.Show
        Case Is = "DanhmucBBCV": Call BBLM.Show
        Case Is = "DanhmucBBHT": Call BBLM.Show
        Case Is = "GhiNhatky": Call BBLM.Show
        Case Else: MsgboxUni VNI("Kho|fffd|ng th|fffd||fffd|c hie|fffd|n tre|fffd|n Sheet na|fffd|y."), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
    End Select
End Sub
Sub INBBLM(control As IRibbonControl)
    On Error Resume Next
    Dim NameSh As String
    NameSh = ActiveSheet.Name
    Select Case NameSh
        Case Is = "BBLMBT": Call BBLM.Show
        Case Else: MsgboxUni VNI("Kho|fffd|ng th|fffd||fffd|c hie|fffd|n tre|fffd|n Sheet na|fffd|y."), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
    End Select
End Sub
Sub TachListTN(control As IRibbonControl)
    On Error Resume Next
    TachFileThinghiem
End Sub
Sub TachListBBCVtoWord(control As IRibbonControl)
    Dim Thongbao
    Sheet5.Select
    Thongbao = MsgboxUni(VNI("Ba|fffd|n co|fffd| muo|fffd|n ta|fffd|ch List bie|fffd|n ba|fffd|n NTCVXD ra file m|fffd||fffd|i kho|fffd|ng"), vbYesNo, VNI("Tho|fffd|ng ba|fffd|o"))
    If Thongbao = vbYes Then Call TachFile_ListBBCVXD
End Sub
Sub TachListBBHT(control As IRibbonControl)
    Dim Thongbao
    On Error Resume Next
    Sheet6.Select
    Thongbao = MsgboxUni(VNI("Ba|fffd|n co|fffd| muo|fffd|n ta|fffd|ch List bie|fffd|n ba|fffd|n NTHTHM ra file m|fffd||fffd|i kho|fffd|ng"), vbYesNo, VNI("Tho|fffd|ng ba|fffd|o"))
    If Thongbao = vbYes Then Call TachFile_ListBBHTHM
End Sub
Sub Hamtutao(control As IRibbonControl)
    On Error Resume Next
    Sheets("Hamtutao").Select
End Sub
Sub HDSD(control As IRibbonControl)
    On Error Resume Next
    FormHelp.Show
End Sub
Attribute VB_Name = "SubBB"
Option Explicit
Sub List_BBNT()
    Dim sArr(), dArr, tArr, I As Long, J As Long, k As Long
On Error Resume Next
With Sheets("Nhattrinh")
    sArr = .Range("C16", .Range("C65000").End(3)).Resize(, 16).Value
End With
ReDim dArr(1 To UBound(sArr), 1 To 16)
For I = 1 To UBound(sArr)
    If sArr(I, 9) <> Empty And Left(sArr(I, 1), 2) <> "HT" And Left(sArr(I, 1), 2) <> "KT" Then
        k = k + 1
        dArr(k, 1) = k
        dArr(k, 2) = sArr(I, 1) & "-" & sArr(I, 12): dArr(k, 3) = sArr(I, 1)
        dArr(k, 4) = sArr(I, 2): dArr(k, 5) = sArr(I, 3)
        dArr(k, 7) = sArr(I, 7): dArr(k, 8) = sArr(I, 8)
        dArr(k, 10) = sArr(I, 9)
        dArr(k, 11) = sArr(I, 10): dArr(k, 12) = sArr(I, 11)
        dArr(k, 13) = sArr(I, 13): dArr(k, 14) = sArr(I, 14)
        dArr(k, 15) = "=RANK(RC[-5],R4C10:R1500C10,1)+COUNTIF(R4C10:RC[-5],RC[-5])-1"
        dArr(k, 16) = k
    End If
Next I
With Sheet8
    If .Range("A65535").End(3).row > 4 Then
        With .Range("A4:P" & .Range("A65535").End(3).row + 1)
            .ClearContents
            .Borders.LineStyle = xlNone
        End With
    End If
    If k Then
        .Range("A4").Resize(k, 16) = dArr
        '.Range("O4:O" & .Range("A65535").End(3).Row + 1) = .Range("O4:O" & .Range("A65535").End(3).Row + 1).Value
        '.Range("B4:Q" & .Range("A65535").End(3).row + 1).Sort Key1:=.[P4]
        With .Range("A4").Resize(k, 16)
            .Borders.LineStyle = xlContinuous
            .Borders.ThemeColor = 10
            .Borders(xlInsideHorizontal).LineStyle = xlNone
        End With
        Call DiengioBBCV
        Call DiengioBBNB
    End If
End With
End Sub
Sub List_BBHT()
    Dim sArr(), dArr, tArr, I As Long, J As Long, k As Long
    On Error Resume Next
    With Sheets("Nhattrinh")
        sArr = .Range("C16", .Range("C65000").End(3)).Resize(, 16).Value
    End With
    ReDim dArr(1 To UBound(sArr), 1 To 16)
    For I = 1 To UBound(sArr)
        If sArr(I, 9) <> Empty And Left(sArr(I, 1), 2) = "HT" Then
            k = k + 1
            dArr(k, 1) = k
            dArr(k, 2) = sArr(I, 1) & "-" & sArr(I, 12): dArr(k, 3) = sArr(I, 1)
            dArr(k, 4) = sArr(I, 2): dArr(k, 5) = sArr(I, 3)
            dArr(k, 7) = sArr(I, 7): dArr(k, 8) = sArr(I, 8)
            dArr(k, 10) = sArr(I, 9)
            dArr(k, 11) = sArr(I, 10): dArr(k, 12) = sArr(I, 11)
            dArr(k, 13) = sArr(I, 13): dArr(k, 14) = sArr(I, 14)
            dArr(k, 15) = "=RANK(RC[-5],R4C10:R1500C10,1)+COUNTIF(R4C10:RC[-5],RC[-5])-1"
            dArr(k, 16) = k
        End If
    Next I
    With Sheets("ListBBHT")
        If .Range("A65535").End(3).row > 4 Then
            With .Range("A4:P" & .Range("A65535").End(3).row + 1)
                .ClearContents
                .Borders.LineStyle = xlNone
            End With
        End If
        If k Then
            .Range("A4").Resize(k, 16) = dArr
            '.Range("O4:O" & .Range("A65535").End(3).Row + 1) = .Range("O4:O" & .Range("A65535").End(3).Row + 1).Value
            '.Range("B4:Q" & .Range("A65535").End(3).row + 1).Sort Key1:=.[P4]
            With .Range("A4").Resize(k, 16)
                .Borders.LineStyle = xlContinuous
                .Borders.ThemeColor = 10
                .Borders(xlInsideHorizontal).LineStyle = xlNone
            End With
            Call DiengioBBHT
            Call DiengioNBHT
        End If
    End With
End Sub
Sub List_Thinghiem()
    Dim sArr(), dArr, tArr, I As Long, J As Long, k As Long
    On Error Resume Next
    With Sheets("Nhattrinh")
        sArr = .Range("C7", .Range("C65000").End(3)).Resize(, 5).Value
    End With
    ReDim dArr(1 To UBound(sArr), 1 To 7)
    For I = 1 To UBound(sArr)
        If Left(sArr(I, 1), 2) = "CP" Then
            k = k + 1
            dArr(k, 1) = k
            dArr(k, 2) = sArr(I, 1): dArr(k, 3) = sArr(I, 2)
            dArr(k, 4) = sArr(I, 3): dArr(k, 5) = sArr(I, 4)
        End If
    Next I
    With Sheets("ListTN")
        With .Range("A4:G" & .Range("A65535").End(3).row + 1)
            .ClearContents
            .Borders.LineStyle = xlNone
        End With
        If k Then
            .Range("A4").Resize(k, 5) = dArr
            With .Range("A4").Resize(k, 7)
                .Borders.LineStyle = xlContinuous
                .Borders.ThemeColor = 10
                .Borders(xlInsideHorizontal).LineStyle = xlNone
            End With
        End If
    End With
End Sub
Sub ListTNBT()
    Dim sArr, dArr, I As Long, k As Long
    Dim LMTN As String, STR_LMTN As String
    Dim dongcuoi As Long
    LMTN = "L" & ChrW$(7845) & "y m" & ChrW$(7851) & "u th" & ChrW$(237) & " nghi" & ChrW$(7879) & "m "
    With Sheets("Nhattrinh")
        sArr = .Range("C16", .Range("C65000").End(3)).Resize(, 14).Value
    End With
    ReDim dArr(1 To UBound(sArr), 1 To 11)
    For I = 1 To UBound(sArr)
        If sArr(I, 1) = "CP.00017" Or sArr(I, 1) = "CP.00018" Then
            k = k + 1
            STR_LMTN = Trim(Replace(sArr(I, 2), LMTN, ""))
            dArr(k, 1) = k
            dArr(k, 2) = UCase(Mid(STR_LMTN, 1, 1)) & Mid(STR_LMTN, 2, Len(STR_LMTN) - 1)
            dArr(k, 3) = sArr(I, 3)
            dArr(k, 4) = _
                    "=IFERROR(MID(RC[-2],FIND(""M"",RC[-2])+1,3),MID(RC[-2],FIND(""C"",RC[-2])+1,3))"
            dArr(k, 5) = "=CotlieuBtong(RC[-3])"
            dArr(k, 6) = "=KhuonBtong(RC[-2],RC[-1])"
            dArr(k, 7) = sArr(I, 4)
            dArr(k, 9) = "x"
            dArr(k, 10) = "x"
            dArr(k, 11) = "=IF(RC[-4]>0,COUNTIF(R3C7:RC[-4],RC[-4]),"""")"
        End If
    Next I
    With Sheets("List TNBT")
        dongcuoi = .Range("A" & Rows.Count).End(xlUp).row
        If dongcuoi > 3 Then .Range("A3:A" & dongcuoi).Resize(, 11).ClearContents
        If k Then .Range("A3").Resize(k, 11) = dArr
        '.Range("B3:J" & .Range("A65535").End(3).Row + 1).Sort Key1:=.[G3]
    End With
End Sub
Sub DANHMUCCVXD()
    Dim sArr, tArr(1 To 1000, 1 To 3), dArr, tmp, Tmp1, rng As Range
    Dim I As Long, J As Long, k As Long, It As Long, Stt As Long, Er As Long, SBB As Long
    Dim dic As Object, R As String
    Dim YC As String, CV As String, LM As String, LM1 As String, Ma As String, Kt As String
    Set dic = CreateObject("Scripting.Dictionary")
    YC = "- Phi" & ChrW$(7871) & "u y" & ChrW$(234) & "u c" & ChrW$(7847) & "u nghi" & ChrW$(7879) & "m thu"
    CV = "- Bi" & ChrW$(234) & "n b" & ChrW$(7843) & "n nghi" & ChrW$(7879) & "m thu c" & ChrW$(244) & "ng vi" & ChrW$(7879) & "c x" & ChrW$(226) & "y d" & ChrW$(7921) & "ng "
    LM = "L" & ChrW$(7845) & "y m" & ChrW$(7851) & "u"
    LM1 = "- Bi" & ChrW$(234) & "n b" & ChrW$(7843) & "n l" & ChrW$(7845) & "y m" & ChrW$(7851) & "u"
    Kt = "- Bi" & ChrW$(234) & "n b" & ChrW$(7843) & "n "
    Dim Arr(), N As Long, Idx
    tmp = Array(YC, CV)
    Application.ScreenUpdating = False
    Set rng = Sheets("ListBBCV").Range("B4:P1800")
    With Sheets("Nhattrinh")
        sArr = .Range("A16: A" & .Range("C65535").End(3).row).Resize(, 15).Value
    End With
    For I = 1 To UBound(sArr)
        If sArr(I, 2) <> Empty Then
            If Not dic.Exists(sArr(I, 2)) Then
                N = N + 1
                dic.Add sArr(I, 2), N
                ReDim Preserve Arr(1 To N)
                Arr(N) = I
            Else
                Arr(N) = Arr(dic.Item(sArr(I, 2))) & "; " & I
            End If
        End If
    Next I
    ReDim dArr(1 To UBound(sArr) * 11, 1 To 6)
    For I = 1 To UBound(sArr)
        If Left(sArr(I, 3), 2) <> "HT" Then
            If sArr(I, 3) <> Empty And sArr(I, 11) <> Empty Then
                Ma = sArr(I, 3) & "-" & sArr(I, 14)
                SBB = Application.WorksheetFunction.VLookup(Ma, rng, 14, False)
            End If
        End If
        If sArr(I, 10) <> Empty And Left(sArr(I, 3), 2) <> "HT" Then
            Stt = Stt + 1
            k = k + 1
            dArr(k, 1) = Stt: dArr(k, 2) = sArr(I, 4): dArr(k, 3) = sArr(I, 5): dArr(k, 6) = SBB
            For J = 0 To UBound(tmp)
                k = k + 1
                dArr(k, 2) = tmp(J): dArr(k, 5) = sArr(I, 10 + J): dArr(k, 6) = SBB
                If J = 0 Then dArr(k, 4) = Format(SBB, "00") & "/PYCCV"
                If J = 1 Then dArr(k, 4) = Format(SBB, "00") & "/NTCV"
            Next J
            R = dic.Item(sArr(I, 1))
            If Len(R) Then
                For Each Idx In Split(Arr(R), ";")
                    k = k + 1
                    If Left(sArr(Idx, 3), 2) = "CP" Then
                        dArr(k, 2) = Replace(sArr(Idx, 4), LM, LM1)
                    Else
                        dArr(k, 2) = Kt & sArr(Idx, 4)
                    End If
                    dArr(k, 3) = sArr(Idx, 5): dArr(k, 5) = sArr(Idx, 6)
                    If Left(sArr(Idx, 3), 2) = "CP" Then
                        k = k + 1
                        dArr(k, 2) = Replace(sArr(Idx, 4), LM, "     + KQTN "): dArr(k, 3) = sArr(Idx, 5)
                    End If
                Next
            End If
        End If
    Next I
    With Sheets("DanhmucBBCV")
        .Range("A4:E1800").ClearContents
        .Range("A4:E1800").Borders.LineStyle = xlNone
        .Range("A4").Resize(k, 6) = dArr
        .Range("A4").Resize(k, 5).Borders.LineStyle = xlContinuous
        .Range("A4").Resize(k, 5).Borders(xlInsideHorizontal).Weight = xlHairline
        .Range("A4").Resize(k, 5).Borders.ThemeColor = 10
        For I = k + 3 To 3 Step -1
            If .Range("A" & I) = Empty Then
                .Range("A" & I & ":E" & I).Font.Italic = True
            Else
                .Range("A" & I & ":E" & I).Font.Italic = False
                .Range("A" & I & ":E" & I).Borders(xlEdgeTop).LineStyle = xlContinuous
                .Range("A" & I & ":E" & I).Borders(xlEdgeTop).Weight = xlThin
            End If
        Next I
        .PageSetup.PrintArea = "$A$1:$E$" & k + 3
        .Range("B4:B" & k + 1).EntireRow.AutoFit
    End With
    Application.ScreenUpdating = True
End Sub
Sub DANHMUCHTHM()
    Dim sArr, tArr(1 To 1000, 1 To 2), dArr, tmp, Tmp1
    Dim I As Long, J As Long, k As Long, It As Long, Stt As Long, Er As Long
    Dim NB As String, YC As String, CV As String, LM As String
    YC = "- Phi" & ChrW$(7871) & "u y" & ChrW$(234) & "u c" & ChrW$(7847) & "u nghi" & ChrW$(7879) & "m thu"
    CV = "- Bi" & ChrW$(234) & "n b" & ChrW$(7843) & "n nghi" & ChrW$(7879) & "m thu c" & ChrW$(244) & "ng vi" & ChrW$(7879) & "c x" & ChrW$(226) & "y d" & ChrW$(7921) & "ng "
    LM = "L" & ChrW$(7845) & "y m" & ChrW$(7851) & "u"
    tmp = Array(YC, CV)
    Application.ScreenUpdating = False
    With Sheets("Nhattrinh")
        sArr = .Range("A16: A" & .Range("C65535").End(3).row).Resize(, 10).Value
    End With
    ReDim dArr(1 To UBound(sArr) * 5, 1 To 4)
    For I = 1 To UBound(sArr)
        If sArr(I, 10) <> Empty And Left(sArr(I, 3), 2) = "HT" Then
            Stt = Stt + 1
            k = k + 1
            dArr(k, 1) = Stt: dArr(k, 2) = sArr(I, 4): dArr(k, 3) = sArr(I, 5)
            For J = 0 To UBound(tmp)
                k = k + 1
                dArr(k, 2) = tmp(J): dArr(k, 4) = sArr(I, 9 + J)
            Next J
        End If
    Next I
    With Sheets("DanhmucBBHT")
        If .Range("A65535").End(xlUp).row > 4 Then
            .Range("A4:D1800").ClearContents
            .Range("A4:D1800").Borders.LineStyle = xlNone
        End If
        If k Then
            .Range("A4").Resize(k, 4) = dArr
            .Range("A4").Resize(k, 4).Borders.LineStyle = xlContinuous
            .Range("A4").Resize(k, 4).Borders(xlInsideHorizontal).Weight = xlHairline
            For I = k + 3 To 3 Step -1
                If .Range("A" & I) = Empty Then
                    .Range("A" & I & ":D" & I).Font.Italic = True
                Else
                    .Range("A" & I & ":D" & I).Font.Italic = False
                    .Range("A" & I & ":D" & I).Borders(xlEdgeTop).LineStyle = xlContinuous
                    .Range("A" & I & ":D" & I).Borders(xlEdgeTop).Weight = xlThin
                End If
            Next I
        End If
        .PageSetup.PrintArea = "$A$1:$D$" & k + 3
        .Range("B4:B" & k + 1).EntireRow.AutoFit
    End With
    Application.ScreenUpdating = True
End Sub
Sub DiengioBBCV()
    Dim sArr(), dArr, tArr, I As Long, J As Long, k As Long, Er As Long, wf As Object
    Dim dic As Object, Tem As Long, R As Long
    Dim BatdauCV, KetthucCV, GioCV As String
    Set dic = CreateObject("Scripting.Dictionary")
    Set wf = Application.WorksheetFunction
    On Error Resume Next
    With Sheets("Config")
        tArr = .Range("A3:I10").Value
    End With
    For I = 1 To UBound(tArr)
        dic.Item(tArr(I, 1)) = I
    Next I
    With Sheets("ListBBCV")
        Er = .Range("A65535").End(3).row
        For I = Er To 4 Step -1
            If I > 3 Then
                Tem = .Range("N" & I)
                R = dic.Item(Tem)
                If R Then
                    GioCV = tArr(R, 9)
                    If tArr(J, 1) = .Range("N" & I) Then .Range("I" & I) = GioCV
                End If
            End If
        Next I
    End With
End Sub
Sub DiengioBBNB()
    Dim sArr(), dArr, tArr, I As Long, J As Long, k As Long, Er As Long, wf As Object
    Dim dic As Object, Tem As Long, R As Long
    Dim BatdauCV, KetthucCV, GioCV As String
    Set dic = CreateObject("Scripting.Dictionary")
    Set wf = Application.WorksheetFunction
    On Error Resume Next
    With Sheets("Config")
        tArr = .Range("A3:I10").Value
    End With
    For I = 1 To UBound(tArr)
        dic.Item(tArr(I, 1)) = I
    Next I
    With Sheets("ListBBCV")
        Er = .Range("A65535").End(3).row
        For I = Er To 4 Step -1
            If I > 3 Then
                Tem = .Range("M" & I)
                R = dic.Item(Tem)
                If R Then
                    GioCV = tArr(R, 6)
                    If tArr(J, 1) = .Range("M" & I) Then .Range("F" & I) = GioCV
                End If
            End If
        Next I
    End With
End Sub
Sub DiengioBBHT()
    Dim sArr(), dArr, tArr, I As Long, J As Long, k As Long, Er As Long, wf As Object
    Dim dic As Object, Tem As Long, R As Long
    Dim BatdauCV, KetthucCV, GioCV As String
    Set dic = CreateObject("Scripting.Dictionary")
    Set wf = Application.WorksheetFunction
    On Error Resume Next
    With Sheets("Config")
        tArr = .Range("A3:I10").Value
    End With
    For I = 1 To UBound(tArr)
        dic.Item(tArr(I, 1)) = I
    Next I
    With Sheets("ListBBHT")
        Er = .Range("A65535").End(3).row
        For I = Er To 4 Step -1
            If I > 3 Then
                Tem = .Range("N" & I)
                R = dic.Item(Tem)
                If R Then
                    GioCV = tArr(R, 9)
                    If tArr(J, 1) = .Range("N" & I) Then .Range("I" & I) = GioCV
                End If
            End If
        Next I
    End With
End Sub
Sub DiengioNBHT()
    Dim sArr(), dArr, tArr, I As Long, J As Long, k As Long, Er As Long, wf As Object
    Dim dic As Object, Tem As Long, R As Long
    Dim BatdauCV, KetthucCV, GioCV As String
    Set dic = CreateObject("Scripting.Dictionary")
    Set wf = Application.WorksheetFunction
    On Error Resume Next
    With Sheets("Config")
        tArr = .Range("A3:I10").Value
    End With
    For I = 1 To UBound(tArr)
        dic.Item(tArr(I, 1)) = I
    Next I
    With Sheets("ListBBHT")
        Er = .Range("A65535").End(3).row
        For I = Er To 4 Step -1
            If I > 3 Then
                Tem = .Range("M" & I)
                R = dic.Item(Tem)
                If R Then
                    GioCV = tArr(R, 6)
                    If tArr(J, 1) = .Range("M" & I) Then .Range("F" & I) = GioCV
                End If
            End If
        Next I
    End With
End Sub
Sub Xuattheohangmuc()
    Application.ScreenUpdating = False
    Sheets("Nhattrinh").Select
    Stt
    List_BBNT
    List_BBHT
    List_Thinghiem
    ListTNBT
    DANHMUCCVXD
    DANHMUCHTHM
    Sheets("DanhmucBBCV").Range("F4:F" & Sheets("DanhmucBBCV").Range("B65535").End(3).row + 1).ClearContents
    Application.ScreenUpdating = True
End Sub
Sub Xuattheongaythicong()
    Dim SrcRng As Range, Arr, dArr, I As Long, N As Long
    Application.ScreenUpdating = False
    Sheets("Nhattrinh").Select
    Stt
    List_BBNT
    List_BBHT
    List_Thinghiem
    ListTNBT
    DANHMUCCVXD
    DANHMUCHTHM
    With Sheets("ListBBCV")
        .Range("B4:P" & .Range("A65535").End(3).row + 1).Sort Key1:=.[H4]
    End With
    With Sheets("ListBBHT")
        .Range("B4:P" & .Range("A65535").End(3).row + 1).Sort Key1:=.[H4]
    End With
    With Sheets("DanhmucBBCV")
        .Range("B4:F" & .Range("B65535").End(3).row + 1).Sort Key1:=.[F4]
        Set SrcRng = Range(.[c4], .[C65536].End(xlUp))
        Arr = SrcRng.Value
        ReDim dArr(1 To UBound(Arr), 1 To 1)
        For I = 1 To UBound(Arr, 1)
            If Arr(I, 1) <> Empty Then
                N = N + 1
                dArr(I, 1) = N
            End If
        Next
        .Range("A4").Resize(I - 1, 1).ClearContents
        .Range("A4").Resize(I - 1, 1).Value = dArr
        .Range("F4:F" & .Range("F65535").End(3).row).ClearContents
    End With
    Application.ScreenUpdating = True
End Sub

Attribute VB_Name = "SubIn"
Option Explicit
Sub TachTCNT()
    Dim my_arr, sArr, dArr(1 To 100, 1 To 1), d As Object, v As Variant, Ma As String, Ws As Worksheet
    Dim J As Long, I As Long, k As Long
    Dim ErTCNT_NB As Long, ErKQTN_NB As Long
    Dim ErTCNT_CV As Long, ErKQTN_CV As Long
Set Ws = ActiveSheet
On Error Resume Next
Set d = CreateObject("Scripting.Dictionary")
Ma = Ws.Range("AD1")
With Sheets("TCNT")
    sArr = .Range("A3", .Range("A65000").End(3)).Resize(, 2).Value
End With
my_arr = Split(Ma, ";")
For I = LBound(my_arr) To UBound(my_arr)
    d(Application.WorksheetFunction.Substitute(my_arr(I), " ", "")) = 1
Next I
For Each v In d.Keys()
    For I = 1 To UBound(sArr)
        If Application.WorksheetFunction.Substitute(sArr(I, 1), " ", "") = v Then
            k = k + 1
            dArr(k, 1) = "     + " & sArr(I, 1) & ": " & sArr(I, 2)
            Exit For
        End If
    Next I
Next v
With Ws
    ErTCNT_NB = .Range("X2").Value: ErKQTN_NB = .Range("Y2").Value
    ErTCNT_CV = .Range("Z2").Value: ErKQTN_CV = .Range("AA2").Value
    .Range("E" & ErTCNT_NB).Resize(10).ClearContents
    .Range("E" & ErTCNT_NB).Resize(10).EntireRow.Hidden = False
    .Range("E" & ErTCNT_CV).Resize(10).ClearContents
    .Range("E" & ErTCNT_CV).Resize(10).EntireRow.Hidden = False
    If k Then
        .Range("E" & ErTCNT_NB).Resize(k, 1) = dArr
        .Range("E" & ErTCNT_CV).Resize(k, 1) = dArr
    End If
    .Range("E" & ErTCNT_NB).Resize(10).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
    .Range("E" & ErTCNT_CV).Resize(10).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
End With
End Sub
Sub TachTNghiem()
    Dim my_arr, sArr, dArr(1 To 100, 1 To 1), d As Object, v As Variant, Ma As String, Ws As Worksheet
    Dim J As Long, I As Long, k As Long
    Dim ErTCNT_NB As Long, ErKQTN_NB As Long
    Dim ErTCNT_CV As Long, ErKQTN_CV As Long
    Set Ws = ActiveSheet
    On Error Resume Next
    Set d = CreateObject("Scripting.Dictionary")
    Ma = Ws.Range("AD2")
    With Sheets("MaTN")
        sArr = .Range("A3", .Range("A65000").End(3)).Resize(, 2).Value2
    End With
    my_arr = Split(Ma, ";")
    For I = LBound(my_arr) To UBound(my_arr)
        d(Application.WorksheetFunction.Substitute(my_arr(I), " ", "")) = 1
    Next I
    For Each v In d.Keys()
        For I = 1 To UBound(sArr)
            If Application.WorksheetFunction.Substitute(sArr(I, 1), " ", "") = v Then
                k = k + 1
                dArr(k, 1) = "     + " & sArr(I, 2)
                Exit For
            End If
        Next I
    Next v
    With Ws
        ErTCNT_NB = .Range("X2").Value: ErKQTN_NB = .Range("Y2").Value
        ErTCNT_CV = .Range("Z2").Value: ErKQTN_CV = .Range("AA2").Value
        .Range("E" & ErKQTN_NB).Resize(10).ClearContents
        .Range("E" & ErKQTN_NB).Resize(10).EntireRow.Hidden = False
        .Range("E" & ErKQTN_CV).Resize(10).ClearContents
        .Range("E" & ErKQTN_CV).Resize(10).EntireRow.Hidden = False
        If k Then
            .Range("E" & ErKQTN_NB).Resize(k, 1) = dArr
            .Range("E" & ErKQTN_CV).Resize(k, 1) = dArr
        End If
        .Range("E" & ErKQTN_NB).Resize(10).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
        .Range("E" & ErKQTN_CV).Resize(10).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
    End With
End Sub
Sub CandongBB()
    Dim sArr, dArr, I As Long, k As Long, Er As Long, DONG, Ws As Worksheet
    Dim c As Range, cc As Range, Ma As Range, MrgeWdth As Single
    Set Ws = ActiveSheet
    On Error Resume Next
    Application.ScreenUpdating = False
    If Ws.Name = "BienbanCVXD" Or Ws.Name = "BienbanHT" Or Ws.Name = "BienbanV.lieu" Then Call TachTCNT: Call TachTNghiem
    With Ws
        sArr = .Range("E14:E" & .Range("E65000").End(3).row).Resize(, 16).Value
        Set c = .Range("E1")
        Set Ma = c.MergeArea
        For Each cc In Ma.Cells
            MrgeWdth = MrgeWdth + cc.ColumnWidth
        Next
    End With
    ReDim dArr(1 To UBound(sArr), 1 To 2)
    For I = 1 To UBound(sArr)
        If sArr(I, 16) <> Empty Then
            k = k + 1
            dArr(k, 1) = sArr(I, 1): dArr(k, 2) = sArr(I, 16)
        End If
    Next I
    With Sheets("Tam")
        .Range("A1").ColumnWidth = MrgeWdth
        .Range("A1:C100").ClearContents
        .Range("A1").Resize(k, 2) = dArr
        Er = .Range("A65535").End(3).row
        .Range("A1:A" & Er).WrapText = True
        .Range("A1:A" & Er).EntireRow.AutoFit
        For I = 1 To Er
            DONG = .Range("B" & I).Value
            Ws.Range("E" & DONG).RowHeight = .Range("C" & I).RowHeight + 16.5 / 5
        Next I
        .Range("A1:C100").ClearContents
        .Range("A1:C100").ColumnWidth = 8.11
        Application.ScreenUpdating = True
    End With
End Sub
Sub Candongtieude()
    Dim sArr, dArr, I As Long, k As Long, Er As Long, DONG, Ws As Worksheet
    Dim c As Range, cc As Range, Ma As Range, MrgeWdth As Single
    Set Ws = ActiveSheet
    On Error Resume Next
    Application.ScreenUpdating = False
    With Ws
        sArr = .Range("E6:E" & .Range("U65000").End(3).row).Resize(, 17).Value
        Set c = .Range("E1")
        Set Ma = c.MergeArea
        For Each cc In Ma.Cells
            MrgeWdth = MrgeWdth + cc.ColumnWidth
        Next
    End With
    ReDim dArr(1 To UBound(sArr), 1 To 2)
    For I = 1 To UBound(sArr)
        If sArr(I, 17) <> Empty Then
            k = k + 1
            dArr(k, 1) = sArr(I, 1): dArr(k, 2) = sArr(I, 17)
        End If
    Next I
    With Sheets("Tam")
        .Range("A1").ColumnWidth = MrgeWdth
        .Range("A1:C100").ClearContents
        .Range("A1").Resize(k, 2) = dArr
        Er = .Range("A65535").End(3).row
        .Range("A1:A" & Er).WrapText = True
        .Range("A1:A" & Er).EntireRow.AutoFit
        For I = 1 To Er
            DONG = .Range("B" & I).Value
            If Ws.Range("E" & DONG) = Empty Then
                Ws.Range("E" & DONG).EntireRow.Hidden = True
            Else
                Ws.Range("E" & DONG).EntireRow.Hidden = False
                Ws.Range("E" & DONG).RowHeight = .Range("C" & I).RowHeight + 16.5 / 5
            End If
        Next I
        .Range("A1:C100").ClearContents
        .Range("A1:C100").ColumnWidth = 8.11
        Application.ScreenUpdating = True
    End With
End Sub
Sub XuatBBtoPdf()
    Dim sArr, dArr, I As Long, J As Long, k As Long, DK As Double
    Dim NameSh As String, TenSheet As String, CelNummber As String, Name As String, CelKtra As String, SttBB As Long
    On Error Resume Next
    With Sheets("Tam")
        sArr = .Range("T2", .Range("T65000").End(3)).Resize(, 5).Value
    End With
    NameSh = ActiveSheet.Name
    DK = False
    For I = 1 To UBound(sArr)
        If NameSh = sArr(I, 1) Then
            DK = True
            With Sheets(NameSh)
                CelNummber = .Range(sArr(I, 2)).Address
                Name = sArr(I, 3)
                CelKtra = .Range(sArr(I, 4)).Address
                SttBB = sArr(I, 5)
                TenSheet = NameSh
            End With
            Exit For
        End If
    Next I
    If DK = True Then
        If sArr(I, 2) <> Empty Then
            NameSh = ActiveSheet.Name
            Select Case NameSh
                Case Is = "BienbanCVXD": Call BBNTbdf.Show
                Case Is = "BienbanHT": Call BBNTHTbdf.Show
            End Select
        Else
            ActiveSheet.ExportAsFixedFormat 0, ThisWorkbook.Path & "\" & Name
        End If
    Else
        MsgboxUni VNI("Sheets(" & NameSh & ") kho|fffd|ng co|fffd| ch|fffd||fffd|c na|fffd|ng xua|fffd|t file ra Pfd./" & Chr(10) & "Ba|fffd|n kie|fffd|m tra la|fffd|i....."), vbInformation, VNI("Tho|fffd|ng ba|fffd|o")
    End If
End Sub
Sub ChenBKL()
    Dim rng As Range, I As Long, J As Long, k As Long, tmp, Tam
    Dim Er As Long, R As Long, m As Long, id As Long, Rs As Long
    Dim Ws As Worksheet, FColl As Long, EColl As Long, Col As Long
    Dim NameSheet As String, NameTable As String, RowNumber As Long, ERowNumber As Long
    On Error Resume Next
    Application.ScreenUpdating = False
    Set Ws = ActiveSheet
    With Ws
        NameTable = .Range("Y2"): NameSheet = .Range("W2"): RowNumber = .Range("W3"): ERowNumber = .Range("W4")
        If NameSheet = "Dulieucotthep" Then
            id = 5: Rs = id + 1
        Else
            id = 3: Rs = id + 2
        End If
        FColl = .Cells(RowNumber, 1).End(xlToRight).Column: EColl = .Cells(RowNumber, 100).End(xlToLeft).Column
        .Range("F" & RowNumber & ":F" & ERowNumber).EntireRow.Hidden = False
        .Range(.Cells(RowNumber + 1, FColl), .Cells(ERowNumber, EColl)).ClearContents
        For m = FColl To EColl
            If .Cells(RowNumber, m) <> Empty Then
                If Tam = Empty Then
                    Tam = m
                Else
                    Tam = Tam & ";" & m
                End If
            End If
        Next m
        k = RowNumber
        With Sheets(NameSheet)
            Col = .Cells(Rs, 100).End(xlToLeft).Column
            R = .Range("B65535").End(3).row
            Set rng = .Range("B1", .Range("B65535").End(3))
            Er = Application.Match(NameTable, rng, 0)
            tmp = Split(Tam, ";")
            For I = Er + id To R
                If .Cells(I, 2).Value = Empty Then Exit For
                k = k + 1
                For J = 1 To Col
                    Ws.Cells(k, Val(tmp(J - 1))) = .Cells(I, J)
                Next J
            Next I
        End With
        .Range("F" & RowNumber & ":F" & ERowNumber).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
    End With
    Application.ScreenUpdating = True
End Sub
Sub AddBreaks()
    Dim Ws As Worksheet, RowNumber As Long, ERowNumber As Long, RowCount As Long
    Dim tRowHei As Double, DeltaRowHei As Double, fCurr As Long, Er As Long, lr As Long, fP As Long
    On Error GoTo Thoat
    Set Ws = ActiveSheet
    RowNumber = Ws.Range("W3") + 1: ERowNumber = Ws.Range("W4")
    tRowHei = 17.5
    lr = Ws.Range("F" & ERowNumber).End(3).row
    Ws.Range("F" & RowNumber & ":F" & ERowNumber).RowHeight = tRowHei
    Ws.Range("F" & RowNumber & ":F" & ERowNumber).SpecialCells(xlCellTypeBlanks).EntireRow.Hidden = True
    ActiveWindow.View = xlPageBreakPreview
    fP = Ws.HPageBreaks.Count
    fCurr = ActiveSheet.HPageBreaks(fP).Location.row
    Er = Ws.Range("E" & Rows.Count).End(xlUp).row
    RowCount = lr - RowNumber
    If fCurr > Er - 17 And fCurr < Er + 17 Then
        DeltaRowHei = Ws.Range("E" & Er - 17 & ":E" & Er).Height / RowCount
        Ws.Range("F" & RowNumber & ":F" & lr).RowHeight = tRowHei + DeltaRowHei
    End If
Thoat:
    ActiveWindow.View = xlNormalView
End Sub
Sub Xuatnhatky_pdf()
    Dim Ws As Worksheet
    Sheets("GhiNhatky").Select
    Set Ws = ActiveSheet
    ActiveSheet.ExportAsFixedFormat 0, ThisWorkbook.Path & "\" & "Nhat ky thi cong"
End Sub
Sub AndongBB(ByVal sCell As Range, ByVal eCell As Range)
    If sCell.Value = Empty Then
        eCell.EntireRow.Hidden = True
    Else
        eCell.EntireRow.Hidden = False
    End If
End Sub
Attribute VB_Name = "Sub_FixRow"
Sub FixRow(ByVal rng As Range)
    Dim Ws As Worksheet
    Dim I As Long, cell As Range, MrgeWdth As Single, Ma As Range
    Dim WithCellPaste As Long, ColPaste As Long, RowPaste As Long, CellPaste As Range, Diff As Single
    On Error Resume Next
    Diff = 0.75
    Set Ws = rng.Worksheet
    ColPaste = Ws.Columns.Count
    For I = 1 To rng.Count
        If rng(I) <> Empty Then
            Set Ma = rng(I).MergeArea
            For Each cell In Ma
                MrgeWdth = MrgeWdth + cell.ColumnWidth + Diff
            Next cell
            Ma.RowHeight = 16.5
            RowPaste = Ma.row
            Set CellPaste = Cells(RowPaste, ColPaste)
            WithCellPaste = CellPaste.ColumnWidth
            CellPaste.ColumnWidth = MrgeWdth
            CellPaste = Ma.Value
            rng(I, 1).Copy
            CellPaste.PasteSpecial xlPasteFormats
            CellPaste.WrapText = True
            CellPaste.EntireRow.AutoFit
            Ma.RowHeight = CellPaste.RowHeight + 16.5 / 3
            CellPaste.Clear
            CellPaste.ColumnWidth = WithCellPaste
        End If
    Next I
End Sub
Sub Dontrangbia()
    Application.ScreenUpdating = False
    On Error Resume Next
    With Sheets("Bia")
        FixRow .Range("I28"): FixRow .Range("I29"): FixRow .Range("I30"): FixRow .Range("I31")
        FixRow .Range("I37"): FixRow .Range("I38"): FixRow .Range("I39")
        For Each rng In [Q28:Q30]
            If rng.Value <> "" Then
                rng.EntireRow.Hidden = False
            Else
                rng.EntireRow.Hidden = True
            End If
        Next rng
        .PageSetup.Zoom = 100
        ActiveWindow.View = 2
        '.VPageBreaks(1).DragOff Direction:=xlToRight, RegionIndex:=1
        .HPageBreaks(1).DragOff Direction:=xlDown, RegionIndex:=1
        ActiveWindow.View = 1
    End With
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "Tach"
Option Explicit
Sub TachListBBCV()
    Dim sArr(), dArr(), I As Long, k As Long
    Dim sRng As Range, fRng As Range
On Error Resume Next
Set sRng = Sheets("TCNT").Range("A3:B" & Sheets("TCNT").Range("A65535").End(3).row)
Set fRng = Sheets("KQTN").Range("A3:B" & Sheets("KQTN").Range("A65535").End(3).row)
With Sheets("ListBBCV")
    If .Range("A4") = Empty Then GoTo Thoat
    sArr = .Range("A4", .Range("A65535").End(3)).Resize(, 16).Value
End With
ReDim dArr(1 To UBound(sArr), 1 To 13)
For I = 1 To UBound(sArr)
    k = k + 1
    dArr(k, 1) = k
    dArr(k, 2) = sArr(I, 4)                             'NDCV
    dArr(k, 3) = sArr(I, 5)                             '"VTXD"
    dArr(k, 4) = TachgioBB((sArr(I, 6)), 1)                'GioNB_Batdau
    dArr(k, 5) = TachgioBB((sArr(I, 6)), 2)               'GioNB_Ketthuc
    dArr(k, 6) = Doingay(sArr(I, 7))                    ' Ngay_Noibo
    dArr(k, 7) = Doingay(sArr(I, 8))                    ' Ngay_PYCNT
    dArr(k, 8) = TachgioBB((sArr(I, 9)), 1)               ' GioCV_Batdau
    dArr(k, 9) = TachgioBB((sArr(I, 9)), 2)               'GioCV_Ketthuc
    dArr(k, 10) = Doingay(sArr(I, 10))                  ' Ngay_CV
    dArr(k, 11) = TieuchuanNT((sArr(I, 11)), sRng, 2)          'Tieuchuan_NT
    dArr(k, 12) = TieuchuanTN((sArr(I, 12)), fRng, 2)
    dArr(k, 13) = sArr(I, 15)
Next I
With Sheets("ListCVXD(ToWord)")
    If .Range("A65535").End(3).row > 2 Then
        With .Range("A2:M" & .Range("A65535").End(3).row + 1)
            .ClearContents
            .Borders.LineStyle = xlNone
        End With
    End If
    If k Then
        .Range("A2").Resize(k, 13) = dArr
        .Range("B2:M" & .Range("A65535").End(3).row + 1).Sort Key1:=.[M2]
        With .Range("A2").Resize(k, 13)
            .Borders.LineStyle = xlContinuous
            .Borders.ThemeColor = 10
            .Borders(xlInsideHorizontal).LineStyle = xlNone
        End With
    End If
End With
Thoat:
End Sub
Sub TachListHTHM()
    Dim sArr(), dArr(), I As Long, k As Long
    Dim sRng As Range, fRng As Range
    On Error Resume Next
    Set sRng = Sheets("TCNT").Range("A3:B" & Sheets("TCNT").Range("A65535").End(3).row)
    Set fRng = Sheets("KQTN").Range("A3:B" & Sheets("KQTN").Range("A65535").End(3).row)
    With Sheets("ListBBHT")
        If .Range("A4") = Empty Then GoTo Thoat
        sArr = .Range("A4", .Range("A65535").End(3)).Resize(, 16).Value
    End With
    ReDim dArr(1 To UBound(sArr), 1 To 13)
    For I = 1 To UBound(sArr)
        k = k + 1
        dArr(k, 1) = k
        dArr(k, 2) = sArr(I, 4)                             'NDCV
        dArr(k, 3) = sArr(I, 5)                             '"VTXD"
        dArr(k, 4) = TachgioBB((sArr(I, 6)), 1)                'GioNB_Batdau
        dArr(k, 5) = TachgioBB((sArr(I, 6)), 2)               'GioNB_Ketthuc
        dArr(k, 6) = Doingay(sArr(I, 7))                    ' Ngay_Noibo
        dArr(k, 7) = Doingay(sArr(I, 8))                    ' Ngay_PYCNT
        dArr(k, 8) = TachgioBB((sArr(I, 9)), 1)               ' GioCV_Batdau
        dArr(k, 9) = TachgioBB((sArr(I, 9)), 2)               'GioCV_Ketthuc
        dArr(k, 10) = Doingay(sArr(I, 10))                  ' Ngay_CV
        dArr(k, 11) = TieuchuanNT((sArr(I, 11)), sRng, 2)          'Tieuchuan_NT
        dArr(k, 12) = TieuchuanTN((sArr(I, 12)), fRng, 2)
        dArr(k, 13) = sArr(I, 15)
    Next I
    With Sheets("ListHTHM(ToWord)")
    If .Range("A65535").End(3).row > 2 Then
        With .Range("A2:M" & .Range("A65535").End(3).row + 1)
            .ClearContents
            .Borders.LineStyle = xlNone
        End With
    End If
        If k Then
            .Range("A2").Resize(k, 13) = dArr
            .Range("B2:M" & .Range("A65535").End(3).row + 1).Sort Key1:=.[M2]
            With .Range("A2").Resize(k, 13)
                .Borders.LineStyle = xlContinuous
                .Borders.ThemeColor = 10
                .Borders(xlInsideHorizontal).LineStyle = xlNone
            End With
        End If
    End With
Thoat:
End Sub

Attribute VB_Name = "TachFile"
Sub Tach_Thinghiem()
'Note: Tach list thi nghiem ra file moi
    Dim sArr(), dArr, I As Long, J As Long, k As Long
On Error Resume Next
With Sheets("ListTN")
    sArr = .Range("A4", .Range("A65000").End(3)).Resize(, 7).Value
End With
ReDim dArr(1 To UBound(sArr), 1 To 6)
For I = 1 To UBound(sArr)
    k = k + 1
    dArr(k, 1) = k
    dArr(k, 2) = sArr(I, 3): dArr(k, 3) = sArr(I, 4)
    dArr(k, 4) = sArr(I, 5): dArr(k, 5) = sArr(I, 6)
Next I
With Sheets("Thinghiem")
    With .Range("A16:F" & .Range("A65535").End(3).row + 1)
        .ClearContents
        .Borders.LineStyle = xlNone
    End With
    If k Then
        .Range("A16").Resize(k, 6) = dArr
        With .Range("A16").Resize(k, 6)
            .Borders.LineStyle = xlContinuous
            .Borders.ThemeColor = 10
            .Borders(xlInsideHorizontal).LineStyle = xlNone
        End With
    End If
End With
End Sub
Public Sub TachFileThinghiem()
    Dim ShMain As Worksheet
    Dim WbMain As Workbook, rng As Range, sh As Worksheet
    Dim FileSaveName As String, FileName As String
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False
    Application.SheetsInNewWorkbook = 1
    Set WbMain = ThisWorkbook
    Set ShMain = WbMain.Sheets("Thinghiem")
    NameFile = ShMain.Name
    Call Tach_Thinghiem
    Set rng = ShMain.Range("A1:A" & ShMain.Range("A65535").End(3).row).Resize(, 6)
    Pth = ActiveWorkbook.Path
    FileSaveName = Application.GetSaveAsFilename(InitialFileName:=NameFile, FileFilter:="Excel Wowkbook (*.xlsx),*.xlsx", Title:="Luu tep tin")
    If FileSaveName <> "False" Then
        With Workbooks.Add
            Set sh = .Sheets(1)
            sh.Name = ShMain.Name
            ShMain.Range("A1", rng).SpecialCells(12).Copy
            sh.Range("A1").PasteSpecial xlPasteColumnWidths
            sh.Range("A1").PasteSpecial xlPasteValues
            sh.Range("A1").PasteSpecial xlPasteFormats
            ActiveWorkbook.SaveAs FileName:=FileSaveName
            ActiveWorkbook.Close False
        End With
    End If
    Application.CutCopyMode = False
    Application.DisplayAlerts = True
    Application.ScreenUpdating = True
End Sub
Public Sub TachFile_ListBBCVXD()
    Dim ShMain As Worksheet
    Dim WbMain As Workbook, rng As Range, sh As Worksheet
    Dim FileSaveName As String, FileName As String
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False
    Application.SheetsInNewWorkbook = 1
    Set WbMain = ThisWorkbook
    Set ShMain = WbMain.Sheets("ListCVXD(ToWord)")
    NameFile = ShMain.Name
    Call TachListBBCV
    Set rng = ShMain.Range("A1:A" & ShMain.Range("A65535").End(3).row).Resize(, 13)
    Pth = ActiveWorkbook.Path
    FileSaveName = Application.GetSaveAsFilename(InitialFileName:=NameFile, FileFilter:="Excel Wowkbook (*.xlsx),*.xlsx", Title:="Luu tep tin")
    If FileSaveName <> "False" Then
        With Workbooks.Add
            Set sh = .Sheets(1)
            sh.Name = ShMain.Name
            ShMain.Range("A1", rng).SpecialCells(12).Copy
            sh.Range("A1").PasteSpecial xlPasteColumnWidths
            sh.Range("A1").PasteSpecial xlPasteValues
            sh.Range("A1").PasteSpecial xlPasteFormats
            ActiveWorkbook.SaveAs FileName:=FileSaveName
            ActiveWorkbook.Close False
        End With
    End If
    Application.CutCopyMode = False
    Application.DisplayAlerts = True
    Application.ScreenUpdating = True
End Sub
Public Sub TachFile_ListBBHTHM()
    Dim ShMain As Worksheet
    Dim WbMain As Workbook, rng As Range, sh As Worksheet
    Dim FileSaveName As String, FileName As String
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False
    Application.SheetsInNewWorkbook = 1
    Set WbMain = ThisWorkbook
    Set ShMain = WbMain.Sheets("ListHTHM(ToWord)")
    NameFile = ShMain.Name
    Call TachListHTHM
    Set rng = ShMain.Range("A1:A" & ShMain.Range("A65535").End(3).row).Resize(, 13)
    Pth = ActiveWorkbook.Path
    FileSaveName = Application.GetSaveAsFilename(InitialFileName:=NameFile, FileFilter:="Excel Wowkbook (*.xlsx),*.xlsx", Title:="Luu tep tin")
    If FileSaveName <> "False" Then
        With Workbooks.Add
            Set sh = .Sheets(1)
            sh.Name = ShMain.Name
            ShMain.Range("A1", rng).SpecialCells(12).Copy
            sh.Range("A1").PasteSpecial xlPasteColumnWidths
            sh.Range("A1").PasteSpecial xlPasteValues
            sh.Range("A1").PasteSpecial xlPasteFormats
            ActiveWorkbook.SaveAs FileName:=FileSaveName
            ActiveWorkbook.Close False
        End With
    End If
    Application.CutCopyMode = False
    Application.DisplayAlerts = True
    Application.ScreenUpdating = True
End Sub
Public Sub LuuFileMoi()
    Dim FileSaveName As String, FileName As String
    NameFile = "Ho so nghiem thu"
    FileSaveName = Application.GetSaveAsFilename(InitialFileName:=NameFile, FileFilter:="Excel Wowkbook (*.xlsx),*.xlsx", Title:="Luu tep tin")
    If FileSaveName <> "False" Then
        ActiveWorkbook.SaveAs FileName:=NameFile
    End If
End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Private Sub Workbook_Open()
        On Error Resume Next
    Application.StatusBar = "                              ------***------" & VNI(" Co|fffd|ng ty TNHH Xa|fffd|y d|fffd||fffd|ng Gia Lo|fffd|c Khang - Pho|fffd|ng TNVL & K|fffd|CLCT LAS XD 1391") & " ------***------"
    Sheets("Nhattrinh").Select
End Sub


Attribute VB_Name = "Thoitiet"
Option Explicit

Sub OpenWebPage()
      On Error GoTo loi
      ActiveWorkbook.FollowHyperlink "https://www.accuweather.com/vi/vn/phan-rang-thap-cham/355452/november-weather/355452?monyr=11/1/2017&view=table", NewWindow:=True
      Exit Sub
loi:       MsgBox "Ban co chac la da mo Internet len chua ?", vbQuestion, "Hoi"
End Sub
Attribute VB_Name = "Weather"
Sub ShowURL()
    Dim rng As Object, cel As Range
Set rng = Range("B2:B583")
If TypeOf rng Is Range Then
    For Each cel In rng
        If cel.Hyperlinks.Count Then cel.Offset(, 1).Value = cel.Hyperlinks(1).Address
    Next
End If
End Sub
Sub GetdatawebAccuweather(ByVal Tram As String, fDate As Date, eDate As Date)
    Application.ScreenUpdating = False
    Dim hrq As Object, html As Object, url As String, Dated As Date, row As Object, cell As Object, a As Object, reg As Object, Str As String, id As String
    Dim I As Long, J As Long, k As Long, nmonth As Long, wf As WorksheetFunction, url2 As String, url3 As String, id2 As String, lcal As String
    Dim dArr(), R As Long
    On Error Resume Next
    Set wf = WorksheetFunction: Set hrq = CreateObject("msxml2.xmlhttp"): Set html = CreateObject("htmlfile")
    url = "https://www.accuweather.com/vi/vn/thai-binh/356177/january-weather/356177?monyr="
    R = Sheet2.Range("H" & Rows.Count).End(xlUp).row + 1
    If R > 5 Then Sheet2.Range("A5:L" & R).Clear
    R = eDate - fDate + 1:        ReDim dArr(1 To R, 1 To 9)
    With hrq
        .Open "POST", "https://www.accuweather.com/vi/search-locations", False
        .setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
        .send "s=" & Tram
        Do While .readystate <> 4
            DoEvents
        Loop
        html.body.innerhtml = .responsetext
        'MsgBox InStr(1, .responsetext, Tram)
    End With
    Dim RX As Object
    Set RX = CreateObject("vbscript.regexp")
    RX.Pattern = "^(?:https://www.accuweather.com)/.+/(\w+)/[^\/]+/(\w+)$": RX.Global = True
    For Each a In html.getelementsbytagname("a")
        If RX.Test(a.href) And (a.innertext Like "*" & Tram & "*" Or a.innertext Like "*" & Split(Tram, ",")(0) & "*") Then '
            id = RX.Replace(a.href, "$1")
            id2 = RX.Replace(a.href, "$2")
        End If
    Next
    RX.Global = True
    RX.Pattern = "\/\d+"
    url2 = Replace(Replace(RX.Replace(url, "@@"), "@@", "/" & id, , 1), "@@", "/" & id2)
    For nmonth = 0 To DateDiff("m", wf.EoMonth(fDate, -1) + 1, wf.EoMonth(eDate, 0) + 1)
        url3 = url2 & Format(wf.eDate(fDate, nmonth), "m/d/yyyy") & "&view=table"
        With hrq
            .Open "GET", url3, False
            .send
            Do While .readystate <> 4
                DoEvents
            Loop
            html.body.innerhtml = .responsetext
        End With
        For Each row In html.getelementsbytagname("tbody")(0).Rows
            Dated = DateValue(Split(Trim(row.Cells(0).innertext), " ")(1) & "/" & Year(wf.eDate(fDate, nmonth)))
            If Dated >= fDate And Dated <= eDate Then
                I = I + 1: J = 0: k = k + 1
                For Each cell In row.Cells
                    J = J + 1
                    dArr(I, J) = cell.innertext:
                Next
                dArr(I, 7) = Dated
                dArr(I, 5) = Accuweather(dArr(I, 2), 1)
                dArr(I, 8) = Accuweather(dArr(I, 3), 2)
                dArr(I, 9) = Dayoff(dArr(I, 7), dArr(I, 3))
            End If
        Next
    Next nmonth
    Sheet2.Range("A5").Resize(k, 9) = dArr
    Sheet2.Range("A5").Resize(k, 9).Borders.LineStyle = 1
    Set hrq = Nothing:    Set html = Nothing
    Application.ScreenUpdating = True
    MsgBox "Done!"
    Set RX = Nothing
End Sub
'******************************************************************************************************************************
Function Accuweather(ByVal txt As String, Choice As Long) As String
    Dim aTmp, I As Long, Temp_Max As Long, Temp_Min As Long, Temp As Long, Amount_rain As Double
    Dim Str As String
    If Len(txt) Then
        If Choice = 1 Then
            aTmp = Split(txt, "/")
            If UBound(aTmp) > 0 Then
                Temp_Max = Val(aTmp(0)): Temp_Min = Val(aTmp(1)): Temp = (Temp_Max + Temp_Min) / 2
                Select Case Temp_Max
                    Case 40 To 50
                        'Troi nang dac biet gay gat
                        Str = "Tr" & ChrW$(7901) & "i n" & ChrW$(7855) & "ng n" & ChrW$(243) & "ng " & _
                                ChrW$(273) & ChrW$(7863) & "c bi" & ChrW$(7879) & "t gay g" & ChrW$(7855) & "t"
                    Case 38 To 39
                        'Troi nang gat
                        IStr = "Tr" & ChrW$(7901) & "i n" & ChrW$(7855) & "ng n" & ChrW$(243) & "ng g" & ChrW$(7855) & "t"
                    Case 36 To 37
                        'Troi nang nong
                        Str = "Tr" & ChrW$(7901) & "i n" & ChrW$(7855) & "ng n" & ChrW$(243) & "ng"
                    Case 26 To 35
                        'Troi nang dep
                        Str = "Tr" & ChrW$(7901) & "i " & "n" & ChrW$(7855) & "ng" & ChrW$(273) & ChrW$(7865) & "p"
                End Select
                '----------------------------------------------------------------------
                Select Case Temp
                    Case 23 To 25
                        Str = "Tr" & ChrW$(7901) & "i m" & ChrW$(225) & "t"
                    Case 21 To 22
                        Str = "Tr" & ChrW$(7901) & "i l" & ChrW$(7841) & "nh"
                    Case 16 To 20
                        Str = "Tr" & ChrW$(7901) & "i r" & ChrW$(233) & "t"
                    Case 14 To 15
                        Str = "Tr" & ChrW$(7901) & "i r" & ChrW$(233) & "t " & ChrW$(273) & ChrW$(7853) & "m"
                    Case Is <= 13
                        Str = "Tr" & ChrW$(7901) & "i r" & ChrW$(233) & "t h" & ChrW$(7841) & "i"
                End Select
            End If
        Else
            Amount_rain = Val(txt)
            Select Case Amount_rain
                Case Is < 0.5
                    Str = "Tr" & ChrW$(7901) & "i kh" & ChrW$(244) & "ng m" & ChrW$(432) & "a"
                Case 0.5 To 9.999
                    Str = "Tr" & ChrW$(7901) & "i m" & ChrW$(432) & "a nh" & ChrW$(7887)
                Case 10 To 49.99
                    Str = "Tr" & ChrW$(7901) & "i m" & ChrW$(432) & "a v" & ChrW$(7915) & "a"
                Case 50 To 100
                    Str = "Tr" & ChrW$(7901) & "i m" & ChrW$(432) & "a to"
                Case Is > 100
                    Str = "Tr" & ChrW$(7901) & "i r" & ChrW$(7845) & "t to"
            End Select
        End If
        If Len(Str) Then Accuweather = Str
    End If
End Function
Function Dayoff(ByVal cDay As Date, Amount_rain) As String
    Dim Dated As Date, DateAL As Date, fDateAL As Date, eDateAL As Date
    Dim Str As String
    DateAL = DateSerial(Year(cDay), 1, 1): fDateAL = DateAL - 7: eDateAL = DateAL + 7
    If Month(cDay) <= 4 Then
        Dated = TransLu(Day(cDay), Month(cDay), Year(cDay))
        If Dated >= fDateAL And Dated <= eDateAL Then
            Str = "T" & ChrW$(7871) & "t nguy" & ChrW$(234) & "n " & ChrW$(273) & ChrW$(225) & "n": GoTo Ketthuc
        End If
        If Dated = DateSerial(Year(cDay), 3, 10) Then
            Str = "Gi" & ChrW$(7895) & " t" & ChrW$(7893) & " H" & ChrW$(249) & "ng V" & ChrW$(432) & ChrW$(417) & "ng": GoTo Ketthuc
        End If
    End If
    If cDay = DateSerial(Year(cDay), 1, 1) Then
        Str = "T" & ChrW$(7871) & "t d" & ChrW$(432) & ChrW$(417) & "ng l" & ChrW$(7883) & "ch": GoTo Ketthuc
        GoTo Ketthuc
    End If
    If cDay = DateSerial(Year(cDay), 4, 30) Then
        Str = "Gi" & ChrW$(7843) & "i ph" & ChrW$(243) & "ng Mi" & ChrW$(7873) & "n Nam": GoTo Ketthuc
    End If
    If cDay = DateSerial(Year(cDay), 5, 1) Then
        Str = "Qu" & ChrW$(7889) & "c t" & ChrW$(7871) & " lao " & ChrW$(273) & ChrW$(7897) & "ng": GoTo Ketthuc
    End If
    If cDay = DateSerial(Year(cDay), 9, 2) Then
        Str = "Qu" & ChrW$(7889) & "c Kh" & ChrW$(225) & "nh": GoTo Ketthuc
    End If
    If Len(Str) = 0 Then
        Amount_rain = Val(Amount_rain)
        If Amount_rain >= 10 Then Str = "C" & ChrW$(244) & "ng tr" & ChrW$(236) & "nh ngh" & ChrW$(7881) & " thi c" & ChrW$(244) & "ng"
    End If
Ketthuc:
    If Len(Str) Then Dayoff = Str
End Function

Attribute VB_Name = "basAddPictrue"
Option Explicit
'************************************************************************************
Private Type PointAPI
    X As Long
    Y As Long
End Type
Private Type MOUSEHOOKSTRUCT
    pt As PointAPI
    hwnd As Long
    wHitTestCode As Long
    dwExtraInfo As Long
End Type
'************************************************************************************
#If VBA7 Then
Private Declare PtrSafe Function FindWindow Lib "user32" _
                Alias "FindWindowA" ( _
                ByVal lpClassName As String, _
                ByVal lpWindowName As String) As Long
#Else
Private Declare Function FindWindow Lib "user32" _
                Alias "FindWindowA" ( _
                ByVal lpClassName As String, _
                ByVal lpWindowName As String) As Long
#End If
'-------------
#If VBA7 Then
Private Declare PtrSafe Function GetWindowLong Lib "user32.dll" _
                Alias "GetWindowLongA" ( _
                ByVal hwnd As Long, _
                ByVal nIndex As Long) As Long
#Else
Private Declare Function GetWindowLong Lib "user32.dll" _
                Alias "GetWindowLongA" ( _
                ByVal hwnd As Long, _
                ByVal nIndex As Long) As Long
#End If
'-------------
#If VBA7 Then
Private Declare PtrSafe Function SetWindowsHookEx Lib "user32" _
                Alias "SetWindowsHookExA" ( _
                ByVal idHook As Long, _
                ByVal lpfn As Long, _
                ByVal hmod As Long, _
                ByVal dwThreadId As Long) As Long
#Else
Private Declare PtrSafe Function SetWindowsHookEx Lib "user32" _
                Alias "SetWindowsHookExA" ( _
                ByVal idHook As Long, _
                ByVal lpfn As Long, _
                ByVal hmod As Long, _
                ByVal dwThreadId As Long) As Long
#End If
'-----------
#If VBA7 Then
Private Declare PtrSafe Function CallNextHookEx Lib "user32" ( _
                ByVal hHook As Long, _
                ByVal nCode As Long, _
                ByVal wParam As Long, _
                ByRef lParam As Any) As Long
#Else
Private Declare Function CallNextHookEx Lib "user32" ( _
                ByVal hHook As Long, _
                ByVal nCode As Long, _
                ByVal wParam As Long, _
                ByRef lParam As Any) As Long
#End If
'-------------
#If VBA7 Then
Private Declare PtrSafe Function UnhookWindowsHookEx Lib "user32" ( _
                ByVal hHook As Long) As Long
#Else
Private Declare Function UnhookWindowsHookEx Lib "user32" ( _
                ByVal hHook As Long) As Long
#End If
'------------
#If VBA7 Then
Private Declare PtrSafe Function WindowFromPoint Lib "user32" ( _
                ByVal xPoint As Long, _
                ByVal yPoint As Long) As Long
#Else
Private Declare Function WindowFromPoint Lib "user32" ( _
                ByVal xPoint As Long, _
                ByVal yPoint As Long) As Long
#End If
'-----------
#If VBA7 Then
Private Declare PtrSafe Function GetCursorPos Lib "user32.dll" ( _
                ByRef lpPoint As PointAPI) As Long
#Else
Private Declare Function GetCursorPos Lib "user32.dll" ( _
                ByRef lpPoint As PointAPI) As Long
#End If
'************************************************************************************
Private Const WH_MOUSE_LL As Long = 14
Private Const WM_MOUSEWHEEL As Long = &H20A
Private Const HC_ACTION As Long = 0
Private Const GWL_HINSTANCE As Long = (-6)
    '************************************************************************************
Private mLngMouseHook As Long
Private mControlHwnd As Long
Private mbHook As Boolean
Private mCtl As MSForms.control
    '************************************************************************************
Sub HookControlScroll(ByVal Ctl As MSForms.control)
    Dim lngAppInst As Long
    Dim hwndUnderCursor As Long
    Dim tPT As PointAPI
    GetCursorPos tPT
    hwndUnderCursor = WindowFromPoint(tPT.X, tPT.Y)
    If mControlHwnd <> hwndUnderCursor Then
        UnhookControlScroll
        Set mCtl = Ctl
        mControlHwnd = hwndUnderCursor
        lngAppInst = GetWindowLong(mControlHwnd, GWL_HINSTANCE)
        If Not mbHook Then
            mLngMouseHook = _
                    SetWindowsHookEx(WH_MOUSE_LL, _
                    AddressOf MouseProc, _
                    lngAppInst, 0)
            mbHook = mLngMouseHook <> 0
        End If
    End If
End Sub
'************************************************************************************
Sub UnhookControlScroll()
    If mbHook Then
        Set mCtl = Nothing
        UnhookWindowsHookEx mLngMouseHook
        mLngMouseHook = 0
        mControlHwnd = 0
        mbHook = False
    End If
End Sub
'************************************************************************************
Private Function MouseProc( _
            ByVal nCode As Long, _
            ByVal wParam As Long, _
            ByRef lParam As MOUSEHOOKSTRUCT) As Long
    On Error GoTo ErrorHandler
    Dim Index As Long
    If (nCode = HC_ACTION) Then
        If WindowFromPoint(lParam.pt.X, lParam.pt.Y) = mControlHwnd Then
            If wParam = WM_MOUSEWHEEL Then
                MouseProc = True
                If lParam.hwnd > 0 Then
                    Index = -1
                Else
                    Index = 1
                End If
                Index = Index + mCtl.TopIndex
                If Index >= 0 Then
                    mCtl.TopIndex = Index
                End If
                Exit Function
            End If
        Else
            UnhookControlScroll
        End If
    End If
    MouseProc = CallNextHookEx( _
            mLngMouseHook, nCode, wParam, ByVal lParam)
    Exit Function
ErrorHandler:
    UnhookControlScroll
End Function

Attribute VB_Name = "basScreen"
Option Explicit

#If VBA7 Then
  Private Declare PtrSafe Function GetDC Lib "user32" (ByVal hwnd As Long) As LongPtr
  Private Declare PtrSafe Function GetDeviceCaps Lib "gdi32" (ByVal hDc As LongPtr, ByVal nIndex As Long) As Long
  Private Declare PtrSafe Function ReleaseDC Lib "user32" (ByVal hwnd As Long, ByVal hDc As LongPtr) As Long
#Else
  Private Declare Function GetDC Lib "user32" (ByVal hwnd As Long) As Long
  Private Declare Function GetDeviceCaps Lib "gdi32" (ByVal hDc As Long, ByVal nIndex As Long) As Long
  Private Declare Function ReleaseDC Lib "user32" (ByVal hwnd As Long, ByVal hDc As Long) As Long
#End If

Private Const HORZRES       As Long = 8
Private Const VERTRES       As Long = 10
Private Const LOGPIXELSX    As Long = 88
Private Const LOGPIXELSY    As Long = 90

Public Enum EnumScale
  vbTwips = 1     '|fffd|
  vbPoints        '|fffd||fffd|
  vbPixels        '|fffd||fffd||fffd||fffd|
  vbCharacters    '|fffd||5b7||fffd|
  vbInches        '|4e2||fffd||fffd|
  vbMillimeters   '|fffd||fffd||fffd||fffd|
  vbCentimeters   '|fffd||fffd||fffd||fffd|
End Enum

Public Property Get ScreenLogPixelsX() As Long
  #If VBA7 Then
    Dim hDc As LongPtr
  #Else
    Dim hDc As Long
  #End If
  hDc = GetDC(0)
  ScreenLogPixelsX = GetDeviceCaps(hDc, LOGPIXELSX)
  ReleaseDC 0, hDc
End Property

Public Property Get ScreenLogPixelsY() As Long
  #If VBA7 Then
    Dim hDc As LongPtr
  #Else
    Dim hDc As Long
  #End If
  hDc = GetDC(0)
  ScreenLogPixelsY = GetDeviceCaps(hDc, LOGPIXELSY)
  ReleaseDC 0, hDc
End Property

Public Property Get ScreenWidth() As Long
  #If VBA7 Then
    Dim hDc As LongPtr
  #Else
    Dim hDc As Long
  #End If
  hDc = GetDC(0)
  ScreenWidth = GetDeviceCaps(hDc, HORZRES)
  ReleaseDC 0, hDc
End Property

Public Property Get ScreenHeight() As Long
  #If VBA7 Then
    Dim hDc As LongPtr
  #Else
    Dim hDc As Long
  #End If
  hDc = GetDC(0)
  ScreenHeight = GetDeviceCaps(hDc, VERTRES)
  ReleaseDC 0, hDc
End Property

Public Function ScreenScaleX(ByVal Width As Single, Optional ByVal FromScale As EnumScale = vbPoints, Optional ByVal ToScale As EnumScale = vbPixels) As Single
  Const TWIPSPERINCH = 1440!
  Const TWIPSPERCENT = 567!
  Const TWIPSPERMILL = 56.7!
  Const TWIPSPERCHAR = 120!
  Const TWIPSPERPOIT = 20!
  If FromScale = ToScale Then
    ScreenScaleX = Width
  Else
    Select Case FromScale
      Case vbTwips
        Select Case ToScale
          Case vbPoints
            ScreenScaleX = Width / TWIPSPERPOIT
          Case vbPixels
            ScreenScaleX = Width / TWIPSPERINCH * ScreenLogPixelsX
          Case vbCharacters
            ScreenScaleX = Width / TWIPSPERCHAR
          Case vbInches
            ScreenScaleX = Width / TWIPSPERINCH
          Case vbMillimeters
            ScreenScaleX = Width / TWIPSPERMILL
          Case vbCentimeters
            ScreenScaleX = Width / TWIPSPERCENT
          Case vbTwips
            ScreenScaleX = Width
        End Select
      Case vbCentimeters
        ScreenScaleX = ScreenScaleX(Width * TWIPSPERCENT, vbTwips, ToScale)
      Case vbMillimeters
        ScreenScaleX = ScreenScaleX(Width * TWIPSPERMILL, vbTwips, ToScale)
      Case vbInches
        ScreenScaleX = ScreenScaleX(Width * TWIPSPERINCH, vbTwips, ToScale)
      Case vbPoints
        ScreenScaleX = ScreenScaleX(Width * TWIPSPERPOIT, vbTwips, ToScale)
      Case vbPixels
        ScreenScaleX = ScreenScaleX(Width * TWIPSPERINCH / ScreenLogPixelsX, vbTwips, ToScale)
      Case vbCharacters
        ScreenScaleX = ScreenScaleX(Width * TWIPSPERCHAR, vbTwips, ToScale)
    End Select
  End If
End Function

Public Function ScreenScaleY(ByVal Height As Single, Optional ByVal FromScale As EnumScale = vbPoints, Optional ByVal ToScale As EnumScale = vbPixels) As Single
  Const TWIPSPERINCH = 1440!
  Const TWIPSPERCENT = 567!
  Const TWIPSPERMILL = 56.7!
  Const TWIPSPERCHAR = 240!
  Const TWIPSPERPOIT = 20!
  
  If FromScale = ToScale Then
    ScreenScaleY = Height
  Else
    Select Case FromScale
      Case vbTwips
        Select Case ToScale
          Case vbPoints
            ScreenScaleY = Height / TWIPSPERPOIT
          Case vbPixels
            ScreenScaleY = Height / TWIPSPERINCH * ScreenLogPixelsY
          Case vbCharacters
            ScreenScaleY = Height / TWIPSPERCHAR
          Case vbInches
            ScreenScaleY = Height / TWIPSPERINCH
          Case vbMillimeters
            ScreenScaleY = Height / TWIPSPERMILL
          Case vbCentimeters
            ScreenScaleY = Height / TWIPSPERCENT
          Case vbTwips
            ScreenScaleY = Height
        End Select
      Case vbCentimeters
        ScreenScaleY = ScreenScaleY(Height * TWIPSPERCENT, vbTwips, ToScale)
      Case vbMillimeters
        ScreenScaleY = ScreenScaleY(Height * TWIPSPERMILL, vbTwips, ToScale)
      Case vbInches
        ScreenScaleY = ScreenScaleY(Height * TWIPSPERINCH, vbTwips, ToScale)
      Case vbPoints
        ScreenScaleY = ScreenScaleY(Height * TWIPSPERPOIT, vbTwips, ToScale)
      Case vbPixels
        ScreenScaleY = ScreenScaleY(Height * TWIPSPERINCH / ScreenLogPixelsY, vbTwips, ToScale)
      Case vbCharacters
        ScreenScaleY = ScreenScaleY(Height * TWIPSPERCHAR, vbTwips, ToScale)
    End Select
  End If
End Function

Public Property Get RangeWidth(ByVal Target As Range, Optional ByVal ScaleMode As EnumScale = vbPoints) As Single
  Dim I As Long, rngWidth As Single
  If Target Is Nothing Then Exit Property
  If Target.Count Then
    Set Target = Target.Cells(1)
    Set Target = Target.MergeArea
    For I = 1 To Target.Columns.Count
      rngWidth = rngWidth + Target.Cells(1, I).Width
    Next
    RangeWidth = ScreenScaleX(rngWidth, vbPoints, ScaleMode)
  End If
End Property

Public Property Get RangeHeight(ByVal Target As Range, Optional ByVal ScaleMode As EnumScale = vbPoints) As Single
  Dim I As Long, rngHeight As Single
  If Target Is Nothing Then Exit Property
  If Target.Count Then
    Set Target = Target.Cells(1)
    Set Target = Target.MergeArea
    For I = 1 To Target.Rows.Count
      rngHeight = rngHeight + Target.Cells(I, 1).Height
    Next
    RangeHeight = ScreenScaleY(rngHeight, vbPoints, ScaleMode)
  End If
End Property

Attribute VB_Name = "foxz"

Attribute VB_Name = "mdlMsgBox"
Option Explicit
'https://www.giaiphapexcel.com/forum/showthread.php?109175-T%E1%BA%B7ng-H%C3%A0m-MsgBox-Vi%E1%BB%87t-h%C3%B3a-font-Unicode-tuy%E1%BB%87t-%C4%91%E1%BA%B9p%21-%28Ph%E1%BA%A7n-2-32bit-64bit%29
'tac gia Hoang Trong Nhia
''------------------------------------------------------------------------

Private hHook As Long
'******************************************************************************************************************************
#If VBA7 And Win64 Then 'Office 64-bit
    Private Declare PtrSafe Function GetCurrentThreadId Lib "kernel32" () As Long
    Private Declare PtrSafe Function SetDlgItemText Lib "user32" Alias "SetDlgItemTextW" (ByVal hDlg As LongPtr, ByVal nIDDlgItem As LongPtr, ByVal lpString As String) As Long
    Private Declare PtrSafe Function SetWindowsHookEx Lib "user32" Alias "SetWindowsHookExA" (ByVal idHook As LongPtr, ByVal lpfn As LongPtr, ByVal hmod As LongPtr, ByVal dwThreadId As LongPtr) As Long
    Private Declare PtrSafe Function UnhookWindowsHookEx Lib "user32" (ByVal hHook As LongPtr) As Long
#Else ' Office 32-bit
    Private Declare Function GetCurrentThreadId Lib "kernel32" () As Long
    Private Declare Function SetDlgItemText Lib "user32" Alias "SetDlgItemTextW" (ByVal hDlg As Long, ByVal nIDDlgItem As Long, ByVal lpString As String) As Long
    Private Declare Function SetWindowsHookEx Lib "user32" Alias "SetWindowsHookExA" (ByVal idHook As Long, ByVal lpfn As Long, ByVal hmod As Long, ByVal dwThreadId As Long) As Long
    Private Declare Function UnhookWindowsHookEx Lib "user32" (ByVal hHook As Long) As Long
#End If
'******************************************************************************************************************************
Private Const WH_CBT = 5
Private Const HCBT_ACTIVATE = 5
''------------------------------------------------------------------------
Private Const IdOK = 1
Private Const IdCancel = 2
Private Const IdAbort = 3
Private Const IdRetry = 4
Private Const IdIgnore = 5
Private Const IdYes = 6
Private Const IdNo = 7
Private Const IdYesAll = 8
''------------------------------------------------------------------------
Private StrOK As String
Private StrCancel As String
Private StrAbort As String
Private StrRetry As String
Private StrIgnore As String
Private StrYes As String
Private StrNo As String
Private StrYesAll As String
'******************************************************************************************************************************

Private Function MsgBoxHookProc(ByVal lMsg As Long, ByVal wParam As Long, ByVal lParam As Long) As Long
    If lMsg = HCBT_ACTIVATE Then
        'De biet Charcode, dung ham ASCW("KyTu")
        StrOK = VNI("Cha|fffd|p nha|fffd|n")     'Chap nhan
        StrCancel = VNI("Hu|fffd|y bo|fffd|")       'Huy bo
        StrAbort = "&H" & ChrW$(7911) & "y ngang"                   'Huy ngang
        StrRetry = "&Th" & ChrW$(7917) & " l" & ChrW$(7841) & "i"   'Thu lai
        StrIgnore = "&B" & ChrW$(7887) & " qua"                     'Bo qua
        StrYes = "&C|fffd|"                                              'Co
        StrNo = "&Kh|fffd|ng"                                            'Khong
        StrYesAll = "C|fffd| &t" & ChrW$(7845) & "t c" & ChrW$(7843)     'Co tat ca
        ''------------------------------------------------------------------------
        SetDlgItemText wParam, IdOK, StrConv(StrOK, vbUnicode)
        SetDlgItemText wParam, IdCancel, StrConv(StrCancel, vbUnicode)
        SetDlgItemText wParam, IdAbort, StrConv(StrAbort, vbUnicode)
        SetDlgItemText wParam, IdRetry, StrConv(StrRetry, vbUnicode)
        SetDlgItemText wParam, IdIgnore, StrConv(StrIgnore, vbUnicode)
        SetDlgItemText wParam, IdYes, StrConv(StrYes, vbUnicode)
        SetDlgItemText wParam, IdNo, StrConv(StrNo, vbUnicode)
        SetDlgItemText wParam, IdYesAll, StrConv(StrYesAll, vbUnicode)
        ''------------------------------------------------------------------------
        UnhookWindowsHookEx hHook
    End If
    MsgBoxHookProc = False
End Function
'******************************************************************************************************************************

Function MyUniMsgBox(ByVal msgTitle As String, _
                     Optional msgText As String, _
                     Optional msgButtonType As MsoAlertButtonType, _
                     Optional msgIconType As MsoAlertIconType, _
                     Optional msgDefaultType As MsoAlertDefaultType) As VbMsgBoxResult
    ''---------------------------------------------------------------------------------------------------
    ''Cau truc: MyUniMsgBox TieuDe (bat buoc), [NoiDung], [KieuNutLenh], [KieuIcon], [KieuNutLenhMacDinh]
    ''---------------------------------------------------------------------------------------------------
    hHook = SetWindowsHookEx(WH_CBT, AddressOf MsgBoxHookProc, 0, GetCurrentThreadId)
    On Error Resume Next
    MyUniMsgBox = Assistant.DoAlert(msgTitle, _
                                    msgText, _
                                    msgButtonType, _
                                    msgIconType, _
                                    msgDefaultType, _
                                    msoAlertCancelDefault, _
                                    False)
    If Err.Number Then
        Err.Clear
        MyUniMsgBox = Assistant.DoAlert(msgTitle, _
                                        msgText, _
                                        msgButtonType, _
                                        msgIconType, _
                                        msoAlertDefaultFirst, _
                                        msoAlertCancelDefault, _
                                        False)
    End If
End Function
'******************************************************************************************************************************
'Khong thu tuc TestFontInRANGE trong VB6 (hoac Ver<7)
Sub TestFontInRANGE()
   'Test trong Excel
   MsgboxUni Range("B3").Value, vbInformation, Range("B4").Value
   MsgBox Range("B3").Value, vbInformation, _
          Range("B4").Value & " - Dung ham MsgBox cua VB/VBA thi loi"
End Sub

Sub TestFontTCVN3()
    'UNC la ham chuyen tu ma TCVN3 sang Unicode
   MsgboxUni UNC("C|fffd|ng ho|fffd| x|fffd| h|fffd|i ch|fffd| ngh|fffd|a Vi|fffd|t Nam"), vbInformation, _
             UNC("Chu|fffd|i |fffd||fffd|a v|fffd|o l|fffd| l|fffd| ki|fffd|u g|fffd| TCVN3")
End Sub

Sub TestFontVNI()
   'VNI la ham chuyen tu ma VNI sang Unicode
   MsgboxUni VNI("Co|fffd|ng hoa|fffd| xa|fffd| ho|fffd|i chu|fffd| ngh|fffd|a Vie|fffd|t Nam"), vbInformation, _
             VNI("Chuo|fffd|i |fffd||fffd|a va|fffd|o la|fffd| la|fffd| kie|fffd|u go|fffd| VNI")
   
End Sub


' InQuest injected base64 decoded content
' )^J)

INQUEST-PP=macro
