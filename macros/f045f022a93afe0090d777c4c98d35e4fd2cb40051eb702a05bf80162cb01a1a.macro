Attribute VB_Name = "Audacheck"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()
Application.Caption = ("Departamento Posventa, Audatex Espa|fffd|a")
Worksheets("Inicio").Select
ActiveWindow.DisplayWorkbookTabs = False
ActiveWindow.DisplayGridlines = False
ActiveWindow.DisplayHeadings = False
End Sub

Attribute VB_Name = "hoj_00_Audacheck"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_00_Grupos"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash01"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash02"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash03"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash04"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash05"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash06"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash07"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash08"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash09"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_dash11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_menu01"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_menu02"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_parametros01"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_parametros02"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_parametros03"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_parametros04"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "hoj_parametros05"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "mod_00Audacheck"
Sub Crear_Ficheros()

Limpiar
        
    hoj_00_Grupos.Activate
    Range("a1").Select
    Dim x As String
    Dim y As String
    Dim m As Variant
    Dim z As Long
    Dim t As Integer
    m = Str(Month(Now) - 1)
    a = Str(Year(Now))
    x = ActiveCell.Value
    
    Range("Parametros!ES1").Value = a
   
    Do Until x = Vac|fffd|o
    
    DisplayAlerts = False
    Application.ScreenUpdating = False
    
' Creamos una copia del archivo para los grupos
            y = Mid(x, 1, 32)
            ActiveWorkbook.SaveCopyAs Filename:="D:\" & "IAP " & y & " " & Application.WorksheetFunction.Proper(MonthName(m)) & a & ".xlsm"
            Workbooks.Open ("D:\IAP " & y & " " & Application.WorksheetFunction.Proper(MonthName(m)) & a & ".xlsm")
            Sheets("AudaCheck").Select
            ActiveSheet.Name = "AudaCheck " & y

' Filtramos la hoja por el CT que est|fffd| en la 8|fffd| columnas (columna H).
            Sheets("AudaCheck " & y).Select
            Columns("D:D").Select
            
' El criterio de filtrado es todos los valores diferentes al valor y
            Selection.AutoFilter Field:=4, Criteria1:="<>" & y
            
' Metemos en la variable z la |fffd|ltima fila de la tabla
            z = Cells(Rows.Count, 1).End(xlUp).Row
            
' Borramos las filas seleccionadas
            Rows("3:" & z).Select
            Selection.Delete Shift:=xlUp
            
' Por est|fffd|tica ocultamos la |fffd|ltima columna de la tabla, la de las URL
            Columns("BF:BF").Select
            Selection.EntireColumn.Hidden = True
            
' Borramos la columna C que es la del filtro aplicado
            Columns("D:D").Select
            Selection.Delete Shift:=xlUp
                      
' Por est|fffd|tica dejamos la hoja en el resultado final
            t = Cells(Rows.Count, 1).End(xlUp).Row
            Cells(t, 21).Select
            
'Ordeno descendentemente la columna Periodo
         
        ActiveWorkbook.Worksheets("AudaCheck " & y).AutoFilter.Sort.SortFields. _
        Clear
        ActiveWorkbook.Worksheets("AudaCheck " & y).AutoFilter.Sort.SortFields. _
        Add Key:=Range("F2"), SortOn:=xlSortOnValues, Order:=xlDescending, _
        DataOption:=xlSortTextAsNumbers
    With ActiveWorkbook.Worksheets("AudaCheck " & y).AutoFilter.Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
actualizar_datos_analisis
        
    ActiveWorkbook.Save
    ActiveWorkbook.Sheets("Grupos").Visible = xlSheetVeryHidden
    ActiveWorkbook.Sheets("plantillacias").Visible = xlSheetVeryHidden
    ActiveWindow.DisplayWorkbookTabs = False
    
    Workbooks("01-Plantilla AudaCheck v10.xlsm").Activate
    Workbooks("IAP " & y & " " & Application.WorksheetFunction.Proper(MonthName(m)) & a & ".xlsm").Close True

' Seleccionamos el siguiente informe t|fffd|cnico
            hoj_00_Grupos.Visible = xlSheetVisible
            hoj_00_Grupos.Select
            ActiveCell.Offset(1, 0).Select
            x = ActiveCell.Value

    Loop
    
Application.ScreenUpdating = True
MsgBox "La Macro ha finalizado" & Chr(13) & Chr(10) & Chr(10) & "Se han generado ficheros en D:\"

End Sub
Sub Limpiar()
' Completar las celdas de Enlaces
    hoj_00_Audacheck.Select
    Range("B2").Select
    rangomes = ActiveSheet.Cells(1048576, 2).End(xlUp).Row
    Range("A3").Select
    Selection.Copy
    Range("A4:A" & rangomes).Select
    ActiveSheet.Paste
    
    Range("X2:X" & rangomes).Select
    Selection.Replace What:="", Replacement:="-", LookAt:=xlWhole, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
        
    Range("AL3").Select
    ActiveCell.FormulaR1C1 = "=RC[-3]+RC[-1]"
    Selection.Copy
    Range("AL3:AL" & rangomes).Select
    Selection.PasteSpecial Paste:=xlPasteFormulas, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
        
    Range("BG3:BI3").Select
    Selection.Copy
    Range("BG4:BI" & rangomes).Select
    Selection.PasteSpecial Paste:=xlPasteFormulas, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
    
'Paso la plantilla de las compa|fffd||fffd|as
    Columns("C:C").Select
    Selection.Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("C3").Select
    ActiveCell.FormulaR1C1 = _
        "=IFERROR(VLOOKUP(RC[1],plantillacias!C[-2]:C[-1],2,0),RC[1])"
    Range("C3").Select
    Selection.AutoFill Destination:=Range("C3:C" & rangomes)
    Range("C3").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Copy

    Range("D3").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Columns("C:C").Select
    Application.CutCopyMode = False
    Selection.Delete Shift:=xlToLeft
    
' Antes de nada reemplazo los '0' y los '0%' por ''
    Columns("AI:BD").Select
    Range("AI2").Activate
    Selection.Replace What:="0", Replacement:="", LookAt:=xlWhole, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
        
    Columns("C:C").Select
    Range("C2").Activate
    Selection.Replace What:="0", Replacement:="", LookAt:=xlWhole, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    
    Range("C3:C" & rangomes).Select
    'Columns("C:C").Select
    'Range("C2").Activate
    Selection.Replace What:="", Replacement:="-", LookAt:=xlWhole, _
        SearchOrder:=xlByRows, MatchCase:=False, SearchFormat:=False, _
        ReplaceFormat:=False
    
    Columns("BG:BI").Select
    Range("BG2").Activate
    Selection.EntireColumn.Hidden = True
    
End Sub
Attribute VB_Name = "mod_01desp"
Sub Irreglas()
Worksheets("Reglas Aplicadas").Activate
End Sub
Sub Irgeneral()
Worksheets("General").Activate
End Sub
Sub Irporabonados()
Worksheets("Por Abonados").Activate
End Sub
Sub Irporreferencia()
Worksheets("Por Referencia interna").Activate
End Sub
Sub Irvolumencliente()
Worksheets("Volumen por cliente").Activate
End Sub
Sub Irinicio()
Worksheets("Inicio").Activate
End Sub
Sub Irresumenreglas()
Worksheets("Resumen Reglas").Activate
End Sub
Sub Irresumenkpi()
Worksheets("Resumen_KPI").Activate
End Sub
Sub IrInstrucciones()
Worksheets("Instrucciones").Activate
End Sub
Sub IrDatosaAnalizar()
Worksheets("Datos a analizar").Activate
End Sub
Sub IrEvolucion()
Worksheets("Seguimiento").Activate
End Sub
Sub IrReferencia()
Worksheets("Por Referencia").Activate
End Sub
Sub IrListado()
hoj_00_Audacheck.Activate
End Sub
Sub IrRentabilidad()
Worksheets("Rentabilidadmo").Activate
End Sub
Sub IrCuentaResultados()
Worksheets("Cuenta_Resultados").Activate
End Sub
Sub IrPintura()
Worksheets("Analisis_Pintura").Activate
End Sub
Attribute VB_Name = "mod_02ope"
Sub actualizar_datos_analisis()

'Actualizo las tablas din|fffd|micas con los nuevos datos cargados

Sheets("Parametros").Select
    Range("A2:A10000").Select
    Selection.ClearContents
    
    Range("C2").Select
    ActiveSheet.PivotTables("Talleres").PivotCache.Refresh
    Range("C2").Select
    rango3 = ActiveSheet.Cells(2, 3).End(xlDown).Row
    Range("C2:C" & rango3 - 1).Select
    Selection.Copy
    
    Range("A2").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    Range("E2:E10000").Select
    Selection.ClearContents
    
    Range("G2").Select
    ActiveSheet.PivotTables("referencias").PivotCache.Refresh
    
    Range("G2").Select
    rango4 = ActiveSheet.Cells(2, 7).End(xlDown).Row
    Range("G2:G" & rango4 - 1).Select
    Selection.Copy

    Range("E2").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    
Sheets("General").Select
Range("F3").Select

'Update para que introduzcan el valor de la pesta|fffd|a resumen
'celda_resumen = InputBox("A|fffd|o de los datos (por si no son 2018):", Default:="2018")

'Range("Parametros!ES1").Value = a 'celda_resumen

'MsgBox "Datos Actualizados"

End Sub
Sub Bot|fffd|ndeopci|fffd|n1_Haga_clic_en()

End Sub

Attribute VB_Name = "mod_03fin"
Sub imprimirpdf()

ActiveSheet.ExportAsFixedFormat Type:=xlTypePDF, _
Filename:="Informe del Check", _
 Quality:=xlQualityStandard, IncludeDocProperties:=True, _
 IgnorePrintAreas:=False, OpenAfterPublish:=True

End Sub


    


INQUEST-PP=macro
