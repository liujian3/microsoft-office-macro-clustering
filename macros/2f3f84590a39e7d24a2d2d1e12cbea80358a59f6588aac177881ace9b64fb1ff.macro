Attribute VB_Name = "Module1"
Public LastRowChartofAccount As Long, SRow As Long, SColumn As Long, EntryNo As Long, TotalsRow As Long
Public MyBook As Workbook, BeginningDate As Date, DExtn As String
Public LastJournalCode As String, LastTranNo As String, LastRecordDate As Date, SysCurrency As String
Public SheetName As String, DataSheetReturn As String, JcodeRow As Long, BeginPeriod As Long, AccountYear As Long
Public EventOff As Boolean, FormZoom As Long
Public CustNo As String, CustName As String, Address1 As String, Address2 As String, Address3 As String
Public CustContact As String, TelNo As String, DueDate As Date, DisRate As Double, DisAmount As Double, CustBalance As Double
Public TotalSum As Double, TotalAmount As Double, CustPO As String, InvDate As Date, InvNo As String, CustRowNo As Long
Public DelName As String, DelAddress1 As String, DelAddress2 As String, DelAddress3 As String, DelContact As String
Public SalesRep As String, ButtonNo As Long, DiscountRate As Double, PayTerm As String, Form6RowNo As Long, Form6TextNo As Long
Public InvStatus As String, RecRowA As Long, RecRowB As Long
Public SupplierBalance As Double, SupplierNo As String, SupplierName As String, SupplierRowNo As Long, PONo As String, OSAmt As Double, Remarks As String
Public DebtorAcct As Variant, SalesDisAcct As Variant, CreditorAcct As Variant, BankAcct As Variant
Public Form15RowNo As Long, Form15TextNo As Long, PartStartRow As Long, PartEndRow As Long
Public OldForm As String, FileStatus As String
Public StockNo As String, StockNoExist As String, AuthorStatus As Boolean
Public Function Code39(DataToEncode As String) As String
 Dim I As Long, StringLength As Long, DataToPrint As String, CurrentChar As String
    DataToEncode = RTrim(LTrim(DataToEncode))
    DataToPrint = ""
    StringLength = Len(DataToEncode)
    For I = 1 To StringLength
        CurrentChar = (Mid(DataToEncode, I, 1))
        If CurrentChar = " " Then CurrentChar = "="
        DataToPrint = DataToPrint & CurrentChar
    Next I
    Code39 = "!" & DataToPrint & "!"
    DataToEncode = ""
End Function

Sub ReFresh(RunCode As String)
 Dim I As Long, J As Long, ShName As String
 Dim DataFileName As String, FilePath As String, ExistFilePath As String
 Application.EnableEvents = False
  ThisWorkbook.Worksheets("System Menu").Activate
  FormZoom = Worksheets("ComFactSheet").Range("C1").Value
  On Error Resume Next
  Application.AskToUpdateLinks = False
  On Error GoTo 0
   DataFileName = ""
   If FileStatus = "New" Or FileStatus = "ReadOnly" Then FileStatus = ""
   If Worksheets("System Menu").Range("C4").Value = "" Then GoTo NoDataFile
  If UCase(Worksheets("System Menu").Range("C4").Value) = UCase(Worksheets("ComFactSheet").Range("B18").Value) Then
    FilePath = Worksheets("ComFactSheet").Range("A18").Value
    DExtn = Worksheets("ComFactSheet").Range("C18").Value
    DataFileName = UCase(Worksheets("ComFactSheet").Range("B18").Value & DExtn)
  Else
    Worksheets("ComFactSheet").Activate
    Range("B21").Select
    Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, 2).Value = 0
     If UCase(ActiveCell.Value) = UCase(Worksheets("System Menu").Range("C4").Value) Then
        FilePath = ActiveCell.Offset(0, -1).Value
        DExtn = ActiveCell.Offset(0, 1).Value
        Range("A18").Value = FilePath
        Range("B18").Value = ActiveCell.Value
        Range("C18").Value = DExtn
        DataFileName = UCase(Worksheets("ComFactSheet").Range("B18").Value & DExtn)
        GoTo FileFound
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    GoTo NoDataFile
  End If
FileFound:
 On Error Resume Next
 Application.DisplayAlerts = False
 If Not (MyBook Is Nothing) Then
  If UCase(MyBook.Path & "\" & MyBook.Name) <> UCase(FilePath & DataFileName) Then
   If MyBook.Worksheets("Raw Data").Range("B1").Value = "ReadOnly" Or MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
     MyBook.Close (False)
   Else
     MyBook.Save
     MyBook.Close
   End If
   Set MyBook = Nothing
   RunCode = "New"
   FileStatus = "New"
  End If
 Else
   RunCode = "New"
   FileStatus = "New"
 End If
 Application.DisplayAlerts = True
  If Dir(FilePath & DataFileName) = "" Then GoTo NoDataFile
  On Error GoTo NoDataFile
  I = Workbooks.Count
  Do While I > 0
   If UCase(Workbooks(I).Name) = DataFileName Then Exit Do
   I = I - 1
  Loop
  If I <> 0 Then
    Workbooks(I).Activate
    Set MyBook = ActiveWorkbook
    ExistFilePath = UCase(MyBook.Path & "\")
    If ExistFilePath <> UCase(FilePath) Then
      ThisWorkbook.Worksheets("System Menu").Activate
      Worksheets("System Menu").ComboBox1.Text = ""
      Range("C4").Value = ""
      Range("C5").Value = ""
      Range("C4").Select
      Set MyBook = Nothing
      RunCode = ""
      FileStatus = ""
      MsgBox ("WARNING!!!" & Chr(13) & Chr(13) & "A file with the Same name as the Target Data file is being used." & Chr(13) & Chr(13) & "Cannot open two files with the same name. ")
      Application.EnableEvents = True
      Exit Sub
    End If
  Else
    Application.DisplayAlerts = False
    Application.Workbooks.Open FilePath & DataFileName
    Application.DisplayAlerts = True
    Set MyBook = Workbooks(DataFileName)
    MyBook.Activate
    On Error GoTo WrongDataFile
    MyBook.Worksheets("Raw Data").Activate
    Range("B1").ClearContents
  End If
   ThisWorkbook.Worksheets("System Menu").Range("C5") = FilePath
CheckDataFile:
  On Error Resume Next
  MyBook.Activate
  Worksheets("Member Data").Activate
  If Err.Number = 0 Then GoTo WrongDataFile
  On Error GoTo WrongDataFile
  I = MyBook.Worksheets.Count
  If I < 21 Then GoTo WrongDataFile
    MyBook.Worksheets("Raw Data").Activate
    Worksheets("YearStartDat").Activate
    Worksheets("Chart of Account").Activate
    Worksheets("Receivable").Activate
    Worksheets("ProInvoice").Activate
    Worksheets("Customer Data").Activate
    Worksheets("Product Data").Activate
    Worksheets("PayRec").Activate
    Worksheets("Supplier Data").Activate
    Worksheets("Payable").Activate
    Worksheets("Supply Data").Activate
    Worksheets("PORecord").Activate
    Worksheets("PayMake").Activate
    Worksheets("StockRec").Activate
    Worksheets("IOData").Activate
    Worksheets("BuildRec").Activate
    Worksheets("StockAdRec").Activate
    Worksheets("ComData").Activate
    Range("B9").Value = Range("DE123").Value
    ActiveSheet.Visible = xlSheetVeryHidden
    Worksheets("CountRec").Activate
    ActiveSheet.Visible = xlSheetVeryHidden
    Worksheets("BOM1").Activate
     J = Range("A9").Value
    ActiveSheet.Visible = xlSheetVeryHidden
    If J > 1 Then
     For I = 2 To J
      ShName = "BOM" & I
      Worksheets(ShName).Activate
      ActiveSheet.Visible = xlSheetVeryHidden
     Next I
    End If
     Worksheets("InvDetail1").Activate
     J = Range("B1").Value
     ActiveSheet.Visible = xlSheetVeryHidden
    If J > 1 Then
     For I = 2 To J
      ShName = "InvDetail" & I
      Worksheets(ShName).Activate
      ActiveSheet.Visible = xlSheetVeryHidden
     Next I
    End If
   If MyBook.MultiUserEditing Then
     Application.DisplayAlerts = False
     If UBound(MyBook.UserStatus, 1) > 1 Then
      If MyBook.Worksheets("Raw Data").Range("B1").Value = "" Then
        MsgBox ("WARNING!!!" & Chr(13) & Chr(13) & "The Data file is improperly set at Multi-User Editing mode which is not designed for.   " & Chr(13) & Chr(13) & "Data Entry is currently NOT allowed. ")
      End If
      FileStatus = "ReadOnly"
      MyBook.Worksheets("Raw Data").Range("B1").Value = "ReadOnly"
     Else
      MyBook.Worksheets("Raw Data").Range("B1").ClearContents
      MyBook.ExclusiveAccess
     End If
     Application.DisplayAlerts = True
   ElseIf MyBook.ReadOnly Then
     If MyBook.Worksheets("Raw Data").Range("B1").Value = "" Then
      MsgBox ("WARNING!!!" & Chr(13) & Chr(13) & "The Data file is being used by another user.  Data Entry is currently NOT allowed. ")
     End If
     FileStatus = "ReadOnly"
     MyBook.Worksheets("Raw Data").Range("B1").Value = "ReadOnly"
   Else
    If MyBook.Worksheets("Raw Data").Range("B1").Value = "ReadOnly" Then
      Application.DisplayAlerts = False
      MyBook.Close (False)
      Application.Workbooks.Open FilePath & DataFileName
      Application.DisplayAlerts = True
      Set MyBook = Workbooks(DataFileName)
      MyBook.Activate
      Worksheets("Raw Data").Range("B1").ClearContents
      GoTo CheckDataFile
    End If
     MyBook.Worksheets("Raw Data").Range("B1").ClearContents
   End If
    BeginningDate = MyBook.Worksheets("Raw Data").Range("A1").Value
 If FileStatus = "New" Then
    If ActiveSheet.Rows.Count > 80000 Then
     For I = 1 To 17
      Select Case I
       Case 1
        Worksheets("Raw Data").Activate
       Case 2
        Worksheets("Receivable").Activate
       Case 3
        Worksheets("ProInvoice").Activate
       Case 4
        Worksheets("PayRec").Activate
       Case 5
        Worksheets("Payable").Activate
       Case 6
        Worksheets("PayMake").Activate
       Case 7
        Worksheets("PORecord").Activate
       Case 8
        Worksheets("Product Data").Activate
       Case 9
        Worksheets("Customer Data").Activate
       Case 10
        Worksheets("Supply Data").Activate
       Case 11
        Worksheets("Supplier Data").Activate
       Case 12
        Worksheets("YearStartDat").Activate
       Case 13
        Worksheets("Chart of Account").Activate
       Case 14
        Worksheets("StockRec").Activate
       Case 15
        Worksheets("IOData").Activate
       Case 16
        Worksheets("BuildRec").Activate
       Case 17
        Worksheets("StockAdRec").Activate
       End Select
       Cells(ActiveSheet.Rows.Count, 1).Select
       Selection.End(xlUp).Select
       If ActiveCell.Row > 1004000 Then
         FileStatus = "AlertEnd"
         GoTo AlertSet
       ElseIf ActiveCell.Row > 960000 Then
         FileStatus = "Alert"
       End If
       ActiveSheet.Visible = xlSheetVeryHidden
     Next I
    Else
      For I = 1 To 17
      Select Case I
       Case 1
        Worksheets("Raw Data").Activate
       Case 2
        Worksheets("Receivable").Activate
       Case 3
        Worksheets("ProInvoice").Activate
       Case 4
        Worksheets("PayRec").Activate
       Case 5
        Worksheets("Payable").Activate
       Case 6
        Worksheets("PayMake").Activate
       Case 7
        Worksheets("PORecord").Activate
       Case 8
        Worksheets("Product Data").Activate
       Case 9
        Worksheets("Customer Data").Activate
       Case 10
        Worksheets("Supply Data").Activate
       Case 11
        Worksheets("Supplier Data").Activate
       Case 12
        Worksheets("YearStartDat").Activate
       Case 13
        Worksheets("Chart of Account").Activate
       Case 14
        Worksheets("StockRec").Activate
       Case 15
        Worksheets("IOData").Activate
       Case 16
        Worksheets("BuildRec").Activate
       Case 17
        Worksheets("StockAdRec").Activate
       End Select
       Cells(ActiveSheet.Rows.Count, 1).Select
       Selection.End(xlUp).Select
       If ActiveCell.Row > 58000 Then
         FileStatus = "AlertEnd"
         GoTo AlertSet
       ElseIf ActiveCell.Row > 52000 Then
         FileStatus = "Alert"
       End If
       ActiveSheet.Visible = xlSheetVeryHidden
     Next I
    End If
AlertSet:
  If FileStatus = "Alert" Then
    If Date - BeginningDate > 366 Then
     MsgBox ("WARNING!!!" & Chr(13) & Chr(13) & "The Data file is nearly FULL.  Data Entry can still be done at this moment. " & _
              Chr(13) & " When the Data file becomes FULL, data entry will be affected." & Chr(13) & Chr(13) & _
              "Please proceed 'Year End Update' so as to release some space for the program ")
    Else
     MsgBox ("WARNING!!!" & Chr(13) & Chr(13) & "The Data file is nearly FULL.  Data Entry can still be done at this moment. " & _
             Chr(13) & " When the Data file becomes full, data entry will be affected." & Chr(13) & Chr(13) & _
              "Please contact Mark-Motum Co.Ltd. for assistance")
    End If
  ElseIf FileStatus = "AlertEnd" Then
    If Date - BeginningDate > 366 Then
     MsgBox ("WARNING!!!" & Chr(13) & Chr(13) & "The Data file is FULL.  Data Entry is NOT allowed. " & _
               Chr(13) & Chr(13) & "Please proceed 'Year End Update' so as to release some space for the program ")
    Else
     MsgBox ("WARNING!!!" & Chr(13) & Chr(13) & "The Data file is FULL.  Data Entry is NOT allowed. " & Chr(13) & Chr(13) & _
              "Please contact Mark-Motum Co.Ltd. for assistance")
    End If
  End If
 End If
 On Error GoTo 0
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then FileStatus = "ReadOnly"
 Call FoundChartofAccountRange("")
 SysCurrency = MyBook.Worksheets("ComData").Range("C6").Value
 If SysCurrency = "" Then SysCurrency = "HKD"
  ThisWorkbook.Worksheets("System Menu").Activate
  Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
 Application.EnableEvents = True
 MyBook.Activate
 Exit Sub
NoDataFile:
 If DataFileName <> "" Then
  MsgBox ("The Data File '" & DataFileName & "' is not found" & Chr(13) & _
              " Please select the correct Data File to proceed.")
  Else
   MsgBox ("The Data File is not found" & Chr(13) & _
  " Please select the correct Data File to proceed.")
 End If
  Set MyBook = Nothing
  ThisWorkbook.Worksheets("System Menu").Activate
  Worksheets("System Menu").ComboBox1.Text = ""
  Range("C4").Value = ""
  Range("C5").Value = ""
  Range("C4").Select
 Application.EnableEvents = True
 Exit Sub
WrongDataFile:
   MsgBox ("The '" & DataFileName & "' is not a Valid Data File" & Chr(13) & _
  " Please select the correct Data File to proceed.")
  Application.DisplayAlerts = False
  If Not (MyBook Is Nothing) Then MyBook.Close (False)
  Application.DisplayAlerts = True
  Set MyBook = Nothing
  ThisWorkbook.Worksheets("System Menu").Activate
  Worksheets("System Menu").ComboBox1.Text = ""
  Range("C4").Value = ""
  Range("C5").Value = ""
  Range("C4").Select
 Application.EnableEvents = True
End Sub

Sub FileOpenBkUp(RunCode As String)
Dim FC As Object, FilePath As String, DataFilePath As String, DExtn As String, LastSave As Date, I As Long
 If MyBook Is Nothing Then Exit Sub
 If FileStatus = "ReadOnly" Then GoTo NoBackUp
   Set FC = CreateObject("Scripting.FileSystemObject")
   FilePath = Worksheets("ComFactSheet").Range("A18").Value
   DataFileName = Worksheets("ComFactSheet").Range("B18").Value
   DExtn = Worksheets("ComFactSheet").Range("C18").Value
   If FC.FileExists(FilePath & DataFileName & ".bak") = True Then
    LastSave = FC.GetFile(FilePath & DataFileName & ".bak").DateLastModified
    If Date - LastSave > 2 Then
      FC.GetFile(FilePath & DataFileName & ".bak").Attributes = 0
      FC.CopyFile FilePath & DataFileName & DExtn, FilePath & DataFileName & ".bak", True
      FC.GetFile(FilePath & DataFileName & ".bak").Attributes = 2
    End If
   Else
     FC.CopyFile FilePath & DataFileName & DExtn, FilePath & DataFileName & ".bak", True
     FC.GetFile(FilePath & DataFileName & ".bak").Attributes = 2
   End If
NoBackUp:
  If Worksheets("ComFactSheet").Range("C2").Value <> "Yes" Then
   If Date - Worksheets("ComFactSheet").Range("B9").Value > 90 Then Exit Sub
   If MyBook.Worksheets("ComData").Range("B9").Value < Worksheets("ComFactSheet").Range("B9").Value Then
     I = 90 - Date + MyBook.Worksheets("ComData").Range("B9").Value
     If I >= 0 Then
       Worksheets("System Menu").Range("G12").Value = "Free Trial Version"
       Worksheets("System Menu").Range("G13").Value = "Trial Period Left : " & I & " days"
       Worksheets("System Menu").Range("B9:C10").ClearContents
       Worksheets("System Menu").CommandButton1.Visible = True
       Worksheets("System Menu").CommandButton2.Visible = True
       Worksheets("System Menu").CommandButton3.Visible = True
       Worksheets("ComFactSheet").Range("C16").ClearContents
       MsgBox ("Trial Period for the Data file will expire in " & I & " days")
     Else
       Worksheets("System Menu").Range("G13").Value = "Trial Period Left : 0 day"
       Worksheets("System Menu").CommandButton1.Visible = False
       Worksheets("System Menu").CommandButton2.Visible = False
       Worksheets("System Menu").CommandButton3.Visible = False
       Worksheets("System Menu").Range("B9").Value = "The Data File Free Trial period has expired.  Only limited functions are allowed."
       Worksheets("ComFactSheet").Range("C16").Value = "Expired"
       Worksheets("System Menu").Hyperlinks.Add Anchor:=Worksheets("System Menu").Range("B10:C10"), Address:="http://mark-motum.com/product.html", _
         TextToDisplay:="   Visit www.mark-motum.com to obtain information about Software Activation"
       With Worksheets("System Menu").Range("B10")
        .Font.ColorIndex = 32
        .Font.Underline = xlUnderlineStyleNone
        End With
        With Worksheets("System Menu").Range("B9:B10").Font
        .Name = "Arial"
        .FontStyle = "Bold"
        .Size = 16
        End With
       Exit Sub
     End If
   Else
    I = 90 - Date + ThisWorkbook.Worksheets("ComFactSheet").Range("B9").Value
    If I >= 0 Then
      Worksheets("System Menu").Range("G12").Value = "Free Trial Version"
      Worksheets("System Menu").Range("G13").Value = "Trial Period Left : " & I & " days"
      Worksheets("System Menu").Range("B9:C10").ClearContents
       Worksheets("System Menu").CommandButton1.Visible = True
       Worksheets("System Menu").CommandButton2.Visible = True
       Worksheets("System Menu").CommandButton3.Visible = True
       Worksheets("ComFactSheet").Range("C16").ClearContents
    End If
   End If
  ElseIf (Date - BeginningDate) > 915 And MyBook.Worksheets("ComData").Range("B14").Value <> "Year End File" Then
   MsgBox ("Year End Update Reminder !!!      " & Chr(13) & Chr(13) & _
           "The Account has passed its year end date for over 18 months,         " & Chr(13) & _
           "Please arrange 'Year End Update'.  It will prevent the data file      " & Chr(13) & _
           "getting too big and causing system instability or data lost      ")
  End If
  If Date < BeginningDate Then
   If MyBook.Worksheets("ComData").Range("B7").Value = "Yes" Then
     MsgBox ("An Error is detected in the date setting of your computer." & Chr(13) & "The current date is earlier than the Year-Start-Date")
   End If
  End If
End Sub

Sub NewEntrySheet()
If ActiveSheet.Name <> "Data Entry" Then Exit Sub
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("Data Entry").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
On Error GoTo ErrHandling
 Application.ScreenUpdating = False
Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call ReFormat("DE")
Worksheets("NewCom").Range("A4").ClearContents
 Application.EnableEvents = False
AccountYear = Int((Period(LastRecordDate) - BeginPeriod) / 12) + Year(BeginningDate)
Range("C6").Value = "JV" & AccountYear
Call JNumRetrieve("DE")
ThisWorkbook.Worksheets("Data Entry").Activate
Range("C7").Value = Right(("00000" & (Val(LastTranNo) + 1)), 5)
Range("C2").Value = Format(LastRecordDate, "yyyy/mm/dd")
Application.ScreenUpdating = True
Range("A1").Select
Range("C2").Select
 Application.EnableEvents = True
 SRow = ActiveCell.Row
 SColumn = ActiveCell.Column
Exit Sub

ErrHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "")
 Call ReturnToMainMenu("")
 Application.EnableEvents = True
End Sub
Sub Duplicate()
If ActiveSheet.Name <> "Data Entry" Then Exit Sub
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("Data Entry").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If ThisWorkbook.Worksheets("Data Entry").Range("B11").Value = "" Then
 ThisWorkbook.Worksheets("Data Entry").Activate
 Range("C2").Select
 GoTo Finish
 Exit Sub
End If
 Application.ScreenUpdating = False
 On Error GoTo NoForm
   UserForm98.Caption = "Duplicate Data to a New Entry"
 On Error GoTo ErrHandling
Application.EnableEvents = False
UserForm98.Show
If UserForm98.AbortChange = True Then
 Unload UserForm98
 Application.ScreenUpdating = True
 ThisWorkbook.Worksheets("Data Entry").ListBox1.Visible = False
 ThisWorkbook.Worksheets("Data Entry").ListBox1.Visible = True
 ThisWorkbook.Worksheets("Data Entry").Activate
 Range("C2").Select
 SRow = ActiveCell.Row
 SColumn = ActiveCell.Column
 Application.EnableEvents = True
 Exit Sub
End If
 Unload UserForm98
Call JNumRetrieve("DE")
ThisWorkbook.Worksheets("Data Entry").Activate
Range("C7").Value = Right(("00000" & (Val(LastTranNo) + 1)), 5)
Application.ScreenUpdating = True
Worksheets("Data Entry").ListBox1.Visible = False
Worksheets("Data Entry").ListBox1.Visible = True
Range("A1").Select
Range("C2").Select
 Application.EnableEvents = True
Finish:
 SRow = ActiveCell.Row
 SColumn = ActiveCell.Column
Exit Sub
NoForm:
Call CloseSysBook("")
Exit Sub
ErrHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "")
 Call ReturnToMainMenu("")
 Application.EnableEvents = True
End Sub

Sub ReFormat(RunCode As String)
 If ThisWorkbook.Worksheets("NewCom").Range("A4").Value <> "Data Entry" Then Exit Sub
If RunCode <> "DE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  Application.EnableEvents = False
  Application.ScreenUpdating = False
   ThisWorkbook.Worksheets("Data Entry").Activate
    ActiveSheet.UsedRange.Select
     Selection.EntireRow.Delete
     Range("A2:I30").Select
    With Selection.Font
        .Name = "Times New Roman"
        .FontStyle = "Regular"
        .Size = 13
        .ColorIndex = 2
    End With
    Range("A1:P30").Select
    With Selection.Interior
        .ColorIndex = 25
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
    End With
    Columns("A:A").ColumnWidth = 1
    Range("B2").Select
    Selection.HorizontalAlignment = xlRight
    Selection.ColumnWidth = 17
   If Worksheets("Data Entry").ScreenType > 1.45 Then
     Range("C2:D2").Select
     Selection.ColumnWidth = 39
     With Worksheets("Data Entry")
      .CommandButton1.Left = 670
      .ListBox1.Width = 400
      .ListBox1.Font.Size = 11
      .CommandButton2.Width = 155
      .CommandButton2.Font.Size = 14
      .CommandButton3.Left = 167
      .CommandButton3.Width = 155
      .CommandButton3.Font.Size = 14
      .CommandButton4.Left = 331
      .CommandButton4.Width = 155
      .CommandButton4.Font.Size = 14
      .CommandButton5.Left = 495
      .CommandButton5.Width = 155
      .CommandButton5.Font.Size = 14
      .CommandButton6.Left = 660
      .CommandButton6.Width = 155
      .CommandButton6.Font.Size = 14
     End With
    Else
     Range("C2:D2").Select
     Selection.ColumnWidth = 27
     With Worksheets("Data Entry")
      .CommandButton1.Left = 570
      .ListBox1.Width = 286
      .ListBox1.Font.Size = 10
      .CommandButton2.Width = 135
      .CommandButton2.Font.Size = 13
      .CommandButton3.Left = 140
      .CommandButton3.Width = 135
      .CommandButton3.Font.Size = 13
      .CommandButton4.Left = 277
      .CommandButton4.Width = 135
      .CommandButton4.Font.Size = 13
      .CommandButton5.Left = 414
      .CommandButton5.Width = 135
      .CommandButton5.Font.Size = 13
      .CommandButton6.Left = 551
      .CommandButton6.Width = 135
      .CommandButton6.Font.Size = 13
     End With
    End If
    Range("E2:F2").Select
    Selection.ColumnWidth = 18.75
    Columns("G:G").ColumnWidth = 1
    Range("B2:F19").Select
    Selection.RowHeight = 16.5
    Range("B20").Select
    Selection.RowHeight = 26.25
    Range("B20:F20").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlMedium
        .ColorIndex = 2
    End With
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Range("D20").Select
    ActiveCell.FormulaR1C1 = "Totals:"
    TotalsRow = 20
    Range("D20").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
        .Orientation = 0
    End With
    Range("B20").Value = "  "
    Range("C20").Value = "   "
    Range("E21").Value = "     "
    Range("F21").Value = "      "
    Range("M2").Value = "  "
    Range("M6").Value = "      "
    Range("M7").Value = "       "
    Range("M8").Value = "        "
    Range("M11").Value = "  "
    Range("B2").Select
    ActiveCell.FormulaR1C1 = "Date (yyyy/mm/dd)"
    Range("C2").Select
    Selection.NumberFormat = "@"
    With Selection.Interior
        .ColorIndex = 1
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
    End With
    ActiveWindow.ScrollRow = 1
    Rows("3:3").RowHeight = 10.5
    Range("B4").Select
    Selection.NumberFormat = "@"
   ActiveCell.FormulaR1C1 = _
       "    -------------------------  Transaction Information   ------------------------------------------------------------"
    Range("B5").Select
    Rows("5:5").RowHeight = 10.5
    Range("B3").Select
    Rows("3:3").RowHeight = 10.5
    Range("B6").Select
    ActiveCell.FormulaR1C1 = "Journal Code :"
    Range("B7").Select
    ActiveCell.FormulaR1C1 = "Number :"
    Range("B8").Select
    ActiveCell.FormulaR1C1 = "Reference :"
    Range("C6").NumberFormat = "@"
    Range("C7").NumberFormat = "@"
    Range("C8").NumberFormat = "@"
    Range("C6:C8").Select
    With Selection
       .HorizontalAlignment = xlLeft
       .VerticalAlignment = xlCenter
    End With
    With Selection.Interior
        .ColorIndex = 1
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
    End With
    Range("B9").Select
    Rows("9:9").RowHeight = 10.5
    Range("B10:F10").Select
    Selection.NumberFormat = "@"
    Range("D10").Select
    ActiveCell.FormulaR1C1 = " -------- Description --------"
    Range("C10").Select
    ActiveCell.FormulaR1C1 = " ---------- Name ----------"
    Range("B10").Select
    ActiveCell.FormulaR1C1 = " --- Account ---"
    Range("E10").Select
    ActiveCell.FormulaR1C1 = " ----- Debit -----"
    Range("F10").Select
    ActiveCell.FormulaR1C1 = " ----- Credit -----"
    Columns("E:F").NumberFormat = "General"
    Range("E20").FormulaR1C1 = "=SUM(R[-12]C:R[-1]C)"
    Range("F20").FormulaR1C1 = "=SUM(R[-12]C:R[-1]C)"
    Range("E10:F23").Select
    Selection.NumberFormat = "#,##0.00"
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("B10:D19").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
     End With
    Rows("1:1").RowHeight = 27.75
    Range("A1:G20").Select
    ActiveWindow.Zoom = True
    Columns("D").NumberFormat = "@"
   Columns("D:D").WrapText = True
    Range("C2").Select
  Application.EnableEvents = True
End Sub

Sub Sorting(RunCode As String)
If RunCode <> "DE" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
ActiveSheet.Name = SheetName
   MyBook.Worksheets("Raw Data").Activate
    ActiveSheet.Range("A4").Select
    If ActiveCell.Value <> "" Then
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
    Selection.Range("A1").Activate
    Selection.Sort _
    Key1:=Selection.Range("A1"), _
    Key2:=Selection.Range("B1")
    ThisWorkbook.Worksheets("Data Entry").Activate
    End If
End Sub
Sub RecordRetrieval(RunCode As String)
Dim JournalCode As String, TranNo As String, RecDate As Date
Dim FRow As Long, LRow As Long, I As Long, J As Long
Dim CheckRange As Range
If RunCode <> "DE" Then Exit Sub
If ThisWorkbook.Worksheets("Data Entry").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("Data Entry").Activate
JournalCode = UCase(Range("C6").Value)
Range("C6").Value = JournalCode
If Range("C7").Value = 100000 Then Range("C7").Value = 1
TranNo = "00000" & Range("C7").Value
TranNo = Right(TranNo, 5)
If TranNo = "00000" Then
TranNo = ""
If Range("B11").Value <> "" Then
Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call ReFormat("DE")
Worksheets("NewCom").Range("A4").ClearContents
  Application.EnableEvents = False
Range("C6").Value = JournalCode
Range("C7").Select
Else
Range("C8").ClearContents
Range("C7").Select
End If
End If
Range("C7").Value = TranNo
If JournalCode <> "" And TranNo <> "" Then
 Set CheckRange = MyBook.Worksheets("Raw Data").UsedRange.Offset(3, 0).Columns("A")
If IsError(Application.Match(JournalCode, CheckRange, 0)) Then
If Range("B11").Value <> "" Then
Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call ReFormat("DE")
Worksheets("NewCom").Range("A4").ClearContents
  Application.EnableEvents = False
Range("C6").Value = JournalCode
Range("C7").Value = TranNo
Range("C2").Select
Else
Range("C8").ClearContents
Range("C2").Select
End If
Exit Sub
End If
FRow = Application.Match(JournalCode, CheckRange, 0) + 3
LRow = Application.Match(JournalCode, CheckRange, 1) + 3
Set CheckRange = MyBook.Worksheets("Raw Data").UsedRange
Set CheckRange = CheckRange.Offset(FRow - 1, 1).Resize(LRow - FRow + 1, 1)
If IsError(Application.Match(TranNo, CheckRange, 0)) Then
If Range("B11").Value <> "" Then
Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call ReFormat("DE")
Worksheets("NewCom").Range("A4").ClearContents
Application.EnableEvents = False
Range("C6").Value = JournalCode
Range("C7").Value = TranNo
Range("C2").Select
Else
Range("C8").ClearContents
Range("C2").Select
End If
Exit Sub
End If
LRow = Application.Match(TranNo, CheckRange, 1) + FRow - 1
FRow = Application.Match(TranNo, CheckRange, 0) + FRow - 1
Worksheets("Data Entry").Activate
Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call ReFormat("DE")
Worksheets("NewCom").Range("A4").ClearContents
Application.EnableEvents = False
Range("C6").Value = JournalCode
Range("C7").Value = TranNo
Range("C8").Value = MyBook.Worksheets("Raw Data").Cells(FRow, 3).Value
RecDate = MyBook.Worksheets("Raw Data").Cells(FRow, 4).Value
Range("C2").Value = Format(RecDate, "yyyy/mm/dd")
ActiveSheet.Range("B10").Select
J = 0
For I = FRow To LRow Step 1
ActiveCell.Offset(1, 0).Select
If ActiveCell.Row > 17 Then
ActiveCell.EntireRow.Insert
ActiveCell.Offset(0, 11).Value = "  "
TotalsRow = TotalsRow + 1
J = J + 1
End If
ActiveCell.Value = MyBook.Worksheets("Raw Data").Cells(I, 5).Value
ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Raw Data").Cells(I, 6).Value
ActiveCell.Offset(0, 2).Value = MyBook.Worksheets("Raw Data").Cells(I, 7).Value
ActiveCell.Offset(0, 3).Value = MyBook.Worksheets("Raw Data").Cells(I, 8).Value
ActiveCell.Offset(0, 4).Value = MyBook.Worksheets("Raw Data").Cells(I, 9).Value
ActiveCell.Offset(1, 11).Value = "  "
Next I
If J > 0 Then
Range(Cells(20, 2), Cells(19 + J, 2)).Select
Selection.EntireRow.Hidden = True
End If
Range("C8").Select
End If
End Sub

Sub MoveUp(RunCode As String)
Dim I As Integer
If RunCode <> "DE" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
ActiveSheet.Name = SheetName
 ThisWorkbook.Worksheets("Data Entry").Activate
 If ActiveCell.Column > 1 Then
 If ActiveCell.Row > 10 And ActiveCell.Column = 3 Then ActiveCell.Offset(0, -1).Select
 If ActiveCell.Column = 3 And ActiveCell.Row > 10 Then ActiveCell.Offset(0, -1).Select
 If ActiveCell.Row = 1 Then Range("C2").Select
 If ActiveCell.Row < 6 Then Range("C2").Select
 If ActiveCell.Row = 6 Then Range("C6").Select
 If ActiveCell.Row = 7 Then Range("C7").Select
 If ActiveCell.Row = 8 Then Range("C8").Select
 If ActiveCell.Row > 8 And ActiveCell.Row < 11 Then Range("C8").Select
 If Selection.Offset(-1, 0).EntireRow.Hidden Then
  Selection.Offset(-1, 0).EntireRow.Hidden = False
  ActiveCell.Offset(8, 0).EntireRow.Hidden = True
  End If
  Else
  If ActiveCell.Row = 1 Then
  Range("C2").Select
  Else
  I = -1
 Do While ActiveCell.Offset(I, 0).EntireRow.Hidden
 I = I - 1
 Loop
 ActiveCell.Offset(I, 5).Select
 If Selection.Row < 11 Then Range("C2").Select
 End If
 End If
End Sub
Sub MoveDown(RunCode As String)
If RunCode <> "DE" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
ActiveSheet.Name = SheetName
 ThisWorkbook.Worksheets("Data Entry").Activate
 If ActiveCell.Column = 3 And ActiveCell.Row > 10 And ActiveCell.Offset(-1, 2 - ActiveCell.Column) <> "" Then ActiveCell.Offset(0, 1).Select
 If ActiveCell.Column = 4 And ActiveCell.Row > 10 And ActiveCell.Offset(0, 2 - ActiveCell.Column) = "" Then ActiveCell.Offset(0, -2).Select
 If ActiveCell.Column = 5 And ActiveCell.Row > 10 And ActiveCell.Offset(0, 2 - ActiveCell.Column) = "" Then ActiveCell.Offset(0, -3).Select
 If ActiveCell.Column = 6 And ActiveCell.Row > 10 And ActiveCell.Offset(0, 2 - ActiveCell.Column) = "" Then ActiveCell.Offset(0, -4).Select
 If ActiveCell.Column > 6 Then ActiveCell.Offset(1, 2 - ActiveCell.Column).Select
 If ActiveCell.Row = 2 Then
   Range("C2").Select
   Exit Sub
 End If
  If ActiveCell.Row <= 6 Then Range("C6").Select
 If ActiveCell.Row = 7 Then Range("C7").Select
 If ActiveCell.Row = 8 Then Range("B11").Select
 If ActiveCell.Row > 8 And ActiveCell.Row < 11 Then Range("B11").Select
  If ActiveCell.Row > ActiveSheet.Range("B10").CurrentRegion.Rows.Count + 11 Then Range("C2").Select
 If ActiveCell.Row > 11 And ActiveCell.Offset(-1, 2 - ActiveCell.Column) = "" Then
  Do While ActiveCell.Offset(-1, 2 - ActiveCell.Column) = "" And ActiveCell.Offset(-1, 2 - ActiveCell.Column).EntireRow.Hidden = False And ActiveCell.Row > 11
   ActiveCell.Offset(-1, 2 - ActiveCell.Column).Select
  Loop
 Exit Sub
 End If
 If Selection.EntireRow.Hidden Then
 ActiveCell.Offset(1, 0).Select
 Do While ActiveCell.EntireRow.Hidden = True
 ActiveCell.Offset(1, 0).Select
 Loop
 End If
 If Selection.Offset(1, 0).EntireRow.Hidden Then
  Selection.Offset(-8, 0).EntireRow.Hidden = True
  Selection.Offset(1, 0).EntireRow.Hidden = False
  ElseIf (ActiveCell.Row > 17) And ActiveCell.Offset(1, 4 - ActiveCell.Column) = "Totals:" Then
  Selection.Offset(-8, 0).EntireRow.Hidden = True
  Selection.Offset(1, 0).EntireRow.Insert
  TotalsRow = TotalsRow + 1
  ActiveCell.Offset(2, 5 - ActiveCell.Column) = "=SUM(E9:E" & ActiveCell.Row + 1 & ")"
  ActiveCell.Offset(2, 6 - ActiveCell.Column) = "=SUM(F9:F" & ActiveCell.Row + 1 & ")"
  End If
End Sub

Sub SaveData()
 Dim JournalCode As String, TranNo As String, C As String, COARange As Range, AccountCode As Variant
 Dim RecordDate As Date, P As Long, Totals As Double, GLRef As String
Dim FRow As Integer, LRow As Integer
Dim CheckRange As Range
On Error GoTo ErrHandling
If ActiveSheet.Name <> "Data Entry" Then Exit Sub
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("Data Entry").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 Application.EnableEvents = False
 Application.ScreenUpdating = False
 ThisWorkbook.Worksheets("Data Entry").Activate
If Range("B10").Value <> " --- Account ---" Or Range("C10").Value <> " ---------- Name ----------" Or Range("D10").Value <> " -------- Description --------" Or Range("E10").Value <> " ----- Debit -----" Or Range("F10").Value <> " ----- Credit -----" _
  Or Cells(TotalsRow, 2).Value <> "  " Or Cells(TotalsRow, 3).Value <> "   " Or Cells(TotalsRow, 4).Value <> "Totals:" Or Cells(TotalsRow + 1, 5).Value <> "     " Or Cells(TotalsRow + 1, 6).Value <> "      " Then
   MsgBox ("You probably inserted or deleted a row or a column which is not allowed." & Chr(13) & Chr(13) & "To avoid possible error, the program will REFRESH the data entry sheet." & Chr(13) & "Please re-enter the current entry again")
   Worksheets("NewCom").Range("A4").Value = "Data Entry"
   Call NewEntrySheet
   Worksheets("NewCom").Range("A4").ClearContents
   Application.EnableEvents = True
   Application.ScreenUpdating = True
   Exit Sub
 End If
 JournalCode = Range("C6").Value
 TranNo = Range("C7").Value
 GLRef = Range("C8").Value
 If IsDate(Range("C2").Value) = False Then
  MsgBox ("Wrong Date Input!!!")
  Range("C2").Select
  GoTo FinishSave
  End If
If Range("C2").Value < BeginningDate Then
  MsgBox (" WRONG DATE !!!" & Chr(13) & Chr(13) & "The current Accounting Year begins on " & Year(BeginningDate) & "/" & Month(BeginningDate) & "/" & Day(BeginningDate) & Chr(13) & "Entry with date earlier than the beginning date is not allowed")
 Range("C2").Select
 GoTo FinishSave
End If
 RecordDate = Range("C2").Value
If JournalCode = "" Or TranNo = "" Or RecordDate = 0 Or Range("B11") = "" Then
 MsgBox ("Journal Code, Number, Date and Transaction record must not be empty" & Chr(13) & "Please correct before proceed")
 GoTo FinishSave
End If
 Range("D20").Select
 Do While ActiveCell.Value <> "Totals:"
 ActiveCell.Offset(1, 0).Select
 Loop
 If ActiveCell.Offset(0, 1).Value = 0 Then
   MsgBox ("No amount was entered in the Credits and Debits column." & Chr(13) & "Please correct the entry")
   Range("C8").Select
   GoTo FinishSave
 End If
  If (ActiveCell.Offset(0, 1).Value - ActiveCell.Offset(0, 2).Value) > 0.005 Or _
    (ActiveCell.Offset(0, 2).Value - ActiveCell.Offset(0, 1).Value) > 0.005 Then
    MsgBox ("Credits and Debits do not balance." & Chr(13) & "Please correct the entry")
    Range("C2").Select
    GoTo FinishSave
  End If
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 ThisWorkbook.Worksheets("Data Entry").Activate
 Range("B11").Select
 Totals = 0
 Do While ActiveCell.Value <> ""
  AccountCode = ActiveCell.Value
  ActiveCell.NumberFormat = "General"
  ActiveCell.Value = AccountCode
  Totals = Totals + ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, 4).Value
  P = Application.Match(AccountCode, COARange, 0) + 9
  MyBook.Worksheets("Chart of Account").Cells(P, 7).Value = "Y"
  ActiveCell.Offset(1, 0).Select
 Loop
  P = ActiveCell.Row - 1
  If P < 11 Then
    MsgBox ("No Transaction record" & Chr(13) & "Please correct before proceed")
    GoTo FinishSave
  End If
  If Abs(Totals) > 0.005 Then
    MsgBox ("Incorrect Credits and Debits data." & Chr(13) & "Please correct the entry")
    GoTo FinishSave
  End If
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Range("A4").Select
    If ActiveCell.Value = "" Then GoTo SavingData
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
    Selection.Range("A1").Activate
    Selection.Sort _
    Key1:=Selection.Range("A1"), _
    Key2:=Selection.Range("B1")
Set CheckRange = MyBook.Worksheets("Raw Data").UsedRange.Offset(3, 0).Columns("A")
If IsError(Application.Match(JournalCode, CheckRange, 0)) Then GoTo SavingData
FRow = Application.Match(JournalCode, CheckRange, 0) + 3
LRow = Application.Match(JournalCode, CheckRange, 1) + 3
Set CheckRange = MyBook.Worksheets("Raw Data").UsedRange
Set CheckRange = CheckRange.Offset(FRow - 1, 1).Resize(LRow - FRow + 1, 1)
If IsError(Application.Match(TranNo, CheckRange, 0)) Then GoTo SavingData
LRow = Application.Match(TranNo, CheckRange, 1) + FRow - 1
FRow = Application.Match(TranNo, CheckRange, 0) + FRow - 1
If Cells(FRow, 10).Value <> "" Then
  MsgBox ("This Entry was originated by Sub-ledger." & Chr(13) & Chr(13) & _
         "Amendment or Deletion at this G/L input screen is NOT allowed")
  GoTo FinishSave
End If
AskReply:
 MSG = "Changes were made to this Entry." + Chr(13) + _
 Chr(13) + "OLD RECORD with the same Journal Code and " + Chr(13) + "Transaction Number will be updated" + _
 Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then
    ThisWorkbook.Worksheets("Data Entry").Activate
    Range("C2").Activate
    GoTo FinishSave
    End If
    GoTo AskReply
DataRemoval:
ActiveSheet.Range(Cells(FRow, 1), Cells(LRow, 1)).EntireRow.Delete
SavingData:
 ThisWorkbook.Worksheets("Data Entry").Activate
  Range(Cells(11, 2), Cells(P, 6)).Select
   Selection.Copy
    MyBook.Worksheets("Raw Data").Activate
    ActiveSheet.Cells(ActiveSheet.Rows.Count, 1).Select
    Selection.End(xlUp).Select
    ActiveCell.Offset(1, 4).Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
      Application.CutCopyMode = False
 Do While ActiveCell.Value <> ""
  ActiveCell.NumberFormat = "General"
  ActiveCell.Offset(0, 3).NumberFormat = "General"
  ActiveCell.Offset(0, 4).NumberFormat = "General"
  ActiveCell.Offset(0, -4).NumberFormat = "@"
  ActiveCell.Offset(0, -4).Value = JournalCode
  ActiveCell.Offset(0, -3).NumberFormat = "@"
  ActiveCell.Offset(0, -3).Value = TranNo
  ActiveCell.Offset(0, -2).NumberFormat = "@"
  ActiveCell.Offset(0, -2).Value = GLRef
  ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
  ActiveCell.Offset(0, -1).Value = RecordDate
  ActiveCell.Offset(1, 0).Select
  Loop
 ActiveSheet.Range("C4").Select
  P = Period(RecordDate) - Period(BeginningDate) + 1
  MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
   Cells(JcodeRow, 7).Select
   If ActiveCell.Value = JournalCode Then
     LastTranNo = ActiveCell.Offset(0, 1).Value
    If Val(TranNo) - Val(LastTranNo) = 1 Then
      ActiveCell.Offset(0, 1).Value = TranNo
      If TranNo = "99999" Then
       LastTranNo = "00000"
       ActiveCell.Offset(0, 1).Value = LastTranNo
      Else
       LastTranNo = TranNo
      End If
    End If
   ElseIf ActiveCell.Value = "" Then
     ActiveCell.NumberFormat = "@"
     ActiveCell.Offset(0, 1).NumberFormat = "@"
     ActiveCell.Value = JournalCode
     ActiveCell.Offset(0, 1).Value = TranNo
     LastTranNo = TranNo
   Else
    Call JNumRetrieve("DE")
    If ActiveCell.Value = JournalCode Then
     LastTranNo = ActiveCell.Offset(0, 1).Value
     If Val(TranNo) - Val(LastTranNo) = 1 Then
      ActiveCell.Offset(0, 1).Value = TranNo
      If TranNo = "99999" Then
       LastTranNo = "00000"
       ActiveCell.Offset(0, 1).Value = LastTranNo
      Else
       LastTranNo = TranNo
      End If
     End If
   Else
    If ActiveCell.Value = "" Then
     ActiveCell.NumberFormat = "@"
     ActiveCell.Offset(0, 1).NumberFormat = "@"
     ActiveCell.Value = JournalCode
     ActiveCell.Offset(0, 1).Value = TranNo
     LastTranNo = TranNo
    End If
   End If
  End If
   ThisWorkbook.Worksheets("Data Entry").Activate
  LastJournalCode = JournalCode
  LastRecordDate = RecordDate
 Worksheets("NewCom").Range("A4").Value = "Data Entry"
  Call ReFormat("DE")
 Worksheets("NewCom").Range("A4").ClearContents
   Application.EnableEvents = False
  Range("C6").Value = LastJournalCode
  Range("C7").Value = Right("00000" & (Val(LastTranNo) + 1), 5)
  Range("C2").Value = Format(LastRecordDate, "yyyy/mm/dd")
  Range("C2").Select
FinishSave:
ThisWorkbook.Worksheets("Data Entry").Activate
SRow = ActiveCell.Row
 SColumn = ActiveCell.Column
 ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
If EntryNo > 9 Then
Application.DisplayAlerts = False
 MyBook.Save
Application.DisplayAlerts = True
ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
EntryNo = 0
Else
EntryNo = EntryNo + 1
End If
    ThisWorkbook.Worksheets("Data Entry").Activate
    Cells(SRow, SColumn).Select
    Application.EnableEvents = True
Exit Sub
ErrHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error found during Data Saving")
 Call ReturnToMainMenu("")
 Application.EnableEvents = True
End Sub
Sub DeleteEntry()
Attribute DeleteEntry.VB_ProcData.VB_Invoke_Func = "d\n14"
 Dim JournalCode As String, TranNo As String, C As String
 Dim CheckRange As Range, FRow As Integer, LRow As Integer
On Error GoTo ErrHandling
If ActiveSheet.Name <> "Data Entry" Then Exit Sub
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("Data Entry").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 Application.EnableEvents = False
 Application.ScreenUpdating = False
 ThisWorkbook.Worksheets("Data Entry").Activate
 JournalCode = Range("C6").Value
 TranNo = Range("C7").Value
If JournalCode = "" Or TranNo = "" Then GoTo B4DeleteFinish
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Range("A4").Select
    If ActiveCell.Value = "" Then GoTo B4DeleteFinish
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
    Selection.Range("A1").Activate
    Selection.Sort _
    Key1:=Selection.Range("A1"), _
    Key2:=Selection.Range("B1")
 Set CheckRange = MyBook.Worksheets("Raw Data").UsedRange.Offset(3, 0).Columns("A")
If IsError(Application.Match(JournalCode, CheckRange, 0)) Then GoTo B4DeleteFinish
FRow = Application.Match(JournalCode, CheckRange, 0) + 3
LRow = Application.Match(JournalCode, CheckRange, 1) + 3
Set CheckRange = MyBook.Worksheets("Raw Data").UsedRange
Set CheckRange = CheckRange.Offset(FRow - 1, 1).Resize(LRow - FRow + 1, 1)
If IsError(Application.Match(TranNo, CheckRange, 0)) Then GoTo B4DeleteFinish
LRow = Application.Match(TranNo, CheckRange, 1) + FRow - 1
FRow = Application.Match(TranNo, CheckRange, 0) + FRow - 1
If Cells(FRow, 10).Value <> "" Then
  MsgBox ("This Entry was originated by Sub-ledger accounts." & Chr(13) & Chr(13) & _
         "Amendment or Deletion at this G/L input screen is NOT allowed")
  GoTo FinishDelete
End If
AskReply:
 MSG = "OLD RECORD with the same Journal Code and " + Chr(13) + "Transaction Number will be removed from the Record" + Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then
    GoTo FinishDelete
    End If
    GoTo AskReply
DataRemoval:
ActiveSheet.Range(Cells(FRow, 1), Cells(LRow, 1)).EntireRow.Delete
   ActiveSheet.Range("C4").Select
B4DeleteFinish:
 ThisWorkbook.Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call ReFormat("DE")
ThisWorkbook.Worksheets("NewCom").Range("A4").ClearContents
 Application.EnableEvents = False
 MyBook.Worksheets("ComData").Activate
 Range("G250").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Value = LastJournalCode Then
   LastTranNo = ActiveCell.Offset(0, 1).Value
   Exit Do
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 JcodeRow = ActiveCell.Row
 If ActiveCell.Value = "" Then LastTranNo = "00000"
 ThisWorkbook.Worksheets("Data Entry").Activate
  Range("C6").Value = LastJournalCode
  Range("C7").Value = Right("00000" & (Val(LastTranNo) + 1), 5)
  Range("C2").Value = Format(LastRecordDate, "yyyy/mm/dd")
  Range("C2").Select
FinishDelete:
ThisWorkbook.Worksheets("Data Entry").Activate
SRow = ActiveCell.Row
 SColumn = ActiveCell.Column
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
    ThisWorkbook.Worksheets("Data Entry").Activate
    Cells(SRow, SColumn).Select
    Application.EnableEvents = True
Exit Sub
ErrHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error found when Deleting Data")
 Call ReturnToMainMenu("")
 Application.EnableEvents = True
End Sub
Sub FoundChartofAccountRange(RunCode As String)
    ThisWorkbook.Worksheets("Chart of Account").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    MyBook.Worksheets("Chart of Account").UsedRange.Copy
    ThisWorkbook.Worksheets("Chart of Account").Activate
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
 ThisWorkbook.Worksheets("Chart of Account").Activate
 Range("A8").End(xlDown).Select
 LastRowChartofAccount = Selection.Row
Exit Sub
ErrHandling:
End Sub

Sub ReturnToMainMenu(RunCode As String)
Attribute ReturnToMainMenu.VB_ProcData.VB_Invoke_Func = " \n14"
 Dim MySheet As Worksheet, Myform As UserForm
  Application.ScreenUpdating = False
  Application.EnableEvents = False
  If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
  If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
   On Error Resume Next
   Application.DisplayAlerts = False
    MyBook.Save
    Application.DisplayAlerts = True
   On Error GoTo 0
   ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
  End If
 If ThisWorkbook.ActiveSheet.Name = "Data Entry" Then
  ThisWorkbook.Worksheets("Data Entry").UsedRange.EntireRow.Delete
 ElseIf ActiveSheet.Name = "Chart of Account" Then
  Call FoundChartofAccountRange("")
 End If
  For Each Myform In UserForms
   Unload Myform
   Application.EnableEvents = False
  Next
 On Error Resume Next
 ThisWorkbook.Worksheets("System Menu").Activate
 On Error GoTo 0
  Worksheets("System Menu").Visible = xlSheetVisible
  For Each MySheet In Worksheets
   If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
  Next
 Worksheets("NewCom").Range("A1").ClearContents
  Application.EnableEvents = True
 Worksheets("System Menu").Activate
 Application.EnableEvents = False
 Worksheets("System Menu").ComboBox1.Visible = False
 Worksheets("System Menu").ComboBox1.Visible = True
 SheetName = "System Menu"
 OldForm = ""
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("C4").Select
 Application.EnableEvents = True
 EventOff = False
End Sub

Sub ESCToMainMenu()
 Dim MySheet As Worksheet, Myform As UserForm
 Application.EnableCancelKey = xlDisabled
  Application.ScreenUpdating = False
  Application.EnableEvents = False
     On Error Resume Next
   ThisWorkbook.ActiveSheet.Name = SheetName
   If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
  If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
   Application.DisplayAlerts = False
   MyBook.Save
   Application.DisplayAlerts = True
   On Error GoTo 0
   ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
  End If
 If SheetName = "Invoice" Then Unload Userform6
 If ActiveSheet.Name = "Data Entry" Then
  ThisWorkbook.Worksheets("Data Entry").UsedRange.EntireRow.Delete
  ElseIf ActiveSheet.Name = "Chart of Account" Then
  Call FoundChartofAccountRange("")
 End If
  For Each Myform In UserForms
   Unload Myform
   Application.EnableEvents = False
  Next
 On Error Resume Next
 ThisWorkbook.Worksheets("System Menu").Activate
 On Error GoTo 0
  Worksheets("System Menu").Visible = xlSheetVisible
  For Each MySheet In Worksheets
   Application.EnableEvents = False
   If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
  Next
 Worksheets("NewCom").Range("A1").Value = ""
  Application.EnableEvents = True
 Worksheets("System Menu").Activate
 Application.EnableEvents = False
 Worksheets("System Menu").ComboBox1.Visible = False
 Worksheets("System Menu").ComboBox1.Visible = True
 SheetName = "System Menu"
 OldForm = ""
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("C4").Select
 Application.EnableEvents = True
 EventOff = False
End Sub
Function IncomAcct(AcctNo)
 If Left(AcctNo, 1) = 1 Then
 IncomAcct = 1
 ElseIf Left(AcctNo, 1) = 2 Then
 IncomAcct = 2
 ElseIf Left(AcctNo, 1) = 3 Then
 IncomAcct = 3
 ElseIf Len(AcctNo) = 4 And Left(AcctNo, 1) = 4 Then
 IncomAcct = 4
 ElseIf Len(AcctNo) = 4 And Left(AcctNo, 1) = 5 Then
 IncomAcct = 5
 ElseIf Len(AcctNo) = 4 And Left(AcctNo, 1) = 6 Then
 IncomAcct = 6
 Else
 IncomAcct = 0
End If
End Function
Function AcctCon(AcctNo)
  Dim A As String
  A = AcctNo & "*******"
  AcctCon = Left(A, 7)
End Function

Function AcctNature(AcctNo)
If Left(AcctNo, 1) = 2 Or Left(AcctNo, 1) = 3 Or Left(AcctNo, 1) = 4 Or Left(AcctNo, 1) = 8 Then
 AcctNature = -1
 Else
 AcctNature = 1
 End If
End Function

Function CheckDate(A, B)
 If A < B Then
 CheckDate = -1
 ElseIf A = B Then
 CheckDate = 0
 Else
 CheckDate = 1
 End If
 End Function

Function Period(Dates) As Long
If MyBook.Worksheets("ComData").Range("B6").Value = 12 Then
  Period = (Year(Dates) - 1994) * 12 + Month(Dates)
   Else
  Period = (Year(Dates) - 1994) * 12 + Month(Dates) - MyBook.Worksheets("ComData").Range("B6").Value
End If
End Function

Function CharCon(A)
  If A < 10 Then
    CharCon = Chr(A + 48)
    Else
    CharCon = Chr(A + 55)
  End If
  If CharCon = "I" Then CharCon = "X"
  If CharCon = "O" Then CharCon = "Y"
End Function

Function NumCon(A)
  If A = "X" Then A = "I"
  If A = "Y" Then A = "O"
  If Asc(A) < 65 Then
    NumCon = Asc(A) - 48
    Else
    NumCon = Asc(A) - 55
  End If
End Function

Function InsCode(DriveSN)
Dim SoftType As String, SetupDate As Date, C1 As String, C2 As String, C3 As String, C4 As String, C5 As String
Dim ORnum As String, C6 As String, C7 As String, C8 As String, C9 As String, C10 As String
ORnum = ThisWorkbook.Worksheets("ComFactSheet").Range("B11").Value
SoftType = Left(ORnum, 1)
SetupDate = ThisWorkbook.Worksheets("ComFactSheet").Range("B9").Value
C1 = CharCon(Val(Right(Year(SetupDate), 2)))
C3 = CharCon(Month(SetupDate))
C5 = CharCon(Day(SetupDate))
C7 = CharCon(DriveSN Mod 31)
C10 = Right(ORnum, 1)
C9 = Mid(ORnum, 6, 1)
C8 = CharCon(Val(Mid(ORnum, 2, 1)) + (Val(Right(Year(SetupDate), 2)) + (DriveSN Mod 31)) Mod 7)
C6 = CharCon(Val(Mid(ORnum, 3, 1)) + Month(SetupDate))
C4 = CharCon(Val(Mid(ORnum, 4, 1)) + (Day(SetupDate) Mod 10))
C2 = CharCon(Val(Mid(ORnum, 5, 1)) + (DriveSN Mod 31) Mod 11)
InsCode = SoftType & C1 & C2 & C3 & C4 & C5 & C6 & C7 & C8 & C9 & C10
End Function

Function KNum(InsCode)
Dim SoftType As String, C1 As Long, C2 As Long, C3 As Long, C4 As Long, C5 As Long
Dim C6 As Long, C7 As Long, C8 As Long, C9 As String, C10 As String
Dim B1 As String, B2 As String, B3 As String, B4 As String, CD2 As Long, Num As Long, TextNum As String
SoftType = Left(InsCode, 1)
C10 = Right(InsCode, 1)
C9 = Mid(InsCode, 10, 1)
C1 = NumCon(Mid(InsCode, 2, 1))
C2 = NumCon(Mid(InsCode, 3, 1))
C3 = NumCon(Mid(InsCode, 4, 1))
C4 = NumCon(Mid(InsCode, 5, 1))
C5 = NumCon(Mid(InsCode, 6, 1))
C6 = NumCon(Mid(InsCode, 7, 1))
C7 = NumCon(Mid(InsCode, 8, 1))
C8 = NumCon(Mid(InsCode, 9, 1))
B1 = C8 - ((C1 + C7) Mod 7)
B2 = C6 - C3
B3 = C4 - (C5 Mod 10)
B4 = C2 - (C7 Mod 11)
Num = Val(C2 & C4 & C6) + Val(B1 & B2 & B3 & B4)
TextNum = "" & Num
If Len(TextNum) < 4 Then TextNum = Right(("0000" & TextNum), 4)
CD2 = 11 - (Num Mod 11)
If CD2 = 11 Then CD2 = 0
 If CD2 <> 10 Then
   KNum = SoftType & TextNum & CD2
 Else
   KNum = SoftType & TextNum & "A"
 End If
End Function


Sub Journal(RunCode As String)
    Dim StartDate As Date, EndDate As Date, FileDate As Date, LineNoA As Long, LineNoB As Long
    Dim JournalNo As String, TranNo As String, ReportDate As Date, YearEndDate As Date
    Dim A As Currency, B As Currency, AT As Currency, BT As Currency, VoucherDate As String, CompName As String
    Dim Tbl As Range, JournalType As String, JournalLen As Long, JourRep As Boolean
 If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  Application.ScreenUpdating = False
  On Error GoTo ErrorHandling
 FileDate = MyBook.Worksheets("Raw Data").Range("A1").Value
 YearEndDate = Year(FileDate - 1) + 1 & "/" & Month(FileDate - 1) & "/" & Day(FileDate - 1)
If MyBook.Worksheets("Raw Data").Range("A4").Value <> "" Then
   MyBook.Worksheets("Raw Data").Activate
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D3").End(xlDown).Select
    ReportDate = ActiveCell.Value
 ElseIf MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  ReportDate = YearEndDate
 Else
 ReportDate = Date
 End If
 MyBook.Worksheets("ComData").Activate
   Range("G250:H250").Select
   Range(Selection, Selection.End(xlDown)).Select
   Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   ThisWorkbook.Worksheets("Journal").Activate
    UserForm4.ComboBox2.Clear
    UserForm4.ComboBox2.AddItem "All"
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   Do While ActiveCell.Value <> ""
    UserForm4.ComboBox2.AddItem ActiveCell.Value
    ActiveCell.Offset(1, 0).Select
   Loop
    UserForm4.ComboBox2.Value = "All"
   ThisWorkbook.Worksheets("Journal").Activate
   UserForm4.Caption = "Journal Report"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Width = 70
   UserForm4.ComboBox2.Visible = True
   UserForm4.ComboBox3.Visible = False
   UserForm4.ComboBox4.Visible = False
   UserForm4.Label2.Visible = True
   UserForm4.Label3.Visible = True
   UserForm4.Label4.Visible = False
   UserForm4.Label5.Visible = False
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Caption = "Journal Type : "
   UserForm4.Label7.Visible = True
   UserForm4.TextBox1.Visible = True
   UserForm4.TextBox1.Value = Format(Year(ReportDate) & "/" & Month(ReportDate) & "/1", "yyyy/mm/dd")
   UserForm4.OptionButton2.Caption = "Journal Report"
   UserForm4.OptionButton3.Caption = "Voucher Printing"
   UserForm4.OptionButton2.Left = 40
   UserForm4.OptionButton2.Top = 50
   UserForm4.OptionButton2.Width = 150
   UserForm4.OptionButton3.Left = 150
   UserForm4.OptionButton3.Top = 50
   UserForm4.OptionButton3.Width = 150
   UserForm4.OptionButton2.Value = True
   UserForm4.OptionButton2.Visible = True
   UserForm4.OptionButton3.Visible = True
   If Month(ReportDate) <> 12 Then
     EndDate = Year(ReportDate) & "/" & Month(ReportDate) + 1 & "/1"
   Else
    EndDate = Year(ReportDate) + 1 & "/" & 1 & "/1"
   End If
   EndDate = EndDate - 1
   UserForm4.TextBox2.Visible = True
   UserForm4.TextBox2.Value = Format(EndDate, "yyyy/mm/dd")
   UserForm4.TextBox1.SetFocus
   UserForm4.Label1.BackColor = &H4000&
   UserForm4.Label1.Caption = Chr(13) & "  Input Dates;  Select Journal Report or Voucher Printing "
   UserForm4.Label1.Visible = True
   UserForm4.Show
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
CheckInput:
  If IsDate(UserForm4.TextBox1.Text) = False Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "        Wrong Beginning Date !!!"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  If IsDate(UserForm4.TextBox2.Text) = False Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "        Wrong Ending Date !!!"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
   StartDate = UserForm4.TextBox1.Value
   EndDate = UserForm4.TextBox2.Value
   JournalType = UCase(UserForm4.ComboBox2.Value)
   If EndDate < StartDate Then
     UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & " Ending Date must not be earlier than Beginning Date !!!"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
   If StartDate < FileDate Then
   UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "  Error!!!     Beginning Date out of range !!!"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  If YearEndDate < EndDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  End If
   If UserForm4.OptionButton2.Value = True Then
     JourRep = True
   Else
     JourRep = False
   End If
   Unload UserForm4
   ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
   If JourRep = True Then
     Call JournalFormat("GL")
   Else
     Call VoucherFormat("Voucher")
   End If
   MyBook.Worksheets("Raw Data").Activate
    If Range("D4") = "" Then GoTo FinishJ
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    LineNoA = 4
    LineNoB = 3
    Range("D4").Select
   If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
    ActiveCell.Offset(30, 0).Select
    Loop
    If ActiveCell.Row > 33 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
    LineNoA = ActiveCell.Row
    ActiveCell.Offset(-1, 0).Select
   End If
   If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
    ActiveCell.Offset(30, 0).Select
    Loop
    If ActiveCell.Row > 33 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
    LineNoB = ActiveCell.Row - 1
    End If
   If LineNoA > LineNoB Then GoTo FinishJ
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
   MyBook.Worksheets("Raw Data").Activate
   Range(Cells(LineNoA, 1), Cells(LineNoB, 9)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
SORTOK:
    ActiveSheet.UsedRange.Select
    Set Tbl = Selection
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 If JournalType <> "ALL" Then
   Range("A1").Select
   JournalLen = Len(JournalType)
  If ActiveCell.Value <> "" Then
    Do While (ActiveCell.Value & "**********") < JournalType And ActiveCell.Value <> ""
    ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While (ActiveCell.Value & "**********") < JournalType And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    If ActiveCell.Row > 1 Then
     Range(Cells(1, 1), ActiveCell.Offset(-1, 0)).EntireRow.Delete
    End If
   End If
  If Range("A1").Value = "" Then GoTo FinishJ
  Range("A1").Select
   If Left((ActiveCell.Value & "**********"), JournalLen) > JournalType Then
    ActiveSheet.UsedRange.Delete
    GoTo FinishJ
   End If
  If Len(ActiveCell.Value) >= JournalLen And ActiveCell.Value <> "" Then
   Do While Len(ActiveCell.Value) >= JournalLen And Left(ActiveCell.Value, JournalLen) = JournalType
    Do While Left(ActiveCell.Value, JournalLen) = JournalType And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
    If ActiveCell.Row > 30 Then
     ActiveCell.Offset(-29, 0).Select
     Do While Left(ActiveCell.Value, JournalLen) = JournalType And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
   Loop
    ActiveCell.EntireRow.Insert
    If ActiveCell.Offset(1, 0).Value <> "" Then ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
  End If
 End If
  If Range("A1").Value = "" Then GoTo FinishJ
   If JourRep = False Then GoTo VoucherPrint
    AT = 0
    BT = 0
    Range("A1").Select
    Do While ActiveCell.Value <> ""
      JournalNo = ActiveCell.Value
      TranNo = ActiveCell.Offset(0, 1).Value
      LineNoA = ActiveCell.Row
      Do While JournalNo = ActiveCell.Value And TranNo = ActiveCell.Offset(0, 1).Value And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
      Loop
     LineNoB = ActiveCell.Row - 1
     A = Application.Sum(Range(Cells(LineNoA, 8), Cells(LineNoB, 8)))
     B = Application.Sum(Range(Cells(LineNoA, 9), Cells(LineNoB, 9)))
     If LineNoB <> LineNoA Then
      Range(Cells(LineNoA + 1, 1), Cells(LineNoB, 3)).ClearContents
      ActiveCell.Range("A1:A3").EntireRow.Insert
      ActiveCell.Offset(1, 6).Value = "Transaction Total:"
      ActiveCell.Offset(1, 7).Value = A
      ActiveCell.Offset(1, 8).Value = B
     Else
      ActiveCell.Range("A1:A3").EntireRow.Insert
      ActiveCell.Offset(1, 6).Value = "Transaction Total:"
      ActiveCell.Offset(1, 7).Value = A
      ActiveCell.Offset(1, 8).Value = B
     End If
     AT = AT + A
     BT = BT + B
     ActiveCell.Offset(3, 0).Select
     Loop
    ActiveCell.Offset(0, 6).Value = "Grand Total:"
    ActiveCell.Offset(0, 7).Value = AT
    ActiveCell.Offset(0, 8).Value = BT
   ActiveSheet.UsedRange.Copy
   ThisWorkbook.Worksheets("Journal").Activate
    Range("A12").Select
    ActiveSheet.PasteSpecial Format:=3, Link:=1, DisplayAsIcon:=False, _
        IconFileName:=False
   Application.CutCopyMode = False
FinishJ:
    If JourRep = False Then GoTo FinishV
    ThisWorkbook.Worksheets("Journal").Activate
    If Range("A12") = "" Then Range("F13").Value = "No Reported Data for the selected Range and Journal type(s) "
    Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A1:J19").Select
    ActiveWindow.Zoom = True
     Cells(1, 1).Select
    ActiveWindow.DisplayGridlines = False
    On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .RightHeader = "&""Times New Roman,Regular""Page &P of &N"
        .PrintTitleRows = "$1:$11"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
    ThisWorkbook.Worksheets("Journal").Visible = xlSheetVisible
    ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
    SheetName = "Journal"
    Range("A3").Select
    Application.ScreenUpdating = True
  Exit Sub
VoucherPrint:
    CompName = MyBook.Worksheets("ComData").Range("B2").Value
    Columns("A").Insert
    Range("B1").Select
    Do While ActiveCell.Value <> ""
      JournalNo = ActiveCell.Value
      TranNo = ActiveCell.Offset(0, 1).Value
      VoucherDate = Format(ActiveCell.Offset(0, 3).Value, "yyyy/mm/dd")
      ActiveCell.Range("A1:A8").EntireRow.Insert
      ActiveCell.Offset(0, 5).Value = CompName
      ActiveCell.Offset(1, 5).Value = "VOUCHER"
      ActiveCell.Offset(2, -1).Value = " Journal Code : " & JournalNo
      ActiveCell.Offset(3, -1).Value = " Tran No : " & TranNo
      ActiveCell.Offset(4, -1).Value = " Date : " & Format(VoucherDate, "yyyy/mm/dd")
      ActiveCell.Offset(2, 8).Value = "Printed on : " & Format(Date, "yyyy/mm/dd")
      ActiveCell.Offset(3, 8).Value = "Time : " & Format(Time, "hh:mm:ss") & "   "
      ActiveCell.Offset(6, 4).Value = "Account #"
      ActiveCell.Offset(6, 5).Value = "Account Name "
      ActiveCell.Offset(6, 6).Value = "Description "
      ActiveCell.Offset(6, 7).Value = "Debits"
      ActiveCell.Offset(6, 8).Value = "Credits"
      ActiveCell.Range("H6:I6").Value = SysCurrency
      ActiveCell.Offset(7, 4).Value = "--------------"
      ActiveCell.Offset(7, 5).Value = "--------------------------------------------"
      ActiveCell.Offset(7, 6).Value = "-----------------------------------------------------"
      ActiveCell.Offset(7, 7).Value = "------------------"
      ActiveCell.Offset(7, 8).Value = "------------------"
      ActiveCell.Offset(8, 0).Select
      LineNoA = ActiveCell.Row
      Do While JournalNo = ActiveCell.Value And TranNo = ActiveCell.Offset(0, 1).Value And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
      Loop
     LineNoB = ActiveCell.Row - 1
     A = Application.Sum(Range(Cells(LineNoA, 9), Cells(LineNoB, 9)))
     B = Application.Sum(Range(Cells(LineNoA, 10), Cells(LineNoB, 10)))
      ActiveCell.Range("A1:A8").EntireRow.Insert
      ActiveCell.Offset(1, 6).Value = "Transaction Total:"
      ActiveCell.Offset(1, 7).Value = A
      ActiveCell.Offset(1, 8).Value = B
      ActiveCell.Offset(6, 4).Value = " Entered by : ___________________________________"
      ActiveCell.Offset(6, 8).Value = " Approved by : __________________________________"
      Worksheets("Journal").Activate
       Range(Cells(LineNoA, 3), Cells(LineNoA + 1, 5)).HorizontalAlignment = xlCenterAcrossSelection
       Cells(LineNoB + 10, 4).HorizontalAlignment = xlRight
       ActiveSheet.HPageBreaks.Add Before:=Cells(LineNoB + 16, 1)
      Worksheets("RunningDat").Activate
      ActiveCell.Offset(8, 0).Select
     Loop
    Columns("B:E").Delete
    ActiveSheet.UsedRange.Copy
    Worksheets("Journal").Activate
    ActiveSheet.PasteSpecial Format:=3, Link:=1, DisplayAsIcon:=False, IconFileName:=False
    Application.CutCopyMode = False
FinishV:
    ThisWorkbook.Worksheets("Journal").Activate
    If Range("A12").Value = "" Then Range("C8").Value = "                                   No Reported Data for the selected Range and Journal type(s) "
    Range("C4").Value = Format(StartDate, "yyyy/mm/dd") & "   to   " & Format(EndDate, "yyyy/mm/dd")
    Range("C5").Value = "Journal Code -- " & JournalType
    Range("A1:F25").Select
    ActiveWindow.Zoom = True
     Cells(1, 1).Select
    ActiveWindow.DisplayGridlines = False
   On Error GoTo NoPrinter1
    With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter1:
   ThisWorkbook.Worksheets("Journal").Visible = xlSheetVisible
    ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
    SheetName = "Journal"
    Range("A3").Select
    Application.ScreenUpdating = True
  Exit Sub
ErrorHandling:
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Journal").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of Journal Report / Voucher." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub


Sub FullActivityRptNew(RunCode As String)
    Dim CurBalance As Currency, BalanceC As Currency, BalanceD As Currency, TotalD As Currency, TotalC As Currency
    Dim AcctA As String, AcctY As Long, LineNo As Long, LineS As Long, LineF As Long, AcctBalance As Currency
    Dim StartAcct As String, EndAcct As String, SAcct As String, EAcct As String
    Dim YS As String, MS As String, DS As String, YE As String, MEnd As String, DE As String
    Dim StartDate As Date, EndDate As Date, LineNoA As Long, LineNoB As Long, YearEndDate As Date, FileDate As Date
    Dim Tbl As Range, AcctNo As String, ChecklineA As Long, ChecklineB As Long, CheckNo As Long
    Dim CheckRange As Range, AccountNo As Variant, J As Long
  If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
   ThisWorkbook.Worksheets("Activity Report").Activate
  FileDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  YearEndDate = Year(FileDate - 1) + 1 & "/" & Month(FileDate - 1) & "/" & Day(FileDate - 1)
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  EndDate = YearEndDate
 Else
  EndDate = Date
 End If
   UserForm4.Caption = "Ledger Detail Activity Report"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Visible = False
   UserForm4.ComboBox3.Value = "All"
   UserForm4.ComboBox4.Visible = False
   UserForm4.Label1.Visible = False
   UserForm4.Label2.Visible = True
   UserForm4.Label3.Visible = True
   UserForm4.Label4.Visible = False
   UserForm4.Label5.Visible = True
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Visible = False
   UserForm4.TextBox1.Visible = True
   UserForm4.TextBox1.Value = Format(Year(FileDate) & "/" & Month(FileDate) & "/1", "yyyy/mm/dd")
   UserForm4.TextBox2.Visible = True
   UserForm4.TextBox2.Value = Format(EndDate, "yyyy/mm/dd")
   UserForm4.TextBox1.SetFocus
   UserForm4.Show
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
CheckInput:
  If IsDate(UserForm4.TextBox1.Text) = False Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "         Wrong Beginning Date !!!"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  If IsDate(UserForm4.TextBox2.Text) = False Then
   UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "          Wrong Ending Date !!!"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
   StartDate = UserForm4.TextBox1.Text
   EndDate = UserForm4.TextBox2.Text
   SAcct = UserForm4.ComboBox3.Text
   If SAcct <> "All" Then
    I = 1
    Do While Mid(SAcct, I, 1) <> " " And I < Len(SAcct)
     I = I + 1
    Loop
    If I < Len(SAcct) Then
     SAcct = Left(SAcct, I - 1)
    End If
   End If
   I = 1
   EAcct = UserForm4.ComboBox4.Text
   Do While Mid(EAcct, I, 1) <> " " And I < Len(EAcct)
    I = I + 1
   Loop
   If I < Len(EAcct) Then
    EAcct = Left(EAcct, I - 1)
   End If
    CheckNo = 0
 If UCase(SAcct) = "ALL" Then
    SAcct = Worksheets("Chart of Account").Range("A10").Value
    EAcct = Worksheets("Chart of Account").Cells(LastRowChartofAccount, 1).Value
    CheckNo = -1
  End If
   On Error GoTo ErrorHandling
    StartAcct = AcctCon(SAcct)
    EndAcct = AcctCon(EAcct)
   If StartAcct > EndAcct Then
     SAcct = StartAcct
     StartAcct = EndAcct
     EndAcct = SAcct
    End If
  If FileDate > StartDate Then
    ThisWorkbook.Worksheets("Activity Report").Activate
     UserForm4.Label1.BackColor = &HC0&
     UserForm4.Label1.ForeColor = &HFFFF&
     UserForm4.Label1.Visible = True
     UserForm4.Label1.Caption = Chr(13) & "     Beginning Date Out of Range !!!"
     UserForm4.TextBox1.SetFocus
     UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
    If StartDate > EndDate Then
    ThisWorkbook.Worksheets("Activity Report").Activate
     UserForm4.Label1.BackColor = &HC0&
     UserForm4.Label1.ForeColor = &HFFFF&
     UserForm4.Label1.Visible = True
     UserForm4.Label1.Caption = Chr(13) & " Ending Date must not be earlier than Beginning Date !!!"
     UserForm4.TextBox1.SetFocus
     UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  If YearEndDate < EndDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "   Ending Date out of Range of this Year End File"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
 End If
  Unload UserForm4
  ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
  ThisWorkbook.Worksheets("Activity Report").Activate
  Worksheets("Activity Report").Visible = xlSheetVisible
  Worksheets("System Menu").Visible = xlSheetVeryHidden
   SheetName = "Activity Report"
  Call ActivityFormat("GL")
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.EntireRow.Delete
  Range("A1").Select
   MyBook.Worksheets("YearStartDat").Activate
    Range("A1").Select
 If Range("A2").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1).Copy
      ThisWorkbook.Worksheets("RunningDat").Activate
      Range("A1").Value = " "
      Range("D1").Select
      ActiveSheet.Paste
     Application.CutCopyMode = False
 End If
      ThisWorkbook.Worksheets("RunningDat").Activate
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 11).Select
   With Selection
     .Columns("J").FormulaR1C1 = "=SUM(RC[-2]-RC[-1])"
     .Columns("J").Copy
     Range("H1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("I:J").ClearContents
     .Columns("K").NumberFormat = "General"
     .Columns("K").FormulaR1C1 = "=LEFT(RC[-6] & ""*******"",7)"
     .Sort Key1:=Range("K1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     .Columns("G").Value = "BEGINNING BALANCE"
   End With
 Range("K1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -6).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
 ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
 If Range("E1").Value <> "" Then
   If Range("E2").Value = "" Then
    Range("A2").Select
   Else
    Range("E1").End(xlDown).Select
    ActiveCell.Offset(1, -4).Select
   End If
 End If
 MyBook.Worksheets("Raw Data").Activate
 If Range("D4") = "" Then
  ThisWorkbook.Worksheets("RunningDat").Activate
  Range("K1").Select
  If CheckNo <> -1 Then
   If ActiveCell.Value < StartAcct And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < StartAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
    If ActiveCell.Row > 30 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartAcct And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
    ChecklineA = ActiveCell.Row - 1
    Range(Cells(1, 1), Cells(ChecklineA, 1)).EntireRow.Delete
   End If
    Range("K1").Select
  If ActiveCell.Value <= EndAcct And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value <= EndAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
  End If
    ActiveCell.EntireRow.Insert
    If ActiveCell.Offset(1, 0).Value <> "" Then ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
 End If
  Range("A1") = "  "
  Range("E1").Select
  Do While ActiveCell.Value <> ""
   AcctBalance = ActiveCell.Offset(0, 3).Value
   If AcctBalance < 0 Then
     ActiveCell.Offset(0, 4).Value = AcctBalance * (-1)
     ActiveCell.Offset(0, 3).ClearContents
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
  GoTo FinishA
End If
   MyBook.Worksheets("Raw Data").Activate
    LineNoA = 4
    LineNoB = 3
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D4").Select
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
    If ActiveCell.Row > 33 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
    End If
    LineNoA = ActiveCell.Row
    ActiveCell.Offset(-1, 0).Select
  End If
   If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 33 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    LineNoB = ActiveCell.Row - 1
   End If
 If LineNoA > 4 Then
    Range(Cells(4, 1), Cells(LineNoA - 1, 9)).Copy
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 11).Select
   With Selection
     .Columns("J").FormulaR1C1 = "=SUM(RC[-2]-RC[-1])"
     .Columns("J").Copy
     Range("H1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("I:J").ClearContents
     .Columns("K").NumberFormat = "General"
     .Columns("K").FormulaR1C1 = "=LEFT(RC[-6] & ""*******"",7)"
     .Sort Key1:=Range("K1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 End If
 Range("K1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -6).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("K1").Select
If CheckNo <> -1 Then
  If ActiveCell.Value < StartAcct And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < StartAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value < StartAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    ChecklineA = ActiveCell.Row - 1
    Range(Cells(1, 1), Cells(ChecklineA, 1)).EntireRow.Delete
  End If
    Range("K1").Select
  If ActiveCell.Value <= EndAcct And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
  If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value <= EndAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
  End If
    ActiveCell.EntireRow.Insert
    If ActiveCell.Offset(1, 0).Value <> "" Then ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
End If
  Range("E1").Select
If ActiveCell.Value <> "" Then
 Do While ActiveCell <> ""
  ChecklineA = ActiveCell.Row
  AcctNo = ActiveCell.Value
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(30, 0).Select
   Loop
   If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(1, 0).Select
   Loop
  End If
    ChecklineB = ActiveCell.Row - 1
    AcctBalance = Application.Sum(Range(Cells(ChecklineA, 8), Cells(ChecklineB, 8)))
   If AcctBalance < 0 Then
     Cells(ChecklineA, 9).Value = AcctBalance * (-1)
     Cells(ChecklineA, 8).ClearContents
   Else
    Cells(ChecklineA, 8).Value = AcctBalance
   End If
     Cells(ChecklineA, 7).Value = "BEGINNING BALANCE"
     If ChecklineB > ChecklineA Then
      Range(Cells(ChecklineA + 1, 1), Cells(ChecklineB, 1)).EntireRow.Delete
     End If
     Cells(ChecklineA + 1, 5).Select
  Loop
 End If
 ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
 If Range("E1").Value <> "" Then
   If Range("E2").Value = "" Then
    Range("A2").Select
   Else
    Range("E1").End(xlDown).Select
    ActiveCell.Offset(1, -4).Select
   End If
 End If
If ActiveCell.Row > 1 And Range("A1").Value = "" Then Range("A1").Value = "  "
 If LineNoB > LineNoA Then
    MyBook.Worksheets("Raw Data").Activate
    Range(Cells(LineNoA, 1), Cells(LineNoB, 9)).Copy
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 11).Select
   With Selection
     .Columns("K").NumberFormat = "General"
     .Columns("K").FormulaR1C1 = "=LEFT(RC[-6] & ""*******"",7)"
     .Sort Key1:=Range("K1"), Order1:=xlAscending, _
         Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 End If
 Range("K1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -6).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("K1").Select
If CheckNo <> -1 Then
  If ActiveCell.Value < StartAcct And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < StartAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value < StartAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    ChecklineA = ActiveCell.Row - 1
    Range(Cells(1, 1), Cells(ChecklineA, 1)).EntireRow.Delete
  End If
    Range("K1").Select
  If ActiveCell.Value <= EndAcct And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value <= EndAcct And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
  End If
    ActiveCell.EntireRow.Insert
    If ActiveCell.Offset(1, 0).Value <> "" Then ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
End If
FinishA:
  Columns("J:K").EntireColumn.ClearContents
Call ActivityFormat("GL")
 ThisWorkbook.Worksheets("Chart of Account").Activate
 Set CheckRange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.UsedRange.Copy
    ThisWorkbook.Worksheets("Activity Report").Activate
    Range("A12").Select
   ActiveSheet.PasteSpecial Format:=3, Link:=1, DisplayAsIcon:=False, _
        IconFileName:=False
   Application.CutCopyMode = False
 TotalC = 0
 TotalD = 0
 Range("E12").Select
If ActiveCell.Value <> "" Then
 Do While ActiveCell <> ""
  AccountNo = ActiveCell.Value
  ChecklineA = ActiveCell.Row
  AcctNo = ActiveCell.Value
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(30, 0).Select
   Loop
  If ActiveCell.Row > ChecklineA + 29 Then
    ActiveCell.Offset(-29, 0).Select
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(1, 0).Select
   Loop
  End If
    ChecklineB = ActiveCell.Row - 1
    Range(ActiveCell, ActiveCell.Offset(1, 0)).EntireRow.Insert
    BalanceD = Application.Sum(Range(Cells(ChecklineA, 8), Cells(ChecklineB, 8)))
    BalanceC = Application.Sum(Range(Cells(ChecklineA, 9), Cells(ChecklineB, 9)))
    CurBalance = (BalanceD - BalanceC)
  If Cells(ChecklineA, 7).Value = "BEGINNING BALANCE" And Cells(ChecklineA, 4).Value < StartDate Then
    If IsError(Application.Match(AccountNo, CheckRange, 0)) = False Then
      J = Application.Match(AccountNo, CheckRange, 0) + 9
      Cells(ChecklineA, 6).Value = Worksheets("Chart of Account").Cells(J, 2).Value
    End If
    Cells(ChecklineB + 1, 8).Value = BalanceD - Cells(ChecklineA, 8).Value
    Cells(ChecklineB + 1, 9).Value = BalanceC - Cells(ChecklineA, 9).Value
    If CurBalance < 0 Then
     Cells(ChecklineB + 1, 10).Value = Format(CurBalance * (-1), "#,##0.00") & " Cr"
    Else
     Cells(ChecklineB + 1, 10).Value = CurBalance
    End If
    Cells(ChecklineB + 1, 7).Value = "CURRENT TRANSACTION"
    TotalD = TotalD + BalanceD - Cells(ChecklineA, 8).Value
    TotalC = TotalC + BalanceC - Cells(ChecklineA, 9).Value
    Range(Cells(ChecklineA, 1), Cells(ChecklineA, 4)).ClearContents
    Cells(ChecklineB + 3, 5).Select
   Else
    Cells(ChecklineB + 1, 8).Value = BalanceD
    Cells(ChecklineB + 1, 9).Value = BalanceC
    If CurBalance < 0 Then
     Cells(ChecklineB + 1, 10).Value = Format(CurBalance * (-1), "#,##0.00") & " Cr"
    Else
     Cells(ChecklineB + 1, 10).Value = CurBalance
    End If
    Cells(ChecklineB + 1, 7).Value = "CURRENT TRANSACTION"
    TotalD = TotalD + BalanceD
    TotalC = TotalC + BalanceC
    Cells(ChecklineA, 5).EntireRow.Insert
    Cells(ChecklineA, 5).Value = Cells(ChecklineA + 1, 5).Value
    Cells(ChecklineA, 6).Value = Cells(ChecklineA + 1, 6).Value
    Cells(ChecklineA, 7).Value = "BEGINNING BALANCE"
    If IsError(Application.Match(AccountNo, CheckRange, 0)) = False Then
      J = Application.Match(AccountNo, CheckRange, 0) + 9
      Cells(ChecklineA, 6).Value = Worksheets("Chart of Account").Cells(J, 2).Value
    End If
    Cells(ChecklineA, 8).Value = 0
    Cells(ChecklineB + 4, 5).Select
   End If
 Loop
    ActiveCell.Offset(0, 2).Value = "TOTAL TRANSACTION"
    ActiveCell.Offset(0, 3).Value = TotalD
    ActiveCell.Offset(0, 4).Value = TotalC
Else
  Range("F13").Value = "No Reported Data for the selected Range and Accounts"
End If
    Range("H12:I12").NumberFormat = "#,##0.00"
    Range("E7").Value = " From:  " & Format(StartDate, "yyyy/mm/dd") & "  To:  " & Format(EndDate, "yyyy/mm/dd")
    Range("A6").Value = "From: Acct # " & SAcct
    Range("A7").Value = "To: Acct # " & EAcct
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
  '  Columns("C").Delete
    Range("A1:J18").Select
    ActiveWindow.Zoom = True
    Cells(1, 1).Select
    ActiveWindow.DisplayGridlines = False
    On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.393700787401575)
        .RightMargin = Application.InchesToPoints(0.354330708661417)
        .RightHeader = "&""Arial,Regular""&10Page &P of &N"
        .PrintTitleRows = "$1:$11"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
  ThisWorkbook.Worksheets("Activity Report").Activate
   SheetName = "Activity Report"
    ActiveSheet.Range("A3").Activate
     Application.ScreenUpdating = True
    Exit Sub
ErrorHandling:
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Activity Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of Ledger Detail Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub TBalanceNew(RunCode As String)
   Dim BeginBalD As Currency, BeginBalC As Currency, CurrentD As Currency, CurrentC As Currency, BeginTotC As Currency
   Dim CurrTotD As Currency, CurrTotC As Currency, TotalD As Currency, TotalC As Currency, BeginTotD As Currency
   Dim LineNoA As Long, LineNoB As Long, ChecklineA As Long, ChecklineB As Long, AccLevel As Long, AcctNo As String
   Dim Tbl As Range, StartDate As Date, EndDate As Date, FileDate As Date, YearEndDate As Date
   Dim ReportType As String, BeginD As Currency
   Dim CheckRange As Range, AccountNo As Variant, I As Long
 If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  Application.ScreenUpdating = False
   On Error GoTo ErrorHandling
  FileDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  YearEndDate = Year(FileDate - 1) + 1 & "/" & Month(FileDate - 1) & "/" & Day(FileDate - 1)
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  EndDate = YearEndDate
 Else
  EndDate = Date
 End If
   UserForm4.Caption = "Trial Balance Generation"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Visible = False
   UserForm4.ComboBox3.Visible = False
   UserForm4.ComboBox4.Visible = False
   UserForm4.OptionButton1.Visible = True
   UserForm4.OptionButton1.Value = True
   UserForm4.OptionButton2.Visible = True
   UserForm4.OptionButton3.Visible = True
   UserForm4.Label1.Visible = False
   UserForm4.Label2.Visible = True
   UserForm4.Label3.Visible = True
   UserForm4.Label4.Visible = False
   UserForm4.Label5.TextAlign = 1
   UserForm4.Label5.Caption = "Report Type :"
   UserForm4.Label5.Visible = True
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Visible = False
   UserForm4.TextBox1.Visible = True
   UserForm4.TextBox1.Value = Format(Year(FileDate) & "/" & Month(FileDate) & "/1", "yyyy/mm/dd")
   UserForm4.TextBox2.Visible = True
   UserForm4.TextBox2.Value = Format(EndDate, "yyyy/mm/dd")
   UserForm4.TextBox1.SetFocus
   UserForm4.Show
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
CheckInput:
  If IsDate(UserForm4.TextBox1.Text) = False Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "    Wrong Beginning Date !!!"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  If IsDate(UserForm4.TextBox2.Text) = False Then
   UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "    Wrong Ending Date !!!"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
   StartDate = UserForm4.TextBox1.Text
   EndDate = UserForm4.TextBox2.Text
   If UserForm4.OptionButton1.Value = True Then
     ReportType = "Detail"
   ElseIf UserForm4.OptionButton2.Value = True Then
     ReportType = "Simple"
   Else
     ReportType = "Listing"
   End If
  If EndDate < StartDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "  Ending Date must not be earlier than Beginning Date"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  If StartDate < FileDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "   Error !!!   Beginning Date out of Range"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  If YearEndDate < EndDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "   Ending Date out of Range of this Year End File"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
 End If
   Unload UserForm4
   Worksheets("Activity Report").Range("D6").ClearContents
  On Error GoTo 0
 ThisWorkbook.Worksheets("Trial Balance").Activate
 Worksheets("Trial Balance").Visible = xlSheetVisible
 Worksheets("System Menu").Visible = xlSheetVeryHidden
  SheetName = "Trial Balance"
   ActiveWindow.DisplayGridlines = False
 If ReportType = "Detail" Then
  Call TBalanceFormat("GL")
 Else
  Call TBFormatSimple("GL")
 End If
If ReportType <> "Detail" Then GoTo SimpleReport
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
  MyBook.Worksheets("Raw Data").Activate
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  End If
  LineNoA = 4
  LineNoB = 3
  Range("D4").Select
 If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 33 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    LineNoA = ActiveCell.Row
    LineNoB = LineNoA - 1
  End If
  If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
  If ActiveCell.Row > 33 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
  End If
    LineNoB = ActiveCell.Row - 1
  End If
  If LineNoA > 4 Then
    Range(Cells(4, 5), Cells(LineNoA - 1, 9)).Copy
    ThisWorkbook.Worksheets("RunningDat").Activate
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
  End If
 ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
 If Range("A1").Value <> "" Then
   If Range("A2").Value = "" Then
    Range("A2").Select
   Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
   End If
 End If
   MyBook.Worksheets("YearStartDat").Activate
    Range("A1").Select
 If Range("A2").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(1, 1).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count - 1).Copy
      ThisWorkbook.Worksheets("RunningDat").Activate
      ActiveSheet.Paste
     Application.CutCopyMode = False
 End If
    ThisWorkbook.Worksheets("RunningDat").Activate
If Range("A1").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 11).Select
   With Selection
     .Columns("K").FormulaR1C1 = "=SUM(RC[-7]-RC[-6])"
     .Columns("K").Copy
     Range("D1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("E:K").ClearContents
   End With
End If
   Range("A1").Select
 If Range("A1").Value <> "" Then
   If Range("A2").Value = "" Then
    Range("A2").Select
   Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
   End If
 End If
  ChecklineA = ActiveCell.Row
  If LineNoB >= LineNoA Then
   MyBook.Worksheets("Raw Data").Activate
    Range(Cells(LineNoA, 5), Cells(LineNoB, 9)).Copy
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Selection.Resize(LineNoB - LineNoA + 1, 11).Select
   With Selection
     .Columns("K").FormulaR1C1 = "=SUM(RC[-7]-RC[-6])"
     .Columns("K").Copy
     Cells(ChecklineA, 6).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("D:E").ClearContents
     .Columns("K").ClearContents
   End With
  End If
If Range("A1") <> "" Then
 On Error Resume Next
 Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 11).Select
   With Selection
     .Columns("C").NumberFormat = "General"
     .Columns("C").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("C1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Range("C1").Select
      Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
       ActiveCell.EntireRow.Delete
     Loop
      .Columns("C").Delete
   End With
  On Error GoTo 0
End If
   BeginBalD = 0
   CurrentD = 0
   BalanceD = 0
   BeginTotC = 0
   BeginTotD = 0
   CurrTotD = 0
   CurrTotC = 0
   TotalD = 0
   TotalC = 0
   Worksheets("Chart of Account").Activate
   Set CheckRange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
   Worksheets("Runningdat").Activate
  Range("A1").Select
If ActiveCell.Value <> "" Then
 Do While ActiveCell <> ""
  AccountNo = ActiveCell.Value
  If IsError(Application.Match(AccountNo, CheckRange, 0)) = False Then
   I = Application.Match(AccountNo, CheckRange, 0) + 9
   ActiveCell.Offset(0, 1).Value = Worksheets("Chart of Account").Cells(I, 2).Value
  End If
  ChecklineA = ActiveCell.Row
  AcctNo = ActiveCell.Value
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(30, 0).Select
   Loop
 If ActiveCell.Row > ChecklineA + 29 Then
    ActiveCell.Offset(-29, 0).Select
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(1, 0).Select
   Loop
 End If
    ChecklineB = ActiveCell.Row - 1
    BeginD = Application.Sum(Range(Cells(ChecklineA, 3), Cells(ChecklineB, 3)))
    CurrentD = Application.Sum(Range(Cells(ChecklineA, 5), Cells(ChecklineB, 5)))
    BalanceD = BeginD + CurrentD
    If ChecklineB > ChecklineA Then
     Range(Cells(ChecklineA + 1, 5), Cells(ChecklineB, 5)).EntireRow.Delete
    End If
    If BeginD > 0 Then
     Cells(ChecklineA, 3).Value = BeginD
     Cells(ChecklineA, 4).ClearContents
     BeginTotD = BeginTotD + BeginD
    ElseIf BeginD < 0 Then
     Cells(ChecklineA, 4).Value = BeginD * (-1)
     Cells(ChecklineA, 3).ClearContents
     BeginTotC = BeginTotC - BeginD
    Else
     If Left(AcctNo, 1) = 2 Or Left(AcctNo, 1) = 3 Or Left(AcctNo, 1) = 4 Or Left(AcctNo, 1) = 8 Then
      Cells(ChecklineA, 4).Value = 0
      Cells(ChecklineA, 3).ClearContents
     Else
      Cells(ChecklineA, 3).Value = 0
      Cells(ChecklineA, 4).ClearContents
     End If
    End If
    If CurrentD > 0 Then
     Cells(ChecklineA, 5).Value = CurrentD
     Cells(ChecklineA, 6).ClearContents
     CurrTotD = CurrTotD + CurrentD
    ElseIf CurrentD < 0 Then
     Cells(ChecklineA, 6).Value = CurrentD * (-1)
     Cells(ChecklineA, 5).ClearContents
     CurrTotC = CurrTotC - CurrentD
    Else
     If Left(AcctNo, 1) = 2 Or Left(AcctNo, 1) = 3 Or Left(AcctNo, 1) = 4 Or Left(AcctNo, 1) = 8 Then
      Cells(ChecklineA, 6).Value = 0
      Cells(ChecklineA, 5).ClearContents
     Else
      Cells(ChecklineA, 5).Value = 0
      Cells(ChecklineA, 6).ClearContents
     End If
    End If
    If BalanceD > 0 Then
     Cells(ChecklineA, 7).Value = BalanceD
     Cells(ChecklineA, 8).ClearContents
     TotalD = TotalD + BalanceD
    ElseIf BalanceD < 0 Then
     Cells(ChecklineA, 8).Value = BalanceD * (-1)
     Cells(ChecklineA, 7).ClearContents
     TotalC = TotalC - BalanceD
    Else
     If Left(AcctNo, 1) = 2 Or Left(AcctNo, 1) = 3 Or Left(AcctNo, 1) = 4 Or Left(AcctNo, 1) = 8 Then
      Cells(ChecklineA, 8).Value = 0
      Cells(ChecklineA, 7).ClearContents
     Else
      Cells(ChecklineA, 7).Value = 0
      Cells(ChecklineA, 8).ClearContents
     End If
    End If
    Cells(ChecklineA + 1, 1).Select
  Loop
 End If
      ActiveCell.Offset(0, 2).NumberFormat = "@"
      ActiveCell.Offset(0, 2).Value = "==========="
      ActiveCell.Offset(0, 3).NumberFormat = "@"
      ActiveCell.Offset(0, 3).Value = "==========="
      ActiveCell.Offset(0, 4).NumberFormat = "@"
      ActiveCell.Offset(0, 4).Value = "==========="
      ActiveCell.Offset(0, 5).NumberFormat = "@"
      ActiveCell.Offset(0, 5).Value = "==========="
      ActiveCell.Offset(0, 6).NumberFormat = "@"
      ActiveCell.Offset(0, 6).Value = "==========="
      ActiveCell.Offset(0, 7).NumberFormat = "@"
      ActiveCell.Offset(0, 7).Value = "==========="
      ActiveCell.Offset(1, 2).NumberFormat = "#,##0.00"
      ActiveCell.Offset(1, 3).NumberFormat = "#,##0.00"
      ActiveCell.Offset(1, 4).NumberFormat = "#,##0.00"
      ActiveCell.Offset(1, 5).NumberFormat = "#,##0.00"
      ActiveCell.Offset(1, 6).NumberFormat = "#,##0.00"
      ActiveCell.Offset(1, 7).NumberFormat = "#,##0.00"
      ActiveCell.Offset(1, 2).Value = BeginTotD
      ActiveCell.Offset(1, 3).Value = BeginTotC
      ActiveCell.Offset(1, 4).Value = CurrTotD
      ActiveCell.Offset(1, 5).Value = CurrTotC
      ActiveCell.Offset(1, 6).Value = TotalD
      ActiveCell.Offset(1, 7).Value = TotalC
If Range("A1").Value <> "" Then
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Copy
  ThisWorkbook.Worksheets("Trial Balance").Activate
  Range("B12").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
End If
   ThisWorkbook.Worksheets("Trial Balance").Activate
 If Range("B12") = "" Then Range("C12").Value = "No Record Found"
    Range("A1").Value = " "
    ActiveSheet.UsedRange.Select
  If ReportType = "Detail" Then
    With Selection.Font
     .Name = "Arial Narrow"
     .Size = 10
     .Bold = False
    End With
  Else
    With Selection.Font
     .Name = "Arial"
     .Size = 10
     .Bold = False
    End With
  End If
     Selection.RowHeight = 15
 If Range("B12") = "" Then GoTo FinishT
    Set Tbl = Selection
    Tbl.Offset(11, 0).Resize(Tbl.Rows.Count - 11).Select
    Selection.Columns("A").ClearContents
    Selection.Columns("B:C").Select
     With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
    End With
    Selection.Columns("C:H").Select
     With Selection
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
FinishT:
    Range("D7").Value = " From:  " & Format(StartDate, "yyyy/mm/dd") & "  To:  " & Format(EndDate, "yyyy/mm/dd")
    Range("B1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("B2").Value = "Time: " & TimeValue(Now)
   Columns("A").Delete
    Range("A1:H19").Select
    ActiveWindow.Zoom = True
    Range("A3").Select
   On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .RightHeader = "&""Arial,Regular""&10Page &P of &N"
        .PrintTitleRows = "$1:$11"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
     Application.ScreenUpdating = True
    Exit Sub

SimpleReport:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
  MyBook.Worksheets("Raw Data").Activate
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  End If
  Range("D4").Select
  If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 33 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
   LineNoA = ActiveCell.Row - 1
  End If
  If LineNoA > 3 Then
    Range(Cells(4, 5), Cells(LineNoA, 9)).Copy
    ThisWorkbook.Worksheets("RunningDat").Activate
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
  End If
  ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
 If Range("A1").Value <> "" Then
   If Range("A2").Value = "" Then
    Range("A2").Select
   Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
   End If
 End If
   MyBook.Worksheets("YearStartDat").Activate
    Range("A1").Select
 If Range("A2").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(1, 1).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count - 1).Copy
      ThisWorkbook.Worksheets("RunningDat").Activate
      ActiveSheet.Paste
     Application.CutCopyMode = False
 End If
If ReportType = "Listing" Then GoTo AccountListing
 ThisWorkbook.Worksheets("RunningDat").Activate
If Range("A1").Value <> "" Then
 On Error Resume Next
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 11).Select
   With Selection
     .Columns("C").NumberFormat = "General"
     .Columns("C").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("C1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     .Columns("K").FormulaR1C1 = "=SUM(RC[-7]-RC[-6])"
     .Columns("K").Copy
     Range("D1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("E:K").ClearContents
     Range("C1").Select
      Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
       ActiveCell.EntireRow.Delete
     Loop
      .Columns("C").Delete
   End With
  On Error GoTo 0
End If
   BeginBalD = 0
   BeginTotC = 0
   BeginTotD = 0
   Worksheets("Chart of Account").Activate
   Set CheckRange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
   Worksheets("Runningdat").Activate
  Range("A1").Select
If ActiveCell.Value <> "" Then
 Do While ActiveCell <> ""
  AccountNo = ActiveCell.Value
  If IsError(Application.Match(AccountNo, CheckRange, 0)) = False Then
   I = Application.Match(AccountNo, CheckRange, 0) + 9
   ActiveCell.Offset(0, 1).Value = Worksheets("Chart of Account").Cells(I, 2).Value
  End If
  ChecklineA = ActiveCell.Row
  AcctNo = ActiveCell.Value
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(30, 0).Select
   Loop
 If ActiveCell.Row > ChecklineA + 29 Then
    ActiveCell.Offset(-29, 0).Select
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(1, 0).Select
   Loop
 End If
    ChecklineB = ActiveCell.Row - 1
    BeginD = Application.Sum(Range(Cells(ChecklineA, 3), Cells(ChecklineB, 3)))
    If ChecklineB > ChecklineA Then
     Range(Cells(ChecklineA + 1, 5), Cells(ChecklineB, 5)).EntireRow.Delete
    End If
    If BeginD > 0 Then
     Cells(ChecklineA, 7).Value = BeginD
     Cells(ChecklineA, 8).ClearContents
     BeginTotD = BeginTotD + BeginD
    ElseIf BeginD < 0 Then
     Cells(ChecklineA, 8).Value = BeginD * (-1)
     Cells(ChecklineA, 7).ClearContents
     BeginTotC = BeginTotC - BeginD
    Else
     If Left(AcctNo, 1) = 2 Or Left(AcctNo, 1) = 3 Or Left(AcctNo, 1) = 4 Or Left(AcctNo, 1) = 8 Then
      Cells(ChecklineA, 8).Value = 0
      Cells(ChecklineA, 7).ClearContents
     Else
      Cells(ChecklineA, 7).Value = 0
      Cells(ChecklineA, 8).ClearContents
     End If
    End If
    Cells(ChecklineA + 1, 1).Select
  Loop
 End If
      ActiveCell.Offset(0, 6).NumberFormat = "@"
      ActiveCell.Offset(0, 6).Value = "==========="
      ActiveCell.Offset(0, 7).NumberFormat = "@"
      ActiveCell.Offset(0, 7).Value = "==========="
      ActiveCell.Offset(1, 6).Value = BeginTotD
      ActiveCell.Offset(1, 7).Value = BeginTotC
  ThisWorkbook.Worksheets("RunningDat").Activate
If Range("A1").Value <> "" Then
  ActiveSheet.UsedRange.Copy
  ThisWorkbook.Worksheets("Trial Balance").Activate
  Range("B12").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
End If
 ThisWorkbook.Worksheets("Trial Balance").Activate
 If Range("B12") = "" Then Range("C12").Value = "No Record Found"
    Range("A1").Value = " "
     ActiveSheet.UsedRange.Select
    With Selection.Font
     .Name = "Arial"
     .Size = 10
     .Bold = False
    End With
     Selection.RowHeight = 15
    Set Tbl = Selection
    Tbl.Offset(11, 0).Resize(Tbl.Rows.Count - 11).Select
    Selection.Columns("A").ClearContents
    Selection.Columns("B:C").Select
     With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
    End With
    Selection.Columns("C:H").Select
     With Selection
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
    Range("C7").Value = " As at " & Format(EndDate, "yyyy/mm/dd")
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Columns("D:G").Delete
    Range("B12").Select
    Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 2) = 0 And ActiveCell.Offset(0, 3) = 0 Then
     ActiveCell.EntireRow.Delete
    Else
     ActiveCell.Offset(1, 0).Select
    End If
   Loop
    Range("A1:E19").Select
    ActiveWindow.Zoom = True
    Range("A3").Select
    On Error GoTo NoPrinter1
    With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(1)
        .RightMargin = Application.InchesToPoints(1)
        .RightHeader = "&""Arial,Regular""&10Page &P of &N"
        .PrintTitleRows = "$1:$11"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter1:
     Application.ScreenUpdating = True
Exit Sub
AccountListing:
 ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
 If Range("A1").Value <> "" Then
   If Range("A2").Value = "" Then
    Range("A2").Select
   Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
   End If
 End If
    Worksheets("Chart of Account").Activate
    Range("A10").Select
  If Range("A11").Value <> "" Then
    Range(Cells(10, 1), Cells(LastRowChartofAccount, 2)).Copy
      ThisWorkbook.Worksheets("RunningDat").Activate
      ActiveSheet.Paste
     Application.CutCopyMode = False
  End If
    ThisWorkbook.Worksheets("RunningDat").Activate
 On Error Resume Next
 If Range("A1").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 11).Select
   With Selection
     .Columns("C").NumberFormat = "General"
     .Columns("C").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("C1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     .Columns("K").FormulaR1C1 = "=SUM(RC[-7]-RC[-6])"
     .Columns("K").Copy
     Range("D1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("E:K").ClearContents
     Range("C1").Select
      Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
       ActiveCell.EntireRow.Delete
     Loop
      .Columns("C").Delete
   End With
 End If
  On Error GoTo 0
   BeginD = 0
   Worksheets("Chart of Account").Activate
   Set CheckRange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
   Worksheets("Runningdat").Activate
  Range("A1").Select
If ActiveCell.Value <> "" Then
 Do While ActiveCell <> ""
  AccountNo = ActiveCell.Value
  If IsError(Application.Match(AccountNo, CheckRange, 0)) = False Then
   I = Application.Match(AccountNo, CheckRange, 0) + 9
   ActiveCell.Offset(0, 1).Value = Worksheets("Chart of Account").Cells(I, 2).Value
  End If
  ChecklineA = ActiveCell.Row
  AcctNo = ActiveCell.Value
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(30, 0).Select
   Loop
 If ActiveCell.Row > ChecklineA + 29 Then
    ActiveCell.Offset(-29, 0).Select
   Do While ActiveCell.Value = AcctNo
     ActiveCell.Offset(1, 0).Select
   Loop
 End If
    ChecklineB = ActiveCell.Row - 1
    BeginD = Application.Sum(Range(Cells(ChecklineA, 3), Cells(ChecklineB, 3)))
    If ChecklineB > ChecklineA Then
     Range(Cells(ChecklineA + 1, 5), Cells(ChecklineB, 5)).EntireRow.Delete
    End If
    Cells(ChecklineA, 3).Value = BeginD
    Cells(ChecklineA + 1, 1).Select
  Loop
End If
 Range("A1").Select
 ChecklineA = 1
 Do While ActiveCell.Value <> ""
  BeginD = ActiveCell.Offset(0, 2).Value
  If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Then
   AccLevel = Len(ActiveCell.Value)
   Do While AccLevel < Len(ActiveCell.Offset(1, 0).Value)
    BeginD = BeginD + ActiveCell.Offset(1, 2).Value
    ActiveCell.Offset(1, 0).Select
   Loop
   If BeginD < 0 Then
    Cells(ChecklineA, 7).Value = Format(BeginD * (-1), "#,##0.00") & " Cr"
   Else
    Cells(ChecklineA, 7).Value = CCur(BeginD)
   End If
  Else
   If BeginD < 0 Then
    Cells(ChecklineA, 8).Value = Format(BeginD * (-1), "#,##0.00") & " Cr"
   Else
    Cells(ChecklineA, 8).Value = CCur(BeginD)
   End If
  End If
   ChecklineA = ChecklineA + 1
   Cells(ChecklineA, 1).Select
 Loop
  ThisWorkbook.Worksheets("RunningDat").Activate
If Range("A1").Value <> "" Then
  ActiveSheet.UsedRange.Copy
  ThisWorkbook.Worksheets("Trial Balance").Activate
  Range("B12").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
End If
   ThisWorkbook.Worksheets("Trial Balance").Activate
    If Range("B12") = "" Then Range("C12").Value = "No Record Found"
    Range("A1").Value = " "
    ActiveSheet.UsedRange.Select
    With Selection.Font
     .Name = "Arial"
     .Size = 10
     .Bold = False
    End With
     Selection.RowHeight = 15
    Set Tbl = Selection
    Tbl.Offset(11, 0).Resize(Tbl.Rows.Count - 11).Select
    Selection.Columns("A").ClearContents
    Selection.Columns("B:C").Select
     With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
    End With
    Selection.Columns("C:H").Select
     With Selection
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
    Range("H9").Value = SysCurrency & " "
    Range("H10").Value = "General Account"
    Range("H11").Value = "----------------------"
    Range("I10").Value = "Detail Account"
    Range("I11").Value = "----------------------"
    Range("C6").Value = "Balance Listing for All Accounts"
    Range("C7").Value = " As at " & Format(EndDate, "yyyy/mm/dd")
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Columns("D:G").Delete
    Range("A1:E19").Select
    ActiveWindow.Zoom = True
    Range("A3").Select
    On Error GoTo NoPrinter2
      With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(1)
        .RightMargin = Application.InchesToPoints(1)
        .RightHeader = "&""Arial,Regular""&10Page &P of &N"
        .PrintTitleRows = "$1:$11"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter2:
     Application.ScreenUpdating = True
    Exit Sub
ErrorHandling:
  MsgBox ("Wrong Input or User Cancelled!")
  ThisWorkbook.Worksheets("System Menu").Activat
End Sub

Sub InComeNewB(RunCode As String)
     Dim StartDate As Date, EndDate As Date, FileDate As Date, ReportDate As Date, YearEndDate As Date
     Dim Level As Long, Checkline As Long, LineNoA As Long, LineNoB As Long, LineNoC As Long
     Dim Profit As Currency, ProfitOld As Currency, AcctBalance As Currency, AcctCode As String, AcctNo As String
     Dim AcctBalA As Currency, CumBalA As Currency, AcctExp As Currency, CumExp As Currency
     Dim CheckRange As Range, AccountNo As Variant, I As Long
 If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  Application.ScreenUpdating = False
  On Error GoTo ErrorHandling
 FileDate = MyBook.Worksheets("Raw Data").Range("A1").Value
 YearEndDate = Year(FileDate - 1) + 1 & "/" & Month(FileDate - 1) & "/" & Day(FileDate - 1)
If MyBook.Worksheets("Raw Data").Range("A4").Value <> "" Then
   MyBook.Worksheets("Raw Data").Activate
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D3").End(xlDown).Select
    ReportDate = ActiveCell.Value
 ElseIf MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 ReportDate = YearEndDate
 Else
 ReportDate = Date
 End If
   ThisWorkbook.Worksheets("Income Statement").Activate
    For I = 1 To 5
     UserForm4.ComboBox2.AddItem I
    Next I
    UserForm4.ComboBox2.Value = "5"
   UserForm4.Caption = "Income Statement Reporting"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Width = 35
   UserForm4.ComboBox2.Visible = True
   UserForm4.ComboBox3.Visible = False
   UserForm4.ComboBox4.Visible = False
   UserForm4.Label1.Visible = False
   UserForm4.Label2.Visible = True
   UserForm4.Label3.Visible = True
   UserForm4.Label4.Visible = False
   UserForm4.Label5.Visible = False
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Caption = "Account Level : "
   UserForm4.Label7.Visible = True
   UserForm4.TextBox1.Visible = True
   UserForm4.TextBox1.Value = Format(Year(ReportDate) & "/" & Month(ReportDate) & "/1", "yyyy/mm/dd")
   If Month(ReportDate) <> 12 Then
     EndDate = Year(ReportDate) & "/" & Month(ReportDate) + 1 & "/1"
   Else
    EndDate = Year(ReportDate) + 1 & "/" & 1 & "/1"
   End If
   EndDate = EndDate - 1
   UserForm4.TextBox2.Visible = True
   UserForm4.TextBox2.Value = Format(EndDate, "yyyy/mm/dd")
   UserForm4.TextBox1.SetFocus
   UserForm4.Show
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
CheckInput:
  If IsDate(UserForm4.TextBox1.Text) = False Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "        Wrong Beginning Date !!!"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  If IsDate(UserForm4.TextBox2.Text) = False Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "        Wrong Ending Date !!!"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
   StartDate = UserForm4.TextBox1.Value
   EndDate = UserForm4.TextBox2.Value
   Level = UserForm4.ComboBox2.ListIndex + 1
   If Level > 5 Or Level < 1 Then Level = 5
  If EndDate < StartDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & " Ending Date must not be earlier than Beginning Date"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  If StartDate < FileDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "  Error !!!   Beginning Date out of Range"
    UserForm4.TextBox1.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  If YearEndDate < EndDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  End If
 MyBook.Activate
 If Period(StartDate) - Period(FileDate) > 11 Then
 Do While Period(StartDate) - Period(FileDate) > 11
  FileDate = Year(FileDate) + 1 & "/" & Month(FileDate) & "/" & Day(FileDate)
 Loop
 End If
LineNoA = 4
LineNoB = 3
LineNoC = 2
  If Period(StartDate) - Period(FileDate) < 12 And Period(EndDate) - Period(FileDate) >= 12 Then LineNoA = 0
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
     Range("A1").Select
    MyBook.Worksheets("Raw Data").Activate
    If Range("A4") = "" Then
     Call IncomeStatementFormat("GL")
     GoTo FinishI
    End If
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D4").Select
If LineNoA <> 0 Then
  If ActiveCell.Value < FileDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < FileDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 33 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value < FileDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    LineNoA = ActiveCell.Row
    LineNoB = LineNoA
  Else
   LineNoB = 4
   LineNoC = 3
  End If
Else
  LineNoB = 4
  LineNoC = 3
End If
 If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
 If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
 End If
    LineNoB = ActiveCell.Row
    LineNoC = LineNoB - 1
  End If
  If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
 If ActiveCell.Row > LineNoB + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
  End If
    LineNoC = ActiveCell.Row - 1
  End If
 If LineNoA <> 0 And LineNoC >= LineNoA Then
   MyBook.Worksheets("Raw Data").Activate
   Range(Cells(LineNoA, 4), Cells(LineNoC, 9)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 8).Select
   With Selection
     .Columns("H").FormulaR1C1 = "=SUM(RC[-3]-RC[-2])"
     .Columns("H").Copy
     Range("G1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("E:F").ClearContents
   End With
 End If
  ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
  If Range("B1").Value <> "" Then
   If Range("B2").Value = "" Then
    Range("A2").Select
   Else
    Range("B1").End(xlDown).Select
    ActiveCell.Offset(1, -1).Select
   End If
  End If
  Checkline = ActiveCell.Row
 If LineNoC >= LineNoB Then
  MyBook.Worksheets("Raw Data").Activate
   Range(Cells(LineNoB, 4), Cells(LineNoC, 9)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.Paste
    Application.CutCopyMode = False
   With Selection
     .Columns("H").FormulaR1C1 = "=SUM(RC[-3]-RC[-2])"
     .Columns("H").Copy
     Cells(Checkline, 5).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("F").ClearContents
   End With
 End If
  Range("B1").Select
  If Range("B1").Value <> "" Then
   If Range("B2").Value = "" Then
    Range("B2").Select
   Else
    Range("B1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
   End If
  End If
  Worksheets("Chart of Account").Activate
  Range(Cells(10, 1), Cells(LastRowChartofAccount, 2)).Copy
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveCell.Offset(0, -1).Value = "A"
  ActiveSheet.Paste
  Application.CutCopyMode = False
  ActiveSheet.UsedRange.Select
   Selection.Resize(Selection.Rows.Count, 8).Select
   With Selection
     .Columns("H").ClearContents
     .Columns("D").NumberFormat = "General"
     .Columns("D").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 Range("D1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
    Range("D1").Select
  If Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> "" Then
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
 If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
 End If
    Checkline = ActiveCell.Row - 1
    Range(Cells(1, 1), Cells(Checkline, 4)).EntireRow.Delete
  End If
  Range("D1").Select
 Do While ActiveCell.Value <> ""
  If Left(ActiveCell.Value, 1) = "4" Or Left(ActiveCell.Value, 1) = "8" Then
    AcctCode = "4" & ActiveCell.Value
    ActiveCell.Value = Left(AcctCode, 7)
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 ActiveSheet.UsedRange.Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("B1").Select
 Do While ActiveCell.Value <> ""
   AcctBalance = 0
   OldBalance = 0
  If Len(ActiveCell.Value) < Level Then
    AcctNo = ActiveCell.Value
    LineNoA = ActiveCell.Row
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
 If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
 End If
    LineNoB = ActiveCell.Row - 1
    AcctBalance = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5)))
    OldBalance = Application.Sum(Range(Cells(LineNoA, 7), Cells(LineNoB, 7)))
    If AcctBalance = 0 And OldBalance = 0 Then
     Range(Cells(LineNoA, 5), Cells(LineNoB, 5)).EntireRow.Delete
     Cells(LineNoA, 2).Select
    Else
     Cells(LineNoA, 5) = AcctBalance
     Cells(LineNoA, 6) = OldBalance
     If LineNoA < LineNoB Then
      Range(Cells(LineNoA + 1, 5), Cells(LineNoB, 5)).EntireRow.Delete
     End If
     Cells(LineNoA + 1, 2).Select
    End If
   ElseIf Len(ActiveCell.Value) = Level Then
     LineNoA = ActiveCell.Row
SameAcct:
     AcctNo = ActiveCell.Value
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    LineNoB = ActiveCell.Row - 1
   If Len(ActiveCell.Value) > Level Then
     GoTo SameAcct
    Else
    AcctBalance = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5)))
    OldBalance = Application.Sum(Range(Cells(LineNoA, 7), Cells(LineNoB, 7)))
    If AcctBalance = 0 And OldBalance = 0 Then
     Range(Cells(LineNoA, 5), Cells(LineNoB, 5)).EntireRow.Delete
     Cells(LineNoA, 2).Select
    Else
     Cells(LineNoA, 5) = AcctBalance
     Cells(LineNoA, 6) = OldBalance
     If LineNoA < LineNoB Then
       Range(Cells(LineNoA + 1, 5), Cells(LineNoB, 5)).EntireRow.Delete
     End If
     Cells(LineNoA + 1, 2).Select
    End If
   End If
 Else
    AcctNo = ActiveCell.Value
    LineNoA = ActiveCell.Row
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
  If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
  End If
    LineNoB = ActiveCell.Row - 1
    AcctBalance = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5)))
    OldBalance = Application.Sum(Range(Cells(LineNoA, 7), Cells(LineNoB, 7)))
     If AcctBalance = 0 And OldBalance = 0 Then
     Range(Cells(LineNoA, 5), Cells(LineNoB, 5)).EntireRow.Delete
     Cells(LineNoA, 2).Select
     Else
      Cells(LineNoA, 5) = AcctBalance
      Cells(LineNoA, 6) = OldBalance
     If LineNoA < LineNoB Then
      Range(Cells(LineNoA + 1, 5), Cells(LineNoB, 5)).EntireRow.Delete
     End If
      Cells(LineNoA + 1, 2).Select
     End If
 End If
Loop
 Columns("G:H").EntireColumn.ClearContents
 Columns("D").EntireColumn.Delete
 Range("B1").Select
     Do While ActiveCell.Value <> ""
      ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, 2).Value * AcctNature(ActiveCell.Value)
      ActiveCell.Offset(0, 3).Value = ActiveCell.Offset(0, 3).Value * AcctNature(ActiveCell.Value)
      ActiveCell.Offset(1, 0).Select
     Loop
   Worksheets("Chart of Account").Activate
   Set CheckRange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
   Worksheets("Runningdat").Activate
   Range("B1").Select
   Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 2) = 0 And ActiveCell.Offset(0, 3) = 0 Then
     ActiveCell.EntireRow.Delete
    Else
      AccountNo = ActiveCell.Value
      If IsError(Application.Match(AccountNo, CheckRange, 0)) = False Then
       I = Application.Match(AccountNo, CheckRange, 0) + 9
       ActiveCell.Offset(0, 1).Value = Worksheets("Chart of Account").Cells(I, 2).Value
      End If
     ActiveCell.Offset(1, 0).Select
    End If
   Loop
  If Range("B1") = "" Then
     Call IncomeStatementFormat("GL")
     GoTo FinishI
    End If
    Call IncomeStatementFormat("GL")
    ThisWorkbook.Worksheets("RunningDat").Activate
    Range("A1").Value = "A"
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(0, 1).Resize(Tbl.Rows.Count, Tbl.Columns.Count - 1).Copy
    ThisWorkbook.Worksheets("Income Statement").Activate
    Range("B12").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
FinishI:
     ThisWorkbook.Worksheets("Income Statement").Activate
     Range("B12").Select
     AcctBalA = 0
     CumBalA = 0
     AcctExp = 0
     CumExp = 0
  If ActiveCell.Value = "" Or Not (Left(ActiveCell.Value, 1) = 4 Or Left(ActiveCell.Value, 1) = 8) Then
     ActiveCell.Range("A1:A3").EntireRow.Insert
     ActiveCell.Offset(1, 1) = "Total Revenue"
     ActiveCell.Offset(0, 2) = "-------------------------"
     ActiveCell.Offset(0, 3) = "-------------------------"
     Range("D13:E15").NumberFormat = "General"
     ActiveCell.Offset(1, 2) = AcctBalA
     ActiveCell.Offset(1, 3) = AcctBalA
     ActiveCell.Offset(3, 0).Select
     GoTo Total
   Else
     Do While ActiveCell.Value <> "" And (Left(ActiveCell.Value, 1) = 4 Or Left(ActiveCell.Value, 1) = 8)
      AcctBalA = AcctBalA + ActiveCell.Offset(0, 2).Value
      CumBalA = CumBalA + ActiveCell.Offset(0, 3).Value
      ActiveCell.Offset(1, 0).Select
     Loop
      ActiveCell.Range("A1:A3").EntireRow.Insert
      ActiveCell.Offset(1, 1) = "Total Revenue"
      ActiveCell.Offset(0, 2) = "-------------------------"
      ActiveCell.Offset(0, 3) = "-------------------------"
      ActiveCell.Offset(1, 2) = AcctBalA
      ActiveCell.Offset(1, 3) = CumBalA
      AcctBalance = AcctBalance - AcctBalA
      CumBalance = CumBalance - CumBalA
      ActiveCell.Offset(3, 0).Select
   End If
Total:
       Do While ActiveCell.Value <> ""
       AcctExp = AcctExp + ActiveCell.Offset(0, 2).Value
       CumExp = CumExp + ActiveCell.Offset(0, 3).Value
       ActiveCell.Offset(1, 0).Select
       Loop
     ActiveCell.Range("A1:A3").EntireRow.Insert
     ActiveCell.Offset(1, 1) = "Total Expenses"
     ActiveCell.Offset(0, 2) = "-------------------------"
     ActiveCell.Offset(0, 3) = "-------------------------"
     ActiveCell.Offset(1, 2) = AcctExp
     ActiveCell.Offset(1, 3) = CumExp
     ActiveCell.Offset(3, 1) = "NET INCOME"
     ActiveCell.Offset(2, 2) = "-------------------------"
     ActiveCell.Offset(2, 3) = "-------------------------"
     ActiveCell.Offset(3, 2) = AcctBalA - AcctExp
     ActiveCell.Offset(3, 3) = CumBalA - CumExp
     ActiveCell.Offset(4, 2).NumberFormat = "@"
     ActiveCell.Offset(4, 2) = "============="
     ActiveCell.Offset(4, 3).NumberFormat = "@"
     ActiveCell.Offset(4, 3) = "============="
    ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 10
        .Bold = False
       End With
     Selection.RowHeight = 13
    Set Tbl = Selection
    Tbl.Offset(11, 0).Resize(Tbl.Rows.Count - 11).Select
     Selection.Columns("B:C").Select
     With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
     End With
    Selection.Columns("C:D").Select
     With Selection
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
     End With
 If Period(StartDate) - Period(FileDate) < 12 And Period(EndDate) - Period(FileDate) >= 12 Then
 Columns("E").EntireColumn.Delete
 End If
    Range("C8") = "From  " & Format(StartDate, "yyyy/mm/dd") & "  To  " & Format(EndDate, "yyyy/mm/dd")
    Range("B1").Value = Format(Date, "yyyy/mm/dd")
    Range("B2").Value = TimeValue(Now)
    Range("A1:F19").Select
    ActiveWindow.Zoom = True
    Cells(1, 1).Select
    Unload UserForm4
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    ActiveWindow.DisplayGridlines = False
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .RightHeader = "&""Arial,Regular""&10Page &P of &N"
         .PrintTitleRows = "$1:$11"
         .Zoom = False
         .FitToPagesWide = 1
         .FitToPagesTall = False
     End With
NoPrinter:
   ThisWorkbook.Worksheets("Income Statement").Visible = xlSheetVisible
    ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
    SheetName = "Income Statement"
    ThisWorkbook.Worksheets("Income Statement").Activate
    Range("A3").Select
     Application.ScreenUpdating = True
  Exit Sub
ErrorHandling:
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Income Statement").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of Income Statement." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub BalanceNewB(RunCode As String)
     Dim EndDate As Date, FileDate As Date, CurrentYearStart As Date, ReportDate As Date, YearEndDate As Date
     Dim Level As Long, ChecklineA As Long, ChecklineB As Long, LineNoA As Long, LineNoB As Long
     Dim Profit As Currency, ProfitOld As Currency, AcctBalance As Currency, AcctNo As String
     Dim AssetBal As Currency, LiaBal As Currency, CumSum As Currency
     Dim CheckRange As Range, AccountNo As Variant, I As Long
  Application.ScreenUpdating = False
   On Error GoTo ErrorHandling
   If RunCode = "Inv Rec" Then
    FileDate = MyBook.Worksheets("Raw Data").Range("A1").Value
    EndDate = UserForm4.TextBox2.Text
    Level = 5
    Unload UserForm4
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    UserForm8.Label7.BackColor = &H40C0&
    UserForm8.Label7.Caption = Chr(13) & "   Request under processing.  Please wait."
    UserForm8.Label7.Visible = True
    DoEvents
    GoTo InvReport
   ElseIf RunCode = "ARPRec" Then
    FileDate = MyBook.Worksheets("Raw Data").Range("A1").Value
    EndDate = UserForm34.TextBox1.Text
    Level = 5
    RunCode = "Inv Rec"
    GoTo InvReport
   ElseIf RunCode <> "GL" Then
    Call ReturnToMainMenu("")
    Exit Sub
   End If
  FileDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  YearEndDate = Year(FileDate - 1) + 1 & "/" & Month(FileDate - 1) & "/" & Day(FileDate - 1)
If MyBook.Worksheets("Raw Data").Range("A4").Value <> "" Then
   MyBook.Worksheets("Raw Data").Activate
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D3").End(xlDown).Select
    ReportDate = ActiveCell.Value
 ElseIf MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 ReportDate = YearEndDate
 Else
 ReportDate = Date
 End If
   ThisWorkbook.Worksheets("Balance Sheet").Activate
    UserForm4.ComboBox2.Clear
    For I = 1 To 5
     UserForm4.ComboBox2.AddItem I
    Next I
    UserForm4.ComboBox2.Value = "5"
   UserForm4.Caption = "Balance Sheet Reporting"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Width = 35
   UserForm4.ComboBox2.Visible = True
   UserForm4.ComboBox3.Visible = False
   UserForm4.ComboBox4.Visible = False
   UserForm4.Label1.Visible = False
   UserForm4.Label2.Visible = False
   UserForm4.Label3.Visible = True
   UserForm4.Label4.Visible = False
   UserForm4.Label5.Visible = False
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Caption = "Account Level : "
   UserForm4.Label7.Visible = True
   UserForm4.TextBox1.Visible = False
   If Month(ReportDate) <> 12 Then
     EndDate = Year(ReportDate) & "/" & Month(ReportDate) + 1 & "/1"
   Else
    EndDate = Year(ReportDate) + 1 & "/" & 1 & "/1"
   End If
   EndDate = EndDate - 1
   UserForm4.TextBox2.Visible = True
   UserForm4.TextBox2.Value = Format(EndDate, "yyyy/mm/dd")
   UserForm4.TextBox2.SetFocus
   UserForm4.Show
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
CheckInput:
  If IsDate(UserForm4.TextBox2.Text) = False Then
   UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "     Wrong Date !!!"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
   EndDate = UserForm4.TextBox2.Value
   Level = UserForm4.ComboBox2.ListIndex + 1
   If Level > 5 Or Level < 1 Then Level = 5
  If EndDate < FileDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "     Wrong Date !!!  The date entered is out of range"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
   Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
   End If
   End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  If YearEndDate < EndDate Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   End If
  End If
InvReport:
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A1").Select
    MyBook.Worksheets("Raw Data").Activate
  Profit = 0
  ProfitOld = 0
  If Range("D4") = "" Then
   ChecklineA = 1
   GoTo NoRawData
  End If
 If Period(EndDate) - Period(FileDate) > 11 Then
  CurrentYearStart = Year(FileDate) + 1 & "/" & Month(FileDate) & "/" & Day(FileDate)
  Do While Period(EndDate) - Period(CurrentYearStart) > 11
   CurrentYearStart = Year(CurrentYearStart) + 1 & "/" & Month(FileDate) & "/" & Day(FileDate)
  Loop
 End If
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Range("D4").Select
    LineNoA = 4
    LineNoB = 3
    ChecklineA = 1
    ChecklineB = 1
    If ActiveCell.Value < CurrentYearStart And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < CurrentYearStart And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
   If ActiveCell.Row > 33 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < CurrentYearStart And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   End If
     LineNoA = ActiveCell.Row
     LineNoB = LineNoA - 1
      ActiveCell.Offset(-1, 0).Select
   End If
    If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
   If ActiveCell.Row > LineNoB + 29 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   End If
     LineNoB = ActiveCell.Row - 1
   End If
 If LineNoA > 4 Then
   Worksheets("Raw Data").Activate
   Range(Cells(4, 4), Cells(LineNoA - 1, 9)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 7).Select
   With Selection
     .Columns("D").NumberFormat = "General"
     .Columns("D").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     .Columns("G").FormulaR1C1 = "=SUM(RC[-2]-RC[-1])"
     .Columns("G").Copy
     Range("E1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("F:G").ClearContents
   End With
 Range("D1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
    Range("D1").Select
    If Left(ActiveCell.Value, 1) < "4" Then
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
    ActiveCell.Offset(30, 0).Select
    Loop
  If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
    ActiveCell.Offset(1, 0).Select
    Loop
  End If
    ChecklineA = ActiveCell.Row
    End If
    If ActiveCell.Offset(1, 0).Value <> "" Then
    ActiveCell.End(xlDown).Select
    End If
    ChecklineB = ActiveCell.Row
  If ChecklineB >= ChecklineA Then
    ProfitOld = Application.Sum(Range(Cells(ChecklineA, 5), Cells(ChecklineB, 5))) * (-1)
    Range(Cells(ChecklineA, 5), Cells(ChecklineB, 5)).EntireRow.Delete
  End If
End If
  ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
 If Range("A1").Value <> "" Then
   If Range("A2").Value = "" Then
    Range("A2").Select
   Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
   End If
 End If
 If LineNoB >= LineNoA Then
   MyBook.Worksheets("Raw Data").Activate
   Range(Cells(LineNoA, 4), Cells(LineNoB, 9)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.Paste
    Application.CutCopyMode = False
 End If
NoRawData:
  ThisWorkbook.Worksheets("RunningDat").Activate
  Range("B1").Select
  If Range("B1").Value <> "" Then
   If Range("B2").Value = "" Then
    Range("B2").Select
   Else
    Range("B1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
   End If
 End If
  Worksheets("Chart of Account").Activate
  Range(Cells(10, 1), Cells(LastRowChartofAccount, 2)).Copy
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveCell.Offset(0, -1).Value = "A"
  ActiveSheet.Paste
  Application.CutCopyMode = False
 Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(ChecklineA - 1, 0).Resize(Tbl.Rows.Count - ChecklineA + 1, 7).Select
   With Selection
     .Columns("D").NumberFormat = "General"
     .Columns("D").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     .Columns("G").FormulaR1C1 = "=SUM(RC[-2]-RC[-1])"
     .Columns("G").Copy
     Cells(ChecklineA, 5).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("F:G").ClearContents
   End With
    Cells(ChecklineA, 4).Select
    If Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> "" Then
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
    ActiveCell.Offset(30, 0).Select
    Loop
  If ActiveCell.Row > ChecklineA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
    ActiveCell.Offset(1, 0).Select
    Loop
   End If
    ChecklineA = ActiveCell.Row
    End If
    If ActiveCell.Offset(1, 0).Value <> "" Then
    ActiveCell.End(xlDown).Select
    End If
    ChecklineB = ActiveCell.Row
    Profit = Application.Sum(Range(Cells(ChecklineA, 5), Cells(ChecklineB, 5))) * (-1)
    Range(Cells(ChecklineA, 5), Cells(ChecklineB, 5)).EntireRow.Delete
    Cells(ChecklineA, 1).Select
  If MyBook.Worksheets("YearStartDat").Range("B2").Value <> "" Then
    MyBook.Worksheets("YearStartDat").Activate
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Copy
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.Paste
    Application.CutCopyMode = False
  End If
Set Tbl = ActiveSheet.UsedRange
    Tbl.Resize(Tbl.Rows.Count, 7).Select
   With Selection
     .Columns("D").NumberFormat = "General"
     .Columns("D").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     .Columns("G").FormulaR1C1 = "=SUM(RC[-2]-RC[-1])"
     .Columns("G").Copy
     Range("E1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
     Application.CutCopyMode = False
     .Columns("F:G").ClearContents
   End With
 Range("D1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
   Range("B1").Select
 Do While ActiveCell.Value <> ""
   AcctBalance = 0
  If Len(ActiveCell.Value) < Level Then
    AcctNo = ActiveCell.Value
    LineNoA = ActiveCell.Row
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
  If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
  End If
    LineNoB = ActiveCell.Row - 1
    AcctBalance = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5)))
    If AcctBalance = 0 Then
     Range(Cells(LineNoA, 5), Cells(LineNoB, 5)).EntireRow.Delete
     Cells(LineNoA, 2).Select
    Else
     Cells(LineNoA, 5) = AcctBalance
     If LineNoA < LineNoB Then
      Range(Cells(LineNoA + 1, 5), Cells(LineNoB, 5)).EntireRow.Delete
     End If
     Cells(LineNoA + 1, 2).Select
    End If
  ElseIf Len(ActiveCell.Value) = Level Then
     LineNoA = ActiveCell.Row
SameAcct:
     AcctNo = ActiveCell.Value
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
    Loop
 If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
  End If
    LineNoB = ActiveCell.Row - 1
   If Len(ActiveCell.Value) > Level Then
     GoTo SameAcct
    Else
    AcctBalance = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5)))
    If AcctBalance = 0 Then
     Range(Cells(LineNoA, 5), Cells(LineNoB, 5)).EntireRow.Delete
     Cells(LineNoA, 2).Select
    Else
     Cells(LineNoA, 5) = AcctBalance
     If LineNoA < LineNoB Then
       Range(Cells(LineNoA + 1, 5), Cells(LineNoB, 5)).EntireRow.Delete
     End If
     Cells(LineNoA + 1, 2).Select
    End If
   End If
  Else
    AcctNo = ActiveCell.Value
    LineNoA = ActiveCell.Row
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    LineNoB = ActiveCell.Row - 1
    AcctBalance = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5)))
    If AcctBalance = 0 Then
     Range(Cells(LineNoA, 5), Cells(LineNoB, 5)).EntireRow.Delete
     Cells(LineNoA, 2).Select
     Else
     Cells(LineNoA, 5) = AcctBalance
     If LineNoA < LineNoB Then
      Range(Cells(LineNoA + 1, 5), Cells(LineNoB, 5)).EntireRow.Delete
     End If
     Cells(LineNoA + 1, 2).Select
    End If
  End If
 Loop
 Columns("F:H").EntireColumn.ClearContents
 Columns("D").EntireColumn.Delete
 Worksheets("Chart of Account").Activate
 Set CheckRange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 Worksheets("Runningdat").Activate
    Range("B1").Select
     Do While ActiveCell.Value <> ""
      ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, 2).Value * AcctNature(ActiveCell.Value)
      AccountNo = ActiveCell.Value
      If IsError(Application.Match(AccountNo, CheckRange, 0)) = False Then
       I = Application.Match(AccountNo, CheckRange, 0) + 9
       ActiveCell.Offset(0, 1).Value = Worksheets("Chart of Account").Cells(I, 2).Value
      End If
      ActiveCell.Offset(1, 0).Select
     Loop
 If RunCode = "Inv Rec" Then Exit Sub
    Call BalanceSheetFormat("GL")
    ThisWorkbook.Worksheets("RunningDat").Activate
    If Range("B1").Value = "" Then GoTo FinishB
    Range("A1").Value = "A"
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(0, 1).Resize(Tbl.Rows.Count, Tbl.Columns.Count - 1).Copy
    ThisWorkbook.Worksheets("Balance Sheet").Activate
    Range("B12").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
  Range("B12").Select
FinishB:
     ThisWorkbook.Worksheets("Balance Sheet").Activate
     AssetBal = 0
     LiaBal = 0
     CumSum = 0
     Range("B12").Select
   If Selection.Offset(1, 0) <> "" Then
      Selection.End(xlDown).Select
      Selection.Offset(1, 0).Value = "  "
     Else
      Range("B13").Value = "  "
   End If
     Range("B12").Select
   If Left(ActiveCell.Value, 1) = 1 Then
     Do While ActiveCell.Value <> ""
     CumSum = CumSum + ActiveCell.Offset(0, 2).Value
     If Left(ActiveCell.Value, 1) <> 1 Then
     CumSum = CumSum - ActiveCell.Offset(0, 2).Value
     AssetBal = CumSum
     ActiveCell.Range("A1:A4").EntireRow.Insert
     ActiveCell.Offset(1, 1) = "Total Assets"
     ActiveCell.Offset(0, 2) = "-------------------------"
     ActiveCell.Offset(2, 2).NumberFormat = "@"
     ActiveCell.Offset(2, 2) = "============="
     ActiveCell.Offset(1, 2) = AssetBal
     ActiveCell.Offset(4, 0).Select
     GoTo LiaSum
     End If
     ActiveCell.Offset(1, 0).Select
     Loop
   Else
     ActiveCell.Range("A1:A4").EntireRow.Insert
     ActiveCell.Offset(1, 1) = "Total Assets"
     ActiveCell.Offset(0, 2) = "-------------------------"
     ActiveCell.Offset(2, 2).NumberFormat = "@"
     ActiveCell.Offset(2, 2) = "============="
     ActiveCell.Offset(1, 2) = 0
     ActiveCell.Offset(4, 0).Select
     GoTo LiaSum
    End If
LiaSum:
   If Left(ActiveCell.Value, 1) = 2 Then
     Do While ActiveCell.Value <> ""
     CumSum = CumSum + ActiveCell.Offset(0, 2).Value
     If Left(ActiveCell.Value, 1) <> 2 Then
      CumSum = CumSum - ActiveCell.Offset(0, 2).Value
      LiaBal = CumSum - AssetBal
      ActiveCell.Range("A1:A4").EntireRow.Insert
      ActiveCell.Offset(1, 1) = "Total Liabilities"
      ActiveCell.Offset(0, 2) = "-------------------------"
      ActiveCell.Offset(2, 2) = "-------------------------"
      ActiveCell.Offset(1, 2) = LiaBal
      ActiveCell.Offset(4, 0).Select
      GoTo Total
     End If
      ActiveCell.Offset(1, 0).Select
     Loop
   Else
    ActiveCell.Range("A1:A4").EntireRow.Insert
      ActiveCell.Offset(1, 1) = "Total Liabilities"
      ActiveCell.Offset(0, 2) = "-------------------------"
      ActiveCell.Offset(2, 2) = "-------------------------"
      ActiveCell.Offset(1, 2) = 0
      ActiveCell.Offset(4, 0).Select
      GoTo Total
   End If
Total:
     Do While ActiveCell.Value <> ""
     CumSum = CumSum + ActiveCell.Offset(0, 2).Value
     ActiveCell.Offset(1, 0).Select
     Loop
  ActiveCell.Offset(-1, 0).EntireRow.Delete
     If Period(EndDate) - Period(FileDate) > 11 Then
      If Period(EndDate) - Period(FileDate) > 23 Then
        ActiveCell.Offset(1, 1) = "Previous Years Earnings"
       Else
        ActiveCell.Offset(1, 1) = "Previous Year Earnings"
       End If
     ActiveCell.Offset(1, 2) = ProfitOld
     ActiveCell.Offset(2, 2) = Profit
     Else
      ActiveCell.Offset(2, 2) = Profit
     End If
     ActiveCell.Offset(2, 1) = "Current Year Earnings"
     ActiveCell.Offset(3, 2) = "-------------------------"
     ActiveCell.Offset(4, 1) = "Total Equity"
     ActiveCell.Offset(4, 2) = CumSum - AssetBal - LiaBal + Profit + ProfitOld
     ActiveCell.Offset(5, 2) = "-------------------------"
     ActiveCell.Offset(6, 1) = "Total Liabilities plus Equity"
     ActiveCell.Offset(6, 2) = CumSum - AssetBal + ProfitOld + Profit
     ActiveCell.Offset(7, 2).NumberFormat = "@"
     ActiveCell.Offset(7, 2) = "============"
     LineNo = ActiveCell.Offset(7, 2).Row
     ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 10
        .Bold = False
       End With
     Selection.RowHeight = 13
    Range("B" & 12 & ":C" & LineNo).Select
     With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
    End With
    Selection.Columns("C").Select
     With Selection
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
    Range("C8") = "As at  " & Format(EndDate, "yyyy/mm/dd")
    Range("B1").Value = Format(Date, "yyyy/mm/dd")
    Range("B2").Value = TimeValue(Now)
    On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.984251968503937)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
   On Error GoTo ErrorHandling
    Range("A1:E19").Select
    ActiveWindow.Zoom = True
    Cells(1, 1).Select
    ActiveWindow.DisplayGridlines = False
    Unload UserForm4
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    ThisWorkbook.Worksheets("Balance Sheet").Visible = xlSheetVisible
    ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
    SheetName = "Balance Sheet"
   ThisWorkbook.Worksheets("Balance Sheet").Activate
   Range("A3").Select
    Application.ScreenUpdating = True
   Exit Sub
ErrorHandling:
   If RunCode = "Inv Rec" Then
    RunCode = "Error"
    Exit Sub
   End If
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Balance Sheet").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of Balance Sheet" & Chr(13) & Chr(13) & _
    "Data file may probably be lack of space for the report." & Chr(13) & _
    "Please proceed 'Year End Update' to remove old data for previous years")
End Sub
Sub YearEndUpdate(RunCode As String)
     Dim YearNum As Long, ProfitAcct As Long, ComEndMonth As Long, MonthNum As String, FileExtNo As Long
     Dim ProfitAcctName As String, YearConfirm As String, AcctCode As String, FilePath As String, NewFileName As String, YearEndName As String
     Dim Profit As Currency, OldFileName As String, LineNoA As Long, LineNoB As Long, AcctNo As String, RowCount As Long, FailCode As Long
     Dim Tbl As Range, YearStart As Date, FileDate As Date, MonthCode(12) As String, MonthCount As Long, I As Long
     Dim myFSO As Object, FileNameLength As Long, JournalA As Long, JournalB As Long, DataRange As Range, JournalCode As String
     Dim COARange As Range, AccountNo As Variant, J As Long, AcctBalance As Currency, AcctSum As Currency
     Dim InvSheet As Long, InvDate As Long, ShName As String
  Application.ScreenUpdating = False
 If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
     MyBook.Worksheets("Raw Data").Activate
     YearNum = Year(Range("A1").Value - 1)
     FilePath = ThisWorkbook.Worksheets("ComFactSheet").Range("A18").Value
     OldFileName = ThisWorkbook.Worksheets("ComFactSheet").Range("B18").Value
     DExtn = ThisWorkbook.Worksheets("ComFactSheet").Range("C18").Value
     ComEndMonth = MyBook.Worksheets("ComData").Range("B6").Value
     Select Case ComEndMonth
     Case 1
     YearConfirm = "January"
     MonthNum = "Jan, "
     Case 2
     YearConfirm = "February"
     MonthNum = "Feb, "
     Case 3
     YearConfirm = "March"
     MonthNum = "Mar, "
     Case 4
     YearConfirm = "April"
     MonthNum = "Apr, "
     Case 5
     YearConfirm = "May"
     MonthNum = "May, "
     Case 6
     YearConfirm = "June"
     MonthNum = "Jun, "
     Case 7
     YearConfirm = "July"
     MonthNum = "Jul, "
     Case 8
     YearConfirm = "August"
     MonthNum = "Aug, "
      Case 9
     YearConfirm = "September"
     MonthNum = "Sept, "
     Case 10
     YearConfirm = "October"
     MonthNum = "Oct, "
     Case 11
     YearConfirm = "November"
     MonthNum = "Nov, "
     Case 12
     YearConfirm = "December"
     MonthNum = "Dec, "
     End Select
   UserForm4.Caption = "Year End Updating"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Visible = False
   UserForm4.ComboBox3.Visible = False
   UserForm4.ComboBox4.Visible = False
   UserForm4.Label1.BackColor = &H4000&
   UserForm4.Label1.Visible = True
   UserForm4.Label1.Caption = Chr(13) & "    Posting for year ended " & YearConfirm & " , " & YearNum + 1
   UserForm4.Label2.Visible = False
   UserForm4.Label3.Visible = False
   UserForm4.Label4.Visible = False
   UserForm4.Label5.Visible = False
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Visible = False
   UserForm4.TextBox1.Visible = False
   UserForm4.TextBox2.Visible = False
   UserForm4.CommandButton1.SetFocus
   UserForm4.Show
   If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
  If MyBook.Worksheets("Raw Data").Range("A4") = "" Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "         No Data.   Year End Update is not going to proceed"
    UserForm4.CommandButton2.Visible = False
    UserForm4.CommandButton1.Caption = "Close"
    UserForm4.Show
    If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
    Unload UserForm4
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Call ReturnToMainMenu("")
    Exit Sub
   End If
     MyBook.Worksheets("ComData").Activate
     Range("E1").Select
     RowCount = 1
     I = 1
    If ComEndMonth = 12 Then ComEndMonth = 0
   Do While RowCount < 13
   If ActiveCell.Value = "" Then
      MonthCount = RowCount + ComEndMonth
     If MonthCount > 12 Then MonthCount = MonthCount - 12
     Select Case MonthCount
     Case 1
     YearConfirm = "Jan, "
     Case 2
     YearConfirm = "Feb, "
     Case 3
     YearConfirm = "Mar, "
     Case 4
     YearConfirm = "Apr, "
     Case 5
     YearConfirm = "May, "
     Case 6
     YearConfirm = "Jun, "
     Case 7
     YearConfirm = "Jul, "
     Case 8
     YearConfirm = "Aug, "
      Case 9
     YearConfirm = "Sept, "
     Case 10
     YearConfirm = "Oct, "
     Case 11
     YearConfirm = "Nov, "
     Case 12
     YearConfirm = "Dec, "
     End Select
     MonthCode(I) = YearConfirm
     I = I + 1
   End If
     RowCount = RowCount + 1
   ActiveCell.Offset(1, 0).Select
  Loop
  If MonthCode(1) <> "" Then
  UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
     UserForm4.Label1.Caption = "ALERT!!  No Data for " & MonthCode(1) & MonthCode(2) & MonthCode(3) & MonthCode(4) _
        & MonthCode(5) & MonthCode(6) & MonthCode(7) & MonthCode(8) & MonthCode(9) & MonthCode(10) & _
        MonthCode(11) & MonthCode(12) & " Click to Proceed or Cancel."
    UserForm4.CommandButton2.Visible = True
    UserForm4.Show
    If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
  End If
    MyBook.Sheets(1).Activate
    FailCode = 6
    On Error GoTo UpdateFail
    Application.DisplayAlerts = False
    MyBook.Save
    Application.DisplayAlerts = True
    FailCode = 7
   MyBook.Worksheets("Raw Data").Activate
    FileDate = Range("A1").Value
    YearStart = Year(FileDate) + 1 & "/" & Month(FileDate) & "/" & Day(FileDate)
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D4").Select
   If ActiveCell.Value < YearStart And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < YearStart And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < YearStart And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
   End If
     ActiveCell.EntireRow.Insert
     If ActiveCell.Offset(1, 0).Value <> "" Then ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
 End If
    Range("D4").Select
    Worksheets("ComData").Range("B14").Value = "Year End File"
    Sheets(1).Activate
    FileNameLength = Len(OldFileName)
    If FileNameLength > 4 Then
     YearEndName = Left(OldFileName, FileNameLength - 4) & "YearEnded " & YearNum + 1
    Else
     YearEndName = OldFileName & "-" & "YearEnded " & YearNum + 1
    End If
  FailCode = 1
   Set myFSO = CreateObject("Scripting.FileSystemObject")
    Application.DisplayAlerts = False
   If myFSO.FileExists(FilePath & YearEndName & DExtn) = True Then
      FileExtNo = 1
      Do While myFSO.FileExists(FilePath & YearEndName & "-" & FileExtNo & ".bak") = True
       FileExtNo = FileExtNo + 1
      Loop
    Name FilePath & YearEndName & DExtn As FilePath & YearEndName & "-" & FileExtNo & ".bak"
    myFSO.GetFile(FilePath & YearEndName & "-" & FileExtNo & ".bak").Attributes = 2
   End If
   FailCode = 2
  If DExtn = ".xlsm" Then
    ActiveWorkbook.SaveAs FilePath & YearEndName & DExtn, FileFormat:=52
   Else
    If Val(Application.Version) < 12 Then
      ActiveWorkbook.SaveAs FilePath & YearEndName & DExtn
    Else
      ActiveWorkbook.SaveAs FilePath & YearEndName & DExtn, FileFormat:=xlExcel8
    End If
  End If
  Application.DisplayAlerts = False
  ActiveWorkbook.Close (False)
  FailCode = 3
   Application.Workbooks.Open FilePath & OldFileName & DExtn
   Application.DisplayAlerts = True
   Set MyBook = Workbooks(OldFileName & DExtn)
   MyBook.Activate
   If MyBook.ReadOnly Then GoTo UpdateFail
   FailCode = 7
     ProfitAcct = Worksheets("YearStartDat").Range("D1").Value + 1
     If ProfitAcct < 3612 Then ProfitAcct = 3612
     ProfitAcctName = "P/L for the year ended " & MonthNum & YearNum + 1
  Worksheets("Chart of account").Activate
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(9, 0).Resize(Tbl.Rows.Count - 9).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("A10").Select
   Do While ActiveCell.Value <= ProfitAcct And ActiveCell.Value <> ""
   If ActiveCell.Value = ProfitAcct Then
   ProfitAcct = ProfitAcct + 1
   End If
   ActiveCell.Offset(1, 0).Select
   Loop
 Cells(Rows.Count, 1).End(xlUp).Select
 ActiveCell.Offset(1, 0).HorizontalAlignment = xlLeft
 ActiveCell.Offset(1, 0).Value = ProfitAcct
 ActiveCell.Offset(1, 1).Value = ProfitAcctName
 ActiveCell.Offset(1, 2).Value = "Capital"
 ActiveCell.Offset(1, 3).HorizontalAlignment = xlCenter
 ActiveCell.Offset(1, 3).Value = 4
 ActiveCell.Offset(1, 6).Value = "Y"
 Set Tbl = ActiveSheet.UsedRange
   Tbl.Offset(9, 0).Resize(Tbl.Rows.Count - 9, Tbl.Columns.Count + 4).Select
   With Selection
       .Columns("H").NumberFormat = "General"
       .Columns("H").FormulaR1C1 = "=LEFT(RC[-7] & ""*******"",7)"
       .Sort Key1:=Range("H1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 Range("H10").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -7).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
     Tbl.Columns("H").EntireColumn.ClearContents
  Select Case Month(Date)
     Case 1
     C = "January"
     Case 2
     C = "February"
     Case 3
     C = "March"
     Case 4
     C = "April"
     Case 5
     C = "May"
     Case 6
     C = "June"
     Case 7
     C = "July"
     Case 8
     C = "August"
     Case 9
     C = "September"
     Case 10
     C = "October"
     Case 11
     C = "November"
     Case 12
     C = "December"
     End Select
  Range("A1").Value = "Last Update: " & C & " " & Day(Date) & ", " & Year(Date)
  ThisWorkbook.Worksheets("RunningDat").UsedRange.EntireRow.Delete
  MyBook.Worksheets("Raw Data").Activate
   Range("D4").Select
 If ActiveCell.Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D4").Select
   If ActiveCell.Value < YearStart And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < YearStart And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < YearStart And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
    LineNoA = ActiveCell.Row - 1
    Range(Cells(4, 4), Cells(LineNoA, 9)).Copy
    ThisWorkbook.Worksheets("RunningDat").Activate
      Range("A1").Select
      ActiveSheet.Paste
      Application.CutCopyMode = False
      MyBook.Worksheets("Raw Data").Activate
      Range(Cells(4, 4), Cells(LineNoA, 9)).EntireRow.Delete
   End If
  End If
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
   If ActiveCell.Value <> "" Then
    If ActiveCell.Offset(1, 0).Value <> "" Then
      ActiveCell.End(xlDown).Select
      ActiveCell.Offset(1, 0).Select
    Else
     Range("A2").Select
    End If
   End If
   If MyBook.Worksheets("YearStartDat").Range("B2").Value <> "" Then
      MyBook.Worksheets("YearStartDat").Activate
     Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Copy
     ThisWorkbook.Worksheets("RunningDat").Activate
     ActiveSheet.Paste
     Application.CutCopyMode = False
    End If
 If Range("A1").Value = "" Then GoTo NoBalance
   Set Tbl = ActiveSheet.UsedRange
   With Tbl
       .Columns("D").NumberFormat = "General"
       .Columns("D").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
       .Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Key2:=Range("A1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 Range("D1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
  Range("D1").Select
    If Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> "" Then
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
    ActiveCell.Offset(30, 0).Select
    Loop
   If ActiveCell.Row > 30 Then
    ActiveCell.Offset(-29, 0).Select
    Do While Left(ActiveCell.Value, 1) < "4" And ActiveCell.Value <> ""
    ActiveCell.Offset(1, 0).Select
    Loop
   End If
    LineNoA = ActiveCell.Row
    End If
   Range("B1").Select
   If ActiveCell.Offset(1, 0).Value <> "" Then
    ActiveCell.End(xlDown).Select
    LineNoB = ActiveCell.Row
   Else
    LineNoB = 1
   End If
   Profit = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5)))
   Profit = Profit - Application.Sum(Range(Cells(LineNoA, 6), Cells(LineNoB, 6)))
   Range(Cells(LineNoA, 1), Cells(LineNoB, 1)).EntireRow.Delete
   Cells(LineNoA, 5).Value = Format(Profit, "0.00")
   Cells(LineNoA, 3).Value = ProfitAcctName
   Cells(LineNoA, 2).Value = ProfitAcct
   Cells(LineNoA, 4).Value = Left(ProfitAcct & "*******", 7)
 ActiveSheet.UsedRange.Sort Key1:=Range("D1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Range("D1").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Offset(0, -2).Value = ""
  ActiveCell.EntireRow.Delete
 Loop
   Range("B1").Select
 Do While ActiveCell.Value <> ""
   AcctBalance = 0
    AcctNo = ActiveCell.Value
    LineNoA = ActiveCell.Row
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(30, 0).Select
    Loop
  If ActiveCell.Row > LineNoA + 29 Then
    ActiveCell.Offset(-29, 0).Select
    Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
    Loop
  End If
    LineNoB = ActiveCell.Row - 1
    AcctBalance = Application.Sum(Range(Cells(LineNoA, 5), Cells(LineNoB, 5))) - Application.Sum(Range(Cells(LineNoA, 6), Cells(LineNoB, 6)))
    If AcctBalance = 0 Then
     Range(Cells(LineNoA, 5), Cells(LineNoB, 5)).EntireRow.Delete
     Cells(LineNoA, 2).Select
    Else
     Cells(LineNoA, 5) = Format(AcctBalance, "0.00")
     Cells(LineNoA, 6) = ""
     If LineNoA < LineNoB Then
      Range(Cells(LineNoA + 1, 5), Cells(LineNoB, 5)).EntireRow.Delete
     End If
     Cells(LineNoA + 1, 2).Select
    End If
  Loop
 Columns("F:H").EntireColumn.ClearContents
 Columns("D").EntireColumn.Delete
  Range("B1").Select
  If ActiveCell.Value = "" Then
   MyBook.Worksheets("YearStartDat").Activate
   Range("A2").Select
   If ActiveCell.Value <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).EntireRow.Delete
   End If
   GoTo NoBalance
  End If
   MyBook.Worksheets("YearStartDat").Activate
   Range("A2").Select
   If ActiveCell.Value <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).EntireRow.Delete
   End If
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Value = "A"
    ActiveSheet.UsedRange.Copy
   MyBook.Worksheets("YearStartDat").Activate
   Range("A2").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Worksheets("Chart of Account").Activate
    Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
    MyBook.Worksheets("YearStartDat").Activate
     Range("B2").Select
    Do While ActiveCell.Value <> ""
     AccountNo = ActiveCell.Value
     If IsError(Application.Match(AccountNo, COARange, 0)) = False Then
       J = Application.Match(AccountNo, COARange, 0) + 9
       ActiveCell.Offset(0, 1).Value = Worksheets("Chart of Account").Cells(J, 2).Value
     End If
     AcctSum = ActiveCell.Offset(0, 2).Value
     If AcctSum > 0 Then
      ActiveCell.Offset(0, 3).Value = Format(AcctSum, "0.00")
      ActiveCell.Offset(1, 0).Select
     ElseIf AcctSum < 0 Then
      ActiveCell.Offset(0, 4).Value = Format(AcctSum * (-1), "0.00")
      ActiveCell.Offset(1, 0).Select
     Else
      Selection.EntireRow.Delete
     End If
    Loop
   I = ActiveCell.Row - 1
    If I < 2 Then GoTo NoBalance
    Range(Cells(2, 1), Cells(I, 6)).Select
   With Selection
       .Columns("A").NumberFormat = "yyyy/mm/dd"
       .Columns("A").Value = YearStart - 1
       .Columns("D").ClearContents
       .Columns("E:F").NumberFormat = "#,##0.00"
   End With
NoBalance:
    MyBook.Worksheets("Receivable").Activate
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlDescending, Key2:=Range("M1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("J4").Select
  If ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184 Then
     Do While ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184
      ActiveCell.Offset(1, 0).Select
     Loop
    I = ActiveCell.Row - 1
    If I > 3 Then
     Range(Cells(4, 1), Cells(I, 5)).EntireRow.Delete
    End If
  End If
    Range("D4").Select
 End If
 
   Worksheets("PayRec").Activate
   If Range("A3").Value <> "" Then
    LineNoB = ActiveSheet.UsedRange.Rows.Count
    Set Tbl = Range(Cells(3, 1), Cells(LineNoB, 17))
    Tbl.Columns("Q").FormulaR1C1 = "=CONCATENATE(RC[-2],""A"")"
    Tbl.Sort Key1:=Range("Q1"), Order1:=xlAscending, Key2:=Range("N1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Tbl.Columns("Q").ClearContents
     
    If Range("O3").Value = "" Then
     LineNoA = 3
    ElseIf Range("O4").Value = "" Then
     LineNoA = 4
    Else
      Range("O3").End(xlDown).Select
      LineNoA = ActiveCell.Row + 1
    End If
    If LineNoA <= LineNoB Then
      Range(Cells(LineNoA, 1), Cells(LineNoB, 15)).Select
      Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
      InvDate = CDate(YearStart - 185)
      Set Tbl = Selection.Columns("B")
      If IsError(Application.Match(InvDate, Tbl, 1)) = False Then
       I = Application.Match(InvDate, Tbl, 1) + LineNoA - 1
       Range(Cells(LineNoA, 1), Cells(I, 15)).EntireRow.Delete
      End If
    End If
    If LineNoA > 3 Then
     Set Tbl = Range(Cells(3, 14), Cells(LineNoA - 1, 14))
      InvDate = CDate(YearStart - 185)
      If IsError(Application.Match(InvDate, Tbl, 1)) = False Then
       I = Application.Match(InvDate, Tbl, 1) + 2
       Range(Cells(3, 1), Cells(I, 15)).EntireRow.Delete
      End If
    End If
   End If
   Range("B3").Select
   Worksheets("PORecord").Activate
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlDescending, Key2:=Range("M1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("J4").Select
   If ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184 Then
     Do While ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184
      ActiveCell.Offset(1, 0).Select
     Loop
    I = ActiveCell.Row - 1
    If I > 3 Then Range(Cells(4, 1), Cells(I, 5)).EntireRow.Delete
   End If
    Range("D4").Select
 End If
  If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlDescending, Key2:=Range("K1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Set DataRange = Selection.Columns("J")
   If IsError(Application.Match("R", DataRange, 0)) = False Then
    LineNoA = Application.Match("R", DataRange, 0) + 3
    Cells(LineNoA, 10).Select
    Do While ActiveCell.Value = "R" And ActiveCell.Offset(0, 1).Value < 0.005
     If Abs(ActiveCell.Offset(0, 1).Value) < 0.005 Then
       If ActiveCell.Offset(0, 3).Value = "" Then
        ActiveCell.Offset(0, 3).NumberFormat = "yyyy/mm/dd"
        ActiveCell.Offset(0, 3).Value = YearStart
        ActiveCell.Value = "S"
       ElseIf ActiveCell.Offset(0, 3).Value < YearStart Then
        ActiveCell.Value = "S"
       End If
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    Range("D4").Select
 End If
    Worksheets("Payable").Activate
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlDescending, Key2:=Range("M1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("J4").Select
   If ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184 Then
     Do While ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value >= "S" And ActiveCell.Value <> "" And ActiveCell.Offset(0, 3).Value < YearStart - 184
      ActiveCell.Offset(1, 0).Select
     Loop
    I = ActiveCell.Row - 1
    If I > 3 Then Range(Cells(4, 1), Cells(I, 5)).EntireRow.Delete
   End If
    Range("D4").Select
 End If
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("V1"), Order1:=xlDescending, Key2:=Range("K1"), Order2:=xlAscending, _
     Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Set DataRange = Selection.Columns("V")
   If IsError(Application.Match("R", DataRange, 0)) = False Then
    LineNoA = Application.Match("R", DataRange, 0) + 3
    Cells(LineNoA, 22).Select
    Do While ActiveCell.Value = "R" And ActiveCell.Offset(0, -11).Value < 0.005
     If Abs(ActiveCell.Offset(0, -11).Value) < 0.005 Then
       If ActiveCell.Offset(0, -9).Value = "" Then
        ActiveCell.Offset(0, -9).NumberFormat = "yyyy/mm/dd"
        ActiveCell.Offset(0, -9).Value = YearStart
        ActiveCell.Offset(0, -12).Value = "S"
       ElseIf ActiveCell.Offset(0, -9).Value < YearStart Then
         ActiveCell.Offset(0, -12).Value = "S"
       End If
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
    Range("D4").Select
 End If
 
   Worksheets("PayMake").Activate
   If Range("A3").Value <> "" Then
    LineNoB = ActiveSheet.UsedRange.Rows.Count
   Set Tbl = Range(Cells(3, 1), Cells(LineNoB, 17))
   Tbl.Columns("Q").FormulaR1C1 = "=CONCATENATE(RC[-1],""A"")"
   Tbl.Sort Key1:=Range("Q1"), Order1:=xlAscending, Key2:=Range("O1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Tbl.Columns("Q").ClearContents
     
    If Range("P3").Value = "" Then
     LineNoA = 3
    ElseIf Range("P4").Value = "" Then
     LineNoA = 4
    Else
      Range("P3").End(xlDown).Select
      LineNoA = ActiveCell.Row + 1
    End If
    If LineNoA <= LineNoB Then
      Range(Cells(LineNoA, 1), Cells(LineNoB, 16)).Select
      Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
      InvDate = CDate(YearStart - 185)
      Set Tbl = Selection.Columns("B")
      If IsError(Application.Match(InvDate, Tbl, 1)) = False Then
       I = Application.Match(InvDate, Tbl, 1) + LineNoA - 1
       Range(Cells(LineNoA, 1), Cells(I, 16)).EntireRow.Delete
      End If
    End If
    If LineNoA > 3 Then
     Set Tbl = Range(Cells(3, 15), Cells(LineNoA - 1, 15))
      InvDate = CDate(YearStart - 185)
      If IsError(Application.Match(InvDate, Tbl, 1)) = False Then
       I = Application.Match(InvDate, Tbl, 1) + 2
       Range(Cells(3, 1), Cells(I, 16)).EntireRow.Delete
      End If
    End If
   End If
   Range("B3").Select
   Worksheets("IOData").Activate
 If Range("A2").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
   If ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 31 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
    I = ActiveCell.Row - 1
    If I > 1 Then Range(Cells(2, 1), Cells(I, 3)).EntireRow.Delete
   End If
    Range("A2").Select
 End If
  Worksheets("InvDetail1").Activate
  FileDate = YearStart - 1
  Range("D1").Value = FileDate
  InvDate = CDate(FileDate)
  InvSheet = Range("B1").Value
  I = InvSheet
  Do While I > 1
   ShName = "InvDetail" & I
   Worksheets(ShName).Activate
   If Range("H2").Value <= FileDate Then
     Application.DisplayAlerts = False
     ActiveSheet.Visible = xlSheetVisible
     ActiveSheet.Delete
     Application.DisplayAlerts = True
     InvSheet = InvSheet - 1
   Else
    Exit Do
   End If
   I = I - 1
  Loop
  Worksheets("InvDetail1").Activate
  Range("B1").Value = InvSheet
  ShName = "InvDetail" & InvSheet
  Worksheets(ShName).Activate
  Range("E2").End(xlToRight).Select
  I = ActiveCell.Column
  If I > 7 Then
   If Cells(2, 8).Value <= FileDate Then
    Range(Cells(2, 8), Cells(2, I)).EntireColumn.Delete
   Else
    Set DataRange = Range(Cells(2, 8), Cells(2, I))
    If IsError(Application.Match(InvDate, DataRange, -1)) = False Then
     J = Application.Match(InvDate, DataRange, -1) + 8
     If Cells(2, J - 1).Value = FileDate Then J = J - 1
     If I >= J Then Range(Cells(2, J), Cells(2, I)).EntireColumn.Delete
    End If
   End If
  End If
 For I = 1 To InvSheet
  ShName = "InvDetail" & I
  Worksheets(ShName).Activate
  If Range("A3").Value <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, Key3:=Range("C1"), Order3:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
      Range("D3").Select
      If ActiveCell.Value <> "" And ActiveCell.Value <= FileDate Then
       Do While ActiveCell.Value <> "" And ActiveCell.Value <= FileDate
        ActiveCell.Offset(1, 0).Select
       Loop
       J = ActiveCell.Row - 1
       If J > 2 Then
        Range(Cells(3, 1), Cells(J, 4)).EntireRow.Delete
       End If
      End If
    If Range("A3").Value <> "" Then
      Set Tbl = ActiveSheet.UsedRange
      Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
     Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    End If
    Range("G1").Select
  End If
 Next I
    Worksheets("BuildRec").Activate
 If Range("A4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B4").Select
   If ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
    I = ActiveCell.Row - 1
    If I > 2 Then Range(Cells(3, 1), Cells(I, 3)).EntireRow.Delete
   End If
    Range("A4").Select
 End If
    Worksheets("StockAdRec").Activate
 If Range("A3").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B3").Select
   If ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 32 Then
     ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < YearStart - 366 And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
    End If
    I = ActiveCell.Row - 1
    If I > 2 Then Range(Cells(3, 1), Cells(I, 3)).EntireRow.Delete
   End If
    Range("A3").Select
 End If
   Worksheets("CountRec").Activate
   Range("A4").Select
  Do While ActiveCell.Value <> "" And ActiveCell.Value < YearStart - 366
    If ActiveCell.Value < YearStart - 366 Then
      ActiveCell.Columns("A:G").EntireColumn.Delete
    Else
      ActiveCell.Offset(0, 7).Select
    End If
    If ActiveCell.Column > 251 Then Exit Do
  Loop
  Worksheets("Raw Data").Range("A1").Value = YearStart
  Worksheets("Raw Data").Range("F1").Value = Worksheets("Raw Data").Range("F1").Value + 1
  Worksheets("Raw Data").Range("B1").ClearContents
  Worksheets("YearStartDat").Range("D1").Value = ProfitAcct
  Worksheets("ComData").Activate
  Columns("E").Select
  Selection.Resize(Selection.Rows.Count - 12, 1).Offset(12, 0).Cut
  Range("E1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
  Range("F1").Select
  
   If Worksheets("Raw Data").Range("A4").Value = "" Then
       Worksheets("ComData").Activate
       Range("G250").Select
       If ActiveCell.Offset(1, 0).Value <> "" Then
         Range("G250:H250").Select
         Range(Selection, Selection.End(xlDown)).ClearContents
       Else
         Range("G250:H250").ClearContents
       End If
       Range("G250").Value = "JV" & Year(YearStart)
       Range("H250").Value = "00000"
      GoTo NoJournalRecord
    End If
    If Worksheets("Raw Data").Range("A5").Value = "" Then
      Worksheets("ComData").Range("G250").Value = Worksheets("Raw Data").Range("A4").Value
      Worksheets("ComData").Range("H250").Value = Worksheets("Raw Data").Range("B4").Value
     Else
     Worksheets("Raw Data").Activate
     Range("A4").Select
     Selection.End(xlDown).Select
     JournalA = ActiveCell.Row
     Set DataRange = Worksheets("Raw Data").Range(Cells(4, 1), Cells(JournalA, 1))
     Worksheets("ComData").Activate
     Range("G250").Select
      Do While ActiveCell.Value <> ""
       JournalCode = ActiveCell.Value
       If IsError(Application.Match(JournalCode, DataRange, 0)) Then Range(ActiveCell, ActiveCell.Offset(0, 1)).ClearContents
       ActiveCell.Offset(1, 0).Select
      Loop
     JournalB = ActiveCell.Row
     Range(Cells(250, 7), Cells(JournalB, 8)).Select
      Selection.Sort Key1:=Range("G250"), Order1:=xlDescending, Header:=xlNo _
        , OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
     End If
     Range("A16").Select
NoJournalRecord:
  MyBook.Sheets(1).Activate
   YearNum = Year(YearStart)
   FileNameLength = Len(OldFileName)
   If FileNameLength > 4 Then
     NewFileName = Left(OldFileName, FileNameLength - 4) & YearNum
    If NewFileName = OldFileName Then NewFileName = Left(OldFileName, FileNameLength - 4) & "1-" & YearNum
   Else
     NewFileName = OldFileName & "-" & YearNum
   End If
   FailCode = 4
   Set myFSO = CreateObject("Scripting.FileSystemObject")
    Application.DisplayAlerts = False
   If myFSO.FileExists(FilePath & NewFileName & DExtn) = True Then
      FileExtNo = 1
      Do While myFSO.FileExists(FilePath & NewFileName & "-" & FileExtNo & ".bak") = True
       FileExtNo = FileExtNo + 1
      Loop
    Name FilePath & NewFileName & DExtn As FilePath & NewFileName & "-" & FileExtNo & ".bak"
    myFSO.GetFile(FilePath & NewFileName & "-" & FileExtNo & ".bak").Attributes = 2
   End If
  FailCode = 5
  If DExtn = ".xlsm" Then
    ActiveWorkbook.SaveAs FilePath & NewFileName & DExtn, FileFormat:=52
  Else
    If Val(Application.Version) < 12 Then
      ActiveWorkbook.SaveAs FilePath & NewFileName & DExtn
    Else
      ActiveWorkbook.SaveAs FilePath & NewFileName & DExtn, FileFormat:=xlExcel8
    End If
  End If
  Application.DisplayAlerts = True
  Set MyBook = ActiveWorkbook
    On Error Resume Next
    Application.DisplayAlerts = False
    FileExtNo = 1
    Do While myFSO.FileExists(FilePath & OldFileName & "-" & FileExtNo & ".bak") = True
     FileExtNo = FileExtNo + 1
    Loop
    Name FilePath & OldFileName & DExtn As FilePath & OldFileName & "-" & FileExtNo & ".bak"
   myFSO.GetFile(FilePath & OldFileName & "-" & FileExtNo & ".bak").Attributes = 2
   Application.DisplayAlerts = True
  On Error GoTo 0
  Call FoundChartofAccountRange("")
  ThisWorkbook.Worksheets("ComFactSheet").Activate
  Range("A18").Value = FilePath
  Range("B18").Value = NewFileName
  Range("C18").Value = DExtn
  Range("A17").Value = FilePath
  Range("B17").Value = NewFileName
  Range("C17").Value = DExtn
  Range("B21").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = OldFileName Then Exit Do
   ActiveCell.Offset(1, 0).Select
  Loop
    ActiveCell.Value = NewFileName
    ActiveCell.Offset(0, -1).Value = FilePath
    ActiveCell.Offset(0, 1).Value = DExtn
  Range("B21").Select
  If Range("B21").Value <> "" Then
   Range("B20").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
  End If
    ActiveCell.NumberFormat = "@"
    ActiveCell.Offset(0, -1).NumberFormat = "@"
    ActiveCell.Offset(0, 1).NumberFormat = "@"
    ActiveCell.Value = YearEndName
    ActiveCell.Offset(0, -1).Value = FilePath
    ActiveCell.Offset(0, 1).Value = DExtn
   EventOff = False
   Worksheets("System Menu").Activate
   EventOff = True
   Range("C4").Value = NewFileName
   Range("C5").Value = FilePath
  On Error Resume Next
  ThisWorkbook.Save
  On Error GoTo 0
  Application.ScreenUpdating = True
   UserForm4.Caption = "Year End Updating"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Visible = False
   UserForm4.ComboBox3.Visible = False
   UserForm4.ComboBox4.Visible = False
   UserForm4.Label2.Visible = False
   UserForm4.Label3.Visible = False
   UserForm4.Label4.Visible = False
   UserForm4.Label5.Visible = False
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Visible = False
   UserForm4.TextBox1.Visible = False
   UserForm4.TextBox2.Visible = False
   UserForm4.CommandButton1.SetFocus
   UserForm4.Label1.BackColor = &HFFFF&
   UserForm4.Label1.ForeColor = &H80000006
   UserForm4.Label1.Visible = True
   UserForm4.Label1.Caption = Chr(13) & "        Year-End Update completed"
   UserForm4.CommandButton1.Caption = "Close"
   UserForm4.CommandButton2.Visible = False
   DoEvents
   Application.EnableEvents = False
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   UserForm4.Show
    If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   Unload UserForm4
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.ScreenUpdating = True
    Range("C4").Activate
  Exit Sub
UpdateFail:
 Select Case FailCode
 Case 1
     Application.DisplayAlerts = False
      MyBook.Close (False)
     UserForm4.Label1.Caption = "     Error !!!  Year-End Update Fail" & Chr(13) & _
                              "     Cannot save to the Year-End file " & YearEndName
 Case 2
      Application.DisplayAlerts = False
      MyBook.Close (False)
      UserForm4.Label1.Caption = "     Error !!!  Year-End Update Fail" & Chr(13) & _
                              "     Cannot save to the Year-End file " & YearEndName
 Case 3
      UserForm4.Label1.Caption = "     Error !!!  Year-End Update Fail" & Chr(13) & _
                              "     Data file " & OldFileName & " is not available for update."
 Case 4
      Application.DisplayAlerts = False
      MyBook.Close (False)
      UserForm4.Label1.Caption = "     Error !!!  Year-End Update Fail" & Chr(13) & _
                              "     Cannot save to the data file " & NewFileName
 Case 5
      Application.DisplayAlerts = False
      MyBook.Close (False)
      UserForm4.Label1.Caption = "     Error !!!  Year-End Update Fail" & Chr(13) & _
                              "     Cannot save to the data file " & NewFileName
 Case 6
     UserForm4.Label1.Caption = "     Error !!!  Year-End Update Fail" & Chr(13) & _
                                "     Cannot save Data file."
 Case 7
     Application.DisplayAlerts = False
      MyBook.Close (False)
      UserForm4.Label1.Caption = "     System Error !!!  Year-End Update Fail"
 End Select
  Application.DisplayAlerts = True
   UserForm4.Label1.BackColor = &HC0&
   UserForm4.Label1.ForeColor = &HFFFF&
   UserForm4.Label1.Visible = True
   UserForm4.CommandButton1.Caption = "Close"
   UserForm4.CommandButton2.Visible = False
   UserForm4.Show
    If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
   Unload UserForm4
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    ThisWorkbook.Worksheets("System Menu").Activate
    Application.ScreenUpdating = True
    Range("C4").Activate
End Sub
Sub NewAddress(RunCode As String)
Dim Yek As String, SNum As String, CheckC As String, I As Long, Num As Long
Dim B1 As String, B2 As String, B3 As String, B4 As String, VersionType As Long, CD1 As String, CD2 As String
Dim A1 As Long, A2 As Long, A3 As Long, A4 As Long, A As Long, SoftType As String
Dim myFSO As Object, DriveCode As String, DriveSN As Long
 If RunCode <> "New" Then Exit Sub
 If UserForm1.Controls("TextBox" & 8).Text = "" Then
   MsgBox ("Sor" & "ry.  WR" & "ONG K" & "ey !!!" & Chr(13) & Chr(13) & "Please get the cor" & "rect K" & "ey and Re-" & "do Prod" & "uct acti" & "vation")
   Exit Sub
  End If
  EventOff = True
 ThisWorkbook.Worksheets("System Menu").Activate
I = Len(UserForm1.Controls("TextBox" & 8).Text)
If I < 9 Then
 If UCase(Worksheets("ComFactSheet").Cells(3, 13).Value) = UCase(UserForm1.Controls("TextBox" & 8).Text) Then
    Worksheets("ComFactSheet").Range("C2").Value = "Yes"
    Worksheets("ComFactSheet").Range("B10").Value = "Activated"
    Worksheets("ComFactSheet").Range("C16").ClearContents
    Worksheets("ComFactSheet").Cells(2, 13).Value = "Yes"
   On Error Resume Next
    DriveCode = Left(ThisWorkbook.Path, 1)
    DriveSN = 0
    Set myFSO = CreateObject("Scripting.FileSystemObject")
    DriveCode = myFSO.GetDrive(DriveCode).SerialNumber
   If Len(DriveCode) > 3 Then
    DriveSN = Val(Right(DriveCode, 3))
   Else
    DriveSN = Abs(Val(DriveCode))
   End If
  On Error GoTo 0
    Worksheets("ComFactSheet").Range("C11").Value = DriveSN
    Worksheets("ComFactSheet").Range("C3").Value = DriveSN
    If Worksheets("ComFactSheet").Range("B11").Value = "A000000" Then
    Worksheets("ComFactSheet").Cells(1, 13).Value = "Single-GL"
    Worksheets("ComFactSheet").Range("B16").Value = "Single-GL"
    End If
    Worksheets("System Menu").Range("G12").Value = ""
    Worksheets("System Menu").Range("G13").Value = ""
    Worksheets("System Menu").Range("B9:C10").ClearContents
    Worksheets("System Menu").CommandButton1.Visible = True
    Worksheets("System Menu").CommandButton2.Visible = True
    Worksheets("System Menu").CommandButton3.Visible = True
  On Error GoTo UpdateFail
    Worksheets("ComFactSheet").Range("DE123").Value = DriveSN
    Worksheets("ComFactSheet").Range("A17").Value = Worksheets("ComFactSheet").Range("A18").Value
    Worksheets("ComFactSheet").Range("B17").Value = Worksheets("ComFactSheet").Range("B18").Value
    Worksheets("ComFactSheet").Range("C17").Value = Worksheets("ComFactSheet").Range("C18").Value
    ThisWorkbook.Save
  On Error GoTo 0
     Unload UserForm1
     Application.ScreenUpdating = True
     DoEvents
     Application.EnableEvents = False
     ThisWorkbook.Worksheets("System Menu").Activate
     Application.EnableEvents = True
    MsgBox ("Product Activation successfully Completed")
  Else
   MsgBox ("Sor" & "ry.  WR" & "ONG K" & "ey !!!" & Chr(13) & Chr(13) & "Please get the cor" & "rect K" & "ey and Re-" & "do Prod" & "uct acti" & "vation")
  End If
Else
 Yek = Left(UserForm1.Controls("TextBox" & 8).Text, I - 5)
 I = Len(Yek)
 If Len(Worksheets("ComFactSheet").Range("M3").Value) < I Then
   MsgBox ("Sor" & "ry.  WR" & "ONG K" & "ey !!!" & Chr(13) & Chr(13) & "Please get the cor" & "rect K" & "ey and Re-" & "do Prod" & "uct acti" & "vation")
   EventOff = False
   Exit Sub
 End If
 If UCase(Yek) <> UCase(Left(Worksheets("ComFactSheet").Range("M3").Value, I)) Then
   MsgBox ("Sor" & "ry.  WR" & "ONG K" & "ey !!!" & Chr(13) & Chr(13) & "Please get the cor" & "rect K" & "ey and Re-" & "do Prod" & "uct acti" & "vation")
   EventOff = False
   Exit Sub
 End If
 SNum = UCase(Right(UserForm1.Controls("TextBox" & 8).Text, 5))
 SoftType = Left(Yek, 1)
 CheckC = Right(SNum, 1)
 If CheckC = "A" Then CheckC = "10"
 B1 = Left(SNum, 1)
 B2 = Mid(SNum, 2, 1)
 B3 = Mid(SNum, 3, 1)
 B4 = Mid(SNum, 4, 1)
  If B1 = "A" Then
     B1 = "10"
  ElseIf B1 = "B" Then
     B1 = "11"
  ElseIf B1 = "C" Then
     B1 = "12"
  ElseIf B1 = "D" Then
     B1 = "13"
  ElseIf B1 = "E" Then
     B1 = "14"
  ElseIf B1 = "F" Then
     B1 = "15"
 End If
  If B2 = "A" Then
     B2 = "10"
  ElseIf B2 = "B" Then
     B2 = "11"
  ElseIf B2 = "C" Then
     B2 = "12"
  ElseIf B2 = "D" Then
     B2 = "13"
  ElseIf B2 = "E" Then
     B2 = "14"
  ElseIf B2 = "F" Then
     B2 = "15"
 End If
  If B3 = "A" Then
     B3 = "10"
  ElseIf B3 = "B" Then
     B3 = "11"
  ElseIf B3 = "C" Then
     B3 = "12"
  ElseIf B3 = "D" Then
     B3 = "13"
  ElseIf B3 = "E" Then
     B3 = "14"
  ElseIf B3 = "F" Then
     B3 = "15"
 End If
  If B4 = "A" Then
     B4 = "10"
  ElseIf B4 = "B" Then
     B4 = "11"
  ElseIf B4 = "C" Then
     B4 = "12"
  ElseIf B4 = "D" Then
     B4 = "13"
  ElseIf B4 = "E" Then
     B4 = "14"
  ElseIf B4 = "F" Then
     B4 = "15"
 End If
 Num = Val(B4) + Val(B3) * 16 + Val(B2) * 16 * 16 + Val(B1) * 16 * 16 * 16
 SNum = SoftType & Num
 Num = 11 - (Num Mod 11)
 If Num = 11 Then Num = 0
 If Num <> Val(CheckC) Then
   MsgBox ("Sor" & "ry.  WR" & "ONG K" & "ey !!!" & Chr(13) & Chr(13) & "Please get the cor" & "rect K" & "ey and Re-" & "do Prod" & "uct acti" & "vation")
   EventOff = False
   Exit Sub
 End If
 If Len(SNum) < 6 Then
   MsgBox ("Sor" & "ry.  WR" & "ONG K" & "ey !!!" & Chr(13) & Chr(13) & "Please get the cor" & "rect K" & "ey and Re-" & "do Prod" & "uct acti" & "vation")
   EventOff = False
   Exit Sub
 End If
 VersionType = Val(Mid(SNum, 2, 1))
 A1 = Val(Mid(SNum, 3, 1))
 A2 = Val(Mid(SNum, 4, 1))
 A3 = Val(Mid(SNum, 5, 1))
 A4 = Val(Mid(SNum, 6, 1))
 Num = A1 & A2 & A3 & A4
 A = 11 - (Num Mod 11)
 If A = 11 Then A = 0
  If A < 10 Then
    CD1 = Chr(A + 48)
  Else
    CD1 = Chr(A + 55)
  End If
A = (A1 & A3) + (A2 & A4)
A = 11 - (A Mod 11)
If A = 11 Then A = 0
  If A < 10 Then
    CD2 = Chr(A + 48)
  Else
    CD2 = Chr(A + 55)
  End If
SNum = SoftType & Num & CD1 & CD2
SNum = UCase(SNum)
Worksheets("ComFactSheet").Range("B11").Value = SNum
  If VersionType = 4 Then
    Worksheets("ComFactSheet").Range("B16").Value = "Multi-ARP"
    Worksheets("ComFactSheet").Range("C15").Value = "-2RP"
    Worksheets("ComFactSheet").Cells(1, 13).Value = "Multi-ARP"
    Worksheets("System Menu").Range("B2").Select
     ActiveCell.Value = "Main System Menu --- Accounting, Sales, Purchases & Material Planning"
    With ActiveCell.Characters(Start:=22, Length:=48).Font
        .Underline = xlUnderlineStyleSingle
    End With
  ElseIf VersionType = 3 Then
    Worksheets("ComFactSheet").Range("B16").Value = "Multi-GL"
    Worksheets("ComFactSheet").Range("C15").Value = "-2GL"
    Worksheets("ComFactSheet").Cells(1, 13).Value = "Multi-GL"
    Worksheets("System Menu").Range("B2").Select
    ActiveCell.Value = "Main System Menu --- General Ledger Accounting"
    With ActiveCell.Characters(Start:=22, Length:=25).Font
        .Underline = xlUnderlineStyleSingle
    End With
  ElseIf VersionType = 2 Then
    Worksheets("ComFactSheet").Range("B16").Value = "Single-ARP"
    Worksheets("ComFactSheet").Range("C15").Value = "-1RP"
    Worksheets("ComFactSheet").Cells(1, 13).Value = "Single-ARP"
    Worksheets("System Menu").Range("B2").Select
    ActiveCell.Value = "Main System Menu --- Accounting, Sales, Purchases & Material Planning"
    With ActiveCell.Characters(Start:=22, Length:=48).Font
        .Underline = xlUnderlineStyleSingle
    End With
  Else
    Worksheets("ComFactSheet").Range("B16").Value = "Single-GL"
    Worksheets("ComFactSheet").Range("C15").Value = "-1GL"
    Worksheets("ComFactSheet").Cells(1, 13).Value = "Single-GL"
    Worksheets("System Menu").Range("B2").Select
    ActiveCell.Value = "Main System Menu --- General Ledger Accounting"
    With ActiveCell.Characters(Start:=22, Length:=25).Font
        .Underline = xlUnderlineStyleSingle
    End With
  End If
 Worksheets("ComFactSheet").Range("C2").Value = "Yes"
 Worksheets("ComFactSheet").Range("B10").Value = "Activated"
 Worksheets("ComFactSheet").Range("C16").ClearContents
 Worksheets("System Menu").Range("G12").Value = ""
 Worksheets("System Menu").Range("G13").Value = ""
 Worksheets("ComFactSheet").Cells(2, 13).Value = "Yes"
  On Error Resume Next
 DriveCode = Left(ThisWorkbook.Path, 1)
 DriveSN = 0
 Set myFSO = CreateObject("Scripting.FileSystemObject")
 DriveCode = myFSO.GetDrive(DriveCode).SerialNumber
 If Len(DriveCode) > 3 Then
  DriveSN = Val(Right(DriveCode, 3))
 Else
  DriveSN = Abs(Val(DriveCode))
 End If
On Error GoTo 0
 Worksheets("ComFactSheet").Range("C11").Value = DriveSN
 Worksheets("ComFactSheet").Range("C3").Value = DriveSN
 Worksheets("System Menu").Range("B9:C10").ClearContents
 Worksheets("System Menu").CommandButton1.Visible = True
 Worksheets("System Menu").CommandButton2.Visible = True
 Worksheets("System Menu").CommandButton3.Visible = True
 Worksheets("ComFactSheet").Range("DE123").Value = DriveSN
 Worksheets("System Menu").Activate
 Range("C4").Select
 On Error GoTo UpdateFail
  Worksheets("ComFactSheet").Range("A17").Value = Worksheets("ComFactSheet").Range("A18").Value
  Worksheets("ComFactSheet").Range("B17").Value = Worksheets("ComFactSheet").Range("B18").Value
  Worksheets("ComFactSheet").Range("C17").Value = Worksheets("ComFactSheet").Range("C18").Value
 ThisWorkbook.Save
 On Error GoTo 0
  Unload UserForm1
  Application.ScreenUpdating = True
  DoEvents
  Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
  MsgBox ("Prod" & "uct Acti" & "vation suc" & "cessful" & "ly Comp" & "leted")
End If
 EventOff = False
 Exit Sub
UpdateFail:
 Unload UserForm1
 DoEvents
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
    MsgBox ("Error!!!  File Saving Problem")
  EventOff = False
End Sub
Sub JournalFormat(RunCode As String)
If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
   ThisWorkbook.Worksheets("Journal").Activate
    Range("A1").ColumnWidth = 6.75
    Range("B1").ColumnWidth = 4.75
    Range("C1").ColumnWidth = 4
    Range("D1").ColumnWidth = 8.13
    Range("E1").ColumnWidth = 5.88
    Range("F1").ColumnWidth = 20
    Range("G1").ColumnWidth = 23
    Range("H1").ColumnWidth = 10.38
    Range("I1").ColumnWidth = 10.38
    Range("J1").ColumnWidth = 5
    ActiveSheet.Columns("A:I").Select
       With Selection.Font
        .Name = "Arial Narrow"
        .Size = 10
        .Bold = False
       End With
     Selection.RowHeight = 14
    Selection.Columns("A").Select
       With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
       End With
     Selection.Columns("B:E").Select
     With Selection
        .HorizontalAlignment = xlCenter
     End With
     Selection.Columns("C").NumberFormat = "yyyy/mm/dd"
     Selection.Columns("E:F").Select
       With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
     End With
     Selection.Columns("C:D").Select
      With Selection
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
     End With
    Range("A1:J11").Select
    Range("J11").Activate
    With Selection.Font
        .Name = "Arial Narrow"
        .Size = 10
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
    End With
   Range("B9:E11").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
    End With
    Range("F10:G10").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("H9:J11").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("A1:A11").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("E1:G7").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
    End With
    Range("A1:J11").VerticalAlignment = xlCenter
    Range("A11:J11").NumberFormat = "@"
    Range("A11").Select
    ActiveCell.FormulaR1C1 = "----------"
    Range("B11").Select
    ActiveCell.FormulaR1C1 = "---------"
    Range("C11").Select
    ActiveCell.FormulaR1C1 = "--------"
    Range("D11").Select
    ActiveCell.FormulaR1C1 = "----------------"
    Range("E11").Select
    ActiveCell.FormulaR1C1 = "-----------"
    Range("F11").Select
    ActiveCell.FormulaR1C1 = "-------------------------------------------"
    Range("G11").Select
    ActiveCell.FormulaR1C1 = "-----------------------------------------------------"
    Range("H11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("I11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("E1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("E2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("E3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("E4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("E6").Value = "General Ledger Journal Report"
    Range("A9").Value = "Journal"
    Range("A10").Value = "Code"
    Range("B9").Value = "Tran"
    Range("B10").Value = "No."
    Range("C10").Value = "Refer"
    Range("D10").Value = "Date"
    Range("E9").Value = "Account"
    Range("E10").Value = "Number"
    Range("F10").Value = "Account Name"
    Range("G10").Value = "Description"
    Range("H9").Value = SysCurrency & "  "
    Range("I9").Value = SysCurrency & "  "
    Range("H10").Value = "Debits"
    Range("I10").Value = "Credits"
    Columns("G:G").Select
    Selection.Resize(Selection.Rows.Count - 11).Select
    With Selection.Offset(11, 0)
     .WrapText = True
     .HorizontalAlignment = xlLeft
     .VerticalAlignment = xlTop
    End With
    Range("A1").Select
End Sub

Sub VoucherFormat(RunCode As String)
If RunCode <> "Voucher" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
   ThisWorkbook.Worksheets("Journal").Activate
    Range("A1").ColumnWidth = 1.4
    Range("B1").ColumnWidth = 9
    Range("C1").ColumnWidth = 24
    Range("D1").ColumnWidth = 27
    Range("E1").ColumnWidth = 10.5
    Range("F1").ColumnWidth = 10.5
    Columns("A:F").Select
       With Selection.Font
        .Name = "Arial Narrow"
        .Size = 10
        .Bold = False
       End With
     Selection.RowHeight = 14
    Columns("A:D").HorizontalAlignment = xlLeft
    Columns("A:D").NumberFormat = "@"
    Columns("E:F").Select
     With Selection
      .HorizontalAlignment = xlRight
     .NumberFormat = "#,##0.00"
     End With
   Range("C1:E5").HorizontalAlignment = xlCenterAcrossSelection
   Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
   Range("C3").Value = "VOUCHER"
   Range("A7:F7").Select
   With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
   ActiveSheet.HPageBreaks.Add Before:=Range("A8")
   
   Range("A9").Select
End Sub


Sub IncomeStatementFormat(RunCode As String)
If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
    ThisWorkbook.Worksheets("Income Statement").Activate
    ActiveSheet.UsedRange.Select
     Selection.ClearContents
    Range("A1").Select
    Selection.ColumnWidth = 5.5
    Range("B1").Select
    Selection.ColumnWidth = 11
    Range("C1").Select
    Selection.ColumnWidth = 31.25
    Range("D1").Select
    Selection.ColumnWidth = 19.88
    Range("E1").Select
    Selection.ColumnWidth = 19.88
    Range("F1").Select
    Selection.ColumnWidth = 4.38
    Range("A1:A2").HorizontalAlignment = xlRight
    Range("A1:E11").Select
    Range("E11").Activate
    With Selection.Font
        .Name = "Arial"
        .Size = 10
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
    End With
    Range("B1: B2").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("B10: C11 ").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("D9:E11").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("C1:D8").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
    End With
    Range("A1:E11").VerticalAlignment = xlCenter
    Range("A11:E11").NumberFormat = "@"
    Range("B11").Select
    ActiveCell.FormulaR1C1 = "------------"
    Range("C11").Select
    ActiveCell.FormulaR1C1 = "-------------------------------------------"
    Range("D11").Select
    ActiveCell.FormulaR1C1 = "--------------------------"
    Range("E11").Select
    ActiveCell.FormulaR1C1 = "--------------------------"
    Range("A1").Value = "Date:"
    Range("A2").Value = "Time:"
    Range("B1").Select
    Selection.NumberFormat = "yyyy/mm/dd"
    Range("B2").Select
    Range("B2").NumberFormat = "[h]:mm:ss"
    Range("C1:D8").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
    End With
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("C6").Value = "INCOME STATEMENT"
    
    Range("B10").Value = "Account"
    Range("C10").Value = "Account Name"
    Range("D9").Value = SysCurrency & " "
    Range("E9").Value = SysCurrency & " "
    Range("D10").Value = "This Period"
    Range("E10").Value = "Year to Date"
    Range("A1").Select
End Sub
Sub BalanceSheetFormat(RunCode As String)
If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
    ThisWorkbook.Worksheets("Balance Sheet").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A1").ColumnWidth = 7.38
    Range("B1").ColumnWidth = 12
    Range("C1").ColumnWidth = 38.13
    Range("D1").ColumnWidth = 18
    Range("F1").ColumnWidth = 8.38
    Range("A1:A2").HorizontalAlignment = xlRight
    Range("A1:D11").Select
    Range("D11").Activate
    With Selection.Font
        .Name = "Arial"
        .Size = 10
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
    End With
    Range("B1: B2").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("B10: C11 ").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("D9:D11").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("C1:C8").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
    End With
    Range("A1:E11").VerticalAlignment = xlCenter
    Range("A11:E11").NumberFormat = "@"
    Range("B11").Select
    ActiveCell.FormulaR1C1 = "------------"
    Range("C11").Select
    ActiveCell.FormulaR1C1 = "-------------------------------------------"
    Range("D11").Select
    ActiveCell.FormulaR1C1 = "--------------------------"
    Range("A1").Value = "Date:"
    Range("A2").Value = "Time:"
    Range("B1").Select
    Selection.NumberFormat = "yyyy/mm/dd"
    Range("B2").Select
    Range("B2").NumberFormat = "[h]:mm:ss"
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("C6").Value = "BALANCE SHEET"
    Range("B10").Value = "Account"
    Range("C10").Value = "Account Name"
    Range("D9").Value = SysCurrency & " "
    Range("D10").Value = "Balance"
    Range("A1").Select
End Sub

Sub TBalanceFormat(RunCode As String)
If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
   ThisWorkbook.Worksheets("Trial Balance").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A1").ColumnWidth = 8.63
    Range("B1").ColumnWidth = 7.75
    Range("C1").ColumnWidth = 24
    Range("D1").ColumnWidth = 9.88
    Range("E1").ColumnWidth = 9.88
    Range("F1").ColumnWidth = 9.88
    Range("G1").ColumnWidth = 9.88
    Range("H1").ColumnWidth = 9.88
    Range("I1").ColumnWidth = 9.88
    Range("B1:I11").Select
    Range("I11").Activate
    With Selection.Font
        .Name = "Arial Narrow"
        .Size = 10
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
    End With
   Range("B1:C11").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("D10:I11").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("D1:F7").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
     End With
    Range("D9:E9").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
    End With
    Range("F9:G9").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
    End With
    Range("H9:I9").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
    End With
    Range("B11:I11").NumberFormat = "@"
    Range("B11").Select
    ActiveCell.FormulaR1C1 = "-----------"
    Range("C11").Select
    ActiveCell.FormulaR1C1 = "--------------------------------------------"
    Range("D11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("E11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("F11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("G11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("H11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("I11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("D1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("D2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("D3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("D4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("D6").Value = "TRIAL BALANCE"
    Range("B9").Value = "Account"
    Range("B10").Value = "Number"
    Range("C10").Value = "Account Name"
    Range("D10").Value = "Debit  "
    Range("E10").Value = "Credit  "
    Range("F10").Value = "Debit  "
    Range("G10").Value = "Credit  "
    Range("H10").Value = "Debit  "
    Range("I10").Value = "Credit  "
    Range("D9").Value = "BEGINNING BALANCE (" & SysCurrency & ")"
    Range("F9").Value = "THIS PERIOD (" & SysCurrency & ")"
    Range("H9").Value = "CURRENT BALANCE (" & SysCurrency & ")"
    Range("B1").Select
End Sub
Sub TBFormatSimple(RunCode As String)
If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
   ThisWorkbook.Worksheets("Trial Balance").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A1").ColumnWidth = 6
    Range("B1").ColumnWidth = 7.75
    Range("C1").ColumnWidth = 30
    Range("D1").ColumnWidth = 9.88
    Range("E1").ColumnWidth = 9.88
    Range("F1").ColumnWidth = 9.88
    Range("G1").ColumnWidth = 9.88
    Range("H1").ColumnWidth = 15
    Range("I1").ColumnWidth = 15
    Range("B1:I11").Select
    Range("I11").Activate
    With Selection.Font
        .Name = "Arial"
        .Size = 10
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
    End With
   Range("B1:C11").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("D10:I11").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("C1:H7").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
     End With
    Range("H9:I9").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("B11:I11").NumberFormat = "@"
    Range("B11").Select
    ActiveCell.FormulaR1C1 = "-----------"
    Range("C11").Select
    ActiveCell.FormulaR1C1 = "------------------------------------------------"
    Range("D11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("E11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("F11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("G11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("H11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("I11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("C6").Value = "TRIAL BALANCE"
    Range("B9").Value = "Account"
    Range("B10").Value = "Number"
    Range("C10").Value = "Account Name"
    Range("H10").Value = "Debit  "
    Range("I10").Value = "Credit  "
    Range("H9").Value = SysCurrency & "  "
    Range("I9").Value = SysCurrency & "  "
    Range("B1").Select
End Sub
Sub ActivityFormat(RunCode As String)
If RunCode <> "GL" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
    ThisWorkbook.Worksheets("Activity Report").Activate
    Range("A1").ColumnWidth = 6.75
    Range("B1").ColumnWidth = 5.13
    Range("C1").ColumnWidth = 5
    Range("D1").ColumnWidth = 9
    Range("E1").ColumnWidth = 6.13
    Range("F1").ColumnWidth = 20
    Range("G1").ColumnWidth = 25.5
    Range("H1").ColumnWidth = 11
    Range("I1").ColumnWidth = 11
    Range("J1").ColumnWidth = 12
   Columns("A:J").Select
     With Selection
        .VerticalAlignment = xlCenter
        .RowHeight = 14
     End With
      With Selection.Font
        .Name = "Arial Narrow"
        .Size = 10
        .Bold = False
      End With
   Columns("A").Select
       With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
       End With
   Columns("B:E").Select
     With Selection
        .HorizontalAlignment = xlCenter
    End With
  Columns("D").NumberFormat = "yyyy/mm/dd"
    Selection.Columns("E:F").Select
       With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 0
    End With
  Columns("H:J").Select
     With Selection
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
    Range("F10:G11").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlCenter
    End With
    Range("H9:J11").Select
    With Selection
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlCenter
    End With
    Range("E1:H7").Select
    With Selection
        .HorizontalAlignment = xlCenterAcrossSelection
        .VerticalAlignment = xlCenter
     End With
    Range("A11:J11").NumberFormat = "@"
    Range("A11").Select
    ActiveCell.FormulaR1C1 = "--------"
    Range("B11").Select
    ActiveCell.FormulaR1C1 = "--------"
     Range("C11").Select
    ActiveCell.FormulaR1C1 = "-----"
    Range("D11").Select
    ActiveCell.FormulaR1C1 = "--------------"
    Range("E11").Select
    ActiveCell.FormulaR1C1 = "----------"
    Range("F11").Select
    ActiveCell.FormulaR1C1 = "-------------------------------------"
    Range("G11").Select
    ActiveCell.FormulaR1C1 = "-----------------------------------------------------"
    Range("H11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("I11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("J11").Select
    ActiveCell.FormulaR1C1 = "------------------"
    Range("D12").NumberFormat = "yyyy/mm/dd"
    Range("E1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("E2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("E3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("E4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("E6").Value = "G/L Detail Account Activity Report"
    Range("A9").Value = "Journal"
    Range("A10").Value = "Code"
    Range("B9").Value = "Tran"
    Range("B10").Value = "No."
    Range("C10").Value = "Refer"
    Range("D10").Value = "Date"
    Range("E9").Value = "Account"
    Range("H9").Value = SysCurrency & "  "
    Range("I9").Value = SysCurrency & "  "
    Range("J9").Value = SysCurrency & "   "
    Range("E10").Value = "Number"
    Range("F10").Value = "Account Name"
    Range("G10").Value = "Description"
    Range("H10").Value = "Debits"
    Range("I10").Value = "Credits"
    Range("J10").Value = "Balance"
    Columns("G:G").Select
    Selection.Resize(Selection.Rows.Count - 11).Select
    With Selection.Offset(11, 0)
     .WrapText = True
     .HorizontalAlignment = xlLeft
     .VerticalAlignment = xlTop
    End With
    Range("A1").Select
End Sub

Sub IniSheetFormat(RunCode As String)
If RunCode <> "IniData" Then Exit Sub
If ThisWorkbook.Worksheets("IniData").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("IniData").Activate
 ActiveSheet.UsedRange.EntireRow.Delete
 ActiveSheet.Columns("A:I").Select
       With Selection.Font
        .Name = "Arial"
        .Size = 13
        .Bold = False
       End With
  Columns("D:D").HorizontalAlignment = xlCenter
  Columns("A:A").HorizontalAlignment = xlLeft
    Range("A1:A3").Select
    With Selection.Font
        .Name = "Arial"
        .Size = 11
        .Bold = True
    End With
    Range("A4:A8").Select
    With Selection.Font
        .Name = "Arial"
        .Size = 11
    End With
    Range("A10:E10").Select
    With Selection.Font
        .Size = 13
        .Bold = True
    End With
    
    Range("C10:D10").Select
    With Selection
         .MergeCells = True
         .Font.Bold = True
    End With
   With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
     Columns("A:A").ColumnWidth = 9.38
    Columns("B:B").ColumnWidth = 31.63
    Columns("C:C").ColumnWidth = 13.25
    Columns("D:D").ColumnWidth = 8.25
    Columns("E:E").ColumnWidth = 15.75
    Columns("F:F").ColumnWidth = 14.25
    Columns("E:E").ColumnWidth = 16.25
    Columns("F:F").ColumnWidth = 14.63
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C:F").HorizontalAlignment = xlCenter
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("B10").HorizontalAlignment = xlRight
    Range("C10").HorizontalAlignment = xlCenter
    Range("C10").NumberFormat = "@"
    Range("E10").HorizontalAlignment = xlLeft
    Range("E12:F12").HorizontalAlignment = xlCenterAcrossSelection
    Range("E15:F15").Select
    Range(Selection, Selection.End(xlDown)).NumberFormat = "#,##0.00"
    Range("B10").Value = "Enter Last date of the Previous Year : "
    Range("E10").Value = "(yyyy/mm/dd)"
    Range("E12").Value = "Opening Balance"
    Range("E13").Value = "Debit"
    Range("F13").Value = "Credit"
    Range("E14").Value = "--------"
    Range("F14").Value = "--------"
    Range("A1").Value = "Please modify the Chart of Accounts below to meet your requirements and enter the opening balance data of your company."
    Range("A2").Value = "The Account number and the corresponding Account names starting from Row # 15"
    Range("A3").Value = "Notes below must be followed to define the Account Numbers "
    Range("A4").Value = "1. Account Number starts with  '2'  is for Liabilities;  '3' is for Capital/Equity; '4' is for Revenue and '8' is for Other Income ( ie Credit Balance Accounts) "
    Range("A5").Value = "2. Account Number starts with '1' is for Assets; '5', '6' and '9' are for Expenses ( i.e. Debit Balance Accounts)"
    Range("A6").Value = "3. Account Number starting with '36' are RESERVED by the system for profit reporting "
    Range("A7").Value = "4. Account number must be with 1 to 5 digits ( e.g. '203',  '45673' are valid account numbers; '112368' is an invalid number) "
    Range("A8").Value = "5. The Account Name must be within 27 characters"
    Range("A12").Value = "Account"
    Range("A13").Value = "Number"
    Range("A14").Value = "----------"
    Range("B13").Value = "Account Name"
    Range("B14").Value = "--------------------------------"
    Range("C12").Value = "Account"
    Range("C13").Value = "Type"
    Range("C14").Value = "---------"
    Range("D12").Value = "Account"
    Range("D13").Value = "Level"
    Range("D14").Value = "---------"
    Range("M14").Value = "  "
    Range("M10").Value = "   "
   Worksheets("StdCOA").Activate
   If Range("A10").Value <> "" Then
    Range("A10:D10").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Copy
    Worksheets("IniData").Activate
    Range("A15").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   End If
 Range("A15").Select
 Do While ActiveCell.Value <> ""
  If Left((ActiveCell.Value & "000"), 1) = 1 Then
   If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
     ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   Else
     ActiveCell.Offset(0, 4).Value = 0
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   End If
  ElseIf Left((ActiveCell.Value & "000"), 1) = 2 Then
   If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
     ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   Else
    ActiveCell.Offset(0, 5).Value = 0
    ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
   End If
  ElseIf Left((ActiveCell.Value & "000"), 1) = 3 Then
   If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
     ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   Else
    ActiveCell.Offset(0, 5).Value = 0
    ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
   End If
  Else
    ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
    ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
   Range("A1:J24").Select
   ActiveWindow.Zoom = True
    Range("C10").Select
End Sub

Sub UpdateBalance(RunCode As String)
Dim C As String, YearEndDate As Date, CreditBal As Currency, DebitBal As Currency, I As Long
Dim NewFileName As String, OldFileName As String, FilePath As String, FileNameLength As Long
Dim Check3 As String, Check36 As String, Check361 As String, Check3610 As String, myFSO As Object
Dim AcctCode As String, AcctBalance As Currency
If RunCode <> "IniData" Then Exit Sub
If ThisWorkbook.Worksheets("IniData").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("IniData").Activate
AskReply:
 MSG = "The program will save the Chart of account and the Opening Balance data." + Chr(13) + _
 Chr(13) + "Please note that once the Balance account data is stored, no change is allowed." + _
 Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo OldChartRemoval
    If C = "N" Or C = "n" Or C = "" Then
    Worksheets("IniData").Activate
    Range("A15").Activate
    GoTo FinishBalance
    End If
    GoTo AskReply
OldChartRemoval:
  Range("A15").Select
  Do While ActiveCell.Value <> ""
   AcctCode = ActiveCell.Value
   ActiveCell.NumberFormat = "General"
   ActiveCell.Value = AcctCode
   ActiveCell.Offset(1, 0).Select
  Loop
   If Len(Range("A15").Value) > 1 Then
      MsgBox ("WARNING!!!" & Chr(13) & "Please enter the next higher level Account for " & Range("A15"))
      Range("A15").Select
      GoTo FinishChart
   End If
   Check3 = ""
   Check36 = ""
   Check361 = ""
   Check3610 = ""
  Range("A15").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = ActiveCell.Offset(1, 0).Value Then
    MsgBox ("WARNING!!!" & Chr(13) & "Duplicate account numbers are found.  Please correct the data before proceed")
    GoTo FinishChart
   End If
   If ActiveCell.Offset(1, 0).Value <> "" Then
    If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Then
     If Len(ActiveCell.Offset(1, 0).Value) - Len(ActiveCell.Value) > 1 Then
       MsgBox ("WARNING!!!" & Chr(13) & "There should be middle level account number between " & ActiveCell.Value & " and " & ActiveCell.Offset(1, 0).Value & ".")
       GoTo FinishChart
     Else
       If Left(ActiveCell.Value, Len(ActiveCell.Value)) <> Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Value)) Then
         MsgBox ("WARNING!!!" & Chr(13) & "The account number " & Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Offset(1, 0).Value) - 1) & " which is the parent account for " & ActiveCell.Offset(1, 0).Value & " is missing. " & Chr(13) & _
        "Please add the parent account.")
        GoTo FinishChart
       End If
     End If
    ElseIf Len(ActiveCell.Value) = Len(ActiveCell.Offset(1, 0).Value) Then
     If Left(ActiveCell.Value, Len(ActiveCell.Value) - 1) <> Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Value) - 1) Then
         MsgBox ("WARNING!!!" & Chr(13) & "The account number " & Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Value) - 1) & " which is the parent account for " & ActiveCell.Offset(1, 0).Value & " is missing. " & Chr(13) & _
        "Please add the parent account.")
       GoTo FinishChart
     End If
    ElseIf Len(ActiveCell.Value) > Len(ActiveCell.Offset(1, 0).Value) Then
      If Len(ActiveCell.Offset(1, 0).Value) > 1 Then
        If Left(ActiveCell.Value, Len(ActiveCell.Offset(1, 0).Value) - 1) <> Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Offset(1, 0).Value) - 1) Then
         MsgBox ("WARNING!!!" & Chr(13) & "The account number " & Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Offset(1, 0).Value) - 1) & " which is the parent account for " & ActiveCell.Offset(1, 0).Value & " is missing. " & Chr(13) & _
        "Please add the parent account.")
        GoTo FinishChart
       End If
      End If
    End If
   End If
  If Left((ActiveCell.Value), 1) = 1 Then
    ActiveCell.Offset(0, 2).Value = "Asset"
     ElseIf Left((ActiveCell.Value), 1) = 2 Then
     ActiveCell.Offset(0, 2).Value = "Liability"
     ElseIf Left((ActiveCell.Value), 1) = 3 Then
     ActiveCell.Offset(0, 2).Value = "Capital"
     ElseIf Left((ActiveCell.Value), 1) = 4 Then
     ActiveCell.Offset(0, 2).Value = "Revenue"
     ElseIf Left((ActiveCell.Value), 1) = 8 Then
     ActiveCell.Offset(0, 2).Value = "Other Income"
   Else
    ActiveCell.Offset(0, 2).Value = "Expense"
  End If
  If Len(ActiveCell.Value) = 1 Then
   ActiveCell.Offset(0, 3).Value = "1"
  ElseIf Len(ActiveCell.Value) = 2 Then
   ActiveCell.Offset(0, 3).Value = "2"
  ElseIf Len(ActiveCell.Value) = 3 Then
   ActiveCell.Offset(0, 3).Value = "3"
   ElseIf Len(ActiveCell.Value) = 4 Then
   ActiveCell.Offset(0, 3).Value = "4"
   ElseIf Len(ActiveCell.Value) = 5 Then
   ActiveCell.Offset(0, 3).Value = "5"
  End If
  If ActiveCell.Value = 3 Then Check3 = "T"
  If ActiveCell.Value = 36 Then Check36 = "T"
  If ActiveCell.Value = 361 Then Check361 = "T"
  If ActiveCell.Value = 3611 Then Check3610 = "T"
  ActiveCell.Offset(1, 0).Select
  Loop
  If Check3 <> "T" Then
   ActiveCell.Value = 3
   ActiveCell.Offset(0, 1).Value = "CAPITAL & RESERVES"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 1
   ActiveCell.Offset(1, 0).Select
  End If
  If Check36 <> "T" Then
   ActiveCell.Value = 36
   ActiveCell.Offset(0, 1).Value = "RESERVES"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 2
   ActiveCell.Offset(1, 0).Select
  End If
  If Check361 <> "T" Then
   ActiveCell.Value = 361
   ActiveCell.Offset(0, 1).Value = "Accumulated P/L"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 3
   ActiveCell.Offset(1, 0).Select
  End If
 If Check3610 <> "T" Then
   ActiveCell.Value = 3611
   ActiveCell.Offset(0, 1).Value = "Accumulated P/L B/F"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 4
   ActiveCell.Offset(0, 5).Value = 0
   ActiveCell.Offset(1, 0).Select
  End If
 I = ActiveCell.Row - 1
 If Check3 <> "T" Or Check36 <> "T" Or Check361 <> "T" Or Check3610 <> "T" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(14, 0).Resize(Tbl.Rows.Count - 14, Tbl.Columns.Count + 3).Select
     With Selection
       .Columns("J").NumberFormat = "General"
       .Columns("J").FormulaR1C1 = "=LEFT(RC[-9] & ""*******"",7)"
       .Sort Key1:=Range("J1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
       .Columns("J").ClearContents
     End With
    Range("A15").Select
     Do While ActiveCell.Value <> ""
      If Left((ActiveCell.Value & "000"), 1) = 1 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
       Else
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlNone
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 2 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 3 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
       End If
      Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
      End If
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
CheckDate:
 On Error GoTo UpdateFail
 If IsDate(Range("C10").Value) = False Then
   MsgBox ("Wrong Date input.  Please correct the data before proceed")
   Range("C10").Select
   GoTo FinishBalance
 End If
 YearEndDate = Range("C10").Value
    If YearEndDate > Date Then
     MsgBox ("Wrong Date input.  The Date must not be later than Today")
     Range("C10").Select
    GoTo FinishBalance
    End If
  If Year(YearEndDate) < 1990 Then
   MsgBox ("Wrong Date input.  Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf Month(YearEndDate) <> MyBook.Worksheets("ComData").Range("B6").Value Then
   MsgBox ("Wrong Month input." & Chr(13) & "It should be the same as the Year End Month of your Company." & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf (Month(YearEndDate) = 1 Or Month(YearEndDate) = 3 Or Month(YearEndDate) = 5 Or Month(YearEndDate) = 7 Or Month(YearEndDate) = 8 Or Month(YearEndDate) = 10 Or Month(YearEndDate) = 12) And Day(YearEndDate) <> 31 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf (Month(YearEndDate) = 4 Or Month(YearEndDate) = 6 Or Month(YearEndDate) = 9 Or Month(YearEndDate) = 11) And Day(YearEndDate) <> 30 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf Month(YearEndDate) = 2 And (Int(Year(YearEndDate) / 4) * 4 <> Year(YearEndDate)) And Day(YearEndDate) <> 28 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf Month(YearEndDate) = 2 And (Int(Year(YearEndDate) / 4) * 4 = Year(YearEndDate)) And Day(YearEndDate) <> 29 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  End If
 CreditBal = Application.Sum(Range(Cells(15, 6), Cells(I, 6)))
 DebitBal = Application.Sum(Range(Cells(15, 5), Cells(I, 5)))
 If CreditBal <> DebitBal Then
 MsgBox ("Wrong Data!!!" & Chr(13) & "The Total Value of Credits and Debits does not balance." & Chr(13) & Chr(13) & "Please correct the data before proceed.")
 GoTo FinishBalance
 End If
  ThisWorkbook.Worksheets("IniData").Label1.Caption = Chr(13) & "    Request under Processing" & Chr(13) & _
                                                    Chr(13) & "    Please Wait "
  Worksheets("IniData").Label1.Visible = True
  Application.ScreenUpdating = True
  Worksheets("IniData").Range("A1").Select
  Application.ScreenUpdating = False
   Worksheets("Chart of Account").Activate
    Range("A10").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.EntireRow.Delete
   Worksheets("IniData").Activate
   Range("A15:D" & I).Copy
    Worksheets("Chart of Account").Activate
    Range("A10").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
Range("A1").Value = Date
Range("A2").Value = "Chart of Account for " & MyBook.Worksheets("ComData").Range("B2").Value
 Range("A10").Select
 Do While ActiveCell.Value <> ""
  If Len(ActiveCell.Value) <> 1 Then
   ActiveCell.Offset(0, 4).Value = Left(ActiveCell.Value, Len(ActiveCell.Value) - 1)
   If Len(ActiveCell.Value) > 2 Then
    If Left(ActiveCell.Value, 2) = 36 Then
      ActiveCell.Offset(0, 6).Value = "Y"
    End If
   End If
  Else
   ActiveCell.Offset(0, 4).Value = "-"
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 MyBook.Worksheets("Chart of Account").UsedRange.Delete
ThisWorkbook.Worksheets("Chart of Account").UsedRange.Copy
 MyBook.Worksheets("Chart of Account").Activate
 Range("A1").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("A3").Select
 ThisWorkbook.Worksheets("IniData").Activate
  Range("C15:D" & I).ClearContents
  Columns("C").EntireColumn.Delete
    MyBook.Worksheets("YearStartDat").Activate
    Range("B2").Select
    If ActiveCell.Offset(1, 0).Value <> "" Then
    Range(Selection, Selection.End(xlDown)).Select
    Selection.EntireRow.Delete
    Else
    ActiveCell.EntireRow.Delete
    End If
  ThisWorkbook.Worksheets("IniData").Activate
   Range("A15:E" & I).Copy
    MyBook.Worksheets("YearStartDat").Activate
    Range("B2").Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("A2").Select
    I = I - 13
    Range("A2:A" & I).Value = YearEndDate
 Range("B2").Select
 Do While ActiveCell.Value <> ""
 If (ActiveCell.Offset(0, 3).Value = "" Or ActiveCell.Offset(0, 3).Value = 0) And (ActiveCell.Offset(0, 4).Value = "" Or ActiveCell.Offset(0, 4).Value = 0) Then
  ActiveCell.EntireRow.Delete
 Else
  AcctBalance = ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, 4).Value
  If AcctBalance < 0 Then
   ActiveCell.Offset(0, 4).Value = Format(AcctBalance * (-1), "0.00")
   ActiveCell.Offset(0, 3).ClearContents
  Else
   ActiveCell.Offset(0, 3).Value = Format(AcctBalance, "0.00")
   ActiveCell.Offset(0, 4).ClearContents
  End If
  ActiveCell.Offset(1, 0).Select
 End If
 Loop
   MyBook.Worksheets("Raw Data").Range("A1").Value = YearEndDate + 1
   MyBook.Worksheets("InvDetail1").Range("D1").Value = YearEndDate
    MyBook.Worksheets("ComData").Range("B7").Value = "Yes"
  MyBook.Worksheets("ComData").Range("G250").Value = "JV" & Year(YearEndDate + 1)
  MyBook.Worksheets("ComData").Range("H250").Value = "00000"
    OldFileName = ThisWorkbook.Worksheets("System Menu").Range("C4").Value
    FileNameLength = Len(OldFileName)
    If FileNameLength <= 4 Then
      NewFileName = OldFileName & "-" & Year(YearEndDate + 1)
      GoTo FileNameOK
    End If
If Year(YearEndDate + 1) = Val(Right(OldFileName, 4)) Then
    Application.DisplayAlerts = False
    MyBook.Save
    Application.DisplayAlerts = True
    NewFileName = OldFileName
    GoTo NewFileOK
Else
    NewFileName = Left(OldFileName, FileNameLength - 4) & Year(YearEndDate + 1)
FileNameOK:
   If UCase(Right(MyBook.Name, 4)) = "XLSM" And UCase(Right(ThisWorkbook.Name, 4)) = "XLSM" And Val(Application.Version) >= 12 Then
    DExtn = ".xlsm"
   Else
    DExtn = ".xls"
   End If
   FilePath = ThisWorkbook.Worksheets("System Menu").Range("C5").Value
   Set myFSO = CreateObject("Scripting.FileSystemObject")
    Application.DisplayAlerts = False
   If myFSO.FileExists(FilePath & NewFileName & DExtn) = True Then
      FileExtNo = 1
      Do While myFSO.FileExists(FilePath & NewFileName & "-" & FileExtNo & ".bak") = True
       FileExtNo = FileExtNo + 1
      Loop
     Name FilePath & NewFileName & DExtn As FilePath & NewFileName & "-" & FileExtNo & ".bak"
     myFSO.GetFile(FilePath & NewFileName & "-" & FileExtNo & ".bak").Attributes = 2
   End If
   If DExtn = ".xlsm" Then
    MyBook.SaveAs FilePath & NewFileName & DExtn, FileFormat:=52
   Else
    If Val(Application.Version) < 12 Then
     MyBook.SaveAs FilePath & NewFileName & DExtn
    Else
     MyBook.SaveAs FilePath & NewFileName & DExtn, FileFormat:=xlExcel8
    End If
   End If
  On Error Resume Next
    Kill FilePath & OldFileName & DExtn
  On Error GoTo 0
  Application.DisplayAlerts = True
  ThisWorkbook.Worksheets("ComFactSheet").Activate
  Range("A18").Value = FilePath
  Range("B18").Value = NewFileName
  Range("C18").Value = DExtn
  Range("A17").Value = FilePath
  Range("B17").Value = NewFileName
  Range("C17").Value = DExtn
  Range("B21").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = OldFileName Then
    ActiveCell.Value = NewFileName
    ActiveCell.Offset(0, -1).Value = FilePath
    ActiveCell.Offset(0, 1).Value = DExtn
    ActiveCell.Offset(0, 2).Value = 0
    Exit Do
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
  If ActiveCell.Value = "" Then
     ActiveCell.NumberFormat = "@"
     ActiveCell.Offset(0, -1).NumberFormat = "@"
     ActiveCell.Offset(0, 1).NumberFormat = "@"
     ActiveCell.Value = NewFileName
     ActiveCell.Offset(0, -1).Value = FilePath
     ActiveCell.Offset(0, 1).Value = DExtn
     ActiveCell.Offset(0, 2).Value = 0
   End If
End If
NewFileOK:
ThisWorkbook.Activate
Worksheets("IniData").UsedRange.EntireRow.Delete
Worksheets("System Menu").ComboBox1.Clear
Worksheets("ComFactSheet").Activate
Worksheets("ComFactSheet").Range("D21").Select
Do While ActiveCell.Value <> "" And ActiveCell.Value = 0
  Worksheets("System Menu").ComboBox1.AddItem ActiveCell.Offset(0, -2).Value
  ActiveCell.Offset(1, 0).Select
Loop
  Worksheets("System Menu").ComboBox1.AddItem "Select Other Files"
  Worksheets("System Menu").ComboBox1.Text = NewFileName
    Worksheets("Chart of Account").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    MyBook.Worksheets("Chart of Account").UsedRange.Copy
    ThisWorkbook.Worksheets("Chart of Account").Activate
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("A8").End(xlDown).Select
    LastRowChartofAccount = Selection.Row
  Worksheets("NewCom").Range("A1").ClearContents
  Worksheets("NewCom").Range("A5").ClearContents
  Worksheets("System Menu").Visible = xlSheetVisible
  Worksheets("IniData").Visible = xlSheetVeryHidden
  SheetName = "System Menu"
  OldForm = ""
  Worksheets("System Menu").Activate
  On Error Resume Next
  EventOff = True
  ThisWorkbook.Save
  EventOff = False
  On Error GoTo 0
  Application.EnableEvents = True
  Worksheets("System Menu").Activate
  Application.ScreenUpdating = True
  MsgBox ("The Initial Account data have been stored in the system ")
FinishChart:
FinishBalance:
 Exit Sub
UpdateFail:
 ThisWorkbook.Activate
 Worksheets("IniData").UsedRange.EntireRow.Delete
 Worksheets("NewCom").Range("A1").ClearContents
 Worksheets("NewCom").Range("A5").ClearContents
  Worksheets("System Menu").Visible = xlSheetVisible
  Worksheets("IniData").Visible = xlSheetVeryHidden
  SheetName = "System Menu"
  OldForm = ""
  Application.DisplayAlerts = False
  If Err.Number <> -2147221080 Then MyBook.Close (False)
  Application.DisplayAlerts = True
  Worksheets("System Menu").Activate
  Application.ScreenUpdating = True
  MsgBox ("Error!!! " & Chr(13) & Chr(13) & "Cannot save to the intended Data File " & NewFileName)
  Application.EnableEvents = True
End Sub
Sub NewBalance(RunCode As String)
Dim C As String, YearEndDate As Date, CreditBal As Currency, DebitBal As Currency
Dim FileName As String, DataFilePath As String, NewFileName As String, L As Long, InvSheet As Long, ShName As String
Dim myFSO As Object, FilePathSub As String, I As Long, K As Long, Check3 As String, Check36 As String
Dim Check361 As String, Check3610 As String, AcctCode As String, AcctBalance As Currency
If RunCode <> "IniData" Then Exit Sub
If ThisWorkbook.Worksheets("IniData").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("IniData").Activate
FileName = Worksheets("NewCom").Range("B7").Value & "-" & Year(Date)
DataFilePath = Worksheets("NewCom").Range("B1").Value
AskReply:
 MSG = "The program will save the Chart of account and the Opening Balance data." + Chr(13) + _
 Chr(13) + "Please note that once the Balance account data is stored, no change is allowed." + _
 Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo OldChartRemoval
    If C = "N" Or C = "n" Or C = "" Then
    Worksheets("IniData").Activate
    Range("A15").Activate
    GoTo FinishBalance
    End If
    GoTo AskReply
OldChartRemoval:
  Range("A15").Select
  Do While ActiveCell.Value <> ""
   AcctCode = ActiveCell.Value
   ActiveCell.NumberFormat = "General"
   ActiveCell.Value = AcctCode
   ActiveCell.Offset(1, 0).Select
  Loop
   If Len(Range("A15").Value) > 1 Then
      MsgBox ("WARNING!!!" & Chr(13) & "Please enter the next higher level Account for " & Range("A15"))
      Range("A15").Select
      GoTo FinishChart
   End If
   Check3 = ""
   Check36 = ""
   Check361 = ""
   Check3610 = ""
  Range("A15").Select
  Do While ActiveCell.Value <> ""
  If ActiveCell.Value = ActiveCell.Offset(1, 0).Value Then
   MsgBox ("WARNING!!!" & Chr(13) & "Duplicate account numbers are found.  Please correct the data before proceed")
   GoTo FinishChart
  End If
   If ActiveCell.Offset(1, 0).Value <> "" Then
    If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Then
     If Len(ActiveCell.Offset(1, 0).Value) - Len(ActiveCell.Value) > 1 Then
       MsgBox ("WARNING!!!" & Chr(13) & "There should be middle level account number between " & ActiveCell.Value & " and " & ActiveCell.Offset(1, 0).Value & ".")
       GoTo FinishChart
     Else
       If Left(ActiveCell.Value, Len(ActiveCell.Value)) <> Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Value)) Then
         MsgBox ("WARNING!!!" & Chr(13) & "The account number " & Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Offset(1, 0).Value) - 1) & " which is the parent account for " & ActiveCell.Offset(1, 0).Value & " is missing. " & Chr(13) & _
        "Please add the parent account.")
        GoTo FinishChart
       End If
     End If
    ElseIf Len(ActiveCell.Value) = Len(ActiveCell.Offset(1, 0).Value) Then
     If Left(ActiveCell.Value, Len(ActiveCell.Value) - 1) <> Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Value) - 1) Then
         MsgBox ("WARNING!!!" & Chr(13) & "The account number " & Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Value) - 1) & " which is the parent account for " & ActiveCell.Offset(1, 0).Value & " is missing. " & Chr(13) & _
        "Please add the parent account.")
       GoTo FinishChart
     End If
    ElseIf Len(ActiveCell.Value) > Len(ActiveCell.Offset(1, 0).Value) Then
      If Len(ActiveCell.Offset(1, 0).Value) > 1 Then
        If Left(ActiveCell.Value, Len(ActiveCell.Offset(1, 0).Value) - 1) <> Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Offset(1, 0).Value) - 1) Then
         MsgBox ("WARNING!!!" & Chr(13) & "The account number " & Left(ActiveCell.Offset(1, 0).Value, Len(ActiveCell.Offset(1, 0).Value) - 1) & " which is the parent account for " & ActiveCell.Offset(1, 0).Value & " is missing. " & Chr(13) & _
        "Please add the parent account.")
        GoTo FinishChart
       End If
      End If
    End If
   End If
  If Left((ActiveCell.Value), 1) = 1 Then
    ActiveCell.Offset(0, 2).Value = "Asset"
     ElseIf Left((ActiveCell.Value), 1) = 2 Then
     ActiveCell.Offset(0, 2).Value = "Liability"
     ElseIf Left((ActiveCell.Value), 1) = 3 Then
     ActiveCell.Offset(0, 2).Value = "Capital"
     ElseIf Left((ActiveCell.Value), 1) = 4 Then
     ActiveCell.Offset(0, 2).Value = "Revenue"
     ElseIf Left((ActiveCell.Value), 1) = 8 Then
     ActiveCell.Offset(0, 2).Value = "Other Income"
   Else
    ActiveCell.Offset(0, 2).Value = "Expense"
  End If
  If Len(ActiveCell.Value) = 1 Then
   ActiveCell.Offset(0, 3).Value = "1"
  ElseIf Len(ActiveCell.Value) = 2 Then
   ActiveCell.Offset(0, 3).Value = "2"
  ElseIf Len(ActiveCell.Value) = 3 Then
   ActiveCell.Offset(0, 3).Value = "3"
   ElseIf Len(ActiveCell.Value) = 4 Then
   ActiveCell.Offset(0, 3).Value = "4"
   ElseIf Len(ActiveCell.Value) = 5 Then
   ActiveCell.Offset(0, 3).Value = "5"
  End If
  If ActiveCell.Value = 3 Then Check3 = "T"
  If ActiveCell.Value = 36 Then Check36 = "T"
  If ActiveCell.Value = 361 Then Check361 = "T"
  If ActiveCell.Value = 3611 Then Check3610 = "T"
  ActiveCell.Offset(1, 0).Select
  Loop
  If Check3 <> "T" Then
   ActiveCell.Value = 3
   ActiveCell.Offset(0, 1).Value = "CAPITAL & RESERVES"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 1
   ActiveCell.Offset(1, 0).Select
  End If
  If Check36 <> "T" Then
   ActiveCell.Value = 36
   ActiveCell.Offset(0, 1).Value = "RESERVES"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 2
   ActiveCell.Offset(1, 0).Select
  End If
  If Check361 <> "T" Then
   ActiveCell.Value = 361
   ActiveCell.Offset(0, 1).Value = "Accumulated P/L"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 3
   ActiveCell.Offset(1, 0).Select
  End If
 If Check3610 <> "T" Then
   ActiveCell.Value = 3611
   ActiveCell.Offset(0, 1).Value = "Accumulated P/L B/F"
   ActiveCell.Offset(0, 2).Value = "Capital"
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = 4
   ActiveCell.Offset(0, 5).Value = 0
   ActiveCell.Offset(1, 0).Select
  End If
 I = ActiveCell.Row - 1
 If Check3 <> "T" Or Check36 <> "T" Or Check361 <> "T" Or Check3610 <> "T" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(14, 0).Resize(Tbl.Rows.Count - 14, Tbl.Columns.Count + 3).Select
     With Selection
       .Columns("J").NumberFormat = "General"
       .Columns("J").FormulaR1C1 = "=LEFT(RC[-9] & ""*******"",7)"
       .Sort Key1:=Range("J1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
       .Columns("J").ClearContents
     End With
    Range("A15").Select
     Do While ActiveCell.Value <> ""
      If Left((ActiveCell.Value & "000"), 1) = 1 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
       Else
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlNone
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 2 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 3 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
       End If
      Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
      End If
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
CheckDate:
 If IsDate(Range("C10").Value) = False Then
   MsgBox ("Wrong Date input.  Please correct the data before proceed")
   Range("C10").Select
   GoTo FinishBalance
 End If
 YearEndDate = Range("C10").Value
    If YearEndDate > Date Then
     MsgBox ("Wrong Date input.  The Date must not be later than Today")
     Range("C10").Select
    GoTo FinishBalance
    End If
  If Year(YearEndDate) < 1990 Then
   MsgBox ("Wrong Date input.  Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf Month(YearEndDate) <> Worksheets("NewCom").Range("B6").Value Then
   MsgBox ("Wrong Month input." & Chr(13) & "It should be the same as the Year End Month of your Company." & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf (Month(YearEndDate) = 1 Or Month(YearEndDate) = 3 Or Month(YearEndDate) = 5 Or Month(YearEndDate) = 7 Or Month(YearEndDate) = 8 Or Month(YearEndDate) = 10 Or Month(YearEndDate) = 12) And Day(YearEndDate) <> 31 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf (Month(YearEndDate) = 4 Or Month(YearEndDate) = 6 Or Month(YearEndDate) = 9 Or Month(YearEndDate) = 11) And Day(YearEndDate) <> 30 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf Month(YearEndDate) = 2 And (Int(Year(YearEndDate) / 4) * 4 <> Year(YearEndDate)) And Day(YearEndDate) <> 28 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  ElseIf Month(YearEndDate) = 2 And (Int(Year(YearEndDate) / 4) * 4 = Year(YearEndDate)) And Day(YearEndDate) <> 29 Then
   MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
   GoTo FinishBalance
  End If
 CreditBal = Application.Sum(Range(Cells(15, 6), Cells(I, 6)))
 DebitBal = Application.Sum(Range(Cells(15, 5), Cells(I, 5)))
 If CreditBal <> DebitBal Then
 MsgBox ("Wrong Data!!!" & Chr(13) & "The Total Value of Credits and Debits does not balance." & Chr(13) & Chr(13) & "Please correct the data before proceed.")
 GoTo FinishBalance
 End If
  ThisWorkbook.Worksheets("IniData").Label1.Caption = Chr(13) & "    Request under Processing" & Chr(13) & _
                                                    Chr(13) & "    Please Wait "
  Worksheets("IniData").Label1.Visible = True
  Application.ScreenUpdating = True
  Worksheets("IniData").Range("A1").Select
  Application.ScreenUpdating = False
  On Error GoTo UpdateFail
  Application.DisplayAlerts = False
  MyBook.Save
  Application.DisplayAlerts = True
On Error GoTo WrongPath
 Set myFSO = CreateObject("Scripting.FileSystemObject")
  If myFSO.FolderExists(DataFilePath) = False Then
    L = Len(DataFilePath)
    If L > 2 Then
     For J = 3 To L
      If Mid(DataFilePath, J, 1) = "\" Then
       FilePathSub = Left(DataFilePath, J)
       If myFSO.FolderExists(FilePathSub) = False Then
        myFSO.CreateFolder (FilePathSub)
       End If
      End If
     Next J
    Else
     GoTo WrongPath
    End If
   End If
On Error GoTo 0
MyBook.Worksheets("Raw Data").Activate
If Range("A4").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).EntireRow.Delete
End If
 Range("F1").Value = 1
 Range("B1").ClearContents
 Range("A4").Select
MyBook.Worksheets("Receivable").Activate
If Range("B4").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A1").NumberFormat = "@"
Range("A1").Value = "000000"
Range("F1").NumberFormat = "@"
Range("F1").Value = "00000"
Range("A4").Select
MyBook.Worksheets("ProInvoice").Activate
If Range("B4").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A1").NumberFormat = "@"
Range("A1").Value = "000000"
Range("A4").Select
MyBook.Worksheets("Customer Data").Activate
If Range("B3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A1").NumberFormat = "@"
Range("A1").Value = "00000"
Range("A3").Select
MyBook.Worksheets("PayRec").Activate
If Range("A3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
Range("B1").NumberFormat = "@"
Range("B1").Value = "00000"
Range("A3").Select
MyBook.Worksheets("Product Data").Activate
If Range("B3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
 Range("A3").Select
MyBook.Worksheets("PORecord").Activate
If Range("B4").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A1").NumberFormat = "@"
Range("A1").Value = "000000"
Range("F1").NumberFormat = "@"
Range("F1").Value = "00000"
Range("A4").Select
MyBook.Worksheets("Payable").Activate
If Range("B4").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A1").NumberFormat = "@"
Range("A1").Value = "000000"
Range("F1").NumberFormat = "@"
Range("F1").Value = "00000"
Range("A4").Select
MyBook.Worksheets("Supplier Data").Activate
If Range("B3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A1").NumberFormat = "@"
Range("A1").Value = "00000"
Range("A3").Select
MyBook.Worksheets("PayMake").Activate
If Range("A3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
Range("B1").NumberFormat = "@"
Range("B1").Value = "00000"
Range("A3").Select
MyBook.Worksheets("Supply Data").Activate
If Range("D3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A3").Select
MyBook.Worksheets("ComData").Activate
Range("B8").Value = ""
If Range("A24") <> "" Then
 If Range("A25").Value <> "" Then
   Range("A24").End(xlDown).Select
   K = ActiveCell.Row
   Range(Cells(21, 1), Cells(K, 3)).ClearContents
 End If
End If
 Range("A21:C24").ClearContents
If Range("C51") <> "" Then
 Range("C50").End(xlDown).Select
 K = ActiveCell.Row
 Range(Cells(50, 3), Cells(K + 10, 4)).ClearContents
Else
 Range("C50:D60").ClearContents
End If
Range("K10").Select
Do While ActiveCell.Value <> ""
 Range(ActiveCell, ActiveCell.Offset(0, 5)).ClearContents
 ActiveCell.Offset(1, 0).Select
Loop
Range("J11:J30").ClearContents
MyBook.Worksheets("StockRec").Activate
If Range("B2").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A2").Select
MyBook.Worksheets("IOData").Activate
If Range("E2").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).EntireRow.Delete
End If
Range("A2").Select
MyBook.Worksheets("InvDetail1").Activate
InvSheet = Range("B1").Value
If Range("A3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
 Range("E2").End(xlToRight).Select
 K = ActiveCell.Column
 If K > 7 Then Range(Cells(2, 8), Cells(2, K)).ClearContents
Range("A2").Select
Range("B1").Value = 1
Range("D1").Value = YearEndDate
 K = InvSheet
  Do While K > 1
   ShName = "InvDetail" & K
   MyBook.Worksheets(ShName).Activate
    Application.DisplayAlerts = False
    ActiveSheet.Visible = xlSheetVisible
    ActiveSheet.Delete
    Application.DisplayAlerts = True
   K = K - 1
  Loop
MyBook.Worksheets("BuildRec").Activate
If Range("D4").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).EntireRow.Delete
End If
Range("B1").NumberFormat = "@"
Range("B1").Value = "00000"
Range("F1").NumberFormat = "@"
Range("F1").Value = "00000"
Range("A4").Select
MyBook.Worksheets("StockAdRec").Activate
If Range("A3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
 Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).EntireRow.Delete
End If
Range("B1").NumberFormat = "@"
Range("B1").Value = "00000"
Range("A3").Select
MyBook.Worksheets("CountRec").UsedRange.Delete
MyBook.Worksheets("BOM1").Activate
 K = Range("A9").Value
 ActiveSheet.UsedRange.Delete
 Range("A1") = "BOM"
 Range("A2") = "Date of Creation"
 Range("A3") = "Date of Last Update"
 Range("A4") = "Revision #"
 Range("A9").NumberFormat = "General"
 Range("A9") = 1
 Range("A10") = "Stock #/Components"
If K > 1 Then
 On Error Resume Next
 Application.DisplayAlerts = False
 Do While K > 1
  Sheets("BOM" & K).Visible = xlSheetVisible
  Sheets("BOM" & K).Delete
  K = K - 1
 Loop
  Application.DisplayAlerts = True
 On Error GoTo 0
End If
 MyBook.Worksheets("Chart of Account").Activate
 ActiveSheet.UsedRange.EntireRow.Delete
   ThisWorkbook.Worksheets("Chart of Account").Activate
    Range("A10").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.EntireRow.Delete
   Worksheets("IniData").Activate
   Range("A15:D" & I).Copy
    Worksheets("Chart of Account").Activate
    Range("A10").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
     
  Range("A1").Value = Date
  Range("A2").Value = "Chart of Account for " & ThisWorkbook.Worksheets("NewCom").Range("B2").Value
 Range("A10").Select
 Do While ActiveCell.Value <> ""
  If Len(ActiveCell.Value) <> 1 Then
   ActiveCell.Offset(0, 4).Value = Left(ActiveCell.Value, Len(ActiveCell.Value) - 1)
   If Len(ActiveCell.Value) > 2 Then
    If Left(ActiveCell.Value, 2) = 36 Then
      ActiveCell.Offset(0, 6).Value = "Y"
    End If
   End If
  Else
   ActiveCell.Offset(0, 4).Value = "-"
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
ThisWorkbook.Worksheets("Chart of Account").UsedRange.Copy
 MyBook.Worksheets("Chart of Account").Activate
 Range("A1").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("A3").Select
 ThisWorkbook.Worksheets("IniData").Activate
  Range("C15:D" & I).ClearContents
  Columns("C").EntireColumn.Delete
   MyBook.Worksheets("YearStartDat").Activate
    Range("B2").Select
    If ActiveCell.Offset(1, 0).Value <> "" Then
    Range(Selection, Selection.End(xlDown)).Select
    Selection.EntireRow.Delete
    Else
    ActiveCell.EntireRow.Delete
    End If
  ThisWorkbook.Worksheets("IniData").Activate
   Range("A15:E" & I).Copy
    MyBook.Worksheets("YearStartDat").Activate
    Range("B2").Select
    Selection.PasteSpecial Paste:=xlValues
    Application.CutCopyMode = False
    Range("A2").Select
    I = I - 13
    Range("A2:A" & I).Value = YearEndDate
 Range("B2").Select
 Do While ActiveCell.Value <> ""
 If (ActiveCell.Offset(0, 3).Value = "" Or ActiveCell.Offset(0, 3).Value = 0) And (ActiveCell.Offset(0, 4).Value = "" Or ActiveCell.Offset(0, 4).Value = 0) Then
  ActiveCell.EntireRow.Delete
 Else
 AcctBalance = ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, 4).Value
 If AcctBalance < 0 Then
   ActiveCell.Offset(0, 4).Value = Format(AcctBalance * (-1), "0.00")
   ActiveCell.Offset(0, 3).ClearContents
 Else
   ActiveCell.Offset(0, 3).Value = Format(AcctBalance, "0.00")
   ActiveCell.Offset(0, 4).ClearContents
 End If
 ActiveCell.Offset(1, 0).Select
 End If
 Loop
   MyBook.Worksheets("Raw Data").Range("A1").Value = YearEndDate + 1
    MyBook.Worksheets("YearStartDat").Range("D1").Value = 3611
  MyBook.Worksheets("ComData").Activate
    Range("G250:H250").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.ClearContents
  Range("G250").Value = "JV" & Year(YearEndDate + 1)
  Range("H250").Value = "00000"
   ThisWorkbook.Worksheets("NewCom").Activate
     Range("B1:C6").Copy
    MyBook.Worksheets("ComData").Activate
    Range("B1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("B7").Value = "Yes"
    Range("B14").Value = ""
    Columns("E").ClearContents
   If Year(YearEndDate + 1) <> Val(Right(FileName, 4)) Then
     FileNameLength = Len(FileName)
     NewFileName = Left(FileName, FileNameLength - 4) & Year(YearEndDate + 1)
   Else
    NewFileName = FileName
   End If
 If UCase(Right(ThisWorkbook.Name, 4)) = "XLSM" And Val(Application.Version) >= 12 Then
   DExtn = ".xlsm"
 Else
   DExtn = ".xls"
 End If
  On Error GoTo UpdateFail
   Application.DisplayAlerts = False
   Set myFSO = CreateObject("Scripting.FileSystemObject")
   If myFSO.FileExists(DataFilePath & NewFileName & DExtn) = True Then
    FileExtNo = 1
    Do While myFSO.FileExists(DataFilePath & NewFileName & "-" & FileExtNo & ".bak") = True
     FileExtNo = FileExtNo + 1
    Loop
    Name DataFilePath & NewFileName & DExtn As DataFilePath & NewFileName & "-" & FileExtNo & ".bak"
    myFSO.GetFile(DataFilePath & NewFileName & "-" & FileExtNo & ".bak").Attributes = 2
   End If
   If DExtn = ".xlsm" Then
    MyBook.SaveAs DataFilePath & NewFileName & DExtn, FileFormat:=52
   Else
    If Val(Application.Version) < 12 Then
      MyBook.SaveAs DataFilePath & NewFileName & DExtn
    Else
      MyBook.SaveAs DataFilePath & NewFileName & DExtn, FileFormat:=xlExcel8
    End If
   End If
   Application.DisplayAlerts = True
   On Error GoTo 0
  ThisWorkbook.Worksheets("ComFactSheet").Activate
  Range("C18").Value = DExtn
  Range("B18").Value = NewFileName
  Range("A18").Value = DataFilePath
  Range("B21").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = NewFileName Then
    ActiveCell.Offset(0, -1).Value = DataFilePath
    ActiveCell.Offset(0, 1).Value = DExtn
    ActiveCell.Offset(0, 2).Value = 0
    Exit Do
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
   If ActiveCell.Value = "" Then
     ActiveCell.NumberFormat = "@"
     ActiveCell.Offset(0, -1).NumberFormat = "@"
     ActiveCell.Offset(0, 1).NumberFormat = "@"
     ActiveCell.Value = NewFileName
     ActiveCell.Offset(0, -1).Value = DataFilePath
     ActiveCell.Offset(0, 1).Value = DExtn
     ActiveCell.Offset(0, 2).Value = 0
   End If
  Range("B21").Select
  If Range("B22").Value <> "" Then
    Range("B20").End(xlDown).Select
    I = ActiveCell.Row
  Else
   I = 21
  End If
 Worksheets("ComFactSheet").Range("A21:D" & I).Select
 Selection.Sort Key1:=Worksheets("ComFactSheet").Range("D21"), Order1:=xlAscending, _
         Key2:=Worksheets("ComFactSheet").Range("B21"), _
         Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:=False, _
         Orientation:=xlTopToBottom
 Worksheets("ComFactSheet").Range("B18").Value = NewFileName
 Worksheets("ComFactSheet").Range("A18").Value = DataFilePath
 Worksheets("ComFactSheet").Range("C18").Value = DExtn
 Worksheets("ComFactSheet").Range("B17").Value = NewFileName
 Worksheets("ComFactSheet").Range("A17").Value = DataFilePath
 Worksheets("ComFactSheet").Range("C17").Value = DExtn
 Worksheets("System Menu").Range("C4").Value = NewFileName
 Worksheets("System Menu").Range("C5").Value = DataFilePath
 Worksheets("System Menu").Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
ThisWorkbook.Worksheets("IniData").Activate
Worksheets("IniData").UsedRange.EntireRow.Delete
Worksheets("System Menu").ComboBox1.Clear
Worksheets("ComFactSheet").Activate
Worksheets("ComFactSheet").Range("D21").Select
Do While ActiveCell.Value <> "" And ActiveCell.Value = 0
 Worksheets("System Menu").ComboBox1.AddItem ActiveCell.Offset(0, -2).Value
 ActiveCell.Offset(1, 0).Select
Loop
 Worksheets("System Menu").ComboBox1.AddItem "Select Other Files"
 Worksheets("System Menu").ComboBox1.Text = NewFileName
    Worksheets("Chart of Account").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    MyBook.Worksheets("Chart of Account").UsedRange.Copy
    ThisWorkbook.Worksheets("Chart of Account").Activate
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("A8").End(xlDown).Select
    LastRowChartofAccount = Selection.Row
  Worksheets("NewCom").Range("A1").ClearContents
  Worksheets("System Menu").Visible = xlSheetVisible
  Worksheets("IniData").Visible = xlSheetVeryHidden
  SheetName = "System Menu"
  OldForm = ""
  Worksheets("System Menu").Activate
  On Error Resume Next
  EventOff = True
  ThisWorkbook.Save
  EventOff = False
  On Error GoTo 0
  Application.EnableEvents = True
  Worksheets("System Menu").Activate
  Application.ScreenUpdating = True
  MsgBox ("New Company data have been stored in the system ")
Exit Sub
WrongPath:
  Call ReturnToMainMenu("")
  MsgBox ("Wrong Data File Path, the company was not created")
FinishChart:
FinishBalance:
Exit Sub
UpdateFail:
 ThisWorkbook.Activate
 Worksheets("IniData").UsedRange.EntireRow.Delete
 Worksheets("NewCom").Range("A1").ClearContents
 Worksheets("NewCom").Range("A5").ClearContents
  Worksheets("System Menu").Visible = xlSheetVisible
  Worksheets("IniData").Visible = xlSheetVeryHidden
  SheetName = "System Menu"
  OldForm = ""
  Application.DisplayAlerts = False
  If Err.Number <> -2147221080 Then MyBook.Close (False)
  Application.DisplayAlerts = True
  Worksheets("System Menu").Activate
  Application.ScreenUpdating = True
  MsgBox ("Error!!! " & Chr(13) & Chr(13) & "Cannot save to the intended Data File " & NewFileName)
  Application.EnableEvents = True
End Sub
Sub JNumRetrieve(RunCode As String)
Dim JournalCode As String, JournalNum As String, JournalRange As Range
If ThisWorkbook.Worksheets("Data Entry").Visible <> xlSheetVisible Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 JournalCode = ThisWorkbook.Worksheets("Data Entry").Range("C6").Value
 MyBook.Worksheets("ComData").Activate
 Range("G250").Select
 JcodeRow = 251
 Set JournalRange = Range("G250")
 If ActiveCell.Offset(1, 0).Value <> "" Then
   Range("G250").End(xlDown).Select
   JcodeRow = ActiveCell.Row + 1
 End If
  Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
   LastTranNo = "00000"
Else
 JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
 LastTranNo = Cells(JcodeRow, 8).Value
End If
LastJournalCode = JournalCode
End Sub

Sub TempRPFormat(RunCode As String)
Dim I As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" And _
    ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 InvStatus = ""
 CustName = ""
 Address1 = ""
 Address2 = ""
 Address3 = ""
 CustContact = ""
 TelNo = ""
 PayTerm = ""
 SalesRep = ""
 DelName = ""
 DelAddress1 = ""
 DelAddress2 = ""
 DelAddress3 = ""
 DelContact = ""
 TotalSum = 0
 DisAmount = 0
 TotalAmount = 0
 DisRate = 0
 InvDate = Date
 For I = 1 To 8
  Userform6.Controls("TextBox" & I).Text = ""
 Next I
 For I = 10 To 13
  Userform6.Controls("TextBox" & I).Text = ""
 Next I
 For I = 15 To 18
  Userform6.Controls("TextBox" & I).Text = ""
 Next I
 For I = 20 To 23
  Userform6.Controls("TextBox" & I).Text = ""
 Next I
 For I = 25 To 28
  Userform6.Controls("TextBox" & I).Text = ""
 Next I
 For I = 30 To 33
  Userform6.Controls("TextBox" & I).Text = ""
 Next I
  Userform6.TextBox35.Text = ""
  Userform6.TextBox36.Text = ""
  Userform6.TextBox38.Text = ""
  Userform6.TextBox39.Text = ""
 For I = 41 To 47
  Userform6.Controls("Label" & I).Caption = ""
 Next I
 For I = 51 To 56
    Userform6.Controls("Label" & I).Caption = ""
 Next I
Userform6.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
Userform6.TextBox2.Text = InvNo
Userform6.Label47.Caption = Format(DisAmount, "#,##0.00")
 Userform6.Label3.Caption = "Customer :   "
 Userform6.Label7.Caption = "Delivered To :   "
 Userform6.Label11.Caption = "Unit Price" & Chr(13) & "(" & SysCurrency & ")"
 Userform6.Label12.Caption = "Amount " & Chr(13) & "(" & SysCurrency & ")"
 Userform6.Label14.Caption = "Discount " & "(" & SysCurrency & ") : "
 Userform6.Label24.Caption = "Total " & "(" & SysCurrency & ") : "
Userform6.Label25.Caption = Format(TotalAmount, "#,##0.00")
Userform6.Label40.Caption = Format(TotalSum, "#,##0.00")
Userform6.ScrollBar1.Max = 15
Userform6.ScrollBar1.Min = 1
Userform6.ScrollBar1.Value = 1
Userform6.CommandButton1.Caption = "Save"
Userform6.CommandButton11.Visible = False
Userform6.CommandButton13.Visible = False
Userform6.CommandButton14.Visible = False
Userform6.Label23.Visible = False
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
   Userform6.CommandButton1.Visible = False
Else
   Userform6.CommandButton1.Visible = True
End If
End Sub
Sub Form6Col1Exit(Source As String)
Dim ProductNo As String, ProductDes As String, EndNo As Long, UnitPrice As Double, SalesAcct As String
Dim AssetAcct As String, CostAcct As String, StockQty As Double, StockAmt As Double, UnitCost As Double, LowQtyLine As Long
Dim RowNo As Long, I As Long, LineNo As Long, LowQtyFlag As String, OldLineNo As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" And _
   ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "CREDIT NOTE" Or Userform6.Label1.Caption = "SALES ORDER") Then
 Userform6.Controls("TextBox" & Form6TextNo).Text = Cells(Form6RowNo + 122, 4).Value
 Exit Sub
End If
 Userform6.Label23.Visible = False
ProductNo = Userform6.Controls("TextBox" & Form6TextNo).Text
If Left(ProductNo, 1) = " " Then
 I = Len(ProductNo)
 J = 1
 Do While J <= I And Mid(ProductNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then ProductNo = ""
  ProductNo = Right(ProductNo, I - J + 1)
End If
If Right(ProductNo, 1) = " " Then
 I = Len(ProductNo)
 J = I
 Do While J > 0 And Mid(ProductNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then ProductNo = ""
  ProductNo = Left(ProductNo, J)
End If
ProductNo = UCase(ProductNo)
Userform6.Controls("TextBox" & Form6TextNo).Text = ProductNo
If Cells(Form6RowNo + 122, 4).Value = ProductNo Then GoTo NoScreenUpdate
 If Userform6.Label1.Caption <> "SALES ORDER" Then
  If Cells(Form6RowNo + 122, 14).Value < 0 And Cells(Form6RowNo + 122, 13).Value <> "" And Cells(Form6RowNo + 122, 15).Value = "" Then
     StockNo = Cells(Form6RowNo + 122, 13).Value
     Cells(Form6RowNo + 121, 4).Select
     Do While ActiveCell.Value <> ""
      If ActiveCell.Offset(0, 9).Value = StockNo Then GoTo ProductDeleteOK
      ActiveCell.offst(-1, 0).Select
     Loop
    Userform6.Controls("TextBox" & Form6TextNo).Text = Cells(Form6RowNo + 122, 4).Value
    Userform6.Label23.Caption = Chr(13) & "     Change or Deletion of the item will make the Stock Quantity of " & StockNo & " negative" & _
                      Chr(13) & Chr(13) & "     Thus Change or Deletion of the original item is not allowed."
    Userform6.Label23.Visible = True
    Exit Sub
   End If
  End If
ProductDeleteOK:
 If Cells(Form6RowNo + 122, 13).Value <> "" Then
   StockNo = Cells(Form6RowNo + 122, 13).Value
  If Cells(Form6RowNo + 122, 15).Value = "*" Then
   StockQty = Cells(Form6RowNo + 122, 14).Value
   StockAmt = Cells(Form6RowNo + 122, 16).Value
   Cells(Form6RowNo + 123, 4).Select
   If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "SALES ORDER" Then
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 9).Value = StockNo Then
       ActiveCell.Offset(0, 10).Value = StockQty
       ActiveCell.Offset(0, 12).Value = StockAmt
       StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
       If StockQty = 0 Then ActiveCell.Offset(0, 8).Value = StockAmt
       StockAmt = Format(StockAmt - ActiveCell.Offset(0, 8).Value, "0.00")
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   Else
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 9).Value = StockNo Then
       ActiveCell.Offset(0, 10).Value = StockQty
       ActiveCell.Offset(0, 12).Value = StockAmt
       StockQty = Format(StockQty + ActiveCell.Offset(0, 2).Value, "0.0000")
       If StockQty = 0 Then ActiveCell.Offset(0, 8).Value = StockAmt * (-1)
       StockAmt = Format(StockAmt + ActiveCell.Offset(0, 8).Value, "0.00")
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
  Else
   Cells(Form6RowNo + 121, 4).Select
   Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 9).Value = StockNo Then
     ActiveCell.Offset(0, 11).Value = ""
     Exit Do
    End If
    ActiveCell.Offset(-1, 0).Select
   Loop
  End If
 End If
If ProductNo = "" Then
 Cells(Form6RowNo + 122, 3).EntireRow.Delete
 RowNo = Val(Userform6.Label15.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
 For I = 1 To 6
  Userform6.Controls("TextBox" & I * 5).Text = Cells(RowNo + 121 + I, 4).Value
  Userform6.Controls("TextBox" & I * 5 + 1).Text = Cells(RowNo + 121 + I, 5).Value
  Userform6.Controls("TextBox" & I * 5 + 2).Text = Cells(RowNo + 121 + I, 6).Value
  Userform6.Controls("TextBox" & I * 5 + 3).Text = Cells(RowNo + 121 + I, 7).Value
  Userform6.Controls("Label" & I + 40).Caption = Cells(RowNo + 121 + I, 8).Value
  Userform6.Controls("Label" & I + 50).Caption = Cells(RowNo + 121 + I, 14).Value
 Next I
 Exit Sub
End If
   Cells(Form6RowNo + 122, 3).Value = ""
   Range(Cells(Form6RowNo + 122, 7), Cells(Form6RowNo + 122, 17)).Value = ""
 If IsError(Application.Match(ProductNo, MyBook.Worksheets("Product Data").Range("B:B"), 0)) Then
  Userform6.Controls("TextBox" & Form6TextNo).Text = ""
  Userform6.Controls("TextBox" & Form6TextNo + 1).Text = ""
  Userform6.Controls("TextBox" & Form6TextNo + 3).Text = ""
  Userform6.Controls("Label" & (Form6TextNo / 5) + 40).Caption = ""
  Userform6.Controls("Label" & (Form6TextNo / 5) + 50).Caption = ""
  ThisWorkbook.Worksheets("TempRP").Activate
  Range(Cells(Form6RowNo + 122, 2), Cells(Form6RowNo + 122, 17)).Value = ""
  If Cells(Form6RowNo + 123, 4).Value <> "" Then Cells(Form6RowNo + 122, 4) = " "
  Call Form6AmountRefresh("")
  Userform6.Label23.Caption = Chr(13) & "     The Product is not found from the record"
  Userform6.Label23.Visible = True
  Exit Sub
 End If
  ProdRow = Application.Match(ProductNo, MyBook.Worksheets("Product Data").Range("B:B"), 0)
  MyBook.Worksheets("Product Data").Activate
  Cells(ProdRow, 2).Select
  ProductDes = ActiveCell.Offset(0, 1).Value
  UnitPrice = ActiveCell.Offset(0, 2).Value
  SalesAcct = ActiveCell.Offset(0, 3).Value
  If ActiveCell.Offset(0, 5).Value = "Yes" Then
    ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 10).NumberFormat = "General"
    ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 10).Value = ActiveCell.Offset(0, 4).Value
    StockNo = ActiveCell.Offset(0, 7).Value
    If StockNo = "" Then
      Userform6.Controls("TextBox" & Form6TextNo).Text = ""
      Userform6.Controls("TextBox" & Form6TextNo + 1).Text = ""
      Userform6.Controls("TextBox" & Form6TextNo + 3).Text = ""
      Userform6.Controls("Label" & (Form6TextNo / 5) + 40).Caption = ""
      Userform6.Controls("Label" & (Form6TextNo / 5) + 50).Caption = ""
      ThisWorkbook.Worksheets("TempRP").Activate
      Range(Cells(Form6RowNo + 122, 2), Cells(Form6RowNo + 122, 17)).Value = ""
      If Cells(Form6RowNo + 123, 4).Value <> "" Then Cells(Form6RowNo + 122, 4) = " "
      Call Form6AmountRefresh("")
      Userform6.Label23.Caption = Chr(13) & "   Note: The Stock number detail is not found from the record. " & Chr(13) & _
                                "    Please update the Stock item before proceed"
     Userform6.Label23.Visible = True
     Exit Sub
    End If
     If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
         Userform6.Controls("TextBox" & Form6TextNo).Text = ""
         Userform6.Controls("TextBox" & Form6TextNo + 1).Text = ""
         Userform6.Controls("TextBox" & Form6TextNo + 3).Text = ""
         Userform6.Controls("Label" & (Form6TextNo / 5) + 40).Caption = ""
         Userform6.Controls("Label" & (Form6TextNo / 5) + 50).Caption = ""
         ThisWorkbook.Worksheets("TempRP").Activate
         Range(Cells(Form6RowNo + 122, 2), Cells(Form6RowNo + 122, 17)).Value = ""
        If Cells(Form6RowNo + 123, 4).Value <> "" Then Cells(Form6RowNo + 122, 4) = " "
         Call Form6AmountRefresh("")
         Userform6.Label23.Caption = Chr(13) & "   Note: The Stock # detail is not found from the record. " & Chr(13) & _
                                "    Please update the Stock item before proceed"
         Userform6.Label23.Visible = True
         Exit Sub
     End If
       MyBook.Worksheets("StockRec").Activate
       I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       Cells(I, 2).Select
       StockQty = ActiveCell.Offset(0, 6).Value
       StockAmt = ActiveCell.Offset(0, 7).Value
       ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 9).NumberFormat = "General"
       ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 9).Value = ActiveCell.Offset(0, 3).Value
       ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 11).NumberFormat = "General"
       If StockQty <> 0 Then
         ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 11).Value = StockAmt / StockQty
       Else
         ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 11).Value = ActiveCell.Offset(0, 8).Value
       End If
       ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 13).NumberFormat = "@"
       ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 13).Value = StockNo
       ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 14).Value = StockQty
       ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 16).Value = StockAmt
       If ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 14).Value = "" Then ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 14).Value = 0
       ThisWorkbook.Worksheets("TempRP").Activate
       Cells(Form6RowNo + 122, 12).Value = Round(Cells(Form6RowNo + 122, 6).Value * Cells(Form6RowNo + 122, 11).Value, 2)
       Cells(Form6RowNo + 121, 13).Select
       If Userform6.Label1.Caption = "INVOICE" Then
        Do While ActiveCell.Row > 99
         If ActiveCell.Value = StockNo Then
          StockQty = Format(ActiveCell.Offset(0, 1).Value - ActiveCell.Offset(0, -7).Value, "0.0000")
          StockAmt = Format(ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, -1).Value, "0.00")
          Cells(Form6RowNo + 122, 14).Value = StockQty
          Cells(Form6RowNo + 122, 16).Value = StockAmt
          If StockQty = Cells(Form6RowNo + 122, 6).Value Then
           Cells(Form6RowNo + 122, 12).Value = StockAmt
          Else
           Cells(Form6RowNo + 122, 12).Value = Round((StockQty - Cells(Form6RowNo + 122, 6).Value) * Cells(Form6RowNo + 122, 11).Value, 2)
           Cells(Form6RowNo + 122, 12).Value = Round((StockAmt - Cells(Form6RowNo + 122, 12).Value), 2)   'Cost Amt
          End If
          ActiveCell.Offset(0, 2).Value = "*"
          Exit Do
         End If
         ActiveCell.Offset(-1, 0).Select
        Loop
       ElseIf Userform6.Label1.Caption = "SALES ORDER" Then
        Do While ActiveCell.Row > 122
         If ActiveCell.Value = StockNo Then
          StockQty = Format(ActiveCell.Offset(0, 1).Value - ActiveCell.Offset(0, -7).Value, "0.0000")
          StockAmt = Format(ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, -1).Value, "0.00")
          Cells(Form6RowNo + 122, 14).Value = StockQty
          Cells(Form6RowNo + 122, 16).Value = StockAmt
          If StockQty = Cells(Form6RowNo + 122, 6).Value Then
           Cells(Form6RowNo + 122, 12).Value = StockAmt
          Else
           Cells(Form6RowNo + 122, 12).Value = Round((StockQty - Cells(Form6RowNo + 122, 6).Value) * Cells(Form6RowNo + 122, 11).Value, 2)
           Cells(Form6RowNo + 122, 12).Value = Round((StockAmt - Cells(Form6RowNo + 122, 12).Value), 2)   'Cost Amt
          End If
          ActiveCell.Offset(0, 2).Value = "*"
          Exit Do
         End If
         ActiveCell.Offset(-1, 0).Select
        Loop
       ElseIf Userform6.Label1.Caption = "CREDIT NOTE" Then
        Do While ActiveCell.Row > 99
         If ActiveCell.Value = StockNo Then
          StockQty = Format(ActiveCell.Offset(0, 1).Value + ActiveCell.Offset(0, -7).Value, "0.0000")
          StockAmt = Format(ActiveCell.Offset(0, 3).Value + ActiveCell.Offset(0, -1).Value, "0.00")
          Cells(Form6RowNo + 122, 14).Value = StockQty
          Cells(Form6RowNo + 122, 16).Value = StockAmt
          If StockQty = Cells(Form6RowNo + 122, 6).Value * (-1) Then
           Cells(Form6RowNo + 122, 12).Value = StockAmt * (-1)
          Else
           Cells(Form6RowNo + 122, 12).Value = Round((StockQty + Cells(Form6RowNo + 122, 6).Value) * Cells(Form6RowNo + 122, 11).Value, 2)
           Cells(Form6RowNo + 122, 12).Value = Round((Cells(Form6RowNo + 122, 12).Value - StockAmt), 2)   'Cost Amt
          End If
          ActiveCell.Offset(0, 2).Value = "*"
          Exit Do
         End If
         ActiveCell.Offset(-1, 0).Select
        Loop
       End If
       LowQtyFlag = ""
       StockNo = Cells(Form6RowNo + 122, 13).Value
     If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "SALES ORDER" Then
        StockQty = Format(Cells(Form6RowNo + 122, 14).Value - Cells(Form6RowNo + 122, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form6RowNo + 122, 16).Value - Cells(Form6RowNo + 122, 12).Value, "0.00")
        UnitCost = Cells(Form6RowNo + 122, 11).Value
       If StockQty < 0 Then LowQtyFlag = ProductNo
       Cells(Form6RowNo + 123, 4).Select
       LowQtyLine = Form6RowNo + 122
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 9).Value = StockNo Then
        Cells(LowQtyLine, 15).Value = "*"
        LowQtyFlag = ""
        ActiveCell.Offset(0, 10).Value = StockQty
        ActiveCell.Offset(0, 12).Value = StockAmt
        ActiveCell.Offset(0, 7).Value = UnitCost
       If ActiveCell.Offset(0, 2).Value = StockQty Then
          ActiveCell.Offset(0, 8).Value = StockAmt
        Else
          ActiveCell.Offset(0, 8).Value = Round((StockQty - ActiveCell.Offset(0, 2).Value) * UnitCost, 2)
          ActiveCell.Offset(0, 8).Value = Round((StockAmt - ActiveCell.Offset(0, 8).Value), 2)
        End If
          StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
          StockAmt = Format(StockAmt - ActiveCell.Offset(0, 8).Value, "0.00")
          LowQtyLine = ActiveCell.Row
          If StockQty < 0 Then LowQtyFlag = ActiveCell.Value
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
     Else
        StockQty = Format(Cells(Form6RowNo + 122, 14).Value + Cells(Form6RowNo + 122, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form6RowNo + 122, 16).Value + Cells(Form6RowNo + 122, 12).Value, "0.00")
        UnitCost = Cells(Form6RowNo + 122, 11).Value
       If StockQty < 0 Then LowQtyFlag = ProductNo
       Cells(Form6RowNo + 123, 4).Select
       LowQtyLine = Form6RowNo + 122
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 9).Value = StockNo Then
        Cells(LowQtyLine, 15).Value = "*"
        LowQtyFlag = ""
        ActiveCell.Offset(0, 10).Value = StockQty
        ActiveCell.Offset(0, 12).Value = StockAmt
         ActiveCell.Offset(0, 7).Value = UnitCost
        If ActiveCell.Offset(0, 2).Value = StockQty * (-1) Then
          ActiveCell.Offset(0, 8).Value = StockAmt * (-1)
        Else
          ActiveCell.Offset(0, 8).Value = Round((StockQty + ActiveCell.Offset(0, 2).Value) * UnitCost, 2)
          ActiveCell.Offset(0, 8).Value = Round((ActiveCell.Offset(0, 8).Value - StockAmt), 2)  'Cost Amt
        End If
          StockQty = Format(StockQty + ActiveCell.Offset(0, 2).Value, "0.0000")
          StockAmt = Format(StockAmt + ActiveCell.Offset(0, 8).Value, "0.00")
          LowQtyLine = ActiveCell.Row
          If StockQty < 0 Then LowQtyFlag = ActiveCell.Value
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
     End If
  Else
    StockNo = ""
    CostAcct = ""
    ThisWorkbook.Worksheets("TempRP").Activate
    Range(Cells(Form6RowNo + 122, 9), Cells(Form6RowNo + 122, 17)).ClearContents
    Cells(Form6RowNo + 122, 14).Value = "N/A"
  End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Userform6.Controls("TextBox" & Form6TextNo).Text = ProductNo
 Userform6.Controls("TextBox" & Form6TextNo + 1).Text = ProductDes
 Userform6.Controls("TextBox" & Form6TextNo + 3).Text = UnitPrice
  Range(Cells(Form6RowNo + 122, 2), Cells(Form6RowNo + 122, 3)).NumberFormat = "General"
  Range(Cells(Form6RowNo + 122, 4), Cells(Form6RowNo + 122, 5)).NumberFormat = "@"
  Range(Cells(Form6RowNo + 122, 6), Cells(Form6RowNo + 122, 8)).NumberFormat = "General"
  Cells(Form6RowNo + 122, 2).Value = "NEW"
  Cells(Form6RowNo + 122, 3).Value = SalesAcct
  Cells(Form6RowNo + 122, 4).Value = ProductNo
  Cells(Form6RowNo + 122, 5).Value = ProductDes
  Cells(Form6RowNo + 122, 7).Value = UnitPrice
  Cells(Form6RowNo + 122, 8).Value = Round(Cells(Form6RowNo + 122, 6).Value * Cells(Form6RowNo + 122, 7).Value, 2)
  Userform6.Controls("TextBox" & Form6TextNo + 2).Text = Cells(Form6RowNo + 122, 6).Value
  Userform6.Controls("TextBox" & Form6TextNo + 3).Text = Cells(Form6RowNo + 122, 7).Value
  Userform6.Controls("Label" & (Form6TextNo / 5) + 40).Caption = Format(Cells(Form6RowNo + 122, 8).Value, "#,##0.00")
  LineNo = Userform6.ScrollBar1.Value
  For I = 1 To 6
   Userform6.Controls("Label" & I + 50).Caption = Cells(LineNo + 121 + I, 14).Value
  Next I
Range("C123").Select
J = 0
For I = 1 To Form6RowNo
 If ActiveCell.Value = "" Then
  ActiveCell.EntireRow.Delete
  J = J + 1
 Else
  ActiveCell.Offset(1, 0).Select
 End If
Next I
 If Source = "List" Then
    OldLineNo = Userform6.ScrollBar1.Value
    If Form6RowNo - J - OldLineNo < 0 Then
      Userform6.Controls("TextBox" & Form6TextNo + 2).SetFocus
      Source = "Jump"
    Else
     Userform6.Controls("TextBox" & (Form6RowNo - J - OldLineNo) * 5 + 7).SetFocus
    End If
  End If
 Do While ActiveCell.Offset(0, 1).Value <> ""
  If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
  Else
   ActiveCell.Offset(1, 0).Select
  End If
 Loop
If J <> 0 Then
 Range("B123").Select
 For I = 1 To 20
  If ActiveCell.Value = "NEW" Then Exit For
   ActiveCell.Offset(1, 0).Select
 Next I
 If I > 20 Then GoTo NoScreenUpdate
  J = ActiveCell.Row
 RowNo = Form6TextNo / 5
 If J > RowNo + 122 Then
  Userform6.ScrollBar1.Value = J - RowNo - 121
 Else
  ThisWorkbook.Worksheets("TempRP").Activate
  For I = 1 To 6
   Userform6.Controls("Label" & I + 14).Caption = I
   Userform6.Controls("TextBox" & I * 5).Text = Cells(122 + I, 4).Value
   Userform6.Controls("TextBox" & I * 5 + 1).Text = Cells(122 + I, 5).Value
   Userform6.Controls("TextBox" & I * 5 + 2).Text = Cells(122 + I, 6).Value
   Userform6.Controls("TextBox" & I * 5 + 3).Text = Cells(122 + I, 7).Value
   Userform6.Controls("Label" & I + 40).Caption = Cells(122 + I, 8).Value
   Userform6.Controls("Label" & I + 50).Caption = Cells(122 + I, 14).Value
  Next I
  Userform6.ScrollBar1.Value = 1
 End If
End If
NoScreenUpdate:
 Range("B123:B143").ClearContents
If Form6TextNo = 30 And Userform6.TextBox30.Text <> "" Then
 If Cells(Form6RowNo + 123, 3).Value = "" And Userform6.ScrollBar1.Value < 15 Then Userform6.ScrollBar1.Value = Userform6.ScrollBar1.Value + 1
End If
 If Source = "List" Then
    LineNo = Userform6.ScrollBar1.Value
    If LineNo > OldLineNo Then
     For I = OldLineNo To LineNo - 1
      SendKeys "{Up}", False
     Next I
    End If
    If LineNo < OldLineNo Then
     For I = LineNo To OldLineNo - 1
      SendKeys "{Down}", False
     Next I
    End If
  End If
If Source <> "List" And Userform6.Controls("Textbox" & Form6TextNo).Text = "" Then
  I = Form6TextNo
  Do While I > 5 And Userform6.Controls("Textbox" & I).Text = ""
   SendKeys "{UP}", False
   I = I - 5
  Loop
End If
  Call Form6AmountRefresh("")
If LowQtyFlag <> "" And Userform6.Label1.Caption <> "SALES ORDER" Then
   Userform6.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & ProductNo
   Userform6.Label23.Visible = True
End If
End Sub

Sub Form6Col3Exit(RunCode As String)
Dim I As Long, LineNo As Long, LowQtyFlag As String, StockQty As Double, StockAmt As Double, ProductNo As String
Dim CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" And _
   ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "CREDIT NOTE" Or Userform6.Label1.Caption = "SALES ORDER") Then
 Userform6.Controls("TextBox" & Form6TextNo).Text = Cells(Form6RowNo + 122, 6).Value
 Exit Sub
End If
 Userform6.Label23.Visible = False
  If Cells(Form6RowNo + 122, 6).Value = Userform6.Controls("TextBox" & Form6TextNo).Text Then Exit Sub
  LowQtyFlag = ""
If Userform6.Controls("TextBox" & Form6TextNo - 2).Text = "" Then
 If Userform6.Controls("TextBox" & Form6TextNo).Text <> "" Then
  Userform6.Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  Userform6.Label23.Visible = True
 End If
  Cells(Form6RowNo + 122, 6).Value = ""
  Cells(Form6RowNo + 122, 7).Value = ""
  Cells(Form6RowNo + 122, 8).Value = ""
  Cells(Form6RowNo + 122, 12).Value = ""
 SendKeys "+{tab}", False
 SendKeys "+{tab}", False
  GoTo CostAmtUpdate
End If
If IsNumeric(Userform6.Controls("TextBox" & Form6TextNo).Text) = False And Userform6.Controls("TextBox" & Form6TextNo).Text <> "" Then
  Cells(Form6RowNo + 122, 6).Value = 0
  Cells(Form6RowNo + 122, 8).Value = 0
  Cells(Form6RowNo + 122, 12).Value = 0
  Userform6.Controls("Label" & ((Form6TextNo + 3) / 5) + 39).Caption = Format(Cells(Form6RowNo + 122, 8).Value, "#,##0.00")
  Userform6.Label23.Caption = Chr(13) & "    Incorrect Quantity Entered"
  Userform6.Label23.Visible = True
  GoTo CostAmtUpdate
ElseIf Userform6.Controls("TextBox" & Form6TextNo).Text = "" Then
  Cells(Form6RowNo + 122, 6).Value = 0
  Userform6.Label23.Visible = False
Else
  CheckNum = Format(Userform6.Controls("TextBox" & Form6TextNo).Text, "0.0000")
  Userform6.Controls("TextBox" & Form6TextNo).Text = CheckNum
  Cells(Form6RowNo + 122, 6).Value = Userform6.Controls("TextBox" & Form6TextNo).Text
   Userform6.Label23.Visible = False
End If
   Cells(Form6RowNo + 122, 8).Value = Round(Cells(Form6RowNo + 122, 6).Value * Cells(Form6RowNo + 122, 7).Value, 2)
 If Cells(Form6RowNo + 122, 9) <> "" Then
  If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "SALES ORDER" Then
    If Cells(Form6RowNo + 122, 6) > Cells(Form6RowNo + 122, 14) Then
     LowQtyFlag = Cells(Form6RowNo + 122, 4).Value
     ProductNo = Cells(Form6RowNo + 122, 4).Value
    End If
    StockQty = Format(Cells(Form6RowNo + 122, 14).Value - Cells(Form6RowNo + 122, 6).Value, "0.0000")
     If StockQty = 0 Then
      StockAmt = 0
      Cells(Form6RowNo + 122, 12).Value = Cells(Form6RowNo + 122, 16).Value
     Else
        Cells(Form6RowNo + 122, 12).Value = Round((Cells(Form6RowNo + 122, 14).Value - Cells(Form6RowNo + 122, 6).Value) * Cells(Form6RowNo + 122, 11).Value, 2)
        Cells(Form6RowNo + 122, 12).Value = Round((Cells(Form6RowNo + 122, 16).Value - Cells(Form6RowNo + 122, 12).Value), 2)   'Cost Amt
     End If
  Else
    If Cells(Form6RowNo + 122, 6) + Cells(Form6RowNo + 122, 14) < 0 Then
     LowQtyFlag = Cells(Form6RowNo + 122, 4).Value
     ProductNo = Cells(Form6RowNo + 122, 4).Value
    End If
    StockQty = Format(Cells(Form6RowNo + 122, 14).Value + Cells(Form6RowNo + 122, 6).Value, "0.0000")
     If StockQty = 0 Then
      StockAmt = 0
      Cells(Form6RowNo + 122, 12).Value = Cells(Form6RowNo + 122, 16).Value * (-1)
     Else
      Cells(Form6RowNo + 122, 12).Value = Round((Cells(Form6RowNo + 122, 14).Value + Cells(Form6RowNo + 122, 6).Value) * Cells(Form6RowNo + 122, 11).Value, 2)
        Cells(Form6RowNo + 122, 12).Value = Round((Cells(Form6RowNo + 122, 12).Value - Cells(Form6RowNo + 122, 16).Value), 2)   'Cost Amt
     End If
  End If
 End If
  Userform6.Controls("TextBox" & Form6TextNo).Text = Cells(Form6RowNo + 122, 6).Value
  Userform6.Controls("TextBox" & Form6TextNo + 1).Text = Cells(Form6RowNo + 122, 7).Value
  Userform6.Controls("Label" & ((Form6TextNo + 3) / 5) + 39).Caption = Format(Cells(Form6RowNo + 122, 8).Value, "#,##0.00")
   If Cells(Form6RowNo + 122, 15).Value = "*" Then LowQtyFlag = ""
CostAmtUpdate:
     StockNo = Cells(Form6RowNo + 122, 13).Value
     If StockNo = "" Then GoTo Finish
     If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "SALES ORDER" Then
        StockQty = Format(Cells(Form6RowNo + 122, 14).Value - Cells(Form6RowNo + 122, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form6RowNo + 122, 16).Value - Cells(Form6RowNo + 122, 12).Value, "0.00")
        UnitCost = Cells(Form6RowNo + 122, 11).Value
       If StockQty < 0 Then
        LowQtyFlag = Cells(Form6RowNo + 122, 4).Value
        ProductNo = Cells(Form6RowNo + 122, 4).Value
       End If
       Cells(Form6RowNo + 123, 4).Select
       LowQtyLine = Form6RowNo + 122
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 9).Value = StockNo Then
        Cells(LowQtyLine, 15).Value = "*"
        LowQtyFlag = ""
        ActiveCell.Offset(0, 10).Value = StockQty
        ActiveCell.Offset(0, 12).Value = StockAmt
        ActiveCell.Offset(0, 7).Value = UnitCost
        If ActiveCell.Offset(0, 2).Value = StockQty Then
          ActiveCell.Offset(0, 8).Value = StockAmt
        Else
          ActiveCell.Offset(0, 8).Value = Round((StockQty - ActiveCell.Offset(0, 2).Value) * UnitCost, 2)
         ActiveCell.Offset(0, 8).Value = Round((StockAmt - ActiveCell.Offset(0, 8).Value), 2)   'Cost Amt
        End If
          StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
          StockAmt = Format(StockAmt - ActiveCell.Offset(0, 8).Value, "0.00")
          LowQtyLine = ActiveCell.Row
          If StockQty < 0 Then LowQtyFlag = ActiveCell.Value
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
     Else
        StockQty = Format(Cells(Form6RowNo + 122, 14).Value + Cells(Form6RowNo + 122, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form6RowNo + 122, 16).Value + Cells(Form6RowNo + 122, 12).Value, "0.00")
        UnitCost = Cells(Form6RowNo + 122, 11).Value
       If StockQty < 0 Then
        LowQtyFlag = Cells(Form6RowNo + 122, 4).Value
        ProductNo = Cells(Form6RowNo + 122, 4).Value
       End If
       Cells(Form6RowNo + 123, 4).Select
       LowQtyLine = Form6RowNo + 122
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 9).Value = StockNo Then
        Cells(LowQtyLine, 15).Value = "*"
        LowQtyFlag = ""
        ActiveCell.Offset(0, 10).Value = StockQty
        ActiveCell.Offset(0, 12).Value = StockAmt
         ActiveCell.Offset(0, 7).Value = UnitCost
        If ActiveCell.Offset(0, 2).Value = StockQty * (-1) Then
          ActiveCell.Offset(0, 8).Value = StockAmt * (-1)
        Else
           ActiveCell.Offset(0, 8).Value = Round((StockQty + ActiveCell.Offset(0, 2).Value) * UnitCost, 2)
         ActiveCell.Offset(0, 8).Value = Round((ActiveCell.Offset(0, 8).Value - StockAmt), 2)  'Cost Amt
        End If
          StockQty = Format(StockQty + ActiveCell.Offset(0, 2).Value, "0.0000")
          StockAmt = Format(StockAmt + ActiveCell.Offset(0, 8).Value, "0.00")
          LowQtyLine = ActiveCell.Row
          If StockQty < 0 Then LowQtyFlag = ActiveCell.Value
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
     End If
  LineNo = Userform6.ScrollBar1.Value
  For I = 1 To 6
   Userform6.Controls("Label" & I + 50).Caption = Cells(LineNo + 121 + I, 14).Value
  Next I
 If LowQtyFlag <> "" And Userform6.Label1.Caption <> "SALES ORDER" Then
   If ProductNo <> "" Then
    Userform6.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & ProductNo
   Else
    Userform6.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & LowQtyFlag
   End If
    Userform6.Label23.Visible = True
 End If
Finish:
Call Form6AmountRefresh("")
End Sub

Sub Form6Col4Exit(RunCode As String)
Dim CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" And _
   ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  ThisWorkbook.Worksheets("TempRP").Activate
If Not (Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "CREDIT NOTE" Or Userform6.Label1.Caption = "SALES ORDER") Then
 Userform6.Controls("TextBox" & Form6TextNo).Text = Cells(Form6RowNo + 122, 7).Value
 Exit Sub
End If
If Cells(Form6RowNo + 122, 7).Value = Userform6.Controls("TextBox" & Form6TextNo).Text Then Exit Sub
 If IsNumeric(Userform6.Controls("TextBox" & Form6TextNo).Text) = False And Userform6.Controls("TextBox" & Form6TextNo).Text <> "" Then
  Cells(Form6RowNo + 122, 7).Value = 0
  Cells(Form6RowNo + 122, 8).Value = Round(Cells(Form6RowNo + 122, 6).Value * Cells(Form6RowNo + 122, 7).Value, 2)
  Cells(Form6RowNo + 122, 12).Value = Round(Cells(Form6RowNo + 122, 6).Value * Cells(Form6RowNo + 122, 11).Value, 2)
  Userform6.Controls("Label" & ((Form6TextNo + 2) / 5 + 39)).Caption = Format(Cells(Form6RowNo + 122, 8).Value, "#,##0.00")
  Call Form6AmountRefresh("")
  Userform6.Label23.Caption = Chr(13) & "    Incorrect Amount Entered"
  Userform6.Label23.Visible = True
  Exit Sub
 ElseIf Userform6.Controls("TextBox" & Form6TextNo).Text = "" Then
  Cells(Form6RowNo + 122, 7).Value = 0
  Userform6.Label23.Visible = False
 Else
   CheckNum = Userform6.Controls("TextBox" & Form6TextNo).Text
   Userform6.Controls("TextBox" & Form6TextNo).Text = CheckNum
   Cells(Form6RowNo + 122, 7).Value = Userform6.Controls("TextBox" & Form6TextNo).Text
   Userform6.Label23.Visible = False
 End If
  Cells(Form6RowNo + 122, 8).Value = Round(Cells(Form6RowNo + 122, 6).Value * Cells(Form6RowNo + 122, 7).Value, 2)
  Cells(Form6RowNo + 122, 12).Value = Round(Cells(Form6RowNo + 122, 6).Value * Cells(Form6RowNo + 122, 11).Value, 2)
  Userform6.Controls("TextBox" & Form6TextNo - 1).Text = Cells(Form6RowNo + 122, 6).Value
  Userform6.Controls("TextBox" & Form6TextNo).Text = Cells(Form6RowNo + 122, 7).Value
  Userform6.Controls("Label" & ((Form6TextNo + 2) / 5 + 39)).Caption = Format(Cells(Form6RowNo + 122, 8).Value, "#,##0.00")
   Call Form6AmountRefresh("")
End Sub

Sub Form6Col7Exit(Form6RowNo As Long, TextRow As Long)
Dim I As Long, LineNo As Long, LowQtyFlag As String, StockQty As Double, ProductNo As String, CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
If Userform6.Label1.Caption <> "SALES ORDER " Then
 Userform6.Controls("TextBox" & TextRow + 39).Text = Cells(Form6RowNo + 122, 18).Value
 Exit Sub
End If
 Userform6.Label23.Visible = False
 If Cells(Form6RowNo + 122, 18).Value = Userform6.Controls("TextBox" & TextRow + 39).Text Then Exit Sub
  LowQtyFlag = ""
  ProductNo = ""
If IsNumeric(Userform6.Controls("TextBox" & TextRow + 39).Text) = False And Userform6.Controls("TextBox" & TextRow + 39).Text <> "" Then
  Cells(Form6RowNo + 122, 18).Value = 0
  Cells(Form6RowNo + 122, 19).Value = 0
  Cells(Form6RowNo + 122, 20).Value = Cells(Form6RowNo + 122, 6).Value
  Cells(Form6RowNo + 122, 21).Value = Cells(Form6RowNo + 122, 8).Value
  Userform6.Label23.Caption = Chr(13) & "    Incorrect Quantity Entered"
  Userform6.Label23.Visible = True
  Exit Sub
ElseIf Userform6.Controls("TextBox" & TextRow + 39).Text = "" Then
  Cells(Form6RowNo + 122, 18).Value = 0
  Cells(Form6RowNo + 122, 19).Value = 0
  Cells(Form6RowNo + 122, 20).Value = Cells(Form6RowNo + 122, 6).Value
  Cells(Form6RowNo + 122, 21).Value = Cells(Form6RowNo + 122, 8).Value
  Userform6.Label23.Visible = False
Else
 CheckNum = Userform6.Controls("TextBox" & TextRow + 39).Text
 Userform6.Controls("TextBox" & TextRow + 39).Text = CheckNum
 If Val(Userform6.Controls("TextBox" & TextRow + 39).Text) > Cells(Form6RowNo + 122, 6).Value Then
   Userform6.Label23.Caption = Chr(13) & "    Quantity for invoice cannot be greater than the Order Quantity"
   Userform6.Label23.Visible = True
   Userform6.Controls("TextBox" & TextRow + 39).Text = Cells(Form6RowNo + 122, 18).Value
   Exit Sub
 End If
End If
If Cells(Form6RowNo + 122, 13).Value <> "" And Val(Userform6.Controls("TextBox" & TextRow + 39).Text) > Cells(Form6RowNo + 122, 14).Value Then
  Userform6.Label23.Caption = Chr(13) & "    Insufficient Stock Quantity"
  Userform6.Label23.Visible = True
  Userform6.Controls("TextBox" & TextRow + 39).Text = Cells(Form6RowNo + 122, 18).Value
  Exit Sub
End If
  Cells(Form6RowNo + 122, 18).Value = Userform6.Controls("TextBox" & TextRow + 39).Text
  Cells(Form6RowNo + 122, 19).Value = Round(Cells(Form6RowNo + 122, 18).Value * Cells(Form6RowNo + 122, 7).Value, 2)
  Cells(Form6RowNo + 122, 20).Value = Cells(Form6RowNo + 122, 6).Value - Cells(Form6RowNo + 122, 18).Value
  Cells(Form6RowNo + 122, 21).Value = Round(Cells(Form6RowNo + 122, 20).Value * Cells(Form6RowNo + 122, 7).Value, 2)
  Userform6.Label23.Visible = False
   If Cells(Form6RowNo + 122, 15).Value = "*" Then LowQtyFlag = ""
     StockNo = Cells(Form6RowNo + 122, 13).Value
     If StockNo = "" Then GoTo Finish
       StockQty = Format(Cells(Form6RowNo + 122, 14).Value - Cells(Form6RowNo + 122, 18).Value, "0.0000")
       If StockQty < 0 Then
        LowQtyFlag = Cells(Form6RowNo + 122, 4).Value
        ProductNo = Cells(Form6RowNo + 122, 4).Value
       End If
       Cells(Form6RowNo + 123, 4).Select
       LowQtyLine = Form6RowNo + 122
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 9).Value = StockNo Then
        Cells(LowQtyLine, 15).Value = "*"
        LowQtyFlag = ""
        ActiveCell.Offset(0, 10).Value = StockQty
          StockQty = Format(StockQty - ActiveCell.Offset(0, 14).Value, "0.0000")
          LowQtyLine = ActiveCell.Row
          If StockQty < 0 Then LowQtyFlag = ActiveCell.Value
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
  LineNo = Userform6.ScrollBar1.Value
  For I = 1 To 6
   Userform6.Controls("Label" & I + 50).Caption = Cells(LineNo + 121 + I, 14).Value
  Next I
 If LowQtyFlag <> "" Then
   If ProductNo <> "" Then
    Userform6.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & ProductNo
   Else
    Userform6.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & LowQtyFlag
   End If
    Userform6.Label23.Visible = True
 End If
Finish:
End Sub

Sub Form6Text1Exit(RunCode As String)
Dim CustRow As Long, CreditSum As Double, FRow As Long, LRow As Long, BalSum As Double
Dim Tbl As Range, CheckRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" And _
    ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "SALES ORDER" Then
  Userform6.Label35.Visible = True
  Userform6.Label35.Left = 84
  Userform6.Label35.Width = 138
  Userform6.TextBox39.Visible = False
  Userform6.TextBox39.Text = ""
  Userform6.TextBox46.Visible = False
  Userform6.TextBox46.Text = ""
End If
If Userform6.TextBox1.Text = "" Then
 CustNo = ""
 CustName = ""
 Address1 = ""
 Address2 = ""
 Address3 = ""
 CustContact = ""
 TelNo = ""
 SalesRep = ""
 PayTerm = ""
 DelName = ""
 DelAddress1 = ""
 DelAddress2 = ""
 DelAddress3 = ""
 DelContact = ""
 DisRate = 0
 Userform6.Label14.Caption = "Discount " & "(" & SysCurrency & ") : "
 Userform6.Label3.Caption = "Customer :   "
 Userform6.Label7.Caption = "Delivered To :   "
 Userform6.TextBox35.Text = SalesRep
 Userform6.TextBox36.Text = ""
 Call Form6AmountRefresh("")
 Userform6.Label33.Visible = False
 Userform6.Label36.Visible = False
 Userform6.Label35.Caption = ""
 Exit Sub
End If
CustNo = UCase(Userform6.TextBox1.Text)
If IsNumeric(CustNo) Then
 If Len(CustNo) < 6 Then
   CustNo = Right(("00000" & CustNo), 5)
 End If
End If

Userform6.TextBox1.Text = CustNo

If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) = True Then
 CustName = ""
 Address1 = ""
 Address2 = ""
 Address3 = ""
 CustContact = ""
 TelNo = ""
 SalesRep = ""
 PayTerm = ""
 DelName = ""
 DelAddress1 = ""
 DelAddress2 = ""
 DelAddress3 = ""
 DelContact = ""
 DisRate = 0
 Userform6.Label14.Caption = "Discount " & "(" & SysCurrency & ") : "
 Userform6.Label3.Caption = "Customer :   "
 Userform6.Label7.Caption = "Delivered To :   "
 Userform6.TextBox35.Text = SalesRep
 Userform6.TextBox36.Text = ""
 Call Form6AmountRefresh("")
 Userform6.Label23.Caption = Chr(13) & "    Incorrect Customer Number"
 Userform6.Label23.Visible = True
 Userform6.Label33.Visible = False
 Userform6.Label36.Visible = False
 Userform6.Label35.Caption = ""
 Exit Sub
Else
 CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
 MyBook.Worksheets("Customer Data").Activate
 Cells(CustRow, 2).Select
 CustNo = ActiveCell.Value
 CustName = ActiveCell.Offset(0, 1).Value
 Address1 = ActiveCell.Offset(0, 3).Value
 Address2 = ActiveCell.Offset(0, 4).Value
 Address3 = ActiveCell.Offset(0, 5).Value
 CreditSum = ActiveCell.Offset(0, 6).Value
 DisRate = ActiveCell.Offset(0, 7).Value / 100
 CustContact = ActiveCell.Offset(0, 8).Value
 TelNo = ""
 SalesRep = ActiveCell.Offset(0, 12).Value
 PayTerm = ActiveCell.Offset(0, 14).Value
 Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
 "     " & Address1 & Chr(13) & _
 "     " & Address2 & Chr(13) & _
 "     " & Address3 & Chr(13) & _
 "     Contact: " & CustContact
 Userform6.TextBox35.Text = SalesRep
 Userform6.Label14.Caption = ActiveCell.Offset(0, 7).Value & "% Discount " & "(" & SysCurrency & ") : "
 If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "SALES ORDER" Then
  DelName = ActiveCell.Offset(0, 15).Value
  DelAddress1 = ActiveCell.Offset(0, 16).Value
  DelAddress2 = ActiveCell.Offset(0, 17).Value
  DelAddress3 = ActiveCell.Offset(0, 18).Value
  DelContact = ActiveCell.Offset(0, 19).Value
   Userform6.Label7.Caption = "Goods delivered To :   " & Chr(13) & "     " & DelName & Chr(13) & _
   "     " & DelAddress1 & Chr(13) & _
   "     " & DelAddress2 & Chr(13) & _
   "     " & DelAddress3 & Chr(13) & _
   "     Contact: " & DelContact
 Worksheets("Receivable").Activate
  BalSum = 0
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(CustNo, CheckRange, 0)) Then GoTo NoBalance
  FRow = Application.Match(CustNo, CheckRange, 0) + 3
  LRow = Application.Match(CustNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
  BalSum = Application.Sum(Range(Cells(FRow, 11), Cells(LRow, 11)))
  BalSum = Format(BalSum, "0.00")
 End If
NoBalance:
 If UCase(PayTerm) <> "C.O.D." And UCase(PayTerm) <> "PREPAID" Then
  CreditSum = Format(CreditSum - BalSum, "0.00")
  Userform6.Label36.Caption = Format(CreditSum, "#,##0.00")
  Userform6.Label33.Caption = "Available Credit Amount (" & SysCurrency & ") : "
  Userform6.Label33.Visible = True
  Userform6.Label36.Visible = True
 Else
  Userform6.Label33.Visible = False
  Userform6.Label36.Visible = False
 End If
  Userform6.Label35.Caption = PayTerm
 End If
End If
  Call DueDateCal("")
  Userform6.ListBox1.Visible = False
  Userform6.Label23.Visible = False
  Call Form6AmountRefresh("")
End Sub

Sub Form6Update(RunCode As String)
Dim ProductNo As String, StockQty As Double, StockAmt As Double, UnitCost As Double, ProdRow As Long, I As Long
Dim DeleteAllow As Boolean
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D123").Select
 Do While ActiveCell.Value <> ""
  ProductNo = ActiveCell.Value
  If IsError(Application.Match(ProductNo, MyBook.Worksheets("Product Data").Columns("B"), 0)) = True Then
     Userform6.CommandButton1.Visible = False
     Userform6.CommandButton13.Visible = False
     Userform6.Label23.Caption = Chr(13) & "   Some Products are no longer in the Product List. " & Chr(13) & _
                                "    No amendment to this Invoice is allowed"
     Userform6.Label23.Visible = True
     Exit Sub
  End If
    ProdRow = Application.Match(ProductNo, MyBook.Worksheets("Product Data").Columns("B"), 0)
    ActiveCell.Offset(0, -1).NumberFormat = "General"
    ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 5).Value
   If MyBook.Worksheets("Product Data").Cells(ProdRow, 7).Value = "Yes" Then
     ActiveCell.Offset(0, 6).NumberFormat = "General"
     ActiveCell.Offset(0, 6).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 6).Value
     StockNo = MyBook.Worksheets("Product Data").Cells(ProdRow, 9).Value
     If StockNo <> ActiveCell.Offset(0, 9).Value Then
       Userform6.CommandButton1.Visible = False
       Userform6.CommandButton13.Visible = False
       Userform6.Label23.Caption = Chr(13) & "   The Stock no for some items have been changed. " & Chr(13) & _
                                "    No amendment to this Invoice is allowed"
       Userform6.Label23.Visible = True
       Exit Sub
      End If
    If StockNo = "" Then
     Userform6.CommandButton1.Visible = False
     Userform6.CommandButton13.Visible = False
     Userform6.Label23.Caption = Chr(13) & "   Note: The Stock # detail cannot be found. " & Chr(13) & _
                                "    No amendment to this Invoice is allowed"
     Userform6.Label23.Visible = True
     Exit Sub
    Else
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
         Userform6.CommandButton1.Visible = False
         Userform6.CommandButton13.Visible = False
         Userform6.Label23.Caption = Chr(13) & "   Note: The Stock # detail cannot be found. " & Chr(13) & _
                                "    No amendment to this Invoice is allowed"
         Userform6.Label23.Visible = True
         Exit Sub
      End If
      I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
      StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
      StockAmt = MyBook.Worksheets("StockRec").Cells(I, 9).Value
       ActiveCell.Offset(0, 10).Value = StockQty
       ActiveCell.Offset(0, 12).Value = StockAmt
        If ActiveCell.Offset(0, 5).Value <> MyBook.Worksheets("StockRec").Cells(I, 5).Value Then
          Userform6.CommandButton1.Visible = False
          Userform6.CommandButton13.Visible = False
          Userform6.Label23.Caption = Chr(13) & "   The Asset Account for some items have been changed. " & Chr(13) & _
                                "    No amendment to this Invoice is allowed"
          Userform6.Label23.Visible = True
         Exit Sub
        End If
       If StockQty <> 0 Then
         ActiveCell.Offset(0, 7).Value = StockAmt / StockQty
       Else
         ActiveCell.Offset(0, 7).Value = MyBook.Worksheets("StockRec").Cells(I, 10).Value
       End If
       ActiveCell.Offset(0, 8).Value = Round(ActiveCell.Offset(0, 7).Value * ActiveCell.Offset(0, 2).Value, 2)
    End If
   Else
     If ActiveCell.Offset(0, 9).Value <> "" Then
          Userform6.CommandButton1.Visible = False
          Userform6.CommandButton13.Visible = False
          Userform6.Label23.Caption = Chr(13) & "   " & ProductNo & " was changed from stock item to non-stock item. " & Chr(13) & _
                                "    No amendment to this Invoice is allowed"
          Userform6.Label23.Visible = True
         Exit Sub
     End If
    StockNo = ""
    ActiveCell.Offset(0, -1).NumberFormat = "General"
    ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 5).Value
    ActiveCell.Offset(0, 9).ClearContents
    ActiveCell.Offset(0, 5).ClearContents
    ActiveCell.Offset(0, 6).ClearContents
    ActiveCell.Offset(0, 7).ClearContents
    ActiveCell.Offset(0, 8).ClearContents
    ActiveCell.Offset(0, 10).Value = "N/A"
    ActiveCell.Offset(0, 11).ClearContents
    ActiveCell.Offset(0, 12).ClearContents
   End If
  ActiveCell.Offset(1, 0).Select
 Loop
    DeleteAllow = True
    Range("C123").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 14).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("Q1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("C123").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 10).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 10).Value
       StockQty = ActiveCell.Offset(0, 11).Value
       StockAmt = ActiveCell.Offset(0, 13).Value
       I = ActiveCell.Row
       Range("D100").Select
       Do While ActiveCell.Value <> ""
        If ActiveCell.Offset(0, 9).Value = StockNo Then
         ActiveCell.Offset(0, 10).Value = StockQty
         ActiveCell.Offset(0, 12).Value = StockAmt
         StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
         StockAmt = Format(StockAmt - ActiveCell.Offset(0, 8).Value, "0.00")
         ActiveCell.Offset(0, 11).Value = "*"
        End If
        ActiveCell.Offset(1, 0).Select
       Loop
        If StockQty < 0 Or StockAmt < 0 Then DeleteAllow = False
        If StockQty = 0 And StockAmt <> 0 Then DeleteAllow = False
       Cells(I, 3).Select
       Cells(I, 14).Value = StockQty
       Cells(I, 16).Value = StockAmt
      If StockQty = Cells(I, 6).Value Then
          Cells(I, 12).Value = StockAmt
       Else
         Cells(I, 12).Value = Round(Cells(I, 11).Value * (StockQty - Cells(I, 6).Value), 2)
         Cells(I, 12).Value = Round((StockAmt - Cells(I, 12).Value), 2)
       End If
       Do While ActiveCell.Offset(1, 10).Value = StockNo
        StockQty = Format(StockQty - ActiveCell.Offset(0, 3).Value, "0.0000")
        StockAmt = Format(StockAmt - ActiveCell.Offset(0, 9).Value, "0.00")
        ActiveCell.Offset(1, 11).Value = StockQty
        ActiveCell.Offset(1, 13).Value = StockAmt
        If StockQty = ActiveCell.Offset(1, 3).Value Then
          ActiveCell.Offset(1, 9).Value = StockAmt
        Else
         ActiveCell.Offset(1, 9).Value = Round(ActiveCell.Offset(1, 8).Value * (StockQty - ActiveCell.Offset(1, 3).Value), 2)
         ActiveCell.Offset(1, 9).Value = Round((StockAmt - ActiveCell.Offset(1, 9).Value), 2)
        End If
        ActiveCell.Offset(0, 12).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("Q123:Q142").ClearContents
 For I = 1 To 6
  Userform6.Controls("Label" & I + 14).Caption = I
  Userform6.Controls("TextBox" & I * 5).Text = Cells(122 + I, 4).Value
  Userform6.Controls("TextBox" & I * 5 + 1).Text = Cells(122 + I, 5).Value
  Userform6.Controls("TextBox" & I * 5 + 2).Text = Cells(122 + I, 6).Value
  Userform6.Controls("TextBox" & I * 5 + 3).Text = Cells(122 + I, 7).Value
  Userform6.Controls("Label" & I + 40).Caption = Format(Cells(122 + I, 8).Value, "#,##0.00")
  Userform6.Controls("Label" & I + 50).Caption = Cells(122 + I, 14).Value
  Next I
  Range("D100").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 9).Value <> "" And ActiveCell.Offset(0, 11).Value <> "*" Then
      StockNo = ActiveCell.Offset(0, 9).Value
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
         Userform6.Label1.Caption = "INVOICE "
         Userform6.CommandButton1.Visible = False
         Userform6.CommandButton13.Visible = False
         MsgBox ("Some stock numbers are no longer in the Stock List." & Chr(13) & Chr(13) & "Amendment to this Invoice is not allowed")
         Exit Sub
      End If
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
 If DeleteAllow = False Then Userform6.CommandButton13.Visible = False
End Sub

Sub InvPrint(RunCode As String)
Dim I As Long, J As Long, EntryNo As Long, K As Long, StartInv As String, EndInv As String
Dim CopyNo As Long, MSG1 As String, myMsg As String, StartRow As Long, EndRow As Long, LabelStatus As Boolean
Dim Sh As Shape, PicLocation As String, PicZoom As Single, CheckRange As Range, FirstInvRow As Long, LastInvRow As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 MyBook.Worksheets("Receivable").Activate
 If Range("B4").Value = "" Then
  MsgBox (" No invoice data is found in the record" & Chr(13) & "Invoice printing cannot be proceeded")
  Exit Sub
 End If
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("A1").End(xlDown).Select
  If ActiveCell.Value <> "INVOICE" Then
   MsgBox (" No invoice data is found in the record" & Chr(13) & "Invoice printing cannot be proceeded")
   Exit Sub
  End If
  LastInvRow = ActiveCell.Row
  If Range("A4").Value = "INVOICE" Then
    FirstInvRow = 4
  Else
    Range("A4").Select
    Do While ActiveCell.Value = "CREDIT NOTE"
     ActiveCell.Offset(5, 0).Select
    Loop
    ActiveCell.Offset(-4, 0).Select
    Do While ActiveCell.Value = "CREDIT NOTE"
     ActiveCell.Offset(1, 0).Select
    Loop
    FirstInvRow = ActiveCell.Row
  End If
Set CheckRange = Range(Cells(FirstInvRow, 2), Cells(LastInvRow, 2))
  J = LastInvRow - 29
  If J < FirstInvRow Then J = FirstInvRow
  StartInv = Cells(J, 2).Value
  EndInv = Cells(LastInvRow, 2).Value
  Userform18.TextBox1.Text = StartInv
  Userform18.TextBox2.Text = EndInv
  Userform6.Hide
  Userform18.Label5.Width = 24
  Userform18.Label6.Width = 24
  If Right(StartInv, 1) = " " Then
    Userform18.Label5.Visible = False
    Userform18.TextBox1.Left = 156
    Userform18.TextBox1.Width = 114
  Else
    Userform18.Label5.Visible = True
    Userform18.TextBox1.Left = 180
    Userform18.TextBox1.Width = 90
  End If
  If Right(EndInv, 1) = " " Then
    Userform18.Label6.Visible = False
    Userform18.TextBox2.Left = 156
    Userform18.TextBox2.Width = 114
  Else
    Userform18.Label6.Visible = True
    Userform18.TextBox2.Left = 180
    Userform18.TextBox2.Width = 90
  End If
  Userform18.Show
CheckInput:
  ThisWorkbook.Worksheets("Invoice").Activate
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Userform6.Show
      Exit Sub
    End If
  StartInv = Userform18.TextBox1.Text
  EndInv = Userform18.TextBox2.Text
  If StartInv > EndInv Then
    StartInv = Userform18.TextBox2.Text
    EndInv = Userform18.TextBox1.Text
   If (Userform18.Label6.Visible = True And Userform18.Label5.Visible = False) Or _
     (Userform18.Label6.Visible = False And Userform18.Label5.Visible = True) Then
    LabelStatus = True
   Else
    LabelStatus = 0
   End If
   If LabelStatus = True Then
    If Userform18.Label6.Visible = True Then
      Userform18.Label6.Visible = False
      Userform18.TextBox2.Left = 156
      Userform18.TextBox2.Width = 114
      Userform18.Label5.Visible = True
      Userform18.TextBox1.Left = 180
      Userform18.TextBox1.Width = 90
    Else
       Userform18.Label6.Visible = True
       Userform18.TextBox2.Left = 180
       Userform18.TextBox2.Width = 90
       Userform18.Label5.Visible = False
       Userform18.TextBox1.Left = 156
       Userform18.TextBox1.Width = 114
    End If
   End If
  End If
  If IsError(Application.Match(StartInv, CheckRange, 1)) Then
   StartRow = FirstInvRow
  Else
   StartRow = Application.Match(StartInv, CheckRange, 1)
   StartRow = StartRow + FirstInvRow - 1
   If StartInv <> MyBook.Worksheets("Receivable").Cells(StartRow, 2).Value Then StartRow = StartRow + 1
  End If
  If IsError(Application.Match(EndInv, CheckRange, 1)) Then
   EndRow = FirstInvRow - 1
  Else
   EndRow = Application.Match(EndInv, CheckRange, 1)
   EndRow = EndRow + FirstInvRow - 1
   If EndRow > LastInvRow Then EndRow = LastInvRow
  End If
 If StartRow > EndRow Then
   Userform18.Label4.BackColor = &H4C0&
   Userform18.Label4.Caption = Chr(13) & "   None of the specified Invoices are found in the record"
   Userform18.TextBox1.Text = StartInv
   Userform18.TextBox2.Text = EndInv
   Userform18.Label4.Visible = True
   Userform18.Show
   GoTo CheckInput
 End If
  Unload Userform18
  ThisWorkbook.Worksheets("InvForm").Activate
  Rows("1:2800").Select
  Selection.Copy
  Worksheets("Invoice").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Cells(1, 1).EntireRow.Insert
I = 2
JumpNo = 0
CopyNo = 0
Do While StartRow <= EndRow And CopyNo < 30
  MyBook.Worksheets("Receivable").Activate
   Rows(StartRow).Select
   Selection.Copy
  ThisWorkbook.Worksheets("Invoice").Activate
   Cells(1, 1).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Cells(I + 2, 1).Value = "INVOICE"
  Cells(I + 4, 8).Value = "Invoice # : "
  Cells(I + 6, 8).Value = "Customer PO : "
  Cells(I + 7, 8).Value = "Delivery note # : "
  Cells(I + 8, 6).Value = "Goods delivered to: "
  Cells(I + 40, 2).Value = "Payment Term : "
  Cells(I + 41, 2).Value = "Payment Due Date : "
  Cells(I + 5, 8).Value = "Date : "
  Cells(I + 8, 1).Value = "Customer : "
  Cells(I + 16, 1).Value = "Item"
  Cells(I + 16, 2).Value = "Product #"
  Cells(I + 16, 3).Value = "Product Description"
  Cells(I + 16, 7).Value = "Qty"
  Cells(I + 15, 8).Value = "Unit Price "
  Cells(I + 16, 8).Value = "(" & SysCurrency & ")"
  Cells(I + 15, 9).Value = "Amount "
  Cells(I + 16, 9).Value = "(" & SysCurrency & ")"
  Cells(I + 39, 8).Value = "Sub-Total : "
  Cells(I + 40, 8).Value = "Discount Amount : "
  Cells(I + 41, 8).Value = "Total : "
  Cells(I + 39, 2).Value = "Sales Person : "
  Cells(I + 45, 7).Value = "Authorized Signature"
  If Right(Range("B1"), 1) <> " " Then
   Cells(I + 4, 9).Value = "INV" & Range("B1").Value
  Else
   Cells(I + 4, 9).Value = Range("B1").Value
  End If
     
   With New StdFont
        .Name = "IDAutomationHC39M Free Version"
        If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
         Cells(I + 4, 1).RowHeight = 16.5
         Cells(I + 4, 1).VerticalAlignment = xlTop
         Cells(I + 4, 1).HorizontalAlignment = xlLeft
         Cells(I + 4, 1).Font.Name = "IDAutomationHC39M Free Version"
         Cells(I + 4, 1).Value = Code39(Cells(I + 4, 9).Value)
        End If
    End With
  
  Cells(I + 7, 9).Value = Range("B1").Value
  Cells(I + 6, 9).Value = Range("AB1").Value
  Cells(I + 40, 3).Value = Range("O1").Value
  Cells(I + 41, 3).Value = Format(Range("N1").Value, "yyyy/mm/dd")
  Cells(I + 9, 6).Value = "   " & Range("W1").Value
  Cells(I + 10, 6).Value = "   " & Range("X1").Value
  Cells(I + 11, 6).Value = "   " & Range("Y1").Value
  Cells(I + 12, 6).Value = "   " & Range("Z1").Value
  Cells(I + 13, 6).Value = "   Contact : " & Range("AA1").Value
  Cells(I + 5, 9).Value = Format(Range("D1").Value, "yyyy/mm/dd")
  Cells(I + 39, 9).Value = Range("AF1").Value + Range("AE1").Value
  Cells(I + 41, 9).Value = Range("AF1").Value
  Cells(I + 39, 3).Value = Range("AC1").Value
  If Range("IS1").Value = "" Then _
    Cells(I + 42, 2).Value = Range("IT1").Value & Chr(10) & Range("IU1").Value & Chr(10) & Range("IV1").Value
  If Range("AE1").Value = 0 Then
    Cells(I + 40, 9).Value = 0
  Else
    Cells(I + 40, 9).Value = Range("AE1").Value * (-1)
  End If
  Cells(I + 9, 1).Value = "   " & Range("Q1").Value
  Cells(I + 10, 1).Value = "   " & Range("R1").Value
  Cells(I + 11, 1).Value = "   " & Range("S1").Value
  Cells(I + 12, 1).Value = "   " & Range("T1").Value
  If Range("V1").Value <> "" Then
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value & " (Tel: " & Range("V1").Value & ")"
  Else
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value
  End If
  If Range("O1").Value = "C.O.D." Or UCase(Range("O1").Value) = "PREPAID" Then
    Range(Cells(I + 41, 2), Cells(I + 41, 3)).ClearContents
  End If
  EntryNo = Range("AD1").Value
  Cells(I + 18, 1).Select
  For K = 1 To EntryNo
   ActiveCell.Value = K
   ActiveCell.Offset(0, 1).Value = Cells(1, K * 8 + 28).Value
   ActiveCell.Offset(0, 2).Value = Cells(1, K * 8 + 29).Value
   ActiveCell.Offset(0, 6).Value = Cells(1, K * 8 + 30).Value
   ActiveCell.Offset(0, 7).Value = Cells(1, K * 8 + 31).Value
   ActiveCell.Offset(0, 8).Value = Cells(1, K * 8 + 32).Value
   ActiveCell.Offset(1, 0).Select
  Next K
  Range(Cells(I + 8, 1), Cells(I + 38, 7)).Copy
  Cells(I + 53, 1).Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Cells(I + 50, 8).Value = "Date : "
  Cells(I + 47, 1).Value = "DELIVERY NOTE"
  Cells(I + 49, 8).Value = "Delivery note # : "
  Cells(I + 51, 8).Value = "Customer PO : "
  Cells(I + 49, 9).Value = Range("AH1").Value & Range("B1").Value
  Cells(I + 50, 9).Value = Format(Range("D1").Value, "yyyy/mm/dd")
  Cells(I + 51, 9).Value = Range("AB1").Value
  Cells(I + 84, 2).Value = "Goods Received by : "
  Cells(I + 88, 2).Value = "Authorized Signature and Stamp"
  Cells(I + 90, 2).Value = "Date : "
   I = I + 90
  CopyNo = CopyNo + 1
  StartRow = StartRow + 1
Loop
 Range(Cells(I + 1, 1), Cells(2760, 1)).EntireRow.Delete
 Rows(1).Delete
 If Cells(3, 1).Value <> "" Then Call InvPageLayout("Invoice")
 ThisWorkbook.Worksheets("Invoice").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 SheetName = "Invoice"
ThisWorkbook.Worksheets("Invoice").Activate
 ActiveSheet.CommandButton5.Visible = False
 ActiveWindow.DisplayGridlines = False
 Range("A1:K19").Select
 ActiveWindow.Zoom = True
 Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
myMsg = CopyNo & " Invoices printed.          "
  If StartRow <= EndRow And CopyNo = 30 Then
    MSG1 = "The number of invoices requested for printing exceeds 30" & Chr(13) _
     & "The system can only handle a maximum of 30 invoices each time." & Chr(13) & "Thus, only 30 invoices were processed.     "
    myMsg = "ALERT !!!" & Chr(13) & Chr(13) & myMsg & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + "Please Note    "
  End If
 MsgBox (myMsg)
End Sub

Sub MLInvoice(RunCode As String)
Dim TopLinesDel As Long, BotLinesDel As Long, LastLine As Long, RowNo As Long, TtlLines As Long, I As Long, SheetNo As Long
Dim ItemSum As Long, LastLineB As Long
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
    Columns("C").Select
    With Selection
        .ColumnWidth = 40.38
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlTop
        .WrapText = True
        .Orientation = 0
        .AddIndent = False
        .ShrinkToFit = False
        .MergeCells = False
    End With
   Worksheets("Report").Visible = xlSheetVeryHidden
  Application.DisplayAlerts = True
   Worksheets("InvForm1").Activate
  Rows("1:2800").Select
  Selection.Copy
  Worksheets("Invoice").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  
        If Range("A5") <> "" Then
         With New StdFont
          .Name = "IDAutomationHC39M Free Version"
          If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
            Range("A5").RowHeight = 16.5
            Range("A5").VerticalAlignment = xlTop
            Range("A5").HorizontalAlignment = xlLeft
            Range("A5").Font.Name = "IDAutomationHC39M Free Version"
            Range("A5").Value = Code39(Range("I5").Value)
          End If
         End With
        End If
        
   Range("C19:C38").Copy
  ThisWorkbook.Worksheets("Report").Activate
   Range("C19").Select
   Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
   Application.CutCopyMode = False
   Range("C19").Select
   SheetNo = 1
   TtlLines = 0
   Do While ActiveCell.Value <> ""
    RowNo = (Selection.RowHeight / 16.5) + 1
    ActiveCell.Offset(0, 1).Value = RowNo
    If RowNo > 21 Then GoTo LongDescription
    TtlLines = TtlLines + RowNo
    If TtlLines = 21 Then
     ActiveCell.Offset(0, 1).Value = RowNo - 1
     TtlLines = TtlLines - 1
    ElseIf TtlLines > 21 Then
     SheetNo = SheetNo + 1
     TtlLines = RowNo
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
  If SheetNo = 1 Then
    BotLinesDel = 0
    Range("C19").Select
    I = 19
    Do While ActiveCell.Value <> ""
     RowNo = ActiveCell.Offset(0, 1).Value
     ThisWorkbook.Worksheets("Invoice").Cells(I, 3).RowHeight = RowNo * 16.5
     ThisWorkbook.Worksheets("Invoice").Cells(I + 45, 3).RowHeight = RowNo * 16.5
     BotLinesDel = BotLinesDel + RowNo - 1
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    ThisWorkbook.Worksheets("Invoice").Activate
    Range("I4").Value = "Page 1 of 1 "
    Range("I49").Value = "Page 1 of 1 "
    Range("A19:G39").Copy
    Range("A64").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Rows("92:3000").Delete
    If BotLinesDel > 0 Then
      Range(Cells(83, 1), Cells(84 - BotLinesDel, 1)).EntireRow.Delete
      Range(Cells(38, 1), Cells(39 - BotLinesDel, 1)).EntireRow.Delete
    End If
  Else
    ThisWorkbook.Worksheets("Invoice").Activate
    Range("I4").Value = "Page 1 of " & SheetNo
     LastLineB = (SheetNo * 45) + 1
     For I = 1 To SheetNo
      RowNo = ((I - 1) * 45) + LastLineB + 1
      Range("A47:I91").Copy
      Cells(RowNo, 1).Select
       ActiveSheet.Paste
      Application.CutCopyMode = False
      Cells(RowNo + 2, 9).Value = "Page " & I & " of " & SheetNo
     Next I
     RowNo = (SheetNo - 1) * 45 + 2
     Range("A2:I46").Copy
     Cells(RowNo, 1).Select
      ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(RowNo + 2, 9).Value = "Page " & SheetNo & " of " & SheetNo
     Range("H40:I42").Select
     Selection.Borders(xlEdgeLeft).LineStyle = xlNone
     Selection.Borders(xlEdgeBottom).LineStyle = xlNone
     Selection.Borders(xlEdgeRight).LineStyle = xlNone
     Selection.Borders(xlInsideVertical).LineStyle = xlNone
     Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
     Selection.ClearContents
    For I = 2 To SheetNo - 1
     RowNo = ((I - 1) * 45) + 2
     Range("A2:I46").Copy
     Cells(RowNo, 1).Select
      ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(RowNo + 2, 9).Value = "Page " & I & " of " & SheetNo
    Next I
    Rows((SheetNo * 90 + 2) & ":3000").Delete
    TopLinesDel = 0
    LastLine = 1
    ItemSum = 0
    TtlLines = 0
    BotLinesDel = 0
    ThisWorkbook.Worksheets("Report").Activate
    Range("C19").Select
    I = 19
    Do While ActiveCell.Value <> ""
     RowNo = ActiveCell.Offset(0, 1).Value
     If (TtlLines + RowNo) > 20 Then
       ThisWorkbook.Worksheets("Invoice").Activate
       Range(Cells(LastLine + TopLinesDel + ItemSum + 18, 1), Cells(LastLine + 37, 9)).ClearContents
       Range(Cells(LastLine + TopLinesDel + 18, 1), Cells(LastLine + 37, 7)).Copy
       Cells(LastLineB + TopLinesDel + 18, 1).Select
       ActiveSheet.Paste
       Application.CutCopyMode = False
       BotLinesDel = BotLinesDel - TopLinesDel
      If BotLinesDel > 0 Then
        Range(Cells(LastLineB + 37, 1), Cells(LastLineB + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLineB + 38, 1), Cells(LastLineB + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLineB + 38, 1), Cells(LastLineB + 37 - BotLinesDel, 1)).RowHeight = 16.5
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLineB + 18, 1), Cells(LastLineB + 17 + TopLinesDel, 1)).EntireRow.Delete
      If BotLinesDel > 0 Then
        Range(Cells(LastLine + 37, 1), Cells(LastLine + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).RowHeight = 16.5
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLine + 18, 1), Cells(LastLine + 17 + TopLinesDel, 1)).EntireRow.Delete
       BotLinesDel = BotLinesDel + TopLinesDel
       LastLine = LastLine + 45 - BotLinesDel
       LastLineB = LastLineB + 45 - BotLinesDel - BotLinesDel
       TtlLines = 0
       BotLinesDel = 0
       ItemSum = 0
       TopLinesDel = I - 19
       ThisWorkbook.Worksheets("Report").Activate
     End If
     TtlLines = TtlLines + RowNo
     ItemSum = ItemSum + 1
     ThisWorkbook.Worksheets("Invoice").Cells(LastLine + I - 1, 3).RowHeight = RowNo * 16.5
     ThisWorkbook.Worksheets("Invoice").Cells(LastLineB + I - 1, 3).RowHeight = RowNo * 16.5
     BotLinesDel = BotLinesDel + RowNo - 1
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
       ThisWorkbook.Worksheets("Invoice").Activate
     BotLinesDel = BotLinesDel - TopLinesDel
      If BotLinesDel > 0 Then
        Range(Cells(LastLineB + 37, 1), Cells(LastLineB + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLineB + 38, 1), Cells(LastLineB + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLineB + 38, 1), Cells(LastLineB + 37 - BotLinesDel, 1)).RowHeight = 16.5
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLineB + 18, 1), Cells(LastLineB + 17 + TopLinesDel, 1)).EntireRow.Delete
      If BotLinesDel > 0 Then
        Range(Cells(LastLine + 37, 1), Cells(LastLine + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).RowHeight = 16.5
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLine + 18, 1), Cells(LastLine + 17 + TopLinesDel, 1)).EntireRow.Delete
  End If
Call InvPageLayout("Invoice")
ThisWorkbook.Worksheets("Invoice").Visible = xlSheetVisible
Worksheets("System Menu").Visible = xlSheetVeryHidden
SheetName = "Invoice"
 ActiveWindow.DisplayGridlines = False
Exit Sub
LongDescription:
 MsgBox ("Data Error!!!" & Chr(13) & Chr(13) & "Product Description is too long to be printed ")
 Call ReturnToMainMenu("")
End Sub
Sub MLCN(RunCode As String)
Dim TopLinesDel As Long, BotLinesDel As Long, LastLine As Long, RowNo As Long, TtlLines As Long, I As Long, SheetNo As Long
Dim ItemSum As Long
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
    Columns("C").Select
    With Selection
        .ColumnWidth = 40.38
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlTop
        .WrapText = True
        .Orientation = 0
        .AddIndent = False
        .ShrinkToFit = False
        .MergeCells = False
    End With
   Worksheets("Report").Visible = xlSheetVeryHidden
  Application.DisplayAlerts = True
  Worksheets("InvForm1").Activate
   Rows("1:1400").Select
  Selection.Copy
  Worksheets("Invoice").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
        If RunCode = "PI" And Range("A5") <> "" Then
         With New StdFont
          .Name = "IDAutomationHC39M Free Version"
          If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
            Range("A5").RowHeight = 16.5
            Range("A5").VerticalAlignment = xlTop
            Range("A5").HorizontalAlignment = xlLeft
            Range("A5").Font.Name = "IDAutomationHC39M Free Version"
            Range("A5").Value = Code39(Range("I5").Value)
          End If
         End With
        End If
   If RunCode = "CN" Then
    Range("F9:I14").Select
    Selection.Borders(xlEdgeTop).LineStyle = xlNone
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
   End If
   Range("C19:C38").Copy
  ThisWorkbook.Worksheets("Report").Activate
   Range("C19").Select
   Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
   Application.CutCopyMode = False
   Range("C19").Select
   SheetNo = 1
   TtlLines = 0
   Do While ActiveCell.Value <> ""
    RowNo = (Selection.RowHeight / 16.5) + 1
    ActiveCell.Offset(0, 1).Value = RowNo
    If RowNo > 21 Then GoTo LongDescription
    TtlLines = TtlLines + RowNo
    If TtlLines = 21 Then
     ActiveCell.Offset(0, 1).Value = RowNo - 1
     TtlLines = TtlLines - 1
    ElseIf TtlLines > 21 Then
     SheetNo = SheetNo + 1
     TtlLines = RowNo
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
  If SheetNo = 1 Then
    BotLinesDel = 0
    Range("C19").Select
    I = 19
    Do While ActiveCell.Value <> ""
     RowNo = ActiveCell.Offset(0, 1).Value
     ThisWorkbook.Worksheets("Invoice").Cells(I, 3).RowHeight = RowNo * 16.5
     BotLinesDel = BotLinesDel + RowNo - 1
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    ThisWorkbook.Worksheets("Invoice").Activate
    Range("I4").Value = "Page 1 of 1 "
    Rows("47:3000").Delete
    If BotLinesDel > 0 Then Range(Cells(38, 1), Cells(39 - BotLinesDel, 1)).EntireRow.Delete
  Else
    ThisWorkbook.Worksheets("Invoice").Activate
    Range("I4").Value = "Page 1 of " & SheetNo
     RowNo = ((SheetNo - 1) * 45) + 3
     Range("A3:I46").Copy
     Cells(RowNo, 1).Select
      ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(RowNo + 1, 9).Value = "Page " & SheetNo & " of " & SheetNo
     Range(Cells(40, 8), Cells(42, 9)).Select
     Selection.Borders(xlEdgeLeft).LineStyle = xlNone
     Selection.Borders(xlEdgeBottom).LineStyle = xlNone
     Selection.Borders(xlEdgeRight).LineStyle = xlNone
     Selection.Borders(xlInsideVertical).LineStyle = xlNone
     Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
     Selection.ClearContents
    For I = 2 To SheetNo - 1
     RowNo = ((I - 1) * 45) + 3
     Range("A3:I46").Copy
     Cells(RowNo, 1).Select
      ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(RowNo + 1, 9).Value = "Page " & I & " of " & SheetNo
    Next I
    Rows((SheetNo * 45 + 2) & ":3000").Delete
    TopLinesDel = 0
    LastLine = 1
    ItemSum = 0
    TtlLines = 0
    BotLinesDel = 0
    ThisWorkbook.Worksheets("Report").Activate
    Range("C19").Select
    I = 19
    Do While ActiveCell.Value <> ""
     RowNo = ActiveCell.Offset(0, 1).Value
     If (TtlLines + RowNo) > 20 Then
       ThisWorkbook.Worksheets("Invoice").Activate
       Range(Cells(LastLine + TopLinesDel + ItemSum + 18, 1), Cells(LastLine + 37, 9)).ClearContents
       BotLinesDel = BotLinesDel - TopLinesDel
      If BotLinesDel > 0 Then
        Range(Cells(LastLine + 37, 1), Cells(LastLine + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).RowHeight = 16.5
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLine + 18, 1), Cells(LastLine + 17 + TopLinesDel, 1)).EntireRow.Delete
       BotLinesDel = BotLinesDel + TopLinesDel
       LastLine = LastLine + 45 - BotLinesDel
       TtlLines = 0
       BotLinesDel = 0
       ItemSum = 0
       TopLinesDel = I - 19
       ThisWorkbook.Worksheets("Report").Activate
     End If
     TtlLines = TtlLines + RowNo
     ItemSum = ItemSum + 1
     ThisWorkbook.Worksheets("Invoice").Cells(LastLine + I - 1, 3).RowHeight = RowNo * 16.5
     BotLinesDel = BotLinesDel + RowNo - 1
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
       ThisWorkbook.Worksheets("Invoice").Activate
     BotLinesDel = BotLinesDel - TopLinesDel
      If BotLinesDel > 0 Then
        Range(Cells(LastLine + 37, 1), Cells(LastLine + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).RowHeight = 16.5
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLine + 18, 1), Cells(LastLine + 17 + TopLinesDel, 1)).EntireRow.Delete
  End If
Call InvPageLayout("Invoice")
ThisWorkbook.Worksheets("Invoice").Visible = xlSheetVisible
Worksheets("System Menu").Visible = xlSheetVeryHidden
SheetName = "Invoice"
 ActiveWindow.DisplayGridlines = False
Exit Sub
LongDescription:
 MsgBox ("Data Error!!!" & Chr(13) & Chr(13) & "Product Description is too long to be printed ")
 Call ReturnToMainMenu("")
End Sub
Sub MLPO(RunCode As String)
Dim TopLinesDel As Long, BotLinesDel As Long, LastLine As Long, RowNo As Long, TtlLines As Long, I As Long, SheetNo As Long
Dim ItemSum As Long
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
    Columns("C").Select
    With Selection
        .ColumnWidth = 40.35
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlTop
        .WrapText = True
        .Orientation = 0
        .AddIndent = False
        .ShrinkToFit = False
        .MergeCells = False
    End With
   Worksheets("Report").Visible = xlSheetVeryHidden
  Application.DisplayAlerts = True
   Worksheets("POForm1").Activate
  Rows("1:1500").Select
  Selection.Copy
  Worksheets("PO").Select
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
        If RunCode = "PO" And Range("A5") <> "" Then
         With New StdFont
          .Name = "IDAutomationHC39M Free Version"
          If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
            Range("A5").RowHeight = 18
            Range("A5").VerticalAlignment = xlTop
            Range("A5").HorizontalAlignment = xlLeft
            Range("A5").Font.Name = "IDAutomationHC39M Free Version"
            Range("A5").Value = Code39(Range("H5").Value)
          End If
         End With
        End If
   If RunCode = "DN" Then
    Range("E9:I14").Select
    Selection.Borders(xlEdgeTop).LineStyle = xlNone
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
   End If
   Range("C19:C38").Copy
  ThisWorkbook.Worksheets("Report").Activate
   Range("C19").Select
   Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
   Application.CutCopyMode = False
   Range("C19").Select
   SheetNo = 1
   TtlLines = 0
   Do While ActiveCell.Value <> ""
    RowNo = (Selection.RowHeight / 16.5) + 1
    ActiveCell.Offset(0, 1).Value = RowNo
    If RowNo > 21 Then GoTo LongDescription
    TtlLines = TtlLines + RowNo
    If TtlLines = 21 Then
     ActiveCell.Offset(0, 1).Value = RowNo - 1
     TtlLines = TtlLines - 1
    ElseIf TtlLines > 21 Then
     SheetNo = SheetNo + 1
     TtlLines = RowNo
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
  If SheetNo = 1 Then
    BotLinesDel = 0
    Range("C19").Select
    I = 19
    Do While ActiveCell.Value <> ""
     RowNo = ActiveCell.Offset(0, 1).Value
     ThisWorkbook.Worksheets("PO").Cells(I, 3).RowHeight = RowNo * 16.5
     BotLinesDel = BotLinesDel + RowNo - 1
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    ThisWorkbook.Worksheets("PO").Activate
    Range("I4").Value = "Page 1 of 1 "
    Rows("48:1500").Delete
    If BotLinesDel > 0 Then Range(Cells(38, 1), Cells(39 - BotLinesDel, 1)).EntireRow.Delete
  Else
    ThisWorkbook.Worksheets("PO").Activate
    Range("I4").Value = "Page 1 of " & SheetNo
     RowNo = ((SheetNo - 1) * 46) + 3
     Range("A3:I47").Copy
     Cells(RowNo, 1).Select
      ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(RowNo + 1, 9).Value = "Page " & SheetNo & " of " & SheetNo
     Range("H40:I40").Select
     Selection.Borders(xlEdgeLeft).LineStyle = xlNone
     Selection.Borders(xlEdgeBottom).LineStyle = xlNone
     Selection.Borders(xlEdgeRight).LineStyle = xlNone
     Selection.Borders(xlInsideVertical).LineStyle = xlNone
     Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
     Selection.ClearContents
    For I = 2 To SheetNo - 1
     RowNo = ((I - 1) * 46) + 3
     Range("A3:I47").Copy
     Cells(RowNo, 1).Select
      ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(RowNo + 1, 9).Value = "Page " & I & " of " & SheetNo
    Next I
    Rows((SheetNo * 46 + 2) & ":1500").Delete
    TopLinesDel = 0
    LastLine = 1
    ItemSum = 0
    TtlLines = 0
    BotLinesDel = 0
    ThisWorkbook.Worksheets("Report").Activate
    Range("C19").Select
    I = 19
    Do While ActiveCell.Value <> ""
     RowNo = ActiveCell.Offset(0, 1).Value
     If (TtlLines + RowNo) > 20 Then
       ThisWorkbook.Worksheets("PO").Activate
       Range(Cells(LastLine + TopLinesDel + ItemSum + 18, 1), Cells(LastLine + 37, 9)).ClearContents
       BotLinesDel = BotLinesDel - TopLinesDel
      If BotLinesDel > 0 Then
        Range(Cells(LastLine + 37, 1), Cells(LastLine + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).RowHeight = 18
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLine + 18, 1), Cells(LastLine + 17 + TopLinesDel, 1)).EntireRow.Delete
       BotLinesDel = BotLinesDel + TopLinesDel
       LastLine = LastLine + 46 - BotLinesDel
       TtlLines = 0
       BotLinesDel = 0
       ItemSum = 0
       TopLinesDel = I - 19
       ThisWorkbook.Worksheets("Report").Activate
     End If
     TtlLines = TtlLines + RowNo
     ItemSum = ItemSum + 1
     ThisWorkbook.Worksheets("PO").Cells(LastLine + I - 1, 3).RowHeight = RowNo * 18
     BotLinesDel = BotLinesDel + RowNo - 1
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
       ThisWorkbook.Worksheets("PO").Activate
     BotLinesDel = BotLinesDel - TopLinesDel
      If BotLinesDel > 0 Then
        Range(Cells(LastLine + 37, 1), Cells(LastLine + 38 - BotLinesDel, 1)).EntireRow.Delete
      ElseIf BotLinesDel < 0 Then
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).EntireRow.Insert
        Range(Cells(LastLine + 38, 1), Cells(LastLine + 37 - BotLinesDel, 1)).RowHeight = 18
      End If
      If TopLinesDel > 0 Then Range(Cells(LastLine + 18, 1), Cells(LastLine + 17 + TopLinesDel, 1)).EntireRow.Delete
  End If
   Call POPageLayout("PO")
ThisWorkbook.Worksheets("PO").Visible = xlSheetVisible
Worksheets("System Menu").Visible = xlSheetVeryHidden
SheetName = "PO"
Worksheets("PO").Activate
ActiveWindow.DisplayGridlines = False
Exit Sub
LongDescription:
 MsgBox ("Data Error!!!" & Chr(13) & Chr(13) & "Product Description is too long to be printed ")
 Call ReturnToMainMenu("")
End Sub

Sub CNPrint(RunCode As String)
Dim I As Long, J As Long, EntryNo As Long, K As Long, StartInv As String, EndInv As String, WorkInv As String, WorkCN As String
Dim JumpNo As Long, CopyNo As Long
Dim Sh As Shape, PicLocation As String, PicZoom As Single
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 MyBook.Worksheets("Receivable").Activate
  If Range("F1").Value = "00000" Then
    MsgBox (" No Credit Note data is found in the record" & Chr(13) & "Credit Note printing cannot be proceeded")
    Exit Sub
  End If
 If Range("B4").Value = "" Then
  MsgBox (" No Credit Note data is found in the record" & Chr(13) & "Credit Note printing cannot be proceeded")
  Exit Sub
 End If
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlDescending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Range("B1").End(xlDown).Select
 If Left(ActiveCell.Value, 1) <> "C" Then
  MsgBox (" No Credit Note data is found in the record" & Chr(13) & "Credit Note printing cannot be proceeded")
  Exit Sub
 End If
 For J = 1 To 30
   If Left(ActiveCell.Value, 1) <> "C" Then Exit For
   ActiveCell.Offset(-1, 0).Select
 Next J
   J = ActiveCell.Row + 1
  Userform18.TextBox2.Text = Range("F1").Value
  I = Val(Range("F1").Value) - 29
  If I < 0 Then I = 1
  StartInv = "CN" & Right("00000" & I, 5)
 If Cells(J, 2).Value > StartInv Then StartInv = Cells(J, 2).Value
 StartInv = Right(StartInv, 5)
 Userform18.TextBox1.Text = StartInv
  Userform6.Hide
  Userform18.Caption = "Multiple Credit Notes Print-Out"
  Userform18.Label1.Caption = "Beginning Credit Note # : "
  Userform18.Label2.Caption = "Ending Credit Note # : "
  Userform18.Label3.Caption = "Enter the range of Credit Note # below" & Chr(13) & " ( Maximum 30 Credit Notes ) "
  Userform18.Label5.Caption = "CN"
  Userform18.Label5.Visible = True
  Userform18.Label6.Caption = "CN"
  Userform18.Label6.Visible = True
  Userform18.TextBox1.Left = 174
  Userform18.TextBox2.Left = 174
  Userform18.Show
CheckInput:
  ThisWorkbook.Worksheets("Invoice").Activate
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Userform6.Show
      Exit Sub
    End If
    If IsNumeric(Userform18.TextBox1.Value) = False Then
       Userform18.Label4.BackColor = &H4C0&
       Userform18.Label4.Caption = Chr(13) & "     Beginning Credit note # is Not a valid Credit Note # "
       Userform18.Label4.Visible = True
       Userform18.Show
       GoTo CheckInput
     End If
    If IsNumeric(Userform18.TextBox2.Value) = False Then
       Userform18.Label4.BackColor = &H4C0&
       Userform18.Label4.Caption = Chr(13) & "     Ending Credit note # is Not a valid Credit Note # "
       Userform18.Label4.Visible = True
       Userform18.Show
       GoTo CheckInput
     End If
  StartInv = Userform18.TextBox1.Text
  EndInv = Userform18.TextBox2.Value
  If StartInv > EndInv Then
    StartInv = Userform18.TextBox2.Text
    EndInv = Userform18.TextBox1.Value
  End If
  Unload Userform18
  ThisWorkbook.Worksheets("CNForm").Activate
  Rows("1:1400").Select
  Selection.Copy
  Worksheets("Invoice").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Cells(1, 1).EntireRow.Insert
I = 2
WorkInv = StartInv
JumpNo = 0
CopyNo = 0
Do While WorkInv <= EndInv And CopyNo < 30
  WorkCN = "CN" & WorkInv
If IsError(Application.Match(WorkCN, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = False Then
   J = Application.Match(WorkCN, MyBook.Worksheets("Receivable").Range("B:B"), 0)
  MyBook.Worksheets("Receivable").Activate
   Rows(J).Select
   Selection.Copy
  ThisWorkbook.Worksheets("Invoice").Activate
   Cells(1, 1).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Cells(I + 2, 1).Value = "CREDIT NOTE"
  Cells(I + 4, 8).Value = "Credit Note # : "
  Cells(I + 6, 8).Value = "Ref Invoice : "
  Cells(I + 5, 8).Value = "Date : "
  Cells(I + 8, 1).Value = "Customer : "
  Cells(I + 16, 1).Value = "Item"
  Cells(I + 16, 2).Value = "Product #"
  Cells(I + 16, 3).Value = "Product Description"
  Cells(I + 16, 7).Value = "Qty"
  Cells(I + 15, 8).Value = "Unit Price "
  Cells(I + 16, 8).Value = "(" & SysCurrency & ")"
  Cells(I + 15, 9).Value = "Amount "
  Cells(I + 16, 9).Value = "(" & SysCurrency & ")"
  Cells(I + 39, 8).Value = "Sub-Total : "
  Cells(I + 40, 8).Value = "Discount Amount : "
  Cells(I + 41, 8).Value = "Total : "
  Cells(I + 40, 2).Value = "Sales Person : "
  Cells(I + 41, 2).Value = "Remarks : "
  Cells(I + 45, 7).Value = "Authorized Signature"
  If Range("IS1").Value = "" Then _
    Cells(I + 42, 2).Value = Range("IT1").Value & Chr(10) & Range("IU1").Value & Chr(10) & Range("IV1").Value
  Cells(I + 4, 9).Value = Range("AH1").Value & Range("B1").Value
  Cells(I + 6, 9).Value = Range("AB1").Value
  Cells(I + 41, 3).Value = Range("W1").Value    '
  Cells(I + 5, 9).Value = Format(Range("D1").Value, "yyyy/mm/dd")
  Cells(I + 39, 9).Value = Range("AF1").Value * (-1) + Range("AE1").Value
  Cells(I + 41, 9).Value = Range("AF1").Value * (-1)
  Cells(I + 40, 3).Value = Range("AC1").Value
  If Range("AE1").Value = 0 Then
    Cells(I + 40, 9).Value = 0
  Else
    Cells(I + 40, 9).Value = Range("AE1").Value * (-1)
  End If
  Cells(I + 9, 1).Value = "   " & Range("Q1").Value
  Cells(I + 10, 1).Value = "   " & Range("R1").Value
  Cells(I + 11, 1).Value = "   " & Range("S1").Value
  Cells(I + 12, 1).Value = "   " & Range("T1").Value
  If Range("V1").Value <> "" Then
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value & " (Tel: " & Range("V1").Value & ")"
  Else
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value
  End If
  EntryNo = Range("AD1").Value
  Cells(I + 18, 1).Select
  For K = 1 To EntryNo
   ActiveCell.Value = K
   ActiveCell.Offset(0, 1).Value = Cells(1, K * 8 + 28).Value
   ActiveCell.Offset(0, 2).Value = Cells(1, K * 8 + 29).Value
   ActiveCell.Offset(0, 6).Value = Cells(1, K * 8 + 30).Value * (-1)
   ActiveCell.Offset(0, 7).Value = Cells(1, K * 8 + 31).Value
   ActiveCell.Offset(0, 8).Value = Cells(1, K * 8 + 32).Value * (-1)
   ActiveCell.Offset(1, 0).Select
  Next K
  I = I + 45
  CopyNo = CopyNo + 1
Else
 JumpNo = JumpNo + 1
End If
    WorkInv = Right(("00000" & Val(WorkInv) + 1), 5)
Loop
Range(Cells(I + 1, 1), Cells(2760, 1)).EntireRow.Delete
Rows(1).Delete
If Range("H5").Value = "" Then
  Userform18.Caption = "Multiple Credit Notes Print-Out"
  Userform18.Label1.Caption = "Beginning Credit Note # : "
  Userform18.Label2.Caption = "Ending Credit Note # : "
  Userform18.Label3.Caption = "Enter the range of Credit Note # below" & Chr(13) & " ( Maximum 30 Credit Notes ) "
  Userform18.Label5.Caption = "CN"
  Userform18.Label5.Visible = True
  Userform18.Label6.Caption = "CN"
  Userform18.Label6.Visible = True
  Userform18.TextBox1.Left = 174
  Userform18.TextBox2.Left = 174
  Userform18.Label4.BackColor = &H4C0&
  Userform18.Label4.Caption = Chr(13) & "   None of the specified Credit Notes is found in the record"
  Userform18.TextBox1.Text = StartInv
  Userform18.TextBox2.Text = EndInv
  Userform18.Label4.Visible = True
  Userform18.Show
  GoTo CheckInput
End If
 If Cells(3, 1).Value <> "" Then Call InvPageLayout("Invoice")
 ThisWorkbook.Worksheets("Invoice").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 SheetName = "Invoice"
 ThisWorkbook.Worksheets("Invoice").Activate
 ActiveSheet.CommandButton5.Visible = False
 Range("A1:K19").Select
 ActiveWindow.Zoom = True
Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
If JumpNo > 0 Or (WorkInv <= EndInv And CopyNo = 30) Then
  If JumpNo = 1 Then
    MSG1 = "One Credit note is not found in the Record."
  ElseIf JumpNo > 1 Then
    MSG1 = JumpNo & " Credit Notes are not found in the Record."
  End If
  If WorkInv <= EndInv And CopyNo = 30 Then MSG2 = "The number of credit notes requested for printing exceeds 30" & Chr(13) _
     & "The system can only handle a maximum of 30 credit notes each time." & Chr(13) & "Thus, only 30 credit notes were processed."
  If MSG1 = "" Then
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG2 + Chr(13) + Chr(13) + "Please Note"
  ElseIf MSG2 = "" Then
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + "Please Note"
  Else
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + MSG2 + Chr(13) + Chr(13) + "Please Note"
  End If
 MsgBox (myMsg)
End If
End Sub
Sub DueDateCal(RunCode As String)
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" And _
   ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE" Then Exit Sub
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Then
  If UCase(Right(PayTerm, 4)) = "DAYS" Then
    DueDate = InvDate + Val(PayTerm)
  ElseIf UCase(Right(PayTerm, 4)) = " EOM" Then
    If Month(InvDate) < 12 Then
      DueDate = Year(InvDate) & "/" & Month(InvDate) + 1 & "/1"
    Else
      DueDate = Year(InvDate) + 1 & "/1/1"
    End If
    DueDate = DueDate - 1 + Val(PayTerm)
  ElseIf Right(PayTerm, 3) = "   " Then
    If DueDate < "2000/1/1" Then DueDate = InvDate
  Else
    DueDate = InvDate
  End If
Else
 DueDate = InvDate
End If
Userform6.TextBox36.Text = Format(DueDate, "yyyy/mm/dd")
End Sub
Sub Form6ViewOnly(RunCode As String)
Dim InvRow As Long, I As Long, InvPrefix As String
If Not (Userform6.Label1.Caption = "INVOICE " Or Userform6.Label1.Caption = "CREDIT NOTE " Or Userform6.Label1.Caption = "SALES ORDER ") Then Exit Sub
   InvNo = Userform6.TextBox2.Text
If Userform6.Label1.Caption = "INVOICE " Then
 If IsNumeric(InvNo) Then
  If Len(InvNo) < 7 Then
   InvNo = Right(("000000" & InvNo), 6)
   Userform6.Label38.Visible = True
   Userform6.TextBox2.Left = 450
   Userform6.TextBox2.Width = 90
   Userform6.TextBox2.Text = InvNo
  Else
   InvNo = InvNo & " "
   Userform6.Label38.Visible = False
   Userform6.TextBox2.Left = 426
   Userform6.TextBox2.Width = 114
  End If
 ElseIf Len(InvNo) = 9 Then
  If Left(InvNo, 3) = "INV" Then
   If IsNumeric(Right(InvNo, 6)) Then
    InvNo = Right(InvNo, 6)
    Userform6.Label38.Visible = True
   Userform6.TextBox2.Left = 450
   Userform6.TextBox2.Width = 90
   Userform6.TextBox2.Text = InvNo
   Else
    InvNo = InvNo & " "
    Userform6.Label38.Visible = False
   Userform6.TextBox2.Left = 426
   Userform6.TextBox2.Width = 114
   End If
  Else
   InvNo = InvNo & " "
   Userform6.Label38.Visible = False
   Userform6.TextBox2.Left = 426
   Userform6.TextBox2.Width = 114
  End If
 Else
  InvNo = InvNo & " "
  Userform6.Label38.Visible = False
   Userform6.TextBox2.Left = 426
   Userform6.TextBox2.Width = 114
 End If
ElseIf Userform6.Label1.Caption = "SALES ORDER " Then
 If IsNumeric(InvNo) Then
  If Len(InvNo) < 7 Then
   InvNo = Right(("000000" & InvNo), 6)
   Userform6.Label38.Visible = True
   Userform6.TextBox2.Left = 444
   Userform6.TextBox2.Width = 90
   Userform6.TextBox2.Text = InvNo
   InvNo = "PI" & InvNo
  Else
   InvNo = InvNo & " "
   Userform6.Label38.Visible = False
   Userform6.TextBox2.Left = 426
   Userform6.TextBox2.Width = 108
  End If
 ElseIf Len(InvNo) = 8 Then
  If Left(InvNo, 2) = "PI" Then
   If IsNumeric(Right(InvNo, 6)) Then
    InvNo = Right(InvNo, 6)
    Userform6.Label38.Visible = True
    Userform6.TextBox2.Left = 444
    Userform6.TextBox2.Width = 90
    Userform6.TextBox2.Text = InvNo
    InvNo = "PI" & InvNo
   Else
    InvNo = InvNo & " "
    Userform6.Label38.Visible = False
    Userform6.TextBox2.Left = 426
    Userform6.TextBox2.Width = 114
   End If
  Else
   InvNo = InvNo & " "
    Userform6.Label38.Visible = False
    Userform6.TextBox2.Left = 426
    Userform6.TextBox2.Width = 114
  End If
 Else
  InvNo = InvNo & " "
  Userform6.Label38.Visible = False
  Userform6.TextBox2.Left = 426
  Userform6.TextBox2.Width = 108
 End If
 GoTo PIViewOnly
Else
 If IsNumeric(InvNo) = False Then
  Call TempRPFormat("AR")
  Userform6.Label23.Caption = Chr(13) & "       Not a correct Credit Note #.  "
  Userform6.Label23.Visible = True
  Userform6.TextBox2.Text = InvNo
  Exit Sub
 Else
   InvNo = Right("00000" & Userform6.TextBox2.Text, 5)
   Userform6.TextBox2.Text = InvNo
   InvNo = "CN" & InvNo
  End If
End If
If IsError(Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = True Then
 If Userform6.Label1.Caption = "CREDIT NOTE " Then InvNo = Right(InvNo, 5)
  Call TempRPFormat("AR")
  If Userform6.Label1.Caption = "CREDIT NOTE " Then
   Userform6.Label23.Caption = Chr(13) & Chr(13) & "      The Credit Note is not found from the record.  "
  Else
    Userform6.Label23.Caption = Chr(13) & Chr(13) & "    The Invoice is not found from the record.  "
  End If
  Userform6.Label23.Visible = True
 Exit Sub
End If
 InvRow = Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("Receivable").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 InvStatus = Range("J1").Value
 CustNo = Range("P1").Value
 CustName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 SalesRep = Range("AC1").Value
 DisAmount = Range("AE1").Value
 TotalAmount = Range("AF1").Value
 InvPrefix = Range("AH1").Value
 DisRate = Range("AG1").Value
 InvDate = Range("D1").Value
 DueDate = Range("N1").Value
 CustPO = Range("AB1").Value
 PayTerm = Range("O1").Value
 If Range("IS1").Value = "" Then
    Userform6.TextBox47.Text = Range("IT1").Value
    Userform6.TextBox48.Text = Range("IU1").Value
    Userform6.TextBox49.Text = Range("IV1").Value
  Else
    Userform6.TextBox47.Text = ""
    Userform6.TextBox48.Text = ""
    Userform6.TextBox49.Text = ""
  End If
 If Userform6.Label1.Caption = "INVOICE " Then
  If TelNo <> "" Then
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
  Else
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact
  End If
   Userform6.Label7.Caption = "Delivered To :   " & Chr(13) & "     " & DelName & Chr(13) & _
   "     " & DelAddress1 & Chr(13) & _
   "     " & DelAddress2 & Chr(13) & _
   "     " & DelAddress3 & Chr(13) & _
   "     Contact: " & DelContact
   Userform6.TextBox1.Text = CustNo
   Userform6.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
   Userform6.TextBox4.Text = CustPO
   Userform6.TextBox35.Text = SalesRep
   Userform6.TextBox36.Text = Format(DueDate, "yyyy/mm/dd")
   Userform6.TextBox38.Text = InvPrefix
   Userform6.Label35.Caption = PayTerm
   If DisAmount = 0 Then
    Userform6.Label47.Caption = Format(DisAmount, "#,##0.00")
   Else
    Userform6.Label47.Caption = Format((DisAmount * (-1)), "#,##0.00")
   End If
   Userform6.Label25.Caption = Format(TotalAmount, "#,##0.00")
   TotalSum = TotalAmount + DisAmount
   Userform6.Label40.Caption = Format(TotalSum, "#,##0.00")
   For I = 15 To 20
    Userform6.Controls("Label" & I).Caption = I - 14
   Next I
  J = 122
  K = 1
  For I = 5 To 164 Step 8
   ActiveCell.Offset(J, K + 1).NumberFormat = "General"
   ActiveCell.Offset(J, K + 7).NumberFormat = "General"
   ActiveCell.Offset(J, K + 2).NumberFormat = "@"
   ActiveCell.Offset(J, K + 3).NumberFormat = "@"
   ActiveCell.Offset(J, K + 11).NumberFormat = "@"
   ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 30).Value
   ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
   ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
   ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value
   ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
   ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value
   J = J + 1
   K = 1
  Next I
 Else
  If TelNo <> "" Then
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
  Else
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact
  End If
   Userform6.TextBox39.Text = DelName
   Userform6.TextBox1.Text = CustNo
   Userform6.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
   Userform6.TextBox4.Text = CustPO
   Userform6.TextBox35.Text = SalesRep
   Userform6.TextBox36.Text = Format(DueDate, "yyyy/mm/dd")
   Userform6.TextBox38.Text = InvPrefix
   Userform6.Label35.Caption = PayTerm
   If DisAmount = 0 Then
    Userform6.Label47.Caption = Format(DisAmount, "#,##0.00")
   Else
    Userform6.Label47.Caption = Format((DisAmount * (-1)), "#,##0.00")
   End If
   If TotalAmount = 0 Then
    Userform6.Label25.Caption = "0.00"
   Else
    TotalAmount = TotalAmount * (-1)
    Userform6.Label25.Caption = Format(TotalAmount, "#,##0.00")
   End If
  TotalSum = TotalAmount + DisAmount
  Userform6.Label40.Caption = Format(TotalSum, "#,##0.00")
  For I = 15 To 20
   Userform6.Controls("Label" & I).Caption = I - 14
  Next I
   J = 122
   K = 1
   For I = 5 To 164 Step 8
    ActiveCell.Offset(J, K + 1).NumberFormat = "General"
    ActiveCell.Offset(J, K + 7).NumberFormat = "General"
    ActiveCell.Offset(J, K + 2).NumberFormat = "@"
    ActiveCell.Offset(J, K + 3).NumberFormat = "@"
    ActiveCell.Offset(J, K + 11).NumberFormat = "@"
    ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 30).Value
    ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
    ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
    If Cells(1, I + 33).Value <> "" Or Cells(1, I + 33).Value <> 0 Then ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value * (-1)
     ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
    If Cells(1, I + 35).Value <> "" Or Cells(1, I + 35).Value <> 0 Then ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value * (-1)
    J = J + 1
    K = 1
   Next I
 End If
 GoTo Finish
PIViewOnly:
If IsError(Application.Match(InvNo, MyBook.Worksheets("ProInvoice").Range("B:B"), 0)) = True Then
  Call TempRPFormat("AR")
  Userform6.Label23.Caption = Chr(13) & "       The Sales Order is not found from the record.  "
  Userform6.Label23.Visible = True
  If Right(InvNo, 1) <> " " Then Userform6.TextBox2.Text = Right(InvNo, 6)
 Exit Sub
End If
 InvRow = Application.Match(InvNo, MyBook.Worksheets("ProInvoice").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("ProInvoice").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 InvStatus = Range("J1").Value
 CustNo = Range("P1").Value
 CustName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 SalesRep = Range("AC1").Value
 DisAmount = Range("AE1").Value
 TotalAmount = Range("AF1").Value
 InvPrefix = Range("AH1").Value
 DisRate = Range("AG1").Value
 InvDate = Range("D1").Value
 Userform6.TextBox36.Text = Range("N1").Value
 CustPO = Range("AB1").Value
 PayTerm = Range("O1").Value
  If TelNo <> "" Then
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
  Else
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact
  End If
 Userform6.Label7.Caption = "Delivered To :   " & Chr(13) & "     " & DelName & Chr(13) & _
 "     " & DelAddress1 & Chr(13) & _
 "     " & DelAddress2 & Chr(13) & _
 "     " & DelAddress3 & Chr(13) & _
 "     Contact: " & DelContact
 Userform6.TextBox1.Text = CustNo
 Userform6.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 Userform6.TextBox4.Text = CustPO
 Userform6.TextBox35.Text = SalesRep
 Userform6.TextBox38.Text = InvPrefix
 Userform6.Label35.Caption = PayTerm
 Userform6.Label14.Caption = DisRate * 100 & "% Discount " & "(" & SysCurrency & ") : "
 If DisAmount = 0 Then
  Userform6.Label47.Caption = Format(DisAmount, "#,##0.00")
 Else
  Userform6.Label47.Caption = Format((DisAmount * (-1)), "#,##0.00")
 End If
 Userform6.Label25.Caption = Format(TotalAmount, "#,##0.00")
For I = 15 To 20
 Userform6.Controls("Label" & I).Caption = I - 14
Next I
J = 122
K = 1
For I = 5 To 164 Step 8
 ActiveCell.Offset(J, K + 1).NumberFormat = "General"
 ActiveCell.Offset(J, K + 7).NumberFormat = "General"
 ActiveCell.Offset(J, K + 2).NumberFormat = "@"
 ActiveCell.Offset(J, K + 3).NumberFormat = "@"
 ActiveCell.Offset(J, K + 11).NumberFormat = "@"
 ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 30).Value
 ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
 ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
 ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value
 ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
 ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value
 ActiveCell.Offset(J, K + 10).Value = Cells(1, I + 36).Value
 ActiveCell.Offset(J, K + 11).Value = Cells(1, I + 37).Value
 J = J + 1
 K = 1
 Next I
Finish:
 Range("D123").Select
 For I = 5 To 34 Step 5
  Userform6.Controls("TextBox" & I).Text = ActiveCell.Value
  Userform6.Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
  Userform6.Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
  Userform6.Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
  Userform6.Controls("Label" & I / 5 + 40).Caption = ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
 Next I
 Userform6.ScrollBar1.Value = 1
 For J = 41 To 46
  If Userform6.Controls("Label" & J).Caption <> "" And IsNumeric(Userform6.Controls("Label" & J).Caption) _
      Then Userform6.Controls("Label" & J).Caption = Format(Userform6.Controls("Label" & J).Caption, "#,##0.00")
 Next J
Range("A1").EntireRow.ClearContents
Userform6.Label23.Visible = False
End Sub

Sub Form7Text1Exit(RunCode As String)
Dim CustNo As String, CustRow As Long, FRow As Long, LRow As Long, BalString As String, I As Long
Dim Tbl As Range, CheckRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "CUSTOMER" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
CustNo = UserForm7.TextBox1.Text
CustBalance = 0
MyBook.Worksheets("Customer Data").Activate
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
 For I = 2 To 17
  UserForm7.Controls("TextBox" & I).Text = ""
 Next I
  UserForm7.Label23.Visible = False
  UserForm7.TextBox6.Text = "0.00"
  UserForm7.TextBox6.Visible = False
  UserForm7.TextBox7.Text = 0
  UserForm7.TextBox18.Text = ""
  UserForm7.TextBox18.Visible = False
  UserForm7.Label26.Caption = "C.O.D."
  UserForm7.Label26.Left = 413.95
  UserForm7.Label26.Width = 126
Else
 CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
 MyBook.Worksheets("Customer Data").Activate
 Cells(CustRow, 2).Select
UserForm7.TextBox1.Text = ActiveCell.Value
UserForm7.TextBox2.Text = ActiveCell.Offset(0, 1).Value
UserForm7.TextBox3.Text = ActiveCell.Offset(0, 3).Value
UserForm7.TextBox4.Text = ActiveCell.Offset(0, 4).Value
UserForm7.TextBox5.Text = ActiveCell.Offset(0, 5).Value
UserForm7.TextBox6.Text = Format(ActiveCell.Offset(0, 6).Value, "0.00")
UserForm7.TextBox7.Text = ActiveCell.Offset(0, 7).Value
UserForm7.TextBox8.Text = ActiveCell.Offset(0, 8).Value
UserForm7.TextBox8.Font.Italic = False
UserForm7.TextBox9.Text = ActiveCell.Offset(0, 9).Value
UserForm7.TextBox10.Text = ActiveCell.Offset(0, 10).Value
UserForm7.TextBox11.Text = ActiveCell.Offset(0, 11).Value
UserForm7.TextBox12.Text = ActiveCell.Offset(0, 12).Value
UserForm7.TextBox13.Text = ActiveCell.Offset(0, 15).Value
UserForm7.TextBox14.Text = ActiveCell.Offset(0, 16).Value
UserForm7.TextBox15.Text = ActiveCell.Offset(0, 17).Value
UserForm7.TextBox16.Text = ActiveCell.Offset(0, 18).Value
UserForm7.TextBox17.Text = ActiveCell.Offset(0, 19).Value
If ActiveCell.Offset(0, 14).Value <> "C.O.D." And ActiveCell.Offset(0, 14).Value <> "Prepaid" Then
 UserForm7.TextBox6.Visible = True
 UserForm7.TextBox18.Text = Val(ActiveCell.Offset(0, 14).Value)
 UserForm7.TextBox18.Visible = True
 UserForm7.Label26.Left = 443.95
 UserForm7.Label26.Width = 96
 If UCase(Right(ActiveCell.Offset(0, 14).Value, 4)) = "DAYS" Then
    UserForm7.Label26.Caption = "Days"
  ElseIf UCase(Right(ActiveCell.Offset(0, 14).Value, 4)) = " EOM" Then
    UserForm7.Label26.Caption = "Days after EOM"
 End If
Else
 UserForm7.TextBox18.Text = ""
 UserForm7.TextBox18.Visible = False
 UserForm7.Label26.Left = 413.95
 UserForm7.Label26.Width = 126
 UserForm7.Label26.Caption = ActiveCell.Offset(0, 14).Value
 UserForm7.TextBox6.Text = "0.00"
 UserForm7.TextBox6.Visible = False
End If
UserForm7.Label23.Caption = " Last Update : " & Year(ActiveCell.Offset(0, -1).Value) & "/" & Month(ActiveCell.Offset(0, -1).Value) & "/" & Day(ActiveCell.Offset(0, -1).Value)
UserForm7.Label23.Visible = True
End If
UserForm7.ListBox1.Visible = False
 MyBook.Worksheets("Receivable").Activate
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(CustNo, CheckRange, 0)) Then GoTo NoRecord
  FRow = Application.Match(CustNo, CheckRange, 0) + 3
  LRow = Application.Match(CustNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
  CustBalance = Application.Sum(Range(Cells(FRow, 11), Cells(LRow, 11)))
 End If
NoRecord:
  BalString = Format(CustBalance, "#,##0.00")
  UserForm7.Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : " & BalString
End Sub

Sub Form6AmountRefresh(RunCode As String)
Dim J As Long, CreditLeft As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "INVOICE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "CREDIT NOTE" And _
   ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
  TotalSum = Application.Sum(Range(Cells(123, 8), Cells(142, 8)))
  TotalSum = Format(TotalSum, "0.00")
  DisAmount = Round(TotalSum * DisRate, 2)
  TotalAmount = Format(TotalSum - DisAmount, "0.00")
  If DisAmount = 0 Then
   Userform6.Label47.Caption = Format(DisAmount, "#,##0.00")
  Else
   Userform6.Label47.Caption = Format((DisAmount * (-1)), "#,##0.00")
  End If
   Userform6.Label25.Caption = Format(TotalAmount, "#,##0.00")
   Userform6.Label40.Caption = Format(TotalSum, "#,##0.00")
If Userform6.Label1.Caption = "INVOICE" Then
   CreditLeft = 0
  If Userform6.Label36.Visible = True Then
   If Userform6.Label36.Caption <> "" Then CreditLeft = Userform6.Label36.Caption
   If TotalAmount - CreditLeft > 0 Then
    Userform6.Label37.Visible = True
   Else
     Userform6.Label37.Visible = False
   End If
  Else
   Userform6.Label37.Visible = False
  End If
End If
For J = 1 To 6
  If Userform6.Controls("Label" & J + 40).Caption <> "" And IsNumeric(Userform6.Controls("Label" & J + 40).Caption) _
      Then Userform6.Controls("Label" & J + 40).Caption = Format(Userform6.Controls("Label" & J + 40).Caption, "#,##0.00")
Next J
End Sub
Sub Form11Text1Exit(RunCode As String)
Dim I As Long, FRow As Long, LRow As Long, RowNo As Long
Dim Tbl As Range, CheckRange As Range

If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PAYMENT" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
MyBook.Activate
 EventOff = True
CustNo = UCase(UserForm11.TextBox1.Text)
    UserForm11.ScrollBar1.Visible = False
    UserForm11.ScrollBar1.Value = 1
    UserForm11.ScrollBar1.Max = 1
   For I = 11 To 35
    UserForm11.Controls("Label" & I).Caption = ""
   Next I
    UserForm11.Label36.Caption = "0.00"
    UserForm11.Label41.Caption = "0.00"
   For I = 4 To 8
    UserForm11.Controls("TextBox" & I).Text = ""
    UserForm11.Controls("TextBox" & I).Visible = False
   Next I
If CustNo = "" Then
 EventOff = False
 Exit Sub
End If
If IsNumeric(CustNo) Then
 If Len(CustNo) < 6 Then
   CustNo = Right(("00000" & CustNo), 5)
 End If
End If
UserForm11.TextBox1.Text = CustNo
MyBook.Worksheets("Customer Data").Activate
If IsError(Application.Match(CustNo, Range("B:B"), 0)) Then
  UserForm11.Label2.Caption = ""
  UserForm11.Label39.Caption = Chr(13) & "    Customer # is not correct, please enter the correct Customer # "
  UserForm11.Label39.Visible = True
  EventOff = False
  Exit Sub
Else
 I = Application.Match(CustNo, Range("B:B"), 0)
 UserForm11.Label2.Caption = Cells(I, 3).Value
End If
 MyBook.Worksheets("Receivable").Activate
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1") _
        , Order2:=xlAscending, Key3:=Range("B1"), Order3:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(CustNo, CheckRange, 0)) Then
   UserForm11.Label39.Caption = Chr(13) & "    No Outstanding invoices/ credit notes for this Customer"
   UserForm11.Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
  FRow = Application.Match(CustNo, CheckRange, 0) + 3
  LRow = Application.Match(CustNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
 UserForm11.Label2.Caption = Cells(FRow, 17).Value
  Cells(FRow, 10).Select
  If ActiveCell.Value <> "S" Then
    Do While ActiveCell.Value <> "S" And ActiveCell.Row <= LRow
     ActiveCell.Offset(1, 0).Select
    Loop
    LRow = ActiveCell.Row - 1
   Range(Cells(FRow, 1), Cells(LRow, 5)).EntireRow.Select
   Selection.Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   Range("A1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Range("A1").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = "INVOICE" And Right(ActiveCell.Offset(0, 1).Value, 1) <> " " Then ActiveCell.Offset(0, 33).Value = "INV" & ActiveCell.Offset(0, 33).Value
   ActiveCell.Offset(1, 0).Select
  Loop
    ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    With Selection
     .Columns("AF").Copy
      Range("J1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("Q").Copy
      Range("C1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("AH").Copy
       Range("A1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("E:I").Delete
     .Columns("G:IV").ClearContents
     .Cut
    End With
    Range("A6").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
  If Range("B7").Value <> "" Then
    Range("B6").End(xlDown).Select
    If ActiveCell.Row > 10 Then
     UserForm11.ScrollBar1.Max = ActiveCell.Row - 9
     UserForm11.ScrollBar1.Visible = True
    End If
  End If
    Range("B6").Select
     I = 1
     Do While ActiveCell.Value <> "" And I < 6
      UserForm11.Controls("Label" & I * 5 + 6).Caption = I
      UserForm11.Controls("Label" & I * 5 + 7).Caption = ActiveCell.Offset(0, -1).Value & ActiveCell.Value
      UserForm11.Controls("Label" & I * 5 + 8).Caption = Format(ActiveCell.Offset(0, 2).Value, "yyyy/mm/dd")
      UserForm11.Controls("Label" & I * 5 + 9).Caption = Format(ActiveCell.Offset(0, 3).Value, "#,##0.00")
      UserForm11.Controls("Label" & I * 5 + 10).Caption = Format(ActiveCell.Offset(0, 4).Value, "#,##0.00")
      UserForm11.Controls("TextBox" & I + 3).Visible = True
      ActiveCell.Offset(1, 0).Select
      I = I + 1
     Loop
  Else
   UserForm11.Label39.Caption = Chr(13) & "    No Outstanding invoices / credit notes for this Customer"
   UserForm11.Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
 End If
UserForm11.Label39.Visible = False
EventOff = False
End Sub
Sub Form11SumRefresh(RunCode As String)
Dim TotalSum As Double, TextBox3Amount As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PAYMENT" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If UserForm11.Controls("TextBox" & Form6TextNo).Text <> "" Then
 If IsNumeric(UserForm11.Controls("TextBox" & Form6TextNo).Value) = False Then
   Cancel = True
   UserForm11.Label39.Caption = Chr(13) & "  Incorrect Amount entered "
   UserForm11.Label39.Visible = True
 Else
   ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value = UserForm11.Controls("TextBox" & Form6TextNo).Value
   ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value = Round(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value, 2)
   UserForm11.Controls("TextBox" & Form6TextNo).Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value, "#,##0.00")
   UserForm11.Label39.Visible = False
  If (ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value - ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 6).Value) > 0.005 And ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 6).Value >= 0 Then
    MsgBox ("WARNING:" & Chr(13) & "The Amount entered exceeds the Amount Due")
  End If
 End If
Else
  ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value = 0
  ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value = Round(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value, 2)
  UserForm11.Controls("TextBox" & Form6TextNo).Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value, "#,##0.00")
  UserForm11.Label39.Visible = False
End If
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("B6").Select
 TotalSum = 0
 Do While ActiveCell.Value <> ""
  TotalSum = TotalSum + ActiveCell.Offset(0, 5).Value
  ActiveCell.Offset(1, 0).Select
 Loop
 UserForm11.Label36.Caption = Format(TotalSum, "#,##0.00")
 If UserForm11.TextBox3.Text = "" Then
  TextBox3Amount = 0
 Else
  TextBox3Amount = UserForm11.TextBox3.Value
 End If
 UserForm11.Label41.Caption = Format(TextBox3Amount - TotalSum, "#,##0.00")
End Sub

Sub CreditNo(RunCode As String)
Dim CNo As String, StockQty As Double, StockAmt As Double
Dim ProdRow As Long, ProductNo As String
If ThisWorkbook.Worksheets("NewCom").Range("A6") <> "CREDIT NOTE" Then Exit Sub
Userform6.Label1.Caption = "CREDIT NOTE"
If Userform6.TextBox2.Text = "" Then Userform6.TextBox2.Text = "0"
InvNo = Userform6.TextBox2.Text

If IsNumeric(InvNo) = False Then
 Call TempRPFormat("AR")
 Call Form6Text1Exit("AR")
 InvNo = ""
 Userform6.CommandButton13.Visible = False
 Userform6.CommandButton1.Visible = False
 Userform6.Label23.Caption = Chr(13) & "       Not a correct Credit Note #.  "
 Userform6.Label23.Visible = True
 Exit Sub
End If
InvNo = Right("00000" & Userform6.TextBox2.Text, 5)
Userform6.TextBox2.Text = InvNo
CNo = "CN" & InvNo
If IsError(Application.Match(CNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = True Then
 InvNo = Right(("00000" & (Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1)), 5)
 Call TempRPFormat("AR")
 Call Form6Text1Exit("AR")
 Userform6.Label23.Caption = Chr(13) & Chr(13) & "      The Credit Note is not found from the record.  "
 Userform6.Label23.Visible = True
 Exit Sub
Else
 Userform6.CommandButton1.Caption = "Edit"
 Userform6.Label1.Caption = "CREDIT NOTE "
 InvRow = Application.Match(CNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("Receivable").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 InvStatus = Range("J1").Value
 CustNo = Range("P1").Value
 CustName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 SalesRep = Range("AC1").Value
 DisAmount = Range("AE1").Value
 If Range("AF1").Value = 0 Then
  TotalAmount = Range("AF1").Value
 Else
  TotalAmount = Range("AF1").Value * (-1)
 End If
 InvPrefix = Range("AH1").Value
 DisRate = Range("AG1").Value
 InvDate = Range("D1").Value
 DueDate = Range("N1").Value
 CustPO = Range("AB1").Value
 PayTerm = Range("O1").Value
 If Range("IS1").Value = "" Then
    Userform6.TextBox47.Text = Range("IT1").Value
    Userform6.TextBox48.Text = Range("IU1").Value
    Userform6.TextBox49.Text = Range("IV1").Value
  Else
    Userform6.TextBox47.Text = ""
    Userform6.TextBox48.Text = ""
    Userform6.TextBox49.Text = ""
  End If
  If TelNo <> "" Then
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
  Else
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact
  End If
 Userform6.TextBox1.Text = CustNo
 Userform6.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 Userform6.TextBox4.Text = CustPO
 Userform6.TextBox35.Text = SalesRep
 Userform6.TextBox36.Text = Format(DueDate, "yyyy/mm/dd")
 Userform6.Label14.Caption = DisRate * 100 & "% Discount " & "(" & SysCurrency & ") : "
If DisAmount = 0 Then
  Userform6.Label47.Caption = Format(DisAmount, "#,##0.00")
 Else
  Userform6.Label47.Caption = Format((DisAmount * (-1)), "#,##0.00")
 End If
 Userform6.Label25.Caption = Format(TotalAmount, "#,##0.00")
 Userform6.TextBox39.Text = DelName
For I = 15 To 20
 Userform6.Controls("Label" & I).Caption = I - 14
Next I
 J = 122
 K = 1
 For I = 5 To 164 Step 8
  ActiveCell.Offset(J, K + 1).NumberFormat = "General"
  ActiveCell.Offset(J, K + 7).NumberFormat = "General"
  ActiveCell.Offset(J, K + 2).NumberFormat = "@"
  ActiveCell.Offset(J, K + 3).NumberFormat = "@"
  ActiveCell.Offset(J, K + 11).NumberFormat = "@"
  ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 30).Value
  ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
  ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
   If Cells(1, I + 33).Value <> "" Or Cells(1, I + 33).Value <> 0 Then ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value * (-1)
  ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
   If Cells(1, I + 35).Value <> "" Or Cells(1, I + 35).Value <> 0 Then ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value * (-1)
   If Cells(1, I + 36).Value <> "" Or Cells(1, I + 36).Value <> 0 Then ActiveCell.Offset(J, K + 10).Value = Cells(1, I + 36).Value * (-1)
  ActiveCell.Offset(J, K + 11).Value = Cells(1, I + 37).Value
 J = J + 1
 K = 1
 Next I
 Range("D123").Select
 For I = 5 To 34 Step 5
  Userform6.Controls("TextBox" & I).Text = ActiveCell.Value
  Userform6.Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
  Userform6.Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
  Userform6.Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
  Userform6.Controls("Label" & I / 5 + 40).Caption = ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
 Next I
 Userform6.ScrollBar1.Value = 1
For J = 41 To 46
  If IsNumeric(Userform6.Controls("Label" & J).Caption) Then Userform6.Controls("Label" & J).Caption = Format(Userform6.Controls("Label" & J).Caption, "#,##0.00")
Next J
End If
Range("A1").EntireRow.ClearContents
If InvStatus <> "*" Or InvDate < BeginningDate Then
  Userform6.CommandButton1.Visible = False
Else
 Userform6.CommandButton1.Caption = "Edit"
 Userform6.CommandButton1.Visible = True
End If
Userform6.CommandButton13.Visible = False
 TotalSum = Application.Sum(Range(Cells(123, 8), Cells(142, 8)))
 Userform6.Label40.Caption = Format(TotalSum, "#,##0.00")
Userform6.Label23.Visible = False
Userform6.Label33.Visible = False
Userform6.Label36.Visible = False
Userform6.Label37.Visible = False
If InvDate < BeginningDate Then Exit Sub
 Range("A123:P142").Copy
 Range("A100").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("D100").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 2).Value = "" Then
   ActiveCell.Offset(0, 2).Value = 0
  Else
   ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, 2).Value * (-1)
  End If
  If ActiveCell.Offset(0, 8).Value = "" Then
   ActiveCell.Offset(0, 8).Value = 0
  Else
   ActiveCell.Offset(0, 8).Value = ActiveCell.Offset(0, 8).Value * (-1)
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 Range("A100").Value = InvDate
End Sub

Sub CNUpdate(RunCode As String)
Dim ProductNo As String, StockQty As Double, StockAmt As Double, DeleteAllow As Boolean
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D123").Select
  Do While ActiveCell.Value <> ""
    ProductNo = ActiveCell.Value
    If IsError(Application.Match(ProductNo, MyBook.Worksheets("Product Data").Columns("B"), 0)) = True Then
      Userform6.CommandButton1.Visible = False
      Userform6.CommandButton13.Visible = False
      Userform6.Label23.Caption = Chr(13) & "   Some Products are no longer in the Product List. " & Chr(13) & _
                                "    No amendment to this Credit Note is allowed"
      Userform6.Label23.Visible = True
      Exit Sub
    End If
    ProdRow = Application.Match(ProductNo, MyBook.Worksheets("Product Data").Columns("B"), 0)
    ActiveCell.Offset(0, -1).NumberFormat = "General"
    ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 5).Value
   If MyBook.Worksheets("Product Data").Cells(ProdRow, 7).Value = "Yes" Then
     ActiveCell.Offset(0, 6).NumberFormat = "General"
     ActiveCell.Offset(0, 6).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 6).Value
     StockNo = MyBook.Worksheets("Product Data").Cells(ProdRow, 9).Value
     If StockNo <> ActiveCell.Offset(0, 9).Value Then
          Userform6.CommandButton1.Visible = False
          Userform6.CommandButton13.Visible = False
          Userform6.Label23.Caption = Chr(13) & "   The Stock no for some items have been changed. " & Chr(13) & _
                                "    No amendment to this Credit Note is allowed"
          Userform6.Label23.Visible = True
         Exit Sub
     End If
    If StockNo = "" Then
     Userform6.CommandButton1.Visible = False
     Userform6.CommandButton13.Visible = False
     Userform6.Label23.Caption = Chr(13) & "   Note: The Stock # detail cannot be found. " & Chr(13) & _
                                "    No amendment to this Creidt Note is allowed"
     Userform6.Label23.Visible = True
     Exit Sub
    Else
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
         Userform6.CommandButton1.Visible = False
         Userform6.CommandButton13.Visible = False
         Userform6.Label23.Caption = Chr(13) & "   Note: The Stock # detail cannot be found. " & Chr(13) & _
                                "    No amendment to this Credit Note is allowed"
         Userform6.Label23.Visible = True
         Exit Sub
      End If
      I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
      StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
      StockAmt = MyBook.Worksheets("StockRec").Cells(I, 9).Value
       ActiveCell.Offset(0, 9).NumberFormat = "@"
       ActiveCell.Offset(0, 9).Value = StockNo
       ActiveCell.Offset(0, 10).Value = StockQty
       ActiveCell.Offset(0, 12).Value = StockAmt
        If ActiveCell.Offset(0, 5).Value <> MyBook.Worksheets("StockRec").Cells(I, 5).Value Then
          Userform6.CommandButton1.Visible = False
          Userform6.CommandButton13.Visible = False
          Userform6.Label23.Caption = Chr(13) & "   The Asset Account for some items have been changed. " & Chr(13) & _
                                "    No amendment to this Credit Note is allowed"
          Userform6.Label23.Visible = True
         Exit Sub
        End If
       If StockQty <> 0 Then
         ActiveCell.Offset(0, 7).Value = StockAmt / StockQty
       Else
         ActiveCell.Offset(0, 7).Value = MyBook.Worksheets("StockRec").Cells(I, 10).Value
       End If
       ActiveCell.Offset(0, 8).Value = Round(ActiveCell.Offset(0, 7).Value * ActiveCell.Offset(0, 2).Value, 2)
    End If
   Else
     If ActiveCell.Offset(0, 9).Value <> "" Then
          Userform6.CommandButton1.Visible = False
          Userform6.CommandButton13.Visible = False
          Userform6.Label23.Caption = Chr(13) & "   " & ProductNo & " was changed from stock item to non-stock item. " & Chr(13) & _
                                "    No amendment to this Credit Note is allowed"
          Userform6.Label23.Visible = True
         Exit Sub
     End If
    StockNo = ""
    ActiveCell.Offset(0, -1).NumberFormat = "General"
    ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 5).Value
    ActiveCell.Offset(0, 9).ClearContents
    ActiveCell.Offset(0, 5).ClearContents
    ActiveCell.Offset(0, 6).ClearContents
    ActiveCell.Offset(0, 7).ClearContents
    ActiveCell.Offset(0, 8).ClearContents
    ActiveCell.Offset(0, 10).Value = "N/A"
    ActiveCell.Offset(0, 11).ClearContents
    ActiveCell.Offset(0, 11).ClearContents
   End If
  ActiveCell.Offset(1, 0).Select
 Loop
    DeleteAllow = True
    Range("C123").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 14).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("Q1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("C123").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 10).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 10).Value
       StockQty = ActiveCell.Offset(0, 11).Value
       StockAmt = ActiveCell.Offset(0, 13).Value
       I = ActiveCell.Row
       Range("D100").Select
       Do While ActiveCell.Value <> ""
        If ActiveCell.Offset(0, 9).Value = StockNo Then
         ActiveCell.Offset(0, 10).Value = StockQty
         ActiveCell.Offset(0, 12).Value = StockAmt
         StockQty = Format(StockQty + ActiveCell.Offset(0, 2).Value, "0.0000")
         StockAmt = Format(StockAmt + ActiveCell.Offset(0, 8).Value, "0.00")
         ActiveCell.Offset(0, 11).Value = "*"
        End If
        ActiveCell.Offset(1, 0).Select
       Loop
        If StockQty < 0 Or StockAmt < 0 Then DeleteAllow = False
        If StockQty = 0 And StockAmt <> 0 Then DeleteAllow = False
       Cells(I, 3).Select
       Cells(I, 14).Value = StockQty
       Cells(I, 16).Value = StockAmt
      If StockQty + Cells(I, 6).Value = 0 Then
          Cells(I, 12).Value = StockAmt * (-1)
       Else
         Cells(I, 12).Value = Round(Cells(I, 11).Value * (StockQty + Cells(I, 6).Value), 2)
         Cells(I, 12).Value = Round((Cells(I, 12).Value - StockAmt), 2)
       End If
       Do While ActiveCell.Offset(1, 10).Value = StockNo
        StockQty = Format(StockQty + ActiveCell.Offset(0, 3).Value, "0.0000")
        StockAmt = Format(StockAmt + ActiveCell.Offset(0, 9).Value, "0.00")
        ActiveCell.Offset(1, 11).Value = StockQty
        ActiveCell.Offset(1, 13).Value = StockAmt
        If StockQty + ActiveCell.Offset(1, 3).Value = 0 Then
          ActiveCell.Offset(1, 9).Value = StockAmt * (-1)
        Else
         ActiveCell.Offset(1, 9).Value = Round(ActiveCell.Offset(1, 8).Value * (StockQty + ActiveCell.Offset(1, 3).Value), 2)
         ActiveCell.Offset(1, 9).Value = Round((ActiveCell.Offset(1, 9).Value - StockAmt), 2)
        End If
        ActiveCell.Offset(0, 12).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("Q123:Q142").ClearContents
 For I = 1 To 6
  Userform6.Controls("Label" & I + 14).Caption = I
  Userform6.Controls("TextBox" & I * 5).Text = Cells(122 + I, 4).Value
  Userform6.Controls("TextBox" & I * 5 + 1).Text = Cells(122 + I, 5).Value
  Userform6.Controls("TextBox" & I * 5 + 2).Text = Cells(122 + I, 6).Value
  Userform6.Controls("TextBox" & I * 5 + 3).Text = Cells(122 + I, 7).Value
  Userform6.Controls("Label" & I + 40).Caption = Format(Cells(122 + I, 8).Value, "#,##0.00")
  Userform6.Controls("Label" & I + 50).Caption = Cells(122 + I, 14).Value
  Next I
  Range("D100").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 9).Value <> "" And ActiveCell.Offset(0, 11).Value <> "*" Then
      StockNo = ActiveCell.Offset(0, 9).Value
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
         Userform6.Label1.Caption = "CREDIT NOTE "
         Userform6.CommandButton1.Visible = False
         Userform6.CommandButton13.Visible = False
         MsgBox ("Some stock numbers are no longer in the Stock List." & Chr(13) & Chr(13) & "Amendment to this Credit Note is not allowed")
         Exit Sub
      End If
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
 If DeleteAllow = False Then Userform6.CommandButton13.Visible = False
End Sub

Sub PInvoice(PINo As String)
Dim StockQty As Double, StockAmt As Double, I As Long, J As Long, K As Long, InvRow As Long, ProductNo As String
If ThisWorkbook.Worksheets("NewCom").Range("A6") <> "PROFORMA INVOICE" Then Exit Sub
 Userform6.Label1.Caption = "SALES ORDER"
  Userform6.Label10.Top = 156
  Userform6.Label10.Height = 18
  Userform6.Label10.Caption = "Qty"
If Userform6.TextBox2.Value = "" Then Userform6.TextBox2.Text = "0"
InvNo = Userform6.TextBox2.Text
If IsNumeric(InvNo) Then
 If Len(InvNo) < 7 Then
   InvNo = Right(("000000" & InvNo), 6)
   If InvNo = "000000" Then
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1)), 6)
   ElseIf IsError(Application.Match("PI" & InvNo, MyBook.Worksheets("ProInvoice").Range("B:B"), 0)) = True Then _
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1)), 6)
   End If
  Userform6.Label38.Visible = True
  Userform6.TextBox2.Left = 444
  Userform6.TextBox2.Width = 90
  PINo = "PI" & InvNo
 Else
   PINo = InvNo & " "
   Userform6.Label38.Visible = False
   Userform6.TextBox2.Left = 426
   Userform6.TextBox2.Width = 108
 End If
ElseIf Len(InvNo) > 2 Then
  If Left(InvNo, 2) = "PI" Then
   If IsNumeric(Right(InvNo, Len(InvNo) - 2)) Then
    InvNo = Right(InvNo, Len(InvNo) - 2)
    InvNo = Right("000000" & InvNo, 6)
    If InvNo = "000000" Then
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1)), 6)
    ElseIf IsError(Application.Match("PI" & InvNo, MyBook.Worksheets("ProInvoice").Range("B:B"), 0)) = True Then _
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1)), 6)
    End If
    Userform6.Label38.Visible = True
    Userform6.TextBox2.Left = 444
    Userform6.TextBox2.Width = 90
    PINo = "PI" & InvNo
   Else
    PINo = InvNo & " "
    Userform6.Label38.Visible = False
    Userform6.TextBox2.Left = 426
    Userform6.TextBox2.Width = 108
   End If
  Else
   PINo = InvNo & " "
   Userform6.Label38.Visible = False
   Userform6.TextBox2.Left = 426
   Userform6.TextBox2.Width = 108
  End If
ElseIf InvNo = "PI" Then
  InvNo = Right(("000000" & (Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1)), 6)
  Userform6.Label38.Visible = True
  Userform6.TextBox2.Left = 444
  Userform6.TextBox2.Width = 90
  PINo = "PI" & InvNo
Else
 PINo = InvNo & " "
 Userform6.Label38.Visible = False
 Userform6.TextBox2.Left = 426
 Userform6.TextBox2.Width = 108
End If
Userform6.TextBox2.Text = InvNo
 Userform6.Label35.Visible = True
 Userform6.Label35.Left = 84
 Userform6.Label35.Width = 138
 Userform6.TextBox39.Visible = False
 Userform6.TextBox39.Text = ""
 Userform6.TextBox46.Visible = False
 Userform6.TextBox46.Text = ""
If IsError(Application.Match(PINo, MyBook.Worksheets("ProInvoice").Range("B:B"), 0)) = True Then
 If Userform6.CommandButton1.Caption <> "Save" Or Userform6.Label51.Visible = False Or ThisWorkbook.Worksheets("TempRP").Range("B1") <> "" Or _
    (IsNumeric(InvNo) = True And Len(InvNo) < 7) Then
  Call TempRPFormat("AR")
  Call Form6Text1Exit("AR")
  Userform6.Label23.Caption = Chr(13) & Chr(13) & "      The Sales Order was not found from the record. "
  Userform6.Label23.Visible = True
  For I = 50 To 56
   Userform6.Controls("Label" & I).Visible = True
  Next I
   For I = 40 To 45
    Userform6.Controls("Textbox" & I).Visible = False
   Next I
   Userform6.Label57.Visible = False
   Userform6.CommandButton17.Visible = False
   Userform6.CommandButton16.Visible = True
   Userform6.CommandButton18.Visible = True
 Else
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
   Userform6.CommandButton1.Visible = False
  Else
   Userform6.CommandButton1.Visible = True
   Userform6.CommandButton18.Visible = True
  End If
 End If
 EventOff = False
 Exit Sub
Else
 Userform6.CommandButton1.Caption = "Edit"
 Userform6.Label1.Caption = "SALES ORDER "
 Userform6.Label10.Top = 150
 Userform6.Label10.Height = 24
 Userform6.Label10.Caption = "Outstanding Qty"
 InvRow = Application.Match(PINo, MyBook.Worksheets("ProInvoice").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("ProInvoice").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 InvStatus = Range("J1").Value
 CustNo = Range("P1").Value
 CustName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 SalesRep = Range("AC1").Value
 DisAmount = Range("AE1").Value
 TotalAmount = Range("AF1").Value
 InvPrefix = Range("AH1").Value
 DisRate = Range("AG1").Value
 InvDate = Range("D1").Value
 Userform6.TextBox36.Text = Range("N1").Value
 CustPO = Range("AB1").Value
 PayTerm = Range("O1").Value
 Userform6.TextBox47.Text = Range("IT1").Value
 Userform6.TextBox48.Text = Range("IU1").Value
 Userform6.TextBox49.Text = Range("IV1").Value
  If TelNo <> "" Then
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
  Else
   Userform6.Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
   "     " & Address1 & Chr(13) & _
   "     " & Address2 & Chr(13) & _
   "     " & Address3 & Chr(13) & _
   "     Contact: " & CustContact
  End If
 Userform6.Label7.Caption = "Delivered To :   " & Chr(13) & "     " & DelName & Chr(13) & _
 "     " & DelAddress1 & Chr(13) & _
 "     " & DelAddress2 & Chr(13) & _
 "     " & DelAddress3 & Chr(13) & _
 "     Contact: " & DelContact
 Userform6.TextBox1.Text = CustNo
 Userform6.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 Userform6.TextBox4.Text = CustPO
 Userform6.TextBox35.Text = SalesRep
 Userform6.TextBox38.Text = InvPrefix
 Userform6.Label35.Caption = PayTerm
 Userform6.Label14.Caption = DisRate * 100 & "% Discount " & "(" & SysCurrency & ") : "
 If DisAmount = 0 Then
  Userform6.Label47.Caption = Format(DisAmount, "#,##0.00")
 Else
  Userform6.Label47.Caption = Format((DisAmount * (-1)), "#,##0.00")
 End If
 Userform6.Label25.Caption = Format(TotalAmount, "#,##0.00")
For I = 15 To 20
 Userform6.Controls("Label" & I).Caption = I - 14
Next I
J = 122
K = 1
For I = 5 To 164 Step 8
 ActiveCell.Offset(J, K + 1).NumberFormat = "General"
 ActiveCell.Offset(J, K + 7).NumberFormat = "General"
 ActiveCell.Offset(J, K + 2).NumberFormat = "@"
 ActiveCell.Offset(J, K + 3).NumberFormat = "@"
 ActiveCell.Offset(J, K + 11).NumberFormat = "@"
 ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 30).Value
 ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
 ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
 ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value
 ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
 ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value
 ActiveCell.Offset(J, K + 10).Value = Cells(1, I + 36).Value
 ActiveCell.Offset(J, K + 11).Value = Cells(1, I + 37).Value
 J = J + 1
 K = 1
 Next I
 Range("D123").Select
 For I = 5 To 34 Step 5
  Userform6.Controls("TextBox" & I).Text = ActiveCell.Value
  Userform6.Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
  Userform6.Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
  Userform6.Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
  Userform6.Controls("Label" & I / 5 + 40).Caption = ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
 Next I
 Userform6.ScrollBar1.Value = 1
For J = 41 To 46
  If IsNumeric(Userform6.Controls("Label" & J).Caption) Then Userform6.Controls("Label" & J).Caption = Format(Userform6.Controls("Label" & J).Caption, "#,##0.00")
Next J
End If
Range("A1").EntireRow.ClearContents
Range("B1").Value = PINo
 Userform6.CommandButton1.Caption = "Edit"
 Userform6.CommandButton1.Visible = True
 TotalSum = Application.Sum(Range(Cells(123, 8), Cells(142, 8)))
 Userform6.Label40.Caption = Format(TotalSum, "#,##0.00")
Userform6.Label23.Visible = False
Userform6.Label33.Visible = False
Userform6.Label36.Visible = False
Userform6.Label37.Visible = False
Userform6.ListBox1.Visible = False
Userform6.ListBox2.Visible = False
Userform6.CommandButton13.Visible = False
Userform6.CommandButton14.Visible = False
 For I = 50 To 56
  Userform6.Controls("Label" & I).Visible = False
 Next I
   For I = 40 To 45
    Userform6.Controls("Textbox" & I).Visible = False
   Next I
   Userform6.Label57.Visible = False
   Userform6.CommandButton17.Visible = False
   Userform6.CommandButton16.Visible = True
End Sub

Sub PIUpdate(PartNotFound As String)
 Dim ProductNo As String, ProdRow As Long, I As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
   For I = 40 To 45
    Userform6.Controls("Textbox" & I).Visible = False
   Next I
   Userform6.Label57.Visible = False
   Userform6.CommandButton17.Visible = False
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D123").Select
  PartNotFound = ""
 Do While ActiveCell.Value <> ""
  ProductNo = ActiveCell.Value
  If IsError(Application.Match(ProductNo, MyBook.Worksheets("Product Data").Columns("B"), 0)) = True Then
     PartNotFound = "Yes"
     ActiveCell.Offset(0, -1).Value = ""
     ActiveCell.Offset(0, 5).Value = ""
     ActiveCell.Offset(0, 6).Value = ""
     ActiveCell.Offset(0, 8).Value = ""
     ActiveCell.Offset(0, 9).Value = ""
     ActiveCell.Offset(0, 10).Value = ""
     ActiveCell.Offset(0, 12).Value = ""
  Else
    ProdRow = Application.Match(ProductNo, MyBook.Worksheets("Product Data").Columns("B"), 0)
    ActiveCell.Offset(0, -1).NumberFormat = "General"
    ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 5).Value
   If MyBook.Worksheets("Product Data").Cells(ProdRow, 7).Value = "Yes" Then
     ActiveCell.Offset(0, 6).NumberFormat = "General"
     ActiveCell.Offset(0, 6).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 6).Value
     StockNo = MyBook.Worksheets("Product Data").Cells(ProdRow, 9).Value
    If StockNo = "" Then
     ActiveCell.Offset(0, 5).Value = ""
     ActiveCell.Offset(0, 8).Value = ""
     ActiveCell.Offset(0, 9).Value = ""
     ActiveCell.Offset(0, 10).Value = ""
     ActiveCell.Offset(0, 12).Value = ""
     PartNotFound = "Yes"
    Else
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
        ActiveCell.Offset(0, 5).Value = ""
        ActiveCell.Offset(0, 8).Value = ""
        ActiveCell.Offset(0, 9).Value = ""
        ActiveCell.Offset(0, 10).Value = ""
        ActiveCell.Offset(0, 12).Value = ""
         PartNotFound = "Yes"
      Else
       I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
       StockAmt = MyBook.Worksheets("StockRec").Cells(I, 9).Value
       ActiveCell.Offset(0, 5).Value = MyBook.Worksheets("StockRec").Cells(I, 5).Value
       ActiveCell.Offset(0, 9).Value = StockNo
       ActiveCell.Offset(0, 10).Value = StockQty
       ActiveCell.Offset(0, 12).Value = StockAmt
       If StockQty <> 0 Then
         ActiveCell.Offset(0, 7).Value = StockAmt / StockQty
       Else
         ActiveCell.Offset(0, 7).Value = MyBook.Worksheets("StockRec").Cells(I, 10).Value
       End If
       ActiveCell.Offset(0, 8).Value = Round(ActiveCell.Offset(0, 7).Value * ActiveCell.Offset(0, 2).Value, 2)
      End If
    End If
   Else
    StockNo = ""
    ActiveCell.Offset(0, -1).NumberFormat = "General"
    ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 5).Value
    ActiveCell.Offset(0, 9).ClearContents
    ActiveCell.Offset(0, 5).ClearContents
    ActiveCell.Offset(0, 6).ClearContents
    ActiveCell.Offset(0, 7).ClearContents
    ActiveCell.Offset(0, 8).ClearContents
    ActiveCell.Offset(0, 10).Value = "N/A"
    ActiveCell.Offset(0, 11).ClearContents
    ActiveCell.Offset(0, 12).ClearContents
   End If
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
    Range("D123").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 13).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("Q1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D123").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 9).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 9).Value
       StockQty = ActiveCell.Offset(0, 10).Value
       StockAmt = ActiveCell.Offset(0, 12).Value
       UnitCost = ActiveCell.Offset(0, 7).Value
       If StockQty = ActiveCell.Offset(0, 2).Value Then
          ActiveCell.Offset(0, 8).Value = StockAmt
       Else
         ActiveCell.Offset(0, 8).Value = Round(UnitCost * ActiveCell.Offset(0, 2).Value, 2)
       End If
       Do While ActiveCell.Offset(1, 9).Value = StockNo
        StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
        StockAmt = Format(StockAmt - ActiveCell.Offset(0, 8).Value, "0.00")
        ActiveCell.Offset(1, 10).Value = StockQty
        ActiveCell.Offset(1, 12).Value = StockAmt
        ActiveCell.Offset(1, 7).Value = UnitCost
        If StockQty = ActiveCell.Offset(1, 2).Value Then
          ActiveCell.Offset(1, 8).Value = StockAmt
        Else
         ActiveCell.Offset(1, 8).Value = Round(UnitCost * ActiveCell.Offset(1, 2).Value, 2)
        End If
        ActiveCell.Offset(0, 11).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Range("Q123:Q142").ClearContents
  For I = 1 To 7
   Userform6.Controls("Label" & I + 49).Visible = True
  Next I
  Userform6.ScrollBar1.Value = 2
  Userform6.ScrollBar1.Value = 1
End Sub

Sub PISave(PINo As String)
Dim FInvRow As Long, LInvRow As Long, I As Long, J As Long, CheckRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If PINo = "" Then
 If InvNo = "" Then
  InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
  Userform6.TextBox2.Text = InvNo
  Userform6.Label38.Visible = True
  Userform6.TextBox2.Left = 444
  Userform6.TextBox2.Width = 90
  PINo = "PI" & InvNo
 ElseIf IsNumeric(InvNo) Then
  If Len(InvNo) < 7 Then
   PINo = "PI" & InvNo
  Else
   PINo = InvNo & " "
  End If
 Else
  PINo = InvNo & " "
 End If
End If
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("C123").Select
  I = 1
  Do While I < 21
   If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
   I = I + 1
  Loop
 If Range("C123").Value = "" Then
   Userform6.Label23.Caption = Chr(13) & "     No Product was entered.   Please add products before proceed."
   Userform6.Label23.Visible = True
   GoTo FormRefresh
 End If
 Call Form6AmountRefresh("")
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D1").NumberFormat = "yyyy/mm/dd"
 Range("D1").Value = InvDate
 Range("E1").NumberFormat = "General"
 Range("E1").Value = DebtorAcct
 Range("H1:I1").NumberFormat = "General"
 Range("J1").NumberFormat = "@"
 Range("J1").Value = "*"
 Range("K1").NumberFormat = "General"
 Range("M1").NumberFormat = "yyyy/mm/dd"
 Range("N1").NumberFormat = "@"
 Range("N1").Value = Userform6.TextBox36.Text
 Range("O1:AC1").NumberFormat = "@"
 Range("O1").Value = PayTerm
 Range("P1").Value = CustNo
 Range("Q1").Value = CustName
 Range("R1").Value = Address1
 Range("S1").Value = Address2
 Range("T1").Value = Address3
 Range("U1").Value = CustContact
 Range("V1").Value = TelNo
 Range("AB1").Value = CustPO
 Range("AC1").Value = SalesRep
 Range("AD1:AG1").NumberFormat = "General"
 Range("AE1").Value = DisAmount
 Range("AH1").NumberFormat = "@"
 Range("AH1").Value = InvPrefix
 Range("AG1").Value = DisRate
 Range("IT1:IV1").NumberFormat = "@"
 Range("IT1").Value = Userform6.TextBox47.Text
 Range("IU1").Value = Userform6.TextBox48.Text
 Range("IV1").Value = Userform6.TextBox49.Text
 Range("B1").NumberFormat = "@"
 Range("A1").Value = "PI"
 Range("B1").Value = PINo
 If TotalAmount >= 0 Then
   Range("H1").Value = TotalAmount
 Else
   Range("I1").Value = TotalAmount * (-1)
 End If
 Range("G1").Value = PINo & " for " & CustName
 Range("K1").Value = TotalAmount
 Range("AF1").Value = TotalAmount
 Range("W1").Value = DelName
 Range("X1").Value = DelAddress1
 Range("Y1").Value = DelAddress2
 Range("Z1").Value = DelAddress3
 Range("AA1").Value = DelContact
 I = 35
 J = 0
 Range("C123").Select
 Do While ActiveCell.Value <> ""
  Cells(1, I).NumberFormat = "General"
  Cells(1, I).Value = ActiveCell.Offset(0, 6).Value
  Cells(1, I + 1).NumberFormat = "@"
  Cells(1, I + 1).Value = ActiveCell.Offset(0, 1).Value
  Cells(1, I + 2).NumberFormat = "@"
  Cells(1, I + 2).Value = ActiveCell.Offset(0, 2).Value
  Range(Cells(1, I + 3), Cells(1, I + 6)).NumberFormat = "General"
  If ActiveCell.Offset(0, 3).Value = "" Then ActiveCell.Offset(0, 3).Value = 0
  Cells(1, I + 3).Value = ActiveCell.Offset(0, 3).Value
  Cells(1, I + 4).Value = ActiveCell.Offset(0, 4).Value
  Cells(1, I + 5).Value = ActiveCell.Offset(0, 5).Value
  Cells(1, I + 6).Value = ActiveCell.Offset(0, 9).Value
  Cells(1, I + 7).NumberFormat = "@"
  Cells(1, I + 7).Value = ActiveCell.Offset(0, 10).Value
  I = I + 8
  J = J + 1
  ActiveCell.Offset(1, 0).Select
 Loop
Range("AD1").Value = J

MyBook.Worksheets("ProInvoice").Activate
If Range("B4").Value <> "" Then
 ActiveSheet.UsedRange.Select
 Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Set CheckRange = Selection.Columns("B")
 If IsError(Application.Match(PINo, CheckRange, 0)) = False Then
   FInvRow = Application.Match(PINo, CheckRange, 0) + 3
   LInvRow = Application.Match(PINo, CheckRange, 1) + 3
  Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
 End If
End If
 MyBook.Worksheets("ProInvoice").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("1:1").Copy
 MyBook.Worksheets("ProInvoice").Activate
 ActiveSheet.Paste
 Range("C1").Select
If IsNumeric(InvNo) Then
  If Len(InvNo) = 6 Then
   If InvNo > MyBook.Worksheets("ProInvoice").Range("A1").Value Then MyBook.Worksheets("ProInvoice").Range("A1").Value = InvNo
  End If
 End If
 If MyBook.Worksheets("ProInvoice").Range("A1").Value = "999999" Then MyBook.Worksheets("ProInvoice").Range("A1").Value = "000000"
 InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
Userform6.TextBox1.Text = ""
Userform6.Label10.Top = 156
Userform6.Label10.Height = 18
Userform6.Label10.Caption = "Qty"
InvDate = Date
Call TempRPFormat("AR")
Call Form6Text1Exit("AR")
Userform6.ScrollBar1.Max = 15
Userform6.ScrollBar1.Min = 1
Userform6.ScrollBar1.Value = 1
PINo = "PI" & InvNo
Userform6.Label38.Visible = True
  Userform6.TextBox2.Left = 444
  Userform6.TextBox2.Width = 90
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
Userform6.TextBox4.SetFocus
FormRefresh:
 LineNo = Userform6.ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
 For I = 1 To 6
  Userform6.Controls("Label" & I + 14).Caption = LineNo + I - 1
  Userform6.Controls("TextBox" & I * 5).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 4).Value
  Userform6.Controls("TextBox" & I * 5 + 1).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 5).Value
  Userform6.Controls("TextBox" & I * 5 + 2).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 6).Value
  Userform6.Controls("TextBox" & I * 5 + 3).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 7).Value
  Userform6.Controls("Label" & I + 40).Caption = Format(Worksheets("TempRP").Cells(LineNo + 121 + I, 8).Value, "#,##0.00")
  Next I
End Sub

Sub PIDelete(PINo As String)
Dim FInvRow As Long, LInvRow As Long, CheckRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
MyBook.Worksheets("ProInvoice").Activate
If Range("B4").Value = "" Then GoTo NoData
 ActiveSheet.UsedRange.Select
 Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Set CheckRange = Selection.Columns("B")
If IsError(Application.Match(PINo, CheckRange, 0)) = False Then
  FInvRow = Application.Match(PINo, CheckRange, 0) + 3
  LInvRow = Application.Match(PINo, CheckRange, 1) + 3
AskReply:
    MSG = "The Sales Order will be removed from the Record" + Chr(13) + _
    Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then GoTo FinishSave
    GoTo AskReply
DataRemoval:
  MyBook.Worksheets("ProInvoice").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
End If
NoData:
 Userform6.CommandButton1.Caption = "Save"
 Userform6.Label10.Top = 156
 Userform6.Label10.Height = 18
 Userform6.Label10.Caption = "Qty"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
  PINo = "PI" & InvNo
  Userform6.Label38.Visible = True
  Userform6.TextBox2.Left = 444
  Userform6.TextBox2.Width = 90
Userform6.TextBox1.Text = ""
InvDate = Date
Call TempRPFormat("AR")
Call Form6Text1Exit("AR")
 Userform6.ListBox1.Visible = False
 Userform6.ListBox2.Visible = False
 Userform6.Label23.Visible = False
   For I = 50 To 56
    Userform6.Controls("Label" & I).Visible = True
   Next I
   For I = 40 To 45
    Userform6.Controls("Textbox" & I).Visible = False
   Next I
   Userform6.Label57.Visible = False
   Userform6.CommandButton17.Visible = False
   Userform6.CommandButton16.Visible = True
   Userform6.CommandButton18.Visible = True
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
FinishSave:
End Sub
Sub PIPrint(PINo As String)
Dim Sh As Shape, PicLocation As String, PicZoom As Single
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("Invoice").Activate
Range("H6").Value = "Date : "
Range("A9").Value = "Customer : "
Range("A17").Value = "Item"
Range("B17").Value = "Product #"
Range("C17").Value = "Product Description"
Range("G17").Value = "Qty"
Range("H16").Value = "Unit Price "
Range("H17").Value = "(" & SysCurrency & ")"
Range("I16").Value = "Amount "
Range("I17").Value = "(" & SysCurrency & ")"
Range("H40").Value = "Sub-Total : "
Range("H41").Value = "Discount Amount : "
Range("H42").Value = "Total : "
Range("B40").Value = "Sales Person : "
Range("G46").Value = "Authorized Signature"
Range("I6").Value = InvDate
Range("I40").Value = TotalSum
Range("I42").Value = TotalAmount
Range("C40").Value = SalesRep
Range("B43").Value = Userform6.TextBox47.Text & Chr(10) & Userform6.TextBox48.Text & Chr(10) & Userform6.TextBox49.Text
If DisAmount = 0 Then
   Range("I41").Value = DisAmount
Else
   Range("I41").Value = DisAmount * (-1)
End If
 Range("A10").Value = "   " & CustName
 Range("A11").Value = "   " & Address1
 Range("A12").Value = "   " & Address2
 Range("A13").Value = "   " & Address3
 If TelNo <> "" Then
  Range("A14").Value = "   Contact : " & CustContact & " (Tel: " & TelNo & ")"
 Else
  Range("A14").Value = "   Contact : " & CustContact
 End If
  Range("A3").Value = "PROFORMA INVOICE"
  Range("H5").Value = "Proforma Invoice # : "
  Range("H7").Value = "Customer PO : "
  Range("F9").Value = "Goods delivered to: "
  Range("B41").Value = "Payment Term : "
  Range("B42").Value = "Ship Schedule : "
  Range("I5").Value = PINo
  
   With New StdFont
        .Name = "IDAutomationHC39M Free Version"
        If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
         Range("A5").RowHeight = 16.5
         Range("A5").VerticalAlignment = xlTop
         Range("A5").HorizontalAlignment = xlLeft
         Range("A5").Font.Name = "IDAutomationHC39M Free Version"
         Range("A5").Value = Code39(Range("I5").Value)
        End If
    End With
  
  Range("I7").Value = CustPO
  Range("C41").Value = PayTerm
  Range("C42").NumberFormat = "@"
  Range("C42").Value = Userform6.TextBox36.Text
  Range("F10").Value = "   " & DelName
  Range("F11").Value = "   " & DelAddress1
  Range("F12").Value = "   " & DelAddress2
  Range("F13").Value = "   " & DelAddress3
  Range("F14").Value = "   Contact : " & DelContact
I = 19
ThisWorkbook.Worksheets("TempRP").Activate
Range("D123").Select
Do While ActiveCell.Value <> ""
 ThisWorkbook.Worksheets("Invoice").Cells(I, 1).Value = I - 18
 ThisWorkbook.Worksheets("Invoice").Cells(I, 2).Value = ActiveCell.Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 3).Value = ActiveCell.Offset(0, 1).Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 7).Value = ActiveCell.Offset(0, 2).Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 8).Value = ActiveCell.Offset(0, 3).Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 9).Value = ActiveCell.Offset(0, 4).Value
 ActiveCell.Offset(1, 0).Select
 I = I + 1
Loop
  Call InvPageLayout("Invoice")
ThisWorkbook.Worksheets("Invoice").Visible = xlSheetVisible
 Worksheets("Invoice").CommandButton2.Visible = False
 Worksheets("Invoice").CommandButton3.Visible = False
 Worksheets("Invoice").CommandButton4.Visible = True
 Worksheets("Invoice").CommandButton5.Visible = True
Worksheets("System Menu").Visible = xlSheetVeryHidden
SheetName = "Invoice"
 ActiveWindow.DisplayGridlines = False
Userform6.Label23.BackColor = &HC0&
Userform6.Label23.Visible = False
Userform6.Hide
Worksheets("Invoice").Activate
Range("A1:K19").Select
ActiveWindow.Zoom = True
Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
End Sub

Sub PItoInvoice(PINo As String, PartNotFound As String)
Dim I As Long, CreditSum As Double, BalSum As Double, CheckRange As Range
 If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PROFORMA INVOICE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D123").Select
  I = 1
  Do While I < 21
   If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
   I = I + 1
  Loop
 If Range("D123").Value = "" Then
   Userform6.Label23.Caption = Chr(13) & "     No Product was entered.   Please add products before proceed."
   Userform6.Label23.Visible = True
   Userform6.ScrollBar1.Value = 2
   Userform6.ScrollBar1.Value = 1
   Exit Sub
 End If
  Call PIUpdate(PartNotFound)
  Call Form6AmountRefresh("")
 If PartNotFound = "Yes" Then
   MsgBox ("WARNING : " & Chr(13) & " Conversion fails." & Chr(13) & Chr(13) & _
    "      Some items are no longer on the Product List or Stock Item List" & _
         Chr(13) & Chr(13) & "      Please setup the Product data before making conversion")
  Exit Sub
 End If
 If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) = True Then
   Userform6.Label23.Caption = Chr(13) & "    The Customer is no longer on the Customer List" & Chr(13) _
                     & Chr(13) & "    Thus, Conversion cannot be proceeded."
   Userform6.Label23.Visible = True
   Exit Sub
 End If
 If Userform6.CommandButton1.Visible = True And Userform6.CommandButton1.Caption = "Save" Then
AskReply:
   MSG = "This Sales Order has not been Saved." + Chr(13) + _
   Chr(13) + "Enter 'Y' to proceed Saving and Conversion to Invoice "
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo FileSave
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
FileSave:
If PINo = "" Then
 If InvNo = "" Then
  InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
  Userform6.TextBox2.Text = InvNo
  Userform6.Label38.Visible = True
  Userform6.TextBox2.Left = 444
  Userform6.TextBox2.Width = 90
  PINo = "PI" & InvNo
 ElseIf IsNumeric(InvNo) Then
  If Len(InvNo) < 7 Then
   PINo = "PI" & InvNo
  Else
   PINo = InvNo & " "
  End If
 Else
  PINo = InvNo & " "
 End If
End If
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("D1").NumberFormat = "yyyy/mm/dd"
  Range("D1").Value = InvDate
  Range("E1").NumberFormat = "General"
  Range("E1").Value = DebtorAcct
  Range("H1:I1").NumberFormat = "General"
  Range("J1").NumberFormat = "@"
  Range("J1").Value = "*"
  Range("K1").NumberFormat = "General"
  Range("M1").NumberFormat = "yyyy/mm/dd"
  Range("N1").NumberFormat = "@"
  Range("N1").Value = Userform6.TextBox36.Text
  Range("O1:AC1").NumberFormat = "@"
  Range("O1").Value = PayTerm
  Range("P1").Value = CustNo
  Range("Q1").Value = CustName
  Range("R1").Value = Address1
  Range("S1").Value = Address2
  Range("T1").Value = Address3
  Range("U1").Value = CustContact
  Range("V1").Value = TelNo
  Range("AB1").Value = CustPO
  Range("AC1").Value = SalesRep
  Range("AD1:AG1").NumberFormat = "General"
  Range("AE1").Value = DisAmount
  Range("AH1").NumberFormat = "@"
  Range("AH1").Value = InvPrefix
  Range("AG1").Value = DisRate
  Range("B1").NumberFormat = "@"
  Range("A1").Value = "PI"
  Range("B1").Value = PINo
  If TotalAmount >= 0 Then
    Range("H1").Value = TotalAmount
  Else
    Range("I1").Value = TotalAmount * (-1)
  End If
  Range("G1").Value = PINo & " for " & CustName
  Range("K1").Value = TotalAmount
  Range("AF1").Value = TotalAmount
  Range("W1").Value = DelName
  Range("X1").Value = DelAddress1
  Range("Y1").Value = DelAddress2
  Range("Z1").Value = DelAddress3
  Range("AA1").Value = DelContact
  I = 35
  J = 0
  Range("C123").Select
  Do While ActiveCell.Value <> ""
   Cells(1, I).NumberFormat = "General"
   Cells(1, I).Value = ActiveCell.Offset(0, 6).Value
   Cells(1, I + 1).NumberFormat = "@"
   Cells(1, I + 1).Value = ActiveCell.Offset(0, 1).Value
   Cells(1, I + 2).NumberFormat = "@"
   Cells(1, I + 2).Value = ActiveCell.Offset(0, 2).Value
   Range(Cells(1, I + 3), Cells(1, I + 6)).NumberFormat = "General"
   Cells(1, I + 3).Value = ActiveCell.Offset(0, 3).Value
   Cells(1, I + 4).Value = ActiveCell.Offset(0, 4).Value
   Cells(1, I + 5).Value = ActiveCell.Offset(0, 5).Value
   Cells(1, I + 6).Value = ActiveCell.Offset(0, 9).Value
   Cells(1, I + 7).NumberFormat = "@"
   Cells(1, I + 7).Value = ActiveCell.Offset(0, 10).Value
   I = I + 8
   J = J + 1
   ActiveCell.Offset(1, 0).Select
  Loop
  Range("AD1").Value = J
  MyBook.Worksheets("ProInvoice").Activate
  If Range("B4").Value <> "" Then
   ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Set CheckRange = Selection.Columns("B")
    If IsError(Application.Match(PINo, CheckRange, 0)) = False Then
     FInvRow = Application.Match(PINo, CheckRange, 0) + 3
     LInvRow = Application.Match(PINo, CheckRange, 1) + 3
     Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
    End If
  End If
  MyBook.Worksheets("ProInvoice").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
  ThisWorkbook.Worksheets("TempRP").Activate
  Rows("1:1").Copy
  MyBook.Worksheets("ProInvoice").Activate
  ActiveSheet.Paste
  Range("C1").Select
  If InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6) Then MyBook.Worksheets("ProInvoice").Range("A1").Value = InvNo
  Userform6.CommandButton1.Caption = "Edit"
 End If
  ThisWorkbook.Worksheets("TempRP").Activate
   Range("D123").Select
   Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 9).Value = "" Then
      GoTo PartialOK
    Else
     If ActiveCell.Offset(0, 10).Value > 0 Then GoTo PartialOK
     If ActiveCell.Offset(0, 2).Value < 0 Then GoTo PartialOK
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
   Userform6.Label23.Caption = Chr(13) & "    No Stock for all the items" & Chr(13) _
                     & Chr(13) & "    Conversion cannot be proceeded."
   Userform6.Label23.Visible = True
   Exit Sub
PartialOK:
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D123").Select
 Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 9).Value <> "" And ActiveCell.Offset(0, 11).Value = "" Then
    If ActiveCell.Offset(0, 10).Value - ActiveCell.Offset(0, 2).Value < 0 Then
     UserForm33.Label1.Caption = Chr(13) & "    Insufficient Stock quantity to fulfil the entire Order. " & Chr(13) & Chr(13) & "    If Partial delivery is desired, click 'Proceed' button "
     UserForm33.Label1.Visible = True
     UserForm33.OptionButton2.Value = True
     UserForm33.OptionButton1.Visible = False
     UserForm33.Show
     ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
     Exit Sub
    End If
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
 UserForm33.OptionButton1.Value = True
 UserForm33.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
  ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
  Exit Sub
 End If
 Unload UserForm33
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 If UCase(PayTerm) <> "C.O.D." And UCase(PayTerm) <> "PREPAID" Then
   CustNo = Userform6.TextBox1.Text
    I = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
    CreditSum = MyBook.Worksheets("Customer Data").Cells(I, 8).Value
    MyBook.Worksheets("Receivable").Activate
    BalSum = 0
   If Range("B4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
   If IsError(Application.Match(CustNo, CheckRange, 0)) Then GoTo NoBalance
    FRow = Application.Match(CustNo, CheckRange, 0) + 3
    LRow = Application.Match(CustNo, CheckRange, 1) + 3
    If LRow < FRow Then LRow = FRow
    BalSum = Application.Sum(Range(Cells(FRow, 11), Cells(LRow, 11)))
   End If
NoBalance:
   CreditSum = CreditSum - BalSum
   Userform6.Label36.Caption = Format(CreditSum, "#,##0.00")
   Userform6.Label33.Caption = "Available Credit Amount (" & SysCurrency & ") : "
   Userform6.Label33.Visible = True
   Userform6.Label36.Visible = True
 Else
  Userform6.Label33.Visible = False
  Userform6.Label36.Visible = False
 End If
  ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE"
  InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
  Userform6.Label38.Visible = True
  Userform6.TextBox2.Width = 90
  Userform6.Label1.Caption = "INVOICE"
  Userform6.Label4.Caption = "Invoice # : "
  Userform6.Label38.Caption = "INV"
  Userform6.Label38.Width = 24
  Userform6.TextBox2.Left = 450
  Userform6.TextBox2.Text = InvNo
  Userform6.Label10.Top = 156
  Userform6.Label10.Height = 18
  Userform6.Label10.Caption = "Qty"
  InvDate = Date
  Userform6.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
  Userform6.TextBox36.Width = 84
  Userform6.CommandButton1.Caption = "Save"
  Userform6.CommandButton4.Visible = False
  Userform6.CommandButton11.Caption = "Issue New Invoice  for the same items"
  Userform6.CommandButton11.Visible = False
  Userform6.CommandButton12.Caption = "New Invoice"
  Userform6.CommandButton13.Caption = "Delete Invoice"
  Userform6.CommandButton13.Visible = False
  Userform6.CommandButton15.Caption = "Print-out   Invoice"
  Userform6.Label60.Visible = True
  Userform6.CommandButton16.Caption = "Multiple    Print-Out"
  Userform6.CommandButton16.BackColor = &H800000
  Userform6.CommandButton19.Visible = True
  Userform6.Label35.Visible = True
  Userform6.Label35.Left = 84
  Userform6.Label35.Width = 138
  Userform6.Label35.Caption = PayTerm
  Userform6.TextBox39.Visible = False
  Userform6.TextBox39.Text = ""
  Userform6.TextBox46.Visible = False
  Userform6.TextBox46.Text = ""
  Userform6.CommandButton18.Visible = True
  Userform6.Label22.Caption = "Payment Due : "
  For I = 1 To 7
   Userform6.Controls("Label" & I + 49).Visible = True
  Next I
  Call DueDateCal("")
   Call Form6AmountRefresh("")
  ThisWorkbook.Worksheets("TempRP").Activate
  MsgBox ("REMINDER : " & Chr(13) & Chr(13) & "     This Invoice has not been saved" & Chr(13) & _
    "     Remember to save the invoice after adding necessary data " & Chr(13) & "     (e.g. Invoice Date; etc)." & Chr(13) & Chr(13) & _
    "NOTE : Upon saving the invoice, the original Sales Order will be " & Chr(13) & "               removed from the record. ")
End Sub

Sub PIOrderReport(RunCode As String)
Dim I As Long, J As Long, K As Long, LineStart As Long, CustomerNo As String, Customer As String
Dim Total As Double, QtyGTotal As Double, AmtGTotal As Double, AcctNo As String
If RunCode <> "PIDetail" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("G1").Select
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A10").Value = "Product #"
    Range("A11").Value = "---------------------------"
    Range("B10").Value = "Description"
    Range("B11").Value = "---------------------------------------------------------------"
    Range("C9").Value = "Outstanding"
    Range("C10").Value = " Quantity "
    Range("C11").Value = "-------------------"
    Range("D9").Value = "  Discounted Amount "
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-----------------------------"
    Columns("A").ColumnWidth = 20
    Columns("B").ColumnWidth = 45
    Columns("C:D").ColumnWidth = 20
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C").HorizontalAlignment = xlCenter
    Columns("D").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("B1:C8").HorizontalAlignment = xlCenterAcrossSelection
    Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("B2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("B3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("B4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
  UserForm32.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
If UserForm32.OptionButton4.Value = True Or UserForm32.OptionButton5.Value = True Then
  Call PIListing("PIListing")
  Exit Sub
ElseIf UserForm32.OptionButton1.Value = True Then
 CustomerNo = UserForm32.TextBox3.Text
 Customer = UserForm32.Label11.Caption
Else
 CustomerNo = "*"
 Customer = ""
End If
 On Error GoTo ErrorHandling
   MyBook.Worksheets("ProInvoice").Activate
  If Range("B4").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  I = 4
  J = Range("B1").End(xlDown).Row
If CustomerNo <> "*" Then
  Range("P4").Select
   If ActiveCell.Value < CustomerNo And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < CustomerNo And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < CustomerNo And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   End If
     If ActiveCell.Value = CustomerNo Then
        I = ActiveCell.Row
        Customer = ActiveCell.Offset(0, 1).Value
     Else
      GoTo Finish
     End If
     Do While ActiveCell.Value = CustomerNo
      ActiveCell.Offset(1, 0).Select
     Loop
    J = ActiveCell.Row - 1
  If J < I Then GoTo Finish
End If
If UserForm32.OptionButton2.Value <> True Then
  Range(Cells(I, 30), Cells(J, 194)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
 I = 1
 Range("A1").Select
 Do While Cells(I, 7).Value <> ""
  DisRate = Cells(I, 10).Value
  J = Cells(I, 7).Value
  K = 13
  Do While J > 0
    Range(Cells(I, K), Cells(I, K + 3)).Copy
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveCell.Offset(0, 4).Value = Cells(I, K + 4) * (1 - DisRate)
    ActiveCell.Offset(1, 0).Select
    J = J - 1
    K = K + 8
  Loop
  I = I + 1
 Loop
  If Range("A1").Value = "" Then GoTo Finish
  Range("A1:E1").CurrentRegion.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("A1").Select
    I = 1
    J = 0
 Do While ActiveCell.Value <> ""
  AcctNo = ActiveCell.Value
  Do While ActiveCell.Value = AcctNo
   ActiveCell.Offset(1, 0).Select
  Loop
  J = ActiveCell.Row - 1
  If J > I Then
   Total = Application.Sum(Range(Cells(I, 3), Cells(J, 3)))
   Cells(I, 3).Value = Total
   Total = Application.Sum(Range(Cells(I, 5), Cells(J, 5)))
   Cells(I, 5).Value = Total
   Range(Cells(I + 1, 1), Cells(J, 5)).EntireRow.Delete
  End If
  I = I + 1
  J = I - 1
  Cells(I, 1).Select
 Loop
  Columns("D").Delete
  Range("A1:E1").CurrentRegion.Copy
  ThisWorkbook.Worksheets("Report").Activate
  Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Application.CutCopyMode = False
Else
  Range(Cells(I, 16), Cells(J, 194)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("I1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("K:V").Delete
  Columns("F:G").NumberFormat = "@"
 I = 1
 Range("A1").Select
 Do While Cells(I, 9).Value <> ""
  DisRate = Cells(I, 14).Value
  J = Cells(I, 11).Value
  K = 17
  Do While J > 0
    Range(Cells(I, K), Cells(I, K + 3)).Copy
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveCell.Offset(0, 4).Value = Cells(I, K + 4) * (1 - DisRate)
    ActiveCell.Offset(0, 5).Value = Cells(I, 9).Value
    ActiveCell.Offset(0, 6).Value = Cells(I, 10).Value
    ActiveCell.Offset(1, 0).Select
    J = J - 1
    K = K + 8
  Loop
  I = I + 1
 Loop
  Columns("D").Delete
  Range("A1:E1").CurrentRegion.Select
  Selection.Sort Key1:=Range("F1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Selection.Copy
   ThisWorkbook.Worksheets("Report").Activate
   Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
   Range("A12").Select
    I = 12
    J = 11
    QtyGTotal = 0
    AmtGTotal = 0
  Do While ActiveCell.Value <> ""
   AcctNo = ActiveCell.Value
   Customer = ActiveCell.Offset(0, 5).Value
   CustomerNo = ActiveCell.Offset(0, 4).Value
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   ActiveCell.HorizontalAlignment = xlLeft
   ActiveCell.Offset(1, 0).Value = Customer & " ( # " & CustomerNo & " )"
   ActiveCell.Offset(2, 0).Select
   I = I + 2
   LineStart = I
   Do While ActiveCell.Offset(0, 5).Value = Customer
     Do While ActiveCell.Value = AcctNo And ActiveCell.Offset(0, 5).Value = Customer
       ActiveCell.Offset(1, 0).Select
     Loop
    J = ActiveCell.Row - 1
    If J > I Then
     Total = Application.Sum(Range(Cells(I, 3), Cells(J, 3)))
     Cells(I, 3).Value = Total
     Total = Application.Sum(Range(Cells(I, 4), Cells(J, 4)))
     Cells(I, 4).Value = Total
     Range(Cells(I + 1, 1), Cells(J, 5)).EntireRow.Delete
    End If
    I = I + 1
    J = I - 1
    Cells(I, 1).Select
    AcctNo = ActiveCell.Value
   Loop
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   Total = Application.Sum(Range(Cells(LineStart, 3), Cells(I - 1, 3)))
   Cells(I + 1, 3).Value = Total
   QtyGTotal = QtyGTotal + Total
   Total = Application.Sum(Range(Cells(LineStart, 4), Cells(I - 1, 4)))
   Cells(I + 1, 4).Value = Total
   AmtGTotal = AmtGTotal + Total
   Cells(I + 1, 2).HorizontalAlignment = xlRight
   Cells(I + 1, 2).Value = "Total : "
    Range(Cells(I + 1, 1), Cells(I + 1, 4)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
     I = I + 2
     J = I - 1
     Cells(I, 1).Select
  Loop
  Columns("E:F").Delete
  Range("A12").Value = " "
  I = ActiveSheet.UsedRange.Rows.Count
  If Range("A12").Value <> "" Then
    Cells(I + 2, 3).Value = QtyGTotal
    Cells(I + 2, 4).Value = AmtGTotal
    Cells(I + 2, 2).HorizontalAlignment = xlRight
    Cells(I + 2, 2).Value = "Grand Total : "
  End If
 End If
Finish:
   ThisWorkbook.Worksheets("Report").Activate
If Range("A12").Value <> "" And UserForm32.OptionButton2.Value <> True Then
  I = ActiveSheet.UsedRange.Rows.Count
   Cells(I + 2, 3).Value = Application.Sum(Range(Cells(12, 3), Cells(I, 3)))
   Cells(I + 2, 4).Value = Application.Sum(Range(Cells(12, 4), Cells(I, 4)))
   Cells(I + 2, 2).HorizontalAlignment = xlRight
   Cells(I + 2, 2).Value = "Total : "
 End If
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    If UserForm32.OptionButton1.Value = True Then
      Range("B6").Value = "Open Sales Order Summary"
      Range("B7").Value = " for "
      If Customer <> "" Then
        Range("B8").Value = " Customer :-- " & Customer & " (# " & CustomerNo & ") "
      Else
        Range("B8").Value = " ( Customer # " & CustomerNo & " ) "
      End If
     ElseIf UserForm32.OptionButton3.Value = True Then
        Range("B6").Value = "Open Sales Order Summary"
     Else
        Range("B6").Value = "Open Sales Order Summary - sorted by Customer name"
     End If
    Range("A1:D15").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
    
  If Range("A12").Value = "" Then
   If Customer <> "" Then
    Range("B13").Value = "    No Data for the selected customer. "
   Else
    Range("B13").Value = "    No Record of Open Sales Orders. "
   End If
  End If
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
     On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
   On Error GoTo ErrorHandling
  Unload UserForm32
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
 Exit Sub
ErrorHandling:
   Unload UserForm32
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "Probably the Data file is lack of space." & Chr(13) & _
    "Try to Remove old Sales Orders from the system")
End Sub

Sub PIListing(RunCode As String)
Dim PIAmt As Double, I As Long, J As Long, K As Long, M As Long
If RunCode <> "PIListing" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("M1").Select
    ThisWorkbook.Worksheets("Report").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A10").Value = "SO Ref #"
    Range("A11").Value = "------------------"
    Range("B10").Value = "SO Date"
    Range("B11").Value = "-----------------"
    Range("C10").Value = " Product #  "
    Range("C11").Value = "-----------------------"
    Range("D10").Value = " Product Description"
    Range("D11").Value = "-----------------------------------------------------------------------"
    Range("E9").Value = "Outstanding"
    Range("E10").Value = " Quantity "
    Range("E11").Value = "-------------------"
    Range("F9").Value = " Unit Price "
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-------------------"
    Range("G9").Value = " Amount "
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "-------------------"
    Columns("A").ColumnWidth = 16
    Columns("B").ColumnWidth = 13
    Columns("C").ColumnWidth = 20
    Columns("D").ColumnWidth = 45
    Columns("E:G").ColumnWidth = 15
    Columns("A").HorizontalAlignment = xlLeft
    Columns("B").HorizontalAlignment = xlCenter
    Columns("C:D").HorizontalAlignment = xlLeft
    Columns("E").HorizontalAlignment = xlCenter
    Columns("F:G").HorizontalAlignment = xlRight
    Columns("A").NumberFormat = "@"
    Columns("B").NumberFormat = "yyyy/mm/dd"
    Columns("C:D").NumberFormat = "@"
    Columns("F").NumberFormat = "#,##0.0000"
    Columns("G").NumberFormat = "#,##0.00"
    Columns("C:D").ShrinkToFit = True
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("C1:E8").HorizontalAlignment = xlCenterAcrossSelection
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
  On Error GoTo ErrorHandling
   MyBook.Worksheets("ProInvoice").Activate
  If Range("B4").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  If UserForm32.OptionButton4.Value = True Then
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Else
    Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  End If
  I = 4
  J = Range("B1").End(xlDown).Row
  Range(Cells(I, 1), Cells(J, 194)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("C:D").NumberFormat = "@"
 Range("AB1").Select
 SupplierNo = ActiveCell.Value
 I = 1
 K = 1
 PIAmt = 0
 Do While ActiveCell.Value <> ""
   Cells(I, 1).Value = ActiveCell.Offset(0, 1).Value & "  (" & ActiveCell.Value & ")"
   I = I + 1
   M = I
   J = ActiveCell.Offset(0, 14).Value
   Cells(I, 1).NumberFormat = "@"
   Cells(I, 1).Value = ActiveCell.Offset(0, -14).Value
   Cells(I, 2).Value = ActiveCell.Offset(0, -12).Value
  Do While J > 0
   Cells(I, 3).Value = ActiveCell.Offset(0, 19 + K).Value
   Cells(I, 4).Value = ActiveCell.Offset(0, 19 + K + 1).Value
   Cells(I, 5).Value = ActiveCell.Offset(0, 19 + K + 2).Value
   If Cells(I, 5).Value = "" Then Cells(I, 5).Value = 0
   Cells(I, 6).Value = ActiveCell.Offset(0, 19 + K + 3).Value
   Cells(I, 7).Value = ActiveCell.Offset(0, 19 + K + 4).Value
   If Cells(I, 7).Value = "" Then Cells(I, 8).Value = 0
   I = I + 1
   J = J - 1
   K = K + 8
  Loop
  Cells(I + 2, 1).Value = "Ship Schedule: " & ActiveCell.Offset(0, -2).Value
  Cells(I + 1, 6).Value = " Sub-Total :"
  Cells(I + 1, 7).Value = Application.Sum(Range(Cells(M, 7), Cells(I - 1, 7)))
  Cells(I + 2, 6).Value = " Discount :"
  Cells(I + 2, 7).Value = ActiveCell.Offset(0, 15).Value
  Cells(I + 3, 6).Value = " Total :"
  Cells(I + 3, 7).Value = ActiveCell.Offset(0, 16).Value
  PIAmt = PIAmt + Cells(I + 3, 7).Value
   Worksheets("Report").Activate
    Range(Cells(I + 14, 1), Cells(I + 14, 7)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Worksheets("TempRP").Activate
  K = 1
  I = I + 5
  ActiveCell.Offset(1, 0).Select
 Loop
If UserForm32.OptionButton4 = True Then
  Cells(I, 6).Value = " Grand Total :"
  Cells(I, 7).Value = PIAmt
End If
  Range(Cells(1, 1), Cells(I, 7)).Copy
  Worksheets("Report").Activate
  Range("A12").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
       False, Transpose:=False
   Application.CutCopyMode = False
Finish:
   ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    If UserForm32.OptionButton4.Value = True Then
      Range("C6").Value = "Detail Listing of All Open Sales Orders --- Sorted by SO Ref #"
     Else
      Range("C6").Value = "Detail Listing of All Open Sales Orders --- Sorted by Customer #"
     End If
    Range("A1:G15").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A12").Value = "" Then
    Range("D13").ShrinkToFit = False
    Range("D13").Value = " No Record of Open Sales Orders. "
  End If
  
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  On Error GoTo ErrorHandling
  Unload UserForm32
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
 Exit Sub
ErrorHandling:
   Unload UserForm32
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "Probably the Data file is lack of space." & Chr(13) & _
    "Try to Remove old Sales Orders from the system")
End Sub

Sub PICompCal(RunCode As String, BuildQty As Double, LastTempRPRow As Long)
Dim I As Long, J As Long, ShName As String, CheckRange As Range, BOMCol As Long, LastBOMRow As Long
If RunCode <> "PICompCal" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
   J = MyBook.Worksheets("BOM1").Range("A9").Value
   BOMCol = 0
   For I = 1 To J
    ShName = "BOM" & I
    MyBook.Worksheets(ShName).Activate
     Set CheckRange = Rows("10")
     If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
       BOMCol = Application.Match(StockNo, CheckRange, 0)
       If Range("A11") <> "" Then
         Range("A10").End(xlDown).Select
         LastBOMRow = ActiveCell.Row
       Else
         LastBOMRow = 10
       End If
       Exit For
     End If
   Next I
   If BOMCol < 2 Then
     If IsError(Application.Match(StockNo, ThisWorkbook.Worksheets("TempRP").Range("D:D"), 0)) = False Then
       I = Application.Match(StockNo, ThisWorkbook.Worksheets("TempRP").Range("D:D"), 0)
       ThisWorkbook.Worksheets("TempRP").Cells(I, 8).ClearContents
     End If
     ThisWorkbook.Worksheets("RunningDat").Activate
     Columns("A:H").ClearContents
     Exit Sub
   End If
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("B2").Select
   MyBook.Worksheets(ShName).Activate
   Range(Cells(11, BOMCol), Cells(LastBOMRow, BOMCol)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("A2").Select
   MyBook.Worksheets(ShName).Activate
   Range(Cells(11, 1), Cells(LastBOMRow, 1)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(2, 1), Cells(LastBOMRow, 2)).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   If Range("B2").Value <> "" Then
    If Range("B3").Value <> "" Then
     Range("B2").End(xlDown).Select
     I = ActiveCell.Row
     Range(Cells(I + 1, 1), Cells(LastBOMRow, 2)).ClearContents
     LastBOMRow = I
    Else
     I = 2
     Range(Cells(3, 1), Cells(LastBOMRow, 2)).ClearContents
     LastBOMRow = 2
    End If
   Else
    Range(Cells(2, 1), Cells(LastBOMRow, 2)).ClearContents
    LastBOMRow = 1
   End If
  If LastBOMRow > 1 Then
   Cells(1, 6).Value = BuildQty
   Range(Cells(2, 8), Cells(LastBOMRow, 8)).Value = BuildQty
   Range(Cells(2, 7), Cells(LastBOMRow, 7)).FormulaR1C1 = "=SUM(RC[-5]*RC[1])"
   Range(Cells(2, 7), Cells(LastBOMRow, 7)).Copy
   Cells(2, 2).Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
   Cells(1, 7).ClearContents
   Cells(1, 6).Value = BuildQty
   Range(Cells(1, 1), Cells(LastBOMRow, 6)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   Cells(LastTempRPRow, 4).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   LastTempRPRow = LastTempRPRow + LastBOMRow
  End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  Columns("A:H").ClearContents
End Sub

Sub ARReport(RunCode As String)
Dim I As Long, J As Long, SortType As String, StartDate As Date, EndDate As Date, RptType As String, AcctNo As String
Dim GrandInv As Double, GrandDue As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "ARREPORT" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("A1").Select
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  UserForm12.OptionButton2.Visible = False
  UserForm12.OptionButton1.Value = True
  UserForm12.Label2.Visible = True
  UserForm12.Label3.Visible = True
  StartDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  EndDate = Year(BeginningDate) + 1 & "/" & Month(BeginningDate) & "/" & Day(BeginningDate)
  EndDate = EndDate - 1
  UserForm12.TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
  UserForm12.TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
  UserForm12.TextBox1.Visible = True
  UserForm12.TextBox2.Visible = True
Else
  UserForm12.OptionButton2.Value = True
End If
UserForm12.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
If UserForm12.OptionButton2.Value = True Then
 RptType = "U"
Else
   RptType = "A"
  StartDate = UserForm12.TextBox1.Text
  EndDate = UserForm12.TextBox2.Text
End If
 ThisWorkbook.Worksheets("Report").Activate
If UserForm12.OptionButton3.Value = True Then
  SortType = "I"
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A10").Value = "Inv /CN #"
    Range("A11").Value = "---------------------"
    Range("B10").Value = " Inv /CN Date "
    Range("B11").Value = "------------------"
    Range("C10").Value = "Customer #"
    Range("C11").Value = "---------------"
    Range("D10").Value = "Customer Name"
    Range("D11").Value = "-------------------------------------------------"
    Range("E9").Value = "Invoice Total"
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "-------------------"
    Range("F9").Value = "Amount Due"
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "--------------------"
    Range("G10").Value = "Due Date"
    Range("G11").Value = "------------------"
    Columns("A:A").ColumnWidth = 16
    Columns("B:B").ColumnWidth = 13
    Columns("C:C").ColumnWidth = 12
    Columns("D:D").ColumnWidth = 35
    Columns("E:F").ColumnWidth = 13.5
    Columns("G:G").ColumnWidth = 13
    Columns("B:B").NumberFormat = "yyyy/mm/dd"
    Columns("A:C").HorizontalAlignment = xlCenter
    Columns("D").HorizontalAlignment = xlLeft
    Columns("E:F").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("G:G").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Range("D1:D7").HorizontalAlignment = xlCenter
    Range("D1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("D2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("D3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("D4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("A12").Select
ElseIf UserForm12.OptionButton4.Value = True Then
 SortType = "D"
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Worksheets("Report").Visible = xlSheetVisible
    Worksheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A10").Value = " Inv Date "
    Range("A11").Value = "------------------"
    Range("B10").Value = "Inv / CN #"
    Range("B11").Value = "-------------------------"
    Range("C10").Value = "Customer #"
    Range("C11").Value = "---------------"
    Range("D10").Value = "Customer Name"
    Range("D11").Value = "-------------------------------------------------"
    Range("E9").Value = "Invoice Total"
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "-----------------"
    Range("F9").Value = "Amount Due"
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-----------------"
    Range("G10").Value = "Due Date"
    Range("G11").Value = "------------------"
    Columns("A:A").ColumnWidth = 13
    Columns("B:B").ColumnWidth = 16
    Columns("C:C").ColumnWidth = 12
    Columns("D:D").ColumnWidth = 35
    Columns("E:F").ColumnWidth = 13.5
    Columns("G:G").ColumnWidth = 13
    Columns("A:A").NumberFormat = "yyyy/mm/dd"
    Columns("A:C").HorizontalAlignment = xlCenter
    Columns("D").HorizontalAlignment = xlLeft
    Columns("E:F").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("G:G").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Range("D1:D7").HorizontalAlignment = xlCenter
    Range("D1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("D2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("D3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("D4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("A12").Select
Else
  SortType = "C"
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Worksheets("Report").Visible = xlSheetVisible
    Worksheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "Customer #"
    Range("A11").Value = "---------------"
    Range("B10").Value = "Customer Name"
    Range("B11").Value = "-------------------------------------------------"
    Range("C10").Value = "Inv / CN #"
    Range("C11").Value = "---------------------"
    Range("D10").Value = " Inv Date "
    Range("D11").Value = "------------------"
    Range("E9").Value = "Invoice Total"
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "-----------------"
    Range("F9").Value = "Amount Due"
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-----------------"
    Range("G10").Value = "Due Date"
    Range("G11").Value = "------------------"
    Columns("A:A").ColumnWidth = 12
    Columns("B:B").ColumnWidth = 35
    Columns("C:C").ColumnWidth = 16
    Columns("D:D").ColumnWidth = 13
    Columns("E:F").ColumnWidth = 13.5
    Columns("G:G").ColumnWidth = 13
    Columns("D:D").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("A").HorizontalAlignment = xlCenter
    Columns("B").HorizontalAlignment = xlLeft
    Columns("A").HorizontalAlignment = xlCenter
    Columns("E:F").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("G:G").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Range("C1:C7").HorizontalAlignment = xlCenter
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("A12").Select
End If
 On Error GoTo ErrorHandling
MyBook.Worksheets("Receivable").Activate
If Range("E4").Value = "" Then GoTo Finish
Range("A1").Select
If RptType = "U" Then
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("J4").Select
  If ActiveCell.Value < "S" And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < "S" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < "S" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(4, 1), Cells(I, 34)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Else
    GoTo Finish
  End If
Else
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("D4").Select
  I = 4
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
      J = ActiveCell.Row - 1
 If J < I Then GoTo Finish
  Range(Cells(I, 1), Cells(J, 34)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
End If
 Range("B1").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, -1).Value = "INVOICE" And Right(ActiveCell.Value, 1) <> " " Then
   ActiveCell.Value = "INV" & ActiveCell.Offset(0, 32).Value & ActiveCell.Value
  Else
   ActiveCell.Value = ActiveCell.Offset(0, 32).Value & ActiveCell.Value
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
ActiveSheet.UsedRange.Select
With Selection
  Columns("AG:AH").Delete
  Columns("R:AE").Delete
  Columns("O").Delete
  Columns("L:M").Delete
  Columns("E:J").Delete
  Columns("C").Delete
  Columns("A").Delete
 If SortType = "I" Then
   Range("C1:F1").EntireColumn.Insert
   .Columns("I:K").Cut
    Range("D1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("C:E").Insert
   .Columns("H:J").Cut
    Range("C1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Range("C1").EntireColumn.Insert
   .Columns("H").Cut
    Range("C1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("G:K").Delete
   Range("A1").Select
 ElseIf SortType = "D" Then
   Columns("C:F").Insert
   .Columns("A").Cut
    Range("C1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   .Columns("H:J").Cut
    Range("D1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("A").Delete
 Else
   Columns("A:B").Insert
   .Columns("E:F").Cut
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("E").Insert
   .Columns("H").Cut
    Range("E1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
 End If
End With
If SortType = "I" Then
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
ElseIf SortType = "D" Then
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
Else
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
End If
Selection.Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
   Application.CutCopyMode = False
If SortType = "I" Or SortType = "D" Then
     Range("F9").End(xlDown).Select
     J = ActiveCell.Row
  If J > 3 Then
   Cells(J + 2, 6).Value = Application.Sum(Range(Cells(4, 6), Cells(J, 6)))
   Cells(J + 2, 5).Value = Application.Sum(Range(Cells(4, 5), Cells(J, 5)))
   Cells(J + 2, 4).Value = "Total : "
   Cells(J + 2, 4).HorizontalAlignment = xlRight
  End If
 Range("A2").Select
Else
 I = 12
 J = 11
 GrandInv = 0
 GrandDue = 0
 Range("A12").Select
 Do While ActiveCell.Value <> ""
  AcctNo = ActiveCell.Value
  Do While ActiveCell.Value = AcctNo
   ActiveCell.Offset(1, 0).Select
  Loop
  J = ActiveCell.Row - 1
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
   Cells(J + 1, 5).Value = Application.Sum(Range(Cells(I, 5), Cells(J, 5)))
   GrandInv = GrandInv + Application.Sum(Range(Cells(I, 5), Cells(J, 5)))
   Cells(J + 1, 6).Value = Application.Sum(Range(Cells(I, 6), Cells(J, 6)))
   GrandDue = GrandDue + Application.Sum(Range(Cells(I, 6), Cells(J, 6)))
   Cells(J + 1, 4).Value = "Total : "
   Cells(J + 1, 4).HorizontalAlignment = xlRight
  If J > I Then
   Range(Cells(I + 1, 1), Cells(J, 2)).ClearContents
  End If
  I = J + 3
  J = J + 2
  Cells(I, 1).Select
 Loop
 Cells(I, 4).Value = "Grand Total : "
 Cells(I, 4).HorizontalAlignment = xlRight
 Cells(I, 5).Value = GrandInv
 Cells(I, 6).Value = GrandDue
 Range("A2").Select
End If
Finish:
  ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
  If SortType = "I" Then
   If RptType = "U" Then
    Range("D6").Value = "Listing of All Unsettled Invoices and Credit Notes"
    Range("D7").Value = "(Sorted by Invoice # and Credit Note #)"
   Else
    Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
    Range("D6").Value = "Listing of Invoices and Credit Notes"
    Range("D7").Value = "(Sorted by Invoice # and Credit Note #)"
   End If
   Range("A1:J19").Select
   ActiveWindow.Zoom = True
  End If
  If SortType = "D" Then
    If RptType = "U" Then
      Range("D6").Value = "Listing of All Unsettled Invoices and Credit Notes"
      Range("D7").Value = "(Sorted by Issue Dates)"
    Else
      Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
      Range("D6").Value = "Listing of Invoices and Credit Notes"
      Range("D7").Value = "(Sorted by Issue dates)"
    End If
   End If
  If SortType = "C" Then
    If RptType = "U" Then
      Range("C6").Value = "Listing of All Unsettled Invoices and Credit Notes"
      Range("C7").Value = "(Sorted by Customer Numbers)"
    Else
      Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
      Range("C6").Value = "Listing of Invoices and Credit Notes"
      Range("C7").Value = "(Sorted by Customer Numbers)"
    End If
   End If
    Range("A1:G23").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A12").Value = "" Then Range("D13").Value = " No Data for the selected period and range. "
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
   On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
  On Error GoTo ErrorHandling
  Unload UserForm12
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
 Exit Sub
ErrorHandling:
   Unload UserForm12
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub AgeReport(RunCode As String)
Dim I As Long, CustomerNo As String, SumDue As Double, SumC As Double, Sum0 As Double, Sum30 As Double
Dim Sum60 As Double, Sum90 As Double, TotalDue As Double, TotalC As Double, Total0 As Double, Total30 As Double
Dim Total60 As Double, Total90 As Double, CloseDate As Date, StartCustNo As String, Customer As String
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "ARAGING" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("A1").Select
UserForm13.Caption = "Receivable Aging Reporting"
UserForm13.Label1.Caption = "Receivable Aging Report"
UserForm13.OptionButton3.Visible = False
UserForm13.OptionButton2.Caption = "All Customers"
UserForm13.OptionButton2.Value = True
UserForm13.OptionButton1.Caption = "Selected Customer"
UserForm13.Label10.Visible = False
UserForm13.Label2.Visible = False
UserForm13.Label3.Visible = False
UserForm13.Label8.Visible = False
UserForm13.Label9.Visible = False
UserForm13.TextBox1.Visible = False
UserForm13.TextBox2.Visible = False
UserForm13.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
If UserForm13.OptionButton1.Value = True Then
 StartCustNo = UserForm13.TextBox3.Text
 Customer = UserForm13.Label11.Caption
Else
 StartCustNo = "*"
 Customer = ""
End If
CloseDate = Date
 ThisWorkbook.Worksheets("Report").Activate
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "Inv /CN #"
    Range("A11").Value = "----------------------"
    Range("B10").Value = "Inv /CN Date"
    Range("B11").Value = "------------------"
    Range("C10").Value = "Due Date"
    Range("C11").Value = "------------------"
    Range("D9").Value = "Amount Due"
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-------------------"
    Range("G9").Value = "CURRENT"
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "--------------------"
    Range("H9").Value = "0 - 30 Days"
    Range("H10").Value = "(" & SysCurrency & ")  "
    Range("H11").Value = "--------------------"
    Range("I9").Value = "31 - 60 Days"
    Range("I10").Value = "(" & SysCurrency & ")  "
    Range("I11").Value = "--------------------"
    Range("J9").Value = "61 - 90 Days"
    Range("J10").Value = "(" & SysCurrency & ")  "
    Range("J11").Value = "--------------------"
    Range("K9").Value = "Over 90 Days"
    Range("K10").Value = "(" & SysCurrency & ")  "
    Range("K11").Value = "--------------------"
    Columns("A:A").ColumnWidth = 16
    Columns("B:K").ColumnWidth = 13
    Columns("B:C").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("A:C").HorizontalAlignment = xlLeft
    Columns("D:K").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("G1:G7").HorizontalAlignment = xlCenter
    Range("G1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("G2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("G3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("G4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
   MyBook.Worksheets("Receivable").Activate
  If Range("E4").Value = "" Then GoTo Finish
  Range("A1").Select
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("J4").Select
 If ActiveCell.Value < "S" And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < "S" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < "S" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(4, 1), Cells(I, 34)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
 Range("B1").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, -1).Value = "INVOICE" And Right(ActiveCell.Value, 1) <> " " Then
   ActiveCell.Value = "INV" & ActiveCell.Offset(0, 32).Value & ActiveCell.Value
  Else
   ActiveCell.Value = ActiveCell.Offset(0, 32).Value & ActiveCell.Value
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
ActiveSheet.UsedRange.Select
With Selection
  Columns("R:AH").Delete
  Columns("O").Delete
  Columns("L:M").Delete
  Columns("E:J").Delete
  Columns("C").Delete
  Columns("A").Delete
  Columns("C").Insert
  Columns("E").Copy
  Range("C1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("E").Delete
End With
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
If StartCustNo <> "*" Then
 Range("E1").Select
 If ActiveCell.Value < StartCustNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value < StartCustNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value < StartCustNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(1, 1), Cells(I, 17)).EntireRow.Delete
 End If
 Range("E1").Select
 If ActiveCell.Value <= StartCustNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value <= StartCustNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value <= StartCustNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   If I > 0 Then
    If Cells(I + 1, 5).Value <> "" Then
      ActiveCell.EntireRow.Insert
      ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
    End If
   Else: GoTo Finish
   End If
   ActiveSheet.UsedRange.Select
 Else
  GoTo Finish
 End If
End If
Selection.Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Application.CutCopyMode = False
 SumDue = 0
 SumC = 0
 Sum0 = 0
 Sum30 = 0
 Sum60 = 0
 Sum90 = 0
 TotalDue = 0
 TotalC = 0
 Total0 = 0
 Total30 = 0
 Total60 = 0
 Total90 = 0
 Range("E12").Select
 Do While ActiveCell.Value <> ""
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.Offset(3, 0).Select
  CustomerNo = ActiveCell.Value
  ActiveCell.Offset(-2, -4).NumberFormat = "@"
  ActiveCell.Offset(-2, -4).Value = ActiveCell.Offset(0, 1).Value & " ( # : " & CustomerNo & " )"
  Do While ActiveCell.Value = CustomerNo
   If CloseDate - ActiveCell.Offset(0, -2).Value > 90 Then
    ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, -1).Value
    Sum90 = Sum90 + ActiveCell.Offset(0, -1).Value
   ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 60 Then
    ActiveCell.Offset(0, 5).Value = ActiveCell.Offset(0, -1).Value
    Sum60 = Sum60 + ActiveCell.Offset(0, -1).Value
   ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 30 Then
    ActiveCell.Offset(0, 4).Value = ActiveCell.Offset(0, -1).Value
    Sum30 = Sum30 + ActiveCell.Offset(0, -1).Value
   ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 0 Then
    ActiveCell.Offset(0, 3).Value = ActiveCell.Offset(0, -1).Value
    Sum0 = Sum0 + ActiveCell.Offset(0, -1).Value
  Else
    ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, -1).Value
    SumC = SumC + ActiveCell.Offset(0, -1).Value
  End If
   ActiveCell.Offset(1, 0).Select
  Loop
  I = ActiveCell.Row
  SumDue = SumC + Sum0 + Sum30 + Sum60 + Sum90
  TotalDue = TotalDue + SumDue
  TotalC = TotalC + SumC
  Total0 = Total0 + Sum0
  Total30 = Total30 + Sum30
  Total60 = Total60 + Sum60
  Total90 = Total90 + Sum90
  ActiveCell.EntireRow.Insert
  Range(Cells(I - 1, 4), Cells(I - 1, 11)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
    End With
   Range(Cells(I, 1), Cells(I, 11)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Cells(I, 5).Select
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "Total : "
  ActiveCell.Offset(0, -1).Value = SumDue
  ActiveCell.Offset(0, 2).Value = SumC
  ActiveCell.Offset(0, 3).Value = Sum0
  ActiveCell.Offset(0, 4).Value = Sum30
  ActiveCell.Offset(0, 5).Value = Sum60
  ActiveCell.Offset(0, 6).Value = Sum90
  SumDue = 0
  SumC = 0
  Sum0 = 0
  Sum30 = 0
  Sum60 = 0
  Sum90 = 0
  ActiveCell.Offset(1, 0).Select
 Loop
   ActiveCell.Offset(1, 0).Select
  If UserForm13.OptionButton1.Value = True Then GoTo Finish
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "GrandTotal : "
  ActiveCell.Offset(0, -1).Value = TotalDue
  ActiveCell.Offset(0, 2).Value = TotalC
  ActiveCell.Offset(0, 3).Value = Total0
  ActiveCell.Offset(0, 4).Value = Total30
  ActiveCell.Offset(0, 5).Value = Total60
  ActiveCell.Offset(0, 6).Value = Total90
End If
Finish:
  ThisWorkbook.Worksheets("Report").Activate
  Columns("E:F").Delete
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    
  If UserForm13.OptionButton1.Value = True Then
    Range("E6").Value = "Aged Report for Unsettled Invoices and Credit Notes"
    Range("E7").Value = "for Customer :" & Customer & " (# " & StartCustNo & ")"
  Else
    Range("E6").Value = "Aged Report for Unsettled Invoices and Credit Notes"
  End If
    Range("A1:I18").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A13").Value = "" Then
   Range("A13").EntireRow.Delete
   Range("D13").Value = " No Data for the selected Customer range. "
  End If
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
  ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  Unload UserForm13
  SheetName = "Report"
  OldForm = "UserForm8"
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
 ThisWorkbook.Worksheets("Report").Activate
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A3").Select
End Sub


Sub ARRec(RunCode As String)
Dim I As Long, CustomerNo As String, SumDue As Double, SumC As Double, Sum0 As Double, Sum30 As Double
Dim Sum60 As Double, Sum90 As Double, TotalDue As Double, TotalC As Double, Total0 As Double, Total30 As Double
Dim Total60 As Double, Total90 As Double, CloseDate As Date, StartCustNo As String
Dim StartRow As Long, EndRow As Long, TestDate As Long, PayDocNo As String, AddAmt As Double, LineNo As Long
Dim CheckRange As Range, RecordRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "ARREC" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.Delete
Range("A1").Select
UserForm34.Caption = "Receivable Reconciliation Report as at Selected Date"
UserForm34.Label1.Caption = "Receivable Reconciliation Report as at Selected Date"
UserForm34.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
  CloseDate = UserForm34.TextBox1.Text
 ThisWorkbook.Worksheets("Report").Activate
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "Inv /CN #"
    Range("A11").Value = "----------------------"
    Range("B10").Value = "Inv /CN Date"
    Range("B11").Value = "------------------"
    Range("C10").Value = "Due Date"
    Range("C11").Value = "------------------"
    Range("D9").Value = "Amount Due"
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-------------------"
    Range("G9").Value = "CURRENT"
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "--------------------"
    Range("H9").Value = "0 - 30 Days"
    Range("H10").Value = "(" & SysCurrency & ")  "
    Range("H11").Value = "--------------------"
    Range("I9").Value = "31 - 60 Days"
    Range("I10").Value = "(" & SysCurrency & ")  "
    Range("I11").Value = "--------------------"
    Range("J9").Value = "61 - 90 Days"
    Range("J10").Value = "(" & SysCurrency & ")  "
    Range("J11").Value = "--------------------"
    Range("K9").Value = "Over 90 Days"
    Range("K10").Value = "(" & SysCurrency & ")  "
    Range("K11").Value = "--------------------"
    Columns("A:A").ColumnWidth = 16
    Columns("B:K").ColumnWidth = 13
    Columns("B:C").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("A:C").HorizontalAlignment = xlLeft
    Columns("D:K").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("G1:G7").HorizontalAlignment = xlCenter
    Range("G1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("G2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("G3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("G4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
   MyBook.Worksheets("Receivable").Activate
  If Range("E4").Value = "" Then GoTo Finish
  Range("A1").Select
  StartRow = 4
  EndRow = ActiveSheet.UsedRange.Rows.Count
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("M")
  TestDate = CDate(CloseDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 4
   If StartRow > EndRow Then GoTo Finish
 End If
  Rows(StartRow & ":" & EndRow).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("D")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   EndRow = Application.Match(TestDate, CheckRange, 1) + StartRow - 1
   If StartRow > EndRow Then GoTo CheckPayment
 Else
   GoTo CheckPayment
 End If
   Range(Cells(StartRow, 1), Cells(EndRow, 34)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
CheckPayment:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
  MyBook.Worksheets("PayRec").Activate
   StartRow = 3
  If Range("A3").Value = "" Then GoTo NoPaymentRec
   ActiveSheet.UsedRange.Select
   EndRow = ActiveSheet.UsedRange.Rows.Count
   Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 3
   If StartRow > EndRow Then GoTo NoPaymentRec
 End If
   Range(Cells(StartRow, 1), Cells(EndRow, 15)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("B1").Value <> "" Then
     Set CheckRange = ActiveSheet.UsedRange.Columns("B")
   Else
     GoTo NoPaymentRec
   End If
   ThisWorkbook.Worksheets("RunningDat").Activate
    Range("L1").Select
    Do While ActiveCell.Value <> ""
     PayDocNo = ActiveCell.Value
     AddAmt = ActiveCell.Offset(0, 1).Value
     If IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
        I = Application.Match(PayDocNo, CheckRange, 0)
        Worksheets("TempRP").Activate
        Cells(I, 11).Value = Format((Cells(I, 11).Value + AddAmt), "0.00")
     End If
     Worksheets("RunningDat").Activate
     ActiveCell.Offset(1, 0).Select
    Loop
NoPaymentRec:
  If StartRow < 4 Then GoTo NoPrepayment
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("B1") = "" Then
    LineNo = 1
    Set RecordRange = Range("B1")
  Else
   LineNo = ActiveSheet.UsedRange.Rows.Count + 1
   Set RecordRange = ActiveSheet.UsedRange.Columns("B")
  End If
  Cells(LineNo, 1).Select
  MyBook.Worksheets("Receivable").Activate
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
  ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.UsedRange.Delete
   Range("A1").Select
   MyBook.Worksheets("PayRec").Activate
   Range(Cells(3, 1), Cells(StartRow - 1, 15)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("Q1").Value = "A"
   ActiveSheet.UsedRange.Select
   Selection.Columns("Q").FormulaR1C1 = "=CONCATENATE(RC[-2],""A"")"
   Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Key2:=Range("N1"), Order2:=xlDescending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("O1").Select
  Do While ActiveCell.Value = "**"
   If ActiveCell.Offset(0, -1).Value > CloseDate Then
    If ActiveCell.Offset(0, -13).Value <= CloseDate Then
      PayDocNo = ActiveCell.Offset(0, -3).Value
      AddAmt = ActiveCell.Offset(0, -2).Value * (-1)
      If IsError(Application.Match(PayDocNo, RecordRange, 0)) = False Then
       I = Application.Match(PayDocNo, RecordRange, 0)
       ThisWorkbook.Worksheets("TempRP").Activate
       Cells(I, 11).Value = Format((Cells(I, 11).Value + AddAmt), "0.00")
       Cells(LineNo, 1).Select
      ElseIf IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
       I = Application.Match(PayDocNo, CheckRange, 0) + 3
       MyBook.Worksheets("Receivable").Activate
       Range(Cells(I, 1), Cells(I, 34)).Copy
       ThisWorkbook.Worksheets("TempRP").Activate
       ActiveSheet.Paste
       Application.CutCopyMode = False
       Cells(LineNo, 11).Value = Format(AddAmt, "0.00")
       LineNo = LineNo + 1
       Set RecordRange = ActiveSheet.UsedRange.Columns("B")
       Cells(LineNo, 1).Select
      End If
    End If
   Else
     Exit Do
   End If
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveCell.EntireRow.Delete
  Loop
NoPrepayment:
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("B1").Value = "" Then GoTo Finish
 Range("B1").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, -1).Value = "INVOICE" And Right(ActiveCell.Value, 1) <> " " Then
   ActiveCell.Value = "INV" & ActiveCell.Offset(0, 32).Value & ActiveCell.Value
  Else
   ActiveCell.Value = ActiveCell.Offset(0, 32).Value & ActiveCell.Value
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
ActiveSheet.UsedRange.Select
With Selection
  Columns("R:AH").Delete
  Columns("O").Delete
  Columns("L:M").Delete
  Columns("E:J").Delete
  Columns("C").Delete
  Columns("A").Delete
  Columns("C").Insert
  Columns("E").Copy
  Range("C1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("E").Delete
End With
 Range("A1").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 3).Value = 0 Then
    ActiveCell.EntireRow.Delete
  Else
    ActiveCell.Offset(1, 0).Select
  End If
 Loop
 If Range("A1").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
Selection.Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Application.CutCopyMode = False
 SumDue = 0
 SumC = 0
 Sum0 = 0
 Sum30 = 0
 Sum60 = 0
 Sum90 = 0
 TotalDue = 0
 TotalC = 0
 Total0 = 0
 Total30 = 0
 Total60 = 0
 Total90 = 0
 Range("E12").Select
 Do While ActiveCell.Value <> ""
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.Offset(3, 0).Select
  CustomerNo = ActiveCell.Value
  ActiveCell.Offset(-2, -4).NumberFormat = "@"
  ActiveCell.Offset(-2, -4).Value = ActiveCell.Offset(0, 1).Value & " ( # : " & CustomerNo & " )"
  Do While ActiveCell.Value = CustomerNo
    If CloseDate - ActiveCell.Offset(0, -2).Value > 90 Then
     ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, -1).Value
     Sum90 = Sum90 + ActiveCell.Offset(0, -1).Value
    ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 60 Then
     ActiveCell.Offset(0, 5).Value = ActiveCell.Offset(0, -1).Value
     Sum60 = Sum60 + ActiveCell.Offset(0, -1).Value
    ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 30 Then
     ActiveCell.Offset(0, 4).Value = ActiveCell.Offset(0, -1).Value
     Sum30 = Sum30 + ActiveCell.Offset(0, -1).Value
    ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 0 Then
     ActiveCell.Offset(0, 3).Value = ActiveCell.Offset(0, -1).Value
     Sum0 = Sum0 + ActiveCell.Offset(0, -1).Value
    Else
     ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, -1).Value
     SumC = SumC + ActiveCell.Offset(0, -1).Value
    End If
    ActiveCell.Offset(1, 0).Select
  Loop
  I = ActiveCell.Row
  SumDue = SumC + Sum0 + Sum30 + Sum60 + Sum90
  TotalDue = TotalDue + SumDue
  TotalC = TotalC + SumC
  Total0 = Total0 + Sum0
  Total30 = Total30 + Sum30
  Total60 = Total60 + Sum60
  Total90 = Total90 + Sum90
  ActiveCell.EntireRow.Insert
  Range(Cells(I - 1, 4), Cells(I - 1, 11)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
    End With
   Range(Cells(I, 1), Cells(I, 11)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Cells(I, 5).Select
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "Total : "
  ActiveCell.Offset(0, -1).Value = SumDue
  ActiveCell.Offset(0, 2).Value = SumC
  ActiveCell.Offset(0, 3).Value = Sum0
  ActiveCell.Offset(0, 4).Value = Sum30
  ActiveCell.Offset(0, 5).Value = Sum60
  ActiveCell.Offset(0, 6).Value = Sum90
  SumDue = 0
  SumC = 0
  Sum0 = 0
  Sum30 = 0
  Sum60 = 0
  Sum90 = 0
  ActiveCell.Offset(1, 0).Select
 Loop
   ActiveCell.Offset(1, 0).Select
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "GrandTotal : "
  ActiveCell.Offset(0, -1).Value = TotalDue
  ActiveCell.Offset(0, 2).Value = TotalC
  ActiveCell.Offset(0, 3).Value = Total0
  ActiveCell.Offset(0, 4).Value = Total30
  ActiveCell.Offset(0, 5).Value = Total60
  ActiveCell.Offset(0, 6).Value = Total90
Finish:
  ThisWorkbook.Worksheets("Report").Activate
  Columns("E:F").Delete
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("E6").Value = "Receivable Reconciliation as at " & Format(CloseDate, "yyyy/mm/dd")
    Range("A1:I18").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A13").Value = "" Then
   Range("A13").EntireRow.Delete
   Range("D13").Value = " No Data for Receivable Ledger. "
  End If
  LineNo = ActiveSheet.UsedRange.Rows.Count + 3
  RunCode = "ARPRec"
  Call BalanceNewB(RunCode)
  If RunCode = "Error" Then
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Balance Sheet").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   EventOff = False
   OldForm = ""
      MsgBox ("Error is found during processing of Reconciliation Report" & Chr(13) & Chr(13) & _
      "Data file may probably be lack of space for the report." & Chr(13) & _
      "Please proceed 'Year End Update' to remove old data for previous years")
   Exit Sub
  End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  Range("A1").Value = "**"
  Range("E1").Value = "**"
  Set CheckRange = ActiveSheet.UsedRange.Columns("B")
  If IsError(Application.Match(DebtorAcct, CheckRange, 0)) = False Then
    I = Application.Match(DebtorAcct, CheckRange, 0)
    AddAmt = Cells(I, 4).Value
  Else
   AddAmt = 0
  End If
  ThisWorkbook.Worksheets("Report").Activate
  Cells(LineNo, 3).HorizontalAlignment = xlRight
  Cells(LineNo + 1, 3).HorizontalAlignment = xlRight
  Cells(LineNo, 4).HorizontalAlignment = xlCenter
  Cells(LineNo + 1, 4).HorizontalAlignment = xlCenter
  Cells(LineNo, 3).Value = "G/L Book Value of Receivable Account # " & DebtorAcct & " : "
  Cells(LineNo + 1, 3).Value = "Difference : "
  Cells(LineNo, 4).NumberFormat = "#,##0.00"
  Cells(LineNo + 1, 4).NumberFormat = "#,##0.00"
  Cells(LineNo, 4).Value = Format(AddAmt, "#,##0.00")
  Cells(LineNo + 1, 4).Value = Format((TotalDue - AddAmt), "#,##0.00")
  EventOff = False
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
  ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  Unload UserForm34
  SheetName = "Report"
  OldForm = "UserForm8"
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
 ThisWorkbook.Worksheets("Report").Activate
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A3").Select
End Sub

Sub APRec(RunCode As String)
Dim I As Long, CustomerNo As String, SumDue As Double, SumC As Double, Sum0 As Double, Sum30 As Double
Dim Sum60 As Double, Sum90 As Double, TotalDue As Double, TotalC As Double, Total0 As Double, Total30 As Double
Dim Total60 As Double, Total90 As Double, CloseDate As Date, StartCustNo As String
Dim StartRow As Long, EndRow As Long, TestDate As Long, PayDocNo As String, AddAmt As Double, DelNo As String
Dim CheckRange As Range, RecordRange As Range, LineNo As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "ARREC" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.Delete
Range("A1").Select
UserForm34.Caption = "Payable Reconciliation Report as at Selected Date"
UserForm34.Label1.Caption = "Payable Reconciliation Report as at Selected Date"
UserForm34.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
  CloseDate = UserForm34.TextBox1.Text
 ThisWorkbook.Worksheets("Report").Activate
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "PO /DN #"
    Range("A11").Value = "---------------------"
    Range("B9").Value = "Goods Rec'd"
    Range("B10").Value = "Date"
    Range("B11").Value = "------------------"
    Range("C9").Value = "Supplier"
    Range("C10").Value = "Invoice #"
    Range("C11").Value = "-----------------------"
    Range("D10").Value = "Due Date"
    Range("D11").Value = "------------------"
    Range("E9").Value = "Amount Due"
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "-------------------"
    Range("H9").Value = "CURRENT"
    Range("H10").Value = "(" & SysCurrency & ")  "
    Range("H11").Value = "--------------------"
    Range("I9").Value = "0 - 30 Days"
    Range("I10").Value = "(" & SysCurrency & ")  "
    Range("I11").Value = "--------------------"
    Range("J9").Value = "31 - 60 Days"
    Range("J10").Value = "(" & SysCurrency & ")  "
    Range("J11").Value = "--------------------"
    Range("K9").Value = "61 - 90 Days"
    Range("K10").Value = "(" & SysCurrency & ")  "
    Range("K11").Value = "--------------------"
    Range("L9").Value = "Over 90 Days"
    Range("L10").Value = "(" & SysCurrency & ")  "
    Range("L11").Value = "--------------------"
    Columns("A:A").ColumnWidth = 16
    Columns("B:L").ColumnWidth = 13
    Columns("C:C").ColumnWidth = 18
    Columns("B").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("D").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("A:D").HorizontalAlignment = xlLeft
    Columns("E:L").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("B9:C10").HorizontalAlignment = xlCenter
    Range("H1:H7").HorizontalAlignment = xlCenter
    Range("H1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("H2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("H3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("H4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
   MyBook.Worksheets("Payable").Activate
  If Range("E4").Value = "" Then GoTo Finish
  Range("A1").Select
  StartRow = 4
  EndRow = ActiveSheet.UsedRange.Rows.Count
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("M")
  TestDate = CDate(CloseDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 4
   If StartRow > EndRow Then GoTo Finish
 End If
  Rows(StartRow & ":" & EndRow).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("D")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   EndRow = Application.Match(TestDate, CheckRange, 1) + StartRow - 1
   If StartRow > EndRow Then GoTo CheckPayment
 Else
   GoTo CheckPayment
 End If
  Range(Cells(StartRow, 2), Cells(EndRow, 23)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
CheckPayment:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
  MyBook.Worksheets("PayMake").Activate
   StartRow = 3
  If Range("A3").Value = "" Then GoTo NoPaymentRec
   ActiveSheet.UsedRange.Select
   EndRow = ActiveSheet.UsedRange.Rows.Count
   Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 3
   If StartRow > EndRow Then GoTo NoPaymentRec
 End If
   Range(Cells(StartRow, 1), Cells(EndRow, 16)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("B1").Value <> "" Then
     Set CheckRange = ActiveSheet.UsedRange.Columns("A")
   Else
     GoTo NoPaymentRec
   End If
   ThisWorkbook.Worksheets("RunningDat").Activate
    Range("K1").Select
    Do While ActiveCell.Value <> ""
     PayDocNo = ActiveCell.Value
     DelNo = ActiveCell.Offset(0, 1).Value
     AddAmt = ActiveCell.Offset(0, 3).Value
     If IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
       I = Application.Match(PayDocNo, CheckRange, 0)
       Worksheets("TempRP").Activate
       Cells(I, 1).Select
       Do While ActiveCell.Value = PayDocNo
        If ActiveCell.Offset(0, 1).Value = DelNo Then
          Cells(I, 10).Value = Format((Cells(I, 10).Value + AddAmt), "0.00")
          Exit Do
        End If
          ActiveCell.Offset(1, 0).Select
          I = I + 1
       Loop
     End If
     Worksheets("RunningDat").Activate
     ActiveCell.Offset(1, 0).Select
    Loop
NoPaymentRec:
  If StartRow < 4 Then GoTo NoPrepayment
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("B1") = "" Then
    LineNo = 1
    Set RecordRange = Range("A1")
  Else
   LineNo = ActiveSheet.UsedRange.Rows.Count + 1
   Set RecordRange = ActiveSheet.UsedRange.Columns("A")
  End If
  Cells(LineNo, 1).Select
  MyBook.Worksheets("Payable").Activate
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
  ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.UsedRange.Delete
   Range("A1").Select
   MyBook.Worksheets("PayMake").Activate
   Range(Cells(3, 1), Cells(StartRow - 1, 16)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("Q1").Value = "A"
   ActiveSheet.UsedRange.Select
   Selection.Columns("Q").FormulaR1C1 = "=CONCATENATE(RC[-1],""A"")"
   Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Key2:=Range("O1"), Order2:=xlDescending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("P1").Select
  Do While ActiveCell.Value = "**"
   If ActiveCell.Offset(0, -1).Value > CloseDate Then
    If ActiveCell.Offset(0, -14).Value <= CloseDate Then
      PayDocNo = ActiveCell.Offset(0, -5).Value
      DelNo = ActiveCell.Offset(0, -4).Value
      AddAmt = ActiveCell.Offset(0, -2).Value * (-1)
      If IsError(Application.Match(PayDocNo, RecordRange, 0)) = False Then
       I = Application.Match(PayDocNo, RecordRange, 0)
       ThisWorkbook.Worksheets("TempRP").Activate
       Cells(I, 1).Select
       Do While ActiveCell.Value = PayDocNo
        If ActiveCell.Offset(0, 1).Value = DelNo Then
         Cells(I, 10).Value = Format((Cells(I, 10).Value + AddAmt), "0.00")
         Cells(LineNo, 1).Select
         GoTo NextItem
        End If
        I = I + 1
        ActiveCell.Offset(1, 0).Select
       Loop
       If IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
        I = Application.Match(PayDocNo, CheckRange, 0) + 3
        MyBook.Worksheets("Payable").Activate
        Cells(I, 2).Select
        Do While ActiveCell.Value = PayDocNo
         If ActiveCell.Offset(0, 1).Value = DelNo Then
          Range(Cells(I, 2), Cells(I, 23)).Copy
          ThisWorkbook.Worksheets("TempRP").Activate
          ActiveSheet.Paste
          Application.CutCopyMode = False
          Cells(LineNo, 10).Value = Format(AddAmt, "0.00")
          LineNo = LineNo + 1
          Cells(LineNo, 1).Select
          Set RecordRange = ActiveSheet.UsedRange.Columns("A")
          GoTo NextItem
         End If
         I = I + 1
         ActiveCell.Offset(1, 0).Select
        Loop
       End If
      ElseIf IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
       I = Application.Match(PayDocNo, CheckRange, 0) + 3
       MyBook.Worksheets("Payable").Activate
        Cells(I, 2).Select
        Do While ActiveCell.Value = PayDocNo
         If ActiveCell.Offset(0, 1).Value = DelNo Then
          Range(Cells(I, 2), Cells(I, 23)).Copy
          ThisWorkbook.Worksheets("TempRP").Activate
          ActiveSheet.Paste
          Application.CutCopyMode = False
          Cells(LineNo, 10).Value = Format(AddAmt, "0.00")
          LineNo = LineNo + 1
          Cells(LineNo, 1).Select
          Set RecordRange = ActiveSheet.UsedRange.Columns("A")
          GoTo NextItem
         End If
         I = I + 1
         ActiveCell.Offset(1, 0).Select
        Loop
      End If
    End If
   Else
     Exit Do
   End If
NextItem:
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveCell.EntireRow.Delete
  Loop
NoPrepayment:
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("A1").Value = "" Then GoTo Finish
ActiveSheet.UsedRange.Select
  Columns("V").Cut
  Range("D1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("M").Cut
  Range("E1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("J").Cut
  Range("F1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("O:P").Cut
  Range("G1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("I:V").Delete
  Columns("B").Delete
 Range("A1").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 4).Value = 0 Then
    ActiveCell.EntireRow.Delete
  Else
    ActiveCell.Offset(1, 0).Select
  End If
 Loop
 If Range("A1").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("F1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
Selection.Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Application.CutCopyMode = False
 SumDue = 0
 SumC = 0
 Sum0 = 0
 Sum30 = 0
 Sum60 = 0
 Sum90 = 0
 TotalDue = 0
 TotalC = 0
 Total0 = 0
 Total30 = 0
 Total60 = 0
 Total90 = 0
 Range("F12").Select
 Do While ActiveCell.Value <> ""
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.Offset(3, 0).Select
  SuppCode = ActiveCell.Value
  ActiveCell.Offset(-2, -5).NumberFormat = "@"
  ActiveCell.Offset(-2, -5).Value = ActiveCell.Offset(0, 1).Value & " ( # : " & SuppCode & " )"
  Do While ActiveCell.Value = SuppCode
    If CloseDate - ActiveCell.Offset(0, -2).Value > 90 Then
     ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, -1).Value
     Sum90 = Sum90 + ActiveCell.Offset(0, -1).Value
    ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 60 Then
     ActiveCell.Offset(0, 5).Value = ActiveCell.Offset(0, -1).Value
     Sum60 = Sum60 + ActiveCell.Offset(0, -1).Value
    ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 30 Then
     ActiveCell.Offset(0, 4).Value = ActiveCell.Offset(0, -1).Value
     Sum30 = Sum30 + ActiveCell.Offset(0, -1).Value
    ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 0 Then
     ActiveCell.Offset(0, 3).Value = ActiveCell.Offset(0, -1).Value
     Sum0 = Sum0 + ActiveCell.Offset(0, -1).Value
    Else
     ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, -1).Value
     SumC = SumC + ActiveCell.Offset(0, -1).Value
    End If
    ActiveCell.Offset(1, 0).Select
  Loop
  I = ActiveCell.Row
  SumDue = SumC + Sum0 + Sum30 + Sum60 + Sum90
  TotalDue = TotalDue + SumDue
  TotalC = TotalC + SumC
  Total0 = Total0 + Sum0
  Total30 = Total30 + Sum30
  Total60 = Total60 + Sum60
  Total90 = Total90 + Sum90
  ActiveCell.EntireRow.Insert
  Range(Cells(I - 1, 5), Cells(I - 1, 12)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
    End With
   Range(Cells(I, 1), Cells(I, 12)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Cells(I, 6).Select
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "Total : "
  ActiveCell.Offset(0, -1).Value = SumDue
  ActiveCell.Offset(0, 2).Value = SumC
  ActiveCell.Offset(0, 3).Value = Sum0
  ActiveCell.Offset(0, 4).Value = Sum30
  ActiveCell.Offset(0, 5).Value = Sum60
  ActiveCell.Offset(0, 6).Value = Sum90
  SumDue = 0
  SumC = 0
  Sum0 = 0
  Sum30 = 0
  Sum60 = 0
  Sum90 = 0
  ActiveCell.Offset(1, 0).Select
 Loop
   ActiveCell.Offset(1, 0).Select
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "GrandTotal : "
  ActiveCell.Offset(0, -1).Value = TotalDue
  ActiveCell.Offset(0, 2).Value = TotalC
  ActiveCell.Offset(0, 3).Value = Total0
  ActiveCell.Offset(0, 4).Value = Total30
  ActiveCell.Offset(0, 5).Value = Total60
  ActiveCell.Offset(0, 6).Value = Total90
Finish:
  ThisWorkbook.Worksheets("Report").Activate
  Columns("F:G").Delete
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("F6").Value = "Payable Reconciliation Report as at " & Format(CloseDate, "yyyy/mm/dd")
    Range("A1:J18").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A13").Value = "" Then
   Range("A13").EntireRow.Delete
   Range("D13").Value = " No Data for Payable Ledger. "
  End If
 LineNo = ActiveSheet.UsedRange.Rows.Count + 3
  RunCode = "ARPRec"
  Call BalanceNewB(RunCode)
  If RunCode = "Error" Then
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   EventOff = False
   OldForm = ""
      MsgBox ("Error is found during processing of Reconciliation Report" & Chr(13) & Chr(13) & _
      "Data file may probably be lack of space for the report." & Chr(13) & _
      "Please proceed 'Year End Update' to remove old data for previous years")
   Exit Sub
  End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  Range("A1").Value = "**"
  Range("E1").Value = "**"
  Set CheckRange = ActiveSheet.UsedRange.Columns("B")
  If IsError(Application.Match(CreditorAcct, CheckRange, 0)) = False Then
    I = Application.Match(CreditorAcct, CheckRange, 0)
    AddAmt = Cells(I, 4).Value
  Else
   AddAmt = 0
  End If
  ThisWorkbook.Worksheets("Report").Activate
  Cells(LineNo, 4).HorizontalAlignment = xlRight
  Cells(LineNo + 1, 4).HorizontalAlignment = xlRight
  Cells(LineNo, 5).HorizontalAlignment = xlCenter
  Cells(LineNo + 1, 5).HorizontalAlignment = xlCenter
  Cells(LineNo, 4).Value = "G/L Book Value of Payable Account # " & CreditorAcct & " : "
  Cells(LineNo + 1, 4).Value = "Difference : "
  Cells(LineNo, 5).NumberFormat = "#,##0.00"
  Cells(LineNo + 1, 5).NumberFormat = "#,##0.00"
  Cells(LineNo, 5).Value = Format(AddAmt, "#,##0.00")
  Cells(LineNo + 1, 5).Value = Format((TotalDue - AddAmt), "#,##0.00")
  EventOff = False
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
  ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
   On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  Unload UserForm34
  SheetName = "Report"
  OldForm = "UserForm8"
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 ThisWorkbook.Worksheets("Report").Activate
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A3").Select
End Sub









Sub CustLedger(RunCode As String)
Dim I As Long, CustomerNo As String, StartDate As Date, EndDate As Date, CloseDate As Date
Dim LineA As Long, LineB As Long, CheckRange As Range, RecordRange As Range
Dim StartRow As Long, EndRow As Long, TestDate As Long, PayDocNo As String, AddAmt As Double, LineNo As Long
Dim CurBalance As Currency, BalanceC As Currency, BalanceD As Currency, TotalD As Currency, TotalC As Currency
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.Delete
Range("A1").Select
  StartDate = UserForm16.TextBox1.Text
  EndDate = UserForm16.TextBox2.Text
  CloseDate = StartDate - 1
  On Error GoTo ErrorHandling
 ThisWorkbook.Worksheets("Report").Activate
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "Date"
    Range("A11").Value = "----------------------"
    Range("B10").Value = "Description"
    Range("B11").Value = "-----------------------------------------------------------------"
    Range("C9").Value = "Debit  "
    Range("C10").Value = "(" & SysCurrency & ")  "
    Range("C11").Value = "------------------"
    Range("D9").Value = "Credit  "
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-------------------"
    Range("E9").Value = "Balance  "
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "-------------------"
    Columns("A:A").ColumnWidth = 21
    Columns("B:B").ColumnWidth = 45
    Columns("C:D").ColumnWidth = 18
    Columns("E:E").ColumnWidth = 21
    Range("A12").Select
   MyBook.Worksheets("Receivable").Activate
  If Range("E4").Value = "" Then GoTo NoInvoice
  Range("A4").Select
  StartRow = 4
  EndRow = ActiveSheet.UsedRange.Rows.Count
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("M")
  TestDate = CDate(CloseDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 4
   If StartRow > EndRow Then GoTo NoPaymentRec
 End If
  Rows(StartRow & ":" & EndRow).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("D")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   EndRow = Application.Match(TestDate, CheckRange, 1) + StartRow - 1
   If StartRow > EndRow Then GoTo CheckPayment
 Else
   GoTo CheckPayment
 End If
   Range(Cells(StartRow, 1), Cells(EndRow, 34)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
CheckPayment:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
  MyBook.Worksheets("PayRec").Activate
   StartRow = 3
  If Range("A3").Value = "" Then GoTo NoPaymentRec
   ActiveSheet.UsedRange.Select
   EndRow = ActiveSheet.UsedRange.Rows.Count
   Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 3
   If StartRow > EndRow Then GoTo NoPaymentRec
 End If
   Range(Cells(StartRow, 1), Cells(EndRow, 15)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("B1").Value <> "" Then
     Set CheckRange = ActiveSheet.UsedRange.Columns("B")
   Else
     GoTo NoPaymentRec
   End If
   ThisWorkbook.Worksheets("RunningDat").Activate
    Range("L1").Select
    Do While ActiveCell.Value <> ""
     PayDocNo = ActiveCell.Value
     AddAmt = ActiveCell.Offset(0, 1).Value
     If IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
        I = Application.Match(PayDocNo, CheckRange, 0)
        Worksheets("TempRP").Activate
        Cells(I, 11).Value = Format((Cells(I, 11).Value + AddAmt), "0.00")
     End If
     Worksheets("RunningDat").Activate
     ActiveCell.Offset(1, 0).Select
    Loop
NoPaymentRec:
  If StartRow < 4 Then GoTo NoPrepayment
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("B1") = "" Then
    LineNo = 1
    Set RecordRange = Range("B1")
  Else
   LineNo = ActiveSheet.UsedRange.Rows.Count + 1
   Set RecordRange = ActiveSheet.UsedRange.Columns("B")
  End If
  Cells(LineNo, 1).Select
  MyBook.Worksheets("Receivable").Activate
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
  ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.UsedRange.Delete
   Range("A1").Select
   MyBook.Worksheets("PayRec").Activate
   Range(Cells(3, 1), Cells(StartRow - 1, 15)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("Q1").Value = "A"
   ActiveSheet.UsedRange.Select
   Selection.Columns("Q").FormulaR1C1 = "=CONCATENATE(RC[-2],""A"")"
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Key2:=Range("N1"), Order2:=xlDescending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("O1").Select
  Do While ActiveCell.Value = "**"
   If ActiveCell.Offset(0, -1).Value > CloseDate Then
    If ActiveCell.Offset(0, -13).Value <= CloseDate Then
      PayDocNo = ActiveCell.Offset(0, -3).Value
      AddAmt = ActiveCell.Offset(0, -2).Value * (-1)
      If IsError(Application.Match(PayDocNo, RecordRange, 0)) = False Then
       I = Application.Match(PayDocNo, RecordRange, 0)
       ThisWorkbook.Worksheets("TempRP").Activate
       Cells(I, 11).Value = Format((Cells(I, 11).Value + AddAmt), "0.00")
       Cells(LineNo, 1).Select
      ElseIf IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
       I = Application.Match(PayDocNo, CheckRange, 0) + 3
       MyBook.Worksheets("Receivable").Activate
       Range(Cells(I, 1), Cells(I, 34)).Copy
       ThisWorkbook.Worksheets("TempRP").Activate
       ActiveSheet.Paste
       Application.CutCopyMode = False
       Cells(LineNo, 11).Value = Format(AddAmt, "0.00")
       LineNo = LineNo + 1
       Set RecordRange = ActiveSheet.UsedRange.Columns("B")
       Cells(LineNo, 1).Select
      End If
    End If
   Else
     Exit Do
   End If
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveCell.EntireRow.Delete
  Loop
NoPrepayment:
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("B1").Value = "" Then GoTo AddTransaction
    ActiveSheet.UsedRange.Select
    Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Selection.Columns("G").Value = "BEGINNING BALANCE"
   Range("P1").Select
   Do While ActiveCell.Value <> ""
     CustomerNo = ActiveCell.Value
     LineA = ActiveCell.Row
     AddAmt = ActiveCell.Offset(0, -5).Value
     Do While ActiveCell.Offset(1, 0).Value = CustomerNo
      AddAmt = ActiveCell.Offset(1, -5).Value + AddAmt
      ActiveCell.Offset(1, 0).Select
     Loop
     LineB = ActiveCell.Row
     Cells(LineA, 8).Value = Format(AddAmt, "0.00")
     Cells(LineA, 4).Value = Format(CloseDate, "yyyy/mm/dd")
     If LineB > LineA Then Range(Cells(LineA + 1, 1), Cells(LineB, 1)).EntireRow.Delete
     Cells(LineA + 1, 16).Select
   Loop
AddTransaction:
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("A1").Value = "" Then
    Range("A1").Select
  ElseIf Range("A2").Value = "" Then
    Range("A2").Select
  Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
  End If
 MyBook.Worksheets("Receivable").Activate
  If Range("E4").Value = "" Then GoTo NoTransaction
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("D")
  StartRow = 4
  EndRow = 3
  TestDate = CDate(StartDate - 1)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then StartRow = Application.Match(TestDate, CheckRange, 1) + 4
 TestDate = CDate(EndDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then EndRow = Application.Match(TestDate, CheckRange, 1) + 3
 If StartRow > EndRow Then GoTo NoTransaction
  Range(Cells(StartRow, 1), Cells(EndRow, 34)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   LineA = ActiveCell.Row
   ActiveSheet.Paste
   Application.CutCopyMode = False
   LineB = ActiveSheet.UsedRange.Rows.Count
   Range(Cells(LineA, 32), Cells(LineB, 32)).Copy
   Cells(LineA, 8).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
NoTransaction:
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.UsedRange.Select
 With Selection
  Columns("R:AH").Delete
  Columns("K:O").Delete
  Columns("I:J").ClearContents
  Columns("E:F").Delete
  Columns("A:C").Delete
 End With
  Range("A1").Select
 Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 2).Value < 0 Then
    ActiveCell.Offset(0, 3).Value = Format(ActiveCell.Offset(0, 2).Value * (-1), "0.00")
    ActiveCell.Offset(0, 2).ClearContents
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
NoInvoice:
 ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
   MyBook.Worksheets("PayRec").Activate
   StartRow = 3
   EndRow = 2
  If Range("A3").Value = "" Then GoTo DataOK
   ActiveSheet.UsedRange.Select
   Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
 TestDate = CDate(StartDate - 1)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then StartRow = Application.Match(TestDate, CheckRange, 1) + 3
 TestDate = CDate(EndDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then EndRow = Application.Match(TestDate, CheckRange, 1) + 2
 If StartRow > EndRow Then GoTo DataOK
  Range(Cells(StartRow, 1), Cells(EndRow, 14)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   With Selection
    .Columns("C:F").EntireColumn.Insert
    .Columns("C:F").NumberFormat = "#,##0.00"
   End With
 Range("A1").Select
 Do While ActiveCell.Value <> ""
   PayDocNo = ActiveCell.Value
   If ActiveCell.Offset(0, 8).Value < 0 Then
    ActiveCell.Offset(0, 3).Value = Format(ActiveCell.Offset(0, 8).Value * (-1), "0.00")
    ActiveCell.Offset(0, 4).ClearContents
    ActiveCell.Offset(0, 2).Value = "# " & ActiveCell.Value & "-Refund to Customer "
   Else
    ActiveCell.Offset(0, 4).Value = Format(ActiveCell.Offset(0, 8).Value, "0.00")
    ActiveCell.Offset(0, 3).ClearContents
    ActiveCell.Offset(0, 2).Value = "# " & ActiveCell.Value & "-Payment from Customer "
   End If
   Do While ActiveCell.Offset(1, 0).Value = PayDocNo
    ActiveCell.Offset(1, 0).EntireRow.Delete
   Loop
   If ActiveCell.Offset(0, 8).Value = 0 Then
     ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
 Loop
 ActiveSheet.UsedRange.Select
 With Selection
  .Columns("I:S").Delete
  .Columns("A").Delete
 End With
 ThisWorkbook.Worksheets("TempRP").Activate
  If Range("A1").Value = "" Then
    Range("A1").Select
  ElseIf Range("A2").Value = "" Then
    Range("A2").Select
  Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
  End If
 ThisWorkbook.Worksheets("RunningDat").Activate
 If Range("A1") = "" Then GoTo DataOK
  ActiveSheet.UsedRange.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
DataOK:
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("A1") = "" Then GoTo Finish
   ActiveSheet.UsedRange.Select
 ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("F1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
If RunCode <> "CustLedger" Then
 Set CheckRange = Selection.Columns("F")
 If IsError(Application.Match(RunCode, CheckRange, 0)) = False Then
   StartRow = Application.Match(RunCode, CheckRange, 0)
   EndRow = Application.Match(RunCode, CheckRange, 1)
   Selection.Rows(StartRow & ":" & EndRow).Select
 Else
   GoTo Finish
 End If
End If
 Selection.Copy
 ThisWorkbook.Worksheets("Report").Activate
 ActiveSheet.Paste
 Application.CutCopyMode = False
Finish:
  ThisWorkbook.Worksheets("Report").Activate
    Columns("A").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
      End With
    Columns("B").HorizontalAlignment = xlLeft
    Columns("C:E").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("B1:D7").HorizontalAlignment = xlCenterAcrossSelection
    Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("B2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("B3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("B4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    If RunCode <> "CustLedger" Then
     Range("B6").Value = "Ledger Detail Report for"
     Range("B7").Value = "Customer : " & UserForm16.Label16.Caption & "  (#" & RunCode & ")"
    Else
     Range("B6").Value = "Customer Ledger Detail Report"
    End If
    Range("A1:A7").HorizontalAlignment = xlLeft
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "    To : " & Format(EndDate, "yyyy/mm/dd")
 TotalC = 0
 TotalD = 0
 Range("A12").Select
If ActiveCell.Value <> "" Then
  MyBook.Worksheets("Customer Data").Activate
  ActiveSheet.UsedRange.Select
  Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
  Set CheckRange = Selection.Columns("B")
  ThisWorkbook.Worksheets("Report").Activate
 Do While ActiveCell <> ""
  ActiveCell.EntireRow.Insert
  ActiveCell.Offset(1, 0).Select
  CustomerNo = ActiveCell.Offset(0, 5).Value
  If IsError(Application.Match(CustomerNo, CheckRange, 0)) = False Then
     I = Application.Match(CustomerNo, CheckRange, 0) + 2
     CustName = MyBook.Worksheets("Customer Data").Cells(I, 3).Value
  Else
    CustName = ActiveCell.Offset(0, 6).Value
  End If
   ActiveCell.Offset(-1, 0).HorizontalAlignment = xlLeft
   ActiveCell.Offset(-1, 0).IndentLevel = 1
   ActiveCell.Offset(-1, 0).Value = CustName & " (" & CustomerNo & ")"
  LineA = ActiveCell.Row
  If Cells(LineA, 2).Value <> "BEGINNING BALANCE" Then
   Cells(LineA, 2).EntireRow.Insert
   Cells(LineA, 2).HorizontalAlignment = xlRight
   Cells(LineA, 2).Value = "BEGINNING BALANCE"
   Cells(LineA, 3).Value = "0.00"
   ActiveCell.Offset(1, 0).Select
  Else
   Cells(LineA, 1).ClearContents
   Cells(LineA, 2).HorizontalAlignment = xlRight
  End If
   Do While ActiveCell.Offset(0, 5).Value = CustomerNo
     ActiveCell.Offset(5, 0).Select
   Loop
  If ActiveCell.Row > LineA + 4 Then
    ActiveCell.Offset(-4, 0).Select
   Do While ActiveCell.Offset(0, 5).Value = CustomerNo
     ActiveCell.Offset(1, 0).Select
   Loop
  End If
    LineB = ActiveCell.Row - 1
    Range(ActiveCell, ActiveCell.Offset(2, 0)).EntireRow.Insert
    BalanceD = Application.Sum(Range(Cells(LineA, 3), Cells(LineB, 3)))
    BalanceC = Application.Sum(Range(Cells(LineA, 4), Cells(LineB, 4)))
    CurBalance = (BalanceD - BalanceC)
    Cells(LineB + 1, 3).Value = BalanceD - Cells(LineA, 3).Value
    Cells(LineB + 1, 4).Value = BalanceC - Cells(LineA, 4).Value
     Cells(LineB + 1, 5).Value = CurBalance
    Cells(LineB + 1, 2).HorizontalAlignment = xlRight
    Cells(LineB + 1, 2).Value = "CURRENT TRANSACTION"
    TotalD = TotalD + BalanceD - Cells(LineA, 3).Value
    TotalC = TotalC + BalanceC - Cells(LineA, 4).Value
    Cells(LineB + 4, 1).Select
 Loop
   If RunCode = "CustLedger" Then
    ActiveCell.Offset(0, 1).HorizontalAlignment = xlRight
    ActiveCell.Offset(0, 1).Value = "TOTAL TRANSACTION"
    ActiveCell.Offset(0, 2).Value = TotalD
    ActiveCell.Offset(0, 3).Value = TotalC
   End If
Else
  Range("B13").Value = "No Reported Data for the selected Range"
End If
    Columns("F:G").Delete
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A1:E25").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
   Application.EnableEvents = False
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  Unload UserForm16
  SheetName = "Report"
  OldForm = "UserForm8"
 ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
 Application.EnableEvents = True
   EventOff = False
 ThisWorkbook.Worksheets("Report").Activate
 Range("A1").Select
 Range("A3").Select
 Exit Sub
ErrorHandling:
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Activity Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of the Ledger Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub SuppLedger(RunCode As String)
Dim I As Long, CustomerNo As String, StartDate As Date, EndDate As Date, CloseDate As Date
Dim LineA As Long, LineB As Long, CheckRange As Range, RecordRange As Range, DelNo As String
Dim StartRow As Long, EndRow As Long, TestDate As Long, PayDocNo As String, AddAmt As Double, LineNo As Long
Dim CurBalance As Currency, BalanceC As Currency, BalanceD As Currency, TotalD As Currency, TotalC As Currency
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.Delete
Range("A1").Select
  StartDate = UserForm23.TextBox1.Text
  EndDate = UserForm23.TextBox2.Text
  CloseDate = StartDate - 1
  On Error GoTo ErrorHandling
 ThisWorkbook.Worksheets("Report").Activate
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "Date"
    Range("A11").Value = "----------------------"
    Range("B10").Value = "Description"
    Range("B11").Value = "-----------------------------------------------------------------"
    Range("C9").Value = "Debit  "
    Range("C10").Value = "(" & SysCurrency & ")  "
    Range("C11").Value = "------------------"
    Range("D9").Value = "Credit  "
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-------------------"
    Range("E9").Value = "Balance  "
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "-------------------"
    Columns("A:A").ColumnWidth = 21
    Columns("B:B").ColumnWidth = 45
    Columns("C:D").ColumnWidth = 18
    Columns("E:E").ColumnWidth = 21
    Range("A12").Select
   MyBook.Worksheets("Payable").Activate
  If Range("B4").Value = "" Then GoTo NoInvoice
   Range("A4").Select
  StartRow = 4
  EndRow = ActiveSheet.UsedRange.Rows.Count
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("M")
  TestDate = CDate(CloseDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 4
   If StartRow > EndRow Then GoTo NoPaymentRec
 End If
  Rows(StartRow & ":" & EndRow).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("D")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   EndRow = Application.Match(TestDate, CheckRange, 1) + StartRow - 1
   If StartRow > EndRow Then GoTo CheckPayment
 Else
   GoTo CheckPayment
 End If
  Range(Cells(StartRow, 2), Cells(EndRow, 23)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
CheckPayment:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
  MyBook.Worksheets("PayMake").Activate
   StartRow = 3
  If Range("A3").Value = "" Then GoTo NoPaymentRec
   ActiveSheet.UsedRange.Select
   EndRow = ActiveSheet.UsedRange.Rows.Count
   Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then
   StartRow = Application.Match(TestDate, CheckRange, 1) + 3
   If StartRow > EndRow Then GoTo NoPaymentRec
 End If
   Range(Cells(StartRow, 1), Cells(EndRow, 16)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("B1").Value <> "" Then
     Set CheckRange = ActiveSheet.UsedRange.Columns("A")
   Else
     GoTo NoPaymentRec
   End If
   ThisWorkbook.Worksheets("RunningDat").Activate
    Range("K1").Select
    Do While ActiveCell.Value <> ""
     PayDocNo = ActiveCell.Value
     DelNo = ActiveCell.Offset(0, 1).Value
     AddAmt = ActiveCell.Offset(0, 3).Value
     If IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
       I = Application.Match(PayDocNo, CheckRange, 0)
       Worksheets("TempRP").Activate
       Cells(I, 1).Select
       Do While ActiveCell.Value = PayDocNo
        If ActiveCell.Offset(0, 1).Value = DelNo Then
          Cells(I, 10).Value = Format((Cells(I, 10).Value + AddAmt), "0.00")
          Exit Do
        End If
          ActiveCell.Offset(1, 0).Select
          I = I + 1
       Loop
     End If
     Worksheets("RunningDat").Activate
     ActiveCell.Offset(1, 0).Select
    Loop
NoPaymentRec:
  If StartRow < 4 Then GoTo NoPrepayment
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("B1") = "" Then
    LineNo = 1
    Set RecordRange = Range("A1")
  Else
   LineNo = ActiveSheet.UsedRange.Rows.Count + 1
   Set RecordRange = ActiveSheet.UsedRange.Columns("A")
  End If
  Cells(LineNo, 1).Select
  MyBook.Worksheets("Payable").Activate
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
  ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.UsedRange.Delete
   Range("A1").Select
   MyBook.Worksheets("PayMake").Activate
   Range(Cells(3, 1), Cells(StartRow - 1, 16)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("Q1").Value = "A"
   ActiveSheet.UsedRange.Select
   Selection.Columns("Q").FormulaR1C1 = "=CONCATENATE(RC[-1],""A"")"
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Key2:=Range("O1"), Order2:=xlDescending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("P1").Select
  Do While ActiveCell.Value = "**"
   If ActiveCell.Offset(0, -1).Value > CloseDate Then
    If ActiveCell.Offset(0, -14).Value <= CloseDate Then
      PayDocNo = ActiveCell.Offset(0, -5).Value
      DelNo = ActiveCell.Offset(0, -4).Value
      AddAmt = ActiveCell.Offset(0, -2).Value * (-1)
      If IsError(Application.Match(PayDocNo, RecordRange, 0)) = False Then
       I = Application.Match(PayDocNo, RecordRange, 0)
       ThisWorkbook.Worksheets("TempRP").Activate
       Cells(I, 1).Select
       Do While ActiveCell.Value = PayDocNo
        If ActiveCell.Offset(0, 1).Value = DelNo Then
         Cells(I, 10).Value = Format((Cells(I, 10).Value + AddAmt), "0.00")
         Cells(LineNo, 1).Select
         GoTo NextItem
        End If
        I = I + 1
        ActiveCell.Offset(1, 0).Select
       Loop
       If IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
        I = Application.Match(PayDocNo, CheckRange, 0) + 3
        MyBook.Worksheets("Payable").Activate
        Cells(I, 2).Select
        Do While ActiveCell.Value = PayDocNo
         If ActiveCell.Offset(0, 1).Value = DelNo Then
          Range(Cells(I, 2), Cells(I, 23)).Copy
          ThisWorkbook.Worksheets("TempRP").Activate
          ActiveSheet.Paste
          Application.CutCopyMode = False
          Cells(LineNo, 10).Value = Format(AddAmt, "0.00")
          LineNo = LineNo + 1
          Cells(LineNo, 1).Select
          Set RecordRange = ActiveSheet.UsedRange.Columns("A")
          GoTo NextItem
         End If
         I = I + 1
         ActiveCell.Offset(1, 0).Select
        Loop
       End If
      ElseIf IsError(Application.Match(PayDocNo, CheckRange, 0)) = False Then
       I = Application.Match(PayDocNo, CheckRange, 0) + 3
       MyBook.Worksheets("Payable").Activate
        Cells(I, 2).Select
        Do While ActiveCell.Value = PayDocNo
         If ActiveCell.Offset(0, 1).Value = DelNo Then
          Range(Cells(I, 2), Cells(I, 23)).Copy
          ThisWorkbook.Worksheets("TempRP").Activate
          ActiveSheet.Paste
          Application.CutCopyMode = False
          Cells(LineNo, 10).Value = Format(AddAmt, "0.00")
          LineNo = LineNo + 1
          Cells(LineNo, 1).Select
          Set RecordRange = ActiveSheet.UsedRange.Columns("A")
          GoTo NextItem
         End If
         I = I + 1
         ActiveCell.Offset(1, 0).Select
        Loop
      End If
    End If
   Else
     Exit Do
   End If
NextItem:
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveCell.EntireRow.Delete
  Loop
NoPrepayment:
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("A1").Value = "" Then GoTo AddTransaction
    ActiveSheet.UsedRange.Select
    Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Selection.Columns("F").Value = "BEGINNING BALANCE"
   Range("O1").Select
   Do While ActiveCell.Value <> ""
     CustomerNo = ActiveCell.Value
     LineA = ActiveCell.Row
     AddAmt = ActiveCell.Offset(0, -5).Value
     Do While ActiveCell.Offset(1, 0).Value = CustomerNo
      AddAmt = ActiveCell.Offset(1, -5).Value + AddAmt
      ActiveCell.Offset(1, 0).Select
     Loop
     LineB = ActiveCell.Row
     Cells(LineA, 8).Value = Format(AddAmt, "0.00")
     Cells(LineA, 3).Value = Format(CloseDate, "yyyy/mm/dd")
     If LineB > LineA Then Range(Cells(LineA + 1, 1), Cells(LineB, 1)).EntireRow.Delete
     Cells(LineA + 1, 15).Select
   Loop
AddTransaction:
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("A1").Value = "" Then
    Range("A1").Select
  ElseIf Range("A2").Value = "" Then
    Range("A2").Select
  Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
  End If
   MyBook.Worksheets("Payable").Activate
  If Range("E4").Value = "" Then GoTo NoTransaction
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("D")
  StartRow = 4
  EndRow = 3
  TestDate = CDate(StartDate - 1)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then StartRow = Application.Match(TestDate, CheckRange, 1) + 4
 TestDate = CDate(EndDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then EndRow = Application.Match(TestDate, CheckRange, 1) + 3
 If StartRow > EndRow Then GoTo NoTransaction
  Range(Cells(StartRow, 2), Cells(EndRow, 23)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   LineA = ActiveCell.Row
   ActiveSheet.Paste
   Application.CutCopyMode = False
   LineB = ActiveSheet.UsedRange.Rows.Count
   Range(Cells(LineA, 11), Cells(LineB, 11)).Copy
   Cells(LineA, 8).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
NoTransaction:
ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.UsedRange.Select
 With Selection
  .Columns("Q:V").Delete
  .Columns("J:N").Delete
  .Columns("I").ClearContents
  .Columns("G").ClearContents
  .Columns("D:E").Delete
  .Columns("A:B").Delete
 End With
  Range("A1").Select
 Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 3).Value < 0 Then
    ActiveCell.Offset(0, 2).Value = Format(ActiveCell.Offset(0, 3).Value * (-1), "0.00")
    ActiveCell.Offset(0, 3).ClearContents
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
NoInvoice:
 ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("A1").Select
  MyBook.Worksheets("PayMake").Activate
   StartRow = 3
   EndRow = 2
  If Range("A3").Value = "" Then GoTo DataOK
   ActiveSheet.UsedRange.Select
   Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
 TestDate = CDate(StartDate - 1)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then StartRow = Application.Match(TestDate, CheckRange, 1) + 3
 TestDate = CDate(EndDate)
 If IsError(Application.Match(TestDate, CheckRange, 1)) = False Then EndRow = Application.Match(TestDate, CheckRange, 1) + 2
 If StartRow > EndRow Then GoTo DataOK
  Range(Cells(StartRow, 1), Cells(EndRow, 14)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   With Selection
    .Columns("C:F").EntireColumn.Insert
    .Columns("C:F").NumberFormat = "#,##0.00"
   End With
 Range("A1").Select
 Do While ActiveCell.Value <> ""
   PayDocNo = ActiveCell.Value
   If ActiveCell.Offset(0, 8).Value < 0 Then
    ActiveCell.Offset(0, 4).Value = Format(ActiveCell.Offset(0, 8).Value * (-1), "0.00")
    ActiveCell.Offset(0, 3).ClearContents
    ActiveCell.Offset(0, 2).Value = "# " & ActiveCell.Value & "-Reverse Payment "
   Else
    ActiveCell.Offset(0, 3).Value = Format(ActiveCell.Offset(0, 8).Value, "0.00")
    ActiveCell.Offset(0, 4).ClearContents
    ActiveCell.Offset(0, 2).Value = "# " & ActiveCell.Value & "-Payment to Supplier "
   End If
   Do While ActiveCell.Offset(1, 0).Value = PayDocNo
    ActiveCell.Offset(1, 0).EntireRow.Delete
   Loop
   If ActiveCell.Offset(0, 8).Value = 0 Then
     ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
 Loop
 ActiveSheet.UsedRange.Select
 With Selection
  .Columns("I:S").Delete
  .Columns("A").Delete
 End With
 ThisWorkbook.Worksheets("TempRP").Activate
  If Range("A1").Value = "" Then
    Range("A1").Select
  ElseIf Range("A2").Value = "" Then
    Range("A2").Select
  Else
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
  End If
 ThisWorkbook.Worksheets("RunningDat").Activate
 If Range("A1") = "" Then GoTo DataOK
  ActiveSheet.UsedRange.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
DataOK:
   ThisWorkbook.Worksheets("TempRP").Activate
   If Range("A1") = "" Then GoTo Finish
   ActiveSheet.UsedRange.Select
 ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("F1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
If RunCode <> "SuppLedger" Then
 Set CheckRange = Selection.Columns("F")
 If IsError(Application.Match(RunCode, CheckRange, 0)) = False Then
   StartRow = Application.Match(RunCode, CheckRange, 0)
   EndRow = Application.Match(RunCode, CheckRange, 1)
   Selection.Rows(StartRow & ":" & EndRow).Select
 Else
   GoTo Finish
 End If
End If
 Selection.Copy
 ThisWorkbook.Worksheets("Report").Activate
 ActiveSheet.Paste
 Application.CutCopyMode = False
Finish:
  ThisWorkbook.Worksheets("Report").Activate
    Columns("A").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
      End With
    Columns("B").HorizontalAlignment = xlLeft
    Columns("C:E").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("B1:D7").HorizontalAlignment = xlCenterAcrossSelection
    Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("B2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("B3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("B4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    If RunCode <> "SuppLedger" Then
     Range("B6").Value = "Ledger Detail Report for"
     Range("B7").Value = "Supplier : " & UserForm23.Label16.Caption & "  (#" & RunCode & ")"
    Else
     Range("B6").Value = "Supplier Ledger Detail Report"
    End If
    Range("A1:A7").HorizontalAlignment = xlLeft
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "    To : " & Format(EndDate, "yyyy/mm/dd")
 TotalC = 0
 TotalD = 0
 Range("A12").Select
If ActiveCell.Value <> "" Then
  MyBook.Worksheets("Supplier Data").Activate
  ActiveSheet.UsedRange.Select
  Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
  Set CheckRange = Selection.Columns("B")
  ThisWorkbook.Worksheets("Report").Activate
 Do While ActiveCell <> ""
  ActiveCell.EntireRow.Insert
  ActiveCell.Offset(1, 0).Select
  CustomerNo = ActiveCell.Offset(0, 5).Value
  If IsError(Application.Match(CustomerNo, CheckRange, 0)) = False Then
     I = Application.Match(CustomerNo, CheckRange, 0) + 2
     CustName = MyBook.Worksheets("Supplier Data").Cells(I, 3).Value
  Else
    CustName = ActiveCell.Offset(0, 6).Value
  End If
   ActiveCell.Offset(-1, 0).HorizontalAlignment = xlLeft
   ActiveCell.Offset(-1, 0).IndentLevel = 1
   ActiveCell.Offset(-1, 0).Value = CustName & " (" & CustomerNo & ")"
  LineA = ActiveCell.Row
  If Cells(LineA, 2).Value <> "BEGINNING BALANCE" Then
   Cells(LineA, 2).EntireRow.Insert
   Cells(LineA, 2).HorizontalAlignment = xlRight
   Cells(LineA, 2).Value = "BEGINNING BALANCE"
   Cells(LineA, 3).Value = "0.00"
   ActiveCell.Offset(1, 0).Select
  Else
   Cells(LineA, 1).ClearContents
   Cells(LineA, 2).HorizontalAlignment = xlRight
  End If
   Do While ActiveCell.Offset(0, 5).Value = CustomerNo
     ActiveCell.Offset(5, 0).Select
   Loop
  If ActiveCell.Row > LineA + 4 Then
    ActiveCell.Offset(-4, 0).Select
   Do While ActiveCell.Offset(0, 5).Value = CustomerNo
     ActiveCell.Offset(1, 0).Select
   Loop
  End If
    LineB = ActiveCell.Row - 1
    Range(ActiveCell, ActiveCell.Offset(2, 0)).EntireRow.Insert
    BalanceD = Application.Sum(Range(Cells(LineA, 3), Cells(LineB, 3)))
    BalanceC = Application.Sum(Range(Cells(LineA, 4), Cells(LineB, 4)))
    CurBalance = (BalanceC - BalanceD)
    Cells(LineB + 1, 3).Value = BalanceD - Cells(LineA, 3).Value
    Cells(LineB + 1, 4).Value = BalanceC - Cells(LineA, 4).Value
     Cells(LineB + 1, 5).Value = CurBalance
    Cells(LineB + 1, 2).HorizontalAlignment = xlRight
    Cells(LineB + 1, 2).Value = "CURRENT TRANSACTION"
    TotalD = TotalD + BalanceD - Cells(LineA, 3).Value
    TotalC = TotalC + BalanceC - Cells(LineA, 4).Value
    Cells(LineB + 4, 1).Select
 Loop
   If RunCode = "SuppLedger" Then
    ActiveCell.Offset(0, 1).HorizontalAlignment = xlRight
    ActiveCell.Offset(0, 1).Value = "TOTAL TRANSACTION"
    ActiveCell.Offset(0, 2).Value = TotalD
    ActiveCell.Offset(0, 3).Value = TotalC
   End If
Else
  Range("B13").Value = "No Reported Data for the selected Range"
End If
   Columns("F:G").Delete
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A1:E25").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
   Application.EnableEvents = False
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  Unload UserForm23
  SheetName = "Report"
  OldForm = "UserForm8"
 Application.EnableEvents = True
  EventOff = False
 ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
 ThisWorkbook.Worksheets("Report").Activate
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A3").Select
 Exit Sub
ErrorHandling:
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Activity Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of the Ledger Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub CreditStatus(RunCode As String)
Dim I As Long, J As Long, CustomerNo As String, Total As Double, CustRow As Long, RptType As String
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "STATUS" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("A1").Select
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Columns("A").ColumnWidth = 16
    Columns("B").ColumnWidth = 32
    Columns("C").ColumnWidth = 21
    Columns("D:E").ColumnWidth = 16
    Columns("F").ColumnWidth = 19
    Columns("A").HorizontalAlignment = xlCenter
    Columns("B").HorizontalAlignment = xlLeft
    Columns("C").HorizontalAlignment = xlCenter
    Columns("D:E").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("F").Select
    With Selection
      .HorizontalAlignment = xlCenter
      .NumberFormat = "0.00%"
    End With
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("B1:E6").HorizontalAlignment = xlCenterAcrossSelection
    Range("A10").Value = "Customer #"
    Range("A11").Value = "------------------"
    Range("B10").Value = "Customer Name"
    Range("B11").Value = "-------------------------------------------------"
    Range("C10").Value = "Credit Term"
    Range("C11").Value = "--------------------------"
    Range("D9").Value = "Credit Limit"
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-------------------"
    Range("E9").Value = "Amount Due"
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "--------------------"
    Range("F9").Value = "% of Credit"
    Range("F10").Value = "Limit Reached"
    Range("F11").Value = "--------------------"
    Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("B2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("B3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("B4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
UserForm12.Caption = "Customer Credit Status Reporting"
UserForm12.Label1.Caption = "Credit Status Report for Customers with Outstanding Balances"
UserForm12.OptionButton2.Visible = False
UserForm12.OptionButton1.Visible = False
UserForm12.Label2.Visible = False
UserForm12.Label3.Visible = False
UserForm12.OptionButton3.Caption = "sorted by Percentage of Credit limit reached"
UserForm12.OptionButton4.Caption = "sorted by Customer # "
UserForm12.OptionButton5.Caption = "sorted by Customer Name"
UserForm12.OptionButton3.Visible = True
UserForm12.OptionButton4.Visible = True
UserForm12.OptionButton5.Visible = True
UserForm12.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
    ThisWorkbook.Worksheets("System Menu").Activate
     SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
If UserForm12.OptionButton3.Value = True Then
  RptType = "Percent"
ElseIf UserForm12.OptionButton4.Value = True Then
  RptType = "CustomerNo"
Else: RptType = "Customer"
End If
   MyBook.Worksheets("Receivable").Activate
  If Range("E4").Value = "" Then GoTo Finish
 Range("A1").Select
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("J4").Select
 If ActiveCell.Value < "S" And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < "S" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < "S" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
     Range(Cells(4, 11), Cells(I, 17)).Copy
     ThisWorkbook.Worksheets("TempRP").Activate
     ActiveSheet.Paste
     Application.CutCopyMode = False
  With Selection
    Columns("A").Copy
    Range("I1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Columns("A:E").Delete
  End With
 Else
  GoTo Finish
 End If
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Range("A1").Select
 I = 1
 J = 0
 Do While ActiveCell.Value <> ""
  CustomerNo = ActiveCell.Value
  Do While ActiveCell.Value = CustomerNo
   ActiveCell.Offset(1, 0).Select
  Loop
  J = ActiveCell.Row - 1
  If J > I Then
   Total = Application.Sum(Range(Cells(I, 4), Cells(J, 4)))
   Cells(I, 4).Value = Total
   Range(Cells(I + 1, 1), Cells(J, 4)).EntireRow.Delete
  End If
  If IsError(Application.Match(CustomerNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
   Cells(I, 3).Value = 0
   If Cells(I, 4).Value = 0 Then
    Cells(I, 5).Value = 0
   Else
    Cells(I, 5).Value = ">10000%"
   End If
  Else
   CustRow = Application.Match(CustomerNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
   Cells(I, 3).Value = MyBook.Worksheets("Customer Data").Cells(CustRow, 8).Value
   If Cells(I, 3).Value = 0 Then
     If Cells(I, 4).Value = 0 Then
       Cells(I, 5).Value = 0
     Else
      Cells(I, 5).Value = ">10000%"
     End If
   Else
    Cells(I, 5).Value = Cells(I, 4).Value / Cells(I, 3).Value
   End If
  End If
  I = I + 1
  J = I - 1
  Cells(I, 1).Select
 Loop
 Columns("C").Insert
 ActiveSheet.UsedRange.Select
 If RptType = "Percent" Then
   Selection.Sort Key1:=Range("F1"), Order1:=xlDescending, Key2:=Range("A1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 ElseIf RptType = "Customer" Then
  Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 End If
 Selection.Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
 Application.CutCopyMode = False
Finish:
   ThisWorkbook.Worksheets("Report").Activate
   Range("A12").Select
   Do While ActiveCell.Value <> ""
    CustomerNo = ActiveCell.Value
    If IsError(Application.Match(CustomerNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) = False Then
      I = Application.Match(CustomerNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
      ActiveCell.Offset(0, 2).Value = MyBook.Worksheets("Customer Data").Cells(I, 16).Value
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    If RptType = "Percent" Then
      Range("B6").Value = "Credit Status Report --- (sorted by Percentage of Credit)"
    ElseIf RptType = "Customer" Then
      Range("B6").Value = "Credit Status Report --- (sorted by Customer Name)"
    Else
     Range("B6").Value = "Credit Status Report --- (sorted by Customer #)"
    End If
    Range("A1:F18").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A12").Value = "" Then Range("B13").Value = " No Data for the selected period and range. "
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
  Unload UserForm12
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
 ThisWorkbook.Worksheets("Report").Activate
 Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
End Sub

Sub ProdSale(RunCode As String)
Dim I As Long, J As Long, K As Long, LineStart As Long, CustomerNo As String, Customer As String
Dim Total As Double, QtyGTotal As Double, AmtGTotal As Double, StartDate As Date, EndDate As Date, AcctNo As String
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PRODSALE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("G1").Select
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A10").Value = "Product #"
    Range("A11").Value = "------------------------"
    Range("B10").Value = "Description"
    Range("B11").Value = "----------------------------------------------------------------"
    Range("C10").Value = " Quantity "
    Range("C11").Value = "-------------------"
    Range("D9").Value = "  Discounted Amount "
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-----------------------------"
    Columns("A").ColumnWidth = 20
    Columns("B").ColumnWidth = 45
    Columns("C:D").ColumnWidth = 20
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C").HorizontalAlignment = xlCenter
    Columns("D").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("B1:C8").HorizontalAlignment = xlCenterAcrossSelection
    Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("B2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("B3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("B4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
UserForm13.OptionButton3.Value = True
UserForm13.OptionButton4.Visible = True
UserForm13.OptionButton5.Visible = True
UserForm13.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
  StartDate = UserForm13.TextBox1.Text
  EndDate = UserForm13.TextBox2.Text
  If StartDate > EndDate Then
   StartDate = UserForm13.TextBox2.Text
   EndDate = UserForm13.TextBox1.Text
  End If
If UserForm13.OptionButton4.Value = True Or UserForm13.OptionButton5.Value = True Then
  Call InvListing("InvListing", StartDate, EndDate)
  Exit Sub
End If
If UserForm13.OptionButton1.Value = True Then
 CustomerNo = UserForm13.TextBox3.Text
 Customer = UserForm13.Label11.Caption
Else
 CustomerNo = "*"
 Customer = ""
End If
 On Error GoTo ErrorHandling
   MyBook.Worksheets("Receivable").Activate
  If Range("E4").Value = "" Then GoTo Finish
If CustomerNo = "*" Then
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("D4").Select
  I = 4
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
      J = ActiveCell.Row - 1
 If J < I Then GoTo Finish
Else
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("P4").Select
  If ActiveCell.Value < CustomerNo And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < CustomerNo And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < CustomerNo And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   End If
     If ActiveCell.Value = CustomerNo Then
        I = ActiveCell.Row
        Customer = ActiveCell.Offset(0, 1).Value
     Else
      GoTo Finish
     End If
     Do While ActiveCell.Value = CustomerNo And ActiveCell.Offset(0, -12).Value < StartDate
      ActiveCell.Offset(1, 0).Select
     Loop
     I = ActiveCell.Row
     Do While ActiveCell.Value = CustomerNo And ActiveCell.Offset(0, -12).Value <= EndDate
      ActiveCell.Offset(1, 0).Select
     Loop
    J = ActiveCell.Row - 1
  If J < I Then GoTo Finish
End If
If UserForm13.OptionButton2.Value <> True Then
  Range(Cells(I, 30), Cells(J, 194)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
 I = 1
 Range("A1").Select
 Do While Cells(I, 7).Value <> ""
  DisRate = Cells(I, 10).Value
  J = Cells(I, 7).Value
  K = 13
  Do While J > 0
    Range(Cells(I, K), Cells(I, K + 3)).Copy
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveCell.Offset(0, 4).Value = Cells(I, K + 4) * (1 - DisRate)
    ActiveCell.Offset(1, 0).Select
    J = J - 1
    K = K + 8
  Loop
  I = I + 1
 Loop
  If Range("A1").Value = "" Then GoTo Finish
  Range("A1:E1").CurrentRegion.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("A1").Select
    I = 1
    J = 0
 Do While ActiveCell.Value <> ""
  AcctNo = ActiveCell.Value
  Do While ActiveCell.Value = AcctNo
   ActiveCell.Offset(1, 0).Select
  Loop
  J = ActiveCell.Row - 1
  If J > I Then
   Total = Application.Sum(Range(Cells(I, 3), Cells(J, 3)))
   Cells(I, 3).Value = Total
   Total = Application.Sum(Range(Cells(I, 5), Cells(J, 5)))
   Cells(I, 5).Value = Total
   Range(Cells(I + 1, 1), Cells(J, 5)).EntireRow.Delete
  End If
  I = I + 1
  J = I - 1
  Cells(I, 1).Select
 Loop
  Columns("D").Delete
  Range("A1:E1").CurrentRegion.Copy
  ThisWorkbook.Worksheets("Report").Activate
  Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Application.CutCopyMode = False
Else
  Range(Cells(I, 16), Cells(J, 194)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("I1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("K:V").Delete
  Columns("F:G").NumberFormat = "@"
 I = 1
 Range("A1").Select
 Do While Cells(I, 9).Value <> ""
  DisRate = Cells(I, 14).Value
  J = Cells(I, 11).Value
  K = 17
  Do While J > 0
    Range(Cells(I, K), Cells(I, K + 3)).Copy
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveCell.Offset(0, 4).Value = Cells(I, K + 4) * (1 - DisRate)
    ActiveCell.Offset(0, 5).Value = Cells(I, 9).Value
    ActiveCell.Offset(0, 6).Value = Cells(I, 10).Value
    ActiveCell.Offset(1, 0).Select
    J = J - 1
    K = K + 8
  Loop
  I = I + 1
 Loop
  Columns("D").Delete
  Range("A1:E1").CurrentRegion.Select
  Selection.Sort Key1:=Range("F1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Selection.Copy
   ThisWorkbook.Worksheets("Report").Activate
   Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
   Range("A12").Select
    I = 12
    J = 11
    QtyGTotal = 0
    AmtGTotal = 0
  Do While ActiveCell.Value <> ""
   AcctNo = ActiveCell.Value
   Customer = ActiveCell.Offset(0, 5).Value
   CustomerNo = ActiveCell.Offset(0, 4).Value
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   ActiveCell.HorizontalAlignment = xlLeft
   ActiveCell.Offset(1, 0).Value = Customer & " ( # " & CustomerNo & " )"
   ActiveCell.Offset(2, 0).Select
   I = I + 2
   LineStart = I
   Do While ActiveCell.Offset(0, 5).Value = Customer
     Do While ActiveCell.Value = AcctNo And ActiveCell.Offset(0, 5).Value = Customer
       ActiveCell.Offset(1, 0).Select
     Loop
    J = ActiveCell.Row - 1
    If J > I Then
     Total = Application.Sum(Range(Cells(I, 3), Cells(J, 3)))
     Cells(I, 3).Value = Total
     Total = Application.Sum(Range(Cells(I, 4), Cells(J, 4)))
     Cells(I, 4).Value = Total
     Range(Cells(I + 1, 1), Cells(J, 5)).EntireRow.Delete
    End If
    I = I + 1
    J = I - 1
    Cells(I, 1).Select
    AcctNo = ActiveCell.Value
   Loop
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   Total = Application.Sum(Range(Cells(LineStart, 3), Cells(I - 1, 3)))
   Cells(I + 1, 3).Value = Total
   QtyGTotal = QtyGTotal + Total
   Total = Application.Sum(Range(Cells(LineStart, 4), Cells(I - 1, 4)))
   Cells(I + 1, 4).Value = Total
   AmtGTotal = AmtGTotal + Total
   Cells(I + 1, 2).HorizontalAlignment = xlRight
   Cells(I + 1, 2).Value = "Total : "
    Range(Cells(I + 1, 1), Cells(I + 1, 4)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
     I = I + 2
     J = I - 1
     Cells(I, 1).Select
  Loop
  Columns("E:F").Delete
  Range("A12").Value = " "
  I = ActiveSheet.UsedRange.Rows.Count
  If Range("A12").Value <> "" Then
    Cells(I + 2, 3).Value = QtyGTotal
    Cells(I + 2, 4).Value = AmtGTotal
    Cells(I + 2, 2).HorizontalAlignment = xlRight
    Cells(I + 2, 2).Value = "Grand Total : "
  End If
 End If
Finish:
   ThisWorkbook.Worksheets("Report").Activate
If Range("A12").Value <> "" And UserForm13.OptionButton2.Value <> True Then
  I = ActiveSheet.UsedRange.Rows.Count
   Cells(I + 2, 3).Value = Application.Sum(Range(Cells(12, 3), Cells(I, 3)))
   Cells(I + 2, 4).Value = Application.Sum(Range(Cells(12, 4), Cells(I, 4)))
   Cells(I + 2, 2).HorizontalAlignment = xlRight
   Cells(I + 2, 2).Value = "Total : "
 End If
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
    If UserForm13.OptionButton1.Value = True Then
      Range("B6").Value = "Product Sales Report"
      Range("B7").Value = " for "
      If Customer <> "" Then
        Range("B8").Value = " Customer :-- " & Customer & " (# " & CustomerNo & ") "
      Else
        Range("B8").Value = " ( Customer # " & CustomerNo & " ) "
      End If
     ElseIf UserForm13.OptionButton3.Value = True Then
        Range("B6").Value = "Product Sales Summary Report"
     Else
        Range("B6").Value = "Product Sales Report - sorted by Customer name"
     End If
    Range("A1:D15").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A12").Value = "" Then Range("B13").Value = " No Data for the selected period and range. "
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  On Error GoTo ErrorHandling
  Unload UserForm13
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
 Exit Sub
ErrorHandling:
   Unload UserForm13
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub InvListing(RunCode As String, StartDate As Date, EndDate As Date)
Dim InvAmt As Double, I As Long, J As Long, K As Long, M As Long, Prefix As String
If RunCode <> "InvListing" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("M1").Select
    ThisWorkbook.Worksheets("Report").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A10").Value = "Inv #"
    Range("A11").Value = "---------------------"
    Range("B10").Value = "Inv Date"
    Range("B11").Value = "-----------------"
    Range("C10").Value = " Part #  "
    Range("C11").Value = "------------------------"
    Range("D10").Value = " Part Description"
    Range("D11").Value = "-----------------------------------------------------------------------"
    Range("E9").Value = " Quantity "
    Range("E10").Value = " Sold "
    Range("E11").Value = "-------------------"
    Range("F9").Value = " Unit Price "
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-------------------"
    Range("G9").Value = " Amount "
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "-------------------"
    Columns("A").ColumnWidth = 16
    Columns("B").ColumnWidth = 13
    Columns("C").ColumnWidth = 20
    Columns("D").ColumnWidth = 45
    Columns("E:G").ColumnWidth = 15
    Columns("A").HorizontalAlignment = xlLeft
    Columns("B").HorizontalAlignment = xlCenter
    Columns("C:D").HorizontalAlignment = xlLeft
    Columns("E").HorizontalAlignment = xlCenter
    Columns("F:G").HorizontalAlignment = xlRight
    Columns("A").NumberFormat = "@"
    Columns("B").NumberFormat = "yyyy/mm/dd"
    Columns("C:D").NumberFormat = "@"
    Columns("F").NumberFormat = "#,##0.0000"
    Columns("G").NumberFormat = "#,##0.00"
    Columns("C:D").ShrinkToFit = True
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("C1:E8").HorizontalAlignment = xlCenterAcrossSelection
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
  On Error GoTo ErrorHandling
   MyBook.Worksheets("Receivable").Activate
  If Range("B4").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("D4").Select
  I = 4
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
      J = ActiveCell.Row - 1
 If J < I Then GoTo Finish
  Range(Cells(I, 1), Cells(J, 194)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Selection.Sort Key1:=Range("M1"), Order1:=xlDescending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("N1").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, -1).Value = "INVOICE" And Right(ActiveCell.Value, 1) <> " " Then _
     ActiveCell.Value = "INV" & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
  ActiveSheet.UsedRange.Select
 If UserForm13.OptionButton4.Value = True Then
    Selection.Sort Key1:=Range("M1"), Order1:=xlDescending, Key2:=Range("N1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Else
   Selection.Sort Key1:=Range("AB1"), Order1:=xlAscending, Key2:=Range("M1"), Order2:=xlDescending, Key3:=Range("N1"), Order3:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 End If
  Columns("C:D").NumberFormat = "@"
 Range("AB1").Select
 I = 1
 K = 1
 InvAmt = 0
 Do While ActiveCell.Value <> ""
   Cells(I, 1).Value = ActiveCell.Offset(0, 1).Value & "  (" & ActiveCell.Value & ")"
   I = I + 1
   M = I
   J = ActiveCell.Offset(0, 14).Value
   Cells(I, 1).NumberFormat = "@"
   Cells(I, 1).Value = ActiveCell.Offset(0, -14).Value
   Cells(I, 2).Value = ActiveCell.Offset(0, -12).Value
  Do While J > 0
   Cells(I, 3).Value = ActiveCell.Offset(0, 19 + K).Value
   Cells(I, 4).Value = ActiveCell.Offset(0, 19 + K + 1).Value
   Cells(I, 5).Value = ActiveCell.Offset(0, 19 + K + 2).Value
   If Cells(I, 5).Value = "" Then Cells(I, 5).Value = 0
   Cells(I, 6).Value = ActiveCell.Offset(0, 19 + K + 3).Value
   Cells(I, 7).Value = ActiveCell.Offset(0, 19 + K + 4).Value
   If Cells(I, 7).Value = "" Then Cells(I, 7).Value = 0
   I = I + 1
   J = J - 1
   K = K + 8
  Loop
  Cells(I + 1, 1).Value = "Payment Term : " & ActiveCell.Offset(0, -1).Value
  Cells(I + 2, 1).Value = "Payment Due : " & Format(ActiveCell.Offset(0, -2).Value, "yyyy/mm/dd")
  Cells(I + 1, 6).Value = " Sub-Total :"
  Cells(I + 1, 7).Value = Application.Sum(Range(Cells(M, 7), Cells(I - 1, 7)))
  Cells(I + 2, 6).Value = " Discount :"
  Cells(I + 2, 7).Value = ActiveCell.Offset(0, 15).Value
  Cells(I + 3, 6).Value = " Total :"
  Cells(I + 3, 7).Value = ActiveCell.Offset(0, 16).Value
  InvAmt = InvAmt + Cells(I + 3, 7).Value
   Worksheets("Report").Activate
    Range(Cells(I + 14, 1), Cells(I + 14, 7)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Worksheets("TempRP").Activate
  K = 1
  I = I + 5
  ActiveCell.Offset(1, 0).Select
 Loop
  Cells(I, 6).Value = " Grand Total :"
  Cells(I, 7).Value = InvAmt
  Range(Cells(1, 1), Cells(I, 7)).Copy
  Worksheets("Report").Activate
  Range("A12").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
       False, Transpose:=False
   Application.CutCopyMode = False
Finish:
   ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "    To : " & Format(EndDate, "yyyy/mm/dd")
    If UserForm13.OptionButton4.Value = True Then
      Range("C6").Value = "Detail Listing of Invoices and Credit Notes --- Sorted by Invoice #"
     Else
      Range("C6").Value = "Detail Listing of Invoices and Credit Notes --- Sorted by Customer #"
     End If
    Range("A1:G15").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
   If Range("A12").Value = "" Then
    Range("D13").ShrinkToFit = False
    Range("D13").Value = " No Record of Invoices and Credit Notes for the period selected. "
  End If
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
   On Error GoTo ErrorHandling
  Unload UserForm13
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
 Exit Sub
ErrorHandling:
   Unload UserForm13
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "Probably the Data file is lack of space.")
End Sub

Sub Form10ListClick(RunCode As String)
Dim AcctNo As String, EndNo As Long, I As Long
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "AccountSetup" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 I = ButtonNo + 1
If UserForm10.Controls("ListBox" & I).Text = "CLOSE this Listing Box" Then
   UserForm10.Controls("ListBox" & I).Visible = False
  Exit Sub
End If
If UserForm10.Controls("ListBox" & I).Text <> "" Then
  UserForm10.Label11.Visible = False
  AcctNo = UserForm10.Controls("ListBox" & I).Text
  EndNo = 1
  Do While Mid(AcctNo, EndNo, 1) <> " " And EndNo <= Len(AcctNo)
   EndNo = EndNo + 1
  Loop
  AcctNo = Left(AcctNo, EndNo - 1)
  UserForm10.Controls("ListBox" & I).Visible = False
  UserForm10.Controls("TextBox" & ButtonNo).Text = AcctNo
Else
 UserForm10.Controls("TextBox" & ButtonNo).Text = ""
End If
  Call Form10TextExit("")
End Sub

Sub Form10TextExit(RunCode As String)
Dim AcctNo As String
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "AccountSetup" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 AcctNo = UserForm10.Controls("Textbox" & ButtonNo).Text
 UserForm10.Controls("Label" & ButtonNo + 11).Caption = ""
  If ButtonNo = 1 And Left(AcctNo, 1) <> 1 Then
   UserForm10.Label11.Caption = Chr(13) & "    Incorrect account type for the A/R Debtor Account "
   UserForm10.Label11.Visible = True
   Exit Sub
  End If
  If ButtonNo = 2 And Left(AcctNo, 1) <> 4 And Left(AcctNo, 1) <> 8 Then
   UserForm10.Label11.Caption = Chr(13) & "    Incorrect account type for the Sales Discount Account #"
   UserForm10.Label11.Visible = True
   Exit Sub
  End If
  If ButtonNo = 3 And Left(AcctNo, 1) <> 2 Then
   UserForm10.Label11.Caption = Chr(13) & "    Incorrect account type for the Creditor Account #"
   UserForm10.Label11.Visible = True
   Exit Sub
  End If
  If ButtonNo = 4 Then
   If Left(AcctNo, 1) > 2 Then
     UserForm10.Label11.Caption = Chr(13) & "    Incorrect account type for Bank/Cash/Liability Accounts"
     UserForm10.Label11.Visible = True
     Exit Sub
   End If
    MyBook.Worksheets("ComData").Activate
    Range("A24").Select
    Do While ActiveCell.Value <> ""
     If AcctNo = ActiveCell.Value Then
      UserForm10.Label11.Caption = Chr(13) & "    This Account # has already been added to the List"
      UserForm10.Label11.Visible = True
      Exit Sub
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
  End If
 MyBook.Worksheets("Chart of Account").Activate
 Range("A10").Select
Do While ActiveCell.Value <= AcctNo And ActiveCell.Value <> ""
 If ActiveCell.Value = AcctNo Then
  If Len(ActiveCell.Offset(1, 0).Value) > Len(AcctNo) Then
   UserForm10.Label11.Caption = Chr(13) & "    It is not a Detailed Account"
   UserForm10.Label11.Visible = True
   Exit Sub
  End If
  UserForm10.Controls("Label" & ButtonNo + 11).Caption = ActiveCell.Offset(0, 1).Value
  GoTo AccountOK
 End If
 ActiveCell.Offset(1, 0).Select
Loop
 If ButtonNo = 1 Then
  UserForm10.Label11.Caption = Chr(13) & "    Incorrect Debtor Account #"
 ElseIf ButtonNo = 2 Then
   UserForm10.Label11.Caption = Chr(13) & "    Incorrect Sales Discount Account #"
 ElseIf ButtonNo = 3 Then
   UserForm10.Label11.Caption = Chr(13) & "    Incorrect Creditor Account #"
 Else
   UserForm10.Label11.Caption = Chr(13) & "    Incorrect Bank/Cash Account #"
 End If
  UserForm10.Label11.Visible = True
 Exit Sub
AccountOK:
 If ButtonNo = 1 Then
  UserForm10.TextBox1.Text = AcctNo
 ElseIf ButtonNo = 2 Then
  UserForm10.TextBox2.Text = AcctNo
 ElseIf ButtonNo = 3 Then
  UserForm10.TextBox3.Text = AcctNo
 Else
  UserForm10.TextBox4.Text = AcctNo
 End If
UserForm10.Label11.Visible = False
UserForm10.CommandButton8.Visible = False
UserForm10.CommandButton9.Visible = False
End Sub

Sub Form14Text1Exit(RunCode As String)
Dim FRow As Long, LRow As Long, BalString As String, I As Long
Dim Tbl As Range, CheckRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "SUPPLIER" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
SupplierNo = UserForm14.TextBox1.Text
SupplierBalance = 0
MyBook.Worksheets("Supplier Data").Activate
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
  For I = 2 To 12
  UserForm14.Controls("TextBox" & I).Text = ""
 Next I
 UserForm14.TextBox8.Text = "0.00"
 UserForm14.TextBox8.Visible = False
 UserForm14.Label26.Caption = "C.O.D."
 UserForm14.Label26.Left = 114
 UserForm14.Label26.Width = 126
 UserForm14.TextBox7.Text = ""
 UserForm14.TextBox7.Visible = False
 UserForm14.Label23.Visible = False
 UserForm14.Label19.Visible = False
 UserForm14.ListBox1.Visible = False
 UserForm14.ListBox2.Visible = False
 UserForm14.Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
Else
 SupplierRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
 MyBook.Worksheets("Supplier Data").Activate
 Cells(SupplierRow, 2).Select
UserForm14.TextBox1.Text = ActiveCell.Value
UserForm14.TextBox2.Text = ActiveCell.Offset(0, 1).Value
UserForm14.TextBox3.Text = ActiveCell.Offset(0, 3).Value
UserForm14.TextBox4.Text = ActiveCell.Offset(0, 4).Value
UserForm14.TextBox5.Text = ActiveCell.Offset(0, 5).Value
UserForm14.TextBox6.Text = ActiveCell.Offset(0, 8).Value
UserForm14.TextBox6.Font.Italic = False
UserForm14.TextBox8.Text = Format(ActiveCell.Offset(0, 6).Value, "#,##0.00")
UserForm14.TextBox9.Text = ActiveCell.Offset(0, 9).Value
UserForm14.TextBox10.Text = ActiveCell.Offset(0, 10).Value
UserForm14.TextBox11.Text = ActiveCell.Offset(0, 11).Value
UserForm14.TextBox12.Text = ActiveCell.Offset(0, 12).Value
If ActiveCell.Offset(0, 14).Value <> "C.O.D." And ActiveCell.Offset(0, 14).Value <> "Prepaid" Then
   UserForm14.TextBox7.Text = Val(ActiveCell.Offset(0, 14).Value)
   UserForm14.TextBox7.Visible = True
  UserForm14.TextBox8.Visible = True
   UserForm14.Label26.Left = 144
   UserForm14.Label26.Width = 108
  If UCase(Right(ActiveCell.Offset(0, 14).Value, 4)) = "DAYS" Then
    UserForm14.Label26.Caption = "Days"
  ElseIf UCase(Right(ActiveCell.Offset(0, 14).Value, 4)) = " EOM" Then
    UserForm14.Label26.Caption = "Days after EOM"
 End If
Else
  UserForm14.Label26.Left = 114
  UserForm14.Label26.Width = 126
  UserForm14.Label26.Caption = ActiveCell.Offset(0, 14).Value
  UserForm14.TextBox7.Text = ""
  UserForm14.TextBox7.Visible = False
  UserForm14.TextBox8.Text = "0.00"
  UserForm14.TextBox8.Visible = False
End If
UserForm14.Label23.Caption = " Last Update : " & Year(ActiveCell.Offset(0, -1).Value) & "/" & Month(ActiveCell.Offset(0, -1).Value) & "/" & Day(ActiveCell.Offset(0, -1).Value)
UserForm14.Label23.Visible = True
End If
UserForm14.ListBox1.Visible = False
 MyBook.Worksheets("Payable").Activate
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(SupplierNo, CheckRange, 0)) Then GoTo NoRecord
  FRow = Application.Match(SupplierNo, CheckRange, 0) + 3
  LRow = Application.Match(SupplierNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
  SupplierBalance = Application.Sum(Range(Cells(FRow, 11), Cells(LRow, 11)))
 End If
NoRecord:
  BalString = Format(SupplierBalance, "#,##0.00")
  UserForm14.Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : " & BalString
End Sub

Sub ReceiptFormat(RunCode As String)
Dim I As Long, J As Long, L As Long, JumpNo As Long, CopyNo As Long, BeginNo As String, EndNo As String
Dim Tbl As Range, CheckRange As Range, WorkNo As String, WorkReceipt As String
If Not (ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PAYMENT" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "RECEIPT") Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 MyBook.Worksheets("PayRec").Activate
 If Range("A3").Value = "" Then
   MsgBox (" No Receipt data is found in the record" & Chr(13) & "Receipt printing cannot be proceeded")
   UserForm11.Show
   Exit Sub
 End If
  If Range("B1").Value = "00000" Then
    MsgBox (" No Receipt data is found in the record" & Chr(13) & "Receipt printing cannot be proceeded")
    UserForm11.Show
    Exit Sub
  End If
  Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
     Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("L1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Columns("A")
  Userform18.TextBox2.Text = Range("B1").Value
  I = Val(Range("B1").Value) - 29
  If I < 0 Then I = 1
  BeginNo = "R" & Right("00000" & I, 5)
  If Range("A3").Value > BeginNo Then BeginNo = Range("A3").Value
  BeginNo = Right(BeginNo, 5)
  Userform18.TextBox1.Text = BeginNo
  Userform18.Caption = "Receipt Printout"
  Userform18.Label3.Caption = "Enter the Range of Receipt # below" & Chr(13) & "(Maximum 30 Receipts)"
  Userform18.Label1.Caption = "Beginning Receipt # : "
  Userform18.Label2.Caption = "Ending Receipt # : "
  Userform18.Label5.Caption = "R"
  Userform18.Label6.Caption = "R"
  Userform18.Label5.Visible = True
  Userform18.Label6.Visible = True
  Userform18.TextBox1.Left = 174
  Userform18.TextBox2.Left = 174
  Userform18.Show
CheckInput:
   If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
      UserForm11.Show
      Exit Sub
    End If
    If IsNumeric(Userform18.TextBox1.Value) = False Then
       Userform18.Label4.BackColor = &H4C0&
       Userform18.Label4.Caption = Chr(13) & "     Beginning Receipt # is Not a valid Receipt # "
       Userform18.Label4.Visible = True
       Userform18.Show
       GoTo CheckInput
     End If
    If IsNumeric(Userform18.TextBox2.Value) = False Then
       Userform18.Label4.BackColor = &H4C0&
       Userform18.Label4.Caption = Chr(13) & "     Ending Receipt # is Not a valid Receipt # "
       Userform18.Label4.Visible = True
       Userform18.Show
       GoTo CheckInput
     End If
   BeginNo = Userform18.TextBox1.Text
   EndNo = Userform18.TextBox2.Text
   If BeginNo > EndNo Then
    BeginNo = Userform18.TextBox2.Text
    EndNo = Userform18.TextBox1.Value
   End If
  Unload Userform18
  Set CheckRange = Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Columns("A")
 Application.EnableEvents = False
   Application.DisplayAlerts = False
   ThisWorkbook.Worksheets("Report").Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Application.DisplayAlerts = True
  ThisWorkbook.Worksheets("RecForm").Activate
  Cells.Select
  Selection.Copy
  Worksheets("Report").Activate
  Cells.Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Cells(1, 1).Select
 WorkNo = BeginNo
 JumpNo = 0
 CopyNo = 0
 ThisWorkbook.Worksheets("Report").Activate
 J = 1
Do While WorkNo <= EndNo And CopyNo < 30
  WorkReceipt = "R" & WorkNo
 If IsError(Application.Match(WorkReceipt, CheckRange, 0)) = False Then
    RecRowA = Application.Match(WorkReceipt, CheckRange, 0) + 2
    RecRowB = Application.Match(WorkReceipt, CheckRange, 1) + 2
    If RecRowB < RecRowA Then RecRowB = RecRowA
   L = 0
   Cells(J, 1).Range("A1").Value = MyBook.Worksheets("ComData").Range("B2")
   Cells(J, 1).Range("A9").Value = "Amount (" & SysCurrency & ") : "
   Cells(J, 1).Range("G5").Value = MyBook.Worksheets("PayRec").Cells(RecRowA, 1).Value
   Cells(J, 1).Range("G6").Value = MyBook.Worksheets("PayRec").Cells(RecRowA, 2).Value
   Cells(J, 1).Range("B8").Value = MyBook.Worksheets("PayRec").Cells(RecRowA, 4).Value
   Cells(J, 1).Range("B9").Value = "  ***" & Format(MyBook.Worksheets("PayRec").Cells(RecRowA, 5).Value, "#,##0.00") & "***"
   If MyBook.Worksheets("PayRec").Cells(RecRowA, 6).Value = "Cheque" Then
    Cells(J, 1).Range("D9").Value = "   (by Cheque)"
    Cells(J, 1).Range("B12").Value = MyBook.Worksheets("PayRec").Cells(RecRowA, 7).Value
    Cells(J, 1).Range("D12").Value = MyBook.Worksheets("PayRec").Cells(RecRowA, 9).Value
    Cells(J, 1).Range("F12").Value = MyBook.Worksheets("PayRec").Cells(RecRowA, 10).Value
   ElseIf MyBook.Worksheets("PayRec").Cells(RecRowA, 6).Value = "Cash" Then
    Cells(J, 1).Range("D9").Value = "     (by Cash)"
    Cells(J, 1).Range("B12").Value = "  N/A"
    Cells(J, 1).Range("D12").Value = "  N/A"
    Cells(J, 1).Range("F12").Value = "  N/A"
   Else
    Cells(J, 1).Range("D9").Value = "     (settle among Invoices and Credit Notes)"
    Cells(J, 1).Range("B12").Value = "  N/A"
    Cells(J, 1).Range("D12").Value = "  N/A"
    Cells(J, 1).Range("F12").Value = "  N/A"
   End If
   Cells(J, 1).Range("B10").Select
   I = RecRowA
  Do While I < RecRowB
   If ActiveCell.Row >= J + 10 Then
    ActiveCell.EntireRow.Insert
    L = L + 1
   End If
    ActiveCell.Value = MyBook.Worksheets("PayRec").Cells(I, 11).Value & MyBook.Worksheets("PayRec").Cells(I, 12).Value & _
         "  (" & SysCurrency & Format(MyBook.Worksheets("PayRec").Cells(I, 13).Value, "#,##0.00") & ")" & "     ;   " & _
         MyBook.Worksheets("PayRec").Cells(I + 1, 11).Value & MyBook.Worksheets("PayRec").Cells(I + 1, 12).Value & _
         "  (" & SysCurrency & Format(MyBook.Worksheets("PayRec").Cells(I + 1, 13).Value, "#,##0.00") & ")"
    I = I + 2
    ActiveCell.Offset(1, 0).Select
  Loop
  If I = RecRowB Then
    If RecRowA <> RecRowB Then
       ActiveCell.Value = MyBook.Worksheets("PayRec").Cells(I, 11).Value & MyBook.Worksheets("PayRec").Cells(I, 12).Value & _
         "  (" & SysCurrency & Format(MyBook.Worksheets("PayRec").Cells(I, 13).Value, "#,##0.00") & ")"
    Else
      ActiveCell.Value = MyBook.Worksheets("PayRec").Cells(I, 11).Value & MyBook.Worksheets("PayRec").Cells(I, 12).Value & _
         "  (" & SysCurrency & Format(MyBook.Worksheets("PayRec").Cells(I, 13).Value, "#,##0.00") & ")"
      ActiveCell.Offset(1, 0).EntireRow.Delete
      L = L - 1
    End If
  Else
    ActiveCell.EntireRow.Delete
    L = L - 1
  End If
   CopyNo = CopyNo + 1
   J = J + 20 + L
 ActiveSheet.Rows(J).PageBreak = xlPageBreakManual
 Else
  JumpNo = JumpNo + 1
 End If
  WorkNo = Right(("00000" & Val(WorkNo) + 1), 5)
Loop
 Range(Cells(J, 1), Cells(800, 1)).EntireRow.Delete
If Range("A9").Value = "" Then
  Userform18.Label4.BackColor = &H4C0&
  Userform18.Label4.Caption = Chr(13) & "   None of the specified Receipts is found in the record"
  Userform18.TextBox1.Text = StartInv
  Userform18.TextBox2.Text = EndInv
  Userform18.Label4.Visible = True
  Userform18.Show
  GoTo CheckInput
End If
  On Error GoTo NoPrinter
  With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
   End With
NoPrinter:
 ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 ThisWorkbook.Worksheets("Report").Activate
 SheetName = "Report"
 Application.ScreenUpdating = True
 ActiveWindow.DisplayGridlines = False
 Range("A1").Select
 Range("A2").Select
If JumpNo > 0 Or (WorkReceipt <= EndNo And CopyNo = 30) Then
  If JumpNo = 1 Then
    MSG1 = "One Receipt # is not found in the Record."
  ElseIf JumpNo > 1 Then
    MSG1 = JumpNo & " Receipt numbers are not found in the Record."
  End If
  If WorkReceipt <= EndNo And CopyNo = 30 Then MSG2 = "The number of Receipts requested for print-out exceeds 30" & Chr(13) _
     & "The system can only handle a maximum of 30 Receipts each time." & Chr(13) & "Thus, only 30 Receipts were processed."
  If MSG1 = "" Then
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG2 + Chr(13) + Chr(13) + "Please Note"
  ElseIf MSG2 = "" Then
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + "Please Note"
  Else
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + MSG2 + Chr(13) + Chr(13) + "Please Note"
  End If
 MsgBox (myMsg)
End If
 Unload UserForm11
 ThisWorkbook.Worksheets("Report").Activate
 SheetName = "Report"
 OldForm = "UserForm8"
 Application.EnableEvents = True
End Sub

Sub RecRecord(RunCode As String)
Dim I As Long, J As Long, StartDate As Date, EndDate As Date, ReceiptNo As String
If RunCode <> "PAYMENT" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
  Application.EnableEvents = False
   Application.DisplayAlerts = False
   ThisWorkbook.Worksheets("Report").Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Columns("A:A").Select
    With Selection
        .ColumnWidth = 11.13
        .HorizontalAlignment = xlLeft
    End With
    Columns("B:B").Select
    With Selection
        .ColumnWidth = 13.88
        .NumberFormat = "yyyy/mm/dd"
        .HorizontalAlignment = xlCenter
    End With
    Columns("C:C").Select
    With Selection
        .ColumnWidth = 15.75
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
    Columns("D:D").Select
    With Selection
        .ColumnWidth = 13.38
        .HorizontalAlignment = xlCenter
        .NumberFormat = "@"
    End With
    Columns("E:E").Select
    With Selection
        .ColumnWidth = 12
        .HorizontalAlignment = xlCenter
        .NumberFormat = "@"
    End With
    Columns("F:F").Select
     With Selection
        .ColumnWidth = 15.75
        .NumberFormat = "yyyy/mm/dd"
        .HorizontalAlignment = xlCenter
     End With
    Columns("G:G").Select
    With Selection
        .ColumnWidth = 26
        .HorizontalAlignment = xlLeft
    End With
    Columns("H:H").Select
    With Selection
        .ColumnWidth = 16
        .HorizontalAlignment = xlLeft
    End With
    Columns("I:I").Select
    With Selection
        .ColumnWidth = 16
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
     Range("A1:J11").VerticalAlignment = xlCenter
    Range("A11:J11").NumberFormat = "@"
    Range("A11").FormulaR1C1 = "-------------"
    Range("B11").FormulaR1C1 = "-------------"
    Range("C11").FormulaR1C1 = "------------------"
    Range("D11").FormulaR1C1 = "----------------"
    Range("E11").FormulaR1C1 = "---------------"
    Range("F11").FormulaR1C1 = "-------------------"
    Range("G11").FormulaR1C1 = "-------------------------------"
    Range("H11").FormulaR1C1 = "--------------------"
    Range("I11").FormulaR1C1 = "--------------------"
    Range("A10").Value = "Receipt #"
    Range("B10").Value = "Pay Date"
    Range("C9").Value = "Payment Amt"
    Range("C10").Value = "(" & SysCurrency & ")"
    Range("D9").Value = "Payment"
    Range("D10").Value = "Method"
    Range("E10").Value = "Cheque #"
    Range("F10").Value = "Cheque Date"
    Range("G10").Value = "Cheque Issuing Bank"
    Range("H9").Value = "Paid to "
    Range("H10").Value = "Inv / CN # "
    Range("I9").Value = "Applied Amt"
    Range("I10").Value = "(" & SysCurrency & ")"
    Columns("A:I").Select
    With Selection.Font
        .Name = "Arial"
        .Size = 13
    End With
  StartDate = UserForm16.TextBox1.Text
  EndDate = UserForm16.TextBox2.Text
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("A1").Select
 MyBook.Worksheets("PayRec").Activate
  If Range("A3").Value = "" Then
   If UserForm16.OptionButton2.Value = True Then GoTo FinishDate
   GoTo Finish
  End If
     Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1") _
        , Order2:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("B3").Select
   I = 3
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 32 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 32 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
   J = ActiveCell.Row - 1
 If J < I Then
  If UserForm16.OptionButton2.Value = True Then GoTo FinishDate
  GoTo Finish
 End If
  Range(Cells(I, 1), Cells(J, 13)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
If UserForm16.OptionButton1.Value = True Then
  CustNo = UserForm16.TextBox3.Text
  ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Key2:=Range("A1") _
        , Order2:=xlAscending, Key3:=Range("L1"), Order3:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Range("C1").Select
 If ActiveCell.Value < CustNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value < CustNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value < CustNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(1, 1), Cells(I, 13)).EntireRow.Delete
 End If
 Range("C1").Select
 If ActiveCell.Value <= CustNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value <= CustNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value <= CustNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
  End If
   I = ActiveCell.Row - 1
   If I > 0 Then
    If Cells(I + 1, 1).Value <> "" Then
     ActiveCell.EntireRow.Insert
     ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
    End If
   Else: GoTo Finish
   End If
End If
If UserForm16.OptionButton3.Value = True Or UserForm16.OptionButton1.Value = True Then
  ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Key2:=Range("A1") _
        , Order2:=xlAscending, Key3:=Range("L1"), Order3:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("A1").Select
  Do While ActiveCell.Value <> ""
   CustNo = ActiveCell.Offset(0, 2).Value
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   ActiveCell.Value = " Customer : " & ActiveCell.Offset(2, 3).Value & "    ( # " & ActiveCell.Offset(2, 2).Value & " )"
   ActiveCell.Offset(2, 0).Select
   Do While ActiveCell.Offset(0, 2).Value = CustNo
     ReceiptNo = ActiveCell.Value
     I = ActiveCell.Row
    Do While ActiveCell.Value = ReceiptNo And ActiveCell.Offset(0, 2).Value = CustNo
      ActiveCell.Offset(0, 11).Value = ActiveCell.Offset(0, 10).Value & ActiveCell.Offset(0, 11).Value
      ActiveCell.Offset(1, 0).Select
    Loop
    J = ActiveCell.Row - 1
    If J > I Then Range(Cells(I + 1, 1), Cells(J, 11)).ClearContents
    ActiveCell.EntireRow.Insert
    ActiveCell.Offset(1, 0).Select
   Loop
   ActiveCell.EntireRow.Insert
   Worksheets("Report").Activate
    Range(Cells(J + 13, 1), Cells(J + 13, 9)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
    End With
   Worksheets("TempRP").Activate
   Cells(J + 3, 1).Select
  Loop
  Columns("K").Delete
  Columns("H").Delete
  Columns("C:D").Delete
  ActiveSheet.UsedRange.Copy
  Worksheets("Report").Activate
  Range("A13").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  GoTo Finish
End If
FinishDate:
    ThisWorkbook.Worksheets("Report").Activate
    Range("C7:D7").Select
    Selection.EntireColumn.Insert
    Columns("C:C").Select
    With Selection
        .ColumnWidth = 13
        .HorizontalAlignment = xlCenter
        .NumberFormat = "@"
    End With
    Columns("D:D").Select
    With Selection
        .ColumnWidth = 30
        .HorizontalAlignment = xlLeft
        .NumberFormat = "@"
    End With
    Range("C10").Value = "Customer #"
    Range("C11").Value = "----------------"
    Range("D10").Value = "Customer name"
    Range("D11").Value = "---------------------------------------"
 Worksheets("TempRP").Activate
 If Range("A1").Value = "" Then GoTo Finish
 ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("A1") _
        , Order2:=xlAscending, Key3:=Range("L1"), Order3:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 Range("A1").Select
   I = 1
  Do While ActiveCell.Value <> ""
   ReceiptNo = ActiveCell.Value
   Do While ActiveCell.Value = ReceiptNo
    ActiveCell.Offset(0, 11).Value = ActiveCell.Offset(0, 10).Value & ActiveCell.Offset(0, 11).Value
    ActiveCell.Offset(1, 0).Select
   Loop
   J = ActiveCell.Row - 1
   If J > I Then Range(Cells(I + 1, 1), Cells(J, 11)).ClearContents
   ActiveCell.EntireRow.Insert
   I = J + 2
   Cells(J + 2, 1).Select
  Loop
  Columns("K").Delete
  Columns("H").Delete
  ActiveSheet.UsedRange.Copy
  Worksheets("Report").Activate
  Range("A13").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
Finish:
 ThisWorkbook.Worksheets("Report").Activate
 If UserForm16.OptionButton3.Value = True Or UserForm16.OptionButton1.Value = True Then
    Range("F1:F7").HorizontalAlignment = xlCenter
    Range("F1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("F2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("F3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("F4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("F6").Value = "Customer Payment Report"
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "     To : " & Format(EndDate, "yyyy/mm/dd")
  If UserForm16.OptionButton3.Value = True Then
    Range("F7").Value = " ( Sorted by Customer Number ) "
  Else
    Range("F6").Value = " ( Payment Record for " & UserForm16.Label11.Caption & " ) "
  End If
     Range("A1:I22").Select
    ActiveWindow.Zoom = True
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
Else
    Range("F1:F7").HorizontalAlignment = xlCenter
    Range("F1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("F2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("F3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("F4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("F6").Value = "Customer Payment Report"
    Range("F7").Value = " ( Sorted by Payment Date )"
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "     To : " & Format(EndDate, "yyyy/mm/dd")
    Range("A1:K28").Select
    ActiveWindow.Zoom = True
    On Error GoTo NoPrinter1
    With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter1:
End If
 Unload UserForm16
 ThisWorkbook.Worksheets("Report").Activate
 SheetName = "Report"
 OldForm = "UserForm8"
 If Range("A13").Value = "" Then Range("D13").Value = " No Data for the selected period and Customer. "
End Sub

Sub Form17Text6Exit(RunCode As String)
Dim PartNo As String, SupplierNo As String, I As Long, FRow As Long, LRow As Long, Tbl As Range, CheckRange As Range
Dim AssetAcctCK As Variant, ExpenseAcctCK As Variant
If RunCode <> "SUPPLY" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
If UserForm17.TextBox1.Text = "" Or UserForm17.TextBox6.Text = "" Then Exit Sub
 Application.EnableEvents = False
    PartNo = UserForm17.TextBox1.Text
    SupplierNo = UserForm17.TextBox6.Text
   If MyBook.Worksheets("Supply Data").Range("D3").Value <> "" Then
     If IsError(Application.Match(PartNo, MyBook.Worksheets("Supply Data").Columns("D"), 0)) Then GoTo Finish
     If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supply Data").Columns("A"), 0)) Then GoTo Finish
     ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
     MyBook.Worksheets("Supply Data").UsedRange.Copy
     ThisWorkbook.Worksheets("TempRP").Activate
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Set Tbl = ActiveSheet.UsedRange
      Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
      Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Set CheckRange = Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Columns("D")
      FRow = Application.Match(PartNo, CheckRange, 0) + 2
      LRow = Application.Match(PartNo, CheckRange, 1) + 2
      I = FRow
      Do While I <= LRow
       If UserForm17.TextBox6.Text = Cells(I, 1).Value Then Exit Do
       I = I + 1
      Loop
    If I <= LRow Then
       Cells(I, 4).Select
       UserForm17.TextBox2.Text = ActiveCell.Offset(0, 1).Value
       UserForm17.TextBox3.Text = Format(ActiveCell.Offset(0, 2).Value, "#,##0.00##################")
       UserForm17.Label11.Caption = " Last Update : " & Format(ActiveCell.Offset(0, -1).Value, "yyyy/mm/dd")
       UserForm17.Label11.Visible = True
      If ActiveCell.Offset(0, 5).Value = "Yes" Then
       UserForm17.ComboBox2.Value = ActiveCell.Offset(0, 6).Value
       AssetAcctCK = ActiveCell.Offset(0, 6).Value
       UserForm17.TextBox5.Text = ActiveCell.Offset(0, 7).Value
       UserForm17.OptionButton1.Value = True
       UserForm17.Label6.Visible = True
       UserForm17.ComboBox2.Visible = True
       UserForm17.Label14.Visible = True
       UserForm17.Label5.Visible = False
       UserForm17.ComboBox1.Visible = False
       UserForm17.Label13.Visible = False
       UserForm17.Label19.Visible = True
       UserForm17.TextBox5.Visible = True
       UserForm17.CommandButton8.Visible = True
       UserForm17.Label20.Visible = True
       UserForm17.Label7.Visible = True
       UserForm17.Label8.Visible = True
      Else
       UserForm17.ComboBox1.Value = ActiveCell.Offset(0, 3).Value
       ExpenseAcctCK = ActiveCell.Offset(0, 3).Value
       UserForm17.TextBox5.Text = ""
       UserForm17.OptionButton2.Value = True
       UserForm17.Label6.Visible = False
       UserForm17.ComboBox2.Visible = False
       UserForm17.Label14.Visible = False
       UserForm17.Label5.Visible = True
       UserForm17.ComboBox1.Visible = True
       UserForm17.Label13.Visible = True
       UserForm17.Label19.Visible = False
       UserForm17.TextBox5.Visible = False
       UserForm17.CommandButton8.Visible = False
       UserForm17.Label20.Visible = False
       UserForm17.Label7.Visible = False
       UserForm17.Label8.Visible = False
      End If
      MyBook.Worksheets("Chart of Account").Activate
      Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
      If ExpenseAcctCK <> "" Then
        I = Application.Match(ExpenseAcctCK, COARange, 0) + 9
        UserForm17.Label13.Caption = Worksheets("Chart of Account").Cells(I, 2)
      Else
        UserForm17.Label13.Caption = ""
      End If
      If AssetAcctCK <> "" Then
         I = Application.Match(AssetAcctCK, COARange, 0) + 9
         UserForm17.Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
      Else
        UserForm17.Label14.Caption = ""
      End If
    End If
   End If
   Application.EnableEvents = True
   Exit Sub
Finish:
   If UserForm17.OptionButton1.Value = True Then
       UserForm17.OptionButton1.Value = True
       UserForm17.Label6.Visible = True
       UserForm17.ComboBox2.Visible = True
       UserForm17.Label14.Visible = True
       UserForm17.Label5.Visible = False
       UserForm17.ComboBox1.Visible = False
       UserForm17.Label13.Visible = False
       UserForm17.Label19.Visible = True
       UserForm17.TextBox5.Visible = True
       UserForm17.CommandButton8.Visible = True
       UserForm17.Label20.Visible = True
      Else
       UserForm17.Label6.Visible = False
       UserForm17.ComboBox2.Visible = False
       UserForm17.Label14.Visible = False
       UserForm17.Label5.Visible = True
       UserForm17.ComboBox1.Visible = True
       UserForm17.Label13.Visible = True
       UserForm17.Label19.Visible = False
       UserForm17.TextBox5.Visible = False
       UserForm17.CommandButton8.Visible = False
       UserForm17.Label20.Visible = False
       UserForm17.Label7.Visible = False
       UserForm17.Label8.Visible = False
      End If
Application.EnableEvents = True
End Sub

Sub POTempFormat(RunCode As String)
Dim I As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
  InvStatus = "*"
  PartStartRow = 0
  SupplierNo = ""
  SupplierName = ""
  Address1 = ""
  Address2 = ""
  Address3 = ""
  CustContact = ""
  TelNo = ""
  PayTerm = ""
  SalesRep = ""
  OSAmt = 0
  TotalAmount = 0
  InvDate = Date
  DueDate = Date
 For I = 1 To 49
  UserForm15.Controls("TextBox" & I).Text = ""
 Next I
For I = 26 To 40
UserForm15.Controls("Label" & I).Caption = ""
Next I
UserForm15.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
If UserForm15.Label1.Caption = "DEBIT NOTE" Or UserForm15.Label1.Caption = "DEBIT NOTE " Then
  UserForm15.TextBox2.Text = Right(PONo, 5)
  UserForm15.Label58.Visible = True
  UserForm15.TextBox2.Left = 366
  UserForm15.TextBox2.Width = 90
ElseIf Left(PONo, 1) = "P" And Right(PONo, 1) <> " " Then
  UserForm15.TextBox2.Text = Right(PONo, 6)
  UserForm15.CommandButton19.Visible = True
  UserForm15.Label58.Visible = True
  UserForm15.TextBox2.Left = 366
  UserForm15.TextBox2.Width = 90
Else
  UserForm15.TextBox2.Text = PONo
  UserForm15.CommandButton19.Visible = True
  UserForm15.Label58.Visible = False
  UserForm15.TextBox2.Left = 342
  UserForm15.TextBox2.Width = 114
End If
UserForm15.Label26.Caption = Format(TotalAmount, "#,##0.00")
UserForm15.Label11.Caption = "Unit Price " & Chr(13) & "(" & SysCurrency & ")"
UserForm15.Label12.Caption = "Discounted " & Chr(13) & " Amt (" & SysCurrency & ")"
UserForm15.Label24.Caption = "Total " & "(" & SysCurrency & ") : "
UserForm15.Label44.Caption = "Available Credit Amount " & "(" & SysCurrency & ") : "
  MyBook.Worksheets("COmData").Activate
  If Range("K10").Value <> "" Then
    DelName = Range("L10").Value
    DelAddress1 = Range("M10").Value
    DelAddress2 = Range("N10").Value
    DelAddress3 = Range("O10").Value
    DelContact = Range("P10").Value
  End If
  UserForm15.Label3.Caption = "Supplier : -   "
   UserForm15.TextBox41.Text = DelName
   UserForm15.TextBox42.Text = DelAddress1
   UserForm15.TextBox43.Text = DelAddress2
   UserForm15.TextBox44.Text = DelAddress3
   UserForm15.TextBox45.Text = DelContact
UserForm15.ScrollBar1.Max = 15
UserForm15.ScrollBar1.Min = 1
UserForm15.ScrollBar1.Value = 1
UserForm15.CommandButton11.Visible = False
UserForm15.CommandButton13.Visible = False
UserForm15.CommandButton17.Visible = False
UserForm15.Label23.Visible = False
UserForm15.CheckBox1.Value = False
UserForm15.CheckBox1.Visible = False
UserForm15.TextBox48.Visible = False
UserForm15.Label47.Visible = False
UserForm15.Label48.Visible = False
UserForm15.TextBox50.Visible = False
UserForm15.Label55.Visible = False
UserForm15.Label56.Visible = False
UserForm15.Label57.Visible = False
UserForm15.Label50.Visible = False
UserForm15.TextBox35.Visible = False
UserForm15.TextBox36.Visible = False
UserForm15.TextBox37.Visible = False
UserForm15.TextBox38.Visible = False
UserForm15.TextBox39.Visible = False
UserForm15.TextBox40.Visible = False
UserForm15.CommandButton17.Visible = False
UserForm15.Label46.Visible = False
UserForm15.Label42.Visible = False
UserForm15.Label33.Visible = False
UserForm15.Label34.Visible = False
UserForm15.Label35.Visible = False
UserForm15.Label36.Visible = False
UserForm15.Label37.Visible = False
UserForm15.Label38.Visible = False
UserForm15.Label54.Visible = False
UserForm15.Label39.Left = 120
UserForm15.Label39.Width = 120
UserForm15.Label39.Caption = ""
UserForm15.TextBox51.Text = ""
UserForm15.TextBox51.Visible = False
UserForm15.TextBox52.Visible = False
UserForm15.TextBox52.Text = ""
UserForm15.CommandButton20.Visible = False
If UserForm15.Label1.Caption = "PURCHASE ORDER" Then UserForm15.Label39.Visible = True
UserForm15.CommandButton20.Visible = False
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
   UserForm15.CommandButton1.Visible = False
Else
   UserForm15.CommandButton1.Visible = True
End If
End Sub

Sub Form15Text1Exit(RunCode As String)
Dim SuppRow As Long, CreditSum As Double, FRow As Long, LRow As Long
 If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If UserForm15.Label1.Caption = "PURCHASE ORDER" Then
  UserForm15.Label39.Visible = True
  UserForm15.Label39.Left = 120
  UserForm15.Label39.Width = 120
  UserForm15.TextBox51.Visible = False
  UserForm15.TextBox51.Text = ""
  UserForm15.TextBox52.Visible = False
  UserForm15.TextBox52.Text = ""
End If
If UserForm15.TextBox1.Text = "" Then
 PartStartRow = 0
 SupplierNo = ""
 SupplierName = ""
 Address1 = ""
 Address2 = ""
 Address3 = ""
 CustContact = ""
 TelNo = ""
 SalesRep = ""
 PayTerm = ""
 UserForm15.Label39.Left = 120
 UserForm15.Label39.Width = 120
 UserForm15.Label39.Caption = ""
 UserForm15.TextBox51.Text = ""
 UserForm15.TextBox51.Visible = False
 UserForm15.Label3.Caption = "Supplier : -  "
 UserForm15.CommandButton4.Visible = False
 Exit Sub
End If
 SupplierNo = UCase(UserForm15.TextBox1.Text)
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
  End If
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
UserForm15.TextBox1.Text = SupplierNo
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) = True Then
 PartStartRow = 0
 SupplierNo = ""
 SupplierName = ""
 Address1 = ""
 Address2 = ""
 Address3 = ""
 CustContact = ""
 TelNo = ""
 SalesRep = ""
 PayTerm = ""
 UserForm15.Label39.Left = 120
 UserForm15.Label39.Width = 120
 UserForm15.Label39.Caption = ""
 UserForm15.TextBox51.Text = ""
 UserForm15.TextBox51.Visible = False
 UserForm15.Label3.Caption = "Supplier : -  "
 UserForm15.Label23.Caption = Chr(13) & "    The supplier number is not found in the Record"
 UserForm15.Label23.Visible = True
 UserForm15.CommandButton4.Visible = False
 Exit Sub
Else
 SuppRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
 MyBook.Worksheets("Supplier Data").Activate
 Cells(SuppRow, 2).Select
 SupplierNo = ActiveCell.Value
 SupplierName = ActiveCell.Offset(0, 1).Value
 Address1 = ActiveCell.Offset(0, 3).Value
 Address2 = ActiveCell.Offset(0, 4).Value
 Address3 = ActiveCell.Offset(0, 5).Value
 CreditSum = ActiveCell.Offset(0, 6).Value
 CustContact = ActiveCell.Offset(0, 8).Value
 TelNo = ""
 SalesRep = ActiveCell.Offset(0, 12).Value
 PayTerm = ActiveCell.Offset(0, 14).Value

 UserForm15.Label3.Caption = "Supplier :-   " & Chr(13) & "     " & SupplierName & Chr(13) & _
 "     " & Address1 & Chr(13) & _
 "     " & Address2 & Chr(13) & _
 "     " & Address3 & Chr(13) & _
 "     Contact: " & CustContact
 UserForm15.TextBox46.Text = SalesRep
 UserForm15.Label39.Caption = PayTerm
  UserForm15.Label39.Left = 120
 UserForm15.Label39.Width = 120
 UserForm15.TextBox51.Text = ""
 UserForm15.TextBox51.Visible = False
 ThisWorkbook.Worksheets("TempRP").UsedRange.ClearContents
 Call Form15ReFresh("")
End If
  UserForm15.ListBox1.Visible = False
  UserForm15.Label23.Visible = False
  UserForm15.CommandButton4.Visible = True
  Call Form15AmountRefresh("")
  Call Form15PartList("")
End Sub
 
Sub Form15Col1Exit(Source As String)
Dim ProductNo As String, ProductDes As String, EndNo As Long, UnitPrice As Double, ProductAcct As String
Dim RowNo As Long, I As Long, CheckRange As Range, OldLineNo As Long, LineNo As Long, LowQtyLine As Long
Dim LowQtyFlag As String, LowValueFlag As String, StockQty As Double, StockAmt As Double, LowValueLine As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (UserForm15.Label1.Caption = "PURCHASE ORDER" Or UserForm15.Label1.Caption = "DEBIT NOTE") Then
 UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 4).Value
 Exit Sub
End If
 If Not (Cells(Form15RowNo + 42, 11).Value = "" Or Cells(Form15RowNo + 42, 11).Value = 0) Then
  If UCase(ProductNo) <> UCase(Cells(Form15RowNo + 42, 4).Value) Then
   UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 4).Value
   UserForm15.Label23.Caption = Chr(13) & "     Delivery of this item has been received.   Change to the item detail is not allowed"
   UserForm15.Label23.Visible = True
   Exit Sub
  End If
 End If
ProductNo = UserForm15.Controls("TextBox" & Form15TextNo).Text
If Left(ProductNo, 1) = " " Then
 I = Len(ProductNo)
 J = 1
 Do While J <= I And Mid(ProductNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then ProductNo = ""
  ProductNo = Right(ProductNo, I - J + 1)
End If
If Right(ProductNo, 1) = " " Then
 I = Len(ProductNo)
 J = I
 Do While J > 0 And Mid(ProductNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then ProductNo = ""
  ProductNo = Left(ProductNo, J)
End If
ProductNo = UCase(ProductNo)
UserForm15.Controls("TextBox" & Form15TextNo).Text = ProductNo
If Cells(Form15RowNo + 42, 4).Value = ProductNo Then GoTo NoScreenUpdate

   If UserForm15.Label1.Caption = "DEBIT NOTE" Then
    If Cells(Form15RowNo + 42, 15).Value <> "" And Cells(Form15RowNo + 42, 16).Value < 0 And Cells(Form15RowNo + 42, 17).Value = "" Then
     StockNo = Cells(Form15RowNo + 42, 15).Value
     Cells(Form15RowNo + 41, 4).Select
     Do While ActiveCell.Value <> ""
      If ActiveCell.Offset(0, 11).Value = StockNo Then GoTo ProductDeleteOK
      ActiveCell.offst(-1, 0).Select
     Loop
    UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 4).Value
    UserForm15.Label23.Caption = Chr(13) & "     Change or Deletion of this item will make the Stock Quantity of " & StockNo & " negative" & _
                      Chr(13) & Chr(13) & "     Thus Change or Deletion of this item is not allowed."
    UserForm15.Label23.Visible = True
    Exit Sub
    End If
   End If

ProductDeleteOK:
 If Cells(Form15RowNo + 42, 15).Value <> "" Then
   StockNo = Cells(Form15RowNo + 42, 15).Value
   
   
   If Cells(Form15RowNo + 42, 17).Value = "*" Then
   StockQty = Cells(Form15RowNo + 42, 16).Value
   StockAmt = Cells(Form15RowNo + 42, 19).Value
   Cells(Form15RowNo + 43, 4).Select
   If UserForm15.Label1.Caption = "DEBIT NOTE" Then
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 11).Value = StockNo Then
       ActiveCell.Offset(0, 12).Value = StockQty
       ActiveCell.Offset(0, 15).Value = StockAmt
       StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
       StockAmt = Format(StockAmt - ActiveCell.Offset(0, 5).Value, "0.00")
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   Else
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 11).Value = StockNo Then
       ActiveCell.Offset(0, 12).Value = StockQty
       ActiveCell.Offset(0, 15).Value = StockAmt
       StockQty = Format(StockQty + ActiveCell.Offset(0, 2).Value, "0.0000")
       StockAmt = Format(StockAmt + ActiveCell.Offset(0, 5).Value, "0.00")
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
  Else
   Cells(Form15RowNo + 41, 4).Select
   Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 11).Value = StockNo Then
     ActiveCell.Offset(0, 13).Value = ""
     Exit Do
    End If
    ActiveCell.Offset(-1, 0).Select
   Loop
  End If
 End If
If ProductNo = "" Then
 Cells(Form15RowNo + 42, 3).EntireRow.Delete
 Call Form15ReFresh("")
 Call Form15AmountRefresh("")
Else
 If PartStartRow = 0 Then
  UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
  UserForm15.Controls("TextBox" & Form15TextNo + 1).Text = ""
  UserForm15.Controls("TextBox" & Form15TextNo + 3).Text = ""
  UserForm15.Controls("TextBox" & Form15TextNo + 4).Text = ""
  ThisWorkbook.Worksheets("TempRP").Activate
  Range(Cells(Form15RowNo + 42, 2), Cells(Form15RowNo + 42, 5)).Value = ""
  Range(Cells(Form15RowNo + 42, 7), Cells(Form15RowNo + 42, 16)).Value = ""
   If Cells(Form15RowNo + 43, 4) <> "" Then Cells(Form15RowNo + 42, 4) = " "
  Call Form15ReFresh("")
  Call Form15AmountRefresh("")
  If SupplierNo <> "" Then
     UserForm15.Label23.Caption = Chr(13) & "     The Product is not found from the Purchase Item List"
   Else
     UserForm15.Label23.Caption = Chr(13) & "     The Supplier has not been entered"
   End If
  UserForm15.Label23.Visible = True
  Exit Sub
 End If
  MyBook.Worksheets("Supply Data").Activate
  Set CheckRange = MyBook.Worksheets("Supply Data").Range(Cells(PartStartRow, 4), Cells(PartEndRow, 4))
 If IsError(Application.Match(ProductNo, CheckRange, 0)) Then
  UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
  UserForm15.Controls("TextBox" & Form15TextNo + 1).Text = ""
  UserForm15.Controls("TextBox" & Form15TextNo + 3).Text = ""
  UserForm15.Controls("TextBox" & Form15TextNo + 4).Text = ""
  ThisWorkbook.Worksheets("TempRP").Activate
  Range(Cells(Form15RowNo + 42, 2), Cells(Form15RowNo + 42, 5)).Value = ""
  Range(Cells(Form15RowNo + 42, 7), Cells(Form15RowNo + 42, 16)).Value = ""
   If Cells(Form15RowNo + 43, 4) <> "" Then Cells(Form15RowNo + 42, 4) = " "
  Call Form15ReFresh("")
  Call Form15AmountRefresh("")
  UserForm15.Label23.Caption = Chr(13) & "     The Product is not found from the Purchase list of the specified supplier"
  UserForm15.Label23.Visible = True
  Exit Sub
 End If
  ProdRow = Application.Match(ProductNo, CheckRange, 0) + PartStartRow - 1
  MyBook.Worksheets("Supply Data").Activate
  Cells(ProdRow, 4).Select
  ProductDes = ActiveCell.Offset(0, 1).Value
  UnitPrice = ActiveCell.Offset(0, 2).Value
 If ActiveCell.Offset(0, 5).Value = "Yes" Then
    StockNo = ActiveCell.Offset(0, 7).Value
    If StockNo = "" Then
      UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
      UserForm15.Controls("TextBox" & Form15TextNo + 1).Text = ""
      UserForm15.Controls("TextBox" & Form15TextNo + 3).Text = ""
      UserForm15.Controls("TextBox" & Form15TextNo + 4).Text = ""
      ThisWorkbook.Worksheets("TempRP").Activate
      Range(Cells(Form15RowNo + 42, 2), Cells(Form15RowNo + 42, 16)).EntireRow.Delete
      Call Form15ReFresh("")
      Call Form15AmountRefresh("")
       MsgBox ("ALERT : " & Chr(13) & ProductNo & " is a stock item. But the stock # is not found from the Record" & _
         Chr(13) & Chr(13) & "Please setup the Part data before proceed")
       Exit Sub
    End If
    If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
          UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
          UserForm15.Controls("TextBox" & Form15TextNo + 1).Text = ""
          UserForm15.Controls("TextBox" & Form15TextNo + 3).Text = ""
          UserForm15.Controls("TextBox" & Form15TextNo + 4).Text = ""
          ThisWorkbook.Worksheets("TempRP").Activate
          Range(Cells(Form15RowNo + 42, 2), Cells(Form15RowNo + 42, 16)).EntireRow.Delete
          Call Form15ReFresh("")
          Call Form15AmountRefresh("")
          MsgBox ("ALERT : " & Chr(13) & ProductNo & " is a stock item. But the stock # is not found from the Stock Item List" & _
           Chr(13) & Chr(13) & "Please setup the Stock item before proceed")
          Exit Sub
    End If
    I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
    ProductAcct = MyBook.Worksheets("StockRec").Cells(I, 5).Value
    StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
    StockAmt = MyBook.Worksheets("StockRec").Cells(I, 9).Value
    ThisWorkbook.Worksheets("TempRP").Activate
     Range(Cells(Form15RowNo + 42, 2), Cells(Form15RowNo + 42, 3)).NumberFormat = "General"
     Range(Cells(Form15RowNo + 42, 4), Cells(Form15RowNo + 42, 5)).NumberFormat = "@"
     Range(Cells(Form15RowNo + 42, 6), Cells(Form15RowNo + 42, 19)).NumberFormat = "General"
     Cells(Form15RowNo + 42, 2).Value = "NEW"
     Cells(Form15RowNo + 42, 3).Value = ProductAcct
     Cells(Form15RowNo + 42, 4).Value = ProductNo
     Cells(Form15RowNo + 42, 5).Value = ProductDes
     Cells(Form15RowNo + 42, 7).Value = UnitPrice
     Cells(Form15RowNo + 42, 14).Value = "Yes"
     Cells(Form15RowNo + 42, 15).NumberFormat = "@"
     Cells(Form15RowNo + 42, 15).Value = StockNo
     Cells(Form15RowNo + 42, 16).Value = StockQty
     Cells(Form15RowNo + 42, 19).Value = StockAmt
  Cells(Form15RowNo + 42, 9).Value = Round(Cells(Form15RowNo + 42, 6).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
       Cells(Form15RowNo + 41, 15).Select
       If UserForm15.Label1.Caption = "DEBIT NOTE" Then
        Do While ActiveCell.Row > 14
         If ActiveCell.Value = StockNo Then
          StockQty = Format(ActiveCell.Offset(0, 1).Value - ActiveCell.Offset(0, -9).Value, "0.0000")
          StockAmt = Format(ActiveCell.Offset(0, 4).Value - ActiveCell.Offset(0, -6).Value, "0.00")
          Cells(Form15RowNo + 42, 16).Value = StockQty
          Cells(Form15RowNo + 42, 19).Value = StockAmt
          ActiveCell.Offset(0, 2).Value = "*"
          Exit Do
         End If
         ActiveCell.Offset(-1, 0).Select
        Loop
        LowQtyFlag = ""
        LowValueFlag = ""
        StockQty = Format(Cells(Form15RowNo + 42, 16).Value - Cells(Form15RowNo + 42, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form15RowNo + 42, 19).Value - Cells(Form15RowNo + 42, 9).Value, "0.00")
        If StockQty < 0 Then LowQtyFlag = ProductNo
        If StockAmt < 0 Then LowValueFlag = ProductNo
        Cells(Form15RowNo + 43, 4).Select
        LowQtyLine = Form15RowNo + 42
        LowValueLine = Form15RowNo + 42
        Do While ActiveCell.Value <> ""
         If ActiveCell.Offset(0, 11).Value = StockNo Then
          Cells(LowQtyLine, 17).Value = "*"
          LowQtyFlag = ""
          LowValueFlag = ""
          ActiveCell.Offset(0, 12).Value = StockQty
          ActiveCell.Offset(0, 15).Value = StockAmt
          StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
          StockAmt = Format(StockAmt - ActiveCell.Offset(0, 5).Value, "0.00")
          LowQtyLine = ActiveCell.Row
          LowValueLine = ActiveCell.Row
          If StockQty < 0 Then LowQtyFlag = ActiveCell.Value
          If StockAmt < 0 Then LowValueFlag = ActiveCell.Value
         End If
         ActiveCell.Offset(1, 0).Select
        Loop
       Else
        Do While ActiveCell.Row > 14
         If ActiveCell.Value = StockNo Then
          StockQty = Format(ActiveCell.Offset(0, 1).Value + ActiveCell.Offset(0, -9).Value, "0.0000")
          Cells(Form15RowNo + 42, 16).Value = StockQty
          ActiveCell.Offset(0, 2).Value = "*"
          Exit Do
         End If
         ActiveCell.Offset(-1, 0).Select
        Loop
        StockQty = Format(Cells(Form15RowNo + 42, 16).Value + Cells(Form15RowNo + 42, 6).Value, "0.0000")
        Cells(Form15RowNo + 43, 4).Select
        LowQtyLine = Form15RowNo + 42
        Do While ActiveCell.Value <> ""
         If ActiveCell.Offset(0, 11).Value = StockNo Then
          Cells(LowQtyLine, 17).Value = "*"
          ActiveCell.Offset(0, 12).Value = StockQty
          StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
          LowQtyLine = ActiveCell.Row
         End If
         ActiveCell.Offset(1, 0).Select
        Loop
       End If
  Else
    ProductAcct = ActiveCell.Offset(0, 3).Value
    StockNo = ""
    ThisWorkbook.Worksheets("TempRP").Activate
    Range(Cells(Form15RowNo + 42, 14), Cells(Form15RowNo + 42, 17)).ClearContents
    Range(Cells(Form15RowNo + 42, 2), Cells(Form15RowNo + 42, 3)).NumberFormat = "General"
    Range(Cells(Form15RowNo + 42, 4), Cells(Form15RowNo + 42, 5)).NumberFormat = "@"
    Range(Cells(Form15RowNo + 42, 6), Cells(Form15RowNo + 42, 11)).NumberFormat = "General"
    Cells(Form15RowNo + 42, 2).Value = "NEW"
    Cells(Form15RowNo + 42, 3).Value = ProductAcct
    Cells(Form15RowNo + 42, 4).Value = ProductNo
    Cells(Form15RowNo + 42, 5).Value = ProductDes
    Cells(Form15RowNo + 42, 7).Value = UnitPrice
  End If
 UserForm15.Controls("TextBox" & Form15TextNo).Text = ProductNo
 UserForm15.Controls("TextBox" & Form15TextNo + 1).Text = ProductDes
 UserForm15.Controls("TextBox" & Form15TextNo + 3).Text = UnitPrice
  ThisWorkbook.Worksheets("TempRP").Activate
  UserForm15.Controls("TextBox" & Form15TextNo + 2).Text = Cells(Form15RowNo + 42, 6).Value
  UserForm15.Controls("TextBox" & Form15TextNo + 3).Text = Cells(Form15RowNo + 42, 7).Value
  UserForm15.Controls("Label" & (Form15TextNo / 5) + 26).Caption = Format(Cells(Form15RowNo + 42, 9).Value, "#,##0.00")
 Range("C43").Select
 J = 0
 For I = 1 To Form15RowNo
  If ActiveCell.Value = "" Then
   ActiveCell.EntireRow.Delete
   J = J + 1
  Else
   ActiveCell.Offset(1, 0).Select
  End If
 Next I
 Do While ActiveCell.Offset(0, 1).Value <> ""
  If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
  Else
   ActiveCell.Offset(1, 0).Select
  End If
 Loop
 If Source = "List" Then
    OldLineNo = UserForm15.ScrollBar1.Value
    If Form15RowNo - J - OldLineNo < 0 Then
     UserForm15.Controls("TextBox" & Form15TextNo + 2).SetFocus
     Source = "Jump"
    Else
     UserForm15.Controls("TextBox" & (Form15RowNo - J - OldLineNo) * 5 + 7).SetFocus
    End If
  End If
 If J <> 0 Then
  Range("B43").Select
  For I = 1 To 20
   If ActiveCell.Value = "NEW" Then Exit For
   ActiveCell.Offset(1, 0).Select
  Next I
   If I > 20 Then GoTo NoScreenUpdate
   J = ActiveCell.Row
   RowNo = Form15TextNo / 5
  If J > RowNo + 42 Then
    UserForm15.ScrollBar1.Value = J - RowNo - 41
  Else
   ThisWorkbook.Worksheets("TempRP").Activate
   For I = 1 To 6
    UserForm15.Controls("Label" & I + 14).Caption = I
    UserForm15.Controls("TextBox" & I * 5).Text = Cells(42 + I, 4).Value
    UserForm15.Controls("TextBox" & I * 5 + 1).Text = Cells(42 + I, 5).Value
    UserForm15.Controls("TextBox" & I * 5 + 2).Text = Cells(42 + I, 6).Value
    UserForm15.Controls("TextBox" & I * 5 + 3).Text = Cells(42 + I, 7).Value
    UserForm15.Controls("TextBox" & I * 5 + 4).Text = Cells(42 + I, 8).Value
    UserForm15.Controls("Label" & I + 26).Caption = Format(Cells(42 + I, 9).Value, "#,##0.00")
    UserForm15.Controls("Label" & I + 32).Caption = Cells(42 + I, 11).Value
    UserForm15.Controls("TextBox" & I + 34).Text = Cells(42 + I, 12).Value
   Next I
   UserForm15.ScrollBar1.Value = 1
  End If
 End If
End If
NoScreenUpdate:
 Range("B43:B63").ClearContents
If Form15TextNo = 30 And UserForm15.TextBox30.Text <> "" Then
 If Cells(Form15RowNo + 43, 3).Value = "" And UserForm15.ScrollBar1.Value < 15 Then UserForm15.ScrollBar1.Value = UserForm15.ScrollBar1.Value + 1
End If
 If Source = "List" Then
    LineNo = UserForm15.ScrollBar1.Value
    If LineNo > OldLineNo Then
     For I = OldLineNo To LineNo - 1
      SendKeys "{Up}", False
     Next I
    End If
    If LineNo < OldLineNo Then
     For I = LineNo To OldLineNo - 1
      SendKeys "{Down}", False
     Next I
    End If
  End If
If Source <> "List" And UserForm15.Controls("Textbox" & Form15TextNo).Text = "" Then
  I = Form15TextNo
  Do While I > 5 And UserForm15.Controls("Textbox" & I).Text = ""
   SendKeys "{UP}", False
   I = I - 5
  Loop
End If
  Call Form15AmountRefresh("")
If LowValueFlag <> "" Then
   UserForm15.Label23.Caption = Chr(13) & "   The Book value for the stock of " & ProductNo & " will become negative"
   UserForm15.Label23.Visible = True
ElseIf LowQtyFlag <> "" Then
   UserForm15.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & ProductNo
   UserForm15.Label23.Visible = True
End If
End Sub
Sub Form15PartList(RunCode As String)
Dim Tbl As Range, CheckRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  UserForm15.ListBox2.Clear
  MyBook.Worksheets("Supply Data").Activate
On Error Resume Next
 If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
  If SupplierNo <> "" Then
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Columns("A")
   If IsError(Application.Match(SupplierNo, CheckRange, 0)) Then
      PartStartRow = 0
      PartEndRow = 0
      UserForm15.ListBox2.AddItem "No Record of Purchase items for the selected supplier"
   Else
     PartStartRow = Application.Match(SupplierNo, CheckRange, 0) + 2
     PartEndRow = Application.Match(SupplierNo, CheckRange, 1) + 2
     If PartEndRow < PartStartRow Then PartEndRow = PartStartRow
     I = PartStartRow
     Cells(I, 4).Select
     UserForm15.ListBox2.AddItem "SWITCH to listing by Part Description"
    Do While I <= PartEndRow
      UserForm15.ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
      ActiveCell.Offset(1, 0).Select
      I = I + 1
    Loop
   End If
  End If
 Else
   UserForm15.ListBox2.AddItem "No Record of Purchase items for the selected supplier"
 End If
 On Error GoTo 0
  UserForm15.ListBox2.AddItem "CLOSE this box"
  UserForm15.ListBox2.Visible = False
End Sub

Sub Form15ReFresh(RunCode As String)
Dim RowNo As Long, LineNo As Long
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 RowNo = Val(UserForm15.Label15.Caption)
 LineNo = UserForm15.ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
For I = 1 To 6
   UserForm15.Controls("Label" & I + 14).Caption = I - 1 + LineNo
   UserForm15.Controls("TextBox" & I * 5).Text = Cells(41 + I + LineNo, 4).Value
   UserForm15.Controls("TextBox" & I * 5 + 1).Text = Cells(41 + I + LineNo, 5).Value
   UserForm15.Controls("TextBox" & I * 5 + 2).Text = Cells(41 + I + LineNo, 6).Value
   UserForm15.Controls("TextBox" & I * 5 + 3).Text = Cells(41 + I + LineNo, 7).Value
   UserForm15.Controls("TextBox" & I * 5 + 4).Text = Cells(41 + I + LineNo, 8).Value
   UserForm15.Controls("Label" & I + 26).Caption = Format(Cells(41 + I + LineNo, 9).Value, "#,##0.00")
   UserForm15.Controls("Label" & I + 32).Caption = Cells(41 + I + LineNo, 11).Value
   UserForm15.Controls("TextBox" & I + 34).Text = Cells(41 + I + LineNo, 12).Value
  Next I
  UserForm15.Label23.Visible = False
End Sub

Sub Form15AmountRefresh(RunCode As String)
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
  TotalAmount = Application.Sum(Range(Cells(43, 9), Cells(62, 9)))
  TotalAmount = Format(TotalAmount, "0.00")
  UserForm15.Label26.Caption = Format(TotalAmount, "#,##0.00")
End Sub

Sub Form15Col3Exit(RunCode As String)
Dim ProductNo As String, LowQtyFlag As String, LowQtyLine As Long, StockQty As Double, CheckNum As Double
Dim LowValueFlag As String, StockAmt As Double, LowValueLine As Long, ZeroQtyFlag As String
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (UserForm15.Label1.Caption = "PURCHASE ORDER" Or UserForm15.Label1.Caption = "DEBIT NOTE") Then
 UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 6).Value
 Exit Sub
End If
 UserForm15.Label23.Visible = False
 If Cells(Form15RowNo + 42, 6).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text Then Exit Sub
If UserForm15.Controls("TextBox" & Form15TextNo - 2).Text = "" Then
 If UserForm15.Controls("TextBox" & Form15TextNo).Text <> "" Then
  UserForm15.Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  UserForm15.Label23.Visible = True
  Exit Sub
 End If
  Range(Cells(Form15RowNo + 42, 6), Cells(Form15RowNo + 42, 7)).ClearContents
  Call Form15AmountRefresh("")
 SendKeys "+{tab}", False
 SendKeys "+{tab}", False
 Exit Sub
End If
If IsNumeric(UserForm15.Controls("TextBox" & Form15TextNo).Text) = False And UserForm15.Controls("TextBox" & Form15TextNo).Text <> "" Then
  UserForm15.Label23.Caption = Chr(13) & "    Incorrect Quantity Entered"
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 6).Value
  UserForm15.Label23.Visible = True
  Exit Sub
ElseIf UserForm15.Controls("TextBox" & Form15TextNo).Text = "" Then
  If Not (Cells(Form15RowNo + 42, 11).Value = "" Or Cells(Form15RowNo + 42, 11).Value = 0) Then
     UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 6).Value
     UserForm15.Label23.Caption = Chr(13) & "     Delivery of the part item has been made. " & Chr(13) & Chr(13) & "    Amended quantity should not be less than the delivered quantity."
     UserForm15.Label23.Visible = True
     Exit Sub
  End If
  Cells(Form15RowNo + 42, 6).Value = 0
  Cells(Form15RowNo + 42, 8).Value = 0
Else
   CheckNum = Format(UserForm15.Controls("TextBox" & Form15TextNo).Text, "0.0000")
   UserForm15.Controls("TextBox" & Form15TextNo).Text = CheckNum
   If Not (Cells(Form15RowNo + 42, 11).Value = "" Or Cells(Form15RowNo + 42, 11).Value = 0) Then
    If Val(UserForm15.Controls("TextBox" & Form15TextNo).Text) < Cells(Form15RowNo + 42, 11).Value Then
     UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 6).Value
     UserForm15.Label23.Caption = Chr(13) & "     Delivery of the part item has been received. " & Chr(13) & Chr(13) & "    Amended quantity should not be less than the delivered quantity."
     UserForm15.Label23.Visible = True
     Exit Sub
    End If
  End If
   Cells(Form15RowNo + 42, 6).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text
End If
    Cells(Form15RowNo + 42, 9).Value = Round(Cells(Form15RowNo + 42, 6).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
     StockNo = Cells(Form15RowNo + 42, 15).Value
     LowQtyFlag = ""
     ZeroQtyFlag = ""
     LowValueFlag = ""
     If StockNo = "" Then GoTo Finish
     If UserForm15.Label1.Caption = "DEBIT NOTE" Then
        StockQty = Format(Cells(Form15RowNo + 42, 16).Value - Cells(Form15RowNo + 42, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form15RowNo + 42, 19).Value - Cells(Form15RowNo + 42, 9).Value, "0.00")
      If Cells(Form15RowNo + 42, 17).Value = "*" Then
         Cells(Form15RowNo + 43, 4).Select
       Do While ActiveCell.Value <> ""
        If ActiveCell.Offset(0, 11).Value = StockNo Then
         ActiveCell.Offset(0, 12).Value = StockQty
         ActiveCell.Offset(0, 15).Value = StockAmt
         LowValueFlag = ""
         LowValueFlag = ""
         ZeroQtyFlag = ""
         StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
         StockAmt = Format(StockAmt - ActiveCell.Offset(0, 5).Value, "0.00")
         If StockQty < 0 Then
          LowQtyFlag = Cells(Form15RowNo + 42, 4).Value
         ElseIf StockQty = 0 And StockAmt <> 0 Then
          ZeroQtyFlag = Cells(Form15RowNo + 42, 4).Value
         ElseIf StockAmt < 0 Then
          LowValueFlag = Cells(Form15RowNo + 42, 4).Value
         End If
         If ActiveCell.Offset(0, 13).Value = "" Then Exit Do
        End If
        ActiveCell.Offset(1, 0).Select
       Loop
      Else
       If StockQty < 0 Then
         LowQtyFlag = Cells(Form15RowNo + 42, 4).Value
       ElseIf StockQty = 0 And StockAmt <> 0 Then
         ZeroQtyFlag = Cells(Form15RowNo + 42, 4).Value
       ElseIf StockAmt < 0 Then
         LowValueFlag = Cells(Form15RowNo + 42, 4).Value
       End If
      End If
     Else
       StockQty = Format(Cells(Form15RowNo + 42, 16).Value + Cells(Form15RowNo + 42, 6).Value, "0.0000")
       Cells(Form15RowNo + 43, 4).Select
       LowQtyLine = Form15RowNo + 42
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 11).Value = StockNo Then
        Cells(LowQtyLine, 17).Value = "*"
        ActiveCell.Offset(0, 12).Value = StockQty
        StockQty = Format(StockQty + ActiveCell.Offset(0, 2).Value, "0.0000")
        LowQtyLine = ActiveCell.Row
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
     End If
 If LowQtyFlag <> "" Then
    UserForm15.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & LowQtyFlag
    UserForm15.Label23.Visible = True
 ElseIf ZeroQtyFlag <> "" Then
    UserForm15.Label23.Caption = Chr(13) & "   The Stock quantity for " & ZeroQtyFlag & " will become zero. " & _
                                 Chr(13) & "   But the book value will not be zero.  "
    UserForm15.Label23.Visible = True
 ElseIf LowValueFlag <> "" Then
    UserForm15.Label23.Caption = Chr(13) & "   The book value for " & LowValueFlag & " will become negative. "
    UserForm15.Label23.Visible = True
 End If
Finish:
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 6).Value
  UserForm15.Controls("Label" & ((Form15TextNo - 2) / 5) + 26).Caption = Format(Cells(Form15RowNo + 42, 9).Value, "#,##0.00")
  Call Form15AmountRefresh("")
End Sub
Sub Form15Col4Exit(RunCode As String)
 Dim CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  ThisWorkbook.Worksheets("TempRP").Activate
If Not (UserForm15.Label1.Caption = "PURCHASE ORDER" Or UserForm15.Label1.Caption = "DEBIT NOTE") Then
 UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 7).Value
 Exit Sub
End If
 If Cells(Form15RowNo + 42, 7).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text Then Exit Sub
 If Not (Cells(Form15RowNo + 42, 11).Value = "" Or Cells(Form15RowNo + 42, 11).Value = 0) Then
   UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 7).Value
   UserForm15.Label23.Caption = Chr(13) & "     Delivery of the part item has been received.   No change to the unit price is allowed"
   UserForm15.Label23.Visible = True
   Exit Sub
 End If
 If IsNumeric(UserForm15.Controls("TextBox" & Form15TextNo).Text) = False And UserForm15.Controls("TextBox" & Form15TextNo).Text <> "" Then
  Cells(Form15RowNo + 42, 7).Value = 0
  Cells(Form15RowNo + 42, 9).Value = Round(Cells(Form15RowNo + 42, 6).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
  UserForm15.Controls("Label" & ((Form15TextNo - 3) / 5) + 26).Caption = Format(Cells(Form15RowNo + 42, 9).Value, "#,##0.00")
  Call Form15AmountRefresh("")
  UserForm15.Label23.Caption = Chr(13) & "    Incorrect Amount Entered"
  UserForm15.Label23.Visible = True
  Exit Sub
 ElseIf UserForm15.Controls("TextBox" & Form15TextNo).Text = "" Then
  Cells(Form15RowNo + 42, 7).Value = 0
  UserForm15.Label23.Visible = False
 Else
  CheckNum = UserForm15.Controls("TextBox" & Form15TextNo).Text
  UserForm15.Controls("TextBox" & Form15TextNo).Text = CheckNum
  Cells(Form15RowNo + 42, 7).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text
  UserForm15.Label23.Visible = False
 End If
  Cells(Form15RowNo + 42, 9).Value = Round(Cells(Form15RowNo + 42, 6).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 7).Value
  UserForm15.Controls("Label" & ((Form15TextNo - 3) / 5) + 26).Caption = Format(Cells(Form15RowNo + 42, 9).Value, "#,##0.00")
   Call Form15AmountRefresh("")
     StockNo = Cells(Form15RowNo + 42, 15).Value
     If StockNo = "" Then Exit Sub
     If UserForm15.Label1.Caption = "DEBIT NOTE" Then
        StockQty = Format(Cells(Form15RowNo + 42, 16).Value - Cells(Form15RowNo + 42, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form15RowNo + 42, 19).Value - Cells(Form15RowNo + 42, 9).Value, "0.00")
      If Cells(Form15RowNo + 42, 17).Value = "*" Then
         Cells(Form15RowNo + 43, 4).Select
       Do While ActiveCell.Value <> ""
        If ActiveCell.Offset(0, 11).Value = StockNo Then
         ActiveCell.Offset(0, 12).Value = StockQty
         ActiveCell.Offset(0, 15).Value = StockAmt
         StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
         StockAmt = Format(StockAmt - ActiveCell.Offset(0, 5).Value, "0.00")
         If ActiveCell.Offset(0, 13).Value = "" Then Exit Do
        End If
        ActiveCell.Offset(1, 0).Select
       Loop
      End If
     End If
End Sub

Sub Form15Col5Exit(RunCode As String)
Dim CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" And ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
  ThisWorkbook.Worksheets("TempRP").Activate
If Not (UserForm15.Label1.Caption = "PURCHASE ORDER" Or UserForm15.Label1.Caption = "DEBIT NOTE") Then
 UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 8).Value
 Exit Sub
End If
 If Cells(Form15RowNo + 42, 8).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text Then Exit Sub
 If Not (Cells(Form15RowNo + 42, 11).Value = "" Or Cells(Form15RowNo + 42, 11).Value = 0) Then
  UserForm15.Label23.Caption = Chr(13) & "     Delivery of this part item has already been received, no change to the discount rate is allowed"
  UserForm15.Label23.Visible = True
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 8).Value
 Exit Sub
End If
 If IsNumeric(UserForm15.Controls("TextBox" & Form15TextNo).Text) = False And UserForm15.Controls("TextBox" & Form15TextNo).Text <> "" Then
  Cells(Form15RowNo + 42, 8).Value = 0
  Cells(Form15RowNo + 42, 9).Value = Round(Cells(Form15RowNo + 42, 6).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
  UserForm15.Controls("Label" & ((Form15TextNo - 4) / 5) + 26).Caption = Format(Cells(Form15RowNo + 42, 9).Value, "#,##0.00")
  Call Form15AmountRefresh("")
  UserForm15.Label23.Caption = Chr(13) & "    Incorrect Percentage Entered"
  UserForm15.Label23.Visible = True
  Exit Sub
 ElseIf UserForm15.Controls("TextBox" & Form15TextNo).Text = "" Then
  Cells(Form15RowNo + 42, 8).Value = 0
  UserForm15.Label23.Visible = False
 Else
  CheckNum = UserForm15.Controls("TextBox" & Form15TextNo).Text
  UserForm15.Controls("TextBox" & Form15TextNo).Text = CheckNum
  Cells(Form15RowNo + 42, 8).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text
  UserForm15.Label23.Visible = False
 End If
  Cells(Form15RowNo + 42, 9).Value = Round(Cells(Form15RowNo + 42, 6).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 8).Value
  UserForm15.Controls("Label" & ((Form15TextNo - 4) / 5) + 26).Caption = Format(Cells(Form15RowNo + 42, 9).Value, "#,##0.00")
  Call Form15AmountRefresh("")
     StockNo = Cells(Form15RowNo + 42, 15).Value
     If StockNo = "" Then Exit Sub
     If UserForm15.Label1.Caption = "DEBIT NOTE" Then
        StockQty = Format(Cells(Form15RowNo + 42, 16).Value - Cells(Form15RowNo + 42, 6).Value, "0.0000")
        StockAmt = Format(Cells(Form15RowNo + 42, 19).Value - Cells(Form15RowNo + 42, 9).Value, "0.00")
      If Cells(Form15RowNo + 42, 17).Value = "*" Then
         Cells(Form15RowNo + 43, 4).Select
       Do While ActiveCell.Value <> ""
        If ActiveCell.Offset(0, 11).Value = StockNo Then
         ActiveCell.Offset(0, 12).Value = StockQty
         ActiveCell.Offset(0, 15).Value = StockAmt
         StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
         StockAmt = Format(StockAmt - ActiveCell.Offset(0, 5).Value, "0.00")
         If ActiveCell.Offset(0, 13).Value = "" Then Exit Do
        End If
        ActiveCell.Offset(1, 0).Select
       Loop
      End If
     End If
End Sub

Sub Form15Col8Exit(RunCode As String)
Dim ProductNo As String, ProdRow As Long, I As Long, CheckRange As Range, StockQty As Double, LowQtyFlag As String
Dim CheckNum As Double, LowValueFlag As String, StockAmt As Double, LowValueLine As Long, ZeroQtyFlag As String
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
 UserForm15.Label23.Visible = False
 ThisWorkbook.Worksheets("TempRP").Activate
 If Cells(Form15RowNo + 42, 12).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text Then Exit Sub
If UserForm15.Controls("TextBox" & (Form15TextNo - 34) * 5).Text = "" Then
  UserForm15.Label23.Caption = Chr(13) & "    It is an empty line.  No Part Code is found."
  UserForm15.Label23.Visible = True
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 12).Value
  Exit Sub
Else
 ProductNo = UserForm15.Controls("TextBox" & (Form15TextNo - 34) * 5).Text
End If
If Cells(Form15RowNo + 42, 3).Value = "" Then
  MsgBox ("ERROR : " & Chr(13) & ProductNo & " is not found from the Purchase Item record" & _
         Chr(13) & Chr(13) & "Please setup the Part data before proceed")
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 12).Value
  Exit Sub
End If
 If Cells(Form15RowNo + 42, 14) = "Yes" Then
   If Cells(Form15RowNo + 42, 15) = "" Then
     MsgBox ("ERROR : " & Chr(13) & ProductNo & " is a stock item but the stock number " & _
        Chr(13) & "         has been removed from the stock item list." & Chr(13) & Chr(13) & "Please setup the Stock # before proceed")
     UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
     Cells(Form15RowNo + 42, 12).ClearContents
     Cells(Form15RowNo + 42, 13).ClearContents
     Cells(Form15RowNo + 42, 16).ClearContents
     UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
     Exit Sub
   End If
 End If
If IsNumeric(UserForm15.Controls("TextBox" & Form15TextNo).Text) = False And UserForm15.Controls("TextBox" & Form15TextNo).Text <> "" Then
  Cells(Form15RowNo + 42, 12).Value = ""
  Cells(Form15RowNo + 42, 13).Value = ""
  UserForm15.Label23.Caption = Chr(13) & "    Incorrect Quantity Entered"
  UserForm15.Label23.Visible = True
  UserForm15.Controls("TextBox" & Form15TextNo).Text = Cells(Form15RowNo + 42, 12).Value
  Exit Sub
ElseIf UserForm15.Controls("TextBox" & Form15TextNo).Text = "" Or UserForm15.Controls("TextBox" & Form15TextNo).Text = 0 Then
  Cells(Form15RowNo + 42, 12).Value = ""
  Cells(Form15RowNo + 42, 13).Value = 0
   If Cells(Form15RowNo + 42, 14) = "Yes" Then
    If Cells(Form15RowNo + 42, 17).Value = "*" Then
      StockNo = Cells(Form15RowNo + 42, 15).Value
      StockQty = Cells(Form15RowNo + 42, 16)
      StockAmt = Cells(Form15RowNo + 42, 19)
      Cells(Form15RowNo + 43, 4).Select
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 11).Value = StockNo Then
        ActiveCell.Offset(0, 12).Value = StockQty
        ActiveCell.Offset(0, 15).Value = StockAmt
        StockQty = Format(StockQty + ActiveCell.Offset(0, 8).Value, "0.0000")
        StockAmt = Format(StockAmt + ActiveCell.Offset(0, 9).Value, "0.00")
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
    End If
   End If
Else
  CheckNum = Format(UserForm15.Controls("TextBox" & Form15TextNo).Text, "0.0000")
  UserForm15.Controls("TextBox" & Form15TextNo).Text = CheckNum
 If CheckNum < 0 Then
AskReply1:
    MSG = "Negative Quantity was entered meaning Return to Supplier" + Chr(13) + _
    Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed"
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo NegQtyOK
    If C = "N" Or C = "n" Or C = "" Then
     Cells(Form15RowNo + 42, 12).ClearContents
     Cells(Form15RowNo + 42, 13).ClearContents
     Cells(Form15RowNo + 42, 16).ClearContents
     UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
     Exit Sub
    End If
    GoTo AskReply1
  End If
End If
NegQtyOK:
  Cells(Form15RowNo + 42, 12).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text
   Cells(Form15RowNo + 42, 13).Value = Round(Cells(Form15RowNo + 42, 12).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
 If Cells(Form15RowNo + 42, 6).Value >= 0 Then
   If Cells(Form15RowNo + 42, 12).Value + Cells(Form15RowNo + 42, 11).Value > Cells(Form15RowNo + 42, 6).Value Then
AskReply:
     MSG = "Received Quantity exceeds the quantity ordered." + Chr(13) + _
     Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed"
     Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo QtyProceed
     If C = "N" Or C = "n" Or C = "" Then
      Cells(Form15RowNo + 42, 12).ClearContents
      Cells(Form15RowNo + 42, 13).ClearContents
      Cells(Form15RowNo + 42, 16).ClearContents
      UserForm15.Controls("TextBox" & Form15TextNo).Text = ""
      Exit Sub
     End If
     GoTo AskReply
   End If
 End If
QtyProceed:
    LowValueFlag = ""
    LowValueFlag = ""
    ZeroQtyFlag = ""
    If Cells(Form15RowNo + 42, 14) <> "Yes" Then GoTo QtyOK
    StockNo = Cells(Form15RowNo + 42, 15).Value
    StockQty = Format(Cells(Form15RowNo + 42, 16).Value + Cells(Form15RowNo + 42, 12).Value, "0.0000")
    StockAmt = Format(Cells(Form15RowNo + 42, 19).Value + Cells(Form15RowNo + 42, 13).Value, "0.00")
     If Cells(Form15RowNo + 42, 17).Value = "*" Then
      Cells(Form15RowNo + 43, 4).Select
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 11).Value = StockNo Then
        ActiveCell.Offset(0, 12).Value = StockQty
        ActiveCell.Offset(0, 15).Value = StockAmt
        LowValueFlag = ""
        LowValueFlag = ""
        ZeroQtyFlag = ""
        StockQty = Format(StockQty + ActiveCell.Offset(0, 8).Value, "0.0000")
        StockAmt = Format(StockAmt + ActiveCell.Offset(0, 9).Value, "0.00")
        If StockQty < 0 Then
         LowQtyFlag = Cells(Form15RowNo + 42, 4).Value
        ElseIf StockQty = 0 And StockAmt <> 0 Then
         ZeroQtyFlag = Cells(Form15RowNo + 42, 4).Value
        ElseIf StockAmt < 0 Then
         LowValueFlag = Cells(Form15RowNo + 42, 4).Value
        End If
        If ActiveCell.Offset(0, 13).Value = "" Then Exit Do
       End If
       ActiveCell.Offset(1, 0).Select
      Loop
     Else
       If StockQty < 0 Then
         LowQtyFlag = Cells(Form15RowNo + 42, 4).Value
       ElseIf StockQty = 0 And StockAmt <> 0 Then
         ZeroQtyFlag = Cells(Form15RowNo + 42, 4).Value
       ElseIf StockAmt < 0 Then
         LowValueFlag = Cells(Form15RowNo + 42, 4).Value
       End If
     End If
 If LowQtyFlag <> "" Then
    UserForm15.Label23.Caption = Chr(13) & "   Insufficient stock quantity for " & LowQtyFlag
    UserForm15.Label23.Visible = True
 ElseIf ZeroQtyFlag <> "" Then
    UserForm15.Label23.Caption = Chr(13) & "   The Stock quantity for " & ZeroQtyFlag & " will become zero. " & _
                                 Chr(13) & "   But the book value will not be zero.   "
    UserForm15.Label23.Visible = True
 ElseIf LowValueFlag <> "" Then
    UserForm15.Label23.Caption = Chr(13) & "   The book value for " & LowValueFlag & " will become negative. "
    UserForm15.Label23.Visible = True
 End If
QtyOK:
    Range(Cells(Form15RowNo + 42, 12), Cells(Form15RowNo + 42, 13)).NumberFormat = "General"
  If Cells(Form15RowNo + 42, 11).Value + Val(UserForm15.Controls("TextBox" & Form15TextNo).Text) = Cells(Form15RowNo + 42, 6).Value Then
   Cells(Form15RowNo + 42, 12).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text
   Cells(Form15RowNo + 42, 13).Value = Format(Cells(Form15RowNo + 42, 9).Value - Cells(Form15RowNo + 42, 10).Value, "0.00")
  Else
   Cells(Form15RowNo + 42, 12).Value = UserForm15.Controls("TextBox" & Form15TextNo).Text
   Cells(Form15RowNo + 42, 13).Value = Round(Cells(Form15RowNo + 42, 12).Value * Cells(Form15RowNo + 42, 7).Value * (1 - (Cells(Form15RowNo + 42, 8).Value / 100)), 2)
  End If
  UserForm15.CommandButton17.Visible = True
End Sub
Sub Form15Update(RunCode As String)
 Dim ProductNo As String, PartNotFound As String, ProdRow As Long, I As Long
 Dim StockNotFound As String
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D43").Select
 PartNotFound = ""
  If PartStartRow = 0 Then
    PartNotFound = "Yes"
    UserForm15.Label23.Caption = Chr(13) & "     Alert!!! Some of the items are no longer on the Purchase Item list" & Chr(13) & _
                               "     This will cause problem when parts arrive"
   Do While ActiveCell.Value <> ""
    ActiveCell.Offset(0, -1).Value = ""
    ActiveCell.Offset(0, 11).Value = ""
    ActiveCell.Offset(1, 0).Select
   Loop
   Exit Sub
  End If
  MyBook.Worksheets("Supply Data").Activate
  Set CheckRange = MyBook.Worksheets("Supply Data").Range(Cells(PartStartRow, 4), Cells(PartEndRow, 4))
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("D43").Select
 Do While ActiveCell.Value <> ""
  ProductNo = ActiveCell.Value
   If IsError(Application.Match(ProductNo, CheckRange, 0)) Then
    PartNotFound = "Yes"
    ActiveCell.Offset(0, -1).Value = ""
    ActiveCell.Offset(0, 11).Value = ""
    ActiveCell.Offset(0, 12).Value = ""
   Else
    ProdRow = Application.Match(ProductNo, CheckRange, 0) + PartStartRow - 1
    If MyBook.Worksheets("Supply Data").Cells(ProdRow, 9).Value = "Yes" Then
      ActiveCell.Offset(0, 10).Value = "Yes"
      ActiveCell.Offset(0, 11).ClearContents
      ActiveCell.Offset(0, 12).ClearContents
      ActiveCell.Offset(0, -1).NumberFormat = "General"
      ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 10).Value
      StockNo = MyBook.Worksheets("Supply Data").Cells(ProdRow, 11).Value
     If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
        I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        ActiveCell.Offset(0, 11).NumberFormat = "@"
        ActiveCell.Offset(0, 11).Value = StockNo
        ActiveCell.Offset(0, 12).Value = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        ActiveCell.Offset(0, 15).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value
     Else
       StockNotFound = "Yes"
     End If
    Else
      ActiveCell.Offset(0, 10).ClearContents
      ActiveCell.Offset(0, 11).ClearContents
      ActiveCell.Offset(0, 12).ClearContents
     ActiveCell.Offset(0, -1).NumberFormat = "General"
     ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 7).Value
    End If
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
    Range("D43").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 14).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A43:S62").Select
    Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, Key2:=Range("R1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D43").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 11).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 11).Value
       Do While ActiveCell.Offset(1, 11).Value = StockNo
        ActiveCell.Offset(0, 13).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A43:S62").Select
    Selection.Sort Key1:=Range("R1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("R43:R62").ClearContents
  If PartNotFound = "Yes" Then
       MsgBox ("WARNING : " & Chr(13) & " Some items are no longer on the Purchase item list" & _
         Chr(13) & Chr(13) & "Please setup the Part data otherwise Receiving Update may not be allowed")
  ElseIf StockNotFound = "Yes" Then
      MsgBox ("WARNING : " & Chr(13) & " Some stock items are no longer on Stock Item List" & _
         Chr(13) & Chr(13) & "Please setup the Stock data otherwise Receiving Update may not be allowed")
  End If
End Sub

Sub DNoteUpdate(RunCode As String)
Dim ProductNo As String, PartNotFound As String, ProdRow As Long, I As Long, CheckRange As Range
Dim DeleteAllow As Boolean, StockQty As Double, StockAmt As Double
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D43").Select
 PartNotFound = ""
  If PartStartRow = 0 Then
    PartNotFound = "Yes"
    UserForm15.Label23.Caption = Chr(13) & "     Alert!!! The Purchase items of this supplier is no longer found from the Record" & Chr(13) & _
                               "     No amendment to this Debit Note is allowed"
    UserForm15.Label23.Visible = True
    UserForm15.CommandButton1.Visible = False
    UserForm15.CommandButton13.Visible = False
   Do While ActiveCell.Value <> ""
    ActiveCell.Offset(0, -1).Value = ""
    ActiveCell.Offset(0, 11).Value = ""
    ActiveCell.Offset(1, 0).Select
   Loop
   Exit Sub
  End If
  MyBook.Worksheets("Supply Data").Activate
  Set CheckRange = MyBook.Worksheets("Supply Data").Range(Cells(PartStartRow, 4), Cells(PartEndRow, 4))
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("D43").Select
 Do While ActiveCell.Value <> ""
  ProductNo = ActiveCell.Value
   If IsError(Application.Match(ProductNo, CheckRange, 0)) Then
    PartNotFound = "Yes"
    ActiveCell.Offset(0, -1).Value = ""
    ActiveCell.Offset(0, 1).Value = ""
    ActiveCell.Offset(0, 11).Value = ""
    UserForm15.CommandButton1.Visible = False
    UserForm15.CommandButton13.Visible = False
    UserForm15.Label23.Caption = Chr(13) & "    The item " & ProductNo & " is no longer on the Purchase item list" & _
         Chr(13) & Chr(13) & "    No amendment to this Debit Note is allowed"
    UserForm15.Label23.Visible = True
    Exit Sub
   Else
    ProdRow = Application.Match(ProductNo, CheckRange, 0) + PartStartRow - 1
    If MyBook.Worksheets("Supply Data").Cells(ProdRow, 9).Value = "Yes" Then
     StockNo = MyBook.Worksheets("Supply Data").Cells(ProdRow, 11).Value
     If ActiveCell.Offset(0, 11).Value <> StockNo Then
        UserForm15.CommandButton1.Visible = False
        UserForm15.CommandButton13.Visible = False
        UserForm15.Label23.Caption = Chr(13) & "    The linked Stock # for some items have been changed. " & Chr(13) & _
                                "    No amendment to this Debit Note is allowed"
        UserForm15.Label23.Visible = True
        Exit Sub
     End If
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
         UserForm15.CommandButton1.Visible = False
         UserForm15.CommandButton13.Visible = False
         UserForm15.Label23.Caption = Chr(13) & "   Note: The Stock # detail for some items cannot be found. " & Chr(13) & _
                                "    No amendment to this Debit Note is allowed"
         UserForm15.Label23.Visible = True
         Exit Sub
      Else
        I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        If ActiveCell.Offset(0, -1).Value <> MyBook.Worksheets("StockRec").Cells(I, 5).Value Then
          UserForm15.CommandButton1.Visible = False
          UserForm15.CommandButton13.Visible = False
          UserForm15.Label23.Caption = Chr(13) & "   Note: The Asset account for some items have been changed. " & Chr(13) & _
                                "    No amendment to this Debit Note is allowed"
          UserForm15.Label23.Visible = True
          Exit Sub
        End If
        ActiveCell.Offset(0, 12).Value = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        ActiveCell.Offset(0, 15).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value
      End If
    Else
       If ActiveCell.Offset(0, 11).Value <> "" Then
          UserForm15.CommandButton1.Visible = False
          UserForm15.CommandButton13.Visible = False
          UserForm15.Label23.Caption = Chr(13) & "    " & ProductNo & " was changed from stock item to non-stock item. " & Chr(13) & _
                                "    No amendment to this Debit Note is allowed"
          UserForm15.Label23.Visible = True
          Exit Sub
       End If
     ActiveCell.Offset(0, -1).NumberFormat = "General"
     ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 7).Value
     ActiveCell.Offset(0, 11).Value = ""
    End If
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
    Range("C43").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 15).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
      Range("A43:S62").Select
    Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, Key2:=Range("R1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D43").Select
    DeleteAllow = True
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 11).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 11).Value
       StockQty = ActiveCell.Offset(0, 12).Value
       StockAmt = ActiveCell.Offset(0, 15).Value
       I = ActiveCell.Row
       Range("D15").Select
       Do While ActiveCell.Value <> ""
        If ActiveCell.Offset(0, 11).Value = StockNo Then
         ActiveCell.Offset(0, 12).Value = StockQty
         ActiveCell.Offset(0, 15).Value = StockAmt
         StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
         StockAmt = Format(StockAmt - ActiveCell.Offset(0, 5).Value, "0.00")
         ActiveCell.Offset(0, 13).Value = "*"
        End If
        ActiveCell.Offset(1, 0).Select
       Loop
        If StockQty < 0 Or StockAmt < 0 Then DeleteAllow = False
        If StockQty = 0 And StockAmt <> 0 Then DeleteAllow = False
       Cells(I, 4).Select
       Cells(I, 16).Value = StockQty
       Cells(I, 19).Value = StockAmt
       Do While ActiveCell.Offset(1, 10).Value = StockNo
        StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
        StockAmt = Format(StockAmt - ActiveCell.Offset(0, 5).Value, "0.00")
        ActiveCell.Offset(1, 12).Value = StockQty
        ActiveCell.Offset(1, 15).Value = StockAmt
        ActiveCell.Offset(0, 13).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A43:S62").Select
    Selection.Sort Key1:=Range("R1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("R43:R62").ClearContents
 For I = 1 To 6
  UserForm15.Controls("Label" & I + 14).Caption = I
  UserForm15.Controls("TextBox" & I * 5).Text = Cells(42 + I, 4).Value
  UserForm15.Controls("TextBox" & I * 5 + 1).Text = Cells(42 + I, 5).Value
  UserForm15.Controls("TextBox" & I * 5 + 2).Text = Cells(42 + I, 6).Value
  UserForm15.Controls("TextBox" & I * 5 + 3).Text = Cells(42 + I, 7).Value
  UserForm15.Controls("TextBox" & I * 5 + 4).Text = Cells(42 + I, 8).Value
  UserForm15.Controls("Label" & I + 26).Caption = Format(Cells(42 + I, 9).Value, "#,##0.00")
 Next I
  Range("D15").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 11).Value <> "" And ActiveCell.Offset(0, 13).Value <> "*" Then
        StockNo = ActiveCell.Offset(0, 11).Value
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
         UserForm15.Label1.Caption = "DEBIT NOTE "
         UserForm15.CommandButton1.Visible = False
         UserForm15.CommandButton13.Visible = False
         MsgBox ("Some stock numbers are no longer in the Stock List." & Chr(13) & Chr(13) & "Amendment to this Debit Note is not allowed")
         Exit Sub
      End If
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
 If DeleteAllow = False Then UserForm15.CommandButton13.Visible = False
End Sub

Sub PODueCal(RunCode As String)
Dim GoodsRecDate As Date
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
 If IsDate(UserForm15.TextBox48.Text) = False Then Exit Sub
   GoodsRecDate = UserForm15.TextBox48.Text
  If UCase(Right(PayTerm, 4)) = "DAYS" Then
    DueDate = GoodsRecDate + Val(PayTerm)
  ElseIf UCase(Right(PayTerm, 4)) = " EOM" Then
    If Month(GoodsRecDate) < 12 Then
      DueDate = Year(GoodsRecDate) & "/" & Month(GoodsRecDate) + 1 & "/1"
    Else
      DueDate = Year(GoodsRecDate) + 1 & "/1/1"
    End If
    DueDate = DueDate - 1 + Val(PayTerm)
  Else
    DueDate = GoodsRecDate
  End If
End Sub

Sub POPrint(RunCode As String)
Dim I As Long, J As Long, EntryNo As Long, K As Long, StartPO As String, EndPO As String
Dim CopyNo As Long, MSG1 As String, myMsg As String, FirstPORow As Long, LastPORow As Long
Dim Sh As Shape, PicLocation As String, PicZoom As Single
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "PURCHASE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 MyBook.Worksheets("PORecord").Activate
 If Range("B4").Value = "" Then
  MsgBox (" No PO data is found in the record" & Chr(13) & "PO printing cannot be proceeded")
  Exit Sub
 End If
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("A1").End(xlDown).Select
 If ActiveCell.Value <> "PO" Then
  MsgBox (" No PO data is found in the record" & Chr(13) & "PO printing cannot be proceeded")
  Exit Sub
 End If
  LastPORow = ActiveCell.Row
  If Range("A4").Value = "PO" Then
    FirstPORow = 4
  Else
    Range("A4").Select
    Do While ActiveCell.Value = "DEBIT NOTE"
     ActiveCell.Offset(5, 0).Select
    Loop
    ActiveCell.Offset(-4, 0).Select
    Do While ActiveCell.Value = "DEBIT NOTE"
     ActiveCell.Offset(1, 0).Select
    Loop
    FirstPORow = ActiveCell.Row
  End If
Set CheckRange = Range(Cells(FirstPORow, 2), Cells(LastPORow, 2))
  J = LastPORow - 29
  If J < FirstPORow Then J = FirstPORow
  StartPO = Cells(J, 2).Value
  EndPO = Cells(LastPORow, 2).Value
  Userform18.TextBox1.Text = StartPO
  Userform18.TextBox2.Text = EndPO
  UserForm15.Hide
  Userform18.Caption = "Multiple Print-out of POs"
  Userform18.Label1.Caption = "Beginning PO # : "
  Userform18.Label2.Caption = "Ending PO # : "
  Userform18.Label3.Caption = "Enter the range of PO # below" & Chr(13) & " ( Maximum 30 orders ) "
  Userform18.Label5.Caption = "P"
  Userform18.Label5.Visible = False
  Userform18.Label6.Caption = "P"
  Userform18.Label6.Visible = False
  Userform18.Label5.Width = 18
  Userform18.Label6.Width = 18
  Userform18.TextBox1.Left = 156
  Userform18.TextBox2.Left = 156
  Userform18.Show
CheckInput:
  ThisWorkbook.Worksheets("PO").Activate
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      UserForm15.Show
      Exit Sub
    End If
  StartPO = Userform18.TextBox1.Text
  EndPO = Userform18.TextBox2.Text
  If StartPO > EndPO Then
   StartPO = Userform18.TextBox2.Text
   EndPO = Userform18.TextBox1.Text
  End If
   If IsError(Application.Match(StartPO, CheckRange, 1)) Then
     StartRow = FirstPORow
   Else
    StartRow = Application.Match(StartPO, CheckRange, 1)
    StartRow = StartRow + FirstPORow - 1
    If StartPO <> MyBook.Worksheets("PORecord").Cells(StartRow, 2).Value Then StartRow = StartRow + 1
   End If
   If IsError(Application.Match(EndPO, CheckRange, 1)) Then
    EndRow = FirstPORow - 1
   Else
    EndRow = Application.Match(EndPO, CheckRange, 1)
    EndRow = EndRow + FirstPORow - 1
    If EndRow > LastPORow Then EndRow = LastPORow
   End If
 If StartRow > EndRow Then
   Userform18.Label4.BackColor = &H4C0&
   Userform18.Label4.Caption = Chr(13) & "   None of the specified POs are found in the record"
   Userform18.TextBox1.Text = StartPO
   Userform18.TextBox2.Text = EndPO
   Userform18.Label4.Visible = True
   Userform18.Show
   GoTo CheckInput
 End If
  Unload Userform18
  ThisWorkbook.Worksheets("POForm").Activate
    Rows("1:1500").Select
  Selection.Copy
  Worksheets("PO").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  ActiveSheet.UsedRange.ClearContents
  Cells(1, 1).EntireRow.Insert
I = 2
CopyNo = 0
Do While StartRow <= EndRow And CopyNo < 30
  MyBook.Worksheets("PORecord").Activate
   Rows(StartRow).Select
   Selection.Copy
  ThisWorkbook.Worksheets("PO").Activate
   Cells(1, 1).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Cells(I + 2, 1).Value = "PURCHASE ORDER"
  Cells(I + 4, 7).Value = "PO # : "
  Cells(I + 5, 7).Value = "Date : "
  Cells(I + 6, 7).Value = "Quote Ref : "
  Cells(I + 8, 1).Value = "Supplier : "
  Cells(I + 8, 5).Value = "Goods Delivered to: "
  Cells(I + 39, 2).Value = "Delivery Date : "
  Cells(I + 39, 8).Value = "Total Amount : "
  Cells(I + 40, 2).Value = "Remarks : "
  Cells(I + 41, 2).Value = "Buyer : "
  Cells(I + 42, 2).Value = "Payment Terms : "
  Cells(I + 45, 6).Value = "Authorized Signature"
  Cells(I + 43, 2).Value = Range("IT1").Value & Chr(10) & Range("IU1").Value & Chr(10) & Range("IV1").Value
  Cells(I + 16, 1).Value = "Item"
  Cells(I + 16, 2).Value = "Product #"
  Cells(I + 16, 3).Value = "Product Description"
  Cells(I + 16, 6).Value = "Qty"
  Cells(I + 15, 8).Value = "Discount"
  Cells(I + 16, 8).Value = "Rate"
  Cells(I + 15, 7).Value = "Unit Price"
  Cells(I + 16, 7).Value = "(" & SysCurrency & ")"
  Cells(I + 15, 9).Value = "Amount "
  Cells(I + 16, 9).Value = "(" & SysCurrency & ")"
  Cells(I + 4, 8).NumberFormat = "@"
  Cells(I + 4, 8).Value = Range("B1").Value
   With New StdFont
        .Name = "IDAutomationHC39M Free Version"
        If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
         Cells(I + 4, 1).RowHeight = 18
         Cells(I + 4, 1).VerticalAlignment = xlTop
         Cells(I + 4, 1).HorizontalAlignment = xlLeft
         Cells(I + 4, 1).Font.Name = "IDAutomationHC39M Free Version"
         Cells(I + 4, 1).Value = Code39(Cells(I + 4, 8).Value)
        End If
    End With
  Cells(I + 5, 8).Value = Range("D1").Value
  Cells(I + 6, 8).Value = Range("AB1").Value
  Cells(I + 39, 3).Value = Range("AG1").Value
  Cells(I + 40, 3).Value = Range("AH1").Value
  Cells(I + 41, 3).Value = Range("AC1").Value
  Cells(I + 42, 3).Value = Range("O1").Value
  Cells(I + 9, 1).Value = "   " & Range("Q1").Value
  Cells(I + 10, 1).Value = "   " & Range("R1").Value
  Cells(I + 11, 1).Value = "   " & Range("S1").Value
  Cells(I + 12, 1).Value = "   " & Range("T1").Value
  If Range("V1").Value <> "" Then
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value & "   Tel : " & Range("V1").Value
  Else
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value
  End If
  Cells(I + 9, 5).Value = "   " & Range("W1").Value
  Cells(I + 10, 5).Value = "   " & Range("X1").Value
  Cells(I + 11, 5).Value = "   " & Range("Y1").Value
  Cells(I + 12, 5).Value = "   " & Range("Z1").Value
  Cells(I + 13, 5).Value = "   Contact : " & Range("AA1").Value
  EntryNo = Range("AD1").Value
  Cells(I + 39, 9).Value = Range("AF1").Value
  Cells(I + 18, 1).Select
  For K = 1 To EntryNo
   ActiveCell.Value = K
   ActiveCell.Offset(0, 1).Value = Cells(1, K * 9 + 27).Value
   ActiveCell.Offset(0, 2).Value = Cells(1, K * 9 + 28).Value
   ActiveCell.Offset(0, 5).Value = Cells(1, K * 9 + 29).Value
   ActiveCell.Offset(0, 6).Value = Cells(1, K * 9 + 30).Value
   ActiveCell.Offset(0, 7).NumberFormat = "0.0#%"
   ActiveCell.Offset(0, 7).Value = Cells(1, K * 9 + 31).Value / 100
   ActiveCell.Offset(0, 8).Value = Cells(1, K * 9 + 32).Value
   ActiveCell.Offset(1, 0).Select
  Next K
  I = I + 46
  CopyNo = CopyNo + 1
  StartRow = StartRow + 1
 Loop
Range(Cells(I + 1, 1), Cells(1500, 1)).EntireRow.Delete
Rows(1).Delete
 If Cells(3, 1).Value <> "" Then Call POPageLayout("PO")
 ThisWorkbook.Worksheets("PO").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 SheetName = "PO"
 ThisWorkbook.Worksheets("PO").Activate
 ActiveSheet.CommandButton3.Visible = False
 ActiveWindow.DisplayGridlines = False
 Range("A1:K19").Select
 ActiveWindow.Zoom = True
 Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
  myMsg = CopyNo & " POs printed.          "
  If StartRow <= EndRow And CopyNo = 30 Then
    MSG1 = "The number of POs requested for printing exceeds 30" & Chr(13) _
     & "The system can only handle a maximum of 30 POs each time." & Chr(13) & "Thus, only 30 POs were processed.     "
    myMsg = "ALERT !!!" & Chr(13) & Chr(13) & myMsg & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + "Please Note    "
  End If
 MsgBox (myMsg)
End Sub
Sub DebitNote(DelDate As String)
Dim InvRow As Long, I As Long, CheckRange As Range, ProdRow As Long, ProductNo As String
If ThisWorkbook.Worksheets("NewCom").Range("A6") <> "DEBIT NOTE" Then Exit Sub
 UserForm15.CommandButton1.Caption = "Save DN"
 UserForm15.Label1.Caption = "DEBIT NOTE"
PONo = Right("00000" & UserForm15.TextBox2.Text, 5)
If IsNumeric(PONo) = False Then
 Call POTempFormat("")
 Call Form15Text1Exit("")
 PONo = ""
 UserForm15.CommandButton13.Visible = False
 UserForm15.CommandButton1.Visible = False
 UserForm15.Label23.Caption = Chr(13) & "       Not a correct Debit Note #.  "
 UserForm15.Label23.Visible = True
 Exit Sub
End If
UserForm15.TextBox2.Text = PONo
PONo = "DN" & PONo
If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = True Then
 PONo = Right(("00000" & (Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1)), 5)
 UserForm15.TextBox2.Value = PONo
 PONo = "DN" & PONo
 Call POTempFormat("")
 Call Form15Text1Exit("")
 UserForm15.Label23.Caption = Chr(13) & Chr(13) & "      The Debit Note is not found from the record. "
 UserForm15.Label23.Visible = True
 UserForm15.CommandButton13.Visible = False
 UserForm15.CommandButton1.Visible = True
 Exit Sub
Else
 UserForm15.CommandButton1.Caption = "Edit DN"
 UserForm15.Label1.Caption = "DEBIT NOTE "
 InvRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("PORecord").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("E1").Value = CreditorAcct
 InvStatus = Range("J1").Value
 OSAmt = Range("K1").Value
 DueDate = Range("N1").Value
 DelDate = Format(Range("N1").Value, "yyyy/mm/dd")
 SupplierNo = Range("P1").Value
 SupplierName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 CustPO = Range("AB1").Value
 SalesRep = Range("AC1").Value
 If Range("AF1").Value = 0 Then
   TotalAmount = 0
 Else
   TotalAmount = Range("AF1").Value
 End If
 Remarks = Range("AH1").Value
 InvDate = Range("D1").Value
 PayTerm = Range("O1").Value
 UserForm15.TextBox53.Text = Range("IT1").Value
 UserForm15.TextBox54.Text = Range("IU1").Value
 UserForm15.TextBox55.Text = Range("IV1").Value
 If TelNo <> "" Then
    UserForm15.Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
    "     " & Address1 & Chr(13) & _
    "     " & Address2 & Chr(13) & _
    "     " & Address3 & Chr(13) & _
    "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
  Else
    UserForm15.Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
    "     " & Address1 & Chr(13) & _
    "     " & Address2 & Chr(13) & _
    "     " & Address3 & Chr(13) & _
    "     Contact: " & CustContact
  End If
 UserForm15.TextBox1.Text = SupplierNo
 UserForm15.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 UserForm15.TextBox4.Text = CustPO
 UserForm15.TextBox46.Text = SalesRep
 UserForm15.Label39.Caption = PayTerm
 UserForm15.TextBox47.Text = Format(DelDate, "yyyy/mm/dd")
 UserForm15.TextBox49.Text = Remarks
For I = 15 To 20
 UserForm15.Controls("Label" & I).Caption = I - 14
Next I
J = 42
K = 1
For I = 5 To 184 Step 9
 ActiveCell.Offset(J, K + 1).NumberFormat = "General"
 ActiveCell.Offset(J, K + 2).NumberFormat = "@"
 ActiveCell.Offset(J, K + 3).NumberFormat = "@"
 ActiveCell.Offset(J, K + 13).NumberFormat = "@"
 ActiveCell.Offset(J, K + 1).Value = Cells(1, I + 30).Value
 ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
 ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
 If Cells(1, I + 33).Value <> "" Or Cells(1, I + 33).Value <> 0 Then ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value * (-1)
 ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
 ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value
 If Cells(1, I + 36).Value <> "" Or Cells(1, I + 36).Value <> 0 Then ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 36).Value * (-1)
 ActiveCell.Offset(J, K + 13).Value = Cells(1, I + 37).Value
   J = J + 1
   K = 1
 Next I
 Range("D43").Select
 For I = 5 To 34 Step 5
  UserForm15.Controls("TextBox" & I).Text = ActiveCell.Value
  UserForm15.Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
  UserForm15.Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
  UserForm15.Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
  UserForm15.Controls("TextBox" & I + 4).Text = ActiveCell.Offset(0, 4).Value
  UserForm15.Controls("Label" & (I / 5) + 26).Caption = ActiveCell.Offset(0, 5).Value
  ActiveCell.Offset(1, 0).Select
 Next I
 UserForm15.ScrollBar1.Value = 1
For J = 0 To 5
  If IsNumeric(UserForm15.Controls("Label" & J + 27).Caption) Then UserForm15.Controls("Label" & J + 27).Caption = Format(UserForm15.Controls("Label" & J + 27).Caption, "#,##0.00")
Next J
End If
If InvStatus <> "*" Or InvDate < BeginningDate Then
  UserForm15.CommandButton1.Visible = False
Else
 UserForm15.CommandButton1.Caption = "Edit DN"
 UserForm15.CommandButton1.Visible = True
End If
Call Form15AmountRefresh("")
UserForm15.CommandButton13.Visible = False
UserForm15.Label23.Visible = False
 Call Form15PartList("")
 ThisWorkbook.Worksheets("TempRP").Activate
 If InvDate < BeginningDate Then Exit Sub
 Range("A43:P62").Copy
 Range("A15").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("C15").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 3).Value = "" Then
   ActiveCell.Offset(0, 3).Value = 0
  Else
   ActiveCell.Offset(0, 3).Value = ActiveCell.Offset(0, 3).Value * (-1)
  End If
  If ActiveCell.Offset(0, 6).Value = "" Then
   ActiveCell.Offset(0, 6).Value = 0
  Else
   ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, 6).Value * (-1)
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
  Range("A15").Value = InvDate
End Sub

Sub DNPrint(RunCode As String)
Dim I As Long, J As Long, EntryNo As Long, K As Long, StartDN As String, EndDN As String, WorkNo As String, WorkPO As String
Dim JumpNo As Long, CopyNo As Long, MSG1 As String, MSG2 As String, myMsg As String
Dim Sh As Shape, PicLocation As String, PicZoom As Single
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "DEBIT NOTE" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 MyBook.Worksheets("PORecord").Activate
   If Range("F1").Value = "00000" Then
    MsgBox (" No Debit Note data is found in the record" & Chr(13) & "Printing cannot be proceeded")
    Exit Sub
  End If
 If Range("B4").Value = "" Then
  MsgBox (" No Debit note data is found in the record" & Chr(13) & "Printing cannot be proceeded")
  Exit Sub
 End If
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 
  Range("B4").Select
 If Left(ActiveCell.Value, 1) <> "D" Then
  MsgBox (" No Debit Note data is found in the record" & Chr(13) & "Printing cannot be proceeded")
  Exit Sub
 End If
  Userform18.TextBox2.Text = Range("F1").Value
  I = Val(Range("F1").Value) - 29
  If I < 0 Then I = 1
  StartDN = Right("00000" & I, 5)
  If Right(Range("B4").Value, 5) > StartDN Then StartDN = Right(Range("B4").Value, 5)
  Userform18.TextBox1.Text = StartDN
  UserForm15.Hide
  Userform18.Caption = "Multiple Debit Note Print-Out"
  Userform18.Label1.Caption = "Beginning Debit Note # : "
  Userform18.Label2.Caption = "Ending Debit Note # : "
  Userform18.Label3.Caption = "Enter the range of Debit Note # below" & Chr(13) & " ( Maximum 30 DNs ) "
  Userform18.Label5.Caption = "DN"
  Userform18.Label5.Visible = True
  Userform18.Label6.Caption = "DN"
  Userform18.Label6.Visible = True
  Userform18.TextBox1.Left = 174
  Userform18.TextBox2.Left = 174
  Userform18.Show
CheckInput:
  ThisWorkbook.Worksheets("PO").Activate
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      UserForm15.Show
      Exit Sub
    End If
    If IsNumeric(Userform18.TextBox1.Text) = False Then
       Userform18.Label4.BackColor = &H4C0&
       Userform18.Label4.Caption = Chr(13) & "     Beginning Debit Note # is Not a valid number"
       Userform18.Label4.Visible = True
       Userform18.Show
       GoTo CheckInput
     End If
    If IsNumeric(Userform18.TextBox2.Text) = False Then
       Userform18.Label4.BackColor = &H4C0&
       Userform18.Label4.Caption = Chr(13) & "     Ending Debit Note # is Not a valid number"
       Userform18.Label4.Visible = True
       Userform18.Show
       GoTo CheckInput
     End If
  StartDN = Userform18.TextBox1.Text
  EndDN = Userform18.TextBox2.Value
  If StartDN > EndDN Then
   StartDN = Userform18.TextBox2.Text
    EndDN = Userform18.TextBox1.Value
  End If
  Unload Userform18
  ThisWorkbook.Worksheets("POForm").Activate
    Rows("1:1500").Select
  Selection.Copy
  Worksheets("PO").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  ActiveSheet.UsedRange.ClearContents
  Cells(1, 1).EntireRow.Insert
I = 2
WorkNo = StartDN
JumpNo = 0
CopyNo = 0
Do While WorkNo <= EndDN And CopyNo < 30
 WorkPO = "DN" & WorkNo
 If IsError(Application.Match(WorkPO, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = False Then
   J = Application.Match(WorkPO, MyBook.Worksheets("PORecord").Range("B:B"), 0)
  MyBook.Worksheets("PORecord").Activate
   Rows(J).Select
   Selection.Copy
  ThisWorkbook.Worksheets("PO").Activate
   Cells(1, 1).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Range(Cells(I + 8, 5), Cells(I + 13, 9)).Select
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    Selection.Borders(xlEdgeTop).LineStyle = xlNone
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
  Cells(I + 2, 1).Value = "DEBIT NOTE"
  Cells(I + 4, 7).Value = "Debit Note # : "
  Cells(I + 5, 7).Value = "Date : "
  Cells(I + 6, 7).Value = "Ref PO # : "
  Cells(I + 8, 1).Value = "Supplier : "
  Cells(I + 39, 2).Value = "Payment Due Date : "
  Cells(I + 39, 8).Value = "Total Amount : "
  Cells(I + 40, 2).Value = "Remarks : "
  Cells(I + 41, 2).Value = "Buyer : "
  Cells(I + 45, 6).Value = "Authorized Signature"
  Cells(I + 43, 2).Value = Range("IT1").Value & Chr(10) & Range("IU1").Value & Chr(10) & Range("IV1").Value
  Cells(I + 16, 1).Value = "Item"
  Cells(I + 16, 2).Value = "Product #"
  Cells(I + 16, 3).Value = "Product Description"
  Cells(I + 16, 6).Value = "Qty"
  Cells(I + 15, 8).Value = "Discount"
  Cells(I + 16, 8).Value = "Rate"
  Cells(I + 15, 7).Value = "Unit Price"
  Cells(I + 16, 7).Value = "(" & SysCurrency & ")"
  Cells(I + 15, 9).Value = "Amount "
  Cells(I + 16, 9).Value = "(" & SysCurrency & ")"
  Cells(I + 4, 8).Value = Range("B1").Value
  Cells(I + 5, 8).Value = Range("D1").Value
  Cells(I + 6, 8).Value = Range("AB1").Value
  Cells(I + 39, 3).Value = Range("N1").Value
  Cells(I + 40, 3).Value = Range("AH1").Value
  Cells(I + 41, 3).Value = Range("AC1").Value
  Cells(I + 9, 1).Value = "   " & Range("Q1").Value
  Cells(I + 10, 1).Value = "   " & Range("R1").Value
  Cells(I + 11, 1).Value = "   " & Range("S1").Value
  Cells(I + 12, 1).Value = "   " & Range("T1").Value
  If Range("V1").Value <> "" Then
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value & "   Tel : " & Range("V1").Value
  Else
   Cells(I + 13, 1).Value = "   Contact : " & Range("U1").Value
  End If
  EntryNo = Range("AD1").Value
  If Range("AF1").Value = "" Or Range("AF1").Value = 0 Then
    Cells(I + 39, 9).Value = 0
  Else
    Cells(I + 39, 9).Value = Range("AF1").Value * (-1)
  End If
  Cells(I + 18, 1).Select
  For K = 1 To EntryNo
   ActiveCell.Value = K
   ActiveCell.Offset(0, 1).Value = Cells(1, K * 9 + 27).Value
   ActiveCell.Offset(0, 2).Value = Cells(1, K * 9 + 28).Value
   If Cells(1, K * 9 + 29).Value = "" Or Cells(1, K * 9 + 29).Value = 0 Then
     ActiveCell.Offset(0, 5).Value = 0
   Else
    ActiveCell.Offset(0, 5).Value = Cells(1, K * 9 + 29).Value * (-1)
   End If
   ActiveCell.Offset(0, 6).Value = Cells(1, K * 9 + 30).Value
   ActiveCell.Offset(0, 7).NumberFormat = "0.0#%"
   ActiveCell.Offset(0, 7).Value = Cells(1, K * 9 + 31).Value / 100
   If Cells(1, K * 9 + 32).Value = "" Or Cells(1, K * 9 + 32).Value = 0 Then
    ActiveCell.Offset(0, 8).Value = 0
   Else
    ActiveCell.Offset(0, 8).Value = Cells(1, K * 9 + 32).Value * (-1)
   End If
   ActiveCell.Offset(1, 0).Select
  Next K
  I = I + 46
  CopyNo = CopyNo + 1
 Else
  JumpNo = JumpNo + 1
 End If
  WorkNo = Right(("00000" & (Val(WorkNo) + 1)), 5)
 Loop
Range(Cells(I + 1, 1), Cells(1500, 1)).EntireRow.Delete
Rows(1).Delete
If Range("H5").Value = "" Then
  Userform18.Caption = "Multiple Debit Note Print-Out"
  Userform18.Label1.Caption = "Beginning Debit Note # : "
  Userform18.Label2.Caption = "Ending Debit Note # : "
  Userform18.Label3.Caption = "Enter the range of Debit Note # below" & Chr(13) & " ( Maximum 30 DNs ) "
  Userform18.Label5.Caption = "DN"
  Userform18.Label5.Visible = True
  Userform18.Label6.Caption = "DN"
  Userform18.Label6.Visible = True
  Userform18.TextBox1.Left = 174
  Userform18.TextBox2.Left = 174
  Userform18.Label4.BackColor = &H4C0&
  Userform18.Label4.Caption = Chr(13) & "   None of the specified Debit Notes is found in the record"
  Userform18.TextBox1.Text = StartDN
  Userform18.TextBox2.Text = EndDN
  Userform18.Label4.Visible = True
  Userform18.Show
  GoTo CheckInput
End If
 If Cells(3, 1).Value <> "" Then Call POPageLayout("PO")
 ThisWorkbook.Worksheets("PO").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 SheetName = "PO"
 ThisWorkbook.Worksheets("PO").Activate
 ActiveSheet.CommandButton3.Visible = False
 ActiveWindow.DisplayGridlines = False
 Range("A1:K19").Select
 ActiveWindow.Zoom = True
 Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
If JumpNo > 0 Or (WorkPO <= EndDN And CopyNo = 30) Then
  If JumpNo = 1 Then
    MSG1 = "One Debit Note is not found in the Record."
  ElseIf JumpNo > 1 Then
    MSG1 = JumpNo & " DNs are not found in the Record."
  End If
  If WorkPO <= EndDN And CopyNo = 30 Then MSG2 = "The number of DNs requested for printing exceeds 30" & Chr(13) _
     & "The system can only handle a maximum of 30 DNs each time." & Chr(13) & "Thus, only 30 DNs were processed."
  If MSG1 = "" Then
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG2 + Chr(13) + Chr(13) + "Please Note"
  ElseIf MSG2 = "" Then
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + "Please Note"
  Else
    myMsg = "WARNING!!!" & Chr(13) & Chr(13) & MSG1 + Chr(13) + Chr(13) + MSG2 + Chr(13) + Chr(13) + "Please Note"
  End If
 MsgBox (myMsg)
End If
End Sub

Sub Form20Text1Exit(RunCode As String)
Dim I As Long, FRow As Long, LRow As Long, RowNo As Long
Dim Tbl As Range, CheckRange As Range
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "BILLPAY" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
MyBook.Activate
EventOff = True
SupplierNo = UCase(UserForm20.TextBox1.Text)
   UserForm20.ScrollBar1.Visible = False
   UserForm20.ScrollBar1.Value = 1
   UserForm20.ScrollBar1.Max = 1
   For I = 11 To 35
    UserForm20.Controls("Label" & I).Caption = ""
   Next I
    UserForm20.Label36.Caption = "0.00"
    UserForm20.Label41.Caption = "0.00"
  For I = 4 To 8
    UserForm20.Controls("TextBox" & I).Text = ""
    UserForm20.Controls("TextBox" & I).Visible = False
   Next I
   For I = 13 To 22
     UserForm20.Controls("TextBox" & I).Text = ""
     If UserForm20.Controls("Textbox" & I).TabStop = True Then UserForm20.Controls("Textbox" & I).TabStop = False
   Next I
   UserForm20.CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date"
If SupplierNo = "" Then
 EventOff = False
 Exit Sub
End If
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
  End If
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
UserForm20.TextBox1.Text = SupplierNo
MyBook.Worksheets("Supplier Data").Activate
If IsError(Application.Match(SupplierNo, Range("B:B"), 0)) Then
  UserForm20.Label2.Caption = ""
Else
 I = Application.Match(SupplierNo, Range("B:B"), 0)
 UserForm20.Label2.Caption = Cells(I, 3).Value
End If
 MyBook.Worksheets("Payable").Activate
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("V1") _
        , Order2:=xlAscending, Key3:=Range("B1"), Order3:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(SupplierNo, CheckRange, 0)) Then
   UserForm20.Label39.Caption = Chr(13) & "    No unsettled POs/ debit notes for this Supplier"
   UserForm20.Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
  FRow = Application.Match(SupplierNo, CheckRange, 0) + 3
  LRow = Application.Match(SupplierNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
  Cells(FRow, 22).Select
  If ActiveCell.Value < "R" Then
    Do While ActiveCell.Value < "R" And ActiveCell.Row <= LRow
     ActiveCell.Offset(1, 0).Select
    Loop
    LRow = ActiveCell.Row - 1
   Range(Cells(FRow, 1), Cells(LRow, 5)).EntireRow.Select
   Selection.Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   Range("A1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    ActiveSheet.UsedRange.Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    With Selection
     .Columns("W").Copy
      Range("E1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("L").Copy
      Range("F1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("K").Copy
       Range("G1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("Q").Copy
       Range("I1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
       .Columns("J:K").NumberFormat = "yyyy/mm/dd"
       .Columns("N").Copy
       Range("J1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Range("K1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
       .Columns("L").NumberFormat = "@"
       .Columns("E").Copy
       Range("L1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("M:IV").ClearContents
     .Columns("H").ClearContents
     .Cut
    End With
    Range("A6").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
 If Range("B7").Value <> "" Then
    Range("B6").End(xlDown).Select
    If ActiveCell.Row > 10 Then
     UserForm20.ScrollBar1.Max = ActiveCell.Row - 9
     UserForm20.ScrollBar1.Visible = True
    End If
  End If
    Range("B6").Select
     I = 1
     Do While ActiveCell.Value <> "" And I < 6
      UserForm20.Controls("Label" & I * 5 + 6).Caption = I
      UserForm20.Controls("Label" & I * 5 + 7).Caption = ActiveCell.Value
      UserForm20.Controls("Label" & I * 5 + 8).Caption = Format(ActiveCell.Offset(0, 2).Value, "yyyy/mm/dd")
      UserForm20.Controls("TextBox" & I + 17).Text = ActiveCell.Offset(0, 3).Value
      UserForm20.Controls("TextBox" & I + 12).Text = Format(ActiveCell.Offset(0, 8).Value, "yyyy/mm/dd")
      UserForm20.Controls("Label" & I * 5 + 9).Caption = Format(ActiveCell.Offset(0, 4).Value, "#,##0.00")
      UserForm20.Controls("Label" & I * 5 + 10).Caption = Format(ActiveCell.Offset(0, 5).Value, "#,##0.00")
      UserForm20.Controls("TextBox" & I + 3).Visible = True
      ActiveCell.Offset(1, 0).Select
      I = I + 1
     Loop
  Else
   UserForm20.Label39.Caption = Chr(13) & "    No unsettled POs / debit notes for this Supplier"
   UserForm20.Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
 End If
UserForm20.Label39.Visible = False
EventOff = False
End Sub

Sub Form20SumRefresh(RunCode As String)
Dim TotalSum As Double, TextBox3Amount As Double
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value <> "BILLPAY" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If UserForm20.Controls("TextBox" & Form6TextNo).Text <> "" Then
 If IsNumeric(UserForm20.Controls("TextBox" & Form6TextNo).Value) = False Then
   Cancel = True
   UserForm20.Label39.Caption = Chr(13) & "  Incorrect Amount entered "
   UserForm20.Label39.Visible = True
 Else
   ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value = UserForm20.Controls("TextBox" & Form6TextNo).Value
   ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value = Round(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value, 2)
   UserForm20.Controls("TextBox" & Form6TextNo).Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value, "#,##0.00")
   UserForm20.Label39.Visible = False
  If (ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value - ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value) > 0.005 And ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 7).Value >= 0 Then
    MsgBox ("WARNING:" & Chr(13) & "The Amount entered exceeds the Amount Due")
  End If
 End If
Else
  ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value = 0
  ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value = Round(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value, 2)
  UserForm20.Controls("TextBox" & Form6TextNo).Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 5, 8).Value, "#,##0.00")
  UserForm20.Label39.Visible = False
End If
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("B6").Select
 TotalSum = 0
 Do While ActiveCell.Value <> ""
  TotalSum = TotalSum + ActiveCell.Offset(0, 6).Value
  ActiveCell.Offset(1, 0).Select
 Loop
 UserForm20.Label36.Caption = Format(TotalSum, "#,##0.00")
 If UserForm20.TextBox3.Text = "" Then
  TextBox3Amount = 0
 Else
  TextBox3Amount = UserForm20.TextBox3.Text
 End If
 UserForm20.Label41.Caption = Format(TextBox3Amount - TotalSum, "#,##0.00")
End Sub

Sub Form15ViewOnly(DelDate As String)
Dim InvRow As Long, I As Long, InvPrefix As String, InputPO As String
If Not (UserForm15.Label1.Caption = "PURCHASE ORDER " Or UserForm15.Label1.Caption = "DEBIT NOTE ") Then Exit Sub
InputPO = UserForm15.TextBox2.Text
If UserForm15.Label1.Caption = "PURCHASE ORDER " Then
 If IsNumeric(InputPO) Then
  If Len(InputPO) < 7 Then
   InputPO = Right(("000000" & InputPO), 6)
   PONo = "P" & InputPO
   UserForm15.Label58.Visible = True
   UserForm15.TextBox2.Text = InputPO
   UserForm15.TextBox2.Left = 366
   UserForm15.TextBox2.Width = 90
  Else
   PONo = InputPO & " "
   UserForm15.Label58.Visible = False
   UserForm15.TextBox2.Left = 342
   UserForm15.TextBox2.Width = 114
  End If
 ElseIf Left(InputPO, 1) = "P" And Len(InputPO) > 1 Then
  PONo = (Right(InputPO, Len(InputPO) - 1))
  If IsNumeric(PONo) Then
   If Len(PONo) < 7 Then
    PONo = Right(("000000" & PONo), 6)
    UserForm15.TextBox2.Text = PONo
    PONo = "P" & PONo
    UserForm15.Label58.Visible = True
    UserForm15.TextBox2.Left = 366
    UserForm15.TextBox2.Width = 90
   Else
    PONo = InputPO & " "
    UserForm15.Label58.Visible = False
    UserForm15.TextBox2.Left = 342
    UserForm15.TextBox2.Width = 114
   End If
  Else
   PONo = InputPO & " "
   UserForm15.Label58.Visible = False
   UserForm15.TextBox2.Left = 342
   UserForm15.TextBox2.Width = 114
  End If
 Else
  PONo = InputPO & " "
   UserForm15.Label58.Visible = False
   UserForm15.TextBox2.Left = 342
   UserForm15.TextBox2.Width = 114
 End If
Else
 If IsNumeric(InputPO) = False Then
  Call POTempFormat("")
  UserForm15.Label23.Caption = Chr(13) & "       Not a correct Debit Note #.  "
  UserForm15.Label23.Visible = True
  UserForm15.TextBox2.Text = InputPO
  Exit Sub
 Else
   PONo = Right("00000" & UserForm15.TextBox2.Text, 5)
   UserForm15.TextBox2.Text = PONo
   PONo = "DN" & PONo
  End If
End If
If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = True Then
  Call POTempFormat("")
  If UserForm15.Label1.Caption = "DEBIT NOTE " Then
   UserForm15.Label23.Caption = Chr(13) & Chr(13) & "      The Debit Note is not found from the record.  "
  Else
    UserForm15.Label23.Caption = Chr(13) & Chr(13) & "    The PO is not found from the record.  "
  End If
   UserForm15.Label23.Visible = True
 Exit Sub
End If
 InvRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("PORecord").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 InvStatus = Range("J1").Value
 OSAmt = Range("K1").Value
 DueDate = Range("N1").Value
 SupplierNo = Range("P1").Value
 SupplierName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 CustPO = Range("AB1").Value
 SalesRep = Range("AC1").Value
 TotalAmount = Range("AF1").Value
 If IsDate(Range("AG1").Value) Then
   DelDate = Format(Range("AG1").Value, "yyyy/mm/dd")
 Else
   DelDate = Range("AG1").Value
 End If
 Remarks = Range("AH1").Value
 InvDate = Range("D1").Value
 PayTerm = Range("O1").Value
 UserForm15.TextBox53.Text = Range("IT1").Value
 UserForm15.TextBox54.Text = Range("IU1").Value
 UserForm15.TextBox55.Text = Range("IV1").Value
If UserForm15.Label1.Caption = "PURCHASE ORDER " Then
 If TelNo <> "" Then
  UserForm15.Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
  "     " & Address1 & Chr(13) & _
  "     " & Address2 & Chr(13) & _
  "     " & Address3 & Chr(13) & _
  "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
 Else
   UserForm15.Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
  "     " & Address1 & Chr(13) & _
  "     " & Address2 & Chr(13) & _
  "     " & Address3 & Chr(13) & _
  "     Contact: " & CustContact
 End If
   UserForm15.TextBox41.Text = DelName
   UserForm15.TextBox42.Text = DelAddress1
   UserForm15.TextBox43.Text = DelAddress2
   UserForm15.TextBox44.Text = DelAddress3
   UserForm15.TextBox45.Text = DelContact
   UserForm15.TextBox1.Text = SupplierNo
  UserForm15.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
  UserForm15.TextBox4.Text = CustPO
  UserForm15.TextBox46.Text = SalesRep
  UserForm15.Label39.Caption = PayTerm
  UserForm15.TextBox47.Text = Format(DelDate, "yyyy/mm/dd")
  UserForm15.TextBox49.Text = Remarks
  UserForm15.Label26.Caption = Format(TotalAmount, "#,##0.00")
  For I = 15 To 20
   UserForm15.Controls("Label" & I).Caption = I - 14
  Next I
  J = 43
  For I = 5 To 184 Step 9
   Range(Cells(J, 3), Cells(J + 1, 13)).NumberFormat = "General"
   Cells(J, 4).NumberFormat = "@"
   Cells(J, 5).NumberFormat = "@"
   Cells(J, 15).NumberFormat = "@"
   Cells(J, 3).Value = Cells(1, I + 30).Value
   Cells(J, 4).Value = Cells(1, I + 31).Value
   Cells(J, 5).Value = Cells(1, I + 32).Value
   Cells(J, 6).Value = Cells(1, I + 33).Value
   Cells(J, 7).Value = Cells(1, I + 34).Value
   Cells(J, 8).Value = Cells(1, I + 35).Value
   Cells(J, 9).Value = Cells(1, I + 36).Value
   Cells(J, 10).Value = Cells(1, I + 37).Value
   Cells(J, 11).Value = Cells(1, I + 38).Value
   J = J + 1
  Next I
  Range("D43").Select
  For I = 5 To 34 Step 5
   UserForm15.Controls("TextBox" & I).Text = ActiveCell.Value
   UserForm15.Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
   UserForm15.Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
   UserForm15.Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
   UserForm15.Controls("TextBox" & I + 4).Text = ActiveCell.Offset(0, 4).Value
   UserForm15.Controls("Label" & (I / 5) + 26).Caption = ActiveCell.Offset(0, 5).Value
   ActiveCell.Offset(1, 0).Select
  Next I
Else
  If TelNo <> "" Then
    UserForm15.Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
    "     " & Address1 & Chr(13) & _
    "     " & Address2 & Chr(13) & _
    "     " & Address3 & Chr(13) & _
    "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
  Else
    UserForm15.Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
    "     " & Address1 & Chr(13) & _
    "     " & Address2 & Chr(13) & _
    "     " & Address3 & Chr(13) & _
    "     Contact: " & CustContact
  End If
 UserForm15.TextBox1.Text = SupplierNo
 UserForm15.TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 UserForm15.TextBox4.Text = CustPO
 UserForm15.TextBox46.Text = SalesRep
 UserForm15.Label39.Caption = PayTerm
 DelDate = Format(DueDate, "yyyy/mm/dd")
 UserForm15.TextBox47.Text = DelDate
 UserForm15.TextBox49.Text = Remarks
 UserForm15.Label26.Caption = Format(TotalAmount * (-1), "#,##0.00")
  For I = 15 To 20
   UserForm15.Controls("Label" & I).Caption = I - 14
  Next I
  J = 42
  K = 1
  For I = 5 To 184 Step 9
   ActiveCell.Offset(J, K + 1).NumberFormat = "General"
   ActiveCell.Offset(J, K + 2).NumberFormat = "@"
   ActiveCell.Offset(J, K + 3).NumberFormat = "@"
   ActiveCell.Offset(J, K + 13).NumberFormat = "@"
   ActiveCell.Offset(J, K + 1).Value = Cells(1, I + 30).Value
   ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
   ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
   If Cells(1, I + 33).Value <> "" Or Cells(1, I + 33).Value <> 0 Then ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value * (-1)
   ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
   ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value
   If Cells(1, I + 36).Value <> "" Or Cells(1, I + 36).Value <> 0 Then ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 36).Value * (-1)
   ActiveCell.Offset(J, K + 13).Value = Cells(1, I + 37).Value
   J = J + 1
   K = 1
  Next I
  Range("D43").Select
  For I = 5 To 34 Step 5
   UserForm15.Controls("TextBox" & I).Text = ActiveCell.Value
   UserForm15.Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
   UserForm15.Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
   UserForm15.Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
   UserForm15.Controls("TextBox" & I + 4).Text = ActiveCell.Offset(0, 4).Value
   UserForm15.Controls("Label" & (I / 5) + 26).Caption = ActiveCell.Offset(0, 5).Value
   ActiveCell.Offset(1, 0).Select
  Next I
End If
  UserForm15.ScrollBar1.Value = 1
 For J = 0 To 5
   If IsNumeric(UserForm15.Controls("Label" & J + 27).Caption) Then UserForm15.Controls("Label" & J + 27).Caption = Format(UserForm15.Controls("Label" & J + 27).Caption, "#,##0.00")
 Next J
Range("A1").EntireRow.ClearContents
UserForm15.Label23.Visible = False
UserForm15.Label39.Left = 120
UserForm15.Label39.Width = 120
UserForm15.TextBox51.Text = ""
UserForm15.TextBox51.Visible = False
UserForm15.CommandButton19.Visible = False
End Sub

Sub APReport(RunCode As String)
Dim I As Long, J As Long, SortType As String, StartDate As Date, EndDate As Date, RptType As String, AcctNo As String
Dim GrandInv As Double, GrandDue As Double
If RunCode <> "APREPORT" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("A1").Select
UserForm21.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
If UserForm21.OptionButton2.Value = True Then
 RptType = "U"
 Else
  RptType = "A"
  StartDate = UserForm21.TextBox1.Text
  EndDate = UserForm21.TextBox2.Text
End If
 ThisWorkbook.Worksheets("TempRP").Activate
If UserForm21.OptionButton3.Value = True Then
  SortType = "I"
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A10").Value = "PO /DN #"
    Range("A11").Value = "-------------------"
    Range("B9").Value = "Goods Rec'd Date"
    Range("B10").Value = " / DN Date "
    Range("B11").Value = "-----------------------"
    Range("C10").Value = "Supplier Invoice #"
    Range("C11").Value = "------------------------"
    Range("D10").Value = "Supplier #"
    Range("D11").Value = "---------------"
    Range("E10").Value = "Supplier Name"
    Range("E11").Value = "-------------------------------------------------"
    Range("F8").Value = "Total Amt of"
    Range("F9").Value = "Goods Rec'd"
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-------------------"
    Range("G9").Value = "Amount Due"
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "--------------------"
    Range("H10").Value = "Due Date"
    Range("H11").Value = "------------------"
    Columns("A:A").ColumnWidth = 16
    Columns("B:B").ColumnWidth = 16
    Columns("C:C").ColumnWidth = 18
    Columns("D:D").ColumnWidth = 12
    Columns("E:E").ColumnWidth = 34.5
    Columns("F:G").ColumnWidth = 13.5
    Columns("H:H").ColumnWidth = 13
    Columns("B:B").NumberFormat = "yyyy/mm/dd"
    Columns("A:D").HorizontalAlignment = xlCenter
    Columns("E").HorizontalAlignment = xlLeft
    Columns("F:G").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("H:H").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Range("E1:E7").HorizontalAlignment = xlCenter
    Range("E1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("E2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("E3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("E4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("A12").Select
ElseIf UserForm21.OptionButton4.Value = True Then
 SortType = "D"
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Worksheets("Report").Visible = xlSheetVisible
    Worksheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A9").Value = "Goods Rec'd Date"
    Range("A10").Value = " / DN Date "
    Range("A11").Value = "------------------------"
    Range("B10").Value = "PO / DN #"
    Range("B11").Value = "--------------------"
    Range("C10").Value = "Supplier Invoice #"
    Range("C11").Value = "------------------------"
    Range("D10").Value = "Supplier #"
    Range("D11").Value = "---------------"
    Range("E10").Value = "Supplier Name"
    Range("E11").Value = "------------------------------------------------"
    Range("F8").Value = "Total Amt of"
    Range("F9").Value = "Goods Rec'd"
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-----------------"
    Range("G9").Value = "Amount Due"
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "-----------------"
    Range("H10").Value = "Due Date"
    Range("H11").Value = "------------------"
    Columns("A:A").ColumnWidth = 17.5
    Columns("B:B").ColumnWidth = 16
    Columns("C:C").ColumnWidth = 18
    Columns("D:D").ColumnWidth = 12
    Columns("E:E").ColumnWidth = 34
    Columns("F:G").ColumnWidth = 13.5
    Columns("H:H").ColumnWidth = 13
    Columns("A:A").NumberFormat = "yyyy/mm/dd"
    Columns("A:D").HorizontalAlignment = xlCenter
    Columns("E").HorizontalAlignment = xlLeft
    Columns("F:G").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("H:H").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Range("E1:E7").HorizontalAlignment = xlCenter
    Range("E1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("E2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("E3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("E4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("A12").Select
Else
  SortType = "C"
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Worksheets("Report").Visible = xlSheetVisible
    Worksheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "Supplier #"
    Range("A11").Value = "---------------"
    Range("B10").Value = "Supplier Name"
    Range("B11").Value = "-------------------------------------------------"
    Range("C10").Value = "PO / DN #"
    Range("C11").Value = "-------------------"
    Range("D9").Value = "Goods Rec'd Date"
    Range("D10").Value = " / DN Date "
    Range("D11").Value = "-----------------------"
    Range("E10").Value = "Supplier Invoice #"
    Range("E11").Value = "------------------------"
    Range("F8").Value = "Total Amt of "
    Range("F9").Value = "Goods Rec'd"
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-----------------"
    Range("G9").Value = "Amount Due"
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "-----------------"
    Range("H10").Value = "Due Date"
    Range("H11").Value = "------------------"
    Columns("A:A").ColumnWidth = 12
    Columns("B:B").ColumnWidth = 34.5
    Columns("C:C").ColumnWidth = 16
    Columns("D:D").ColumnWidth = 16
    Columns("E:E").ColumnWidth = 18
    Columns("F:G").ColumnWidth = 13.5
    Columns("H:H").ColumnWidth = 13
    Columns("D:D").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("A").HorizontalAlignment = xlCenter
    Columns("B").HorizontalAlignment = xlLeft
    Columns("C").HorizontalAlignment = xlCenter
    Columns("E").HorizontalAlignment = xlCenter
    Columns("F:G").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("H:H").Select
    With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Range("D1:D7").HorizontalAlignment = xlCenter
    Range("D1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("D2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("D3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("D4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("A12").Select
End If
On Error GoTo ErrorHandling
MyBook.Worksheets("Payable").Activate
If Range("E4").Value = "" Then GoTo Finish
Range("A1").Select
If RptType = "U" Then
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("V1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("V4").Select
  If ActiveCell.Value < "R" And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < "R" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < "R" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(4, 1), Cells(I, 23)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Else
    GoTo Finish
  End If
Else
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("D4").Select
  I = 4
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
      J = ActiveCell.Row - 1
 If J < I Then GoTo Finish
  Range(Cells(I, 1), Cells(J, 23)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
End If
ActiveSheet.UsedRange.Select
  Columns("R:V").Delete
  Columns("O").Delete
  Columns("M").Delete
  Columns("E:J").Delete
  Columns("C").Delete
  Columns("A").Delete
 If SortType = "I" Then
    Columns("C:F").Insert
    Columns("L").Cut
    Range("C1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Columns("J:K").Cut
    Range("D1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Columns("H").Cut
    Range("F1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("H").Delete
   Range("A1").Select
 ElseIf SortType = "D" Then
   Columns("A").Insert
   Columns("C").Cut
   Range("A1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Columns("I").Cut
   Range("C1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Columns("D:F").Insert
   Columns("J:K").Cut
    Range("D1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("H").Cut
    Range("F1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Columns("H").Delete
    Range("A1").Select
 Else
   Columns("A:B").Insert
   Columns("H:I").Cut
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("E:F").Insert
   Columns("L").Cut
    Range("E1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
   Columns("H").Cut
    Range("F1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Columns("H").Delete
    Range("A1").Select
 End If
If SortType = "I" Then
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
ElseIf SortType = "D" Then
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
Else
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
End If
Selection.Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Application.CutCopyMode = False
If SortType = "I" Or SortType = "D" Then
     Range("F9").End(xlDown).Select
     J = ActiveCell.Row
  If J > 11 Then
   Cells(J + 2, 7).Value = Application.Sum(Range(Cells(12, 7), Cells(J, 7)))
   Cells(J + 2, 6).Value = Application.Sum(Range(Cells(12, 6), Cells(J, 6)))
   Cells(J + 2, 5).Value = "Total : "
   Cells(J + 2, 5).HorizontalAlignment = xlRight
  End If
 Range("A2").Select
Else
 I = 12
 J = 11
 GrandInv = 0
 GrandDue = 0
 Range("A12").Select
 Do While ActiveCell.Value <> ""
  AcctNo = ActiveCell.Value
  Do While ActiveCell.Value = AcctNo
   ActiveCell.Offset(1, 0).Select
  Loop
  J = ActiveCell.Row - 1
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
   Cells(J + 1, 6).Value = Application.Sum(Range(Cells(I, 6), Cells(J, 6)))
   GrandInv = GrandInv + Application.Sum(Range(Cells(I, 6), Cells(J, 6)))
   Cells(J + 1, 7).Value = Application.Sum(Range(Cells(I, 7), Cells(J, 7)))
   GrandDue = GrandDue + Application.Sum(Range(Cells(I, 7), Cells(J, 7)))
   Cells(J + 1, 5).Value = "Total : "
   Cells(J + 1, 5).HorizontalAlignment = xlRight
  If J > I Then
   Range(Cells(I + 1, 1), Cells(J, 2)).ClearContents
  End If
  I = J + 3
  J = J + 2
  Cells(I, 1).Select
 Loop
 Cells(I, 5).Value = "Grand Total : "
 Cells(I, 5).HorizontalAlignment = xlRight
 Cells(I, 6).Value = GrandInv
 Cells(I, 7).Value = GrandDue
 Range("A2").Select
End If
Finish:
  ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
  If SortType = "I" Then
   If RptType = "U" Then
    Range("E6").Value = "Listing of All Unsettled Payables and Debit Notes"
    Range("E7").Value = "(Sorted by PO # and Debit Note #)"
   Else
    Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
    Range("E6").Value = "Listing of Payables and Debit Notes"
    Range("E7").Value = "(Sorted by PO # and Debit Note #)"
   End If
   Range("A1:J19").Select
   ActiveWindow.Zoom = True
  End If
  If SortType = "D" Then
    If RptType = "U" Then
      Range("E6").Value = "Listing of All Unsettled Payables and Debit Notes"
      Range("E7").Value = "(Sorted by Goods Rec'd Dates and Debit Note dates)"
    Else
      Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
      Range("E6").Value = "Listing of Payables and Debit Notes"
      Range("E7").Value = "(Sorted by Goods Rec'd Dates and Debit Note dates)"
    End If
   End If
  If SortType = "C" Then
    If RptType = "U" Then
      Range("D6").Value = "Listing of All Unsettled Payables and Debit Notes"
      Range("D7").Value = "(Sorted by Supplier Numbers)"
    Else
      Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
      Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
      Range("D6").Value = "Listing of Payables and Debit Notes"
      Range("D7").Value = "(Sorted by Supplier Numbers)"
    End If
   End If
    Range("A1:H23").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A12").Value = "" Then Range("D13").Value = " No Data for the selected period and range. "
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
 On Error GoTo ErrorHandling
  Unload UserForm21
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
  Exit Sub
ErrorHandling:
   Unload UserForm21
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub APAge(RunCode As String)
Dim I As Long, SuppCode As String, SumDue As Double, SumC As Double, Sum0 As Double, Sum30 As Double
Dim Sum60 As Double, Sum90 As Double, TotalDue As Double, TotalC As Double, Total0 As Double, Total30 As Double
Dim Total60 As Double, Total90 As Double, CloseDate As Date, StartCustNo As String, Supplier As String
If RunCode <> "APAGING" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("A1").Select
UserForm22.Caption = "Payable Aging Reporting"
UserForm22.Label1.Caption = "Payable Aging Report"
UserForm22.OptionButton2.Caption = "All Suppliers"
UserForm22.OptionButton2.Value = True
UserForm22.OptionButton3.Visible = False
UserForm22.Label15.Visible = False
UserForm22.OptionButton4.Visible = False
UserForm22.OptionButton5.Visible = False
UserForm22.OptionButton1.Caption = "Selected Supplier"
UserForm22.Label2.Visible = False
UserForm22.Label3.Visible = False
UserForm22.Label8.Visible = False
UserForm22.Label9.Visible = False
UserForm22.TextBox1.Visible = False
UserForm22.TextBox2.Visible = False
UserForm22.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
If UserForm22.OptionButton1.Value = True Then
 StartCustNo = UserForm22.TextBox3.Text
 Supplier = UserForm22.Label11.Caption
Else
 StartCustNo = "*"
 Supplier = ""
End If
CloseDate = Date
 ThisWorkbook.Worksheets("Report").Activate
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
 Application.EnableEvents = True
    Range("A10").Value = "PO /DN #"
    Range("A11").Value = "---------------------"
    Range("B9").Value = "Goods Rec'd"
    Range("B10").Value = "Date"
    Range("B11").Value = "------------------"
    Range("C9").Value = "Supplier"
    Range("C10").Value = "Invoice #"
    Range("C11").Value = "-----------------------"
    Range("D10").Value = "Due Date"
    Range("D11").Value = "------------------"
    Range("E9").Value = "Amount Due"
    Range("E10").Value = "(" & SysCurrency & ")  "
    Range("E11").Value = "-------------------"
    Range("H9").Value = "CURRENT"
    Range("H10").Value = "(" & SysCurrency & ")  "
    Range("H11").Value = "--------------------"
    Range("I9").Value = "0 - 30 Days"
    Range("I10").Value = "(" & SysCurrency & ")  "
    Range("I11").Value = "--------------------"
    Range("J9").Value = "31 - 60 Days"
    Range("J10").Value = "(" & SysCurrency & ")  "
    Range("J11").Value = "--------------------"
    Range("K9").Value = "61 - 90 Days"
    Range("K10").Value = "(" & SysCurrency & ")  "
    Range("K11").Value = "--------------------"
    Range("L9").Value = "Over 90 Days"
    Range("L10").Value = "(" & SysCurrency & ")  "
    Range("L11").Value = "--------------------"
    Columns("A:A").ColumnWidth = 16
    Columns("B:L").ColumnWidth = 13
    Columns("C:C").ColumnWidth = 18
    Columns("A").HorizontalAlignment = xlLeft
    Columns("C").HorizontalAlignment = xlCenter
    Columns("B").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("D").Select
      With Selection
        .HorizontalAlignment = xlCenter
        .NumberFormat = "yyyy/mm/dd"
    End With
    Columns("E:L").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("B9:C10").HorizontalAlignment = xlCenter
    Range("H1:H7").HorizontalAlignment = xlCenter
    Range("H1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("H2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("H3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("H4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
   MyBook.Worksheets("Payable").Activate
  If Range("E4").Value = "" Then GoTo Finish
  Range("A1").Select
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
   Selection.Sort Key1:=Range("V1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("V4").Select
 If ActiveCell.Value < "R" And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < "R" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < "R" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(4, 2), Cells(I, 23)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
ActiveSheet.UsedRange.Select
  Columns("V").Cut
  Range("D1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("M").Cut
  Range("E1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("J").Cut
  Range("F1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("O:P").Cut
  Range("G1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("I:V").Delete
  Columns("B").Delete
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("F1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
If StartCustNo <> "*" Then
 Range("F1").Select
 If ActiveCell.Value < StartCustNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value < StartCustNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value < StartCustNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(1, 1), Cells(I, 17)).EntireRow.Delete
 End If
 Range("F1").Select
 If ActiveCell.Value <= StartCustNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value <= StartCustNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value <= StartCustNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   If I > 0 Then
    If Cells(I + 1, 6).Value <> "" Then
      ActiveCell.EntireRow.Insert
      ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
    End If
   Else: GoTo Finish
   End If
   ActiveSheet.UsedRange.Select
 Else
  GoTo Finish
 End If
End If
Selection.Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
    Application.CutCopyMode = False
 SumDue = 0
 SumC = 0
 Sum0 = 0
 Sum30 = 0
 Sum60 = 0
 Sum90 = 0
 TotalDue = 0
 TotalC = 0
 Total0 = 0
 Total30 = 0
 Total60 = 0
 Total90 = 0
 Range("F12").Select
 Do While ActiveCell.Value <> ""
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.EntireRow.Insert
  ActiveCell.Offset(3, 0).Select
  SuppCode = ActiveCell.Value
  ActiveCell.Offset(-2, -5).NumberFormat = "@"
  ActiveCell.Offset(-2, -5).Value = ActiveCell.Offset(0, 1).Value & " ( # : " & SuppCode & " )"
  Do While ActiveCell.Value = SuppCode
   If CloseDate - ActiveCell.Offset(0, -2).Value > 90 Then
    ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, -1).Value
    Sum90 = Sum90 + ActiveCell.Offset(0, -1).Value
   ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 60 Then
    ActiveCell.Offset(0, 5).Value = ActiveCell.Offset(0, -1).Value
    Sum60 = Sum60 + ActiveCell.Offset(0, -1).Value
   ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 30 Then
    ActiveCell.Offset(0, 4).Value = ActiveCell.Offset(0, -1).Value
    Sum30 = Sum30 + ActiveCell.Offset(0, -1).Value
   ElseIf CloseDate - ActiveCell.Offset(0, -2).Value > 0 Then
    ActiveCell.Offset(0, 3).Value = ActiveCell.Offset(0, -1).Value
    Sum0 = Sum0 + ActiveCell.Offset(0, -1).Value
  Else
    ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, -1).Value
    SumC = SumC + ActiveCell.Offset(0, -1).Value
  End If
   ActiveCell.Offset(1, 0).Select
  Loop
  I = ActiveCell.Row
  SumDue = SumC + Sum0 + Sum30 + Sum60 + Sum90
  TotalDue = TotalDue + SumDue
  TotalC = TotalC + SumC
  Total0 = Total0 + Sum0
  Total30 = Total30 + Sum30
  Total60 = Total60 + Sum60
  Total90 = Total90 + Sum90
  ActiveCell.EntireRow.Insert
  Range(Cells(I - 1, 5), Cells(I - 1, 12)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
    End With
   Range(Cells(I, 1), Cells(I, 12)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Cells(I, 6).Select
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "Total : "
  ActiveCell.Offset(0, -1).Value = SumDue
  ActiveCell.Offset(0, 2).Value = SumC
  ActiveCell.Offset(0, 3).Value = Sum0
  ActiveCell.Offset(0, 4).Value = Sum30
  ActiveCell.Offset(0, 5).Value = Sum60
  ActiveCell.Offset(0, 6).Value = Sum90
  SumDue = 0
  SumC = 0
  Sum0 = 0
  Sum30 = 0
  Sum60 = 0
  Sum90 = 0
  ActiveCell.Offset(1, 0).Select
 Loop
   ActiveCell.Offset(1, 0).Select
  If UserForm22.OptionButton1.Value = True Then GoTo Finish
  ActiveCell.Offset(0, -2).HorizontalAlignment = xlRight
  ActiveCell.Offset(0, -2).Value = "GrandTotal : "
  ActiveCell.Offset(0, -1).Value = TotalDue
  ActiveCell.Offset(0, 2).Value = TotalC
  ActiveCell.Offset(0, 3).Value = Total0
  ActiveCell.Offset(0, 4).Value = Total30
  ActiveCell.Offset(0, 5).Value = Total60
  ActiveCell.Offset(0, 6).Value = Total90
End If
Finish:
  ThisWorkbook.Worksheets("Report").Activate
  Columns("F:G").Delete
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
  If UserForm22.OptionButton1.Value = True Then
    Range("F6").Value = "Aged Report for Unsettled Payables and Debit Notes"
    Range("F7").Value = "for Supplier :" & Supplier & " (# " & StartCustNo & ")"
  Else
    Range("F6").Value = "Aged Report for Unsettled Payables and Debit Notes"
  End If
    Range("A1:J18").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A13").Value = "" Then
   Range("A13").EntireRow.Delete
   Range("D13").Value = " No Data for the selected Supplier range. "
  End If
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
  ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
   On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
  Unload UserForm22
  SheetName = "Report"
  OldForm = "UserForm8"
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 ThisWorkbook.Worksheets("Report").Activate
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A3").Select
End Sub

Sub PartBuy(RunCode As String)
Dim I As Long, J As Long, LineStart As Long, SuppCode As String, Supplier As String
Dim Total As Double, QtyGTotal As Double, AmtGTotal As Double, POQty As Double, POTotal As Double
Dim StartDate As Date, EndDate As Date, AcctNo As String
If RunCode <> "PARTPUR" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("K1").Select
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A9").Value = "Purchase"
    Range("A10").Value = "Item #"
    Range("A11").Value = "-----------------------"
    Range("B10").Value = "Description"
    Range("B11").Value = "-----------------------------------------------------------------"
    Range("C10").Value = " PO Qty "
    Range("C11").Value = "-------------------"
    Range("D8").Value = "Discounted "
    Range("D9").Value = " PO Amount "
    Range("D10").Value = "(" & SysCurrency & ")  "
    Range("D11").Value = "-------------------"
    Range("E9").Value = " Received "
    Range("E10").Value = " Quantity "
    Range("E11").Value = "-------------------"
    Range("F8").Value = "Amount of  "
    Range("F9").Value = " Rec'd Items "
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "-------------------"
    Columns("A").ColumnWidth = 20
    Columns("B").ColumnWidth = 45
    Columns("C").ColumnWidth = 16
    Columns("D").ColumnWidth = 18
    Columns("E").ColumnWidth = 16
    Columns("F").ColumnWidth = 18
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C").HorizontalAlignment = xlCenter
    Columns("D").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Columns("E").HorizontalAlignment = xlCenter
    Columns("F").Select
    With Selection
        .HorizontalAlignment = xlRight
        .NumberFormat = "#,##0.00"
    End With
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
  UserForm22.OptionButton2.Value = True
  UserForm22.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
  If UserForm22.OptionButton3.Value = True Then
   Call PODelRecord("DelRecord")
   Exit Sub
  End If
  StartDate = UserForm22.TextBox1.Text
  EndDate = UserForm22.TextBox2.Text
  If StartDate > EndDate Then
   StartDate = UserForm22.TextBox2.Text
   EndDate = UserForm22.TextBox1.Text
  End If
If UserForm22.OptionButton1.Value = True Then
 SuppCode = UserForm22.TextBox3.Text
 Supplier = UserForm22.Label11.Caption
ElseIf UserForm22.OptionButton2.Value = True Then
 SuppCode = "*"
 Supplier = ""
Else
 If UserForm22.OptionButton4.Value = True Then
   Call POListing("PO", StartDate, EndDate)
 Else
   Call POListing("Supplier", StartDate, EndDate)
 End If
 Exit Sub
End If
On Error GoTo ErrorHandling
   MyBook.Worksheets("Payable").Activate
  If Range("E4").Value = "" Then GoTo NoPayable
If SuppCode = "*" Then
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("D4").Select
  I = 4
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
      J = ActiveCell.Row - 1
 If J < I Then GoTo NoPayable
Else
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("P4").Select
  If ActiveCell.Value < SuppCode And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < SuppCode And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < SuppCode And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   End If
     If ActiveCell.Value = SuppCode Then
        I = ActiveCell.Row
        Supplier = ActiveCell.Offset(0, 1).Value
     Else
      GoTo NoPayable
     End If
     Do While ActiveCell.Value = SuppCode And ActiveCell.Offset(0, -12).Value < StartDate
      ActiveCell.Offset(1, 0).Select
     Loop
     I = ActiveCell.Row
     Do While ActiveCell.Value = SuppCode And ActiveCell.Offset(0, -12).Value <= EndDate
      ActiveCell.Offset(1, 0).Select
     Loop
    J = ActiveCell.Row - 1
  If J < I Then GoTo NoPayable
End If
  Range(Cells(I, 16), Cells(J, 164)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("K1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("M:R").Delete
  Columns("G:L").NumberFormat = "@"
 I = 1
 Range("A1").Select
 Do While Cells(I, 11).Value <> ""
  J = Cells(I, 13).Value
  K = 15
  Do While J > 0
    Range(Cells(I, K), Cells(I, K + 1)).Copy
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveCell.Offset(0, 4).Value = Cells(I, K + 2)
    ActiveCell.Offset(0, 5).Value = Cells(I, K + 5)
    ActiveCell.Offset(0, 6).Value = Cells(I, 11).Value
    ActiveCell.Offset(0, 7).Value = Cells(I, 12).Value
    ActiveCell.Offset(1, 0).Select
    J = J - 1
    K = K + 7
  Loop
  I = I + 1
 Loop
   Columns("K:EZ").Delete
NoPayable:
   MyBook.Worksheets("PORecord").Activate
  If Range("E4").Value = "" Then GoTo OKtoSort
If SuppCode = "*" Then
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("A4").Select
  I = 4
  If Left(ActiveCell.Value, 1) <> "P" And ActiveCell.Value <> "" Then
     Do While Left(ActiveCell.Value, 1) <> "P" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While Left(ActiveCell.Value, 1) <> "P" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Offset(0, 4).Value = "" Then GoTo OKtoSort
  Cells(I, 4).Select
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > I + 29 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > I + 29 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
      J = ActiveCell.Row - 1
 If J < I Then GoTo OKtoSort
Else
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("P1"), Order2:=xlAscending, _
        Key3:=Range("D1"), Order3:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("A4").Select
  I = 4
  If Left(ActiveCell.Value, 1) <> "P" And ActiveCell.Value <> "" Then
     Do While Left(ActiveCell.Value, 1) <> "P" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While Left(ActiveCell.Value, 1) <> "P" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Offset(0, 4).Value = "" Then GoTo OKtoSort
  Cells(I, 16).Select
  If ActiveCell.Value < SuppCode And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < SuppCode And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > I + 29 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < SuppCode And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   End If
     If ActiveCell.Value = SuppCode Then
        I = ActiveCell.Row
        Supplier = ActiveCell.Offset(0, 1).Value
     Else
      GoTo OKtoSort
     End If
     Do While ActiveCell.Value = SuppCode And ActiveCell.Offset(0, -12).Value < StartDate
      ActiveCell.Offset(1, 0).Select
     Loop
     I = ActiveCell.Row
     Do While ActiveCell.Value = SuppCode And ActiveCell.Offset(0, -12).Value <= EndDate
      ActiveCell.Offset(1, 0).Select
     Loop
    J = ActiveCell.Row - 1
  If J < I Then GoTo OKtoSort
End If
  Range(Cells(I, 16), Cells(J, 214)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("K1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("M:X").Delete
  Columns("G:L").NumberFormat = "@"
If Range("A1").Value = "" Then
  Range("A1").Select
ElseIf Range("A2").Value = "" Then
  Range("A2").Select
Else
  Range("A1").End(xlDown).Select
  ActiveCell.Offset(1, 0).Select
End If
 I = 1
 Do While Cells(I, 11).Value <> ""
  J = Cells(I, 13).Value
  K = 19
  Do While J > 0
    Range(Cells(I, K), Cells(I, K + 2)).Copy
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveCell.Offset(0, 3).Value = Cells(I, K + 5)
    ActiveCell.Offset(0, 6).Value = Cells(I, 11).Value
    ActiveCell.Offset(0, 7).Value = Cells(I, 12).Value
    ActiveCell.Offset(1, 0).Select
    J = J - 1
    K = K + 9
  Loop
  I = I + 1
 Loop
   Columns("K:GQ").Delete
OKtoSort:
ThisWorkbook.Worksheets("TempRP").Activate
 If Range("A1").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
  Selection.Sort Key1:=Range("G1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Selection.Copy
   ThisWorkbook.Worksheets("Report").Activate
   Range("A12").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
   Application.CutCopyMode = False
   Range("A12").Select
    I = 12
    J = 11
    POQty = 0
    POTotal = 0
    QtyGTotal = 0
    AmtGTotal = 0
  Do While ActiveCell.Value <> ""
   AcctNo = ActiveCell.Value
   Supplier = ActiveCell.Offset(0, 7).Value
   SuppCode = ActiveCell.Offset(0, 6).Value
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   ActiveCell.HorizontalAlignment = xlLeft
   ActiveCell.Offset(1, 0).Value = Supplier & " ( # " & SuppCode & " )"
   ActiveCell.Offset(2, 0).Select
   I = I + 2
   LineStart = I
   Do While ActiveCell.Offset(0, 7).Value = Supplier
     Do While ActiveCell.Value = AcctNo And ActiveCell.Offset(0, 7).Value = Supplier
       ActiveCell.Offset(1, 0).Select
     Loop
    J = ActiveCell.Row - 1
    If J > I Then
     Total = Application.Sum(Range(Cells(I, 3), Cells(J, 3)))
     Cells(I, 3).Value = Total
     Total = Application.Sum(Range(Cells(I, 4), Cells(J, 4)))
     Cells(I, 4).Value = Total
     Total = Application.Sum(Range(Cells(I, 5), Cells(J, 5)))
     Cells(I, 5).Value = Total
     Total = Application.Sum(Range(Cells(I, 6), Cells(J, 6)))
     Cells(I, 6).Value = Total
     Range(Cells(I + 1, 1), Cells(J, 5)).EntireRow.Delete
    ElseIf J = I Then
     If Cells(J, 3).Value = "" Then Cells(J, 3).Value = 0
     If Cells(J, 4).Value = "" Then Cells(J, 4).Value = 0
     If Cells(J, 5).Value = "" Then Cells(J, 5).Value = 0
     If Cells(J, 6).Value = "" Then Cells(J, 6).Value = 0
    End If
    I = I + 1
    J = I - 1
    Cells(I, 1).Select
    AcctNo = ActiveCell.Value
   Loop
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   Total = Application.Sum(Range(Cells(LineStart, 3), Cells(I - 1, 3)))
   Cells(I + 1, 3).Value = Total
   POQty = POQty + Total
   Total = Application.Sum(Range(Cells(LineStart, 4), Cells(I - 1, 4)))
   Cells(I + 1, 4).Value = Total
   POTotal = POTotal + Total
   Total = Application.Sum(Range(Cells(LineStart, 5), Cells(I - 1, 5)))
   Cells(I + 1, 5).Value = Total
   QtyGTotal = QtyGTotal + Total
   Total = Application.Sum(Range(Cells(LineStart, 6), Cells(I - 1, 6)))
   Cells(I + 1, 6).Value = Total
   AmtGTotal = AmtGTotal + Total
   Cells(I + 1, 2).HorizontalAlignment = xlRight
   Cells(I + 1, 2).Value = "Total : "
    Range(Cells(I + 1, 1), Cells(I + 1, 6)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
     I = I + 2
     J = I - 1
     Cells(I, 1).Select
  Loop
  Columns("G:H").Delete
  Range("A12").Value = " "
  I = ActiveSheet.UsedRange.Rows.Count
  If Range("A12").Value <> "" And UserForm22.OptionButton1.Value <> True Then
    Cells(I + 2, 3).Value = POQty
    Cells(I + 2, 4).Value = POTotal
    Cells(I + 2, 5).Value = QtyGTotal
    Cells(I + 2, 6).Value = AmtGTotal
    Cells(I + 2, 2).HorizontalAlignment = xlRight
    Cells(I + 2, 2).Value = "Grand Total : "
  End If
Finish:
   ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A6") = "From: " & Format(StartDate, "yyyy/mm/dd")
    Range("A7") = "    To: " & Format(EndDate, "yyyy/mm/dd")
    If UserForm22.OptionButton1.Value = True Then
      Range("C6").Value = "Purchasing Summary Report"
      If Supplier <> "" Then
        Range("C7").Value = " ( for Supplier :-- " & Supplier & " ; # " & SuppCode & " ) "
      Else
        Range("C7").Value = " ( for Supplier # " & SuppCode & " ) "
      End If
     Else
        Range("C6").Value = "Purchasing Summary Report - sorted by Supplier name"
     End If
    Range("A1:F15").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A12").Value = "" Then Range("B13").Value = " No Data for the selected period and range. "
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
  On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
  On Error GoTo ErrorHandling
  Unload UserForm22
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
Exit Sub
ErrorHandling:
   Unload UserForm22
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub PODetail(RunCode As String)
Dim FRow As Long, LRow As Long, I As Long, J As Long, K As Long, M As Long
Dim POAmt As Double, DelAmt As Double, UnDelAmt As Double
Dim SuppCode As String, Supplier As String, CheckRange As Range
If RunCode <> "OSPODetail" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("M1").Select
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    ThisWorkbook.Worksheets("Report").Activate
    Range("A10").Value = "PO #"
    Range("A11").Value = "--------------------"
    Range("B10").Value = "PO Date"
    Range("B11").Value = "-----------------"
    Range("C9").Value = " Required "
    Range("C10").Value = " Del. Date "
    Range("C11").Value = "------------------"
    Range("D10").Value = " Part #  "
    Range("D11").Value = "--------------------------"
    Range("E10").Value = " Part Description"
    Range("E11").Value = "-------------------------------------------------------------------------------"
    Range("F9").Value = " Quantity  "
    Range("F10").Value = " Ordered  "
    Range("F11").Value = "-------------------"
    Range("G9").Value = " PO Amount "
    Range("G10").Value = "(" & SysCurrency & ")  "
    Range("G11").Value = "-------------------"
    Range("H9").Value = " Quantity  "
    Range("H10").Value = " Delivered  "
    Range("H11").Value = "-------------------"
    Range("I9").Value = " Amt Delivered "
    Range("I10").Value = "(" & SysCurrency & ")  "
    Range("I11").Value = "-------------------"
    Range("J9").Value = " Quantity "
    Range("J10").Value = "Outstanding"
    Range("J11").Value = "-------------------"
    Range("K9").Value = " Amt O/S "
    Range("K10").Value = "(" & SysCurrency & ")  "
    Range("K11").Value = "-------------------"
    Columns("A").ColumnWidth = 16
    Columns("B").ColumnWidth = 12
    Columns("C").ColumnWidth = 12
    Columns("D").ColumnWidth = 20
    Columns("E").ColumnWidth = 49
    Columns("F").ColumnWidth = 15
    Columns("G").ColumnWidth = 15
    Columns("H").ColumnWidth = 15
    Columns("I").ColumnWidth = 15
    Columns("J").ColumnWidth = 15
    Columns("K").ColumnWidth = 15
    Columns("A:E").HorizontalAlignment = xlLeft
    Columns("F").HorizontalAlignment = xlCenter
    Columns("G").HorizontalAlignment = xlRight
    Columns("H").HorizontalAlignment = xlCenter
    Columns("I").HorizontalAlignment = xlRight
    Columns("J").HorizontalAlignment = xlCenter
    Columns("K").HorizontalAlignment = xlRight
    Columns("A").NumberFormat = "@"
    Columns("B:C").NumberFormat = "yyyy/mm/dd"
    Columns("D:E").NumberFormat = "@"
    Columns("G").NumberFormat = "#,##0.00"
    Columns("I").NumberFormat = "#,##0.00"
    Columns("K").NumberFormat = "#,##0.00"
    Columns("D:E").ShrinkToFit = True
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("E1:G7").HorizontalAlignment = xlCenterAcrossSelection
    Range("E1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("E2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("E3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("E4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
  UserForm24.OptionButton5.Value = True
  UserForm24.Show
 If ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
    ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
    ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
    ThisWorkbook.Worksheets("System Menu").Activate
    SheetName = "System Menu"
    Application.ScreenUpdating = True
    Application.ScreenUpdating = False
    Application.EnableEvents = True
    UserForm8.Show
    Exit Sub
  End If
If UserForm24.OptionButton3.Value = True Then
 SuppCode = UserForm24.TextBox3.Text
 Supplier = UserForm24.Label11.Caption
Else
 SuppCode = "*"
 Supplier = ""
End If
On Error GoTo ErrorHandling
   MyBook.Worksheets("PORecord").Activate
  If Range("E4").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("J1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("A4").Select
  If Left(ActiveCell.Value, 1) < "P" And ActiveCell.Value <> "" Then
     Do While Left(ActiveCell.Value, 1) < "P" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While Left(ActiveCell.Value, 1) < "P" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
  FRow = ActiveCell.Row
   ActiveCell.Offset(0, 9).Select
  If ActiveCell.Value < "R" And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < "R" And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > FRow + 29 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < "R" And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
    LRow = ActiveCell.Row - 1
  If LRow < FRow Then GoTo Finish
  Range(Cells(FRow, 1), Cells(LRow, 216)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
If UserForm24.OptionButton2.Value <> True And UserForm24.OptionButton4.Value <> True Then
  If UserForm24.OptionButton5.Value <> True Then
     Selection.Sort Key1:=Range("AB1"), Order1:=xlAscending, Key2:=Range("N1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Else
     Selection.Sort Key1:=Range("AB1"), Order1:=xlAscending, Key2:=Range("AS1"), Order2:=xlAscending, _
        Key3:=Range("N1"), Order3:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  End If
  If SuppCode <> "*" Then
   Set CheckRange = Selection.Columns("P")
   If IsError(Application.Match(SuppCode, CheckRange, 0)) = False Then
     FRow = Application.Match(SuppCode, CheckRange, 0)
     LRow = Application.Match(SuppCode, CheckRange, 1)
     Range(Cells(FRow, 1), Cells(LRow, 216)).EntireRow.Copy
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(LRow - FRow + 2, 13).EntireRow.Insert
     Cells(LRow - FRow + 3, 13).CurrentRegion.EntireRow.Delete
   Else
    GoTo Finish
   End If
  End If
Else
     Selection.Sort Key1:=Range("N1"), Order1:=xlAscending, Key2:=Range("P1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
If UserForm24.OptionButton4.Value = True Then
   Set CheckRange = Selection.Columns("B")
   If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
     FRow = Application.Match(PONo, CheckRange, 0)
     LRow = Application.Match(PONo, CheckRange, 1)
     Range(Cells(FRow, 1), Cells(LRow, 216)).EntireRow.Copy
     Range("A1").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
     Cells(LRow - FRow + 2, 13).EntireRow.Insert
     Cells(LRow - FRow + 3, 13).CurrentRegion.EntireRow.Delete
   Else
    GoTo Finish
   End If
  End If
End If
 Range("AB1").Select
 SupplierNo = ActiveCell.Value
 I = 1
 K = 1
 POAmt = 0
 DelAmt = 0
 UnDelAmt = 0
 Do While ActiveCell.Value <> ""
   Cells(I, 1).Value = ActiveCell.Offset(0, 1).Value & "  (" & ActiveCell.Value & ")"
   I = I + 1
   M = I
   J = ActiveCell.Offset(0, 14).Value
   Cells(I, 1).NumberFormat = "@"
   Cells(I, 1).Value = ActiveCell.Offset(0, -14).Value
   Cells(I, 2).Value = ActiveCell.Offset(0, -12).Value
   Cells(I, 3).NumberFormat = "yyyy/mm/dd"
   Cells(I, 3).Value = ActiveCell.Offset(0, 17).Value
  Do While J > 0
   Range(Cells(I, 4), Cells(I, 5)).NumberFormat = "@"
   Cells(I, 4).Value = ActiveCell.Offset(0, 19 + K).Value
   Cells(I, 5).Value = ActiveCell.Offset(0, 19 + K + 1).Value
   Cells(I, 6).Value = ActiveCell.Offset(0, 19 + K + 2).Value
   If Cells(I, 6).Value = "" Then Cells(I, 6).Value = 0
   Cells(I, 7).Value = ActiveCell.Offset(0, 19 + K + 5).Value
   If Cells(I, 7).Value = "" Then Cells(I, 7).Value = 0
   Cells(I, 8).Value = ActiveCell.Offset(0, 19 + K + 7).Value
   If Cells(I, 8).Value = "" Then Cells(I, 8).Value = 0
   Cells(I, 9).Value = ActiveCell.Offset(0, 19 + K + 6).Value
   If Cells(I, 9).Value = "" Then Cells(I, 9).Value = 0
   Cells(I, 10).Value = Cells(I, 6).Value - Cells(I, 8).Value
   Cells(I, 11).Value = Cells(I, 7).Value - Cells(I, 9).Value
   I = I + 1
   J = J - 1
   K = K + 9
  Loop
  Cells(I, 1).Value = "Remark: " & ActiveCell.Offset(0, 18).Value
  Cells(I + 1, 6).Value = " Total :"
  Cells(I + 1, 7).Value = Application.Sum(Range(Cells(M, 7), Cells(I - 1, 7)))
  Cells(I + 1, 9).Value = Application.Sum(Range(Cells(M, 9), Cells(I - 1, 9)))
  Cells(I + 1, 11).Value = Application.Sum(Range(Cells(M, 11), Cells(I - 1, 11)))
  POAmt = POAmt + Cells(I + 1, 7).Value
  DelAmt = DelAmt + Cells(I + 1, 9).Value
  UnDelAmt = UnDelAmt + Cells(I + 1, 11).Value
   Worksheets("Report").Activate
    Cells(I + 12, 6).HorizontalAlignment = xlRight
    Range(Cells(I + 12, 1), Cells(I + 12, 11)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Worksheets("TempRP").Activate
  K = 1
  I = I + 3
  ActiveCell.Offset(1, 0).Select
 Loop
If UserForm24.OptionButton4 <> True Then
  Cells(I, 6).Value = " Grand Total :"
  Cells(I, 7).Value = POAmt
  Cells(I, 9).Value = DelAmt
  Cells(I, 11).Value = UnDelAmt
End If
  Range(Cells(1, 1), Cells(I, 11)).Copy
  Worksheets("Report").Activate
  Range("A12").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
       False, Transpose:=False
   Application.CutCopyMode = False
Finish:
   ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
     If UserForm24.OptionButton1.Value = True Then
        Range("E6").Value = "Outstanding Purchase Orders -- Sorted by Supplier numbers and PO # "
     ElseIf UserForm24.OptionButton5.Value = True Then
        Range("E6").Value = "Outstanding Purchase Orders -- Sorted by Supplier numbers and Required Delivery Date "
     ElseIf UserForm24.OptionButton2.Value = True Then
        Range("E6").Value = "Outstanding Purchase Orders -- Sorted by PO numbers "
     ElseIf UserForm24.OptionButton3.Value = True Then
      Range("E6").Value = "Outstanding Purchase Order Detail Report"
      If Supplier <> "" Then
        Range("E7").Value = " ( for Supplier :-- " & Supplier & " ; # " & SuppCode & " ) "
      Else
        Range("E7").Value = " ( for Supplier # " & SuppCode & " ) "
      End If
     Else
        Range("E6").Value = "Outstanding Purchase Order Report for PO # " & PONo
     End If
    Range("A1:K22").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
  If Range("A12").Value = "" Then
   If UserForm24.OptionButton1.Value = True Or UserForm24.OptionButton2.Value = True Or UserForm24.OptionButton5.Value = True Then
      Range("E13").ShrinkToFit = False
      Range("E13").Value = "  No Purchase Order is outstanding. "
   ElseIf UserForm24.OptionButton3.Value = True Then
      Range("E13").ShrinkToFit = False
      Range("E13").Value = "  No Outstanding Purchase Order for the Selected Supplier. "
   Else
      Range("E13").ShrinkToFit = False
      Range("E13").Value = " The Selected PO is not outstanding. "
   End If
  End If
  Unload UserForm24
   Worksheets("Report").Visible = xlSheetVisible
   Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
   On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$11"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
  SheetName = "Report"
  OldForm = "UserForm8"
Worksheets("Activity Report").Range("D6").ClearContents
Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
Exit Sub
ErrorHandling:
   Unload UserForm24
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
End Sub

Sub PaySuppRecord(RunCode As String)
Dim I As Long, J As Long, K As Long, StartDate As Date, EndDate As Date, PayRefNo As String
Dim GrandTotalA As Double, GrandTotalB As Double
If RunCode <> "PAYSUPP" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
  Application.EnableEvents = False
   Application.DisplayAlerts = False
   ThisWorkbook.Worksheets("Report").Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
    Worksheets("Report").Activate
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Columns("A:A").Select
    With Selection
        .ColumnWidth = 11.13
        .HorizontalAlignment = xlLeft
    End With
    Columns("B:B").Select
    With Selection
        .ColumnWidth = 13.88
        .NumberFormat = "yyyy/mm/dd"
        .HorizontalAlignment = xlCenter
    End With
    Columns("C:C").Select
    With Selection
        .ColumnWidth = 15.75
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
    Columns("D:D").Select
    With Selection
        .ColumnWidth = 13.38
        .HorizontalAlignment = xlCenter
        .NumberFormat = "@"
    End With
    Columns("E:E").Select
    With Selection
        .ColumnWidth = 12
        .HorizontalAlignment = xlCenter
        .NumberFormat = "@"
    End With
    Columns("F:F").Select
     With Selection
        .ColumnWidth = 15.75
        .NumberFormat = "yyyy/mm/dd"
        .HorizontalAlignment = xlCenter
     End With
    Columns("G:G").Select
    With Selection
        .ColumnWidth = 24
        .HorizontalAlignment = xlLeft
    End With
    Columns("H:H").Select
    With Selection
        .ColumnWidth = 16
        .HorizontalAlignment = xlLeft
    End With
    Columns("I:I").Select
    With Selection
        .ColumnWidth = 17
        .HorizontalAlignment = xlRight
    End With
    Columns("J:J").Select
    With Selection
        .ColumnWidth = 16
        .NumberFormat = "#,##0.00"
        .HorizontalAlignment = xlRight
    End With
    Range("A1:J11").VerticalAlignment = xlCenter
    Range("A11:J11").NumberFormat = "@"
    Range("A11").FormulaR1C1 = "-------------"
    Range("B11").FormulaR1C1 = "-------------"
    Range("C11").FormulaR1C1 = "------------------"
    Range("D11").FormulaR1C1 = "----------------"
    Range("E11").FormulaR1C1 = "---------------"
    Range("F11").FormulaR1C1 = "-------------------"
    Range("G11").FormulaR1C1 = "-------------------------------"
    Range("H11").FormulaR1C1 = "--------------------"
    Range("I11").FormulaR1C1 = "--------------------"
    Range("J11").FormulaR1C1 = "--------------------"
    Range("A10").Value = "Ref #"
    Range("B10").Value = "Pay Date"
    Range("C9").Value = "Payment Amt"
    Range("C10").Value = "(" & SysCurrency & ")"
    Range("D9").Value = "Payment"
    Range("D10").Value = "Method"
    Range("E10").Value = "Cheque #"
    Range("F10").Value = "Cheque Date"
    Range("G10").Value = "Cheque Issuing Bank"
    Range("H9").Value = "Paid to "
    Range("H10").Value = "PO # / DN # "
    Range("I9").Value = " Supplier "
    Range("I10").Value = " Invoice # "
    Range("J9").Value = "Applied Amt "
    Range("J10").Value = "(" & SysCurrency & ") "
    Columns("A:J").Select
    With Selection.Font
        .Name = "Arial"
        .Size = 13
    End With
  StartDate = UserForm23.TextBox1.Text
  EndDate = UserForm23.TextBox2.Text
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("A1").Select
 MyBook.Worksheets("PayMake").Activate
  If Range("A3").Value = "" Then
   If UserForm23.OptionButton2.Value = True Then GoTo FinishDate
   GoTo Finish
  End If
     Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1") _
        , Order2:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("B3").Select
   I = 3
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 32 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 32 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
   J = ActiveCell.Row - 1
 If J < I Then
  If UserForm23.OptionButton2.Value = True Then GoTo FinishDate
   GoTo Finish
 End If
  Range(Cells(I, 1), Cells(J, 14)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
If UserForm23.OptionButton1.Value = True Then
  SupplierNo = UserForm23.TextBox3.Text
  ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Key2:=Range("A1") _
        , Order2:=xlAscending, Key3:=Range("L1"), Order3:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Range("C1").Select
 If ActiveCell.Value < SupplierNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value < SupplierNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value < SupplierNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row - 1
   Range(Cells(1, 1), Cells(I, 13)).EntireRow.Delete
 End If
 Range("C1").Select
 If ActiveCell.Value <= SupplierNo And ActiveCell.Value <> "" Then
  Do While ActiveCell.Value <= SupplierNo And ActiveCell.Value <> ""
     ActiveCell.Offset(10, 0).Select
   Loop
   If ActiveCell.Row > 10 Then ActiveCell.Offset(-9, 0).Select
     Do While ActiveCell.Value <= SupplierNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
     Loop
  End If
   I = ActiveCell.Row - 1
   If I > 0 Then
    If Cells(I + 1, 1).Value <> "" Then
     ActiveCell.EntireRow.Insert
     ActiveCell.Offset(1, 0).CurrentRegion.EntireRow.Delete
    End If
   Else: GoTo Finish
   End If
End If
If UserForm23.OptionButton3.Value = True Or UserForm23.OptionButton1.Value = True Then
  ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Key2:=Range("A1") _
        , Order2:=xlAscending, Key3:=Range("L1"), Order3:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("A1").Select
   GrandTotalA = 0
   GrandTotalB = 0
  Do While ActiveCell.Value <> ""
   SupplierNo = ActiveCell.Offset(0, 2).Value
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   ActiveCell.Value = " Supplier : " & ActiveCell.Offset(2, 3).Value & "    ( # " & ActiveCell.Offset(2, 2).Value & " )"
   ActiveCell.Offset(2, 0).Select
   K = ActiveCell.Row
   Do While ActiveCell.Offset(0, 2).Value = SupplierNo
     PayRefNo = ActiveCell.Value
     I = ActiveCell.Row
    Do While ActiveCell.Value = PayRefNo And ActiveCell.Offset(0, 2).Value = SupplierNo
      ActiveCell.Offset(1, 0).Select
    Loop
    J = ActiveCell.Row - 1
    If J > I Then Range(Cells(I + 1, 1), Cells(J, 10)).ClearContents
    ActiveCell.EntireRow.Insert
    ActiveCell.Offset(1, 0).Select
   Loop
    ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
   Worksheets("Report").Cells(J + 14, 2).HorizontalAlignment = xlRight
   Worksheets("Report").Cells(J + 14, 13).HorizontalAlignment = xlRight
   Cells(J + 2, 2).Value = "Total : "
   Cells(J + 2, 13).Value = "Total : "
   Cells(J + 2, 5).Value = Application.Sum(Range(Cells(K, 5), Cells(J, 5)))
   Cells(J + 2, 14).Value = Application.Sum(Range(Cells(K, 14), Cells(J, 14)))
   GrandTotalA = GrandTotalA + Cells(J + 2, 5).Value
   GrandTotalB = GrandTotalB + Cells(J + 2, 14).Value
   Worksheets("Report").Activate
    Range(Cells(J + 14, 1), Cells(J + 14, 10)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
    End With
   Worksheets("TempRP").Activate
   Cells(J + 4, 1).Select
  Loop
  If UserForm23.OptionButton1.Value <> True Then
   Worksheets("Report").Cells(J + 16, 2).HorizontalAlignment = xlRight
   Worksheets("Report").Cells(J + 16, 13).HorizontalAlignment = xlRight
   Cells(J + 4, 2).Value = "Grand Total : "
   Cells(J + 4, 13).Value = "Grand Total : "
   Cells(J + 4, 5).Value = GrandTotalA
   Cells(J + 4, 14).Value = GrandTotalB
  End If
  Columns("L").Delete
  Columns("H").Delete
  Columns("C:D").Delete
  ActiveSheet.UsedRange.Copy
  Worksheets("Report").Activate
  Range("A13").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  GoTo Finish
End If
FinishDate:
    ThisWorkbook.Worksheets("Report").Activate
    Range("C7:D7").Select
    Selection.EntireColumn.Insert
    Columns("C:C").Select
    With Selection
        .ColumnWidth = 13
        .HorizontalAlignment = xlCenter
        .NumberFormat = "@"
    End With
    Columns("D:D").Select
    With Selection
        .ColumnWidth = 28
        .HorizontalAlignment = xlLeft
        .NumberFormat = "@"
    End With
    Range("C10").Value = "Supplier #"
    Range("C11").Value = "----------------"
    Range("D10").Value = "Supplier name"
    Range("D11").Value = "---------------------------------"
 Worksheets("TempRP").Activate
 If Range("A1").Value = "" Then GoTo Finish
 ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("A1") _
        , Order2:=xlAscending, Key3:=Range("L1"), Order3:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 Range("A1").Select
   I = 1
  Do While ActiveCell.Value <> ""
   PayRefNo = ActiveCell.Value
   Do While ActiveCell.Value = PayRefNo
    ActiveCell.Offset(1, 0).Select
   Loop
   J = ActiveCell.Row - 1
   If J > I Then Range(Cells(I + 1, 1), Cells(J, 10)).ClearContents
   ActiveCell.EntireRow.Insert
   I = J + 2
   Cells(J + 2, 1).Select
  Loop
   Worksheets("Report").Cells(J + 14, 4).HorizontalAlignment = xlRight
   Worksheets("Report").Cells(J + 14, 13).HorizontalAlignment = xlRight
   Cells(J + 2, 4).Value = "Total : "
   Cells(J + 2, 13).Value = "Total : "
   Cells(J + 2, 5).Value = Application.Sum(Range(Cells(1, 5), Cells(J, 5)))
   Cells(J + 2, 14).Value = Application.Sum(Range(Cells(1, 14), Cells(J, 14)))
  Columns("L").Delete
  Columns("H").Delete
  ActiveSheet.UsedRange.Copy
  Worksheets("Report").Activate
  Range("A13").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
Finish:
 ThisWorkbook.Worksheets("Report").Activate
If UserForm23.OptionButton3.Value = True Or UserForm23.OptionButton1.Value = True Then
    Range("F1:F7").HorizontalAlignment = xlCenter
    Range("F1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("F2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("F3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("F4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("F6").Value = "Payment to Supplier Report"
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "    To : " & Format(EndDate, "yyyy/mm/dd")
  If UserForm23.OptionButton3.Value = True Then
    Range("F7").Value = " ( Sorted by Supplier Number ) "
  Else
    Range("F6").Value = " ( Payment Record for " & UserForm23.Label11.Caption & " ) "
  End If
     Range("A1:J22").Select
    ActiveWindow.Zoom = True
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
Else
    Range("F1:F7").HorizontalAlignment = xlCenter
    Range("F1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("F2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("F3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("F4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("F6").Value = "Payment to Supplier Report"
    Range("F7").Value = " ( Sorted by Payment Date )"
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "    To : " & Format(EndDate, "yyyy/mm/dd")
    Range("A1:L28").Select
    ActiveWindow.Zoom = True
    On Error GoTo NoPrinter1
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter1:
End If
 Unload UserForm23
 ThisWorkbook.Worksheets("Report").Activate
 SheetName = "Report"
 OldForm = "UserForm8"
 If Range("A13").Value = "" Then Range("D13").Value = " No Data for the selected period and Supplier. "
End Sub

Sub IOUpdate(QtyTotalO As Double, AmountO As Double, RefNoO As String, InvDateO As Date, ActionO As String, BeginStockO As Double)
Dim QtyAdj As Double, RecordNo As Long, LastRowNo As Long, I As Long, IODate As Date, StockRow As Long, FRow As Long, LRow As Long
Dim CheckRange As Range
Dim QtyTotal As Double, Amount As Double, RefNo As String, InvDateN As Date, Action As String, BeginStock As Double
If ThisWorkbook.Worksheets("NewCom").Range("A10").Value <> "IOAdd" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
QtyTotal = QtyTotalO
Amount = AmountO
RefNo = RefNoO
InvDateN = InvDateO
Action = ActionO
BeginStock = BeginStockO
  IODate = Date
    MyBook.Worksheets("IOData").Activate
  If Range("E2").Value = "" Or IsError(Application.Match(StockNo, MyBook.Worksheets("IOData").Columns("E"), 0)) Then
    If Range("E2").Value = "" Then
      Range("E2").Select
    Else
      Range("E1").End(xlDown).Select
      ActiveCell.Offset(1, 0).Select
    End If
    ActiveCell.Offset(0, -1).NumberFormat = "General"
    ActiveCell.Offset(0, -1).Value = 1
    QtyAdj = 0
    GoTo NewRowEntry
  End If
  ActiveSheet.UsedRange.Select
  Selection.Offset(1, 0).Resize(Selection.Rows.Count - 1).Select
  Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlDescending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("E")
   FRow = Application.Match(StockNo, CheckRange, 0) + 1
   LRow = Application.Match(StockNo, CheckRange, 1) + 1
   StockRow = FRow
   LastRowNo = Cells(FRow, 4).Value
   If Not (Cells(StockRow, 1).Value <= InvDateN Or StockRow = LRow) Then
    Do While Cells(StockRow + 1, 5) = StockNo
      StockRow = StockRow + 1
      If Cells(StockRow, 1).Value <= InvDateN Then
       If Cells(StockRow, 2).Value <= InvDateN Then StockRow = StockRow - 1
        GoTo AddEntry
      End If
    Loop
   End If
AddEntry:
 QtyAdj = 0
  If Cells(StockRow, 6) > 33 Then
    If Cells(StockRow, 245).Value > InvDateN Then
       Cells(StockRow, 238).Select
      Do While ActiveCell.Column > 7
       If ActiveCell.Value <= InvDateN Then Exit Do
       ActiveCell.Offset(0, -7).Select
      Loop
       I = ActiveCell.Offset(0, 1).Column
       Range(Cells(StockRow, I), Cells(StockRow, 245)).Copy
       Cells(StockRow, I + 7).Select
       ActiveSheet.Paste
       Application.CutCopyMode = False
       Range(Cells(StockRow, I), Cells(StockRow, I + 6)).ClearContents
       Cells(StockRow, I).Select
       ActiveCell.NumberFormat = "yyyy/mm/dd"
       ActiveCell.Value = IODate
       ActiveCell.Offset(0, 6).NumberFormat = "yyyy/mm/dd"
       ActiveCell.Offset(0, 6).Value = InvDateN
       ActiveCell.Offset(0, 5).NumberFormat = "@"
       ActiveCell.Offset(0, 5).Value = RefNo
      If Action = "A" Then
       If QtyTotal > 0 Then
        ActiveCell.Offset(0, 1).Value = "IN"
       Else
        ActiveCell.Offset(0, 1).Value = "OUT"
       End If
       ActiveCell.Offset(0, 2).Value = QtyTotal
       ActiveCell.Offset(0, 3).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
      ElseIf Action = "Adj" Then
       ActiveCell.Offset(0, 1).Value = "Qty Adjust"
       ActiveCell.Offset(0, 2).Value = QtyTotal
       ActiveCell.Offset(0, 3).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
      ElseIf Action = "Build" Then
       ActiveCell.Offset(0, 1).Value = "Build Product"
       ActiveCell.Offset(0, 2).Value = QtyTotal
       ActiveCell.Offset(0, 3).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
      Else
       If QtyTotal > 0 Then
        ActiveCell.Offset(0, 1).Value = "OUT"
       Else
        ActiveCell.Offset(0, 1).Value = "IN"
       End If
       ActiveCell.Offset(0, 2).Value = QtyTotal * (-1)
       ActiveCell.Offset(0, 3).Value = Amount * (-1)
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
      End If
       QtyAdj = ActiveCell.Offset(0, 2).Value - Cells(StockRow, 248).Value
      If Cells(StockRow, 1).Value > InvDateN Then Cells(StockRow, 1).Value = InvDateN
      Cells(StockRow, 2).Value = Cells(StockRow, 245).Value
      Cells(StockRow, 246).Select
      IODate = ActiveCell.Value
      If ActiveCell.Offset(0, 1).Value = "IN" Then
        Action = "A"
        QtyTotal = ActiveCell.Offset(0, 2).Value
        Amount = ActiveCell.Offset(0, 3).Value
      ElseIf ActiveCell.Offset(0, 1).Value = "Qty Adjust" Then
        Action = "Adj"
        QtyTotal = ActiveCell.Offset(0, 2).Value
        Amount = ActiveCell.Offset(0, 3).Value
      ElseIf ActiveCell.Offset(0, 1).Value = "Build Product" Then
        Action = "Build"
        QtyTotal = ActiveCell.Offset(0, 2).Value
        Amount = ActiveCell.Offset(0, 3).Value
      Else
        Action = "D"
        QtyTotal = ActiveCell.Offset(0, 2).Value * (-1)
        Amount = ActiveCell.Offset(0, 3).Value * (-1)
      End If
      RefNo = ActiveCell.Offset(0, 5).Value
      InvDateN = ActiveCell.Offset(0, 6).Value
      Range(Cells(StockRow, 246), Cells(StockRow, 252)).ClearContents
    End If
     If StockRow > FRow Then
       StockRow = StockRow - 1
       Cells(StockRow, 7).Value = Cells(StockRow, 7).Value + QtyAdj
       GoTo AddEntry
     Else
      Range("E1").End(xlDown).Select
      ActiveCell.Offset(1, 0).Select
      ActiveCell.Offset(0, -1).NumberFormat = "General"
      ActiveCell.Offset(0, -1).Value = LastRowNo + 1
      GoTo NewRowEntry
     End If
  Else
    RecordNo = Cells(StockRow, 6).Value
    If Cells(StockRow, ((RecordNo + 1) * 7)).Value <= InvDateN Then
      Cells(StockRow, (RecordNo * 7) + 8).Select
    Else
     Cells(StockRow, (RecordNo * 7)).Select
     Do While ActiveCell.Column > 7
       If ActiveCell.Value <= InvDateN Then Exit Do
       ActiveCell.Offset(0, -7).Select
     Loop
       I = ActiveCell.Offset(0, 1).Column
       Range(Cells(StockRow, I), Cells(StockRow, (RecordNo + 1) * 7)).Copy
       Cells(StockRow, I + 7).Select
       ActiveSheet.Paste
       Application.CutCopyMode = False
       Range(Cells(StockRow, I), Cells(StockRow, I + 6)).ClearContents
       Cells(StockRow, I).Select
    End If
       ActiveCell.NumberFormat = "yyyy/mm/dd"
       ActiveCell.Value = IODate
       ActiveCell.Offset(0, 6).NumberFormat = "yyyy/mm/dd"
       ActiveCell.Offset(0, 6).Value = InvDateN
     ActiveCell.Offset(0, 5).NumberFormat = "@"
     ActiveCell.Offset(0, 5).Value = RefNo
     If Action = "A" Then
      If QtyTotal > 0 Then
       ActiveCell.Offset(0, 1).Value = "IN"
      Else
       ActiveCell.Offset(0, 1).Value = "OUT"
      End If
       ActiveCell.Offset(0, 2).Value = QtyTotal
       ActiveCell.Offset(0, 3).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
     ElseIf Action = "Adj" Then
       ActiveCell.Offset(0, 1).Value = "Qty Adjust"
       ActiveCell.Offset(0, 2).Value = QtyTotal
       ActiveCell.Offset(0, 3).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
     ElseIf Action = "Build" Then
       ActiveCell.Offset(0, 1).Value = "Build Product"
       ActiveCell.Offset(0, 2).Value = QtyTotal
       ActiveCell.Offset(0, 3).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
     Else
      If QtyTotal > 0 Then
       ActiveCell.Offset(0, 1).Value = "OUT"
      Else
       ActiveCell.Offset(0, 1).Value = "IN"
      End If
       ActiveCell.Offset(0, 2).Value = QtyTotal * (-1)
       ActiveCell.Offset(0, 3).Value = Amount * (-1)
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 4).Value = Amount / QtyTotal
     End If
     Cells(StockRow, 6).Value = RecordNo + 1
     If RecordNo = 33 Then Cells(StockRow, 3).Value = "R"
     If Cells(StockRow, 1).Value > InvDateN Then Cells(StockRow, 1).Value = InvDateN
     If Cells(StockRow, 2).Value < InvDateN Then Cells(StockRow, 2).Value = InvDateN
  End If
Exit Sub
NewRowEntry:
    ActiveCell.NumberFormat = "@"
    ActiveCell.Value = StockNo
    ActiveCell.Offset(0, -2).NumberFormat = "@"
    ActiveCell.Offset(0, -2).Value = "*"
    ActiveCell.Offset(0, 1).NumberFormat = "General"
    ActiveCell.Offset(0, 1).Value = 1
    ActiveCell.Offset(0, -3).NumberFormat = "yyyy/mm/dd"
    ActiveCell.Offset(0, -4).NumberFormat = "yyyy/mm/dd"
    ActiveCell.Offset(0, -3).Value = InvDateN
    ActiveCell.Offset(0, -4).Value = InvDateN
    ActiveCell.Offset(0, 2).NumberFormat = "General"
    ActiveCell.Offset(0, 2).Value = Format(BeginStock + QtyAdj, "0.0000")
    ActiveCell.Offset(0, 3).NumberFormat = "yyyy/mm/dd"
    ActiveCell.Offset(0, 3).Value = IODate
    ActiveCell.Offset(0, 9).NumberFormat = "yyyy/mm/dd"
    ActiveCell.Offset(0, 9).Value = InvDateN
    ActiveCell.Offset(0, 8).NumberFormat = "@"
    ActiveCell.Offset(0, 8).Value = RefNo
   If Action = "A" Then
    If QtyTotal > 0 Then
     ActiveCell.Offset(0, 4).Value = "IN"
    Else
     ActiveCell.Offset(0, 4).Value = "OUT"
    End If
    ActiveCell.Offset(0, 5).Value = QtyTotal
    ActiveCell.Offset(0, 6).Value = Amount
    If QtyTotal <> 0 Then ActiveCell.Offset(0, 7).Value = Amount / QtyTotal
   ElseIf Action = "Adj" Then
       ActiveCell.Offset(0, 4).Value = "Qty Adjust"
       ActiveCell.Offset(0, 5).Value = QtyTotal
       ActiveCell.Offset(0, 6).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 7).Value = Amount / QtyTotal
   ElseIf Action = "Build" Then
       ActiveCell.Offset(0, 4).Value = "Build Product"
       ActiveCell.Offset(0, 5).Value = QtyTotal
       ActiveCell.Offset(0, 6).Value = Amount
       If QtyTotal <> 0 Then ActiveCell.Offset(0, 7).Value = Amount / QtyTotal
   Else
    If QtyTotal > 0 Then
     ActiveCell.Offset(0, 4).Value = "OUT"
    Else
     ActiveCell.Offset(0, 4).Value = "IN"
    End If
    ActiveCell.Offset(0, 5).Value = QtyTotal * (-1)
    ActiveCell.Offset(0, 6).Value = Amount * (-1)
    If QtyTotal <> 0 Then ActiveCell.Offset(0, 7).Value = Amount / QtyTotal
   End If
End Sub

Sub Form25Text1Exit(RunCode As String)
Dim StockQty As Double, StockAmt As Double, I As Long, J As Long, ShName As String, AssetAcctCK As Variant, OldStock As Boolean
Dim FRow As Long, LRow As Long, K As Long, L As Long, CheckRange As Range, Tbl As Range
If RunCode <> "StockUpdate" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 OldStock = False
If IsError(Application.Match(StockNo, MyBook.Worksheets("InvDetail1").Range("A:A"), 0)) = False Then OldStock = True
If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = True Then GoTo NonStock
  StockNoExist = "Yes"
  MyBook.Worksheets("StockRec").Activate
  RowNo = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
  Cells(RowNo, 2).Select
   UserForm25.Label5.Height = 16
   UserForm25.Label5.Caption = "Existing Stock Qty : "
   UserForm25.Label9.Visible = True
   UserForm25.Label14.Visible = True
   UserForm25.TextBox5.Text = ""
   UserForm25.TextBox6.Text = ""
   UserForm25.TextBox5.Visible = False
   UserForm25.TextBox6.Visible = False
  UserForm25.TextBox2.Text = ActiveCell.Offset(0, 1).Value
  UserForm25.TextBox3.Text = ActiveCell.Offset(0, 10).Value
  UserForm25.TextBox4.Text = ActiveCell.Offset(0, 9).Value
  AssetAcctCK = ActiveCell.Offset(0, 3).Value
  UserForm25.ComboBox1.Value = ActiveCell.Offset(0, 3).Value
  UserForm25.Label11.Caption = " Last Update : " & Format(ActiveCell.Offset(0, -1).Value, "yyyy/mm/dd")
  UserForm25.Label11.Visible = True
  StockQty = ActiveCell.Offset(0, 6).Value
  UserForm25.Label9.Caption = StockQty
  StockAmt = ActiveCell.Offset(0, 7).Value
  UserForm25.Label14.Caption = Format(StockAmt, "#,##0.00")
  If StockQty <> 0 Then
   UserForm25.Label16.Caption = Format(StockAmt / StockQty, "#,##0.0000")
  Else
   UserForm25.Label16.Caption = Format(ActiveCell.Offset(0, 8).Value, "#,##0.0000")
  End If
 If ActiveCell.Offset(0, 5).Value = "Yes" Then
  J = MyBook.Worksheets("BOM1").Range("A9").Value
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("B10").Value <> "" Then
    If IsError(Application.Match(StockNo, MyBook.Worksheets(ShName).Range("B10:IV10"), 0)) = False Then
     UserForm25.Label12.Caption = "This is a Self-Manufactured item"
     UserForm25.Label12.Visible = True
     Exit For
    End If
   End If
  Next I
 Else
  UserForm25.Label12.Visible = False
 End If
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
    I = Application.Match(AssetAcctCK, COARange, 0) + 9
    UserForm25.Label8.Caption = Worksheets("Chart of Account").Cells(I, 2)
  Else
    UserForm25.Label8.Caption = ""
  End If
 Else
   UserForm25.Label8.Caption = ""
 End If
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.UsedRange.Delete
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
    If IsError(Application.Match(StockNo, MyBook.Worksheets("Product Data").Columns("I"), 0)) = False Then
      Set Tbl = ActiveSheet.UsedRange
      Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
      Selection.Sort Key1:=Range("I1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Set CheckRange = Selection.Columns("I")
       FRow = Application.Match(StockNo, CheckRange, 0) + 2
       LRow = Application.Match(StockNo, CheckRange, 1) + 2
       L = 100
       For I = FRow To LRow
        ThisWorkbook.Worksheets("TempRP").Cells(L, 2).NumberFormat = "@"
        ThisWorkbook.Worksheets("TempRP").Cells(L, 2).Value = Cells(I, 2).Value
        L = L + 1
       Next I
       If LRow - FRow > 2 Then
        UserForm25.ScrollBar1.Max = LRow - FRow - 1
        UserForm25.ScrollBar1.Visible = True
       Else
        UserForm25.ScrollBar1.Visible = False
       End If
     End If
  End If
  MyBook.Worksheets("Supply Data").Activate
  If Range("B3") <> "" Then
    If IsError(Application.Match(StockNo, MyBook.Worksheets("Supply Data").Columns("K"), 0)) = False Then
     Set Tbl = ActiveSheet.UsedRange
     Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
      Selection.Sort Key1:=Range("K1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
       Set CheckRange = Selection.Columns("K")
       FRow = Application.Match(StockNo, CheckRange, 0) + 2
       LRow = Application.Match(StockNo, CheckRange, 1) + 2
       L = 100
       For I = FRow To LRow
        ThisWorkbook.Worksheets("TempRP").Cells(L, 4).NumberFormat = "@"
        ThisWorkbook.Worksheets("TempRP").Cells(L, 4).Value = Cells(I, 4).Value & " --- " & Cells(I, 2).Value
        L = L + 1
       Next I
       If LRow - FRow > 2 Then
        UserForm25.ScrollBar2.Max = LRow - FRow - 1
        UserForm25.ScrollBar2.Visible = True
       Else
        UserForm25.ScrollBar2.Visible = False
       End If
     End If
  End If
  J = MyBook.Worksheets("BOM1").Range("A9").Value
  L = 100
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("A11").Value <> "" Then
    Columns("A").Select
    Set CheckRange = Selection.Resize(Selection.Rows.Count - 10, 1).Offset(10, 0)
    If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
     FRow = Application.Match(StockNo, CheckRange, 0) + 10
     Cells(FRow, 1).Select
     Do While ActiveCell.Column < 256
      If ActiveCell.Offset(0, 1).Value = "" Then
       ActiveCell.End(xlToRight).Select
      Else
       ActiveCell.Offset(0, 1).Select
      End If
      K = ActiveCell.Column
      If Cells(10, K).Value <> "" Then
       ThisWorkbook.Worksheets("TempRP").Cells(L, 6).NumberFormat = "@"
       ThisWorkbook.Worksheets("TempRP").Cells(L, 6).Value = Cells(10, K).Value
       L = L + 1
      End If
     Loop
    End If
   End If
  Next I
  If L > 104 Then
   UserForm25.ScrollBar3.Max = L - 102
   UserForm25.ScrollBar3.Visible = True
  Else
   UserForm25.ScrollBar3.Visible = False
  End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("B100").Select
 For I = 1 To 4
  UserForm25.Controls("Label" & 17 + I).Caption = ActiveCell.Value
  UserForm25.Controls("Label" & 23 + I).Caption = ActiveCell.Offset(0, 2).Value
  UserForm25.Controls("Label" & 28 + I).Caption = ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
 Next I
If UserForm25.Label12.Visible = True Or Val(UserForm25.Label9.Caption) <> 0 Or Val(UserForm25.Label14.Caption) <> 0 Or Range("B100").Value <> "" Or Range("D100").Value <> "" Or Range("F100").Value <> "" Then
 UserForm25.CommandButton4.Visible = False
Else
 UserForm25.CommandButton4.Visible = True
End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 UserForm25.CommandButton2.Visible = False
 UserForm25.CommandButton3.Visible = False
 UserForm25.CommandButton4.Visible = False
End If
Exit Sub
NonStock:
 StockNo = ""
 StockNoExist = ""
 UserForm25.Label9.Caption = ""
 UserForm25.Label14.Caption = ""
 UserForm25.Label11.Visible = False
 UserForm25.Label12.Visible = False
 For I = 18 To 21
  UserForm25.Controls("Label" & I).Caption = ""
 Next I
 For I = 24 To 27
  UserForm25.Controls("Label" & I).Caption = ""
 Next I
 For I = 29 To 32
  UserForm25.Controls("Label" & I).Caption = ""
 Next I
UserForm25.CommandButton4.Visible = False
UserForm25.ScrollBar1.Visible = False
UserForm25.ScrollBar2.Visible = False
UserForm25.ScrollBar3.Visible = False
If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 And OldStock = False Then
  MyBook.Worksheets("InvDetail1").Activate
   UserForm25.Label5.Height = 30
   UserForm25.Label5.Caption = " Opening Qty : " & Chr(13) & "(carried from last year)"
   UserForm25.Label9.Visible = False
   UserForm25.Label14.Visible = False
   UserForm25.TextBox5.Text = 0
   UserForm25.TextBox6.Text = 0
   UserForm25.TextBox5.Visible = True
   UserForm25.TextBox6.Visible = True
   UserForm25.Label16.Caption = ""
End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 UserForm25.CommandButton2.Visible = False
 UserForm25.CommandButton3.Visible = False
 UserForm25.CommandButton4.Visible = False
End If
End Sub

Sub Form26Text1Exit(BOMRow As Long)
Dim I As Long, J As Long, LineNo As Long, ShName As String, BOMCol As Long, LastBOMRow As Long, CompNo As String
Dim CheckRange As Range, EntryNo As Long, TotalComp As Long, HasBOM As String, JumpStatus As Boolean
 If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "BOM" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm26.ListBox1.Visible = True Then
  JumpStatus = False
 Else
  JumpStatus = True
 End If
 UserForm26.Label10.Visible = False
 UserForm26.ListBox1.Visible = False
 UserForm26.ListBox2.Visible = False
 UserForm26.Label42.Visible = False
 UserForm26.TextBox29.Visible = False
 UserForm26.CommandButton20.Visible = False
 UserForm26.CommandButton19.Visible = False
If Left(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = 1
 Do While J <= I And Mid(StockNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then GoTo NoInput
  StockNo = Right(StockNo, I - J + 1)
End If
If Right(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = I
 Do While J > 0 And Mid(StockNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then GoTo NoInput
  StockNo = Left(StockNo, J)
End If
StockNo = UCase(StockNo)
If StockNo = "" Then GoTo NoInput
If BOMRow > 4 Then
  EntryNo = Val(UserForm26.Controls("Label" & BOMRow + 10).Caption)
  If StockNo = ThisWorkbook.Worksheets("RunningDat").Cells(EntryNo + 10, 1).Value Then Exit Sub
End If
 MyBook.Worksheets("StockRec").Activate
If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = True Then GoTo NonStock
  If BOMRow = 1 Then
   ShName = ""
   BOMCol = 0
   LastBOMRow = 10
    GoTo BOMProduct
  Else
   If UserForm26.TextBox1.Text = "" Then
     UserForm26.Label10.Caption = Chr(13) & "    Please enter the stock number of the Product first before enter the components."
     UserForm26.Label10.Visible = True
     UserForm26.Controls("TextBox" & BOMRow).Text = ""
     UserForm26.TextBox1.SetFocus
     Exit Sub
   End If
   If StockNo = UserForm26.TextBox1.Text Then
     UserForm26.Label10.Caption = Chr(13) & "    Error!!  A product cannot be a component of itself."
     UserForm26.Label10.Visible = True
     UserForm26.Controls("Textbox" & BOMRow).Text = ""
     GoTo EmptyRow
   End If
    ThisWorkbook.Worksheets("RunningDat").Activate
    Range("G1").Select
    Do While ActiveCell.Value <> ""
      If ActiveCell.Value = StockNo Then
        UserForm26.Label10.Caption = Chr(13) & "    Error!!  The selected part cannot be a component for " & UserForm26.TextBox1.Text & Chr(13) & _
                                     "                  because it is a manufactured product made of " & UserForm26.TextBox1.Text
        UserForm26.Label10.Visible = True
        UserForm26.Controls("Textbox" & BOMRow).Text = ""
        GoTo EmptyRow
      End If
     ActiveCell.Offset(1, 0).Select
    Loop
    GoTo BOMComponent
  End If
Exit Sub
BOMProduct:
   If BOMRow = 1 Then
     UserForm26.TextBox1.Text = StockNo
     UserForm26.TextBox4.Text = ""
     UserForm26.Label4.Visible = False
     ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
     I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
     UserForm26.Label6.Caption = MyBook.Worksheets("StockRec").Cells(I, 3).Value
   End If
   J = MyBook.Worksheets("BOM1").Range("A9").Value
   HasBOM = ""
   For I = 1 To J
    ShName = "BOM" & I
    MyBook.Worksheets(ShName).Activate
    If Range("B10").Value <> "" Then
     HasBOM = "Yes"
     Set CheckRange = Rows("10")
     If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
      BOMCol = Application.Match(StockNo, CheckRange, 0)
      If BOMCol > 1 Then
       If Range("A11") <> "" Then
         Range("A10").End(xlDown).Select
         LastBOMRow = ActiveCell.Row
       Else
         LastBOMRow = 10
       End If
       Exit For
      Else
       ShName = ""
      End If
     Else
      ShName = ""
     End If
    Else
     ShName = ""
    End If
   Next I
   ThisWorkbook.Worksheets("RunningDat").Activate
  If ShName = "" Then
     If HasBOM = "Yes" Then UserForm26.CommandButton19.Visible = True
     Range("A1").Value = ""
     Range("A2").Value = 0
     Range("A3").Value = 10
     Range("A4").NumberFormat = "@"
     Range("A4").Value = StockNo
     I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
     UserForm26.Label6.Caption = MyBook.Worksheets("StockRec").Cells(I, 3).Value
     UserForm26.CommandButton17.Visible = False
     For I = 1 To 12
      UserForm26.Controls("Label" & I + 14).Caption = I
      UserForm26.Controls("TextBox" & I + 4).Text = ""
      UserForm26.Controls("Label" & I + 29).Caption = ""
      UserForm26.Controls("TextBox" & I + 16).Text = ""
     Next I
     UserForm26.ScrollBar1.Value = 1
     GoTo FindHigherLevelProduct
   End If
   If BOMRow = 1 Then
     UserForm26.TextBox4.Text = MyBook.Worksheets(ShName).Cells(4, BOMCol).Value
     Range("A1").Value = ShName
     Range("A2").Value = BOMCol
     Range("A3").Value = LastBOMRow
     Range("A4").NumberFormat = "@"
     Range("A4").Value = StockNo
     Range("A5").NumberFormat = "@"
     Range("A5").Value = MyBook.Worksheets(ShName).Cells(4, BOMCol).Value
     Range("A6").Value = MyBook.Worksheets(ShName).Cells(2, BOMCol).Value
     Range("A7").Value = MyBook.Worksheets(ShName).Cells(3, BOMCol).Value
     UserForm26.Label4 = "Date of Last Update : " & Format(MyBook.Worksheets(ShName).Cells(3, BOMCol).Value, "yyyy/mm/dd")
     UserForm26.Label4.Visible = True
    If Not (MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly") Then
       UserForm26.CommandButton17.Visible = True
    Else
      UserForm26.CommandButton17.Visible = False
    End If
   End If
   If Not (BOMCol > 1 And LastBOMRow > 10) Then GoTo FindHigherLevelProduct
   Range("C11").Select
   MyBook.Worksheets(ShName).Activate
   Range(Cells(11, BOMCol), Cells(LastBOMRow, BOMCol)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(11, 1), Cells(LastBOMRow, 2)).NumberFormat = "@"
   Range("A11").Select
   MyBook.Worksheets(ShName).Activate
   Range(Cells(11, 1), Cells(LastBOMRow, 1)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
   Application.CutCopyMode = False
   Range(Cells(11, 1), Cells(LastBOMRow, 3)).Select
   Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   If Range("C11").Value <> "" Then
    If Range("C12").Value <> "" Then
     Range("C11").End(xlDown).Select
     I = ActiveCell.Row
     Cells(I + 1, 1).EntireRow.Insert
     Cells(I + 2, 1).Select
     ActiveCell.CurrentRegion.Select
     Selection.EntireRow.Delete
    Else
     I = 11
     If LastBOMRow > 11 Then Range(Cells(12, 1), Cells(LastBOMRow, 1)).EntireRow.Delete
    End If
   Else
    I = 11
    Range(Cells(11, 1), Cells(LastBOMRow, 1)).EntireRow.Delete
   End If
   If Range("A11") <> "" Then
     Range(Cells(11, 1), Cells(I, 3)).Select
     Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Range("A11").Select
    Do While ActiveCell.Value <> ""
     CompNo = ActiveCell.Value
     If IsError(Application.Match(CompNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
       J = Application.Match(CompNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("StockRec").Cells(J, 3).Value
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
     If I > 19 Then
      UserForm26.ScrollBar1.Max = ActiveCell.Row - 13
     End If
    Range("A11").Select
    For I = 5 To 16
     UserForm26.Controls("Textbox" & I).Text = ActiveCell.Value
     UserForm26.Controls("label" & I + 25).Caption = ActiveCell.Offset(0, 1).Value
     UserForm26.Controls("Textbox" & I + 12).Text = ActiveCell.Offset(0, 2).Value
     ActiveCell.Offset(1, 0).Select
    Next I
FindHigherLevelProduct:
If BOMRow = 1 Then
  J = MyBook.Worksheets("BOM1").Range("A9").Value
  L = 1
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("A11").Value <> "" Then
    Columns("A").Select
    Set CheckRange = Selection.Resize(Selection.Rows.Count - 10, 1).Offset(10, 0)
    Range("A1").Select
    If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
     FRow = Application.Match(StockNo, CheckRange, 0) + 10
     Cells(FRow, 1).Select
     Do While ActiveCell.Column < 256
      ActiveCell.End(xlToRight).Select
      K = ActiveCell.Column
      If Cells(10, K).Value <> "" Then
       ThisWorkbook.Worksheets("RunningDat").Cells(L, 7).NumberFormat = "@"
       ThisWorkbook.Worksheets("RunningDat").Cells(L, 7).Value = Cells(10, K).Value
       L = L + 1
      End If
     Loop
    End If
   End If
  Next I
 End If
CheckViewOnly:
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
    UserForm26.CommandButton17.Visible = False
    UserForm26.CommandButton19.Visible = False
  End If
 Exit Sub
BOMComponent:
 EntryNo = Val(UserForm26.Controls("Label" & BOMRow + 10).Caption)
 ThisWorkbook.Worksheets("RunningDat").Activate
    Range("A11").Select
    Do While ActiveCell.Value <> ""
      If ActiveCell.Value = StockNo Then
         If ActiveCell.Row <> EntryNo + 10 Then
         UserForm26.Label10.Caption = Chr(13) & "    Error!!  Duplicate Component "
         UserForm26.Label10.Visible = True
         UserForm26.Controls("Textbox" & BOMRow).Text = ""
         GoTo EmptyRow
        End If
      End If
     ActiveCell.Offset(1, 0).Select
    Loop
 Cells(EntryNo + 10, 1).NumberFormat = "@"
 Cells(EntryNo + 10, 1).Value = StockNo
 I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
 Cells(EntryNo + 10, 2).NumberFormat = "@"
 Cells(EntryNo + 10, 2).Value = MyBook.Worksheets("StockRec").Cells(I, 3).Value
Range("A11").Select
For I = 1 To EntryNo
 If ActiveCell.Value = "" Then
  ActiveCell.EntireRow.Delete
 Else
  ActiveCell.Offset(1, 0).Select
 End If
Next I
  J = ActiveCell.Row - 11
  If Range("A11").Value = "" Then
    TotalComp = 0
  ElseIf Range("A12").Value = "" Then
    TotalComp = 1
  Else
    Range("A11").End(xlDown).Select
    TotalComp = ActiveCell.Row - 10
  End If
If TotalComp > 10 Then
  UserForm26.ScrollBar1.Max = TotalComp - 4
End If
If J <> TotalComp Then
 If J > BOMRow - 4 Then
   If J + 5 - BOMRow <= UserForm26.ScrollBar1.Max Then UserForm26.ScrollBar1.Value = J + 5 - BOMRow
   LineNo = UserForm26.ScrollBar1.Value
   ThisWorkbook.Worksheets("RunningDat").Activate
   Cells(10 + LineNo, 1).Select
  For I = 1 To 12
   UserForm26.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm26.Controls("TextBox" & I + 4).Text = Cells(9 + LineNo + I, 1).Value
   UserForm26.Controls("Label" & I + 29).Caption = Cells(9 + LineNo + I, 2).Value
   UserForm26.Controls("TextBox" & I + 16).Text = Cells(9 + LineNo + I, 3).Value
  Next I
 Else
  ThisWorkbook.Worksheets("RunningDat").Activate
  UserForm26.ScrollBar1.Value = 1
  Range("A11").Select
  For I = 1 To 12
   UserForm26.Controls("Label" & I + 14).Caption = I
   UserForm26.Controls("TextBox" & I + 4).Text = Cells(10 + I, 1).Value
   UserForm26.Controls("Label" & I + 29).Caption = Cells(10 + I, 2).Value
   UserForm26.Controls("TextBox" & I + 16).Text = Cells(10 + I, 3).Value
  Next I
 End If
Else
 If J > 10 And BOMRow > 14 Then
  If UserForm26.ScrollBar1.Value < UserForm26.ScrollBar1.Max Then
     UserForm26.ScrollBar1.Value = UserForm26.ScrollBar1.Value + 1
     If JumpStatus = True Then SendKeys "{Up}", False
  End If
 ElseIf J > 10 And BOMRow <= 14 Then
   If J + 5 - BOMRow <= UserForm26.ScrollBar1.Max Then UserForm26.ScrollBar1.Value = J + 5 - BOMRow
   LineNo = UserForm26.ScrollBar1.Value
   ThisWorkbook.Worksheets("RunningDat").Activate
   Cells(10 + LineNo, 1).Select
  For I = 1 To 12
   UserForm26.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm26.Controls("TextBox" & I + 4).Text = Cells(9 + LineNo + I, 1).Value
   UserForm26.Controls("Label" & I + 29).Caption = Cells(9 + LineNo + I, 2).Value
   UserForm26.Controls("TextBox" & I + 16).Text = Cells(9 + LineNo + I, 3).Value
  Next I
 Else
  UserForm26.ScrollBar1.Value = 1
  ThisWorkbook.Worksheets("RunningDat").Activate
  Cells(11, 1).Select
  For I = 1 To 12
   UserForm26.Controls("Label" & I + 14).Caption = I
   UserForm26.Controls("TextBox" & I + 4).Text = Cells(10 + I, 1).Value
   UserForm26.Controls("Label" & I + 29).Caption = Cells(10 + I, 2).Value
   UserForm26.Controls("TextBox" & I + 16).Text = Cells(10 + I, 3).Value
  Next I
 End If
End If
Exit Sub
NonStock:
  If BOMRow = 1 Then
    UserForm26.CommandButton17.Visible = False
    UserForm26.Label4.Visible = False
    ShName = ""
    BOMCol = 0
    LastBOMRow = 11
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveSheet.UsedRange.Delete
    Range("A1").Value = ""
    Range("A2").Value = BOMCol
    Range("A3").Value = LastBOMRow
    Range("A4").Value = StockNo
     For I = 1 To 12
      UserForm26.Controls("Label" & I + 14).Caption = I
      UserForm26.Controls("TextBox" & I + 4).Text = ""
      UserForm26.Controls("Label" & I + 29).Caption = ""
      UserForm26.Controls("TextBox" & I + 16).Text = ""
     Next I
     UserForm26.ScrollBar1.Value = 1
     UserForm26.Label6.Caption = ""
  Else
     UserForm26.Controls("Label" & BOMRow + 25).Caption = ""
  End If
   UserForm26.Label10.Caption = "    The stock number entered is not in the record." & Chr(13) & _
                 "    Please click the 'Stock Item Setup' button to add the stock number before " & Chr(13) & _
                 "    using it in creating the BOM"
   UserForm26.Label10.Visible = True
   UserForm26.Controls("Textbox" & BOMRow).Text = ""
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
    UserForm26.CommandButton19.Visible = False
  Else
   UserForm26.CommandButton18.Visible = True
  End If
 Exit Sub
NoInput:
 UserForm26.Controls("Textbox" & BOMRow).Text = ""
If BOMRow = 1 Then
 UserForm26.CommandButton17.Visible = False
 UserForm26.Label4.Visible = False
 ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
 For I = 1 To 12
   UserForm26.Controls("Label" & I + 14).Caption = I
   UserForm26.Controls("TextBox" & I + 4).Text = ""
   UserForm26.Controls("Label" & I + 29).Caption = ""
   UserForm26.Controls("TextBox" & I + 16).Text = ""
 Next I
  UserForm26.ScrollBar1.Value = 1
   UserForm26.Label6.Caption = ""
  Exit Sub
Else
   UserForm26.Controls("Label" & BOMRow + 25).Caption = ""
End If
EmptyRow:
  ThisWorkbook.Worksheets("RunningDat").Activate
  EntryNo = Val(UserForm26.Controls("Label" & BOMRow + 10).Caption)
  Cells(EntryNo + 10, 1).EntireRow.Delete
   LineNo = UserForm26.ScrollBar1.Value
   Cells(10 + LineNo, 1).Select
  For I = 1 To 12
   UserForm26.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm26.Controls("TextBox" & I + 4).Text = Cells(9 + LineNo + I, 1).Value
   UserForm26.Controls("Label" & I + 29).Caption = Cells(9 + LineNo + I, 2).Value
   UserForm26.Controls("TextBox" & I + 16).Text = Cells(9 + LineNo + I, 3).Value
  Next I
End Sub

Sub Form26Col3Exit(BOMRow As Long)
Dim EntryNo As Long, CheckNum As Double
 If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "BOM" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 UserForm26.Label10.Visible = False
 UserForm26.ListBox1.Visible = False
 UserForm26.ListBox2.Visible = False
 UserForm26.Label42.Visible = False
 UserForm26.TextBox29.Visible = False
 UserForm26.CommandButton20.Visible = False
 UserForm26.CommandButton19.Visible = False
 If UserForm26.Controls("TextBox" & BOMRow).Text <> "" Then
  If IsNumeric(UserForm26.Controls("TextBox" & BOMRow).Text) = False Then
    UserForm26.Label10.Caption = Chr(13) & "     Incorrect Quantity. Please correct"
    UserForm26.Label10.Visible = True
    Exit Sub
  End If
  CheckNum = UserForm26.Controls("TextBox" & BOMRow).Text
  UserForm26.Controls("TextBox" & BOMRow).Text = CheckNum
 End If
 EntryNo = Val(UserForm26.Controls("Label" & BOMRow - 2).Caption)
 ThisWorkbook.Worksheets("RunningDat").Activate
 Cells(EntryNo + 10, 3).NumberFormat = "General"
 Cells(EntryNo + 10, 3).Value = UserForm26.Controls("TextBox" & BOMRow).Text
End Sub

Sub Form26Text29Exit(BOMRow As Long)
Dim I As Long, J As Long, ShName As String, BOMCol As Long, LastBOMRow As Long, CompNo As String, CheckRange As Range
Dim RemoveRow As Boolean
 If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "BOM" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
If Left(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = 1
 Do While J <= I And Mid(StockNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then GoTo NonBOM
  StockNo = Right(StockNo, I - J + 1)
End If
If Right(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = I
 Do While J > 0 And Mid(StockNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then GoTo NonBOM
  StockNo = Left(StockNo, J)
End If
StockNo = UCase(StockNo)
If StockNo = "" Then GoTo NonBOM
  If StockNo = ThisWorkbook.Worksheets("RunningDat").Range("A4").Value Then GoTo NonBOM
 ThisWorkbook.Worksheets("RunningDat").Activate
If IsError(Application.Match(StockNo, ThisWorkbook.Worksheets("RunningDat").Columns("I"), 0)) = True Then GoTo NonBOM
   J = MyBook.Worksheets("BOM1").Range("A9").Value
   For I = 1 To J
    ShName = "BOM" & I
    MyBook.Worksheets(ShName).Activate
    If Range("B10").Value <> "" Then
     Set CheckRange = Rows("10")
     If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
      BOMCol = Application.Match(StockNo, CheckRange, 0)
      If BOMCol > 1 Then
       If Range("A11") <> "" Then
         Range("A10").End(xlDown).Select
         LastBOMRow = ActiveCell.Row
       Else
         LastBOMRow = 10
       End If
       Exit For
      Else
       ShName = ""
      End If
     Else
      ShName = ""
     End If
    Else
     ShName = ""
    End If
   Next I
  If ShName = "" Then GoTo NonBOM
   Range("C11").Select
   MyBook.Worksheets(ShName).Activate
   Range(Cells(11, BOMCol), Cells(LastBOMRow, BOMCol)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("C11").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(11, 1), Cells(LastBOMRow, 2)).NumberFormat = "@"
   Range("A11").Select
   MyBook.Worksheets(ShName).Activate
   Range(Cells(11, 1), Cells(LastBOMRow, 1)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(11, 1), Cells(LastBOMRow, 3)).Select
   Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    RemoveRow = False
   If Range("C11").Value <> "" Then
    If Range("C12").Value <> "" Then
     Range("C11").End(xlDown).Select
     I = ActiveCell.Row
     Cells(I + 1, 1).EntireRow.Insert
     Cells(I + 2, 1).Select
     ActiveCell.CurrentRegion.Select
     Selection.EntireRow.Delete
     Cells(I + 1, 1).NumberFormat = "@"
     Cells(I + 1, 1).Value = Range("A4").Value
     Cells(I + 1, 3).Value = "*"
     If Range("G1").Value <> "" Then
      If Range("G2").Value <> "" Then
       Range("G1").End(xlDown).Select
       J = ActiveCell.Row
      Else
       J = 1
      End If
      Range(Cells(1, 7), Cells(J, 7)).Copy
      Cells(I + 2, 1).Select
      ActiveSheet.Paste
      Application.CutCopyMode = False
      Selection.Columns("C").Value = "*"
     End If
     Range("C11").End(xlDown).Select
     I = ActiveCell.Row
     Range(Cells(11, 1), Cells(I, 3)).Select
     Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlDescending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Range("A11").Select
      Do While ActiveCell.Value <> ""
       If ActiveCell.Offset(0, 2).Value = "*" Then
         CompNo = ActiveCell.Value
         Do While ActiveCell.Offset(1, 0).Value = CompNo
          RemoveRow = True
          ActiveCell.EntireRow.Delete
         Loop
         ActiveCell.EntireRow.Delete
       Else
        ActiveCell.Offset(1, 0).Select
       End If
      Loop
    Else
     I = 11
     If LastBOMRow > 11 Then Range(Cells(12, 1), Cells(LastBOMRow, 1)).EntireRow.Delete
      CompNo = Range("A11").Value
      If CompNo = Range("A4").Value Then
        RemoveRow = True
        Range("A11").EntireRow.Delete
      Else
       Range("G1").Select
       Do While ActiveCell.Value <> ""
         If ActiveCell.Value = CompNo Then
          RemoveRow = True
          Range("A11").EntireRow.Delete
          Exit Do
         End If
         ActiveCell.Offset(1, 0).Select
       Loop
      End If
    End If
   Else
    I = 11
    Range(Cells(11, 1), Cells(LastBOMRow, 1)).EntireRow.Delete
   End If
   If Range("A11") <> "" Then
     Range(Cells(11, 1), Cells(I, 3)).Select
     Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Range("A11").Select
    Do While ActiveCell.Value <> ""
     CompNo = ActiveCell.Value
     If IsError(Application.Match(CompNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
       J = Application.Match(CompNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("StockRec").Cells(J, 3).Value
       ActiveCell.Offset(1, 0).Select
     Else
      RemoveRow = True
      ActiveCell.EntireRow.Delete
     End If
    Loop
   End If
     If I > 19 Then
      UserForm26.ScrollBar1.Max = ActiveCell.Row - 13
     End If
    UserForm26.ScrollBar1.Value = 1
    Range("A11").Select
    For I = 5 To 16
     UserForm26.Controls("Textbox" & I).Text = ActiveCell.Value
     UserForm26.Controls("label" & I + 25).Caption = ActiveCell.Offset(0, 1).Value
     UserForm26.Controls("Textbox" & I + 12).Text = ActiveCell.Offset(0, 2).Value
     ActiveCell.Offset(1, 0).Select
    Next I
  UserForm26.Label42.Visible = False
  UserForm26.CommandButton17.Visible = False
  UserForm26.CommandButton20.Visible = False
  UserForm26.TextBox29.Text = ""
  UserForm26.TextBox29.Visible = False
  If RemoveRow = True Then
          MsgBox ("Remark : -- " & Chr(13) & Chr(13) & _
           "  Below parts are removed from the Components list :-- " & Chr(13) & _
           "   1). The product itself; " & Chr(13) & "   2). Next higher level products; and " & Chr(13) & _
           "   3). Stock items no longer in the Record")
  End If
 UserForm26.TextBox4.SetFocus
 Exit Sub
NonBOM:
 UserForm26.Label10.Caption = "      Incorrect Stock # "
 UserForm26.Label10.Visible = True
 UserForm26.CommandButton20.Visible = True
 UserForm26.TextBox4.SetFocus
End Sub

Sub Form26TextEnter(BOM As String)
  If BOM <> "" Then Exit Sub
  UserForm26.ListBox1.Visible = False
  UserForm26.ListBox2.Visible = False
  UserForm26.CommandButton19.Visible = False
  UserForm26.CommandButton20.Visible = False
  UserForm26.TextBox29.Visible = False
  UserForm26.Label42.Visible = False
End Sub

Sub Form26TextChange(BOM As String)
  If BOM <> "" Then Exit Sub
  UserForm26.CommandButton18.Visible = False
  UserForm26.Label10.Visible = False
End Sub

Sub Form27Col1Exit(BOMRow As Long, Source As String)
Dim I As Long, J As Long, StockRow As Long, EntryNo As Long, LineNo As Long
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "InvAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm27.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm27.ScrollBar1.Value
  If UserForm27.Controls("Textbox" & BOMRow).Text <> Cells(95 + LineNo + BOMRow, 3).Value Then
   UserForm27.Label10.Caption = Chr(13) & "   No Change to the Stock Adjustment record is allowed"
   UserForm27.Label10.Visible = True
  End If
   For I = 1 To 12
    UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
    UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
    UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
    UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
    UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
    UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
    UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
   Next I
   Exit Sub
 End If
 UserForm27.Label10.Visible = False
 UserForm27.ListBox2.Visible = False
If Left(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = 1
 Do While J <= I And Mid(StockNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then GoTo NoInput
  StockNo = Right(StockNo, I - J + 1)
End If
If Right(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = I
 Do While J > 0 And Mid(StockNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then GoTo NoInput
  StockNo = Left(StockNo, J)
End If
StockNo = UCase(StockNo)
If StockNo = "" Then GoTo NoInput
 EntryNo = Val(UserForm27.Controls("Label" & BOMRow + 10).Caption)
 If StockNo = ThisWorkbook.Worksheets("RunningDat").Cells(EntryNo + 100, 3).Value Then Exit Sub
 MyBook.Worksheets("StockRec").Activate
If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = True Then
  UserForm27.Controls("Textbox" & BOMRow).Text = ""
  UserForm27.Label10.Caption = Chr(13) & "    The stock number entered is not in the record."
  UserForm27.Label10.Visible = True
  SendKeys "+{tab}", False
 Exit Sub
End If
StockRow = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
 ThisWorkbook.Worksheets("RunningDat").Activate
    Range("C101").Select
    Do While ActiveCell.Value <> ""
      If ActiveCell.Value = StockNo Then
       If ActiveCell.Row <> EntryNo + 100 Then
         UserForm27.Label10.Caption = Chr(13) & "    Error!!  Duplicate Stock number"
         UserForm27.Label10.Visible = True
         UserForm27.Controls("Textbox" & BOMRow).Text = Cells(EntryNo + 100, 3).Value
         Exit Sub
       End If
      End If
     ActiveCell.Offset(1, 0).Select
    Loop
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range(Cells(EntryNo + 100, 2), Cells(EntryNo + 100, 10)).NumberFormat = "General"
 Range(Cells(EntryNo + 100, 3), Cells(EntryNo + 100, 4)).NumberFormat = "@"
 Cells(EntryNo + 100, 3).Value = StockNo
 Cells(EntryNo + 100, 4).Value = MyBook.Worksheets("StockRec").Cells(StockRow, 3).Value
 Cells(EntryNo + 100, 2).Value = MyBook.Worksheets("StockRec").Cells(StockRow, 5).Value
 Cells(EntryNo + 100, 5).Value = MyBook.Worksheets("StockRec").Cells(StockRow, 8).Value
 Cells(EntryNo + 100, 6).Value = MyBook.Worksheets("StockRec").Cells(StockRow, 9).Value
 If Cells(EntryNo + 100, 5).Value <> 0 Then
  Cells(EntryNo + 100, 7).Value = Format((Cells(EntryNo + 100, 6).Value / Cells(EntryNo + 100, 5).Value), "0.0000")
 Else
  Cells(EntryNo + 100, 7).Value = Format(MyBook.Worksheets("StockRec").Cells(StockRow, 10).Value, "0.0000")
 End If
 If Cells(EntryNo + 100, 10).Value = "" Then Cells(EntryNo + 100, 10).Value = UserForm27.TextBox1.Text
  If Cells(EntryNo + 100, 8).Value <> "" Then
   If Cells(EntryNo + 100, 8).Value + Cells(EntryNo + 100, 5).Value < 0 Then
     Cells(EntryNo + 100, 8).ClearContents
     Cells(EntryNo + 100, 9).ClearContents
   ElseIf Abs(Cells(EntryNo + 100, 8).Value + Cells(EntryNo + 100, 5).Value) < 0.00001 Then
    Cells(EntryNo + 100, 9).Value = Format(Cells(EntryNo + 100, 6).Value * (-1), "#,##0.00")
   Else
    Cells(EntryNo + 100, 9).Value = Format(Cells(EntryNo + 100, 8).Value * Cells(EntryNo + 100, 7).Value, "#,##0.00")
   End If
  End If
 Range("C101").Select
 For I = 1 To EntryNo
  If ActiveCell.Value = "" Then
   ActiveCell.EntireRow.Delete
  Else
   ActiveCell.Offset(1, 0).Select
  End If
 Next I
  J = ActiveCell.Row - 101
  If Range("C101").Select = "" Then
    TotalComp = 0
  ElseIf Range("C102").Value = "" Then
    TotalComp = 1
  Else
    Range("C101").End(xlDown).Select
    TotalComp = ActiveCell.Row - 100
  End If
 If TotalComp > 10 Then
   UserForm27.ScrollBar1.Max = TotalComp - 4
 End If
If J <> TotalComp Then
 If J > BOMRow - 4 Then
   If J + 5 - BOMRow <= UserForm27.ScrollBar1.Max Then UserForm27.ScrollBar1.Value = J + 5 - BOMRow
   LineNo = UserForm27.ScrollBar1.Value
   ThisWorkbook.Worksheets("RunningDat").Activate
   Cells(100 + LineNo, 1).Select
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
  Next I
 Else
  ThisWorkbook.Worksheets("RunningDat").Activate
  UserForm27.ScrollBar1.Value = 1
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(100 + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(100 + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(100 + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(100 + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(100 + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(100 + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(100 + I, 10).Value
  Next I
 End If
Else
 If J > 10 And BOMRow > 14 Then
  If UserForm27.ScrollBar1.Value < UserForm27.ScrollBar1.Max Then UserForm27.ScrollBar1.Value = UserForm27.ScrollBar1.Value + 1
 ElseIf J > 10 And BOMRow <= 14 Then
   If J + 5 - BOMRow <= UserForm27.ScrollBar1.Max Then UserForm27.ScrollBar1.Value = J + 5 - BOMRow
   LineNo = UserForm27.ScrollBar1.Value
   ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
  Next I
 Else
  UserForm27.ScrollBar1.Value = 1
  ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(100 + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(100 + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(100 + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(100 + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(100 + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(100 + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(100 + I, 10).Value
  Next I
 End If
End If
If Source = "List" Then
  I = Val(UserForm27.Label15.Caption)
  UserForm27.Controls("Textbox" & 17 + J - I).SetFocus
Else
 If UserForm27.Controls("Textbox" & BOMRow) = "" Then
     I = BOMRow
     Do While I > 5
      If UserForm27.Controls("Textbox" & I) <> "" Then Exit Do
      SendKeys "{Up}", False
      I = I - 1
     Loop
   End If
End If
 Exit Sub
NoInput:
  EntryNo = Val(UserForm27.Controls("Label" & BOMRow + 10).Caption)
   ThisWorkbook.Worksheets("RunningDat").Activate
   Cells(EntryNo + 100, 3).EntireRow.Delete
   SendKeys "+{tab}", False
   LineNo = UserForm27.ScrollBar1.Value
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
  Next I
End Sub

Sub Form27Col2Exit(BOMRow As Long)
Dim LineNo As Long, I As Long, EntryNo As Long, CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "InvAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm27.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm27.ScrollBar1.Value
  If Val(UserForm27.Controls("Textbox" & BOMRow + 12).Text) <> Cells(95 + LineNo + BOMRow, 8).Value Then
   UserForm27.Label10.Caption = Chr(13) & "   No Change to the Stock Adjustment record is allowed"
   UserForm27.Label10.Visible = True
  End If
   For I = 1 To 12
    UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
    UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
    UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
    UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
    UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
    UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
    UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
   Next I
   Exit Sub
 End If
 UserForm27.Label10.Visible = False
 UserForm27.ListBox2.Visible = False
  EntryNo = Val(UserForm27.Controls("Label" & BOMRow + 10).Caption)
  ThisWorkbook.Worksheets("RunningDat").Activate
  If UserForm27.Controls("Textbox" & BOMRow).Text = Cells(EntryNo + 100, 8).Value Then Exit Sub
 If UserForm27.Controls("Textbox" & BOMRow + 12).Text = "" Then
   Cells(EntryNo + 100, 8).Value = ""
   Cells(EntryNo + 100, 9).Value = ""
   UserForm27.Controls("Textbox" & BOMRow + 12).Text = Cells(EntryNo + 100, 8).Value
   UserForm27.Controls("Textbox" & BOMRow + 24).Text = Cells(EntryNo + 100, 9).Value
  Exit Sub
 End If
 If UserForm27.Controls("Textbox" & BOMRow).Text = "" Then
   UserForm27.Label10.Caption = Chr(13) & "    Please enter the Stock number first."
   UserForm27.Label10.Visible = True
   UserForm27.Controls("Textbox" & BOMRow + 12).Text = Cells(EntryNo + 100, 8).Value
   Exit Sub
 End If
 If IsNumeric(UserForm27.Controls("Textbox" & BOMRow + 12).Text) = False Then
   UserForm27.Label10.Caption = Chr(13) & "    Incorrect Quantity entered."
   UserForm27.Label10.Visible = True
   UserForm27.Controls("Textbox" & BOMRow + 12).Text = Cells(EntryNo + 100, 8).Value
   Exit Sub
 End If
  CheckNum = Format(UserForm27.Controls("Textbox" & BOMRow + 12).Text, "0.0000")
  UserForm27.Controls("Textbox" & BOMRow + 12).Text = CheckNum
 If CheckNum + Cells(EntryNo + 100, 5).Value < 0 Then
   UserForm27.Label10.Caption = Chr(13) & "    Negative Quantity after adjustment is not allowed."
   UserForm27.Label10.Visible = True
   UserForm27.Controls("Textbox" & BOMRow + 12).Text = Cells(EntryNo + 100, 8).Value
   Exit Sub
 End If
 Cells(EntryNo + 100, 8).NumberFormat = "General"
 Cells(EntryNo + 100, 8).Value = UserForm27.Controls("Textbox" & BOMRow + 12).Text
 If Cells(EntryNo + 100, 7).Value <> "" Then
   Cells(EntryNo + 100, 9).NumberFormat = "General"
   If Cells(EntryNo + 100, 8).Value + Cells(EntryNo + 100, 5).Value <> 0 Then
    Cells(EntryNo + 100, 9).Value = Format(Cells(EntryNo + 100, 8).Value * Cells(EntryNo + 100, 7).Value, "#,##0.00")
   Else
    Cells(EntryNo + 100, 9).Value = Format(Cells(EntryNo + 100, 6).Value * (-1), "#,##0.00")
   End If
 End If
   LineNo = UserForm27.ScrollBar1.Value
   ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
  Next I
  UserForm27.Controls("Textbox" & BOMRow + 12).SetFocus
   If UserForm27.Controls("Textbox" & BOMRow) = "" Then
     I = BOMRow
     Do While I > 5
      If UserForm27.Controls("Textbox" & I) <> "" Then Exit Do
      SendKeys "{Up}", False
      I = I - 1
     Loop
   End If
End Sub

Sub Form27Col3Exit(BOMRow As Long)
Dim EntryNo As Long, LineNo As Long, I As Long, CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "InvAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm27.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm27.ScrollBar1.Value
  If Val(UserForm27.Controls("Textbox" & BOMRow + 24).Text) <> Cells(95 + LineNo + BOMRow, 9).Value Then
   UserForm27.Label10.Caption = Chr(13) & "   No Change to the Stock Adjustment record is allowed"
   UserForm27.Label10.Visible = True
  End If
   For I = 1 To 12
    UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
    UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
    UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
    UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
    UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
    UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
    UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
   Next I
   Exit Sub
 End If
 UserForm27.Label10.Visible = False
 UserForm27.ListBox1.Visible = False
 UserForm27.ListBox2.Visible = False
  EntryNo = Val(UserForm27.Controls("Label" & BOMRow + 10).Caption)
 If UserForm27.Controls("Textbox" & BOMRow).Text = "" Then
   UserForm27.Label10.Caption = Chr(13) & "    Please enter the Stock number first."
   UserForm27.Label10.Visible = True
   UserForm27.Controls("Textbox" & BOMRow + 24).Text = Cells(100 + EntryNo, 9).Value
   Exit Sub
 End If
 If IsNumeric(UserForm27.Controls("Textbox" & BOMRow + 24).Text) = False Then
   UserForm27.Label10.Caption = Chr(13) & "    Incorrect Amount entered."
   UserForm27.Label10.Visible = True
   UserForm27.Controls("Textbox" & BOMRow + 24).Text = Cells(100 + EntryNo, 9).Value
   Exit Sub
 End If
  CheckNum = UserForm27.Controls("Textbox" & BOMRow + 24).Text
  UserForm27.Controls("Textbox" & BOMRow + 24).Text = CheckNum
  ThisWorkbook.Worksheets("RunningDat").Activate
  If Cells(EntryNo + 100, 9).Value = Format(UserForm27.Controls("Textbox" & BOMRow + 24).Text, "#,##0.00") Then Exit Sub
 If Cells(100 + EntryNo, 5).Value + Cells(100 + EntryNo, 8).Value = 0 Then
   UserForm27.Label10.Caption = Chr(13) & "    This adjustment reduces the stock Qty to zero." & Chr(13) & _
                                "    Hence, the book value must be reduced to zero. "
   UserForm27.Label10.Visible = True
   Cells(EntryNo + 100, 9).Value = Format(Cells(EntryNo + 100, 6).Value * (-1), "#,##0.00")
   UserForm27.Controls("Textbox" & BOMRow + 24).Text = Cells(100 + EntryNo, 9).Value
 ElseIf Cells(EntryNo + 100, 6).Value + Val(UserForm27.Controls("Textbox" & BOMRow + 24).Text) < 0 Then
   UserForm27.Label10.Caption = Chr(13) & "    The value of the stock part cannot be adjusted to negative."
   UserForm27.Label10.Visible = True
   Cells(EntryNo + 100, 9).Value = Format((Cells(EntryNo + 100, 7).Value * Cells(EntryNo + 100, 8).Value), "#,##0.00")
   UserForm27.Controls("Textbox" & BOMRow + 24).Text = Cells(100 + EntryNo, 9).Value
 Else
   Cells(100 + EntryNo, 9).Value = Format(UserForm27.Controls("Textbox" & BOMRow + 24).Text, "#,##0.00")
   UserForm27.Controls("Textbox" & BOMRow + 24).Text = Cells(100 + EntryNo, 9).Value
 End If
End Sub

Sub Form27AcctExit(BOMRow As Long)
Dim AcctNo As String, EntryNo As Long, LineNo As Long, I As Long
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "InvAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm27.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm27.ScrollBar1.Value
  AcctNo = UserForm27.Controls("Textbox" & BOMRow).Text
  If AcctNo <> Cells(59 + LineNo + BOMRow, 10).Value Then
   UserForm27.Label10.Caption = Chr(13) & "   No Change to the Stock Adjustment record is allowed"
   UserForm27.Label10.Visible = True
  End If
   For I = 1 To 12
    UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
    UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
    UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
    UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
    UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
    UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
    UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
   Next I
   Exit Sub
 End If
 UserForm27.Label10.Visible = False
 UserForm27.ListBox1.Visible = False
 UserForm27.ListBox2.Visible = False
 AcctNo = UCase(UserForm27.Controls("Textbox" & BOMRow).Text)
 UserForm27.Controls("Textbox" & BOMRow).Text = AcctNo
 If AcctNo = "" Then GoTo AccountOK
If BOMRow <> 1 Then
  EntryNo = Val(UserForm27.Controls("Label" & BOMRow - 26).Caption)
 If UserForm27.Controls("Textbox" & BOMRow - 36).Text = "" Then
  UserForm27.Label10.Caption = Chr(13) & "   Please enter the Stock number first "
  UserForm27.Label10.Visible = True
  UserForm27.Controls("Textbox" & BOMRow).Text = Cells(EntryNo + 100, 10).Value
  Exit Sub
 End If
End If
 MyBook.Worksheets("Chart of Account").Activate
 Range("A10").Select
 Do While ActiveCell.Value <= AcctNo And ActiveCell.Value <> ""
  If ActiveCell.Value = AcctNo Then
   If Len(ActiveCell.Offset(1, 0).Value) > Len(AcctNo) Then
    UserForm27.Label10.Caption = Chr(13) & "    The number entered is Not a Detailed Account"
    UserForm27.Label10.Visible = True
    GoTo WrongAccount
   End If
   GoTo AccountOK
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
   UserForm27.Label10.Caption = Chr(13) & "    The number entered is not a Valid Account number"
   UserForm27.Label10.Visible = True
WrongAccount:
UserForm27.Controls("Textbox" & BOMRow).Text = ""
If BOMRow <> 1 Then
 EntryNo = Val(UserForm27.Controls("Label" & BOMRow - 26).Caption)
 ThisWorkbook.Worksheets("RunningDat").Activate
 UserForm27.Controls("Textbox" & BOMRow).Text = Cells(EntryNo + 100, 10).Value
End If
Exit Sub
AccountOK:
ThisWorkbook.Worksheets("RunningDat").Activate
If BOMRow = 1 Then
 Cells(101, 3).Select
 Do While ActiveCell.Value <> ""
  ActiveCell.Offset(0, 7).Value = AcctNo
  ActiveCell.Offset(1, 0).Select
 Loop
   LineNo = UserForm27.ScrollBar1.Value
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
  Next I
Else
 EntryNo = Val(UserForm27.Controls("Label" & BOMRow - 26).Caption)
 Cells(EntryNo + 100, 10).Value = AcctNo
End If
End Sub

Sub Form28Text1Exit(RunCode As String)
Dim J As Long, ShName As String, BOMCol As Long, LastBOMRow As Long, CompNo As String, ProdAcct As String
Dim BuildQty As Double, ProdQty As Double, ProdValue As Double
If RunCode <> "BuildProduct" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 UserForm28.Label10.Visible = False
   J = MyBook.Worksheets("BOM1").Range("A9").Value
   BOMCol = 0
   For I = 1 To J
    ShName = "BOM" & I
    MyBook.Worksheets(ShName).Activate
    If Range("B10").Value <> "" Then
     Set CheckRange = Rows("10")
     If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
      BOMCol = Application.Match(StockNo, CheckRange, 0)
      If BOMCol > 1 Then Exit For
     Else
      ShName = ""
     End If
    Else
     ShName = ""
    End If
   Next I
  ProdAcct = ""
 MyBook.Worksheets("StockRec").Activate
 If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)) = False Then
  I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)
  UserForm28.Label11.Caption = Cells(I, 3).Value
  ProdAcct = Cells(I, 5).Value
  ProdQty = Cells(I, 8).Value
  ProdValue = Cells(I, 9).Value
 End If
 If ShName = "" Or BOMCol < 2 Then GoTo NoBOM
 MyBook.Worksheets(ShName).Activate
   If Range("A11") <> "" Then
      Range("A10").End(xlDown).Select
      LastBOMRow = ActiveCell.Row
   Else
      LastBOMRow = 10
   End If
 ThisWorkbook.Worksheets("RunningDat").Activate
 ActiveSheet.UsedRange.Delete
 Columns("B").NumberFormat = "General"
 Columns("C:D").NumberFormat = "@"
 Columns("E:L").NumberFormat = "General"
 Range("E101").Select
  Range("A3:A5").NumberFormat = "General"
  Range("A3").Value = ProdAcct
  Range("A4").Value = ProdQty
  Range("A5").Value = ProdValue
 MyBook.Worksheets(ShName).Activate
  If BOMCol < 2 Then GoTo NoComponent
   Range(Cells(11, BOMCol), Cells(LastBOMRow, BOMCol)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(101, 3), Cells(LastBOMRow, 3)).NumberFormat = "@"
   Range("C101").Select
   MyBook.Worksheets(ShName).Activate
   Range(Cells(11, 1), Cells(LastBOMRow, 1)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
   Application.CutCopyMode = False
   LastBOMRow = LastBOMRow + 90
   Range(Cells(101, 3), Cells(LastBOMRow, 5)).Select
   Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   If Range("E101").Value <> "" Then
    If Range("E102").Value <> "" Then
     Range("E101").End(xlDown).Select
     I = ActiveCell.Row
     Cells(I + 1, 1).EntireRow.Insert
     Cells(I + 2, 3).Select
     ActiveCell.CurrentRegion.Select
     Selection.EntireRow.Delete
    Else
     I = 101
     If LastBOMRow > 101 Then Range(Cells(102, 1), Cells(LastBOMRow, 1)).EntireRow.Delete
    End If
   Else
    I = 101
    Range(Cells(101, 1), Cells(LastBOMRow, 1)).EntireRow.Delete
   End If
   LastBOMRow = I
   If Range("C101") <> "" Then
     Range(Cells(101, 3), Cells(I, 5)).Select
     Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Range("C101").Select
    Do While ActiveCell.Value <> ""
     CompNo = ActiveCell.Value
     If IsError(Application.Match(CompNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
       J = Application.Match(CompNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       ActiveCell.Offset(0, -1).NumberFormat = "General"
       ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("StockRec").Cells(J, 5).Value
       ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("StockRec").Cells(J, 3).Value
       ActiveCell.Offset(0, 3).Value = MyBook.Worksheets("StockRec").Cells(J, 8).Value
       ActiveCell.Offset(0, 4).Value = MyBook.Worksheets("StockRec").Cells(J, 9).Value
       ActiveCell.Offset(0, 5).Value = MyBook.Worksheets("StockRec").Cells(J, 10).Value
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
  If IsNumeric(UserForm28.TextBox3.Text) = True Then
    BuildQty = UserForm28.TextBox3.Text
    If BuildQty + ProdQty < 0 Then
      BuildQty = 0 - ProdQty
      BuildQty = 0
      UserForm28.Label10.Caption = Chr(13) & "     Negative Build Qty. Cannot be less than " & BuildQty & ", otherwise the inventory will result in Negative quantity "
      UserForm28.Label10.Visible = True
      UserForm28.TextBox3.Text = BuildQty
    End If
    Range("C101").Select
    Do While ActiveCell.Value <> ""
       ActiveCell.Offset(0, 6).Value = Format(ActiveCell.Offset(0, 2).Value * BuildQty, "0.0000")
       If ActiveCell.Offset(0, 6).Value > ActiveCell.Offset(0, 3).Value Then
          ActiveCell.Offset(0, 8).Value = "Insufficient Qty"
       Else
        ActiveCell.Offset(0, 8).Value = Format(ActiveCell.Offset(0, 6).Value + ActiveCell.Offset(0, 7).Value, "0.0000")
        If ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, 3).Value Then
          ActiveCell.Offset(0, 9).Value = ActiveCell.Offset(0, 4).Value
        Else
         If ActiveCell.Offset(0, 3).Value = 0 Then
           ActiveCell.Offset(0, 9).Value = Format((ActiveCell.Offset(0, 4).Value * ActiveCell.Offset(0, 8).Value) / ActiveCell.Offset(0, 3).Value, "0.00")
         Else
           ActiveCell.Offset(0, 9).Value = Format((ActiveCell.Offset(0, 5).Value * ActiveCell.Offset(0, 8).Value), "0.00")
         End If
        End If
       End If
     ActiveCell.Offset(1, 0).Select
    Loop
   End If
NoComponent:
    If LastBOMRow > 110 Then
      UserForm28.ScrollBar1.Max = LastBOMRow - 110
    Else
      UserForm28.ScrollBar1.Max = 1
    End If
      UserForm28.ScrollBar1.Value = 1
 For I = 1 To 12
    UserForm28.Controls("Label" & I + 14).Caption = I
    UserForm28.Controls("Label" & I + 77).Caption = Cells(100 + I, 3).Value
    UserForm28.Controls("Label" & I + 89).Caption = Cells(100 + I, 4).Value
    UserForm28.Controls("Label" & I + 29).Caption = Cells(100 + I, 5).Value
    UserForm28.Controls("Label" & I + 41).Caption = Cells(100 + I, 6).Value
    UserForm28.Controls("Label" & I + 53).Caption = Cells(100 + I, 9).Value
    UserForm28.Controls("Textbox" & I + 16).Text = Cells(100 + I, 10).Value
    UserForm28.Controls("Label" & I + 65).Caption = Cells(100 + I, 11).Value
 Next I
 Exit Sub
NoBOM:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("C101").Select
  For I = 15 To 26
   UserForm28.Controls("Label" & I).Caption = I - 14
  Next I
  For I = 17 To 28
   UserForm28.Controls("Textbox" & I).Text = ""
  Next I
  For I = 30 To 101
   UserForm28.Controls("Label" & I).Caption = ""
  Next I
  UserForm28.Label10.Caption = Chr(13) & "     BOM for the product is not found from the record"
  UserForm28.Label10.Visible = True
  UserForm28.CommandButton2.Visible = False
  SendKeys "{Up}", False
End Sub

Sub Form28Col1Exit(RowNo As Long)
Dim WasteQty As Double, DataRowNo As Long, I As Long, CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "BuildProduct" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm28.CommandButton2.Visible = False Then
    ThisWorkbook.Worksheets("RunningDat").Activate
    LineNo = UserForm28.ScrollBar1.Value
  If Val(UserForm28.Controls("Textbox" & RowNo).Text) <> Cells(83 + LineNo + RowNo, 10).Value Then
   UserForm28.Label10.Caption = Chr(13) & "   No Change to the Job order record is allowed"
   UserForm28.Label10.Visible = True
  End If
   For I = 1 To 12
    UserForm28.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm28.Controls("Label" & I + 77).Caption = Cells(99 + LineNo + I, 3).Value
    UserForm28.Controls("Label" & I + 89).Caption = Cells(99 + LineNo + I, 4).Value
    UserForm28.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
    UserForm28.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 6).Value
    UserForm28.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 9).Value
    UserForm28.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 10).Value
    UserForm28.Controls("Label" & I + 65).Caption = Cells(99 + LineNo + I, 11).Value
   Next I
   Exit Sub
 End If
   UserForm28.Label10.Visible = False
  DataRowNo = Val(UserForm28.Label15.Caption) + RowNo + 83
  ThisWorkbook.Worksheets("RunningDat").Activate
  If Cells(DataRowNo, 10).Value = UserForm28.Controls("TextBox" & RowNo).Text Then Exit Sub
 If UserForm28.Controls("Label" & RowNo + 61).Caption = "" Then
   UserForm28.Label10.Caption = Chr(13) & "    Error!!  There is no component item in this row"
   UserForm28.Label10.Visible = True
   Cells(DataRowNo, 10).Value = ""
   UserForm28.Controls("Textbox" & RowNo).Text = Cells(DataRowNo, 10).Value
   Exit Sub
 End If
 If IsNumeric(UserForm28.Controls("TextBox" & RowNo).Text) = True Then
   CheckNum = Format(UserForm28.Controls("TextBox" & RowNo).Text, "0.0000")
   UserForm28.Controls("TextBox" & RowNo).Text = CheckNum
   WasteQty = UserForm28.Controls("TextBox" & RowNo).Text
 ElseIf UserForm28.Controls("TextBox" & RowNo).Text = "" Then WasteQty = 0
 Else
   UserForm28.Label10.Caption = Chr(13) & "    Incorrect input for Production Waste Quantity.  It must be a numeric number"
   UserForm28.Label10.Visible = True
   Exit Sub
 End If
Cells(DataRowNo, 10).Value = WasteQty
Cells(DataRowNo, 11).Value = Format(Cells(DataRowNo, 9).Value + Cells(DataRowNo, 10).Value, "0.0000")
If Cells(DataRowNo, 11).Value > Cells(DataRowNo, 6).Value Then
  Cells(DataRowNo, 11).Value = "Insufficient Qty"
ElseIf Cells(DataRowNo, 11).Value = Cells(DataRowNo, 6).Value Then Cells(DataRowNo, 12).Value = Format(Cells(DataRowNo, 7).Value, "#,##0.00")
Else
 If Cells(DataRowNo, 6).Value <> 0 Then
   Cells(DataRowNo, 12).Value = Format(((Cells(DataRowNo, 11).Value * Cells(DataRowNo, 7).Value) / Cells(DataRowNo, 6).Value), "#,##0.00")
 Else
  Cells(DataRowNo, 12).Value = Format((Cells(DataRowNo, 11).Value * Cells(DataRowNo, 8).Value), "#,##0.00")
 End If
End If
 LineNo = UserForm28.ScrollBar1.Value
 UserForm28.Controls("Textbox" & RowNo).Text = Cells(100 + LineNo + RowNo - 17, 10).Value
 UserForm28.Controls("Label" & RowNo + 49).Caption = Cells(100 + LineNo + RowNo - 17, 11).Value
End Sub

Sub Form29Col1Exit(FormRow As Long)
Dim LineNo As Long, I As Long, EntryNo As Long
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "PIAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm29.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm29.ScrollBar1.Value
  If UserForm29.TextBox2.Text <> "" Then
   If Val(UserForm29.Controls("Textbox" & FormRow).Text) <> Cells(4 + LineNo + FormRow, 6).Value Then
    UserForm29.Label10.Caption = Chr(13) & "   This is an old Record.  No Change is allowed"
    UserForm29.Label10.Visible = True
   End If
  End If
   For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
   Exit Sub
 End If
 UserForm29.Label10.Visible = False
 UserForm29.ListBox1.Visible = False
  EntryNo = Val(UserForm29.Controls("Label" & FormRow + 10).Caption)
  ThisWorkbook.Worksheets("RunningDat").Activate
  If Cells(EntryNo + 9, 6).Value = UserForm29.Controls("Textbox" & FormRow).Text Then Exit Sub
 If UserForm29.Controls("Label" & FormRow + 25).Caption = "" Then
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 6).Value
   Exit Sub
 End If
 If UserForm29.Controls("Textbox" & FormRow).Text = "" Then
   Cells(EntryNo + 9, 6).Value = 0
   Cells(EntryNo + 9, 7).Value = Cells(EntryNo + 9, 6).Value - Cells(EntryNo + 9, 5).Value
   Cells(EntryNo + 9, 8).Value = Format(Cells(EntryNo + 9, 1).Value * (-1), "0.00")
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 6).Value
   UserForm29.Controls("Textbox" & FormRow + 12).Text = Cells(EntryNo + 9, 7).Value
   UserForm29.Controls("Textbox" & FormRow + 24).Text = Cells(EntryNo + 9, 8).Value
  Exit Sub
 End If
 If IsNumeric(UserForm29.Controls("Textbox" & FormRow).Text) = False Then
   UserForm29.Label10.Caption = Chr(13) & "    Incorrect Quantity entered."
   UserForm29.Label10.Visible = True
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 6).Value
   Exit Sub
 End If
 If Val(UserForm29.Controls("Textbox" & FormRow).Text) < 0 Then
   UserForm29.Label10.Caption = Chr(13) & "    Actual Quantity cannot be negative."
   UserForm29.Label10.Visible = True
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 6).Value
   UserForm29.Controls("Textbox" & FormRow + 12).Text = Cells(EntryNo + 9, 7).Value
   UserForm29.Controls("Textbox" & FormRow + 24).Text = Cells(EntryNo + 9, 8).Value
   Exit Sub
 End If
 Cells(EntryNo + 9, 6).Value = Format(UserForm29.Controls("Textbox" & FormRow).Text, "0.0000")
 UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 6).Value
 Cells(EntryNo + 9, 7).Value = Format(Cells(EntryNo + 9, 6).Value - Cells(EntryNo + 9, 5).Value, "0.0000")
 If Cells(EntryNo + 9, 7).Value <> 0 Then
   If Cells(EntryNo + 9, 5).Value = 0 Then
     Cells(EntryNo + 9, 8).Value = Format(Cells(EntryNo + 9, 7).Value * Cells(EntryNo + 9, 10).Value, "0.00")
   Else
    If Cells(EntryNo + 9, 6).Value = 0 Then
       Cells(EntryNo + 9, 8).Value = Format(Cells(EntryNo + 9, 1).Value * (-1), "0.00")
    Else
     Cells(EntryNo + 9, 8).Value = Format(((Cells(EntryNo + 9, 7).Value * Cells(EntryNo + 9, 1).Value) / Cells(EntryNo + 9, 5).Value), "0.00")
    End If
   End If
 Else
    Cells(EntryNo + 9, 8).Value = 0
 End If
   LineNo = UserForm29.ScrollBar1.Value
  For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
End Sub

Sub Form29Col2Exit(FormRow As Long)
Dim LineNo As Long, I As Long, EntryNo As Long, CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "PIAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm29.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm29.ScrollBar1.Value
  If UserForm29.TextBox2.Text <> "" Then
   If Val(UserForm29.Controls("Textbox" & FormRow).Text) <> Cells(LineNo + FormRow - 8, 7).Value Then
    UserForm29.Label10.Caption = Chr(13) & "   This is an old Record.  No Change is allowed"
    UserForm29.Label10.Visible = True
   End If
  End If
   For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
   Exit Sub
 End If
 UserForm29.Label10.Visible = False
 UserForm29.ListBox1.Visible = False
  EntryNo = Val(UserForm29.Controls("Label" & FormRow - 2).Caption)
  ThisWorkbook.Worksheets("RunningDat").Activate
  If Cells(EntryNo + 9, 7).Value = UserForm29.Controls("Textbox" & FormRow).Text Then Exit Sub
 If UserForm29.Controls("Label" & FormRow + 13).Caption = "" Then
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 7).Value
   Exit Sub
 End If
 If UserForm29.Controls("Textbox" & FormRow).Text = "" Then
   Cells(EntryNo + 9, 7).Value = 0
   Cells(EntryNo + 9, 6).Value = Cells(EntryNo + 9, 5).Value - Cells(EntryNo + 9, 7).Value
   Cells(EntryNo + 9, 8).Value = 0
   UserForm29.Controls("Textbox" & FormRow - 12).Text = Cells(EntryNo + 9, 6).Value
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 7).Value
   UserForm29.Controls("Textbox" & FormRow + 12).Text = Cells(EntryNo + 9, 8).Value
  Exit Sub
 End If
 If IsNumeric(UserForm29.Controls("Textbox" & FormRow).Text) = False Then
   UserForm29.Label10.Caption = Chr(13) & "    Incorrect Quantity entered."
   UserForm29.Label10.Visible = True
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 7).Value
   Exit Sub
 End If
 CheckNum = Format(UserForm29.Controls("Textbox" & FormRow).Text, "0.0000")
 UserForm29.Controls("Textbox" & FormRow).Text = CheckNum
 If CheckNum + Cells(EntryNo + 9, 5).Value < 0 Then
   UserForm29.Label10.Caption = Chr(13) & "    Actual Quantity cannot be negative."
   UserForm29.Label10.Visible = True
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 7).Value
   Exit Sub
 End If
 Cells(EntryNo + 9, 7).Value = UserForm29.Controls("Textbox" & FormRow).Text
 Cells(EntryNo + 9, 6).Value = Format(Cells(EntryNo + 9, 7).Value + Cells(EntryNo + 9, 5).Value, "0.0000")
 If Cells(EntryNo + 9, 7).Value <> 0 Then
   If Cells(EntryNo + 9, 5).Value = 0 Then
     Cells(EntryNo + 9, 8).Value = Format(Cells(EntryNo + 9, 7).Value * Cells(EntryNo + 9, 10).Value, "0.00")
   Else
    If Cells(EntryNo + 9, 6).Value = 0 Then
       Cells(EntryNo + 9, 8).Value = Format(Cells(EntryNo + 9, 1).Value * (-1), "0.00")
    Else
     Cells(EntryNo + 9, 8).Value = Format((Cells(EntryNo + 9, 7).Value * Cells(EntryNo + 9, 1).Value) / Cells(EntryNo + 9, 5).Value, "0.00")
    End If
   End If
 Else
    Cells(EntryNo + 9, 8).Value = 0
 End If
   LineNo = UserForm29.ScrollBar1.Value
  For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
End Sub

Sub Form29Col3Exit(FormRow As Long)
Dim LineNo As Long, I As Long, EntryNo As Long, CheckNum As Double
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "PIAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm29.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm29.ScrollBar1.Value
  If UserForm29.TextBox2.Text <> "" Then
   If Val(UserForm29.Controls("Textbox" & FormRow).Text) <> Cells(LineNo + FormRow - 20, 8).Value Then
    UserForm29.Label10.Caption = Chr(13) & "   This is an old Record.  No Change is allowed"
    UserForm29.Label10.Visible = True
   End If
  End If
   For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
   Exit Sub
 End If
 UserForm29.Label10.Visible = False
 UserForm29.ListBox1.Visible = False
  EntryNo = Val(UserForm29.Controls("Label" & FormRow - 14).Caption)
  ThisWorkbook.Worksheets("RunningDat").Activate
  If Cells(EntryNo + 9, 8).Value = UserForm29.Controls("Textbox" & FormRow).Text Then Exit Sub
 If UserForm29.Controls("Label" & FormRow + 1).Caption = "" Then
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 8).Value
   Exit Sub
 End If
 If UserForm29.Controls("Textbox" & FormRow).Text = "" Then
    Cells(EntryNo + 9, 8).Value = 0
    UserForm29.Controls("Textbox" & FormRow).Text = 0
 End If
 If IsNumeric(UserForm29.Controls("Textbox" & FormRow).Text) = False Then
   UserForm29.Label10.Caption = Chr(13) & "    Incorrect Quantity entered."
   UserForm29.Label10.Visible = True
   UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 8).Value
   Exit Sub
 End If
  CheckNum = Format(UserForm29.Controls("Textbox" & FormRow).Text, "0.00")
  UserForm29.Controls("Textbox" & FormRow).Text = CheckNum
 If Cells(EntryNo + 9, 6).Value = 0 Then
   If CheckNum <> Cells(EntryNo + 9, 1).Value * (-1) Then
     UserForm29.Label10.Caption = Chr(13) & "    As No Quantity is left, total amount of this item must be reduced to zero."
     UserForm29.Label10.Visible = True
   End If
    Cells(EntryNo + 9, 8).Value = Cells(EntryNo + 9, 1).Value * (-1)
    UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 8).Value
  Exit Sub
 End If
 If Val(UserForm29.Controls("Textbox" & FormRow).Text) + Cells(EntryNo + 9, 1).Value < 0 Then
     UserForm29.Label10.Caption = Chr(13) & "    The Total amount of this item cannot be reduced to negative."
     UserForm29.Label10.Visible = True
    UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 8).Value
  Exit Sub
 End If
 Cells(EntryNo + 9, 8).Value = UserForm29.Controls("Textbox" & FormRow).Text
   LineNo = UserForm29.ScrollBar1.Value
  For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
End Sub

Sub Form29AcctExit(FormRow As Long)
Dim AcctNo As String, EntryNo As Long, LineNo As Long, I As Long
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value <> "PIAdj" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 If UserForm29.CommandButton2.Visible = False Then
   ThisWorkbook.Worksheets("RunningDat").Activate
   LineNo = UserForm29.ScrollBar1.Value
  If UserForm29.TextBox2.Text <> "" Then
   AcctNo = UserForm29.Controls("Textbox" & FormRow).Text
   If AcctNo <> Cells(LineNo + FormRow - 32, 9).Value Then
    UserForm29.Label10.Caption = Chr(13) & "   This is an old Record.  No Change is allowed"
    UserForm29.Label10.Visible = True
   End If
  End If
   For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
   Exit Sub
 End If
 UserForm29.Label10.Visible = False
 UserForm29.ListBox1.Visible = False
  AcctNo = UCase(UserForm29.Controls("Textbox" & FormRow).Text)
  UserForm29.Controls("Textbox" & FormRow).Text = AcctNo
  If AcctNo = "" Then GoTo AccountOK
If FormRow <> 1 Then
   EntryNo = Val(UserForm29.Controls("Label" & FormRow - 26).Caption)
  If UserForm29.Controls("Label" & FormRow - 11).Caption = "" Then
   UserForm29.Controls("Textbox" & FormRow).Text = ""
   Exit Sub
  End If
End If
 MyBook.Worksheets("Chart of Account").Activate
 Range("A10").Select
 Do While ActiveCell.Value <= AcctNo And ActiveCell.Value <> ""
  If ActiveCell.Value = AcctNo Then
   If Len(ActiveCell.Offset(1, 0).Value) > Len(AcctNo) Then
    UserForm29.Label10.Caption = Chr(13) & "    The number entered is Not a Detailed Account"
    UserForm29.Label10.Visible = True
    GoTo WrongAccount
   End If
   GoTo AccountOK
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
   UserForm29.Label10.Caption = Chr(13) & "    The number entered is not a Valid Account number"
   UserForm29.Label10.Visible = True
WrongAccount:
 UserForm29.Controls("Textbox" & FormRow).Text = ""
If FormRow <> 1 Then
 EntryNo = Val(UserForm29.Controls("Label" & FormRow - 26).Caption)
 ThisWorkbook.Worksheets("RunningDat").Activate
 UserForm29.Controls("Textbox" & FormRow).Text = Cells(EntryNo + 9, 9).Value
End If
Exit Sub
AccountOK:
ThisWorkbook.Worksheets("RunningDat").Activate
If FormRow = 1 Then
 Cells(10, 3).Select
 Do While ActiveCell.Value <> ""
  ActiveCell.Offset(0, 6).Value = AcctNo
  ActiveCell.Offset(1, 0).Select
 Loop
   LineNo = UserForm29.ScrollBar1.Value
   For I = 1 To 12
    UserForm29.Controls("Label" & I + 14).Caption = I + LineNo - 1
    UserForm29.Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    UserForm29.Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    UserForm29.Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    UserForm29.Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    UserForm29.Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    UserForm29.Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    UserForm29.Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
   Next I
Else
 EntryNo = Val(UserForm29.Controls("Label" & FormRow - 26).Caption)
 Cells(EntryNo + 9, 9).Value = AcctNo
End If
End Sub

Sub InvoiceIOAdd(StockDate As Date, InvRef As String)
Dim StockQty As Double, SubTotal As Double, QtyTotal As Double, I As Long
Dim AddQty As Double, AddAmt As Double, QtySum As Double, AmtSum As Double, AssetNo As String
If ThisWorkbook.Worksheets("NewCOm").Range("A10").Value <> "IOAdd" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Activate
   Range("D160").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 9).Value <> "" Then
    StockNo = ActiveCell.Offset(0, 9).Value
    QtyTotal = ActiveCell.Offset(0, 2).Value
    SubTotal = ActiveCell.Offset(0, 8).Value
    Do While ActiveCell.Offset(1, 0).Value <> "" And ActiveCell.Offset(1, 9).Value = StockNo
     QtyTotal = QtyTotal + ActiveCell.Offset(1, 2).Value
     SubTotal = SubTotal + ActiveCell.Offset(1, 8).Value
     ActiveCell.EntireRow.Delete
    Loop
     QtyTotal = Format(QtyTotal, "0.0000")
     SubTotal = Format(SubTotal, "0.00")
    If QtyTotal <> 0 Or SubTotal <> 0 Then
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
       I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        MyBook.Worksheets("StockRec").Cells(I, 8).Value = Format(StockQty - QtyTotal, "0.0000")
       If Abs(SubTotal) > 0.001 Then MyBook.Worksheets("StockRec").Cells(I, 9).Value = Format(MyBook.Worksheets("StockRec").Cells(I, 9).Value - SubTotal, "0.00")
       If MyBook.Worksheets("StockRec").Cells(I, 8).Value <> 0 Then _
           MyBook.Worksheets("StockRec").Cells(I, 10).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value / MyBook.Worksheets("StockRec").Cells(I, 8).Value
       If MyBook.Worksheets("StockRec").Cells(I, 1).Value < StockDate Then MyBook.Worksheets("StockRec").Cells(I, 1).Value = StockDate
        AddQty = QtyTotal * (-1)
        AddAmt = SubTotal * (-1)
        QtySum = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        AmtSum = MyBook.Worksheets("StockRec").Cells(I, 9).Value
        AssetNo = MyBook.Worksheets("StockRec").Cells(I, 5).Value
       If QtyTotal <> 0 Or SubTotal <> 0 Then
        Call InvIOAdd(AddQty, AddAmt, StockDate, QtySum, AmtSum, AssetNo)
        Call IOUpdate(QtyTotal, SubTotal, InvRef, StockDate, "D", StockQty)
       End If
      End If
    End If
   End If
    ThisWorkbook.Worksheets("TempRP").Activate
    ActiveCell.Offset(1, 0).Select
  Loop
End Sub

Sub CNIOAdd(StockDate As Date, CNo As String)
Dim StockQty As Double, SubTotal As Double, QtyTotal As Double, I As Long
Dim AddQty As Double, AddAmt As Double, QtySum As Double, AmtSum As Double, AssetNo As String
If ThisWorkbook.Worksheets("NewCOm").Range("A10").Value <> "IOAdd" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Activate
   Range("D160").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 9).Value <> "" Then
    StockNo = ActiveCell.Offset(0, 9).Value
    QtyTotal = ActiveCell.Offset(0, 2).Value
    SubTotal = ActiveCell.Offset(0, 8).Value
    Do While ActiveCell.Offset(1, 0).Value <> "" And ActiveCell.Offset(1, 9).Value = StockNo
     QtyTotal = QtyTotal + ActiveCell.Offset(1, 2).Value
     SubTotal = SubTotal + ActiveCell.Offset(1, 8).Value
     ActiveCell.EntireRow.Delete
    Loop
    QtyTotal = Format(QtyTotal, "0.0000")
    SubTotal = Format(SubTotal, "0.00")
    If QtyTotal <> 0 Or SubTotal <> 0 Then
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
       I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        MyBook.Worksheets("StockRec").Cells(I, 8).Value = Format(StockQty + QtyTotal, "0.0000")
       If Abs(SubTotal) > 0.001 Then MyBook.Worksheets("StockRec").Cells(I, 9).Value = Format(MyBook.Worksheets("StockRec").Cells(I, 9).Value + SubTotal, "0.00")
       If MyBook.Worksheets("StockRec").Cells(I, 8).Value <> 0 Then _
           MyBook.Worksheets("StockRec").Cells(I, 10).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value / MyBook.Worksheets("StockRec").Cells(I, 8).Value
       If MyBook.Worksheets("StockRec").Cells(I, 1).Value < InvDate Then MyBook.Worksheets("StockRec").Cells(I, 1).Value = InvDate
        QtySum = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        AmtSum = MyBook.Worksheets("StockRec").Cells(I, 9).Value
        AssetNo = MyBook.Worksheets("StockRec").Cells(I, 5).Value
       If QtyTotal <> 0 Or SubTotal <> 0 Then
        Call InvIOAdd(QtyTotal, SubTotal, StockDate, QtySum, AmtSum, AssetNo)
        Call IOUpdate(QtyTotal, SubTotal, CNo, StockDate, "A", StockQty)
       End If
      End If
    End If
   End If
    ThisWorkbook.Worksheets("TempRP").Activate
    ActiveCell.Offset(1, 0).Select
  Loop
End Sub

Sub DNIOAdd(StockDate As Date, DNNo As String)
Dim StockQty As Double, SubTotal As Double, QtyTotal As Double, I As Long
Dim AddQty As Double, AddAmt As Double, QtySum As Double, AmtSum As Double, AssetNo As String
If ThisWorkbook.Worksheets("NewCOm").Range("A10").Value <> "IOAdd" Then
  Call ReturnToMainMenu("")
  Exit Sub
End If
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("C105").Select
  Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 12).Value <> "" Then
     StockNo = ActiveCell.Offset(0, 12).Value
     QtyTotal = ActiveCell.Offset(0, 3).Value
     SubTotal = ActiveCell.Offset(0, 6).Value
     Do While ActiveCell.Offset(1, 12).Value = StockNo
       QtyTotal = QtyTotal + ActiveCell.Offset(1, 3).Value
       SubTotal = SubTotal + ActiveCell.Offset(1, 6).Value
       ActiveCell.EntireRow.Delete
     Loop
     QtyTotal = Format(QtyTotal, "0.0000")
     SubTotal = Format(SubTotal, "0.00")
     If QtyTotal <> 0 Or SubTotal <> 0 Then
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
        I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        MyBook.Worksheets("StockRec").Cells(I, 8).Value = Format(StockQty - QtyTotal, "0.0000")
        If Abs(SubTotal) > 0.001 Then MyBook.Worksheets("StockRec").Cells(I, 9).Value = Format(MyBook.Worksheets("StockRec").Cells(I, 9).Value - SubTotal, "0.00")
        If MyBook.Worksheets("StockRec").Cells(I, 8).Value <> 0 Then _
           MyBook.Worksheets("StockRec").Cells(I, 10).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value / MyBook.Worksheets("StockRec").Cells(I, 8).Value
         If MyBook.Worksheets("StockRec").Cells(I, 1).Value < InvDate Then MyBook.Worksheets("StockRec").Cells(I, 1).Value = InvDate
         AddQty = QtyTotal * (-1)
         AddAmt = SubTotal * (-1)
         QtySum = MyBook.Worksheets("StockRec").Cells(I, 8).Value
         AmtSum = MyBook.Worksheets("StockRec").Cells(I, 9).Value
         AssetNo = MyBook.Worksheets("StockRec").Cells(I, 5).Value
         If QtyTotal <> 0 Or SubTotal <> 0 Then
          Call InvIOAdd(AddQty, AddAmt, StockDate, QtySum, AmtSum, AssetNo)
          Call IOUpdate(QtyTotal, SubTotal, DNNo, StockDate, "D", StockQty)
         End If
        End If
     End If
    End If
    ThisWorkbook.Worksheets("TempRP").Activate
    ActiveCell.Offset(1, 0).Select
  Loop
End Sub

Sub InvStockAdd(AssetAcctNo As String, ProdDes As String)
Dim TtlSheet As Long, J As Long, K As Long, LastInvRow As Long, CheckRange As Range, ShName As String
 MyBook.Worksheets("InvDetail1").Activate
 TtlSheet = Range("B1").Value
 If Range("A3").Value <> "" Then
   Range("A1").End(xlDown).Select
   LastInvRow = ActiveCell.Row
   Set CheckRange = Range(Cells(3, 1), Cells(LastInvRow, 1))
   If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then GoTo ReStateStock
 Else
   LastInvRow = 2
 End If
  MyBook.Worksheets("InvDetail1").Activate
  Range(Cells(LastInvRow + 1, 1), Cells(LastInvRow + 2, 2)).NumberFormat = "@"
  Range(Cells(LastInvRow + 1, 3), Cells(LastInvRow + 2, 7)).NumberFormat = "General"
  Cells(LastInvRow + 1, 1).Select
  ActiveCell.Value = StockNo
  ActiveCell.Offset(1, 0).Value = StockNo
  ActiveCell.Offset(0, 1).Value = ProdDes
  ActiveCell.Offset(1, 1).Value = ProdDes
  ActiveCell.Offset(0, 2).Value = 1
  ActiveCell.Offset(1, 2).Value = 2
  ActiveCell.Offset(0, 3).ClearContents
  ActiveCell.Offset(1, 3).ClearContents
  ActiveCell.Offset(0, 4).Value = AssetAcctNo
  ActiveCell.Offset(1, 4).Value = AssetAcctNo
  ActiveCell.Offset(0, 5).ClearContents
  ActiveCell.Offset(1, 5).ClearContents
 If TtlSheet > 1 Then
   Set CheckRange = Range(Cells(LastInvRow + 1, 1), Cells(LastInvRow + 2, 7))
   CheckRange.Copy
   For J = 2 To TtlSheet
    ShName = "InvDetail" & J
    MyBook.Worksheets(ShName).Activate
    Range("A1").End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
    ActiveSheet.Paste
   Next J
 End If
  Application.CutCopyMode = False
  Exit Sub
ReStateStock:
   For J = 1 To TtlSheet
    ShName = "InvDetail" & J
    MyBook.Worksheets(ShName).Activate
    Set CheckRange = Range(Cells(3, 1), Cells(LastInvRow, 1))
    If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
      K = Application.Match(StockNo, CheckRange, 0) + 2
      Range(Cells(K, 2), Cells(K + 1, 2)).NumberFormat = "@"
      Range(Cells(K, 4), Cells(K + 1, 7)).NumberFormat = "General"
      Cells(K, 1).Select
      ActiveCell.Offset(0, 1).Value = ProdDes
      ActiveCell.Offset(1, 1).Value = ProdDes
      ActiveCell.Offset(0, 3).ClearContents
      ActiveCell.Offset(1, 3).ClearContents
      ActiveCell.Offset(0, 4).Value = AssetAcctNo
      ActiveCell.Offset(1, 4).Value = AssetAcctNo
      ActiveCell.Offset(0, 5).ClearContents
      ActiveCell.Offset(1, 5).ClearContents
    End If
   Next J
End Sub

Sub InvStockUpdate(StockQty As Double, StockAmount As Double, AssetAcctNo As String, ProdDes As String)
Dim I As Long, LastInvRow As Long, CheckRange As Range
 MyBook.Worksheets("InvDetail1").Activate
 If Range("A3").Value <> "" Then
  Range("A1").End(xlDown).Select
  LastInvRow = ActiveCell.Row
  Set CheckRange = Range(Cells(3, 1), Cells(LastInvRow, 1))
  If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then GoTo AddRecord
 End If
  Call InvStockAdd(AssetAcctNo, ProdDes)
  MyBook.Worksheets("InvDetail1").Activate
  Range("A1").End(xlDown).Select
  LastInvRow = ActiveCell.Row
  Set CheckRange = Range(Cells(3, 1), Cells(LastInvRow, 1))
AddRecord:
 I = Application.Match(StockNo, CheckRange, 0) + 2
 Range(Cells(I, 2), Cells(I + 1, 2)).NumberFormat = "@"
 Range(Cells(I, 2), Cells(I + 1, 2)).Value = ProdDes
 Range(Cells(I, 5), Cells(I + 1, 7)).NumberFormat = "General"
 Range(Cells(I, 5), Cells(I + 1, 5)).Value = AssetAcctNo
 Cells(I, 7).Value = StockQty * (-1)
 Cells(I + 1, 7).Value = StockAmount * (-1)
End Sub

Sub InvIOAdd(AddQty As Double, AddAmount As Double, AddDate As Date, QtySum As Double, AmtSum As Double, AssetNo As String)
Dim TtlSheet As Long, I As Long, DataSheet As Long, ColumnNo As Long, AddColumn As Long, CheckRange As Range
Dim LastInvRow As Long, ShName As String, ShNameNext As String, TestDate As Long, ProdDes As String
AddStock:
MyBook.Worksheets("InvDetail1").Activate
TtlSheet = Range("B1").Value
If IsError(Application.Match(StockNo, Columns("A"), 0)) = True Then
 If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
   ProdDes = MyBook.Worksheets("StockRec").Cells(I, 3).Value
   Call InvStockAdd(AssetNo, ProdDes)
 Else
   Call InvStockAdd(AssetNo, "")
 End If
End If
 For I = 1 To TtlSheet
  ShName = "InvDetail" & I
  MyBook.Worksheets(ShName).Activate
  If Range("A3").Value <> "" Then
   ActiveSheet.UsedRange.Select
   Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End If
 Next I
 MyBook.Worksheets("InvDetail1").Activate
 For I = 1 To TtlSheet
  ShName = "InvDetail" & I
  MyBook.Worksheets(ShName).Activate
  If Range("H2").Value = "" Then
    AddColumn = 8
    DataSheet = I
    GoTo ColumnOK
  ElseIf Range("H2").Value = AddDate Then
    AddColumn = 8
    DataSheet = I
    GoTo ColumnOK
  ElseIf Range("H2").Value < AddDate Then
    Range("H2").EntireColumn.Insert
    AddColumn = 8
    DataSheet = I
    GoTo ColumnOK
  End If
   Range("E2").End(xlToRight).Select
   ColumnNo = ActiveCell.Column
   If ActiveCell.Value = AddDate Then
     AddColumn = ColumnNo
     DataSheet = I
     GoTo ColumnOK
   ElseIf ActiveCell.Value > AddDate Then
     AddColumn = ColumnNo + 1
     DataSheet = I
   Else
    Set CheckRange = Range(Cells(2, 8), Cells(2, ColumnNo))
    TestDate = CDate(AddDate)
    AddColumn = Application.Match(TestDate, CheckRange, -1) + 7
    If Cells(2, AddColumn).Value = AddDate Then
     DataSheet = I
     GoTo ColumnOK
    Else
     AddColumn = AddColumn + 1
     Cells(2, AddColumn).EntireColumn.Insert
     DataSheet = I
     GoTo ColumnOK
    End If
   End If
NextLoop:
 Next I
ColumnOK:
 MyBook.Worksheets("InvDetail1").Activate
 Range("A1").End(xlDown).Select
 LastInvRow = ActiveCell.Row
 Set CheckRange = Range(Cells(3, 1), Cells(LastInvRow, 1))
  I = Application.Match(StockNo, CheckRange, 0) + 2
  Cells(I, 7).Value = QtySum * (-1)
  Cells(I + 1, 7).Value = AmtSum * (-1)
 ShName = "InvDetail" & DataSheet
 MyBook.Worksheets(ShName).Activate
  Cells(I, AddColumn).Value = Format(Cells(I, AddColumn).Value + AddQty, "0.0000")
  Cells(I + 1, AddColumn).Value = Format(Cells(I + 1, AddColumn).Value + AddAmount, "0.00")
  Cells(2, AddColumn).NumberFormat = "yyyy/mm/dd"
  Cells(2, AddColumn).Value = AddDate
 Range("E2").End(xlToRight).Select
 ColumnNo = ActiveCell.Column
 I = DataSheet
 Do While ActiveSheet.Columns.Count - ColumnNo < 5
  If TtlSheet > I Then
   ShName = "InvDetail" & I
   ShNameNext = "InvDetail" & I + 1
   MyBook.Worksheets(ShNameNext).Activate
   Range("H1").EntireColumn.Insert
   Range("H1").Select
   MyBook.Worksheets(ShName).Columns(ColumnNo).Cut
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("E2").End(xlToRight).Select
   ColumnNo = ActiveCell.Column
  Else
   Application.DisplayAlerts = False
   ShName = "InvDetail" & I
   ShNameNext = "InvDetail" & TtlSheet + 1
   MyBook.Sheets.Add After:=Worksheets(ShName)
   ActiveSheet.Name = ShNameNext
   ActiveSheet.Visible = xlSheetVeryHidden
   Application.DisplayAlerts = True
   MyBook.Worksheets("InvDetail1").Activate
   Range("B1").Value = Range("B1").Value + 1
   Columns("A:G").Copy
   MyBook.Worksheets(ShNameNext).Activate
   Range("A1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("H1").Select
   MyBook.Worksheets(ShName).Columns(ColumnNo).Cut
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("B1").Value = TtlSheet + 1
   Exit Sub
  End If
  I = I + 1
 Loop
End Sub
Sub PODelRecord(RunCode As String)
Dim I As Long, J As Long, K As Long, CheckRange As Range
 If RunCode <> "DelRecord" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("M1").Select
    ThisWorkbook.Worksheets("Report").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A10").Value = "PO #"
    Range("A11").Value = "----------------------"
    Range("B10").Value = "PO Date"
    Range("B11").Value = "--------------------"
    Range("C10").Value = " Part #  "
    Range("C11").Value = "-----------------------------"
    Range("D10").Value = " Part Description"
    Range("D11").Value = "-----------------------------------------------------------------------"
    Range("E9").Value = " Order "
    Range("E10").Value = " Quantity "
    Range("E11").Value = "-------------------"
    Range("F9").Value = " Unit Price "
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "---------------------"
    Range("G9").Value = " % "
    Range("G10").Value = "Discount"
    Range("G11").Value = "-------------"
    Range("H9").Value = " Amount "
    Range("H10").Value = "(" & SysCurrency & ")  "
    Range("H11").Value = "---------------------"
    Columns("A").ColumnWidth = 16
    Columns("B").ColumnWidth = 13
    Columns("C").ColumnWidth = 20
    Columns("D").ColumnWidth = 45
    Columns("E:F").ColumnWidth = 15
    Columns("G").ColumnWidth = 9
    Columns("H").ColumnWidth = 15
    Columns("A").HorizontalAlignment = xlLeft
    Columns("B").HorizontalAlignment = xlCenter
    Columns("C:D").HorizontalAlignment = xlLeft
    Columns("E").HorizontalAlignment = xlCenter
    Columns("F").HorizontalAlignment = xlRight
    Columns("G").HorizontalAlignment = xlCenter
    Columns("H").HorizontalAlignment = xlRight
    Columns("A").NumberFormat = "@"
    Columns("B").NumberFormat = "yyyy/mm/dd"
    Columns("C:D").NumberFormat = "@"
    Columns("F").NumberFormat = "#,##0.0000"
    Columns("G").NumberFormat = "@"
    Columns("H").NumberFormat = "#,##0.00"
    Columns("C:D").ShrinkToFit = True
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("C1:E8").HorizontalAlignment = xlCenterAcrossSelection
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
  On Error GoTo ErrorHandling
   MyBook.Worksheets("PORecord").Activate
  If Range("B4").Value = "" Then GoTo NoPO
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlDescending, Key2:=Range("B1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    I = Selection.Rows.Count + 3
   Set CheckRange = ActiveSheet.Range(Cells(4, 2), Cells(I, 2))
  If IsError(Application.Match(PONo, CheckRange, 0)) Then GoTo NoPO
  I = Application.Match(PONo, CheckRange, 0) + 3
  Range(Cells(I, 1), Cells(I, 214)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Columns("A").NumberFormat = "@"
  Columns("C:D").NumberFormat = "@"
 Range("AB1").Select
   Cells(1, 1).Value = ActiveCell.Offset(0, 1).Value & "  (" & ActiveCell.Value & ")"
   I = 2
   J = ActiveCell.Offset(0, 14).Value
   K = 1
   Cells(I, 1).Value = ActiveCell.Offset(0, -14).Value
   Cells(I, 2).Value = ActiveCell.Offset(0, -12).Value
  Do While J > 0
   Cells(I, 3).Value = ActiveCell.Offset(0, 19 + K).Value
   Cells(I, 4).Value = ActiveCell.Offset(0, 19 + K + 1).Value
   Cells(I, 5).Value = ActiveCell.Offset(0, 19 + K + 2).Value
   If Cells(I, 5).Value = "" Then Cells(I, 5).Value = 0
   Cells(I, 6).Value = ActiveCell.Offset(0, 19 + K + 3).Value
   Cells(I, 7).Value = ActiveCell.Offset(0, 19 + K + 4).Value
   Cells(I, 8).Value = ActiveCell.Offset(0, 19 + K + 5).Value
   If Cells(I, 8).Value = "" Then Cells(I, 8).Value = 0
   I = I + 1
   J = J - 1
   K = K + 9
  Loop
  Cells(I + 1, 1).Value = "Payment Term : " & ActiveCell.Offset(0, -1).Value
  Cells(I + 2, 1).Value = "Required Delivery : " & Format(ActiveCell.Offset(0, 17).Value, "yyyy/mm/dd")
  Cells(I + 2, 7).Value = " Total :"
  Cells(I + 2, 8).Value = ActiveCell.Offset(0, 16).Value
   Cells(I + 5, 1).Value = "Parts Receiving Detail : --- "
   I = I + 7
  Range("M1").Select
   Worksheets("Report").Activate
    Cells(I + 9, 1).Font.Bold = True
    Range(Cells(I + 7, 1), Cells(I + 7, 8)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
   MyBook.Worksheets("Payable").Activate
  If Range("E4").Value = "" Then GoTo NoDel
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlDescending, Key2:=Range("B1"), Order2:=xlAscending, Key3:=Range("D1"), Order3:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  J = Selection.Rows.Count + 3
  Set CheckRange = ActiveSheet.Range(Cells(4, 2), Cells(J, 2))
  If IsError(Application.Match(PONo, CheckRange, 0)) Then GoTo NoDel
  J = Application.Match(PONo, CheckRange, 0) + 3
  K = Application.Match(PONo, CheckRange, 1) + 3
  If Cells(J, 1).Value <> "PO" Then GoTo NoDel
  If Cells(K, 1).Value <> "PO" Then
    Do While K > J
     If Cells(K, 1).Value = "PO" Then Exit Do
     K = K - 1
    Loop
  End If
  Range(Cells(J, 1), Cells(K, 164)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
    Cells(I, 1).Value = "Supplier Inv #"
    Cells(I + 1, 1).Value = "------------------"
    Cells(I, 2).Value = " Date Rec'd"
    Cells(I + 1, 2).Value = "--------------------"
    Cells(I, 3).Value = " Part #  "
    Cells(I + 1, 3).Value = "--------------------------"
    Cells(I, 4).Value = " Part Description"
    Cells(I + 1, 4).Value = "-----------------------------------------------------------------------"
    Cells(I - 1, 5).Value = " Ouantity "
    Cells(I, 5).Value = " Received"
    Cells(I + 1, 5).Value = "-------------------"
    Cells(I - 1, 8).Value = " Discounted   "
    Cells(I, 8).Value = "Value (" & SysCurrency & ")"
    Cells(I + 1, 8).Value = "---------------------"
    I = I + 3
 Range("N1").Select
 Do While ActiveCell.Value <> ""
  J = ActiveCell.Offset(0, 22).Value
  K = 24
  Cells(I, 2).Value = ActiveCell.Offset(0, 2).Value
  Cells(I, 1).Value = ActiveCell.Offset(0, 21).Value
  Do While J > 0
    Cells(I, 3).Value = ActiveCell.Offset(0, K).Value
    Cells(I, 4).Value = ActiveCell.Offset(0, K + 1).Value
    Cells(I, 5).Value = ActiveCell.Offset(0, K + 2).Value
    Cells(I, 8).Value = ActiveCell.Offset(0, K + 5).Value
    I = I + 1
    J = J - 1
    K = K + 7
  Loop
  I = I + 2
  ActiveCell.Offset(1, 0).Select
 Loop
   Columns("M:FU").Delete
NoDel:
  ThisWorkbook.Worksheets("TempRP").Activate
  Range(Cells(1, 1), Cells(I, 8)).Copy
  Worksheets("Report").Activate
  Range("A12").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
       False, Transpose:=False
   Application.CutCopyMode = False
    If Cells(I + 9, 1).Value = "Parts Receiving Detail : --- " Then Cells(I + 11, 4).Value = " No Record of Parts Receiving for the specified PO "
NoPO:
   ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A8").Font.Bold = True
    Range("A8").Value = " PO Detail : --- "
    Range("C6").Value = "Detail Receiving Report for PO # " & PONo
    Range("A1:H15").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
   If Range("A12").Value = "" Then
    Range("D13").ShrinkToFit = False
    Range("D13").Value = Range("D13").Value = " The specified PO is not found from the record. "
   End If
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
       End With
     Selection.RowHeight = 18
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
  On Error GoTo ErrorHandling
  Unload UserForm22
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
 Exit Sub
ErrorHandling:
   Unload UserForm22
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "Probably the Data file is lack of space.")
End Sub
Sub POListing(RunCode As String, StartDate As Date, EndDate As Date)
Dim POAmt As Double, I As Long, J As Long, K As Long
If RunCode <> "PO" And RunCode <> "Supplier" Then
  Call ReturnToMainMenu("")
  Exit Sub
 End If
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("M1").Select
    ThisWorkbook.Worksheets("Report").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
    Range("A10").Value = "PO #"
    Range("A11").Value = "-----------------------"
    Range("B10").Value = "PO Date"
    Range("B11").Value = "-----------------"
    Range("C10").Value = " Part #  "
    Range("C11").Value = "------------------------"
    Range("D10").Value = " Part Description"
    Range("D11").Value = "-----------------------------------------------------------------------"
    Range("E9").Value = " Order "
    Range("E10").Value = " Quantity "
    Range("E11").Value = "-------------------"
    Range("F9").Value = " Unit Price "
    Range("F10").Value = "(" & SysCurrency & ")  "
    Range("F11").Value = "---------------------"
    Range("G9").Value = " % "
    Range("G10").Value = "Discount"
    Range("G11").Value = "-------------"
    Range("H9").Value = " Amount "
    Range("H10").Value = "(" & SysCurrency & ")  "
    Range("H11").Value = "---------------------"
    Columns("A").ColumnWidth = 16
    Columns("B").ColumnWidth = 13
    Columns("C").ColumnWidth = 20
    Columns("D").ColumnWidth = 45
    Columns("E:F").ColumnWidth = 15
    Columns("G").ColumnWidth = 9
    Columns("H").ColumnWidth = 15
    Columns("A").HorizontalAlignment = xlLeft
    Columns("B").HorizontalAlignment = xlCenter
    Columns("C:D").HorizontalAlignment = xlLeft
    Columns("E").HorizontalAlignment = xlCenter
    Columns("F").HorizontalAlignment = xlRight
    Columns("G").HorizontalAlignment = xlCenter
    Columns("H").HorizontalAlignment = xlRight
    Columns("A").NumberFormat = "@"
    Columns("B").NumberFormat = "yyyy/mm/dd"
    Columns("C:D").NumberFormat = "@"
    Columns("F").NumberFormat = "#,##0.0000"
    Columns("G").NumberFormat = "@"
    Columns("H").NumberFormat = "#,##0.00"
    Columns("C:D").ShrinkToFit = True
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("C1:E8").HorizontalAlignment = xlCenterAcrossSelection
    Range("C1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("C2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("C3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("C4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
  On Error GoTo ErrorHandling
   MyBook.Worksheets("PORecord").Activate
  If Range("B4").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3).Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("D4").Select
  I = 4
  If ActiveCell.Value < StartDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value < StartDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
   I = ActiveCell.Row
  End If
 If ActiveCell.Value <= EndDate And ActiveCell.Value <> "" Then
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(30, 0).Select
     Loop
    If ActiveCell.Row > 33 Then ActiveCell.Offset(-29, 0).Select
     Do While ActiveCell.Value <= EndDate And ActiveCell.Value <> ""
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
      J = ActiveCell.Row - 1
 If J < I Then GoTo Finish
  Range(Cells(I, 1), Cells(J, 214)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Selection.Sort Key1:=Range("M1"), Order1:=xlDescending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 If RunCode = "PO" Then
    Selection.Sort Key1:=Range("M1"), Order1:=xlDescending, Key2:=Range("N1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Else
   Selection.Sort Key1:=Range("AB1"), Order1:=xlAscending, Key2:=Range("M1"), Order2:=xlDescending, Key3:=Range("N1"), Order3:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 End If
  Columns("A").NumberFormat = "@"
  Columns("C:D").NumberFormat = "@"
 Range("AB1").Select
 I = 1
 K = 1
 POAmt = 0
 Do While ActiveCell.Value <> ""
   Cells(I, 1).Value = ActiveCell.Offset(0, 1).Value & "  (" & ActiveCell.Value & ")"
   I = I + 1
   J = ActiveCell.Offset(0, 14).Value
   Cells(I, 1).Value = ActiveCell.Offset(0, -14).Value
   Cells(I, 2).Value = ActiveCell.Offset(0, -12).Value
  Do While J > 0
   Cells(I, 3).Value = ActiveCell.Offset(0, 19 + K).Value
   Cells(I, 4).Value = ActiveCell.Offset(0, 19 + K + 1).Value
   Cells(I, 5).Value = ActiveCell.Offset(0, 19 + K + 2).Value
   If Cells(I, 5).Value = "" Then Cells(I, 5).Value = 0
   Cells(I, 6).Value = ActiveCell.Offset(0, 19 + K + 3).Value
   Cells(I, 7).Value = ActiveCell.Offset(0, 19 + K + 4).Value
   Cells(I, 8).Value = ActiveCell.Offset(0, 19 + K + 5).Value
   If Cells(I, 8).Value = "" Then Cells(I, 8).Value = 0
   I = I + 1
   J = J - 1
   K = K + 9
  Loop
  Cells(I + 1, 1).Value = "Payment Term : " & ActiveCell.Offset(0, -1).Value
  Cells(I + 2, 1).Value = "Required Delivery : " & Format(ActiveCell.Offset(0, 17).Value, "yyyy/mm/dd")
  Cells(I + 2, 7).Value = " Total :"
  Cells(I + 2, 8).Value = ActiveCell.Offset(0, 16).Value
  POAmt = POAmt + Cells(I + 2, 8).Value
   Worksheets("Report").Activate
    Range(Cells(I + 14, 1), Cells(I + 14, 8)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  Worksheets("TempRP").Activate
  K = 1
  I = I + 4
  ActiveCell.Offset(1, 0).Select
 Loop
  Cells(I, 7).Value = " Grand Total :"
  Cells(I, 8).Value = POAmt
  Range(Cells(1, 1), Cells(I, 8)).Copy
  Worksheets("Report").Activate
  Range("A12").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
       False, Transpose:=False
   Application.CutCopyMode = False
Finish:
   ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    Range("A6").Value = "From : " & Format(StartDate, "yyyy/mm/dd")
    Range("A7").Value = "    To : " & Format(EndDate, "yyyy/mm/dd")
    If RunCode = "PO" Then
      Range("C6").Value = "Detail Listing of POs and Debit Notes --- Sorted by PO # and Debit Note #"
     Else
      Range("C6").Value = "Detail Listing of POs and Debit Notes --- Sorted by Supplier #"
     End If
    Range("A1:H15").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
   If Range("A12").Value = "" Then
    Range("D13").ShrinkToFit = False
    Range("D13").Value = " No Record of POs and Debit Notes for the period selected. "
   End If
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
   On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
  On Error GoTo ErrorHandling
  Unload UserForm22
  SheetName = "Report"
  OldForm = "UserForm8"
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
 Exit Sub
ErrorHandling:
   Unload UserForm22
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "Probably the Data file is lack of space.")
End Sub

Sub InvPageLayout(RunCode As String)
Dim J As Long, K As Long, FontName As String, FontType As String, FontSize As Double
 If RunCode <> "Invoice" Then
   Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("Invoice").Activate
   On Error Resume Next
  If MyBook.Worksheets("ComData").Range("C4").Value = "" Then
    Range("A1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    If MyBook.Worksheets("ComData").Range("G1").Value <> "" Then
      FontName = MyBook.Worksheets("ComData").Range("G1").Value
      FontType = MyBook.Worksheets("ComData").Range("H1").Value
      FontSize = MyBook.Worksheets("ComData").Range("I1").Value
      J = Len(MyBook.Worksheets("ComData").Range("B2").Value)
      K = Len(MyBook.Worksheets("ComData").Range("C4").Value)
     With Range("A1").Font
        .Name = FontName
        .FontStyle = FontType
        .Size = FontSize
     End With
    End If
  Else
    Range("A1").Value = MyBook.Worksheets("ComData").Range("B2").Value & Chr(10) & MyBook.Worksheets("ComData").Range("C4").Value
    If MyBook.Worksheets("ComData").Range("G1").Value <> "" Then
      FontName = MyBook.Worksheets("ComData").Range("G1").Value
      FontType = MyBook.Worksheets("ComData").Range("H1").Value
      FontSize = MyBook.Worksheets("ComData").Range("I1").Value
      J = Len(MyBook.Worksheets("ComData").Range("B2").Value)
      K = Len(MyBook.Worksheets("ComData").Range("C4").Value)
     With Range("A1").Characters(Start:=1, Length:=J).Font
        .Name = FontName
        .FontStyle = FontType
        .Size = FontSize
     End With
     If MyBook.Worksheets("ComData").Range("G2").Value <> "" Then
       FontName = MyBook.Worksheets("ComData").Range("G2").Value
       FontType = MyBook.Worksheets("ComData").Range("H2").Value
       FontSize = MyBook.Worksheets("ComData").Range("I2").Value
     End If
     With Range("A1").Characters(Start:=J + 2, Length:=K).Font
        .Name = FontName
        .FontStyle = FontType
        .Size = FontSize
     End With
    End If
  End If
    If MyBook.Worksheets("ComData").Range("C3").Value <> "" Then
     PicLocation = MyBook.Worksheets("ComData").Range("C3")
     If Dir(PicLocation) <> "" Then
      Set Sh = ActiveSheet.Shapes.AddPicture( _
      FileName:=PicLocation, _
      LinkToFile:=msoFalse, _
      SaveWithDocument:=msoTrue, _
      Left:=0, _
      Top:=0, _
      Height:=100, _
      Width:=500)
      Sh.ScaleHeight Factor:=1, RelativeToOriginalSize:=msoTrue
      Sh.ScaleWidth Factor:=1, RelativeToOriginalSize:=msoTrue
      Sh.LockAspectRatio = msoFalse
      PicZoom = 74 / Sh.Height
      Sh.ScaleHeight PicZoom, msoTrue, msoScaleFromTopLeft
      Sh.ScaleWidth PicZoom, msoTrue, msoScaleFromTopLeft
     End If
    End If
   On Error GoTo NoPrinter
   With ActiveSheet.PageSetup
        .PrintTitleRows = "$1:$1"
    If MyBook.Worksheets("ComData").Range("K1").Value <> "" Then
      .PaperSize = MyBook.Worksheets("ComData").Range("K1").Value
      .Orientation = MyBook.Worksheets("ComData").Range("L1").Value
      .Zoom = MyBook.Worksheets("ComData").Range("M1").Value
      .LeftMargin = MyBook.Worksheets("ComData").Range("N1").Value
      .RightMargin = MyBook.Worksheets("ComData").Range("O1").Value
      .TopMargin = MyBook.Worksheets("ComData").Range("P1").Value
      .BottomMargin = MyBook.Worksheets("ComData").Range("Q1").Value
      .HeaderMargin = MyBook.Worksheets("ComData").Range("R1").Value
      .FooterMargin = MyBook.Worksheets("ComData").Range("S1").Value
      .CenterFooter = "&""Courier New""&11" & MyBook.Worksheets("ComData").Range("C1") & Chr(13) & MyBook.Worksheets("ComData").Range("C2")
    Else
        .RightMargin = Application.InchesToPoints(0.35)
        .FooterMargin = Application.InchesToPoints(0.35)
        .CenterFooter = "&""Courier New""&11" & MyBook.Worksheets("ComData").Range("C1") & Chr(13) & MyBook.Worksheets("ComData").Range("C2")
        .Orientation = xlPortrait
     If .PaperSize = xlPaperA4 Then
        .LeftMargin = Application.InchesToPoints(0.75)
        .TopMargin = Application.InchesToPoints(0.55)
        .BottomMargin = Application.InchesToPoints(0.866)
        .Zoom = 90
     ElseIf .PaperSize = xlPaperLetter Then
        .LeftMargin = Application.InchesToPoints(0.95)
        .TopMargin = Application.InchesToPoints(0.59)
        .BottomMargin = Application.InchesToPoints(0.866)
        .Zoom = 84
     Else
        .LeftMargin = Application.InchesToPoints(0.75)
     End If
    End If
   End With
NoPrinter:
End Sub

Sub POPageLayout(RunCode As String)
Dim J As Long, K As Long, FontName As String, FontType As String, FontSize As Double
 If RunCode <> "PO" Then
   Call ReturnToMainMenu("")
  Exit Sub
 End If
 ThisWorkbook.Worksheets("PO").Activate
    On Error Resume Next
  If MyBook.Worksheets("ComData").Range("C4").Value = "" Then
    Range("A1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    If MyBook.Worksheets("ComData").Range("G1").Value <> "" Then
      FontName = MyBook.Worksheets("ComData").Range("G1").Value
      FontType = MyBook.Worksheets("ComData").Range("H1").Value
      FontSize = MyBook.Worksheets("ComData").Range("I1").Value
      J = Len(MyBook.Worksheets("ComData").Range("B2").Value)
      K = Len(MyBook.Worksheets("ComData").Range("C4").Value)
     With Range("A1").Font
        .Name = FontName
        .FontStyle = FontType
        .Size = FontSize
     End With
    End If
  Else
    Range("A1").Value = MyBook.Worksheets("ComData").Range("B2").Value & Chr(10) & MyBook.Worksheets("ComData").Range("C4").Value
    If MyBook.Worksheets("ComData").Range("G1").Value <> "" Then
      FontName = MyBook.Worksheets("ComData").Range("G1").Value
      FontType = MyBook.Worksheets("ComData").Range("H1").Value
      FontSize = MyBook.Worksheets("ComData").Range("I1").Value
      J = Len(MyBook.Worksheets("ComData").Range("B2").Value)
      K = Len(MyBook.Worksheets("ComData").Range("C4").Value)
     With Range("A1").Characters(Start:=1, Length:=J).Font
        .Name = FontName
        .FontStyle = FontType
        .Size = FontSize
     End With
     If MyBook.Worksheets("ComData").Range("G2").Value <> "" Then
       FontName = MyBook.Worksheets("ComData").Range("G2").Value
       FontType = MyBook.Worksheets("ComData").Range("H2").Value
       FontSize = MyBook.Worksheets("ComData").Range("I2").Value
     End If
     With Range("A1").Characters(Start:=J + 2, Length:=K).Font
        .Name = FontName
        .FontStyle = FontType
        .Size = FontSize
     End With
    End If
  End If
    If MyBook.Worksheets("ComData").Range("C3").Value <> "" Then
     PicLocation = MyBook.Worksheets("ComData").Range("C3")
     If Dir(PicLocation) <> "" Then
      Set Sh = ActiveSheet.Shapes.AddPicture( _
      FileName:=PicLocation, _
      LinkToFile:=msoFalse, _
      SaveWithDocument:=msoTrue, _
      Left:=0, _
      Top:=0, _
      Height:=100, _
      Width:=500)
      Sh.ScaleHeight Factor:=1, RelativeToOriginalSize:=msoTrue
      Sh.ScaleWidth Factor:=1, RelativeToOriginalSize:=msoTrue
      Sh.LockAspectRatio = msoFalse
      PicZoom = 74 / Sh.Height
      Sh.ScaleHeight PicZoom, msoTrue, msoScaleFromTopLeft
      Sh.ScaleWidth PicZoom, msoTrue, msoScaleFromTopLeft
     End If
    End If
  On Error GoTo NoPrinter
   With ActiveSheet.PageSetup
      .PrintTitleRows = "$1:$1"
    If MyBook.Worksheets("ComData").Range("K2").Value <> "" Then
      .PaperSize = MyBook.Worksheets("ComData").Range("K2").Value
      .Orientation = MyBook.Worksheets("ComData").Range("L2").Value
      .Zoom = MyBook.Worksheets("ComData").Range("M2").Value
      .LeftMargin = MyBook.Worksheets("ComData").Range("N2").Value
      .RightMargin = MyBook.Worksheets("ComData").Range("O2").Value
      .TopMargin = MyBook.Worksheets("ComData").Range("P2").Value
      .BottomMargin = MyBook.Worksheets("ComData").Range("Q2").Value
      .HeaderMargin = MyBook.Worksheets("ComData").Range("R2").Value
      .FooterMargin = MyBook.Worksheets("ComData").Range("S2").Value
      .CenterFooter = "&""Courier New""&11" & MyBook.Worksheets("ComData").Range("C1") & Chr(13) & MyBook.Worksheets("ComData").Range("C2")
    Else
        .RightMargin = Application.InchesToPoints(0.35)
        .TopMargin = Application.InchesToPoints(0.66)
        .BottomMargin = Application.InchesToPoints(0.866)
        .FooterMargin = Application.InchesToPoints(0.35)
        .CenterFooter = "&""Courier New""&11" & MyBook.Worksheets("ComData").Range("C1") & Chr(13) & MyBook.Worksheets("ComData").Range("C2")
        .Orientation = xlPortrait
     If .PaperSize = xlPaperA4 Then
        .LeftMargin = Application.InchesToPoints(0.55)
        .Zoom = 85
     ElseIf .PaperSize = xlPaperLetter Then
        .LeftMargin = Application.InchesToPoints(0.87)
        .TopMargin = Application.InchesToPoints(0.709)
        .Zoom = 79
     Else
        .LeftMargin = Application.InchesToPoints(0.55)
     End If
    End If
   End With
NoPrinter:
End Sub

Sub DateConvert(DateString As String)
Dim A As String
If IsDate(DateString) = True Then Exit Sub
If IsNumeric(DateString) Then
 If Len(DateString) = 8 Then
   A = Left(DateString, 4) & "/" & Mid(DateString, 5, 2) & "/" & Right(DateString, 2)
   If IsDate(A) = True Then DateString = A
 End If
End If
End Sub
Sub CloseSysBook(RunCode As String)
    MsgBox ("WARNING !!!" & Chr(13) & Chr(13) & "    Excel Resources Problem, Some programs have halted    " & Chr(13) & _
         "    System needs to Re-start.   Please Click 'OK'    " & Chr(13) & _
     Chr(13) & "    The system will shut down and then restart immediately    ")
    If Not (MyBook.Worksheets("Raw Data").Range("B1").Value = "ReadOnly" Or MyBook.Worksheets("ComData").Range("B14").Value = "Year End File") Then MyBook.Save
    MyBook.Close (False)
    Application.OnTime Now + TimeValue("00:00:01"), "ESCToMainMenu"
    ThisWorkbook.Close (False)
End Sub


Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 3, 2, MSForms, CommandButton"
Attribute VB_Control = "CommandButton4, 4, 3, MSForms, CommandButton"
Attribute VB_Control = "CommandButton5, 5, 4, MSForms, CommandButton"
Attribute VB_Control = "CommandButton6, 6, 5, MSForms, CommandButton"
Attribute VB_Control = "CommandButton7, 7, 6, MSForms, CommandButton"
Attribute VB_Control = "CommandButton8, 8, 7, MSForms, CommandButton"
Attribute VB_Control = "CommandButton9, 9, 8, MSForms, CommandButton"
Attribute VB_Control = "CommandButton11, 14, 10, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 21, 13, MSForms, CommandButton"
Attribute VB_Control = "Label1, 19, 14, MSForms, Label"
Attribute VB_Control = "ComboBox1, 20, 15, MSForms, ComboBox"
Private Sub ComboBox1_Click()
Dim FileNo As String, EndNo As Long, F As Long, I  As Long, J As Long, FileOpenStatus As String
Dim myFSO As Object, DataFilePath As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 FileNo = ComboBox1.Text
 If FileNo = "Select Other Files" Then
   DExtn = ""
   If Range("C5").Value <> "" Then
     DataFilePath = Range("C5").Value
     Set myFSO = CreateObject("Scripting.FileSystemObject")
    If myFSO.FolderExists(DataFilePath) = True Then
      CreateObject("WScript.Shell").CurrentDirectory = DataFilePath
    Else
      ChDir ThisWorkbook.Path
    End If
   Else
     ChDir ThisWorkbook.Path
   End If
   If UCase(Right(ThisWorkbook.Name, 4)) = "XLSM" Then
    FileNo = Application.GetOpenFilename(",*.xls;*.xlsm")
    If UCase(FileNo) = "FALSE" Then
      ComboBox1.Text = Range("C4").Value
      Application.EnableEvents = True
      Exit Sub
    End If
    I = Len(FileNo)
    If I > 5 Then
      If Mid(FileNo, I - 4, 1) = "." Then DExtn = Right(FileNo, 5)
      If Mid(FileNo, I - 3, 1) = "." Then DExtn = Right(FileNo, 4)
    ElseIf I > 4 Then
      If Mid(FileNo, I - 3, 1) = "." Then DExtn = Right(FileNo, 4)
    Else
      MsgBox ("Wrong Data File Type")
      ComboBox1.Text = ""
      Range("C4").Value = ""
      Range("C5").Value = ""
      Application.EnableEvents = True
      Exit Sub
    End If
    If Not (UCase(DExtn) = ".XLSM" Or UCase(DExtn) = ".XLS") Then
      MsgBox ("Wrong Data File Type")
      ComboBox1.Text = ""
      Range("C4").Value = ""
      Range("C5").Value = ""
      Application.EnableEvents = True
      Exit Sub
    End If
    If UCase(DExtn) = ".XLS" Then
      DExtn = ".xls"
      FileNo = Left(FileNo, I - 4)
    ElseIf I > 5 Then
      DExtn = ".xlsm"
      FileNo = Left(FileNo, I - 5)
    End If
    Worksheets("ComFactSheet").Range("C18").Value = DExtn
   Else
    FileNo = Application.GetOpenFilename(",*.xls")
    If UCase(FileNo) = "FALSE" Then
      ComboBox1.Text = Range("C4").Value
      Application.EnableEvents = True
      Exit Sub
    End If
    I = Len(FileNo)
    If I > 4 Then
      If Mid(FileNo, I - 3, 1) = "." Then DExtn = Right(FileNo, 4)
    Else
      MsgBox ("Wrong Data File Type")
      ComboBox1.Text = ""
      Range("C4").Value = ""
      Range("C5").Value = ""
      Application.EnableEvents = True
      Exit Sub
    End If
    If UCase(DExtn) <> ".XLS" Then
      MsgBox ("Wrong Data File Type")
      ComboBox1.Text = ""
      Range("C4").Value = ""
      Range("C5").Value = ""
      Application.EnableEvents = True
      Exit Sub
    End If
      DExtn = ".xls"
      Worksheets("ComFactSheet").Range("C18").Value = DExtn
      FileNo = Left(FileNo, I - 4)
   End If
   I = Len(FileNo)
   J = I - 1
   Do While J > 0
    If Mid(FileNo, J, 1) = "\" Then
      Worksheets("ComFactSheet").Range("A18").Value = Left(FileNo, J)
      FileNo = Right(FileNo, I - J)
      Worksheets("ComFactSheet").Range("B18").Value = FileNo
     Exit Do
    End If
    J = J - 1
   Loop
  Range("C4").Value = FileNo
  Range("C5").Value = Worksheets("ComFactSheet").Range("A18").Value
  EventOff = True
  ComboBox1.Text = FileNo
  EventOff = False
 Else
  Range("C4").Value = FileNo
  Range("C5").Value = ""
 End If
 Application.ScreenUpdating = False
 
  FileOpenStatus = ""
Call ReFresh(FileOpenStatus)
Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
If MyBook Is Nothing Then
  Application.EnableEvents = True
 Exit Sub
End If
On Error Resume Next
 If FileOpenStatus = "New" Then Call FileOpenBkUp("")
Application.EnableEvents = True
End Sub
Private Sub ComboBox1_GotFocus()
If EventOff = True Then Exit Sub
Application.EnableEvents = False
 On Error Resume Next
 ThisWorkbook.ActiveSheet.Name = "System Menu"
 ThisWorkbook.Worksheets("System Menu").Activate
 Range("A1").Select
 Range("C4").Select
 On Error GoTo 0
 Application.EnableEvents = True
End Sub
Private Sub Combobox1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
 On Error Resume Next
 ThisWorkbook.ActiveSheet.Name = "System Menu"
 ThisWorkbook.Worksheets("System Menu").Activate
 Range("C4").Select
  Range("C4").Value = ComboBox1.Text
  On Error GoTo 0
 Application.EnableEvents = True
End Sub
Private Sub CommandButton1_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 ComboBox1.Activate
 If ThisWorkbook.Worksheets("ComFactSheet").Range("C16").Value = "Expired" Then Exit Sub
  EventOff = True
 Application.EnableEvents = False
Application.ScreenUpdating = False
 ActiveSheet.Name = "System Menu"
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
ThisWorkbook.Worksheets("System Menu").Activate
Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
If Date < BeginningDate Then
 If MyBook.Worksheets("ComData").Range("B7").Value = "Yes" Then
   MsgBox ("Error in the date setting of your computer." & Chr(13) & "Input is not allowed")
   Exit Sub
  End If
End If
If ThisWorkbook.Worksheets("ComFactSheet").Range("C2") <> "Yes" Then
   If (Date - MyBook.Worksheets("ComData").Range("B9").Value) > 90 Then
      MsgBox ("The Free Trial Period for the Data File has expired." & Chr(13) & "Data Entry is not allowed.")
      Exit Sub
   End If
End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  MsgBox ("It is a Year Ended file." & Chr(13) & "Data Entry is not allowed.")
  Exit Sub
 End If
If MyBook.Worksheets("ComData").Range("B7").Value <> "Yes" Then
  MsgBox ("The Initial account data has not been entered. " & Chr(13) & "Thus, Data Entry is NOT allowed." & Chr(13) & Chr(13) & "Please click the Company Data Button      " & Chr(13) & "to proceed set-up of the initial account data     ")
  Exit Sub
End If
EntryNo = 0
If FileStatus = "AlertEnd" Then
  MsgBox ("The Data File is FULL.  No more input is allowed." & Chr(13) & "Please proceed Year End Update first")
  Exit Sub
End If
If FileStatus = "ReadOnly" Then
  MsgBox ("The Data File is being used by another user.  No Data input is allowed.")
  Exit Sub
End If
BeginningDate = MyBook.Worksheets("Raw Data").Range("A1").Value
Worksheets("Data Entry").Visible = xlSheetVisible
Worksheets("System Menu").Visible = xlSheetVeryHidden
Worksheets("Data Entry").Activate
SheetName = "Data Entry"
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton11_Click()
Dim Myform As UserForm
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 ComboBox1.Activate
 Application.EnableEvents = False
 On Error Resume Next
 ActiveSheet.Name = "System Menu"
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = False
  Worksheets("NewCom").Range("A8").ClearContents
  For Each Myform In UserForms
   Unload Myform
    Application.EnableEvents = False
  Next
 Application.DisplayAlerts = False
If MyBook Is Nothing Then GoTo CloseFile
 MyBook.Activate
 If MyBook.Worksheets("Raw Data").Range("B1").Value = "ReadOnly" Or MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
   MyBook.Close (False)
 Else
  MyBook.Save
  MyBook.Close
End If
CloseFile:
 ThisWorkbook.Worksheets("System Menu").Activate
 If Worksheets("ComFactSheet").Range("A6").Value = Worksheets("Invoice").PageSetup.PaperSize And _
   Worksheets("ComFactSheet").Range("A7").Value = Worksheets("PO").PageSetup.PaperSize And _
   Worksheets("ComFactSheet").Range("A18").Value = Worksheets("ComFactSheet").Range("A17").Value And _
   Worksheets("ComFactSheet").Range("B18").Value = Worksheets("ComFactSheet").Range("B17").Value And _
   Worksheets("ComFactSheet").Range("C18").Value = Worksheets("ComFactSheet").Range("C17").Value Then
   ThisWorkbook.Saved = True
 Else
   Worksheets("ComFactSheet").Range("A6").Value = Worksheets("Invoice").PageSetup.PaperSize
   Worksheets("ComFactSheet").Range("A7").Value = Worksheets("PO").PageSetup.PaperSize
   Worksheets("ComFactSheet").Range("A17").Value = Worksheets("ComFactSheet").Range("A18").Value
   Worksheets("ComFactSheet").Range("B17").Value = Worksheets("ComFactSheet").Range("B18").Value
   Worksheets("ComFactSheet").Range("C17").Value = Worksheets("ComFactSheet").Range("C18").Value
   ThisWorkbook.Save
 End If
 Set MyBook = Nothing
 Application.Quit
End Sub
Private Sub CommandButton2_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ComboBox1.Activate
 If ThisWorkbook.Worksheets("ComFactSheet").Range("C16").Value = "Expired" Then Exit Sub
  EventOff = True
 Application.EnableEvents = False
ActiveSheet.Name = "System Menu"
Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
If Date < BeginningDate Then
 If MyBook.Worksheets("ComData").Range("B7").Value = "Yes" Then
  MsgBox ("Error in the date setting of your computer." & Chr(13) & "Input is not allowed")
  Exit Sub
 End If
End If
If ThisWorkbook.Worksheets("ComFactSheet").Range("C2") <> "Yes" Then
   If (Date - MyBook.Worksheets("ComData").Range("B9").Value) > 90 Then
      MsgBox ("The Free Trial Period for the Data File has expired." & Chr(13) & "Data Entry is not allowed.")
      Exit Sub
   End If
 End If
 If MyBook.Worksheets("ComData").Range("B7").Value <> "Yes" Then
  MsgBox ("The Initial account data has not been entered. " & Chr(13) & "Thus, Data Entry is NOT allowed." & Chr(13) & Chr(13) & "Please click the Company Data Button      " & Chr(13) & "to proceed set-up of the initial account data     ")
  Exit Sub
 End If
 If Right(Worksheets("ComFactSheet").Range("B16").Value, 2) <> "RP" Then
  MsgBox ("This system ( MMT Account-Basic ) does not support Sub-Ledger Accounting." & Chr(13) & Chr(13) & _
          "Upgrade to 'MMT Account-Business' if Sub-Ledger Accounting is desired")
  Exit Sub
 End If
On Error GoTo NoForm
UserForm8.Caption = "Sales, Purchases, Inventory Sub Ledger Accounting"
On Error GoTo 0
UserForm8.Show
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton3_Click()
Dim YearLastDate As Date
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ComboBox1.Activate
 If ThisWorkbook.Worksheets("ComFactSheet").Range("C16").Value = "Expired" Then Exit Sub
  EventOff = True
 Application.EnableEvents = False
 ActiveSheet.Name = "System Menu"
 Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
If Date < BeginningDate Then
 If MyBook.Worksheets("ComData").Range("B7").Value = "Yes" Then
  MsgBox ("Error in the date setting of your computer." & Chr(13) & "Input is not allowed")
  Exit Sub
 End If
End If
If ThisWorkbook.Worksheets("ComFactSheet").Range("C2") <> "Yes" Then
   If (Date - MyBook.Worksheets("ComData").Range("B9").Value) > 90 Then
      MsgBox ("The Free Trial Period for the Data File has expired." & Chr(13) & "Data Entry is not allowed.")
      Exit Sub
   End If
 End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  MsgBox ("The Data File is a Year Ended file." & Chr(13) & "No Update is allowed.")
  Exit Sub
  End If
 If MyBook.Worksheets("ComData").Range("B7").Value <> "Yes" Then
  MsgBox ("The Initial account data has not been entered. " & Chr(13) & "Thus, Year End Update is NOT allowed." & Chr(13) & Chr(13))
  Exit Sub
  End If
 YearLastDate = Year(MyBook.Worksheets("Raw Data").Range("A1")) + 1 & "/" & Month(MyBook.Worksheets("Raw Data").Range("A1")) _
                & "/" & Day(MyBook.Worksheets("Raw Data").Range("A1"))
 YearLastDate = YearLastDate - 1
 If YearLastDate > Date Then
  MsgBox ("Year End Date of this Company is " & Year(YearLastDate) & "/" & Month(YearLastDate) & "/" & _
  Day(YearLastDate) & Chr(13) & Chr(13) _
  & "As the day of year end has not yet reached, " & Chr(13) & "Year End Update is NOT allowed." & Chr(13) & Chr(13))
  Exit Sub
  End If
If FileStatus = "ReadOnly" Then
  MsgBox ("The Data File is being used by another user.  No Update is allowed.")
  Exit Sub
End If
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
On Error GoTo NoForm
UserForm4.Caption = "Year End Updating"
On Error GoTo 0
EventOff = True
Call YearEndUpdate("GL")
EventOff = False
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton4_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ComboBox1.Activate
  EventOff = True
 Application.EnableEvents = False
 ActiveSheet.Name = "System Menu"
Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
On Error GoTo NoForm
UserForm4.Caption = "Journal Report"
On Error GoTo 0
 Application.EnableEvents = False
 Application.DisplayAlerts = False
    Sheets("Journal").Visible = xlSheetVisible
    Sheets("Journal").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Journal"
 Application.DisplayAlerts = True
 SheetName = "Journal"
Application.EnableEvents = True
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
EventOff = True
Call Journal("GL")
EventOff = False
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton5_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 ComboBox1.Activate
  EventOff = True
 Application.EnableEvents = False
 ActiveSheet.Name = "System Menu"
Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
On Error GoTo NoForm
 UserForm4.Caption = "Income Statement Reporting"
 On Error GoTo 0
Application.EnableEvents = False
Application.DisplayAlerts = False
    Sheets("Income Statement").Visible = xlSheetVisible
    Sheets("Income Statement").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Income Statement"
 Application.DisplayAlerts = True
 SheetName = "Income Statement"
 Application.EnableEvents = True
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 EventOff = True
Call InComeNewB("GL")
EventOff = False
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton6_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ComboBox1.Activate
  EventOff = True
 Application.EnableEvents = False
 ActiveSheet.Name = "System Menu"
Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
On Error GoTo NoForm
UserForm4.Caption = "Balance Sheet Reporting"
On Error GoTo 0
Application.EnableEvents = False
Application.DisplayAlerts = False
    Sheets("Balance Sheet").Visible = xlSheetVisible
    Sheets("Balance Sheet").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Balance Sheet"
 Application.DisplayAlerts = True
SheetName = "Balance Sheet"
Application.EnableEvents = True
ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
EventOff = True
Call BalanceNewB("GL")
EventOff = False
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton7_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ComboBox1.Activate
  EventOff = True
 Application.EnableEvents = False
 ActiveSheet.Name = "System Menu"
Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
On Error GoTo NoForm
UserForm4.Caption = "Ledger Detail Activity Report"
On Error GoTo 0
 Application.EnableEvents = False
 Application.DisplayAlerts = False
    Sheets("Activity Report").Visible = xlSheetVisible
    Sheets("Activity Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Activity Report"
 Application.DisplayAlerts = True
 SheetName = "Activity Report"
 Application.EnableEvents = True
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 EventOff = True
Call FullActivityRptNew("GL")
EventOff = False
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton8_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ComboBox1.Activate
  EventOff = True
 Application.EnableEvents = False
 ActiveSheet.Name = "System Menu"
Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
  Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
 Application.ScreenUpdating = False
On Error GoTo NoForm
UserForm1.Caption = "Company Information"
On Error GoTo 0
UserForm1.Show
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub CommandButton9_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ComboBox1.Activate
  EventOff = True
 Application.EnableEvents = False
 ActiveSheet.Name = "System Menu"
Application.ScreenUpdating = False
Call ReFresh("GL")
Application.EnableEvents = False
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
If MyBook Is Nothing Then Exit Sub
 If AuthorStatus = False Then
  If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
   On Error GoTo NoForm
    UserForm99.Caption = "User Authorization"
   On Error GoTo 0
   UserForm99.Show
   Worksheets("Activity Report").Range("D6").ClearContents
   Call ReturnToMainMenu("")
   Exit Sub
  Else
   AuthorStatus = True
  End If
 End If
On Error GoTo NoForm
UserForm4.Caption = "Trial Balance Generation"
On Error GoTo 0
 Application.EnableEvents = False
 Application.DisplayAlerts = False
    Sheets("Trial Balance").Visible = xlSheetVisible
    Sheets("Trial Balance").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Trial Balance"
 Application.DisplayAlerts = True
 SheetName = "Trial Balance"
 Application.EnableEvents = True
 ThisWorkbook.Worksheets("Activity Report").Range("D6").ClearContents
 EventOff = True
Call TBalanceNew("GL")
EventOff = False
Exit Sub
NoForm:
Call CloseSysBook("")
End Sub
Private Sub Worksheet_Activate()
Dim I As Long, J As Long, LineNo As Long, FileNo As String, DataFileName As String, DataPath As String
Dim myFSO As Object, FilePath As String, FileExtn As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Application.OnKey "{F10}", "SaveData"
 Application.OnKey "{F5}", "ESCToMainMenu"
 Application.EnableEvents = False
 DataPath = ""
 DataFileName = ""
 ThisWorkbook.Worksheets("ComFactSheet").Activate
 Worksheets("ComFactSheet").Range("B21").Select
 Set myFSO = CreateObject("Scripting.FileSystemObject")
 Do While ActiveCell.Value <> ""
   FileNo = ActiveCell.Value
   FilePath = ActiveCell.Offset(0, -1).Value
   FileExtn = ActiveCell.Offset(0, 1).Value
  If UCase(Right(ThisWorkbook.Name, 4)) = ".XLS" And UCase(FileExtn) <> ".XLS" Then
   ActiveCell.Offset(0, 2).Value = 1
  Else
   If myFSO.FileExists(FilePath & FileNo & FileExtn) = True Then
    J = myFSO.GetFile(FilePath & FileNo & FileExtn).Attributes Mod 4
    If J <> 2 And J <> 3 Then
     ActiveCell.Offset(0, 2).Value = 0
    Else
     ActiveCell.Offset(0, 2).Value = 1
    End If
   Else
    ActiveCell.Offset(0, 2).Value = 1
   End If
  End If
   ActiveCell.Offset(1, 0).Select
 Loop
 I = ActiveCell.Row - 1
 If I > 21 Then
 Worksheets("ComFactSheet").Range("A21:D" & I).Select
 Selection.Sort Key1:=Worksheets("ComFactSheet").Range("D21"), Order1:=xlAscending, _
         Key2:=Worksheets("ComFactSheet").Range("B21"), _
         Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:=False, _
         Orientation:=xlTopToBottom
 End If
ComboBox1.Clear
Worksheets("ComFactSheet").Activate
Worksheets("ComFactSheet").Range("D21").Select
Do While ActiveCell.Offset(0, -2).Value <> "" And ActiveCell.Value = 0
 ComboBox1.AddItem ActiveCell.Offset(0, -2).Value
 ActiveCell.Offset(1, 0).Select
Loop
ComboBox1.AddItem "Select Other Files"
 DataFileName = Worksheets("ComFactSheet").Range("B18").Value
 DExtn = Worksheets("ComFactSheet").Range("C18").Value
 DataPath = Worksheets("ComFactSheet").Range("A18").Value
Worksheets("System Menu").Activate
 Range("A1:G21").Select
 ActiveWindow.Zoom = True
 Range("C4").Select
 Range("C4").Value = DataFileName
 Range("B5").Value = "Folder of the file -- "
 Range("C5").Value = DataPath
 ComboBox1.Value = DataFileName
 Application.EnableEvents = True
 ComboBox1.Visible = True
End Sub
Private Sub Worksheet_SelectionChange(ByVal Target As Range)
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
  EventOff = True
  Application.EnableEvents = False
  On Error Resume Next
   Range("C4").Select
 If UCase(Range("C4").Value) <> UCase(ComboBox1.Text) Then
   ComboBox1.Text = ""
   For I = 0 To ComboBox1.ListCount - 1
    If UCase(Range("C4").Value) = UCase(ComboBox1.List(I)) Then
      ComboBox1.Text = ComboBox1.List(I)
      Exit For
    End If
   Next I
 End If
  Application.EnableEvents = True
  EventOff = False
 ComboBox1.Activate
End Sub



Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 2, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 7, 2, MSForms, CommandButton"
Attribute VB_Control = "Label1, 8, 3, MSForms, Label"
Public OldAccount As String, RowNo As Long, ColumnNo As Long, SaveAllow As Boolean

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
Application.ScreenUpdating = False
On Error GoTo ErrorHandling
 MyBook.Activate
On Error GoTo 0
 ThisWorkbook.Worksheets("IniData").Activate
ActiveSheet.Name = "IniData"
Worksheets("IniData").UsedRange.EntireRow.Delete
If Worksheets("NewCom").Range("A1").Value = "New" Then
 Worksheets("NewCom").Range("A1").Value = ""
 Call FoundChartofAccountRange("")
End If
Call ReturnToMainMenu("")
Application.EnableEvents = True
Exit Sub
ErrorHandling:
 Call ReturnToMainMenu("")
End Sub

Private Sub CommandButton2_Click()
Dim I As Long, NoAcctName As String, ProbRow As Long, ProbCol As Long
Application.EnableCancelKey = xlDisabled
 ActiveCell.Offset(1, 0).Select
 If SaveAllow = False Then Exit Sub
 Application.EnableEvents = False
 Application.ScreenUpdating = False
 On Error GoTo ErrorHandling
  MyBook.Activate
 On Error GoTo 0
 ThisWorkbook.Worksheets("IniData").Activate
 ActiveSheet.Name = "IniData"
If ActiveSheet.UsedRange.Rows.Count > 14 Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(14, 0).Resize(Tbl.Rows.Count - 14, Tbl.Columns.Count + 3).Select
     With Selection
       .Columns("J").NumberFormat = "General"
       .Columns("J").FormulaR1C1 = "=LEFT(RC[-9] & ""*******"",7)"
       .Sort Key1:=Range("J1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
       .Columns("J").ClearContents
     End With
 If Range("A15").Value = "" Then
   Range("A15").Select
   I = Tbl.Rows.Count - 14
   Do While ActiveCell.Value = "" And I > 1
    ActiveCell.EntireRow.Delete
    I = I - 1
    Loop
 End If
Else
  MsgBox ("Error!!!" & Chr(13) & Chr(13) & "No data for Chart of Account")
  Application.EnableEvents = True
  Application.ScreenUpdating = True
 Exit Sub
End If
     Range("A15").Select
     NoAcctName = ""
     Do While ActiveCell.Value <> ""
      If Left((ActiveCell.Value & "000"), 1) = 1 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).ClearContents
        ActiveCell.Offset(0, 5).ClearContents
       Else
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlNone
        ActiveCell.Offset(0, 5).ClearContents
        If ActiveCell.Offset(0, 4).Value = "" Then ActiveCell.Offset(0, 4).Value = 0
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 2 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 4).ClearContents
         ActiveCell.Offset(0, 5).ClearContents
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
        ActiveCell.Offset(0, 4).ClearContents
        If ActiveCell.Offset(0, 5).Value = "" Then ActiveCell.Offset(0, 5).Value = 0
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 3 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 4).ClearContents
        ActiveCell.Offset(0, 5).ClearContents
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
        ActiveCell.Offset(0, 4).ClearContents
        If ActiveCell.Offset(0, 5).Value = "" Then ActiveCell.Offset(0, 5).Value = 0
       End If
      Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).Value = ""
        ActiveCell.Offset(0, 5).Value = ""
      End If
      If Len(ActiveCell.Value) > 5 Then
        WrongAcct = ActiveCell.Value
        WrongRow = ActiveCell.Row
      ElseIf Len(ActiveCell.Value) = 5 Then
        If IsNumeric(Left(ActiveCell.Value, 4)) = False Then
         WrongAcct = ActiveCell.Value
         WrongRow = ActiveCell.Row
        End If
      ElseIf IsNumeric(ActiveCell.Value) = False Then
         WrongAcct = ActiveCell.Value
         WrongRow = ActiveCell.Row
      End If
      If ActiveCell.Offset(0, 1).Value = "" Then
        NoAcctName = ActiveCell.Value
        ProbRow = ActiveCell.Row
        ProbCol = ActiveCell.Column
      End If
      ActiveCell.Offset(1, 0).Select
     Loop
  If WrongAcct <> "" Then
     MsgBox ("Wrong Account # ' " & WrongAcct & " '. Please correct.")
    Application.ScreenUpdating = True
    Cells(WrongRow, 1).Select
    Application.EnableEvents = True
   Exit Sub
  End If
  If NoAcctName <> "" Then
    MsgBox ("Please enter the Account name for " & NoAcctName)
   Application.ScreenUpdating = True
   Cells(ProbRow, ProbCol + 1).Select
    Application.EnableEvents = True
   Exit Sub
  End If
If Range("A15").Value = "" Then
  MsgBox ("Error!!!" & Chr(13) & Chr(13) & "No data for Chart of Account")
  Application.EnableEvents = True
  Application.ScreenUpdating = True
 Exit Sub
End If
  If IsNumeric(Range("C10").Value) = True Then
     Range("C10").Select
     MsgBox ("Please enter the Last Date of Previous Year in the format 'yyyy/mm/dd'")
      Application.EnableEvents = True
     Application.ScreenUpdating = True
    Exit Sub
  End If
  If IsDate(Range("C10").Value) = False Then
     Range("C10").Select
     MsgBox ("Last Date of Previous Year was not properly entered" & Chr(13) & Chr(13) & "Please correct the Date")
      Application.EnableEvents = True
     Application.ScreenUpdating = True
    Exit Sub
  End If
If Worksheets("NewCom").Range("A1").Value = "New" Then
 Call NewBalance("IniData")
Else
 Call UpdateBalance("IniData")
End If
 If ThisWorkbook.Worksheets("IniData").Visible = True Then
   ThisWorkbook.Worksheets("Inidata").Activate
   If ActiveCell.Column = 1 And ActiveCell.Row > 14 Then
      OldAccount = ActiveCell.Value
     Else
      OldAccount = ""
     End If
  End If
  Application.EnableEvents = True
  Application.ScreenUpdating = True
 Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem. Setup cannot be proceeded")
 Call ReturnToMainMenu("")
End Sub

Private Sub CommandButton3_Click()
On Error GoTo ErrorHandling
Application.EnableCancelKey = xlDisabled
 MyBook.Activate
On Error GoTo 0
 ThisWorkbook.Worksheets("IniData").Activate
ActiveSheet.Name = "IniData"
SheetName = "IniData"
UserForm3.Show
Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem. Setup cannot be proceeded")
 Call ReturnToMainMenu("")
End Sub

Private Sub Worksheet_Activate()
Application.EnableCancelKey = xlDisabled
  Application.EnableEvents = False
  Application.ScreenUpdating = False
  Worksheets("IniData").Label1.Caption = Chr(13) & "    Request under Processing" & Chr(13) & _
                                                    Chr(13) & "    Please Wait "
  Worksheets("IniData").Label1.Visible = False
  Call IniSheetFormat("IniData")
  SheetName = "IniData"
  Application.ScreenUpdating = True
  Range("A1").Select
  Range("C10").Select
  Application.EnableEvents = True
End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
Dim Acct As String, LastDate As Date, YearEndMonth As Long, UpperAcct As String, AcctLen As Long, I As Long, J As Long, K As Long
Dim DateString As String
Application.EnableCancelKey = xlDisabled
 Application.EnableEvents = False
 Application.ScreenUpdating = False
 ActiveSheet.Name = "IniData"
  If Range("M14").Value <> "  " Or Range("M10").Value <> "   " Then GoTo ErrorHandling
  If Range("E14").Value <> "--------" Or Range("F14").Value <> "--------" Or Range("A14").Value <> "----------" Or Range("B14").Value <> "--------------------------------" _
    Or Range("C14").Value <> "---------" Or Range("D14").Value <> "---------" Then GoTo ErrorHandling
  If Target.Rows.Count > 1 Or Target.Columns.Count > 1 Then
    Target.Resize(1, 1).Select
    If ActiveCell.Column = 1 And ActiveCell.Row > 14 Then
      OldAccount = ActiveCell.Value
     Else
      OldAccount = ""
     End If
    Application.ScreenUpdating = True
    Application.EnableEvents = True
   Exit Sub
  End If
With Target
 RowNo = .Row
 ColumnNo = .Column
 If .Row < 15 Then
   On Error GoTo ErrorHandling
   If .Address <> "$C$10" Then
    LastDate = Range("C10").Value
    Range("A1:L14").ClearContents
    Range("B10").Value = "Enter Last date of the Previous Year : "
    Range("E10").Value = "(yyyy/mm/dd)"
    Range("E12").Value = "Opening Balance"
    Range("E13").Value = "Debit"
    Range("F13").Value = "Credit"
    Range("E14").Value = "--------"
    Range("F14").Value = "--------"
    Range("A1").Value = "Please modify the Chart of Accounts below to meet your requirements and enter the opening balance data of your company."
    Range("A2").Value = "The Account number and the corresponding Account names starting from Row # 15"
    Range("A3").Value = "Notes below must be followed to define the Account Numbers "
    Range("A4").Value = "1. Account Number starts with  '2'  is for Liabilities;  '3' is for Capital/Equity; '4' is for Revenue and '8' is for Other Income ( ie Credit Balance Accounts) "
    Range("A5").Value = "2. Account Number starts with '1' is for Assets; '5', '6' and '9' are for Expenses ( i.e. Debit Balance Accounts)"
    Range("A6").Value = "3. Account Number starting with '36' are RESERVED by the system for profit reporting "
    Range("A7").Value = "4. Account number must be with 1 to 5 digits ( e.g. '203',  '45673' are valid account numbers; '112368' is an invalid number) "
    Range("A8").Value = "5. The Account Name must be within 27 characters"
    Range("A12").Value = "Account"
    Range("A13").Value = "Number"
    Range("A14").Value = "----------"
    Range("B13").Value = "Account Name"
    Range("B14").Value = "--------------------------------"
    Range("C12").Value = "Account"
    Range("C13").Value = "Type"
    Range("C14").Value = "---------"
    Range("D12").Value = "Account"
    Range("D13").Value = "Level"
    Range("D14").Value = "---------"
    If LastDate <> 0 Then Range("C10").Value = Format(LastDate, "yyyy/mm/dd")
    Range("C10").Select
   Else
    On Error GoTo DataFileErr
   If Worksheets("NewCom").Range("A1").Value = "New" Then
     YearEndMonth = Worksheets("NewCom").Range("B6").Value
   Else
     YearEndMonth = MyBook.Worksheets("ComData").Range("B6").Value
   End If
    If IsNumeric(Range("C10").Value) = True Then
      DateString = Range("C10").Value
      Call DateConvert(DateString)
     If IsDate(DateString) = False Then
      MsgBox ("Wrong input. Enter the Date in the format 'yyyy/mm/dd'")
      Range("C10").Select
      GoTo FinishIni
     Else
      Range("C10").Value = DateString
     End If
    End If
    If IsDate(Range("C10").Value) = False Then
     MsgBox ("Wrong Date input.  Please correct the date before proceed")
     Range("C10").Select
     GoTo FinishIni
    End If
    LastDate = Range("C10").Value
    If LastDate > Date Then
     MsgBox ("Wrong Date input.  The Date must not be later than Today")
     Range("C10").Select
     GoTo FinishIni
    End If
    If Year(LastDate) < 1990 Then
      MsgBox ("Wrong Date input.  Please correct the data before proceed")
       Range("C10").Select
      GoTo FinishIni
    ElseIf Month(LastDate) <> YearEndMonth Then
      MsgBox ("Wrong Month input." & Chr(13) & "It should be the same as the Year End Month of your Company." & Chr(13) & Chr(13) & "Please correct the data before proceed")
      Range("C10").Select
      GoTo FinishIni
    ElseIf (Month(LastDate) = 1 Or Month(LastDate) = 3 Or Month(LastDate) = 5 Or Month(LastDate) = 7 Or Month(LastDate) = 8 Or Month(LastDate) = 10 Or Month(LastDate) = 12) And Day(LastDate) <> 31 Then
     MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
     Range("C10").Select
     GoTo FinishIni
    ElseIf (Month(LastDate) = 4 Or Month(LastDate) = 6 Or Month(LastDate) = 9 Or Month(LastDate) = 11) And Day(LastDate) <> 30 Then
     MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
     Range("C10").Select
     GoTo FinishIni
    ElseIf Month(LastDate) = 2 And (Int(Year(LastDate) / 4) * 4 <> Year(LastDate)) And Day(LastDate) <> 28 Then
     MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
     Range("C10").Select
     GoTo FinishIni
    ElseIf Month(LastDate) = 2 And (Int(Year(LastDate) / 4) * 4 = Year(LastDate)) And Day(LastDate) <> 29 Then
     MsgBox ("Wrong Date input." & Chr(13) & "It must be the last day of the Year End month" & Chr(13) & Chr(13) & "Please correct the data before proceed")
     Range("C10").Select
     GoTo FinishIni
    End If
    Range("C10").Value = Format(LastDate, "yyyy/mm/dd")
    Range("E15").Select
   End If
  OldAccount = ""
 Else
    If .Column = 2 Then
     If Len(.Value) > 9 Then
       I = Len(.Value)
       J = 1
       K = 0
       Do While J <= I
        If Abs(Asc(Mid(.Value, J, 1))) > 255 Then
          K = K + 3
        Else
          K = K + 1
        End If
        If K > 29 Then
          .Value = Left(.Value, J - 1)
          Exit Do
        End If
        J = J + 1
       Loop
     End If
    ElseIf .Column = 1 Then
     If .Value = "" Then
       Acct = OldAccount
       AcctLen = Len(Acct)
       J = ActiveSheet.UsedRange.Rows.Count - .Row
       I = 1
       Do While .Offset(I, 0).Value = "" And J > 0
         I = I + 1
         J = J - 1
       Loop
       .Offset(I, 0).Select
       If Acct = ActiveCell.Value Then
          MsgBox ("The Account # is deleted")
         .EntireRow.Delete
          GoTo ResetAccount
       ElseIf OldAccount = "36" Or OldAccount = "361" Or OldAccount = "3611" Then GoTo Handle36
       ElseIf AcctLen > 0 Then
         If Acct = Left(ActiveCell.Value, AcctLen) Then
           .Value = Acct
           MsgBox ("It is the parent Account for " & ActiveCell.Value & ".  No deletion is allowed")
           GoTo FinishIni
         Else
           MsgBox ("The Account # is deleted")
          .EntireRow.Delete
          GoTo ResetAccount
         End If
       Else
        MsgBox ("The Account # is deleted")
        .EntireRow.Delete
        GoTo ResetAccount
       End If
     End If
Handle36:
     If OldAccount = "36" Or OldAccount = "361" Or OldAccount = "3611" Then
       J = ActiveSheet.UsedRange.Rows.Count - .Row
       I = 1
       Do While .Offset(I, 0).Value = "" And J > 0
         I = I + 1
         J = J - 1
       Loop
       .Offset(I, 0).Select
      If ActiveCell.Value = OldAccount Then GoTo DuplicateAcct
       .Value = OldAccount
        If OldAccount = "36" Then
           .Offset(0, 1).Value = "RESERVES"
           .Offset(0, 2).Value = "Capital"
           .Offset(0, 3).NumberFormat = "General"
           .Offset(0, 3).Value = 2
           .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
           .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ElseIf OldAccount = "361" Then
           .Offset(0, 1).Value = "Accumulated P/L"
           .Offset(0, 2).Value = "Capital"
           .Offset(0, 3).NumberFormat = "General"
           .Offset(0, 3).Value = 3
           .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
           .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        Else
           .Offset(0, 1).Value = "Accumulated P/L B/F"
           .Offset(0, 2).Value = "Capital"
           .Offset(0, 3).NumberFormat = "General"
           .Offset(0, 3).Value = 4
           .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
           .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         End If
        MsgBox ("The number starts with '36' is reserved for system use." & Chr(13) & _
        "No change to the account number is allowed.")
        OldAccount = ActiveCell.Value
       Application.EnableEvents = True
       Application.ScreenUpdating = True
       Exit Sub
     End If
     If Left((.Value & "***"), 2) = "36" Then
      MsgBox ("The number starts with '36' is reserved for system use." & Chr(13) & _
       "No change to the account number is allowed.")
       .Value = ""
       OldAccount = ActiveCell.Value
       Application.EnableEvents = True
       Application.ScreenUpdating = True
      Exit Sub
     End If
      .Value = UCase(.Value)
      Acct = .Value
      AcctLen = Len(.Value)
     If AcctLen > 5 Then
      .Select
       MsgBox ("Wrong Input!!!." & Chr(13) & "The account number must be of 1 to 5 figures")
       .Value = ""
       GoTo FinishIni
     End If
     If Left(Acct, 1) > 9 Or Left(Acct, 1) < 1 Then
      .Select
       MsgBox ("Wrong Input!!!." & Chr(13) & "Account numbers must start with 1 to 9")
       .Value = ""
       GoTo FinishIni
     End If
     For I = 2 To AcctLen
      If Mid(Acct, I, 1) > 9 Or Mid(Acct, I, 1) < 0 Then
        If I = 5 Then
          If Asc(Mid(Acct, I, 1)) > 64 And Asc(Mid(Acct, I, 1)) < 91 Then
           If Mid(Acct, I, 1) <> "O" And Mid(Acct, I, 1) <> "I" Then
            Exit For
           Else
            .Select
            MsgBox ("Wrong Input!!!." & Chr(13) & "For Level 5 accounts, the last character can only be " & Chr(13) _
            & "a number from 0 to 9 or an alphabet from A to Z except 'O' and 'I' ")
            .Value = ""
           GoTo FinishIni
           End If
         Else
          .Select
          MsgBox ("Wrong Input!!!." & Chr(13) & "For Level 5 accounts, the last character can only be " & Chr(13) _
          & "a number from 0 to 9 or an alphabet from A to Z except 'O' and 'I' ")
          .Value = ""
          GoTo FinishIni
         End If
        Else
         .Select
         MsgBox ("Wrong Input!!!." & Chr(13) & "For Level 1 to 4 accounts, the account number must be numeric")
         .Value = ""
          GoTo FinishIni
        End If
      End If
     Next I
       Acct = .Value
       AcctLen = Len(Acct) - 1
       UpperAcct = ""
       I = ActiveSheet.UsedRange.Rows.Count - 14
     If AcctLen > 0 Then
        UpperAcct = Left(Acct, AcctLen)
        AcctLen = 1
       Range("A15").Select
       Do While I > 1
        If Acct = ActiveCell.Value And ActiveCell.Row <> .Row Then
         GoTo DuplicateAcct
        End If
        If UpperAcct = ActiveCell.Value Then
         AcctLen = 0
        End If
        ActiveCell.Offset(1, 0).Select
        I = I - 1
       Loop
     Else
      Range("A15").Select
       Do While I > 1
        If Acct = ActiveCell.Value And ActiveCell.Row <> .Row Then
         GoTo DuplicateAcct
        End If
        ActiveCell.Offset(1, 0).Select
        I = I - 1
       Loop
     End If
     If AcctLen <> 0 Then
        MsgBox ("WARNING!!!" & Chr(13) & "The account number " & UpperAcct & " which is the parent account for " & Acct & " does not exist. " & Chr(13) & _
        "Please add " & UpperAcct & " first.")
        .Value = ""
        GoTo FinishIni
      End If
     If Left((.Value & "000"), 1) = 1 Then
      .Offset(0, 2).Value = "Asset"
      .Offset(0, 4).Value = 0
      .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlNone
      .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ElseIf Left((.Value & "000"), 1) = 2 Then
      .Offset(0, 2).Value = "Liability"
      .Offset(0, 5).Value = 0
      .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
      .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ElseIf Left((.Value & "000"), 1) = 3 Then
      .Offset(0, 2).Value = "Capital"
      .Offset(0, 5).Value = 0
      .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
      .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ElseIf Left((.Value & "000"), 1) = 4 Then
      .Offset(0, 2).Value = "Revenue"
      .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
      .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ElseIf Left((.Value & "000"), 1) = 8 Then
      .Offset(0, 2).Value = "Other Income"
      .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
      .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
     Else
      .Offset(0, 2).Value = "Expense"
      .Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
      .Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
     End If
    .Offset(0, 3).NumberFormat = "General"
    If Len(.Value) = 1 Then
     .Offset(0, 3).Value = "1"
    ElseIf Len(.Value) = 2 Then
     .Offset(0, 3).Value = "2"
    ElseIf Len(.Value) = 3 Then
     .Offset(0, 3).Value = "3"
    ElseIf Len(.Value) = 4 Then
     .Offset(0, 3).Value = "4"
    ElseIf Len(.Value) = 5 Then
     .Offset(0, 3).Value = "5"
    End If
    .Offset(0, 1).Select
   End If
 If .Row > 14 And .Column = 5 Then
  If Left((.Offset(0, -4).Value & "000"), 1) > 3 Then
     MsgBox ("There should not be opening value for accounts related to Income/Revenue or expense items")
     .Value = ""
   ElseIf Left((.Offset(0, -4).Value & "000"), 1) <> 1 Then
     MsgBox ("It is a Credit type account." & Chr(13) & "Input should be made at Credit Column")
     .Value = ""
  Else
   If Len(.Offset(0, -4).Value) < Len(.Offset(1, -4).Value) Or Len(.Offset(0, -4).Value) = 1 Then
    MsgBox ("There should not be opening value for a General Account")
     .Value = ""
   Else
    If IsNumeric(.Value) = False Then
     MsgBox ("Not a valid Debit amount.")
      .Value = 0
     .Select
    Else
     .Value = CCur(.Value)
     RowNo = RowNo + 1
    End If
   End If
  End If
 End If
 If .Row > 14 And .Column = 6 Then
  If Left((.Offset(0, -5).Value & "000"), 1) > 3 Then
    MsgBox ("There should not be opening value for accounts related to Income/Revenue or expense items")
    .Value = ""
  ElseIf Left((.Offset(0, -5).Value & "000"), 1) = 1 Then
     MsgBox ("It is a Debit type account." & Chr(13) & "Input should be made at Debit Column")
     .Value = ""
  Else
   If Len(.Offset(0, -5).Value) < Len(.Offset(1, -5).Value) Or Len(.Offset(0, -5).Value) = 1 Then
    MsgBox ("Opening Balance should be inputted to a Detail Account; not a General Account")
     .Value = ""
   Else
    If IsNumeric(.Value) = False Then
     MsgBox ("Not a valid Credit amount.")
     .Value = 0
     .Select
    Else
     .Value = CCur(.Value)
     RowNo = RowNo + 1
    End If
   End If
  End If
 End If
End If
If ActiveCell.Column = 1 And ActiveCell.Row > 14 Then
  OldAccount = ActiveCell.Value
Else
 OldAccount = ""
End If
ResetAccount:
If ActiveSheet.UsedRange.Rows.Count > 14 Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(14, 0).Resize(Tbl.Rows.Count - 14, Tbl.Columns.Count + 3).Select
     With Selection
       .Columns("J").NumberFormat = "General"
       .Columns("J").FormulaR1C1 = "=LEFT(RC[-9] & ""*******"",7)"
       .Sort Key1:=Range("J1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
       .Columns("J").ClearContents
     End With
 If Range("A15").Value = "" Then
   Range("A15").Select
   I = Tbl.Rows.Count - 14
   Do While ActiveCell.Value = "" And I > 1
    ActiveCell.EntireRow.Delete
    I = I - 1
    Loop
 End If
     Range("A15").Select
     Do While ActiveCell.Value <> ""
      If Left((ActiveCell.Value & "000"), 1) = 1 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).ClearContents
        ActiveCell.Offset(0, 5).ClearContents
       Else
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlNone
        If ActiveCell.Offset(0, 4).Value = "" Then ActiveCell.Offset(0, 4).Value = 0
        ActiveCell.Offset(0, 5).ClearContents
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 2 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 4).ClearContents
        ActiveCell.Offset(0, 5).ClearContents
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
        If ActiveCell.Offset(0, 5).Value = "" Then ActiveCell.Offset(0, 5).Value = 0
        ActiveCell.Offset(0, 4).ClearContents
       End If
      ElseIf Left((ActiveCell.Value & "000"), 1) = 3 Then
          If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
         ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
         ActiveCell.Offset(0, 4).ClearContents
        ActiveCell.Offset(0, 5).ClearContents
       Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlNone
        If ActiveCell.Offset(0, 5).Value = "" Then ActiveCell.Offset(0, 5).Value = 0
        ActiveCell.Offset(0, 4).ClearContents
       End If
      Else
        ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
        ActiveCell.Offset(0, 4).ClearContents
        ActiveCell.Offset(0, 5).ClearContents
      End If
      ActiveCell.Offset(1, 0).Select
     Loop
  End If
  If ColumnNo = 1 And Acct <> "" Then
   Range("A15").Select
   Do While ActiveCell.Value <> "" And ActiveCell.Value <> Acct
    ActiveCell.Offset(1, 0).Select
   Loop
    Application.ScreenUpdating = True
    ActiveCell.Select
   If ActiveCell.Value <> Acct Then
     Cells(RowNo, ColumnNo).Select
   ElseIf ActiveCell.Offset(0, 1).Value = "" Then
     ActiveCell.Offset(0, 1).Select
   End If
  ElseIf ColumnNo = 2 And .Value <> "" Then
    Application.ScreenUpdating = True
    Cells(RowNo + 1, ColumnNo).Select
  Else
    Application.ScreenUpdating = True
   Cells(RowNo, ColumnNo).Select
  End If
 If ActiveCell.Column = 1 And ActiveCell.Row > 14 Then
   OldAccount = ActiveCell.Value
 Else
   OldAccount = ""
 End If
  Application.EnableEvents = True
 Exit Sub
DuplicateAcct:
  Application.ScreenUpdating = True
 .Select
 MsgBox ("Wrong Input!!!." & Chr(13) & "Duplicate Account number")
 .Value = ""
  OldAccount = ""
  Application.EnableEvents = True
  Application.ScreenUpdating = True
 Exit Sub
ErrorHandling:
MsgBox ("You probably have inserted or deleted a column or a row which is not allowed." & Chr(13) & Chr(13) & "To avoid possible error, the program will REFRESH the sheet." & Chr(13) & "Please re-enter the data again")
  Call IniSheetFormat("IniData")
  SheetName = "IniData"
  Application.ScreenUpdating = True
  Range("A1").Select
  Range("C10").Select
  OldAccount = ""
  Application.EnableEvents = True
 Exit Sub
DataFileErr:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem. Setup cannot be proceeded")
  Call ReturnToMainMenu("")
 Exit Sub
FinishIni:
  Cells(RowNo, ColumnNo).Select
  If ActiveCell.Column = 1 And ActiveCell.Row > 14 Then
    OldAccount = ActiveCell.Value
  Else
   OldAccount = ""
  End If
  Application.EnableEvents = True
  Application.ScreenUpdating = True
End With
End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
On Error GoTo Finish
Application.EnableCancelKey = xlDisabled
ActiveSheet.Name = "IniData"
 Application.EnableEvents = False
 Application.ScreenUpdating = False
  If Range("M14").Value <> "  " Or Range("M10").Value <> "   " Then GoTo ErrorHandling
  If Range("E14").Value <> "--------" Or Range("F14").Value <> "--------" Or Range("A14").Value <> "----------" Or Range("B14").Value <> "--------------------------------" _
    Or Range("C14").Value <> "---------" Or Range("D14").Value <> "---------" Then GoTo ErrorHandling
 If Target.Rows.Count > 1 Or Target.Columns.Count > 1 Then
    Target.Resize(1, 1).Select
    If ActiveCell.Column = 1 And ActiveCell.Row > 14 Then
      OldAccount = ActiveCell.Value
     Else
      OldAccount = ""
     End If
    Application.ScreenUpdating = True
    Application.EnableEvents = True
   Exit Sub
  End If
With Target
 If .Row > 14 Then
  If .Column > 6 Then Cells(.Row + 1, 1).Select
  If .Column > 2 And Cells(.Row, 1).Value = "" Then Cells(.Row, 1).Select
 End If
End With
 If ActiveCell.Column = 1 And ActiveCell.Row > 14 Then
  OldAccount = ActiveCell.Value
 Else
  OldAccount = ""
 End If
 SaveAllow = True
 
 Application.ScreenUpdating = True
  Application.EnableEvents = True
Exit Sub
ErrorHandling:
 MsgBox ("You probably have inserted or deleted a column or a row which is not allowed." & Chr(13) & Chr(13) & "To avoid possible error, the program will REFRESH the sheet." & Chr(13) & "Please re-enter the data again")
  Call IniSheetFormat("IniData")
  SheetName = "IniData"
  Application.ScreenUpdating = True
  Range("A1").Select
  Range("C10").Select
  OldAccount = ""
 SaveAllow = False
Finish:
Application.EnableEvents = True
End Sub
Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 4, 0, MSForms, CommandButton"
Attribute VB_Control = "ListBox1, 2, 1, MSForms, ListBox"
Attribute VB_Control = "Label1, 6, 2, MSForms, Label"
Attribute VB_Control = "CommandButton5, 18, 3, MSForms, CommandButton"
Attribute VB_Control = "CommandButton4, 17, 4, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 16, 5, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 15, 6, MSForms, CommandButton"
Attribute VB_Control = "CommandButton6, 19, 7, MSForms, CommandButton"
Public ScreenType As Double
Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
DataSheetReturn = "Yes"
Application.ScreenUpdating = False
On Error GoTo ErrorHandling
MyBook.Activate
On Error GoTo 0
ThisWorkbook.Worksheets("Data Entry").Activate
UserForm5.Show
 Application.EnableEvents = False
ListBox1.Clear
L = 10
M = LastRowChartofAccount
For I = L To M
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " -------"
spacing = Left(spacing, 8 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ListBox1.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
Next I
ListBox1.AddItem ""
Application.ScreenUpdating = True
ListBox1.Visible = False
ListBox1.Visible = True
 ActiveCell.Select
 Application.EnableEvents = True
 Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem")
 Call ReturnToMainMenu("")
End Sub
Private Sub CommandButton2_Click()
Call ESCToMainMenu
End Sub
Private Sub CommandButton3_Click()
Call SaveData
End Sub
Private Sub CommandButton4_Click()
Call DeleteEntry
End Sub
Private Sub CommandButton5_Click()
Call NewEntrySheet
End Sub
Private Sub CommandButton6_Click()
Call Duplicate
End Sub
Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim AccountNo As String, EndNo As Long
Application.EnableCancelKey = xlDisabled
If ActiveCell.Column = 2 And ActiveCell.Row > 10 Then
EndNo = 2
AccountNo = ListBox1.Text
If AccountNo = "" Then Exit Sub
Do While Mid(AccountNo, EndNo, 1) <> " "
EndNo = EndNo + 1
Loop
AccountNo = Left(AccountNo, EndNo - 1)
ActiveCell.Value = AccountNo
End If
ListBox1.Visible = False
ListBox1.Visible = True
ActiveCell.Select
End Sub

Private Sub Worksheet_Activate()
Dim I As Long, L As Long, M As Long, N As Long, spacing As String
 Application.OnKey "{F10}", "SaveData"
 Application.OnKey "^{l}", "NewEntrySheet"
 Application.OnKey "^{d}", "DeleteEntry"
 Application.OnKey "^{m}", "Duplicate"
 Application.EnableCancelKey = xlDisabled
  Application.EnableEvents = False
  Application.ScreenUpdating = False
   ScreenType = Application.Width / Application.Height
  Worksheets("NewCom").Range("A4").Value = "Data Entry"
  Call ReFormat("DE")
  Worksheets("NewCom").Range("A4").ClearContents
  Application.EnableEvents = False
ListBox1.Clear
L = 10
M = LastRowChartofAccount
For I = L To M
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " -------"
spacing = Left(spacing, 8 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ListBox1.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
Next I
ListBox1.AddItem ""
BeginPeriod = Period(BeginningDate)
LastRecordDate = Date
AccountYear = Int((Period(LastRecordDate) - BeginPeriod) / 12) + Year(BeginningDate)
Range("C6").Value = "JV" & AccountYear
Call JNumRetrieve("DE")
ThisWorkbook.Worksheets("Data Entry").Activate
Range("C7").Value = Right(("00000" & (Val(LastTranNo) + 1)), 5)
Range("C2").Value = Format(LastRecordDate, "yyyy/mm/dd")
Application.ScreenUpdating = True
Range("A1").Select
Range("C2").Select
ListBox1.Visible = False
ListBox1.Visible = True
SRow = 2
SColumn = 3
  Application.EnableEvents = True
End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
 Dim TotalSum As Currency, FullDate As Date, RowNo As Long, COARange As Range, DateString As String
 Application.EnableCancelKey = xlDisabled
 Application.EnableEvents = False
 Application.ScreenUpdating = False
 ActiveSheet.Name = "Data Entry"
 On Error GoTo ErrorHandling
If Range("B10").Value <> " --- Account ---" Or Range("C10").Value <> " ---------- Name ----------" Or Range("D10").Value <> " -------- Description --------" Or Range("E10").Value <> " ----- Debit -----" Or Range("F10").Value <> " ----- Credit -----" Then GoTo ErrorHandling
If Cells(TotalsRow, 2).Value <> "  " Or Cells(TotalsRow, 3).Value <> "   " Or Cells(TotalsRow, 4).Value <> "Totals:" Or Cells(TotalsRow + 1, 5).Value <> "     " Or Cells(TotalsRow + 1, 6).Value <> "      " Then GoTo ErrorHandling
If Range("M2").Value <> "  " Or Range("M6").Value <> "      " Or Range("M7").Value <> "       " Or Range("M8").Value <> "        " Then GoTo ErrorHandling
With Target
If .Row > 10 And Cells(.Row, 13) <> "  " Then GoTo ErrorHandling
If .Rows.Count = 1 And .Columns.Count = 1 Then
If .Address = "$C$2" Then
 DateString = .Value
 Call DateConvert(DateString)
If IsDate(DateString) = False Then
  .Select
   MsgBox ("Wrong Date input!!!")
 .Value = ""
 GoTo Finish
End If
.Value = Format(DateString, "yyyy/mm/dd")
If .Value < BeginningDate Then
 .Select
  MsgBox (" WRONG DATE !!!" & Chr(13) & Chr(13) & "The current Accounting Year begins on " & Year(BeginningDate) & "/" & Month(BeginningDate) & "/" & Day(BeginningDate) & Chr(13) & "Entry with date earlier than the beginning date is not allowed")
.Value = ""
GoTo Finish
Else
 FullDate = .Value
 .Value = Format(FullDate, "yyyy/mm/dd")
 LastRecordDate = FullDate
   AccountYear = Int((Period(FullDate) - BeginPeriod) / 12) + Year(BeginningDate)
 If Range("B11") = "" Then
  If LastJournalCode = "" Then Range("C6").Value = "JV" & AccountYear
   If Len(Range("C6").Value) >= 2 Then
    If Left(Range("C6").Value, 2) = "JV" Then Range("C6").Value = "JV" & AccountYear
   End If
  Call JNumRetrieve("DE")
  ThisWorkbook.Worksheets("Data Entry").Activate
  Range("C7").Value = Right(("00000" & Val(LastTranNo) + 1), 5)
 End If
  Range("C6").Select
End If
GoTo Finish
End If
If .Address = "$C$6" Then
 .Value = UCase(.Value)
  Call JNumRetrieve("DE")
  ThisWorkbook.Worksheets("Data Entry").Activate
  Range("C7").Value = Right("00000" & (Val(LastTranNo) + 1), 5)
  Worksheets("NewCom").Range("A4").Value = "Data Entry"
    Call Sorting("DE")
    Call RecordRetrieval("DE")
   Worksheets("NewCom").Range("A4").ClearContents
  Range("B11").Select
  GoTo Finish
End If
If .Column = 2 Then
 If .Row > 11 And (.Offset(-1, 0).Value = "" Or (.Offset(-1, 3).Value = 0 And .Offset(-1, 4).Value = 0)) Then
 .Value = ""
 .Offset(-1, 0).Select
 If ActiveCell.Value <> "" Then
 ActiveCell.Offset(0, 3).Select
 MsgBox ("No Amount was entered in Debit nor Credit columns")
 End If
 Else
 If .Value <> "" Then
   .NumberFormat = "General"
   .Value = UCase(.Value)
    Set COARange = Worksheets("Chart of Account").Range(Worksheets("Chart of Account").Cells(10, 1), Worksheets("Chart of Account").Cells(LastRowChartofAccount, 1))
  If IsError(Application.Match(.Value, COARange, 0)) Then
    .Offset(0, 1).Value = ""
    .Select
    MsgBox ("The Account number is not found in the Chart of Account")
   Selection.Value = ""
   GoTo Finish
  Else
   RowNo = Application.Match(.Value, COARange, 0) + 9
  If (Worksheets("Chart of Account").Cells(RowNo + 1, 1).Value = "" Or (Len(Worksheets("Chart of Account").Cells(RowNo + 1, 1).Value) <= Len(.Value))) And Len(.Value) <> 1 Then
   .Offset(0, 1).NumberFormat = "@"
   .Offset(0, 1).Value = Worksheets("Chart of Account").Cells(RowNo, 2).Value
   .Offset(1, 11).Value = "  "
   Else
    .Select
    .Offset(0, 1).Value = ""
   MsgBox ("It is not a DETAILED Account")
   Selection.Value = ""
   GoTo Finish
   End If
  End If
 End If
 If .Row > 11 Then
  .Offset(0, 2).Value = .Offset(-1, 2).Value
 .Offset(0, 2).Select
 ElseIf .Row = 11 Then
  .Offset(0, 2).Select
 End If
 End If
 If .Row > 11 Then
  Range("B11").Select
  TotalSum = 0
  Do While ActiveCell.Value <> ""
  TotalSum = TotalSum + ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
  Loop
  If .Offset(0, 3).Value = "" And .Offset(0, 4).Value = "" Then
   If TotalSum > 0 Then
    .Offset(0, 4).Value = TotalSum
   ElseIf TotalSum < 0 Then
    .Offset(0, 3).Value = (-1 * TotalSum)
   End If
  End If
  .Offset(0, 2).Select
 End If
If .Row > 10 And .Value = "" Then
 .Select
 ActiveCell.Value = ""
 ActiveCell.Offset(0, 1).Value = ""
 ActiveCell.Offset(0, 2).Value = ""
 ActiveCell.Offset(0, 3).Value = ""
 ActiveCell.Offset(0, 4).Value = ""
If .Offset(1, 0).Value <> "" Then
 Do While ActiveCell.Offset(1, 0).Value <> ""
 ActiveCell.Value = ActiveCell.Offset(1, 0).Value
 ActiveCell.Offset(0, 1).Value = ActiveCell.Offset(1, 1).Value
 ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(1, 2).Value
 ActiveCell.Offset(0, 3).Value = ActiveCell.Offset(1, 3).Value
 ActiveCell.Offset(0, 4).Value = ActiveCell.Offset(1, 4).Value
 ActiveCell.Offset(1, 0).Activate
 Loop
 ActiveCell.Value = ""
 ActiveCell.Offset(0, 1).Value = ""
 ActiveCell.Offset(0, 2).Value = ""
 ActiveCell.Offset(0, 3).Value = ""
 ActiveCell.Offset(0, 4).Value = ""
 .Select
 End If
 End If
 ElseIf .Column = 3 And .Row = 8 Then Range("B11").Select
 ElseIf .Column = 4 And .Row >= 11 Then
   If Len(.Value) > 150 Then
   .Value = Left(.Value, 150)
   End If
  .Offset(0, 1).Select
  ElseIf .Column = 5 Then
  If IsNumeric(.Value) = False Then
   .Select
   MsgBox ("Not a Valid Debit amount." & Chr(13) & "Please correct the entry")
   .ClearContents
   Range("B11").Select
  TotalSum = 0
  Do While ActiveCell.Value <> ""
  TotalSum = TotalSum + ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
  Loop
  If TotalSum > 0 Then .Value = (-1 * TotalSum)
    .Select
  GoTo Finish
  End If
  .Offset(0, 1).ClearContents
  .Value = CCur(.Value)
  .Offset(1, -3).Select
  ElseIf .Column = 6 Then
  If IsNumeric(.Value) = False Then
  .Select
  MsgBox ("Not a Valid Credit amount." & Chr(13) & "Please correct the entry")
   .ClearContents
  Range("B11").Select
  TotalSum = 0
  Do While ActiveCell.Value <> ""
  TotalSum = TotalSum + ActiveCell.Offset(0, 3).Value - ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
  Loop
  If TotalSum > 0 Then .Value = TotalSum
    .Select
   GoTo Finish
  End If
   .Offset(0, -1).ClearContents
   .Value = CCur(.Value)
  .Offset(1, -4).Select
 End If
 If .Address = "$C$7" Then
  If IsNumeric(Range("C7")) = False Then
    If Range("C6").Value <> "" Then
       Range("C7").Value = Right("00000" & (Val(LastTranNo) + 1), 5)
    Else
       Range("C7").Value = "00001"
    End If
  End If
 End If
 If .Address = "$C$7" And Range("C6").Value <> "" Then
  If Val(Range("C7").Value) > Val(LastTranNo) + 1 Then
    Range("C7").Value = Right("00000" & (Val(LastTranNo) + 1), 5)
    Worksheets("NewCom").Range("A4").Value = "Data Entry"
    Call Sorting("DE")
    Call RecordRetrieval("DE")
   Worksheets("NewCom").Range("A4").ClearContents
  Else
    Worksheets("NewCom").Range("A4").Value = "Data Entry"
    Call Sorting("DE")
    Call RecordRetrieval("DE")
   Worksheets("NewCom").Range("A4").ClearContents
  If Range("C2").Value = "" Then
     Range("C2").Select
   Else
    Range("B11").Select
   End If
  End If
 End If
End If
 GoTo Finish
ErrHandling:
  .Select
  MsgBox ("Incorrect Data Input." & Chr(13) & "Please correct the entry")
   GoTo Finish
ErrorHandling:
MsgBox ("You probably have inserted or deleted a row or a column which is not allowed." & Chr(13) & Chr(13) & "To avoid possible error, the program will REFRESH the data entry sheet." & Chr(13) & "Please re-enter the current entry again")
Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call NewEntrySheet
Worksheets("NewCom").Range("A4").ClearContents
Finish:
 End With
 SRow = ActiveCell.Row
 SColumn = ActiveCell.Column
  Application.EnableEvents = True
  Application.ScreenUpdating = True
End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim I As Long
Application.EnableCancelKey = xlDisabled
    Application.EnableEvents = False
    ActiveSheet.Name = "Data Entry"
If Range("B10").Value <> " --- Account ---" Or Range("C10").Value <> " ---------- Name ----------" Or Range("D10").Value <> " -------- Description --------" Or Range("E10").Value <> " ----- Debit -----" Or Range("F10").Value <> " ----- Credit -----" Then GoTo ErrorHandling
If Cells(TotalsRow, 2).Value <> "  " Or Cells(TotalsRow, 3).Value <> "   " Or Cells(TotalsRow, 4).Value <> "Totals:" Or Cells(TotalsRow + 1, 5).Value <> "     " Or Cells(TotalsRow + 1, 6).Value <> "      " Then GoTo ErrorHandling
If Range("M2").Value <> "  " Or Range("M6").Value <> "      " Or Range("M7").Value <> "       " Or Range("M8").Value <> "        " Then GoTo ErrorHandling
 I = Range("B10").CurrentRegion.Rows.Count + 9
 Do While I > 10
  If Cells(I, 13).Value <> "  " Then GoTo ErrorHandling
  I = I - 1
 Loop
With Target
 If .Rows.Count > 1 Or .Columns.Count > 1 Then
  Application.ScreenUpdating = False
   Range("B11").Select
   Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(1, 11).Value <> "  " Then
     Application.ScreenUpdating = True
     GoTo ErrorHandling
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
   Application.ScreenUpdating = True
  .Resize(1, 1).Select
 End If
  If SColumn = 2 And .Column = 3 And .Row < 9 And .Row > 5 Then
    ActiveCell.Select
  Else
   If .Row < SRow Or .Column < SColumn Then Call MoveUp("DE")
   If .Row > SRow Or .Column > SColumn Then
     Call MoveDown("DE")
   ElseIf .Row = SRow And .Column = 2 Then
    Call MoveDown("DE")
   End If
  End If
End With
 SRow = ActiveCell.Row
 SColumn = ActiveCell.Column
  Application.EnableEvents = True
  Exit Sub
ErrorHandling:
MsgBox ("You probably inserted or deleted a row or a column which is not allowed." & Chr(13) & Chr(13) & "To avoid possible error, the program will REFRESH the data entry sheet." & Chr(13) & "Please re-enter the current entry again")
Worksheets("NewCom").Range("A4").Value = "Data Entry"
 Call NewEntrySheet
Worksheets("NewCom").Range("A4").ClearContents
  Application.EnableEvents = True
End Sub
Attribute VB_Name = "Sheet20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 2, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 3, 2, MSForms, CommandButton"
Attribute VB_Control = "CommandButton4, 4, 3, MSForms, CommandButton"
Attribute VB_Control = "CommandButton5, 5, 4, MSForms, CommandButton"
Private Sub CommandButton1_Click()
Dim LineNo As Long, I As Long, FontName As String, FontType As String, FontSize As Double
Application.ScreenUpdating = False
ActiveSheet.Name = "Invoice"
Application.EnableEvents = False
On Error Resume Next
   If Range("A1").Value <> "" Then
      I = Len(Range("A1").Value)
      If I > 2 Then
       With Range("A1").Characters(Start:=1, Length:=1).Font
        FontName = .Name
        FontType = .FontStyle
        FontSize = .Size
       End With
        MyBook.Worksheets("ComData").Range("G1").Value = FontName
        MyBook.Worksheets("ComData").Range("H1").Value = FontType
        MyBook.Worksheets("ComData").Range("I1").Value = FontSize
       With Range("A1").Characters(Start:=I - 1, Length:=1).Font
        FontName = .Name
        FontType = .FontStyle
        FontSize = .Size
       End With
        MyBook.Worksheets("ComData").Range("G2").Value = FontName
        MyBook.Worksheets("ComData").Range("H2").Value = FontType
        MyBook.Worksheets("ComData").Range("I2").Value = FontSize
      End If
   End If
   With ActiveSheet.PageSetup
      MyBook.Worksheets("ComData").Range("K1").Value = .PaperSize
      MyBook.Worksheets("ComData").Range("L1").Value = .Orientation
      MyBook.Worksheets("ComData").Range("M1").Value = .Zoom
      MyBook.Worksheets("ComData").Range("N1").Value = .LeftMargin
      MyBook.Worksheets("ComData").Range("O1").Value = .RightMargin
      MyBook.Worksheets("ComData").Range("P1").Value = .TopMargin
      MyBook.Worksheets("ComData").Range("Q1").Value = .BottomMargin
      MyBook.Worksheets("ComData").Range("R1").Value = .HeaderMargin
      MyBook.Worksheets("ComData").Range("S1").Value = .FooterMargin
   End With
Worksheets("System Menu").Visible = xlSheetVisible
Worksheets("Invoice").Visible = xlSheetVeryHidden
On Error GoTo ErrorHandling
MyBook.Activate
ThisWorkbook.Worksheets("System Menu").Activate
Application.ScreenUpdating = True
SheetName = "System Menu"
DoEvents
Application.ScreenUpdating = False
 LineNo = Userform6.ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
 For I = 1 To 6
  Userform6.Controls("Label" & I + 14).Caption = LineNo + I - 1
  Userform6.Controls("TextBox" & I * 5).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 4).Value
  Userform6.Controls("TextBox" & I * 5 + 1).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 5).Value
  Userform6.Controls("TextBox" & I * 5 + 2).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 6).Value
  Userform6.Controls("TextBox" & I * 5 + 3).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 7).Value
  Userform6.Controls("Label" & I + 40).Caption = Format(Worksheets("TempRP").Cells(LineNo + 121 + I, 8).Value, "#,##0.00")
  Next I
 Call Form6AmountRefresh("")
 Userform6.Label23.Visible = False
 Application.EnableEvents = True
 Userform6.Show
 Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem")
 Call ReturnToMainMenu("")
End Sub
Private Sub CommandButton2_Click()
Dim I  As Long, LastRow As Long
ThisWorkbook.Worksheets("Invoice").Activate
ActiveSheet.Name = "Invoice"
SheetName = "Invoice"
Application.EnableEvents = False
Application.ScreenUpdating = False
ActiveSheet.UsedRange.EntireRow.Hidden = False
LastRow = ActiveSheet.UsedRange.Rows.Count
If CommandButton2.Caption = "Invoice Only" Then
 I = 47
 Do While I <= LastRow
  Range(Cells(I, 1), Cells(I + 44, 1)).EntireRow.Hidden = True
  I = I + 90
 Loop
 CommandButton2.Caption = "Invoice & Delivery Note"
 CommandButton3.Caption = "Delivery Note Only"
Else
 I = 47
 Do While I <= LastRow
  I = I + 45
 Loop
 CommandButton2.Caption = "Invoice Only"
 CommandButton3.Caption = "Delivery Note Only"
End If
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A2").Select
 Application.EnableEvents = True
End Sub
Private Sub CommandButton3_Click()
Dim I  As Long, LastRow As Long
ThisWorkbook.Worksheets("Invoice").Activate
ActiveSheet.Name = "Invoice"
SheetName = "Invoice"
Application.EnableEvents = False
Application.ScreenUpdating = False
ActiveSheet.UsedRange.EntireRow.Hidden = False
LastRow = ActiveSheet.UsedRange.Rows.Count
If CommandButton3.Caption = "Delivery Note Only" Then
 Range("A47").Select
 I = 2
 Do While I <= LastRow
  Range(Cells(I, 1), Cells(I + 44, 1)).EntireRow.Hidden = True
  I = I + 90
 Loop
 CommandButton3.Caption = "Invoice & Delivery Note"
 CommandButton2.Caption = "Invoice Only"
 Application.ScreenUpdating = True
 Range("A47").Select
 Range("A48").Select
Else
 I = 47
 Do While I <= LastRow
  I = I + 45
 Loop
 CommandButton3.Caption = "Delivery Note Only"
 CommandButton2.Caption = "Invoice Only"
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A2").Select
End If
 Application.EnableEvents = True
End Sub
Private Sub CommandButton4_Click()
ActiveSheet.Name = "Invoice"
Application.ScreenUpdating = False
Application.EnableEvents = False
On Error GoTo ErrorHandling
UserForm30.Show
Application.EnableEvents = True
Application.ScreenUpdating = True
ThisWorkbook.Worksheets("Invoice").Activate
Range("A2").Select
Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem")
 Call ReturnToMainMenu("")
End Sub
Private Sub CommandButton5_Click()
Dim Sh As Shape
ActiveSheet.Name = "Invoice"
Application.ScreenUpdating = False
Application.EnableEvents = False
On Error GoTo ErrorHandling
For Each Sh In ActiveSheet.Shapes
 If Sh.Type = msoPicture Then Sh.Delete
Next
Range("A1").ColumnWidth = 5.25
Range("B1").ColumnWidth = 15
Range("C1").ColumnWidth = 14.5
Range("D1").ColumnWidth = 12.25
Range("E1").ColumnWidth = 1.25
Range("F1").ColumnWidth = 12.13
Range("G1").ColumnWidth = 8.5
Range("H1").ColumnWidth = 13
Range("I1").ColumnWidth = 13
If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "INVOICE " Then
  Call MLInvoice("Invoice")
ElseIf Userform6.Label1.Caption = "SALES ORDER" Or Userform6.Label1.Caption = "SALES ORDER " Then
  Call MLCN("PI")
Else
  Call MLCN("CN")
End If
Range("A1:K18").Select
ActiveWindow.Zoom = True
Worksheets("Invoice").CommandButton4.Visible = False
Worksheets("Invoice").CommandButton5.Visible = False
Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
Application.EnableEvents = True
Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem")
 Call ReturnToMainMenu("")
End Sub

Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 2, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 3, 2, MSForms, CommandButton"
Private Sub CommandButton1_Click()
Dim LineNo As Long, I As Long, FontName As String, FontType As String, FontSize As Double
Application.ScreenUpdating = False
ActiveSheet.Name = "PO"
Application.EnableEvents = False
On Error Resume Next
   If Range("A1").Value <> "" Then
      I = Len(Range("A1").Value)
      If I > 2 Then
       With Range("A1").Characters(Start:=1, Length:=1).Font
        FontName = .Name
        FontType = .FontStyle
        FontSize = .Size
       End With
        MyBook.Worksheets("ComData").Range("G1").Value = FontName
        MyBook.Worksheets("ComData").Range("H1").Value = FontType
        MyBook.Worksheets("ComData").Range("I1").Value = FontSize
       With Range("A1").Characters(Start:=I - 1, Length:=1).Font
        FontName = .Name
        FontType = .FontStyle
        FontSize = .Size
       End With
        MyBook.Worksheets("ComData").Range("G2").Value = FontName
        MyBook.Worksheets("ComData").Range("H2").Value = FontType
        MyBook.Worksheets("ComData").Range("I2").Value = FontSize
      End If
   End If
   With ActiveSheet.PageSetup
      MyBook.Worksheets("ComData").Range("K2").Value = .PaperSize
      MyBook.Worksheets("ComData").Range("L2").Value = .Orientation
      MyBook.Worksheets("ComData").Range("M2").Value = .Zoom
      MyBook.Worksheets("ComData").Range("N2").Value = .LeftMargin
      MyBook.Worksheets("ComData").Range("O2").Value = .RightMargin
      MyBook.Worksheets("ComData").Range("P2").Value = .TopMargin
      MyBook.Worksheets("ComData").Range("Q2").Value = .BottomMargin
      MyBook.Worksheets("ComData").Range("R2").Value = .HeaderMargin
      MyBook.Worksheets("ComData").Range("S2").Value = .FooterMargin
   End With
Worksheets("System Menu").Visible = xlSheetVisible
Worksheets("PO").Visible = xlSheetVeryHidden
 On Error GoTo ErrorHandling
 MyBook.Activate
 ThisWorkbook.Worksheets("System Menu").Activate
Application.ScreenUpdating = True
SheetName = "System Menu"
DoEvents
Application.ScreenUpdating = False
 LineNo = UserForm15.ScrollBar1.Value
 For I = 1 To 6
  UserForm15.Controls("Label" & I + 14).Caption = LineNo + I - 1
  UserForm15.Controls("TextBox" & I * 5).Text = Worksheets("TempRP").Cells(LineNo + 41 + I, 4).Value
  UserForm15.Controls("TextBox" & I * 5 + 1).Text = Worksheets("TempRP").Cells(LineNo + 41 + I, 5).Value
  UserForm15.Controls("TextBox" & I * 5 + 2).Text = Worksheets("TempRP").Cells(LineNo + 41 + I, 6).Value
  UserForm15.Controls("TextBox" & I * 5 + 3).Text = Worksheets("TempRP").Cells(LineNo + 41 + I, 7).Value
  UserForm15.Controls("TextBox" & I * 5 + 4).Text = Worksheets("TempRP").Cells(LineNo + 41 + I, 8).Value
  UserForm15.Controls("Label" & I + 26).Caption = Format(Worksheets("TempRP").Cells(LineNo + 41 + I, 9).Value, "#,##0.00")
  UserForm15.Controls("Label" & I + 32).Caption = Worksheets("TempRP").Cells(LineNo + 41 + I, 11).Value
  UserForm15.Controls("TextBox" & I + 34).Text = Worksheets("TempRP").Cells(LineNo + 41 + I, 12).Value
 Next I
 Call Form15AmountRefresh("")
 UserForm15.Label23.Visible = False
 Application.EnableEvents = True
 UserForm15.Show
 Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem")
 Call ReturnToMainMenu("")
End Sub

Private Sub CommandButton2_Click()
ActiveSheet.Name = "PO"
Application.ScreenUpdating = False
Application.EnableEvents = False
On Error GoTo ErrorHandling
UserForm30.Show
Application.EnableEvents = True
Application.ScreenUpdating = True
ThisWorkbook.Worksheets("PO").Activate
Range("A2").Select
Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem")
 Call ReturnToMainMenu("")
End Sub

Private Sub CommandButton3_Click()
Dim Sh As Shape
ActiveSheet.Name = "PO"
Application.ScreenUpdating = False
Application.EnableEvents = False
On Error GoTo ErrorHandling
For Each Sh In ActiveSheet.Shapes
 If Sh.Type = msoPicture Then Sh.Delete
Next
Range("A1").ColumnWidth = 5.25
Range("B1").ColumnWidth = 15
Range("C1").ColumnWidth = 31.88
Range("D1").ColumnWidth = 0.85
Range("E1").ColumnWidth = 7.63
Range("F1").ColumnWidth = 8.5
Range("G1").ColumnWidth = 13
Range("H1").ColumnWidth = 8
Range("I1").ColumnWidth = 13
If UserForm15.Label1.Caption = "PURCHASE ORDER" Or UserForm15.Label1.Caption = "PURCHASE ORDER " Then
  Call MLPO("PO")
Else
 Call MLPO("DN")
End If

ThisWorkbook.Worksheets("PO").Activate
Range("A1:K18").Select
ActiveWindow.Zoom = True
ActiveSheet.CommandButton2.Visible = False
ActiveSheet.CommandButton3.Visible = False
Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
Application.EnableEvents = True
Exit Sub
ErrorHandling:
 MsgBox ("System Error!!!" & Chr(13) & Chr(13) & "Error Found. Data File Problem")
 Call ReturnToMainMenu("")
End Sub


Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
' Acctfile Created by Vitus Tse of Mark-Motum Co. Ltd.
' Version A02A
Private Sub Workbook_BeforeClose(Cancel As Boolean)
Dim MySheet As Worksheet, Myform As UserForm
On Error Resume Next
Application.EnableCancelKey = xlDisabled
Application.ScreenUpdating = False
Application.EnableEvents = False
ThisWorkbook.ActiveSheet.Name = SheetName
If ActiveSheet.Name <> "System Menu" Then
 Cancel = True
 Select Case OldForm
  Case "UserForm8"
   On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
    Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   Application.ScreenUpdating = False
   UserForm8.Show
  Exit Sub
 Case "UserForm6"
   On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
    Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   Application.ScreenUpdating = False
   Userform6.Show
  Exit Sub
 Case "UserForm15"
    On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
   Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   Application.ScreenUpdating = False
   UserForm15.Show
  Exit Sub
 Case "UserForm25"
   On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
    Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    Application.EnableEvents = False
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   Application.ScreenUpdating = False
   UserForm25.Show
  Exit Sub
 Case "UserForm26"
      On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
    Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    Application.EnableEvents = False
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   Application.ScreenUpdating = False
   UserForm26.Show
  Exit Sub
 Case "UserForm27"
      On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
    Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   Application.ScreenUpdating = False
   UserForm27.Show
  Exit Sub
 Case "UserForm28"
    On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
    Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
     Application.ScreenUpdating = False
   UserForm28.Show
  Exit Sub
 Case "UserForm29"
      On Error GoTo ErrorHandling
   MyBook.Activate
   ThisWorkbook.Worksheets("System Menu").Activate
    Worksheets("System Menu").Visible = xlSheetVisible
   For Each MySheet In Worksheets
    If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
   Next
   Application.ScreenUpdating = True
   Application.EnableEvents = False
   Worksheets("System Menu").Activate
   SheetName = "System Menu"
   OldForm = ""
   DoEvents
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.EnableEvents = True
   Application.ScreenUpdating = False
   UserForm29.Show
  Exit Sub
 End Select
 Call ReturnToMainMenu("")
 On Error GoTo 0
 Exit Sub
End If
  ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
  For Each Myform In UserForms
   Unload Myform
   Application.EnableEvents = False
  Next
Application.Caption = ""
ActiveWindow.Caption = ActiveWorkbook.Name
Application.DisplayAlerts = False
MyBook.Activate
If MyBook.Worksheets("Raw Data").Range("B1").Value = "ReadOnly" Or MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
   MyBook.Close (False)
 Else
  MyBook.Save
  MyBook.Close
 End If
ThisWorkbook.Saved = True
On Error GoTo 0
 Application.EnableEvents = True
 Application.DisplayAlerts = True
 Exit Sub
ErrorHandling:
Call ReturnToMainMenu("")
End Sub
Private Sub Workbook_Open()
Dim DataFileName As String, FilePath As String, I As Long, InsDate As Date, X As Double, Y As Double
Dim MySheet As Worksheet, DriveSN As Long, DriveCode As String
Dim myFSO As Object
Application.EnableCancelKey = xlDisabled
  Application.EnableEvents = False
  Application.ScreenUpdating = False
  On Error GoTo WrongSystemFile
   I = ThisWorkbook.Worksheets.Count
   If I < 21 Then GoTo WrongSystemFile
    Worksheets("NewCom").Activate
    Worksheets("System Menu").Activate
    Worksheets("Chart of Account").Activate
    Worksheets("ComFactSheet").Activate
     Cells(1, 3).Value = "2"
     Cells(2, 3).Value = "321"
    Worksheets("RunningDat").Activate
    Worksheets("Activity Report").Activate
    Worksheets("Journal").Activate
    Worksheets("Income Statement").Activate
    Worksheets("Balance Sheet").Activate
    Worksheets("Report").Activate
    Worksheets("Trial Balance").Activate
    Worksheets("Data Entry").Activate
    Worksheets("IniData").Activate
    Worksheets("StdCOA").Activate
    Worksheets("TempRP").Activate
    Worksheets("CNForm").Activate
    Worksheets("InvForm").Activate
    Worksheets("Invoice").Activate
    Worksheets("RecForm").Activate
    Worksheets("POForm").Activate
    Worksheets("PO").Activate
  On Error GoTo 0
   FilePath = "M"
   DataFileName = "DE"
If Worksheets("ComFactSheet").Range("B9").Value = "" Then
 MsgBox ("The system has not been properly installed." & Chr(13) & "Please proceed SETUP first by double clicking the 'Setup' file of the original software supplied")
 Application.Quit
 Exit Sub
Else
FilePath = FilePath & Worksheets("ComFactSheet").Range("C1").Value
DataFileName = DataFileName & Worksheets("ComFactSheet").Range("C2").Value
Worksheets("ComFactSheet").Cells(9, 2).Value = Worksheets("ComFactSheet").Range(DataFileName).Value
Worksheets("ComFactSheet").Cells(2, 3).Value = Worksheets("ComFactSheet").Range(FilePath).Value
DataFileName = Left(DataFileName, 2) & "123"
FilePath = Left(FilePath, 1) & "1"
Worksheets("ComFactSheet").Cells(16, 2).Value = Worksheets("ComFactSheet").Range(FilePath).Value
FilePath = Left(FilePath, 1) & "3"
Worksheets("ComFactSheet").Cells(11, 3).Value = Worksheets("ComFactSheet").Range(DataFileName).Value
End If
Application.OnKey "{F5}", "ESCToMainMenu"
EventOff = False
ThisWorkbook.Worksheets("System Menu").Activate
Worksheets("System Menu").Visible = xlSheetVisible
Range("B9:B10").ClearContents
Range("G12").ClearContents
Range("G13").ClearContents
Worksheets("System Menu").CommandButton1.Visible = True
Worksheets("System Menu").CommandButton2.Visible = True
Worksheets("System Menu").CommandButton3.Visible = True
For Each MySheet In Worksheets
If MySheet.Name <> "System Menu" Then MySheet.Visible = xlSheetVeryHidden
Next
On Error Resume Next
DriveCode = Left(ThisWorkbook.Path, 1)
DriveSN = 0
Set myFSO = CreateObject("Scripting.FileSystemObject")
DriveCode = myFSO.GetDrive(DriveCode).SerialNumber
If Len(DriveCode) > 3 Then
DriveSN = Val(Right(DriveCode, 3))
Else
DriveSN = Abs(Val(DriveCode))
End If
I = Workbooks.Count
Do While I > 0
If Workbooks(I).Name = "Setup.xls" Then Exit Do
I = I - 1
Loop
If I <> 0 Then MsgBox ("Installation has successfully completed" & Chr(13) & "Please click 'OK' to start the program.")
Worksheets("ComFactSheet").Range("C16").ClearContents
If Not (Worksheets("ComFactSheet").Range("B10") = "Activated") Then
If DriveSN <> Worksheets("ComFactSheet").Range("C11").Value Then
  DriveCode = InsCode(DriveSN)
  Worksheets("ComFactSheet").Range("B12").Value = DriveCode
  Worksheets("ComFactSheet").Range(FilePath).Value = KNum(DriveCode)
 End If
InsDate = Worksheets("ComFactSheet").Range("B9").Value
If (Date - InsDate) > 90 Then
Worksheets("System Menu").CommandButton1.Visible = False
Worksheets("System Menu").CommandButton2.Visible = False
Worksheets("System Menu").CommandButton3.Visible = False
Worksheets("System Menu").Range("B9").Value = "The allowable Free Trial period has expired.  Only limited functions are allowed."
Worksheets("ComFactSheet").Range("C16").Value = "Expired"
Worksheets("System Menu").Hyperlinks.Add Anchor:=Worksheets("System Menu").Range("B10:C10"), Address:="http://mark-motum.com/product.html", _
         TextToDisplay:="   Visit www.mark-motum.com to obtain information about Software Activation"
        With Worksheets("System Menu").Range("B10")
        .Font.ColorIndex = 32
        .Font.Underline = xlUnderlineStyleNone
        End With
        With Worksheets("System Menu").Range("B9:B10").Font
        .Name = "Arial"
        .FontStyle = "Bold"
        .Size = 16
        End With
Else
I = 90 - Date + InsDate
Worksheets("System Menu").Range("G12").Value = "Free Trial Version"
Worksheets("System Menu").Range("G13").Value = "Trial Period Left : " & I & " days"
End If
ElseIf Worksheets("ComFactSheet").Range("C2") <> "Yes" Then
If DriveSN <> Worksheets("ComFactSheet").Range("C11").Value Then
  DriveCode = InsCode(DriveSN)
  Worksheets("ComFactSheet").Range("B12").Value = DriveCode
  Worksheets("ComFactSheet").Range(FilePath).Value = KNum(DriveCode)
 End If
InsDate = Worksheets("ComFactSheet").Range("B9").Value
If (Date - InsDate) > 90 Then
Worksheets("System Menu").CommandButton1.Visible = False
Worksheets("System Menu").CommandButton2.Visible = False
Worksheets("System Menu").CommandButton3.Visible = False
Worksheets("System Menu").Range("B9").Value = "The allowable Free Trial period has expired.  Only limited functions are allowed."
Worksheets("ComFactSheet").Range("C16").Value = "Expired"
Worksheets("System Menu").Hyperlinks.Add Anchor:=Worksheets("System Menu").Range("B10:C10"), Address:="http://mark-motum.com/product.html", _
         TextToDisplay:="   Visit www.mark-motum.com to obtain information about Software Activation"
       With Worksheets("System Menu").Range("B10")
        .Font.ColorIndex = 32
        .Font.Underline = xlUnderlineStyleNone
        End With
        With Worksheets("System Menu").Range("B9:B10").Font
        .Name = "Arial"
        .FontStyle = "Bold"
        .Size = 16
        End With
Else
I = 90 - Date + InsDate
Worksheets("System Menu").Range("G12").Value = "Free Trial Version"
Worksheets("System Menu").Range("G13").Value = "Trial Period Left : " & I & " days"
End If
Else
If DriveSN <> Worksheets("ComFactSheet").Range("C11").Value Then
DriveCode = InsCode(DriveSN)
Worksheets("ComFactSheet").Range("B12").Value = DriveCode
Worksheets("System Menu").CommandButton1.Visible = False
Worksheets("System Menu").CommandButton2.Visible = False
Worksheets("System Menu").CommandButton3.Visible = False
Worksheets("ComFactSheet").Range(FilePath).Value = KNum(DriveCode)
Worksheets("ComFactSheet").Range("A17").ClearContents
Worksheets("System Menu").Range("B9").Value = "SYSTEM ERROR!!!   Improper system setup was detected.  Only limited functions are allowed."
Worksheets("ComFactSheet").Range("C16").Value = "Expired"
Worksheets("System Menu").Hyperlinks.Add Anchor:=Worksheets("System Menu").Range("B10:C10"), Address:="http://mark-motum.com/product.html", _
         TextToDisplay:="   Visit www.mark-motum.com to obtain information about Software Activation"
       With Worksheets("System Menu").Range("B10")
        .Font.ColorIndex = 32
        .Font.Underline = xlUnderlineStyleNone
        End With
        With Worksheets("System Menu").Range("B9:B10").Font
        .Name = "Arial"
        .FontStyle = "Bold"
        .Size = 16
        End With
End If
Worksheets("ComFactSheet").Range("C3").Value = Worksheets("ComFactSheet").Range("C11").Value
Worksheets("ComFactSheet").Range("C11").Value = DriveSN
End If
On Error GoTo 0
Application.Caption = "MARK-MOTUM COMPANY LIMITED"
ActiveWindow.Caption = "MMT Account"
 If Right(Worksheets("ComFactSheet").Range("B16").Value, 2) = "RP" Then
   Worksheets("System Menu").Range("B2").Select
   ActiveCell.Value = "Main System Menu --- Accounting, Sales, Purchases & Material Planning"
   With ActiveCell.Characters(Start:=22, Length:=48).Font
        .Underline = xlUnderlineStyleSingle
    End With
 Else
   Worksheets("System Menu").Range("B2").Select
   ActiveCell.Value = "Main System Menu --- General Ledger Accounting"
   With ActiveCell.Characters(Start:=22, Length:=25).Font
        .Underline = xlUnderlineStyleSingle
    End With
 End If
 Set MyBook = Nothing
 Worksheets("System Menu").Activate
 With Range("B5:C5").Font
        .Name = "Arial"
        .FontStyle = "Bold"
        .Size = 13
        .Underline = xlUnderlineStyleNone
        .ColorIndex = xlAutomatic
  End With
  With Range("C5")
        .HorizontalAlignment = xlLeft
        .VerticalAlignment = xlTop
   End With
   With Range("B5")
        .HorizontalAlignment = xlRight
        .VerticalAlignment = xlTop
   End With
 DataSheetReturn = ""
 Worksheets("ComFactSheet").Activate
  Range("A17").Value = Range("A18").Value
  Range("B17").Value = Range("B18").Value
  Range("C17").Value = Range("C18").Value
 Application.WindowState = xlMaximized
 ActiveWindow.WindowState = xlMaximized
 Application.EnableEvents = True
 Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.ScreenUpdating = False
  Call ReFresh("GL")
 Application.EnableEvents = False
  ThisWorkbook.Worksheets("System Menu").Activate
 On Error Resume Next
 Call FileOpenBkUp("")
FormZoom = 100
On Error GoTo NoResize
X = Application.Width
Y = Application.Height
X = X * 100 / 735
Y = Y * 100 / 540
 If Y < X Then
   FormZoom = Y
 Else
   FormZoom = X
 End If
If FormZoom > 160 Then
  FormZoom = 130
ElseIf FormZoom > 150 Then
  FormZoom = 120
ElseIf FormZoom > 130 Then
  FormZoom = 110
ElseIf FormZoom > 100 Then
  FormZoom = 100
End If
NoResize:
ThisWorkbook.Worksheets("System Menu").Activate
Worksheets("ComFactSheet").Range("C1").Value = FormZoom
On Error GoTo ShowMenu
 If ThisWorkbook.Worksheets("ComFactSheet").Range("B8").Value <> "" Then
  AuthorStatus = False
  UserForm99.Show
  If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
  End If
 Else
  AuthorStatus = True
 End If
ShowMenu:
ThisWorkbook.Worksheets("System Menu").Activate
Application.ScreenUpdating = True
Range("A1").Select
Range("C4").Select
Application.EnableEvents = True
 Exit Sub
WrongSystemFile:
 MsgBox ("System Error !!!" & Chr(13) & Chr(13) & "     File Corrupted. System is going to quit.")
 Application.Quit
End Sub
Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As Boolean)
If EventOff = True Then Exit Sub
 Cancel = True
End Sub
Attribute VB_Name = "UserForm1"
Attribute VB_Base = "0{D9AC5E56-A051-414B-9E81-B3230F76098A}{4B7D5A20-27E1-474F-98BC-4A293C66A48F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 Unload Me
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm5.Show
End Sub
Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Worksheets("NewCom").UsedRange.Delete
UserForm2.Show
End Sub
Private Sub CommandButton4_Click()
Dim KeyCode As String
Application.EnableCancelKey = xlDisabled
 EventOff = False
 KeyCode = TextBox5.Text
 Call UpdateBalance("IniData")
 Call JNumRetrieve(KeyCode)
 Call Sorting("Key")
 Call ReFresh(KeyCode)
 Call ESCToMainMenu
 EventOff = False
End Sub
Private Sub CommandButton3_Click()
Dim NewDate As Date, OldDate As Date
Application.EnableCancelKey = xlDisabled
MyBook.Activate
Worksheets("ComData").Activate
Range("B3:B5").NumberFormat = "@"
Range("C1:C4").NumberFormat = "@"
Range("B3").Value = TextBox2.Text
Range("B4").Value = TextBox3.Text
Range("B5").Value = TextBox4.Text
Range("C1").Value = TextBox6.Text
Range("C2").Value = TextBox7.Text
Range("C3").Value = TextBox9.Text
Range("C4").Value = TextBox10.Text
On Error Resume Next
 MyBook.Save
 On Error GoTo 0
ThisWorkbook.Worksheets("System Menu").Activate
MsgBox ("Completed")
End Sub
Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
 ThisWorkbook.Worksheets("System Menu").Activate
 Unload UserForm1
 Application.EnableEvents = True
 Worksheets("IniData").Visible = xlSheetVisible
 Worksheets("System Menu").Visible = xlSheetVeryHidden
 Worksheets("IniData").CommandButton3.Visible = False
 Worksheets("IniData").Activate
 SheetName = "IniData"
End Sub
Private Sub CommandButton5_Click()
Application.EnableCancelKey = xlDisabled
Call NewAddress("New")
End Sub
Private Sub CommandButton7_Click()
Application.EnableCancelKey = xlDisabled
Unload UserForm1
Call ReturnToMainMenu("")
End Sub
Private Sub CommandButton8_Click()
Dim FileNo As String
   ChDir ThisWorkbook.Path
   FileNo = Application.GetOpenFilename(",*.png;*.bmp;*.gif;*.tif;*.jpg")
   If UCase(FileNo) <> "FALSE" Then TextBox9.Text = FileNo
End Sub
Private Sub CommandButton9_Click()
Dim Code1 As String, Code2 As String
Application.EnableCancelKey = xlDisabled
Code1 = TextBox11.Text
Code2 = TextBox12.Text
If Code1 = Code2 Then
 If Code1 = "" And Code2 = "" Then
AskReply:
   MSG = "  You Choose to remove Password Protection    " + Chr(13) + Chr(13) + "  Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo NoCode
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
     GoTo AskReply
 End If
NoCode:
 TextBox11.Text = ""
 TextBox12.Text = ""
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("ComFactSheet").Activate
 If Range("B8").Value <> Code1 Then
  Range("B8").NumberFormat = "@"
  Range("B8").Value = Code1
  ThisWorkbook.Worksheets("System Menu").Activate
  ThisWorkbook.Save
 Else
  ThisWorkbook.Worksheets("System Menu").Activate
 End If
 Application.EnableEvents = True
 MsgBox ("   New Password Updated   ")
 Exit Sub
End If
If Code1 = "" Then
 MsgBox ("  New Password was not properly entered  ")
 Exit Sub
ElseIf Code2 = "" Then
 MsgBox ("  Please re-enter the Password for validation  ")
 Exit Sub
End If
 If Code1 <> Code2 Then MsgBox (" Wrong Password.   The two inputs are not the same   ")
End Sub
Private Sub UserForm_Initialize()
Dim myFSO As Object, YearEnd As Date, AddNo As Long, A As String, B As String, C As String
Application.EnableCancelKey = xlDisabled
EventOff = True
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
BeginningDate = MyBook.Worksheets("Raw Data").Range("A1").Value
YearEnd = ((Year(BeginningDate) + 1) & "/" & Month(BeginningDate) & "/" & Day(BeginningDate))
YearEnd = YearEnd - 1
A = "Commandbutton"
B = "TextBox"
C = "ve the K"
If MyBook.Worksheets("ComData").Range("B2").Value <> "" Then
 Label1.Caption = "Company Name :  " & MyBook.Worksheets("ComData").Range("B2").Value
 TextBox2.Text = MyBook.Worksheets("ComData").Range("B3").Value
 TextBox3.Text = MyBook.Worksheets("ComData").Range("B4").Value
 TextBox4.Text = MyBook.Worksheets("ComData").Range("B5").Value
 TextBox9.Text = MyBook.Worksheets("ComData").Range("C3").Value
 TextBox10.Text = MyBook.Worksheets("ComData").Range("C4").Value
 Label5.Caption = "Year End Month : " & MyBook.Worksheets("ComData").Range("B6").Value
 Label16.Caption = "Currency : " & SysCurrency
 Label14.Caption = Worksheets("ComFactSheet").Range("B15").Value & MyBook.Worksheets("ComData").Range("A7").Value
End If
If Not (MyBook.Worksheets("ComData").Range("B7").Value <> "Yes" And MyBook.Worksheets("ComData").Range("C1").Value = "" And MyBook.Worksheets("ComData").Range("C2").Value = "") Then
 TextBox6.Text = MyBook.Worksheets("ComData").Range("C1").Value
 TextBox7.Text = MyBook.Worksheets("ComData").Range("C2").Value
End If
If MyBook.Worksheets("ComData").Range("B7").Value = "Yes" Then
  CommandButton2.Visible = False
  Label7.Visible = False
    Label17.Caption = "Accounting Year : " & Year(BeginningDate) & "-" & Month(BeginningDate) & "-" & Day(BeginningDate) & "   to   " _
       & Year(YearEnd) & "-" & Month(YearEnd) & "-" & Day(YearEnd)
  Label17.Visible = True
 Else
  CommandButton1.Visible = False
  CommandButton6.Visible = False
  Label17.Visible = False
End If
 A = A & "5"
 With Controls(A)
  .Left = 450
  .Top = 360
  .Width = 90
   B = B & "8"
   C = "Sa" & C
 End With
 With Controls(B)
  .Left = 312
  .Top = 366
  .BackColor = &H80000008
  .Visible = True
   C = C & "ey"
 End With
 Controls(A).Caption = C
  ThisWorkbook.Worksheets("ComFactSheet").Activate
If Range("C2").Value = "Yes" And Range("B10").Value = "Activated" And Range("C3").Value = Range("C11").Value Then
  Controls(B).Visible = False
  Controls(A).Visible = False
  Label9.BackColor = &H4000&
  Label9.ForeColor = &HFFFF&
  If Right(Worksheets("ComFactSheet").Range("B16").Value, 2) = "RP" Then
    Label9.Caption = "MMT Account-Business " & Chr(13) & "Activated"
  Else
    Label9.Caption = "MMT Account-Basic " & Chr(13) & "Activated"
  End If
  Label9.Top = 319
  Label9.Left = 354
  Label12.Caption = "Serial Number : " & Worksheets("ComFactSheet").Range("B11").Value
  Label12.Left = 354
  Label14.Left = 354
 Else
  Label12.Caption = "Installation Code : " & Range("B12").Value
 End If
 Set myFSO = CreateObject("Scripting.FileSystemObject")
 If Left(Worksheets("ComFactSheet").Range("B16").Value, 5) <> "Multi" Then CommandButton6.Visible = False
 If Right(Worksheets("ComFactSheet").Range("B16").Value, 2) <> "RP" Then
   Label18.Visible = False
   TextBox6.Visible = False
   TextBox7.Visible = False
 End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  CommandButton1.Visible = False
  CommandButton6.Visible = False
 End If
 If ThisWorkbook.Worksheets("System Menu").CommandButton1.Visible = False Or FileStatus = "ReadOnly" Then
  CommandButton1.Visible = False
  CommandButton2.Visible = False
  CommandButton3.Visible = False
  CommandButton6.Visible = False
 End If
 CommandButton7.SetFocus
 EventOff = False
 ThisWorkbook.Worksheets("System Menu").Activate
End Sub
Private Sub UserForm_Terminate()
ThisWorkbook.Worksheets("System Menu").Activate
End Sub
Attribute VB_Name = "UserForm10"
Attribute VB_Base = "0{FAA5BEE6-5F2D-458B-843A-4A30964B00B1}{F1F70A49-F35A-4463-B935-342EAD64EF72}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
Dim EndNo As Long, COARange As Range, I As Long, AccountCode As Variant, MyRange() As Variant, AcctNo As String
Application.EnableCancelKey = xlDisabled
 ListBox2.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
 ListBox5.Visible = False
If TextBox1.Value = "" Or Label12.Caption = "" Then
 Label11.Caption = Chr(13) & "    Please enter the A/R Debtor Account #"
 Label11.Visible = True
 Exit Sub
Else
 If Left(TextBox1.Text, 1) <> 1 Then
   UserForm10.Label11.Caption = Chr(13) & "    Incorrect account type for the A/R Debtor Account "
   UserForm10.Label11.Visible = True
   Exit Sub
  End If
End If
If TextBox2.Value = "" Or Label13.Caption = "" Then
 Label11.Caption = Chr(13) & "    Please enter the Sales Discount Account #"
 Label11.Visible = True
 Exit Sub
Else
 If Left(TextBox2.Text, 1) <> 4 And Left(TextBox2.Text, 1) <> 8 Then
   Label11.Caption = Chr(13) & "    Incorrect account type for the Sales Discount Account"
   Label11.Visible = True
   Exit Sub
   End If
End If
If TextBox3.Value = "" Or Label14.Caption = "" Then
 Label11.Caption = Chr(13) & "    Please enter the A/P Creditor Account #"
 Label11.Visible = True
 Exit Sub
Else
 If Left(TextBox3.Text, 1) <> 2 Then
   Label11.Caption = Chr(13) & "    Incorrect account type for the A/P Creditor Account "
   Label11.Visible = True
   Exit Sub
   End If
End If
If TextBox4.Value = "" And MyBook.Worksheets("ComData").Range("A24").Value = "" Then
 Label11.Caption = Chr(13) & "    Please enter the Payment Account #"
 Label11.Visible = True
 Exit Sub
End If
If TextBox4.Value <> "" Then
 If Left(TextBox4.Text, 1) > 2 Then
   Label11.Caption = Chr(13) & "    Incorrect account type for the Bank/Cash Account being added"
   Label11.Visible = True
   Exit Sub
 End If
   MyBook.Worksheets("ComData").Activate
   Range("A24").Select
   AcctNo = TextBox4.Value
   Do While ActiveCell.Value <> ""
    If AcctNo = ActiveCell.Value Then
      UserForm10.Label11.Caption = Chr(13) & "    The Bank/Cash Account being added has already existed in the List"
      UserForm10.Label11.Visible = True
      Exit Sub
    End If
     ActiveCell.Offset(1, 0).Select
   Loop
   If Label15.Caption = "" Then
    Label11.Caption = Chr(13) & "    Incorrect account for the Bank/Cash Account being added "
    Label11.Visible = True
    Exit Sub
   End If
End If
   MyBook.Worksheets("ComData").Activate
   Range("A21:A40").NumberFormat = "General"
   Range("A21").Value = TextBox1.Text
   Range("A22").Value = TextBox2.Text
   Range("A23").Value = TextBox3.Text
 If TextBox4.Value <> "" Then
   MyBook.Worksheets("ComData").Activate
   Range("A22").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   With Selection
    .NumberFormat = "General"
    .Value = TextBox4.Text
    .Offset(0, 1).NumberFormat = "@"
    .Offset(0, 1).Value = Label15.Caption
   End With
   I = ActiveCell.Row
  If I > 25 Then
   Range(Cells(25, 1), Cells(I, 3)).Select
    With Selection
     .Columns("C").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("C1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    End With
  End If
   I = I - 23
   ListBox1.Clear
   ReDim MyRange(I - 1, 2)
   ListBox1.ColumnCount = 2
   Range("A24").Select
   I = 0
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value & "   ---- (Default)"
    I = I + 1
    ActiveCell.Offset(1, 0).Select
   Do While ActiveCell.Value <> ""
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value
    I = I + 1
    ActiveCell.Offset(1, 0).Select
   Loop
    ListBox1.List() = MyRange
    ListBox1.ListIndex = 0
  End If
   DebtorAcct = Range("A21").Value
   SalesDisAcct = Range("A22").Value
   CreditorAcct = Range("A23").Value
   BankAcct = Range("A24").Value
   Range("B8").Value = "Yes"
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 MyBook.Worksheets("ComData").Activate
 Range("A21").Select
 Do While ActiveCell.Value <> ""
 AccountCode = ActiveCell.Value
 If IsError(Application.Match(AccountCode, COARange, 0)) = False Then
   I = Application.Match(AccountCode, COARange, 0) + 9
   Worksheets("Chart of Account").Cells(I, 7).Value = "Y"
 End If
 ActiveCell.Offset(1, 0).Select
 Loop
TextBox4.Text = ""
Label15.Caption = ""
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
 Unload Me
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
ButtonNo = 1
ListBox2.Visible = True
ListBox3.Visible = False
ListBox4.Visible = False
ListBox5.Visible = False
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub CommandButton5_Click()
Application.EnableCancelKey = xlDisabled
ButtonNo = 2
ListBox2.Visible = False
ListBox3.Visible = True
ListBox4.Visible = False
ListBox5.Visible = False
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
ButtonNo = 3
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = True
ListBox5.Visible = False
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub CommandButton7_Click()
Application.EnableCancelKey = xlDisabled
ButtonNo = 4
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
ListBox5.Visible = True
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub CommandButton8_Click()
Dim DefaultAcct As String, MyRange() As Variant, I As Long, J As Long, COARange As Range, AccountCode As Variant
Application.EnableCancelKey = xlDisabled
If ButtonNo = 24 Then Exit Sub
DefaultAcct = MyBook.Worksheets("ComData").Cells(ButtonNo, 1).Value
MyBook.Worksheets("ComData").Cells(ButtonNo, 1).Value = MyBook.Worksheets("ComData").Range("A24").Value
MyBook.Worksheets("ComData").Range("A24").Value = DefaultAcct
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 MyBook.Worksheets("ComData").Activate
 Range("A24").End(xlDown).Select
   I = ActiveCell.Row
  If I > 25 Then
   Range(Cells(25, 1), Cells(I, 3)).Select
    With Selection
     .Columns("C").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("C1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    End With
  End If
 Range("A24").Select
 Do While ActiveCell.Value <> ""
  AccountCode = ActiveCell.Value
  If IsError(Application.Match(AccountCode, COARange, 0)) = False Then
    J = Application.Match(AccountCode, COARange, 0) + 9
    ActiveCell.Offset(0, 1).NumberFormat = "@"
    ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Chart of Account").Cells(J, 2).Value
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 I = I - 23
   ListBox1.Clear
   ReDim MyRange(I, 2)
   ListBox1.ColumnCount = 2
   Range("A24").Select
   I = 0
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value & "   ---- (Default)"
    I = I + 1
    ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value
    I = I + 1
    ActiveCell.Offset(1, 0).Select
  Loop
   ListBox1.List() = MyRange
   ListBox1.ListIndex = 0
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub CommandButton9_Click()
Dim DelAcct As String, MyRange() As Variant, I As Long, J As Long, COARange As Range, AccountCode As Variant
Application.EnableCancelKey = xlDisabled
If ButtonNo = 24 Then
 If MyBook.Worksheets("ComData").Range("A25").Value = "" Then
    MsgBox ("WARNING" & Chr(13) & Chr(13) & "   Deletion of the only one Account is not allowed !!!")
    Exit Sub
 End If
End If
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 MyBook.Worksheets("ComData").Activate
 Range("A24").End(xlDown).Select
 I = ActiveCell.Row
If I <> ButtonNo Then
 DelAcct = Cells(I, 1).Value
 Cells(I, 3).ClearContents
 Cells(I, 2).ClearContents
 Cells(I, 1).ClearContents
Else
 Cells(I, 3).ClearContents
 Cells(I, 2).ClearContents
 Cells(I, 1).ClearContents
End If
 MyBook.Worksheets("ComData").Cells(ButtonNo, 1).Value = DelAcct
  If I > 26 Then
   Range(Cells(25, 1), Cells(I - 1, 3)).Select
    With Selection
     .Columns("C").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("C1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    End With
  End If
 Range("A24").Select
 Do While ActiveCell.Value <> ""
  AccountCode = ActiveCell.Value
  If IsError(Application.Match(AccountCode, COARange, 0)) = False Then
    J = Application.Match(AccountCode, COARange, 0) + 9
    ActiveCell.Offset(0, 1).NumberFormat = "@"
    ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Chart of Account").Cells(J, 2).Value
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
   I = I - 24
   ListBox1.Clear
   ReDim MyRange(I, 2)
   ListBox1.ColumnCount = 2
   MyBook.Worksheets("ComData").Activate
   Range("A24").Select
   I = 0
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value & "   ---- (Default)"
    I = I + 1
    ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value
    I = I + 1
    ActiveCell.Offset(1, 0).Select
  Loop
   ListBox1.List() = MyRange
   ListBox1.ListIndex = 0
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
ListBox5.Visible = False
If ListBox1.ListIndex < 0 Then Exit Sub
If ListBox1.Text = "No Registered Bank Account" Then Exit Sub
ButtonNo = ListBox1.ListIndex + 24
If Not (MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly") Then
  CommandButton8.Visible = True
  CommandButton9.Visible = True
End If
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox2.ListIndex < 0 Then
 ListBox2.Visible = False
 Exit Sub
End If
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10ListClick("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub ListBox3_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox3.ListIndex < 0 Then
 ListBox3.Visible = False
 Exit Sub
End If
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10ListClick("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub ListBox4_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox4.ListIndex < 0 Then
 ListBox4.Visible = False
 Exit Sub
End If
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10ListClick("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub ListBox5_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox5.ListIndex < 0 Then
 ListBox5.Visible = False
 Exit Sub
End If
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10ListClick("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub TextBox1_Enter()
Application.EnableCancelKey = xlDisabled
For I = 2 To 5
 Controls("Listbox" & I).Visible = False
Next I
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
ButtonNo = 1
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10TextExit("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub TextBox2_Enter()
Application.EnableCancelKey = xlDisabled
For I = 2 To 5
 Controls("Listbox" & I).Visible = False
Next I
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
ButtonNo = 2
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10TextExit("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub TextBox3_Enter()
Application.EnableCancelKey = xlDisabled
For I = 2 To 5
 Controls("Listbox" & I).Visible = False
Next I
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
ButtonNo = 3
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10TextExit("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub TextBox4_Enter()
Application.EnableCancelKey = xlDisabled
For I = 2 To 5
 Controls("Listbox" & I).Visible = False
Next I
Label11.Visible = False
CommandButton8.Visible = False
CommandButton9.Visible = False
End Sub

Private Sub TextBox4_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If TextBox4.Text = "" Then
 Label15.Caption = ""
 Exit Sub
End If
ButtonNo = 4
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "AccountSetup"
Call Form10TextExit("")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
End Sub

Private Sub UserForm_Initialize()
Dim I As Long, COARange As Range, MyRange() As Variant, AddNo As Long, L As Long, M As Long, N As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox2.Clear
L = 10
M = LastRowChartofAccount
 MyBook.Worksheets("Chart of Account").Activate
For I = L To M
 If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 1 Then
  N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
  spacing = " ----"
  spacing = Left(spacing, 6 - N)
  If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
   ListBox2.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
  End If
 End If
Next I
ListBox3.Clear
For I = L To M
 If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 4 Or Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 8 Then
   N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
   spacing = " ----"
   spacing = Left(spacing, 6 - N)
  If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
    ListBox3.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
  End If
 End If
Next I
ListBox4.Clear
For I = L To M
 If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 2 Then
   N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
   spacing = " ----"
   spacing = Left(spacing, 6 - N)
   If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
     ListBox4.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
   End If
 End If
Next I
ListBox5.Clear
For I = L To M
 If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) < 3 Then
   N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
   spacing = " ----"
   spacing = Left(spacing, 6 - N)
   If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
     ListBox5.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
   End If
 End If
Next I
 For I = 2 To 5
   Controls("ListBox" & I).AddItem "CLOSE this Listing Box"
 Next I
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 If DebtorAcct <> "" Then
  TextBox1.Text = DebtorAcct
  If IsError(Application.Match(DebtorAcct, COARange, 0)) Then
   Label12.Caption = ""
  Else
    I = Application.Match(DebtorAcct, COARange, 0) + 9
    Label12.Caption = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
  End If
 End If
 If SalesDisAcct <> "" Then
  TextBox2.Text = SalesDisAcct
  If IsError(Application.Match(SalesDisAcct, COARange, 0)) Then
   Label13.Caption = ""
  Else
    I = Application.Match(SalesDisAcct, COARange, 0) + 9
    Label13.Caption = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
  End If
 End If
 If CreditorAcct <> "" Then
  TextBox3.Text = CreditorAcct
  If IsError(Application.Match(CreditorAcct, COARange, 0)) Then
   Label14.Caption = ""
  Else
    I = Application.Match(CreditorAcct, COARange, 0) + 9
    Label14.Caption = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
  End If
 End If
   ListBox1.Clear
 If BankAcct <> "" Then
   MyBook.Worksheets("ComData").Activate
   Range("A24").Select
   Do While ActiveCell.Value <> ""
    BankAcct = ActiveCell.Value
    If IsError(Application.Match(BankAcct, COARange, 0)) = False Then
      I = Application.Match(BankAcct, COARange, 0) + 9
      ActiveCell.Offset(0, 1).NumberFormat = "@"
      ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
    Else
      ActiveCell.Offset(0, 1).Value = ""
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
   I = ActiveCell.Row - 1
  If I > 25 Then
   Range(Cells(25, 1), Cells(I, 3)).Select
    With Selection
     .Columns("C").FormulaR1C1 = "=LEFT(RC[-2] & ""*******"",7)"
     .Sort Key1:=Range("C1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    End With
  End If
   I = I - 23
   ReDim MyRange(I - 1, 2)
   ListBox1.ColumnCount = 2
   Range("A24").Select
   I = 0
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value & "   ---- (Default)"
    I = I + 1
    ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
    MyRange(I, 0) = ActiveCell.Value
    MyRange(I, 1) = ActiveCell.Offset(0, 1).Value
    I = I + 1
    ActiveCell.Offset(1, 0).Select
  Loop
   ListBox1.List() = MyRange
   ListBox1.ListIndex = 0
 Else
  ListBox1.ColumnCount = 1
  ListBox1.AddItem "No Registered Bank Account"
 End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  CommandButton1.Visible = False
  CommandButton8.Visible = False
  CommandButton9.Visible = False
End If
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If

ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub
Attribute VB_Name = "UserForm11"
Attribute VB_Base = "0{91C1641E-C844-49A6-B902-3BD274B92D8C}{58C06BCE-E8B3-4C28-9986-42E56247E0E9}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public ReceiptNo As String

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = True
 ListBox2.Visible = False
 ListBox4.Visible = False
End Sub

Private Sub CommandButton2_Click()
Dim TotalSum As Double, FInvRow As Long, LInvRow As Long, NewBalance As Double, PayDate As Date, PayAmount As Double
Dim ColNo As Long, AcctYear As Long, JournalCode As String, PayTotal As Double, P As Long, CQNo As String
Dim CheckRange As Range
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
If CustNo = "" Then Exit Sub
If TextBox2.Text = "" Then
 Label39.Caption = Chr(13) & "    Please enter the Payment date"
 Label39.Visible = True
 Exit Sub
End If
PayDate = TextBox2.Text
If TextBox3.Text = "" Then
 PayTotal = 0
Else
 PayTotal = TextBox3.Value
End If
CQNo = ""
If OptionButton1.Value = True Then
 If TextBox9.Text = "" Then
  Label39.Caption = Chr(13) & "    Please enter the Cheque number"
  Label39.Visible = True
  Exit Sub
 End If
 If IsDate(TextBox11.Text) = False And TextBox11.Text <> "" Then
  Label39.Caption = Chr(13) & "    Please enter the Date of the Cheque"
  Label39.Visible = True
  Exit Sub
 End If
 CQNo = "#" & TextBox9.Text & ", "
End If
If PayDate < BeginningDate Then
  If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
 MSG = "The date entered belongs to the previous Posted year" & Chr(13) & _
    "The system will not post this entry to the General Ledger." & Chr(13) & Chr(13) _
     + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
   Title = "WARNING"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DateProceed
    If C = "N" Or C = "n" Or C = "" Then
     Label39.Caption = Chr(13) & "    Please enter a new Payment Receive Date and then click 'Save' Button again. "
     Label39.Visible = True
     Exit Sub
    End If
    GoTo AskReply
  Else
     Label39.Caption = "    Transaction with date belonging to previous Posted year is not allowed" & _
     Chr(13) & "    Please enter a new Payment Receive Date and then click 'Save' Button to proceed. "
     Label39.Visible = True
     Exit Sub
 End If
End If
DateProceed:
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("B6").Select
 TotalSum = 0
 P = 0
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 5).Value <> "" Then P = 1
  TotalSum = TotalSum + ActiveCell.Offset(0, 5).Value
  ActiveCell.Offset(1, 0).Select
 Loop
  TotalSum = Format(TotalSum, "0.00")
  If P = 0 Then
   Label39.Caption = Chr(13) & "    No Payment applied to any of the invoices"
   Label39.Visible = True
   Exit Sub
  End If
  Label36.Caption = Format(TotalSum, "#,##0.00")
  Label41.Caption = Format((PayTotal - TotalSum), "#,##0.00")
  If Abs(TotalSum - PayTotal) > 0.001 Then
   Label39.Caption = Chr(13) & "    The Payment amount does not balance with the Sum of Applied Amount"
   Label39.Visible = True
   Exit Sub
  End If
 If Abs(PayTotal) > 0.001 And OptionButton1.Value = False And OptionButton2.Value = False Then
   Label39.Caption = Chr(13) & "    Please select the payment method ( Cheque or Cash)"
   Label39.Visible = True
   Exit Sub
  End If
MyBook.Worksheets("Receivable").Activate
If Range("B4").Value <> "" Then
 ActiveSheet.UsedRange.Select
 Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("B6").Select
Do While ActiveCell.Value <> ""
 If Not (ActiveCell.Offset(0, 5).Value = "" Or ActiveCell.Offset(0, 5).Value = 0) Then
   InvNo = ActiveCell.Value
   PayAmount = Format(ActiveCell.Offset(0, 5).Value, "0.00")
   NewBalance = Format(ActiveCell.Offset(0, 4).Value - PayAmount, "0.00")
   MyBook.Worksheets("Receivable").Activate
   Set CheckRange = MyBook.Worksheets("Receivable").UsedRange.Offset(3, 0).Columns("B")
   If IsError(Application.Match(InvNo, CheckRange, 0)) = False Then
    FInvRow = Application.Match(InvNo, CheckRange, 0) + 3
    LInvRow = Application.Match(InvNo, CheckRange, 1) + 3
    If LInvRow < FInvRow Then LInvRow = FInvRow
   Range(Cells(FInvRow, 11), Cells(LInvRow, 11)).Value = NewBalance
    If Abs(NewBalance) < 0.0001 Then
      Range(Cells(FInvRow, 10), Cells(LInvRow, 10)) = "S"
      Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
      Range(Cells(FInvRow, 13), Cells(LInvRow, 13)) = PayDate
    Else
     Range(Cells(FInvRow, 10), Cells(LInvRow, 10)) = "P"
     Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).ClearContents
    End If
    If Cells(FInvRow, 196).Value = "" Then
     Range(Cells(FInvRow, 196), Cells(LInvRow, 196)).NumberFormat = "yyyy/mm/dd"
     Range(Cells(FInvRow, 196), Cells(LInvRow, 196)).Value = PayDate
     Range(Cells(FInvRow, 197), Cells(LInvRow, 197)).NumberFormat = "General"
     Range(Cells(FInvRow, 197), Cells(LInvRow, 197)).Value = PayAmount
     Range(Cells(FInvRow, 198), Cells(LInvRow, 198)).Value = "R" & ReceiptNo
    Else
     ColNo = Cells(FInvRow, 196).End(xlToRight).Column + 1
     If ColNo < 251 Then
      Range(Cells(FInvRow, ColNo), Cells(LInvRow, ColNo)).NumberFormat = "yyyy/mm/dd"
      Range(Cells(FInvRow, ColNo), Cells(LInvRow, ColNo)).Value = PayDate
      Range(Cells(FInvRow, ColNo + 1), Cells(LInvRow, ColNo + 1)).NumberFormat = "General"
      Range(Cells(FInvRow, ColNo + 1), Cells(LInvRow, ColNo + 1)).Value = PayAmount
      Range(Cells(FInvRow, ColNo + 2), Cells(LInvRow, ColNo + 2)).Value = "R" & ReceiptNo
     ElseIf ColNo > 253 Then
      Range(Cells(FInvRow, 196), Cells(LInvRow, 198)).NumberFormat = "General"
      Range(Cells(FInvRow, 196), Cells(LInvRow, 196)).Value = " Up to " & Format(Cells(FInvRow, 202).Value, "yyyy/mm/dd")
      Range(Cells(FInvRow, 197), Cells(LInvRow, 197)).Value = Cells(FInvRow, 203).Value + Cells(FInvRow, 200).Value + Cells(FInvRow, 197).Value
      Range(Cells(FInvRow, 198), Cells(LInvRow, 198)).Value = Cells(FInvRow, 198).Value & " ; " & Cells(FInvRow, 201).Value & " ; " & Cells(FInvRow, 204).Value
      Range(Cells(FInvRow, 205), Cells(LInvRow, 255)).Copy
      Cells(FInvRow, 199).Select
      ActiveSheet.Paste
      Application.CutCopyMode = False
      Range(Cells(FInvRow, 250), Cells(LInvRow, 250)).NumberFormat = "yyyy/mm/dd"
      Range(Cells(FInvRow, 250), Cells(LInvRow, 250)).Value = PayDate
      Range(Cells(FInvRow, 251), Cells(LInvRow, 251)).NumberFormat = "General"
      Range(Cells(FInvRow, 251), Cells(LInvRow, 251)).Value = PayAmount
      Range(Cells(FInvRow, 252), Cells(LInvRow, 252)).Value = "R" & ReceiptNo
      Range(Cells(FInvRow, 253), Cells(LInvRow, 255)).ClearContents
      Range(Cells(FInvRow, 253), Cells(LInvRow, 255)).NumberFormat = "General"
     Else
      Range(Cells(FInvRow, 196), Cells(LInvRow, 198)).NumberFormat = "General"
      Range(Cells(FInvRow, 196), Cells(LInvRow, 196)).Value = " Up to " & Format(Cells(FInvRow, 199).Value, "yyyy/mm/dd")
      Range(Cells(FInvRow, 197), Cells(LInvRow, 197)).Value = Cells(FInvRow, 200).Value + Cells(FInvRow, 197).Value
      Range(Cells(FInvRow, 198), Cells(LInvRow, 198)).Value = Cells(FInvRow, 198).Value & " ; " & Cells(FInvRow, 201).Value
      Range(Cells(FInvRow, 202), Cells(LInvRow, 252)).Copy
      Cells(FInvRow, 199).Select
      ActiveSheet.Paste
      Application.CutCopyMode = False
      Range(Cells(FInvRow, 250), Cells(LInvRow, 250)).NumberFormat = "yyyy/mm/dd"
      Range(Cells(FInvRow, 250), Cells(LInvRow, 250)).Value = PayDate
      Range(Cells(FInvRow, 251), Cells(LInvRow, 251)).NumberFormat = "General"
      Range(Cells(FInvRow, 251), Cells(LInvRow, 251)).Value = PayAmount
      Range(Cells(FInvRow, 252), Cells(LInvRow, 252)).Value = "R" & ReceiptNo
     End If
    End If
   End If
 ElseIf ActiveCell.Offset(0, 5).Value = 0 And ActiveCell.Offset(0, 5).Value <> "" Then
  If ActiveCell.Offset(0, 4).Value = 0 Then
   InvNo = ActiveCell.Value
   MyBook.Worksheets("Receivable").Activate
   Set CheckRange = MyBook.Worksheets("Receivable").UsedRange.Offset(3, 0).Columns("B")
   If IsError(Application.Match(InvNo, CheckRange, 0)) = False Then
    FInvRow = Application.Match(InvNo, CheckRange, 0) + 3
    LInvRow = Application.Match(InvNo, CheckRange, 1) + 3
    If LInvRow < FInvRow Then LInvRow = FInvRow
     Range(Cells(FInvRow, 10), Cells(LInvRow, 10)) = "S"
     Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
     Range(Cells(FInvRow, 13), Cells(LInvRow, 13)) = PayDate
   End If
  End If
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveCell.Offset(1, 0).Select
Loop
If PayDate < BeginningDate Then GoTo RawDataUpdateComplete
If OptionButton3.Value <> "True" Or TotalSum <> 0 Then
  Range("D1:D2").NumberFormat = "yyyy/mm/dd"
  Range("D1:D2").Value = PayDate
  Range("E1:E2").NumberFormat = "General"
  Range("E1").Value = DebtorAcct
  Range("H1:I2").NumberFormat = "General"
  If TotalSum >= 0 Then
    Range("I1").Value = Format(TotalSum, "0.00")
    Range("H2").Value = Format(TotalSum, "0.00")
    Range("G1:G2").Value = CQNo & "Receipt R" & ReceiptNo & ", Paid by " & Range("C6").Value
  Else
    Range("H1").Value = Format(TotalSum * (-1), "0.00")
    Range("I2").Value = Format(TotalSum * (-1), "0.00")
    Range("G1:G2").Value = CQNo & "Receipt R" & ReceiptNo & ", Credit to " & Range("C6").Value
  End If
  Range("E2").Value = BankAcct
  Range("J1:J2").Value = "R" & ReceiptNo
  Range("F1:F2").NumberFormat = "General"
  Range("F1:F2").FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
  Range("F1:F2").NumberFormat = "@"
  Range("F1:F2").Copy
  Range("F1:F2").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  AcctYear = Int((Period(PayDate) - Period(MyBook.Worksheets("Raw Data").Range("A1").Value)) / 12)
  AcctYear = AcctYear + Year(MyBook.Worksheets("Raw Data").Range("A1").Value)
  JournalCode = "RV" & AcctYear
  MyBook.Worksheets("ComData").Activate
  Range("G250").Select
  JcodeRow = 251
  Set JournalRange = Range("G250")
  If ActiveCell.Offset(1, 0).Value <> "" Then
   Range("G250").End(xlDown).Select
   JcodeRow = ActiveCell.Row + 1
  End If
   Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
    LastTranNo = "00001"
    Range(Cells(JcodeRow, 7), Cells(JcodeRow, 8)).NumberFormat = "@"
    Cells(JcodeRow, 7).Value = JournalCode
    Cells(JcodeRow, 8).Value = LastTranNo
  Else
   JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
   LastTranNo = Cells(JcodeRow, 8).Value
   LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
   Cells(JcodeRow, 8).NumberFormat = "@"
   Cells(JcodeRow, 8).Value = LastTranNo
  End If
  LastJournalCode = JournalCode
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("A1:B2").NumberFormat = "@"
  Range("A1:A2").Value = JournalCode
  Range("B1:B2").Value = LastTranNo
  MyBook.Worksheets("Raw Data").Activate
  Range("A2").End(xlDown).Select
  ActiveCell.Offset(1, 0).Select
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("A1:J2").Copy
  MyBook.Worksheets("Raw Data").Activate
  ActiveSheet.Paste
  P = Period(PayDate) - Period(BeginningDate) + 1
  MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
End If
RawDataUpdateComplete:
 MyBook.Worksheets("PayRec").Activate
 Range("A1").End(xlDown).Select
 ActiveCell.Offset(1, 0).Select
 RecRowA = ActiveCell.Row
 RecRowB = RecRowA
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("B6").Select
 Do While ActiveCell.Value <> ""
  If Not (ActiveCell.Offset(0, 5).Value = "" Or ActiveCell.Offset(0, 5).Value = 0) Then
    MyBook.Worksheets("PayRec").Cells(RecRowB, 11).NumberFormat = "@"
    MyBook.Worksheets("PayRec").Cells(RecRowB, 12).NumberFormat = "@"
    MyBook.Worksheets("PayRec").Cells(RecRowB, 11).Value = ActiveCell.Offset(0, -1).Value
    MyBook.Worksheets("PayRec").Cells(RecRowB, 12).Value = ActiveCell.Value
    MyBook.Worksheets("PayRec").Cells(RecRowB, 13).NumberFormat = "General"
    MyBook.Worksheets("PayRec").Cells(RecRowB, 13).Value = ActiveCell.Offset(0, 5).Value
    MyBook.Worksheets("PayRec").Cells(RecRowB, 14).NumberFormat = "yyyy/mm/dd"
    MyBook.Worksheets("PayRec").Cells(RecRowB, 14).Value = ActiveCell.Offset(0, 2).Value
    MyBook.Worksheets("PayRec").Cells(RecRowB, 15).NumberFormat = "@"
    If ActiveCell.Offset(0, 2).Value > PayDate Then
      MyBook.Worksheets("PayRec").Cells(RecRowB, 15).Value = "**"
    Else
      MyBook.Worksheets("PayRec").Cells(RecRowB, 15).ClearContents
    End If
    RecRowB = RecRowB + 1
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
  RecRowB = RecRowB - 1
If RecRowB >= RecRowA Then
  MyBook.Worksheets("PayRec").Activate
  Range(Cells(RecRowA, 1), Cells(RecRowB, 1)).Value = Label54.Caption
  Range(Cells(RecRowA, 2), Cells(RecRowB, 2)).NumberFormat = "yyyy/mm/dd"
  Range(Cells(RecRowA, 2), Cells(RecRowB, 2)).Value = PayDate
  Range(Cells(RecRowA, 3), Cells(RecRowB, 3)).NumberFormat = "@"
  Range(Cells(RecRowA, 3), Cells(RecRowB, 3)).Value = CustNo
  Range(Cells(RecRowA, 4), Cells(RecRowB, 4)).Value = Label2.Caption
  Range(Cells(RecRowA, 5), Cells(RecRowB, 5)).NumberFormat = "General"
  Range(Cells(RecRowA, 5), Cells(RecRowB, 5)).Value = PayTotal
 If OptionButton3.Value = "True" Then
  Range(Cells(RecRowA, 6), Cells(RecRowB, 6)).Value = "Credit Note"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 7)).Value = "N/A"
  Range(Cells(RecRowA, 8), Cells(RecRowB, 8)).Value = "N/A"
  Range(Cells(RecRowA, 9), Cells(RecRowB, 9)).Value = "N/A"
  Range(Cells(RecRowA, 10), Cells(RecRowB, 10)).Value = "N/A"
 ElseIf OptionButton2.Value = "True" Then
  Range(Cells(RecRowA, 6), Cells(RecRowB, 6)).Value = "Cash"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 7)).Value = "N/A"
  Range(Cells(RecRowA, 8), Cells(RecRowB, 8)).Value = "N/A"
  Range(Cells(RecRowA, 9), Cells(RecRowB, 9)).Value = "N/A"
  Range(Cells(RecRowA, 10), Cells(RecRowB, 10)).Value = "N/A"
 Else
  Range(Cells(RecRowA, 6), Cells(RecRowB, 6)).Value = "Cheque"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 7)).NumberFormat = "@"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 7)).Value = TextBox9.Text
  Range(Cells(RecRowA, 9), Cells(RecRowB, 9)).NumberFormat = "yyyy/mm/dd"
  Range(Cells(RecRowA, 9), Cells(RecRowB, 9)).Value = TextBox11.Text
  Range(Cells(RecRowA, 10), Cells(RecRowB, 10)).NumberFormat = "@"
  Range(Cells(RecRowA, 10), Cells(RecRowB, 10)).Value = TextBox12.Text
 End If
  Range("B1").Value = ReceiptNo
  ReceiptNo = Right(("00000" & Val(MyBook.Worksheets("PayRec").Range("B1").Value) + 1), 5)
End If
ThisWorkbook.Worksheets("TempRP").Activate
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
ScrollBar1.Max = 1
ScrollBar1.Min = 1
ScrollBar1.Value = 1
ScrollBar1.Visible = False
OptionButton1.Value = True
CommandButton2.Visible = True
For I = 1 To 3
 Controls("TextBox" & I).Text = ""
Next I
For I = 4 To 8
 Controls("TextBox" & I).Text = ""
 Controls("TextBox" & I).Visible = False
Next I
For I = 9 To 12
 Controls("TextBox" & I).Text = ""
Next I
 Label2.Caption = ""
For I = 11 To 35
 Controls("Label" & I).Caption = ""
Next I
For I = 1 To 5
 Controls("Label" & I * 5 + 6).Caption = I
Next I
Label54.Caption = "R" & ReceiptNo
Label36.Caption = "0.00"
Label41.Caption = "0.00"
Label39.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm8.Show
End Sub

Private Sub CommandButton5_Click()
Application.EnableCancelKey = xlDisabled
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox4.Visible = False
End Sub

Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
  ListBox1.Visible = False
  ListBox2.Visible = False
  ListBox4.Visible = False
   Me.Hide
   ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PAYMENT"
   Call ReceiptFormat("")
End Sub

Private Sub CommandButton7_Click()
Dim I As Long, FRow As Long, LRow As Long, RowNo As Long
Dim Tbl As Range, CheckRange As Range
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
MyBook.Activate
 EventOff = True
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox4.Visible = False
    ScrollBar1.Visible = False
    ScrollBar1.Value = 1
    ScrollBar1.Max = 1
   For I = 11 To 35
    Controls("Label" & I).Caption = ""
   Next I
    Label36.Caption = "0.00"
    Label41.Caption = "0.00"
   For I = 4 To 8
    Controls("TextBox" & I).Text = ""
    Controls("TextBox" & I).Visible = False
   Next I
CustNo = TextBox1.Text
MyBook.Worksheets("Customer Data").Activate
If IsError(Application.Match(CustNo, Range("B:B"), 0)) Then
  Label2.Caption = ""
  Label39.Caption = "    Customer # is not correct, please enter the correct Customer # " & Chr(13) & _
       "    and then click the 'Amend Payment' button to proceed"
  Label39.Visible = True
  EventOff = False
  Exit Sub
Else
 I = Application.Match(CustNo, Range("B:B"), 0)
 Label2.Caption = Cells(I, 3).Value
End If
 MyBook.Worksheets("Receivable").Activate
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("B1") _
        , Order2:=xlAscending, Key3:=Range("J1"), Order3:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(CustNo, CheckRange, 0)) Then
   Label39.Caption = Chr(13) & "    No Record of invoices/ credit notes for this Customer"
   Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
  FRow = Application.Match(CustNo, CheckRange, 0) + 3
  LRow = Application.Match(CustNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
 Label2.Caption = Cells(FRow, 17).Value
   Range(Cells(FRow, 1), Cells(LRow, 5)).EntireRow.Select
   Selection.Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   Range("A1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Range("A1").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = "INVOICE" And Right(ActiveCell.Offset(0, 1).Value, 1) <> " " Then ActiveCell.Offset(0, 33).Value = "INV" & ActiveCell.Offset(0, 33).Value
   ActiveCell.Offset(1, 0).Select
  Loop
    ActiveSheet.UsedRange.Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    With Selection
     .Columns("AF").Copy
      Range("J1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("Q").Copy
      Range("C1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("AH").Copy
       Range("A1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("E:I").Delete
     .Columns("G:IV").ClearContents
     .Cut
    End With
    Range("A6").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
  If Range("B7").Value <> "" Then
    Range("B6").End(xlDown).Select
    If ActiveCell.Row > 10 Then
     ScrollBar1.Max = ActiveCell.Row - 9
     ScrollBar1.Visible = True
    End If
  End If
    Range("B6").Select
     I = 1
     Do While ActiveCell.Value <> "" And I < 6
      Controls("Label" & I * 5 + 6).Caption = I
      Controls("Label" & I * 5 + 7).Caption = ActiveCell.Offset(0, -1).Value & ActiveCell.Value
      Controls("Label" & I * 5 + 8).Caption = Format(ActiveCell.Offset(0, 2).Value, "yyyy/mm/dd")
      Controls("Label" & I * 5 + 9).Caption = Format(ActiveCell.Offset(0, 3).Value, "#,##0.00")
      Controls("Label" & I * 5 + 10).Caption = Format(ActiveCell.Offset(0, 4).Value, "#,##0.00")
      Controls("TextBox" & I + 3).Visible = True
      ActiveCell.Offset(1, 0).Select
      I = I + 1
     Loop
 Else
    Label39.Caption = Chr(13) & "    No Record of invoices/ credit notes for this Customer"
    Label39.Visible = True
    EventOff = False
    Exit Sub
 End If
Label39.Visible = False
EventOff = False
End Sub

Private Sub CommandButton8_Click()
 Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label39.Visible = False
 ListBox4.Visible = True
End Sub

Private Sub CommandButton9_Click()
Dim BankName As String, I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox4.Visible = False
If TextBox12.Text = "" Then Exit Sub
 BankName = TextBox12.Text
 MyBook.Worksheets("ComData").Activate
 Range("J11").Select
 Do While ActiveCell.Value <> ""
  If BankName = ActiveCell.Value Then
    I = ActiveCell.Row
    Range(Cells(I + 1, 10), Cells(30, 10)).Cut
    Cells(I, 10).Select
    ActiveSheet.Paste
    GoTo AddName
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 Exit Sub
AddName:
  EventOff = True
  MyBook.Worksheets("ComData").Activate
  Range("J11").Select
    ListBox4.Clear
   MyBook.Worksheets("ComData").Activate
   If Range("J11") <> "" Then
    Do While ActiveCell.Value <> ""
     ListBox4.AddItem "  " & ActiveCell.Value
     ActiveCell.Offset(1, 0).Select
    Loop
   Else
    ListBox4.AddItem "No Record of Bank Names"
   End If
   ListBox4.AddItem "CLOSE this box"
    EventOff = False
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.List(0) = "No Customer Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 RowNo = ListBox1.ListIndex + 2
 For I = 11 To 35
  Controls("Label" & I).Caption = ""
 Next I
  Label36.Caption = "0.00"
 For I = 4 To 12
  Controls("TextBox" & I).Text = ""
 Next I
 ListBox1.Visible = False
 CustNo = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
 TextBox1.Text = CustNo
 ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PAYMENT"
 Call Form11Text1Exit("")
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Then
 ListBox2.Visible = False
 Exit Sub
End If
RowNo = ListBox2.ListIndex + 24
BankAcct = MyBook.Worksheets("COmData").Cells(RowNo, 1).Value
Label45.Caption = BankAcct
Label46.Caption = MyBook.Worksheets("COmData").Cells(RowNo, 2).Value

ListBox2.Visible = False
End Sub

Private Sub ListBox4_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox4.Text = "CLOSE this box" Or ListBox4.Text = "No Record of Bank Names" Or ListBox4.ListIndex < 0 Then
 ListBox4.Visible = False
 Exit Sub
End If
RowNo = ListBox4.ListIndex + 11
TextBox12.Text = MyBook.Worksheets("COmData").Cells(RowNo, 10).Value
ListBox4.Visible = False
End Sub

Private Sub OptionButton1_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
  If Not ((TextBox3.Text = "" Or TextBox3.Value = 0)) Or OptionButton3.Value = True Then
   CommandButton2.Visible = True
  Else
   CommandButton2.Visible = False
  End If
  Label39.Visible = False
 For I = 50 To 52
  Controls("Label" & I).Visible = True
 Next I
 Label48.Visible = True
 For I = 11 To 12
  Controls("TextBox" & I).Visible = True
 Next I
 TextBox9.Visible = True
 CommandButton8.Visible = True
 CommandButton9.Visible = True
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
  If Not ((TextBox3.Text = "" Or TextBox3.Value = 0)) Or OptionButton3.Value = True Then
   CommandButton2.Visible = True
  Else
   CommandButton2.Visible = False
  End If
  Label39.Visible = False
For I = 50 To 52
  Controls("Label" & I).Visible = False
 Next I
 Label48.Visible = False
 For I = 11 To 12
  Controls("TextBox" & I).Visible = False
 Next I
 TextBox9.Visible = False
 CommandButton8.Visible = False
 CommandButton9.Visible = False
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub OptionButton3_Click()
Application.EnableCancelKey = xlDisabled
 CommandButton2.Visible = True
 Label39.Visible = False
For I = 50 To 52
  Controls("Label" & I).Visible = False
 Next I
 Label48.Visible = False
 For I = 11 To 12
  Controls("TextBox" & I).Visible = False
 Next I
 TextBox9.Visible = False
 CommandButton8.Visible = False
 CommandButton9.Visible = False
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub ScrollBar1_Change()
 Dim LineNo As Long, I As Long, TotalSum As Double
  If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
   Cells(LineNo + 5, 2).Select
     I = 1
     Do While ActiveCell.Value <> "" And I < 6
      Controls("Label" & I * 5 + 6).Caption = I + LineNo - 1
      Controls("Label" & I * 5 + 7).Caption = ActiveCell.Offset(0, -1).Value & ActiveCell.Value
      Controls("Label" & I * 5 + 8).Caption = Format(ActiveCell.Offset(0, 2).Value, "yyyy/mm/dd")
      Controls("Label" & I * 5 + 9).Caption = Format(ActiveCell.Offset(0, 3).Value, "#,##0.00")
      Controls("Label" & I * 5 + 10).Caption = Format(ActiveCell.Offset(0, 4).Value, "#,##0.00")
      Controls("Textbox" & I + 3).Text = Format(ActiveCell.Offset(0, 5).Value, "#,##0.00")
      Controls("TextBox" & I + 3).Visible = True
      ActiveCell.Offset(1, 0).Select
      I = I + 1
     Loop
End Sub

Private Sub TextBox1_Enter()
Application.EnableCancelKey = xlDisabled
Label39.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
Call Form11Text1Exit("")
End Sub

Private Sub TextBox12_Change()
Application.EnableCancelKey = xlDisabled
Label39.Visible = False
End Sub

Private Sub TextBox12_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim BankName As String, I As Long, J As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If TextBox12.Text = "" Then Exit Sub
 BankName = TextBox12.Text
If Left(BankName, 1) = " " Then
 I = Len(BankName)
 J = 1
 Do While J <= I And Mid(BankName, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then Exit Sub
  BankName = Right(BankName, I - J + 1)
End If
 TextBox12.Text = BankName
 MyBook.Worksheets("ComData").Activate
 Range("J11").Select
 Do While ActiveCell.Value <> ""
  If BankName = ActiveCell.Value Then Exit Sub
  ActiveCell.Offset(1, 0).Select
 Loop
  If ActiveCell.Row < 31 Then
    ActiveCell.NumberFormat = "@"
    ActiveCell.Value = BankName
    EventOff = True
    ListBox4.Clear
   MyBook.Worksheets("ComData").Activate
   If Range("J11") <> "" Then
    Range("J11:J30").Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("J11").Select
    Do While ActiveCell.Value <> ""
     ListBox4.AddItem "  " & ActiveCell.Value
     ActiveCell.Offset(1, 0).Select
    Loop
   Else
    ListBox4.AddItem "No Record of Bank Names"
   End If
   ListBox4.AddItem "CLOSE this box"
    EventOff = False
 End If
End Sub

Private Sub TextBox2_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim PayDate As Date, DateString As String
Application.EnableCancelKey = xlDisabled
If TextBox2.Text = "" Then Exit Sub
 Label39.Visible = False
 DateString = TextBox2.Text
 Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label39.Caption = Chr(13) & "  Incorrect Date "
 Label39.Visible = True
 Exit Sub
End If
 TextBox2.Text = Format(DateString, "yyyy/mm/dd")
 PayDate = TextBox2.Text
If PayDate < BeginningDate Then
 Label39.Caption = Chr(13) & "  The Date entered belongs to Previous Posted Year "
 Label39.Visible = True
 Exit Sub
End If
End Sub

Private Sub TextBox3_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
CommandButton2.Visible = False
OptionButton3.Visible = False
End Sub

Private Sub TextBox3_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim TextBox3Amount As Double
Application.EnableCancelKey = xlDisabled
If TextBox3.Text = "" Then
 TextBox3Amount = 0
 TextBox3.Text = "0.00"
End If
If IsNumeric(TextBox3.Text) = False Then
 Cancel = True
 Label39.Caption = Chr(13) & "  Incorrect Amount input "
 Label39.Visible = True
Else
 TextBox3Amount = TextBox3.Value
 TextBox3Amount = Round(TextBox3Amount, 2)
 TextBox3.Text = Format(TextBox3Amount, "#,##0.00")
 Label39.Visible = False
End If
If TextBox3Amount <> 0 Then
 OptionButton3.Visible = False
Else
 OptionButton3.Visible = True
End If
  If Not ((TextBox3.Text = "" Or TextBox3Amount = 0)) Or OptionButton3.Value = True Then
   CommandButton2.Visible = True
  Else
   CommandButton2.Visible = False
  End If
Label41.Caption = Format((TextBox3Amount - Label36.Caption), "#,##0.00")
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub TextBox4_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox4_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label11.Caption)
 Form6TextNo = 4
 Call Form11SumRefresh("")
End Sub

Private Sub TextBox5_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label16.Caption)
 Form6TextNo = 5
Call Form11SumRefresh("")
End Sub

Private Sub TextBox6_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label21.Caption)
 Form6TextNo = 6
Call Form11SumRefresh("")
End Sub

Private Sub TextBox7_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox7_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label26.Caption)
 Form6TextNo = 7
Call Form11SumRefresh("")
End Sub

Private Sub TextBox8_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox8_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label31.Caption)
 Form6TextNo = 8
Call Form11SumRefresh("")
End Sub

Private Sub TextBox9_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox10_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox11_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox11_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim PayDate As Date, ExpireDate As Date, DateString As String
Application.EnableCancelKey = xlDisabled
Label39.Visible = False
If TextBox11.Text = "" Then Exit Sub
DateString = TextBox11.Text
Call DateConvert(DateString)
If IsDate(DateString) = False And TextBox11.Text <> "" Then
 Cancel = True
 Label39.Caption = Chr(13) & "  Incorrect Date "
 Label39.Visible = True
 Exit Sub
End If
TextBox11.Text = DateString
If TextBox11.Text <> "" Then
  TextBox11.Text = Format(TextBox11.Value, "yyyy/mm/dd")
  PayDate = TextBox11.Text
 If Month(Date) > 6 Then
   If IsDate(Year(Date) & "/" & Month(Date) - 6 & "/" & Day(Date)) = False Then
    ExpireDate = Year(Date) & "/" & Month(Date) - 5 & "/" & 1
   Else
    ExpireDate = Year(Date) & "/" & Month(Date) - 6 & "/" & Day(Date)
    ExpireDate = ExpireDate + 1
   End If
  ElseIf Month(Date) = 6 Then
   If IsDate(Year(Date) - 1 & "/" & 12 & "/" & Day(Date)) = False Then
     ExpireDate = Year(Date) & "/" & 1 & "/" & 1
   Else
     ExpireDate = Year(Date) - 1 & "/" & 12 & "/" & Day(Date)
     ExpireDate = ExpireDate + 1
   End If
  Else
   If IsDate(Year(Date) - 1 & "/" & Month(Date) + 6 & "/" & Day(Date)) = False Then
     ExpireDate = Year(Date) - 1 & "/" & Month(Date) + 7 & "/" & 1
   Else
     ExpireDate = Year(Date) - 1 & "/" & Month(Date) + 6 & "/" & Day(Date)
     ExpireDate = ExpireDate + 1
   End If
  End If
 If PayDate < ExpireDate Then
  Label39.Caption = Chr(13) & "  Warning!!! Cheque date is older than 6 months "
  Label39.Visible = True
  Exit Sub
 End If
End If
End Sub

Private Sub TextBox12_Enter()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub UserForm_Initialize()
Dim I As Long, COARange As Range, AddNo As Long, AcctNo As Variant
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.Clear
MyBook.Worksheets("Customer Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
ListBox1.AddItem "CLOSE this box"
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  MyBook.Worksheets("ComData").Activate
  Range("A24").Select
  Do While ActiveCell.Value <> ""
   AcctNo = ActiveCell.Value
   If IsError(Application.Match(AcctNo, COARange, 0)) = False Then
    I = Application.Match(AcctNo, COARange, 0) + 9
    ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
  ListBox2.Clear
   MyBook.Worksheets("ComData").Activate
   Range("A24").Select
   If ActiveCell.Value <> "" Then
    N = Len(ActiveCell.Value)
    spacing = " -----"
    spacing = Left(spacing, 7 - N)
    ListBox2.AddItem ActiveCell.Value & spacing & ActiveCell.Offset(0, 1).Value & "   ---- (Default)"
    ActiveCell.Offset(1, 0).Select
   End If
   Do While ActiveCell.Value <> ""
    N = Len(ActiveCell.Value)
    spacing = " -----"
    spacing = Left(spacing, 7 - N)
    ListBox2.AddItem ActiveCell.Value & spacing & ActiveCell.Offset(0, 1).Value
    ActiveCell.Offset(1, 0).Select
   Loop
   ListBox2.AddItem "CLOSE this box"
 ListBox4.Clear
MyBook.Worksheets("ComData").Activate
 If Range("J11") <> "" Then
   Range("J11:J30").Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("J11").Select
  Do While ActiveCell.Value <> ""
   ListBox4.AddItem "  " & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox4.AddItem "No Record of Bank Names"
 End If
 ListBox4.AddItem "CLOSE this box"
EventOff = True
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
Label3.Caption = "Payment Amount (" & SysCurrency & ") : "
Label7.Caption = "Total Amount" & Chr(13) & "(" & SysCurrency & ")  "
Label8.Caption = "Amount Due" & Chr(13) & "(" & SysCurrency & ")  "
Label9.Caption = "Applied Amount" & Chr(13) & "(" & SysCurrency & ")  "
Label37.Caption = "Total Sum (" & SysCurrency & ") : "
TextBox3.Text = "0.00"
ReceiptNo = Right(("00000" & Val(MyBook.Worksheets("PayRec").Range("B1").Value) + 1), 5)
Label54.Caption = "R" & ReceiptNo
If BankAcct <> "" Then
  Label45.Caption = BankAcct
  If IsError(Application.Match(BankAcct, COARange, 0)) = False Then
    I = Application.Match(BankAcct, COARange, 0) + 9
    Label46.Caption = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
  End If
Else
  BankAcct = Range("A24").Value
  Label45.Caption = BankAcct
  Label46.Caption = Range("B24").Value
End If
ScrollBar1.Max = 1
ScrollBar1.Min = 1
ScrollBar1.Value = 1
ScrollBar1.Visible = False
OptionButton1.Value = True
CommandButton2.Visible = False
CustNo = ""
For I = 4 To 8
 Controls("TextBox" & I).Visible = False
Next I
BeginningDate = MyBook.Worksheets("Raw Data").Range("A1").Value
If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton7.Visible = False
End If
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PAYMENT"
EventOff = False
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub
Attribute VB_Name = "UserForm12"
Attribute VB_Base = "0{2169C636-4259-4336-8F02-6DE60B3163BE}{17901280-ED0B-40ED-AD9C-E1C920E516CD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public StartDate As Date, EndDate As Date
Private Sub CommandButton1_Click()
Dim YearEndDate As Date
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
If OptionButton1.Value = True Then
 If IsDate(TextBox1.Text) = False Then
  Label5.Caption = Chr(13) & "      Beginning Date Invalid"
  Label5.Visible = True
  Exit Sub
 End If
 If IsDate(TextBox2.Text) = False Then
  Label5.Caption = Chr(13) & "      Ending Date Invalid"
  Label5.Visible = True
  Exit Sub
 End If
 StartDate = TextBox1.Text
 EndDate = TextBox2.Text
 If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
 If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
 ListBox1.Visible = False
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
Me.Hide
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
Unload Me
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
 ButtonNo = 3
 ListBox1.Visible = True
End Sub

Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
 ButtonNo = 4
 ListBox1.Visible = True
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.List(0) = "No Customer Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
RowNo = ListBox1.ListIndex + 2
If ButtonNo = 3 Then
  TextBox1.Text = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
Else
  TextBox2.Text = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
End If
ListBox1.Visible = False
End Sub

Private Sub OptionButton1_Click()
Application.EnableCancelKey = xlDisabled
If Label1.Caption = "Aging Report" Or Label1.Caption = "Credit Status Report" Then
 Label2.Caption = "Starting Customer # : "
 Label3.Caption = "Ending Customer # : "
 Label2.Visible = True
 Label3.Visible = True
 CommandButton3.Visible = True
 CommandButton4.Visible = True
Else
 Label2.Visible = True
 Label3.Visible = True
   EndDate = Date
  If Month(EndDate) > 3 Then
   If IsDate(Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1) = False Then
    StartDate = Year(EndDate) & "/" & Month(EndDate) - 2 & "/" & 1
   Else
   StartDate = Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1
   End If
  ElseIf Month(EndDate) = 3 Then
   If IsDate(Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) & "/" & 1 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1
   End If
  Else
   If IsDate(Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 10 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1
   End If
  End If
If Day(EndDate + 1) = 1 And Day(StartDate) <> 1 Then
 StartDate = Year(StartDate) - 1 & "/" & Month(StartDate) + 1 & "/" & 1
End If
 TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
 TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
End If
 TextBox1.Visible = True
 TextBox2.Visible = True
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
Label2.Visible = False
Label3.Visible = False
TextBox1.Visible = False
TextBox2.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If Label1.Caption = "Aging Report" Or Label1.Caption = "Credit Status Report" Then Exit Sub
If TextBox1.Text = "" Then Exit Sub
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
 StartDate = TextBox1.Text
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
End Sub
Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If Label1.Caption = "Aging Report" Or Label1.Caption = "Credit Status Report" Then Exit Sub
If TextBox2.Text = "" Then Exit Sub
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox2.Text = Format(DateString, "yyyy/mm/dd")
End If
EndDate = TextBox2.Text
If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100

OptionButton3.Value = True
ListBox1.Clear
MyBook.Worksheets("Customer Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
ListBox1.AddItem "CLOSE this box"
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "STATUS"
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
End Sub
Attribute VB_Name = "UserForm13"
Attribute VB_Base = "0{8E59763D-B385-409F-82F7-59130885F502}{AC4475FD-6536-444C-9078-D2B027A1168D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public StartDate As Date, EndDate As Date
Private Sub CommandButton1_Click()
Dim YearEndDate As Date
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False

If TextBox1.Visible = True Then
 If IsDate(TextBox1.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Beginning Date"
  Label5.Visible = True
  Exit Sub
 End If
 If IsDate(TextBox2.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Ending Date"
  Label5.Visible = True
  Exit Sub
 End If
 If EndDate - StartDate > 365 Then
  Label5.Caption = Chr(13) & "   The Date range exceeds 12 months.   Please input the date again"
  Label5.Visible = True
  Exit Sub
 End If
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
If OptionButton1.Value = True And TextBox3.Value = "" Then
  Label5.Caption = Chr(13) & "   Please input the selected customer # to proceed"
  Label5.Visible = True
  Exit Sub
End If
 ListBox1.Visible = False
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
Me.Hide
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
Unload Me
End Sub

Private Sub CommandButton3_Click()
 ListBox1.Visible = True
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.List(0) = "No Customer Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 RowNo = ListBox1.ListIndex + 2
TextBox3.Text = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
Label11.Caption = MyBook.Worksheets("Customer Data").Cells(RowNo, 3).Value
ListBox1.Visible = False
End Sub

Private Sub OptionButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = True
 TextBox3.Visible = True
 Label11.Visible = True
 Label12.Visible = True
 CommandButton3.Visible = True
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
CommandButton3.Visible = False
End Sub

Private Sub OptionButton3_Click()
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
CommandButton3.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox1.Text = "" Then Exit Sub
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
 StartDate = TextBox1.Text
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
If EndDate - StartDate > 365 Then
  Label5.Caption = Chr(13) & "   The Date range exceeds 12 months.   Please input the date again"
  Label5.Visible = True
 End If
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If Label1.Caption = "Aging Report" Or Label1.Caption = "Credit Status Report" Then Exit Sub
If TextBox2.Text = "" Then Exit Sub
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox2.Text = Format(DateString, "yyyy/mm/dd")
End If
EndDate = TextBox2.Text
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
If EndDate - StartDate > 365 Then
  Label5.Caption = Chr(13) & "   The Date range exceeds 12 months.   Please input the date again"
  Label5.Visible = True
 End If
End Sub

Private Sub TextBox3_Change()
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CustNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
CustNo = UCase(TextBox3.Text)
If IsNumeric(CustNo) Then
 If Len(CustNo) < 6 Then CustNo = Right(("00000" & CustNo), 5)
End If
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
  TextBox3.Text = CustNo
  Label11.Caption = ""
  Label5.Caption = Chr(13) & "      Incorrect Customer # entered"
  Label5.Visible = True
Else
 CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
 MyBook.Worksheets("Customer Data").Activate
 TextBox3.Text = CustNo
 Label11.Caption = Cells(CustRow, 3).Value
End If
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  EndDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  EndDate = Year(EndDate) + 1 & "/" & Month(EndDate) & "/" & Day(EndDate)
  EndDate = EndDate - 1
Else
   EndDate = Date
End If
  If Month(EndDate) > 3 Then
   If IsDate(Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1) = False Then
    StartDate = Year(EndDate) & "/" & Month(EndDate) - 2 & "/" & 1
   Else
   StartDate = Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1
   End If
  ElseIf Month(EndDate) = 3 Then
   If IsDate(Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) & "/" & 1 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1
   End If
  Else
   If IsDate(Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 10 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1
   End If
  End If
If Day(EndDate + 1) = 1 And Day(StartDate) <> 1 Then
 StartDate = Year(StartDate) - 1 & "/" & Month(StartDate) + 1 & "/" & 1
End If
 TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
 TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
End Sub

Private Sub UserForm_Terminate()
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
End Sub
Attribute VB_Name = "UserForm14"
Attribute VB_Base = "0{C7C73F73-5C0B-451F-A7D7-30A8A9573303}{46EC3386-B867-4EB4-AAD4-67E425366CB9}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = False
 Unload Me
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton2_Click()
Dim EndNo As Long, SuppliertRow As Long, COARange As Range, I As Long
Application.EnableCancelKey = xlDisabled
SupplierNo = TextBox1.Text
ListBox1.Visible = False
ListBox2.Visible = False
If SupplierNo = "" Then
 Label19.Caption = Chr(13) & "    Please enter the Supplier #"
 Label19.Visible = True
 Exit Sub
End If
If TextBox2.Text = "" Then
 Label19.Caption = Chr(13) & "    Please enter the Supplier Name"
 Label19.Visible = True
 Exit Sub
End If
If IsNumeric(TextBox8.Text) = False And TextBox8 <> "" Then
 Label19.Caption = Chr(13) & "    Incorrect value for Credit Limit"
 Label19.Visible = True
 Exit Sub
End If
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
  MyBook.Worksheets("Supplier Data").Activate
  Range("B2").Select
  If ActiveCell.Offset(1, 0).Value = "" Then
    Range("B3").Select
  Else
    ActiveCell.End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
  End If
Else
  SupplierRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
  MyBook.Worksheets("Supplier Data").Activate
  Cells(SupplierRow, 2).Select
End If
   ActiveCell.NumberFormat = "@"
   ActiveCell.Value = SupplierNo
   ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
   ActiveCell.Offset(0, -1).Value = Date
   ActiveCell.Offset(0, 1).NumberFormat = "@"
   ActiveCell.Offset(0, 1).Value = TextBox2.Text
   ActiveCell.Offset(0, 2).NumberFormat = "General"
   ActiveCell.Offset(0, 3).NumberFormat = "@"
   ActiveCell.Offset(0, 3).Value = TextBox3.Text
   ActiveCell.Offset(0, 4).NumberFormat = "@"
   ActiveCell.Offset(0, 4).Value = TextBox4.Text
   ActiveCell.Offset(0, 5).NumberFormat = "@"
   ActiveCell.Offset(0, 5).Value = TextBox5.Text
   ActiveCell.Offset(0, 6).NumberFormat = "General"
   ActiveCell.Offset(0, 8).NumberFormat = "@"
   If TextBox6.Text = "Contact Name, Fax # etc (shown on PO)" Then
    ActiveCell.Offset(0, 8).Value = ""
   Else
    ActiveCell.Offset(0, 8).Value = TextBox6.Text
   End If
   ActiveCell.Offset(0, 9).NumberFormat = "@"
   ActiveCell.Offset(0, 9).Value = TextBox9.Text
   ActiveCell.Offset(0, 10).NumberFormat = "@"
   ActiveCell.Offset(0, 10).Value = TextBox10.Text
   ActiveCell.Offset(0, 11).NumberFormat = "@"
   ActiveCell.Offset(0, 11).Value = TextBox11.Text
   ActiveCell.Offset(0, 12).NumberFormat = "@"
   ActiveCell.Offset(0, 12).Value = TextBox12.Text
   If Label26.Caption = "C.O.D." Or Label26.Caption = "Prepaid" Then
     ActiveCell.Offset(0, 6).Value = ""
     ActiveCell.Offset(0, 14).Value = Label26.Caption
   Else
      ActiveCell.Offset(0, 6).Value = TextBox8.Text
    ActiveCell.Offset(0, 14).Value = TextBox7 & " " & Label26.Caption
   End If
MyBook.Worksheets("Supplier Data").Activate
If UCase(Left(SupplierNo, 1)) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) = 5 Then
   If SupplierNo > Range("A1").Value Then Range("A1").Value = SupplierNo
  End If
 End If
End If
Application.EnableEvents = False
TextBox1.Text = "S" & Right(("00000" & Val(Range("A1").Value) + 1), 5)
Application.EnableEvents = True
ListBox1.Clear
MyBook.Worksheets("Supplier Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
ListBox1.AddItem "CLOSE this box"
EventOff = True
TextBox1.Text = "S" & Right(("00000" & Val(Range("A1").Value) + 1), 5)
For I = 2 To 12
 Controls("TextBox" & I).Text = ""
Next I
 TextBox8.Text = "0.00"
 TextBox8.Visible = False
 Label26.Caption = "C.O.D."
 Label26.Left = 114
 Label26.Width = 126
 TextBox7.Text = ""
 TextBox7.Visible = False
 Label23.Visible = False
 Label19.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
EventOff = False
End Sub
Private Sub CommandButton3_Click()
Dim EndNo As Long, SupplierRow As Long, COARange As Range, I As Long, J As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
EventOff = True
SupplierNo = TextBox1.Text
MyBook.Worksheets("Supplier Data").Activate
If SupplierNo = "" Then
  SupplierNo = "S" & Right(("00000" & Val(Range("A1").Value) + 1), 5)
  TextBox1.Text = SupplierNo
 For I = 2 To 12
  Controls("TextBox" & I).Text = ""
 Next I
 TextBox8.Text = "0.00"
 TextBox8.Visible = False
 Label26.Caption = "C.O.D."
 Label26.Left = 114
 Label26.Width = 126
 TextBox7.Text = ""
 TextBox7.Visible = False
 Label23.Visible = False
 Label19.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
 EventOff = False
 Exit Sub
End If
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
  SupplierNo = "S" & Right(("00000" & Val(Range("A1").Value) + 1), 5)
  TextBox1.Text = SupplierNo
 For I = 2 To 12
  Controls("TextBox" & I).Text = ""
 Next I
 TextBox8.Text = "0.00"
 TextBox8.Visible = False
 Label26.Caption = "C.O.D."
 Label26.Left = 114
 Label26.Width = 126
 TextBox7.Text = ""
 TextBox7.Visible = False
 Label23.Visible = False
 Label19.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
 EventOff = False
 Exit Sub
Else
 If SupplierBalance <> 0 Then
  Label19.Caption = Chr(13) & "    There are outstanding payable amount for this supplier," & Chr(13) & _
    "    Deletion of this supplier from the record is not allowed."
  Label19.Visible = True
  EventOff = False
  Exit Sub
 End If
 MyBook.Worksheets("PORecord").Activate
 If Range("B4").Value <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
       Set Tbl = Selection.Columns("P")
    If IsError(Application.Match(SupplierNo, Tbl, 0)) = False Then
     I = Application.Match(SupplierNo, Tbl, 0) + 3
      If Cells(I, 10).Value < "S" Then
        Label19.Caption = Chr(13) & "    There are unsettled PO or Debit note for this supplier," & Chr(13) & _
               "    Deletion of this supplier from the record is not allowed."
        Label19.Visible = True
        EventOff = False
        Exit Sub
      End If
    End If
 End If
  SupplierRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
  MyBook.Worksheets("Supplier Data").Activate
  Cells(SupplierRow, 2).Select
End If
AskReply:
 MSG = "OLD RECORD with the same Supplier # will be removed from the Record" + Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then
    GoTo FinishDelete
    End If
    GoTo AskReply
DataRemoval:
ActiveCell.EntireRow.Delete
MyBook.Worksheets("Supply Data").Activate
If Range("A3").Value <> "" Then
 Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Set Tbl = Selection.Columns("A")
  If IsError(Application.Match(SupplierNo, Tbl, 0)) = False Then
    I = Application.Match(SupplierNo, Tbl, 0) + 2
    J = Application.Match(SupplierNo, Tbl, 1) + 2
    Range(Cells(I, 1), Cells(J, 2)).EntireRow.Delete
  End If
End If
ListBox1.Clear
MyBook.Worksheets("Supplier Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
' Add an extra line to listBox1
ListBox1.AddItem "CLOSE this box"

' Set the value of TextBox1
SupplierNo = "S" & Right(("00000" & Val(Range("A1").Value) + 1), 5)
TextBox1.Text = SupplierNo
' Reset all Textboxes
 For I = 2 To 12
  Controls("TextBox" & I).Text = ""
 Next I
 TextBox8.Text = "0.00"
 TextBox8.Visible = False
 Label26.Caption = "C.O.D."
 Label26.Left = 114
 Label26.Width = 126
 TextBox7.Text = ""
 TextBox7.Visible = False
 Label23.Visible = False
FinishDelete:
 Label19.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
' Add "C" to the worksheet ("NewCom") cell A8 to identify that the file has been changed
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
EventOff = False
End Sub

Private Sub CommandButton4_Click()
 ' Supplier # Button
 ListBox1.Visible = True
 Label19.Visible = False
End Sub

Private Sub CommandButton5_Click()
' New Entry button
' Set the value of TextBox1
Application.EnableCancelKey = xlDisabled
MyBook.Worksheets("Supplier Data").Activate
TextBox1.Text = "S" & Right(("00000" & Val(Range("A1").Value) + 1), 5)
' Reset all Textboxes
 For I = 2 To 12
  Controls("TextBox" & I).Text = ""
 Next I
 TextBox8.Text = "0.00"
 TextBox8.Visible = False
 Label26.Caption = "C.O.D."
 Label26.Left = 114
 Label26.Width = 126
 TextBox7.Text = ""
 TextBox7.Visible = False
 Label23.Visible = False
 Label19.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
End Sub

Private Sub CommandButton6_Click()
ListBox1.Visible = False
ListBox2.Visible = True
End Sub

Private Sub CommandButton7_Click()
Dim I As Long, J As Long, ReportForm As Boolean, SortStyle As Boolean
Application.EnableCancelKey = xlDisabled
  ListBox1.Visible = False
  ListBox2.Visible = False
  UserForm31.OptionButton1.Value = True
  UserForm31.OptionButton3.Value = True
  UserForm31.OptionButton3.Caption = " Sorted by Supplier Number"
  UserForm31.OptionButton4.Caption = " Sorted by Supplier Name"
  UserForm31.Show
  If UserForm31.OptionButton2.Value = True Then
    ReportForm = False
  Else
    ReportForm = True
  End If
  If UserForm31.OptionButton4.Value = True Then
    SortStyle = False
  Else
    SortStyle = True
  End If
  Unload UserForm31
  Label19.BackColor = &H40C0&
  Label19.Caption = Chr(13) & "   Request under processing.  Please wait."
  Label19.Visible = True
  DoEvents
 Application.ScreenUpdating = False
 Application.EnableEvents = False
 Application.DisplayAlerts = False
 ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
Application.EnableEvents = True
ActiveWindow.DisplayGridlines = False
If ReportForm = True Then
  Columns("A:D").Select
  With Selection
    .NumberFormat = "@"
    With .Font
     .Name = "Arial"
     .FontStyle = "Regular"
     .Size = 12
     End With
  End With
  Columns("A").HorizontalAlignment = xlRight
  Columns("C").HorizontalAlignment = xlRight
  Columns("B").HorizontalAlignment = xlLeft
  Columns("D").HorizontalAlignment = xlLeft
  Columns("A").ColumnWidth = 20
  Columns("B").ColumnWidth = 38
  Columns("C").ColumnWidth = 17
  Columns("D").ColumnWidth = 38
 If MyBook.Worksheets("Supplier Data").Range("B3") = "" Then GoTo Finish1
  MyBook.Worksheets("Supplier Data").Activate
   Set Tbl = ActiveSheet.UsedRange
  Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
  If SortStyle = True Then
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
    False, Orientation:=xlTopToBottom
  Else
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
    False, Orientation:=xlTopToBottom
  End If
  Selection.Copy
  ThisWorkbook.Worksheets("Report").Activate
  Range("H1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  I = 5
  J = 1
   Range("I1").Select
  Do While ActiveCell.Value <> ""
   Cells(I, 1).Value = " Supplier # : "
   Cells(I, 2).Value = ActiveCell.Value
   Cells(I + 1, 1).Value = " Supplier Name : "
   Cells(I + 1, 2).Value = ActiveCell.Offset(0, 1).Value
   Cells(I + 2, 1).Value = " Supplier Address : "
   Cells(I + 2, 2).Value = ActiveCell.Offset(0, 3).Value
   Cells(I + 3, 2).Value = ActiveCell.Offset(0, 4).Value
   Cells(I + 4, 2).Value = ActiveCell.Offset(0, 5).Value
   Cells(I + 1, 3).Value = " Contact Detail : "
   Cells(I + 1, 4).Value = ActiveCell.Offset(0, 8).Value
   Cells(I + 2, 3).Value = " Tel # : "
   Cells(I + 2, 4).Value = ActiveCell.Offset(0, 9).Value
   Cells(I + 3, 3).Value = " Fax # : "
   Cells(I + 3, 4).Value = ActiveCell.Offset(0, 10).Value
   Cells(I + 4, 3).Value = " Email : "
   Cells(I + 4, 4).Value = ActiveCell.Offset(0, 11).Value
   Cells(I + 6, 1).Value = " Payment Term : "
   Cells(I + 6, 2).Value = ActiveCell.Offset(0, 14).Value
   Cells(I + 7, 1).Value = " Credit Limit : "
   Cells(I + 7, 2).Value = ActiveCell.Offset(0, 6).Value
   Cells(I + 7, 3).Value = " Purchaser : "
   Cells(I + 7, 4).Value = ActiveCell.Offset(0, 12).Value
   Range(Cells(I + 8, 1), Cells(I + 8, 5)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
   I = I + 10
   J = J + 1
   Cells(J, 9).Select
  Loop
Finish1:
  Range("A1:A2").HorizontalAlignment = xlLeft
  Range("A1") = MyBook.Worksheets("ComData").Range("B2").Value
  Range("A2") = "Suppliers Listing --- Printed on " & Format(Date, "yyyy/mm/dd")
  Range("A3:E3").Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  If Range("A5").Value = "" Then Range("B5").Value = " No Supplier Data in the record"
   Columns("H:AZ").ClearContents
   Range("A1:D19").Select
    ActiveWindow.Zoom = True
     Range("C2").Select
   On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$3"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
Else
 Columns("A:O").Select
  With Selection.Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
  End With
  Columns("A").ColumnWidth = 12
  Columns("B").ColumnWidth = 38
  Columns("D:F").ColumnWidth = 34
  Columns("G").ColumnWidth = 15
  Columns("H").ColumnWidth = 10
  Columns("I").ColumnWidth = 34
  Columns("J:K").ColumnWidth = 20
  Columns("L").ColumnWidth = 34
  Columns("M:O").ColumnWidth = 20
  Columns("A:F").NumberFormat = "@"
  Columns("G:H").NumberFormat = "General"
  Columns("I:O").NumberFormat = "@"
  Columns("G:K").HorizontalAlignment = xlCenter
  Columns("O").HorizontalAlignment = xlCenter
 If MyBook.Worksheets("Supplier Data").Range("B3") = "" Then GoTo Finish2
  MyBook.Worksheets("Supplier Data").Activate
   Set Tbl = ActiveSheet.UsedRange
  Tbl.Offset(2, 1).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
  If SortStyle = True Then
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
    False, Orientation:=xlTopToBottom
  Else
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
    False, Orientation:=xlTopToBottom
  End If
  Selection.Columns("A:O").Copy
 ThisWorkbook.Worksheets("Report").Activate
  Range("A8").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  Application.CutCopyMode = False
Finish2:
  Range("A1:A2").HorizontalAlignment = xlLeft
  Range("A1") = MyBook.Worksheets("ComData").Range("B2").Value
  Range("A2") = "Suppliers Detail Listing ----- Printed on " & Format(Date, "yyyy/mm/dd")
  Range("A6").Value = " Supplier #"
  Range("A7").Value = "----------------"
  Range("B6").Value = " Supplier Name"
  Range("B7").Value = "-------------------------------------------------"
  Range("D6").Value = " Address- Line-1"
  Range("D7").Value = "-------------------------------------------"
  Range("E6").Value = " Address- Line-2"
  Range("E7").Value = "-------------------------------------------"
  Range("F6").Value = " Address- Line-3"
  Range("F7").Value = "-------------------------------------------"
  Range("G6").Value = " Credit Limit"
  Range("G7").Value = "------------------"
  Range("H6").Value = " Dis % "
  Range("H7").Value = "------------"
  Range("I6").Value = " Contact Detail "
  Range("I7").Value = "------------------------------------------------"
  Range("J6").Value = " Tel # "
  Range("J7").Value = "----------------------"
  Range("K6").Value = " Fax # "
  Range("K7").Value = "----------------------"
  Range("L6").Value = " Email "
  Range("L7").Value = "----------------------------------------"
  Range("M6").Value = " Purchaser "
  Range("M7").Value = "-----------------------"
  Range("O6").Value = "Payment Term"
  Range("O7").Value = "-------------------------"
  Columns("N").Delete
  Columns("H").Delete
  Columns("C").Delete
 If Range("A8").Value = "" Then Range("C9").Value = " No Supplier Data in the record"
    Range("A1:E20").Select
    ActiveWindow.Zoom = True
     Range("A4").Select
    On Error GoTo NoPrinter1
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$7"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter1:
End If
Label19.BackColor = &HC0&
Label19.Visible = False
Unload Me
Application.EnableEvents = False
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
SheetName = "Report"
OldForm = "UserForm8"
ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
ThisWorkbook.Worksheets("Report").Activate
Application.EnableEvents = True
End Sub
Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Supplier Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
EventOff = True
RowNo = ListBox1.ListIndex + 2
TextBox1.Text = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value
Call Form14Text1Exit("")
EventOff = False
End Sub
Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
 If ListBox2.ListIndex < 0 Then Exit Sub
If ListBox2.Text <> "C.O.D." And ListBox2.Text <> "Prepaid" Then
 Label26.Left = 144
 Label26.Width = 108
 If ListBox2.Text = "# of Days" Then Label26.Caption = "Days"
 If ListBox2.Text = "# of Days after EOM" Then Label26.Caption = "Days after EOM"
 If TextBox7.Text = "" Then TextBox7.Text = 30
 TextBox7.Visible = True
 TextBox8.Visible = True
Else
 Label26.Left = 114
 Label26.Width = 126
 Label26.Caption = ListBox2.Text
 TextBox7.Visible = False
 TextBox8.Visible = False
End If
 ListBox2.Visible = False
End Sub

Private Sub TextBox1_AfterUpdate()
Dim I As Long, J As Long
Application.EnableCancelKey = xlDisabled
If EventOff = True Then Exit Sub
EventOff = True
SupplierNo = UCase(TextBox1.Text)
If Left(SupplierNo, 1) = " " Then
 I = Len(SupplierNo)
 J = 1
 Do While J <= I And Mid(SupplierNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    SupplierNo = ""
    GoTo InputChecked
  Else
   SupplierNo = Right(SupplierNo, I - J + 1)
  End If
End If
If Right(SupplierNo, 1) = " " Then
 I = Len(SupplierNo)
 J = I
 Do While J > 0 And Mid(SupplierNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    SupplierNo = ""
    GoTo InputChecked
  Else
   SupplierNo = Left(SupplierNo, J)
  End If
End If
InputChecked:
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   If SupplierNo = "00000" Then SupplierNo = Right(("00000" & Val(MyBook.Worksheets("Supplier Data").Range("A1").Value) + 1), 5)
  End If
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
  If SupplierNo = "00000" Then SupplierNo = Right(("00000" & Val(MyBook.Worksheets("Supplier Data").Range("A1").Value) + 1), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
TextBox1.Text = SupplierNo
Call Form14Text1Exit("")
EventOff = False
End Sub
Private Sub TextBox1_Change()
If EventOff = True Then Exit Sub
Label19.Visible = False
ListBox1.Visible = False
End Sub
Private Sub TextBox1_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox10_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox11_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox12_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox2_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox3_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox4_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox5_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox6_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
If TextBox6.Text = "Contact Name, Fax # etc (shown on PO)" Then TextBox6.Text = ""
TextBox6.Font.Italic = False
End Sub
Private Sub TextBox7_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox7_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If IsNumeric(TextBox7.Text) = False Then
 Cancel = True
 Label19.Caption = Chr(13) & "    Incorrect # of Days of payment terms"
 Label19.Visible = True
Else
 Label19.Visible = False
End If
End Sub
Private Sub TextBox8_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox8_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CheckNum As Double
Application.EnableCancelKey = xlDisabled
If TextBox8.Text = "" Then TextBox8.Text = 0
If IsNumeric(TextBox8.Text) = False Then
 Cancel = True
 Label19.Caption = Chr(13) & "    Incorrect Credit Limit"
 Label19.Visible = True
Else
 CheckNum = TextBox8.Text
 TextBox8.Text = Format(CheckNum, "0.00")
 Label19.Visible = False
End If
End Sub

Private Sub TextBox9_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub UserForm_Initialize()
Dim L As Long, M As Long, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ThisWorkbook.Worksheets("ComFactSheet").Activate
Range("E1").Select
ListBox2.Clear
Do While ActiveCell.Value <> ""
ListBox2.AddItem ActiveCell.Value
ActiveCell.Offset(1, 0).Select
Loop
ListBox2.Value = "C.O.D."
ListBox1.Clear
MyBook.Worksheets("Supplier Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
ListBox1.AddItem "CLOSE this box"
 EventOff = True
TextBox1.Text = "S" & Right(("00000" & Val(Range("A1").Value) + 1), 5)
For I = 2 To 12
  Controls("TextBox" & I).Text = ""
 Next I
 TextBox6.Text = "Contact Name, Fax # etc (shown on PO)"
 TextBox6.Font.Italic = True
 TextBox8.Text = "0.00"
 TextBox8.Visible = False
 Label26.Caption = "C.O.D."
 Label26.Left = 114
 Label26.Width = 126
 Label22.Caption = "Credit Limit (" & SysCurrency & ") :"
 TextBox7.Text = ""
 TextBox7.Visible = False
 Label23.Visible = False
 Label19.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 CommandButton5.Visible = False
End If
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "SUPPLIER"
EventOff = False
End Sub
Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub

Attribute VB_Name = "UserForm15"
Attribute VB_Base = "0{0FBD5A8B-AE1B-4CBE-AE83-056C0D5B3597}{1538B0D0-4505-498F-A1A1-8213CC33DEC2}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public DelDate As String, DelNo As Long, LabelAlert As Boolean, Instr1 As String, Instr2 As String, Instr3 As String

Private Sub CheckBox1_Click()
Application.EnableCancelKey = xlDisabled
If CheckBox1.Value = True Then
  CommandButton17.Visible = True
  Exit Sub
End If
If CheckBox1.Value = False Then CommandButton17.Visible = False
If TextBox48.Text <> "" Then
  CommandButton17.Visible = True
  Exit Sub
End If
ThisWorkbook.Worksheets("TempRP").Activate
 Range("C43").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 9).Value <> "" Then
    CommandButton17.Visible = True
    Exit Sub
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
End Sub

Private Sub CommandButton1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim FInvRow As Long, LInvRow As Long, I As Long, J As Long, AccountNo As String, SubTotal As Double, DisAccount As String
Dim AcctYear As Long, JournalCode As String, JournalRange As Range, JournalNum As String, TranNo As String, InvPrefix As String
Dim CheckRange As Range, LineNo As Long, OldData As Boolean, AssetNo As String, OldDNDate As Date
Dim LowValueFlag As String, ZeroQtyFlag As String, SettleDate As Date
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
  EventOff = True
If CommandButton1.Caption = "Edit PO" Then
   Label23.Visible = False
   Label1.Caption = "PURCHASE ORDER"
    CommandButton1.Caption = "Save PO"
    CommandButton11.Visible = False
    CommandButton4.Visible = True
    CheckBox1.Visible = False
    TextBox48.Text = ""
    TextBox48.Visible = False
    Label47.Visible = False
    Label48.Visible = False
    TextBox50.Text = ""
    TextBox50.Visible = False
    Label55.Visible = False
    Label56.Visible = False
    Label57.Visible = False
    Label50.Visible = False
    Label60.Visible = True
    For I = 35 To 40 Step 1
     Controls("Textbox" & I).Text = ""
     Controls("Textbox" & I).Visible = False
    Next I
    ThisWorkbook.Worksheets("TempRP").Activate
     Range("L42: L62").ClearContents
     CheckBox1.Value = False
    CommandButton17.Visible = False
     Label46.Visible = True
     Label42.Visible = True
     Label33.Visible = True
     Label34.Visible = True
     Label35.Visible = True
     Label36.Visible = True
     Label37.Visible = True
     Label38.Visible = True
     CommandButton19.Visible = True
     If InvStatus = "*" Then CommandButton13.Visible = True
    Call Form15Update("")
    Call Form15AmountRefresh("")
    EventOff = False
   Exit Sub
End If
If CommandButton1.Caption = "Edit DN" Then
    Label23.Visible = False
    Label1.Caption = "DEBIT NOTE"
    CommandButton1.Caption = "Save DN"
    CommandButton4.Visible = False
    CommandButton13.Visible = True
    CheckBox1.Visible = False
    TextBox48.Visible = False
    Label47.Visible = False
    Label48.Visible = False
    TextBox50.Text = ""
    TextBox50.Visible = False
    Label55.Visible = False
    Label56.Visible = False
    Label57.Visible = False
    Label50.Visible = False
    For I = 35 To 40 Step 1
      Controls("Textbox" & I).Text = ""
      Controls("Textbox" & I).Visible = False
    Next I
     Label46.Visible = False
     Label42.Visible = False
     Label33.Visible = False
     Label34.Visible = False
     Label35.Visible = False
     Label36.Visible = False
     Label37.Visible = False
     Label38.Visible = False
    CommandButton17.Visible = False
    Call DNoteUpdate("")
    Call Form15AmountRefresh("")
    EventOff = False
   Exit Sub
End If
 If LabelAlert = True And Label23.Visible = True Then
   LabelAlert = False
   EventOff = False
   Exit Sub
 End If
LabelAlert = False
If SupplierNo = "" Or SupplierName = "" Then
 Label23.Caption = Chr(13) & "    Supplier Number is incorrect.  Please enter correct data"
 Label23.Visible = True
 TextBox1.SetFocus
 EventOff = False
 Exit Sub
End If
If TextBox3.Text = "" Or IsDate(InvDate) = False Then
  Label23.Caption = Chr(13) & "    Please enter the Date"
  Label23.Visible = True
  TextBox3.SetFocus
  EventOff = False
 Exit Sub
End If
 OldData = False
If Label1.Caption = "DEBIT NOTE" And InvDate < BeginningDate Then
 If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
  MSG = "WARNING" & Chr(13) & Chr(13) & "The date entered belongs to previous Posted year" & Chr(13) & _
    "Thus, no posting to the Inventory and the General Ledger." & Chr(13) & Chr(13) _
     + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
   Title = "WARNING"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then
     OldData = True
     GoTo DateProceed
    End If
    If C = "N" Or C = "n" Or C = "" Then
     Label23.Caption = Chr(13) & "    Please enter a new Date and then click 'Save' Button again. "
     Label23.Visible = True
     EventOff = False
     Exit Sub
    End If
    GoTo AskReply
  Else
     Label23.Caption = Chr(13) & "    The date entered belongs to previous Posted year" & _
     Chr(13) & "    Please enter a new Date and then click 'Save' Button again. "
     Label23.Visible = True
     EventOff = False
     Exit Sub
  End If
End If
DateProceed:
If PONo = "" Then
 If Label1.Caption = "PURCHASE ORDER" Then
  PONo = Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
  TextBox2.Text = PONo
  PONo = "P" & PONo
 Else
  PONo = Right(("00000" & Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1), 6)
  TextBox2.Text = PONo
  PONo = "DN" & PONo
 End If
End If
If Label1.Caption = "PURCHASE ORDER" Then
 If TextBox47.Text = "" Then
   Label23.Caption = Chr(13) & "    Please enter the required Delivery Date"
   Label23.Visible = True
   TextBox47.SetFocus
   EventOff = False
   Exit Sub
 End If
 If IsDate(TextBox47.Text) = False Then
   Label23.Caption = Chr(13) & "    The Delivery Date inputted is Not a Valid Date. "
   Label23.Visible = True
   TextBox47.SetFocus
   EventOff = False
   Exit Sub
 End If
 DelDate = TextBox47.Text
End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("C43").Select
  I = 1
  Do While I < 21
   If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
   I = I + 1
  Loop
 Call Form15AmountRefresh("")
 If Range("C43").Value = "" Then
   Label23.Caption = Chr(13) & "     No product is entered in the form.   Please add products before proceed."
   Label23.Visible = True
   GoTo FormRefresh
 End If
 LowValueFlag = ""
 ZeroQtyFlag = ""
If Label1.Caption = "DEBIT NOTE" And OldData <> True Then
 Range("C43").Select
 Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 12).Value <> "" And ActiveCell.Offset(0, 14).Value = "" Then
    If ActiveCell.Offset(0, 13).Value - ActiveCell.Offset(0, 3).Value < 0 Then
     Label23.Caption = Chr(13) & "    Insufficient Stock quantity for " & ActiveCell.Offset(0, 1).Value & Chr(13) _
                     & Chr(13) & "    Thus, this Debit Note cannot be proceeded."
     Label23.Visible = True
     GoTo FormRefresh
    ElseIf ActiveCell.Offset(0, 16).Value - ActiveCell.Offset(0, 6).Value < 0 Then
      If LowValueFlag = "" Then
       LowValueFlag = ActiveCell.Offset(0, 12).Value
      Else
       LowValueFlag = LowValueFlag & "; " & ActiveCell.Offset(0, 12).Value
      End If
    ElseIf (ActiveCell.Offset(0, 13).Value - ActiveCell.Offset(0, 3).Value = 0) And (ActiveCell.Offset(0, 16).Value - ActiveCell.Offset(0, 6).Value) <> 0 Then
      If ZeroQtyFlag = "" Then
       ZeroQtyFlag = ActiveCell.Offset(0, 12).Value
      Else
       ZeroQtyFlag = ZeroQtyFlag & "; " & ActiveCell.Offset(0, 12).Value
      End If
    End If
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
 If LowValueFlag <> "" And ZeroQtyFlag <> "" Then
  MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Debit Note CANNOT be proceeded because it will make the book value of some stock items negative.  " & _
  "Also, the stock qty of some stock items will become zero but the book value will not be zero.  ")
  GoTo FormRefresh
 ElseIf LowValueFlag <> "" Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Debit Note CANNOT be proceeded because it will make the book value of " & LowValueFlag & " negative.  ")
   GoTo FormRefresh
 ElseIf ZeroQtyFlag <> "" Then
  MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Debit Note CANNOT be proceeded because it will make the stock qty of " & ZeroQtyFlag & " zero. " & _
       "But the book value of these stock items not zero. ")
    GoTo FormRefresh
 End If
End If


If InvStatus <> "*" And Label1.Caption = "PURCHASE ORDER" Then
  Range("C43").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 3).Value <> ActiveCell.Offset(0, 8).Value Then
    InvStatus = "P"
    GoTo StatusUpdate
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
  If InvStatus = "P" Then InvStatus = "R"
    If Range("M1").Value <> "" Then
      If IsDate(Range("M1").Value) = True Then
       SettleDate = Range("M1").Value
      Else
       SettleDate = Date
      End If
    Else
      SettleDate = Date
    End If
StatusUpdate:
   MyBook.Worksheets("Payable").Activate
  If InvStatus = "R" And OSAmt = 0 Then
    Set CheckRange = MyBook.Worksheets("Payable").Columns("B")
   If IsError(Application.Match(PONo, CheckRange, 0)) = True Then
     InvStatus = "S"
   ElseIf Range("B4").Value <> "" Then
      ActiveSheet.UsedRange.Select
      Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
      Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Set CheckRange = MyBook.Worksheets("Payable").UsedRange.Offset(3, 0).Columns("B")
     If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
       FInvRow = Application.Match(PONo, CheckRange, 0) + 3
       LInvRow = Application.Match(PONo, CheckRange, 1) + 3
       Range(Cells(FInvRow, 10), Cells(LInvRow, 10)).Value = "R"
       Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
       Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).Value = Format(SettleDate, "yyyy/mm/dd")
       I = FInvRow
       Do While I <= LInvRow
        If Cells(I, 11).Value <> 0 Then GoTo POPrepare
         I = I + 1
       Loop
       Range(Cells(FInvRow, 10), Cells(LInvRow, 10)).Value = "S"
       Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
       Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).Value = Format(SettleDate, "yyyy/mm/dd")
       InvStatus = "S"
     Else
      InvStatus = "S"
     End If
   End If
  Else
   If Range("B4").Value <> "" Then
      ActiveSheet.UsedRange.Select
      Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
      Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Set CheckRange = MyBook.Worksheets("Payable").UsedRange.Offset(3, 0).Columns("B")
     If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
       FInvRow = Application.Match(PONo, CheckRange, 0) + 3
       LInvRow = Application.Match(PONo, CheckRange, 1) + 3
       I = FInvRow
       Range(Cells(FInvRow, 10), Cells(LInvRow, 10)).Value = InvStatus
       If InvStatus = "S" Then
        Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
        Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).Value = Format(SettleDate, "yyyy/mm/dd")
       Else
        Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).ClearContents
       End If
     End If
   End If
  End If
End If

POPrepare:
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("1").ClearContents
 Range("C1").NumberFormat = "General"
 Range("D1").NumberFormat = "yyyy/mm/dd"
 Range("D1").Value = InvDate
 Range("E1").NumberFormat = "General"
 Range("E1").Value = CreditorAcct
 Range("J1").Value = InvStatus
 Range("H1:I1").NumberFormat = "General"
 Range("J1").NumberFormat = "@"
 Range("K1").NumberFormat = "General"
 Range("K1").Value = OSAmt
 Range("M1:N1").NumberFormat = "yyyy/mm/dd"
 If InvStatus = "S" Or (InvStatus = "R" And OSAmt = 0) Then Range("M1").Value = SettleDate
 Range("N1").Value = DueDate
 Range("O1:AC1").NumberFormat = "@"
 Range("O1").Value = PayTerm
 Range("P1").Value = SupplierNo
 Range("Q1").Value = SupplierName
 Range("R1").Value = Address1
 Range("S1").Value = Address2
 Range("T1").Value = Address3
 Range("U1").Value = CustContact
 Range("V1").Value = TelNo
 Range("AB1").Value = CustPO
 Range("AC1").Value = SalesRep
 Range("AD1:AF1").NumberFormat = "General"
 Range("AE1").Value = DisAmount
 Range("AG1").NumberFormat = "yyyy/mm/dd"
 Range("AG1").Value = DelDate
 Range("AH1").NumberFormat = "@"
 Range("AH1").Value = Remarks
 Range("IT1:IV1").NumberFormat = "@"
 Range("IT1").Value = TextBox53.Text
 Range("IU1").Value = TextBox54.Text
 Range("IV1").Value = TextBox55.Text
   Range("F1").NumberFormat = "General"
   Range("F1").FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
   Range("F1").NumberFormat = "@"
   Range("F1").Copy
   Range("F1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
Range("B1").NumberFormat = "@"
If Label1.Caption = "PURCHASE ORDER" Then
 Range("A1").Value = "PO"
 Range("B1").Value = PONo
 Range("G1").Value = "PO " & PONo & " for " & SupplierName
 Range("K1").Value = OSAmt
 Range("AF1").Value = TotalAmount
 Range("W1").Value = DelName
 Range("X1").Value = DelAddress1
 Range("Y1").Value = DelAddress2
 Range("Z1").Value = DelAddress3
 Range("AA1").Value = DelContact
 Range(Cells(1, 35), Cells(1, 253)).ClearContents
 I = 35
 J = 0
 Range("C43").Select
 Do While ActiveCell.Value <> ""
  Cells(1, I).NumberFormat = "General"
  Cells(1, I).Value = ActiveCell.Value
  Range(Cells(1, I + 1), Cells(1, I + 2)).NumberFormat = "@"
  Range(Cells(1, I + 3), Cells(1, I + 8)).NumberFormat = "General"
  Cells(1, I + 1).Value = ActiveCell.Offset(0, 1).Value
  Cells(1, I + 2).Value = ActiveCell.Offset(0, 2).Value
  If ActiveCell.Offset(0, 3).Value = "" Then ActiveCell.Offset(0, 3).Value = 0
  Cells(1, I + 3).Value = ActiveCell.Offset(0, 3).Value
  Cells(1, I + 4).Value = ActiveCell.Offset(0, 4).Value
  If ActiveCell.Offset(0, 5).Value = "" Then ActiveCell.Offset(0, 5).Value = 0
  Cells(1, I + 5).Value = ActiveCell.Offset(0, 5).Value
  Cells(1, I + 6).Value = ActiveCell.Offset(0, 6).Value
  Cells(1, I + 7).Value = ActiveCell.Offset(0, 7).Value
  Cells(1, I + 8).Value = ActiveCell.Offset(0, 8).Value
  I = I + 9
  J = J + 1
 ActiveCell.Offset(1, 0).Select
 Loop
Range("AD1").Value = J
MyBook.Worksheets("PORecord").Activate
If Range("B4").Value <> "" Then
 ActiveSheet.UsedRange.Select
 Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
 If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
  MyBook.Worksheets("PORecord").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
 End If
End If
 MyBook.Worksheets("PORecord").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("1").Copy
 MyBook.Worksheets("PORecord").Activate
 ActiveSheet.Paste
 Application.CutCopyMode = False
 MyBook.Worksheets("PORecord").Activate
 Range("C1").Select
 
 If Len(PONo) = 7 Then
  If Left(PONo, 1) = "P" And Right(PONo, 1) <> " " Then
   PONo = Right(PONo, 6)
   If IsNumeric(PONo) Then
    If PONo > Right("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value), 6) Then MyBook.Worksheets("PORecord").Range("A1").Value = PONo
    If MyBook.Worksheets("PORecord").Range("A1").Value = "999999" Then MyBook.Worksheets("PORecord").Range("A1").Value = "000000"
   End If
  End If
 End If
 PONo = "P" & Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
Else
 Range("A1").Value = "DEBIT NOTE"
 Range("B1").Value = PONo
 If TextBox47.Text = "" Or IsDate(TextBox47.Text) = False Then
   Range("N1").Value = InvDate
 Else
   Range("N1").Value = TextBox47.Text
 End If
 If TotalAmount >= 0 Then
  Range("H1").Value = Format(TotalAmount, "0.00")
 Else
  Range("I1").Value = Format(TotalAmount * (-1), "0.00")
 End If
 If TotalAmount = 0 Then
  Range("K1").Value = Format(TotalAmount, "0.00")
  Range("AF1").Value = Format(TotalAmount, "0.00")
 Else
  Range("K1").Value = Format(TotalAmount * (-1), "0.00")
  Range("AF1").Value = Format(TotalAmount * (-1), "0.00")
 End If
 Range("G1").Value = "Debit note " & PONo & " for " & SupplierName
Range(Cells(1, 35), Cells(1, 253)).ClearContents
 I = 35
 J = 0
 Range("C43").Select
 Do While ActiveCell.Value <> ""
  Cells(1, I).NumberFormat = "General"
  Cells(1, I).Value = ActiveCell.Value
  Range(Cells(1, I + 1), Cells(1, I + 2)).NumberFormat = "@"
  Range(Cells(1, I + 3), Cells(1, I + 6)).NumberFormat = "General"
  Range(Cells(1, I + 7), Cells(1, I + 8)).NumberFormat = "@"
  Cells(1, I + 1).Value = ActiveCell.Offset(0, 1).Value
  Cells(1, I + 2).Value = ActiveCell.Offset(0, 2).Value
  Cells(1, I + 4).Value = ActiveCell.Offset(0, 4).Value
  Cells(1, I + 5).Value = ActiveCell.Offset(0, 5).Value
  If ActiveCell.Offset(0, 3).Value = 0 Then
    Cells(1, I + 3).Value = 0
  Else
   Cells(1, I + 3).Value = ActiveCell.Offset(0, 3).Value * (-1)
  End If
  If ActiveCell.Offset(0, 6).Value = 0 Then
    Cells(1, I + 6).Value = 0
  Else
    Cells(1, I + 6).Value = ActiveCell.Offset(0, 6).Value * (-1)
  End If
  Cells(1, I + 7).Value = ActiveCell.Offset(0, 12).Value
  Cells(1, I + 8).Value = ""
  I = I + 9
  J = J + 1
  ActiveCell.Offset(1, 0).Select
 Loop
Range("AD1").Value = J
 MyBook.Worksheets("PORecord").Activate
 If Range("B4").Value <> "" Then
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
  If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
   MyBook.Worksheets("PORecord").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
  End If
 End If
 MyBook.Worksheets("PORecord").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("1").Copy
 MyBook.Worksheets("PORecord").Activate
 ActiveSheet.Paste
 Application.CutCopyMode = False
 If IsError(Application.Match(PONo, MyBook.Worksheets("Payable").Range("B:B"), 0)) = False Then
   MyBook.Worksheets("Payable").Activate
     ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Selection.Columns("B")
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
   Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("3").ClearContents
 Range("A1:U1").Copy
 Range("A3").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("K3:L3").NumberFormat = "General"
 Range("L3").Value = Range("K3").Value
 Range("V3").Value = InvStatus
 Range("X3").NumberFormat = "General"
 Range("X3").Value = Range("AD1").Value
 I = 25
 J = 0
 Range("C43").Select
 Do While ActiveCell.Value <> ""
  Cells(3, I).NumberFormat = "General"
  Cells(3, I).Value = ActiveCell.Value
  Range(Cells(3, I + 1), Cells(3, I + 2)).NumberFormat = "@"
  Range(Cells(3, I + 3), Cells(3, I + 6)).NumberFormat = "General"
  Cells(3, I + 1).Value = ActiveCell.Offset(0, 1).Value
  Cells(3, I + 2).Value = ActiveCell.Offset(0, 2).Value
  Cells(3, I + 4).Value = ActiveCell.Offset(0, 4).Value
  Cells(3, I + 5).Value = ActiveCell.Offset(0, 5).Value
  If ActiveCell.Offset(0, 3).Value = 0 Then
    Cells(3, I + 3).Value = 0
  Else
   Cells(3, I + 3).Value = ActiveCell.Offset(0, 3).Value * (-1)
  End If
  If ActiveCell.Offset(0, 6).Value = 0 Then
    Cells(3, I + 6).Value = 0
  Else
    Cells(3, I + 6).Value = ActiveCell.Offset(0, 6).Value * (-1)
  End If
  I = I + 7
  J = J + 1
 ActiveCell.Offset(1, 0).Select
 Loop
  MyBook.Worksheets("Payable").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
  ThisWorkbook.Worksheets("TempRP").Activate
  Rows("3").Copy
  MyBook.Worksheets("Payable").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
 ThisWorkbook.Worksheets("TempRP").Activate
    Rows("105:154").ClearContents
   If Range("D15") <> "" Then
     OldDNDate = Range("A15").Value
     Range("A15:P34").Copy
     Range("A105").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
      Range("A105:P124").Select
     Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
     False, Orientation:=xlTopToBottom
     Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
     Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
     ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
      Call DNIOAdd(OldDNDate, PONo)
      ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
   End If
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("105:154").ClearContents
   Rows("15:34").ClearContents
 If InvDate >= BeginningDate Then
   Range("A43: P62").Copy
   Range("A105").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
     Range("A105:P124").Select
   Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
     False, Orientation:=xlTopToBottom
    Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 End If
 If Range("C105").Value <> "" Then
   ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
    Call DNIOAdd(InvDate, PONo)
   ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
 End If
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("100:154").ClearContents
 Range("C43:P62").Select
    Selection.Sort Key1:=Range("C3"), Order1:=xlAscending, Key2:=Range("D3"), Order2:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  I = 4
  Range("C43").Select
   Do While ActiveCell.Value <> ""
    Range("A3:I3").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Range(Cells(I, 8), Cells(I, 9)).ClearContents
    Range("C43").Select
    AccountNo = ActiveCell.Value
    SubTotal = ActiveCell.Offset(0, 6).Value
    Do While ActiveCell.Offset(1, 0).Value = AccountNo
     SubTotal = SubTotal + ActiveCell.Offset(1, 6).Value
     ActiveCell.EntireRow.Delete
    Loop
    SubTotal = Format(SubTotal, "0.00")
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Cells(I, 9).NumberFormat = "General"
     If SubTotal >= 0 Then
      Cells(I, 9).Value = Format(SubTotal, "0.00")
     Else
      Cells(I, 8).Value = Format(SubTotal * (-1), "0.00")
     End If
     I = I + 1
    ActiveCell.EntireRow.Delete
    Loop
   Range(Cells(3, 6), Cells(I - 1, 6)).NumberFormat = "General"
   Range(Cells(3, 6), Cells(I - 1, 6)).FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
   Range(Cells(3, 6), Cells(I - 1, 6)).NumberFormat = "@"
   Range(Cells(3, 6), Cells(I - 1, 6)).Copy
   Range(Cells(3, 6), Cells(I - 1, 6)).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  MyBook.Worksheets("Raw Data").Activate
  If Range("B4").Value = "" Then GoTo NewData
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("J")
 If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
  JournalCode = MyBook.Worksheets("Raw Data").Cells(FInvRow, 1).Value
  TranNo = MyBook.Worksheets("Raw Data").Cells(FInvRow, 2).Value
   MyBook.Worksheets("Raw Data").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(3, 10), Cells(I - 1, 10)).NumberFormat = "@"
   Range(Cells(3, 10), Cells(I - 1, 10)).Value = PONo
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(3, 1), Cells(I - 1, 1)).NumberFormat = "@"
   Range(Cells(3, 1), Cells(I - 1, 1)).Value = JournalCode
   Range(Cells(3, 2), Cells(I - 1, 2)).NumberFormat = "@"
   Range(Cells(3, 2), Cells(I - 1, 2)).Value = TranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(3, 1), Cells(I - 1, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
   P = Period(InvDate) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
 Else
NewData:
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(3, 10), Cells(I - 1, 10)).NumberFormat = "@"
   Range(Cells(3, 10), Cells(I - 1, 10)).Value = PONo
   AcctYear = Int((Period(InvDate) - Period(BeginningDate)) / 12)
   AcctYear = AcctYear + Year(BeginningDate)
   JournalCode = "PV" & AcctYear
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   JcodeRow = 251
   Set JournalRange = Range("G250")
   If ActiveCell.Offset(1, 0).Value <> "" Then
    Range("G250").End(xlDown).Select
    JcodeRow = ActiveCell.Row + 1
   End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Range(Cells(JcodeRow, 7), Cells(JcodeRow, 8)).NumberFormat = "@"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
   Else
    JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
    LastTranNo = Cells(JcodeRow, 8).Value
    LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
    Cells(JcodeRow, 8).NumberFormat = "@"
    Cells(JcodeRow, 8).Value = LastTranNo
   End If
   LastJournalCode = JournalCode
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(3, 1), Cells(I - 1, 1)).NumberFormat = "@"
   Range(Cells(3, 1), Cells(I - 1, 1)).Value = JournalCode
   Range(Cells(3, 2), Cells(I - 1, 2)).NumberFormat = "@"
   Range(Cells(3, 2), Cells(I - 1, 2)).Value = LastTranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(3, 1), Cells(I - 1, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
   P = Period(InvDate) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
 End If
Finish:
 MyBook.Worksheets("PORecord").Activate
 Range("C1").Select
 PONo = Right(PONo, 5)
 If PONo = Right(("00000" & Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1), 5) Then MyBook.Worksheets("PORecord").Range("F1").Value = PONo
 If MyBook.Worksheets("PORecord").Range("F1").Value = "99999" Then MyBook.Worksheets("PORecord").Range("F1").Value = "00000"
 PONo = "DN" & Right(("00000" & Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1), 5)
End If
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
TextBox1.Text = ""
Call POTempFormat("")
Call Form15Text1Exit("")
DelNo = 0
ScrollBar1.Max = 15
ScrollBar1.Min = 1
ScrollBar1.Value = 1
CommandButton11.Visible = False
CommandButton13.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
FinishSave:
 CommandButton4.Visible = False
 TextBox4.SetFocus
 EventOff = False
 Exit Sub
FormRefresh:
LineNo = ScrollBar1.Value
ThisWorkbook.Worksheets("TempRP").Activate
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = LineNo + I - 1
  Controls("TextBox" & I * 5).Text = Cells(LineNo + 41 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(LineNo + 41 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(LineNo + 41 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(LineNo + 41 + I, 7).Value
  Controls("TextBox" & I * 5 + 4).Text = Cells(LineNo + 41 + I, 8).Value
  Controls("Label" & I + 26).Caption = Format(Cells(LineNo + 41 + I, 9).Value, "#,##0.00")
  Controls("Label" & I + 32).Caption = Cells(LineNo + 41 + I, 11).Value
  Controls("TextBox" & I + 34).Text = Cells(LineNo + 41 + I, 12).Value
 Next I
 EventOff = False
End Sub

Private Sub CommandButton1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
LabelAlert = False
End Sub

Private Sub CommandButton11_Click()
Dim PartNotFound As String, ProductNo As String, SuppRow As Long
Dim ProdRow As Long, I As Long, CheckRange As Range
Application.EnableCancelKey = xlDisabled
If Label1.Caption <> "PURCHASE ORDER" And Label1.Caption <> "PURCHASE ORDER " Then Exit Sub
EventOff = True
Label1.Caption = "PURCHASE ORDER"
PONo = Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
TextBox2.Text = PONo
PONo = "P" & PONo
InvDate = Date
DueDate = Date
InvStatus = "*"
OSAmt = 0
TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
TextBox47.Text = ""
CustPO = ""
TextBox4.Text = CustPO
ScrollBar1.Max = 15
CommandButton11.Visible = False
CommandButton1.Caption = "Save PO"
CommandButton1.Visible = True
Label23.Visible = False
ThisWorkbook.Worksheets("TempRP").Activate
Range("J42:K63").ClearContents
Rows("1").ClearContents
 For I = 35 To 40 Step 1
  Controls("Textbox" & I).Text = ""
  Controls("Textbox" & I).Visible = False
 Next I
 For I = 33 To 38 Step 1
  Controls("Label" & I).Caption = ""
  Controls("Label" & I).Visible = False
 Next I
CheckBox1.Visible = False
TextBox48.Visible = False
Label47.Visible = False
Label48.Visible = False
TextBox50.Text = ""
TextBox50.Visible = False
Label54.Visible = False
Label55.Visible = False
Label56.Visible = False
Label57.Visible = False
Label50.Visible = False
CommandButton17.Visible = False
Label46.Visible = False
Label42.Visible = False
Label23.Visible = False
CommandButton20.Visible = False
CommandButton19.Visible = True
 SupplierNo = TextBox1.Text
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) = True Then
  SupplierNo = ""
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.UsedRange.Delete
  Label3.Caption = "Supplier : -  "
  Label23.Caption = Chr(13) & "    The supplier number is no longer in the Record"
  Label23.Visible = True
  ScrollBar1.Value = 1
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = I
  Controls("TextBox" & I * 5).Text = Cells(42 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(42 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(42 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(42 + I, 7).Value
  Controls("TextBox" & I * 5 + 4).Text = Cells(42 + I, 8).Value
  Controls("Label" & I + 26).Caption = Format(Cells(42 + I, 9).Value, "#,##0.00")
 Next I
 Call Form15AmountRefresh("")
 Call Form15PartList("")
  CommandButton4.Visible = False
  EventOff = False
 Exit Sub
End If
 SuppRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
 MyBook.Worksheets("Supplier Data").Activate
 Cells(SuppRow, 2).Select
 SupplierNo = ActiveCell.Value
 SupplierName = ActiveCell.Offset(0, 1).Value
 Address1 = ActiveCell.Offset(0, 3).Value
 Address2 = ActiveCell.Offset(0, 4).Value
 Address3 = ActiveCell.Offset(0, 5).Value
 CreditSum = ActiveCell.Offset(0, 6).Value
 CustContact = ActiveCell.Offset(0, 8).Value
 TelNo = ""
 SalesRep = ActiveCell.Offset(0, 12).Value
 PayTerm = ActiveCell.Offset(0, 14).Value
 Label3.Caption = "Supplier :-   " & Chr(13) & "     " & SupplierName & Chr(13) & _
 "     " & Address1 & Chr(13) & _
 "     " & Address2 & Chr(13) & _
 "     " & Address3 & Chr(13) & _
 "     Contact: " & CustContact
 TextBox46.Text = SalesRep
 Label39.Caption = PayTerm
 Call Form15PartList("")
 If PartStartRow = 0 Then
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.UsedRange.Delete
   Label3.Caption = "Supplier : -  "
   Label23.Caption = Chr(13) & "    No part item from the supplier is found in the record"
   Label23.Visible = True
   ScrollBar1.Value = 1
   For I = 1 To 6
    Controls("Label" & I + 14).Caption = I
    Controls("TextBox" & I * 5).Text = Cells(42 + I, 4).Value
    Controls("TextBox" & I * 5 + 1).Text = Cells(42 + I, 5).Value
    Controls("TextBox" & I * 5 + 2).Text = Cells(42 + I, 6).Value
    Controls("TextBox" & I * 5 + 3).Text = Cells(42 + I, 7).Value
    Controls("TextBox" & I * 5 + 4).Text = Cells(42 + I, 8).Value
    Controls("Label" & I + 26).Caption = Format(Cells(42 + I, 9).Value, "#,##0.00")
   Next I
  Call Form15AmountRefresh("")
  EventOff = False
  Exit Sub
 End If
  MyBook.Worksheets("Supply Data").Activate
  Set CheckRange = MyBook.Worksheets("Supply Data").Range(Cells(PartStartRow, 4), Cells(PartEndRow, 4))
ThisWorkbook.Worksheets("TempRP").Activate
Range("D43").Select
PartNotFound = ""
Do While ActiveCell.Value <> ""
 ProductNo = ActiveCell.Value
 If IsError(Application.Match(ProductNo, CheckRange, 0)) Then
  ActiveCell.EntireRow.Delete
  PartNotFound = "Yes"
 Else
  ProdRow = Application.Match(ProductNo, CheckRange, 0) + PartStartRow - 1
  ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 5).Value
  ActiveCell.Offset(0, 3).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 6).Value
  If MyBook.Worksheets("Supply Data").Cells(ProdRow, 9).Value = "Yes" Then
   ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 10).Value
   ActiveCell.Offset(0, 11).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 11).Value
  Else
   ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Supply Data").Cells(ProdRow, 7).Value
   ActiveCell.Offset(0, 11).Value = ""
  End If
  ActiveCell.Offset(0, 5).Value = ActiveCell.Offset(0, 2).Value * ActiveCell.Offset(0, 3).Value * (1 - (ActiveCell.Offset(0, 4).Value / 100))
  ActiveCell.Offset(1, 0).Select
 End If
Loop
  Call Form15AmountRefresh("")
 ScrollBar1.Value = 1
  For I = 1 To 6
  Controls("Label" & I + 14).Caption = I
  Controls("TextBox" & I * 5).Text = Cells(42 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(42 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(42 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(42 + I, 7).Value
  Controls("TextBox" & I * 5 + 4).Text = Cells(42 + I, 8).Value
  Controls("Label" & I + 26).Caption = Format(Cells(42 + I, 9).Value, "#,##0.00")
 Next I
If PartNotFound = "Yes" Then
   Label23.Caption = Chr(13) & "    ALERT !! Some of the items are deleted " & Chr(13) & _
      "    because they are no longer in the Purchase Item list"
   Label23.Visible = True
End If
 EventOff = False
End Sub

Private Sub CommandButton12_Click()
Application.EnableCancelKey = xlDisabled
 If Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "PURCHASE ORDER " Then
  Label1.Caption = "PURCHASE ORDER"
  PONo = "P" & Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
  CommandButton1.Caption = "Save PO"
  Label60.Visible = True
 Else
  Label1.Caption = "DEBIT NOTE"
  PONo = "DN" & Right(("00000" & Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1), 5)
  CommandButton1.Caption = "Save DN"
 End If
 EventOff = True
TextBox1.Text = ""
Call POTempFormat("")
Call Form15Text1Exit("")
DelNo = 0
 If Label1.Caption = "PURCHASE ORDER" Then CommandButton19.Visible = True
 CommandButton1.Visible = True
 CommandButton13.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
 Label23.Visible = False
 CommandButton4.Visible = False
 CommandButton11.Visible = False
 EventOff = False
End Sub

Private Sub CommandButton13_Click()
Dim C As String, OldDNDate As Date
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
If InvStatus <> "*" Then
 If Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "PURCHASE ORDER " Then
  Label23.Caption = Chr(13) & "   Delivery has been made, No deletion of this PO is allowed"
 Else
  Label23.Caption = Chr(13) & "   Payment has been made, No deletion of this Debit Note is allowed"
 End If
  Label23.Visible = True
  CommandButton13.Visible = False
  Exit Sub
End If
 EventOff = True
 If Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "PURCHASE ORDER " Then
 If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = True Then GoTo SheetUpdate
 InvRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
AskReply1:
   MSG = "The PO will be removed from the Record" + Chr(13) + _
    Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval1
    If C = "N" Or C = "n" Or C = "" Then GoTo FinishDelete
    GoTo AskReply1
DataRemoval1:
 MyBook.Worksheets("PORecord").Activate
 Cells(InvRow, 1).EntireRow.Delete
End If
If Label1.Caption = "DEBIT NOTE" Or Label1.Caption = "DEBIT NOTE " Then
 If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = True Then GoTo SheetUpdate
 InvRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
AskReply2:
   MSG = "The Debit Note will be removed from the Record" + Chr(13) + _
    Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval2
    If C = "N" Or C = "n" Or C = "" Then GoTo FinishDelete
    GoTo AskReply2
DataRemoval2:
 MyBook.Worksheets("PORecord").Activate
 Cells(InvRow, 1).EntireRow.Delete
 If IsError(Application.Match(PONo, MyBook.Worksheets("Payable").Range("B:B"), 0)) = False Then
   MyBook.Worksheets("Payable").Activate
     ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Selection.Columns("B")
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
   Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
 End If
 MyBook.Worksheets("Raw Data").Activate
 If Range("B4").Value <> "" Then
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Selection.Columns("J")
  If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
   Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
  End If
 End If
  ThisWorkbook.Worksheets("TempRP").Activate
    Rows("105:154").ClearContents
   If Range("D15") <> "" Then
     OldDNDate = Range("A15").Value
     Range("A15:P34").Copy
     Range("A105").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
      Range("A105:P124").Select
     Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
     False, Orientation:=xlTopToBottom
     Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
     Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
     ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
      Call DNIOAdd(OldDNDate, PONo)
      ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
   End If
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("105:154").ClearContents
   Rows("15:34").ClearContents
End If
SheetUpdate:
   If Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "PURCHASE ORDER " Then
    PONo = "P" & Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
    Label1.Caption = "PURCHASE ORDER"
    CommandButton19.Visible = True
   Else
    PONo = "DN" & Right(("00000" & Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1), 5)
    Label1.Caption = "DEBIT NOTE"
    Label4.Caption = "Debit Note # : "
    Label6.Caption = "Ref PO : "
   End If
   Call POTempFormat("")
   DelNo = 0
 CommandButton1.Visible = True
 CommandButton4.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
FinishDelete:
 Label23.Visible = False
 EventOff = False
End Sub
Private Sub CommandButton15_Click()
Dim Sh As Shape, PicLocation As String, PicZoom As Single
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
Label23.Visible = False
If CommandButton1.Visible = True And (CommandButton1.Caption = "Save PO" Or CommandButton1.Caption = "Save DN") And TotalAmount <> 0 Then
AskReply:
   MSG = "This Entry has not been Saved." + Chr(13) + _
   Chr(13) + "Enter 'Y' to proceed Without Saving "
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo PrintForm
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
End If
PrintForm:
 Label23.BackColor = &H40C0&
 Label23.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label23.Visible = True
 DoEvents
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("D43").Select
  I = 1
  Do While I < 21
   If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
   I = I + 1
  Loop
Call Form15AmountRefresh("")
ThisWorkbook.Worksheets("PO").Activate
ActiveSheet.UsedRange.ClearContents
For Each Sh In ActiveSheet.Shapes
 If Sh.Type = msoPicture Then Sh.Delete
Next
Range("A1").ColumnWidth = 5.25
Range("B1").ColumnWidth = 14.25
Range("C1").ColumnWidth = 32.63
Range("D1").ColumnWidth = 0.85
Range("E1").ColumnWidth = 7.63
Range("F1").ColumnWidth = 8.5
Range("G1").ColumnWidth = 13
Range("H1").ColumnWidth = 8
Range("I1").ColumnWidth = 13
  Worksheets("POForm").Activate
   Rows("1:50").Select
  Selection.Copy
  Worksheets("PO").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Rows("48:1500").Delete
Range("G6").Value = "Date : "
Range("A9").Value = "Supplier : "
Range("A17").Value = "Item"
Range("B17").Value = "Product #"
Range("C17").Value = "Product Description"
Range("F17").Value = "Qty"
Range("G16").Value = "Unit Price "
Range("G17").Value = "(" & SysCurrency & ")"
Range("H16").Value = "Discount"
Range("H17").Value = "Rate"
Range("I16").Value = "Amount "
Range("I17").Value = "(" & SysCurrency & ")"
Range("H40").Value = "Total Amount : "
Range("B41").Value = "Remarks : "
Range("B42").Value = "Buyer : "
Range("F46").Value = "Authorized Signature"
Range("H5").NumberFormat = "@"
Range("H5").Value = PONo
Range("H6").NumberFormat = "yyyy/mm/dd"
Range("H6").Value = InvDate
Range("H7").Value = CustPO
Range("I40").Value = TotalAmount
Range("C41").Value = Remarks
Range("C42").Value = SalesRep
Range("B44").Value = TextBox53.Text & Chr(10) & TextBox54.Text & Chr(10) & TextBox55.Text
Range("A10").Value = "   " & SupplierName
Range("A11").Value = "   " & Address1
Range("A12").Value = "   " & Address2
Range("A13").Value = "   " & Address3
If TelNo <> "" Then
 Range("A14").Value = "   Contact : " & CustContact & "   Tel : " & TelNo
Else
 Range("A14").Value = "   Contact : " & CustContact
End If
If Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "PURCHASE ORDER " Then
  Range("A3").Value = "PURCHASE ORDER"
  Range("G5").Value = "PO # : "
  Range("G7").Value = "Quote Ref : "
  Range("E9").Value = "Goods Delivered to : "
  Range("B43").Value = "Payment Terms : "
  Range("C43").Value = PayTerm
  Range("B40").Value = "Delivery Date : "
  Range("C40").Value = DelDate
  Range("E10").Value = "   " & DelName
  Range("E11").Value = "   " & DelAddress1
  Range("E12").Value = "   " & DelAddress2
  Range("E13").Value = "   " & DelAddress3
  Range("E14").Value = "   Contact : " & DelContact
   With New StdFont
        .Name = "IDAutomationHC39M Free Version"
        If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
         Range("A5").RowHeight = 18
         Range("A5").VerticalAlignment = xlTop
         Range("A5").HorizontalAlignment = xlLeft
         Range("A5").Font.Name = "IDAutomationHC39M Free Version"
         Range("A5").Value = Code39(Range("H5").Value)
        End If
    End With
Else
    Range("E9:I14").Select
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    Selection.Borders(xlEdgeTop).LineStyle = xlNone
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
  Range("A3").Value = "DEBIT NOTE"
  Range("G5").Value = "Debit Note # : "
  Range("G7").Value = "Ref PO # : "
  Range("B40").Value = "Payment Due Date : "
  Range("C40").Value = TextBox47.Text
End If
I = 19
ThisWorkbook.Worksheets("TempRP").Activate
Range("D43").Select
Do While ActiveCell.Value <> ""
 ThisWorkbook.Worksheets("PO").Cells(I, 1).Value = I - 18
 ThisWorkbook.Worksheets("PO").Cells(I, 2).Value = ActiveCell.Value
 ThisWorkbook.Worksheets("PO").Cells(I, 3).Value = ActiveCell.Offset(0, 1).Value
 ThisWorkbook.Worksheets("PO").Cells(I, 6).Value = ActiveCell.Offset(0, 2).Value
 ThisWorkbook.Worksheets("PO").Cells(I, 7).Value = ActiveCell.Offset(0, 3).Value
 If ActiveCell.Offset(0, 4).Value = "" Then ActiveCell.Offset(0, 4).Value = 0
 ThisWorkbook.Worksheets("PO").Cells(I, 8).NumberFormat = "0.0#%"
 ThisWorkbook.Worksheets("PO").Cells(I, 8).Value = ActiveCell.Offset(0, 4).Value / 100
 ThisWorkbook.Worksheets("PO").Cells(I, 9).Value = ActiveCell.Offset(0, 5).Value
 ActiveCell.Offset(1, 0).Select
 I = I + 1
Loop
Call POPageLayout("PO")
ThisWorkbook.Worksheets("PO").Visible = xlSheetVisible
Worksheets("System Menu").Visible = xlSheetVeryHidden
SheetName = "PO"
 Label23.BackColor = &HC0&
 Label23.Visible = False
Me.Hide
Worksheets("PO").Activate
ActiveWindow.DisplayGridlines = False
ActiveSheet.CommandButton2.Visible = True
ActiveSheet.CommandButton3.Visible = True
Range("A1:K19").Select
ActiveWindow.Zoom = True
Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
End Sub
Private Sub CommandButton16_Click()
Dim Sh As Shape
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
Label23.Visible = False
If CommandButton1.Visible = True And (CommandButton1.Caption = "Save PO" Or CommandButton1.Caption = "Save DN") And TotalAmount <> 0 Then
AskReply:
   MSG = "This Entry has not been Saved." + _
    Chr(13) + "Multiple printing only handles 'Saved' entries" + Chr(13) _
    + Chr(13) + "Enter 'Y' to proceed Without Saving "
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo PrintForm
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
End If
PrintForm:
ThisWorkbook.Worksheets("PO").Activate
For Each Sh In ActiveSheet.Shapes
 If Sh.Type = msoPicture Then Sh.Delete
Next
Range("A1").ColumnWidth = 5.25
Range("B1").ColumnWidth = 14.25
Range("C1").ColumnWidth = 32.63
Range("D1").ColumnWidth = 0.85
Range("E1").ColumnWidth = 7.63
Range("F1").ColumnWidth = 8.5
Range("G1").ColumnWidth = 13
Range("H1").ColumnWidth = 8
Range("I1").ColumnWidth = 13
If Label1.Caption = "PURCHASE ORDER " Or Label1.Caption = "PURCHASE ORDER" Then
  Call POPrint("")
Else
  Call DNPrint("")
End If
ThisWorkbook.Worksheets("PO").CommandButton2.Visible = True
End Sub
Private Sub CommandButton17_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RecAmt As Double, SubTotal As Double, GoodsRecDate As Date, AccountNo As String, DelItem As Long
Dim CheckRange As Range, QtyTotal As Double, StockQty As Double, LineNo As Long
Dim QtySum As Double, AmtSum As Double, AssetNo As String
Dim LowValueFlag As String, ZeroQtyFlag As String
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
If Label23.Visible = True And LabelAlert = True Then
 LabelAlert = False
 Exit Sub
End If
LabelAlert = False
If CheckBox1.Value = True Then
   ThisWorkbook.Worksheets("TempRP").Activate
   Range("D43").Select
   Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 8).Value <> "" Then
      GoTo QtyUpdate
    End If
    ActiveCell.Offset(1, 0).Select
   Loop
    GoodsRecDate = Date
    InvStatus = "R"
    GoTo NoQty
End If
QtyUpdate:
 If IsDate(TextBox48.Text) = False Then
   Label23.Caption = Chr(13) & "    Receiving date is incorrect"
   Label23.Visible = True
   Exit Sub
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D43").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 8).Value <> "" Then GoTo QtyOK
  ActiveCell.Offset(1, 0).Select
 Loop
 Label23.Caption = Chr(13) & "    No entry of newly received Quantity for all the items"
 Label23.Visible = True
 Exit Sub
QtyOK:
 GoodsRecDate = TextBox48.Text
If GoodsRecDate > Date Then
   Label23.Caption = Chr(13) & "    Receiving date cannot be a future date"
   Label23.Visible = True
   Exit Sub
End If
If GoodsRecDate < BeginningDate Then
 If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
      MSG = "WARNING!!!" & Chr(13) & Chr(13) & "The Receiving date belongs to previous year" & Chr(13) & _
       "Thus, no posting to the Inventory and the General Ledger." & Chr(13) & Chr(13) _
        + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
      Title = "WARNING"
      C = InputBox(MSG, Title)
      If C = "Y" Or C = "y" Then
       GoTo DateProceed
      End If
     If C = "N" Or C = "n" Or C = "" Then
       Label23.Caption = Chr(13) & "    Please enter a new Date "
       Label23.Visible = True
       LabelAlert = False
       Exit Sub
     End If
      GoTo AskReply
 Else
     Label23.Caption = Chr(13) & "    The Receiving date belongs to previous Posted year which is not allowed" & _
     Chr(13) & "    Please enter a new Date. "
     Label23.Visible = True
     LabelAlert = False
     Exit Sub
 End If
End If
 LowValueFlag = ""
 ZeroQtyFlag = ""
 Range("C43").Select
 Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 12).Value <> "" And ActiveCell.Offset(0, 14).Value = "" Then
    If ActiveCell.Offset(0, 13).Value + ActiveCell.Offset(0, 9).Value < 0 Then
     Label23.Caption = Chr(13) & "    Insufficient Stock quantity for " & ActiveCell.Offset(0, 1).Value & Chr(13) _
                     & Chr(13) & "    Thus, Receiving Update cannot be proceeded."
     Label23.Visible = True
     Exit Sub
    ElseIf ActiveCell.Offset(0, 16).Value + ActiveCell.Offset(0, 10).Value < 0 Then
      If LowValueFlag = "" Then
       LowValueFlag = ActiveCell.Offset(0, 12).Value
      Else
       LowValueFlag = LowValueFlag & "; " & ActiveCell.Offset(0, 12).Value
      End If
    ElseIf (ActiveCell.Offset(0, 13).Value + ActiveCell.Offset(0, 9).Value = 0) And (ActiveCell.Offset(0, 16).Value + ActiveCell.Offset(0, 10).Value) <> 0 Then
      If ZeroQtyFlag = "" Then
       ZeroQtyFlag = ActiveCell.Offset(0, 12).Value
      Else
       ZeroQtyFlag = ZeroQtyFlag & "; " & ActiveCell.Offset(0, 12).Value
      End If
    End If
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
 If LowValueFlag <> "" And ZeroQtyFlag <> "" Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Receiving Update cannot be proceeded because it will make the book value of some stock items negative.  " & _
   "Also, the stock quantity of some stock items will become zero but the book value will not be zero.  ")
    Exit Sub
 ElseIf LowValueFlag <> "" Then
 MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Receiving Update cannot be proceeded because it will make the book value of " & LowValueFlag & " negative.  ")
  Exit Sub
 ElseIf ZeroQtyFlag <> "" Then
 MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Receiving Update cannot be proceeded because it will make the stock quantity of " & ZeroQtyFlag & " zero. " & _
       "But the book value of these stock items not zero. ")
  Exit Sub
 End If
DateProceed:
 Call PODueCal("")
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("N1").NumberFormat = "yyyy/mm/dd"
 Range("N1").Value = DueDate
 RecAmt = Format(Application.Sum(Range(Cells(43, 13), Cells(62, 13))), "0.00")
 OSAmt = Format((OSAmt + RecAmt), "0.00")
 Range("K1").NumberFormat = "General"
 Range("K1").Value = OSAmt
Rows("3").ClearContents
Range("A1:U1").Copy
Range("A3").Select
ActiveSheet.Paste
Application.CutCopyMode = False
 Range("D3").NumberFormat = "yyyy/mm/dd"
 Range("D3").Value = GoodsRecDate
 DelNo = DelNo + 1
 Range("C3").NumberFormat = "General"
 Range("C3").Value = DelNo
 Range("K3:L3").NumberFormat = "General"
 Range("K3").Value = RecAmt
 Range("L3").Value = RecAmt
 Range("V3").Value = "*"
 Range("W3").NumberFormat = "@"
 Range("W3").Value = TextBox50.Text
 Rows("80:100").ClearContents
 Range("A80").Select
 Range("A43:R62").Copy
 ActiveSheet.Paste
 Application.CutCopyMode = False
  Range("D80").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, -1).Value = "" Then
    ActiveCell.EntireRow.Delete
   ElseIf ActiveCell.Offset(0, 8).Value = 0 Then
    ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
  Loop
 I = 25
 DelItem = 0
 Range("C80").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 9).Value <> "" Then
   Cells(3, I).NumberFormat = "General"
   Cells(3, I).Value = ActiveCell.Value
   Range(Cells(3, I + 1), Cells(3, I + 2)).NumberFormat = "@"
   Range(Cells(3, I + 3), Cells(3, I + 6)).NumberFormat = "General"
   Cells(3, I + 1).Value = ActiveCell.Offset(0, 1).Value
   Cells(3, I + 2).Value = ActiveCell.Offset(0, 2).Value
   Cells(3, I + 3).Value = ActiveCell.Offset(0, 9).Value
   Cells(3, I + 4).Value = ActiveCell.Offset(0, 4).Value
   Cells(3, I + 5).Value = ActiveCell.Offset(0, 5).Value
   Cells(3, I + 6).Value = ActiveCell.Offset(0, 10).Value
   DelItem = DelItem + 1
   I = I + 7
   ActiveCell.Offset(1, 0).Select
  Else
   ActiveCell.EntireRow.Delete
  End If
 Loop
  Range("X3").Value = DelItem
  MyBook.Worksheets("Payable").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
  ThisWorkbook.Worksheets("TempRP").Activate
  Rows("3").Copy
  MyBook.Worksheets("Payable").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
  ThisWorkbook.Worksheets("TempRP").Activate
  If Range("D80").Value = "" Then GoTo Finish
If GoodsRecDate >= BeginningDate Then
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("A80:R99").Copy
  Range("A130").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Range("A130:Q149").Select
  Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
     False, Orientation:=xlTopToBottom
  Range("A3:I3").Copy
  Range("A105").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
   I = 106
  Range("C130").Select
  Do While ActiveCell.Value <> ""
   Range("A105").EntireRow.Copy
   Cells(I, 1).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Range("C130").Select
    AccountNo = ActiveCell.Value
    SubTotal = ActiveCell.Offset(0, 10).Value
    Do While ActiveCell.Offset(1, 0).Value = AccountNo
     SubTotal = SubTotal + ActiveCell.Offset(1, 10).Value
     ActiveCell.EntireRow.Delete
    Loop
     SubTotal = Format(SubTotal, "0.00")
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
     If SubTotal >= 0 Then
       Cells(I, 8).Value = Format(SubTotal, "0.00")
       Cells(I, 9).ClearContents
     Else
      Cells(I, 9).Value = Format(SubTotal * (-1), "0.00")
       Cells(I, 8).ClearContents
     End If
    ActiveCell.EntireRow.Delete
    I = I + 1
  Loop
   Range(Cells(105, 8), Cells(105, 9)).NumberFormat = "General"
   If RecAmt >= 0 Then
     Cells(105, 9).Value = Format(RecAmt, "0.00")
     Cells(105, 8).ClearContents
   Else
     Cells(105, 8).Value = Format(RecAmt * (-1), "0.00")
     Cells(105, 9).ClearContents
   End If
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(105, 10), Cells(I - 1, 10)).NumberFormat = "@"
   Range(Cells(105, 10), Cells(I - 1, 10)).Value = PONo & "-PV"
   Range(Cells(105, 4), Cells(I - 1, 4)).NumberFormat = "yyyy/mm/dd"
   Range(Cells(105, 4), Cells(I - 1, 4)).Value = GoodsRecDate
   Range(Cells(105, 6), Cells(I - 1, 6)).NumberFormat = "General"
   Range(Cells(105, 6), Cells(I - 1, 6)).FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
   Range(Cells(105, 6), Cells(I - 1, 6)).NumberFormat = "@"
   Range(Cells(105, 6), Cells(I - 1, 6)).Copy
   Range(Cells(105, 6), Cells(I - 1, 6)).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
   Range(Cells(105, 7), Cells(I - 1, 7)).Value = "PO # " & PONo & "-Rec'd " & GoodsRecDate
   AcctYear = Int((Period(GoodsRecDate) - Period(BeginningDate)) / 12)
   AcctYear = AcctYear + Year(BeginningDate)
   JournalCode = "PV" & AcctYear
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   JcodeRow = 251
   Set JournalRange = Range("G250")
   If ActiveCell.Offset(1, 0).Value <> "" Then
    Range("G250").End(xlDown).Select
    JcodeRow = ActiveCell.Row + 1
   End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Range(Cells(JcodeRow, 7), Cells(JcodeRow, 8)).NumberFormat = "@"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
   Else
    JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
    LastTranNo = Cells(JcodeRow, 8).Value
    LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
    Cells(JcodeRow, 8).NumberFormat = "@"
    Cells(JcodeRow, 8).Value = LastTranNo
   End If
   LastJournalCode = JournalCode
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(105, 1), Cells(I - 1, 1)).NumberFormat = "@"
   Range(Cells(105, 1), Cells(I - 1, 1)).Value = JournalCode
   Range(Cells(105, 2), Cells(I - 1, 2)).NumberFormat = "@"
   Range(Cells(105, 2), Cells(I - 1, 2)).Value = LastTranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(105, 1), Cells(I - 1, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
   P = Period(GoodsRecDate) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("105:155").ClearContents
  Range("A80:R99").Select
  Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
     False, Orientation:=xlTopToBottom
  Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
     False, Orientation:=xlTopToBottom
  Range("C80").Select
  ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
   Do While ActiveCell.Value <> ""
    If ActiveCell.Offset(0, 12).Value <> "" Then
     StockNo = ActiveCell.Offset(0, 12).Value
     QtyTotal = ActiveCell.Offset(0, 9).Value
     SubTotal = ActiveCell.Offset(0, 10).Value
     Do While ActiveCell.Offset(1, 12).Value = StockNo
      QtyTotal = QtyTotal + ActiveCell.Offset(1, 9).Value
      SubTotal = SubTotal + ActiveCell.Offset(1, 10).Value
      ActiveCell.EntireRow.Delete
     Loop
     QtyTotal = Format(QtyTotal, "0.0000")
     SubTotal = Format(SubTotal, "0.00")
     If QtyTotal <> 0 Or SubTotal <> 0 Then
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
        I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        MyBook.Worksheets("StockRec").Cells(I, 8).Value = Format(StockQty + QtyTotal, "0.0000")
        If Abs(SubTotal) > 0.001 Then MyBook.Worksheets("StockRec").Cells(I, 9).Value = Format(MyBook.Worksheets("StockRec").Cells(I, 9).Value + SubTotal, "0.00")
        If MyBook.Worksheets("StockRec").Cells(I, 8).Value <> 0 Then _
          MyBook.Worksheets("StockRec").Cells(I, 10).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value / MyBook.Worksheets("StockRec").Cells(I, 8).Value
         If MyBook.Worksheets("StockRec").Cells(I, 1).Value < GoodsRecDate Then MyBook.Worksheets("StockRec").Cells(I, 1).Value = GoodsRecDate
         If MyBook.Worksheets("StockRec").Cells(I, 15).Value < GoodsRecDate Then MyBook.Worksheets("StockRec").Cells(I, 15).Value = GoodsRecDate
          QtySum = MyBook.Worksheets("StockRec").Cells(I, 8).Value
          AmtSum = MyBook.Worksheets("StockRec").Cells(I, 9).Value
          AssetNo = MyBook.Worksheets("StockRec").Cells(I, 5).Value
         If QtyTotal <> 0 Or SubTotal <> 0 Then
          Call InvIOAdd(QtyTotal, SubTotal, GoodsRecDate, QtySum, AmtSum, AssetNo)
          Call IOUpdate(QtyTotal, SubTotal, PONo, GoodsRecDate, "A", StockQty)
         End If
       End If
     End If
    End If
    ThisWorkbook.Worksheets("TempRP").Activate
    ActiveCell.Offset(1, 0).Select
   Loop
  ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
End If
Finish:
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("80:155").ClearContents
 Range("D43").Select
 I = 42
 Do While ActiveCell.Value <> ""
  ActiveCell.Offset(0, 7).Value = Format(ActiveCell.Offset(0, 7).Value + ActiveCell.Offset(0, 8).Value, "0.0000")
  ActiveCell.Offset(0, 6).Value = Format(ActiveCell.Offset(0, 6).Value + ActiveCell.Offset(0, 9).Value, "0.00")
  If ActiveCell.Offset(0, 7).Value = 0 Then ActiveCell.Offset(0, 7).Value = ""
  Cells(1, I).Value = ActiveCell.Offset(0, 6).Value
  Cells(1, I + 1).Value = ActiveCell.Offset(0, 7).Value
  ActiveCell.Offset(1, 0).Select
  I = I + 9
 Loop
 Range("L42:M62").ClearContents
   Range("D43").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 14).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
  Range("A43:R62").Select
    Selection.Sort Key1:=Range("O1"), Order1:=xlAscending, Key2:=Range("R1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D43").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 11).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 11).Value
        If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
        I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        ActiveCell.Offset(0, 12).Value = StockQty
       Do While ActiveCell.Value <> "" And ActiveCell.Offset(1, 11).Value = StockNo
        ActiveCell.Offset(1, 12).Value = StockQty
        ActiveCell.Offset(1, 0).Select
       Loop
      End If
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A43:R62").Select
    Selection.Sort Key1:=Range("R1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("R43:R62").ClearContents
LineNo = ScrollBar1.Value
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = LineNo + I - 1
  Controls("TextBox" & I * 5).Text = Cells(LineNo + 41 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(LineNo + 41 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(LineNo + 41 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(LineNo + 41 + I, 7).Value
  Controls("TextBox" & I * 5 + 4).Text = Cells(LineNo + 41 + I, 8).Value
  Controls("Label" & I + 26).Caption = Format(Cells(LineNo + 41 + I, 9).Value, "#,##0.00")
  Controls("Label" & I + 32).Caption = Cells(LineNo + 41 + I, 11).Value
  Controls("TextBox" & I + 34).Text = Cells(LineNo + 41 + I, 12).Value
 Next I
 TextBox48.Text = ""
 TextBox50.Text = ""
 If CheckBox1.Value = False Then
  Range("D43").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 2).Value <> ActiveCell.Offset(0, 7).Value Then
    InvStatus = "P"
    GoTo StatusUpdate
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
  InvStatus = "R"
 Else
  InvStatus = "R"
 End If
NoQty:
If InvStatus = "R" And OSAmt = 0 Then
 If IsError(Application.Match(PONo, MyBook.Worksheets("Payable").Range("B:B"), 0)) = False Then
  MyBook.Worksheets("Payable").Activate
  If Range("B4").Value <> "" Then
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
    FInvRow = Application.Match(PONo, CheckRange, 0) + 3
    LInvRow = Application.Match(PONo, CheckRange, 1) + 3
   I = FInvRow
   Do While I <= LInvRow
    If Cells(I, 22).Value <> "R" Then GoTo StatusUpdate
    I = I + 1
   Loop
   InvStatus = "S"
  End If
 Else
  InvStatus = "S"
 End If
End If
StatusUpdate:
ThisWorkbook.Worksheets("TempRP").Activate
  Cells(1, 11).Value = OSAmt
  Cells(1, 10).Value = InvStatus
  Cells(1, 13).ClearContents
  If InvStatus = "S" Or (InvStatus = "R" And OSAmt = 0) Then
   Cells(1, 13).NumberFormat = "yyyy/mm/dd"
   Cells(1, 13).Value = GoodsRecDate
  End If
If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = False Then
   InvRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
   MyBook.Worksheets("PORecord").Activate
   Cells(InvRow, 1).EntireRow.Delete
End If
   MyBook.Worksheets("PORecord").Activate
   Range("B1").End(xlDown).Select
   ActiveCell.Offset(1, -1).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("1:1").Copy
   MyBook.Worksheets("PORecord").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
If IsError(Application.Match(PONo, MyBook.Worksheets("Payable").Range("B:B"), 0)) = False Then
   MyBook.Worksheets("Payable").Activate
   ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Selection.Columns("B")
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
  MyBook.Worksheets("Payable").Range(Cells(FInvRow, 10), Cells(LInvRow, 10)).Value = InvStatus
  If InvStatus = "S" Or (InvStatus = "R" And OSAmt = 0) Then
    MyBook.Worksheets("Payable").Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
    MyBook.Worksheets("Payable").Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).Value = GoodsRecDate
  Else
    MyBook.Worksheets("Payable").Range(Cells(FInvRow, 13), Cells(LInvRow, 13)).ClearContents
  End If
End If
  ThisWorkbook.Worksheets("TempRP").Activate
  Rows("3").ClearContents
  EventOff = True
  Label23.Visible = False
  CommandButton13.Visible = False
If InvStatus = "S" Or InvStatus = "R" Then
  CommandButton1.Visible = False
  Label46.Caption = ""
  CheckBox1.Visible = False
  TextBox48.Visible = False
  Label47.Visible = False
  Label48.Visible = False
  TextBox50.Text = ""
  TextBox50.Visible = False
  Label55.Visible = False
  Label56.Visible = False
  Label57.Visible = False
  Label50.Visible = False
  TextBox35.Visible = False
  TextBox36.Visible = False
  TextBox37.Visible = False
  TextBox38.Visible = False
  TextBox39.Visible = False
  TextBox40.Visible = False
  CommandButton20.Visible = True
  CommandButton17.Visible = False
  If InvStatus = "S" Then
   Label54.Caption = "PO Status : CLOSED and SETTLED"
   Label54.Visible = True
  Else
   Label54.Caption = "PO Status : CLOSED"
   Label54.Visible = True
  End If
ElseIf InvStatus = "P" Then
  CommandButton1.Caption = "Edit PO"
  CommandButton1.Visible = True
  Label46.Caption = "Receiving Update"
  Label54.Caption = "PO Status : PARTIALLY RECEIVED"
  Label54.Visible = True
End If
 ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
 EventOff = False
End Sub

Private Sub CommandButton17_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
LabelAlert = False
End Sub

Private Sub CommandButton18_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If InvStatus <> "*" Then
 Label23.Caption = Chr(13) & "     Delivery of goods has been made, no change to the delivery address is allowed"
 Label23.Visible = True
 Exit Sub
End If
ListBox3.Visible = True
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
Label23.Visible = False
End Sub

Private Sub CommandButton19_Click()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = True
End Sub

Private Sub CommandButton2_Click()
Dim C As String
Application.EnableCancelKey = xlDisabled
 Unload Me
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 DoEvents
 Application.EnableEvents = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton20_Click()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
Label23.Visible = False
AskReply:
 MSG = "It is a CLOSED PO." + Chr(13) + _
 Chr(13) + "Do you really want to re-open it for goods Receiving/Return update " + _
 Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo ReOpen
    If C = "N" Or C = "n" Or C = "" Then
    Exit Sub
    End If
    GoTo AskReply
ReOpen:
CommandButton11.Visible = True
CheckBox1.Visible = True
TextBox48.Visible = True
Label47.Visible = True
Label48.Visible = True
TextBox50.Text = ""
TextBox50.Visible = True
Label55.Visible = True
Label56.Visible = True
Label57.Visible = True
Label50.Visible = True
TextBox35.Visible = True
TextBox36.Visible = True
TextBox37.Visible = True
TextBox38.Visible = True
TextBox39.Visible = True
TextBox40.Visible = True
Label54.Visible = False
  CommandButton13.Visible = False
  CommandButton1.Caption = "Edit PO"
  CommandButton1.Visible = True
  Label46.Caption = "Receiving Update"
  Label54.Caption = "PO Status : RE-OPEN for UPDATE"
  Label54.Visible = True
  CommandButton20.Visible = False
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If InvStatus <> "*" Then
 Label23.Caption = Chr(13) & "    Some parts of this PO have already been received, no change to the supplier data is allowed"
 Label23.Visible = True
 Exit Sub
End If
 ListBox1.Visible = True
 ListBox2.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
 Label23.Visible = False
End Sub

Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
If Label1.Caption <> "PURCHASE ORDER" And Label1.Caption <> "DEBIT NOTE" Then Exit Sub
Label23.Visible = False
Me.Hide
ThisWorkbook.Worksheets("System Menu").Activate
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm17.TextBox6.Text = SupplierNo
UserForm17.Label18.Caption = SupplierName
UserForm17.CommandButton4.Visible = False
UserForm17.Show
End Sub

Private Sub CommandButton5_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If SupplierNo = "" Then
 Label23.Caption = Chr(13) & "     Please input Supplier number first  "
 Label23.Visible = True
 Exit Sub
End If
If Label33.Caption <> "" Then
 Label23.Caption = Chr(13) & "     Delivery of the part item has been received.   Change to the part detail is not allowed"
 Label23.Visible = True
 Exit Sub
End If
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
 ButtonNo = 5
 Label23.Visible = False
End Sub

Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If SupplierNo = "" Then
 Label23.Caption = Chr(13) & "     Please input Supplier number first  "
 Label23.Visible = True
 Exit Sub
End If
If Label34.Caption <> "" Then
 Label23.Caption = Chr(13) & "     Delivery of the part item has been received.   Change to the part detail is not allowed"
 Label23.Visible = True
 Exit Sub
End If
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
 ButtonNo = 6
 Label23.Visible = False
End Sub

Private Sub CommandButton7_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If SupplierNo = "" Then
 Label23.Caption = Chr(13) & "     Please input Supplier number first  "
 Label23.Visible = True
 Exit Sub
End If
If Label35.Caption <> "" Then
 Label23.Caption = Chr(13) & "     Delivery of the part item has been received.   Change to the part detail is not allowed"
 Label23.Visible = True
 Exit Sub
End If
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
 ButtonNo = 7
 Label23.Visible = False
End Sub

Private Sub CommandButton8_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If SupplierNo = "" Then
 Label23.Caption = Chr(13) & "     Please input Supplier number first  "
 Label23.Visible = True
 Exit Sub
End If
If Label36.Caption <> "" Then
 Label23.Caption = Chr(13) & "     Delivery of the part item has been received.   Change to the part detail is not allowed"
 Label23.Visible = True
 Exit Sub
End If
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
ButtonNo = 8
Label23.Visible = False
End Sub

Private Sub CommandButton9_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If SupplierNo = "" Then
 Label23.Caption = Chr(13) & "     Please input Supplier number first  "
 Label23.Visible = True
 Exit Sub
End If
If Label37.Caption <> "" Then
 Label23.Caption = Chr(13) & "     Delivery of the part item has been received.   Change to the part detail is not allowed"
 Label23.Visible = True
 Exit Sub
End If
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
ButtonNo = 9
Label23.Visible = False
End Sub

Private Sub CommandButton10_Click()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then Exit Sub
If SupplierNo = "" Then
 Label23.Caption = Chr(13) & "     Please input Supplier number first  "
 Label23.Visible = True
 Exit Sub
End If
If Label38.Caption <> "" Then
 Label23.Caption = Chr(13) & "     Delivery of the part item has been received.   Change to the part detail is not allowed"
 Label23.Visible = True
 Exit Sub
End If
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ListBox4.Visible = False
ButtonNo = 10
Label23.Visible = False
End Sub


Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
Label23.Visible = False
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Supplier Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
RowNo = ListBox1.ListIndex + 2
If SupplierNo = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value Then
 ListBox1.Visible = False
 Exit Sub
End If
 EventOff = True
TextBox1.Text = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value
Call Form15Text1Exit("")
 EventOff = False
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range, CheckRange As Range
Application.EnableCancelKey = xlDisabled
Label23.Visible = False
If ListBox2.List(0) = "No Record of Purchase items for the selected supplier" Then
 ListBox2.Visible = False
 Exit Sub
End If
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Then
 ListBox2.Visible = False
 Exit Sub
End If
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Part Description" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("Supply Data").Activate
 If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
  If SupplierNo <> "" Then
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("E1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Columns("A")
   If IsError(Application.Match(SupplierNo, CheckRange, 0)) Then
      ListBox2.AddItem "No Record of Purchase items for the selected supplier"
   Else
     PartStartRow = Application.Match(SupplierNo, CheckRange, 0) + 2
     PartEndRow = Application.Match(SupplierNo, CheckRange, 1) + 2
     If PartEndRow < PartStartRow Then PartEndRow = PartStartRow
     I = PartStartRow
     Cells(I, 4).Select
     ListBox2.AddItem "SWITCH to listing by Part #"
    Do While I <= PartEndRow
      ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value & "   (Supplier: " & ActiveCell.Offset(0, -2).Value & " )"
      I = I + 1
      ActiveCell.Offset(1, 0).Select
    Loop
   End If
  End If
 Else
   ListBox2.AddItem "No Record of Purchase items for the selected supplier"
 End If
  ListBox2.AddItem "CLOSE this box"
  ListBox2.Visible = True
  Exit Sub
End If
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Part #" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("Supply Data").Activate
 If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
  If SupplierNo <> "" Then
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Columns("A")
   If IsError(Application.Match(SupplierNo, CheckRange, 0)) Then
      ListBox2.AddItem "No Record of Purchase items for the selected supplier"
   Else
     PartStartRow = Application.Match(SupplierNo, CheckRange, 0) + 2
     PartEndRow = Application.Match(SupplierNo, CheckRange, 1) + 2
     If PartEndRow < PartStartRow Then PartEndRow = PartStartRow
     I = PartStartRow
     Cells(I, 4).Select
     ListBox2.AddItem "SWITCH to listing by Part Description"
    Do While I <= PartEndRow
      ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value & "   (Supplier: " & ActiveCell.Offset(0, -2).Value & " )"
      I = I + 1
      ActiveCell.Offset(1, 0).Select
    Loop
   End If
  End If
 Else
   ListBox2.AddItem "No Record of Purchase items for the selected supplier"
 End If
  ListBox2.AddItem "CLOSE this box"
  ListBox2.Visible = True
  Exit Sub
End If
 EventOff = True
RowNo = ListBox2.ListIndex + PartStartRow - 1
Form15TextNo = (ButtonNo - 4) * 5
Form15RowNo = Val(UserForm15.Controls("Label" & ButtonNo + 10).Caption)
MyBook.Worksheets("Supply Data").Activate
Controls("TextBox" & Form15TextNo).Text = Cells(RowNo, 4).Value
Controls("TextBox" & Form15TextNo + 1).Text = Cells(RowNo, 5).Value
Controls("TextBox" & Form15TextNo + 3).Text = Cells(RowNo, 6).Value
Call Form15Col1Exit("List")
ListBox2.Visible = False
 EventOff = False
End Sub

Private Sub ListBox3_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox3.Text = "No Record of Delivery Address" Then
 ListBox3.Visible = False
 Exit Sub
End If
If ListBox3.Text = "CLOSE this box" Or ListBox3.ListIndex < 0 Then
 ListBox3.Visible = False
 Exit Sub
End If
RowNo = ListBox3.ListIndex + 10
DelName = MyBook.Worksheets("comData").Cells(RowNo, 12).Value
DelAddress1 = MyBook.Worksheets("comData").Cells(RowNo, 13).Value
DelAddress2 = MyBook.Worksheets("comData").Cells(RowNo, 14).Value
DelAddress3 = MyBook.Worksheets("comData").Cells(RowNo, 15).Value
DelContact = MyBook.Worksheets("comData").Cells(RowNo, 16).Value
   TextBox41.Text = DelName
   TextBox42.Text = DelAddress1
   TextBox43.Text = DelAddress2
   TextBox44.Text = DelAddress3
   TextBox45.Text = DelContact
ListBox3.Visible = False
End Sub

Private Sub ListBox4_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox4.Text = "CLOSE this box" Or ListBox4.ListIndex < 0 Then
 ListBox4.Visible = False
 Exit Sub
End If
EventOff = True
If ListBox4.Text <> "C.O.D." And ListBox4.Text <> "Prepaid" And ListBox4.Text <> "User Input" Then
  Label39.Visible = True
  TextBox51.Visible = True
  TextBox52.Visible = False
  Label39.Left = 150
  Label39.Width = 90
  TextBox51.Width = 30
 If ListBox4.Text = "# of Days" Then Label39.Caption = "Days"
 If ListBox4.Text = "# of Days after EOM" Then Label39.Caption = "Days after EOM"
  TextBox51.Visible = True
  If TextBox51.Text = "" Then
   If Val(PayTerm) = 0 Then
      TextBox51.Text = "30"
    Else
     TextBox51.Text = Val(PayTerm)
    End If
  End If
   PayTerm = TextBox51.Text & " " & Label39.Caption
ElseIf ListBox4.Text = "User Input" Then
  TextBox51.Visible = False
  Label39.Visible = False
  TextBox52.Visible = True
  TextBox52.SetFocus
Else
 Label39.Left = 120
 Label39.Width = 120
 Label39.Caption = ListBox4.Text
 TextBox51.Text = ""
 Label39.Visible = True
 TextBox51.Visible = False
 TextBox52.Visible = False
 PayTerm = Label39.Caption
End If
 ListBox4.Visible = False
 EventOff = False
End Sub

Private Sub ScrollBar1_Change()
 Dim LineNo As Long, I As Long
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = LineNo + I - 1
  Controls("TextBox" & I * 5).Text = Cells(LineNo + 41 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(LineNo + 41 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(LineNo + 41 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(LineNo + 41 + I, 7).Value
  Controls("TextBox" & I * 5 + 4).Text = Cells(LineNo + 41 + I, 8).Value
  Controls("Label" & I + 26).Caption = Format(Cells(LineNo + 41 + I, 9).Value, "#,##0.00")
  Controls("Label" & I + 32).Caption = Cells(LineNo + 41 + I, 11).Value
  Controls("TextBox" & I + 34).Text = Cells(LineNo + 41 + I, 12).Value
 Next I
 Call Form15AmountRefresh("")
 Label23.Visible = False
 EventOff = False
End Sub

Private Sub TextBox1_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Or InvStatus <> "*" Then
 TextBox1.Text = SupplierNo
 EventOff = False
 Exit Sub
End If
If TextBox1.Text = "" Then
  CommandButton4.Visible = False
Else
  CommandButton4.Visible = True
End If
If TextBox1.Text = SupplierNo Then
 EventOff = False
 Exit Sub
End If
  Call Form15Text1Exit("")
  EventOff = False
End Sub

Private Sub TextBox1_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
CommandButton4.Visible = False
CommandButton13.Visible = False
End Sub

Private Sub TextBox1_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox11_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox12_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox13_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox14_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox16_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox17_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox18_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox19_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub
Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InvRow As Long, I As Long, CheckRange As Range, InvInput As String
  If EventOff = True Then Exit Sub
  Application.EnableCancelKey = xlDisabled
  EventOff = True
 CheckBox1.Value = False
 InvInput = UCase(TextBox2.Text)
If Left(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = 1
 Do While J <= I And Mid(InvInput, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Right(InvInput, I - J + 1)
  End If
End If
If Right(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = I
 Do While J > 0 And Mid(InvInput, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Left(InvInput, J)
  End If
End If
InputChecked:
If InvInput = "" Then InvInput = "0"
TextBox2.Text = InvInput
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 Call Form15ViewOnly(DelDate)
 Instr1 = TextBox53.Text
  Instr2 = TextBox54.Text
  Instr3 = TextBox55.Text
 EventOff = False
 Exit Sub
End If
 If Label1.Caption = "DEBIT NOTE" Or Label1.Caption = "DEBIT NOTE " Then
  Call DebitNote(DelDate)
  Instr1 = TextBox53.Text
  Instr2 = TextBox54.Text
  Instr3 = TextBox55.Text
  EventOff = False
  Exit Sub
 End If
 
 
If IsNumeric(InvInput) Then
 If Len(InvInput) < 7 Then
   InvInput = Right(("000000" & InvInput), 6)
   If InvInput = "000000" Then
     InvInput = Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
   ElseIf IsError(Application.Match("P" & InvInput, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = True Then
     InvInput = Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
   End If
   PONo = "P" & InvInput
  Label58.Visible = True
  TextBox2.Left = 366
  TextBox2.Width = 90
 Else
  PONo = InvInput & " "
  Label58.Visible = False
  TextBox2.Left = 342
  TextBox2.Width = 114
 End If
ElseIf Len(InvInput) > 1 Then
 If Left(InvInput, 1) = "P" Then
  PONo = Right(InvInput, Len(InvInput) - 1)
  If IsNumeric(PONo) Then
   If Len(PONo) < 7 Then
    InvInput = Right(("000000" & PONo), 6)
    If InvInput = "000000" Then
     InvInput = Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
    ElseIf IsError(Application.Match("P" & InvInput, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = True Then
     InvInput = Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
    End If
    PONo = "P" & InvInput
    Label58.Visible = True
    TextBox2.Left = 366
    TextBox2.Width = 90
   Else
    PONo = InvInput & " "
    Label58.Visible = False
    TextBox2.Left = 342
    TextBox2.Width = 114
   End If
  Else
   PONo = InvInput & " "
   Label58.Visible = False
   TextBox2.Left = 342
   TextBox2.Width = 114
  End If
 ElseIf Left(InvInput, 2) = "DN" Then
   If Len(InvInput) = 7 Then
    If IsNumeric(Right(InvInput, 5)) Then
      PONo = "DN0" & Right(InvInput, 5) & " "
      InvInput = PONo
      Label58.Visible = False
      TextBox2.Left = 342
      TextBox2.Width = 114
    Else
     PONo = InvInput & " "
     Label58.Visible = False
     TextBox2.Left = 342
     TextBox2.Width = 114
    End If
   Else
     PONo = InvInput & " "
     Label58.Visible = False
     TextBox2.Left = 342
     TextBox2.Width = 114
   End If
 Else
  PONo = InvInput & " "
  Label58.Visible = False
  TextBox2.Left = 342
  TextBox2.Width = 114
 End If
ElseIf InvInput = "P" Then
  InvInput = Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
  PONo = "P" & InvInput
  Label58.Visible = True
  TextBox2.Left = 366
  TextBox2.Width = 90
Else
 PONo = InvInput & " "
 Label58.Visible = False
 TextBox2.Left = 342
 TextBox2.Width = 114
End If



TextBox2.Text = InvInput
 DelNo = 0
  Label39.Visible = True
  Label39.Left = 120
  Label39.Width = 120
  TextBox51.Visible = False
  TextBox51.Text = ""
  TextBox52.Visible = False
  TextBox52.Text = ""
If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = True Then
 If Label1.Caption <> "PURCHASE ORDER" Or Label42.Visible = True Then
  Call POTempFormat("")
  Call Form15Text1Exit("")
  Label23.Caption = Chr(13) & Chr(13) & "    The PO was not found from the record.  Please input again."
  Label23.Visible = True
  CommandButton13.Visible = False
  CommandButton1.Visible = True
  CommandButton19.Visible = True
  CommandButton1.Caption = "Save PO"
  Label1.Caption = "PURCHASE ORDER"
  Label60.Visible = True
 Else
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
   CommandButton1.Visible = False
  Else
   CommandButton1.Visible = True
   CommandButton19.Visible = True
  End If
 End If
   EventOff = False
   Exit Sub
Else
 CommandButton1.Caption = "Edit PO"
 Label1.Caption = "PURCHASE ORDER "
 Label60.Visible = False
 InvRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("PORecord").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("E1").Value = CreditorAcct
 InvStatus = Range("J1").Value
 OSAmt = Range("K1").Value
 DueDate = Range("N1").Value
 SupplierNo = Range("P1").Value
 SupplierName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 CustPO = Range("AB1").Value
 SalesRep = Range("AC1").Value
 TotalAmount = Range("AF1").Value
 DelDate = Format(Range("AG1").Value, "yyyy/mm/dd")
 Remarks = Range("AH1").Value
 InvDate = Range("D1").Value
 PayTerm = Range("O1").Value
 Instr1 = Range("IT1").Value
  Instr2 = Range("IU1").Value
  Instr3 = Range("IV1").Value
If TelNo <> "" Then
 Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
 "     " & Address1 & Chr(13) & _
 "     " & Address2 & Chr(13) & _
 "     " & Address3 & Chr(13) & _
 "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
Else
 Label3.Caption = "Supplier :   " & Chr(13) & "     " & SupplierName & Chr(13) & _
 "     " & Address1 & Chr(13) & _
 "     " & Address2 & Chr(13) & _
 "     " & Address3 & Chr(13) & _
 "     Contact: " & CustContact
End If
   TextBox41.Text = DelName
   TextBox42.Text = DelAddress1
   TextBox43.Text = DelAddress2
   TextBox44.Text = DelAddress3
   TextBox45.Text = DelContact
 TextBox1.Text = SupplierNo
 TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 TextBox4.Text = CustPO
 TextBox46.Text = SalesRep
 Label39.Caption = PayTerm
 TextBox47.Text = DelDate
 TextBox49.Text = Remarks
 TextBox53.Text = Instr1
 TextBox54.Text = Instr2
 TextBox55.Text = Instr3
For I = 15 To 20
 Controls("Label" & I).Caption = I - 14
Next I
J = 43
For I = 5 To 184 Step 9
 Range(Cells(J, 3), Cells(J + 1, 13)).NumberFormat = "General"
 Cells(J, 4).NumberFormat = "@"
 Cells(J, 5).NumberFormat = "@"
 Cells(J, 15).NumberFormat = "@"
 Cells(J, 3).Value = Cells(1, I + 30).Value
 Cells(J, 4).Value = Cells(1, I + 31).Value
 Cells(J, 5).Value = Cells(1, I + 32).Value
 Cells(J, 6).Value = Cells(1, I + 33).Value
 Cells(J, 7).Value = Cells(1, I + 34).Value
 Cells(J, 8).Value = Cells(1, I + 35).Value
 Cells(J, 9).Value = Cells(1, I + 36).Value
 Cells(J, 10).Value = Cells(1, I + 37).Value
 Cells(J, 11).Value = Cells(1, I + 38).Value
   J = J + 1
 Next I
 Range("D43").Select
 For I = 5 To 34 Step 5
  Controls("TextBox" & I).Text = ActiveCell.Value
  Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
  Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
  Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
  Controls("TextBox" & I + 4).Text = ActiveCell.Offset(0, 4).Value
  Controls("Label" & (I / 5) + 26).Caption = ActiveCell.Offset(0, 5).Value
  Controls("Label" & I / 5 + 32).Caption = ActiveCell.Offset(0, 7).Value
  ActiveCell.Offset(1, 0).Select
 Next I
 ScrollBar1.Value = 1
For J = 0 To 5
  If IsNumeric(Controls("Label" & J + 27).Caption) Then Controls("Label" & J + 27).Caption = Format(Controls("Label" & J + 27).Caption, "#,##0.00")
Next J
  MyBook.Worksheets("Payable").Activate
 If Range("B4").Value <> "" Then
  ActiveSheet.UsedRange.Select
  Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
   Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, _
   Header:=xlNo, OrderCustom:=1, MatchCase:= _
       False, Orientation:=xlTopToBottom
   Set CheckRange = Selection.Columns("B")
 If IsError(Application.Match(PONo, CheckRange, 0)) = False Then
   FInvRow = Application.Match(PONo, CheckRange, 0) + 3
   LInvRow = Application.Match(PONo, CheckRange, 1) + 3
   DelNo = MyBook.Worksheets("Payable").Cells(LInvRow, 3).Value
 End If
 End If
End If
CommandButton11.Visible = True
CheckBox1.Value = False
CheckBox1.Visible = True
TextBox48.Text = ""
TextBox48.Visible = True
Label47.Visible = True
Label48.Visible = True
TextBox50.Text = ""
TextBox50.Visible = True
Label55.Visible = True
Label56.Visible = True
Label57.Visible = True
Label50.Visible = True
For I = 35 To 40
 Controls("Textbox" & I).Text = ""
 Controls("Textbox" & I).Visible = True
Next I
Label54.Visible = False
If InvStatus = "S" Or InvStatus = "R" Then
  CommandButton1.Visible = False
  Label46.Caption = ""
  CheckBox1.Visible = False
  TextBox48.Visible = False
  Label47.Visible = False
  Label48.Visible = False
  TextBox50.Text = ""
  TextBox50.Visible = False
  Label55.Visible = False
  Label56.Visible = False
  Label57.Visible = False
  Label50.Visible = False
  TextBox35.Visible = False
  TextBox36.Visible = False
  TextBox37.Visible = False
  TextBox38.Visible = False
  TextBox39.Visible = False
  TextBox40.Visible = False
  If InvStatus = "S" Then
   Label54.Caption = "PO Status : CLOSED and SETTLED"
   Label54.Visible = True
  Else
   Label54.Caption = "PO Status : CLOSED"
   Label54.Visible = True
  End If
  CommandButton20.Visible = True
ElseIf InvStatus = "P" Then
  CommandButton1.Caption = "Edit PO"
  CommandButton1.Visible = True
  Label46.Caption = "Receiving Update"
  Label54.Caption = "PO Status : PARTIALLY RECEIVED"
  Label54.Visible = True
  CommandButton20.Visible = False
Else
 CommandButton1.Caption = "Edit PO"
 CommandButton1.Visible = True
 Label46.Caption = "Receiving Update"
 Label54.Caption = "PO Status : OPEN"
 Label54.Visible = True
 CommandButton20.Visible = False
End If
Call Form15AmountRefresh("")
CommandButton13.Visible = False
Label23.Visible = False
Label40.Visible = False
Label44.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton17.Visible = False
     Label46.Visible = True
     Label42.Visible = True
     Label33.Visible = True
     Label34.Visible = True
     Label35.Visible = True
     Label36.Visible = True
     Label37.Visible = True
     Label38.Visible = True
 Call Form15PartList("")
 Call Form15Update("")
 ThisWorkbook.Worksheets("TempRP").Activate
Label39.Left = 120
Label39.Width = 120
TextBox51.Text = ""
TextBox51.Visible = False
CommandButton19.Visible = False
EventOff = False
End Sub

Private Sub TextBox2_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
CommandButton1.Visible = False
CommandButton4.Visible = False
CommandButton13.Visible = False
CommandButton11.Visible = False
CommandButton17.Visible = False
CommandButton19.Visible = False
CommandButton20.Visible = False
End Sub

Private Sub TextBox2_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub
Private Sub TextBox21_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox22_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox23_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox24_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox26_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox27_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox28_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox29_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox3_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
 EventOff = True
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 EventOff = False
 Exit Sub
End If

 If TextBox3.Text = "" Then
  EventOff = False
  Exit Sub
 End If
 
 DateString = TextBox3.Text
 Call DateConvert(DateString)
 If IsDate(DateString) = False Then
  Cancel = True
  Label23.Caption = Chr(13) & "    Incorrect Date Input. "
  Label23.Visible = True
  EventOff = False
  Exit Sub
 Else
  TextBox3.Text = DateString
  InvDate = TextBox3.Text
  If InvDate < BeginningDate Then
   If Label1.Caption <> "PURCHASE ORDER" Then
    If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
      MSG = "WARNING!!!" & Chr(13) & Chr(13) & "The date entered belongs to previous year" & Chr(13) & _
       "Thus, no posting to the Inventory and the General Ledger." & Chr(13) & Chr(13) _
        + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
      Title = "WARNING"
      C = InputBox(MSG, Title)
      If C = "Y" Or C = "y" Then
       OldData = True
       GoTo DateProceed
      End If
     If C = "N" Or C = "n" Or C = "" Then
       Label23.Caption = Chr(13) & "    Please enter a new Date and then click 'Save' Button again. "
       Label23.Visible = True
       EventOff = False
       Exit Sub
     End If
      GoTo AskReply
    Else
     Label23.Caption = Chr(13) & "    The date entered belongs to previous Posted year which is not allowed" & _
     Chr(13) & "    Please enter a new Date. "
     Label23.Visible = True
     EventOff = False
     Exit Sub
    End If
   End If
  End If
DateProceed:
  TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
  If InvStatus = "*" Then DueDate = InvDate
  Label23.Visible = False
 End If
 EventOff = False
End Sub

Private Sub TextBox31_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox32_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox33_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox34_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox35_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox35_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label15.Caption)
If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox35.Text Then
 Form15TextNo = 35
 Call Form15Col8Exit("")
End If
If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
EventOff = False
End Sub

Private Sub TextBox35_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
    Form15RowNo = Val(Label15.Caption)
   If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox35.Text Then
     Form15TextNo = 35
     Call Form15Col8Exit("")
   End If
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox36.SetFocus
      SendKeys "{Up}", False
 End If
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox36_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox36_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label16.Caption)
If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox36.Text Then
 Form15TextNo = 36
 Call Form15Col8Exit("")
End If
If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox37_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox37_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
 Form15RowNo = Val(Label17.Caption)
If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox37.Text Then
 Form15TextNo = 37
 Call Form15Col8Exit("")
End If
If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox38_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox38_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label18.Caption)
If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox38.Text Then
 Form15TextNo = 38
 Call Form15Col8Exit("")
End If
If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox39_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox39_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
 Form15RowNo = Val(Label19.Caption)
If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox39.Text Then
 Form15TextNo = 39
 Call Form15Col8Exit("")
End If
If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
EventOff = False
End Sub

Private Sub TextBox4_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox40_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox40_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
 If KeyCode = vbKeyDown Or KeyCode = vbKeyReturn Then
   Form15RowNo = Val(Label20.Caption)
   If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox40.Text Then
     Form15TextNo = 40
     Call Form15Col8Exit("")
   End If
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox39.SetFocus
     SendKeys "{Down}", False
 End If
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox40_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label20.Caption)
If ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 12).Value <> TextBox40.Text Then
 Form15TextNo = 40
 Call Form15Col8Exit("")
End If
If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox4_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox4.Text = CustPO
 Exit Sub
End If
CustPO = TextBox4.Text
End Sub

Private Sub TextBox41_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox41_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox41.Text = DelName
 Exit Sub
End If
 DelName = TextBox41.Text
End Sub

Private Sub TextBox42_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox42_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox42.Text = DelAddress1
 Exit Sub
End If
 DelAddress1 = TextBox42.Text
End Sub

Private Sub TextBox43_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox43_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox43.Text = DelAddress2
 Exit Sub
End If
 DelAddress2 = TextBox43.Text
End Sub

Private Sub TextBox44_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox44_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox44.Text = DelAddress3
 Exit Sub
End If
 DelAddress3 = TextBox44.Text
End Sub

Private Sub TextBox45_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox45_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox45.Text = DelContact
 Exit Sub
End If
 DelContact = TextBox45.Text
End Sub

Private Sub TextBox46_AfterUpdate()
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox46.Text = SalesRep
 Exit Sub
End If
SalesRep = TextBox46.Text
End Sub

Private Sub TextBox46_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox47_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub
Private Sub TextBox47_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String

Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox47.Text = DelDate
 Exit Sub
End If

Label23.Visible = False
If TextBox47.Text = "" Then Exit Sub
If Label1.Caption = "PURCHASE ORDER" Then
  DateString = TextBox47.Text
 Call DateConvert(DateString)
 If IsDate(DateString) = False Then
  Cancel = True
  Label23.Caption = Chr(13) & "    The Delivery Date inputted is Not a Valid Date. "
  Label23.Visible = True
  Exit Sub
 Else
  TextBox47.Text = Format(DateString, "yyyy/mm/dd")
  DelDate = TextBox47.Text
 End If
Else
 DateString = TextBox47.Text
 Call DateConvert(DateString)
 If IsDate(DateString) = False Then
  Cancel = True
  Label23.Caption = Chr(13) & "    The Payment Due Date inputted is Not a Valid Date. "
  Label23.Visible = True
  Exit Sub
 Else
  TextBox47.Text = Format(DateString, "yyyy/mm/dd")
 End If
End If
 
End Sub

Private Sub TextBox48_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox48_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim GoodsRecDate As Date, DateString As String
Application.EnableCancelKey = xlDisabled
 Label23.Visible = False
 LabelAlert = False
 If TextBox48.Text = "" Then Exit Sub
DateString = TextBox48.Text
 Call DateConvert(DateString)
If IsDate(DateString) = False Then
  Cancel = True
  Label23.Caption = Chr(13) & "    Receiving Date inputted is Not a Valid Date. "
  Label23.Visible = True
  LabelAlert = True
  Exit Sub
Else
  TextBox48.Text = Format(DateString, "yyyy/mm/dd")
  GoodsRecDate = TextBox48.Text
  If GoodsRecDate > Date Then
    Cancel = True
   Label23.Caption = Chr(13) & "    Receiving Date Must Not be a future date. "
   Label23.Visible = True
   LabelAlert = True
   Exit Sub
  End If
  If GoodsRecDate < BeginningDate Then
    If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
      MSG = "WARNING!!!" & Chr(13) & Chr(13) & "The date entered belongs to previous year" & Chr(13) & _
       "Thus, no posting to the Inventory and the General Ledger." & Chr(13) & Chr(13) _
        + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
      Title = "WARNING"
      C = InputBox(MSG, Title)
      If C = "Y" Or C = "y" Then
       GoTo DateProceed
      End If
     If C = "N" Or C = "n" Or C = "" Then
       Label23.Caption = Chr(13) & "    Please enter a new Date "
       Label23.Visible = True
       LabelAlert = False
       Exit Sub
     End If
      GoTo AskReply
    Else
     Label23.Caption = Chr(13) & "    The date entered belongs to previous Posted year which is not allowed" & _
     Chr(13) & "    Please enter a new Date. "
     Label23.Visible = True
     LabelAlert = True
     Exit Sub
    End If
  End If
DateProceed:
 ThisWorkbook.Worksheets("TempRP").Range("L42").NumberFormat = "yyyy/mm/dd"
 ThisWorkbook.Worksheets("TempRP").Range("L42").Value = TextBox48.Text
 CommandButton17.Visible = True
End If
End Sub

Private Sub TextBox49_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox49_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox49.Text = Remarks
 Exit Sub
End If
Remarks = TextBox49.Text
End Sub

Private Sub TextBox5_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
 Form15RowNo = Val(Label15.Caption)
 Form15TextNo = 5
 Call Form15Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox5_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox50_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox51_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
Label23.Visible = False
End Sub

Private Sub TextBox51_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
  If IsNumeric(TextBox51.Text) = False Then
   EventOff = True
   If Val(PayTerm) = 0 Then
      TextBox51.Text = "30"
    Else
     TextBox51.Text = Val(PayTerm)
    End If
    Label23.Caption = Chr(13) & "     Incorrect Input.  It must be a number     "
    Label23.Visible = True
    EventOff = False
    Exit Sub
  End If
 If Label39.Caption <> "C.O.D." And Label39.Caption <> "Prepaid" Then
    PayTerm = TextBox51 & " " & Label39.Caption
 Else
   PayTerm = Label39.Caption
 End If
End Sub

Private Sub TextBox52_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
PayTerm = TextBox52.Text & "    "
Label39.Caption = PayTerm
Label39.Left = 84
Label39.Width = 138
End Sub
Private Sub TextBox53_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox53_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox53.Text = Instr1
 Exit Sub
End If

Instr1 = TextBox53.Text
End Sub

Private Sub TextBox54_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox54_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox54.Text = Instr2
 Exit Sub
End If

Instr2 = TextBox54.Text
End Sub

Private Sub TextBox55_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox55_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox55.Text = Instr3
 Exit Sub
End If

Instr3 = TextBox55.Text
End Sub

Private Sub TextBox6_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label23.Visible = False
 Form15RowNo = Val(Label15.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox6.Text = Cells(Form15RowNo + 42, 5).Value
 EventOff = False
 Exit Sub
End If
If Not (ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = "" Or ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = 0) Then
  Label23.Caption = Chr(13) & "     Delivery of this part has already been received, change to the part data is not allowed"
  Label23.Visible = True
  TextBox6.Text = Cells(Form15RowNo + 42, 5).Value
  EventOff = False
 Exit Sub
End If
If TextBox5.Value = "" Then
  Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  Label23.Visible = True
  TextBox6.Text = ""
  EventOff = False
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 5).Value = TextBox6.Text
 EventOff = False
End Sub

Private Sub TextBox6_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox7_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label15.Caption)
 Form15TextNo = 7
 Call Form15Col3Exit("")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox7_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox7_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox7.Text) = False And TextBox7.Text <> "" And TextBox5.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox7_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
   Form15RowNo = Val(Label15.Caption)
   Form15TextNo = 7
   Call Form15Col3Exit("")
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox12.SetFocus
      SendKeys "{Up}", False
  End If
 EventOff = False
End Sub

Private Sub TextBox8_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label15.Caption)
 Form15TextNo = 8
 Call Form15Col4Exit("")
 EventOff = False
End Sub

Private Sub TextBox8_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox8_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox8.Text) = False And TextBox8.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox9_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label15.Caption)
 Form15TextNo = 9
 Call Form15Col5Exit("")
 EventOff = False
End Sub

Private Sub TextBox9_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox9_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox9.Text) = False And TextBox9.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox10_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
 Form15RowNo = Val(Label16.Caption)
 Form15TextNo = 10
 Call Form15Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox10_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox11_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Label23.Visible = False
 Form15RowNo = Val(Label16.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox11.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If Not (ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = "" Or ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = 0) Then
  Label23.Caption = Chr(13) & "     Delivery of this part has already been received, change to the part data is not allowed"
  Label23.Visible = True
  TextBox11.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If TextBox10.Value = "" Then
  Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  Label23.Visible = True
  TextBox11.Text = ""
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 5).Value = TextBox11.Text
End Sub

Private Sub TextBox12_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label16.Caption)
 Form15TextNo = 12
 Call Form15Col3Exit("")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox12_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox12.Text) = False And TextBox12.Text <> "" And TextBox10.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox13_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label16.Caption)
 Form15TextNo = 13
 Call Form15Col4Exit("")
 EventOff = False
End Sub

Private Sub TextBox13_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox13.Text) = False And TextBox13.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox14_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label16.Caption)
 Form15TextNo = 14
 Call Form15Col5Exit("")
 EventOff = False
End Sub

Private Sub TextBox14_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox14.Text) = False And TextBox14.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox15_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
 Form15RowNo = Val(Label17.Caption)
 Form15TextNo = 15
 Call Form15Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox15_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox16_AfterUpdate()
Application.EnableCancelKey = xlDisabled
 Label23.Visible = False
 Form15RowNo = Val(Label17.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox16.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If Not (ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = "" Or ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = 0) Then
  Label23.Caption = Chr(13) & "     Delivery of this part has already been received, change to the part data is not allowed"
  Label23.Visible = True
  TextBox16.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If TextBox15.Value = "" Then
  Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  Label23.Visible = True
  TextBox16.Text = ""
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 5).Value = TextBox16.Text
End Sub

Private Sub TextBox17_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label17.Caption)
 Form15TextNo = 17
 Call Form15Col3Exit("")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox17_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox17.Text) = False And TextBox17.Text <> "" And TextBox15.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox18_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label17.Caption)
 Form15TextNo = 18
 Call Form15Col4Exit("")
 EventOff = False
End Sub

Private Sub TextBox18_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox18.Text) = False And TextBox18.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox19_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label17.Caption)
 Form15TextNo = 19
 Call Form15Col5Exit("")
 EventOff = False
End Sub

Private Sub TextBox19_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox19.Text) = False And TextBox19.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox20_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
 Form15RowNo = Val(Label18.Caption)
 Form15TextNo = 20
 Call Form15Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox20_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox21_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 Label23.Visible = False
 Form15RowNo = Val(Label18.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox21.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If Not (ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = "" Or ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = 0) Then
  Label23.Caption = Chr(13) & "     Delivery of this part has already been received, change to the part data is not allowed"
  Label23.Visible = True
  TextBox21.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If TextBox20.Value = "" Then
  Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  Label23.Visible = True
  TextBox21.Text = ""
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 5).Value = TextBox21.Value
End Sub

Private Sub TextBox22_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label18.Caption)
 Form15TextNo = 22
 Call Form15Col3Exit("")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox22_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox22.Text) = False And TextBox22.Text <> "" And TextBox20.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox23_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label18.Caption)
 Form15TextNo = 23
 Call Form15Col4Exit("")
 EventOff = False
End Sub

Private Sub TextBox23_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox23.Text) = False And TextBox23.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox24_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label18.Caption)
 Form15TextNo = 24
 Call Form15Col5Exit("")
 EventOff = False
End Sub

Private Sub TextBox24_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox24.Text) = False And TextBox24.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox25_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
 Form15RowNo = Val(Label19.Caption)
 Form15TextNo = 25
 Call Form15Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox25_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox26_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 Label23.Visible = False
 Form15RowNo = Val(Label19.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox26.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If Not (ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = "" Or ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = 0) Then
  Label23.Caption = Chr(13) & "     Delivery of this part has already been received, change to the part data is not allowed"
  Label23.Visible = True
  TextBox26.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If TextBox25.Value = "" Then
  Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  Label23.Visible = True
  TextBox26.Text = ""
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 5).Value = TextBox26.Value
End Sub

Private Sub TextBox27_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label19.Caption)
 Form15TextNo = 27
 Call Form15Col3Exit("")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox27_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox27.Text) = False And TextBox27.Text <> "" And TextBox25.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox28_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label19.Caption)
 Form15TextNo = 28
 Call Form15Col4Exit("")
 EventOff = False
End Sub

Private Sub TextBox28_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox28.Text) = False And TextBox28.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox29_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label19.Caption)
 Form15TextNo = 29
 Call Form15Col5Exit("")
 EventOff = False
End Sub

Private Sub TextBox29_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox29.Text) = False And TextBox29.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox30_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
 Form15RowNo = Val(Label20.Caption)
 Form15TextNo = 30
 Call Form15Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox30_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = False Then Label23.Visible = False
 LabelAlert = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox31_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 Label23.Visible = False
 Form15RowNo = Val(Label20.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "PURCHASE ORDER" Or Label1.Caption = "DEBIT NOTE") Then
 TextBox31.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If Not (ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = "" Or ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 11).Value = 0) Then
  Label23.Caption = Chr(13) & "     Delivery of this part has already been received, change to the part data is not allowed"
  Label23.Visible = True
  TextBox31.Text = Cells(Form15RowNo + 42, 5).Value
 Exit Sub
End If
If TextBox30.Value = "" Then
  Label23.Caption = Chr(13) & "    No data for the Product Code. Please enter the product code first."
  Label23.Visible = True
  TextBox31.Text = ""
  Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form15RowNo + 42, 5).Value = TextBox31.Value
End Sub

Private Sub TextBox32_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label20.Caption)
 Form15TextNo = 32
 Call Form15Col3Exit("")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox32_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox32.Text) = False And TextBox32.Text <> "" And TextBox30.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox32_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyDown Then
  Form15RowNo = Val(Label20.Caption)
  Form15TextNo = 32
  Call Form15Col3Exit("")
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox27.SetFocus
     SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox33_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label20.Caption)
 Form15TextNo = 33
 Call Form15Col4Exit("")
 EventOff = False
 End Sub
 
 Private Sub TextBox33_Exit(ByVal Cancel As MSForms.ReturnBoolean)
 If EventOff = True Then Exit Sub
If IsNumeric(TextBox33.Text) = False And TextBox33.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox34_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form15RowNo = Val(Label20.Caption)
 Form15TextNo = 34
 Call Form15Col5Exit("")
 EventOff = False
End Sub

Private Sub TextBox34_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
If IsNumeric(TextBox34.Text) = False And TextBox34.Text <> "" Then Cancel = True
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.Clear
MyBook.Worksheets("Supplier Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
 ListBox1.AddItem "CLOSE this box"
 ListBox3.Clear
  MyBook.Worksheets("COmData").Activate
  Range("K10").Select
 If ActiveCell.Value <> "" Then
  ListBox3.AddItem "  " & ActiveCell.Value & " --- (Default) "
  ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
   ListBox3.AddItem "  " & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
    DelName = Range("L10").Value
    DelAddress1 = Range("M10").Value
    DelAddress2 = Range("N10").Value
    DelAddress3 = Range("O10").Value
    DelContact = Range("P10").Value
 Else
  ListBox3.AddItem "No Record of Delivery Address"
    DelName = Range("B2").Value
    DelAddress1 = Range("B3").Value
    DelAddress2 = Range("B4").Value
    DelAddress3 = Range("B5").Value
    DelContact = ""
 End If
 ListBox3.AddItem "CLOSE this box"
ThisWorkbook.Worksheets("ComFactSheet").Activate
Range("E1").Select
ListBox4.Clear
Do While ActiveCell.Value <> ""
ListBox4.AddItem ActiveCell.Value
ActiveCell.Offset(1, 0).Select
Loop
ListBox4.AddItem "User Input"
ListBox4.Value = "C.O.D."
SupplierNo = ""
 EventOff = True
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PURCHASE" Then
  Label1.Caption = "PURCHASE ORDER"
  PONo = "P" & Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
  CommandButton15.Caption = "Print-out   This PO"
  Label58.Caption = "P"
Else
  PONo = "DN" & Right(("00000" & Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1), 5)
  Label1.Caption = "DEBIT NOTE"
  Label4.Caption = "Debit Note # : "
  Label6.Caption = "Ref PO # : "
   Label58.Caption = "DN"
   Label14.Visible = False
   Label52.Caption = "Payment Due Date : "
   Label39.Visible = False
   Label40.Visible = False
   Label44.Visible = False
   CommandButton1.Caption = "Save DN"
   CommandButton12.Caption = "New DN"
   CommandButton13.Caption = "Delete DN"
   CommandButton15.Caption = "Print-out   This DN"
   Label7.Visible = False
   CommandButton18.Visible = False
   TextBox41.Visible = False
   TextBox42.Visible = False
   TextBox43.Visible = False
   TextBox44.Visible = False
   TextBox45.Visible = False
   CommandButton19.Visible = False
   Label59.Visible = True
   Label60.Visible = False
End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PURCHASE" Then
    Label1.Caption = "PURCHASE ORDER "
    PONo = "P" & Right(("000000" & Val(MyBook.Worksheets("PORecord").Range("A1").Value) + 1), 6)
  Else
    PONo = "DN" & Right(("00000" & Val(MyBook.Worksheets("PORecord").Range("F1").Value) + 1), 5)
    Label1.Caption = "DEBIT NOTE "
  End If
 CommandButton1.Visible = False
 CommandButton3.Visible = False
 CommandButton4.Visible = False
 CommandButton12.Visible = False
 CommandButton18.Visible = False
 CommandButton19.Visible = False
 Label60.Visible = False
End If
Call POTempFormat("")
DelNo = 0
 EventOff = False
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub
Attribute VB_Name = "UserForm16"
Attribute VB_Base = "0{6905836D-ACC2-4143-845B-799B3081B1D0}{8425D334-E9CE-4F70-9AD6-E41937BAD75C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public StartDate As Date, EndDate As Date

Private Sub CommandButton1_Click()
Dim YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
ListBox1.Visible = False
If OptionButton1.Value = True And (TextBox3.Text = "" Or Label11.Caption = "") Then
   Label5.Caption = Chr(13) & "   Please input the selected customer # to proceed."
   Label5.Visible = True
   Exit Sub
End If
If OptionButton7.Value = True And (TextBox6.Text = "" Or Label16.Caption = "") Then
   Label5.Caption = Chr(13) & "   Please input the selected customer # to proceed."
   Label5.Visible = True
   Exit Sub
End If
If OptionButton5.Value <> True Then
 If IsDate(TextBox1.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Beginning Date"
  Label5.Visible = True
  Exit Sub
 End If
 If IsDate(TextBox2.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Ending Date"
  Label5.Visible = True
  Exit Sub
 End If
 If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
 If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
  If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
  End If
 End If
End If
If OptionButton6.Value = True Then
  ListBox1.Visible = False
  Label5.BackColor = &H40C0&
  Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
  Label5.Visible = True
  DoEvents
  Application.ScreenUpdating = False
  Me.Hide
  Call CustLedger("CustLedger")
 Exit Sub
End If
If OptionButton7.Value = True Then
  ListBox1.Visible = False
  Label5.BackColor = &H40C0&
  Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
  Label5.Visible = True
  DoEvents
  Application.ScreenUpdating = False
  Me.Hide
  Call CustLedger(TextBox6.Text)
 Exit Sub
End If
If OptionButton5.Value = True Then
  If TextBox5.Text = "" Then
    Label5.Caption = Chr(13) & "       Please Input invoice number"
    Label5.Visible = True
    Exit Sub
   End If
   If IsError(Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = True Then
    Label5.Caption = Chr(13) & "   The invoice number is not found from the Record."
    Label5.Visible = True
    Exit Sub
   End If
  ListBox1.Visible = False
  Label5.BackColor = &H40C0&
  Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
  Label5.Visible = True
  DoEvents
  Application.EnableEvents = False
   Application.DisplayAlerts = False
   ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add
    ActiveSheet.Name = "Report"
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Columns("A:A").Select
    With Selection
        .ColumnWidth = 28
        .NumberFormat = "yyyy/mm/dd"
        .HorizontalAlignment = xlCenter
    End With
    Columns("B:B").Select
    With Selection
        .NumberFormat = "#,##0.00"
        .ColumnWidth = 17
        .HorizontalAlignment = xlRight
    End With
    Columns("C").Select
    With Selection
        .ColumnWidth = 14
        .HorizontalAlignment = xlLeft
        .IndentLevel = 2
    End With
    Columns("A:C").Select
    With Selection.Font
        .Name = "Times New Roman"
        .Size = 12
    End With
    Range("A1").Value = "Record of Payment Received for the below Invoice/ Credit Note"
    Range("A1").Select
    With Selection
        .HorizontalAlignment = xlLeft
    End With
    With Selection.Font
        .Name = "Times New Roman"
        .FontStyle = "Bold"
        .Size = 14
    End With
    Range("A3:A7").Select
    With Selection
        .HorizontalAlignment = xlRight
    End With
    Range("B3:B7").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 2
    End With
    Range("A9").Select
    With Selection
        .HorizontalAlignment = xlLeft
    End With
    With Selection.Font
        .Name = "Times New Roman"
        .FontStyle = "Bold"
        .Size = 12
    End With
    Range("A11:C11").Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = xlAutomatic
    End With
    Range("B3").NumberFormat = "@"
    Range("B4").NumberFormat = "yyyy/mm/dd"
    Range("B5").NumberFormat = "#,##0.00"
    Range("B6").NumberFormat = "#,##0.00"
    ThisWorkbook.Worksheets("TempRP").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
  InvRow = Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)
  ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
  MyBook.Worksheets("Receivable").Activate
  Cells(InvRow, 1).EntireRow.Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("A1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Range("A6").Value = Range("A1").Value & " # :"
  Range("B6").NumberFormat = "@"
  If Left(Range("B1").Value, 1) = "C" Or Right(Range("B1").Value, 1) = " " Then
   Range("B6").Value = Range("B1").Value
  Else
   Range("B6").Value = "INV" & Range("B1").Value
  End If
  Range("A7").Value = "Invoice Date : "
  Range("B7").Value = Range("D1").Value
  Range("A8").Value = "Invoice Amount : (" & SysCurrency & ")"
  Range("B8").Value = Range("AF1").Value
  Range("A9").Value = "Outstanding Amount : (" & SysCurrency & ")"
  Range("B9").Value = Range("K1").Value
  Range("A10").Value = "Customer : "
  Range("B10").Value = Range("Q1").Value & "    ( # " & Range("P1").Value & " )"
  Range("A12").Value = "Details of Payment Received : --"
  Range("A14").Value = " Payment Date"
  Range("B13").Value = "Payment Amount"
  Range("B14").Value = "(" & SysCurrency & ")"
  Range("C14").Value = "Receipt No"
  Range("GN1").Select
  I = 15
  Do While ActiveCell.Value <> ""
   Cells(I, 1).NumberFormat = "yyyy/mm/dd"
   Cells(I, 1).Value = ActiveCell.Value
   Cells(I, 2).Value = ActiveCell.Offset(0, 1).Value
   Cells(I, 3).Value = ActiveCell.Offset(0, 2).Value
   ActiveCell.Offset(0, 3).Select
   I = I + 1
  Loop
  Range(Cells(6, 1), Cells(I, 3)).Copy
  Worksheets("Report").Activate
  Range("A3").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Range("E1").Value = " "
  On Error GoTo NoPrinter
  With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.75)
        .RightMargin = Application.InchesToPoints(0.75)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
 GoTo Finish
End If
  If IsDate(TextBox1.Text) = False Then
    Cancel = True
    Label5.Caption = Chr(13) & "    Incorrect Beginning Date entered"
    Label5.Visible = True
    Exit Sub
  End If
  If IsDate(TextBox2.Text) = False Then
    Cancel = True
    Label5.Caption = Chr(13) & "    Incorrect Ending Date entered"
    Label5.Visible = True
    Exit Sub
  End If
  StartDate = TextBox1.Text
  EndDate = TextBox2.Text
  If EndDate < StartDate Then
    Label5.Caption = Chr(13) & "    Ending Date must not be earlier than the Beginning Date"
    Label5.Visible = True
    Exit Sub
  End If
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
  End If
 ListBox1.Visible = False
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
 Call RecRecord("PAYMENT")
Finish:
 Unload Me
 Application.EnableEvents = False
 MyBook.Activate
 ThisWorkbook.Worksheets("Report").Activate
 ActiveSheet.Visible = xlSheetVisible
 Worksheets("System Menu").Visible = xlSheetVeryHidden
 SheetName = "Report"
 OldForm = "UserForm8"
 Application.EnableEvents = True
 ActiveWindow.DisplayGridlines = False
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A2").Select
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
Unload Me
UserForm8.Show
End Sub

Private Sub CommandButton3_Click()
 ListBox1.Visible = True
 Label5.Visible = False
End Sub

Private Sub CommandButton4_Click()
 ListBox1.Visible = True
 Label5.Visible = False
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If ListBox1.List(0) = "No Customer Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 If ListBox1.Text = "" Then
  ListBox1.Visible = False
  Exit Sub
 End If
 RowNo = ListBox1.ListIndex + 2
TextBox3.Text = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
Label11.Caption = MyBook.Worksheets("Customer Data").Cells(RowNo, 3).Value
TextBox6.Text = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
Label16.Caption = MyBook.Worksheets("Customer Data").Cells(RowNo, 3).Value
ListBox1.Visible = False
End Sub

Private Sub OptionButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = True
 TextBox3.Visible = True
 Label11.Visible = True
 Label12.Visible = True
 CommandButton3.Visible = True
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
  TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton3_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton5_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = False
 TextBox1.Visible = False
 Label3.Visible = False
 TextBox2.Visible = False
 Label8.Visible = False
 Label9.Visible = False
 Label14.Visible = True
 TextBox5.Visible = True
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub
Private Sub OptionButton6_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton7_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = True
 Label16.Visible = True
 Label15.Visible = True
 Label17.Visible = True
 CommandButton4.Visible = True
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox1.Text = "" Then Exit Sub
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
 StartDate = TextBox1.Text
 If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If

End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox2.Text = "" Then Exit Sub
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox2.Text = Format(DateString, "yyyy/mm/dd")
End If
EndDate = TextBox2.Text
If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
End Sub
Private Sub TextBox3_Change()
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CustNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
CustNo = UCase(TextBox3.Text)
If IsNumeric(CustNo) Then
 If Len(CustNo) < 6 Then CustNo = Right(("00000" & CustNo), 5)
End If
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
  TextBox3.Text = CustNo
  Label11.Caption = ""
  Label5.Caption = Chr(13) & "      Incorrect Customer # entered"
  Label5.Visible = True
Else
 CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
 MyBook.Worksheets("Customer Data").Activate
 TextBox3.Text = CustNo
 Label11.Caption = Cells(CustRow, 3).Value
End If
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InvInput As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
InvInput = UCase(TextBox5.Text)
If Left(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = 1
 Do While J <= I And Mid(InvInput, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Right(InvInput, I - J + 1)
  End If
End If
If Right(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = I
 Do While J > 0 And Mid(InvInput, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Left(InvInput, J)
  End If
End If
InputChecked:
If IsNumeric(InvInput) Then
 If Len(InvInput) < 7 Then
   InvNo = Right(("000000" & InvInput), 6)
 Else
  InvNo = InvInput & " "
 End If
ElseIf Len(InvInput) = 7 Then
  If Left(InvInput, 2) = "CN" Then
   If IsNumeric(Right(InvInput, 5)) = True Then
     InvNo = InvInput
   Else
    InvNo = InvInput & " "
   End If
  Else
   InvNo = InvInput & " "
  End If
ElseIf Len(InvInput) = 9 Then
  If Left(InvInput, 3) = "INV" Then
   If IsNumeric(Right(InvInput, 6)) = True Then
    InvNo = Right(InvInput, 6)
   Else
    InvNo = InvInput & " "
   End If
  Else
   InvNo = InvInput & " "
  End If
Else
  InvNo = InvInput & " "
End If
 TextBox5.Text = InvNo
End Sub

Private Sub TextBox6_Change()
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CustNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
CustNo = UCase(TextBox6.Text)
If IsNumeric(CustNo) Then
 If Len(CustNo) < 6 Then CustNo = Right(("00000" & CustNo), 5)
End If
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
  TextBox6.Text = CustNo
  Label16.Caption = ""
  Label5.Caption = Chr(13) & "      Incorrect Customer # entered"
  Label5.Visible = True
Else
 CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
 MyBook.Worksheets("Customer Data").Activate
 TextBox6.Text = CustNo
 Label16.Caption = Cells(CustRow, 3).Value
End If
End Sub
Private Sub UserForm_Initialize()
Dim Tbl As Range, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  EndDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  EndDate = Year(EndDate) + 1 & "/" & Month(EndDate) & "/" & Day(EndDate)
  EndDate = EndDate - 1
Else
   EndDate = Date
End If
  If Month(EndDate) > 3 Then
   If IsDate(Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1) = False Then
    StartDate = Year(EndDate) & "/" & Month(EndDate) - 2 & "/" & 1
   Else
   StartDate = Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1
   End If
  ElseIf Month(EndDate) = 3 Then
   If IsDate(Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) & "/" & 1 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1
   End If
  Else
   If IsDate(Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 10 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1
   End If
  End If
If Day(EndDate + 1) = 1 And Day(StartDate) <> 1 Then
 StartDate = Year(StartDate) - 1 & "/" & Month(StartDate) + 1 & "/" & 1
End If
 TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
 TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  OptionButton3.Value = True
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
Application.EnableEvents = False
ThisWorkbook.Worksheets("System Menu").Activate
SheetName = "System Menu"
Application.EnableEvents = True
End Sub
Attribute VB_Name = "UserForm17"
Attribute VB_Base = "0{36855B4F-CAB5-4F13-B8C7-8FD6CF99090B}{8D53474E-C2DE-450A-9B41-F3C6C99475C5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public ExpenseAcctNo As String, AssetAcctNo As String, SupplierNo As String, PartNo As String, COARange As Range
Public AssetAcctCK As Variant, ExpenseAcctCK As Variant, StockAssetAcct As String

Private Sub ComboBox1_Click()
Dim EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ComboBox1.Width = 60
Label13.Caption = ""
ExpenseAcctNo = ComboBox1.Text
FullNo = Len(ExpenseAcctNo)
EndNo = 1
Do While Mid(ExpenseAcctNo, EndNo, 1) <> " " And EndNo <= FullNo
EndNo = EndNo + 1
Loop
If FullNo > 6 Then Label13.Caption = Right(ExpenseAcctNo, FullNo - 6)
ExpenseAcctNo = Left(ExpenseAcctNo, EndNo - 1)
ComboBox1.Text = ExpenseAcctNo
End Sub

Private Sub Combobox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long, J As Long, TempInput As String, EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
  ComboBox1.Width = 60
 If ComboBox1.Text = "" Then
  Label13.Caption = ""
  Exit Sub
 End If
I = ComboBox1.ListCount
J = 0
TempInput = ComboBox1.Text
Do While J < I
 If TempInput = Left(ComboBox1.List(J), Len(TempInput)) Then
   TempInput = ComboBox1.List(J)
   FullNo = Len(TempInput)
   EndNo = 1
   Do While Mid(TempInput, EndNo, 1) <> " " And EndNo <= FullNo
    EndNo = EndNo + 1
   Loop
   TempInput = Left(TempInput, EndNo - 1)
   ComboBox1.Text = TempInput
   Label13.Caption = Right(ComboBox1.List(J), Len(ComboBox1.List(J)) - 6)
  Exit Sub
 End If
  J = J + 1
Loop
 Label10.Caption = Chr(13) & "    Incorrect Expense Account #"
 Label13.Caption = ""
 Label10.Visible = True
End Sub

Private Sub Combobox1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ComboBox1.Width = 306
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub ComboBox2_Click()
Dim EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
ComboBox2.Width = 60
If StockNoExist = "Yes" And StockAssetAcct <> "" Then
  Label10.Caption = Chr(13) & "   The stock # exists in the Record." & Chr(13) & " Change of the Asset Account should be done at Inventory System"
  Label10.Visible = True
  ComboBox2.Value = StockAssetAcct
  Exit Sub
End If
Label14.Caption = ""
AssetAcctNo = ComboBox2.Text
FullNo = Len(AssetAcctNo)
EndNo = 1
Do While Mid(AssetAcctNo, EndNo, 1) <> " " And EndNo <= FullNo
EndNo = EndNo + 1
Loop
If FullNo > 6 Then Label14.Caption = Right(AssetAcctNo, FullNo - 6)
Label14.Visible = True
AssetAcctNo = Left(AssetAcctNo, EndNo - 1)
ComboBox2.Text = AssetAcctNo
End Sub

Private Sub ComboBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long, J As Long, TempInput As String, EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
  ComboBox2.Width = 60
If StockNoExist = "Yes" And StockAssetAcct <> "" Then
  Label10.Caption = Chr(13) & "   The stock # exists in the Record." & Chr(13) & " Change of the Asset Account should be done at Inventory System"
  Label10.Visible = True
  ComboBox2.Value = StockAssetAcct
  Exit Sub
End If
  If ComboBox2.Text = "" Then
  Label14.Caption = ""
  Exit Sub
 End If
I = ComboBox2.ListCount
J = 0
TempInput = ComboBox2.Text
Do While J < I
 If TempInput = Left(ComboBox2.List(J), Len(TempInput)) Then
   TempInput = ComboBox2.List(J)
   FullNo = Len(TempInput)
   EndNo = 1
   Do While Mid(TempInput, EndNo, 1) <> " " And EndNo <= FullNo
    EndNo = EndNo + 1
   Loop
   TempInput = Left(TempInput, EndNo - 1)
   ComboBox2.Text = TempInput
   Label14.Caption = Right(ComboBox2.List(J), Len(ComboBox2.List(J)) - 6)
  Exit Sub
 End If
  J = J + 1
Loop
 Label10.Caption = Chr(13) & "    Incorrect Asset Account #"
 Label14.Caption = ""
 Label10.Visible = True
End Sub

Private Sub ComboBox2_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ComboBox2.Width = 306
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PURCHASE" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "DEBIT NOTE" Then
   Call Form15PartList("")
   Unload Me
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
   UserForm15.Show
 Else
   Unload Me
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
   UserForm8.Show
 End If
End Sub

Private Sub CommandButton2_Click()
Dim EndNo As Long, ProdRow As Long, COARange As Range, I As Long, Tbl As Range, ProdDes As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
PartNo = TextBox1.Text
If TextBox1.Text = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Part #"
 Label10.Visible = True
 GoTo FinishSave
End If
If TextBox2.Text = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Part Description"
 Label10.Visible = True
 GoTo FinishSave
End If
If TextBox6.Text = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Supplier #"
 Label10.Visible = True
 GoTo FinishSave
End If
SupplierNo = TextBox6.Text
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Columns("B"), 0)) Or Label18.Caption = "" Then
  Label18.Caption = ""
  Label10.Caption = Chr(13) & "    Incorrect Supplier #"
  Label10.Visible = True
  GoTo FinishSave
End If
If IsNumeric(TextBox3.Text) = False Then
 Label10.Caption = Chr(13) & "    Incorrect Unit Price entered"
 Label10.Visible = True
 GoTo FinishSave
End If
If OptionButton2.Value = True Then
 If ComboBox1.Value = "" Or Label13.Caption = "" Then
  Label10.Caption = Chr(13) & "    Please enter the Expense Account #"
  Label10.Visible = True
  GoTo FinishSave
 Else
  ExpenseAcctNo = ComboBox1.Value
 End If
 If Left(ExpenseAcctNo, 1) <> 5 And Left(ExpenseAcctNo, 1) <> 6 And Left(ExpenseAcctNo, 1) <> 7 And Left(ExpenseAcctNo, 1) <> 9 Then
   Label10.Caption = Chr(13) & "    Incorrect Expense Account #"
   Label10.Visible = True
   GoTo FinishSave
 End If
 MyBook.Worksheets("Chart of Account").Activate
 Range("A10").Select
 Do While ActiveCell.Value <= ExpenseAcctNo And ActiveCell.Value <> ""
  If ActiveCell.Value = ExpenseAcctNo Then GoTo AccountOK
   ActiveCell.Offset(1, 0).Select
 Loop
 Label10.Caption = Chr(13) & "    Incorrect Expense Account #"
 Label10.Visible = True
 GoTo FinishSave
End If
If OptionButton1.Value = True Then
 If TextBox5.Text = "" Then
   Label10.Caption = Chr(13) & "    Please enter the Stock #"
   Label10.Visible = True
   GoTo FinishSave
 Else
   StockNo = TextBox5.Text
 End If
 If ComboBox2.Value = "" Or Label14.Caption = "" Then
  Label10.Caption = Chr(13) & "    Please enter the Asset Account #"
  Label10.Visible = True
  GoTo FinishSave
 Else
  AssetAcctNo = ComboBox2.Value
 End If
 If Left(AssetAcctNo, 1) <> 1 Then
   Label10.Caption = Chr(13) & "    Incorrect Asset Account #"
   Label10.Visible = True
   GoTo FinishSave
 End If
 MyBook.Worksheets("Chart of Account").Activate
 Range("A10").Select
 Do While ActiveCell.Value <= AssetAcctNo And ActiveCell.Value <> ""
  If ActiveCell.Value = AssetAcctNo Then GoTo AccountOK
   ActiveCell.Offset(1, 0).Select
 Loop
 Label10.Caption = Chr(13) & "    Incorrect Asset Account #"
 Label10.Visible = True
 GoTo FinishSave
End If
AccountOK:
If IsError(Application.Match(PartNo, MyBook.Worksheets("Supply Data").Columns("D"), 0)) Then
  MyBook.Worksheets("Supply Data").Activate
  Range("D1").Select
  ActiveCell.End(xlDown).Select
  ActiveCell.Offset(1, 0).Select
Else
  PartNo = TextBox1.Text
  SupplierNo = TextBox6.Text
 MyBook.Worksheets("Supply Data").Activate
 If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 End If
  I = Application.Match(PartNo, MyBook.Worksheets("Supply Data").Columns("D"), 0)
  Cells(I, 4).Select
  Do While ActiveCell.Value <> "" And ActiveCell.Value = PartNo
      If ActiveCell.Offset(0, -3).Value = SupplierNo Then Exit Do
     ActiveCell.Offset(1, 0).Select
  Loop
 If ActiveCell.Value = PartNo Then
    I = ActiveCell.Row
   If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PURCHASE" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "DEBIT NOTE" Then
     Label10.Caption = Chr(13) & "    Change to existing purchase part detail is not allowed.  " & Chr(13) & "    Only new purchase parts can be added while PO or Debit Note is being processed.   "
     Label10.Visible = True
     GoTo FinishSave
   End If
AskReply:
    MSG = "Changes were made to this Entry." + Chr(13) + _
    Chr(13) + "OLD RECORD with the same Part number and " + Chr(13) + "Supplier number will be updated" + _
    Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataRemoval
     If C = "N" Or C = "n" Or C = "" Then GoTo FinishSave
    GoTo AskReply
DataRemoval:
 Else
    Range("D1").Select
    ActiveCell.End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
 End If
End If
   ActiveCell.NumberFormat = "@"
   ActiveCell.Value = PartNo
   ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
   ActiveCell.Offset(0, -1).Value = Date
   ActiveCell.Offset(0, -2).NumberFormat = "@"
   ActiveCell.Offset(0, -2).Value = Label18.Caption
   ActiveCell.Offset(0, -3).NumberFormat = "@"
   ActiveCell.Offset(0, -3).Value = SupplierNo
   ActiveCell.Offset(0, 1).NumberFormat = "@"
   ActiveCell.Offset(0, 1).Value = TextBox2.Text
   ActiveCell.Offset(0, 2).NumberFormat = "General"
   ActiveCell.Offset(0, 2).Value = TextBox3.Text
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 6).NumberFormat = "General"
   ActiveCell.Offset(0, 7).NumberFormat = "@"
   If OptionButton2.Value = True Then
     ActiveCell.Offset(0, 3).Value = ExpenseAcctNo
     ActiveCell.Offset(0, 6).Value = ""
     ActiveCell.Offset(0, 5).Value = ""
     ActiveCell.Offset(0, 7).Value = ""
   Else
     ActiveCell.Offset(0, 3).Value = ""
     ActiveCell.Offset(0, 6).Value = AssetAcctNo
     ActiveCell.Offset(0, 5).Value = "Yes"
     ActiveCell.Offset(0, 7).Value = StockNo
   End If
    ExpenseAcctCK = ActiveCell.Offset(0, 3).Value
    AssetAcctCK = ActiveCell.Offset(0, 6).Value
 If OptionButton1.Value <> True Then GoTo NoStockUpdate
 If StockNoExist = "Yes" And StockAssetAcct <> "" Then GoTo NoStockUpdate
  MyBook.Worksheets("StockRec").Activate
 If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
     MyBook.Worksheets("StockRec").Activate
     If Range("B2").Value = "" Then
       Range("B2").Select
     Else
       Range("B1").End(xlDown).Select
       ActiveCell.Offset(1, 0).Select
     End If
   ActiveCell.NumberFormat = "@"
   ActiveCell.Value = StockNo
   ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
   ActiveCell.Offset(0, -1).Value = Date
   ActiveCell.Offset(0, 1).NumberFormat = "@"
   ActiveCell.Offset(0, 1).Value = TextBox2.Text
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = AssetAcctNo
   ActiveCell.Offset(0, 6).NumberFormat = "General"
   ActiveCell.Offset(0, 7).NumberFormat = "General"
   ActiveCell.Offset(0, 8).NumberFormat = "General"
    ProdDes = TextBox2.Text
   Call InvStockAdd(AssetAcctNo, ProdDes)
 End If
 If StockNoExist <> "Yes" Then
   ListBox3.Clear
   MyBook.Worksheets("StockRec").Activate
   If Range("B2") <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox3.AddItem "SWITCH to listing by Stock Item Description"
    Do While ActiveCell.Value <> ""
     ListBox3.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
    ActiveCell.Offset(1, 0).Select
    Loop
   Else
    ListBox3.AddItem "No Record of Stock Item"
   End If
   ListBox3.AddItem "CLOSE this box"
 End If
NoStockUpdate:
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 If ExpenseAcctCK <> "" And IsError(Application.Match(ExpenseAcctCK, COARange, 0)) = False Then
   I = Application.Match(ExpenseAcctCK, COARange, 0) + 9
   Worksheets("Chart of Account").Cells(I, 7).Value = "Y"
 End If
 If AssetAcctCK <> "" And IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
    Worksheets("Chart of Account").Cells(I, 7).Value = "Y"
 End If
ListBox1.Clear
MyBook.Worksheets("Supply Data").Activate
  If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Range("D3").Select
  ListBox1.AddItem "SWITCH to listing by Part Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value & "   (From: " & ActiveCell.Offset(0, -2).Value & " )"
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Data of Purchase items"
 End If
ListBox1.AddItem "CLOSE this box"
For I = 1 To 5
 Controls("TextBox" & I).Text = ""
Next I
Label10.Visible = False
Label7.Visible = False
Label8.Visible = False
Label11.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
SupplierNo = ""
PartNo = ""
StockNoExist = ""
StockNo = ""
StockAssetAcct = ""
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
FinishSave:
EventOff = False
End Sub
Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
EventOff = True
For I = 1 To 6
 Controls("TextBox" & I).Text = ""
Next I
Label10.Visible = False
Label7.Visible = False
Label8.Visible = False
Label11.Visible = False
Label18.Caption = ""
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
SupplierNo = ""
PartNo = ""
StockNoExist = ""
StockNo = ""
StockAssetAcct = ""
  If OptionButton1.Value = True Then
    Label19.Visible = True
    TextBox5.Visible = True
    CommandButton8.Visible = True
    Label20.Visible = True
    Label5.Visible = False
    ComboBox1.Visible = False
    Label13.Visible = False
    Label6.Visible = True
    ComboBox2.Visible = True
    Label14.Visible = True
   Else
    Label19.Visible = False
    TextBox5.Visible = False
    CommandButton8.Visible = False
    Label20.Visible = False
    Label7.Visible = False
    Label8.Visible = False
    Label5.Visible = True
    ComboBox1.Visible = True
    Label13.Visible = True
    Label6.Visible = False
    ComboBox2.Visible = False
    Label14.Visible = False
   End If
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  CommandButton2.Visible = False
 Else
  CommandButton2.Visible = True
 End If
EventOff = False
End Sub
Private Sub CommandButton4_Click()
Dim EndNo As Long, I As Long, J As Long, K As Long, Tbl As Range, CheckRange As Range
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
PartNo = TextBox1.Text
SupplierNo = TextBox6.Text
If TextBox1.Text = "" Then GoTo DeleteFinish
If TextBox6.Text = "" Then GoTo DeleteFinish
If IsError(Application.Match(PartNo, MyBook.Worksheets("Supply Data").Columns("D"), 0)) Then GoTo DeleteFinish
  MyBook.Worksheets("PORecord").Activate
 If Range("B4") <> "" Then
  If IsError(Application.Match(SupplierNo, MyBook.Worksheets("PORecord").Columns("P"), 0)) = False Then
    ActiveSheet.UsedRange.Select
    Set Tbl = Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count - 3)
     Tbl.Select
     Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1"), Order2:=xlAscending, Key3:=Range("A1"), _
     Order3:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
     I = Application.Match(SupplierNo, Tbl.Columns("P"), 0) + 3
     K = Application.Match(SupplierNo, Tbl.Columns("P"), 1) + 3
      Set Tbl = Range(Cells(I, 1), Cells(K, 1))
     If IsError(Application.Match("PO", Tbl, 0)) = False Then
      J = Application.Match("PO", Tbl.Columns("A"), 0) + I - 1
      Set Tbl = Range(Cells(J, 1), Cells(K, 1))
      For I = 35 To 206 Step 9
       Set CheckRange = Tbl.Offset(0, I)
       If IsError(Application.Match(PartNo, CheckRange, 0)) = False Then
        K = Application.Match(PartNo, CheckRange, 0) + J - 1
        If Cells(K, 10).Value < "R" Then
         Label10.Caption = Chr(13) & "     There are outstanding PO for this part item" & _
                     Chr(13) & "     Deletion of this part is not allowed"
         Label10.Visible = True
         GoTo NoDelete
        End If
       End If
      Next I
     End If
  End If
 End If
  I = Application.Match(PartNo, MyBook.Worksheets("Supply Data").Columns("D"), 0)
  MyBook.Worksheets("Supply Data").Activate
  Cells(I, 4).Select
  Do While ActiveCell.Value <> ""
    If ActiveCell.Value = PartNo Then
      If ActiveCell.Offset(0, -3).Value = SupplierNo Then Exit Do
    End If
     ActiveCell.Offset(1, 0).Select
  Loop
  If ActiveCell.Value <> "" Then
    I = ActiveCell.Row
AskReply:
    MSG = "The Part number will be deleted from the Record." + Chr(13) + _
     Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataRemoval
     If C = "N" Or C = "n" Or C = "" Then GoTo NoDelete
    GoTo AskReply
   End If
DataRemoval:
  Cells(I, 1).EntireRow.Delete
    Range("D1").Select
    ActiveCell.End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
ListBox1.Clear
MyBook.Worksheets("Supply Data").Activate
  If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Range("D3").Select
  ListBox1.AddItem "SWITCH to listing by Part Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value & "   (From: " & ActiveCell.Offset(0, -2).Value & " )"
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Data of Purchase items"
 End If
ListBox1.AddItem "CLOSE this box"
DeleteFinish:
EventOff = True
For I = 1 To 6
 Controls("TextBox" & I).Text = ""
Next I
Label10.Visible = False
Label7.Visible = False
Label8.Visible = False
Label11.Visible = False
Label18.Caption = ""
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
SupplierNo = ""
PartNo = ""
StockNoExist = ""
StockNo = ""
StockAssetAcct = ""
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
NoDelete:
EventOff = False
End Sub
Private Sub CommandButton5_Click()
 Label10.Visible = False
 ListBox1.Visible = True
 ListBox2.Visible = False
 ListBox3.Visible = False
End Sub
Private Sub CommandButton6_Click()
 Label10.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = True
 ListBox3.Visible = False
End Sub

Private Sub CommandButton7_Click()
Dim AcctNo As String, Tbl As Range
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = False
 Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
 Application.ScreenUpdating = False
 Application.EnableEvents = False
 Application.DisplayAlerts = False
 ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
Application.EnableEvents = True
Columns("D:I").Select
With Selection.Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
End With
Columns("A:E").NumberFormat = "@"
Columns("F").NumberFormat = "#,##0.0000##"
Columns("G:I").NumberFormat = "@"
Columns("D").HorizontalAlignment = xlLeft
Columns("E").HorizontalAlignment = xlLeft
Columns("F").HorizontalAlignment = xlRight
Columns("G:K").HorizontalAlignment = xlCenter
Columns("A").ColumnWidth = 12
Columns("B").ColumnWidth = 30
Columns("D").ColumnWidth = 20
Columns("E").ColumnWidth = 43
Columns("F:J").ColumnWidth = 16
Columns("K").ColumnWidth = 20
If MyBook.Worksheets("Supply Data").Range("A3") = "" Then GoTo Finish
MyBook.Worksheets("Supply Data").Activate
Set Tbl = ActiveSheet.UsedRange
  Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 I = Selection.Rows.Count
 Range(Cells(3, 1), Cells(I + 2, 11)).Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A8").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
Finish:
Range("A1:A2").HorizontalAlignment = xlLeft
Range("A1") = MyBook.Worksheets("ComData").Range("B2").Value
Range("A2") = "Purchase Item Listing ----- Printed on " & Format(Date, "yyyy/mm/dd")
Range("A6").Value = " Supplier #"
Range("A7").Value = "----------------"
Range("B6").Value = " Supplier Name"
Range("B7").Value = "---------------------------------------"
Range("D6").Value = " Item #"
Range("D7").Value = "------------------------"
Range("E6").Value = " Purchase Item Description"
Range("E7").Value = "-------------------------------------------------------------"
Range("F5").Value = " Unit Price"
Range("F6").Value = " (" & SysCurrency & ")"
Range("F7").Value = "------------------------"
Range("G5").Value = " Linked "
Range("G6").Value = " Expense Acct #"
Range("G7").Value = "---------------------"
Range("I6").Value = " Stock Item "
Range("I7").Value = "---------------------"
Range("J5").Value = " Linked "
Range("J6").Value = " Asset Acct # "
Range("J7").Value = "---------------------"
Range("K5").Value = " Linked "
Range("K6").Value = " Stock # "
Range("K7").Value = "---------------------"
Range("A8").Select
Do While ActiveCell.Value <> ""
 AcctNo = ActiveCell.Value
 Do While ActiveCell.Value = AcctNo And ActiveCell.Value <> ""
  ActiveCell.Offset(1, 0).Select
 Loop
   ActiveCell.EntireRow.Insert
   ActiveCell.EntireRow.Insert
  Range(ActiveCell, ActiveCell.Offset(0, 10)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
  ActiveCell.Offset(2, 0).Select
Loop
   Columns("H").Delete
   Columns("C").Delete
 If Range("A8").Value = "" Then Range("C8").Value = " No data of Purchase items in the record"
    Range("A1:I19").Select
    ActiveWindow.Zoom = 75
     Range("D2").Select
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$7"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
Label10.BackColor = &HC0&
Label10.Visible = False
Unload Me
Application.EnableEvents = False
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PURCHASE" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "DEBIT NOTE" Then
 Call Form15PartList("")
 OldForm = "UserForm15"
Else
 OldForm = "UserForm8"
End If
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
SheetName = "Report"
ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
ThisWorkbook.Worksheets("Report").Activate
ActiveWindow.DisplayGridlines = False
Application.EnableEvents = True
End Sub

Private Sub CommandButton8_Click()
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = True
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, I As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Data of Purchase items" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Part Description" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supply Data").Activate
  If Range("D3") <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    Range("D3").Select
    ListBox1.AddItem "SWITCH to listing by Part # & Supplier"
   Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value & "   (From: " & ActiveCell.Offset(0, -2).Value & " )"
   ActiveCell.Offset(1, 0).Select
  Loop
  Else
   ListBox1.AddItem "No Data of Purchase items"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Part # & Supplier" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supply Data").Activate
   If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Range("D3").Select
  ListBox1.AddItem "SWITCH to listing by Part Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value & "   (From: " & ActiveCell.Offset(0, -2).Value & " )"
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
   ListBox1.AddItem "No Data of Purchase items"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
EventOff = True
RowNo = ListBox1.ListIndex + 2
If ListBox1.Text = "" Then
 For I = 1 To 5
  Controls("TextBox" & I).Text = ""
 Next I
  ListBox1.Visible = False
  Label7.Visible = False
  Label8.Visible = False
  Label11.Visible = False
  StockNo = ""
  StockNoExist = ""
  StockAssetAcct = ""
  EventOff = False
 Exit Sub
End If
MyBook.Worksheets("Supply Data").Activate
  Cells(RowNo, 4).Select
  TextBox1.Text = ActiveCell.Value
  PartNo = TextBox1.Text
  TextBox2.Text = ActiveCell.Offset(0, 1).Value
  TextBox3.Text = Format(ActiveCell.Offset(0, 2).Value, "#,##0.00##################")
  TextBox6.Text = ActiveCell.Offset(0, -3).Value
  SupplierNo = TextBox6.Text
  Label11.Caption = " Last Update : " & Format(ActiveCell.Offset(0, -1).Value, "yyyy/mm/dd")
  Label11.Visible = True
  If ActiveCell.Offset(0, 5).Value = "Yes" Then
    AssetAcctNo = ActiveCell.Offset(0, 6).Value
    ComboBox2.Value = AssetAcctNo
    AssetAcctCK = ActiveCell.Offset(0, 6).Value
    StockNo = ActiveCell.Offset(0, 7).Value
    TextBox5.Text = StockNo
    OptionButton1.Value = True
    If StockNo <> "" Then
      If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
        StockNo = ""
        StockNoExist = ""
        StockAssetAcct = ""
      Else
        I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        StockAssetAcct = MyBook.Worksheets("StockRec").Cells(I, 5).Value
        AssetAcctCK = MyBook.Worksheets("StockRec").Cells(I, 5).Value
        StockNoExist = "Yes"
        Label8.Caption = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        If Label8.Caption = "" Then Label8.Caption = 0
        Label7.Visible = True
        Label8.Visible = True
      End If
    Else
     StockNo = ""
     StockNoExist = ""
     StockAssetAcct = ""
    End If
  Else
    ExpenseAcctNo = ActiveCell.Offset(0, 3).Value
    ComboBox1.Value = ExpenseAcctNo
    ExpenseAcctCK = ActiveCell.Offset(0, 3).Value
    StockNo = ""
    StockNoExist = ""
    StockAssetAcct = ""
    OptionButton2.Value = True
  End If
  If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
    Label18.Caption = ""
  Else
   I = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
   ActiveCell.Offset(0, -2).Value = MyBook.Worksheets("Supplier Data").Cells(I, 3).Value
   Label18.Caption = ActiveCell.Offset(0, -2).Value
  End If
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 Label13.Caption = ""
 If ExpenseAcctCK <> "" Then
  If IsError(Application.Match(ExpenseAcctCK, COARange, 0)) = False Then
   I = Application.Match(ExpenseAcctCK, COARange, 0) + 9
   Label13.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
 Label14.Caption = ""
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
   Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
 ListBox1.Visible = False
If OptionButton1.Value = True Then
    Label19.Visible = True
    TextBox5.Visible = True
    CommandButton8.Visible = True
    Label20.Visible = True
    Label5.Visible = False
    ComboBox1.Visible = False
    Label13.Visible = False
    Label6.Visible = True
    ComboBox2.Visible = True
    Label14.Visible = True
   Else
    Label19.Visible = False
    TextBox5.Visible = False
    CommandButton8.Visible = False
    Label20.Visible = False
    Label7.Visible = False
    Label8.Visible = False
    Label5.Visible = True
    ComboBox1.Visible = True
    Label13.Visible = True
    Label6.Visible = False
    ComboBox2.Visible = False
    Label14.Visible = False
   End If
 EventOff = False
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range, CheckRange As Range, I As Long
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Then GoTo NoProduct
If ListBox2.Text = "No Supplier in the Record" Then GoTo NoProduct
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Supplier name" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox2.AddItem "SWITCH to listing by Supplier #"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Supplier in the Record"
 End If
  ListBox2.AddItem "CLOSE this box"
  ListBox2.Visible = True
  Exit Sub
End If
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Supplier #" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox2.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Supplier in the Record"
 End If
  ListBox2.AddItem "CLOSE this box"
  ListBox2.Visible = True
 Exit Sub
End If
   EventOff = True
 Label11.Visible = False
 RowNo = ListBox2.ListIndex + 2
 MyBook.Worksheets("Supplier Data").Activate
 Cells(RowNo, 2).Select
   TextBox6.Text = ActiveCell.Value
   Label18.Caption = ActiveCell.Offset(0, 1).Value
   SupplierNo = TextBox6.Text
  If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Columns("B"), 0)) Then
    Label18.Caption = ""
    Label10.Caption = Chr(13) & "    Incorrect Supplier #"
    Label10.Visible = True
    GoTo NoProduct
  Else
   I = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Columns("B"), 0)
   Label18.Caption = MyBook.Worksheets("Supplier Data").Cells(I, 3).Value
  End If
  Call Form17Text6Exit("SUPPLY")
If TextBox5.Text = "" Then
  Label7.Visible = False
  Label8.Visible = False
  GoTo NoProduct
End If
  StockNo = TextBox5.Text
  If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
   StockNoExist = ""
   StockAssetAcct = ""
   Label7.Visible = False
   Label8.Visible = False
   GoTo NoProduct
  Else
   MyBook.Worksheets("StockRec").Activate
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
   StockNoExist = "Yes"
   StockAssetAcct = Cells(I, 5).Value
   AssetAcctCK = Cells(I, 5).Value
   Label7.Visible = True
   Label8.Caption = Cells(I, 8).Value
   If Label8.Caption = "" Then Label8.Caption = 0
   Label8.Visible = True
   TextBox4.Text = Cells(I, 11).Value
   ComboBox2.Value = StockAssetAcct
  End If
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  Label13.Caption = ""
 If ExpenseAcctCK <> "" Then
  If IsError(Application.Match(ExpenseAcctCK, COARange, 0)) = False Then
   I = Application.Match(ExpenseAcctCK, COARange, 0) + 9
   Label13.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
  Label14.Caption = ""
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
    Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
NoProduct:
   ListBox2.Visible = False
If OptionButton1.Value = True Then
    Label19.Visible = True
    TextBox5.Visible = True
    CommandButton8.Visible = True
    Label20.Visible = True
    Label5.Visible = False
    ComboBox1.Visible = False
    Label13.Visible = False
    Label6.Visible = True
    ComboBox2.Visible = True
    Label14.Visible = True
   Else
    Label19.Visible = False
    TextBox5.Visible = False
    CommandButton8.Visible = False
    Label20.Visible = False
    Label7.Visible = False
    Label8.Visible = False
    Label5.Visible = True
    ComboBox1.Visible = True
    Label13.Visible = True
    Label6.Visible = False
    ComboBox2.Visible = False
    Label14.Visible = False
   End If
     EventOff = False
End Sub

Private Sub ListBox3_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim Tbl As Range
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If ListBox3.Text = "CLOSE this box" Or ListBox3.ListIndex < 0 Then
 ListBox3.Visible = False
 Exit Sub
End If
If ListBox3.Text = "No Record of Stock Item" Then
 ListBox3.Visible = False
 Exit Sub
End If
If ListBox3.ListIndex = 0 And ListBox3.List(0) = "SWITCH to listing by Stock Item Description" Then
  ListBox3.Visible = False
  ListBox3.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox3.AddItem "SWITCH to listing by Stock #"
  Do While ActiveCell.Value <> ""
   ListBox3.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox3.AddItem "No Record of Stock Item"
 End If
  ListBox3.AddItem "CLOSE this box"
  ListBox3.Visible = True
  Exit Sub
End If
If ListBox3.ListIndex = 0 And ListBox3.List(0) = "SWITCH to listing by Stock #" Then
  ListBox3.Visible = False
  ListBox3.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox3.AddItem "SWITCH to listing by Stock Item Description"
  Do While ActiveCell.Value <> ""
   ListBox3.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox3.AddItem "No Record of Stock Item"
 End If
  ListBox3.AddItem "CLOSE this box"
  ListBox3.Visible = True
  Exit Sub
End If
RowNo = ListBox3.ListIndex + 1
If ListBox3.Text = "" Then
 ListBox3.Visible = False
 Exit Sub
End If
  EventOff = True
MyBook.Worksheets("StockRec").Activate
  Cells(RowNo, 2).Select
  TextBox5.Value = ActiveCell.Value
  StockNo = TextBox5.Text
  StockNoExist = "Yes"
  StockAssetAcct = ActiveCell.Offset(0, 3).Value
  AssetAcctCK = ActiveCell.Offset(0, 3).Value
  ComboBox2.Value = StockAssetAcct
  If TextBox2.Text = "" Then TextBox2.Text = ActiveCell.Offset(0, 1).Value
  Label13 = ""
  Label14 = ""
  Label7.Visible = True
  Label8.Caption = ActiveCell.Offset(0, 6).Value
  If Label8.Caption = "" Then Label8.Caption = 0
  Label8.Visible = True
  TextBox4 = ActiveCell.Offset(0, 9).Value
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  Label14.Caption = ""
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
   Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
 ListBox1.Visible = False
 ListBox3.Visible = False
   EventOff = False
End Sub

Private Sub OptionButton1_Click()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
    OptionButton1.Value = True
    Label6.Visible = True
    ComboBox2.Visible = True
    Label14.Visible = True
    Label5.Visible = False
    ComboBox1.Visible = False
    Label13.Visible = False
    Label19.Visible = True
    TextBox5.Text = ""
    StockNoExist = ""
    StockAssetAcct = ""
    TextBox5.Visible = True
    CommandButton8.Visible = True
    Label20.Visible = True
End Sub

Private Sub OptionButton2_Click()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
    OptionButton2.Value = True
    Label6.Visible = False
    ComboBox2.Visible = False
    Label14.Visible = False
    Label5.Visible = True
    ComboBox1.Visible = True
    Label13.Visible = True
    Label19.Visible = False
    TextBox5.Visible = False
    CommandButton8.Visible = False
    Label20.Visible = False
    Label7.Visible = False
    Label8.Visible = False
    TextBox5.Text = ""
End Sub

Private Sub TextBox1_AfterUpdate()
Dim RowNo As Long, I As Long, J As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label10.Visible = False
 Label11.Visible = False
If TextBox1.Text = "" Then GoTo NoInput
PartNo = TextBox1.Text
If Left(PartNo, 1) = " " Then
 I = Len(PartNo)
 J = 1
 Do While J <= I And Mid(PartNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then GoTo NoInput
  PartNo = Right(PartNo, I - J + 1)
End If
If Right(PartNo, 1) = " " Then
 I = Len(PartNo)
 J = I
 Do While J > 0 And Mid(PartNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then GoTo NoInput
  PartNo = Left(PartNo, J)
End If
PartNo = UCase(PartNo)
TextBox1.Text = PartNo
 Call Form17Text6Exit("SUPPLY")
If TextBox5.Text = "" Then
  StockNoExist = ""
  StockAssetAcct = ""
  Label7.Visible = False
  Label8.Visible = False
  EventOff = False
  Exit Sub
End If
  StockNo = TextBox5.Text
  If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
   StockNoExist = ""
   StockAssetAcct = ""
   Label7.Visible = False
   Label8.Visible = False
   EventOff = False
   Exit Sub
  Else
   MyBook.Worksheets("StockRec").Activate
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
   StockNoExist = "Yes"
   StockAssetAcct = Cells(I, 5).Value
   AssetAcctCK = Cells(I, 5).Value
   Label7.Visible = True
   Label8.Caption = Cells(I, 8).Value
   If Label8.Caption = "" Then Label8.Caption = "0"
   Label8.Visible = True
   TextBox4.Text = Cells(I, 11).Value
   ComboBox2.Value = StockAssetAcct
  End If
 EventOff = False
 Exit Sub
NoInput:
 TextBox1.Text = ""
 PartNo = ""
 For I = 1 To 5
  Controls("TextBox" & I).Text = ""
 Next I
 Label10.Visible = False
 Label11.Visible = False
 ListBox1.Visible = False
 Label7.Visible = False
 Label8.Visible = False
  StockNo = ""
  StockNoExist = ""
  StockAssetAcct = ""
 EventOff = False
End Sub

Private Sub TextBox1_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
End Sub

Private Sub TextBox1_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton8.Visible = False
Label5.Visible = False
ComboBox1.Visible = False
Label13.Visible = False
Label6.Visible = False
ComboBox2.Visible = False
Label14.Visible = False
Label11.Visible = False
CommandButton2.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
  If OptionButton1.Value = True Then
    Label19.Visible = True
    TextBox5.Visible = True
    CommandButton8.Visible = True
    Label20.Visible = True
    Label5.Visible = False
    ComboBox1.Visible = False
    Label13.Visible = False
    Label6.Visible = True
    ComboBox2.Visible = True
    Label14.Visible = True
   Else
    Label19.Visible = False
    TextBox5.Visible = False
    CommandButton8.Visible = False
    Label20.Visible = False
    Label7.Visible = False
    Label8.Visible = False
    Label5.Visible = True
    ComboBox1.Visible = True
    Label13.Visible = True
    Label6.Visible = False
    ComboBox2.Visible = False
    Label14.Visible = False
   End If
  If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
   CommandButton2.Visible = False
  Else
   CommandButton2.Visible = True
  End If
End Sub

Private Sub TextBox2_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
End Sub

Private Sub TextBox3_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CheckNum As Double
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If TextBox3.Text = "" Then TextBox3.Text = 0
If IsNumeric(TextBox3.Text) = False Then
   Label10.Caption = Chr(13) & "   Wrong Unit Price entered !!! "
   Label10.Visible = True
Else
   CheckNum = TextBox3.Text
   TextBox3.Text = Format(CheckNum, "#,##0.00##################")
End If
End Sub

Private Sub TextBox4_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
End Sub

Private Sub TextBox5_AfterUpdate()
Dim I As Long, J As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label10.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
 Label7.Visible = False
 Label8.Visible = False
StockNo = UCase(TextBox5.Text)
TextBox5.Text = StockNo
If StockNo = "" Then
 StockNoExist = ""
 StockAssetAcct = ""
 EventOff = False
 Exit Sub
End If
If Left(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = 1
 Do While J <= I And Mid(StockNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
   TextBox5.Text = ""
   StockNo = ""
   StockNoExist = ""
   StockAssetAcct = ""
   EventOff = False
   Exit Sub
  End If
  StockNo = Right(StockNo, I - J + 1)
End If
If Right(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = I
 Do While J > 0 And Mid(StockNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
   TextBox5.Text = ""
   StockNo = ""
   StockNoExist = ""
   StockAssetAcct = ""
   EventOff = False
   Exit Sub
  End If
  StockNo = Left(StockNo, J)
End If
StockNo = UCase(StockNo)
TextBox5.Text = StockNo
MyBook.Worksheets("StockRec").Activate
If Range("B2").Value = "" Then
 StockNoExist = ""
 StockAssetAcct = ""
 EventOff = False
 Exit Sub
End If
If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
 StockNoExist = ""
 StockAssetAcct = ""
 EventOff = False
 Exit Sub
Else
 I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
 StockNoExist = "Yes"
 StockAssetAcct = Cells(I, 5).Value
 AssetAcctCK = Cells(I, 5).Value
 If TextBox2.Text = "" Then TextBox2.Text = Cells(I, 3).Value
  Label7.Visible = True
  Label8.Caption = Cells(I, 8).Value
  If Label8.Caption = "" Then Label8.Caption = 0
  Label8.Visible = True
 ComboBox2.Value = StockAssetAcct
 Label14.Caption = ""
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
   Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
End If
 EventOff = False
End Sub

Private Sub TextBox5_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
End Sub

Private Sub TextBox6_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
End Sub

Private Sub TextBox6_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton8.Visible = False
Label5.Visible = False
ComboBox1.Visible = False
Label13.Visible = False
Label6.Visible = False
ComboBox2.Visible = False
Label14.Visible = False
Label11.Visible = False
CommandButton2.Visible = False
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
 Application.EnableCancelKey = xlDisabled
  If OptionButton1.Value = True Then
    Label19.Visible = True
    TextBox5.Visible = True
    CommandButton8.Visible = True
    Label20.Visible = True
    Label5.Visible = False
    ComboBox1.Visible = False
    Label13.Visible = False
    Label6.Visible = True
    ComboBox2.Visible = True
    Label14.Visible = True
   Else
    Label19.Visible = False
    TextBox5.Visible = False
    CommandButton8.Visible = False
    Label20.Visible = False
    Label7.Visible = False
    Label8.Visible = False
    Label5.Visible = True
    ComboBox1.Visible = True
    Label13.Visible = True
    Label6.Visible = False
    ComboBox2.Visible = False
    Label14.Visible = False
   End If
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  CommandButton2.Visible = False
 Else
  CommandButton2.Visible = True
 End If
End Sub

Private Sub TextBox6_AfterUpdate()
Dim I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label10.Visible = False
 Label11.Visible = False
 If TextBox6.Text = "" Then
   Label18.Caption = ""
   GoTo Finish
 End If
 SupplierNo = UCase(TextBox6.Text)
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
  End If
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
 TextBox6.Text = SupplierNo
 If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Columns("B"), 0)) Then
    Label18.Caption = ""
    Label10.Caption = Chr(13) & "    Incorrect Supplier #"
    Label10.Visible = True
    GoTo Finish
  Else
   I = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Columns("B"), 0)
   Label18.Caption = MyBook.Worksheets("Supplier Data").Cells(I, 3).Value
  End If
 Call Form17Text6Exit("SUPPLY")
If TextBox5.Text = "" Then GoTo Finish
  StockNo = TextBox5.Text
  If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
   StockNoExist = ""
   StockAssetAcct = ""
   Label7.Visible = False
   Label8.Visible = False
   EventOff = False
   Exit Sub
  Else
   MyBook.Worksheets("StockRec").Activate
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
   StockNoExist = "Yes"
   StockAssetAcct = Cells(I, 5).Value
   AssetAcctCK = Cells(I, 5).Value
   Label7.Visible = True
   Label8.Caption = Cells(I, 8).Value
   If Label8.Caption = "" Then Label8.Caption = 0
   Label8.Visible = True
   TextBox4.Text = Cells(I, 11).Value
   ComboBox2.Value = StockAssetAcct
  End If
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
 If ExpenseAcctCK <> "" And IsError(Application.Match(ExpenseAcctCK, COARange, 0)) = False Then
   I = Application.Match(ExpenseAcctCK, COARange, 0) + 9
   Label13.Caption = Worksheets("Chart of Account").Cells(I, 2)
 Else
   Label13.Caption = ""
 End If
 If AssetAcctCK <> "" And IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
    Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
 Else
   Label14.Caption = ""
 End If
  EventOff = False
  Exit Sub
Finish:
   If OptionButton1.Value = True Then
    Label19.Visible = True
    TextBox5.Visible = True
    CommandButton8.Visible = True
    Label20.Visible = True
    Label5.Visible = False
    ComboBox1.Visible = False
    Label13.Visible = False
    Label6.Visible = True
    ComboBox2.Visible = True
    Label14.Visible = True
   Else
    Label19.Visible = False
    TextBox5.Visible = False
    CommandButton8.Visible = False
    Label20.Visible = False
    Label7.Visible = False
    Label8.Visible = False
    Label5.Visible = True
    ComboBox1.Visible = True
    Label13.Visible = True
    Label6.Visible = False
    ComboBox2.Visible = False
    Label14.Visible = False
   End If
 EventOff = False
End Sub

Private Sub UserForm_Initialize()
Dim SupplierLastRow As Long, PartLastRow As Long, I As Long, L As Long, M As Long, N As Long, Tbl As Range, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
 MyBook.Worksheets("Supplier Data").Activate
   Range("B1").End(xlDown).Select
   SupplierLastRow = ActiveCell.Row
 If SupplierLastRow > 2 Then
   MyBook.Worksheets("Supply Data").Activate
   Range("A1").End(xlDown).Select
   PartLastRow = ActiveCell.Row
  If PartLastRow > 2 Then
   Range(Cells(3, 2), Cells(PartLastRow, 2)).Select
   With Selection
    .NumberFormat = "General"
    .FormulaR1C1 = "=VLOOKUP(RC[-1],'Supplier Data'!R3C2:R" & SupplierLastRow & "C3,2,0)"
    .NumberFormat = "@"
    .Copy
    .PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
   End With
   Application.CutCopyMode = False
  End If
 End If
ListBox1.Clear
MyBook.Worksheets("Supply Data").Activate
  If Range("D3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, Header:=xlNo, _
      OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Range("D3").Select
  ListBox1.AddItem "SWITCH to listing by Part Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value & "   (From: " & ActiveCell.Offset(0, -2).Value & " )"
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Data of Purchase items"
 End If
ListBox1.AddItem "CLOSE this box"
ListBox2.Clear
MyBook.Worksheets("Supplier Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox2.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Supplier in the Record"
 End If
ListBox2.AddItem "CLOSE this box"
ListBox3.Clear
MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox3.AddItem "SWITCH to listing by Stock Item Description"
  Do While ActiveCell.Value <> ""
   ListBox3.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox3.AddItem "No Record of Stock Item"
 End If
ListBox3.AddItem "CLOSE this box"
ComboBox1.Clear
L = 10
M = LastRowChartofAccount
ThisWorkbook.Worksheets("Chart of Account").Activate
For I = L To M
If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 5 Or Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 6 Or _
 Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 7 Or Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 9 Then
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ----"
spacing = Left(spacing, 6 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ComboBox1.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
End If
Next I
ComboBox2.Clear
L = 10
M = LastRowChartofAccount
ThisWorkbook.Worksheets("Chart of Account").Activate
For I = L To M
If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 1 Then
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ----"
spacing = Left(spacing, 6 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ComboBox2.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
End If
Next I
Label3.Caption = "Unit Price (" & SysCurrency & ") : "
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 CommandButton4.Visible = False
End If
SupplierNo = ""
PartNo = ""
AssetAcctNo = ""
ExpenseAcctNo = ""
StockNoExist = ""
StockAssetAcct = ""
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
   Application.EnableEvents = False
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
   Application.EnableEvents = True
End Sub

Attribute VB_Name = "UserForm19"
Attribute VB_Base = "0{BB64CC92-CA99-41B8-9A00-B01C7B0B7908}{27CB7318-287D-4093-BCBC-BEF4BA1E61E8}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = False
 Unload Me
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton2_Click()
Dim AddressID As String
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
 If TextBox6.Value = "" Then
   Label10.Caption = Chr(13) & "    Please enter the Address id "
   Label10.Visible = True
   Exit Sub
 End If
If TextBox1.Value = "" And TextBox2.Value = "" And TextBox3.Value = "" And TextBox4.Value = "" And TextBox5.Value = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Delivery Address and Contact detail"
 Label10.Visible = True
 Exit Sub
End If
  AddressID = TextBox6.Text
  MyBook.Worksheets("ComData").Activate
  Range("K10").Select
  If ActiveCell.Value = "" Then GoTo AddAddress
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = AddressID Then
AskReply:
    MSG = "Old Record of the same Address ID will be updated" + Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo AddAddress
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
AddAddress:
 Range(ActiveCell, ActiveCell.Offset(0, 5)).NumberFormat = "@"
 ActiveCell.Value = TextBox6.Text
 ActiveCell.Offset(0, 1).Value = TextBox1.Text
 ActiveCell.Offset(0, 2).Value = TextBox2.Text
 ActiveCell.Offset(0, 3).Value = TextBox3.Text
 ActiveCell.Offset(0, 4).Value = TextBox4.Text
 ActiveCell.Offset(0, 5).Value = TextBox5.Text
 If Range("K12").Value <> "" Then
   Range("K10").End(xlDown).Select
   I = ActiveCell.Row
   Range(Cells(11, 11), Cells(I, 16)).Select
   With Selection
     .Sort Key1:=Range("K1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 End If
  ListBox1.Clear
   Range("K10").Select
 If ActiveCell.Value <> "" Then
  ListBox1.AddItem "  " & ActiveCell.Value & " --- (Default) "
  ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Delivery Address"
 End If
 ListBox1.AddItem "CLOSE this box"
  EventOff = True
TextBox1.Text = ""
TextBox2.Text = ""
TextBox3.Text = ""
TextBox4.Text = ""
TextBox5.Text = ""
TextBox6.Text = ""
Label10.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
 EventOff = False
End Sub

Private Sub CommandButton3_Click()
Dim LastRow As Long, I As Long
Application.EnableCancelKey = xlDisabled
 EventOff = True
 ListBox1.Visible = False
If MyBook.Worksheets("ComData").Range("K10").Value = "" Then
 EventOff = False
 Exit Sub
End If
If MyBook.Worksheets("ComData").Range("K11").Value = "" Then
  If TextBox6.Value = MyBook.Worksheets("ComData").Range("K10").Value Then
    MsgBox ("WARNING" & Chr(13) & Chr(13) & "   Deletion of the only one Delivery Address is not allowed !!!")
    EventOff = False
    Exit Sub
  Else
    For I = 1 To 5
     Controls("Textbox" & I).Text = ""
    Next I
    EventOff = False
   Exit Sub
  End If
End If
AskReply:
    MSG = "The selected delivery address will be deleted from the Record." + Chr(13) + _
     Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataRemoval
     If C = "N" Or C = "n" Or C = "" Then GoTo NoDelete
    GoTo AskReply
DataRemoval:
  AddressID = TextBox6.Text
  MyBook.Worksheets("ComData").Activate
  Range("K10").End(xlDown).Select
  LastRow = ActiveCell.Row
  Range("K10").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Value = AddressID Then
    If ActiveCell.Row = LastRow Then
      Range(Cells(LastRow, 11), Cells(LastRow, 16)).ClearContents
    Else
      I = ActiveCell.Row
      Range(Cells(LastRow, 11), Cells(LastRow, 16)).Copy
      Cells(I, 11).Select
      ActiveSheet.Paste
      Range(Cells(LastRow, 11), Cells(LastRow, 16)).ClearContents
    End If
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
 If Range("K12").Value <> "" Then
   Range("K10").End(xlDown).Select
   LastRow = ActiveCell.Row
   Range(Cells(11, 11), Cells(LastRow, 16)).Select
   With Selection
     .Sort Key1:=Range("K1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 End If
  ListBox1.Clear
   Range("K10").Select
 If ActiveCell.Value <> "" Then
  ListBox1.AddItem "  " & ActiveCell.Value & " --- (Default) "
  ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Delivery Address"
 End If
 ListBox1.AddItem "CLOSE this box"
 For I = 1 To 6
  Controls("Textbox" & I).Text = ""
 Next I
Label10.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
NoDelete:
 EventOff = False
End Sub

Private Sub CommandButton4_Click()
Dim DefaultAdd As String, LastRow As Long, I As Long
Application.EnableCancelKey = xlDisabled
 EventOff = True
 ListBox1.Visible = False
DefaultAdd = TextBox6.Value
If MyBook.Worksheets("ComData").Range("K10").Value = DefaultAdd Then
  For I = 1 To 6
     Controls("Textbox" & I).Text = ""
    Next I
    EventOff = False
   Exit Sub
End If
If MyBook.Worksheets("ComData").Range("K11").Value = "" Then
  For I = 1 To 6
     Controls("Textbox" & I).Text = ""
    Next I
    EventOff = False
   Exit Sub
End If
MyBook.Worksheets("ComData").Activate
 Range("K10").End(xlDown).Select
 LastRow = ActiveCell.Row
Range("K11").Select
Do While ActiveCell.Value <> ""
 If ActiveCell.Value = DefaultAdd Then
   I = ActiveCell.Row
   Range("K10:P10").Copy
   Cells(LastRow + 1, 11).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(I, 11), Cells(I, 16)).Copy
   Range("K10").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(LastRow + 1, 11), Cells(LastRow + 1, 16)).Cut
   Cells(I, 11).Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
 End If
 ActiveCell.Offset(1, 0).Select
Loop
  If I > LastRow Then
    Label10.Caption = Chr(13) & "    The Address id is not found in the record. "
    Label10.Visible = True
    EventOff = False
    Exit Sub
  End If
 If Range("K12").Value <> "" Then
   Range("K10").End(xlDown).Select
   I = ActiveCell.Row
   Range(Cells(11, 11), Cells(I, 16)).Select
   With Selection
     .Sort Key1:=Range("K1"), Order1:=xlAscending, _
         Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   End With
 End If
  ListBox1.Clear
   Range("K10").Select
 If ActiveCell.Value <> "" Then
  ListBox1.AddItem "  " & ActiveCell.Value & " --- (Default) "
  ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Delivery Address"
 End If
 ListBox1.AddItem "CLOSE this box"
TextBox1.Text = ""
TextBox2.Text = ""
TextBox3.Text = ""
TextBox4.Text = ""
TextBox5.Text = ""
TextBox6.Text = ""
Label10.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
 EventOff = False
End Sub

Private Sub CommandButton5_Click()
ListBox1.Visible = True
Label10.Visible = False
End Sub

Private Sub CommandButton6_Click()
Dim I As Long, J As Long
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
 Application.ScreenUpdating = False
 Application.EnableEvents = False
 Application.DisplayAlerts = False
 ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
Application.EnableEvents = True
Columns("A:B").Select
With Selection
  .NumberFormat = "@"
  With .Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
   End With
End With
Columns("A").HorizontalAlignment = xlRight
Columns("B").HorizontalAlignment = xlLeft
Columns("A").ColumnWidth = 22
Columns("B").ColumnWidth = 50
If MyBook.Worksheets("ComData").Range("K10") = "" Then GoTo Finish
MyBook.Worksheets("ComData").Activate
 If Range("K11").Value = "" Then
  Range(Cells(10, 11), Cells(10, 16)).Copy
 Else
  Range("K10").End(xlDown).Select
  I = ActiveCell.Row
  Range(Cells(10, 11), Cells(I, 16)).Copy
 End If
ThisWorkbook.Worksheets("Report").Activate
Range("H1").Select
ActiveSheet.Paste
Application.CutCopyMode = False
I = 5
J = 1
 Range("H1").Select
Do While ActiveCell.Value <> ""
 Cells(I, 1).Value = " Delivery ID : "
 Cells(I, 2).Value = ActiveCell.Value
 Cells(I + 1, 1).Value = " Company Name : "
 Cells(I + 1, 2).Value = ActiveCell.Offset(0, 1).Value
 Cells(I + 2, 1).Value = " Delivery Address : "
 Cells(I + 2, 2).Value = ActiveCell.Offset(0, 2).Value
 Cells(I + 3, 2).Value = ActiveCell.Offset(0, 3).Value
 Cells(I + 4, 2).Value = ActiveCell.Offset(0, 4).Value
 Cells(I + 5, 1).Value = "Contact Person : "
 Cells(I + 5, 2).Value = ActiveCell.Offset(0, 5).Value
  Range(Cells(I + 6, 1), Cells(I + 6, 2)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
 I = I + 8
 J = J + 1
 Cells(J, 8).Select
Loop
Finish:
Range("A1:A2").HorizontalAlignment = xlLeft
Range("A1") = MyBook.Worksheets("ComData").Range("B2").Value
Range("A2") = "Delivery Addresses Listing --- Printed on " & Format(Date, "yyyy/mm/dd")
Range("A3:B3").Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
If Range("A5").Value = "" Then
  Range("B5").Value = " No Data of Delivery Address in the record"
Else
  Range("B5").Value = Range("B5").Value & " ----- (Default)"
End If
   Columns("H:AZ").ClearContents
  Range("A1:C19").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
     Range("C2").Select
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$3"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
 Label10.BackColor = &HC0&
 Label10.Visible = False
Unload Me
Application.EnableEvents = False
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
SheetName = "Report"
OldForm = "UserForm8"
ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
ThisWorkbook.Worksheets("Report").Activate
Application.EnableEvents = True
End Sub

Private Sub CommandButton7_Click()
Application.EnableCancelKey = xlDisabled
TextBox1.Text = ""
TextBox2.Text = ""
TextBox3.Text = ""
TextBox4.Text = ""
TextBox5.Text = ""
TextBox6.Text = ""
ListBox1.Visible = False
Label10.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "No Record of Delivery Address" Then
 ListBox1.Visible = False
 CommandButton2.Caption = "Add to Record"
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
EventOff = True
RowNo = ListBox1.ListIndex + 10
TextBox6.Text = MyBook.Worksheets("comData").Cells(RowNo, 11).Value
TextBox1.Text = MyBook.Worksheets("comData").Cells(RowNo, 12).Value
TextBox2.Text = MyBook.Worksheets("comData").Cells(RowNo, 13).Value
TextBox3.Text = MyBook.Worksheets("comData").Cells(RowNo, 14).Value
TextBox4.Text = MyBook.Worksheets("comData").Cells(RowNo, 15).Value
TextBox5.Text = MyBook.Worksheets("comData").Cells(RowNo, 16).Value
CommandButton2.Caption = "Update Record"
If Not (FileStatus = "AlertEnd" Or FileStatus = "ReadOnly") Then
 CommandButton3.Visible = True
 CommandButton4.Visible = True
End If
ListBox1.Visible = False
EventOff = False
End Sub

Private Sub TextBox1_Change()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox2_Change()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox3_Change()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox4_Change()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox5_Change()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox6_Change()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
CommandButton3.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim AddressID As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
 EventOff = True
If TextBox6.Text = "" Then
 For I = 1 To 5
  Controls("Textbox" & I).Text = ""
 Next I
 CommandButton2.Caption = "Add to Record"
 CommandButton3.Visible = False
 CommandButton4.Visible = False
 EventOff = False
 Exit Sub
End If
AddressID = TextBox6.Text
If Left(AddressID, 1) = " " Then
 I = Len(AddressID)
 J = 1
 Do While J <= I And Mid(AddressID, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    For I = 1 To 6
     Controls("Textbox" & I).Text = ""
    Next I
     CommandButton3.Visible = False
     CommandButton4.Visible = False
     EventOff = False
    Exit Sub
  End If
  AddressID = Right(AddressID, I - J + 1)
End If
If Right(AddressID, 1) = " " Then
 I = Len(AddressID)
 J = I
 Do While J > 0 And Mid(AddressID, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    For I = 1 To 6
     Controls("Textbox" & I).Text = ""
    Next I
     CommandButton3.Visible = False
     CommandButton4.Visible = False
     EventOff = False
    Exit Sub
  End If
  AddressID = Left(AddressID, J)
End If
AddressID = UCase(AddressID)
TextBox6.Text = AddressID
MyBook.Worksheets("ComData").Activate
Range("K10").Select
Do While ActiveCell.Value <> ""
 If ActiveCell.Value = AddressID Then
   TextBox1.Text = ActiveCell.Offset(0, 1).Value
   TextBox2.Text = ActiveCell.Offset(0, 2).Value
   TextBox3.Text = ActiveCell.Offset(0, 3).Value
   TextBox4.Text = ActiveCell.Offset(0, 4).Value
   TextBox5.Text = ActiveCell.Offset(0, 5).Value
   If Not (FileStatus = "AlertEnd" Or FileStatus = "ReadOnly") Then
    CommandButton3.Visible = True
    CommandButton4.Visible = True
   End If
   CommandButton2.Caption = "Update Record"
   EventOff = False
   Exit Sub
 End If
 ActiveCell.Offset(1, 0).Select
Loop
 CommandButton3.Visible = False
 CommandButton4.Visible = False
 CommandButton2.Caption = "Add to Record"
 EventOff = False
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
 ListBox1.Clear
  MyBook.Worksheets("COmData").Activate
  Range("K10").Select
 If ActiveCell.Value <> "" Then
  ListBox1.AddItem "  " & ActiveCell.Value & " --- (Default) "
  ActiveCell.Offset(1, 0).Select
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Delivery Address"
 End If
 ListBox1.AddItem "CLOSE this box"
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  CommandButton2.Visible = False
  CommandButton3.Visible = False
  CommandButton4.Visible = False
  CommandButton7.Visible = False
End If
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub

Attribute VB_Name = "UserForm2"
Attribute VB_Base = "0{D690EF64-1F49-4933-A88B-477B20265FAE}{4188FDB8-5502-4888-B062-BA44A3F1476F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public NewName As String
Private Sub Combobox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
Worksheets("NewCom").Range("A2").Value = ""
If ComboBox1.ListIndex < 0 Or ComboBox1.ListIndex > 11 Then
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
Label8.Caption = Chr(13) & "                   Incorrect Year End Month"
Label8.Visible = True
Worksheets("NewCom").Range("A2").Value = "Error"
Else
Label8.BackColor = &H4000&
Label8.ForeColor = &HFFFF&
Label8.Visible = False
End If
Application.EnableEvents = True
End Sub
Private Sub ComboBox2_Enter()
Label13.Visible = True
End Sub
Private Sub ComboBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CurCode As String, I As Long, J As Long, FinalCode As String
Application.EnableCancelKey = xlDisabled
If ComboBox2.Value = "" Then GoTo Finish
 CurCode = UCase(ComboBox2.Value)
If Left(CurCode, 1) = " " Then
 I = Len(CurCode)
 J = 1
 Do While J <= I And Mid(CurCode, J, 1) = " "
  J = J + 1
 Loop
  CurCode = Right(CurCode, I - J + 1)
End If
If Right(CurCode, 1) = " " Then
 I = Len(CurCode)
 J = I
 Do While J > 0 And Mid(CurCode, J, 1) = " "
  J = J - 1
 Loop
  CurCode = Left(CurCode, J)
End If
If Len(CurCode) <> 3 Then
 ComboBox2.Value = CurCode
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = Chr(13) & "   Incorrect Currency Code, It should be made up with 3 Alphabets"
 Label8.Visible = True
Else
 FinalCode = ""
 For I = 1 To 3
  If Asc(Mid(CurCode, I, 1)) >= 65 And Asc(Mid(CurCode, I, 1)) <= 90 Then
    FinalCode = FinalCode + Mid(CurCode, I, 1)
  End If
 Next I
 ComboBox2.Value = FinalCode
 If Len(FinalCode) <> 3 Then
  Label8.BackColor = &HC0&
  Label8.ForeColor = &HFFFF&
  Label8.Caption = Chr(13) & "   Incorrect Currency Code, It should be made up with 3 Alphabets"
  Label8.Visible = True
 Else
  Label8.BackColor = &H4000&
  Label8.ForeColor = &HFFFF&
  Label8.Visible = False
 End If
End If
Finish:
Label13.Visible = False
End Sub
Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim myFSO As Object, DataFilePath As String, FilePathSub As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
EventOff = True
Label8.Visible = False
Worksheets("NewCom").Range("A2").Value = ""
If TextBox5.Text <> "" And Right(TextBox5.Text, 1) <> "\" Then TextBox5.Text = TextBox5.Text & "\"
DataFilePath = TextBox5.Text
    I = Len(DataFilePath)
    J = 3
    Do While J < I
    If Mid(DataFilePath, J, 1) = ":" Then
       DataFilePath = Left(DataFilePath, J - 1) & Right(DataFilePath, I - J)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
    J = 3
    Do While J < I
     If Mid(DataFilePath, J, 2) = "\\" Then
       DataFilePath = Left(DataFilePath, J) & Right(DataFilePath, I - J - 1)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
On Error GoTo WrongPath
 Set myFSO = CreateObject("Scripting.FileSystemObject")
  If myFSO.FolderExists(DataFilePath) = False Then
    I = Len(DataFilePath)
    If I > 2 Then
     For J = 3 To I
      If Mid(DataFilePath, J, 1) = "\" Then
       FilePathSub = Left(DataFilePath, J)
       If myFSO.FolderExists(FilePathSub) = False Then
        myFSO.CreateFolder (FilePathSub)
       End If
      End If
     Next J
    Else
     GoTo WrongPath
    End If
   End If
On Error GoTo 0
TextBox5.Text = DataFilePath
EventOff = False
 Exit Sub
WrongPath:
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
Label8.Caption = Chr(13) & "   Incorrect Data File Path, Please correct it before proceed"
Label8.Visible = True
Worksheets("NewCom").Range("A2").Value = "Error"
EventOff = False
End Sub
Private Sub TextBox6_Change()
Dim I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
For I = 1 To Len(TextBox6.Text)
 If Abs(Asc(Mid(TextBox6.Text, I, 1))) > 255 Then GoTo Nocheck
 If Asc(Mid(TextBox6.Text, I, 1)) < 45 Or Asc(Mid(TextBox6.Text, I, 1)) > 122 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 90 And Asc(Mid(TextBox6.Text, I, 1)) < 95 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 95 And Asc(Mid(TextBox6.Text, I, 1)) < 97 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 57 And Asc(Mid(TextBox6.Text, I, 1)) < 65 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 45 And Asc(Mid(TextBox6.Text, I, 1)) < 48 Then GoTo WrongInput
Nocheck:
Next I
Label8.Caption = Chr(13) & "   Data File Name Prefix is recommended to contain 4 to 6 characters"
Label8.BackColor = &H4000&
Label8.ForeColor = &HFFFF&
Label8.Visible = True
Exit Sub
WrongInput:
Label8.Caption = Chr(13) & "   Wrong Data File name. No symbol is allowed except '-' and '_'"
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
End Sub
Private Sub TextBox6_Enter()
Application.EnableCancelKey = xlDisabled
If Label8.BackColor = &HC0& And Label8.Visible = True Then Exit Sub
Label8.Caption = Chr(13) & "   Data File Name Prefix is recommended to contain 4 to 6 characters"
Label8.BackColor = &H4000&
Label8.ForeColor = &HFFFF&
Label8.Visible = True
End Sub
Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim FileNamePrefix As String, I As Long
Application.EnableCancelKey = xlDisabled
Worksheets("NewCom").Range("A2").Value = ""
FileNamePrefix = UCase(TextBox6.Text)
Worksheets("ComFactSheet").Activate
Range("B21").Select
Do While ActiveCell.Value <> ""
 I = Len(ActiveCell.Value) - 5
 If UCase(Left(ActiveCell.Value, I)) = FileNamePrefix Then
   Label8.BackColor = &HC0&
   Label8.ForeColor = &HFFFF&
   Label8.Caption = Chr(13) & "   The Data file name is in duplicate with an existing file"
   Label8.Visible = True
   Worksheets("NewCom").Range("A2").Value = "Error"
   Exit Do
 End If
 ActiveCell.Offset(1, 0).Select
Loop
 NewName = TextBox6.Text
End Sub
Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
EventOff = True
ComboBox1.Clear
ComboBox1.AddItem "1"
ComboBox1.AddItem "2"
ComboBox1.AddItem "3"
ComboBox1.AddItem "4"
ComboBox1.AddItem "5"
ComboBox1.AddItem "6"
ComboBox1.AddItem "7"
ComboBox1.AddItem "8"
ComboBox1.AddItem "9"
ComboBox1.AddItem "10"
ComboBox1.AddItem "11"
ComboBox1.AddItem "12"
ComboBox1.Value = "3"
ComboBox2.Clear
ThisWorkbook.Worksheets("ComFactSheet").Activate
Range("F1").Select
Do While ActiveCell.Value <> ""
ComboBox2.AddItem ActiveCell.Value
ActiveCell.Offset(1, 0).Select
Loop
ComboBox2.Value = "HKD"
TextBox1.Text = "Mark-Motum Co. Ltd"
TextBox2.Text = "Flat F, 30/F., Florence Plaza"
TextBox3.Text = "23 Cheung Wah Street"
TextBox4.Text = "Cheung Sha Wan, Kowloon, HK"
Label9.Caption = "Two Steps to add a new Company : " & Chr(13) & Chr(13) & " Step 1 --- " & "Enter Company Information" & Chr(13) & Chr(13) & _
" Step 2 --- " & "Create Chart of Account" & Chr(13) & "                and setup Opening Balance"
Label8.Caption = Chr(13) & "   Data File Name Prefix is recommended to contain 4 to 6 characters"
 If UCase(Right(ThisWorkbook.Name, 4)) = "XLSM" And Val(Application.Version) >= 12 Then
   Label11.Caption = " -" & "yyyy.xlsm"
 Else
   Label11.Caption = " -" & "yyyy.xls"
 End If
TextBox5.Text = ThisWorkbook.Path & "\"
TextBox6.Text = "MARK"
NewName = "MARK"
EventOff = False
End Sub
Private Sub CommandButton1_Click()
Dim FileNamePrefix As String, I As Long
Dim myFSO As Object, DataFilePath As String, FilePathSub As String, J As Long
 Application.EnableCancelKey = xlDisabled
 If Worksheets("NewCom").Range("A2").Value = "Error" Then
  Worksheets("NewCom").Range("A2").Value = ""
  Exit Sub
 End If
If TextBox5.Text = "" Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = Chr(13) & "                  Please enter the Data File Path"
 Label8.Visible = True
 Worksheets("NewCom").Range("A2").Value = "Error"
 TextBox5.SetFocus
  Exit Sub
End If
If TextBox6.Text = "" Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = Chr(13) & "                  Please enter the Data File Name"
 Label8.Visible = True
 Worksheets("NewCom").Range("A2").Value = "Error"
 TextBox6.SetFocus
  Exit Sub
End If
If ComboBox1.ListIndex < 0 Or ComboBox1.ListIndex > 11 Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = Chr(13) & "                  Incorrect Year End Month"
 Label8.Visible = True
 Worksheets("NewCom").Range("A2").Value = "Error"
 With ComboBox1
.SetFocus
.SelStart = 0
.SelLength = Len(ComboBox1.Value)
End With
  Exit Sub
End If
If ComboBox2.Value = "" Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = Chr(13) & "                  Please enter the currency code"
 Label8.Visible = True
 ComboBox2.SetFocus
  Exit Sub
ElseIf Len(ComboBox2.Value) <> 3 Then
  Label8.BackColor = &HC0&
  Label8.ForeColor = &HFFFF&
  Label8.Caption = Chr(13) & "      Incorrect Currency Code.  It should be made up with 3 Alphabets"
  Label8.Visible = True
  ComboBox2.SetFocus
  Exit Sub
End If
If Right(TextBox5.Text, 1) <> "\" Then TextBox5.Text = TextBox5.Text & "\"
DataFilePath = TextBox5.Text

    I = Len(DataFilePath)
    J = 3
    Do While J < I
    If Mid(DataFilePath, J, 1) = ":" Then
       DataFilePath = Left(DataFilePath, J - 1) & Right(DataFilePath, I - J)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
    J = 3
    Do While J < I
     If Mid(DataFilePath, J, 2) = "\\" Then
       DataFilePath = Left(DataFilePath, J) & Right(DataFilePath, I - J - 1)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
On Error GoTo WrongPath
 Set myFSO = CreateObject("Scripting.FileSystemObject")
  If myFSO.FolderExists(DataFilePath) = False Then
    I = Len(DataFilePath)
    If I > 2 Then
     For J = 3 To I
      If Mid(DataFilePath, J, 1) = "\" Then
       FilePathSub = Left(DataFilePath, J)
       If myFSO.FolderExists(FilePathSub) = False Then
        myFSO.CreateFolder (FilePathSub)
       End If
      End If
     Next J
    Else
     GoTo WrongPath
    End If
   End If
On Error GoTo 0
TextBox5.Text = DataFilePath
For I = 1 To Len(TextBox6.Text)
 If Abs(Asc(Mid(TextBox6.Text, I, 1))) > 255 Then GoTo Nocheck
 If Asc(Mid(TextBox6.Text, I, 1)) < 45 Or Asc(Mid(TextBox6.Text, I, 1)) > 122 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 90 And Asc(Mid(TextBox6.Text, I, 1)) < 95 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 95 And Asc(Mid(TextBox6.Text, I, 1)) < 97 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 57 And Asc(Mid(TextBox6.Text, I, 1)) < 65 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 45 And Asc(Mid(TextBox6.Text, I, 1)) < 48 Then GoTo WrongInput
Nocheck:
Next I
FileNamePrefix = UCase(TextBox6.Text)
Worksheets("ComFactSheet").Activate
Range("B21").Select
Do While ActiveCell.Value <> ""
 I = Len(ActiveCell.Value) - 5
 If UCase(Left(ActiveCell.Value, I)) = FileNamePrefix Then
   Label8.BackColor = &HC0&
   Label8.ForeColor = &HFFFF&
   Label8.Caption = Chr(13) & "   The Data file name is in duplicate with an existing file"
   Label8.Visible = True
   Worksheets("NewCom").Range("A2").Value = "Error"
   With TextBox6
    .SetFocus
    .SelStart = 0
    .SelLength = Len(TextBox6.Text)
   End With
   Exit Sub
 End If
 ActiveCell.Offset(1, 0).Select
Loop
Worksheets("NewCom").Activate
Range("B1:C7").ClearContents
Range("B1:B5").NumberFormat = "@"
Range("B7").NumberFormat = "@"
Range("B1").Value = TextBox5.Text
Range("B2").Value = TextBox1.Text
Range("B3").Value = TextBox2.Text
Range("B4").Value = TextBox3.Text
Range("B5").Value = TextBox4.Text
Range("B6").Value = ComboBox1.ListIndex + 1
Range("C6").Value = ComboBox2.Value
Range("B7").Value = TextBox6.Text
Range("A1").Value = "New"
Unload Me
 ThisWorkbook.Activate
 Application.EnableEvents = True
 Worksheets("IniData").Visible = xlSheetVisible
 Worksheets("System Menu").Visible = xlSheetVeryHidden
 Worksheets("IniData").Activate
  SheetName = "IniData"
 Worksheets("IniData").CommandButton3.Visible = True
 Application.ScreenUpdating = True
 Exit Sub
WrongPath:
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
Label8.Caption = Chr(13) & "   Incorrect Data File Path, Please correct it before proceed"
Label8.Visible = True
Worksheets("NewCom").Range("A2").Value = "Error"
With TextBox5
.SetFocus
.SelStart = 0
.SelLength = Len(TextBox5.Text)
End With
Exit Sub
WrongInput:
Label8.Caption = Chr(13) & "   Wrong Data File name. No symbol is allowed except '-' and '_'"
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
With TextBox6
.SetFocus
.SelStart = 0
.SelLength = Len(TextBox6.Text)
End With
End Sub
Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
EventOff = False
Worksheets("NewCom").Range("A2").Value = ""
Unload Me
Call ReturnToMainMenu("")
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub
Attribute VB_Name = "UserForm20"
Attribute VB_Base = "0{66E58AA6-4E3D-48F9-8563-AD3E51190A17}{ED6AB6F5-864D-4742-A49C-324AA3F0BB93}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public PayRef As String

Private Sub CommandButton1_Click()
 ListBox1.Visible = True
 ListBox2.Visible = False
 ListBox4.Visible = False
End Sub

Private Sub CommandButton10_Click()
Dim BankName As String, I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox4.Visible = False
If TextBox12.Text = "" Then Exit Sub
 BankName = TextBox12.Text
 MyBook.Worksheets("ComData").Activate
 Range("J11").Select
 Do While ActiveCell.Value <> ""
  If BankName = ActiveCell.Value Then
    I = ActiveCell.Row
    Range(Cells(I + 1, 10), Cells(30, 10)).Cut
    Cells(I, 10).Select
    ActiveSheet.Paste
    GoTo AddName
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 Exit Sub
AddName:
  EventOff = True
  MyBook.Worksheets("ComData").Activate
  Range("J11").Select
    ListBox4.Clear
   MyBook.Worksheets("ComData").Activate
   If Range("J11") <> "" Then
    Do While ActiveCell.Value <> ""
     ListBox4.AddItem "  " & ActiveCell.Value
     ActiveCell.Offset(1, 0).Select
    Loop
   Else
    ListBox4.AddItem "No Record of Bank Names"
   End If
   ListBox4.AddItem "CLOSE this box"
    EventOff = False
End Sub

Private Sub CommandButton2_Click()
Dim TotalSum As Double, FInvRow As Long, LInvRow As Long, NewBalance As Double, PayDate As Date, PayAmount As Double
Dim ColNo As Long, AcctYear As Long, JournalCode As String, PayTotal As Double, P As Long, SettleDate As Date
Dim CheckRange As Range, POFRow As Long, FRow As Long, CQNo As String, DelNo As Long, POStyle As String
Application.EnableCancelKey = xlDisabled
  ListBox1.Visible = False
  ListBox2.Visible = False
  ListBox4.Visible = False
If SupplierNo = "" Then Exit Sub
If TextBox2.Text = "" Then
 Label39.Caption = Chr(13) & "    Please enter the Payment date"
 Label39.Visible = True
 Exit Sub
End If
PayDate = TextBox2.Text
If TextBox3.Text = "" Then
 PayTotal = 0
Else
 PayTotal = TextBox3.Value
End If
CQNo = ""
If OptionButton1.Value = True Then
 If TextBox9.Text = "" Then
  Label39.Caption = Chr(13) & "    Please enter the Cheque number"
  Label39.Visible = True
  Exit Sub
 End If
 If IsDate(TextBox11.Text) = False And TextBox11.Text <> "" Then
  Label39.Caption = Chr(13) & "    Please enter the Date of the Cheque"
  Label39.Visible = True
  Exit Sub
 End If
 CQNo = "#" & TextBox9.Text & ", "
End If
If PayDate < BeginningDate Then
 If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
 MSG = "The date entered belongs to the previous Posted year" & Chr(13) & _
    "The system will not post this entry to the General Ledger." & Chr(13) & Chr(13) _
     + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
   Title = "WARNING"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DateProceed
    If C = "N" Or C = "n" Or C = "" Then
     Label39.Caption = Chr(13) & "    Please enter a new Payment Date and then click 'Save' Button again. "
     Label39.Visible = True
     Exit Sub
    End If
    GoTo AskReply
 Else
     Label39.Caption = "    Transaction with date belonging to previous Posted year is not allowed" & _
     Chr(13) & "    Please enter a new Payment Date and then click 'Save' Button to proceed. "
     Label39.Visible = True
     Exit Sub
 End If
End If
DateProceed:
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("B6").Select
 TotalSum = 0
 P = 0
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 6).Value <> "" Then P = 1
  TotalSum = TotalSum + ActiveCell.Offset(0, 6).Value
  ActiveCell.Offset(1, 0).Select
 Loop
  TotalSum = Format(TotalSum, "0.00")
  If P = 0 Then
   Label39.Caption = Chr(13) & "    No Payment applied to any of the POs or debit notes"
   Label39.Visible = True
   Exit Sub
  End If
  Label36.Caption = Format(TotalSum, "#,##0.00")
  Label41.Caption = Format((PayTotal - TotalSum), "#,##0.00")
  If Abs(TotalSum - PayTotal) > 0.001 Then
   Label39.Caption = Chr(13) & "    The Payment amount does not balance with the Sum of Applied Amount"
   Label39.Visible = True
   Exit Sub
  End If
 If Abs(PayTotal) > 0.001 And OptionButton1.Value = False And OptionButton2.Value = False Then
   Label39.Caption = Chr(13) & "    Please select the payment method ( Cheque or Cash)"
   Label39.Visible = True
   Exit Sub
  End If
MyBook.Worksheets("Payable").Activate
If Range("B4").Value <> "" Then
 ActiveSheet.UsedRange.Select
 Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("B6").Select
 
 
 
Do While ActiveCell.Value <> ""
 If Not (ActiveCell.Offset(0, 6).Value = "" Or ActiveCell.Offset(0, 6).Value = 0) Then
   PONo = ActiveCell.Value
   POStyle = ActiveCell.Offset(0, -1).Value
   DelNo = ActiveCell.Offset(0, 1).Value
   PayAmount = Format(ActiveCell.Offset(0, 6).Value, "0.00")
   NewBalance = Format(ActiveCell.Offset(0, 5).Value - PayAmount, "0.00")
   MyBook.Worksheets("Payable").Activate
   Set CheckRange = MyBook.Worksheets("Payable").UsedRange.Offset(3, 0).Columns("B")
    FInvRow = Application.Match(PONo, CheckRange, 0) + 3
    LInvRow = Application.Match(PONo, CheckRange, 1) + 3
    FRow = FInvRow
    
  If FInvRow <> LInvRow Then
    Set CheckRange = CheckRange.Offset(FInvRow - 4, 1).Resize(LInvRow - FInvRow + 1, 1)
   If IsError(Application.Match(DelNo, CheckRange, 0)) = False Then FInvRow = Application.Match(DelNo, CheckRange, 0) + FInvRow - 1
  End If
   Cells(FInvRow, 11).Value = Format(NewBalance, "0.00")
   If Abs(NewBalance) < 0.0001 Then
      Cells(FInvRow, 22).Value = "R"
      If POStyle <> "PO" Then
        Cells(FInvRow, 10).Value = "S"
        Cells(FInvRow, 13).NumberFormat = "yyyy/mm/dd"
        Cells(FInvRow, 13).Value = PayDate
      Else
        Cells(FInvRow, 10).Value = "R"
        Cells(FInvRow, 13).ClearContents
      End If
   Else
     Cells(FInvRow, 22).Value = "P"
     Cells(FInvRow, 10).Value = "P"
     Cells(FInvRow, 13).ClearContents
   End If
   If Cells(FInvRow, 166).Value = "" Then
      Cells(FInvRow, 166).NumberFormat = "yyyy/mm/dd"
      Cells(FInvRow, 166).Value = PayDate
      Cells(FInvRow, 167).NumberFormat = "General"
      Cells(FInvRow, 167).Value = PayAmount
     Cells(FInvRow, 168).Value = "B" & PayRef
   Else
     ColNo = Cells(FInvRow, 166).End(xlToRight).Column + 1
    If ColNo < 254 Then
      Cells(FInvRow, ColNo).NumberFormat = "yyyy/mm/dd"
      Cells(FInvRow, ColNo).Value = PayDate
      Cells(FInvRow, ColNo + 1).NumberFormat = "General"
      Cells(FInvRow, ColNo + 1).Value = PayAmount
      Cells(FInvRow, ColNo + 2).Value = "B" & PayRef
    Else
      Range(Cells(FInvRow, 166), Cells(FInvRow, 168)).NumberFormat = "General"
      Cells(FInvRow, 166).Value = " Up to " & Format(Cells(FInvRow, 169).Value, "yyyy/mm/dd")
      Cells(FInvRow, 167).Value = Cells(FInvRow, 170).Value + Cells(FInvRow, 167).Value
      Cells(FInvRow, 168).Value = Cells(FInvRow, 168).Value & " ; " & Cells(FInvRow, 171).Value
      Range(Cells(FInvRow, 172), Cells(FInvRow, 255)).Copy
      Cells(FInvRow, 169).Select
      ActiveSheet.Paste
      Application.CutCopyMode = False
      Cells(FInvRow, 253).NumberFormat = "yyyy/mm/dd"
      Cells(FInvRow, 253).Value = PayDate
      Cells(FInvRow, 254).NumberFormat = "General"
      Cells(FInvRow, 254).Value = PayAmount
      Cells(FInvRow, 255).Value = "B" & PayRef
    End If
   End If
   MyBook.Worksheets("PORecord").Activate
  If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = False Then
    POFRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
    Cells(POFRow, 11).NumberFormat = "General"
    Cells(POFRow, 11).Value = Format((Cells(POFRow, 11).Value - PayAmount), "0.00")
    If POStyle = "PO" Then
     If (Cells(POFRow, 10).Value = "S" Or Cells(POFRow, 10).Value = "R") Then
      Cells(POFRow, 10).Value = "R"
      Cells(POFRow, 13).ClearContents
      InvStatus = "R"
     Else
      Cells(POFRow, 10).Value = "P"
      Cells(POFRow, 13).ClearContents
      InvStatus = "P"
     End If
    Else
      Cells(POFRow, 10).Value = "P"
      Cells(POFRow, 13).ClearContents
      InvStatus = "P"
    End If
   If Abs(Cells(POFRow, 11).Value) < 0.0001 Then
    If POStyle <> "PO" Then
     Cells(POFRow, 10).Value = "S"
     Cells(POFRow, 13).NumberFormat = "yyyy/mm/dd"
     Cells(POFRow, 13).Value = PayDate
     MyBook.Worksheets("Payable").Activate
     Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "S"
     Range(Cells(FRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
     Range(Cells(FRow, 13), Cells(LInvRow, 13)).Value = PayDate
    ElseIf Cells(POFRow, 10).Value = "R" Then
     MyBook.Worksheets("Payable").Activate
     Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "R"
     Range(Cells(FRow, 13), Cells(LInvRow, 13)).ClearContents
     I = FRow
     Do While I <= LInvRow
      If Cells(I, 11).Value <> 0 Then GoTo ContSave
      I = I + 1
     Loop
     Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "S"
     Range(Cells(FRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
     Range(Cells(FRow, 13), Cells(LInvRow, 13)).Value = PayDate
     MyBook.Worksheets("PORecord").Activate
     Cells(POFRow, 10).Value = "S"
     Cells(POFRow, 13).NumberFormat = "yyyy/mm/dd"
     Cells(POFRow, 13).Value = PayDate
    Else
     MyBook.Worksheets("Payable").Activate
     Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "P"
     Range(Cells(FRow, 13), Cells(LInvRow, 13)).ClearContents
    End If
   Else
     MyBook.Worksheets("Payable").Activate
     Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = InvStatus
   End If
  End If
 ElseIf ActiveCell.Offset(0, 6).Value = 0 And ActiveCell.Offset(0, 6).Value <> "" Then
  If ActiveCell.Offset(0, 5).Value = 0 Then
   PONo = ActiveCell.Value
   POStyle = ActiveCell.Offset(0, -1).Value
   DelNo = ActiveCell.Offset(0, 1).Value
    MyBook.Worksheets("Payable").Activate
   Set CheckRange = MyBook.Worksheets("Payable").UsedRange.Offset(3, 0).Columns("B")
    FInvRow = Application.Match(PONo, CheckRange, 0) + 3
    LInvRow = Application.Match(PONo, CheckRange, 1) + 3
    FRow = FInvRow
   If FInvRow <> LInvRow Then
    Set CheckRange = CheckRange.Offset(FInvRow - 4, 1).Resize(LInvRow - FInvRow + 1, 1)
    If IsError(Application.Match(DelNo, CheckRange, 0)) = False Then FInvRow = Application.Match(DelNo, CheckRange, 0) + FInvRow - 1
   End If
      Cells(FInvRow, 22).Value = "R"
      If POStyle <> "PO" Then
        Cells(FInvRow, 10).Value = "S"
        Cells(FInvRow, 13).NumberFormat = "yyyy/mm/dd"
        Cells(FInvRow, 13).Value = PayDate
      Else
        Cells(FInvRow, 10).Value = "R"
        Cells(FInvRow, 13).ClearContents
      End If
    MyBook.Worksheets("PORecord").Activate
   If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) = False Then
    POFRow = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
    If IsDate(Cells(POFRow, 13).Value) = True Then
      SettleDate = Cells(POFRow, 13).Value
    Else
      SettleDate = PayDate
    End If
    If POStyle = "PO" Then
     If (Cells(POFRow, 10).Value = "S" Or Cells(POFRow, 10).Value = "R") Then
      Cells(POFRow, 10).Value = "R"
      Cells(POFRow, 13).ClearContents
      InvStatus = "R"
     Else
      Cells(POFRow, 10).Value = "P"
      Cells(POFRow, 13).ClearContents
      InvStatus = "P"
     End If
    Else
      Cells(POFRow, 10).Value = "P"
      Cells(POFRow, 13).ClearContents
      InvStatus = "P"
    End If
    If Abs(Cells(POFRow, 11).Value) < 0.0001 Then
     If POStyle <> "PO" Then
      Cells(POFRow, 10).Value = "S"
      Cells(POFRow, 13).NumberFormat = "yyyy/mm/dd"
      Cells(POFRow, 13).Value = SettleDate
      MyBook.Worksheets("Payable").Activate
      Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "S"
      Range(Cells(FRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
      Range(Cells(FRow, 13), Cells(LInvRow, 13)).Value = SettleDate
     ElseIf Cells(POFRow, 10).Value = "R" Then
      MyBook.Worksheets("Payable").Activate
      Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "R"
      Range(Cells(FRow, 13), Cells(LInvRow, 13)).ClearContents
      I = FRow
      Do While I <= LInvRow
      If Cells(I, 11).Value <> 0 Then GoTo ContSave
       I = I + 1
      Loop
      Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "S"
      Range(Cells(FRow, 13), Cells(LInvRow, 13)).NumberFormat = "yyyy/mm/dd"
      Range(Cells(FRow, 13), Cells(LInvRow, 13)).Value = SettleDate
      MyBook.Worksheets("PORecord").Activate
      Cells(POFRow, 10).Value = "S"
      Cells(POFRow, 13).NumberFormat = "yyyy/mm/dd"
      Cells(POFRow, 13).Value = SettleDate
     Else
      MyBook.Worksheets("Payable").Activate
      Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = "P"
      Range(Cells(FRow, 13), Cells(LInvRow, 13)).ClearContents
     End If
    Else
     MyBook.Worksheets("Payable").Activate
     Range(Cells(FRow, 10), Cells(LInvRow, 10)).Value = InvStatus
    End If
   End If
  End If
 End If
ContSave:
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveCell.Offset(1, 0).Select
Loop




If PayDate < BeginningDate Then GoTo RawDataUpdateComplete
If OptionButton3.Value <> "True" Or TotalSum <> 0 Then
  Range("D1:D2").NumberFormat = "yyyy/mm/dd"
  Range("D1:D2").Value = PayDate
  Range("E1:E2").NumberFormat = "General"
  Range("H1:I2").NumberFormat = "General"
  Range("E1").Value = CreditorAcct
  If TotalSum >= 0 Then
    Range("H1").Value = Format(TotalSum, "0.00")
    Range("I2").Value = Format(TotalSum, "0.00")
    Range("G1:G2").Value = CQNo & "Ref B" & PayRef & " Paid to " & Range("I6").Value
  Else
    Range("I1").Value = Format(TotalSum * (-1), "0.00")
    Range("H2").Value = Format(TotalSum * (-1), "0.00")
    Range("G1:G2").Value = CQNo & "Ref B" & PayRef & " Paid by " & Range("I6").Value
  End If
  Range("E2").Value = BankAcct
  Range("F1:F2").NumberFormat = "General"
  Range("F1:F2").FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
  Range("F1:F2").NumberFormat = "@"
  Range("F1:F2").Copy
  Range("F1:F2").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  Range("J1:J2").Value = "B" & PayRef
  AcctYear = Int((Period(PayDate) - Period(MyBook.Worksheets("Raw Data").Range("A1").Value)) / 12)
  AcctYear = AcctYear + Year(MyBook.Worksheets("Raw Data").Range("A1").Value)
  JournalCode = "PV" & AcctYear
  MyBook.Worksheets("ComData").Activate
  Range("G250").Select
  JcodeRow = 251
  Set JournalRange = Range("G250")
  If ActiveCell.Offset(1, 0).Value <> "" Then
   Range("G250").End(xlDown).Select
   JcodeRow = ActiveCell.Row + 1
  End If
   Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
    LastTranNo = "00001"
    Range(Cells(JcodeRow, 7), Cells(JcodeRow, 8)).NumberFormat = "@"
    Cells(JcodeRow, 7).Value = JournalCode
    Cells(JcodeRow, 8).Value = LastTranNo
  Else
   JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
   LastTranNo = Cells(JcodeRow, 8).Value
   LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
   Cells(JcodeRow, 8).NumberFormat = "@"
   Cells(JcodeRow, 8).Value = LastTranNo
  End If
  LastJournalCode = JournalCode
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("A1:B2").NumberFormat = "@"
  Range("A1:A2").Value = JournalCode
  Range("B1:B2").Value = LastTranNo
  MyBook.Worksheets("Raw Data").Activate
  Range("A2").End(xlDown).Select
  ActiveCell.Offset(1, 0).Select
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("A1:J2").Copy
  MyBook.Worksheets("Raw Data").Activate
  ActiveSheet.Paste
  P = Period(PayDate) - Period(BeginningDate) + 1
  MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
End If
RawDataUpdateComplete:
 MyBook.Worksheets("PayMake").Activate
 Range("A1").End(xlDown).Select
 ActiveCell.Offset(1, 0).Select
 RecRowA = ActiveCell.Row
 RecRowB = RecRowA
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("B6").Select
 Do While ActiveCell.Value <> ""
  If Not (ActiveCell.Offset(0, 6).Value = "" Or ActiveCell.Offset(0, 6).Value = 0) Then
    MyBook.Worksheets("PayMake").Cells(RecRowB, 11).NumberFormat = "@"
    MyBook.Worksheets("PayMake").Cells(RecRowB, 11).Value = ActiveCell.Value
    MyBook.Worksheets("PayMake").Cells(RecRowB, 12).NumberFormat = "General"
    MyBook.Worksheets("PayMake").Cells(RecRowB, 12).Value = ActiveCell.Offset(0, 1).Value
    MyBook.Worksheets("PayMake").Cells(RecRowB, 13).NumberFormat = "@"
    MyBook.Worksheets("PayMake").Cells(RecRowB, 13).Value = ActiveCell.Offset(0, 3).Value
     MyBook.Worksheets("PayMake").Cells(RecRowB, 14).NumberFormat = "General"
    MyBook.Worksheets("PayMake").Cells(RecRowB, 14).Value = ActiveCell.Offset(0, 6).Value
    MyBook.Worksheets("PayMake").Cells(RecRowB, 15).NumberFormat = "yyyy/mm/dd"
    MyBook.Worksheets("PayMake").Cells(RecRowB, 15).Value = ActiveCell.Offset(0, 2).Value
    MyBook.Worksheets("PayMake").Cells(RecRowB, 16).NumberFormat = "@"
    If ActiveCell.Offset(0, 2).Value > PayDate Then
      MyBook.Worksheets("PayMake").Cells(RecRowB, 16).Value = "**"
    Else
      MyBook.Worksheets("PayMake").Cells(RecRowB, 16).ClearContents
    End If
    RecRowB = RecRowB + 1
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
  RecRowB = RecRowB - 1
If RecRowB >= RecRowA Then
  MyBook.Worksheets("PayMake").Activate
  Range(Cells(RecRowA, 1), Cells(RecRowB, 1)).Value = Label54.Caption
  Range(Cells(RecRowA, 2), Cells(RecRowB, 2)).NumberFormat = "yyyy/mm/dd"
  Range(Cells(RecRowA, 2), Cells(RecRowB, 2)).Value = PayDate
  Range(Cells(RecRowA, 3), Cells(RecRowB, 3)).NumberFormat = "@"
  Range(Cells(RecRowA, 3), Cells(RecRowB, 3)).Value = SupplierNo
  Range(Cells(RecRowA, 4), Cells(RecRowB, 4)).Value = Label2.Caption
  Range(Cells(RecRowA, 5), Cells(RecRowB, 5)).NumberFormat = "General"
  Range(Cells(RecRowA, 5), Cells(RecRowB, 5)).Value = PayTotal
 If OptionButton3.Value = "True" Then
  Range(Cells(RecRowA, 6), Cells(RecRowB, 6)).Value = "Debit Note"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 7)).Value = "N/A"
  Range(Cells(RecRowA, 8), Cells(RecRowB, 8)).Value = "N/A"
  Range(Cells(RecRowA, 9), Cells(RecRowB, 9)).Value = "N/A"
  Range(Cells(RecRowA, 10), Cells(RecRowB, 10)).Value = "N/A"
 ElseIf OptionButton2.Value = "True" Then
  Range(Cells(RecRowA, 6), Cells(RecRowB, 6)).Value = "Cash"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 7)).Value = "N/A"
  Range(Cells(RecRowA, 8), Cells(RecRowB, 8)).Value = "N/A"
  Range(Cells(RecRowA, 9), Cells(RecRowB, 9)).Value = "N/A"
  Range(Cells(RecRowA, 10), Cells(RecRowB, 10)).Value = "N/A"
 Else
  Range(Cells(RecRowA, 6), Cells(RecRowB, 6)).Value = "Cheque"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 10)).NumberFormat = "@"
  Range(Cells(RecRowA, 7), Cells(RecRowB, 7)).Value = TextBox9.Text
  Range(Cells(RecRowA, 9), Cells(RecRowB, 9)).Value = TextBox11.Text
  Range(Cells(RecRowA, 10), Cells(RecRowB, 10)).Value = TextBox12.Text
 End If
  Range("B1").Value = PayRef
  PayRef = Right(("00000" & Val(MyBook.Worksheets("PayMake").Range("B1").Value) + 1), 5)
End If
ThisWorkbook.Worksheets("TempRP").Activate
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
ScrollBar1.Max = 1
ScrollBar1.Min = 1
ScrollBar1.Value = 1
ScrollBar1.Visible = False
OptionButton1.Value = True
OptionButton3.Visible = True
CommandButton2.Visible = True
For I = 1 To 3
 Controls("TextBox" & I).Text = ""
Next I
For I = 4 To 8
 Controls("TextBox" & I).Text = ""
 Controls("TextBox" & I).Visible = False
Next I
CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date"
 For I = 13 To 22
  Controls("TextBox" & I).Text = ""
  If Controls("Textbox" & I).TabStop = True Then Controls("Textbox" & I).TabStop = False
  Next I
For I = 9 To 12
 Controls("TextBox" & I).Text = ""
Next I
 Label2.Caption = ""
For I = 11 To 35
 Controls("Label" & I).Caption = ""
Next I
For I = 1 To 5
 Controls("Label" & I * 5 + 6).Caption = I
Next I
Label54.Caption = "B" & PayRef
Label36.Caption = "0.00"
Label41.Caption = "0.00"
Label39.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm8.Show
End Sub

Private Sub CommandButton5_Click()
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox4.Visible = False
End Sub

Private Sub CommandButton7_Click()
Dim I As Long, FRow As Long, LRow As Long, RowNo As Long
Dim Tbl As Range, CheckRange As Range
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
MyBook.Activate
EventOff = True
SupplierNo = TextBox1.Text
   ListBox1.Visible = False
   ListBox2.Visible = False
   ListBox4.Visible = False
   ScrollBar1.Visible = False
   ScrollBar1.Value = 1
   ScrollBar1.Max = 1
   For I = 11 To 35
    Controls("Label" & I).Caption = ""
   Next I
    Label36.Caption = "0.00"
    Label41.Caption = "0.00"
  For I = 4 To 8
    Controls("TextBox" & I).Text = ""
    Controls("TextBox" & I).Visible = False
   Next I
   For I = 13 To 22
     Controls("TextBox" & I).Text = ""
     If Controls("Textbox" & I).TabStop = True Then Controls("Textbox" & I).TabStop = False
   Next I
   CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date"
If SupplierNo = "" Then
 EventOff = False
 Exit Sub
End If
MyBook.Worksheets("Supplier Data").Activate
If IsError(Application.Match(SupplierNo, Range("B:B"), 0)) Then
  Label2.Caption = ""
  Label39.Caption = "    Supplier # is not correct, please enter the correct Supplier # " & Chr(13) & _
       "    and then click the 'Amend Payment' button to proceed"
  Label39.Visible = True
  EventOff = False
  Exit Sub
Else
 I = Application.Match(SupplierNo, Range("B:B"), 0)
 Label2.Caption = Cells(I, 3).Value
End If
 MyBook.Worksheets("Payable").Activate
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("B1") _
        , Order2:=xlAscending, Key3:=Range("V1"), Order3:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(SupplierNo, CheckRange, 0)) Then
   Label39.Caption = Chr(13) & "    No Record of POs/ debit notes for this Supplier"
   Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
  FRow = Application.Match(SupplierNo, CheckRange, 0) + 3
  LRow = Application.Match(SupplierNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
  Label2.Caption = Cells(FRow, 17).Value
  Cells(FRow, 22).Select
   Range(Cells(FRow, 1), Cells(LRow, 5)).EntireRow.Select
   Selection.Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   Range("A1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    ActiveSheet.UsedRange.Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
      Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    With Selection
     .Columns("W").Copy
      Range("E1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("L").Copy
      Range("F1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("K").Copy
       Range("G1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("Q").Copy
       Range("I1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
       .Columns("J:K").NumberFormat = "yyyy/mm/dd"
       .Columns("N").Copy
       Range("J1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Range("K1").PasteSpecial Paste:=xlPasteAll, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
       .Columns("L").NumberFormat = "@"
       .Columns("E").Copy
       Range("L1").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
       Application.CutCopyMode = False
     .Columns("M:IV").ClearContents
     .Columns("H").ClearContents
     .Cut
    End With
    Range("A6").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
 If Range("B7").Value <> "" Then
    Range("B6").End(xlDown).Select
    If ActiveCell.Row > 10 Then
     ScrollBar1.Max = ActiveCell.Row - 9
     ScrollBar1.Visible = True
    End If
  End If
    Range("B6").Select
     I = 1
     Do While ActiveCell.Value <> "" And I < 6
      Controls("Label" & I * 5 + 6).Caption = I
      Controls("Label" & I * 5 + 7).Caption = ActiveCell.Value
      Controls("Label" & I * 5 + 8).Caption = Format(ActiveCell.Offset(0, 2).Value, "yyyy/mm/dd")
      Controls("TextBox" & I + 17).Text = ActiveCell.Offset(0, 3).Value
      Controls("TextBox" & I + 12).Text = Format(ActiveCell.Offset(0, 8).Value, "yyyy/mm/dd")
      Controls("Label" & I * 5 + 9).Caption = Format(ActiveCell.Offset(0, 4).Value, "#,##0.00")
      Controls("Label" & I * 5 + 10).Caption = Format(ActiveCell.Offset(0, 5).Value, "#,##0.00")
      Controls("TextBox" & I + 3).Visible = True
      ActiveCell.Offset(1, 0).Select
      I = I + 1
     Loop
  Else
   Label39.Caption = Chr(13) & "    No Record of POs / debit notes for this Supplier"
   Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
  Label39.Visible = False
  EventOff = False
End Sub

Private Sub CommandButton8_Click()
Dim FInvRow As Long, LInvRow As Long, I As Long, DelNo As Long, SupplierInv As String
If ThisWorkbook.Worksheets("TempRP").Range("B6").Value = "" Then Exit Sub
Application.EnableCancelKey = xlDisabled
If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  CommandButton8.Caption = "Save  Supplier Inv #          &  Due Date"
  For I = 13 To 22
   Controls("Textbox" & I).TabStop = True
  Next I
  Exit Sub
End If
MyBook.Worksheets("Payable").Activate
If Range("B4").Value <> "" Then
 ActiveSheet.UsedRange.Select
 Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
End If
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("B6").Select
Do While ActiveCell.Value <> ""
If (ActiveCell.Offset(0, 8).Value <> ActiveCell.Offset(0, 9).Value) Or (ActiveCell.Offset(0, 3).Value <> ActiveCell.Offset(0, 10).Value) Then
   PONo = ActiveCell.Value
   DelNo = ActiveCell.Offset(0, 1).Value
   DueDate = ActiveCell.Offset(0, 8).Value
   ActiveCell.Offset(0, 9).Value = DueDate
   SupplierInv = ActiveCell.Offset(0, 3).Value
   ActiveCell.Offset(0, 10).Value = SupplierInv
   MyBook.Worksheets("Payable").Activate
   Set CheckRange = MyBook.Worksheets("Payable").UsedRange.Offset(3, 0).Columns("B")
    FInvRow = Application.Match(PONo, CheckRange, 0) + 3
    LInvRow = Application.Match(PONo, CheckRange, 1) + 3
    FRow = FInvRow
  If FInvRow <> LInvRow Then
    Set CheckRange = CheckRange.Offset(FInvRow - 4, 1).Resize(LInvRow - FInvRow + 1, 1)
   If IsError(Application.Match(DelNo, CheckRange, 0)) = False Then FInvRow = Application.Match(DelNo, CheckRange, 0) + FInvRow - 1
  End If
   Cells(FInvRow, 14).NumberFormat = "yyyy/mm/dd"
   Cells(FInvRow, 14).Value = DueDate
   Cells(FInvRow, 23).NumberFormat = "@"
   Cells(FInvRow, 23).Value = SupplierInv
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveCell.Offset(1, 0).Select
Loop
CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date"
 For I = 13 To 22
   Controls("Textbox" & I).TabStop = False
  Next I
End Sub

Private Sub CommandButton9_Click()
 Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label39.Visible = False
 ListBox4.Visible = True
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
If ListBox1.List(0) = "No Supplier Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 RowNo = ListBox1.ListIndex + 2
 ListBox1.Visible = False
 SupplierNo = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value
 TextBox1.Text = SupplierNo
 Call Form20Text1Exit("")
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Then
 ListBox2.Visible = False
 Exit Sub
End If
RowNo = ListBox2.ListIndex + 24
BankAcct = MyBook.Worksheets("COmData").Cells(RowNo, 1).Value
Label45.Caption = BankAcct
Label46.Caption = MyBook.Worksheets("COmData").Cells(RowNo, 2).Value
ListBox2.Visible = False
End Sub

Private Sub ListBox4_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox4.Text = "CLOSE this box" Or ListBox4.Text = "No Record of Bank Names" Then
 ListBox4.Visible = False
 Exit Sub
End If
RowNo = ListBox4.ListIndex + 11
TextBox12.Text = MyBook.Worksheets("COmData").Cells(RowNo, 10).Value
ListBox4.Visible = False
End Sub

Private Sub OptionButton1_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
  If Not ((TextBox3.Text = "" Or TextBox3.Value = 0)) Or OptionButton3.Value = True Or ListBox4.ListIndex < 0 Then
   CommandButton2.Visible = True
  Else
   CommandButton2.Visible = False
  End If
  Label39.Visible = False
 For I = 50 To 52
  Controls("Label" & I).Visible = True
 Next I
 Label48.Visible = True
 For I = 11 To 12
  Controls("TextBox" & I).Visible = True
 Next I
 TextBox9.Visible = True
 CommandButton9.Visible = True
 CommandButton10.Visible = True
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
  If Not ((TextBox3.Text = "" Or TextBox3.Value = 0)) Or OptionButton3.Value = True Then
   CommandButton2.Visible = True
  Else
   CommandButton2.Visible = False
  End If
  Label39.Visible = False
For I = 50 To 52
  Controls("Label" & I).Visible = False
 Next I
 Label48.Visible = False
 For I = 11 To 12
  Controls("TextBox" & I).Visible = False
 Next I
 TextBox9.Visible = False
 CommandButton9.Visible = False
 CommandButton10.Visible = False
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub OptionButton3_Click()
Application.EnableCancelKey = xlDisabled
 CommandButton2.Visible = True
Label39.Visible = False
For I = 50 To 52
  Controls("Label" & I).Visible = False
 Next I
 Label48.Visible = False
 For I = 11 To 12
  Controls("TextBox" & I).Visible = False
 Next I
 TextBox9.Visible = False
  CommandButton9.Visible = False
  CommandButton10.Visible = False
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub ScrollBar1_Change()
 Dim LineNo As Long, I As Long, TotalSum As Double
  If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
   Cells(LineNo + 5, 2).Select
     I = 1
     Do While ActiveCell.Value <> "" And I < 6
      Controls("Label" & I * 5 + 6).Caption = I + LineNo - 1
      Controls("Label" & I * 5 + 7).Caption = ActiveCell.Value
      Controls("Label" & I * 5 + 8).Caption = Format(ActiveCell.Offset(0, 2).Value, "yyyy/mm/dd")
      Controls("TextBox" & I + 17).Text = ActiveCell.Offset(0, 3).Value
      Controls("TextBox" & I + 12).Text = Format(ActiveCell.Offset(0, 8).Value, "yyyy/mm/dd")
      Controls("Label" & I * 5 + 9).Caption = Format(ActiveCell.Offset(0, 4).Value, "#,##0.00")
      Controls("Label" & I * 5 + 10).Caption = Format(ActiveCell.Offset(0, 5).Value, "#,##0.00")
      Controls("Textbox" & I + 3).Text = Format(ActiveCell.Offset(0, 6).Value, "#,##0.00")
      Controls("TextBox" & I + 3).Visible = True
      ActiveCell.Offset(1, 0).Select
      I = I + 1
     Loop
End Sub

Private Sub TextBox1_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
Call Form20Text1Exit("")
End Sub

Private Sub TextBox10_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox11_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox11_Exit(ByVal Cancel As MSForms.ReturnBoolean)
 Dim PayDate As Date, ExpireDate As Date, DateString As String
 Application.EnableCancelKey = xlDisabled
Label39.Visible = False
If TextBox11.Text = "" Then Exit Sub
DateString = TextBox11.Text
Call DateConvert(DateString)
If IsDate(DateString) = False And TextBox11.Text <> "" Then
 Cancel = True
 Label39.Caption = Chr(13) & "  Incorrect Date "
 Label39.Visible = True
 Exit Sub
End If
If TextBox11.Text <> "" Then
  TextBox11.Text = Format(DateString, "yyyy/mm/dd")
  PayDate = TextBox11.Text
 If Month(Date) > 6 Then
   If IsDate(Year(Date) & "/" & Month(Date) - 6 & "/" & Day(Date)) = False Then
    ExpireDate = Year(Date) & "/" & Month(Date) - 5 & "/" & 1
   Else
    ExpireDate = Year(Date) & "/" & Month(Date) - 6 & "/" & Day(Date)
    ExpireDate = ExpireDate + 1
   End If
  ElseIf Month(Date) = 6 Then
   If IsDate(Year(Date) - 1 & "/" & 12 & "/" & Day(Date)) = False Then
     ExpireDate = Year(Date) & "/" & 1 & "/" & 1
   Else
     ExpireDate = Year(Date) - 1 & "/" & 12 & "/" & Day(Date)
     ExpireDate = ExpireDate + 1
   End If
  Else
   If IsDate(Year(Date) - 1 & "/" & Month(Date) + 6 & "/" & Day(Date)) = False Then
     ExpireDate = Year(Date) - 1 & "/" & Month(Date) + 7 & "/" & 1
   Else
     ExpireDate = Year(Date) - 1 & "/" & Month(Date) + 6 & "/" & Day(Date)
     ExpireDate = ExpireDate + 1
   End If
  End If
 If PayDate < ExpireDate Then
  Label39.Caption = Chr(13) & "  Warning!!! Cheque date is older than 6 months "
  Label39.Visible = True
  Exit Sub
 End If
End If
End Sub

Private Sub TextBox12_Change()
Label39.Visible = False
End Sub

Private Sub TextBox12_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox12_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim BankName As String, I As Long, J As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If TextBox12.Text = "" Then Exit Sub
 BankName = TextBox12.Text
If Left(BankName, 1) = " " Then
 I = Len(BankName)
 J = 1
 Do While J <= I And Mid(BankName, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then Exit Sub
  BankName = Right(BankName, I - J + 1)
End If
 TextBox12.Text = BankName
 MyBook.Worksheets("ComData").Activate
 Range("J11").Select
 Do While ActiveCell.Value <> ""
  If BankName = ActiveCell.Value Then Exit Sub
  ActiveCell.Offset(1, 0).Select
 Loop
  If ActiveCell.Row < 31 Then
    ActiveCell.NumberFormat = "@"
    ActiveCell.Value = BankName
    EventOff = True
    ListBox4.Clear
   MyBook.Worksheets("ComData").Activate
   If Range("J11") <> "" Then
    Range("J11:J30").Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("J11").Select
    Do While ActiveCell.Value <> ""
     ListBox4.AddItem "  " & ActiveCell.Value
     ActiveCell.Offset(1, 0).Select
    Loop
   Else
    ListBox4.AddItem "No Record of Bank Names"
   End If
   ListBox4.AddItem "CLOSE this box"
    EventOff = False
 End If
End Sub

Private Sub TextBox13_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, DateString As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 5
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox13.Text = ""
  Else
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
  End If
  Exit Sub
 End If
 DateString = TextBox13.Text
 Call DateConvert(DateString)
 TextBox13.Text = DateString
 If IsDate(TextBox13.Text) = False Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox13.Text = ""
  Else
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       Incorrect Input.  Not a valid Date. "
    Label39.Visible = True
  End If
  Exit Sub
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "DEBIT NOTE" Then
   If TextBox13.Text <> Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd") Then
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       No Change is allowed.  Due Date for a debit note can only be changed by amending the Debit Note "
    Label39.Visible = True
    Exit Sub
   End If
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "PO" Then
   ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = TextBox13.Text
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
 Else
  TextBox13.Text = ""
 End If
End Sub

Private Sub TextBox13_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
 Dim RowNo As Long, DateString As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If KeyCode = vbKeyUp Then
  EventOff = True
   RowNo = Val(Label11.Caption) + 5
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox13.Text = ""
  Else
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
  End If
  GoTo Finish
 End If
 DateString = TextBox13.Text
 Call DateConvert(DateString)
 TextBox13.Text = DateString
 If IsDate(TextBox13.Text) = False Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox13.Text = ""
  Else
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       Incorrect Input.  Not a valid Date. "
    Label39.Visible = True
  End If
  EventOff = False
  Exit Sub
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "DEBIT NOTE" Then
   If TextBox13.Text <> Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd") Then
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       No Change is allowed.  Due Date for a debit note can only be changed by amending the Debit Note "
    Label39.Visible = True
    EventOff = False
    Exit Sub
   End If
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "PO" Then
   ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = TextBox13.Text
    TextBox13.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
 Else
  TextBox13.Text = ""
 End If
Finish:
EventOff = False
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox14.SetFocus
      SendKeys "{Up}", False
End If
End Sub

Private Sub TextBox14_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, DateString As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 6
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox14.Text = ""
  Else
    TextBox14.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
  End If
  Exit Sub
 End If
 DateString = TextBox14.Text
 Call DateConvert(DateString)
 TextBox14.Text = DateString
 If IsDate(TextBox14.Text) = False Then
   If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox14.Text = ""
  Else
    TextBox14.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       Incorrect Input.  Not a valid Date. "
   Label39.Visible = True
  End If
  Exit Sub
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "DEBIT NOTE" Then
  If TextBox14.Text <> Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd") Then
   TextBox14.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
   Label39.Caption = "       No Change is allowed.  Due Date for a debit note can only be changed by amending the Debit Note "
   Label39.Visible = True
   Exit Sub
  End If
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "PO" Then
   ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = TextBox14.Text
    TextBox14.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
 Else
  TextBox14.Text = ""
 End If
End Sub

Private Sub TextBox15_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, DateString As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 7
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox15.Text = ""
  Else
    TextBox15.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
  End If
  Exit Sub
 End If
 DateString = TextBox15.Text
 Call DateConvert(DateString)
 TextBox15.Text = DateString
 If IsDate(TextBox15.Text) = False Then
   If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox15.Text = ""
  Else
    TextBox15.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       Incorrect Input.  Not a valid Date. "
   Label39.Visible = True
  End If
  Exit Sub
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "DEBIT NOTE" Then
  If TextBox15.Text <> Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd") Then
   TextBox15.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
   Label39.Caption = "       No Change is allowed.  Due Date for a debit note can only be changed by amending the Debit Note "
   Label39.Visible = True
   Exit Sub
  End If
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "PO" Then
   ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = TextBox15.Text
    TextBox15.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
 Else
  TextBox15.Text = ""
 End If
End Sub

Private Sub TextBox16_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, DateString As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 8
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox16.Text = ""
  Else
    TextBox16.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
  End If
  Exit Sub
 End If
 DateString = TextBox16.Text
 Call DateConvert(DateString)
 TextBox16.Text = DateString
 If IsDate(TextBox16.Text) = False Then
   If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox16.Text = ""
  Else
    TextBox16.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       Incorrect Input.  Not a valid Date. "
   Label39.Visible = True
  End If
  Exit Sub
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "DEBIT NOTE" Then
  If TextBox16.Text <> Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd") Then
   TextBox16.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
   Label39.Caption = "       No Change is allowed.  Due Date for a debit note can only be changed by amending the Debit Note "
   Label39.Visible = True
   Exit Sub
  End If
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "PO" Then
   ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = TextBox16.Text
    TextBox16.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
 Else
  TextBox16.Text = ""
 End If
End Sub

Private Sub TextBox17_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, DateString As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 9
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox17.Text = ""
  Else
    TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
  End If
  Exit Sub
 End If
 DateString = TextBox17.Text
 Call DateConvert(DateString)
 TextBox17.Text = DateString
 If IsDate(TextBox17.Text) = False Then
   If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox17.Text = ""
  Else
    TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       Incorrect Input.  Not a valid Date. "
   Label39.Visible = True
  End If
  Exit Sub
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "DEBIT NOTE" Then
  If TextBox17.Text <> Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd") Then
   TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
   Label39.Caption = "       No Change is allowed.  Due Date for a debit note can only be changed by amending the Debit Note "
   Label39.Visible = True
   Exit Sub
  End If
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "PO" Then
   ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = TextBox17.Text
    TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
 Else
  TextBox17.Text = ""
 End If
End Sub

Private Sub TextBox17_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
Dim RowNo As Long, DateString As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If KeyCode = vbKeyDown Then
 EventOff = True
  RowNo = Val(Label11.Caption) + 9
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox17.Text = ""
  Else
    TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
  End If
  GoTo Finish
 End If
 DateString = TextBox17.Text
 Call DateConvert(DateString)
 TextBox17.Text = DateString
 If IsDate(TextBox17.Text) = False Then
   If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = "" Then
    TextBox17.Text = ""
  Else
    TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
    Label39.Caption = "       Incorrect Input.  Not a valid Date. "
   Label39.Visible = True
  End If
  EventOff = False
  Exit Sub
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "DEBIT NOTE" Then
  If TextBox17.Text <> Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd") Then
   TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
   Label39.Caption = "       No Change is allowed.  Due Date for a debit note can only be changed by amending the Debit Note "
   Label39.Visible = True
   EventOff = False
   Exit Sub
  End If
 ElseIf ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value = "PO" Then
   ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value = TextBox17.Text
    TextBox17.Text = Format(ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 10).Value, "yyyy/mm/dd")
 Else
  TextBox17.Text = ""
 End If
Finish:
 EventOff = False
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox16.SetFocus
     SendKeys "{Down}", False
 End If
End Sub

Private Sub TextBox18_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, SupplierInv As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 5
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = "" Then
    TextBox18.Text = ""
  Else
    TextBox18.Text = ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value
  End If
  Exit Sub
 End If
 If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value <> "" Then
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).NumberFormat = "@"
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = TextBox18.Text
 Else
  TextBox18.Text = ""
 End If
End Sub

Private Sub TextBox18_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
Dim RowNo As Long, SupplierInv As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 If KeyCode = vbKeyUp Then
  EventOff = True
   RowNo = Val(Label11.Caption) + 5
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = "" Then
    TextBox18.Text = ""
  Else
    TextBox18.Text = ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value
  End If
  GoTo Finish
 End If
 If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value <> "" Then
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).NumberFormat = "@"
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = TextBox18.Text
 Else
  TextBox18.Text = ""
 End If
Finish:
EventOff = False
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox19.SetFocus
      SendKeys "{Up}", False
End If
End Sub

Private Sub TextBox19_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, SupplierInv As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 6
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = "" Then
    TextBox19.Text = ""
  Else
    TextBox19.Text = ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value
  End If
  Exit Sub
 End If
 If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value <> "" Then
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).NumberFormat = "@"
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = TextBox19.Text
 Else
  TextBox19.Text = ""
 End If
End Sub

Private Sub TextBox2_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim PayDate As Date, DateString As String
If TextBox2.Text = "" Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label39.Visible = False
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label39.Caption = Chr(13) & "  Incorrect Date "
 Label39.Visible = True
 Exit Sub
End If
  TextBox2.Text = Format(DateString, "yyyy/mm/dd")
  PayDate = TextBox2.Text
 If PayDate < BeginningDate Then
  Label39.Caption = Chr(13) & "  The Date entered belongs to Previous Posted Year "
  Label39.Visible = True
  Exit Sub
 End If
End Sub

Private Sub TextBox20_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, SupplierInv As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 7
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = "" Then
    TextBox20.Text = ""
  Else
    TextBox20.Text = ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value
  End If
  Exit Sub
 End If
 If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value <> "" Then
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).NumberFormat = "@"
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = TextBox20.Text
 Else
  TextBox20.Text = ""
 End If
End Sub

Private Sub TextBox21_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, SupplierInv As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 8
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = "" Then
    TextBox21.Text = ""
  Else
    TextBox21.Text = ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value
  End If
  Exit Sub
 End If
 If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value <> "" Then
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).NumberFormat = "@"
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = TextBox21.Text
 Else
  TextBox21.Text = ""
 End If
End Sub

Private Sub TextBox22_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RowNo As Long, SupplierInv As String
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   RowNo = Val(Label11.Caption) + 9
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = "" Then
    TextBox22.Text = ""
  Else
    TextBox22.Text = ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value
  End If
  Exit Sub
 End If
 If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value <> "" Then
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).NumberFormat = "@"
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = TextBox22.Text
 Else
  TextBox22.Text = ""
 End If
End Sub

Private Sub TextBox22_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
Dim RowNo As Long, SupplierInv As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
If KeyCode = vbKeyDown Then
 EventOff = True
   RowNo = Val(Label11.Caption) + 9
   Label39.Visible = False
 If CommandButton8.Caption = "Edit  Supplier Inv #          &  Due Date" Then
  If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = "" Then
    TextBox22.Text = ""
  Else
    TextBox22.Text = ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value
  End If
  GoTo Finish
 End If
 If ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 1).Value <> "" Then
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).NumberFormat = "@"
    ThisWorkbook.Worksheets("TempRP").Cells(RowNo, 5).Value = TextBox22.Text
 Else
  TextBox22.Text = ""
 End If
Finish:
 EventOff = False
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox21.SetFocus
     SendKeys "{Down}", False
 End If
End Sub

Private Sub TextBox3_Change()
If EventOff = True Then Exit Sub
CommandButton2.Visible = False
 OptionButton3.Visible = False
End Sub

Private Sub TextBox3_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim TextBox3Amount As Double
Application.EnableCancelKey = xlDisabled
If TextBox3.Text = "" Then
 TextBox3Amount = 0
 TextBox3.Text = "0.00"
End If
If IsNumeric(TextBox3.Text) = False Then
 Cancel = True
 Label39.Caption = Chr(13) & "  Incorrect Amount input "
 Label39.Visible = True
Else
 TextBox3Amount = TextBox3.Value
 TextBox3Amount = Round(TextBox3Amount, 2)
 TextBox3.Text = Format(TextBox3Amount, "#,##0.00")
 Label39.Visible = False
End If
If TextBox3Amount <> 0 Then
 OptionButton3.Visible = False
Else
 OptionButton3.Visible = True
End If
  If Not ((TextBox3.Text = "" Or TextBox3Amount = 0)) Or OptionButton3.Value = True Then
   CommandButton2.Visible = True
  Else
   CommandButton2.Visible = False
  End If
Label41.Caption = Format((TextBox3Amount - Label36.Caption), "#,##0.00")
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then CommandButton2.Visible = False
End Sub

Private Sub TextBox4_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox4_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label11.Caption)
 Form6TextNo = 4
 Call Form20SumRefresh("")
End Sub

Private Sub TextBox5_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label16.Caption)
 Form6TextNo = 5
Call Form20SumRefresh("")
End Sub

Private Sub TextBox6_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label21.Caption)
 Form6TextNo = 6
Call Form20SumRefresh("")
End Sub

Private Sub TextBox7_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox7_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label26.Caption)
 Form6TextNo = 7
Call Form20SumRefresh("")
End Sub

Private Sub TextBox8_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub TextBox8_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
 Form6RowNo = Val(Label31.Caption)
 Form6TextNo = 8
Call Form20SumRefresh("")
End Sub

Private Sub TextBox9_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
ListBox4.Visible = False
End Sub

Private Sub UserForm_Initialize()
Dim I As Long, COARange As Range, Tbl As Range, AddNo As Long, AcctNo As Variant
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.Clear
MyBook.Worksheets("Supplier Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
 ListBox1.AddItem "CLOSE this box"
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  MyBook.Worksheets("ComData").Activate
  Range("A24").Select
  Do While ActiveCell.Value <> ""
   AcctNo = ActiveCell.Value
   If IsError(Application.Match(AcctNo, COARange, 0)) = False Then
    I = Application.Match(AcctNo, COARange, 0) + 9
    ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
  ListBox2.Clear
   MyBook.Worksheets("ComData").Activate
   Range("A24").Select
   If ActiveCell.Value <> "" Then
    N = Len(ActiveCell.Value)
    spacing = " -----"
    spacing = Left(spacing, 7 - N)
    ListBox2.AddItem ActiveCell.Value & spacing & ActiveCell.Offset(0, 1).Value & "   ---- (Default)"
    ActiveCell.Offset(1, 0).Select
   End If
   Do While ActiveCell.Value <> ""
    N = Len(ActiveCell.Value)
    spacing = " -----"
    spacing = Left(spacing, 7 - N)
    ListBox2.AddItem ActiveCell.Value & spacing & ActiveCell.Offset(0, 1).Value
    ActiveCell.Offset(1, 0).Select
   Loop
   ListBox2.AddItem "CLOSE this box"
 ListBox4.Clear
 MyBook.Worksheets("ComData").Activate
 If Range("J11") <> "" Then
   Range("J11:J30").Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("J11").Select
  Do While ActiveCell.Value <> ""
   ListBox4.AddItem "  " & ActiveCell.Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox4.AddItem "No Record of Bank Names"
 End If
 ListBox4.AddItem "CLOSE this box"
EventOff = True
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
Label3.Caption = "Payment Amount (" & SysCurrency & ") : "
Label7.Caption = "Amt of Goods  " & Chr(13) & "Rec'd   (" & SysCurrency & ")  "
Label8.Caption = "Amount Due" & Chr(13) & "(" & SysCurrency & ")  "
Label9.Caption = "Applied Amount" & Chr(13) & "(" & SysCurrency & ")  "
Label37.Caption = "Total Sum (" & SysCurrency & ") : "
TextBox3.Text = "0.00"
PayRef = Right(("00000" & Val(MyBook.Worksheets("PayMake").Range("B1").Value) + 1), 5)
Label54.Caption = "B" & PayRef
If BankAcct <> "" Then
  Label45.Caption = BankAcct
  If IsError(Application.Match(BankAcct, COARange, 0)) = False Then
    I = Application.Match(BankAcct, COARange, 0) + 9
    Label46.Caption = MyBook.Worksheets("Chart of Account").Cells(I, 2).Value
  End If
Else
  BankAcct = Range("A24").Value
  Label45.Caption = BankAcct
  Label46.Caption = Range("B24").Value
End If
ScrollBar1.Max = 1
ScrollBar1.Min = 1
ScrollBar1.Value = 1
ScrollBar1.Visible = False
OptionButton1.Value = True
CommandButton2.Visible = False
SupplierNo = ""
For I = 4 To 8
 Controls("TextBox" & I).Visible = False
Next I
If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  CommandButton2.Visible = False
  CommandButton7.Visible = False
  CommandButton8.Visible = False
End If
BeginningDate = MyBook.Worksheets("Raw Data").Range("A1").Value
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "BILLPAY"
EventOff = False
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub
Attribute VB_Name = "UserForm21"
Attribute VB_Base = "0{F6AF877F-3D74-4E30-ADD1-18C7BA94BFDA}{DD51F3C7-47DE-46D7-A1C5-57499C144908}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public EndDate As Date, StartDate As Date
Private Sub CommandButton1_Click()
Dim YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If OptionButton1.Value = True Then
 If IsDate(TextBox1.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Beginning Date"
  Label5.Visible = True
  Exit Sub
 End If
 If IsDate(TextBox2.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Ending Date"
  Label5.Visible = True
  Exit Sub
 End If
 If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
 If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
  If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
  End If
 End If
End If
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
Me.Hide
End Sub

Private Sub CommandButton2_Click()
Unload Me
End Sub

Private Sub OptionButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label2.Visible = True
 Label3.Visible = True
   EndDate = Date
  If Month(EndDate) > 3 Then
   If IsDate(Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1) = False Then
    StartDate = Year(EndDate) & "/" & Month(EndDate) - 2 & "/" & 1
   Else
   StartDate = Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1
   End If
  ElseIf Month(EndDate) = 3 Then
   If IsDate(Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) & "/" & 1 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1
   End If
  Else
   If IsDate(Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 10 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1
   End If
  End If
If Day(EndDate + 1) = 1 And Day(StartDate) <> 1 Then
 StartDate = Year(StartDate) - 1 & "/" & Month(StartDate) + 1 & "/" & 1
End If
 TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
 TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
 TextBox1.Visible = True
 TextBox2.Visible = True
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
Label2.Visible = False
Label3.Visible = False
TextBox1.Visible = False
TextBox2.Visible = False
End Sub


Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
' For aging report, no need to check the content of the textboxes
If Label1.Caption = "Aging Report" Or Label1.Caption = "Debit Status Report" Then Exit Sub
If TextBox1.Text = "" Then Exit Sub
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
  TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
StartDate = TextBox1.Text
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If Label1.Caption = "Aging Report" Or Label1.Caption = "Debit Status Report" Then Exit Sub
If TextBox2.Text = "" Then Exit Sub
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox2.Text = Format(DateString, "yyyy/mm/dd")
End If
EndDate = TextBox2.Text
 If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  OptionButton2.Visible = False
  OptionButton1.Value = True
  Label2.Visible = True
  Label3.Visible = True
  StartDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  EndDate = Year(StartDate) + 1 & "/" & Month(StartDate) & "/" & Day(StartDate)
  EndDate = EndDate - 1
  TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
  TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
  TextBox1.Visible = True
  TextBox2.Visible = True
Else
  OptionButton2.Value = True
End If
OptionButton3.Value = True
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "STATUS"
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
End Sub


Attribute VB_Name = "UserForm22"
Attribute VB_Base = "0{950A7AAB-8E2D-402D-BD94-482753806589}{F425EF04-54E0-4372-8FDB-FDE8AB063E7C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public StartDate As Date, EndDate As Date
Private Sub CommandButton1_Click()
Dim YearEndDate As Date
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 ListBox1.Visible = False
If OptionButton3.Value <> True Then
 If IsDate(TextBox1.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Beginning Date"
  Label5.Visible = True
  Exit Sub
 End If
 If IsDate(TextBox2.Text) = False Then
  Label5.Caption = Chr(13) & "    Incorrect Ending Date"
  Label5.Visible = True
  Exit Sub
 End If
  StartDate = TextBox1.Text
  EndDate = TextBox2.Text
 If EndDate < StartDate Then
  Label5.Caption = Chr(13) & "   The Ending Date must not be earlier than the Beginning Date"
  Label5.Visible = True
  Exit Sub
 End If
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
  End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
  If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
  End If
 End If
End If
If OptionButton1.Value = True And TextBox3.Text = "" Then
 Label5.Caption = Chr(13) & "    Please input the Selected Supplier # to proceed"
 Label5.Visible = True
 Exit Sub
End If
If OptionButton3.Value = True And PONo = "" Then
 If TextBox5.Text = "" Then
   Label5.Caption = Chr(13) & "    Please input the Selected PO number # to proceed"
   Label5.Visible = True
 Else
   Label5.Caption = Chr(13) & "      The PO number is not found from the Record"
   Label5.Visible = True
 End If
 Exit Sub
End If
 ListBox1.Visible = False
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
Me.Hide
End Sub
Private Sub CommandButton2_Click()
Unload Me
End Sub
Private Sub CommandButton3_Click()
 Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = True
 Label5.Visible = False
End Sub
Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If ListBox1.List(0) = "No Supplier Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 RowNo = ListBox1.ListIndex + 2
TextBox3.Text = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value
Label11.Caption = MyBook.Worksheets("Supplier Data").Cells(RowNo, 3).Value
ListBox1.Visible = False
End Sub
Private Sub OptionButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = True
 TextBox3.Visible = True
 Label11.Visible = True
 Label12.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 CommandButton3.Visible = True
End Sub
Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
Label14.Visible = False
TextBox5.Visible = False
CommandButton3.Visible = False
End Sub
Private Sub OptionButton3_Click()
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
Label14.Visible = True
TextBox5.Visible = True
CommandButton3.Visible = False
End Sub
Private Sub OptionButton4_Click()
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
Label14.Visible = False
TextBox5.Visible = False
CommandButton3.Visible = False
End Sub
Private Sub OptionButton5_Click()
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
Label14.Visible = False
TextBox5.Visible = False
CommandButton3.Visible = False
End Sub
Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox1.Text = "" Then Exit Sub
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
 StartDate = TextBox1.Text
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox2.Text = "" Then Exit Sub
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox2.Text = Format(DateString, "yyyy/mm/dd")
End If
EndDate = TextBox2.Text
If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
    ' Add below lines
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If

'Add above
End Sub
Private Sub TextBox3_Change()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
Label5.Visible = False
End Sub
Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim SupplierNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
SupplierNo = UCase(TextBox3.Text)
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then SupplierNo = Right(("00000" & SupplierNo), 5)
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
  TextBox3.Text = SupplierNo
  Label11.Caption = ""
  Label5.Caption = Chr(13) & "      Incorrect Supplier # entered"
  Label5.Visible = True
Else
 CustRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
 MyBook.Worksheets("Supplier Data").Activate
 TextBox3.Text = SupplierNo
 Label11.Caption = Cells(CustRow, 3).Value
End If
End Sub

Private Sub TextBox5_Change()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InvInput As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
InvInput = UCase(TextBox5.Text)
If Left(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = 1
 Do While J <= I And Mid(InvInput, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Right(InvInput, I - J + 1)
  End If
End If
If Right(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = I
 Do While J > 0 And Mid(InvInput, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Left(InvInput, J)
  End If
End If
InputChecked:
If InvInput = "" Then
  PONo = ""
  TextBox5.Text = ""
  Exit Sub
End If
If IsNumeric(InvInput) Then
 If Len(InvInput) < 7 Then
   PONo = "P" & Right(("000000" & InvInput), 6)
 Else
  PONo = InvInput & " "
 End If
ElseIf Len(InvInput) = 7 Then
  If Left(InvInput, 1) = "P" Then
   If IsNumeric(Right(InvInput, 6)) = True Then
     PONo = InvInput
   Else
    PONo = InvInput & " "
   End If
  ElseIf Left(InvInput, 2) = "DN" Then
   If IsNumeric(Right(InvInput, 5)) = True Then
     PONo = InvInput
   Else
    PONo = InvInput & " "
   End If
  Else
   PONo = InvInput & " "
  End If
Else
  PONo = InvInput & " "
End If
 TextBox5.Text = PONo
If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) Then
  PONo = ""
  Label5.Caption = Chr(13) & "      The PO number is not found from the Record"
  Label5.Visible = True
Else
 I = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
 If MyBook.Worksheets("PORecord").Cells(I, 1).Value <> "PO" Then
   PONo = ""
   Label5.Caption = Chr(13) & "      The PO number is not found from the Record"
   Label5.Visible = True
 End If
End If
End Sub

Private Sub UserForm_Initialize()
Dim Tbl As Range, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  EndDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  EndDate = Year(EndDate) + 1 & "/" & Month(EndDate) & "/" & Day(EndDate)
  EndDate = EndDate - 1
Else
   EndDate = Date
End If
  If Month(EndDate) > 3 Then
   If IsDate(Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1) = False Then
    StartDate = Year(EndDate) & "/" & Month(EndDate) - 2 & "/" & 1
   Else
   StartDate = Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1
   End If
  ElseIf Month(EndDate) = 3 Then
   If IsDate(Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) & "/" & 1 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1
   End If
  Else
   If IsDate(Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 10 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1
   End If
  End If
If Day(EndDate + 1) = 1 And Day(StartDate) <> 1 Then
 StartDate = Year(StartDate) - 1 & "/" & Month(StartDate) + 1 & "/" & 1
End If
 TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
 TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
 SupplierNo = ""
 PONo = ""
ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
End Sub
Private Sub UserForm_Terminate()
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
End Sub
Attribute VB_Name = "UserForm23"
Attribute VB_Base = "0{9D31BE2F-BFD7-43E0-9EB9-56E18236CF5F}{6B3EFEE1-847A-4D63-9F5F-1F882D8DC919}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public StartDate As Date, EndDate As Date

Private Sub CommandButton1_Click()
Dim Tbl As Range, CheckRange As Range, PORowA As Long, PORowB As Long, I As Long, J As Long
Dim YearEndDate As Date
Application.EnableCancelKey = xlDisabled
  Label5.Visible = False
  ListBox1.Visible = False
If OptionButton5.Value <> True Then
  If IsDate(TextBox1.Text) = False Then
   Label5.Caption = Chr(13) & "    Incorrect Beginning Date"
   Label5.Visible = True
   Exit Sub
  End If
  If IsDate(TextBox2.Text) = False Then
   Label5.Caption = Chr(13) & "    Incorrect Ending Date"
   Label5.Visible = True
   Exit Sub
  End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
  If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
  End If
 End If
End If
 If OptionButton1.Value = True And (TextBox3.Text = "" Or Label11.Caption = "") Then
    Label5.Caption = Chr(13) & "   Please input the Selected Supplier # to proceed."
    Label5.Visible = True
    Exit Sub
 End If
  If OptionButton7.Value = True And (TextBox6.Text = "" Or Label16.Caption = "") Then
    Label5.Caption = Chr(13) & "   Please input the Selected Supplier # to proceed."
    Label5.Visible = True
    Exit Sub
 End If
If OptionButton5.Value = True Then
   If IsError(Application.Match(PONo, MyBook.Worksheets("Payable").Columns("B"), 0)) = True Then
    Label5.Caption = Chr(13) & "   No payment record for the selected PO number."
    Label5.Visible = True
    Exit Sub
   End If
  ListBox1.Visible = False
  Label5.BackColor = &H40C0&
  Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
  Label5.Visible = True
  DoEvents
  Application.EnableEvents = False
   Application.DisplayAlerts = False
   ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add
    ActiveSheet.Name = "Report"
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Columns("A:A").Select
    With Selection
        .ColumnWidth = 33
        .NumberFormat = "yyyy/mm/dd"
        .HorizontalAlignment = xlCenter
    End With
    Columns("B:B").Select
    With Selection
        .NumberFormat = "#,##0.00"
        .ColumnWidth = 17
        .HorizontalAlignment = xlRight
    End With
    Columns("C").Select
    With Selection
        .ColumnWidth = 14
        .HorizontalAlignment = xlLeft
        .IndentLevel = 2
    End With
    Columns("A:C").Select
    With Selection.Font
        .Name = "Times New Roman"
        .Size = 12
    End With
    Range("A1").Value = "Record of Payment made for the below PO/ Debit Note"
    Range("A1").Select
    With Selection
        .HorizontalAlignment = xlLeft
    End With
    With Selection.Font
        .Name = "Times New Roman"
        .FontStyle = "Bold"
        .Size = 14
    End With
    Range("A3:A8").Select
    With Selection
        .HorizontalAlignment = xlRight
    End With
    Range("B3:B8").Select
    With Selection
        .HorizontalAlignment = xlLeft
        .IndentLevel = 2
    End With
    Range("A10").Select
    With Selection
        .HorizontalAlignment = xlLeft
    End With
    With Selection.Font
        .Name = "Times New Roman"
        .FontStyle = "Bold"
        .Size = 12
    End With
    Range("A12:C12").Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = xlAutomatic
    End With
    Range("B3").NumberFormat = "@"
    Range("B4").NumberFormat = "yyyy/mm/dd"
    Range("B5").NumberFormat = "#,##0.00"
    Range("B6").NumberFormat = "#,##0.00"
    Range("B7").NumberFormat = "#,##0.00"
    ThisWorkbook.Worksheets("TempRP").Activate
    ActiveSheet.UsedRange.EntireRow.Delete
 MyBook.Worksheets("Payable").Activate
 If Range("B4") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
  PORowA = Application.Match(PONo, CheckRange, 0) + 3
  PORowB = Application.Match(PONo, CheckRange, 1) + 3
  ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
  MyBook.Worksheets("Payable").Activate
  Range(Cells(PORowA, 10), Cells(PORowB, 256)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  Range("J1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  If Left(PONo, 1) = "P" Or Right(PONo, 1) = " " Then
    Range("A6").Value = "PO # : "
    Range("A7").Value = "PO Date : "
    Range("A8").Value = " Total PO Amount : (" & SysCurrency & ")"
    Range("A9").Value = "Total Amount of Goods Rec'd : (" & SysCurrency & ")"
    Range("A10").Value = "Outstanding Amount : (" & SysCurrency & ")"
    Range("B9").NumberFormat = "#,##0.00"
    Range("B9").Value = Application.Sum(Range(Cells(1, 12), Cells(PORowB - PORowA + 1, 12)))
  Else
    Range("A6").Value = "Debit Note # : "
    Range("A7").Value = "Debit Note Date : "
    Range("A8").Value = " Total DN Amount : (" & SysCurrency & ")"
    Range("A10").Value = "Outstanding Amount : (" & SysCurrency & ")"
  End If
    Range("B6").NumberFormat = "@"
    Range("B6").Value = PONo
    If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Columns("B"), 0)) = False Then
      J = Application.Match(PONo, MyBook.Worksheets("PORecord").Columns("B"), 0)
      Range("B7").NumberFormat = "yyyy/mm/dd"
      Range("B7").Value = MyBook.Worksheets("PORecord").Cells(J, 4).Value
      Range("B8").NumberFormat = "#,##0.00"
      Range("B8").Value = MyBook.Worksheets("PORecord").Cells(J, 32).Value
      Range("B10").NumberFormat = "#,##0.00"
      Range("B10").Value = MyBook.Worksheets("PORecord").Cells(J, 11).Value
    End If
    Range("A11").Value = "Supplier : "
    Range("B11").Value = Range("Q1").Value & "    ( # " & Range("P1").Value & " )"
    Range("A13").Value = "Details of Payment made  : --"
    Range("A15").Value = " Payment Date"
    Range("B14").Value = "Payment Amount"
    Range("B15").Value = "(" & SysCurrency & ")"
    Range("C15").Value = "Payment No"
      I = 16
   For J = 1 To PORowB - PORowA + 1
    Cells(J, 166).Select
    Do While ActiveCell.Value <> ""
     Cells(I, 1).NumberFormat = "yyyy/mm/dd"
     Cells(I, 1).Value = ActiveCell.Value
     Cells(I, 2).Value = ActiveCell.Offset(0, 1).Value
     Cells(I, 3).Value = ActiveCell.Offset(0, 2).Value
     I = I + 1
     ActiveCell.Offset(0, 3).Select
    Loop
   Next J
   Range(Cells(16, 1), Cells(I, 3)).Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range(Cells(6, 1), Cells(I, 3)).Copy
   Worksheets("Report").Activate
   Range("A3").Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
   Application.CutCopyMode = False
   Range("E1").Value = " "
  On Error GoTo NoPrinter
   With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .LeftMargin = Application.InchesToPoints(0.75)
        .RightMargin = Application.InchesToPoints(0.75)
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
 End If
 
 
 GoTo Finish
End If
  If IsDate(TextBox1.Text) = False Then
    Cancel = True
    Label5.Caption = Chr(13) & "    Incorrect Beginning Date entered"
    Label5.Visible = True
    Exit Sub
  End If
  If IsDate(TextBox2.Text) = False Then
    Cancel = True
    Label5.Caption = Chr(13) & "    Incorrect Ending Date entered"
    Label5.Visible = True
    Exit Sub
  End If
  StartDate = TextBox1.Text
  EndDate = TextBox2.Text
 If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
 ListBox1.Visible = False
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
 If OptionButton6.Value = True Then
  Application.ScreenUpdating = False
  Me.Hide
  Call SuppLedger("SuppLedger")
 Exit Sub
 End If
 If OptionButton7.Value = True Then
  Application.ScreenUpdating = False
  Me.Hide
  Call SuppLedger(TextBox6.Text)
 Exit Sub
End If
 Call PaySuppRecord("PAYSUPP")
Finish:
 Unload Me
 Application.EnableEvents = False
 MyBook.Activate
 ThisWorkbook.Worksheets("Report").Activate
 ActiveSheet.Visible = xlSheetVisible
 Worksheets("System Menu").Visible = xlSheetVeryHidden
 SheetName = "Report"
 OldForm = "UserForm8"
 Application.EnableEvents = True
 ActiveWindow.DisplayGridlines = False
 Application.ScreenUpdating = True
 Range("A1").Select
 Range("A2").Select
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
Unload Me
UserForm8.Show
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = True
 Label5.Visible = False
End Sub
Private Sub CommandButton4_Click()
 Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = True
 Label5.Visible = False
End Sub
Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If ListBox1.List(0) = "No Supplier Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 RowNo = ListBox1.ListIndex + 2
TextBox3.Text = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value
Label11.Caption = MyBook.Worksheets("Supplier Data").Cells(RowNo, 3).Value
TextBox6.Text = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value
Label16.Caption = MyBook.Worksheets("Supplier Data").Cells(RowNo, 3).Value
ListBox1.Visible = False
End Sub

Private Sub OptionButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = True
 TextBox3.Visible = True
 Label11.Visible = True
 Label12.Visible = True
 CommandButton3.Visible = True
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton3_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton5_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = False
 TextBox1.Visible = False
 Label3.Visible = False
 TextBox2.Visible = False
 Label8.Visible = False
 Label9.Visible = False
 Label14.Visible = True
 TextBox5.Visible = True
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub
Private Sub OptionButton6_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = False
 Label16.Visible = False
 Label15.Visible = False
 Label17.Visible = False
 CommandButton4.Visible = False
End Sub

Private Sub OptionButton7_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label2.Visible = True
 TextBox1.Visible = True
 Label3.Visible = True
 TextBox2.Visible = True
 Label8.Visible = True
 Label9.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
 TextBox6.Visible = True
 Label16.Visible = True
 Label15.Visible = True
 Label17.Visible = True
 CommandButton4.Visible = True
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox1.Text = "" Then Exit Sub
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
 StartDate = TextBox1.Text
  If BeginningDate - StartDate > 184 Then
   Label5.Caption = "   Data earlier than 6 months prior to the beginning date " & Chr(13) & "    of the Accounting Year is not available. "
   Label5.Visible = True
   Exit Sub
 End If
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox2.Text = "" Then Exit Sub
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox2.Text = Format(DateString, "yyyy/mm/dd")
End If
EndDate = TextBox2.Text
If EndDate < StartDate Then
   Label5.Caption = Chr(13) & "   Ending Date must not be earlier than Beginning Date"
   Label5.Visible = True
   Exit Sub
 End If
 If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   Label5.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
End Sub

Private Sub TextBox3_Change()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim SupplierNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
SupplierNo = UCase(TextBox3.Text)
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then SupplierNo = Right(("00000" & SupplierNo), 5)
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
  TextBox3.Text = SupplierNo
  Label11.Caption = ""
  Label5.Caption = Chr(13) & "      Incorrect Supplier # entered"
  Label5.Visible = True
Else
 CustRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
 MyBook.Worksheets("Supplier Data").Activate
 TextBox3.Text = SupplierNo
 Label11.Caption = Cells(CustRow, 3).Value
End If
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InvInput As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
InvInput = UCase(TextBox5.Text)
If Left(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = 1
 Do While J <= I And Mid(InvInput, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Right(InvInput, I - J + 1)
  End If
End If
If Right(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = I
 Do While J > 0 And Mid(InvInput, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Left(InvInput, J)
  End If
End If
InputChecked:
If IsNumeric(InvInput) Then
 If Len(InvInput) < 7 Then
   PONo = "P" & Right(("000000" & InvInput), 6)
 Else
  PONo = InvInput & " "
 End If
ElseIf Len(InvInput) = 7 Then
  If Left(InvInput, 1) = "P" Then
   If IsNumeric(Right(InvInput, 6)) = True Then
     PONo = InvInput
   Else
    PONo = InvInput & " "
   End If
  ElseIf Left(InvInput, 2) = "DN" Then
   If IsNumeric(Right(InvInput, 5)) = True Then
     PONo = InvInput
   Else
    PONo = InvInput & " "
   End If
  Else
   PONo = InvInput & " "
  End If
Else
  PONo = InvInput & " "
End If
 TextBox5.Text = PONo
End Sub

Private Sub TextBox6_Change()
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim SupplierNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
SupplierNo = UCase(TextBox6.Text)
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then SupplierNo = Right(("00000" & SupplierNo), 5)
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
  TextBox6.Text = SupplierNo
  Label16.Caption = ""
  Label5.Caption = Chr(13) & "      Incorrect Supplier # entered"
  Label5.Visible = True
Else
 CustRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
 MyBook.Worksheets("Supplier Data").Activate
 TextBox6.Text = SupplierNo
 Label16.Caption = Cells(CustRow, 3).Value
End If
End Sub

Private Sub UserForm_Initialize()
Dim StartDate As Date, EndDate As Date, Tbl As Range, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
  EndDate = MyBook.Worksheets("Raw Data").Range("A1").Value
  EndDate = Year(EndDate) + 1 & "/" & Month(EndDate) & "/" & Day(EndDate)
  EndDate = EndDate - 1
Else
   EndDate = Date
End If
  If Month(EndDate) > 3 Then
   If IsDate(Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1) = False Then
    StartDate = Year(EndDate) & "/" & Month(EndDate) - 2 & "/" & 1
   Else
   StartDate = Year(EndDate) & "/" & Month(EndDate) - 3 & "/" & Day(EndDate) + 1
   End If
  ElseIf Month(EndDate) = 3 Then
   If IsDate(Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) & "/" & 1 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & 12 & "/" & Day(EndDate) + 1
   End If
  Else
   If IsDate(Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1) = False Then
     StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 10 & "/" & 1
   Else
   StartDate = Year(EndDate) - 1 & "/" & Month(EndDate) + 9 & "/" & Day(EndDate) + 1
   End If
  End If
If Day(EndDate + 1) = 1 And Day(StartDate) <> 1 Then
 StartDate = Year(StartDate) - 1 & "/" & Month(StartDate) + 1 & "/" & 1
End If
 TextBox1.Text = Format(StartDate, "yyyy/mm/dd")
 TextBox2.Text = Format(EndDate, "yyyy/mm/dd")
ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Supplier Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  OptionButton3.Value = True
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
EventOff = True
ThisWorkbook.Worksheets("System Menu").Activate
SheetName = "System Menu"
EventOff = False
End Sub


Attribute VB_Name = "UserForm24"
Attribute VB_Base = "0{0357230A-E5DB-4CF0-B71A-8BFA8DCC63E9}{838E5AD8-0032-43F5-9F34-FBCA7A5DF5F3}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
' Proceed Button
  Label5.Visible = False
  ListBox1.Visible = False
' For one supplier, check to see if the supplier # has been inputted or not
 If OptionButton3.Value = True And TextBox3.Text = "" Then
   Label5.Caption = Chr(13) & "   Please enter the Selected supplier number. "
   Label5.Visible = True
   Exit Sub
 End If


' Check to see if the required PO # has been selected
 If OptionButton4.Value = True And PONo = "" Then
  If TextBox5.Text = "" Then
   Label5.Caption = Chr(13) & "    Please input the Selected PO number # to proceed"
   Label5.Visible = True
  Else
   Label5.Caption = Chr(13) & "      The PO number is not found from the Record"
   Label5.Visible = True
  End If
  Exit Sub
 End If
 ' Hide the listbox and display the message of waiting for processing
 ListBox1.Visible = False
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
' Proceed reporting
Me.Hide
 
End Sub

Private Sub CommandButton2_Click()
' Close button
Unload Me
End Sub

Private Sub CommandButton3_Click()
 ' Supplier # Button
 ListBox1.Visible = True
 Label5.Visible = False
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, Tbl As Range
' Check if there is no Supplier data in the listbox1
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
If ListBox1.List(0) = "No Supplier Data" Then
 ListBox1.Visible = False
 Exit Sub
End If

If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
' See if the user wants to change to Supplier name / Supplier # sorting
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
        
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
 ' No Supplier data in the record, hide the commandbutton4
  ListBox1.AddItem "No Supplier Data"
 End If
' Add an extra line to listBox1
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If

If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Supplier #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
  ' Add Supplier Name to ListBox1 in ascending order of Supplier name
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
        
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
 ' No Supplier data in the record, hide the commandbutton4
  ListBox1.AddItem "No Supplier Data"
 End If
' Add an extra line to listBox1
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 
 RowNo = ListBox1.ListIndex + 2
' Copy data from Supplier data sheet to the userform
TextBox3.Text = MyBook.Worksheets("Supplier Data").Cells(RowNo, 2).Value
Label11.Caption = MyBook.Worksheets("Supplier Data").Cells(RowNo, 3).Value
ListBox1.Visible = False
End Sub


Private Sub OptionButton1_Click()
' Sorted by Suppliers and PO # option button
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
' Label2.Visible = True
' TextBox1.Visible = True
' Label3.Visible = True
' TextBox2.Visible = True
' Label8.Visible = True
' Label9.Visible = True
  Label14.Visible = False
 TextBox5.Visible = False
End Sub


Private Sub OptionButton2_Click()
' sorted by PO date
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label14.Visible = False
 TextBox5.Visible = False
End Sub

Private Sub OptionButton3_Click()
' Selected Supplier button
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = True
 TextBox3.Visible = True
 Label11.Visible = True
 Label12.Visible = True
' Show the Supplier # selection button
 CommandButton3.Visible = True
 Label14.Visible = False
 TextBox5.Visible = False
End Sub


Private Sub OptionButton4_Click()
' Selected PO
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
 Label14.Visible = True
 TextBox5.Visible = True

End Sub

Private Sub OptionButton5_Click()
' Sorted by Suppliers and PO # option button
 Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = False
 TextBox3.Visible = False
 Label11.Visible = False
 Label12.Visible = False
 CommandButton3.Visible = False
' Label2.Visible = True
' TextBox1.Visible = True
' Label3.Visible = True
' TextBox2.Visible = True
' Label8.Visible = True
' Label9.Visible = True
  Label14.Visible = False
 TextBox5.Visible = False
End Sub

Private Sub TextBox3_Change()
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
' Find the Supplier # and Supplier name and list it in the textbox3 and label11
Dim SupplierNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
SupplierNo = UCase(TextBox3.Text)
If Left(SupplierNo, 1) = "S" Then
 I = Len(SupplierNo)
 SupplierNo = Right(SupplierNo, I - 1)
 If IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then SupplierNo = Right(("00000" & SupplierNo), 5)
 End If
   SupplierNo = "S" & SupplierNo
ElseIf IsNumeric(SupplierNo) Then
  If Len(SupplierNo) < 6 Then
   SupplierNo = Right(("00000" & SupplierNo), 5)
   SupplierNo = "S" & SupplierNo
  End If
End If
If IsError(Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)) Then
  TextBox3.Text = SupplierNo
  Label11.Caption = ""
  Label5.Caption = Chr(13) & "      Incorrect Supplier # entered"
  Label5.Visible = True
Else
' Find the Row number that contain the same Supplier # in the Supplier data sheet
 CustRow = Application.Match(SupplierNo, MyBook.Worksheets("Supplier Data").Range("B:B"), 0)
 MyBook.Worksheets("Supplier Data").Activate
 TextBox3.Text = SupplierNo
 Label11.Caption = Cells(CustRow, 3).Value
End If
End Sub

Private Sub TextBox5_Change()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InvInput As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
InvInput = UCase(TextBox5.Text)
If Left(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = 1
 Do While J <= I And Mid(InvInput, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Right(InvInput, I - J + 1)
  End If
End If
If Right(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = I
 Do While J > 0 And Mid(InvInput, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Left(InvInput, J)
  End If
End If
InputChecked:
If InvInput = "" Then
  PONo = ""
  TextBox5.Text = ""
  Exit Sub
End If
If IsNumeric(InvInput) Then
 If Len(InvInput) < 7 Then
   PONo = Right(("000000" & InvInput), 6)
   TextBox5.Text = PONo
   PONo = "P" & PONo
 Else
  PONo = InvInput & " "
  TextBox5.Text = PONo
 End If
ElseIf Len(InvInput) = 7 Then
  If Left(InvInput, 1) = "P" Then
   If IsNumeric(Right(InvInput, 6)) = True Then
     PONo = InvInput
     TextBox5.Text = Right(InvInput, 6)
   Else
    PONo = InvInput & " "
    TextBox5.Text = PONo
   End If
  Else
   PONo = InvInput & " "
   TextBox5.Text = PONo
  End If
Else
  PONo = InvInput & " "
  TextBox5.Text = PONo
End If

TextBox5.Text = PONo
 ' Check to see if the PO # is available or not
If IsError(Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)) Then
  PONo = ""
  Label5.Caption = Chr(13) & "      The PO number is not found from the Record"
  Label5.Visible = True
Else
' Find the Row number that contain the same PO # in the PO Record sheet
 I = Application.Match(PONo, MyBook.Worksheets("PORecord").Range("B:B"), 0)
 If MyBook.Worksheets("PORecord").Cells(I, 1).Value <> "PO" Then
   PONo = ""
   Label5.Caption = Chr(13) & "      The PO number is not found from the Record"
   Label5.Visible = True
 End If
End If


End Sub

Private Sub UserForm_Initialize()

Dim Tbl As Range, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If

Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
' Add Supplier Name to ListBox1 in ascending order of Supplier name
ListBox1.Clear
  MyBook.Worksheets("Supplier Data").Activate
  ' Add Supplier Name to ListBox1 in ascending order of Supplier name
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
        
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Supplier name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
 ' No Supplier data in the record, hide the commandbutton4
  ListBox1.AddItem "No Supplier Data"
 End If
' Add an extra line to listBox1
  ListBox1.AddItem "CLOSE this box"
  PONo = ""
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub

Private Sub UserForm_Terminate()
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
End Sub




Attribute VB_Name = "UserForm25"
Attribute VB_Base = "0{72835788-D5C7-475B-8644-B8C2D15B74AE}{37ECE7C7-0FA9-45DF-B309-5C25F302336C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public StockAssetAcct As String, AssetAcctCK As Variant

Private Sub ComboBox1_Click()
Dim EndNo As Long, FullNo As Long, AssetAcct As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ComboBox1.Width = 60
Label8.Caption = ""
AssetAcct = ComboBox1.Text
FullNo = Len(AssetAcct)
EndNo = 1
Do While Mid(AssetAcct, EndNo, 1) <> " " And EndNo <= FullNo
EndNo = EndNo + 1
Loop
If FullNo > 6 Then Label8.Caption = Right(AssetAcct, FullNo - 6)
Label8.Visible = True
AssetAcct = Left(AssetAcct, EndNo - 1)
ComboBox1.Text = AssetAcct
If StockNoExist = "Yes" And StockAssetAcct <> ComboBox1.Value And Label9.Caption <> "0" Then
  Label10.Caption = "    The stock # exists in the Record." & Chr(13) & "    Change of the Asset Account will result in moving on-hand value " & Chr(13) & _
                    "    from the old account # to the new account #"
  Label10.Visible = True
End If
End Sub

Private Sub Combobox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long, J As Long, TempInput As String, EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
  ListBox1.Visible = False
  ComboBox1.Width = 60
 If ComboBox1.Text = "" Then
  Label8.Caption = ""
  Exit Sub
 End If
I = ComboBox1.ListCount
J = 0
TempInput = ComboBox1.Text
Do While J < I
 If TempInput = Left(ComboBox1.List(J), Len(TempInput)) Then
   TempInput = ComboBox1.List(J)
   FullNo = Len(TempInput)
   EndNo = 1
   Do While Mid(TempInput, EndNo, 1) <> " " And EndNo <= FullNo
    EndNo = EndNo + 1
   Loop
   TempInput = Left(TempInput, EndNo - 1)
   ComboBox1.Text = TempInput
   Label8.Caption = Right(ComboBox1.List(J), Len(ComboBox1.List(J)) - 6)
  If StockNoExist = "Yes" And StockAssetAcct <> ComboBox1.Value And Label9.Caption <> "0" Then
    Label10.Caption = "    The stock # exists in the Record." & Chr(13) & "    Change of the Asset Account will result in moving on-hand value " & Chr(13) & _
                    "    from the old account # to the new account #"
    Label10.Visible = True
  End If
  Exit Sub
 End If
  J = J + 1
Loop
 Label10.Caption = Chr(13) & "    Incorrect Asset Account #"
 Label8.Caption = ""
 Label10.Visible = True
End Sub

Private Sub Combobox1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
EventOff = True
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ComboBox1.Width = 306
ListBox1.Visible = False
EventOff = False
End Sub

Private Sub CommandButton1_Click()
Dim Tbl As Range, ProductNo As String, I As Long
Application.EnableCancelKey = xlDisabled
 EventOff = False
If ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM" Then
   ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
   Unload Me
   ThisWorkbook.Worksheets("System Menu").Activate
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
  UserForm26.ListBox1.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B2"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("B2").Select
   UserForm26.ListBox1.AddItem "SWITCH to listing by Product Description"
   Do While ActiveCell.Value <> ""
    UserForm26.ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
    ActiveCell.Offset(1, 0).Select
   Loop
  Else
   UserForm26.ListBox1.AddItem "No Record of Stock item"
  End If
  UserForm26.ListBox1.AddItem "CLOSE this box"
  UserForm26.CommandButton18.Visible = False
  If UserForm26.TextBox1.Text = "" Then
    ProductNo = ThisWorkbook.Worksheets("RunningDat").Range("A4")
    If ProductNo <> "" Then
      If IsError(Application.Match(ProductNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
        I = Application.Match(ProductNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
        If I > 1 Then
         UserForm26.TextBox1.Text = ProductNo
         UserForm26.Label6.Caption = MyBook.Worksheets("StockRec").Cells(I, 3).Value
        End If
      End If
    End If
  End If
  UserForm26.Label10.Visible = False
  UserForm26.Show
Else
 Unload Me
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm8.Show
End If
End Sub

Private Sub CommandButton2_Click()
Dim FRow As Long, LRow As Long, I As Long, AssetAcct As String, AcctYear As Long, CheckRange As Range, Tbl As Range
Dim StockQty As Double, StockAmount As Double, ProdDes As String
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ListBox1.Visible = False
If TextBox1.Text = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Stock #"
 Label10.Visible = True
 Exit Sub
End If
If TextBox2.Text = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Product Description"
 Label10.Visible = True
 Exit Sub
End If
StockNo = TextBox1.Text
If ComboBox1.Value = "" Or Label8.Caption = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Asset Account #"
 Label10.Visible = True
 Exit Sub
End If
If Val(TextBox5.Text) < 0 Or Val(TextBox6.Text) < 0 Then
 Label10.Caption = Chr(13) & "    The stock quantity or stock value cannot be negative "
 Label10.Visible = True
 Exit Sub
End If
AssetAcct = ComboBox1.Value
If StockNoExist = "Yes" Then
  If StockAssetAcct <> AssetAcct Then
AskReply1:
    MSG = "The Asset account for this existing Stock Item is changed." + Chr(13) + _
     "On hand value of this stock item will be moved to the new account #" & Chr(13) + _
      Chr(13) & Chr(13) & "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataChange
     If C = "N" Or C = "n" Or C = "" Then GoTo NoSave
    GoTo AskReply1
  Else
AskReply2:
    MSG = "The existing record for this Stock number will be changed." + Chr(13) + _
     Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataUpdate
     If C = "N" Or C = "n" Or C = "" Then GoTo NoSave
    GoTo AskReply2
  End If
DataChange:
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
    If IsError(Application.Match(StockNo, MyBook.Worksheets("Product Data").Columns("I"), 0)) = False Then
      Set Tbl = ActiveSheet.UsedRange
      Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
      Selection.Sort Key1:=Range("I1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Set CheckRange = Selection.Columns("I")
       FRow = Application.Match(StockNo, CheckRange, 0) + 2
       LRow = Application.Match(StockNo, CheckRange, 1) + 2
       Range(Cells(FRow, 8), Cells(LRow, 8)).Value = AssetAcct
    End If
  End If
  MyBook.Worksheets("Supply Data").Activate
  If Range("B3") <> "" Then
    If IsError(Application.Match(StockNo, MyBook.Worksheets("Supply Data").Columns("K"), 0)) = False Then
      Set Tbl = ActiveSheet.UsedRange
      Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
      Selection.Sort Key1:=Range("K1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Set CheckRange = Selection.Columns("K")
       FRow = Application.Match(StockNo, CheckRange, 0) + 2
       LRow = Application.Match(StockNo, CheckRange, 1) + 2
       Range(Cells(FRow, 10), Cells(LRow, 10)).Value = AssetAcct
    End If
  End If
  MyBook.Worksheets("InvDetail1").Activate
  If IsError(Application.Match(StockNo, MyBook.Worksheets("InvDetail1").Columns("A"), 0)) = False Then
    I = Application.Match(StockNo, MyBook.Worksheets("InvDetail1").Columns("A"), 0)
    Range(Cells(I, 5), Cells(I + 1, 5)).NumberFormat = "General"
    Range(Cells(I, 5), Cells(I + 1, 5)).Value = AssetAcct
  End If
   MyBook.Worksheets("StockRec").Activate
  If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)) = False Then
   FRow = Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)
   Cells(FRow, 2).Select
   StockAmount = Round(Cells(FRow, 9).Value, 2)
   If StockAmount <> 0 Then
    ThisWorkbook.Worksheets("TempRP").Activate
    Rows("1:3").ClearContents
    Range("D1:D2").NumberFormat = "yyyy/mm/dd"
    Range("D1:D2").Value = Date
    Range("E1:E2").NumberFormat = "General"
    Range("E1").Value = StockAssetAcct
    Range("E2").Value = AssetAcct
    Range("F1:F2").NumberFormat = "General"
    Range("F1:F2").FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
    Range("F1:F2").NumberFormat = "@"
    Range("F1:F2").Copy
    Range("F1:F2").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
    Range("H1:I2").NumberFormat = "General"
    If StockAmount > 0 Then
     Range("H2").Value = StockAmount
     Range("I1").Value = StockAmount
    Else
     Range("H1").Value = StockAmount
     Range("I2").Value = StockAmount
    End If
     Range("G1:G2").Value = StockNo & " move from Acct # " & StockAssetAcct & " to " & AssetAcct & " on " & Format(Date, "yyyy/mm/dd")
  
    Range("J1:J2").NumberFormat = "@"
    Range("J1:J2").Value = "Stock #" & StockNo
   AcctYear = Int((Period(Date) - Period(BeginningDate)) / 12)
   AcctYear = AcctYear + Year(BeginningDate)
   JournalCode = "SV" & AcctYear
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   JcodeRow = 251
   Set JournalRange = Range("G250")
   If ActiveCell.Offset(1, 0).Value <> "" Then
    Range("G250").End(xlDown).Select
    JcodeRow = ActiveCell.Row + 1
   End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
   Else
    JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
    LastTranNo = Cells(JcodeRow, 8).Value
    LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
    Cells(JcodeRow, 8).Value = LastTranNo
   End If
   LastJournalCode = JournalCode
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(2, 1)).NumberFormat = "@"
   Range(Cells(1, 1), Cells(2, 1)).Value = JournalCode
   Range(Cells(1, 2), Cells(2, 2)).NumberFormat = "@"
   Range(Cells(1, 2), Cells(2, 2)).Value = LastTranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(2, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
   End If
  End If
End If
DataUpdate:
  MyBook.Worksheets("StockRec").Activate
 If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)) = False Then
   FRow = Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)
   Cells(FRow, 2).Select
 Else
  If Range("B2").Value = "" Then
   Range("B2").Select
  Else
   Range("B1").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
  End If
   ActiveCell.NumberFormat = "@"
   ActiveCell.Value = StockNo
   ActiveCell.Offset(0, 6).NumberFormat = "General"
   ActiveCell.Offset(0, 7).NumberFormat = "General"
   ActiveCell.Offset(0, 8).NumberFormat = "General"
   If IsNumeric(TextBox5.Text) = False Or TextBox5.Visible = False Then
     StockQty = 0
   Else
     StockQty = TextBox5.Text
   End If
   If IsNumeric(TextBox6.Text) = False Or TextBox6.Visible = False Then
    StockAmount = 0
   Else
    StockAmount = TextBox6.Text
   End If
   ActiveCell.Offset(0, 6).Value = StockQty
   ActiveCell.Offset(0, 7).Value = StockAmount
   If StockQty <> 0 Then
     ActiveCell.Offset(0, 8).Value = StockAmount / StockQty
   ElseIf ActiveCell.Offset(0, 8).Value = "" Then
     ActiveCell.Offset(0, 8).Value = 0
   End If
   ProdDes = TextBox2.Text
   Call InvStockAdd(AssetAcct, ProdDes)
 End If
MyBook.Worksheets("StockRec").Activate
StockAssetAcct = AssetAcct
ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
ActiveCell.Offset(0, -1).Value = Date
ActiveCell.Offset(0, 1).NumberFormat = "@"
ActiveCell.Offset(0, 1).Value = TextBox2.Text
ActiveCell.Offset(0, 3).NumberFormat = "General"
ActiveCell.Offset(0, 3).Value = StockAssetAcct
ActiveCell.Offset(0, 9).NumberFormat = "@"
ActiveCell.Offset(0, 9).Value = TextBox4.Text
ActiveCell.Offset(0, 10).NumberFormat = "@"
ActiveCell.Offset(0, 10).Value = TextBox3.Text
 StockQty = ActiveCell.Offset(0, 6).Value
 StockAmount = ActiveCell.Offset(0, 7).Value
 ProdDes = ActiveCell.Offset(0, 1).Value
Call InvStockUpdate(StockQty, StockAmount, AssetAcct, ProdDes)
EventOff = True
 For I = 1 To 6
  Controls("Textbox" & I).Text = ""
 Next I
 Label9.Caption = ""
 Label14.Caption = ""
 Label16.Caption = ""
 For I = 18 To 21
  Controls("Label" & I).Caption = ""
 Next I
 For I = 24 To 27
  Controls("Label" & I).Caption = ""
 Next I
 For I = 29 To 32
  Controls("Label" & I).Caption = ""
 Next I
ListBox1.Clear
MyBook.Worksheets("StockRec").Activate
 If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B2"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox1.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Stock item"
 End If
 ListBox1.AddItem "CLOSE this box"
 StockNoExist = ""
 StockNo = ""
 ListBox1.Visible = False
 Label10.Visible = False
 Label11.Visible = False
 CommandButton4.Visible = False
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 ScrollBar1.Visible = False
 ScrollBar2.Visible = False
 ScrollBar3.Visible = False
NoSave:
EventOff = False
End Sub

Private Sub CommandButton3_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
 EventOff = True
 For I = 1 To 6
  Controls("Textbox" & I).Text = ""
 Next I
 Label9.Caption = ""
 Label14.Caption = ""
 Label16.Caption = ""
 For I = 18 To 21
  Controls("Label" & I).Caption = ""
 Next I
 For I = 24 To 27
  Controls("Label" & I).Caption = ""
 Next I
 For I = 29 To 32
  Controls("Label" & I).Caption = ""
 Next I
 StockNoExist = ""
 StockNo = ""
 ListBox1.Visible = False
 Label10.Visible = False
 Label11.Visible = False
 CommandButton4.Visible = False
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 ScrollBar1.Visible = False
 ScrollBar2.Visible = False
 ScrollBar3.Visible = False
 EventOff = False
End Sub

Private Sub CommandButton4_Click()
Dim I As Long, J As Long, BOMCol As Long, Tbl As Range, InvRow As Long
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
If TextBox1.Text = "" Then Exit Sub
 StockNo = TextBox1.Text
If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = True Then GoTo NonStock
 ThisWorkbook.Worksheets("TempRP").Activate
 If Range("B100").Value <> "" Or Range("D100").Value <> "" Or Range("F100").Value <> "" Then
    MsgBox ("This Stock item is linked with either a product, a purchased item or a self-manufactured item" & Chr(13) & Chr(13) & _
     "Thus, deletion is NOT allowed")
    GoTo NoDelete
 End If
  I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
  MyBook.Worksheets("StockRec").Activate
  If Cells(I, 7).Value <> "" And Cells(I, 7).Value <> 0 Then
    MsgBox ("There is still some inventory for this Stock Item number." & Chr(13) & Chr(13) & _
     "Thus, deletion is NOT allowed")
    GoTo NoDelete
  End If
AskReply:
    MSG = "The Stock Item number will be removed from the Record." + Chr(13) + _
     Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataRemoval
     If C = "N" Or C = "n" Or C = "" Then GoTo NoDelete
    GoTo AskReply
DataRemoval:
  MyBook.Worksheets("StockRec").Activate
  Cells(I, 2).EntireRow.Delete
  J = MyBook.Worksheets("InvDetail1").Range("B1").Value
  For I = 1 To J
   ShName = "InvDetail" & I
   MyBook.Worksheets(ShName).Activate
   Set CheckRange = Columns("A")
    If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
     InvRow = Application.Match(StockNo, CheckRange, 0)
     Range(Cells(InvRow, 4), Cells(InvRow + 1, 4)).NumberFormat = "yyyy/mm/dd"
     Range(Cells(InvRow, 4), Cells(InvRow + 1, 4)).Value = Date
    End If
  Next I
  J = MyBook.Worksheets("BOM1").Range("A9").Value
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("B10").Value <> "" Then
    Set CheckRange = Rows("10")
    If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
     BOMCol = Application.Match(StockNo, CheckRange, 0)
     Columns(BOMCol).Delete
     Exit For
    End If
   End If
  Next I
  J = MyBook.Worksheets("BOM1").Range("A9").Value
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("A11").Value <> "" Then
    Set CheckRange = Columns("A")
    If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
     FRow = Application.Match(StockNo, CheckRange, 0)
     Cells(FRow, 1).Select
      ActiveCell.End(xlToRight).Select
      If ActiveCell.Column > 255 Then ActiveCell.EntireRow.Delete
    End If
   End If
  Next I
ListBox1.Clear
MyBook.Worksheets("StockRec").Activate
 If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B2"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox1.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Stock item"
 End If
 ListBox1.AddItem "CLOSE this box"
NonStock:
 EventOff = True
 For I = 1 To 4
  Controls("Textbox" & I).Text = ""
 Next I
 Label9.Caption = ""
 Label14.Caption = ""
 Label16.Caption = ""
 For I = 18 To 21
  Controls("Label" & I).Caption = ""
 Next I
 For I = 24 To 27
  Controls("Label" & I).Caption = ""
 Next I
 For I = 29 To 32
  Controls("Label" & I).Caption = ""
 Next I
 StockNoExist = ""
 StockNo = ""
 ListBox1.Visible = False
 Label10.Visible = False
 Label11.Visible = False
 CommandButton4.Visible = False
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 ScrollBar1.Visible = False
 ScrollBar2.Visible = False
 ScrollBar3.Visible = False
NoDelete:
 EventOff = False
End Sub

Private Sub CommandButton5_Click()
Label10.Visible = False
ListBox1.Visible = True
End Sub

Private Sub CommandButton6_Click()
Dim StartRow As Long, EndRow As Long, Line As Long, I As Long, OpenQty As Double, EndQty As Double, EndAmt As Double, CheckRange As Range
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 If TextBox1.Text = "" Then
   Label10.Caption = Chr(13) & "    Please enter the Stock Number"
   Label10.Visible = True
   Exit Sub
 End If
 If StockNo = "" Then
   Label10.Caption = Chr(13) & "    Invalid Stock Number"
   Label10.Visible = True
   Exit Sub
 End If
  If IsError(Application.Match(StockNo, MyBook.Worksheets("IOData").Columns("E"), 0)) Then
   Label10.Caption = Chr(13) & "    No record of In/Out data for the stock item."
   Label10.Visible = True
   Exit Sub
  End If
 EventOff = True
 Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
 ThisWorkbook.Worksheets("RunningDat").Activate
 ActiveSheet.UsedRange.Delete
 Range("A1").Select
 MyBook.Worksheets("IOData").Activate
  ActiveSheet.UsedRange.Select
  Selection.Offset(1, 0).Resize(Selection.Rows.Count - 1).Select
  Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, _
        Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Selection.Columns("E")
   StartRow = Application.Match(StockNo, CheckRange, 0) + 1
   EndRow = Application.Match(StockNo, CheckRange, 1) + 1
   Range(Cells(StartRow, 1), Cells(EndRow, 256)).Copy
  ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   StartRow = EndRow - StartRow + 1
  Line = StartRow + 5
  I = 1
 Do While I <= StartRow
  Cells(I, 8).Select
  Do While ActiveCell <> ""
   Cells(Line, 1).NumberFormat = "yyyy/mm/dd"
   Cells(Line, 3).NumberFormat = "General"
   Cells(Line, 4).NumberFormat = "General"
   Cells(Line, 6).NumberFormat = "yyyy/mm/dd"
   Cells(Line, 1).Value = ActiveCell.Offset(0, 6).Value
   Cells(Line, 2).Value = ActiveCell.Offset(0, 1).Value
   Cells(Line, 3).Value = ActiveCell.Offset(0, 2).Value
   Cells(Line, 4).Value = ActiveCell.Offset(0, 3).Value
   Cells(Line, 5).Value = ActiveCell.Offset(0, 5).Value
   Cells(Line, 6).Value = ActiveCell.Value
   Line = Line + 1
   ActiveCell.Offset(0, 7).Select
  Loop
  I = I + 1
 Loop
 Range(Cells(StartRow + 5, 1), Cells(Line, 5)).Select
 Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 OpenQty = Application.Sum(Range(Cells(StartRow + 5, 3), Cells(Line, 3)))
 EndQty = Label9.Caption
 EndAmt = Label14.Caption
 OpenQty = EndQty - OpenQty
 Cells(StartRow + 4, 2).Value = "Opening Quantity"
 Cells(StartRow + 4, 3).NumberFormat = "General"
 Cells(StartRow + 4, 3).Value = OpenQty
 Cells(Line + 1, 2).Value = "Closing Value"
 Cells(Line + 1, 3).NumberFormat = "General"
 Cells(Line + 1, 4).NumberFormat = "General"
 Cells(Line + 1, 3).Value = EndQty
 Cells(Line + 1, 4).Value = EndAmt
 Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
    Range("A2").Value = "Stock Movement Detail "
    Range("A4").Value = "Stock # : " & StockNo
    Range("A5").Value = "Item Description : " & TextBox2.Text
    Range("A6").Value = "Report Date : " & Format(Date, "yyyy/mm/dd")
    Range("A8").Value = "In/Out Date"
    Range("A9").Value = "-------------------"
    Range("B8").Value = "Ref"
    Range("B9").Value = "---------------------------"
    Range("C8").Value = "Qty"
    Range("C9").Value = "------------------"
    Range("D7").Value = "Affected Stock Value"
    Range("D8").Value = "(" & SysCurrency & ")"
    Range("D9").Value = "---------------------------"
    Range("E8").Value = "Related Doc #"
    Range("E9").Value = "----------------------"
    Range("F8").Value = "System Entry Date"
    Range("F9").Value = "--------------------------"
    Columns("A").ColumnWidth = 13
    Columns("B").ColumnWidth = 19
    Columns("C").ColumnWidth = 15
    Columns("D").ColumnWidth = 20
    Columns("E").ColumnWidth = 16
    Columns("F").ColumnWidth = 18
    Range("A10").Select
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range(Cells(StartRow + 4, 1), Cells(Line + 1, 6)).Copy
 Worksheets("Report").Activate
 ActiveSheet.Paste
 Application.CutCopyMode = False
  Columns("A").HorizontalAlignment = xlLeft
  Columns("B:C").HorizontalAlignment = xlCenter
  Columns("D").HorizontalAlignment = xlRight
  Columns("D").NumberFormat = "#,##0.00"
  Columns("E").HorizontalAlignment = xlCenter
  Columns("F").HorizontalAlignment = xlLeft
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
   On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
      .Orientation = xlPortrait
      .PrintTitleRows = "$1:$9"
      .LeftMargin = Application.InchesToPoints(0.72)
      .RightMargin = Application.InchesToPoints(0.55)
       .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
    Range("A1:E22").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
    Range("B1").Select
 ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 ThisWorkbook.Worksheets("Report").Activate
 EventOff = False
   Label10.BackColor = &HC0&
 Label10.Visible = False
 Me.Hide
 MyBook.Activate
 ThisWorkbook.Worksheets("Report").Activate
  SheetName = "Report"
  OldForm = "UserForm25"
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, I As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Record of Stock item" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Product Description" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox1.AddItem "SWITCH to listing by Stock #"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Record of Stock item"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Stock #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox1.AddItem "SWITCH to listing by Product Description"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Record of Stock item"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
RowNo = ListBox1.ListIndex + 1
 EventOff = True
StockNo = MyBook.Worksheets("StockRec").Cells(RowNo, 2).Value
TextBox1.Text = StockNo
Call Form25Text1Exit("StockUpdate")
  ListBox1.Visible = False
 If StockNoExist = "Yes" Then
  StockAssetAcct = ComboBox1.Value
 Else
  StockAssetAcct = ""
 End If
  EventOff = False
End Sub

Private Sub ScrollBar1_Change()
 Dim LineNo As Long, I As Long
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
  Label18.Caption = Cells(LineNo + 99, 2)
  Label19.Caption = Cells(LineNo + 100, 2)
  Label20.Caption = Cells(LineNo + 101, 2)
  Label21.Caption = Cells(LineNo + 102, 2)
End Sub

Private Sub ScrollBar2_Change()
 Dim LineNo As Long, I As Long
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar2.Value
 ThisWorkbook.Worksheets("TempRP").Activate
  Label24.Caption = Cells(LineNo + 99, 4)
  Label25.Caption = Cells(LineNo + 100, 4)
  Label26.Caption = Cells(LineNo + 101, 4)
  Label27.Caption = Cells(LineNo + 102, 4)
End Sub

Private Sub ScrollBar3_Change()
Dim LineNo As Long, I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar3.Value
 ThisWorkbook.Worksheets("TempRP").Activate
  Label29.Caption = Cells(LineNo + 99, 6)
  Label30.Caption = Cells(LineNo + 100, 6)
  Label31.Caption = Cells(LineNo + 101, 6)
  Label32.Caption = Cells(LineNo + 102, 6)
End Sub

Private Sub TextBox1_AfterUpdate()
Dim RowNo As Long, I As Long, J As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
If TextBox1.Text = "" Then GoTo NoInput
StockNo = TextBox1.Text
If Left(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = 1
 Do While J <= I And Mid(StockNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then GoTo NoInput
  StockNo = Right(StockNo, I - J + 1)
End If
If Right(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = I
 Do While J > 0 And Mid(StockNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then GoTo NoInput
  StockNo = Left(StockNo, J)
End If
 EventOff = True
StockNo = UCase(StockNo)
TextBox1.Text = StockNo
  MyBook.Worksheets("StockRec").Activate
 Call Form25Text1Exit("StockUpdate")
 If StockNoExist = "Yes" Then
  StockAssetAcct = ComboBox1.Value
 Else
  StockAssetAcct = ""
 End If
 EventOff = False
Exit Sub
NoInput:
 EventOff = True
 StockNo = ""
 StockNoExist = ""
 Label9.Caption = ""
 Label14.Caption = ""
 Label16.Caption = ""
 Label11.Visible = False
 Label12.Visible = False
 For I = 18 To 21
  Controls("Label" & I).Caption = ""
 Next I
 For I = 24 To 27
  Controls("Label" & I).Caption = ""
 Next I
 For I = 29 To 32
  Controls("Label" & I).Caption = ""
 Next I
CommandButton4.Visible = False
ScrollBar1.Visible = False
ScrollBar2.Visible = False
ScrollBar3.Visible = False
EventOff = False
End Sub

Private Sub TextBox1_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 CommandButton4.Visible = False
 ScrollBar1.Visible = False
 ScrollBar2.Visible = False
 ScrollBar3.Visible = False
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
 Dim CheckNum As Double, Amount As Double
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
If TextBox5.Text = "" Then TextBox5.Text = 0
If IsNumeric(TextBox5.Text) = False Then
   TextBox5.Text = 0
   Label10.Caption = Chr(13) & "    Incorrect Quantity Entered"
   Label10.Visible = True
  Exit Sub
End If
 CheckNum = Format(TextBox5.Text, "0.0000")
 TextBox5.Text = CheckNum
If CheckNum < 0 Then
   TextBox5.Text = 0
   TextBox6.Text = 0
   Label10.Caption = Chr(13) & "    Negative Stock Quantity is not allowed "
   Label10.Visible = True
  Exit Sub
End If
If CheckNum <> 0 Then
  Amount = TextBox6.Text
  Label16.Caption = Round(Amount / CheckNum, 4)
ElseIf TextBox5.Text = 0 And TextBox6.Text <> 0 Then
    TextBox6.Text = 0
    Label10.Caption = Chr(13) & "   There is no Stock Qty, the value entered must be zero"
    Label10.Visible = True
End If
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
 Dim CheckNum As Double
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
If TextBox6.Text = "" Then TextBox6.Text = 0
If IsNumeric(TextBox6.Text) = False Then
   TextBox6.Text = 0
   Label10.Caption = Chr(13) & "    Incorrect Value Entered"
   Label10.Visible = True
  Exit Sub
End If
 CheckNum = Format(TextBox6.Text, "0.00")
 TextBox6.Text = Format(CheckNum, "#,##0.00")
If CheckNum < 0 Then
   TextBox6.Text = 0
   Label10.Caption = Chr(13) & "    Negative Stock Value is not allowed "
   Label10.Visible = True
  Exit Sub
End If
If IsNumeric(TextBox5.Text) = True Then
 If TextBox5.Text <> 0 Then
  Label16.Caption = Round(CheckNum / TextBox5.Text, 4)
 ElseIf TextBox5.Text = 0 And TextBox6.Text <> 0 Then
    TextBox6.Text = 0
    Label10.Caption = Chr(13) & "   There is no Stock Qty, the value entered must be zero"
    Label10.Visible = True
 End If
Else
  TextBox6.Text = 0
  Label10.Caption = Chr(13) & "   There is no Stock Qty, the value entered must be zero"
  Label10.Visible = True
End If
End Sub

Private Sub UserForm_Initialize()
Dim Tbl As Range, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.Clear
MyBook.Worksheets("StockRec").Activate
 If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B2"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox1.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Stock item"
 End If
 ListBox1.AddItem "CLOSE this box"
ComboBox1.Clear
L = 10
M = LastRowChartofAccount
ThisWorkbook.Activate
For I = L To M
If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 1 Then
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ----"
spacing = Left(spacing, 6 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ComboBox1.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
End If
Next I
Label13.Caption = "Total Value (" & SysCurrency & ") : "
Label15.Caption = "Average Unit Cost (" & SysCurrency & ") : "
 Label11.Visible = False
 StockNoExist = ""
 StockAssetAcct = ""
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
End If
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
Application.EnableCancelKey = xlDisabled
If CloseMode = vbFormControlMenu Then
 ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
 EventOff = True
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
End If
EventOff = False
End Sub
Attribute VB_Name = "UserForm26"
Attribute VB_Base = "0{47C955CA-D490-46C6-8152-9E3CBBD990AD}{28FC6983-B653-4552-9CA2-37D6F59D435A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public BOMRow As Long, NewProduct As String, NewProductName As String
Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = False
 Unload Me
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton17_Click()
Dim I As Long, J As Long, C As String, CheckRange As Range
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
 If TextBox1.Text = "" Then Exit Sub
 StockNo = TextBox1.Text
 ThisWorkbook.Worksheets("RunningDat").Activate
If Range("A1").Value <> "" Then
  ShName = Range("A1").Value
  BOMCol = Range("A2").Value
  MyBook.Worksheets(ShName).Activate
  If Cells(10, BOMCol).Value = StockNo Then
AskReply:
 MSG = "The BOM for " & StockNo & " will be removed from the Record." + _
 Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
DataRemoval:
  Columns(BOMCol).Delete
  GoTo ClearSheet
  End If
End If
  J = MyBook.Worksheets("BOM1").Range("A9").Value
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("B10").Value <> "" Then
    If IsError(Application.Match(StockNo, MyBook.Worksheets(ShName).Range("B10:IV10"), 0)) = False Then
     BOMCol = Application.Match(StockNo, MyBook.Worksheets(ShName).Range("B10:IV10"), 0) + 1
     GoTo AskReply
    End If
   End If
  Next I
ClearSheet:
  Label10.Visible = False
  MyBook.Worksheets("StockRec").Activate
  If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
    I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
    Cells(I, 7).ClearContents
    If Cells(I, 1).Value < Date Then Cells(I, 1).Value = Date
  End If
   ThisWorkbook.Worksheets("RunningDat").Activate
   LastBOMRow = Range("A3").Value
   MyBook.Worksheets(ShName).Activate
   Set CheckRange = Range(Cells(11, 1), Cells(LastBOMRow, 1))
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A11").Select
   Do While ActiveCell.Value <> ""
    StockNo = ActiveCell.Value
    MyBook.Worksheets(ShName).Activate
    If IsError(Application.Match(StockNo, CheckRange, 0)) = False Then
     I = Application.Match(StockNo, CheckRange, 0) + 10
     Cells(I, 1).End(xlToRight).Select
     If ActiveCell.Column > 255 Then ActiveCell.EntireRow.Delete
    End If
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveCell.Offset(1, 0).Select
   Loop
  ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
  EventOff = True
  TextBox1.Text = ""
  For I = 4 To 28
   Controls("TextBox" & I).Text = ""
  Next I
  For I = 30 To 41
   Controls("Label" & I).Caption = ""
  Next I
  Label6.Caption = ""
  For I = 15 To 26
   Controls("Label" & I).Caption = I - 14
  Next I
  Label4.Visible = False
  CommandButton17.Visible = False
  CommandButton18.Visible = False
   ScrollBar1.Max = 7
   ScrollBar1.Value = 1
   Label42.Visible = False
   TextBox29.Visible = False
   CommandButton20.Visible = False
   CommandButton19.Visible = False
 ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
  EventOff = False
End Sub
Private Sub CommandButton18_Click()
Application.EnableCancelKey = xlDisabled
 Me.Hide
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm25.TextBox1.Text = StockNo
 UserForm25.Show
End Sub
Private Sub CommandButton19_Click()
Dim I As Long, J As Long, K As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label10.Visible = False
 Label42.Visible = True
 TextBox29.Text = ""
 TextBox29.Visible = True
 CommandButton20.Visible = True
 CommandButton19.Visible = False
  ThisWorkbook.Worksheets("RunningDat").Activate
  Columns("I").ClearContents
  Range("I1").Select
  J = MyBook.Worksheets("BOM1").Range("A9").Value
   For I = 1 To J
    ShName = "BOM" & I
    MyBook.Worksheets(ShName).Activate
    If Range("B10").Value <> "" Then
       If Range("C10").Value = "" Then
         Range("B10").Copy
       Else
        K = Range("B10").End(xlToRight).Column
        Range(Cells(10, 2), Cells(10, K)).Copy
       End If
       ThisWorkbook.Worksheets("RunningDat").Activate
       Selection.PasteSpecial Paste:=xlAll, Operation:=xlNone, SkipBlanks:=False _
        , Transpose:=True
       If ActiveCell.Offset(1, 0).Value = "" Then
         ActiveCell.Offset(1, 0).Select
       Else
        ActiveCell.End(xlDown).Select
        ActiveCell.Offset(1, 0).Select
       End If
    End If
   Next I
 K = ActiveCell.Row - 1
 If K > 0 Then
  Range(Cells(1, 9), Cells(K, 9)).Select
    Selection.Sort Key1:=Range("I1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   ListBox2.Clear
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("I1").Select
   Do While ActiveCell.Value <> ""
    ListBox2.AddItem ActiveCell.Value
    ActiveCell.Offset(1, 0).Select
   Loop
   ListBox2.AddItem "CLOSE this box"
 Else
  ListBox2.Clear
  ListBox2.AddItem "No Record of Manufactured Product"
   ListBox2.AddItem "CLOSE this box"
 End If
 TextBox29.SetFocus
 EventOff = False
End Sub
Private Sub CommandButton2_Click()
Dim I As Long, J As Long, LastRow As Long, ShName As String, BOMCol As Long, Qty As Double, C As String
Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 If TextBox1.Text = "" Then Exit Sub
 ThisWorkbook.Worksheets("RunningDat").Activate
 If Range("A11") = "" Then
    Label10.Caption = Chr(13) & "     No component entered in the BOM"
    Label10.Visible = True
    Exit Sub
 End If
 Range("A11").Select
 Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 2).Value = "" Then
     Label10.Caption = Chr(13) & "     The required quantity of some components has not been inputted"
     Label10.Visible = True
     Exit Sub
   ElseIf IsNumeric(ActiveCell.Offset(0, 2).Value) = False Then
     Label10.Caption = Chr(13) & "     The required quantity of some components has not been properly inputted"
     Label10.Visible = True
     Exit Sub
   ElseIf ActiveCell.Offset(0, 2).Value = 0 Then
     Label10.Caption = Chr(13) & "     Some components were inputted with zero quantity which is not allowed. " & Chr(13) & _
                                 "     Please amend the quantity or delete the component item from the BOM "
     Label10.Visible = True
     Exit Sub
   End If
   ActiveCell.Offset(1, 0).Select
 Loop
 LastRow = ActiveCell.Row - 1
 StockNo = TextBox1.Text
If Range("A1").Value <> "" Then
  ShName = Range("A1").Value
  BOMCol = Range("A2").Value
  MyBook.Worksheets(ShName).Activate
  If Cells(10, BOMCol).Value = StockNo Then
AskReply:
 MSG = "Changes were made to the BOM." + Chr(13) + _
 Chr(13) + "OLD BOM with the same Stock number will be updated" + _
 Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
DataRemoval:
  Columns(BOMCol).Select
  Selection.Resize(Selection.Rows.Count - 10, 1).Offset(10, 0).ClearContents
  GoTo DataUpdate
  End If
End If
  J = MyBook.Worksheets("BOM1").Range("A9").Value
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("B10").Value <> "" Then
    If IsError(Application.Match(StockNo, MyBook.Worksheets(ShName).Range("B10:IV10"), 0)) = False Then
     BOMCol = Application.Match(StockNo, MyBook.Worksheets(ShName).Range("B10:IV10"), 0) + 1
     GoTo AskReply
    End If
   End If
  Next I
  BOMCol = 0
  For I = 1 To J
   ShName = "BOM" & I
   MyBook.Worksheets(ShName).Activate
   If Range("B10").Value <> "" Then
    Range("A10").End(xlToRight).Select
    If ActiveCell.Column < 250 Then
      BOMCol = ActiveCell.Column + 1
      Exit For
    End If
   Else
    BOMCol = 2
    Exit For
   End If
  Next I
 If BOMCol = 0 Then
    Application.DisplayAlerts = False
    Sheets.Add After:=Worksheets(ShName)
    ActiveSheet.Name = "BOM" & J + 1
    ShName = ActiveSheet.Name
    Application.DisplayAlerts = True
    MyBook.Worksheets("BOM1").Activate
    Range("A9").NumberFormat = "General"
    Range("A9").Value = J + 1
    Range("A1:A10").Copy
    MyBook.Worksheets(ShName).Activate
    Range("A1").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range(Cells(10, 1), Cells(10, 1).End(xlDown)).NumberFormat = "@"
    Range(Cells(10, 1), Cells(10, 1).End(xlToRight)).NumberFormat = "@"
    Cells(1, 1).Select
    BOMCol = 2
 End If
    Cells(2, BOMCol).NumberFormat = "yyyy/mm/dd"
    Cells(2, BOMCol).Value = Date
DataUpdate:
  Cells(3, BOMCol).NumberFormat = "yyyy/mm/dd"
  Cells(3, BOMCol).Value = Date
  Cells(4, BOMCol).NumberFormat = "@"
  Cells(4, BOMCol).Value = TextBox4.Text
  Cells(10, BOMCol).NumberFormat = "@"
  Cells(10, BOMCol).Value = TextBox1.Text
  If Range("A11").Value = "" Then
    LastRow = 10
  Else
     Range("A10").End(xlDown).Select
    LastRow = ActiveCell.Row
  End If
  MyBook.Worksheets("StockRec").Activate
  If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
    I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
    Cells(I, 7).Value = "Yes"
    If Cells(I, 1).Value < Date Then Cells(I, 1).Value = Date
  End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  Range("A11").Select
  Do While ActiveCell.Value <> ""
    StockNo = ActiveCell.Value
    Qty = ActiveCell.Offset(0, 2).Value
    MyBook.Worksheets(ShName).Activate
    If LastRow < 11 Then
      LastRow = LastRow + 1
      Cells(LastRow, 1).NumberFormat = "@"
      Cells(LastRow, BOMCol).NumberFormat = "General"
      Cells(LastRow, 1).Value = StockNo
      Cells(LastRow, BOMCol).Value = Qty
    ElseIf IsError(Application.Match(StockNo, Range(Cells(11, 1), Cells(LastRow, 1)), 0)) = False Then
      I = Application.Match(StockNo, Range(Cells(11, 1), Cells(LastRow, 1)), 0) + 10
      Cells(I, BOMCol).NumberFormat = "General"
      Cells(I, BOMCol).Value = Qty
    Else
     LastRow = LastRow + 1
     Cells(LastRow, 1).NumberFormat = "@"
     Cells(LastRow, BOMCol).NumberFormat = "General"
     Cells(LastRow, 1).Value = StockNo
     Cells(LastRow, BOMCol).Value = Qty
    End If
    ThisWorkbook.Worksheets("RunningDat").Activate
    ActiveCell.Offset(1, 0).Select
  Loop
  ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
  EventOff = True
  Label10.Visible = False
  TextBox1.Text = ""
  For I = 4 To 28
   Controls("TextBox" & I).Text = ""
  Next I
  For I = 30 To 41
   Controls("Label" & I).Caption = ""
  Next I
  Label6.Caption = ""
  For I = 15 To 26
   Controls("Label" & I).Caption = I - 14
  Next I
  Label4.Visible = False
  CommandButton17.Visible = False
  CommandButton18.Visible = False
   ScrollBar1.Max = 7
   ScrollBar1.Value = 1
   Label42.Visible = False
   TextBox29.Visible = False
   CommandButton20.Visible = False
   CommandButton19.Visible = False
   ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
  EventOff = False
End Sub
Private Sub CommandButton20_Click()
ListBox1.Visible = False
ListBox2.Visible = True
Label10.Visible = False
End Sub
Private Sub CommandButton21_Click()
Dim LastBOMRow As Long, I As Long
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 If TextBox1.Text = "" Then
    Label10.Caption = Chr(13) & "     Please enter the stock number for BOM printing "
    Label10.Visible = True
   Exit Sub
 End If
  Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
ThisWorkbook.Worksheets("Report").Activate
ActiveSheet.UsedRange.Delete
Columns("A").ColumnWidth = 8.5
Columns("B").ColumnWidth = 20
Columns("C").ColumnWidth = 45
Columns("D").ColumnWidth = 12
Columns("A").HorizontalAlignment = xlCenter
Columns("B:C").HorizontalAlignment = xlLeft
Columns("D").HorizontalAlignment = xlCenter
Columns("A:D").Select
With Selection.Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
End With
Range("A1:A5").HorizontalAlignment = xlLeft
Columns("A:C").NumberFormat = "@"
Columns("D").NumberFormat = "General"
Range("A1").Value = "Print Date : " & Format(Date, "yyyy/mm/dd")
Range("A3").Value = "BOM for " & TextBox1.Text & " ( " & Label6.Caption & " )"
If TextBox4.Value <> "" Then
  Range("A4").Value = "   (" & "Rev : " & TextBox4.Text & "   " & Label4.Caption & " )"
Else
  Range("A4").Value = "   ( " & Label4.Caption & " )"
End If
Range("A6").Value = "Item # "
Range("A7").Value = "---------"
Range("B6").Value = "Component # "
Range("B7").Value = "---------------------------"
Range("C6").Value = "Component Description"
Range("C7").Value = "---------------------------------------------------------------"
Range("D6").Value = "Qty Used"
Range("D7").Value = "----------"
Range("B8").Select
Worksheets("RunningDat").Activate
  If Range("A11").Value = "" Then
    LastBOMRow = 10
  ElseIf Range("A12").Value = "" Then
    LastBOMRow = 11
  Else
     Range("A11").End(xlDown).Select
    LastBOMRow = ActiveCell.Row
  End If
If LastBOMRow < 11 Then GoTo NoComponent
Range(Cells(11, 1), Cells(LastBOMRow, 3)).Copy
Worksheets("Report").Activate
Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
Application.CutCopyMode = False
Range("B8").Select
I = 1
Do While ActiveCell.Value <> ""
 ActiveCell.Offset(0, -1).Value = I
 I = I + 1
 ActiveCell.Offset(1, 0).Select
Loop
NoComponent:
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
Worksheets("System Menu").Visible = xlSheetVeryHidden
 Label10.BackColor = &HC0&
 Label10.Visible = False
Me.Hide
ThisWorkbook.Worksheets("Report").Activate
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
         .Orientation = xlPortrait
        .PrintTitleRows = "$1:$7"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
     Range("A1:E16").Select
    Range("D16").Activate
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
    Range("C1").Select
   SheetName = "Report"
   OldForm = "UserForm26"
   Application.EnableEvents = True
End Sub
Private Sub CommandButton3_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
EventOff = True
TextBox1.Text = ""
For I = 4 To 28
 Controls("TextBox" & I).Text = ""
Next I
For I = 30 To 41
 Controls("Label" & I).Caption = ""
Next I
Label6.Caption = ""
For I = 15 To 26
 Controls("Label" & I).Caption = I - 14
Next I
Label4.Visible = False
CommandButton17.Visible = False
CommandButton18.Visible = False
 ScrollBar1.Max = 7
 ScrollBar1.Value = 1
 Label42.Visible = False
 TextBox29.Visible = False
 CommandButton20.Visible = False
 CommandButton19.Visible = False
EventOff = False
End Sub
Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
 BOMRow = 1
 ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton5_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 5
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 6
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton7_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 7
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton8_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 8
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton9_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 9
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton10_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 10
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton11_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 11
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton12_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 12
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton13_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 13
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton14_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 14
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton15_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 15
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub CommandButton16_Click()
Application.EnableCancelKey = xlDisabled
BOMRow = 16
ListBox1.Visible = True
 ListBox2.Visible = False
 CommandButton19.Visible = False
 CommandButton20.Visible = False
 TextBox29.Visible = False
 Label42.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, I As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Record of Stock item" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Product Description" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox1.AddItem "SWITCH to listing by Stock #"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Record of Stock item"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Stock #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox1.AddItem "SWITCH to listing by Product Description"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Record of Stock item"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
RowNo = ListBox1.ListIndex + 1
StockNo = MyBook.Worksheets("StockRec").Cells(RowNo, 2).Value
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
EventOff = True
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 If BOMRow > 4 Then
   If Controls("Textbox" & BOMRow).Text <> "" Then
     Controls("Textbox" & BOMRow + 12).SetFocus
   Else
     I = BOMRow - 1
     Do While I > 4
      If Controls("Textbox" & I) <> "" Then
       Controls("Textbox" & I + 12).SetFocus
       Exit Do
      End If
      I = I - 1
     Loop
   End If
 End If
 EventOff = False
End Sub
Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Then
 ListBox2.Visible = False
 Exit Sub
End If
If ListBox2.Text = "No Record of Manufactured Product" Then
 ListBox2.Visible = False
 Exit Sub
End If
StockNo = ListBox2.Text
EventOff = True
ListBox2.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text29Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub ScrollBar1_Change()
Dim LineNo As Long
Application.EnableCancelKey = xlDisabled
LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
   Controls("Label" & I + 14).Caption = I + LineNo - 1
   Controls("TextBox" & I + 4).Text = Cells(9 + LineNo + I, 1).Value
   Controls("Label" & I + 29).Caption = Cells(9 + LineNo + I, 2).Value
   Controls("TextBox" & I + 16).Text = Cells(9 + LineNo + I, 3).Value
  Next I
End Sub
Private Sub TextBox1_AfterUpdate()
Dim RowNo As Long, I As Long, J As Long
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label10.Visible = False
 BOMRow = 1
 StockNo = TextBox1.Text
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Text1Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox1_Change()
Application.EnableCancelKey = xlDisabled
 CommandButton17.Visible = False
 CommandButton18.Visible = False
End Sub
Private Sub TextBox1_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
 Call Form26TextChange("")
End Sub
Private Sub TextBox17_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 17
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox17_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox17_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox17_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyUp Then
  BOMRow = 17
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
  Call Form26Col3Exit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox18.SetFocus
      SendKeys "{Up}", False
 End If
  EventOff = False
End Sub
Private Sub TextBox18_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox18_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox18_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 18
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox19_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 19
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox19_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox19_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox20_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 20
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox20_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox20_Enter()
 If EventOff = True Then Exit Sub
 Call Form26TextEnter("")
End Sub
Private Sub TextBox21_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 21
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox21_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox21_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox22_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 22
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox22_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox22_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox23_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 23
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox23_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox23_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox24_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 24
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox24_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox24_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox25_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 25
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox25_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox25_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox26_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 26
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox26_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox26_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox27_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 27
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox27_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox27_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox28_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 BOMRow = 28
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Col3Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox28_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox28_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox28_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 If KeyCode = vbKeyDown Then
    BOMRow = 28
    ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
    Call Form26Col3Exit(BOMRow)
    ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox27.SetFocus
      SendKeys "{Down}", False
 End If
  EventOff = False
End Sub
Private Sub TextBox29_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
 StockNo = TextBox29.Text
 EventOff = True
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
 Call Form26Text29Exit(BOMRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
 End Sub
Private Sub TextBox29_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
   CommandButton20.Visible = False
End Sub
Private Sub TextBox29_Enter()
 ListBox1.Visible = False
 ListBox2.Visible = False
End Sub
Private Sub TextBox4_Enter()
 ListBox1.Visible = False
 ListBox2.Visible = False
End Sub
Private Sub TextBox5_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 5
StockNo = TextBox5.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox5_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox5_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox5_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
  BOMRow = 5
  StockNo = TextBox5.Text
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
  Call Form26Text1Exit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox6.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub
Private Sub TextBox6_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 6
StockNo = TextBox6.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox6_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox6_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox7_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 7
StockNo = TextBox7.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox7_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox7_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox8_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 8
StockNo = TextBox8.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox8_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox8_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox9_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 9
StockNo = TextBox9.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox9_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox9_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox10_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 10
StockNo = TextBox10.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox10_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox10_Enter()
 If EventOff = True Then Exit Sub
 Call Form26TextEnter("")
End Sub
Private Sub TextBox11_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 11
StockNo = TextBox11.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox11_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox11_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox12_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 12
StockNo = TextBox12.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox12_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox12_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox13_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 13
StockNo = TextBox13.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
   EventOff = False
End Sub
Private Sub TextBox13_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox13_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox14_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 14
StockNo = TextBox14.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox14_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox14_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox15_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 15
StockNo = TextBox15.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox15_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox15_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox16_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 16
StockNo = TextBox16.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
Call Form26Text1Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub
Private Sub TextBox16_Change()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextChange("")
End Sub
Private Sub TextBox16_Enter()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 Call Form26TextEnter("")
End Sub
Private Sub TextBox16_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyDown Then
  BOMRow = 16
  StockNo = TextBox16.Text
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BOM"
  Call Form26Text1Exit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox15.SetFocus
     SendKeys "{Down}", False
 End If
 EventOff = False
End Sub
Private Sub UserForm_Initialize()
Dim Tbl As Range, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ThisWorkbook.Worksheets("RunningDat").Activate
ActiveSheet.UsedRange.Delete
ListBox1.Clear
MyBook.Worksheets("StockRec").Activate
 If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B2"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox1.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Stock item"
 End If
 ListBox1.AddItem "CLOSE this box"
   ScrollBar1.Max = 7
   ScrollBar1.Value = 1
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
End If
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
Application.EnableCancelKey = xlDisabled
If CloseMode = vbFormControlMenu Then
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = True
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
End If
EventOff = False
End Sub

Attribute VB_Name = "UserForm27"
Attribute VB_Base = "0{DDB1F0FB-09D6-4FB1-8038-37E2F814F62A}{89000494-5080-4BE0-A845-2CD2985D96CF}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public BOMRow As Long, NewProduct As String, NewProductName As String

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = False
 Unload Me
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton2_Click()
Dim I As Long, AdjustQty As Double, AdjustAmt As Double, RecordNo As String, AdjustDate As Date, StockQty As Double
Dim LastRowNo As Long, AccountNo As String, TotalSum As Double, LineNo As Long, DataRow As Long
Dim QtySum As Double, AmtSum As Double, AssetNo As String
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C101").Select
If ActiveCell.Value = "" Then GoTo Finish
If IsDate(TextBox53.Text) = False Then
   Label10.Caption = Chr(13) & "    Please enter the date."
   Label10.Visible = True
   Exit Sub
End If
Do While ActiveCell.Value <> ""
 If ActiveCell.Offset(0, 5).Value = "" Or ActiveCell.Offset(0, 7).Value = "" Then
  If ActiveCell.Offset(0, 5).Value = "" Then
    Label10.Caption = "    The Adjusted Quantity of some items are not properly entered." & Chr(13) & _
                     "    Please double check the data before proceed." & Chr(13) & _
                     "    Enter '0' in case no change to the quantity. "
    Label10.Visible = True
    Exit Sub
  ElseIf ActiveCell.Offset(0, 7).Value = "" Then
    Label10.Caption = "    The Affected Account number for some items are not entered." & Chr(13) & _
                     "    Please double check the data before proceed."
    Label10.Visible = True
    Exit Sub
  End If
 ElseIf ActiveCell.Offset(0, 5).Value = 0 Then
   If ActiveCell.Offset(0, 6).Value = 0 Or ActiveCell.Offset(0, 6).Value = "" Then
     Label10.Caption = "    The Adjusted Quantity and the Adjusted Amount of some items are both zero." & Chr(13) & _
                     "    Please double check the data before proceed."
     Label10.Visible = True
     Exit Sub
   End If
 End If
 ActiveCell.Offset(1, 0).Select
Loop
LastRowNo = ActiveCell.Row - 1
 RecordNo = TextBox2.Text
 AdjustDate = TextBox53.Text
 Range("C101").Select
 ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
 Do While ActiveCell.Value <> ""
  StockNo = ActiveCell.Value
  AdjustQty = ActiveCell.Offset(0, 5).Value
  AdjustAmt = ActiveCell.Offset(0, 6).Value
    If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
      I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
       MyBook.Worksheets("StockRec").Cells(I, 8).Value = Format(StockQty + AdjustQty, "0.0000")
       MyBook.Worksheets("StockRec").Cells(I, 9).Value = Format(MyBook.Worksheets("StockRec").Cells(I, 9).Value + AdjustAmt, "0.00")
       If MyBook.Worksheets("StockRec").Cells(I, 1).Value < AdjustDate Then MyBook.Worksheets("StockRec").Cells(I, 1).Value = AdjustDate
      If MyBook.Worksheets("StockRec").Cells(I, 8).Value <> 0 Then _
          MyBook.Worksheets("StockRec").Cells(I, 10).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value / MyBook.Worksheets("StockRec").Cells(I, 8).Value
          QtySum = MyBook.Worksheets("StockRec").Cells(I, 8).Value
          AmtSum = MyBook.Worksheets("StockRec").Cells(I, 9).Value
          AssetNo = MyBook.Worksheets("StockRec").Cells(I, 5).Value
      If AdjustQty <> 0 Or AdjustAmt <> 0 Then
       Call InvIOAdd(AdjustQty, AdjustAmt, AdjustDate, QtySum, AmtSum, AssetNo)
       Call IOUpdate(AdjustQty, AdjustAmt, RecordNo, AdjustDate, "Adj", StockQty)
      End If
    End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveCell.Offset(1, 0).Select
 Loop
 ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.UsedRange.Delete
 Range("E1").Select
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range(Cells(101, 2), Cells(LastRowNo, 10)).Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.Paste
 Cells(LastRowNo - 99, 5).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range(Cells(1, 13), Cells(LastRowNo - 100, 13)).Copy
 Range("E1").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range(Cells(1, 11), Cells(LastRowNo - 100, 11)).FormulaR1C1 = "=SUM(RC[1]*-1)"
 Range(Cells(1, 11), Cells(LastRowNo - 100, 11)).Copy
 Cells(1, 12).Select
    Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Columns("M").Delete
  Columns("H:K").Delete
  Range(Cells(1, 5), Cells((LastRowNo - 100) * 2, 8)).Select
  Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("E1").Select
   Do While ActiveCell.Value <> ""
    TotalSum = ActiveCell.Offset(0, 3).Value
    AccountNo = ActiveCell.Value
    Do While ActiveCell.Offset(1, 0).Value = AccountNo
     TotalSum = TotalSum + ActiveCell.Offset(1, 3).Value
     ActiveCell.Offset(1, 0).EntireRow.Delete
    Loop
    TotalSum = Format(TotalSum, "0.00")
    If Abs(TotalSum) < 0.001 Then
      ActiveCell.EntireRow.Delete
    Else
      If TotalSum >= 0 Then
       ActiveCell.Offset(0, 3).Value = TotalSum
       ActiveCell.Offset(0, 4).ClearContents
      Else
       ActiveCell.Offset(0, 4).Value = Format(TotalSum * (-1), "0.00")
       ActiveCell.Offset(0, 3).ClearContents
      End If
      ActiveCell.Offset(1, 0).Select
    End If
   Loop
   LastRowNo = ActiveCell.Row - 1
  If LastRowNo < 1 Then GoTo NoGLEntry
  Range(Cells(1, 6), Cells(LastRowNo, 6)).NumberFormat = "General"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).NumberFormat = "@"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).Copy
  Range(Cells(1, 6), Cells(LastRowNo, 6)).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  Range(Cells(1, 10), Cells(LastRowNo, 10)).NumberFormat = "@"
  Range(Cells(1, 10), Cells(LastRowNo, 10)).Value = RecordNo
  Range(Cells(1, 7), Cells(LastRowNo, 7)).Value = "Inventory Adjustment # " & RecordNo
  Range(Cells(1, 4), Cells(LastRowNo, 4)).NumberFormat = "yyyy/mm/dd"
  Range(Cells(1, 4), Cells(LastRowNo, 4)).Value = AdjustDate
   AcctYear = Int((Period(AdjustDate) - Period(BeginningDate)) / 12)
   AcctYear = AcctYear + Year(BeginningDate)
   JournalCode = "SV" & AcctYear
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   JcodeRow = 251
   Set JournalRange = Range("G250")
   If ActiveCell.Offset(1, 0).Value <> "" Then
    Range("G250").End(xlDown).Select
    JcodeRow = ActiveCell.Row + 1
   End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
   Else
    JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
    LastTranNo = Cells(JcodeRow, 8).Value
    LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
    Cells(JcodeRow, 8).Value = LastTranNo
   End If
   LastJournalCode = JournalCode
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(LastRowNo, 1)).NumberFormat = "@"
   Range(Cells(1, 1), Cells(LastRowNo, 1)).Value = JournalCode
   Range(Cells(1, 2), Cells(LastRowNo, 2)).NumberFormat = "@"
   Range(Cells(1, 2), Cells(LastRowNo, 2)).Value = LastTranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(LastRowNo, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
NoGLEntry:
   P = Period(AdjustDate) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
 MyBook.Worksheets("StockAdRec").Activate
 Range("A1").End(xlDown).Select
 DataRow = ActiveCell.Row
 LineNo = 0
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range("C101").Select
 Do While ActiveCell.Value <> ""
  LineNo = LineNo + 1
  MyBook.Worksheets("StockAdRec").Activate
  Cells(DataRow + LineNo, 1).NumberFormat = "@"
  Cells(DataRow + LineNo, 1).Value = RecordNo
  Cells(DataRow + LineNo, 2).NumberFormat = "yyyy/mm/dd"
  Cells(DataRow + LineNo, 2).Value = AdjustDate
  Range(Cells(DataRow + LineNo, 3), Cells(DataRow, 4)).NumberFormat = "General"
  Cells(DataRow + LineNo, 3).Value = LineNo
  I = 1
  ThisWorkbook.Worksheets("RunningDat").Activate
  Do While ActiveCell.Value <> ""
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) - 1).NumberFormat = "General"
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I)).NumberFormat = "@"
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 1).NumberFormat = "General"
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 2).NumberFormat = "General"
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 3).NumberFormat = "General"
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 4).NumberFormat = "General"
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) - 1).Value = ActiveCell.Offset(0, -1).Value
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I)).Value = ActiveCell.Value
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 1).Value = ActiveCell.Offset(0, 2).Value
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 2).Value = ActiveCell.Offset(0, 5).Value
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 3).Value = ActiveCell.Offset(0, 6).Value
    MyBook.Worksheets("StockAdRec").Cells(DataRow + LineNo, (6 * I) + 4).Value = ActiveCell.Offset(0, 7).Value
   I = I + 1
   ActiveCell.Offset(1, 0).Select
   If I > 40 Then Exit Do
  Loop
 Loop
 MyBook.Worksheets("StockAdRec").Activate
 Range(Cells(DataRow + 1, 4), Cells(DataRow + LineNo, 4)).Value = ((LineNo - 1) * 40) + I - 1
 MyBook.Worksheets("StockAdRec").Range("B1").Value = Right(TextBox2.Text, 5)
 ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
Finish:
ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
EventOff = True
TextBox1.Text = ""
For I = 5 To 53
 Controls("TextBox" & I).Text = ""
Next I
For I = 30 To 65
 Controls("Label" & I).Caption = ""
Next I
 TextBox2.Text = "A" & Right(("00000" & Val(MyBook.Worksheets("StockAdRec").Range("B1").Value) + 1), 5)
 ScrollBar1.Max = 7
 ScrollBar1.Value = 1
 Label66.Visible = True
 TextBox1.Visible = True
 CommandButton4.Visible = True
 CommandButton2.Visible = True
 Label10.Visible = False
 EventOff = False
End Sub

Private Sub CommandButton21_Click()
Dim EndLine As Long, I As Long
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
 Application.ScreenUpdating = False
 Application.EnableEvents = False
 Application.DisplayAlerts = False
 ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
Application.EnableEvents = True
Columns("A:I").Select
With Selection.Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
End With
Columns("A").NumberFormat = "General"
Columns("B:C").NumberFormat = "@"
Columns("G").NumberFormat = "General"
Columns("F").NumberFormat = "#,##0.00"
Columns("I").NumberFormat = "General"
Columns("A").HorizontalAlignment = xlCenter
Columns("B:C").HorizontalAlignment = xlLeft
Columns("G").HorizontalAlignment = xlCenter
Columns("H").HorizontalAlignment = xlRight
Columns("I").HorizontalAlignment = xlCenter
Columns("A").ColumnWidth = 9
Columns("B").ColumnWidth = 20
Columns("C").ColumnWidth = 45
Columns("G").ColumnWidth = 15
Columns("H").ColumnWidth = 18
Columns("I").ColumnWidth = 19
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C101").Select
If ActiveCell.Offset(1, 0).Value = "" Then
 Range("C101:J101").Copy
Else
 ActiveCell.End(xlDown).Select
 EndLine = ActiveCell.Row + 1
 Range(Cells(101, 3), Cells(EndLine, 10)).Copy
End If
Worksheets("Report").Activate
Range("B10").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
Application.CutCopyMode = False
Range("A1").Font.Size = 14
Range("A1:A5").HorizontalAlignment = xlLeft
Range("A1").Value = " Inventory Adjustment Record "
Range("A3").Value = " Adjustment Ref # : " & TextBox2.Text
If Worksheets("RunningDat").Range("A1").Value <> "" Then
  Range("A5").Value = " Record Date : " & Format(Worksheets("RunningDat").Range("A1").Value, "yyyy/mm/dd")
Else
  Range("A5").Value = " Adjustment Status : ( Still processing on " & Format(Date, "yyyy/mm/dd") & " )"
End If
Range("A8").Value = " Item # "
Range("A9").Value = "---------"
Range("B8").Value = " Stock # "
Range("B9").Value = "-------------------------"
Range("C8").Value = " Part Description "
Range("C9").Value = "------------------------------------------------------------------"
Range("G8").Value = " Adjusted Qty "
Range("G9").Value = "--------------------"
Range("H7").Value = " Amount Involved "
Range("H8").Value = " (" & SysCurrency & ") "
Range("H9").Value = "-----------------------"
Range("I8").Value = " Acct # for Bal"
Range("I9").Value = "-----------------------"
If Range("B10").Value = "" Then
   Range("C11").Value = "     No Data in the Record. "
Else
  Range("B10").Select
  I = 1
  Do While ActiveCell.Value <> ""
   ActiveCell.Offset(0, -1).Value = I
   I = I + 1
   ActiveCell.Offset(1, 0).Select
  Loop
End If
Columns("D:F").Delete
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
SheetName = "Report"
ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
ThisWorkbook.Worksheets("Report").Activate
  On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$9"
         .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
    Range("A1:F15").Select
    Range("F15").Activate
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
    Range("C1").Select
Application.EnableEvents = True
OldForm = "UserForm27"
 Label10.BackColor = &HC0&
 Label10.Visible = False
Me.Hide
Application.ScreenUpdating = True
Range("A1").Select
Range("D1").Select
End Sub

Private Sub CommandButton22_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 41
End Sub

Private Sub CommandButton23_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 42
End Sub

Private Sub CommandButton24_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 43
End Sub

Private Sub CommandButton25_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 44
End Sub

Private Sub CommandButton26_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 45
End Sub

Private Sub CommandButton27_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 46
End Sub
Private Sub CommandButton28_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 47
End Sub

Private Sub CommandButton29_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 48
End Sub

Private Sub CommandButton30_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 49
End Sub

Private Sub CommandButton31_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 50
End Sub

Private Sub CommandButton32_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 51
End Sub

Private Sub CommandButton33_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 52
End Sub

Private Sub CommandButton3_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
EventOff = True
 ListBox1.Visible = False
 ListBox2.Visible = False
TextBox1.Text = ""
For I = 5 To 53
 Controls("TextBox" & I).Text = ""
Next I
For I = 30 To 65
 Controls("Label" & I).Caption = ""
Next I
TextBox2.Text = "A" & Right(("00000" & Val(MyBook.Worksheets("StockAdRec").Range("B1").Value) + 1), 5)
 ScrollBar1.Max = 7
 ScrollBar1.Value = 1
 Label66.Visible = True
 TextBox1.Visible = True
 CommandButton4.Visible = True
 CommandButton2.Visible = True
 Label10.Visible = False
EventOff = False
End Sub

Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = True
ListBox1.Visible = False
BOMRow = 1
End Sub

Private Sub CommandButton5_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 5
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton6_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 6
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton7_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 7
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton8_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 8
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton9_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 9
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton10_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 10
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton11_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 11
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton12_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 12
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton13_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 13
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton14_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 14
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton15_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 15
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub CommandButton16_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
BOMRow = 16
ListBox1.Visible = True
ListBox2.Visible = False
End Sub

Private Sub Label54_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label54.Width = 288
End Sub

Private Sub Label54_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label54.Width = 156
End Sub

Private Sub Label55_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label55.Width = 288
End Sub

Private Sub label55_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label55.Width = 156
End Sub

Private Sub label56_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label56.Width = 288
End Sub

Private Sub label56_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label56.Width = 156
End Sub

Private Sub label57_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label57.Width = 288
End Sub

Private Sub label57_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label57.Width = 156
End Sub

Private Sub label58_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label58.Width = 288
End Sub

Private Sub label58_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label58.Width = 156
End Sub

Private Sub label59_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label59.Width = 288
End Sub

Private Sub label59_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label59.Width = 156
End Sub

Private Sub label60_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label60.Width = 288
End Sub

Private Sub label60_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label60.Width = 156
End Sub

Private Sub label61_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label61.Width = 288
End Sub

Private Sub label61_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label61.Width = 156
End Sub

Private Sub label62_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label62.Width = 288
End Sub

Private Sub label62_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label62.Width = 156
End Sub

Private Sub label63_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label63.Width = 288
End Sub

Private Sub label63_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label63.Width = 156
End Sub

Private Sub label64_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label64.Width = 288
End Sub

Private Sub label64_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label64.Width = 156
End Sub

Private Sub label65_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label65.Width = 288
End Sub

Private Sub label65_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label65.Width = 156
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, I As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Record of Stock item" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Product Description" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox1.AddItem "SWITCH to listing by Stock #"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Record of Stock item"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Stock #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox1.AddItem "SWITCH to listing by Product Description"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Record of Stock item"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
 RowNo = ListBox1.ListIndex + 1
 ListBox1.Visible = False
 EventOff = True
StockNo = MyBook.Worksheets("StockRec").Cells(RowNo, 2).Value
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "List")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim AccountNo As String, EndNo As Long, EntryNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Or ListBox2.Text = "" Then
 ListBox2.Visible = False
 Exit Sub
End If
EndNo = 2
AccountNo = ListBox2.Text
If BOMRow <> 1 Then
 If Controls("Textbox" & BOMRow - 36).Text = "" Then
  Label10.Caption = Chr(13) & "   Please enter the Stock number first "
  Label10.Visible = True
  ListBox2.Visible = False
  Exit Sub
 End If
End If
 Do While Mid(AccountNo, EndNo, 1) <> " "
  EndNo = EndNo + 1
 Loop
AccountNo = Left(AccountNo, EndNo - 1)
Controls("TextBox" & BOMRow).Text = AccountNo
 ThisWorkbook.Worksheets("RunningDat").Activate
 EventOff = True
If BOMRow = 1 Then
 Cells(101, 3).Select
 Do While ActiveCell.Value <> ""
  ActiveCell.Offset(0, 7).Value = AccountNo
  ActiveCell.Offset(1, 0).Select
 Loop
   LineNo = UserForm27.ScrollBar1.Value
  For I = 1 To 12
   UserForm27.Controls("Label" & I + 14).Caption = I + LineNo - 1
   UserForm27.Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
   UserForm27.Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
   UserForm27.Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
   UserForm27.Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
   UserForm27.Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
   UserForm27.Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
   UserForm27.Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
  Next I
Else
 EntryNo = Val(Controls("Label" & BOMRow - 26).Caption)
 Cells(EntryNo + 100, 10).Value = AccountNo
End If
 ListBox2.Visible = False
 EventOff = False
End Sub

Private Sub ScrollBar1_Change()
Dim LineNo As Long
Application.EnableCancelKey = xlDisabled
LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
   Controls("Label" & I + 14).Caption = I + LineNo - 1
   Controls("Textbox" & I + 4).Text = Cells(99 + LineNo + I, 3).Value
   Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 4).Value
   Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
   Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 7).Value
   Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 8).Value
   Controls("Textbox" & I + 28).Text = Cells(99 + LineNo + I, 9).Value
   Controls("Textbox" & I + 40).Text = Cells(99 + LineNo + I, 10).Value
  Next I
End Sub

Private Sub TextBox1_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 1
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox1_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox2_AfterUpdate()
Dim RecordNo As String, Tbl As Range, LineStart As Long, LineEnd As Long, LineNo As Long, I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If TextBox2.Text = "" Then TextBox2.Text = "A" & Right(("00000" & Val(MyBook.Worksheets("StockAdRec").Range("B1").Value) + 1), 5)
If IsNumeric(TextBox2.Text) = True Then TextBox2.Text = "A" & Right(("00000" & TextBox2.Text), 5)
 Label10.Visible = False
If TextBox2.Text = "A" & Right(("00000" & Val(MyBook.Worksheets("StockAdRec").Range("B1").Value) + 1), 5) Then GoTo ResetForm
 RecordNo = TextBox2.Text
If Left(RecordNo, 1) <> "A" Then
  Label10.Caption = Chr(13) & "     The Adjustment Ref # is not Valid"
  Label10.Visible = True
  GoTo ResetForm
End If
If MyBook.Worksheets("StockAdRec").Range("A3").Value = "" Then
  Label10.Caption = Chr(13) & "     The Adjustment Ref # is not found from the Record"
  Label10.Visible = True
  GoTo ResetForm
End If
 MyBook.Worksheets("StockAdRec").Activate
 Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set Tbl = Selection
 If IsError(Application.Match(RecordNo, Tbl.Columns("A"), 0)) Then
  Label10.Caption = Chr(13) & "     The Adjustment Ref # is not found from the Record"
  Label10.Visible = True
  GoTo ResetForm
 End If
 LineStart = Application.Match(RecordNo, Tbl.Columns("A"), 0) + 2
 LineEnd = Application.Match(RecordNo, Tbl.Columns("A"), 1) + 2
 ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
 ThisWorkbook.Worksheets("RunningDat").Range("A1").NumberFormat = "yyyy/mm/dd"
 ThisWorkbook.Worksheets("RunningDat").Range("A1").Value = Cells(LineStart, 2).Value
 TextBox53.Text = Format(Cells(LineStart, 2).Value, "yyyy/mm/dd")
 LineNo = 101
 MyBook.Worksheets("StockAdRec").Activate
 Do While LineStart <= LineEnd
  Cells(LineStart, 6).Select
  Do While ActiveCell.Value <> ""
    ThisWorkbook.Worksheets("RunningDat").Activate
    Cells(LineNo, 2).NumberFormat = "General"
    Range(Cells(LineNo, 3), Cells(LineNo, 4)).NumberFormat = "@"
    Range(Cells(LineNo, 5), Cells(LineNo, 9)).NumberFormat = "General"
    MyBook.Worksheets("StockAdRec").Activate
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 2) = ActiveCell.Offset(0, -1).Value
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 3) = ActiveCell.Value
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 8) = ActiveCell.Offset(0, 2).Value
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 9) = ActiveCell.Offset(0, 3).Value
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 10) = ActiveCell.Offset(0, 4).Value
   ActiveCell.Offset(0, 6).Select
   LineNo = LineNo + 1
  Loop
  LineStart = LineStart + 1
 Loop
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range("C101").Select
 Do While ActiveCell.Value <> ""
  StockNo = ActiveCell.Value
  If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)) = False Then
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Columns("B"), 0)
   ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("StockRec").Cells(I, 3).Value
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 ScrollBar1.Value = 1
 If LineNo < 111 Then
  ScrollBar1.Max = 1
 Else
  ScrollBar1.Max = LineNo - 109
 End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I
    Controls("Textbox" & I + 4).Text = Cells(100 + I, 3).Value
    Controls("Label" & I + 53).Caption = Cells(100 + I, 4).Value
    Controls("Label" & I + 29).Caption = Cells(100 + I, 5).Value
    Controls("Label" & I + 41).Caption = Cells(100 + I, 7).Value
    Controls("Textbox" & I + 16).Text = Cells(100 + I, 8).Value
    Controls("Textbox" & I + 28).Text = Cells(100 + I, 9).Value
    Controls("Textbox" & I + 40).Text = Cells(100 + I, 10).Value
   Next I
 Label66.Visible = False
 TextBox1.Visible = False
 CommandButton4.Visible = False
 CommandButton2.Visible = False
 EventOff = False
Exit Sub
ResetForm:
 ThisWorkbook.Worksheets("RunningDat").Activate
 ActiveSheet.UsedRange.Delete
 TextBox1.Text = ""
For I = 5 To 52
 Controls("TextBox" & I).Text = ""
Next I
For I = 30 To 65
 Controls("Label" & I).Caption = ""
Next I
 ScrollBar1.Max = 7
 ScrollBar1.Value = 1
 If TextBox2.Text = "A" & Right(("00000" & Val(MyBook.Worksheets("StockAdRec").Range("B1").Value) + 1), 5) Then
  Label66.Visible = True
  TextBox1.Visible = True
  CommandButton4.Visible = True
  CommandButton2.Visible = True
  Label10.Visible = False
 Else
  Label66.Visible = False
  TextBox1.Visible = False
  CommandButton4.Visible = False
  CommandButton2.Visible = False
 End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 Label66.Visible = False
 TextBox1.Visible = False
 CommandButton4.Visible = False
End If
 EventOff = False
End Sub

Private Sub TextBox2_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
CommandButton2.Visible = False
CommandButton4.Visible = False
End Sub

Private Sub TextBox2_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox29_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 5
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox29_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox29_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyUp Then
  BOMRow = 5
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27Col3Exit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox30.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox30_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 6
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox30_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox31_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 7
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox31_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox32_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
BOMRow = 8
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox32_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox33_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 9
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox33_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox34_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 10
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox34_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox35_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 11
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox35_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox36_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 12
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox36_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox37_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 13
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox37_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox38_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 14
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox38_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox39_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 15
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox39_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox40_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 16
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col3Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox40_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyDown Then
  BOMRow = 16
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27Col3Exit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox39.SetFocus
     SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox40_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox41_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 41
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox41_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox41_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
  BOMRow = 41
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27AcctExit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox42.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox42_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 42
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox42_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox43_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 43
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox43_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox44_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 44
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox44_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox45_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 45
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox45_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox46_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 46
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox46_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox47_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 47
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox47_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox48_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 48
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox48_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox49_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox49_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 49
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox50_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 50
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox50_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox51_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 51
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox51_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox52_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 52
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27AcctExit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox52_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox52_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyDown Or KeyCode = vbKeyReturn Then
  BOMRow = 52
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27AcctExit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox51.SetFocus
     SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox5_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 5
StockNo = TextBox5.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox5_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox5_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
  BOMRow = 5
  StockNo = TextBox5.Text
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27Col1Exit(BOMRow, "")
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox6.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub
Private Sub TextBox53_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub
Private Sub TextBox53_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim AdjustDate As Date, DateString As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If CommandButton2.Visible = False Then
 If TextBox53.Text <> Format(ThisWorkbook.Worksheets("RunningDat").Cells(1.1).Value, "yyyy/mm/dd") Then
  Label10.Caption = Chr(13) & "   No Change to the record is allowed"
  Label10.Visible = True
 End If
 TextBox53.Text = Format(ThisWorkbook.Worksheets("RunningDat").Cells(1.1).Value, "yyyy/mm/dd")
 Exit Sub
End If
If TextBox53.Text = "" Then Exit Sub
DateString = TextBox53.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label10.Caption = Chr(13) & "    Incorrect Date entered"
 Label10.Visible = True
 Exit Sub
Else
 TextBox53.Text = Format(DateString, "yyyy/mm/dd")
End If
AdjustDate = TextBox53.Text
If AdjustDate < BeginningDate Then
 TextBox53.Text = ""
 Label10.Caption = Chr(13) & "   The Date entered is earlier than the Year Start Date which is not allowed"
 Label10.Visible = True
End If
End Sub

Private Sub TextBox6_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 6
StockNo = TextBox6.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox6_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox7_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 7
StockNo = TextBox7.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox7_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox8_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 8
StockNo = TextBox8.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox8_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox9_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 9
StockNo = TextBox9.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox9_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox10_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 10
StockNo = TextBox10.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox10_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox11_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 11
StockNo = TextBox11.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox11_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox12_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 12
StockNo = TextBox12.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox12_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox13_AfterUpdate()
If EventOff = True Then Exit Sub
EventOff = True
BOMRow = 13
StockNo = TextBox13.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox13_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox14_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 14
StockNo = TextBox14.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox14_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox15_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 15
StockNo = TextBox15.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox15_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox16_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 16
StockNo = TextBox16.Text
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col1Exit(BOMRow, "")
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox16_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox16_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
 If KeyCode = vbKeyDown Then
  BOMRow = 16
  StockNo = TextBox16.Text
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27Col1Exit(BOMRow, "")
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox15.SetFocus
     SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox17_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 5
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox17_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox17_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
  BOMRow = 5
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27Col2Exit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox18.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox18_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 6
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox18_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox19_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 7
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox19_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox20_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 8
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox20_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox21_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 9
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox21_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox22_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 10
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox22_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox23_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 11
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox23_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox24_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 12
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox24_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox25_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 13
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox25_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox26_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 14
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox26_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox27_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 15
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox27_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox28_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
BOMRow = 16
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
Call Form27Col2Exit(BOMRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox28_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox28_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 If KeyCode = vbKeyDown Then
   BOMRow = 16
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "InvAdj"
  Call Form27Col2Exit(BOMRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox27.SetFocus
      SendKeys "{Down}", False
 End If
 EventOff = False
End Sub
Private Sub UserForm_Initialize()
Dim Tbl As Range, L As Long, M As Long, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ThisWorkbook.Worksheets("RunningDat").Activate
ActiveSheet.UsedRange.Delete
ListBox1.Clear
MyBook.Worksheets("StockRec").Activate
 If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(1, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B2"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox1.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Record of Stock item"
 End If
 ListBox1.AddItem "CLOSE this box"
  ListBox2.Clear
  L = 10
  M = LastRowChartofAccount
  For I = L To M
   N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
   spacing = " -------"
   spacing = Left(spacing, 8 - N)
   If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
     ListBox2.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
   End If
   Next I
  ListBox2.AddItem "CLOSE this box"
 Label5.Caption = "Unit Cost" & Chr(13) & "(" & SysCurrency & ")"
 Label7.Caption = "Amt Adj" & Chr(13) & "(" & SysCurrency & ")"
 EventOff = True
 TextBox2.Text = "A" & Right(("00000" & Val(MyBook.Worksheets("StockAdRec").Range("B1").Value) + 1), 5)
  ScrollBar1.Max = 7
  ScrollBar1.Value = 1
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 Label66.Visible = False
 TextBox1.Visible = False
 CommandButton4.Visible = False
End If
 EventOff = False
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
Application.EnableCancelKey = xlDisabled
If CloseMode = vbFormControlMenu Then
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = True
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
End If
EventOff = False
End Sub


Attribute VB_Name = "UserForm28"
Attribute VB_Base = "0{B7FBC3E2-0C1A-4FA2-92A6-A22309272B23}{2BE99528-3EA3-4C29-B008-AEB709ADA192}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public BuildQty As Double

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = False
Unload Me
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton2_Click()
Dim I As Long, AdjustQty As Double, AdjustAmt As Double, RecordNo As String, RecordDate As Date, StockQty As Double
Dim LastRowNo As Long, AccountNo As String, TotalSum As Double, LineNo As Long, DataRow As Long
Dim QtySum As Double, AmtSum As Double, AssetNo As String
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C101").Select
If ActiveCell.Value = "" Then GoTo Finish
  If TextBox1.Text = "" Then
    Label10.Caption = Chr(13) & "   Please enter the product stock number."
    Label10.Visible = True
    Exit Sub
  End If
   If IsNumeric(TextBox3.Text) = True Then
   BuildQty = TextBox3.Text
  Else
   BuildQty = 0
  End If
  If BuildQty = 0 Then
    Label10.Caption = Chr(13) & "   Please enter the Build Quantity."
    Label10.Visible = True
    Exit Sub
  End If
    If BuildQty + Range("A4").Value < 0 Then
       BuildQty = 0 - Range("A4").Value
      UserForm28.Label10.Caption = Chr(13) & "     Negative Build Qty cannot be less than " & BuildQty & ", otherwise the inventory will result in Negative quantity " & Chr(13) & _
                                             "     Please correct the Quantity. "
      UserForm28.Label10.Visible = True
      BuildQty = TextBox3.Text
      Exit Sub
    End If
  If IsDate(TextBox29.Text) = False Then
    Label10.Caption = Chr(13) & "   Please enter the Date."
    Label10.Visible = True
    Exit Sub
  End If
Do While ActiveCell.Value <> ""
 If IsNumeric(ActiveCell.Offset(0, 8).Value) = False Then
    Label10.Caption = Chr(13) & "   Please check to ensure the quantity for all components are sufficient."
    Label10.Visible = True
    Exit Sub
  End If
 ActiveCell.Offset(1, 0).Select
Loop
LastRowNo = ActiveCell.Row - 1
  AmtSum = Application.Sum(Range(Cells(101, 12), Cells(LastRowNo, 12)))
    If AmtSum + Range("A5").Value < 0 Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This production job cannot be proceeded because it will make the book value of the manufactured item negative.  ")
   Exit Sub
  ElseIf (BuildQty + Range("A4").Value = 0) And (AmtSum + Range("A5").Value <> 0) Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This production job cannot be proceeded because it will result in zero stock quantity for the manufactured item. " & _
       "But the book value of the manufactured item will not be zero. ")
   Exit Sub
  End If
ProceedBuild:
 Range(Cells(LastRowNo, 2), Cells(LastRowNo, 12)).NumberFormat = "General"
 Range(Cells(100, 3), Cells(100, 4)).NumberFormat = "@"
 Cells(100, 2).Value = Range("A3").Value
 Cells(100, 3).Value = TextBox1.Text
 Cells(100, 4).Value = Label11.Caption
 Cells(100, 11).Value = TextBox3.Text * (-1)
 Cells(100, 12).Value = Application.Sum(Range(Cells(101, 12), Cells(LastRowNo, 12))) * (-1)
 RecordNo = TextBox2.Text
 RecordDate = TextBox29.Text
 Range("C100").Select
 ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
 Do While ActiveCell.Value <> ""
  StockNo = ActiveCell.Value
  AdjustQty = ActiveCell.Offset(0, 8).Value * (-1)
  AdjustAmt = ActiveCell.Offset(0, 9).Value * (-1)
    If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
      I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
       MyBook.Worksheets("StockRec").Cells(I, 8).Value = Format(StockQty + AdjustQty, "0.0000")
       MyBook.Worksheets("StockRec").Cells(I, 9).Value = Format(MyBook.Worksheets("StockRec").Cells(I, 9).Value + AdjustAmt, "0.00")
       If MyBook.Worksheets("StockRec").Cells(I, 1).Value < RecordDate Then MyBook.Worksheets("StockRec").Cells(I, 1).Value = RecordDate
      If MyBook.Worksheets("StockRec").Cells(I, 8).Value <> 0 Then _
          MyBook.Worksheets("StockRec").Cells(I, 10).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value / MyBook.Worksheets("StockRec").Cells(I, 8).Value
        QtySum = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        AmtSum = MyBook.Worksheets("StockRec").Cells(I, 9).Value
        AssetNo = MyBook.Worksheets("StockRec").Cells(I, 5).Value
      If AdjustQty <> 0 Or AdjustAmt <> 0 Then
       Call InvIOAdd(AdjustQty, AdjustAmt, RecordDate, QtySum, AmtSum, AssetNo)
       Call IOUpdate(AdjustQty, AdjustAmt, RecordNo, RecordDate, "Build", StockQty)
      End If
    End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveCell.Offset(1, 0).Select
 Loop
 ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.UsedRange.Delete
 Range("E1").Select
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range(Cells(100, 2), Cells(LastRowNo, 12)).Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Columns("I:N").Delete
Range(Cells(1, 6), Cells(LastRowNo - 99, 8)).ClearContents
Range(Cells(1, 6), Cells(LastRowNo - 99, 7)).NumberFormat = "@"
Range(Cells(1, 6), Cells(LastRowNo - 99, 8)).NumberFormat = "General"
  Range(Cells(2, 5), Cells(LastRowNo - 99, 9)).Select
  Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("E2").Select
   Do While ActiveCell.Value <> ""
    TotalSum = ActiveCell.Offset(0, 4).Value
    AccountNo = ActiveCell.Value
    Do While ActiveCell.Offset(1, 0).Value = AccountNo
     TotalSum = TotalSum + ActiveCell.Offset(1, 4).Value
     ActiveCell.Offset(1, 0).EntireRow.Delete
    Loop
    TotalSum = Format(TotalSum, "0.00")
    If Abs(TotalSum) < 0.001 Then
      ActiveCell.EntireRow.Delete
    Else
      If TotalSum >= 0 Then
       ActiveCell.Offset(0, 4).Value = TotalSum
       ActiveCell.Offset(0, 3).ClearContents
      Else
       ActiveCell.Offset(0, 3).Value = Format(TotalSum * (-1), "0.00")
       ActiveCell.Offset(0, 4).ClearContents
      End If
      ActiveCell.Offset(1, 0).Select
    End If
   Loop
   LastRowNo = ActiveCell.Row - 1
    TotalSum = Range("I1").Value
   If Abs(TotalSum) < 0.001 Then
    ActiveCell.EntireRow.Delete
     LastRowNo = LastRowNo - 1
   Else
    If TotalSum >= 0 Then
      Range("H1").ClearContents
    Else
      Range("H1").Value = Format(TotalSum * (-1), "0.00")
      Range("I1").ClearContents
    End If
   End If
    If LastRowNo < 1 Then GoTo NoGLEntry
  Range(Cells(1, 6), Cells(LastRowNo, 6)).NumberFormat = "General"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).NumberFormat = "@"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).Copy
  Range(Cells(1, 6), Cells(LastRowNo, 6)).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  Range(Cells(1, 10), Cells(LastRowNo, 10)).NumberFormat = "@"
  Range(Cells(1, 10), Cells(LastRowNo, 10)).Value = RecordNo
  Range(Cells(1, 7), Cells(LastRowNo, 7)).Value = "Build " & TextBox1.Text & " (Qty : " & TextBox3.Text & ") Job Order # " & RecordNo
  Range(Cells(1, 4), Cells(LastRowNo, 4)).NumberFormat = "yyyy/mm/dd"
  Range(Cells(1, 4), Cells(LastRowNo, 4)).Value = RecordDate
   AcctYear = Int((Period(RecordDate) - Period(BeginningDate)) / 12)
   AcctYear = AcctYear + Year(BeginningDate)
   JournalCode = "SV" & AcctYear
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   JcodeRow = 251
   Set JournalRange = Range("G250")
   If ActiveCell.Offset(1, 0).Value <> "" Then
    Range("G250").End(xlDown).Select
    JcodeRow = ActiveCell.Row + 1
   End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
   Else
    JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
    LastTranNo = Cells(JcodeRow, 8).Value
    LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
    Cells(JcodeRow, 8).Value = LastTranNo
   End If
   LastJournalCode = JournalCode
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(LastRowNo, 1)).NumberFormat = "@"
   Range(Cells(1, 1), Cells(LastRowNo, 1)).Value = JournalCode
   Range(Cells(1, 2), Cells(LastRowNo, 2)).NumberFormat = "@"
   Range(Cells(1, 2), Cells(LastRowNo, 2)).Value = LastTranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(LastRowNo, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
NoGLEntry:
   P = Period(RecordDate) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
 MyBook.Worksheets("BuildRec").Activate
 Range("A1").End(xlDown).Select
 DataRow = ActiveCell.Row
 LineNo = 0
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range("C101").Select
 Do While ActiveCell.Value <> ""
  LineNo = LineNo + 1
  MyBook.Worksheets("BuildRec").Activate
  Rows(DataRow + LineNo).NumberFormat = "General"
  Cells(DataRow + LineNo, 1).NumberFormat = "@"
  Cells(DataRow + LineNo, 1).Value = RecordNo
  Cells(DataRow + LineNo, 2).NumberFormat = "yyyy/mm/dd"
  Cells(DataRow + LineNo, 2).Value = RecordDate
  Cells(DataRow + LineNo, 4).NumberFormat = "@"
  Cells(DataRow + LineNo, 4).Value = TextBox1.Text
  Cells(DataRow + LineNo, 5).NumberFormat = "@"
  Cells(DataRow + LineNo, 5).Value = Label11.Caption
  Cells(DataRow + LineNo, 3).Value = LineNo
  I = 1
  ThisWorkbook.Worksheets("RunningDat").Activate
  Do While ActiveCell.Value <> ""
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 2).NumberFormat = "@"
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 3).NumberFormat = "@"
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 1).Value = ActiveCell.Offset(0, -1).Value
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 2).Value = ActiveCell.Value
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 3).Value = ActiveCell.Offset(0, 1).Value
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 4).Value = ActiveCell.Offset(0, 2).Value * (-1)
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 5).Value = ActiveCell.Offset(0, 6).Value * (-1)
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 6).Value = ActiveCell.Offset(0, 7).Value * (-1)
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 7).Value = ActiveCell.Offset(0, 8).Value * (-1)
    MyBook.Worksheets("BuildRec").Cells(DataRow + LineNo, (8 * I) + 8).Value = ActiveCell.Offset(0, 9).Value * (-1)
   I = I + 1
   ActiveCell.Offset(1, 0).Select
   If I > 30 Then Exit Do
  Loop
 Loop
 MyBook.Worksheets("BuildRec").Activate
  Range(Cells(DataRow + 1, 6), Cells(DataRow + LineNo, 6)).Value = BuildQty
 Range(Cells(DataRow + 1, 8), Cells(DataRow + LineNo, 8)).Value = ((LineNo - 1) * 30) + I - 1
 Range(Cells(DataRow + 1, 7), Cells(DataRow + LineNo, 7)).Value = TotalSum * (-1)
 MyBook.Worksheets("BuildRec").Range("B1").Value = Right(TextBox2.Text, 5)
 ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
Finish:
 Label10.Visible = False
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("C101").Select
  EventOff = True
 TextBox2.Text = "M" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("B1").Value) + 1), 5)
  TextBox1.Text = ""
  TextBox3.Text = ""
  Label11.Caption = ""
  For I = 15 To 26
   Controls("Label" & I).Caption = I - 14
  Next I
  For I = 17 To 29
   Controls("Textbox" & I).Text = ""
  Next I
  For I = 30 To 101
   Controls("Label" & I).Caption = ""
  Next I
 ScrollBar1.Max = 7
 ScrollBar1.Value = 1
  EventOff = False
End Sub

Private Sub CommandButton3_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
 ListBox1.Visible = False
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("C101").Select
   EventOff = True
 TextBox2.Text = "M" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("B1").Value) + 1), 5)
  TextBox1.Text = ""
  TextBox3.Text = ""
  Label11.Caption = ""
  For I = 15 To 26
   Controls("Label" & I).Caption = I - 14
  Next I
  For I = 17 To 29
   Controls("Textbox" & I).Text = ""
  Next I
  For I = 30 To 101
   Controls("Label" & I).Caption = ""
  Next I
 ScrollBar1.Max = 7
 ScrollBar1.Value = 1
 CommandButton5.Visible = True
 CommandButton2.Visible = True
  EventOff = False
End Sub

Private Sub CommandButton4_Click()
Dim EndLine As Long, I As Long
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
 Application.ScreenUpdating = False
 Application.EnableEvents = False
 Application.DisplayAlerts = False
 ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
Application.EnableEvents = True
Columns("A:J").Select
With Selection.Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
End With
Columns("A").NumberFormat = "General"
Columns("B:C").NumberFormat = "@"
Columns("H:J").NumberFormat = "General"
Columns("A").HorizontalAlignment = xlCenter
Columns("B:C").HorizontalAlignment = xlLeft
Columns("H:J").HorizontalAlignment = xlCenter
Columns("A").ColumnWidth = 9
Columns("B").ColumnWidth = 20
Columns("C").ColumnWidth = 45
Columns("H:J").ColumnWidth = 16
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C101").Select
If ActiveCell.Offset(1, 0).Value = "" Then
 Range("C101:K101").Copy
Else
 ActiveCell.End(xlDown).Select
 EndLine = ActiveCell.Row + 1
 Range(Cells(101, 3), Cells(EndLine, 11)).Copy
End If
Worksheets("Report").Activate
Range("B14").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
Application.CutCopyMode = False
Range("A1").Font.Size = 14
Range("A1:A10").HorizontalAlignment = xlLeft
Range("A1").Value = " Product Manufacturing Job Order Record "
Range("A3").Value = " Job Order # : " & TextBox2.Text
If Label11.Caption <> "" Then
  Range("A4").Value = " Product # : " & TextBox1.Text & " ---- " & Label11.Caption
Else
  Range("A4").Value = " Product # : " & TextBox1.Text
End If
Range("A5").Value = " Quantity Manufactured : " & TextBox3.Text
If Worksheets("RunningDat").Range("A1").Value <> "" Then
  Range("A7").Value = " Record Date : " & Format(Worksheets("RunningDat").Range("A1").Value, "yyyy/mm/dd")
Else
  Range("A7").Value = " Record Date : " & Format(Date, "yyyy/mm/dd")
End If
Range("A10").Value = "Components Consumption Detail : --- "
Range("A12").Value = " Item # "
Range("A13").Value = "---------"
Range("B12").Value = " Stock # "
Range("B13").Value = "-------------------------"
Range("C12").Value = " Part Description "
Range("C13").Value = "--------------------------------------------------------------------"
Range("H12").Value = " Qty Required"
Range("H13").Value = "--------------------"
Range("I11").Value = " Production "
Range("I12").Value = " Wastage "
Range("I13").Value = "---------------------"
Range("J11").Value = " Total Qty "
Range("J12").Value = " Consumed "
Range("J13").Value = "---------------------"
If Range("B14").Value = "" Then
   Range("C15").Value = "     No Data in the Record. "
Else
  Range("B14").Select
  I = 1
  Do While ActiveCell.Value <> ""
   ActiveCell.Offset(0, -1).Value = I
   I = I + 1
   ActiveCell.Offset(1, 0).Select
  Loop
End If
Columns("D:G").Delete
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
SheetName = "Report"
ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
ThisWorkbook.Worksheets("Report").Activate
Application.EnableEvents = True
OldForm = "UserForm28"
 Label10.BackColor = &HC0&
 Label10.Visible = False
Me.Hide
 On Error GoTo NoPrinter
  With ActiveSheet.PageSetup
    .Orientation = xlPortrait
    .PrintTitleRows = "$1:$13"
    .LeftMargin = Application.InchesToPoints(0.72)
    .RightMargin = Application.InchesToPoints(0.55)
    .Zoom = False
    .FitToPagesWide = 1
    .FitToPagesTall = False
  End With
NoPrinter:
 Range("A1:F19").Select
 Range("A1").Activate
 ActiveWindow.Zoom = True
 ActiveWindow.DisplayGridlines = False
 MyBook.Activate
 ThisWorkbook.Worksheets("Report").Activate
Application.ScreenUpdating = True
Range("A1").Select
Range("D1").Select
End Sub

Private Sub CommandButton5_Click()
ListBox1.Visible = True
Label10.Visible = False
End Sub

Private Sub Label90_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label90.Width = 288
End Sub

Private Sub Label90_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label90.Width = 156
End Sub

Private Sub Label91_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label91.Width = 288
End Sub

Private Sub Label91_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label91.Width = 156
End Sub

Private Sub Label92_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label92.Width = 288
End Sub

Private Sub Label92_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label92.Width = 156
End Sub

Private Sub Label93_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label93.Width = 288
End Sub

Private Sub Label93_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label93.Width = 156
End Sub

Private Sub Label94_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label94.Width = 288
End Sub

Private Sub Label94_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label94.Width = 156
End Sub

Private Sub Label95_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label95.Width = 288
End Sub

Private Sub Label95_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label95.Width = 156
End Sub

Private Sub Label96_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label96.Width = 288
End Sub

Private Sub Label96_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label96.Width = 156
End Sub

Private Sub Label97_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label97.Width = 288
End Sub

Private Sub Label97_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label97.Width = 156
End Sub

Private Sub Label98_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label98.Width = 288
End Sub

Private Sub Label98_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label98.Width = 156
End Sub

Private Sub Label99_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label99.Width = 288
End Sub

Private Sub Label99_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label99.Width = 156
End Sub

Private Sub Label100_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label100.Width = 288
End Sub

Private Sub Label100_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label100.Width = 156
End Sub

Private Sub Label101_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label101.Width = 288
End Sub

Private Sub Label101_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label101.Width = 156
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, I As Long, Tbl As Range
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Product available in the Record" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Product Description" Then
  ListBox1.Visible = False
  ListBox1.Clear
  ThisWorkbook.Worksheets("Journal").Activate
  If Range("A1") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("A1").Select
    ListBox1.AddItem "SWITCH to listing by Stock #"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Product available in the Record"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Stock #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  ThisWorkbook.Worksheets("Journal").Activate
  If Range("A1") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("A1").Select
    ListBox1.AddItem "SWITCH to listing by Product Description"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Product available in the Record"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
RowNo = ListBox1.ListIndex
If RowNo = 0 Then
 ListBox1.Visible = False
 Exit Sub
End If
  EventOff = True
 StockNo = ThisWorkbook.Worksheets("Journal").Cells(RowNo, 1).Value
 TextBox1.Text = StockNo
 ListBox1.Visible = False
 SendKeys "{Down}", False
Call Form28Text1Exit("BuildProduct")
 EventOff = False
End Sub

Private Sub ScrollBar1_Change()
Dim LineNo As Long
Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I + LineNo - 1
    Controls("Label" & I + 77).Caption = Cells(99 + LineNo + I, 3).Value
    Controls("Label" & I + 89).Caption = Cells(99 + LineNo + I, 4).Value
    Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
    Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 6).Value
    Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 9).Value
    Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 10).Value
    Controls("Label" & I + 65).Caption = Cells(99 + LineNo + I, 11).Value
 Next I
End Sub

Private Sub TextBox1_AfterUpdate()
Dim I As Long, J As Long
Application.EnableCancelKey = xlDisabled
If CommandButton2.Visible = False Then
  If TextBox1.Text <> ThisWorkbook.Worksheets("RunningDat").Range("A4").Value Then
   Label10.Caption = Chr(13) & "   No Change to the Job order record is allowed"
   Label10.Visible = True
  End If
  TextBox1.Text = ThisWorkbook.Worksheets("RunningDat").Range("A4").Value
  Exit Sub
End If
EventOff = True
 StockNo = TextBox1.Text
If Left(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = 1
 Do While J <= I And Mid(StockNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then GoTo NoInput
  StockNo = Right(StockNo, I - J + 1)
End If
If Right(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = I
 Do While J > 0 And Mid(StockNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then GoTo NoInput
  StockNo = Left(StockNo, J)
End If
StockNo = UCase(StockNo)
TextBox1.Text = StockNo
If StockNo = "" Then GoTo NoInput
Call Form28Text1Exit("BuildProduct")
EventOff = False
Exit Sub
NoInput:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("C101").Select
  Label11.Caption = ""
  For I = 15 To 26
   Controls("Label" & I).Caption = I - 14
  Next I
  For I = 17 To 28
   Controls("Textbox" & I).Text = ""
  Next I
  For I = 30 To 101
   Controls("Label" & I).Caption = ""
  Next I
   SendKeys "{Up}", False
   EventOff = False
End Sub

Private Sub TextBox1_Change()
 If EventOff = True Then Exit Sub
 ListBox1.Visible = False
 Label10.Visible = False
End Sub

Private Sub TextBox17_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(17)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox17_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox17_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyUp Then
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
  Call Form28Col1Exit(17)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox18.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox18_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(18)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox18_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox19_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(19)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox19_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox2_AfterUpdate()
Dim RecordNo As String, Tbl As Range, LineStart As Long, LineEnd As Long, LineNo As Long, I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If TextBox2.Text = "" Then TextBox2.Text = "M" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("B1").Value) + 1), 5)
If IsNumeric(TextBox2.Text) = True Then TextBox2.Text = "M" & Right(("00000" & TextBox2.Text), 5)
 Label10.Visible = False
 RecordNo = TextBox2.Text
If RecordNo = "M" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("B1").Value) + 1), 5) Then GoTo ResetForm
If MyBook.Worksheets("BuildRec").Range("A4").Value = "" Then
  Label10.Caption = Chr(13) & "     The Job Order is not found from the Record"
  Label10.Visible = True
  GoTo ResetForm
End If
 MyBook.Worksheets("BuildRec").Activate
 Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set Tbl = Selection
 If IsError(Application.Match(RecordNo, Tbl.Columns("A"), 0)) Then
  Label10.Caption = Chr(13) & "     The Job Order is not found from the Record"
  Label10.Visible = True
  GoTo ResetForm
 End If
 LineStart = Application.Match(RecordNo, Tbl.Columns("A"), 0) + 3
 LineEnd = Application.Match(RecordNo, Tbl.Columns("A"), 1) + 3
 ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
 ThisWorkbook.Worksheets("RunningDat").Range("A1").NumberFormat = "yyyy/mm/dd"
 ThisWorkbook.Worksheets("RunningDat").Range("A1").Value = Cells(LineStart, 2).Value
 TextBox29.Text = Format(Cells(LineStart, 2).Value, "yyyy/mm/dd")
 ThisWorkbook.Worksheets("RunningDat").Range("A4").NumberFormat = "@"
 ThisWorkbook.Worksheets("RunningDat").Range("A4").Value = Cells(LineStart, 4).Value
 TextBox1.Text = Cells(LineStart, 4).Value
 ThisWorkbook.Worksheets("RunningDat").Range("A5").NumberFormat = "@"
 ThisWorkbook.Worksheets("RunningDat").Range("A5").Value = Cells(LineStart, 5).Value
 Label11.Caption = Cells(LineStart, 5).Value
 ThisWorkbook.Worksheets("RunningDat").Range("A6").NumberFormat = "General"
 ThisWorkbook.Worksheets("RunningDat").Range("A6").Value = Cells(LineStart, 6).Value
 TextBox3.Text = Cells(LineStart, 6).Value
 LineNo = 101
 MyBook.Worksheets("BuildRec").Activate
 Do While LineStart <= LineEnd
  Cells(LineStart, 10).Select
  Do While ActiveCell.Value <> ""
    ThisWorkbook.Worksheets("RunningDat").Activate
    Rows(LineNo).NumberFormat = "General"
    Range(Cells(LineNo, 3), Cells(LineNo, 4)).NumberFormat = "@"
    MyBook.Worksheets("BuildRec").Activate
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 2) = ActiveCell.Offset(0, -1).Value
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 3) = ActiveCell.Value
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 4) = ActiveCell.Offset(0, 1).Value
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 5) = ActiveCell.Offset(0, 2).Value * (-1)
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 9) = ActiveCell.Offset(0, 3).Value * (-1)
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 10) = ActiveCell.Offset(0, 4).Value * (-1)
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 11) = ActiveCell.Offset(0, 5).Value * (-1)
    ThisWorkbook.Worksheets("RunningDat").Cells(LineNo, 12) = ActiveCell.Offset(0, 6).Value * (-1)
   ActiveCell.Offset(0, 8).Select
   LineNo = LineNo + 1
  Loop
  LineStart = LineStart + 1
 Loop
 ScrollBar1.Value = 1
 If LineNo < 111 Then
  ScrollBar1.Max = 1
 Else
  ScrollBar1.Max = LineNo - 109
 End If
  ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I
    Controls("Label" & I + 77).Caption = Cells(100 + I, 3).Value
    Controls("Label" & I + 89).Caption = Cells(100 + I, 4).Value
    Controls("Label" & I + 29).Caption = Cells(100 + I, 5).Value
    Controls("Label" & I + 41).Caption = Cells(100 + I, 6).Value
    Controls("Label" & I + 53).Caption = Cells(100 + I, 9).Value
    Controls("Textbox" & I + 16).Text = Cells(100 + I, 10).Value
    Controls("Label" & I + 65).Caption = Cells(100 + I, 11).Value
   Next I
 CommandButton5.Visible = False
 CommandButton2.Visible = False
  EventOff = False
Exit Sub
ResetForm:
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Range("C101").Select
  TextBox1.Text = ""
  TextBox3.Text = ""
  Label11.Caption = ""
  For I = 15 To 26
   Controls("Label" & I).Caption = I - 14
  Next I
  For I = 17 To 28
   Controls("Textbox" & I).Text = ""
  Next I
  For I = 30 To 101
   Controls("Label" & I).Caption = ""
  Next I
 ScrollBar1.Max = 7
 ScrollBar1.Value = 1
If RecordNo = "M" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("B1").Value) + 1), 5) Then
  CommandButton5.Visible = True
  CommandButton2.Visible = True
  Label10.Visible = False
Else
  CommandButton5.Visible = False
  CommandButton2.Visible = False
End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
End If
  EventOff = False
End Sub

Private Sub TextBox2_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
CommandButton2.Visible = False
CommandButton5.Visible = False
End Sub

Private Sub TextBox2_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox20_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(20)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox20_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox21_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(21)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox21_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox22_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(22)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox22_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox23_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(23)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox23_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox24_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(24)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox24_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox25_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(25)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox25_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox26_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(26)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox26_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox27_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(27)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox27_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox28_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
Call Form28Col1Exit(28)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox28_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox28_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 If KeyCode = vbKeyDown Or KeyCode = vbKeyReturn Then
   ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "BuildProduct"
   Call Form28Col1Exit(28)
   ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox27.SetFocus
      SendKeys "{Down}", False
 End If
  EventOff = False
End Sub

Private Sub TextBox29_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox29_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim RecordDate, DateString As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If CommandButton2.Visible = False Then
 If TextBox29.Text <> Format(ThisWorkbook.Worksheets("RunningDat").Cells(1.1).Value, "yyyy/mm/dd") Then
   Label10.Caption = Chr(13) & "   No Change to the record is allowed"
   Label10.Visible = True
 End If
 TextBox29.Text = Format(ThisWorkbook.Worksheets("RunningDat").Cells(1.1).Value, "yyyy/mm/dd")
 Exit Sub
End If
If TextBox29.Text = "" Then Exit Sub
DateString = TextBox29.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label10.Caption = Chr(13) & "    Incorrect Date entered"
 Label10.Visible = True
 Exit Sub
Else
 TextBox29.Text = Format(DateString, "yyyy/mm/dd")
End If
RecordDate = TextBox29.Text
If RecordDate < BeginningDate Then
 TextBox29.Text = ""
 Label10.Caption = Chr(13) & "   The Date entered is earlier than the Year Start Date which is not allowed"
 Label10.Visible = True
End If
End Sub

Private Sub TextBox3_AfterUpdate()
Dim LineNo As Long, CheckNum As Double
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If CommandButton2.Visible = False Then
  If TextBox3.Text <> ThisWorkbook.Worksheets("RunningDat").Range("A6").Value Then
   Label10.Caption = Chr(13) & "   No Change to the Job order record is allowed"
   Label10.Visible = True
  End If
  TextBox3.Text = ThisWorkbook.Worksheets("RunningDat").Range("A6").Value
   EventOff = False
  Exit Sub
End If
 If IsNumeric(TextBox3.Text) = True Then
   CheckNum = Format(TextBox3.Text, "0.0000")
   TextBox3.Text = CheckNum
   BuildQty = TextBox3.Text
    If BuildQty + ThisWorkbook.Worksheets("RunningDat").Range("A4").Value < 0 Then
      BuildQty = 0 - ThisWorkbook.Worksheets("RunningDat").Range("A4").Value
      BuildQty = Format(BuildQty, "0.0000")
      UserForm28.Label10.Caption = Chr(13) & "     Negative Build Qty. Cannot be less than " & BuildQty & ", otherwise the inventory will result in Negative quantity "
      UserForm28.Label10.Visible = True
      BuildQty = 0
      TextBox3.Text = BuildQty
    End If
 ElseIf TextBox3.Text = "" Then BuildQty = 0
 Else
   BuildQty = 0
   Label10.Caption = Chr(13) & "    Incorrect input for the Build quantity.  It must be a numeric number"
   Label10.Visible = True
 End If
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C101").Select
 Do While ActiveCell.Value <> ""
    ActiveCell.Offset(0, 6).Value = Format(ActiveCell.Offset(0, 2).Value * BuildQty, "0.0000")
       If ActiveCell.Offset(0, 6).Value > ActiveCell.Offset(0, 3).Value Then
          ActiveCell.Offset(0, 8).Value = "Insufficient Qty"
       Else
        ActiveCell.Offset(0, 8).Value = ActiveCell.Offset(0, 6).Value + ActiveCell.Offset(0, 7).Value
        If ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, 3).Value Then
          ActiveCell.Offset(0, 9).Value = ActiveCell.Offset(0, 4).Value
        Else
         If ActiveCell.Offset(0, 3).Value <> 0 Then
           ActiveCell.Offset(0, 9).Value = Format((ActiveCell.Offset(0, 4).Value * ActiveCell.Offset(0, 8).Value) / ActiveCell.Offset(0, 3).Value, "#,##0.00")
         Else
           ActiveCell.Offset(0, 9).Value = Format((ActiveCell.Offset(0, 5).Value * ActiveCell.Offset(0, 8).Value), "#,##0.00")
         End If
        End If
       End If
     ActiveCell.Offset(1, 0).Select
 Loop
LineNo = ScrollBar1.Value
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I + LineNo - 1
    Controls("Label" & I + 77).Caption = Cells(99 + LineNo + I, 3).Value
    Controls("Label" & I + 89).Caption = Cells(99 + LineNo + I, 4).Value
    Controls("Label" & I + 29).Caption = Cells(99 + LineNo + I, 5).Value
    Controls("Label" & I + 41).Caption = Cells(99 + LineNo + I, 6).Value
    Controls("Label" & I + 53).Caption = Cells(99 + LineNo + I, 9).Value
    Controls("Textbox" & I + 16).Text = Cells(99 + LineNo + I, 10).Value
    Controls("Label" & I + 65).Caption = Cells(99 + LineNo + I, 11).Value
 Next I
  EventOff = False
End Sub

Private Sub TextBox3_Change()
 If EventOff = True Then Exit Sub
 If CommandButton2.Visible = True Then Label10.Visible = False
End Sub

Private Sub UserForm_Initialize()
Dim TtlShNo As Long, I As Long, J As Long, LastProdRow As Long, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ThisWorkbook.Worksheets("Journal").Activate
ActiveSheet.UsedRange.Delete
Range("A1").Select
TtlShNo = MyBook.Worksheets("BOM1").Range("A9").Value
I = 1
Do While I <= TtlShNo
 MyBook.Worksheets("BOM" & I).Activate
  If Range("B10").Value <> "" Then
    Range("A10").End(xlToRight).Select
    J = ActiveCell.Column
    Range(Cells(10, 2), Cells(10, J)).Copy
    ThisWorkbook.Worksheets("Journal").Activate
    Selection.PasteSpecial Paste:=xlAll, Operation:=xlNone, SkipBlanks:=False, Transpose:=True
    If Range("A2") = "" Then
      Range("A2").Select
    Else
      Range("A1").End(xlDown).Select
      ActiveCell.Offset(1, 0).Select
    End If
  End If
    I = I + 1
 Loop
 ThisWorkbook.Worksheets("Journal").Activate
 LastProdRow = ActiveCell.Row - 1
 ListBox1.Clear
 If LastProdRow > 0 Then
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   MyBook.Worksheets("StockRec").Activate
   Set CheckRange = ActiveSheet.Columns("B")
   ThisWorkbook.Worksheets("Journal").Activate
   Range("A1").Select
   ListBox1.AddItem "SWITCH to listing by Product Description"
   Do While ActiveCell.Value <> ""
    If IsError(Application.Match(ActiveCell.Value, CheckRange, 0)) = False Then
       J = Application.Match(ActiveCell.Value, CheckRange, 0)
       ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("StockRec").Cells(J, 3).Value
     End If
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
    ActiveCell.Offset(1, 0).Select
   Loop
 Else
   ListBox1.AddItem "No Product available in the Record"
 End If
  ListBox1.AddItem "CLOSE this box"
 ThisWorkbook.Worksheets("RunningDat").Activate
 ActiveSheet.UsedRange.Delete
 EventOff = True
 TextBox2.Text = "M" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("B1").Value) + 1), 5)
 CommandButton2.Visible = True
 CommandButton5.Visible = True
  ScrollBar1.Max = 7
  ScrollBar1.Value = 1
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
End If
 EventOff = False
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
Application.EnableCancelKey = xlDisabled
If CloseMode = vbFormControlMenu Then
 EventOff = True
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
End If
EventOff = False
End Sub
Attribute VB_Name = "UserForm29"
Attribute VB_Base = "0{20D14EF5-FF88-4BB7-9005-F18242623AB1}{6DCF4459-2EE0-4E74-AE20-64AF7E0FE423}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public FormRow As Long

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = False
Unload Me
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton2_Click()
Dim I As Long, AdjustQty As Double, AdjustAmt As Double, RecordNo As String, AdjustDate As Date, StockQty As Double
Dim LastRowNo As Long, AccountNo As String, TotalSum As Double, LineNo As Long, DataRow As Long
Dim LineA As Long, LineB As Long
Dim QtySum As Double, AmtSum As Double, AssetNo As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 If IsDate(TextBox3.Text) = False Then
    Label10.Caption = "    The Date of Stock Take is not valid." & Chr(13) & _
                     "    Please double check the data before proceed."
    Label10.Visible = True
    Exit Sub
 Else
   AdjustDate = TextBox3.Text
   If AdjustDate > Date Then
    Label10.Caption = "    The Date of Stock Take is a future date." & Chr(13) & _
                     "    Please double check the data before proceed."
    Label10.Visible = True
    Exit Sub
   ElseIf AdjustDate < BeginningDate Then
    Label10.Caption = "    The Date of Stock Take is belonging to previous closed out accounting year." & Chr(13) & _
                     "    Update will not proceed to the current accounting year."
    Label10.Visible = True
    Exit Sub
   End If
 End If
EventOff = True
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C10").Select
If ActiveCell.Value = "" Then GoTo Finish
 If Range("C11").Value = "" Then
   LastRowNo = 10
 Else
    Range("C10").End(xlDown).Select
    LastRowNo = ActiveCell.Row
 End If
 Range(Cells(10, 1), Cells(LastRowNo, 11)).Select
 Selection.Sort Key1:=Range("I1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 Range("I10").Select
 If ActiveCell.Value <> "" And Range("I11").Value <> "" Then Range("I10").End(xlDown).Select
 If ActiveCell.Row < LastRowNo Then
   Do While ActiveCell.Value <> ""
     ActiveCell.Offset(1, 0).Select
   Loop
   Do While ActiveCell.Offset(0, -6).Value <> ""
     If ActiveCell.Offset(0, -1).Value <> 0 Then GoTo AcctMissing
     ActiveCell.Offset(1, 0).Select
   Loop
 End If
 Range(Cells(10, 1), Cells(LastRowNo, 11)).Select
 Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
MyBook.Worksheets("CountRec").Activate
I = 0
Range("A3").Select
Do While ActiveCell.Value <> "" And I < 35
 ActiveCell.Offset(0, 7).Select
 I = I + 1
Loop
 If ActiveCell.Value <> "" Then Columns("A:G").Delete
 Cells(1, I * 7 + 1).Select
 ThisWorkbook.Worksheets("RunningDat").Columns("C:I").Copy
 ActiveSheet.Paste
 Application.CutCopyMode = False
 RecordNo = TextBox2.Text
 Cells(3, I * 7 + 1).NumberFormat = "@"
 Cells(3, I * 7 + 1).Value = RecordNo
 Cells(4, I * 7 + 1).NumberFormat = "yyyy/mm/dd"
 Cells(4, I * 7 + 1).Value = AdjustDate
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C10").Select
 Range("C10").Select
 ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 4).Value = "" Or ActiveCell.Offset(0, 4).Value = 0 Then
     If ActiveCell.Offset(0, 5).Value = "" Or ActiveCell.Offset(0, 5).Value = 0 Then
      ActiveCell.EntireRow.Delete
       GoTo NoUpdate
     End If
  End If
  StockNo = ActiveCell.Value
  AdjustQty = ActiveCell.Offset(0, 4).Value
  AdjustAmt = ActiveCell.Offset(0, 5).Value
    If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
      I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
       MyBook.Worksheets("StockRec").Cells(I, 8).Value = Format(StockQty + AdjustQty, "0.0000")
       MyBook.Worksheets("StockRec").Cells(I, 9).Value = Format(MyBook.Worksheets("StockRec").Cells(I, 9).Value + AdjustAmt, "0.00")
       If MyBook.Worksheets("StockRec").Cells(I, 1).Value < AdjustDate Then MyBook.Worksheets("StockRec").Cells(I, 1).Value = AdjustDate
      If MyBook.Worksheets("StockRec").Cells(I, 8).Value <> 0 Then _
          MyBook.Worksheets("StockRec").Cells(I, 10).Value = MyBook.Worksheets("StockRec").Cells(I, 9).Value / MyBook.Worksheets("StockRec").Cells(I, 8).Value
        QtySum = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        AmtSum = MyBook.Worksheets("StockRec").Cells(I, 9).Value
        AssetNo = MyBook.Worksheets("StockRec").Cells(I, 5).Value
      If AdjustQty <> 0 Or AdjustAmt <> 0 Then
        Call InvIOAdd(AdjustQty, AdjustAmt, AdjustDate, QtySum, AmtSum, AssetNo)
        Call IOUpdate(AdjustQty, AdjustAmt, RecordNo, AdjustDate, "Adj", StockQty)
      End If
    End If
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveCell.Offset(1, 0).Select
NoUpdate:
 Loop
 ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
 LastRowNo = ActiveCell.Row - 1
 If LastRowNo < 10 Then GoTo NoGLEntry
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.UsedRange.Delete
 Range("E1").Select
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range(Cells(10, 2), Cells(LastRowNo, 8)).Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Columns("H:J").Delete
  Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("E1").Select
   LineA = 1
   LineB = LineA - 1
   Do While ActiveCell.Value <> ""
    AccountNo = ActiveCell.Value
    Do While ActiveCell.Value = AccountNo And ActiveCell.Value <> ""
     ActiveCell.Offset(20, 0).Select
    Loop
    If ActiveCell.Row - LineA > 19 Then
      ActiveCell.Offset(-19, 0).Select
      Do While ActiveCell.Value = AccountNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
      Loop
    End If
    LineB = ActiveCell.Row - 1
    If LineB >= LineA Then
      TotalSum = Application.Sum(Range(Cells(LineA, 8), Cells(LineB, 8)))
      TotalSum = Format(TotalSum, "0.00")
      If Abs(TotalSum) < 0.001 Then
       Range(Cells(LineA, 1), Cells(LineB, 8)).EntireRow.Delete
       LineB = LineA - 1
      Else
       If TotalSum >= 0 Then
        Cells(LineA, 8).NumberFormat = "General"
        Cells(LineA, 8).Value = TotalSum
        Cells(LineA, 9).ClearContents
        If LineB > LineA Then Range(Cells(LineA + 1, 1), Cells(LineB, 8)).EntireRow.Delete
       Else
        Cells(LineA, 9).NumberFormat = "General"
         Cells(LineA, 9).Value = Format(TotalSum * (-1), "0.00")
        Cells(LineA, 8).ClearContents
        If LineB > LineA Then Range(Cells(LineA + 1, 1), Cells(LineB, 8)).EntireRow.Delete
       End If
        LineA = LineA + 1
        LineB = LineA - 1
      End If
    End If
     Cells(LineA, 5).Select
   Loop
  ThisWorkbook.Worksheets("RunningDat").Activate
 Range(Cells(10, 2), Cells(LastRowNo, 9)).Select
  Selection.Sort Key1:=Range("I1"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("I10").Select
   LineA = 10
   LineB = LineA - 1
   Do While ActiveCell.Value <> ""
    AccountNo = ActiveCell.Value
    Do While ActiveCell.Value = AccountNo And ActiveCell.Value <> ""
     ActiveCell.Offset(20, 0).Select
    Loop
    If ActiveCell.Row - LineA > 19 Then
      ActiveCell.Offset(-19, 0).Select
      Do While ActiveCell.Value = AccountNo And ActiveCell.Value <> ""
       ActiveCell.Offset(1, 0).Select
      Loop
    End If
    LineB = ActiveCell.Row - 1
    If LineB >= LineA Then
      TotalSum = Application.Sum(Range(Cells(LineA, 8), Cells(LineB, 8)))
      TotalSum = Format(TotalSum, "0.00")
      If Abs(TotalSum) < 0.001 Then
       Range(Cells(LineA, 1), Cells(LineB, 8)).EntireRow.Delete
       LineB = LineA - 1
      Else
       If TotalSum >= 0 Then
        Cells(LineA, 13).NumberFormat = "General"
        Cells(LineA, 13).Value = TotalSum
        Cells(LineA, 12).ClearContents
        If LineB > LineA Then Range(Cells(LineA + 1, 1), Cells(LineB, 8)).EntireRow.Delete
       Else
        Cells(LineA, 12).NumberFormat = "General"
        Cells(LineA, 12).Value = TotalSum * (-1)
        Cells(LineA, 13).ClearContents
        If LineB > LineA Then Range(Cells(LineA + 1, 1), Cells(LineB, 8)).EntireRow.Delete
       End If
        LineA = LineA + 1
        LineB = LineA - 1
      End If
    End If
     Cells(LineA, 9).Select
   Loop
    LastRowNo = ActiveCell.Row - 1
    Range(Cells(10, 9), Cells(LastRowNo, 13)).Copy
    Worksheets("TempRP").Activate
    ActiveSheet.Paste
    Application.CutCopyMode = False
    If Range("E1").Value = "" Then
      GoTo NoGLEntry
    Else
      Range("E1").End(xlDown).Select
      LastRowNo = ActiveCell.Row
    End If
  Range(Cells(1, 6), Cells(LastRowNo, 6)).NumberFormat = "General"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).NumberFormat = "@"
  Range(Cells(1, 6), Cells(LastRowNo, 6)).Copy
  Range(Cells(1, 6), Cells(LastRowNo, 6)).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  Range(Cells(1, 10), Cells(LastRowNo, 10)).NumberFormat = "@"
  Range(Cells(1, 10), Cells(LastRowNo, 10)).Value = RecordNo
  Range(Cells(1, 7), Cells(LastRowNo, 7)).Value = "Stock Take # " & RecordNo
  Range(Cells(1, 4), Cells(LastRowNo, 4)).NumberFormat = "yyyy/mm/dd"
  Range(Cells(1, 4), Cells(LastRowNo, 4)).Value = AdjustDate
   AcctYear = Int((Period(Date) - Period(BeginningDate)) / 12)
   AcctYear = AcctYear + Year(BeginningDate)
   JournalCode = "SV" & AcctYear
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   JcodeRow = 251
   Set JournalRange = Range("G250")
   If ActiveCell.Offset(1, 0).Value <> "" Then
    Range("G250").End(xlDown).Select
    JcodeRow = ActiveCell.Row + 1
   End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
   Else
    JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
    LastTranNo = Cells(JcodeRow, 8).Value
    LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
    Cells(JcodeRow, 8).Value = LastTranNo
   End If
   LastJournalCode = JournalCode
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(LastRowNo, 1)).NumberFormat = "@"
   Range(Cells(1, 1), Cells(LastRowNo, 1)).Value = JournalCode
   Range(Cells(1, 2), Cells(LastRowNo, 2)).NumberFormat = "@"
   Range(Cells(1, 2), Cells(LastRowNo, 2)).Value = LastTranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(LastRowNo, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
NoGLEntry:
   P = Period(Date) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
 MyBook.Worksheets("BuildRec").Range("F1").Value = Right(RecordNo, 5)
 ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
Finish:
ThisWorkbook.Worksheets("RunningDat").Activate
ActiveSheet.UsedRange.Delete
Worksheets("TempRP").UsedRange.Delete
EventOff = True
For I = 1 To 3
 Controls("TextBox" & I).Text = ""
Next I
 ScrollBar1.Max = 1
 ScrollBar1.Value = 1
   For I = 1 To 12
    Controls("Label" & I + 14).Caption = I
    Controls("Label" & I + 29).Caption = Cells(9 + I, 3).Value
    Controls("Label" & I + 41).Caption = Cells(9 + I, 4).Value
    Controls("Label" & I + 53).Caption = Cells(9 + I, 5).Value
    Controls("Textbox" & I + 4).Text = Cells(9 + I, 6).Value
    Controls("Textbox" & I + 16).Text = Cells(9 + I, 7).Value
    Controls("Textbox" & I + 28).Text = Cells(9 + I, 8).Value
    Controls("Textbox" & I + 40).Text = Cells(9 + I, 9).Value
  Next I
 Label10.Visible = False
 CommandButton2.Visible = False
 TextBox1.Visible = False
 CommandButton4.Visible = False
 Label27.Visible = False
 EventOff = False
 Exit Sub
AcctMissing:
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range(Cells(10, 1), Cells(LastRowNo, 11)).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Label10.Caption = "    The Affected Account number for some items are not entered." & Chr(13) & _
                     "    Please double check the data before proceed."
    Label10.Visible = True
 EventOff = False
End Sub

Private Sub CommandButton22_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 41
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton23_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 42
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton24_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 43
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton25_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 44
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton26_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 45
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton27_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 46
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub
Private Sub CommandButton28_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 47
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton29_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 48
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton3_Click()
Dim I As Long, PoductExist As String
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("RunningDat").Activate
ActiveSheet.UsedRange.Delete
Range("C10").Select
 Label7.Caption = "Amount" & Chr(13) & "(" & SysCurrency & ")"
 EventOff = True
 TextBox2.Text = "ST" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("F1").Value) + 1), 5)
  ScrollBar1.Max = 7
  ScrollBar1.Value = 1
  TextBox3.Text = ""
  CommandButton2.Visible = True
  Label27.Visible = True
  TextBox1.Visible = True
  CommandButton4.Visible = True
  Label10.Visible = False
  ListBox1.Visible = False
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 Label27.Visible = False
 TextBox1.Visible = False
 CommandButton4.Visible = False
 EventOff = False
 Exit Sub
End If
 MyBook.Worksheets("StockRec").Activate
 If Range("B2").Value <> "" Then
   Range("B1").End(xlDown).Select
   I = ActiveCell.Row
   Range(Cells(2, 2), Cells(I, 10)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   If I < 13 Then
     ScrollBar1.Max = 1
   Else
     ScrollBar1.Max = I - 11
   End If
   I = I + 8
   Range(Cells(10, 6), Cells(I, 6)).Copy
   Range("B10").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(10, 10), Cells(I, 10)).Copy
   Range("A10").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Columns("J").Delete
  Columns("E:H").Delete
  Columns("F:I").EntireColumn.Insert
  Range(Cells(10, 1), Cells(I, 11)).Select
  Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range(Cells(10, 5), Cells(I, 5)).Copy
  Range("F10").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  Range("C9").Select
   For I = 1 To 12
    Controls("Label" & I + 14).Caption = I
    Controls("Label" & I + 29).Caption = Cells(9 + I, 3).Value
    Controls("Label" & I + 41).Caption = Cells(9 + I, 4).Value
    Controls("Label" & I + 53).Caption = Cells(9 + I, 5).Value
    Controls("Textbox" & I + 4).Text = Cells(9 + I, 6).Value
    Controls("Textbox" & I + 16).Text = Cells(9 + I, 7).Value
    Controls("Textbox" & I + 28).Text = Cells(9 + I, 8).Value
    Controls("Textbox" & I + 40).Text = Cells(9 + I, 9).Value
  Next I
 End If
 EventOff = False
End Sub

Private Sub CommandButton30_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 49
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton31_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 50
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton32_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 51
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton33_Click()
If CommandButton2.Visible = False Then Exit Sub
Application.EnableCancelKey = xlDisabled
FormRow = 52
If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
ListBox1.Visible = True
End Sub

Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = True
FormRow = 1
End Sub

Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
  EventOff = True
  ListBox1.Visible = False
   Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
  ThisWorkbook.Worksheets("Report").Activate
 Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
   Range("A10").Select
    Range("A8").Value = "Stock #"
    Range("A9").Value = "-------------------------"
    Range("B8").Value = " Part Description "
    Range("B9").Value = "-----------------------------------------------------------"
    Range("G8").Value = "Book Qty"
    Range("G9").Value = "-------------------"
    Range("H8").Value = "Actual Count"
    Range("H9").Value = "-------------------"
    Range("I8").Value = "Qty Adjusted"
    Range("I9").Value = "-------------------"
    Columns("A:A").ColumnWidth = 20
    Columns("B:B").ColumnWidth = 45
    Columns("G:I").ColumnWidth = 16
 MyBook.Worksheets("StockRec").Activate
 If Range("B2").Value = "" Then GoTo Finish
   Range("B1").End(xlDown).Select
   I = ActiveCell.Row
   Range(Cells(2, 2), Cells(I, 8)).Copy
   ThisWorkbook.Worksheets("Report").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   I = I + 8
  Range(Cells(10, 1), Cells(I, 10)).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("A1").Select
Finish:
   ThisWorkbook.Worksheets("Report").Activate
   Columns("C:F").Delete
   If Range("A10").Value = "" Then Range("B11").Value = "    No Record of Stock Item. "
   Range("A1").Value = " Stock Take Date : "
   Range("A2").Value = " Stock Take Ref # : " & "ST" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("F1").Value) + 1), 5)
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C:E").HorizontalAlignment = xlCenter
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$9"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
    Range("A1:E19").Select
    ActiveWindow.Zoom = True
 ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 ThisWorkbook.Worksheets("Report").Activate
  Range("C1").Select
 EventOff = False
   Label10.BackColor = &HC0&
 Label10.Visible = False
 Me.Hide
 MyBook.Activate
  ThisWorkbook.Worksheets("Report").Activate
  Range("C1").Select
  SheetName = "Report"
  OldForm = "UserForm29"
End Sub

Private Sub CommandButton7_Click()
Application.EnableCancelKey = xlDisabled
  EventOff = True
  ListBox1.Visible = False
 Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
  ThisWorkbook.Worksheets("Report").Activate
 Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
   Range("A10").Select
    Range("A8").Value = "Stock #"
    Range("A9").Value = "-------------------------"
    Range("B8").Value = " Part Description "
    Range("B9").Value = "-----------------------------------------------------------"
    Range("C8").Value = "Book Qty"
    Range("C9").Value = "-------------------"
    Range("D8").Value = "Actual Count"
    Range("D9").Value = "-------------------"
    Range("E8").Value = "Qty Adjusted"
    Range("E9").Value = "-------------------"
    Range("F7").Value = "Amount Adjusted"
    Range("F8").Value = "(" & SysCurrency & ")"
    Range("F9").Value = "-------------------"
    Range("G8").Value = "Acct # for Bal"
    Range("G9").Value = "-------------------"
    Columns("A:A").ColumnWidth = 18
    Columns("B:B").ColumnWidth = 45
    Columns("C:G").ColumnWidth = 15.5
  Worksheets("RunningDat").Activate
 If Range("C10").Value = "" Then GoTo Finish
   If Range("C11").Value = "" Then
     I = 10
   Else
     Range("C10").End(xlDown).Select
     I = ActiveCell.Row
   End If
   Range(Cells(10, 3), Cells(I, 9)).Copy
   ThisWorkbook.Worksheets("Report").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Range(Cells(10, 1), Cells(I, 7)).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("C9").Select
Finish:
   ThisWorkbook.Worksheets("Report").Activate
   If Range("A10").Value = "" Then Range("B11").Value = "    No Data. "
   Range("A1").Value = " Stock Take Date : " & TextBox3.Text
   Range("A2").Value = " Stock Take Ref # : " & TextBox2.Text
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C:G").HorizontalAlignment = xlCenter
   On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$9"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
NoPrinter:
    Range("A1:G19").Select
    ActiveWindow.Zoom = True
    Range("D1").Select
 ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 ThisWorkbook.Worksheets("Report").Activate
 EventOff = False
   Label10.BackColor = &HC0&
 Label10.Visible = False
 Me.Hide
  SheetName = "Report"
  OldForm = "UserForm29"
End Sub

Private Sub Label42_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label42.Width = 284
End Sub

Private Sub Label42_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label42.Width = 156
End Sub

Private Sub Label43_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label43.Width = 284
End Sub

Private Sub Label43_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label43.Width = 156
End Sub

Private Sub Label44_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label44.Width = 284
End Sub

Private Sub Label44_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label44.Width = 156
End Sub

Private Sub Label45_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label45.Width = 284
End Sub

Private Sub Label45_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label45.Width = 156
End Sub

Private Sub Label46_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label46.Width = 284
End Sub

Private Sub Label46_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label46.Width = 156
End Sub

Private Sub Label47_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label47.Width = 284
End Sub

Private Sub Label47_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label47.Width = 156
End Sub

Private Sub Label48_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label48.Width = 284
End Sub

Private Sub Label48_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label48.Width = 156
End Sub

Private Sub Label49_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label49.Width = 284
End Sub

Private Sub Label49_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label49.Width = 156
End Sub

Private Sub Label50_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label50.Width = 284
End Sub

Private Sub Label50_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label50.Width = 156
End Sub

Private Sub Label51_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label51.Width = 284
End Sub

Private Sub Label51_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label51.Width = 156
End Sub

Private Sub Label52_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label52.Width = 284
End Sub

Private Sub Label52_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label52.Width = 156
End Sub

Private Sub Label53_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label53.Width = 284
End Sub

Private Sub Label53_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label53.Width = 156
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim AccountNo As String, EndNo As Long, EntryNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
EndNo = 2
AccountNo = ListBox1.Text
If FormRow <> 1 Then
 If Controls("Label" & FormRow - 11).Caption = "" Then Exit Sub
End If
 Do While Mid(AccountNo, EndNo, 1) <> " "
  EndNo = EndNo + 1
 Loop
AccountNo = Left(AccountNo, EndNo - 1)
Controls("Textbox" & FormRow).Text = AccountNo
 ThisWorkbook.Worksheets("RunningDat").Activate
 EventOff = True
If FormRow = 1 Then
 Cells(10, 3).Select
 Do While ActiveCell.Value <> ""
  ActiveCell.Offset(0, 6).Value = AccountNo
  ActiveCell.Offset(1, 0).Select
 Loop
   LineNo = ScrollBar1.Value
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I + LineNo - 1
    Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
  Next I
Else
 EntryNo = Val(Controls("Label" & FormRow - 26).Caption)
 Cells(EntryNo + 9, 9).Value = AccountNo
End If
 ListBox1.Visible = False
 EventOff = False
End Sub

Private Sub ScrollBar1_Change()
Dim LineNo As Long
Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("RunningDat").Activate
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I + LineNo - 1
    Controls("Label" & I + 29).Caption = Cells(8 + LineNo + I, 3).Value
    Controls("Label" & I + 41).Caption = Cells(8 + LineNo + I, 4).Value
    Controls("Label" & I + 53).Caption = Cells(8 + LineNo + I, 5).Value
    Controls("Textbox" & I + 4).Text = Cells(8 + LineNo + I, 6).Value
    Controls("Textbox" & I + 16).Text = Cells(8 + LineNo + I, 7).Value
    Controls("Textbox" & I + 28).Text = Cells(8 + LineNo + I, 8).Value
    Controls("Textbox" & I + 40).Text = Cells(8 + LineNo + I, 9).Value
  Next I
End Sub

Private Sub TextBox1_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 1
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29AcctExit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox17_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 17
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox17_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
 If KeyCode = vbKeyUp Then
   FormRow = 17
   ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
   Call Form29Col2Exit(FormRow)
   ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox18.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox18_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 18
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox19_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 19
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox2_AfterUpdate()
Dim RecordNo As String, I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label10.Visible = False
If TextBox2.Text = "" Then GoTo ClearForm
If TextBox2.Text = "ST" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("F1").Value) + 1), 5) Then GoTo ClearForm
If IsNumeric(TextBox2.Text) = True Then TextBox2.Text = "ST" & Right(("00000" & TextBox2.Text), 5)
ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
 RecordNo = UCase(TextBox2.Text)
If Left(RecordNo, 2) <> "ST" Then GoTo ClearForm
  TextBox2.Text = RecordNo
MyBook.Worksheets("CountRec").Activate
Range("A3").Select
If ActiveCell.Value <> RecordNo Then
 Do While ActiveCell.Value <> "" And ActiveCell.Column < 254
  If ActiveCell.Value = RecordNo Then Exit Do
  ActiveCell.Offset(0, 7).Select
 Loop
End If
If ActiveCell.Value <> RecordNo Then GoTo ClearForm
 Selection.EntireColumn.Columns("A:G").Copy
ThisWorkbook.Worksheets("RunningDat").Activate
Range("C1").Select
ActiveSheet.Paste
Application.CutCopyMode = False
If Range("C11") <> "" Then
 Range("C10").End(xlDown).Select
 I = ActiveCell.Row
   If I < 21 Then
     ScrollBar1.Max = 1
   Else
     ScrollBar1.Max = I - 19
   End If
End If
TextBox3.Text = Format(Range("C4").Value, "yyyy/mm/dd")
ScrollBar1.Value = 1
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I
    Controls("Label" & I + 29).Caption = Cells(9 + I, 3).Value
    Controls("Label" & I + 41).Caption = Cells(9 + I, 4).Value
    Controls("Label" & I + 53).Caption = Cells(9 + I, 5).Value
    Controls("Textbox" & I + 4).Text = Cells(9 + I, 6).Value
    Controls("Textbox" & I + 16).Text = Cells(9 + I, 7).Value
    Controls("Textbox" & I + 28).Text = Cells(9 + I, 8).Value
    Controls("Textbox" & I + 40).Text = Cells(9 + I, 9).Value
  Next I
 EventOff = False
Exit Sub
ClearForm:
 ThisWorkbook.Worksheets("RunningDat").Activate
 ActiveSheet.UsedRange.Delete
  ScrollBar1.Max = 1
  ScrollBar1.Value = 1
  TextBox1.Text = ""
  TextBox3.Text = ""
  For I = 1 To 12
    Controls("Label" & I + 14).Caption = I
    Controls("Label" & I + 29).Caption = Cells(9 + I, 3).Value
    Controls("Label" & I + 41).Caption = Cells(9 + I, 4).Value
    Controls("Label" & I + 53).Caption = Cells(9 + I, 5).Value
    Controls("Textbox" & I + 4).Text = Cells(9 + I, 6).Value
    Controls("Textbox" & I + 16).Text = Cells(9 + I, 7).Value
    Controls("Textbox" & I + 28).Text = Cells(9 + I, 8).Value
    Controls("Textbox" & I + 40).Text = Cells(9 + I, 9).Value
  Next I
  Label10.Caption = Chr(13) & "     The Stock Take Ref # is not Found from the Record"
  Label10.Visible = True
 EventOff = False
End Sub

Private Sub TextBox2_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 CommandButton2.Visible = False
 TextBox1.Visible = False
 CommandButton4.Visible = False
 Label27.Visible = False
End Sub

Private Sub TextBox2_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox20_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 20
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox21_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 21
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox22_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 22
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox23_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 23
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox24_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 24
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox25_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 25
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox26_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 26
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox27_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 27
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox28_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 28
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col2Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox28_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyDown Or KeyCode = vbKeyReturn Then
  FormRow = 28
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
  Call Form29Col2Exit(FormRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox27.SetFocus
      SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox29_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 29
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox29_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
  FormRow = 29
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
  Call Form29Col3Exit(FormRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox30.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox3_Enter()
If EventOff = True Then Exit Sub
ListBox1.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
 Label10.Visible = False
 If CommandButton2.Visible = False Then
  TextBox3.Text = Format(ThisWorkbook.Worksheets("RunningDat").Range("C4").Value, "yyyy/mm/dd")
  Exit Sub
 End If
  If TextBox3.Text = "" Then Exit Sub
 DateString = TextBox3.Text
 Call DateConvert(DateString)

 If IsDate(DateString) = False And TextBox2.Text <> "" Then
   Cancel = True
   Label10.Caption = Chr(13) & "    Not a Valid Date. "
   Label10.Visible = True
   Exit Sub
 Else
  TextBox3.Text = Format(DateString, "yyyy/mm/dd")
 End If
End Sub

Private Sub TextBox30_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 30
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox31_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 31
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox32_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 32
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox33_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 33
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox34_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 34
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox35_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 35
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox36_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 36
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox37_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 37
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox38_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 38
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox39_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 39
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox40_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 40
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col3Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox40_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyDown Or KeyCode = vbKeyReturn Then
  FormRow = 40
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
  Call Form29Col3Exit(FormRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox39.SetFocus
      SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox41_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 41
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox41_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyUp Then
   FormRow = 41
   ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
   Call Form29AcctExit(FormRow)
   ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox42.SetFocus
      SendKeys "{Up}", False
 End If
  EventOff = False
End Sub

Private Sub TextBox42_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 42
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox43_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 43
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox44_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 44
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox45_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 45
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox46_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 46
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox47_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 47
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox48_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 48
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox49_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 49
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox50_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 50
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox51_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 51
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox52_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 FormRow = 52
 ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
 Call Form29AcctExit(FormRow)
 ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
 EventOff = False
End Sub

Private Sub TextBox52_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyDown Or KeyCode = vbKeyReturn Then
   FormRow = 52
   ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
   Call Form29AcctExit(FormRow)
   ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox51.SetFocus
      SendKeys "{Down}", False
 End If
  EventOff = False
End Sub

Private Sub TextBox5_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 5
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox5_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
  FormRow = 5
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
  Call Form29Col1Exit(FormRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox6.SetFocus
      SendKeys "{Up}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox6_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 6
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox7_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 7
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox8_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 8
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox9_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 9
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox10_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 10
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox11_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 11
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox12_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 12
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox13_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 13
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub
Private Sub TextBox14_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 14
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox15_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 15
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox16_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
FormRow = 16
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
Call Form29Col1Exit(FormRow)
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
EventOff = False
End Sub

Private Sub TextBox16_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyDown Or KeyCode = vbKeyReturn Then
  FormRow = 16
  ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "PIAdj"
  Call Form29Col1Exit(FormRow)
  ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox15.SetFocus
      SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub UserForm_Initialize()
Dim I As Long, PoductExist As String, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ThisWorkbook.Worksheets("RunningDat").Activate
ActiveSheet.UsedRange.Delete
Range("C10").Select
  ListBox1.Clear
  L = 10
  M = LastRowChartofAccount
  For I = L To M
   N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
   spacing = " -------"
   spacing = Left(spacing, 8 - N)
   If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
     ListBox1.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
   End If
   Next I
  ListBox1.AddItem "CLOSE this box"
 Label7.Caption = "Amt Adj" & Chr(13) & "(" & SysCurrency & ")"
 EventOff = True
 TextBox2.Text = "ST" & Right(("00000" & Val(MyBook.Worksheets("BuildRec").Range("F1").Value) + 1), 5)
  ScrollBar1.Max = 7
  ScrollBar1.Value = 1
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 Label27.Visible = False
 TextBox1.Visible = False
 CommandButton4.Visible = False
 EventOff = False
 Exit Sub
End If
 MyBook.Worksheets("StockRec").Activate
 If Range("B2").Value <> "" Then
   Range("B1").End(xlDown).Select
   I = ActiveCell.Row
   Range(Cells(2, 2), Cells(I, 10)).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
   If I < 13 Then
     ScrollBar1.Max = 1
   Else
     ScrollBar1.Max = I - 11
   End If
   I = I + 8
   Range(Cells(10, 6), Cells(I, 6)).Copy
   Range("B10").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range(Cells(10, 10), Cells(I, 10)).Copy
   Range("A10").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Columns("J").Delete
  Columns("E:H").Delete
  Columns("F:I").EntireColumn.Insert
  Columns("F:I").NumberFormat = "General"
  Range(Cells(10, 5), Cells(I, 5)).Copy
   Range("F10").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Range(Cells(10, 1), Cells(I, 11)).Select
  Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("C9").Select
   For I = 1 To 12
    Controls("Label" & I + 14).Caption = I
    Controls("Label" & I + 29).Caption = Cells(9 + I, 3).Value
    Controls("Label" & I + 41).Caption = Cells(9 + I, 4).Value
    Controls("Label" & I + 53).Caption = Cells(9 + I, 5).Value
    Controls("Textbox" & I + 4).Text = Cells(9 + I, 6).Value
   Next I
 End If
 TextBox3.SetFocus
 EventOff = False
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
Application.EnableCancelKey = xlDisabled
If CloseMode = vbFormControlMenu Then
 EventOff = True
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
End If
EventOff = False
End Sub
Attribute VB_Name = "UserForm3"
Attribute VB_Base = "0{FC8B3E65-AD51-4FCC-9F0C-4FE48FBF74ED}{C6406946-90F3-4154-8798-AEC2F0D52E4E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub ComboBox1_Change()
Dim TargetFile As String, TargetFilePath As String, F As Long
Application.EnableCancelKey = xlDisabled
 Application.EnableEvents = False
 Application.ScreenUpdating = False
TargetFile = ComboBox1.Text
Worksheets("NewCom").Range("B18").Value = TargetFile
Worksheets("ComFactSheet").Range("B21").Select
Do While ActiveCell.Value <> ""
 If ActiveCell.Value = TargetFile Then
  Worksheets("NewCom").Range("B17").Value = ActiveCell.Offset(0, -1).Value
  Worksheets("NewCom").Range("B19").Value = ActiveCell.Offset(0, 1).Value
 Exit Do
 End If
 ActiveCell.Offset(1, 0).Select
Loop
Application.EnableEvents = True
Application.ScreenUpdating = True
ComboBox1.Visible = False
ComboBox1.Visible = True
End Sub

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
Unload Me
ThisWorkbook.Worksheets("IniData").Activate
SheetName = "IniData"
End Sub

Private Sub CommandButton2_Click()
Dim I As Long, TargeFile As String, TargetFilePath As String, TargetExtn As String, TargetBook As Workbook
Application.EnableCancelKey = xlDisabled
 Application.EnableEvents = False
 Application.ScreenUpdating = False
  ThisWorkbook.Activate
  TargetFile = Worksheets("NewCom").Range("B18").Value
  TargetFilePath = Worksheets("NewCom").Range("B17").Value
  TargetExtn = Worksheets("NewCom").Range("B19").Value
  Worksheets("IniData").Activate
  Range("A15").Select
   Range(Selection, Selection.End(xlDown)).EntireRow.Delete
   I = Workbooks.Count
  Do While I > 0
   If UCase(Workbooks(I).Name) = UCase(TargetFile & TargetExtn) Then Exit Do
   I = I - 1
  Loop
  If I <> 0 Then
   Workbooks(I).Activate
   Set TargetBook = ActiveWorkbook
  Else
   Application.Workbooks.Open TargetFilePath & TargetFile & TargetExtn
    End If
  Set TargetBook = ActiveWorkbook
  TargetBook.Worksheets("Chart of Account").Activate
  
   If Range("A10").Value <> "" Then
    Range("A10:D10").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Copy
    ThisWorkbook.Worksheets("IniData").Activate
    Range("A15").Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Range("A15").Select
    Do While ActiveCell <> ""
     If Left((ActiveCell.Value & "000"), 2) = 36 And ActiveCell.Value > 3610 Then
        ActiveCell.EntireRow.Delete
        ActiveCell.Offset(-1, 0).Select
      End If
      ActiveCell.Offset(1, 0).Select
    Loop
   End If
  Unload Me
  Range("A15").Select
  MsgBox ("The Required Chart of Account has been Imported")
  If UCase(MyBook.Name) <> UCase(TargetBook.Name) Then TargetBook.Close (False)
 Do While ActiveCell.Value <> ""
  If Left((ActiveCell.Value & "000"), 1) = 1 Then
   If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
     ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   Else
     ActiveCell.Offset(0, 4).Value = 0
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   End If
  ElseIf Left((ActiveCell.Value & "000"), 1) = 2 Then
   If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
     ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   Else
    ActiveCell.Offset(0, 5).Value = 0
    ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
   End If
  ElseIf Left((ActiveCell.Value & "000"), 1) = 3 Then
   If Len(ActiveCell.Value) < Len(ActiveCell.Offset(1, 0).Value) Or Len(ActiveCell.Value) = 1 Then
     ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
     ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
   Else
    ActiveCell.Offset(0, 5).Value = 0
    ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
   End If
  Else
    ActiveCell.Offset(0, 4).Borders(xlDiagonalUp).LineStyle = xlContinuous
    ActiveCell.Offset(0, 5).Borders(xlDiagonalUp).LineStyle = xlContinuous
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
Range("A15").Select
Application.EnableEvents = True
 Application.ScreenUpdating = True
End Sub

Private Sub UserForm_Activate()
Dim I As Long, J As Long, LineNo As Long, FileNo As String
Dim myFSO As Object, FilePath As String
Application.EnableCancelKey = xlDisabled
 Application.EnableEvents = False
 Application.ScreenUpdating = False
ComboBox1.Clear
Worksheets("ComFactSheet").Activate
Range("D21").Select
 Do While ActiveCell.Value <> "" And ActiveCell.Value = 0
 ComboBox1.AddItem ActiveCell.Offset(0, -2).Value
 ActiveCell.Offset(1, 0).Select
Loop
ComboBox1.Value = Range("B18").Value
Worksheets("NewCom").Range("B18").Value = Range("B18").Value
Worksheets("NewCom").Range("B17").Value = Range("A18").Value
Worksheets("NewCom").Range("B19").Value = Range("C18").Value
 Application.EnableEvents = True
 Application.ScreenUpdating = True
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub

Private Sub UserForm_Terminate()
Worksheets("NewCom").Range("B17:B19").ClearContents
End Sub
Attribute VB_Name = "UserForm30"
Attribute VB_Base = "0{A55AB7C2-D36B-46D6-B021-AE100879A3AE}{6BC71546-161E-4087-BA14-6F455ECAB98D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public SheetId As String
Private Sub ComboBox1_AfterUpdate()
Dim CurCode As String, I As Long, J As Long, FinalCode As String
Application.EnableCancelKey = xlDisabled
 Label3.Visible = False
If ComboBox1.Value = "" Then GoTo Finish
 CurCode = UCase(ComboBox1.Value)
If Left(CurCode, 1) = " " Then
 I = Len(CurCode)
 J = 1
 Do While J <= I And Mid(CurCode, J, 1) = " "
  J = J + 1
 Loop
  CurCode = Right(CurCode, I - J + 1)
End If
If Right(CurCode, 1) = " " Then
 I = Len(CurCode)
 J = I
 Do While J > 0 And Mid(CurCode, J, 1) = " "
  J = J - 1
 Loop
  CurCode = Left(CurCode, J)
End If
If Len(CurCode) <> 3 Then
 ComboBox1.Value = CurCode
 Label3.Caption = Chr(13) & "  Incorrect Currency Code, It should be made up with 3 Alphabets"
 Label3.Visible = True
Else
 FinalCode = ""
 For I = 1 To 3
  If Asc(Mid(CurCode, I, 1)) >= 65 And Asc(Mid(CurCode, I, 1)) <= 90 Then
    FinalCode = FinalCode + Mid(CurCode, I, 1)
  End If
 Next I
 ComboBox1.Value = FinalCode
 If Len(FinalCode) <> 3 Then
  Label3.Caption = Chr(13) & "  Incorrect Currency Code, It should be made up with 3 Alphabets"
  Label3.Visible = True
 End If
End If
Finish:
CurCode = ComboBox1.Value
 If ComboBox1.Value = "" Or Len(CurCode) <> 3 Then
  Label5.Caption = "One dollar to "
  Exit Sub
 End If
 Label5.Caption = "One " & CurCode & " to "
 MyBook.Worksheets("ComData").Activate
 Range("X50").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Value = CurCode Then
   TextBox1.Text = ActiveCell.Offset(0, 1).Value
   Exit Do
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
End Sub

Private Sub ComboBox1_Click()
Dim CurCode As String
Application.EnableCancelKey = xlDisabled
Label3.Visible = False
CurCode = ComboBox1.Value
If ComboBox1.Value = "" Then
 Label5.Caption = "One dollar to "
 Exit Sub
End If
Label5.Caption = "One " & CurCode & " to "
MyBook.Worksheets("ComData").Activate
Range("X50").Select
Do While ActiveCell.Value <> ""
 If ActiveCell.Value = CurCode Then
  TextBox1.Text = ActiveCell.Offset(0, 1).Value
  Exit Do
 End If
 ActiveCell.Offset(1, 0).Select
Loop
End Sub

Private Sub CommandButton1_Click()
  Unload Me
End Sub

Private Sub CommandButton2_Click()
Dim LineNo As Long, ReportCur As String, Rate As Double, TotalSum As Double, InvOrCN As String
Application.EnableCancelKey = xlDisabled
If SheetId = "Invoice" Then GoTo InvConvert
ThisWorkbook.Worksheets("PO").Activate
If Range("G17").Value <> "(" & SysCurrency & ")" Then
  Label3.Caption = "   The currency for conversion is not of " & SysCurrency & Chr(13) & _
      "   Please re-generate the data before proceed."
  Label3.Visible = True
  Exit Sub
End If
If ComboBox1.Value = SysCurrency Then
 Label3.Caption = Chr(13) & "   Please choose the required currency for conversion."
 Label3.Visible = True
  Exit Sub
End If
If ComboBox1.Value = "" Then
  Label3.Caption = "   The currency for conversion is not entered" & Chr(13) & _
      "   Please enter the currency before proceed."
  Label3.Visible = True
  Exit Sub
ElseIf Len(ComboBox1.Value) <> 3 Then
  Label3.Caption = "   The currency code for conversion is not correct" & Chr(13) & _
      "   It should be made up with 3 Alphabets."
  Label3.Visible = True
  Exit Sub
End If
If TextBox1.Value = "" Then
 Label3.Caption = Chr(13) & "   Please enter the exchange rate."
 Label3.Visible = True
  Exit Sub
End If
If IsNumeric(TextBox1.Value) = False Then
 Label3.Caption = "   The exchange rate is improperly entered." & Chr(13) & "   Please enter the exchange rate again."
 Label3.Visible = True
  Exit Sub
End If
If TextBox1.Value = 0 Then
 Label3.Caption = "   The exchange rate is improperly entered." & Chr(13) & "   It should not be zero."
 Label3.Visible = True
  Exit Sub
End If
 Label3.BackColor = &H40C0&
 Label3.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label3.Visible = True
 DoEvents
ReportCur = ComboBox1.Value
Rate = TextBox1.Text
MyBook.Worksheets("ComData").Activate
Range("X50").Select
Do While ActiveCell.Value <> ""
 If ActiveCell.Value = ReportCur Then
  ActiveCell.Offset(0, 1).NumberFormat = "General"
  If ActiveCell.Row = 50 Then
   ActiveCell.Offset(0, 1).Value = Rate
  Else
   ActiveCell.Value = Range("X50").Value
   ActiveCell.Offset(0, 1).Value = Range("Y50").Value
   Range("X50").Value = ReportCur
   Range("Y50").Value = Rate
  End If
  Exit Do
 End If
 ActiveCell.Offset(1, 0).Select
Loop
If ActiveCell.Value = "" Then
 ActiveCell.Offset(0, 1).NumberFormat = "General"
 If ActiveCell.Row = 50 Then
  ActiveCell.Value = ReportCur
  ActiveCell.Offset(0, 1).Value = Rate
 Else
  ActiveCell.Value = Range("X50").Value
  ActiveCell.Offset(0, 1).Value = Range("Y50").Value
  Range("X50").Value = ReportCur
  Range("Y50").Value = Rate
 End If
End If
ThisWorkbook.Worksheets("PO").Activate
LineNo = 1
Do While Cells(LineNo + 2, 1).Value <> ""
 Cells(LineNo + 16, 7).Value = "(" & ReportCur & ")"
 Cells(LineNo + 16, 9).Value = "(" & ReportCur & ")"
 Cells(LineNo + 18, 1).Select
 TotalSum = 0
 Do While ActiveCell.Value <> ""
  ActiveCell.Offset(0, 6).Value = ActiveCell.Offset(0, 6).Value / Rate
  ActiveCell.Offset(0, 8).Value = Format(ActiveCell.Offset(0, 5).Value * Round(ActiveCell.Offset(0, 6).Value, 4) * (1 - ActiveCell.Offset(0, 7).Value), "#,##0.00")
  TotalSum = TotalSum + ActiveCell.Offset(0, 8).Value
  ActiveCell.Offset(1, 0).Select
 Loop
 Cells(LineNo + 39, 9).Value = TotalSum
 LineNo = LineNo + 46
Loop
ThisWorkbook.Worksheets("PO").Activate
Application.ScreenUpdating = True
Range("A1").Select
Range("A2").Select
ThisWorkbook.Worksheets("PO").CommandButton2.Visible = False
Unload Me
 Exit Sub
InvConvert:
ThisWorkbook.Worksheets("Invoice").Activate
If Range("H17").Value <> "(" & SysCurrency & ")" Then
  Label3.Caption = "   The currency for conversion is not of " & SysCurrency & Chr(13) & _
      "   Please re-generate the data before proceed."
  Label3.Visible = True
  Exit Sub
End If
If ComboBox1.Value = SysCurrency Then
 Label3.Caption = Chr(13) & "   Please choose the required currency for conversion."
 Label3.Visible = True
  Exit Sub
End If
If ComboBox1.Value = "" Then
  Label3.Caption = "   The currency for conversion is not entered" & Chr(13) & _
      "   Please enter the currency before proceed."
  Label3.Visible = True
  Exit Sub
ElseIf Len(ComboBox1.Value) <> 3 Then
  Label3.Caption = "   The currency code for conversion is not correct" & Chr(13) & _
      "   It should be made up with 3 Alphabets."
  Label3.Visible = True
  Exit Sub
End If
If TextBox1.Value = "" Then
 Label3.Caption = Chr(13) & "   Please enter the exchange rate."
 Label3.Visible = True
  Exit Sub
End If
If IsNumeric(TextBox1.Value) = False Then
 Label3.Caption = "   The exchange rate is improperly entered." & Chr(13) & "   Please enter the exchange rate again."
 Label3.Visible = True
  Exit Sub
End If
If TextBox1.Value = 0 Then
 Label3.Caption = "   The exchange rate is improperly entered." & Chr(13) & "   It should not be zero."
 Label3.Visible = True
  Exit Sub
End If
 Label3.BackColor = &H40C0&
 Label3.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label3.Visible = True
 DoEvents
ReportCur = ComboBox1.Value
Rate = TextBox1.Text
MyBook.Worksheets("ComData").Activate
Range("X50").Select
Do While ActiveCell.Value <> ""
 If ActiveCell.Value = ReportCur Then
  ActiveCell.Offset(0, 1).NumberFormat = "General"
  If ActiveCell.Row = 50 Then
   ActiveCell.Offset(0, 1).Value = Rate
  Else
   ActiveCell.Value = Range("X50").Value
   ActiveCell.Offset(0, 1).Value = Range("Y50").Value
   Range("X50").Value = ReportCur
   Range("Y50").Value = Rate
  End If
  Exit Do
 End If
 ActiveCell.Offset(1, 0).Select
Loop
If ActiveCell.Value = "" Then
 ActiveCell.Offset(0, 1).NumberFormat = "General"
 If ActiveCell.Row = 50 Then
  ActiveCell.Value = ReportCur
  ActiveCell.Offset(0, 1).Value = Rate
 Else
  ActiveCell.Value = Range("X50").Value
  ActiveCell.Offset(0, 1).Value = Range("Y50").Value
  Range("X50").Value = ReportCur
  Range("Y50").Value = Rate
 End If
End If
 If Userform6.Label1.Caption = "INVOICE" Or Userform6.Label1.Caption = "INVOICE " Then
  InvOrCN = "INVOICE"
 Else
  InvOrCN = ""
 End If
ThisWorkbook.Worksheets("Invoice").Activate
LineNo = 1
Do While Cells(LineNo + 2, 1).Value <> ""
 Cells(LineNo + 16, 8).Value = "(" & ReportCur & ")"
 Cells(LineNo + 16, 9).Value = "(" & ReportCur & ")"
 Cells(LineNo + 18, 1).Select
 TotalSum = 0
 Do While ActiveCell.Value <> ""
  ActiveCell.Offset(0, 7).Value = ActiveCell.Offset(0, 7).Value / Rate
  ActiveCell.Offset(0, 8).Value = Format(ActiveCell.Offset(0, 6).Value * Round(ActiveCell.Offset(0, 7).Value, 4), "#,##0.00")
  TotalSum = TotalSum + ActiveCell.Offset(0, 8).Value
  ActiveCell.Offset(1, 0).Select
 Loop
 If Cells(LineNo + 39, 9).Value <> 0 Then
   Cells(LineNo + 40, 9).Value = Format((TotalSum * Cells(LineNo + 40, 9).Value / Cells(LineNo + 39, 9).Value), "#,##0.00")
 Else
   Cells(LineNo + 40, 9).Value = Format(0, "#,##0.00")
 End If
 Cells(LineNo + 39, 9).Value = TotalSum
 Cells(LineNo + 41, 9).Value = TotalSum + Cells(LineNo + 40, 9).Value
 If InvOrCN = "INVOICE" Then
  LineNo = LineNo + 90
 Else
  LineNo = LineNo + 45
 End If
Loop
ThisWorkbook.Worksheets("Invoice").Activate
Application.ScreenUpdating = True
Range("A1").Select
Range("A2").Select
ThisWorkbook.Worksheets("Invoice").CommandButton4.Visible = False
Unload Me
 Exit Sub
End Sub
Private Sub TextBox1_AfterUpdate()
Application.EnableCancelKey = xlDisabled
Label3.Visible = False
If TextBox1.Value = "" Then Exit Sub
If IsNumeric(TextBox1.Value) = False Then
 Label3.Caption = "   The exchange rate is improperly entered." & Chr(13) & "   Please enter the exchange rate again."
 Label3.Visible = True
  Exit Sub
End If
End Sub
Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
EventOff = True
ComboBox1.Clear
If MyBook.Worksheets("ComData").Range("X50").Value = "" Then
  ThisWorkbook.Worksheets("ComFactSheet").Activate
  Range("F1").Select
Else
  MyBook.Worksheets("ComData").Activate
  Range("X50").Select
End If
Do While ActiveCell.Value <> ""
ComboBox1.AddItem ActiveCell.Value
ActiveCell.Offset(1, 0).Select
Loop
 Label4.Caption = " " & SysCurrency
 MyBook.Worksheets("ComData").Activate
If Range("X50").Value <> "" Then
  ComboBox1.Value = Range("X50").Value
  TextBox1.Text = Range("Y50").Value
Else
  ComboBox1.Value = SysCurrency
  Label5.Caption = "One " & SysCurrency & " to "
  TextBox1.Text = "1.0000"
End If
SheetId = SheetName
EventOff = False
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub
Attribute VB_Name = "UserForm31"
Attribute VB_Base = "0{F5C01337-85B6-422D-BEB4-E24719833E1C}{F3C8F495-C944-4CA6-8F5D-5A0FB8003A7D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
Me.Hide
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
End Sub
Attribute VB_Name = "UserForm32"
Attribute VB_Base = "0{CA7D36BF-44A1-4914-8053-60DBFA17F6DD}{742C3701-DC72-48FC-B837-61C7AED011C5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
If OptionButton1.Value = True And TextBox3.Value = "" Then
  Label5.Caption = "   Please input the selected customer # to proceed"
  Label5.Visible = True
  Exit Sub
End If
 Label5.BackColor = &H40C0&
 Label5.Caption = "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
Me.Hide
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
Unload Me
End Sub

Private Sub CommandButton3_Click()
 ListBox1.Visible = True
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.List(0) = "No Customer Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 RowNo = ListBox1.ListIndex + 2
TextBox3.Text = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
Label11.Caption = MyBook.Worksheets("Customer Data").Cells(RowNo, 3).Value
ListBox1.Visible = False
End Sub

Private Sub OptionButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label5.Visible = False
 Label6.Visible = True
 TextBox3.Visible = True
 Label11.Visible = True
 Label12.Visible = True
 CommandButton3.Visible = True
End Sub

Private Sub OptionButton2_Click()
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
CommandButton3.Visible = False
End Sub

Private Sub OptionButton3_Click()
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
CommandButton3.Visible = False
End Sub

Private Sub OptionButton4_Click()
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
CommandButton3.Visible = False
End Sub

Private Sub OptionButton5_Click()
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
Label6.Visible = False
TextBox3.Visible = False
Label11.Visible = False
Label12.Visible = False
CommandButton3.Visible = False
End Sub

Private Sub TextBox3_Change()
ListBox1.Visible = False
Label5.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CustNo As String, CustRow As Long
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
CustNo = UCase(TextBox3.Text)
If IsNumeric(CustNo) Then
 If Len(CustNo) < 6 Then CustNo = Right(("00000" & CustNo), 5)
End If
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
  TextBox3.Text = CustNo
  Label11.Caption = ""
  Label5.Caption = "      Incorrect Customer # entered"
  Label5.Visible = True
Else
 CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
 MyBook.Worksheets("Customer Data").Activate
 TextBox3.Text = CustNo
 Label11.Caption = Cells(CustRow, 3).Value
End If
End Sub

Private Sub UserForm_Initialize()
 Dim AddNo As Long
 Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  OptionButton3.Value = True
End Sub

Private Sub UserForm_Terminate()
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
End Sub


Attribute VB_Name = "UserForm33"
Attribute VB_Base = "0{A6B4F654-B8D6-48A5-86D2-A5D337138794}{CB5E219A-5819-436B-89D2-BDFC2B0E6337}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
If OptionButton1.Value = True Then
 Me.Hide
 Exit Sub
Else
  Userform6.CommandButton16.Visible = False
  Userform6.Label1.Caption = "SALES ORDER "
  Userform6.CommandButton1.Caption = "Edit"
  Userform6.CommandButton13.Visible = False
  Userform6.CommandButton17.Visible = True
  Userform6.Label57.Visible = True
  For I = 40 To 45
   Userform6.Controls("Textbox" & I).Visible = True
  Next I
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D123").Select
    Range("D123").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 13).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:U142").Select
    Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("Q1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D123").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 9).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 9).Value
       StockQty = ActiveCell.Offset(0, 10).Value
       If StockQty <= ActiveCell.Offset(0, 2).Value Then
          ActiveCell.Offset(0, 14).Value = StockQty
          ActiveCell.Offset(0, 15).Value = Round(ActiveCell.Offset(0, 14).Value * ActiveCell.Offset(0, 3).Value, 2)
          ActiveCell.Offset(0, 16).Value = ActiveCell.Offset(0, 2).Value - ActiveCell.Offset(0, 14).Value
          ActiveCell.Offset(0, 17).Value = Round(ActiveCell.Offset(0, 16).Value * ActiveCell.Offset(0, 3).Value, 2)
       Else
          ActiveCell.Offset(0, 14).Value = ActiveCell.Offset(0, 2).Value
          ActiveCell.Offset(0, 15).Value = Round(ActiveCell.Offset(0, 14).Value * ActiveCell.Offset(0, 3).Value, 2)
          ActiveCell.Offset(0, 16).Value = ActiveCell.Offset(0, 2).Value - ActiveCell.Offset(0, 14).Value
          ActiveCell.Offset(0, 17).Value = Round(ActiveCell.Offset(0, 16).Value * ActiveCell.Offset(0, 3).Value, 2)
       End If
       Do While ActiveCell.Offset(1, 9).Value = StockNo
        StockQty = StockQty - ActiveCell.Offset(0, 14).Value
        ActiveCell.Offset(1, 10).Value = StockQty
        If StockQty <= ActiveCell.Offset(1, 2).Value Then
          ActiveCell.Offset(1, 14).Value = StockQty
          ActiveCell.Offset(1, 15).Value = Round(ActiveCell.Offset(1, 14).Value * ActiveCell.Offset(1, 3).Value, 2)
          ActiveCell.Offset(1, 16).Value = ActiveCell.Offset(1, 2).Value - ActiveCell.Offset(1, 14).Value
          ActiveCell.Offset(1, 17).Value = Round(ActiveCell.Offset(1, 16).Value * ActiveCell.Offset(1, 3).Value, 2)
        Else
          ActiveCell.Offset(1, 14).Value = ActiveCell.Offset(1, 2).Value
          ActiveCell.Offset(1, 15).Value = Round(ActiveCell.Offset(1, 14).Value * ActiveCell.Offset(1, 3).Value, 2)
          ActiveCell.Offset(1, 16).Value = ActiveCell.Offset(1, 2).Value - ActiveCell.Offset(1, 14).Value
          ActiveCell.Offset(1, 17).Value = Round(ActiveCell.Offset(1, 16).Value * ActiveCell.Offset(1, 3).Value, 2)
        End If
        ActiveCell.Offset(0, 11).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     Else
       ActiveCell.Offset(0, 14).Value = ActiveCell.Offset(0, 2).Value
       ActiveCell.Offset(0, 15).Value = Round(ActiveCell.Offset(0, 14).Value * ActiveCell.Offset(0, 3).Value, 2)
       ActiveCell.Offset(0, 16).Value = 0
       ActiveCell.Offset(0, 17).Value = 0
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:U142").Select
    Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Userform6.ScrollBar1.Value = 2
  Userform6.ScrollBar1.Value = 1
  Unload Me
End If
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
 ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
 Unload Me
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
End Sub

Private Sub UserForm_Terminate()
 ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
 Unload Me
End Sub
Attribute VB_Name = "UserForm34"
Attribute VB_Base = "0{9D80B613-3C90-40B4-93E7-A0AFDAF7FB8E}{E04AE702-60BF-4BF3-9FE8-D1CC7AFC469B}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
Dim AsAtDate As Date, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
If IsDate(TextBox1.Text) = False Then
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
End If
  AsAtDate = TextBox1.Text
  If BeginningDate > AsAtDate Then
   Label5.Caption = Chr(13) & "   Date earlier than the beginning date " & Chr(13) & "    of the Accounting Year is not allowed. "
   Label5.Visible = True
   Exit Sub
 End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If AsAtDate > YearEndDate Then
   Label5.Caption = Chr(13) & "  Date entered is out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
 Label5.BackColor = &H40C0&
 Label5.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label5.Visible = True
 DoEvents
Me.Hide
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
Unload Me
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, AsAtDate As Date, YearEndDate As Date
Application.EnableCancelKey = xlDisabled
Label5.Visible = False
If TextBox1.Text = "" Then Exit Sub
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
 Cancel = True
 Label5.Caption = Chr(13) & "    Incorrect Date entered"
 Label5.Visible = True
 Exit Sub
Else
 TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
 AsAtDate = TextBox1.Text
  If BeginningDate > AsAtDate Then
   Label5.Caption = Chr(13) & "   Date earlier than the beginning date " & Chr(13) & "    of the Accounting Year is not allowed. "
   Label5.Visible = True
   Exit Sub
 End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If AsAtDate > YearEndDate Then
   Label5.Caption = Chr(13) & "  Date entered is out of Range of this Year End File"
   Label5.Visible = True
   Exit Sub
 End If
End If
End Sub
Attribute VB_Name = "UserForm4"
Attribute VB_Base = "0{85D26E0E-87DA-4270-B35E-CE527E8F86F7}{4947C727-1301-4E56-987A-9B825B3272E6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub ComboBox3_Change()
If UCase(ComboBox3.Value) <> "ALL" Then
   UserForm4.ComboBox4.Visible = True
   UserForm4.Label4.Visible = True
End If
End Sub
Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label1.BackColor = &H40C0&
 Label1.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label1.Visible = True
 DoEvents
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.EnableEvents = True
Me.Hide
End Sub
Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
Unload Me
End Sub
Private Sub TextBox1_Change()
Label1.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
If TextBox1.Text = "" Then Exit Sub
Application.EnableCancelKey = xlDisabled
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
   Cancel = True
   Label1.BackColor = &HC0&
   ForeColor = &HFFFF&
   Label1.Visible = True
   Label1.Caption = Chr(13) & "        Wrong Date Entered !!!"
Else
  TextBox1.Text = Format(DateString, "yyyy/mm/dd")
End If
End Sub
Private Sub TextBox2_Change()
Label1.Visible = False
End Sub
Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
If TextBox2.Text = "" Then Exit Sub
Application.EnableCancelKey = xlDisabled
DateString = TextBox2.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
   Cancel = True
   Label1.BackColor = &HC0&
   ForeColor = &HFFFF&
   Label1.Visible = True
   Label1.Caption = Chr(13) & "        Wrong Date Entered !!!"
Else
  TextBox2.Text = Format(DateString, "yyyy/mm/dd")
End If
End Sub
Private Sub UserForm_Initialize()
Dim M As Long, N As Long, spacing As String, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
M = LastRowChartofAccount
ComboBox3.AddItem "All"
For I = 10 To M
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ------"
spacing = Left(spacing, 6 - N)
ComboBox3.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
Next I
ComboBox3.Value = "All"
For I = 10 To M
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ------"
spacing = Left(spacing, 6 - N)
ComboBox4.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
Next I
ComboBox4.Value = Worksheets("Chart of Account").Cells(M, 1).Value & spacing & Worksheets("Chart of Account").Cells(M, 2).Value
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub
Attribute VB_Name = "UserForm5"
Attribute VB_Base = "0{44644445-5096-45F7-890F-CE8AAE51C277}{132B5BBB-204D-423B-8BDD-327A295F2181}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public Level As String, AccountType As String, UpperAccount As String

Private Sub TextBox1_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
CommandButton5.Visible = False
TextBox2.Text = ""
Label2.Visible = False
Label5.Visible = False
Label6.Visible = False
Label7.Visible = False
Application.EnableEvents = True
End Sub

Private Sub TextBox1_AfterUpdate()
Dim AccountCode As String, AcctLen As Long, I As Long
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
 EventOff = True
 CommandButton5.Visible = False
 TextBox1.Text = UCase(TextBox1.Text)
 AccountCode = TextBox1.Text
 AcctLen = Len(AccountCode)
 EventOff = False
If AccountCode = "" Then Exit Sub
     If AcctLen > 5 Then
      Label2.BackColor = &HC0&
      Label2.ForeColor = &HFFFF&
      Label2.Caption = "  Wrong Input!!!." & Chr(13) & "  Account number must not be more than 5 figures"
      Label2.Visible = True
      Label5.Visible = False
      Label6.Visible = False
      Label7.Visible = False
      CommandButton5.Visible = False
      TextBox1.SetFocus
      Exit Sub
     End If
     If Left(AccountCode, 1) > 9 Or Left(AccountCode, 1) < 1 Then
      Label2.BackColor = &HC0&
      Label2.ForeColor = &HFFFF&
      Label2.Caption = "  Wrong Input!!!." & Chr(13) & "  Account number must start with 1 to 9"
      Label2.Visible = True
      Label5.Visible = False
      Label6.Visible = False
      Label7.Visible = False
      CommandButton5.Visible = False
      TextBox1.SetFocus
      Exit Sub
     End If
 If Left(AccountCode & "***", 2) = "36" Then
   Label2.BackColor = &HC0&
   Label2.ForeColor = &HFFFF&
   Label2.Caption = "  Wrong Input!!!." & Chr(13) & "  The account number is reserved for year-end profits by the system"
   Label2.Visible = True
   Label5.Visible = False
   Label6.Visible = False
   Label7.Visible = False
   CommandButton5.Visible = False
   TextBox1.SetFocus
  Exit Sub
 End If
    AccountCode = TextBox1.Text
    AcctLen = Len(AccountCode)
     For I = 2 To AcctLen
      If Mid(AccountCode, I, 1) > 9 Or Mid(AccountCode, I, 1) < 0 Then
        If I = 5 Then
          If Asc(Mid(AccountCode, I, 1)) > 64 And Asc(Mid(AccountCode, I, 1)) < 91 Then
           If Mid(AccountCode, I, 1) <> "O" And Mid(AccountCode, I, 1) <> "I" Then
            Exit For
           Else
            Label2.BackColor = &HC0&
            Label2.ForeColor = &HFFFF&
            Label2.Caption = "  Wrong Input!!!." & Chr(13) & "  For level 5 accounts, the last figure can only be a number " & Chr(13) _
             & "   between 0 to 9 or an alphabet from A to Z except 'O' and 'I' "
            Label2.Visible = True
            Label5.Visible = False
            Label6.Visible = False
            Label7.Visible = False
            CommandButton5.Visible = False
            TextBox1.SetFocus
            Exit Sub
           End If
         Else
           Label2.BackColor = &HC0&
           Label2.ForeColor = &HFFFF&
           Label2.Caption = "  Wrong Input!!!." & Chr(13) & "  For level 5 accounts, the last character can only be a number " & Chr(13) _
             & "   between 0 to 9 or an alphabet from A to Z except 'O' and 'I' "
           Label2.Visible = True
           Label5.Visible = False
           Label6.Visible = False
           Label7.Visible = False
           CommandButton5.Visible = False
           TextBox1.SetFocus
           Exit Sub
         End If
        Else
         Label2.BackColor = &HC0&
         Label2.ForeColor = &HFFFF&
         Label2.Caption = "  Wrong Input!!!." & Chr(13) & "  For Level 1 to 4 accounts, the account number must be numeric "
         Label2.Visible = True
         TextBox1.SetFocus
         Label5.Visible = False
         Label6.Visible = False
         Label7.Visible = False
         CommandButton5.Visible = False
         Exit Sub
        End If
      End If
     Next I
  MyBook.Worksheets("Chart of Account").Activate
  Range("A10").Select
  Do While ActiveCell.Value <> "" And ActiveCell.Value <= AccountCode
  If AccountCode = ActiveCell.Value Then
   Label2.BackColor = &HC0&
   Label2.ForeColor = &HFFFF&
   Label2.Caption = "    Wrong Input!!!." & Chr(13) & "    Duplicate Account number"
   Label2.Visible = True
   Label5.Visible = False
   Label6.Visible = False
   Label7.Visible = False
   CommandButton5.Visible = False
   TextBox1.SetFocus
   Exit Sub
  End If
 ActiveCell.Offset(1, 0).Select
  Loop
 If AcctLen > 1 Then
  UpperAccount = Left(AccountCode, AcctLen - 1)
  ActiveCell.Offset(-1, 0).Select
  Do While ActiveCell.Row > 9 And ActiveCell.Value >= UpperAccount
   If ActiveCell.Value = UpperAccount Then
    If ActiveCell.Offset(0, 6).Value = "Y" Then
      Label2.BackColor = &HC0&
      Label2.ForeColor = &HFFFF&
      Label2.Caption = "   Account # " & UpperAccount & " is a Detail account " & Chr(13) & "   Adding a lower level account to a detail account is not allowed"
      Label2.Visible = True
      Label5.Visible = False
      Label6.Visible = False
      Label7.Visible = False
      CommandButton5.Visible = False
      TextBox1.SetFocus
     Exit Sub
    End If
    GoTo CheckFinish
   End If
    ActiveCell.Offset(-1, 0).Select
  Loop
   Label2.BackColor = &HC0&
   Label2.ForeColor = &HFFFF&
   Label2.Caption = "   WARNING!!!" & Chr(13) & "   The parent account for the new account is " & UpperAccount & "." _
   & Chr(13) & "   But, " & UpperAccount & " is not found in the Chart of Account." & _
   Chr(13) & "   Please proceed to add the " & UpperAccount & " first."
   Label2.Visible = True
   Label5.Visible = False
   Label6.Visible = False
   Label7.Visible = False
   CommandButton5.Visible = False
   TextBox1.SetFocus
   Exit Sub
End If
CheckFinish:
  If Left((AccountCode & "000"), 1) = 1 Then
    AccountType = "Asset"
    ElseIf Left((AccountCode & "000"), 1) = 2 Then
     AccountType = "Liability"
     ElseIf Left((AccountCode & "000"), 1) = 3 Then
    AccountType = "Capital"
    ElseIf Left((AccountCode & "000"), 1) = 4 Then
     AccountType = "Revenue"
    ElseIf Left((AccountCode & "000"), 1) = 8 Then
     AccountType = "Other Income"
   Else
     AccountType = "Expense"
  End If
  If Len(AccountCode) = 1 Then
   Level = "1"
   UpperAccount = "-"
  ElseIf Len(AccountCode) = 2 Then
    Level = "2"
    UpperAccount = Left(AccountCode, 1)
  ElseIf Len(AccountCode) = 3 Then
    Level = "3"
    UpperAccount = Left(AccountCode, 2)
   ElseIf Len(AccountCode) = 4 Then
    Level = "4"
    UpperAccount = Left(AccountCode, 3)
   ElseIf Len(AccountCode) = 5 Then
    Level = "5"
    UpperAccount = Left(AccountCode, 4)
  End If
 Label5.Caption = "Account Type : " & AccountType
 Label6.Caption = "Level : " & Level
 Label7.Caption = "Parent Account # : " & UpperAccount
 Label5.Visible = True
 Label6.Visible = True
 Label7.Visible = True
 TextBox2.Text = ""
 TextBox2.SetFocus
 CommandButton5.Visible = True
 Application.EnableEvents = True
End Sub

Private Sub TextBox2_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
Label2.Visible = False
Application.EnableEvents = True
End Sub

Private Sub ListBox1_Click()
Application.EnableCancelKey = xlDisabled
EventOff = True
Label3.Visible = False
TextBox1.Visible = False
TextBox2.Visible = False
Label4.Visible = False
Label8.Visible = False
Label5.Visible = False
Label6.Visible = False
Label7.Visible = False
CommandButton5.Visible = False
EventOff = False
End Sub

Private Sub ListBox1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long
Application.EnableCancelKey = xlDisabled
I = ListBox1.ListIndex
If I < 0 Or ListBox1.List(I, 0) = "" Then Exit Sub
Application.EnableEvents = False
EventOff = True
Label2.Visible = False
TextBox1.Visible = False
TextBox1.Text = ""
Label2.Caption = ""
Label3.Width = 105
Label3.Caption = "Account # : " & ListBox1.List(I, 0)
TextBox2.Text = ListBox1.List(I, 1)
Label5.Caption = "Account Type : " & ListBox1.List(I, 2)
Label6.Caption = "Level : " & ListBox1.List(I, 3)
Label7.Caption = "Parent Account # : " & ListBox1.List(I, 4)
Label3.Visible = True
TextBox2.Visible = True
Label4.Visible = True
Label8.Visible = True
Label5.Visible = True
Label6.Visible = True
Label7.Visible = True
CommandButton5.Visible = True
TextBox2.SetFocus
EventOff = False
Application.EnableEvents = True
End Sub

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
EventOff = False
Label3.Visible = False
TextBox1.Visible = False
TextBox2.Visible = False
Label4.Visible = False
Label8.Visible = False
Label5.Visible = False
Label6.Visible = False
Label7.Visible = False
CommandButton5.Visible = False
 Application.EnableEvents = False
Unload Me
If DataSheetReturn = "Yes" Then
 DataSheetReturn = ""
 ThisWorkbook.Worksheets("Data Entry").Activate
 SheetName = "Data Entry"
Else
 ThisWorkbook.Worksheets("System Menu").Activate
 Range("C4").Select
 SheetName = "System Menu"
End If
Application.EnableEvents = True
End Sub

Private Sub CommandButton2_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
EventOff = True
Application.EnableEvents = False
I = ListBox1.ListIndex
If ListBox1.List(I, 0) <> "" Then
 Label2.Visible = False
 TextBox1.Visible = False
 TextBox1.Text = ""
 Label2.Caption = ""
 Label3.Width = 105
 Label3.Caption = "Account # : " & ListBox1.List(I, 0)
 TextBox2.Text = ListBox1.List(I, 1)
 Label5.Caption = "Account Type : " & ListBox1.List(I, 2)
 Label6.Caption = "Level : " & ListBox1.List(I, 3)
 Label7.Caption = "Parent Account # : " & ListBox1.List(I, 4)
 Label3.Visible = True
 TextBox2.Visible = True
 Label4.Visible = True
 Label8.Visible = True
 Label5.Visible = True
 Label6.Visible = True
 Label7.Visible = True
 CommandButton5.Visible = True
 TextBox2.SetFocus
End If
Application.EnableEvents = True
EventOff = False
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
EventOff = True
CommandButton5.Visible = False
Label2.Visible = False
Label4.Visible = True
Label8.Visible = True
Label5.Visible = False
Label6.Visible = False
Label7.Visible = False
Label3.Width = 78
Label3.Caption = "Account # : "
Label3.Visible = True
TextBox1.Text = ""
TextBox2.Text = ""
Label3.Visible = True
TextBox1.Visible = True
TextBox2.Visible = True
TextBox1.SetFocus
EventOff = False
Application.EnableEvents = True
End Sub
Private Sub CommandButton4_Click()
Dim C As String
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
Application.ScreenUpdating = False
ThisWorkbook.Worksheets("Chart of Account").Activate
ActiveSheet.UsedRange.Select
Selection.Offset(0, 5).Resize(Selection.Rows.Count, 4).ClearContents
 Columns("C:E").HorizontalAlignment = xlCenter
 Columns("A:A").HorizontalAlignment = xlLeft
If IsDate(Range("A1").Value) Then
  Select Case Month(Range("A1").Value)
     Case 1
     C = "January"
     Case 2
     C = "February"
     Case 3
     C = "March"
     Case 4
     C = "April"
     Case 5
     C = "May"
     Case 6
     C = "June"
     Case 7
     C = "July"
     Case 8
     C = "August"
     Case 9
     C = "September"
     Case 10
     C = "October"
     Case 11
     C = "November"
     Case 12
     C = "December"
     End Select
  Range("A1").Value = "Last Update: " & C & " " & Day(Range("A1").Value) & ", " & Year(Range("A1").Value)
 End If
ActiveSheet.Visible = xlSheetVisible
Worksheets("System Menu").Visible = xlSheetVeryHidden
SheetName = "Chart of Account"
Unload Me
Application.ScreenUpdating = True
Application.EnableEvents = True
Range("A1").Select
Range("A3").Select
End Sub

Private Sub CommandButton5_Click()
Dim MyRange() As Variant, I As Long, J As Long, AccountCode As String, Check As String, AccountName As String
Dim AcctCK As Variant, Tbl As Range, LastRow As Long
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
Application.ScreenUpdating = False
If TextBox2.Text = "" Or (TextBox1.Text = "" And TextBox1.Visible = True) Then
 Label2.BackColor = &HC0&
 Label2.ForeColor = &HFFFF&
 Label2.Caption = "  Please enter Account Description "
 Label2.Visible = True
 TextBox2.SetFocus
 Exit Sub
End If
If Label2.Visible = True Then
 TextBox2.SetFocus
 Exit Sub
End If
 Label2.BackColor = &H40C0&
 Label2.ForeColor = &HFFFF&
 Label2.Caption = Chr(13) & Chr(13) & "       Request under processing.  Please wait."
 Label2.Visible = True
 DoEvents
If TextBox1.Visible = True Then
 AccountCode = TextBox1.Text
 Check = "NEW"
Else
 J = ListBox1.ListIndex
 AccountCode = ListBox1.List(J, 0)
 Check = "EDIT"
End If
AccountName = TextBox2.Text
Label3.Visible = False
TextBox1.Visible = False
TextBox2.Visible = False
Label4.Visible = False
Label8.Visible = False
Label5.Visible = False
Label6.Visible = False
Label7.Visible = False
CommandButton5.Visible = False
 MyBook.Worksheets("Chart of Account").Activate
 Range("A1").Value = Date
 Range("A10").Select
If Check = "EDIT" Then
  Do While ActiveCell.Value <> "" And AccountCode >= ActiveCell.Value
    If AccountCode > ActiveCell.Offset(5, 0).Value And ActiveCell.Offset(5, 0).Value <> "" Then
      ActiveCell.Offset(5, 0).Select
    Else
     If AccountCode = ActiveCell.Value Then
       ActiveCell.Offset(0, 1).NumberFormat = "@"
       ActiveCell.Offset(0, 1).Value = AccountName
       AcctCK = ActiveCell.Value
       MyBook.Worksheets("Raw Data").Activate
       If Range("A4") <> "" Then
        Set Tbl = ActiveSheet.UsedRange
        Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
        Selection.Sort Key1:=Range("E1"), Order1:=xlAscending, _
          Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
        Set Tbl = Selection.Columns("E")
         If IsError(Application.Match(AcctCK, Tbl, 0)) = False Then
           I = Application.Match(AcctCK, Tbl, 0) + 3
           LastRow = Application.Match(AcctCK, Tbl, 1) + 3
           Range(Cells(I, 6), Cells(LastRow, 6)).NumberFormat = "@"
           Range(Cells(I, 6), Cells(LastRow, 6)).Value = AccountName
         End If
       End If
       Exit Do
     End If
     ActiveCell.Offset(1, 0).Select
    End If
  Loop
 Else
  Do While ActiveCell.Value <> "" And ActiveCell.Value <= AccountCode
   If AccountCode > ActiveCell.Offset(5, 0).Value And ActiveCell.Offset(5, 0).Value <> "" Then
      ActiveCell.Offset(5, 0).Select
    Else
      ActiveCell.Offset(1, 0).Select
    End If
  Loop
  ActiveCell.EntireRow.Insert
  ActiveCell.NumberFormat = "General"
  ActiveCell.Value = AccountCode
  ActiveCell.Offset(0, 1).NumberFormat = "@"
  ActiveCell.Offset(0, 1).Value = AccountName
  ActiveCell.Offset(0, 2).Value = AccountType
  ActiveCell.Offset(0, 3).Value = Level
  ActiveCell.Offset(0, 4).Value = UpperAccount
  LastRowChartofAccount = LastRowChartofAccount + 1
  J = ActiveCell.Row - 10
 End If
 MyBook.Worksheets("Chart of Account").UsedRange.Copy
 ThisWorkbook.Worksheets("Chart of Account").Activate
 Range("A1").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("A3").Select
ListBox1.Clear
ThisWorkbook.Worksheets("Chart of Account").Activate
I = LastRowChartofAccount - 9
ReDim MyRange(I, 5)
I = 0
Range("A10").Select
Do While ActiveCell.Value <> ""
MyRange(I, 0) = ActiveCell.Value
MyRange(I, 1) = ActiveCell.Offset(0, 1).Value
MyRange(I, 2) = ActiveCell.Offset(0, 2).Value
MyRange(I, 3) = ActiveCell.Offset(0, 3).Value
MyRange(I, 4) = ActiveCell.Offset(0, 4).Value
I = I + 1
ActiveCell.Offset(1, 0).Select
Loop
ListBox1.List() = MyRange
ListBox1.ListIndex = J
On Error Resume Next
 MyBook.Save
 On Error GoTo 0
  Label2.Visible = False
Application.EnableEvents = True
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long, J As Long, K As Long
     If Len(TextBox2.Text) > 9 Then
       I = Len(TextBox2.Text)
       J = 1
       K = 0
       Do While J <= I
        If Abs(Asc(Mid(TextBox2.Text, J, 1))) > 255 Then
          K = K + 3
        Else
          K = K + 1
        End If
        If K > 29 Then
          TextBox2.Text = Left(TextBox2.Text, J - 1)
          Exit Do
        End If
        J = J + 1
       Loop
     End If
End Sub

Private Sub UserForm_Initialize()
Dim MyRange() As Variant, I As Long, AddNo As Long
Application.EnableCancelKey = xlDisabled
Application.EnableEvents = False
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.ColumnCount = 5
I = LastRowChartofAccount - 9
ReDim MyRange(I, 5)
I = 0
ThisWorkbook.Worksheets("Chart of Account").Activate
Range("A10").Select
Do While ActiveCell.Value <> ""
MyRange(I, 0) = ActiveCell.Value
MyRange(I, 1) = ActiveCell.Offset(0, 1).Value
MyRange(I, 2) = ActiveCell.Offset(0, 2).Value
MyRange(I, 3) = ActiveCell.Offset(0, 3).Value
MyRange(I, 4) = ActiveCell.Offset(0, 4).Value
I = I + 1
ActiveCell.Offset(1, 0).Select
Loop
ListBox1.List() = MyRange
ListBox1.ListIndex = 0
If DataSheetReturn = "Yes" Then CommandButton4.Visible = False
Label2.BackColor = &H4000&
Label2.ForeColor = &H8000000E
Label2.Caption = " Note:  Account numbers can be 1 to 5 figures." & Chr(13) _
  & "           For a 5-figure number, the last figure can either be a number " & Chr(13) _
  & "              or an alphabet except 'O' and 'I'"
Label2.Visible = True
Application.EnableEvents = True
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub

Private Sub CommandButton1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label2.Visible = False
End Sub

Private Sub CommandButton2_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label2.Visible = False
End Sub

Private Sub CommandButton3_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label2.Visible = False
End Sub

Private Sub CommandButton4_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label2.Visible = False
End Sub




Attribute VB_Name = "UserForm7"
Attribute VB_Base = "0{8F28FCF6-196E-48E8-B645-46E563C08853}{EBA06F6B-6CE7-4AAD-A0B0-5AA598D1D4BA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = False
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE" Then
  Unload Me
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
 Userform6.ListBox1.Clear
 MyBook.Worksheets("Customer Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  Userform6.ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   Userform6.ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  Userform6.ListBox1.AddItem "No Customer Data"
 End If
  Userform6.ListBox1.AddItem "CLOSE this box"
  Userform6.Show
Else
 Unload Me
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
 UserForm8.Show
End If
End Sub

Private Sub CommandButton2_Click()
Dim EndNo As Long, CustRow As Long, COARange As Range, I As Long
Application.EnableCancelKey = xlDisabled
 Label19.Visible = False
 ListBox1.Visible = False
 ListBox2.Visible = False
CustNo = TextBox1.Text
If CustNo = "" Then
 Label19.Caption = Chr(13) & "    Please enter the Customer #"
 Label19.Visible = True
 Exit Sub
End If
If TextBox2.Text = "" Then
 Label19.Caption = Chr(13) & "    Please enter the Customer Name"
 Label19.Visible = True
 Exit Sub
End If
If (TextBox6.Text = "" Or Val(TextBox6.Text) = 0) And Not (Label26.Caption = "C.O.D." Or Label26.Caption = "Prepaid") Then
 Label19.Caption = Chr(13) & "    Please enter the Credit Limit"
 Label19.Visible = True
 Exit Sub
End If
If IsNumeric(TextBox6.Text) = False And TextBox6.Text <> "" Then
 Label19.Caption = Chr(13) & "    Incorrect value for Credit Limit"
 Label19.Visible = True
 Exit Sub
End If
If IsNumeric(TextBox7.Text) = True Then
 If Val(TextBox7.Text) > 100 Or Val(TextBox7.Text) < 0 Then
    Label19.Caption = Chr(13) & "    Incorrect value for Discount % "
    Label19.Visible = True
    Exit Sub
 End If
Else
 Label19.Caption = Chr(13) & "    Incorrect value for Discount % "
 Label19.Visible = True
 Exit Sub
End If
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
  MyBook.Worksheets("Customer Data").Activate
  Range("B2").Select
  If ActiveCell.Offset(1, 0).Value = "" Then
    Range("B3").Select
  Else
    ActiveCell.End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
  End If
ElseIf ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE" Then
  Label19.Caption = Chr(13) & "    Change to existing Customer detail is not allowed.  " & Chr(13) & "    Only new Customers can be added while Invoice or Sales Order is being processed.   "
  Label19.Visible = True
  Exit Sub
Else
  CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
  MyBook.Worksheets("Customer Data").Activate
  Cells(CustRow, 2).Select
End If
   ActiveCell.NumberFormat = "@"
   ActiveCell.Value = CustNo
   ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
   ActiveCell.Offset(0, -1).Value = Date
   ActiveCell.Offset(0, 1).NumberFormat = "@"
   ActiveCell.Offset(0, 1).Value = TextBox2.Text
   ActiveCell.Offset(0, 2).NumberFormat = "General"
   ActiveCell.Offset(0, 3).NumberFormat = "@"
   ActiveCell.Offset(0, 3).Value = TextBox3.Text
   ActiveCell.Offset(0, 4).NumberFormat = "@"
   ActiveCell.Offset(0, 4).Value = TextBox4.Text
   ActiveCell.Offset(0, 5).NumberFormat = "@"
   ActiveCell.Offset(0, 5).Value = TextBox5.Text
   ActiveCell.Offset(0, 6).NumberFormat = "General"
   ActiveCell.Offset(0, 7).NumberFormat = "General"
   ActiveCell.Offset(0, 7).Value = TextBox7.Text
   ActiveCell.Offset(0, 8).NumberFormat = "@"
   If TextBox8.Text = " Name, Tel # etc (shown on Invoice)" Then
    ActiveCell.Offset(0, 8).Value = ""
   Else
     ActiveCell.Offset(0, 8).Value = TextBox8.Text
   End If
   ActiveCell.Offset(0, 9).NumberFormat = "@"
   ActiveCell.Offset(0, 9).Value = TextBox9.Text
   ActiveCell.Offset(0, 10).NumberFormat = "@"
   ActiveCell.Offset(0, 10).Value = TextBox10.Text
   ActiveCell.Offset(0, 11).NumberFormat = "@"
   ActiveCell.Offset(0, 11).Value = TextBox11.Text
   ActiveCell.Offset(0, 12).NumberFormat = "@"
   ActiveCell.Offset(0, 12).Value = TextBox12.Text
   If Label26.Caption = "C.O.D." Or Label26.Caption = "Prepaid" Then
     ActiveCell.Offset(0, 6).Value = ""
     ActiveCell.Offset(0, 14).Value = Label26.Caption
   Else
    ActiveCell.Offset(0, 6).Value = TextBox6.Text
    ActiveCell.Offset(0, 14).Value = TextBox18 & " " & Label26.Caption
   End If
   ActiveCell.Offset(0, 15).NumberFormat = "@"
   ActiveCell.Offset(0, 15).Value = TextBox13.Text
   ActiveCell.Offset(0, 16).NumberFormat = "@"
   ActiveCell.Offset(0, 16).Value = TextBox14.Text
   ActiveCell.Offset(0, 17).NumberFormat = "@"
   ActiveCell.Offset(0, 17).Value = TextBox15.Text
   ActiveCell.Offset(0, 18).NumberFormat = "@"
   ActiveCell.Offset(0, 18).Value = TextBox16.Text
   ActiveCell.Offset(0, 19).NumberFormat = "@"
   ActiveCell.Offset(0, 19).Value = TextBox17.Text
MyBook.Worksheets("Customer Data").Activate
If IsNumeric(CustNo) Then
 If Len(CustNo) = 5 Then
  If CustNo > Range("A1").Value Then Range("A1").Value = CustNo
 End If
End If
Application.EnableEvents = False
TextBox1.Text = Right(("00000" & Val(Range("A1").Value) + 1), 5)
Application.EnableEvents = True
ListBox1.Clear
MyBook.Worksheets("Customer Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
ListBox1.AddItem "CLOSE this box"
EventOff = True
TextBox1.Text = Right(("00000" & Val(Range("A1").Value) + 1), 5)
For I = 2 To 17
 Controls("TextBox" & I).Text = ""
Next I
TextBox6.Text = "0.00"
TextBox6.Visible = False
TextBox7.Text = 0
Label26.Caption = "C.O.D."
Label26.Left = 413.95
Label26.Width = 126
TextBox18.Text = ""
TextBox18.Visible = False
Label23.Visible = False
Label19.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
EventOff = False
End Sub

Private Sub CommandButton3_Click()
Dim EndNo As Long, CustNo As String, CustRow As Long, COARange As Range, I As Long
Application.EnableCancelKey = xlDisabled
CustNo = TextBox1.Text
MyBook.Worksheets("Customer Data").Activate
EventOff = True
ListBox1.Visible = False
ListBox2.Visible = False
If CustNo = "" Then
  CustNo = Right(("00000" & Val(Range("A1").Value) + 1), 5)
  TextBox1.Text = CustNo
  For I = 2 To 17
   Controls("TextBox" & I).Text = ""
  Next I
  TextBox6.Text = "0.00"
  TextBox6.Visible = False
  TextBox7.Text = 0
  Label26.Caption = "C.O.D."
  Label26.Left = 413.95
  Label26.Width = 126
  TextBox18.Text = ""
  TextBox18.Visible = False
  Label23.Visible = False
  Label19.Visible = False
  Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
  EventOff = False
  Exit Sub
End If
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) Then
  CustNo = Right(("00000" & Val(Range("A1").Value) + 1), 5)
  TextBox1.Text = CustNo
  For I = 2 To 17
   Controls("TextBox" & I).Text = ""
  Next I
  TextBox6.Text = "0.00"
  TextBox6.Visible = False
  TextBox7.Text = 0
  Label26.Caption = "C.O.D."
  Label26.Left = 413.95
  Label26.Width = 126
  TextBox18.Text = ""
  TextBox18.Visible = False
  Label23.Visible = False
  Label19.Visible = False
  Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
  EventOff = False
  Exit Sub
Else
 If CustBalance <> 0 Then
  Label19.Caption = Chr(13) & "    There are outstanding receivable amount for this customer," & Chr(13) & _
    "    Deletion of this customer from the record is not allowed."
  Label19.Visible = True
  EventOff = False
  Exit Sub
 End If
  If IsError(Application.Match(CustNo, MyBook.Worksheets("ProInvoice").Range("P:P"), 0)) = False Then
      Label19.Caption = Chr(13) & "    There are outstanding Sales Orders for this customer," & Chr(13) & _
            "    Deletion of this customer from the record is not allowed."
      Label19.Visible = True
      EventOff = False
      Exit Sub
  End If
  CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
  MyBook.Worksheets("Customer Data").Activate
  Cells(CustRow, 2).Select
End If
AskReply:
 MSG = "OLD RECORD with the same Customer # will be removed from the Record" + Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then GoTo FinishDelete
    GoTo AskReply
DataRemoval:
ActiveCell.EntireRow.Delete
ListBox1.Clear
MyBook.Worksheets("Customer Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
ListBox1.AddItem "CLOSE this box"
CustNo = Right(("00000" & Val(Range("A1").Value) + 1), 5)
TextBox1.Text = CustNo
For I = 2 To 17
 Controls("TextBox" & I).Text = ""
Next I
TextBox6.Text = "0.00"
TextBox6.Visible = False
TextBox7.Text = 0
Label26.Caption = "C.O.D."
Label26.Left = 413.95
Label26.Width = 126
TextBox18.Text = ""
TextBox18.Visible = False
Label23.Visible = False
FinishDelete:
Label19.Visible = False
Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
EventOff = False
End Sub

Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = True
 Label19.Visible = False
End Sub

Private Sub CommandButton5_Click()
Application.EnableCancelKey = xlDisabled
MyBook.Worksheets("Customer Data").Activate
EventOff = True
TextBox1.Text = Right(("00000" & Val(Range("A1").Value) + 1), 5)
For I = 2 To 17
 Controls("TextBox" & I).Text = ""
Next I
TextBox6.Text = "0.00"
TextBox6.Visible = False
TextBox7.Text = 0
Label26.Caption = "C.O.D."
Label26.Left = 413.95
Label26.Width = 126
TextBox18.Text = ""
TextBox18.Visible = False
Label23.Visible = False
Label19.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
Label25.Caption = "Outstanding Balance (" & SysCurrency & ") : 0.00"
EventOff = False
End Sub

Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = True
End Sub
Private Sub CommandButton7_Click()
Dim I As Long, J As Long, ReportForm As Boolean, SortStyle As Boolean
 Application.EnableCancelKey = xlDisabled
  ListBox1.Visible = False
  ListBox2.Visible = False
  UserForm31.OptionButton1.Value = True
  UserForm31.OptionButton3.Value = True
  UserForm31.OptionButton3.Caption = " Sorted by Customer Number"
  UserForm31.OptionButton4.Caption = " Sorted by Customer Name"
  UserForm31.Show
  If UserForm31.OptionButton2.Value = True Then
    ReportForm = False
  Else
    ReportForm = True
  End If
  If UserForm31.OptionButton4.Value = True Then
    SortStyle = False
  Else
    SortStyle = True
  End If
  Unload UserForm31
  Label19.BackColor = &H40C0&
  Label19.Caption = Chr(13) & "   Request under processing.  Please wait."
  Label19.Visible = True
  DoEvents
 Application.ScreenUpdating = False
 Application.EnableEvents = False
 Application.DisplayAlerts = False
 ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
Application.EnableEvents = True
 ActiveWindow.DisplayGridlines = False
If ReportForm = True Then
  Columns("A:D").Select
  With Selection
    .NumberFormat = "@"
    With .Font
     .Name = "Arial"
     .FontStyle = "Regular"
     .Size = 12
    End With
  End With
  Columns("A").HorizontalAlignment = xlRight
  Columns("C").HorizontalAlignment = xlRight
  Columns("B").HorizontalAlignment = xlLeft
  Columns("D").HorizontalAlignment = xlLeft
  Columns("A").ColumnWidth = 20
  Columns("B").ColumnWidth = 38
  Columns("C").ColumnWidth = 17
  Columns("D").ColumnWidth = 38
  If MyBook.Worksheets("Customer Data").Range("B3") = "" Then GoTo Finish1
  MyBook.Worksheets("Customer Data").Activate
  Set Tbl = ActiveSheet.UsedRange
  Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
  If SortStyle = True Then
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
      False, Orientation:=xlTopToBottom
  Else
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
      False, Orientation:=xlTopToBottom
  End If
  Selection.Copy
  ThisWorkbook.Worksheets("Report").Activate
  Range("H1").Select
  ActiveSheet.Paste
  Application.CutCopyMode = False
  I = 5
  J = 1
  Range("I1").Select
  Do While ActiveCell.Value <> ""
   Cells(I, 1).Value = " Customer # : "
   Cells(I, 2).Value = ActiveCell.Value
   Cells(I + 1, 1).Value = " Customer Name : "
   Cells(I + 1, 2).Value = ActiveCell.Offset(0, 1).Value
   Cells(I + 2, 1).Value = " Customer Address : "
   Cells(I + 2, 2).Value = ActiveCell.Offset(0, 3).Value
   Cells(I + 3, 2).Value = ActiveCell.Offset(0, 4).Value
   Cells(I + 4, 2).Value = ActiveCell.Offset(0, 5).Value
   Cells(I + 1, 3).Value = " Contact Detail : "
   Cells(I + 1, 4).Value = ActiveCell.Offset(0, 8).Value
   Cells(I + 2, 3).Value = " Tel # : "
   Cells(I + 2, 4).Value = ActiveCell.Offset(0, 9).Value
   Cells(I + 3, 3).Value = " Fax # : "
   Cells(I + 3, 4).Value = ActiveCell.Offset(0, 10).Value
   Cells(I + 4, 3).Value = " Email : "
   Cells(I + 4, 4).Value = ActiveCell.Offset(0, 11).Value
   Cells(I + 6, 1).Value = " Payment Term : "
   Cells(I + 6, 2).Value = ActiveCell.Offset(0, 14).Value
   Cells(I + 7, 1).Value = " Credit Limit : "
   Cells(I + 7, 2).Value = ActiveCell.Offset(0, 6).Value
   Cells(I + 6, 3).Value = " Discount Rate : "
   Cells(I + 6, 4).Value = ActiveCell.Offset(0, 7).Value & " %"
   Cells(I + 7, 3).Value = " Sales Rep : "
   Cells(I + 7, 4).Value = ActiveCell.Offset(0, 12).Value
   Cells(I + 9, 1).Value = " Delivery Address : "
   Cells(I + 9, 2).Value = ActiveCell.Offset(0, 15).Value
   Cells(I + 10, 2).Value = ActiveCell.Offset(0, 16).Value
   Cells(I + 11, 2).Value = ActiveCell.Offset(0, 17).Value
   Cells(I + 12, 2).Value = ActiveCell.Offset(0, 18).Value
   Cells(I + 13, 2).Value = ActiveCell.Offset(0, 19).Value
   Range(Cells(I + 14, 1), Cells(I + 14, 5)).Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
   I = I + 16
   J = J + 1
   Cells(J, 9).Select
  Loop
Finish1:
Range("A1:A2").HorizontalAlignment = xlLeft
Range("A1") = MyBook.Worksheets("ComData").Range("B2").Value
Range("A2") = "Customer Listing --- Printed on " & Format(Date, "yyyy/mm/dd")
Range("A3:E3").Select
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlMedium
    End With
If Range("A5").Value = "" Then Range("B5").Value = " No Customer Data in the record"
   Columns("H:AZ").ClearContents
   Range("A1:D19").Select
    ActiveWindow.Zoom = True
     Range("C2").Select
    On Error GoTo NoPrinter
      With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$3"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
      End With
NoPrinter:
Else
 Columns("A:T").Select
  With Selection.Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
  End With
  Columns("A").ColumnWidth = 12
  Columns("B").ColumnWidth = 40
  Columns("D:F").ColumnWidth = 34
  Columns("G").ColumnWidth = 15
  Columns("H").ColumnWidth = 10
  Columns("I").ColumnWidth = 34
  Columns("J:K").ColumnWidth = 18
  Columns("L").ColumnWidth = 30
  Columns("M:O").ColumnWidth = 18
  Columns("P").ColumnWidth = 38
  Columns("Q:S").ColumnWidth = 34
  Columns("T").ColumnWidth = 20
  Columns("A:F").NumberFormat = "@"
  Columns("G:H").NumberFormat = "General"
  Columns("I:T").NumberFormat = "@"
  Columns("G:K").HorizontalAlignment = xlCenter
  Columns("O").HorizontalAlignment = xlCenter
  If MyBook.Worksheets("Customer Data").Range("B3") = "" Then GoTo Finish2
  MyBook.Worksheets("Customer Data").Activate
  Set Tbl = ActiveSheet.UsedRange
  Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
  If SortStyle = True Then
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
      False, Orientation:=xlTopToBottom
  Else
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
      False, Orientation:=xlTopToBottom
  End If
  Selection.Columns("B:U").Copy
  ThisWorkbook.Worksheets("Report").Activate
  Range("A8").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
  Application.CutCopyMode = False
Finish2:
  Range("A1:A2").HorizontalAlignment = xlLeft
  Range("A1") = MyBook.Worksheets("ComData").Range("B2").Value
  Range("A2") = "Customer Detail Listing ----- Printed on " & Format(Date, "yyyy/mm/dd")
  Range("A6").Value = " Customer #"
  Range("A7").Value = "-------------"
  Range("B6").Value = " Customer Name"
  Range("B7").Value = "-------------------------------------------------"
  Range("D6").Value = " Address- Line-1"
  Range("D7").Value = "---------------------------------------"
  Range("E6").Value = " Address- Line-2"
  Range("E7").Value = "---------------------------------------"
  Range("F6").Value = " Address- Line-3"
  Range("F7").Value = "---------------------------------------"
  Range("G6").Value = " Credit Limit"
  Range("G7").Value = "------------------"
  Range("H6").Value = " Dis % "
  Range("H7").Value = "------------"
  Range("I6").Value = " Contact Detail "
  Range("I7").Value = "-------------------------------------------------"
  Range("J6").Value = " Tel # "
  Range("J7").Value = "---------------------"
  Range("K6").Value = " Fax # "
  Range("K7").Value = "---------------------"
  Range("L6").Value = " Email "
  Range("L7").Value = "-----------------------------------------"
  Range("M6").Value = " Sales Rep "
  Range("M7").Value = "---------------------"
  Range("O6").Value = " Payment Term "
  Range("O7").Value = "---------------------"
  Range("P6").Value = " Ship-to Co. Name "
  Range("P7").Value = "-------------------------------------------------"
  Range("Q6").Value = " Ship-to Address-1 "
  Range("Q7").Value = "---------------------------------------"
  Range("R6").Value = " Ship-to Address-2 "
  Range("R7").Value = "---------------------------------------"
  Range("S6").Value = " Ship-to Address-3 "
  Range("S7").Value = "---------------------------------------"
  Range("T6").Value = " Ship-to Contact "
  Range("T7").Value = "---------------------"
  Columns("N").Delete
  Columns("C").Delete
 If Range("A8").Value = "" Then Range("C9").Value = " No Customer Data in the record"
    Range("A1:E20").Select
    ActiveWindow.Zoom = True
     Range("A4").Select
    On Error GoTo NoPrinter1
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$7"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter1:
End If
Label19.BackColor = &HC0&
Label19.Visible = False
Unload Me
 Application.EnableEvents = False
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Then
  Userform6.ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("B3").Select
   Userform6.ListBox1.AddItem "SWITCH to listing by Customer name"
   Do While ActiveCell.Value <> ""
    Userform6.ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
    ActiveCell.Offset(1, 0).Select
   Loop
 Else
   Userform6.ListBox1.AddItem "No Customer Data"
 End If
   Userform6.ListBox1.AddItem "CLOSE this box"
   OldForm = "UserForm6"
Else
 OldForm = "UserForm8"
End If
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
SheetName = "Report"
ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
ThisWorkbook.Worksheets("Report").Activate
Application.EnableEvents = True
End Sub
Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "No Customer Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
RowNo = ListBox1.ListIndex + 2
If EventOff = True Then Exit Sub
EventOff = True
TextBox1.Text = MyBook.Worksheets("Customer Data").Cells(RowNo, 2).Value
Call Form7Text1Exit("")
EventOff = False
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox2.ListIndex < 0 Then Exit Sub
If ListBox2.Text <> "C.O.D." And ListBox2.Text <> "Prepaid" Then
 Label26.Left = 443.95
 Label26.Width = 96
 If ListBox2.Text = "# of Days" Then Label26.Caption = "Days"
 If ListBox2.Text = "# of Days after EOM" Then Label26.Caption = "Days after EOM"
 If TextBox18.Text = "" Then TextBox18.Text = 30
 TextBox6.Visible = True
 TextBox18.Visible = True
Else
 Label26.Left = 413.95
 Label26.Width = 126
 Label26.Caption = ListBox2.Text
 TextBox6.Visible = False
 TextBox18.Visible = Flase
End If
 ListBox2.Visible = False
End Sub

Private Sub TextBox1_AfterUpdate()
Dim I As Long, J As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
CustNo = UCase(TextBox1.Text)
If Left(CustNo, 1) = " " Then
 I = Len(CustNo)
 J = 1
 Do While J <= I And Mid(CustNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    CustNo = ""
    GoTo InputChecked
  Else
   CustNo = Right(CustNo, I - J + 1)
  End If
End If
If Right(CustNo, 1) = " " Then
 I = Len(CustNo)
 J = I
 Do While J > 0 And Mid(CustNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    CustNo = ""
    GoTo InputChecked
  Else
   CustNo = Left(CustNo, J)
  End If
End If
InputChecked:
If IsNumeric(CustNo) Then
 If Len(CustNo) < 6 Then
   CustNo = Right(("00000" & CustNo), 5)
   If CustNo = "00000" Then CustNo = Right(("00000" & Val(MyBook.Worksheets("Customer Data").Range("A1").Value) + 1), 5)
 End If
End If
TextBox1.Text = CustNo
Call Form7Text1Exit("")
EventOff = False
End Sub

Private Sub TextBox1_Change()
Label19.Visible = False
ListBox1.Visible = False
End Sub

Private Sub TextBox1_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox18_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If IsNumeric(TextBox18.Text) = False Then
 Cancel = True
 Label19.Caption = Chr(13) & "    Incorrect # of Days of payment terms"
 Label19.Visible = True
Else
 Label19.Visible = False
End If
End Sub

Private Sub TextBox2_Change()
If EventOff = True Then Exit Sub
Label19.Visible = False
End Sub

Private Sub TextBox2_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
 If TextBox13.Text = "" Then TextBox13.Text = TextBox2.Text
End Sub

Private Sub TextBox3_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
  If TextBox14.Text = "" Then TextBox14.Text = TextBox3.Text
End Sub

Private Sub TextBox4_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox4_Exit(ByVal Cancel As MSForms.ReturnBoolean)
  If TextBox15.Text = "" Then TextBox15.Text = TextBox4.Text
End Sub

Private Sub TextBox5_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
  If TextBox16.Text = "" Then TextBox16.Text = TextBox5.Text
End Sub

Private Sub TextBox6_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox6_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CheckNum As Double
Application.EnableCancelKey = xlDisabled
If TextBox6 = "" Then TextBox6 = 0
If IsNumeric(TextBox6.Text) = False Then
 Cancel = True
 Label19.Caption = Chr(13) & "    Incorrect Credit Limit"
 Label19.Visible = True
Else
 CheckNum = TextBox6.Text
 TextBox6.Text = Format(CheckNum, "0.00")
 Label19.Visible = False
End If
End Sub

Private Sub TextBox7_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox7_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CheckNum As Double
Application.EnableCancelKey = xlDisabled
If IsNumeric(TextBox7.Text) = False Then
 Cancel = True
 Label19.Caption = Chr(13) & "    Incorrect Discount Rate"
 Label19.Visible = True
Else
 CheckNum = TextBox7.Text
 TextBox7.Text = CheckNum
 Label19.Visible = False
End If
End Sub

Private Sub TextBox8_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
If TextBox8.Text = " Name, Tel # etc (shown on Invoice)" Then TextBox8.Text = ""
TextBox8.Font.Italic = False
End Sub

Private Sub TextBox8_Exit(ByVal Cancel As MSForms.ReturnBoolean)
  If TextBox17.Text = "" Then TextBox17.Text = TextBox8.Text
End Sub

Private Sub TextBox9_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox10_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox11_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox12_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox13_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox14_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox15_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox16_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox17_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox18_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub UserForm_Initialize()
Dim L As Long, M As Long, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ThisWorkbook.Worksheets("ComFactSheet").Activate
Range("E1").Select
ListBox2.Clear
Do While ActiveCell.Value <> ""
ListBox2.AddItem ActiveCell.Value
ActiveCell.Offset(1, 0).Select
Loop
ListBox2.Value = "C.O.D."
ListBox1.Clear
MyBook.Worksheets("Customer Data").Activate
If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
ListBox1.AddItem "CLOSE this box"
EventOff = True
TextBox1.Text = Right(("00000" & Val(Range("A1").Value) + 1), 5)
For I = 2 To 17
 Controls("TextBox" & I).Text = ""
Next I
 TextBox8.Text = " Name, Tel # etc (shown on Invoice)"
 TextBox8.Font.Italic = True
TextBox6.Text = "0.00"
TextBox6.Visible = False
TextBox7.Text = 0
Label26.Caption = "C.O.D."
Label26.Left = 413.95
Label26.Width = 126
Label22.Caption = "Credit Limit (" & SysCurrency & ") :"
TextBox18.Text = ""
TextBox18.Visible = False
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 CommandButton5.Visible = False
End If
ThisWorkbook.Worksheets("NewCom").Range("A7").Value = "CUSTOMER"
EventOff = False
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("NewCom").Range("A7").ClearContents
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub
Attribute VB_Name = "UserForm8"
Attribute VB_Base = "0{68467A53-60D3-4246-9A0A-263D7D8E3427}{1B380E48-539F-4B43-8318-5E8C6E5DD27A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim I As Long
Application.EnableCancelKey = xlDisabled
If Label1.Caption = "Sales, Invoicing and AR Accounting" Then
  CommandButton1.Visible = False
  Label1.ForeColor = &H400040
  Label1.Caption = "Purchases and AP Accounting"
  CommandButton1.BackColor = &H800000
  CommandButton1.Caption = "Sales    &           AR Accounting"
  CommandButton2.Top = 78
  CommandButton2.Left = 48.1
  CommandButton2.Width = 105
  For I = 3 To 13
   Controls("CommandButton" & I).Visible = False
  Next I
  CommandButton40.Visible = False
  CommandButton41.Visible = False
  CommandButton42.Visible = False
  CommandButton43.Visible = True
  For I = 15 To 25
   Controls("CommandButton" & I).Visible = True
  Next I
  ThisWorkbook.Worksheets("NewCOm").Range("A9").Value = "AP"
ElseIf Label1.Caption = "Purchases and AP Accounting" Then
  Label1.ForeColor = &H800000
  Label1.Caption = "Sales, Invoicing and AR Accounting"
  CommandButton1.BackColor = &H400040
  CommandButton1.Caption = "Purchases   &   AP Accounting"
  CommandButton2.Top = 72
  CommandButton2.Left = 54.05
  CommandButton2.Width = 120
  For I = 3 To 13
   Controls("CommandButton" & I).Visible = True
  Next I
  CommandButton40.Visible = True
  CommandButton41.Visible = True
  CommandButton42.Visible = True
  CommandButton43.Visible = False
  For I = 15 To 25
   Controls("CommandButton" & I).Visible = False
  Next I
  ThisWorkbook.Worksheets("NewCOm").Range("A9").ClearContents
Else
  CommandButton1.Visible = False
  Label1.ForeColor = &H400040
  Label1.Caption = "Purchases and AP Accounting"
  CommandButton1.BackColor = &H800000
  CommandButton1.Caption = "Sales    &           AR Accounting"
  CommandButton2.Top = 78
  CommandButton2.Left = 48.1
  CommandButton2.Width = 105
  For I = 27 To 33
   Controls("CommandButton" & I).Visible = False
  Next I
  CommandButton2.Visible = True
  CommandButton42.Visible = False
  CommandButton43.Visible = True
  For I = 15 To 25
   Controls("CommandButton" & I).Visible = True
  Next I
  ThisWorkbook.Worksheets("NewCOm").Range("A9").Value = "AP"
  CommandButton26.BackColor = &H40C0&
  CommandButton26.Caption = "Inventory  & Manufacturing"
End If
 Label7.Visible = False
   CommandButton1.Visible = True
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 CommandButton9.Visible = False
 CommandButton10.Visible = False
 CommandButton40.Visible = False
 CommandButton41.Visible = False
 CommandButton22.Visible = False
 CommandButton25.Visible = False
 CommandButton32.Visible = False
End If
End Sub
Private Sub CommandButton10_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "STATUS"
Call CreditStatus("")
End Sub

Private Sub CommandButton11_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PRODSALE"
Call ProdSale("")
End Sub

Private Sub CommandButton12_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm16.Show
End Sub

Private Sub CommandButton14_Click()
Application.EnableCancelKey = xlDisabled
Unload Me
OldForm = ""
Call ReturnToMainMenu("")
End Sub

Private Sub CommandButton15_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm14.Show
End Sub

Private Sub CommandButton16_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm17.Show
End Sub

Private Sub CommandButton17_Click()
Application.EnableCancelKey = xlDisabled
 ARPReady = ""
If MyBook.Worksheets("ComData").Range("B8") <> "Yes" Then ARPReady = "Account Setup"
If MyBook.Worksheets("Supplier Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Supplier Setup"
  Else
   ARPReady = ARPReady & ", Supplier Setup"
  End If
End If
If MyBook.Worksheets("Supply Data").Range("D3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Purchase Item Setup"
  Else
   ARPReady = ARPReady & " and Purchase Item Setup"
  End If
 End If
If ARPReady <> "" Then
 Label7.Caption = "    " & ARPReady & " have not been done." & Chr(13) & "    Please proceed setup before making data entry."
 Label7.Visible = True
 Exit Sub
End If
Label7.Visible = False
Unload Me
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PURCHASE"
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm15.Show
End Sub

Private Sub CommandButton18_Click()
Application.EnableCancelKey = xlDisabled
 ARPReady = ""
If MyBook.Worksheets("ComData").Range("B8") <> "Yes" Then ARPReady = "Account Setup"
If MyBook.Worksheets("Supplier Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Supplier Setup"
  Else
   ARPReady = ARPReady & ", Supplier Setup"
  End If
End If
If MyBook.Worksheets("Supply Data").Range("D3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Purchase Item Setup"
  Else
   ARPReady = ARPReady & " and Purchase Item Setup"
  End If
 End If
If ARPReady <> "" Then
 Label7.Caption = "    " & ARPReady & " have not been done." & Chr(13) & "    Please proceed setup before making data entry."
 Label7.Visible = True
 Exit Sub
End If
Label7.Visible = False
Unload Me
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "DEBIT NOTE"
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm15.Show
End Sub

Private Sub CommandButton19_Click()
Application.EnableCancelKey = xlDisabled
 ARPReady = ""
If MyBook.Worksheets("ComData").Range("B8") <> "Yes" Then ARPReady = "Account Setup"
If MyBook.Worksheets("Supplier Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Supplier Setup"
  Else
   ARPReady = ARPReady & ", Supplier Setup"
  End If
End If
If MyBook.Worksheets("Supply Data").Range("D3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Purchase Item Setup"
  Else
   ARPReady = ARPReady & " and Purchase Item Setup"
  End If
 End If
If ARPReady <> "" Then
 Label7.Caption = "    " & ARPReady & " have not been done." & Chr(13) & "    Please proceed setup before making data entry."
 Label7.Visible = True
 Exit Sub
End If
 
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm20.Show
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm10.Show
End Sub
Private Sub CommandButton20_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Call APReport("APREPORT")
End Sub

Private Sub CommandButton21_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm19.Show
End Sub

Private Sub CommandButton22_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Call APAge("APAGING")
End Sub

Private Sub CommandButton23_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm23.Show
End Sub

Private Sub CommandButton24_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Call PartBuy("PARTPUR")
End Sub

Private Sub CommandButton25_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Call PODetail("OSPODetail")
End Sub

Private Sub CommandButton26_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim I As Long
Application.EnableCancelKey = xlDisabled
If Label1.Caption = "Sales, Invoicing and AR Accounting" Then
  CommandButton26.Visible = False
  Label1.ForeColor = &H40C0
  Label1.Caption = "Inventory  & Manufacturing"
  CommandButton26.BackColor = &H800000
  CommandButton26.Caption = "Sales    &           AR Accounting"
  For I = 2 To 13
   Controls("CommandButton" & I).Visible = False
  Next I
  CommandButton40.Visible = False
  CommandButton41.Visible = False
  CommandButton42.Visible = False
  CommandButton43.Visible = False
  For I = 27 To 33
   Controls("CommandButton" & I).Visible = True
  Next I
  ThisWorkbook.Worksheets("NewCOm").Range("A9").Value = "INVENTORY"
ElseIf Label1.Caption = "Purchases and AP Accounting" Then
  Label1.ForeColor = &H40C0
  Label1.Caption = "Inventory  & Manufacturing"
  CommandButton26.BackColor = &H800000
  CommandButton26.Caption = "Sales    &           AR Accounting"
  CommandButton2.Visible = False
  CommandButton42.Visible = False
  CommandButton43.Visible = False
  For I = 15 To 25
   Controls("CommandButton" & I).Visible = False
  Next I
  For I = 27 To 33
   Controls("CommandButton" & I).Visible = True
  Next I
  ThisWorkbook.Worksheets("NewCOm").Range("A9").Value = "INVENTORY"
  CommandButton1.BackColor = &H400040
  CommandButton1.Caption = "Purchases   &   AP Accounting"
Else
  CommandButton26.Visible = False
  Label1.ForeColor = &H800000
  Label1.Caption = "Sales, Invoicing and AR Accounting"
  CommandButton26.BackColor = &H40C0&
  CommandButton26.Caption = "Inventory  & Manufacturing"
  CommandButton2.Top = 72
  CommandButton2.Left = 54.05
  CommandButton2.Width = 120
  For I = 27 To 33
   Controls("CommandButton" & I).Visible = False
  Next I
  For I = 2 To 13
   Controls("CommandButton" & I).Visible = True
  Next I
  CommandButton40.Visible = True
  CommandButton41.Visible = True
  CommandButton42.Visible = True
  CommandButton43.Visible = False
  ThisWorkbook.Worksheets("NewCOm").Range("A9").ClearContents
End If
 Label7.Visible = False
   CommandButton26.Visible = True
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 CommandButton9.Visible = False
 CommandButton10.Visible = False
 CommandButton40.Visible = False
 CommandButton41.Visible = False
 CommandButton22.Visible = False
 CommandButton25.Visible = False
 CommandButton32.Visible = False
End If
End Sub

Private Sub CommandButton27_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm25.Show
End Sub

Private Sub CommandButton28_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm26.Show
End Sub

Private Sub CommandButton29_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm27.Show
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm7.Show
End Sub

Private Sub CommandButton30_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm28.Show
End Sub

Private Sub CommandButton31_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm29.Show
End Sub

Private Sub CommandButton32_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = True
   Label7.BackColor = &H40C0&
    Label7.Caption = Chr(13) & "   Request under processing.  Please wait."
    Label7.Visible = True
    DoEvents
 ThisWorkbook.Worksheets("Report").Activate
 Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
    Range("A7").Value = "Stock #"
    Range("A8").Value = "-------------------------"
    Range("B7").Value = " Part Description "
    Range("B8").Value = "---------------------------------------------------------------------------------"
    Range("D7").Value = "Asset Acct # "
    Range("D8").Value = "-------------------"
    Range("G6").Value = "Available"
    Range("G7").Value = "Stock Qty"
    Range("G8").Value = "-------------------"
    Range("H6").Value = "Total Amount"
    Range("H7").Value = "(" & SysCurrency & ")"
    Range("H8").Value = "-------------------"
    Range("I6").Value = "Average Unit Cost"
    Range("I7").Value = "(" & SysCurrency & ")"
    Range("I8").Value = "-------------------"
    Range("J7").Value = "Unit Style"
    Range("J8").Value = "-------------------"
    Range("K7").Value = "Location"
    Range("K8").Value = "-------------------"
    Columns("A:A").ColumnWidth = 22
    Columns("B:B").ColumnWidth = 60
    Columns("C:K").ColumnWidth = 15
    Columns("I").ColumnWidth = 17.5
    Range("A9").Select
  MyBook.Worksheets("StockRec").Activate
   If Range("B2").Value = "" Then GoTo Finish
    Range("B1").End(xlDown).Select
    I = ActiveCell.Row
   Range(Cells(2, 2), Cells(I, 12)).Copy
   ThisWorkbook.Worksheets("Report").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Range(Cells(9, 1), Cells(I + 7, 11)).Select
  Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
Finish:
   ThisWorkbook.Worksheets("Report").Activate
   Columns("E:F").Delete
   Columns("C").Delete
   Range("C9").Select
   If Range("A9").Value = "" Then Range("B10").Value = "    No Data of Stock Items. "
   Range("A1").Value = MyBook.Worksheets("ComData").Range("B2").Value & " --- Stock Item Detail Listing "
   Range("A3").Value = "Report Date : " & Format(Date, "yyyy/mm/dd")
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C:H").HorizontalAlignment = xlCenter
    Columns("E").NumberFormat = "#,##0.00"
    Columns("F").NumberFormat = "#,##0.0000"
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$8"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
    Range("A1:H20").Select
    ActiveWindow.Zoom = True
    Range("A5").Select
 ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 ThisWorkbook.Worksheets("Report").Activate
  Label7.BackColor = &HC0&
  Label7.Visible = False
  EventOff = False
  Unload Me
  MyBook.Activate
  ThisWorkbook.Worksheets("Report").Activate
  Range("A5").Select
  SheetName = "Report"
  OldForm = "UserForm8"
End Sub

Private Sub CommandButton33_Click()
Dim AcctCode As Variant, LineA As Long, LineB As Long, I As Long, EndDate As Date, StockStartDate As Date
Dim TtlSheet As Long, LastColumn As Long, SumColumn As Long, SumOK As Boolean, TestDate As Long, LastRow As Long
Dim CheckRange As Range, ShName As String, ShNameNext As String, RunCode As String
Dim YearEndDate As Date
  Application.EnableCancelKey = xlDisabled
   UserForm4.Caption = "Stock Value Reconciliation"
   UserForm4.ComboBox1.Visible = False
   UserForm4.ComboBox2.Visible = False
   UserForm4.ComboBox3.Visible = False
   UserForm4.ComboBox4.Visible = False
   UserForm4.Label1.Visible = False
   UserForm4.Label2.Visible = False
   UserForm4.Label3.Caption = "Closing Date (yyyy/mm/dd) : "
   UserForm4.Label3.Visible = True
   UserForm4.Label4.Visible = False
   UserForm4.Label5.Visible = False
   UserForm4.Label6.Visible = False
   UserForm4.Label7.Visible = False
   UserForm4.TextBox1.Visible = False
   UserForm4.TextBox2.Text = Format(Date, "yyyy/mm/dd")
   If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
     YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
     UserForm4.TextBox2.Text = Format(YearEndDate, "yyyy/mm/dd")
   End If
   UserForm4.TextBox2.Visible = True
   UserForm4.TextBox2.SetFocus
   UserForm4.Show
   If Worksheets("Activity Report").Range("D6").Value = "Cancel" Then
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
CheckInput:
  If IsDate(UserForm4.TextBox2.Text) = False Then
    UserForm4.Label1.BackColor = &HC0&
    UserForm4.Label1.ForeColor = &HFFFF&
    UserForm4.Label1.Visible = True
    UserForm4.Label1.Caption = Chr(13) & "     Wrong Date !!!"
    UserForm4.TextBox2.SetFocus
    UserForm4.Show
    If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
      GoTo CheckInput
    Else
      Worksheets("Activity Report").Range("D6").ClearContents
      Call ReturnToMainMenu("")
      Exit Sub
    End If
  Else
    EndDate = UserForm4.TextBox2.Text
    If EndDate < MyBook.Worksheets("InvDetail1").Range("D1").Value Then
      StockStartDate = MyBook.Worksheets("InvDetail1").Range("D1").Value
      UserForm4.Label1.BackColor = &HC0&
      UserForm4.Label1.ForeColor = &HFFFF&
      UserForm4.Label1.Visible = True
      UserForm4.Label1.Caption = "     Data before " & Format(StockStartDate, "yyyy/mm/dd") & " is not available." & Chr(13) & _
                                  "     Please input the Date again."
      UserForm4.TextBox2.SetFocus
      UserForm4.Show
      If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
        GoTo CheckInput
      Else
        Worksheets("Activity Report").Range("D6").ClearContents
        Call ReturnToMainMenu("")
        Exit Sub
      End If
    End If
  End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 YearEndDate = Year(BeginningDate - 1) + 1 & "/" & Month(BeginningDate - 1) & "/" & Day(BeginningDate - 1)
 If EndDate > YearEndDate Then
   UserForm4.Label1.BackColor = &HC0&
   UserForm4.Label1.ForeColor = &HFFFF&
   UserForm4.Label1.Visible = True
   UserForm4.Label1.Caption = Chr(13) & " Ending Date out of Range of this Year End File"
   UserForm4.TextBox2.SetFocus
   UserForm4.Show
   If Worksheets("Activity Report").Range("D6").Value <> "Cancel" Then
        GoTo CheckInput
   Else
        Worksheets("Activity Report").Range("D6").ClearContents
        Call ReturnToMainMenu("")
        Exit Sub
   End If
 End If
End If
  EventOff = True
  RunCode = "Inv Rec"
  Call BalanceNewB(RunCode)
  If RunCode = "Error" Then
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Balance Sheet").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   Label7.BackColor = &HC0&
   Label7.Visible = False
   EventOff = False
   OldForm = ""
      MsgBox ("Error is found during processing of Stock Data" & Chr(13) & Chr(13) & _
      "Data file may probably be lack of space for the report." & Chr(13) & _
      "Please proceed 'Year End Update' to remove old data for previous years")
   Exit Sub
  End If
  ThisWorkbook.Worksheets("Report").Activate
 Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
   Range("A10").Select
    Range("A7").Value = "Asset Acct # "
    Range("A8").Value = "-------------------"
    Range("B7").Value = "Stock #"
    Range("B8").Value = "-------------------------"
    Range("C7").Value = " Part Description "
    Range("C8").Value = "-------------------------------------------------------------------------------"
    Range("D7").Value = "Stock Qty"
    Range("D8").Value = "-------------------"
    Range("E6").Value = "Amount"
    Range("E7").Value = "(" & SysCurrency & ")"
    Range("E8").Value = "-------------------"
    Range("F5").Value = "Inventory"
    Range("F6").Value = "Asset Value"
    Range("F7").Value = "(" & SysCurrency & ")"
    Range("F8").Value = "-------------------"
    Range("G5").Value = "Balance Sheet"
    Range("G6").Value = "Value"
    Range("G7").Value = "(" & SysCurrency & ")"
    Range("G8").Value = "-------------------"
    Range("H6").Value = "Difference"
    Range("H7").Value = "(" & SysCurrency & ")"
    Range("H8").Value = "-------------------"
    Columns("A").ColumnWidth = 12
    Columns("B").ColumnWidth = 22
    Columns("C").ColumnWidth = 60
    Columns("D:H").ColumnWidth = 18
    Range("B9").Select
    MyBook.Worksheets("InvDetail1").Activate
    If Range("A3").Value = "" Then GoTo Finish
    TtlSheet = Range("B1").Value
    For I = 1 To TtlSheet
     ShName = "InvDetail" & I
     MyBook.Worksheets(ShName).Activate
     If Range("A3").Value <> "" Then
       ActiveSheet.UsedRange.Select
       Selection.Offset(2, 0).Resize(Selection.Rows.Count - 2).Select
       Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("C1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     End If
    Next I
    SumOK = False
    TestDate = CDate(EndDate)
     MyBook.Worksheets("InvDetail1").Activate
     Range("A1").End(xlDown).Select
     LastRow = ActiveCell.Row
    I = 1
    Do While I <= TtlSheet And SumOK = False
     ShName = "InvDetail" & I - 1
     ShNameNext = "InvDetail" & I
     If I = 1 Then
       MyBook.Worksheets(ShNameNext).Activate
       Range("E2").End(xlToRight).Select
       LastColumn = ActiveCell.Column
     Else
       MyBook.Worksheets(ShName).Activate
       Range(Cells(3, 6), Cells(LastRow, 6)).Copy
       MyBook.Worksheets(ShNameNext).Activate
       Range("G3").Select
       ActiveSheet.Paste
       Application.CutCopyMode = False
       Range("E2").End(xlToRight).Select
       LastColumn = ActiveCell.Column
     End If
     If Range("H2").Value = "" Then
        Range(Cells(3, 7), Cells(LastRow, 7)).Copy
        Cells(3, 6).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        SumOK = True
     ElseIf Range("H2").Value <= EndDate Then
        Range(Cells(3, 7), Cells(LastRow, 7)).Copy
        Cells(3, 6).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        SumOK = True
     ElseIf LastColumn = 8 Then
         Range(Cells(3, 6), Cells(LastRow, 6)).Select
      With Selection
        .Columns("A").FormulaR1C1 = "=SUM(RC[1]:RC[2])"
        .Copy
        Range("F3").Select
        Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
      End With
        Application.CutCopyMode = False
        SumOK = True
     ElseIf LastColumn > 8 Then
       If Cells(2, LastColumn) = EndDate Then
         Range(Cells(3, 6), Cells(LastRow, 6)).Select
         With Selection
          .Columns("A").FormulaR1C1 = "=SUM(RC[1]:RC[" & LastColumn - 7 & "])"
          .Copy
          Range("F3").Select
          Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
          False, Transpose:=False
         End With
          Application.CutCopyMode = False
          SumOK = True
       ElseIf Cells(2, LastColumn) > EndDate Then
         Range(Cells(3, 6), Cells(LastRow, 6)).Select
         With Selection
          .Columns("A").FormulaR1C1 = "=SUM(RC[1]:RC[" & LastColumn - 6 & "])"
          .Copy
          Range("F3").Select
          Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
          False, Transpose:=False
         End With
          Application.CutCopyMode = False
          SumOK = False
       ElseIf Cells(2, LastColumn) < EndDate Then
        Set CheckRange = Range(Cells(2, 8), Cells(2, LastColumn))
        SumColumn = Application.Match(TestDate, CheckRange, -1) + 7
        If Cells(2, SumColumn).Value = EndDate Then SumColumn = SumColumn - 1
         Range(Cells(3, 6), Cells(LastRow, 6)).Select
         With Selection
          .Columns("A").FormulaR1C1 = "=SUM(RC[1]:RC[" & SumColumn - 6 & "])"
          .Copy
          Range("F3").Select
          Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
          False, Transpose:=False
         End With
          Application.CutCopyMode = False
          SumOK = True
       End If
     End If
     I = I + 1
    Loop
    If I > 2 Then
      MyBook.Worksheets(ShNameNext).Activate
      Range(Cells(3, 6), Cells(LastRow, 6)).Copy
      MyBook.Worksheets("InvDetail1").Activate
      Range("F3").Select
      ActiveSheet.Paste
      Application.CutCopyMode = False
    End If
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.UsedRange.Delete
   Range("B1").Select
   MyBook.Worksheets("InvDetail1").Activate
   Range(Cells(3, 1), Cells(LastRow, 6)).Copy
   ThisWorkbook.Worksheets("TempRP").Activate
   ActiveSheet.Paste
   Application.CutCopyMode = False
  Range(Cells(1, 8), Cells(LastRow - 2, 8)).FormulaR1C1 = "=SUM(RC[-1])*(-1)"
  Range(Cells(1, 9), Cells(LastRow - 2, 9)).FormulaR1C1 = "=SUM(R[1]C[-2])*(-1)"
  Range(Cells(1, 8), Cells(LastRow - 2, 9)).Copy
  Cells(1, 8).Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
          False, Transpose:=False
   Application.CutCopyMode = False
  ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("F1"), Order2:=xlAscending, Key3:=Range("B1"), Order3:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 I = LastRow / 2
 Cells(I, 4).Select
 If ActiveCell.Value = 2 Then
  Do While ActiveCell.Value = 2
   ActiveCell.Offset(-1, 0).Select
  Loop
   LastRow = ActiveCell.Row
   ActiveCell.Offset(1, 0).EntireRow.Insert
   ActiveCell.Offset(2, 0).Select
 Else
  Do While ActiveCell.Value = 1
   ActiveSheet.Offset(1, 0).Select
  Loop
   LastRow = ActiveCell.Row - 1
   ActiveCell.EntireRow.Insert
   ActiveCell.Offset(1, 0).Select
 End If
 ActiveCell.CurrentRegion.EntireRow.Delete
 Columns("F").Copy
 Range("A1").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range(Cells(1, 6), Cells(LastRow, 6)).Select
  With Selection
    .FormulaR1C1 = "=LEFT(RC[-5] & ""*******"",7)"
  End With
  ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("F1"), Order1:=xlAscending, Key2:=Range("B1"), Order2:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Columns("D:G").Delete
 ActiveSheet.UsedRange.Copy
 ThisWorkbook.Worksheets("Report").Activate
 Range("A9").Select
 ActiveSheet.Paste
   Range("A9").Select
   Do While ActiveCell.Value <> ""
    LineA = ActiveCell.Row
    LineB = LineA
    AcctCode = ActiveCell.Value
    Do While ActiveCell.Offset(1, 0).Value = AcctCode
     LineB = LineB + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Cells(LineA, 6).Value = Application.Sum(Range(Cells(LineA, 5), Cells(LineB, 5)))
    If IsError(Application.Match(AcctCode, Worksheets("RunningDat").Columns("B"), 0)) Then
      Cells(LineA, 7).Value = 0
    Else
     I = Application.Match(AcctCode, Worksheets("RunningDat").Columns("B"), 0)
      Cells(LineA, 7).Value = Worksheets("RunningDat").Cells(I, 4).Value
    End If
    Cells(LineA, 8).Value = Cells(LineA, 6).Value - Cells(LineA, 7).Value
    If LineB > LineA Then Range(Cells(LineA + 1, 1), Cells(LineB, 1)).ClearContents
    ActiveCell.Offset(1, 0).EntireRow.Insert
    LineA = LineB + 2
    LineB = LineA
    Cells(LineA, 1).Select
   Loop
Finish:
   ThisWorkbook.Worksheets("Report").Activate
   If Range("A9").Value = "" Then Range("B10").Value = "    No Data of Stock Items. "
   Range("A1").Value = MyBook.Worksheets("ComData").Range("B2").Value
   Range("A2").Value = "Reconciliation of Closing Inventory as at " & Format(EndDate, "yyyy/mm/dd")
   Range("A4").Value = "Report Date : " & Format(Date, "yyyy/mm/dd")
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
    Columns("A").HorizontalAlignment = xlCenter
    Range("A1:A5").HorizontalAlignment = xlLeft
    Columns("B:C").HorizontalAlignment = xlLeft
    Columns("D:H").HorizontalAlignment = xlCenter
    Columns("E:H").NumberFormat = "#,##0.00"
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .PrintTitleRows = "$1:$8"
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
    Range("A1:H20").Select
    ActiveWindow.Zoom = True
    Range("A5").Select
 ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
 ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
 ThisWorkbook.Worksheets("Balance Sheet").Visible = xlSheetVeryHidden
 ThisWorkbook.Worksheets("Report").Activate
  Label7.BackColor = &HC0&
  Label7.Visible = False
 EventOff = False
Unload Me
 MyBook.Activate
ThisWorkbook.Worksheets("Report").Activate
Range("A5").Select
SheetName = "Report"
OldForm = "UserForm8"
End Sub

Private Sub CommandButton4_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm9.Show
End Sub

Private Sub CommandButton40_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Call PIOrderReport("PIDetail")
End Sub

Private Sub CommandButton41_Click()
Dim I As Long, J As Long, K As Long, M As Long, LineStart As Long, ProdCode As String
Dim QtyTotal As Double, LastTempRPRow As Long, BuildQty As Double, RepeatNo As Long
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("TempRP").Activate
ActiveSheet.UsedRange.EntireRow.Delete
Range("G1").Select
 EventOff = True
  Label7.BackColor = &H40C0&
  Label7.Caption = Chr(13) & "   Request under processing.  Please wait."
  Label7.Visible = True
  DoEvents
 ThisWorkbook.Worksheets("RunningDat").Activate
 ActiveSheet.UsedRange.EntireRow.Delete
 Range("J1").Select
   Application.EnableEvents = False
   Application.DisplayAlerts = False
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
  Application.DisplayAlerts = True
  Application.EnableEvents = True
    Range("A10").Value = "Product #"
    Range("A11").Value = "-----------------------------"
    Range("B10").Value = "Description"
    Range("B11").Value = "-----------------------------------------------------------------------"
    Range("C9").Value = " Quantity "
    Range("C10").Value = " on Order "
    Range("C11").Value = "-------------------------"
    Range("D9").Value = " Stock Item Required"
    Range("D10").Value = "to fulfill Orders"
    Range("D11").Value = "---------------------------------"
    Range("E9").Value = " Quantity "
    Range("E10").Value = " Required "
    Range("E11").Value = "-------------------------"
    Range("F9").Value = " Quantity "
    Range("F10").Value = "in Stock"
    Range("F11").Value = "-------------------------"
    Range("G9").Value = " Quantity "
    Range("G10").Value = " Lacking "
    Range("G11").Value = "-------------------------"
    Range("H9").Value = " Self-Build "
    Range("H10").Value = "Item"
    Range("H11").Value = "------------------------"
    Columns("A").ColumnWidth = 22
    Columns("B").ColumnWidth = 45
    Columns("C:H").ColumnWidth = 18
     Columns("D").ColumnWidth = 25
    Columns("A:B").HorizontalAlignment = xlLeft
    Columns("C:H").HorizontalAlignment = xlCenter
    Range("A1:A8").HorizontalAlignment = xlLeft
    Range("B1:G8").HorizontalAlignment = xlCenterAcrossSelection
    Range("B1").Value = MyBook.Worksheets("ComData").Range("B2").Value
    Range("B2").Value = MyBook.Worksheets("ComData").Range("B3").Value
    Range("B3").Value = MyBook.Worksheets("ComData").Range("B4").Value
    Range("B4").Value = MyBook.Worksheets("ComData").Range("B5").Value
    Range("A12").Select
 On Error GoTo ErrorHandling
   MyBook.Worksheets("ProInvoice").Activate
  If Range("B4").Value = "" Then GoTo Finish
  ActiveSheet.UsedRange.Select
  J = Selection.Rows.Count
  Range(Cells(4, 30), Cells(J, 194)).Copy
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.Paste
  Application.CutCopyMode = False
 I = 1
 Range("A1").Select
 Do While Cells(I, 7).Value <> ""
  DisRate = Cells(I, 10).Value
  J = Cells(I, 7).Value
  K = 13
  Do While J > 0
    Range(Cells(I, K), Cells(I, K + 2)).Copy
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveCell.Offset(1, 0).Select
    J = J - 1
    K = K + 8
  Loop
  I = I + 1
 Loop
  Columns("G:DD").Delete
  If Range("A1").Value = "" Then GoTo Finish
   ActiveSheet.UsedRange.Select
   Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("A1").Select
  Do While ActiveCell.Value <> ""
   ProdCode = ActiveCell.Value
   QtyTotal = ActiveCell.Offset(0, 2).Value
   Do While ActiveCell.Offset(1, 0).Value = ProdCode
    QtyTotal = QtyTotal + ActiveCell.Offset(1, 2).Value
    ActiveCell.EntireRow.Delete
   Loop
   ActiveCell.Offset(0, 2).Value = QtyTotal
   If IsError(Application.Match(ProdCode, MyBook.Worksheets("Product Data").Columns("B"), 0)) = False Then
     I = Application.Match(ProdCode, MyBook.Worksheets("Product Data").Columns("B"), 0)
     If MyBook.Worksheets("Product Data").Cells(I, 9).Value = "" Then
        ActiveCell.EntireRow.Delete
     Else
      ActiveCell.Offset(0, 3).NumberFormat = "@"
      ActiveCell.Offset(0, 3).Value = MyBook.Worksheets("Product Data").Cells(I, 9).Value
      ActiveCell.Offset(1, 0).Select
     End If
   Else
    ActiveCell.EntireRow.Delete
   End If
  Loop
  If Range("A1").Value = "" Then GoTo Finish
 ActiveSheet.UsedRange.Select
 Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
 K = 1
 Range("D1").Select
 Do While ActiveCell.Value <> ""
   StockNo = ActiveCell.Value
   I = ActiveCell.Row
   J = I - 1
   QtyTotal = ActiveCell.Offset(0, -1).Value
   Do While ActiveCell.Offset(1, 0).Value = StockNo
    QtyTotal = QtyTotal + ActiveCell.Offset(1, -1).Value
    ActiveCell.Offset(1, 0).Select
   Loop
   J = ActiveCell.Row
   Cells(I, 5).Value = QtyTotal
   If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
    M = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
    Cells(I, 6).Value = MyBook.Worksheets("StockRec").Cells(M, 8).Value
    If MyBook.Worksheets("StockRec").Cells(M, 7).Value = "Yes" Then Cells(I, 8).Value = "Yes"
   End If
    If Cells(I, 6).Value = "" Then Cells(I, 6).Value = 0
    If Cells(I, 6).Value < Cells(I, 5).Value Then
      Cells(I, 7).Value = Cells(I, 5) - Cells(I, 6).Value
     If Cells(I, 8).Value = "Yes" Then
        Range(Cells(I, 4), Cells(I, 8)).Copy
        ThisWorkbook.Worksheets("RunningDat").Activate
        Cells(K, 10).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        K = K + 1
        ThisWorkbook.Worksheets("TempRP").Activate
     End If
    End If
   ActiveCell.Offset(1, 0).Select
 Loop
 LastTempRPRow = ActiveCell.Row
 RepeatNo = 0
RepeatBOM:
 RepeatNo = RepeatNo + 1
 If RepeatNo > 15 Then GoTo LoopProblem
 ThisWorkbook.Worksheets("RunningDat").Activate
 Range("J1").Select
 If ActiveCell.Value = "" Then GoTo PrintReport
  I = 1
 Do While ActiveCell.Value <> ""
   BuildQty = ActiveCell.Offset(0, 1).Value - ActiveCell.Offset(0, 2).Value - ActiveCell.Offset(0, 5).Value
   If BuildQty > 0 Then
    StockNo = ActiveCell.Value
    Cells(1, 1).NumberFormat = "@"
    Cells(1, 1).Value = StockNo
    Cells(1, 5).Value = "Yes"
    Cells(1, 7).Value = BuildQty
    Call PICompCal("PICompCal", BuildQty, LastTempRPRow)
   End If
   I = I + 1
   Cells(I, 10).Select
 Loop
  ThisWorkbook.Worksheets("RunningDat").Activate
  ActiveSheet.UsedRange.Delete
  Worksheets("TempRP").Activate
  ActiveSheet.UsedRange.Select
 ActiveSheet.UsedRange.Select
 Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Key2:=Range("A1"), Order2:=xlAscending, Key3:=Range("F1"), Order3:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 K = 1
 Range("D1").Select
 Do While ActiveCell.Value <> ""
   StockNo = ActiveCell.Value
   I = ActiveCell.Row
   J = I - 1
   QtyTotal = ActiveCell.Offset(0, 1).Value
   BuildQty = ActiveCell.Offset(0, 5).Value
   Do While ActiveCell.Offset(1, 0).Value = StockNo
    QtyTotal = QtyTotal + ActiveCell.Offset(1, 1).Value
    BuildQty = BuildQty + ActiveCell.Offset(1, 5).Value
    If ActiveCell.Offset(1, -3).Value = "" Then
      ActiveCell.Offset(1, 0).EntireRow.Delete
    Else
      ActiveCell.Offset(1, 0).Select
    End If
   Loop
   J = ActiveCell.Row
   Cells(I, 5).Value = QtyTotal
   Cells(I, 9).Value = BuildQty
   If Cells(I, 6).Value = "" Then
     If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
       M = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
       Cells(I, 6).Value = MyBook.Worksheets("StockRec").Cells(M, 8).Value
      If MyBook.Worksheets("StockRec").Cells(M, 7).Value = "Yes" Then Cells(I, 8).Value = "Yes"
     End If
     If Cells(I, 6).Value = "" Then Cells(I, 6).Value = 0
   End If
    If Cells(I, 6).Value < Cells(I, 5).Value Then Cells(I, 7).Value = Cells(I, 5) - Cells(I, 6).Value
     BuildQty = Cells(I, 5).Value - Cells(I, 6).Value - Cells(I, 9).Value
     If Cells(I, 8).Value = "Yes" And BuildQty > 0 Then
        Range(Cells(I, 4), Cells(I, 9)).Copy
        ThisWorkbook.Worksheets("RunningDat").Activate
        Cells(K, 10).Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        K = K + 1
        ThisWorkbook.Worksheets("TempRP").Activate
     End If
   ActiveCell.Offset(1, 0).Select
 Loop
  LastTempRPRow = ActiveCell.Row
 GoTo RepeatBOM
PrintReport:
 ThisWorkbook.Worksheets("TempRP").Activate
 ActiveSheet.UsedRange.Select
 Selection.Sort Key1:=Range("A1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Key3:=Range("F1"), Order3:=xlAscending, _
    Header:=xlNo, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
 Range(Cells(1, 1), Cells(LastTempRPRow, 8)).Copy
 ThisWorkbook.Worksheets("Report").Activate
 Range("A12").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Selection.Columns("C:H").HorizontalAlignment = xlCenter
Finish:
   ThisWorkbook.Worksheets("Report").Activate
    Range("A1").Value = "Date: " & Format(Date, "yyyy/mm/dd")
    Range("A2").Value = "Time: " & TimeValue(Now)
    If Range("A12") = "" Then Range("B13").Value = "  No Open Order for Stock Items "
    Range("B6").Value = "Stock Items Status for fulfillment of Open Sales Orders"
    Range("A1:H18").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
   ActiveSheet.UsedRange.Select
       With Selection.Font
        .Name = "Arial"
        .Size = 12
        .Bold = False
       End With
     Selection.RowHeight = 18
   On Error GoTo NoPrinter
    With ActiveSheet.PageSetup
        .Orientation = xlLandscape
        .PrintTitleRows = "$1:$11"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
  ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
  ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
  Unload UserForm8
  MyBook.Activate
  ThisWorkbook.Worksheets("Report").Activate
  SheetName = "Report"
  OldForm = "UserForm8"
  Application.ScreenUpdating = True
  Range("A1").Select
  Range("A3").Select
  On Error GoTo 0
  EventOff = False
 Exit Sub
ErrorHandling:
   Unload UserForm8
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
    OldForm = ""
   On Error GoTo 0
   Application.ScreenUpdating = True
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "It is probably because Data file is lack of space for the report." & Chr(13) & _
    "Try to reduce the report by selecting a shorter period")
 EventOff = False
 Exit Sub
LoopProblem:
   Unload UserForm8
   ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVisible
   ThisWorkbook.Worksheets("Report").Visible = xlSheetVeryHidden
   ThisWorkbook.Worksheets("System Menu").Activate
   SheetName = "System Menu"
    OldForm = ""
   On Error GoTo 0
   Application.ScreenUpdating = True
  MsgBox ("Error is found during processing of the Report." & Chr(13) & Chr(13) & _
    "There may be a problem with the BOMs" & Chr(13) & _
    "Please check if any BOM has entered its grandparent product as its component")
 EventOff = False
End Sub

Private Sub CommandButton42_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "ARREC"
Call ARRec("")
End Sub

Private Sub CommandButton43_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "ARREC"
Call APRec("")
End Sub

Private Sub CommandButton5_Click()
Dim ARPReady As String
Application.EnableCancelKey = xlDisabled
 ARPReady = ""
If MyBook.Worksheets("ComData").Range("B8") <> "Yes" Then ARPReady = "Account Setup"
If MyBook.Worksheets("Customer Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Customer Setup"
  Else
   ARPReady = ARPReady & ", Customer Setup"
  End If
End If
If MyBook.Worksheets("Product Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Product Setup"
  Else
   ARPReady = ARPReady & " and Product Setup"
  End If
 End If
If ARPReady <> "" Then
 Label7.Caption = "    " & ARPReady & " have not been done." & Chr(13) & "    Please proceed setup before making data entry."
 Label7.Visible = True
 Exit Sub
End If
Label7.Visible = False
Unload Me
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE"
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Userform6.Show
End Sub

Private Sub CommandButton6_Click()
Application.EnableCancelKey = xlDisabled
 ARPReady = ""
If MyBook.Worksheets("ComData").Range("B8") <> "Yes" Then ARPReady = "Account Setup"
If MyBook.Worksheets("Customer Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Customer Setup"
  Else
   ARPReady = ARPReady & ", Customer Setup"
  End If
End If
If MyBook.Worksheets("Product Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Product Setup"
  Else
   ARPReady = ARPReady & " and Product Setup"
  End If
 End If
If ARPReady <> "" Then
 Label7.Caption = "    " & ARPReady & " have not been done." & Chr(13) & "    Please proceed setup before making data entry."
 Label7.Visible = True
 Exit Sub
End If
Label7.Visible = False
Unload Me
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "CREDIT NOTE"
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Userform6.Show
End Sub

Private Sub CommandButton7_Click()
Application.EnableCancelKey = xlDisabled
 ARPReady = ""
If MyBook.Worksheets("ComData").Range("B8") <> "Yes" Then ARPReady = "Account Setup"
If MyBook.Worksheets("Customer Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Customer Setup"
  Else
   ARPReady = ARPReady & ", Customer Setup"
  End If
End If
If MyBook.Worksheets("Product Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Product Setup"
  Else
   ARPReady = ARPReady & " and Product Setup"
  End If
 End If
If ARPReady <> "" Then
 Label7.Caption = "    " & ARPReady & " have not been done." & Chr(13) & "    Please proceed setup before making data entry."
 Label7.Visible = True
 Exit Sub
End If
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm11.Show
End Sub

Private Sub CommandButton13_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "ARREPORT"
Call ARReport("")

End Sub

Private Sub CommandButton8_Click()
Dim ARPReady As String
Application.EnableCancelKey = xlDisabled
 ARPReady = ""
If MyBook.Worksheets("ComData").Range("B8") <> "Yes" Then ARPReady = "Account Setup"
If MyBook.Worksheets("Customer Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Customer Setup"
  Else
   ARPReady = ARPReady & ", Customer Setup"
  End If
End If
If MyBook.Worksheets("Product Data").Range("B3").Value = "" Then
  If ARPReady = "" Then
   ARPReady = "Product Setup"
  Else
   ARPReady = ARPReady & " and Product Setup"
  End If
 End If
If ARPReady <> "" Then
 Label7.Caption = "    " & ARPReady & " have not been done." & Chr(13) & "    Please proceed setup before making data entry."
 Label7.Visible = True
 Exit Sub
End If
Label7.Visible = False
Unload Me
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE"
Application.ScreenUpdating = True
Application.ScreenUpdating = False
Userform6.Show
End Sub

Private Sub CommandButton9_Click()
Application.EnableCancelKey = xlDisabled
Label7.Visible = False
Unload Me
Application.ScreenUpdating = True
Application.ScreenUpdating = False
ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "ARAGING"
Call AgeReport("")
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
Me.Caption = MyBook.Worksheets("ComData").Range("B2").Value & " ---- Sub-Ledger Accounting"
DebtorAcct = MyBook.Worksheets("ComData").Range("A21").Value
SalesDisAcct = MyBook.Worksheets("ComData").Range("A22").Value
CreditorAcct = MyBook.Worksheets("ComData").Range("A23").Value
BankAcct = MyBook.Worksheets("ComData").Range("A24").Value
If ThisWorkbook.Worksheets("NewCOm").Range("A9").Value = "AP" Then
  Label1.ForeColor = &H400040
  Label1.Caption = "Purchases and AP Accounting"
  CommandButton1.BackColor = &H800000
  CommandButton1.Caption = "Sales    &           AR Accounting"
  CommandButton2.Top = 78
  CommandButton2.Left = 48.01
  CommandButton2.Width = 105
  For I = 3 To 13
   Controls("CommandButton" & I).Visible = False
  Next I
  CommandButton40.Visible = False
  CommandButton41.Visible = False
  CommandButton42.Visible = False
  CommandButton43.Visible = True
  For I = 15 To 25
   Controls("CommandButton" & I).Visible = True
  Next I
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
   Label6.Visible = True
  ElseIf FileStatus = "AlertEnd" Then
    Label6.Caption = "   Note: Data File is FULL.  Data Entry is Not Allowed"
    Label6.Visible = True
  ElseIf FileStatus = "ReadOnly" Then
    Label6.Caption = "   Note: Data File is being used by another user.  Data Entry is Not Allowed"
    Label6.Visible = True
  End If
ElseIf ThisWorkbook.Worksheets("NewCOm").Range("A9").Value = "INVENTORY" Then
  Label1.ForeColor = &H40C0
  Label1.Caption = "Inventory  & Manufacturing"
  CommandButton26.BackColor = &H800000
  CommandButton26.Caption = "Sales    &           AR Accounting"
  CommandButton1.BackColor = &H400040
  CommandButton1.Caption = "Purchases   &   AP Accounting"
  For I = 2 To 13
   Controls("CommandButton" & I).Visible = False
  Next I
   CommandButton40.Visible = False
   CommandButton41.Visible = False
   CommandButton42.Visible = False
   CommandButton43.Visible = False
  For I = 15 To 25
   Controls("CommandButton" & I).Visible = False
  Next I
  For I = 27 To 33
   Controls("CommandButton" & I).Visible = True
  Next I
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
   Label6.Visible = True
  ElseIf FileStatus = "AlertEnd" Then
    Label6.Caption = "   Note: Data File is FULL.  Data Entry is Not Allowed"
    Label6.Visible = True
  ElseIf FileStatus = "ReadOnly" Then
    Label6.Caption = "   Note: Data File is being used by another user.  Data Entry is Not Allowed"
    Label6.Visible = True
  End If
Else
  Label1.ForeColor = &H800000
  Label1.Caption = "Sales, Invoicing and AR Accounting"
  CommandButton1.BackColor = &H400040
  CommandButton1.Caption = "Purchases   &   AP Accounting"
  CommandButton2.Top = 72
  CommandButton2.Left = 54.05
  CommandButton2.Width = 120
  For I = 3 To 13
   Controls("CommandButton" & I).Visible = True
  Next I
  CommandButton40.Visible = True
  CommandButton41.Visible = True
  CommandButton42.Visible = True
  CommandButton43.Visible = False
  For I = 15 To 25
   Controls("CommandButton" & I).Visible = False
  Next I
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
    Label6.Visible = True
  ElseIf FileStatus = "AlertEnd" Then
    Label6.Caption = "   Note: Data File is FULL.  Data Entry is Not Allowed"
    Label6.Visible = True
  ElseIf FileStatus = "ReadOnly" Then
    Label6.Caption = "   Note: Data File is being used by another user.  Data Entry is Not Allowed"
    Label6.Visible = True
  End If
End If
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Then
 CommandButton9.Visible = False
 CommandButton10.Visible = False
 CommandButton40.Visible = False
 CommandButton41.Visible = False
 CommandButton22.Visible = False
 CommandButton25.Visible = False
 CommandButton32.Visible = False
End If
BeginningDate = MyBook.Worksheets("Raw Data").Range("A1").Value
OldForm = ""
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
Application.EnableCancelKey = xlDisabled
If CloseMode = vbFormControlMenu Then Cancel = True
OldForm = ""
End Sub
Attribute VB_Name = "UserForm9"
Attribute VB_Base = "0{CD04343A-7180-40D9-8812-6DB6BDA6478C}{76CA1E0B-D6D5-4509-8B15-99AD131422AA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public SaleAcctNo As String, AssetAcctNo As String, CostAcctNo As String
Public StockAssetAcct As String, StockCostAcct As String, SaleAcctCK As Variant, AssetAcctCK As Variant, CostAcctCK As Variant
Private Sub ComboBox1_Click()
Dim EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
Label10.Visible = False
ComboBox1.Width = 60
Label13.Caption = ""
SaleAcctNo = ComboBox1.Text
FullNo = Len(SaleAcctNo)
EndNo = 1
Do While Mid(SaleAcctNo, EndNo, 1) <> " " And EndNo <= FullNo
EndNo = EndNo + 1
Loop
If FullNo > 6 Then Label13.Caption = Right(SaleAcctNo, FullNo - 6)
SaleAcctNo = Left(SaleAcctNo, EndNo - 1)
ComboBox1.Text = SaleAcctNo
End Sub
Private Sub Combobox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long, J As Long, TempInput As String, EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ComboBox1.Width = 60
 If ComboBox1.Text = "" Then
  Label13.Caption = ""
  Exit Sub
 End If
I = ComboBox1.ListCount
J = 0
TempInput = ComboBox1.Text
Do While J < I
 If TempInput = Left(ComboBox1.List(J), Len(TempInput)) Then
   TempInput = ComboBox1.List(J)
   FullNo = Len(TempInput)
   EndNo = 1
   Do While Mid(TempInput, EndNo, 1) <> " " And EndNo <= FullNo
    EndNo = EndNo + 1
   Loop
   TempInput = Left(TempInput, EndNo - 1)
   ComboBox1.Text = TempInput
   Label13.Caption = Right(ComboBox1.List(J), Len(ComboBox1.List(J)) - 6)
  Exit Sub
 End If
  J = J + 1
Loop
 Label10.Caption = Chr(13) & "    Incorrect Sales Account #"
 Label13.Caption = ""
 Label10.Visible = True
End Sub
Private Sub Combobox1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label10.Visible = False
ComboBox1.Width = 306
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub ComboBox2_Click()
Dim EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ComboBox2.Width = 60
If StockNoExist = "Yes" And StockAssetAcct <> "" Then
  Label10.Caption = Chr(13) & "   The stock # exists in the Record." & Chr(13) & "   Change of the linked Accounts should be done at Inventory System"
  Label10.Visible = True
  ComboBox2.Value = StockAssetAcct
  Exit Sub
End If
Label14.Caption = ""
AssetAcctNo = ComboBox2.Text
FullNo = Len(AssetAcctNo)
EndNo = 1
Do While Mid(AssetAcctNo, EndNo, 1) <> " " And EndNo <= FullNo
EndNo = EndNo + 1
Loop
If FullNo > 6 Then Label14.Caption = Right(AssetAcctNo, FullNo - 6)
Label14.Visible = True
AssetAcctNo = Left(AssetAcctNo, EndNo - 1)
ComboBox2.Text = AssetAcctNo
End Sub

Private Sub ComboBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long, J As Long, TempInput As String, EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
  ListBox1.Visible = False
  ListBox2.Visible = False
  ComboBox2.Width = 60
If StockNoExist = "Yes" And StockAssetAcct <> "" Then
  Label10.Caption = Chr(13) & "   The stock # exists in the Record." & Chr(13) & "   Change of the Asset Account should be done at Inventory System"
  Label10.Visible = True
  ComboBox2.Value = StockAssetAcct
  Exit Sub
End If
  If ComboBox2.Text = "" Then
  Label14.Caption = ""
  Exit Sub
 End If
I = ComboBox2.ListCount
J = 0
TempInput = ComboBox2.Text
Do While J < I
 If TempInput = Left(ComboBox2.List(J), Len(TempInput)) Then
   TempInput = ComboBox2.List(J)
   FullNo = Len(TempInput)
   EndNo = 1
   Do While Mid(TempInput, EndNo, 1) <> " " And EndNo <= FullNo
    EndNo = EndNo + 1
   Loop
   TempInput = Left(TempInput, EndNo - 1)
   ComboBox2.Text = TempInput
   Label14.Caption = Right(ComboBox2.List(J), Len(ComboBox2.List(J)) - 6)
  Exit Sub
 End If
  J = J + 1
Loop
 Label10.Caption = Chr(13) & "    Incorrect Asset Account #"
 Label14.Caption = ""
 Label10.Visible = True
End Sub

Private Sub ComboBox2_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label10.Visible = False
ComboBox2.Width = 306
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub ComboBox3_Click()
Dim EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ComboBox3.Width = 60
Label15.Caption = ""
CostAcctNo = ComboBox3.Text
FullNo = Len(CostAcctNo)
EndNo = 1
Do While Mid(CostAcctNo, EndNo, 1) <> " " And EndNo <= FullNo
EndNo = EndNo + 1
Loop
If FullNo > 6 Then Label15.Caption = Right(CostAcctNo, FullNo - 6)
Label15.Visible = True
CostAcctNo = Left(CostAcctNo, EndNo - 1)
ComboBox3.Text = CostAcctNo
End Sub

Private Sub ComboBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim I As Long, J As Long, TempInput As String, EndNo As Long, FullNo As Long
Application.EnableCancelKey = xlDisabled
  ListBox1.Visible = False
  ListBox2.Visible = False
  ComboBox3.Width = 60
 If ComboBox3.Text = "" Then
  Label15.Caption = ""
  Exit Sub
 End If
I = ComboBox3.ListCount
J = 0
TempInput = ComboBox3.Text
Do While J < I
 If TempInput = Left(ComboBox3.List(J), Len(TempInput)) Then
   TempInput = ComboBox3.List(J)
   FullNo = Len(TempInput)
   EndNo = 1
   Do While Mid(TempInput, EndNo, 1) <> " " And EndNo <= FullNo
    EndNo = EndNo + 1
   Loop
   TempInput = Left(TempInput, EndNo - 1)
   ComboBox3.Text = TempInput
   Label15.Caption = Right(ComboBox3.List(J), Len(ComboBox3.List(J)) - 6)
  Exit Sub
 End If
  J = J + 1
Loop
 Label10.Caption = Chr(13) & "    Incorrect Cost Account #"
 Label15.Caption = ""
 Label10.Visible = True
End Sub

Private Sub ComboBox3_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Label10.Visible = False
ComboBox3.Width = 306
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE" Then
  Unload Me
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
  Userform6.ListBox2.Clear
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  Userform6.ListBox2.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   Userform6.ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  Userform6.ListBox2.AddItem "No Registered Product"
 End If
   Userform6.ListBox2.AddItem "CLOSE this box"
  Userform6.Show
Else
 Unload Me
   Application.ScreenUpdating = True
   Application.ScreenUpdating = False
 UserForm8.Show
End If
End Sub

Private Sub CommandButton2_Click()
Dim EndNo As Long, ProdCode As String, ProdRow As Long, COARange As Range, I As Long, ProdDes As String
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
ListBox1.Visible = False
ListBox2.Visible = False
Label10.Visible = False
ProdCode = TextBox1.Text
If ProdCode = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Product #"
 Label10.Visible = True
 GoTo NoDelete
End If
If TextBox2.Text = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Product Description"
 Label10.Visible = True
 GoTo NoDelete
End If
If ComboBox1.Value = "" Or Label13.Caption = "" Then
 Label10.Caption = Chr(13) & "    Please enter the Sales Account #"
 Label10.Visible = True
 GoTo NoDelete
End If
If OptionButton1.Value = True Then
 If TextBox5.Text = "" Then
  Label10.Caption = Chr(13) & "    Please enter the Stock # "
  Label10.Visible = True
  GoTo NoDelete
 Else
  StockNo = TextBox5.Text
 End If
 If ComboBox2.Value = "" Or Label14.Caption = "" Then
  Label10.Caption = Chr(13) & "    Please enter the Asset Account #"
  Label10.Visible = True
  GoTo NoDelete
 End If
 If ComboBox3.Value = "" Or Label15.Caption = "" Then
  Label10.Caption = Chr(13) & "    Please enter the Cost of Good Sold Account #"
  Label10.Visible = True
  GoTo NoDelete
 End If
End If
If IsNumeric(TextBox3.Text) = False Then
 Label10.Caption = Chr(13) & "    Incorrect Unit Price entered"
 Label10.Visible = True
 GoTo NoDelete
End If
SaleAcctNo = ComboBox1.Value
If Left(SaleAcctNo, 1) <> 4 And Left(SaleAcctNo, 1) <> 8 Then
 Label10.Caption = Chr(13) & "    Incorrect Sales Account #"
 Label10.Visible = True
 GoTo NoDelete
End If
MyBook.Worksheets("Chart of Account").Activate
Range("A10").Select
Do While ActiveCell.Value <= SaleAcctNo And ActiveCell.Value <> ""
 If ActiveCell.Value = SaleAcctNo Then GoTo SaleAccountOK
 ActiveCell.Offset(1, 0).Select
Loop
 Label10.Caption = Chr(13) & "    Incorrect Sales Account #"
 Label10.Visible = True
 GoTo NoDelete
SaleAccountOK:
If OptionButton1.Value = True Then
 AssetAcctNo = ComboBox2.Value
 If Left(AssetAcctNo, 1) <> 1 Then
  Label10.Caption = Chr(13) & "    Incorrect Asset Account #"
  Label10.Visible = True
  GoTo NoDelete
 End If
 MyBook.Worksheets("Chart of Account").Activate
 Range("A10").Select
 Do While ActiveCell.Value <= AssetAcctNo And ActiveCell.Value <> ""
  If ActiveCell.Value = AssetAcctNo Then GoTo AssetAccountOK
  ActiveCell.Offset(1, 0).Select
 Loop
 Label10.Caption = Chr(13) & "    Incorrect Asset Account #"
 Label10.Visible = True
 GoTo NoDelete
AssetAccountOK:
 CostAcctNo = ComboBox3.Value
 If Left(CostAcctNo, 1) <> 5 And Left(CostAcctNo, 1) <> 6 And Left(CostAcctNo, 1) <> 7 And Left(CostAcctNo, 1) <> 9 Then
  Label10.Caption = Chr(13) & "    Incorrect Cost Account #"
  Label10.Visible = True
  GoTo NoDelete
 End If
 MyBook.Worksheets("Chart of Account").Activate
 Range("A10").Select
 Do While ActiveCell.Value <= CostAcctNo And ActiveCell.Value <> ""
  If ActiveCell.Value = CostAcctNo Then GoTo AccountOK
  ActiveCell.Offset(1, 0).Select
 Loop
 Label10.Caption = Chr(13) & "    Incorrect Cost Account #"
 Label10.Visible = True
 GoTo NoDelete
End If
AccountOK:
If IsError(Application.Match(ProdCode, MyBook.Worksheets("Product Data").Range("B:B"), 0)) Then
  MyBook.Worksheets("Product Data").Activate
  Range("B2").Select
  If ActiveCell.Offset(1, 0).Value = "" Then
    Range("B3").Select
  Else
    ActiveCell.End(xlDown).Select
    ActiveCell.Offset(1, 0).Select
  End If
ElseIf ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Or ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE" Then
  Label10.Caption = Chr(13) & "    Change to existing Product detail is not allowed.  " & Chr(13) & "    Only new products can be added while Invoice or Sales Order is being processed.   "
  Label10.Visible = True
  GoTo NoDelete
Else
  ProdRow = Application.Match(ProdCode, MyBook.Worksheets("Product Data").Range("B:B"), 0)
  MyBook.Worksheets("Product Data").Activate
  Cells(ProdRow, 2).Select
AskReply:
    MSG = "The Product data was changed. Record will be updated." + Chr(13) + _
     Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataRemoval
     If C = "N" Or C = "n" Or C = "" Then GoTo NoDelete
    GoTo AskReply
DataRemoval:
End If
   ActiveCell.NumberFormat = "@"
   ActiveCell.Value = ProdCode
   ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
   ActiveCell.Offset(0, -1).Value = Date
   ActiveCell.Offset(0, 1).NumberFormat = "@"
   ActiveCell.Offset(0, 1).Value = TextBox2.Text
   ActiveCell.Offset(0, 2).NumberFormat = "General"
   ActiveCell.Offset(0, 2).Value = TextBox3.Text
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = SaleAcctNo
   ActiveCell.Offset(0, 4).NumberFormat = "General"
   ActiveCell.Offset(0, 6).NumberFormat = "General"
   ActiveCell.Offset(0, 7).NumberFormat = "@"
   If OptionButton1.Value = True Then
    ActiveCell.Offset(0, 6).Value = AssetAcctNo
    ActiveCell.Offset(0, 4).Value = CostAcctNo
    ActiveCell.Offset(0, 5).Value = "Yes"
    ActiveCell.Offset(0, 7).Value = TextBox5.Text
   Else
    ActiveCell.Offset(0, 4).ClearContents
    ActiveCell.Offset(0, 5).ClearContents
    ActiveCell.Offset(0, 6).ClearContents
    ActiveCell.Offset(0, 7).ClearContents
   End If
    SaleAcctCK = ActiveCell.Offset(0, 3).Value
    AssetAcctCK = ActiveCell.Offset(0, 6).Value
    CostAcctCK = ActiveCell.Offset(0, 4).Value
 If OptionButton1.Value <> True Then GoTo NoStockUpdate
 If StockNoExist = "Yes" And StockAssetAcct <> "" And StockCostAcct = CostAcctNo Then GoTo NoStockUpdate
  MyBook.Worksheets("StockRec").Activate
 If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
     MyBook.Worksheets("StockRec").Activate
     If Range("B2").Value = "" Then
       Range("B2").Select
     Else
       Range("B1").End(xlDown).Select
       ActiveCell.Offset(1, 0).Select
     End If
   ActiveCell.NumberFormat = "@"
   ActiveCell.Value = StockNo
   ActiveCell.Offset(0, -1).NumberFormat = "yyyy/mm/dd"
   ActiveCell.Offset(0, -1).Value = Date
   ActiveCell.Offset(0, 1).NumberFormat = "@"
   ActiveCell.Offset(0, 1).Value = TextBox2.Text
   ActiveCell.Offset(0, 2).NumberFormat = "General"
   ActiveCell.Offset(0, 2).Value = SaleAcctNo
   ActiveCell.Offset(0, 3).NumberFormat = "General"
   ActiveCell.Offset(0, 4).NumberFormat = "General"
   ActiveCell.Offset(0, 3).Value = AssetAcctNo
   ActiveCell.Offset(0, 4).Value = CostAcctNo
   ActiveCell.Offset(0, 6).NumberFormat = "General"
   ActiveCell.Offset(0, 7).NumberFormat = "General"
   ActiveCell.Offset(0, 8).NumberFormat = "General"
   ProdDes = TextBox2.Text
   Call InvStockAdd(AssetAcctNo, ProdDes)
 Else
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
   Cells(I, 2).Select
   ActiveCell.Offset(0, 4).NumberFormat = "General"
   ActiveCell.Offset(0, 4).Value = CostAcctNo
   StockCostAcct = CostAcctNo
 End If
 If StockNoExist <> "Yes" Then
   ListBox2.Clear
   MyBook.Worksheets("StockRec").Activate
   If Range("B2") <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B2").Select
    ListBox2.AddItem "SWITCH to listing by Stock Item Description"
    Do While ActiveCell.Value <> ""
     ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
    ActiveCell.Offset(1, 0).Select
    Loop
   Else
    ListBox2.AddItem "No Record of Stock Item"
   End If
   ListBox2.AddItem "CLOSE this box"
 End If
NoStockUpdate:
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  If SaleAcctCK <> "" And IsError(Application.Match(SaleAcctCK, COARange, 0)) = False Then
   I = Application.Match(SaleAcctCK, COARange, 0) + 9
   Worksheets("Chart of Account").Cells(I, 7).Value = "Y"
  End If
  If AssetAcctCK <> "" And IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
    Worksheets("Chart of Account").Cells(I, 7).Value = "Y"
  End If
  If CostAcctCK <> "" And IsError(Application.Match(CostAcctCK, COARange, 0)) = False Then
   I = Application.Match(CostAcctCK, COARange, 0) + 9
    Worksheets("Chart of Account").Cells(I, 7).Value = "Y"
  End If
ListBox1.Clear
MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Registered Product"
 End If
ListBox1.AddItem "CLOSE this box"
 If OptionButton2.Value = True Then
    MyBook.Worksheets("Product Data").Range("A1") = "Service"
 Else
    MyBook.Worksheets("Product Data").Range("A1").ClearContents
 End If
For I = 1 To 5
 Controls("TextBox" & I).Text = ""
Next I
Label10.Visible = False
Label7.Visible = False
Label8.Visible = False
Label11.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
 StockNo = ""
 StockNoExist = ""
 StockAssetAcct = ""
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
NoDelete:
EventOff = False
End Sub

Private Sub CommandButton3_Click()
Application.EnableCancelKey = xlDisabled
EventOff = True
ListBox1.Visible = False
ListBox2.Visible = False
For I = 1 To 5
 Controls("TextBox" & I).Text = ""
Next I
Label10.Visible = False
Label7.Visible = False
Label8.Visible = False
Label11.Visible = False
 StockNo = ""
 StockNoExist = ""
 StockAssetAcct = ""
 StockCostAcct = ""
If OptionButton1.Value = True Then
  Label19.Visible = True
  Label20.Visible = True
  Label21.Visible = True
  TextBox5.Visible = True
  CommandButton8.Visible = True
  Label5.Visible = True
  ComboBox1.Visible = True
  Label13.Visible = True
  Label6.Visible = True
  Label14.Visible = True
  ComboBox2.Visible = True
  Label12.Visible = True
  Label15.Visible = True
  ComboBox3.Visible = True
Else
  Label5.Visible = True
  ComboBox1.Visible = True
  Label13.Visible = True
  Label19.Visible = False
  Label20.Visible = False
  Label21.Visible = False
  TextBox5.Visible = False
  CommandButton8.Visible = False
  Label6.Visible = False
  Label14.Visible = False
  ComboBox2.Visible = False
  Label12.Visible = False
  Label15.Visible = False
  ComboBox3.Visible = False
  Label7.Visible = False
  Label8.Visible = False
  TextBox5.Text = ""
End If
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  CommandButton2.Visible = False
 Else
  CommandButton2.Visible = True
 End If
 EventOff = False
End Sub

Private Sub CommandButton4_Click()
Dim EndNo As Long, ProdCode As String, ProdRow As Long, COARange As Range, I As Long
Dim Tbl As Range, CheckRange As Range
Application.EnableCancelKey = xlDisabled
EventOff = True
ListBox1.Visible = False
ListBox2.Visible = False
ProdCode = TextBox1.Text
If TextBox1.Text = "" Then
 For I = 1 To 5
  Controls("TextBox" & I).Text = ""
 Next I
 Label10.Visible = False
 Label7.Visible = False
 Label8.Visible = False
 Label11.Visible = False
 ListBox1.Visible = False
 StockNo = ""
 StockNoExist = ""
 StockAssetAcct = ""
 StockCostAcct = ""
 EventOff = False
 Exit Sub
End If
If IsError(Application.Match(ProdCode, MyBook.Worksheets("Product Data").Range("B:B"), 0)) Then
  For I = 1 To 5
   Controls("TextBox" & I).Text = ""
  Next I
  Label10.Visible = False
  Label7.Visible = False
  Label8.Visible = False
  Label11.Visible = False
  ListBox1.Visible = False
 StockNo = ""
 StockNoExist = ""
 StockAssetAcct = ""
 StockCostAcct = ""
 EventOff = False
 Exit Sub
Else
   MyBook.Worksheets("ProInvoice").Activate
   If Range("B4").Value <> "" Then
    ActiveSheet.UsedRange.Select
    Set Tbl = Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, 1)
    For I = 35 To 188 Step 8
     Set CheckRange = Tbl.Offset(0, I)
    If IsError(Application.Match(ProdCode, CheckRange, 0)) = False Then
      Label10.Caption = Chr(13) & "     There are outstanding Sales Orders for the product # " & ProdCode & _
                     Chr(13) & "     Deletion of this product is not allowed"
      Label10.Visible = True
      GoTo NoDelete
    End If
    Next I
   End If
  ProdRow = Application.Match(ProdCode, MyBook.Worksheets("Product Data").Range("B:B"), 0)
AskReply:
    MSG = "The Product number will be deleted from the Record." + Chr(13) + _
     Chr(13) + "Enter 'Y' to confirm proceed."
    Title = "ALERT"
     C = InputBox(MSG, Title)
     If C = "Y" Or C = "y" Then GoTo DataRemoval
     If C = "N" Or C = "n" Or C = "" Then GoTo NoDelete
    GoTo AskReply
DataRemoval:
  MyBook.Worksheets("Product Data").Activate
  Cells(ProdRow, 2).EntireRow.Delete
End If
 ListBox1.Clear
 MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to sorted by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Registered Product"
 End If
 ListBox1.AddItem "CLOSE this box"
 For I = 1 To 5
   Controls("TextBox" & I).Text = ""
  Next I
  Label10.Visible = False
  Label7.Visible = False
  Label8.Visible = False
  Label11.Visible = False
  ListBox1.Visible = False
 StockNo = ""
 StockNoExist = ""
 StockAssetAcct = ""
 StockCostAcct = ""
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
NoDelete:
EventOff = False
End Sub

Private Sub CommandButton5_Click()
 Label10.Visible = False
 ListBox1.Visible = True
 ListBox2.Visible = False
End Sub

Private Sub CommandButton6_Click()
Dim I As Long
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 Label10.BackColor = &H40C0&
 Label10.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label10.Visible = True
 DoEvents
 ListBox1.Visible = False
 ListBox2.Visible = False
 Application.ScreenUpdating = False
 Application.EnableEvents = False
 Application.DisplayAlerts = False
 ThisWorkbook.Activate
    Sheets("Report").Visible = xlSheetVisible
    Sheets("Report").Delete
    Sheets.Add After:=Worksheets("RunningDat")
    ActiveSheet.Name = "Report"
 Application.DisplayAlerts = True
 SheetName = "Report"
Application.EnableEvents = True
Columns("A:H").Select
With Selection.Font
   .Name = "Arial"
   .FontStyle = "Regular"
   .Size = 12
End With
Columns("A:B").NumberFormat = "@"
Columns("C").NumberFormat = "#,##0.0000##"
Columns("D:G").NumberFormat = "@"
Columns("A").HorizontalAlignment = xlLeft
Columns("B").HorizontalAlignment = xlLeft
Columns("C").HorizontalAlignment = xlRight
Columns("D:H").HorizontalAlignment = xlCenter
Columns("A").ColumnWidth = 20
Columns("B").ColumnWidth = 42
Columns("C:G").ColumnWidth = 13
Columns("H").ColumnWidth = 20
If MyBook.Worksheets("Product Data").Range("B3") = "" Then GoTo Finish
MyBook.Worksheets("Product Data").Activate
Set Tbl = ActiveSheet.UsedRange
  Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
    False, Orientation:=xlTopToBottom
 I = Selection.Rows.Count
 Range(Cells(3, 2), Cells(I + 2, 9)).Copy
ThisWorkbook.Worksheets("Report").Activate
Range("A8").Select
  Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
Finish:
Range("A1:A2").HorizontalAlignment = xlLeft
Range("A1") = MyBook.Worksheets("ComData").Range("B2").Value
Range("A2") = "Product Listing ----- Printed on " & Format(Date, "yyyy/mm/dd")
If Range("A8").Value = "" Then Range("B8").Value = " No Product Data in the record"
Range("A6").Value = " Product #"
Range("A7").Value = "----------------------"
Range("B6").Value = " Product Description"
Range("B7").Value = "------------------------------------------------------------------"
Range("C5").Value = " Unit Price"
Range("C6").Value = " (" & SysCurrency & ")"
Range("C7").Value = "-------------------"
Range("D5").Value = " Linked "
Range("D6").Value = " Sales Acct #"
Range("D7").Value = "------------------"
Range("E5").Value = " Linked "
Range("E6").Value = " Cost Acct # "
Range("E7").Value = "------------------"
Range("F6").Value = " Stock Item "
Range("F7").Value = "------------------"
Range("G5").Value = " Linked "
Range("G6").Value = " Asset Acct #"
Range("G7").Value = "--------------------"
Range("H5").Value = " Linked "
Range("H6").Value = " Stock #"
Range("H7").Value = "----------------------"
    Range("A1:H19").Select
    ActiveWindow.Zoom = True
    ActiveWindow.DisplayGridlines = False
     Range("C2").Select
    On Error GoTo NoPrinter
     With ActiveSheet.PageSetup
        .Orientation = xlPortrait
        .PrintTitleRows = "$1:$7"
        .LeftMargin = Application.InchesToPoints(0.72)
        .RightMargin = Application.InchesToPoints(0.55)
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
     End With
NoPrinter:
 Label10.BackColor = &HC0&
 Label10.Visible = False
 Unload Me
  Application.EnableEvents = False
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Then
  Userform6.ListBox2.Clear
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  Userform6.ListBox2.AddItem "SWITCH to sorted by Product Description"
  Do While ActiveCell.Value <> ""
   Userform6.ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  Userform6.ListBox2.AddItem "No Registered Product"
 End If
   Userform6.ListBox2.AddItem "CLOSE this box"
 OldForm = "UserForm6"
Else
 OldForm = "UserForm8"
End If
ThisWorkbook.Worksheets("Report").Visible = xlSheetVisible
SheetName = "Report"
ThisWorkbook.Worksheets("System Menu").Visible = xlSheetVeryHidden
MyBook.Activate
ThisWorkbook.Worksheets("Report").Activate
 Application.EnableEvents = True
End Sub

Private Sub CommandButton8_Click()
 ListBox2.Visible = True
 ListBox1.Visible = False
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, I As Long
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 GoTo Finish
End If
If ListBox1.Text = "No Registered Product" Then
 ListBox1.Visible = False
 GoTo Finish
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Product Description" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B3").Select
    ListBox1.AddItem "SWITCH to listing by Product #"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Registered Product"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Product #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("B3").Select
    ListBox1.AddItem "SWITCH to listing by Product Description"
   Do While ActiveCell.Value <> ""
     ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
     ActiveCell.Offset(1, 0).Select
   Loop
  Else
   ListBox1.AddItem "No Registered Product"
  End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
RowNo = ListBox1.ListIndex + 2
EventOff = True
MyBook.Worksheets("Product Data").Activate
Cells(RowNo, 2).Select
TextBox1.Text = ActiveCell.Value
  ProdCode = TextBox1.Text
  TextBox2.Text = ActiveCell.Offset(0, 1).Value
  TextBox3.Text = Format(ActiveCell.Offset(0, 2).Value, "#,##0.00##################")
  ComboBox1.Value = ActiveCell.Offset(0, 3).Value
  Label11.Caption = " Last Update : " & Format(ActiveCell.Offset(0, -1).Value, "yyyy/mm/dd")
  Label11.Visible = True
    SaleAcctNo = ActiveCell.Offset(0, 3).Value
    SaleAcctCK = ActiveCell.Offset(0, 3).Value
  If ActiveCell.Offset(0, 5).Value = "Yes" Then
     CostAcctNo = ActiveCell.Offset(0, 4).Value
     CostAcctCK = ActiveCell.Offset(0, 4).Value
    ComboBox3.Value = ActiveCell.Offset(0, 4).Value
    StockNo = ActiveCell.Offset(0, 7).Value
    TextBox5.Text = StockNo
    OptionButton1.Value = True
  Else
    StockNo = ""
    OptionButton2.Value = True
  End If
  If StockNo = "" Or IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
   StockNoExist = ""
   StockAssetAcct = ""
   StockCostAcct = ""
   Label7.Visible = False
   Label8.Visible = False
   GoTo AddAcctName
  Else
   MyBook.Worksheets("StockRec").Activate
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
   StockNoExist = "Yes"
   StockAssetAcct = Cells(I, 5).Value
   AssetAcctNo = Cells(I, 5).Value
   AssetAcctCK = Cells(I, 5).Value
   StockCostAcct = Cells(I, 6).Value
   Label7.Visible = True
   Label8.Caption = Cells(I, 8).Value
   If Label8.Caption = "" Then Label8.Caption = "0"
   Label8.Visible = True
   TextBox4.Text = Cells(I, 11).Value
  End If
AddAcctName:
   ComboBox1.Value = SaleAcctNo
   ComboBox2.Value = StockAssetAcct
   ComboBox3.Value = CostAcctNo
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
   Label13.Caption = ""
  If SaleAcctCK <> "" Then
   If IsError(Application.Match(SaleAcctCK, COARange, 0)) = False Then
     I = Application.Match(SaleAcctCK, COARange, 0) + 9
     Label13.Caption = Worksheets("Chart of Account").Cells(I, 2)
   End If
  End If
  Label14.Caption = ""
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
   Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
  Label15.Caption = ""
 If CostAcctCK <> "" Then
  If IsError(Application.Match(CostAcctCK, COARange, 0)) = False Then
   I = Application.Match(CostAcctCK, COARange, 0) + 9
   Label15.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
Finish:
  ListBox1.Visible = False
If OptionButton1.Value = True Then
  Label19.Visible = True
  Label20.Visible = True
  Label21.Visible = True
  TextBox5.Visible = True
  CommandButton8.Visible = True
  Label5.Visible = True
  ComboBox1.Visible = True
  Label13.Visible = True
  Label6.Visible = True
  Label14.Visible = True
  ComboBox2.Visible = True
  Label12.Visible = True
  Label15.Visible = True
  ComboBox3.Visible = True
Else
  Label5.Visible = True
  ComboBox1.Visible = True
  Label13.Visible = True
  Label19.Visible = False
  Label20.Visible = False
  Label21.Visible = False
  TextBox5.Visible = False
  CommandButton8.Visible = False
  Label6.Visible = False
  Label14.Visible = False
  ComboBox2.Visible = False
  Label12.Visible = False
  Label15.Visible = False
  ComboBox3.Visible = False
  Label7.Visible = False
  Label8.Visible = False
  TextBox5.Text = ""
End If
  EventOff = False
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long, I As Long
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Or ListBox2.Text = "" Then
 ListBox2.Visible = False
 Exit Sub
End If
If ListBox2.Text = "No Record of Stock Item" Then
 ListBox2.Visible = False
 Exit Sub
End If
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Stock Item Description" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox2.AddItem "SWITCH to listing by Stock #"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Record of Stock Item"
 End If
  ListBox2.AddItem "CLOSE this box"
  ListBox2.Visible = True
  Exit Sub
End If
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Stock #" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox2.AddItem "SWITCH to listing by Stock Item Description"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Record of Stock Item"
 End If
  ListBox2.AddItem "CLOSE this box"
  ListBox2.Visible = True
  Exit Sub
End If
RowNo = ListBox2.ListIndex + 1
EventOff = True
MyBook.Worksheets("StockRec").Activate
 Cells(RowNo, 2).Select
  TextBox5.Value = ActiveCell.Value
  StockNo = TextBox5.Text
  StockNoExist = "Yes"
  StockAssetAcct = ActiveCell.Offset(0, 3).Value
  AssetAcctCK = ActiveCell.Offset(0, 3).Value
  StockCostAcct = ActiveCell.Offset(0, 4).Value
  ComboBox2.Value = StockAssetAcct
  If TextBox2.Text = "" Then TextBox2.Text = ActiveCell.Offset(0, 1).Value
  Label14 = ""
  Label7.Visible = True
  Label8.Caption = ActiveCell.Offset(0, 6).Value
  If Label8.Caption = "" Then Label8.Caption = "0"
  Label8.Visible = True
  TextBox4 = ActiveCell.Offset(0, 9).Value
 MyBook.Worksheets("Chart of Account").Activate
 Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  Label14.Caption = ""
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
   Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
 ListBox1.Visible = False
 ListBox2.Visible = False
 EventOff = False
End Sub

Private Sub OptionButton1_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
Label19.Visible = True
Label20.Visible = True
Label21.Visible = True
TextBox5.Visible = True
CommandButton8.Visible = True
  Label5.Visible = True
  ComboBox1.Visible = True
  Label13.Visible = True
  Label6.Visible = True
  Label14.Visible = True
  ComboBox2.Visible = True
  Label12.Visible = True
  Label15.Visible = True
  ComboBox3.Visible = True
 If ComboBox1.Value = "" Then Label13.Caption = ""
 If ComboBox2.Value = "" Then Label14.Caption = ""
 If ComboBox3.Value = "" Then Label15.Caption = ""
End Sub

Private Sub OptionButton2_Click()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
Label5.Visible = True
ComboBox1.Visible = True
Label13.Visible = True
Label19.Visible = False
Label20.Visible = False
Label21.Visible = False
TextBox5.Visible = False
CommandButton8.Visible = False
Label6.Visible = False
Label14.Visible = False
ComboBox2.Visible = False
Label12.Visible = False
Label15.Visible = False
ComboBox3.Visible = False
Label7.Visible = False
Label8.Visible = False
TextBox5.Text = ""
End Sub

Private Sub TextBox1_AfterUpdate()
Dim ProdCode As String, RowNo As Long, I As Long, J As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Label11.Visible = False
If TextBox1.Text = "" Then GoTo NoInput
ProdCode = TextBox1.Text
If Left(ProdCode, 1) = " " Then
 I = Len(ProdCode)
 J = 1
 Do While J <= I And Mid(ProdCode, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then GoTo NoInput
  ProdCode = Right(ProdCode, I - J + 1)
End If
If Right(ProdCode, 1) = " " Then
 I = Len(ProdCode)
 J = I
 Do While J > 0 And Mid(ProdCode, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then GoTo NoInput
  ProdCode = Left(ProdCode, J)
End If
ProdCode = UCase(ProdCode)
TextBox1.Text = ProdCode
  MyBook.Worksheets("Product Data").Activate
If IsError(Application.Match(ProdCode, MyBook.Worksheets("Product Data").Range("B:B"), 0)) = False Then
  RowNo = Application.Match(ProdCode, MyBook.Worksheets("Product Data").Range("B:B"), 0)
  Cells(RowNo, 2).Select
  TextBox2.Text = ActiveCell.Offset(0, 1).Value
  TextBox3.Text = Format(ActiveCell.Offset(0, 2).Value, "#,##0.00##################")
  ComboBox1.Value = ActiveCell.Offset(0, 3).Value
  Label11.Caption = " Last Update : " & Format(ActiveCell.Offset(0, -1).Value, "yyyy/mm/dd")
  Label11.Visible = True
    SaleAcctNo = ActiveCell.Offset(0, 3).Value
    SaleAcctCK = ActiveCell.Offset(0, 3).Value
  If ActiveCell.Offset(0, 5).Value = "Yes" Then
    CostAcctNo = ActiveCell.Offset(0, 4).Value
    CostAcctCK = ActiveCell.Offset(0, 4).Value
    ComboBox3.Value = ActiveCell.Offset(0, 4).Value
    StockNo = ActiveCell.Offset(0, 7).Value
    TextBox5.Text = StockNo
    OptionButton1.Value = True
  Else
    StockNo = ""
    OptionButton2.Value = True
  End If
  If StockNo = "" Or IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
   StockNoExist = ""
   StockAssetAcct = ""
   StockCostAcct = ""
   Label7.Visible = False
   Label8.Visible = False
   GoTo AddAcctName
  Else
   MyBook.Worksheets("StockRec").Activate
   I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
   StockNoExist = "Yes"
   StockAssetAcct = Cells(I, 5).Value
   AssetAcctCK = Cells(I, 5).Value
   AssetAcctNo = Cells(I, 5).Value
   StockCostAcct = Cells(I, 6).Value
   Label7.Visible = True
   Label8.Caption = Cells(I, 8).Value
   If Label8.Caption = "" Then Label8.Caption = "0"
   Label8.Visible = True
   TextBox4.Text = Cells(I, 11).Value
   ComboBox2.Value = StockAssetAcct
  End If
AddAcctName:
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
   Label13.Caption = ""
  If SaleAcctCK <> "" Then
   If IsError(Application.Match(SaleAcctCK, COARange, 0)) = False Then
     I = Application.Match(SaleAcctCK, COARange, 0) + 9
    Label13.Caption = Worksheets("Chart of Account").Cells(I, 2)
   End If
  End If
   Label14.Caption = ""
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
   I = Application.Match(AssetAcctCK, COARange, 0) + 9
   Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
   Label15.Caption = ""
 If CostAcctCK <> "" Then
  If IsError(Application.Match(CostAcctCK, COARange, 0)) = False Then
   I = Application.Match(CostAcctCK, COARange, 0) + 9
   Label15.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
ElseIf OptionButton2.Value = True Then
  StockNo = ""
  StockNoExist = ""
  StockAssetAcct = ""
  StockCostAcct = ""
  TextBox5.Text = ""
  Label7.Visible = False
  Label8.Visible = False
  Label11.Visible = False
  EventOff = False
  Exit Sub
ElseIf TextBox5.Text = "" Then
  StockNo = ProdCode
  StockNoExist = ""
  StockAssetAcct = ""
  StockCostAcct = ""
  TextBox5.Text = StockNo
  Label7.Visible = False
  Label8.Visible = False
  Label11.Visible = False
  OptionButton1.Value = True
 MyBook.Worksheets("StockRec").Activate
 If Range("B2").Value = "" Then
  StockNoExist = ""
  StockAssetAcct = ""
  StockCostAcct = ""
  EventOff = False
  Exit Sub
 End If
 If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
  StockNoExist = ""
  StockAssetAcct = ""
  StockCostAcct = ""
  Label7.Visible = False
  Label8.Visible = False
  EventOff = False
  Exit Sub
 Else
  I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
  StockNoExist = "Yes"
  StockAssetAcct = Cells(I, 5).Value
  AssetAcctCK = Cells(I, 5).Value
  StockCostAcct = Cells(I, 6).Value
  Label7.Visible = True
  Label8.Caption = Cells(I, 8).Value
  If Label8.Caption = "" Then Label8.Caption = "0"
  Label8.Visible = True
  ComboBox2.Value = StockAssetAcct
  Label14.Caption = ""
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
   Label14.Caption = ""
  If AssetAcctCK <> "" Then
   If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
    I = Application.Match(AssetAcctCK, COARange, 0) + 9
    Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
   End If
  End If
 End If
End If
EventOff = False
Exit Sub
NoInput:
  TextBox1.Text = ""
  ProdCode = ""
 For I = 1 To 5
  Controls("TextBox" & I).Text = ""
 Next I
 Label10.Visible = False
 Label7.Visible = False
 Label8.Visible = False
 Label11.Visible = False
 ListBox1.Visible = False
 Label7.Visible = False
 Label8.Visible = False
  StockNo = ""
  StockNoExist = ""
  StockAssetAcct = ""
  StockCostAcct = ""
  EventOff = False
End Sub

Private Sub TextBox1_Change()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
End Sub

Private Sub TextBox1_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
CommandButton8.Visible = False
Label12.Visible = False
ComboBox3.Visible = False
Label15.Visible = False
Label6.Visible = False
ComboBox2.Visible = False
Label14.Visible = False
CommandButton2.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If OptionButton1.Value = True Then
  Label19.Visible = True
  Label20.Visible = True
  Label21.Visible = True
  TextBox5.Visible = True
  CommandButton8.Visible = True
  Label5.Visible = True
  ComboBox1.Visible = True
  Label13.Visible = True
  Label6.Visible = True
  Label14.Visible = True
  ComboBox2.Visible = True
  Label12.Visible = True
  Label15.Visible = True
  ComboBox3.Visible = True
Else
  Label5.Visible = True
  ComboBox1.Visible = True
  Label13.Visible = True
  Label19.Visible = False
  Label20.Visible = False
  Label21.Visible = False
  TextBox5.Visible = False
  CommandButton8.Visible = False
  Label6.Visible = False
  Label14.Visible = False
  ComboBox2.Visible = False
  Label12.Visible = False
  Label15.Visible = False
  ComboBox3.Visible = False
  Label7.Visible = False
  Label8.Visible = False
  TextBox5.Text = ""
End If
 If FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  CommandButton2.Visible = False
 Else
  CommandButton2.Visible = True
 End If
End Sub

Private Sub TextBox2_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox3_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CheckNum As Double
Application.EnableCancelKey = xlDisabled
Label10.Visible = False
If TextBox3.Text = "" Then TextBox3.Text = 0
If IsNumeric(TextBox3.Text) = False Then
   Label10.Caption = Chr(13) & "   Wrong Unit Price entered !!! "
   Label10.Visible = True
Else
   CheckNum = TextBox3.Text
   TextBox3.Text = Format(CheckNum, "#,##0.00##################")
End If
End Sub

Private Sub TextBox4_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub TextBox5_AfterUpdate()
Dim I As Long
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
Label10.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
Label7.Visible = False
Label8.Visible = False
StockNo = UCase(TextBox5.Text)
TextBox5.Text = StockNo
If StockNo = "" Then
 StockNoExist = ""
 AssetAcctNo = ""
 StockAssetAcct = ""
 StockCostAcct = ""
 EventOff = False
 Exit Sub
End If
If Left(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = 1
 Do While J <= I And Mid(StockNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
   TextBox5.Text = ""
   StockNo = ""
   StockNoExist = ""
   StockAssetAcct = ""
   StockCostAcct = ""
   EventOff = False
   Exit Sub
  End If
  StockNo = Right(StockNo, I - J + 1)
End If
If Right(StockNo, 1) = " " Then
 I = Len(StockNo)
 J = I
 Do While J > 0 And Mid(StockNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
   TextBox5.Text = ""
   StockNo = ""
   StockNoExist = ""
   StockAssetAcct = ""
   StockCostAcct = ""
   EventOff = False
   Exit Sub
  End If
  StockNo = Left(StockNo, J)
End If
StockNo = UCase(StockNo)
TextBox5.Text = StockNo
MyBook.Worksheets("StockRec").Activate
If Range("B2").Value = "" Then
 StockNoExist = ""
 AssetAcctNo = ""
 StockAssetAcct = ""
 StockCostAcct = ""
 EventOff = False
 Exit Sub
End If
If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) Then
 StockNoExist = ""
 AssetAcctNo = ""
 StockAssetAcct = ""
 StockCostAcct = ""
 Label7.Visible = False
 Label8.Visible = False
 EventOff = False
 Exit Sub
Else
 I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
 StockNoExist = "Yes"
 StockAssetAcct = Cells(I, 5).Value
 AssetAcctCK = Cells(I, 5).Value
 StockCostAcct = Cells(I, 6).Value
 CostAcctCK = Cells(I, 6).Value
  If TextBox2.Text = "" Then TextBox2.Text = Cells(I, 3).Value
  Label7.Visible = True
  Label8.Caption = Cells(I, 8).Value
  If Label8.Caption = "" Then Label8.Caption = "0"
  Label8.Visible = True
  ComboBox2.Value = StockAssetAcct
  Label14.Caption = ""
  MyBook.Worksheets("Chart of Account").Activate
  Set COARange = Range(Cells(10, 1), Cells(LastRowChartofAccount, 1))
  Label14.Caption = ""
 If AssetAcctCK <> "" Then
  If IsError(Application.Match(AssetAcctCK, COARange, 0)) = False Then
    I = Application.Match(AssetAcctCK, COARange, 0) + 9
    Label14.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
 If CostAcctCK <> "" Then
  ComboBox3.Value = StockCostAcct
  If IsError(Application.Match(CostAcctCK, COARange, 0)) = False Then
   I = Application.Match(CostAcctCK, COARange, 0) + 9
   Label15.Caption = Worksheets("Chart of Account").Cells(I, 2)
  End If
 End If
End If
EventOff = False
End Sub

Private Sub TextBox5_Enter()
ListBox1.Visible = False
ListBox2.Visible = False
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.Clear
MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
 ListBox1.AddItem "No Registered Product"
 End If
ListBox1.AddItem "CLOSE this box"
ListBox2.Clear
MyBook.Worksheets("StockRec").Activate
  If Range("B2") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 1, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B2").Select
  ListBox2.AddItem "SWITCH to listing by Stock Item Description"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Record of Stock Item"
 End If
ListBox2.AddItem "CLOSE this box"
ComboBox1.Clear
L = 10
M = LastRowChartofAccount
ThisWorkbook.Activate
For I = L To M
If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 4 Or Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 8 Then
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ----"
spacing = Left(spacing, 6 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ComboBox1.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
End If
Next I
ComboBox2.Clear
L = 10
M = LastRowChartofAccount
ThisWorkbook.Activate
For I = L To M
If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 1 Then
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ----"
spacing = Left(spacing, 6 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ComboBox2.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
End If
Next I
ComboBox3.Clear
L = 10
M = LastRowChartofAccount
ThisWorkbook.Activate
For I = L To M
If Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 5 Or Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 6 Or _
  Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 7 Or Left(Worksheets("Chart of Account").Cells(I, 1).Value, 1) = 9 Then
N = Len(Worksheets("Chart of Account").Cells(I, 1).Value)
spacing = " ----"
spacing = Left(spacing, 6 - N)
If Not (N < Len(Worksheets("Chart of Account").Cells(I + 1, 1)) Or N = 1) Then
 ComboBox3.AddItem Worksheets("Chart of Account").Cells(I, 1).Value & spacing & Worksheets("Chart of Account").Cells(I, 2).Value
End If
End If
Next I
Label3.Caption = "Unit Price (" & SysCurrency & ") : "
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 CommandButton2.Visible = False
 CommandButton3.Visible = False
 CommandButton4.Visible = False
End If
StockNoExist = ""
StockSaleAcct = ""
StockAssetAcct = ""
StockCostAcct = ""
If MyBook.Worksheets("Product Data").Range("A1").Value = "Service" Then
  OptionButton2.Value = True
End If
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
 Application.EnableEvents = False
  ThisWorkbook.Worksheets("System Menu").Activate
  SheetName = "System Menu"
  Application.EnableEvents = True
End Sub
Attribute VB_Name = "UserForm98"
Attribute VB_Base = "0{66E89147-AD65-4CDA-B192-3CE5CC1C0A9E}{30F4DA14-9944-4E64-B1D5-1DF29AE5B005}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public DuplicateCode As String, CodeAmended As Boolean, ExitStatus As Boolean, AbortChange As Boolean

Private Sub CommandButton1_Click()
Dim DuplicateDate As Date
Application.EnableCancelKey = xlDisabled
If ExitStatus = False Then
 ExitStatus = True
 Exit Sub
End If
If TextBox2.Text = "" Then
   Label3.Visible = True
   Label3.Caption = Chr(13) & "        Please enter Journal Code "
   DuplicateCode = ""
   Exit Sub
End If
If IsDate(TextBox1.Text) = False Then
   Label3.Visible = True
   Label3.Caption = Chr(13) & "        Wrong Date Entered !!!"
   Exit Sub
Else
 DuplicateDate = TextBox1.Text
 If DuplicateDate < BeginningDate Then
  Label3.Visible = True
  Label3.Caption = Chr(13) & "  Date cannot be earlier than the Beginning date of Accounting Year" & Chr(13) & _
             "  Please input the correct date.   "
  Exit Sub
 End If
End If
DuplicateCode = TextBox2.Text
ThisWorkbook.Worksheets("Data Entry").Range("C2").Value = Format(DuplicateDate, "yyyy/mm/dd")
ThisWorkbook.Worksheets("Data Entry").Range("C6").Value = DuplicateCode
AbortChange = False
Me.Hide
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
AbortChange = True
Me.Hide
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String, DuplicateDate As Date
If TextBox1.Text = "" Then Exit Sub
Application.EnableCancelKey = xlDisabled
DateString = TextBox1.Text
Call DateConvert(DateString)
If IsDate(DateString) = False Then
   Label3.Visible = True
   Label3.Caption = Chr(13) & "        Wrong Date Entered !!!"
Else
 DuplicateDate = DateString
 If DuplicateDate < BeginningDate Then
  Cancel = True
  TextBox1.Text = ""
  Label3.Visible = True
  Label3.Caption = Chr(13) & "  Date cannot be earlier than the Beginning date of Accounting Year" & Chr(13) & _
             "  Please input the correct date.   "
  Exit Sub
 Else
   TextBox1.Text = Format(DuplicateDate, "yyyy/mm/dd")
 End If
  If CodeAmended = False Then
   AccountYear = Int((Period(DuplicateDate) - BeginPeriod) / 12) + Year(BeginningDate)
   DuplicateCode = "JV" & AccountYear
   If DuplicateCode <> TextBox2.Text Then
    TextBox2.Text = DuplicateCode
    ExitStatus = False
   Else
    ExitStatus = True
   End If
  End If
 Label3.Visible = False
End If
End Sub
Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If TextBox2.Text = "" Then
   Label3.Visible = True
   Label3.Caption = Chr(13) & "        Please enter Journal Code "
   DuplicateCode = ""
   Exit Sub
End If
 TextBox2.Text = UCase(TextBox2.Text)
 DuplicateCode = TextBox2.Text
 CodeAmended = True
 ExitStatus = True
 Label3.Visible = False
End Sub
Private Sub UserForm_Activate()
If Date < BeginningDate Then
  TextBox1.Text = UCase(Format(BeginningDate, "yyyy/mm/dd"))
Else
  TextBox1.Text = UCase(Format(Date, "yyyy/mm/dd"))
End If
 DuplicateDate = TextBox1.Text
 AccountYear = Int((Period(DuplicateDate) - BeginPeriod) / 12) + Year(BeginningDate)
   DuplicateCode = "JV" & AccountYear
   TextBox2.Text = DuplicateCode
   ExitStatus = True
   CodeAmended = False
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub
Attribute VB_Name = "UserForm99"
Attribute VB_Base = "0{F21C792D-A928-4A48-96A9-783291B8BD9C}{6ED363A2-A8FA-4510-8852-7CB6069C445F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Public PassCode As String
Private Sub CommandButton1_Click()
 If PassCode = ThisWorkbook.Worksheets("ComFactSheet").Range("B8") Then
  Worksheets("Activity Report").Range("D6").ClearContents
  AuthorStatus = True
  Unload Me
 Else
  TextBox1.Text = ""
  PassCode = ""
  Label3.Caption = Chr(13) & "  Wrong Password !!    " & Chr(13) & "  Please enter the password again"
  Label3.Visible = True
 End If
End Sub
Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
Unload Me
End Sub
Private Sub TextBox1_Change()
Dim I As Long, J As Long, K As Long, TempInput As String, TempCode
 Label3.Visible = False
I = Len(TextBox1.Text)
J = Len(PassCode)
If I = 0 Then
 PassCode = ""
 Exit Sub
ElseIf I <= J Then
  PassCode = Left(PassCode, J)
Else
 PassCode = PassCode & Right(TextBox1.Text, 1)
End If
 If I < 20 Then
  TextBox1.Text = Left("*********************", I)
 Else
  J = 20
  TempInput = "********************"
  Do While J < I
   TempInput = TempInput & "*"
  Loop
  TextBox1.Text = TempInput
 End If
End Sub
Private Sub UserForm_Initialize()
Dim M As Long, N As Long, spacing As String, AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
TextBox1.Text = ""
PassCode = ""
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub
Attribute VB_Name = "Userform18"
Attribute VB_Base = "0{6324912E-CBE5-4348-93C9-908E93321046}{5EBC9149-D82B-426F-B46A-CB9D9699172C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
Application.EnableCancelKey = xlDisabled
 Label4.BackColor = &H40C0&
 Label4.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label4.Visible = True
 DoEvents
Me.Hide
End Sub

Private Sub CommandButton2_Click()
Application.EnableCancelKey = xlDisabled
ThisWorkbook.Worksheets("Activity Report").Range("D6").Value = "Cancel"
Unload Me
End Sub

Private Sub TextBox1_Change()
 Label4.Visible = False
End Sub

Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InputNo As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
InputNo = UCase(TextBox1.Text)
If Left(InputNo, 1) = " " Then
 I = Len(InputNo)
 J = 1
 Do While J <= I And Mid(InputNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InputNo = ""
    GoTo InputChecked
  Else
   InputNo = Right(InputNo, I - J + 1)
  End If
End If
If Right(InputNo, 1) = " " Then
 I = Len(InputNo)
 J = I
 Do While J > 0 And Mid(InputNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InputNo = ""
    GoTo InputChecked
  Else
   InputNo = Left(InputNo, J)
  End If
End If
InputChecked:
If InputNo = "" Then InputNo = "0"
If Label1.Caption = "Beginning Credit Note # : " Then
 TextBox1.Text = Right("00000" & InputNo, 5)
 If IsNumeric(TextBox1.Value) = False Then
  Label4.Caption = Chr(13) & "     Beginning Credit note # is Not a valid Credit Note # "
  Label4.Visible = True
  Exit Sub
 End If
ElseIf Label1.Caption = "Beginning Receipt # : " Then
 TextBox1.Text = Right("00000" & InputNo, 5)
 If IsNumeric(TextBox1.Value) = False Then
  Label4.Caption = Chr(13) & "     Beginning Receipt # is Not a valid Receipt # "
  Label4.Visible = True
  Exit Sub
 End If
ElseIf Label1.Caption = "Beginning Invoice # : " Then
 If IsNumeric(InputNo) Then
  If Len(InputNo) < 7 Then
    InputNo = Right(("000000" & InputNo), 6)
    Label5.Visible = True
    TextBox1.Left = 180
    TextBox1.Width = 90
  Else
   InputNo = InputNo & " "
   Label5.Visible = False
    TextBox1.Left = 156
    TextBox1.Width = 114
  End If
 ElseIf Len(InputNo) = 9 Then
   If Left(InputNo, 3) = "INV" Then
    If IsNumeric(Right(InputNo, 6)) Then
     InputNo = Right(InputNo, 6)
     Label5.Visible = True
     TextBox1.Left = 180
     TextBox1.Width = 90
    Else
     InputNo = InputNo & " "
     Label5.Visible = False
     TextBox1.Left = 156
     TextBox1.Width = 114
    End If
   Else
    InputNo = InputNo & " "
    Label5.Visible = False
    TextBox1.Left = 156
    TextBox1.Width = 114
   End If
 Else
  InputNo = InputNo & " "
   Label5.Visible = False
    TextBox1.Left = 156
    TextBox1.Width = 114
 End If
 TextBox1.Text = InputNo
ElseIf Label1.Caption = "Beginning PI # : " Then
 TextBox1.Text = Right("000000" & InputNo, 6)
 If IsNumeric(TextBox1.Value) = False Then
  Label4.Caption = Chr(13) & "     Beginning PI # is Not a valid PI # "
  Label4.Visible = True
  Exit Sub
 End If
ElseIf Label1.Caption = "Beginning PO # : " Then
  If IsNumeric(InputNo) Then
  If Len(InputNo) < 7 Then
    InputNo = "P" & Right(("000000" & InputNo), 6)
  Else
   InputNo = InputNo & " "
  End If
 ElseIf Len(InputNo) < 8 Then
   If Left(InputNo, 1) = "P" Then
    If IsNumeric(Right(InputNo, Len(InputNo) - 1)) Then
     InputNo = Right(InputNo, Len(InputNo) - 1)
     InputNo = "P" & Right("000000" & InputNo, 6)
    Else
     InputNo = InputNo & " "
    End If
   Else
    InputNo = InputNo & " "
   End If
 Else
  InputNo = InputNo & " "
 End If
 TextBox1.Text = InputNo
Else
 TextBox1.Text = Right("00000" & InputNo, 5)
 If IsNumeric(TextBox1.Value) = False Then
  Label4.Caption = Chr(13) & "     Beginning Debit Note # is Not a valid number "
  Label4.Visible = True
  Exit Sub
 End If
End If
End Sub

Private Sub TextBox2_Change()
Label4.Visible = False
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InputNo As String, I As Long, J As Long
Application.EnableCancelKey = xlDisabled
InputNo = UCase(TextBox2.Text)
If Left(InputNo, 1) = " " Then
 I = Len(InputNo)
 J = 1
 Do While J <= I And Mid(InputNo, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InputNo = ""
    GoTo InputChecked
  Else
   InputNo = Right(InputNo, I - J + 1)
  End If
End If
If Right(InputNo, 1) = " " Then
 I = Len(InputNo)
 J = I
 Do While J > 0 And Mid(InputNo, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InputNo = ""
    GoTo InputChecked
  Else
   InputNo = Left(InputNo, J)
  End If
End If
InputChecked:
If InputNo = "" Then InputNo = "0"
If Label1.Caption = "Beginning Credit Note # : " Then
  TextBox2.Text = Right("00000" & InputNo, 5)
  If IsNumeric(TextBox2.Value) = False Then
   Label4.Caption = Chr(13) & "     Ending Credit note # is Not a valid Credit Note # "
   Label4.Visible = True
   Exit Sub
  End If
ElseIf Label1.Caption = "Beginning Receipt # : " Then
 TextBox2.Text = Right("00000" & InputNo, 5)
  If IsNumeric(TextBox2.Value) = False Then
   Label4.Caption = Chr(13) & "     Ending Receipt # is Not a valid Receipt # "
   Label4.Visible = True
   Exit Sub
  End If
ElseIf Label1.Caption = "Beginning Invoice # : " Then
 If IsNumeric(InputNo) Then
  If Len(InputNo) < 7 Then
    InputNo = Right(("000000" & InputNo), 6)
    Label6.Visible = True
    TextBox2.Left = 180
    TextBox2.Width = 90
  Else
   InputNo = InputNo & " "
   Label6.Visible = False
    TextBox2.Left = 156
    TextBox2.Width = 114
  End If
 ElseIf Len(InputNo) = 9 Then
   If Left(InputNo, 3) = "INV" Then
    If IsNumeric(Right(InputNo, 6)) Then
     InputNo = Right(InputNo, 6)
     Label6.Visible = True
     TextBox2.Left = 180
     TextBox2.Width = 90
    Else
     InputNo = InputNo & " "
     Label6.Visible = False
     TextBox2.Left = 156
     TextBox2.Width = 114
    End If
   Else
    InputNo = InputNo & " "
    Label6.Visible = False
    TextBox2.Left = 156
    TextBox2.Width = 114
   End If
 Else
  InputNo = InputNo & " "
   Label6.Visible = False
    TextBox2.Left = 156
    TextBox2.Width = 114
 End If
 TextBox2.Text = InputNo
ElseIf Label1.Caption = "Beginning PI # : " Then
 TextBox2.Text = Right("000000" & InputNo, 6)
 If IsNumeric(TextBox2.Value) = False Then
  Label4.Caption = Chr(13) & "     Ending PI # is Not a valid PI # "
  Label4.Visible = True
  Exit Sub
 End If
ElseIf Label1.Caption = "Beginning PO # : " Then
 If IsNumeric(InputNo) Then
  If Len(InputNo) < 7 Then
    InputNo = "P" & Right(("000000" & InputNo), 6)
  Else
   InputNo = InputNo & " "
  End If
 ElseIf Len(InputNo) < 8 Then
   If Left(InputNo, 1) = "P" Then
    If IsNumeric(Right(InputNo, Len(InputNo) - 1)) Then
     InputNo = Right(InputNo, Len(InputNo) - 1)
     InputNo = "P" & Right("000000" & InputNo, 6)
    Else
     InputNo = InputNo & " "
    End If
   Else
    InputNo = InputNo & " "
   End If
 Else
  InputNo = InputNo & " "
 End If
 TextBox2.Text = InputNo
Else
  TextBox2.Text = Right("00000" & InputNo, 5)
 If IsNumeric(TextBox2.Value) = False Then
  Label4.Caption = Chr(13) & "     Ending Debit Note # is Not a valid number "
  Label4.Visible = True
  Exit Sub
 End If
End If
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = vbFormControlMenu Then Cancel = True
End Sub


Attribute VB_Name = "Userform6"
Attribute VB_Base = "0{88C35FAA-93E7-4DA5-9C5C-23B088E27F30}{A89F766E-7F17-41F2-BDC4-C6C80FE9411D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Public LabelAlert As Boolean, PINo As String, PIPartial As String, Instr1 As String, Instr2 As String, Instr3 As String
Private Sub CommandButton1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim FInvRow As Long, LInvRow As Long, I As Long, J As Long, AccountNo As String, SubTotal As Double, DisAccount As String
Dim AcctYear As Long, JournalCode As String, JournalRange As Range, JournalNum As String, TranNo As String, InvPrefix As String
Dim CNo As String, LineNo As Long, PartNotFound As String, OldData As Boolean, OldInvDate As Date, CheckRange As Range
Dim LowValueFlag As String, ZeroQtyFlag As String, InvRef As String
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
If LabelAlert = True And Label23.Visible = True Then
 LabelAlert = False
 Exit Sub
End If
If CommandButton1.Caption = "Edit" Then
   Label23.Visible = False
   LabelAlert = False
   EventOff = True
  CommandButton1.Caption = "Save"
  CommandButton13.Visible = True
 If Label1.Caption = "INVOICE " Then
   Label1.Caption = "INVOICE"
   CommandButton11.Visible = False
      CommandButton18.Visible = True
  ScrollBar1.Value = 2
  For I = 1 To 7
   Controls("Label" & I + 49).Visible = True
  Next I
  ScrollBar1.Value = 1
  Call Form6Update("")
 ElseIf Label1.Caption = "SALES ORDER " Then
   Label1.Caption = "SALES ORDER"
   PartNotFound = ""
   Call PIUpdate(PartNotFound)
   If PartNotFound = "Yes" Then _
      MsgBox ("WARNING : " & Chr(13) & " Some items are no longer on the Product List or Stock Item List" & _
         Chr(13) & Chr(13) & "Please setup the Product data otherwise convert this PI to Invoice may not be allowed")
   CommandButton11.Visible = False
   CommandButton16.Visible = True
   CommandButton18.Visible = True
 Else
   Label1.Caption = "CREDIT NOTE"
  Call CNUpdate("")
 End If
 Call Form6AmountRefresh("")
 TextBox4.SetFocus
 EventOff = False
 Exit Sub
End If
If CustNo = "" Or CustName = "" Then
 Label23.Caption = Chr(13) & "    Customer Number is incorrect.  Please enter correct data"
 Label23.Visible = True
 TextBox1.SetFocus
 Exit Sub
End If
If TextBox3.Text = "" Or IsDate(InvDate) = False Then
  Label23.Caption = Chr(13) & "    Please enter the Date"
  Label23.Visible = True
  TextBox3.SetFocus
 Exit Sub
End If
If Label1.Caption = "SALES ORDER" Then
   EventOff = True
   Call PISave(PINo)
   EventOff = False
   Exit Sub
End If
If InvNo = "" Then
 If Label1.Caption = "INVOICE" Then
  InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
  TextBox2.Text = InvNo
 Else
  InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1), 6)
  TextBox2.Text = InvNo
 End If
End If
OldData = False
If InvDate < BeginningDate Then
 If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
      MSG = "WARNING!!!" & Chr(13) & Chr(13) & "The date entered belongs to previous year" & Chr(13) & _
       "Thus, no posting to the Inventory and the General Ledger." & Chr(13) & Chr(13) _
        + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
      Title = "WARNING"
      C = InputBox(MSG, Title)
      If C = "Y" Or C = "y" Then
       OldData = True
       GoTo DateProceed
      End If
     If C = "N" Or C = "n" Or C = "" Then
       Label23.Caption = Chr(13) & "    Please enter a new Date. "
       Label23.Visible = True
       LabelAlert = True
       EventOff = False
       Exit Sub
     End If
      GoTo AskReply
 Else
     Label23.Caption = Chr(13) & "    Transaction with date belonging to previous Posted year is not allowed" & _
     Chr(13) & "    Please enter a new Date and then click 'Save' Button to proceed. "
     Label23.Visible = True
     EventOff = False
     Exit Sub
 End If
End If
DateProceed:
 EventOff = True
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("C123").Select
  I = 1
  Do While I < 21
   If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
   I = I + 1
  Loop
 If Range("C123").Value = "" Then
   Label23.Caption = Chr(13) & "     No Product was entered.   Please add products before proceed."
   Label23.Visible = True
   GoTo FormRefresh
 End If
If OldData <> True Then
  LowValueFlag = ""
  ZeroQtyFlag = ""
 If Label1.Caption = "INVOICE" Then
  Range("C123").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 10).Value <> "" And ActiveCell.Offset(0, 12).Value = "" Then
    If ActiveCell.Offset(0, 11).Value - ActiveCell.Offset(0, 3).Value < 0 Then
     Label23.Caption = Chr(13) & "    Insufficient Stock quantity for " & ActiveCell.Offset(0, 1).Value & Chr(13) _
                     & Chr(13) & "    Thus, this Invoice cannot be proceeded."
     Label23.Visible = True
     GoTo FormRefresh
    ElseIf ActiveCell.Offset(0, 13).Value - ActiveCell.Offset(0, 9).Value < 0 Then
      If LowValueFlag = "" Then
       LowValueFlag = ActiveCell.Offset(0, 10).Value
      Else
       LowValueFlag = LowValueFlag & "; " & ActiveCell.Offset(0, 10).Value
      End If
    ElseIf (ActiveCell.Offset(0, 11).Value - ActiveCell.Offset(0, 3).Value = 0) And (ActiveCell.Offset(0, 13).Value - ActiveCell.Offset(0, 9).Value) <> 0 Then
      If ZeroQtyFlag = "" Then
       ZeroQtyFlag = ActiveCell.Offset(0, 10).Value
      Else
       ZeroQtyFlag = ZeroQtyFlag & "; " & ActiveCell.Offset(0, 10).Value
      End If
    End If
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
   If LowValueFlag <> "" And ZeroQtyFlag <> "" Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Invoice CANNOT be proceeded because it will make the book value of some stock items negative.  " & _
   "Also, the stock qty of some stock items will become zero but the book value will not be zero.  ")
   GoTo FormRefresh
  ElseIf LowValueFlag <> "" Then
    MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Invoice CANNOT be proceeded because it will make the book value of " & LowValueFlag & " negative.  ")
    GoTo FormRefresh
  ElseIf ZeroQtyFlag <> "" Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Invoice CANNOT be proceeded because it will make the stock qty of " & ZeroQtyFlag & " zero. " & _
       "But the book value of these stock items not zero. ")
    GoTo FormRefresh
  End If
 ElseIf Label1.Caption = "CREDIT NOTE" Then
  Range("C123").Select
  Do While ActiveCell.Value <> ""
   If ActiveCell.Offset(0, 10).Value <> "" And ActiveCell.Offset(0, 12).Value = "" Then
    If ActiveCell.Offset(0, 11).Value + ActiveCell.Offset(0, 3).Value < 0 Then
     Label23.Caption = Chr(13) & "    Insufficient Stock quantity for " & ActiveCell.Offset(0, 1).Value & Chr(13) _
                     & Chr(13) & "    Thus, this Credit Note cannot be proceeded."
     Label23.Visible = True
     GoTo FormRefresh
    ElseIf ActiveCell.Offset(0, 13).Value + ActiveCell.Offset(0, 9).Value < 0 Then
      If LowValueFlag = "" Then
       LowValueFlag = ActiveCell.Offset(0, 10).Value
      Else
       LowValueFlag = LowValueFlag & "; " & ActiveCell.Offset(0, 10).Value
      End If
    ElseIf (ActiveCell.Offset(0, 11).Value + ActiveCell.Offset(0, 3).Value = 0) And (ActiveCell.Offset(0, 13).Value + ActiveCell.Offset(0, 9).Value) <> 0 Then
      If ZeroQtyFlag = "" Then
       ZeroQtyFlag = ActiveCell.Offset(0, 10).Value
      Else
       ZeroQtyFlag = ZeroQtyFlag & "; " & ActiveCell.Offset(0, 10).Value
      End If
    End If
   End If
   ActiveCell.Offset(1, 0).Select
  Loop
  If LowValueFlag <> "" And ZeroQtyFlag <> "" Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Credit Note CANNOT be proceeded because it will make the book value of some stock items negative.  " & _
   "Also, the stock qty of some stock items will become zero but the book value will not be zero.  ")
   GoTo FormRefresh
  ElseIf LowValueFlag <> "" Then
    MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Credit Note CANNOT be proceeded because it will make the book value of " & LowValueFlag & " negative.  ")
    GoTo FormRefresh
  ElseIf ZeroQtyFlag <> "" Then
   MsgBox ("WARNING" & Chr(13) & Chr(13) & "This Credit Note CANNOT be proceeded because it will make the stock qty of " & ZeroQtyFlag & " zero. " & _
       "But the book value of these stock items not zero. ")
    GoTo FormRefresh
  End If
 End If
End If
 Call Form6AmountRefresh("")
  InvPrefix = TextBox38.Text
 ThisWorkbook.Worksheets("TempRP").Activate
 Range("D1").NumberFormat = "yyyy/mm/dd"
 Range("D1").Value = InvDate
 Range("E1").NumberFormat = "General"
 Range("E1").Value = DebtorAcct
 Range("H1:I1").NumberFormat = "General"
 Range("J1").NumberFormat = "@"
 Range("J1").Value = "*"
 Range("K1").NumberFormat = "General"
 Range("M1:N1").NumberFormat = "yyyy/mm/dd"
 Range("N1").Value = DueDate
 Range("O1:AC1").NumberFormat = "@"
 Range("O1").Value = PayTerm
 Range("P1").Value = CustNo
 Range("Q1").Value = CustName
 Range("R1").Value = Address1
 Range("S1").Value = Address2
 Range("T1").Value = Address3
 Range("U1").Value = CustContact
 Range("V1").Value = TelNo
 Range("AB1").Value = CustPO
 Range("AC1").Value = SalesRep
 Range("AD1:AG1").NumberFormat = "General"
 Range("AE1").Value = DisAmount
 Range("AH1").NumberFormat = "@"
 Range("AH1").Value = InvPrefix
 Range("AG1").Value = DisRate
 Range("IT1:IV1").NumberFormat = "@"
 Range("IT1").Value = TextBox47.Text
 Range("IU1").Value = TextBox48.Text
 Range("IV1").Value = TextBox49.Text
 Range("B1").NumberFormat = "@"
If Label1.Caption = "INVOICE" Then
 Range("A1").Value = "INVOICE"
 Range("B1").Value = InvNo
 If TotalAmount >= 0 Then
   Range("H1").Value = Format(TotalAmount, "0.00")
 Else
   Range("I1").Value = Format(TotalAmount * (-1), "0.00")
 End If
 If Right(InvNo, 1) <> " " Then
   Range("G1").Value = "INV" & InvNo & " for " & CustName
 Else
   Range("G1").Value = "Invoice-" & InvNo & " for " & CustName
 End If
 Range("K1").Value = Format(TotalAmount, "0.00")
 Range("AF1").Value = Format(TotalAmount, "0.00")
 Range("W1").Value = DelName
 Range("X1").Value = DelAddress1
 Range("Y1").Value = DelAddress2
 Range("Z1").Value = DelAddress3
 Range("AA1").Value = DelContact
 I = 35
 J = 0
 Range("C123").Select
 Do While ActiveCell.Value <> ""
  Cells(1, I).NumberFormat = "General"
  Cells(1, I).Value = ActiveCell.Offset(0, 6).Value
  Cells(1, I + 1).NumberFormat = "@"
  Cells(1, I + 1).Value = ActiveCell.Offset(0, 1).Value
  Cells(1, I + 2).NumberFormat = "@"
  Cells(1, I + 2).Value = ActiveCell.Offset(0, 2).Value
  Range(Cells(1, I + 3), Cells(1, I + 6)).NumberFormat = "General"
  If ActiveCell.Offset(0, 3).Value = "" Then ActiveCell.Offset(0, 3).Value = 0
  Cells(1, I + 3).Value = ActiveCell.Offset(0, 3).Value
  Cells(1, I + 4).Value = ActiveCell.Offset(0, 4).Value
  Cells(1, I + 5).Value = ActiveCell.Offset(0, 5).Value
  Cells(1, I + 6).Value = ActiveCell.Offset(0, 9).Value
  Cells(1, I + 7).NumberFormat = "@"
  Cells(1, I + 7).Value = ActiveCell.Offset(0, 10).Value
  I = I + 8
  J = J + 1
 ActiveCell.Offset(1, 0).Select
 Loop
Else
 Range("A1").Value = "CREDIT NOTE"
 CNo = "CN" & InvNo
 Range("B1").Value = CNo
 If TotalAmount >= 0 Then
   Range("I1").Value = Format(TotalAmount, "0.00")
 Else
   Range("H1").Value = Format(TotalAmount * (-1), "0.00")
 End If
 Range("G1").Value = CNo & " for " & CustName
 Range("W1").Value = TextBox39.Text
If TotalAmount = 0 Then
 Range("K1").Value = Format(TotalAmount, "0.00")
 Range("AF1").Value = Format(TotalAmount, "0.00")
Else
 Range("K1").Value = Format(TotalAmount * (-1), "0.00")
 Range("AF1").Value = Format(TotalAmount * (-1), "0.00")
End If
 I = 35
 J = 0
 Range("C123").Select
 Do While ActiveCell.Value <> ""
  Cells(1, I).NumberFormat = "General"
  Cells(1, I).Value = ActiveCell.Offset(0, 6).Value
  Cells(1, I + 1).NumberFormat = "@"
  Cells(1, I + 1).Value = ActiveCell.Offset(0, 1).Value
  Cells(1, I + 2).NumberFormat = "@"
  Cells(1, I + 2).Value = ActiveCell.Offset(0, 2).Value
  Range(Cells(1, I + 3), Cells(1, I + 6)).NumberFormat = "General"
  If ActiveCell.Offset(0, 3).Value <> "" Or ActiveCell.Offset(0, 3).Value <> 0 Then
   Cells(1, I + 3).Value = ActiveCell.Offset(0, 3).Value * (-1)
  Else
   Cells(1, I + 3).Value = 0
  End If
  Cells(1, I + 4).Value = ActiveCell.Offset(0, 4).Value
  If ActiveCell.Offset(0, 5).Value <> "" Or ActiveCell.Offset(0, 5).Value <> 0 Then
   Cells(1, I + 5).Value = ActiveCell.Offset(0, 5).Value * (-1)
  Else
   Cells(1, I + 3).Value = 0
  End If
  If ActiveCell.Offset(0, 9).Value <> "" Or ActiveCell.Offset(0, 9).Value <> 0 Then
   Cells(1, I + 6).Value = ActiveCell.Offset(0, 9).Value * (-1)
  Else
   Cells(1, I + 6).Value = 0
  End If
  Cells(1, I + 7).NumberFormat = "@"
  Cells(1, I + 7).Value = ActiveCell.Offset(0, 10).Value
  I = I + 8
  J = J + 1
 ActiveCell.Offset(1, 0).Select
 Loop
End If
Range("AD1").Value = J
 ThisWorkbook.Worksheets("TempRP").Activate
   If Range("D100") <> "" Then
     OldInvDate = Range("A100").Value
     Range("A100: P119").Copy
     Range("A160").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
      Range("A160:P179").Select
      Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
    If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
      If Right(InvNo, 1) = " " Then
         InvRef = InvNo
      Else
         InvRef = "INV" & InvNo
      End If
      Call InvoiceIOAdd(OldInvDate, InvRef)
    Else
      Call CNIOAdd(OldInvDate, CNo)
    End If
      ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
   End If
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("160:203").ClearContents
   Rows("100:120").ClearContents
 If InvDate >= BeginningDate Then
   Range("A123: P142").Copy
   Range("A160").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("A160:P179").Select
    Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
      False, Orientation:=xlTopToBottom
    Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
      False, Orientation:=xlTopToBottom
     ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
    If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
      If Right(InvNo, 1) = " " Then
         InvRef = InvNo
      Else
         InvRef = "INV" & InvNo
      End If
      Call InvoiceIOAdd(InvDate, InvRef)
    Else
      Call CNIOAdd(InvDate, CNo)
    End If
      ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
 End If
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("160:203").ClearContents
  Range("A123:P142").Copy
  Range("A160").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Selection.Sort Key1:=Range("C3"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  I = 2
  Range("C160").Select
If Label1.Caption = "INVOICE" Then
   Do While ActiveCell.Value <> ""
    Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Range("C160").Select
    AccountNo = ActiveCell.Value
    SubTotal = ActiveCell.Offset(0, 5).Value
    Do While ActiveCell.Offset(1, 0).Value = AccountNo And AccountNo <> ""
     SubTotal = SubTotal + ActiveCell.Offset(1, 5).Value
     ActiveCell.EntireRow.Delete
    Loop
     SubTotal = Format(SubTotal, "0.00")
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
     If SubTotal >= 0 Then
       Cells(I, 9).Value = Format(SubTotal, "0.00")
     Else
       Cells(I, 8).Value = Format(SubTotal * (-1), "0.00")
     End If
     I = I + 1
    ActiveCell.EntireRow.Delete
   Loop
 If DisAmount <> 0 Then
   Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Cells(I, 5).NumberFormat = "General"
    Cells(I, 5).Value = SalesDisAcct
    Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
    If DisAmount >= 0 Then
     Cells(I, 8).Value = Format(DisAmount, "0.00")
    Else
     Cells(I, 9).Value = Format(DisAmount * (-1), "0.00")
    End If
    I = I + 1
 End If
  Rows("160:203").ClearContents
  Range("A123:P142").Copy
  Range("A160").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Selection.Sort Key1:=Range("I3"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("C160").Select
   Do While ActiveCell.Value <> ""
    Do While ActiveCell.Offset(0, 6).Value = "" And ActiveCell.Value <> ""
     ActiveCell.EntireRow.Delete
    Loop
    If ActiveCell.Value = "" Then Exit Do
    Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Range("C160").Select
    AccountNo = ActiveCell.Offset(0, 6).Value
    SubTotal = ActiveCell.Offset(0, 9).Value
    Do While ActiveCell.Offset(1, 6).Value = AccountNo And AccountNo <> ""
     SubTotal = SubTotal + ActiveCell.Offset(1, 9).Value
     ActiveCell.EntireRow.Delete
    Loop
    SubTotal = Format(SubTotal, "0.00")
   If Abs(SubTotal) > 0.001 Then
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
     If SubTotal >= 0 Then
      Cells(I, 9).Value = Format(SubTotal, "0.00")
     Else
      Cells(I, 8).Value = Format(SubTotal * (-1), "0.00")
     End If
     I = I + 1
    End If
    ActiveCell.EntireRow.Delete
   Loop
  Rows("160:203").ClearContents
  Range("A123:P142").Copy
  Range("A160").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Selection.Sort Key1:=Range("J3"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("C160").Select
   Do While ActiveCell.Value <> ""
    Do While ActiveCell.Offset(0, 7).Value = "" And ActiveCell.Value <> ""
     ActiveCell.EntireRow.Delete
    Loop
    If ActiveCell.Value = "" Then Exit Do
    Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Range("C160").Select
    AccountNo = ActiveCell.Offset(0, 7).Value
    SubTotal = ActiveCell.Offset(0, 9).Value
    Do While ActiveCell.Offset(1, 7).Value = AccountNo And AccountNo <> ""
     SubTotal = SubTotal + ActiveCell.Offset(1, 9).Value
     ActiveCell.EntireRow.Delete
    Loop
    SubTotal = Format(SubTotal, "0.00")
   If Abs(SubTotal) > 0.001 Then
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
     If SubTotal >= 0 Then
      Cells(I, 8).Value = Format(SubTotal, "0.00")
     Else
      Cells(I, 9).Value = Format(SubTotal * (-1), "0.00")
     End If
     I = I + 1
    End If
    ActiveCell.EntireRow.Delete
   Loop
Else
 Do While ActiveCell.Value <> ""
    Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Range("C160").Select
    AccountNo = ActiveCell.Value
    SubTotal = ActiveCell.Offset(0, 5).Value
    Do While ActiveCell.Offset(1, 0).Value = AccountNo And AccountNo <> ""
     SubTotal = SubTotal + ActiveCell.Offset(1, 5).Value
     ActiveCell.EntireRow.Delete
    Loop
     SubTotal = Format(SubTotal, "0.00")
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
     If SubTotal >= 0 Then
       Cells(I, 8).Value = Format(SubTotal, "0.00")
     Else
       Cells(I, 9).Value = Format(SubTotal * (-1), "0.00")
     End If
      I = I + 1
    ActiveCell.EntireRow.Delete
   Loop
 If DisAmount <> 0 Then
   Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Cells(I, 5).NumberFormat = "General"
    Cells(I, 5).Value = SalesDisAcct
    Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
    If DisAmount >= 0 Then
      Cells(I, 9).Value = Format(DisAmount, "0.00")
    Else
      Cells(I, 8).Value = Format(DisAmount * (-1), "0.00")
    End If
    I = I + 1
 End If
  Rows("160:203").ClearContents
  Range("A123:P142").Copy
  Range("A160").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Selection.Sort Key1:=Range("I3"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("C160").Select
   Do While ActiveCell.Value <> ""
    Do While ActiveCell.Offset(0, 6).Value = "" And ActiveCell.Value <> ""
     ActiveCell.EntireRow.Delete
    Loop
    If ActiveCell.Value = "" Then Exit Do
    Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Range("C160").Select
    AccountNo = ActiveCell.Offset(0, 6).Value
    SubTotal = ActiveCell.Offset(0, 9).Value
    Do While ActiveCell.Offset(1, 6).Value = AccountNo And AccountNo <> ""
     SubTotal = SubTotal + ActiveCell.Offset(1, 9).Value
     ActiveCell.EntireRow.Delete
    Loop
    SubTotal = Format(SubTotal, "0.00")
   If Abs(SubTotal) > 0.001 Then
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
     If SubTotal >= 0 Then
      Cells(I, 8).Value = Format(SubTotal, "0.00")
     Else
      Cells(I, 9).Value = Format(SubTotal * (-1), "0.00")
     End If
     I = I + 1
    End If
    ActiveCell.EntireRow.Delete
   Loop
  Rows("160:203").ClearContents
  Range("A123:P142").Copy
  Range("A160").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
    Selection.Sort Key1:=Range("J3"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   Range("C160").Select
   Do While ActiveCell.Value <> ""
    Do While ActiveCell.Offset(0, 7).Value = "" And ActiveCell.Value <> ""
     ActiveCell.EntireRow.Delete
    Loop
    If ActiveCell.Value = "" Then Exit Do
    Rows("1:1").Copy
    Cells(I, 1).Select
    ActiveSheet.Paste
    Cells(I, 8).ClearContents
    Cells(I, 9).ClearContents
    Range("C160").Select
    AccountNo = ActiveCell.Offset(0, 7).Value
    SubTotal = ActiveCell.Offset(0, 9).Value
    Do While ActiveCell.Offset(1, 7).Value = AccountNo And AccountNo <> ""
     SubTotal = SubTotal + ActiveCell.Offset(1, 9).Value
     ActiveCell.EntireRow.Delete
    Loop
    SubTotal = Format(SubTotal, "0.00")
    If Abs(SubTotal) > 0.001 Then
     Cells(I, 5).NumberFormat = "General"
     Cells(I, 5).Value = AccountNo
     Range(Cells(I, 8), Cells(I, 9)).NumberFormat = "General"
     If SubTotal >= 0 Then
      Cells(I, 9).Value = Format(SubTotal, "0.00")
     Else
      Cells(I, 8).Value = Format(SubTotal * (-1), "0.00")
     End If
     I = I + 1
    End If
    ActiveCell.EntireRow.Delete
   Loop
End If
   Range(Cells(1, 6), Cells(I, 6)).NumberFormat = "General"
   Range(Cells(1, 6), Cells(I, 6)).FormulaR1C1 = "=VLOOKUP(RC[-1],'Chart of Account'!R10C1:R" & LastRowChartofAccount & "C2,2,0)"
   Range(Cells(1, 6), Cells(I, 6)).NumberFormat = "@"
   Range(Cells(1, 6), Cells(I, 6)).Copy
   Range(Cells(1, 6), Cells(I, 6)).PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
If Label1.Caption = "INVOICE" Then CNo = InvNo
MyBook.Worksheets("Receivable").Activate
If Range("B4").Value <> "" Then
 ActiveSheet.UsedRange.Select
 Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
End If
If IsError(Application.Match(CNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = False Then
  ActiveSheet.UsedRange.Select
   Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
   Set CheckRange = Selection.Columns("B")
   FInvRow = Application.Match(CNo, CheckRange, 0) + 3
   LInvRow = Application.Match(CNo, CheckRange, 1) + 3
  MyBook.Worksheets("Receivable").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
  MyBook.Worksheets("Raw Data").Activate
 If Range("B4").Value <> "" Then
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Set CheckRange = Selection.Columns("J")
  If IsError(Application.Match(CNo, MyBook.Worksheets("Raw Data").Range("J:J"), 0)) = False Then
   FInvRow = Application.Match(CNo, CheckRange, 0) + 3
   LInvRow = Application.Match(CNo, CheckRange, 1) + 3
  JournalCode = MyBook.Worksheets("Raw Data").Cells(FInvRow, 1).Value
  TranNo = MyBook.Worksheets("Raw Data").Cells(FInvRow, 2).Value
   MyBook.Worksheets("Raw Data").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
  End If
 End If
 MyBook.Worksheets("Receivable").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("1:1").Copy
 MyBook.Worksheets("Receivable").Activate
 ActiveSheet.Paste
 If InvDate >= BeginningDate Then
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 10), Cells(I - 1, 10)).NumberFormat = "@"
   Range(Cells(1, 10), Cells(I - 1, 10)).Value = CNo
  If JournalCode = "" Then
    AcctYear = Int((Period(InvDate) - Period(BeginningDate)) / 12)
    AcctYear = AcctYear + Year(BeginningDate)
    JournalCode = "RV" & AcctYear
    MyBook.Worksheets("ComData").Activate
    Range("G250").Select
    JcodeRow = 251
    Set JournalRange = Range("G250")
    If ActiveCell.Offset(1, 0).Value <> "" Then
     Range("G250").End(xlDown).Select
     JcodeRow = ActiveCell.Row + 1
    End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
    Else
     JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
     LastTranNo = Cells(JcodeRow, 8).Value
     LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
     Cells(JcodeRow, 8).Value = LastTranNo
    End If
   LastJournalCode = JournalCode
   TranNo = LastTranNo
  End If
   
   
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(I - 1, 1)).NumberFormat = "@"
   Range(Cells(1, 1), Cells(I - 1, 1)).Value = JournalCode
   Range(Cells(1, 2), Cells(I - 1, 2)).NumberFormat = "@"
   Range(Cells(1, 2), Cells(I - 1, 2)).Value = TranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(I - 1, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
   P = Period(InvDate) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
 End If
Else
 MyBook.Worksheets("Receivable").Activate
  Range("B1").End(xlDown).Select
  ActiveCell.Offset(1, -1).Select
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("1:1").Copy
 MyBook.Worksheets("Receivable").Activate
 ActiveSheet.Paste
 If InvDate >= BeginningDate Then
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 10), Cells(I - 1, 10)).NumberFormat = "@"
   Range(Cells(1, 10), Cells(I - 1, 10)).Value = CNo
   AcctYear = Int((Period(InvDate) - Period(BeginningDate)) / 12)
   AcctYear = AcctYear + Year(BeginningDate)
   JournalCode = "RV" & AcctYear
   MyBook.Worksheets("ComData").Activate
   Range("G250").Select
   JcodeRow = 251
   Set JournalRange = Range("G250")
   If ActiveCell.Offset(1, 0).Value <> "" Then
    Range("G250").End(xlDown).Select
    JcodeRow = ActiveCell.Row + 1
   End If
    Set JournalRange = Range(Cells(250, 7), Cells(JcodeRow - 1, 7))
    Range(Cells(250, 7), Cells(JcodeRow - 1, 8)).Select
    Selection.Sort Key1:=Range("G250"), Order1:=xlAscending, Header:=xlNo, _
        OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
   If IsError(Application.Match(JournalCode, JournalRange, 0)) Then
     LastTranNo = "00001"
     Cells(JcodeRow, 7).Value = JournalCode
     Cells(JcodeRow, 8).Value = LastTranNo
   Else
    JcodeRow = Application.Match(JournalCode, JournalRange, 0) + 249
    LastTranNo = Cells(JcodeRow, 8).Value
    LastTranNo = Right(("00000" & (Val(LastTranNo) + 1)), 5)
    Cells(JcodeRow, 8).Value = LastTranNo
   End If
   LastJournalCode = JournalCode
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(I - 1, 1)).NumberFormat = "@"
   Range(Cells(1, 1), Cells(I - 1, 1)).Value = JournalCode
   Range(Cells(1, 2), Cells(I - 1, 2)).NumberFormat = "@"
   Range(Cells(1, 2), Cells(I - 1, 2)).Value = LastTranNo
   MyBook.Worksheets("Raw Data").Activate
   Range("A2").End(xlDown).Select
   ActiveCell.Offset(1, 0).Select
   ThisWorkbook.Worksheets("TempRP").Activate
   Range(Cells(1, 1), Cells(I - 1, 10)).Copy
   MyBook.Worksheets("Raw Data").Activate
   ActiveSheet.Paste
   P = Period(InvDate) - Period(BeginningDate) + 1
   MyBook.Worksheets("ComData").Activate
   Cells(P, 5).Value = "Yes"
 End If
End If
 MyBook.Worksheets("Receivable").Activate
 Range("C1").Select
If Label1.Caption = "INVOICE" Then
 If IsNumeric(InvNo) Then
  If Len(InvNo) = 6 Then
   If InvNo > MyBook.Worksheets("Receivable").Range("A1").Value Then MyBook.Worksheets("Receivable").Range("A1").Value = InvNo
  End If
 End If
 If MyBook.Worksheets("Receivable").Range("A1").Value = "999999" Then MyBook.Worksheets("Receivable").Range("A1").Value = "000000"
 InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
  Label38.Visible = True
  TextBox2.Left = 450
  TextBox2.Width = 90
 Label35.Visible = True
 Label35.Left = 84
 Label35.Width = 138
 TextBox39.Visible = False
 TextBox39.Text = ""
 TextBox46.Visible = False
 TextBox46.Text = ""
Else
 If InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1), 5) Then MyBook.Worksheets("Receivable").Range("F1").Value = InvNo
 If MyBook.Worksheets("Receivable").Range("F1").Value = "99999" Then MyBook.Worksheets("Receivable").Range("F1").Value = "00000"
 InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1), 5)
End If
ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
TextBox1.Text = ""
 If PINo <> "" And Label1.Caption = "INVOICE" Then
   MyBook.Worksheets("ProInvoice").Activate
   If Range("B4").Value <> "" Then
     ActiveSheet.UsedRange.Select
     Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
     Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Set CheckRange = Selection.Columns("B")
    If IsError(Application.Match(PINo, CheckRange, 0)) = False Then
     FInvRow = Application.Match(PINo, CheckRange, 0) + 3
     LInvRow = Application.Match(PINo, CheckRange, 1) + 3
     Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
    End If
   End If
   If PIPartial = "R" Then
     MyBook.Worksheets("ProInvoice").Activate
     Range("B1").End(xlDown).Select
     ActiveCell.Offset(1, -1).Select
     ThisWorkbook.Worksheets("RunningDat").Activate
     Rows("1:1").Copy
     MyBook.Worksheets("ProInvoice").Activate
     ActiveSheet.Paste
     Range("C1").Select
   End If
 End If
 PINo = ""
 PIPartial = ""
InvDate = Date
Call TempRPFormat("AR")
Call Form6Text1Exit("AR")
ScrollBar1.Max = 15
ScrollBar1.Min = 1
ScrollBar1.Value = 1
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
TextBox4.SetFocus
EventOff = False
Exit Sub
FormRefresh:
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = LineNo + I - 1
  Controls("TextBox" & I * 5).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Worksheets("TempRP").Cells(LineNo + 121 + I, 7).Value
  Controls("Label" & I + 40).Caption = Format(Worksheets("TempRP").Cells(LineNo + 121 + I, 8).Value, "#,##0.00")
  Next I
  EventOff = False
End Sub
Private Sub CommandButton1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
LabelAlert = False
End Sub

Private Sub CommandButton11_Click()
Dim I As Long, J As Long, K As Long, StockQty As Double, StockAmt As Double, UnitCost As Double, CustRow As Long
Dim CheckRange As Range, CreditSum As Double, BalSum As Double, FRow As Long, LRow As Long
Dim PartNotFound As String, ProductNo As String
Application.EnableCancelKey = xlDisabled
 EventOff = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 Label23.Visible = False
 CommandButton1.Caption = "Save"
 If Label1.Caption = "INVOICE " Or Label1.Caption = "INVOICE" Then
  Label1.Caption = "INVOICE"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
  Label38.Visible = True
   TextBox2.Left = 450
   TextBox2.Width = 90
 Else
  Label1.Caption = "SALES ORDER"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
 End If
 TextBox2.Text = InvNo
 InvDate = Date
 TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 CustPO = ""
 TextBox4.Text = CustPO
 ScrollBar1.Max = 15
 CommandButton11.Visible = False
 CommandButton1.Visible = True
 CommandButton18.Visible = True
ThisWorkbook.Worksheets("TempRP").Activate
 Range("A100:Q120").ClearContents
 CustNo = TextBox1.Text
If IsError(Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)) = True Then
  CustNo = ""
  ThisWorkbook.Worksheets("TempRP").Activate
  ActiveSheet.UsedRange.Delete
  Label3.Caption = "Customer : -  "
  Label23.Caption = Chr(13) & "    The Customer number is no longer found from the Record"
  Label23.Visible = True
  ScrollBar1.Value = 1
  For I = 1 To 6
  Controls("Label" & I + 14).Caption = I
  Controls("TextBox" & I * 5).Text = Cells(122 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(122 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(122 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(122 + I, 7).Value
  Controls("Label" & I + 40).Caption = Format(Cells(122 + I, 8).Value, "#,##0.00")
  Controls("Label" & I + 50).Caption = Cells(122, 14).Value
  Next I
  Call Form6Text1Exit("AR")
  Call Form6AmountRefresh("")
  EventOff = False
  Exit Sub
End If
 CustRow = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
 MyBook.Worksheets("Customer Data").Activate
 Cells(CustRow, 2).Select
 CustNo = ActiveCell.Value
 CustName = ActiveCell.Offset(0, 1).Value
 Address1 = ActiveCell.Offset(0, 3).Value
 Address2 = ActiveCell.Offset(0, 4).Value
 Address3 = ActiveCell.Offset(0, 5).Value
 CreditSum = ActiveCell.Offset(0, 6).Value
 DisRate = ActiveCell.Offset(0, 7).Value / 100
 CustContact = ActiveCell.Offset(0, 8).Value
 TelNo = ""
 SalesRep = ActiveCell.Offset(0, 12).Value
 PayTerm = ActiveCell.Offset(0, 14).Value
 Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
 "     " & Address1 & Chr(13) & _
 "     " & Address2 & Chr(13) & _
 "     " & Address3 & Chr(13) & _
 "     Contact: " & CustContact
 TextBox35.Text = SalesRep
 Label14.Caption = ActiveCell.Offset(0, 7).Value & "% Discount " & "(" & SysCurrency & ") : "
  DelName = ActiveCell.Offset(0, 15).Value
  DelAddress1 = ActiveCell.Offset(0, 16).Value
  DelAddress2 = ActiveCell.Offset(0, 17).Value
  DelAddress3 = ActiveCell.Offset(0, 18).Value
  DelContact = ActiveCell.Offset(0, 19).Value
   Label7.Caption = "Goods delivered To :   " & Chr(13) & "     " & DelName & Chr(13) & _
   "     " & DelAddress1 & Chr(13) & _
   "     " & DelAddress2 & Chr(13) & _
   "     " & DelAddress3 & Chr(13) & _
   "     Contact: " & DelContact
 Worksheets("Receivable").Activate
  BalSum = 0
 If Range("B4").Value <> "" Then
  Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
  Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
  If IsError(Application.Match(CustNo, CheckRange, 0)) Then GoTo NoBalance
  FRow = Application.Match(CustNo, CheckRange, 0) + 3
  LRow = Application.Match(CustNo, CheckRange, 1) + 3
  If LRow < FRow Then LRow = FRow
  BalSum = Application.Sum(Range(Cells(FRow, 11), Cells(LRow, 11)))
 End If
NoBalance:
 If UCase(PayTerm) <> "C.O.D." And UCase(PayTerm) <> "PREPAID" Then
  CreditSum = CreditSum - BalSum
  Label36.Caption = Format(CreditSum, "#,##0.00")
  Label33.Caption = "Available Credit Amount (" & SysCurrency & ") : "
  Label33.Visible = True
  Label36.Visible = True
 Else
  Label33.Visible = False
  Label36.Visible = False
 End If
  Label35.Caption = PayTerm
ThisWorkbook.Worksheets("TempRP").Activate
 Range("D123").Select
 PartNotFound = ""
Do While ActiveCell.Value <> ""
  ProductNo = ActiveCell.Value
  If IsError(Application.Match(ProductNo, MyBook.Worksheets("Product Data").Range("B:B"), 0)) Then
   ActiveCell.EntireRow.Delete
   PartNotFound = "Yes"
  Else
    ProdRow = Application.Match(ProductNo, MyBook.Worksheets("Product Data").Range("B:B"), 0)
    ActiveCell.Offset(0, 1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 3).Value
    ActiveCell.Offset(0, 3).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 4).Value
    ActiveCell.Offset(0, -1).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 5).Value
    If MyBook.Worksheets("Product Data").Cells(ProdRow, 7).Value = "Yes" Then
      ActiveCell.Offset(0, 5).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 8).Value
      ActiveCell.Offset(0, 9).NumberFormat = "@"
      ActiveCell.Offset(0, 9).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 9).Value
      StockNo = ActiveCell.Offset(0, 9).Value
      ActiveCell.Offset(0, 6).Value = MyBook.Worksheets("Product Data").Cells(ProdRow, 6).Value
    Else
      ActiveCell.Offset(0, 5).Value = ""
      ActiveCell.Offset(0, 9).Value = ""
      ActiveCell.Offset(0, 6).Value = ""
      ActiveCell.Offset(0, 10).Value = "N/A"
      StockNo = ""
    End If
    ActiveCell.Offset(0, 4).Value = ActiveCell.Offset(0, 2).Value * ActiveCell.Offset(0, 3).Value
   If StockNo <> "" Then
     If IsError(Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)) = False Then
      I = Application.Match(StockNo, MyBook.Worksheets("StockRec").Range("B:B"), 0)
      ActiveCell.Offset(0, 5).Value = MyBook.Worksheets("StockRec").Cells(I, 5).Value
       StockAmt = MyBook.Worksheets("StockRec").Cells(I, 9).Value
       StockQty = MyBook.Worksheets("StockRec").Cells(I, 8).Value
        ActiveCell.Offset(0, 10).Value = StockQty
        ActiveCell.Offset(0, 12).Value = StockAmt
       If StockQty <> 0 Then
         ActiveCell.Offset(0, 7).Value = StockAmt / StockQty
       Else
         ActiveCell.Offset(0, 7).Value = MyBook.Worksheets("StockRec").Cells(I, 10).Value
       End If
       ActiveCell.Offset(0, 8).Value = Round(ActiveCell.Offset(0, 7).Value * ActiveCell.Offset(0, 2).Value, 2)
     End If
   End If
    ActiveCell.Offset(1, 0).Select
  End If
Loop
    Range("C123").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 14).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("Q1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("C123").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 10).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 10).Value
       StockQty = ActiveCell.Offset(0, 11).Value
       StockAmt = ActiveCell.Offset(0, 13).Value
       UnitCost = ActiveCell.Offset(0, 8).Value
       If StockQty = ActiveCell.Offset(0, 3).Value Then
          ActiveCell.Offset(0, 9).Value = StockAmt
       Else
         ActiveCell.Offset(0, 9).Value = Round(UnitCost * ActiveCell.Offset(0, 3).Value, 2)
       End If
       Do While ActiveCell.Offset(1, 10).Value = StockNo
        StockQty = Format(StockQty - ActiveCell.Offset(0, 3).Value, "0.0000")
        StockAmt = Format(StockAmt - ActiveCell.Offset(0, 9).Value, "0.00")
        ActiveCell.Offset(1, 11).Value = StockQty
        ActiveCell.Offset(1, 13).Value = StockAmt
        ActiveCell.Offset(1, 8).Value = UnitCost
        If StockQty = ActiveCell.Offset(1, 3).Value Then
          ActiveCell.Offset(1, 9).Value = StockAmt
        Else
         ActiveCell.Offset(1, 9).Value = Round(UnitCost * ActiveCell.Offset(1, 3).Value, 2)
        End If
        ActiveCell.Offset(0, 12).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Range("Q123:Q142").ClearContents
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = I
  Controls("TextBox" & I * 5).Text = Cells(122 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(122 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(122 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(122 + I, 7).Value
  Controls("Label" & I + 40).Caption = Format(Cells(122 + I, 8).Value, "#,##0.00")
  Controls("Label" & I + 50).Caption = Cells(122 + I, 14).Value
  Next I
  For I = 1 To 7
   Controls("Label" & I + 49).Visible = True
  Next I
  ScrollBar1.Value = 1
 If PartNotFound = "Yes" Then
   Label23.Caption = Chr(13) & "    ALERT !! Some of the products are deleted " & Chr(13) & _
      "    because they are no longer in the Product list"
   Label23.Visible = True
 End If
  Call DueDateCal("")
  Call Form6AmountRefresh("")
  EventOff = False
End Sub

Private Sub CommandButton12_Click()
Application.EnableCancelKey = xlDisabled
 EventOff = True
 PINo = ""
 CommandButton1.Caption = "Save"
 If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
  Label1.Caption = "INVOICE"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
   Label38.Visible = True
   TextBox2.Left = 450
   TextBox2.Width = 90
 ElseIf Label1.Caption = "SALES ORDER" Or Label1.Caption = "SALES ORDER " Then
  Label1.Caption = "SALES ORDER"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
  PINo = "PI" & InvNo
  Label38.Visible = True
  TextBox2.Left = 444
  TextBox2.Width = 90
  Label10.Top = 156
  Label10.Height = 18
  Label10.Caption = "Qty"
 Else
  Label1.Caption = "CREDIT NOTE"
  InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1), 5)
 End If
Call TempRPFormat("AR")
Call Form6Text1Exit("AR")
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = False
 Label23.Visible = False
 If Label1.Caption = "INVOICE" Then
   For I = 50 To 56
    Controls("Label" & I).Visible = True
   Next I
   CommandButton18.Visible = True
 End If
If Label1.Caption = "SALES ORDER" Then
   For I = 50 To 56
    Controls("Label" & I).Visible = True
   Next I
   For I = 40 To 45
    Controls("Textbox" & I).Visible = False
   Next I
   Label57.Visible = False
   CommandButton17.Visible = False
   CommandButton16.Visible = True
   CommandButton18.Visible = True
 End If
 EventOff = False
End Sub

Private Sub CommandButton13_Click()
Dim CNo As String, C As String, OldInvDate As Date, CheckRange As Range, InvRef As String
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = False
 CommandButton14.Visible = False
 Label23.Visible = False
If Label1.Caption = "SALES ORDER" Or Label1.Caption = "SALES ORDER " Then
  EventOff = True
  Call PIDelete(PINo)
  EventOff = False
  Exit Sub
ElseIf Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "CREDIT NOTE " Then
 CNo = "CN" & InvNo
Else
 CNo = InvNo
End If
EventOff = True
PINo = ""
MyBook.Worksheets("Receivable").Activate
ActiveSheet.UsedRange.Select
Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Set CheckRange = Selection.Columns("B")
If IsError(Application.Match(CNo, CheckRange, 0)) = False Then
  FInvRow = Application.Match(CNo, CheckRange, 0) + 3
  LInvRow = Application.Match(CNo, CheckRange, 1) + 3
AskReply:
 If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
   MSG = "The Invoice will be removed from the Record" + Chr(13) + _
    Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
 Else
   MSG = "The Credit Note will be removed from the Record" + Chr(13) + _
    Chr(13) + Chr(13) + "Enter 'Y' to confirm proceed."
 End If
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then GoTo FinishSave
    GoTo AskReply
DataRemoval:
MyBook.Worksheets("Receivable").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
 MyBook.Worksheets("Raw Data").Activate
 If Range("B4").Value <> "" Then
    ActiveSheet.UsedRange.Select
    Selection.Offset(3, 0).Resize(Selection.Rows.Count - 3, Selection.Columns.Count).Select
    Selection.Sort Key1:=Range("J1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
   Set CheckRange = Selection.Columns("J")
  If IsError(Application.Match(CNo, CheckRange, 0)) = False Then
   FInvRow = Application.Match(CNo, CheckRange, 0) + 3
   LInvRow = Application.Match(CNo, CheckRange, 1) + 3
   MyBook.Worksheets("Raw Data").Range(Cells(FInvRow, 1), Cells(LInvRow, 1)).EntireRow.Delete
  End If
 End If
 ThisWorkbook.Worksheets("TempRP").Activate
   If Range("D100") <> "" Then
     OldInvDate = Range("A100").Value
     Range("A100: P119").Copy
     Range("A160").Select
     ActiveSheet.Paste
     Application.CutCopyMode = False
      Range("A160:P179").Select
      Selection.Sort Key1:=Range("D1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
      Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("D1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     ThisWorkbook.Worksheets("NewCOm").Range("A10").Value = "IOAdd"
    If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
      If Right(InvNo, 1) = " " Then
         InvRef = InvNo
      Else
         InvRef = "INV" & InvNo
      End If
      Call InvoiceIOAdd(OldInvDate, InvRef)
    Else
      Call CNIOAdd(OldInvDate, CNo)
    End If
      ThisWorkbook.Worksheets("NewCOm").Range("A10").ClearContents
   End If
   ThisWorkbook.Worksheets("TempRP").Activate
   Rows("160:203").ClearContents
   Rows("100:120").ClearContents
End If
 CommandButton1.Caption = "Save"
If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
  Label1.Caption = "INVOICE"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
  For I = 50 To 56
   Controls("Label" & I).Visible = True
  Next I
   Label38.Visible = True
   TextBox2.Left = 450
   TextBox2.Width = 90
   CommandButton18.Visible = True
Else
  Label1.Caption = "CREDIT NOTE"
  InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1), 5)
End If
TextBox1.Text = ""
InvDate = Date
Call TempRPFormat("AR")
Call Form6Text1Exit("AR")
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = False
 Label23.Visible = False
ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C"
FinishSave:
EventOff = False
End Sub
Private Sub CommandButton14_Click()
If Label1.Caption <> "INVOICE" And Label1.Caption <> "SALES ORDER" Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox2.Visible = False
CommandButton14.Visible = False
Label23.Visible = False
Me.Hide
ThisWorkbook.Worksheets("System Menu").Activate
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm9.CommandButton4.Visible = False
UserForm9.Show
End Sub
Private Sub CommandButton15_Click()
Dim Sh As Shape, PicLocation As String, PicZoom As Single
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
Label23.Visible = False
If CommandButton1.Visible = True And CommandButton1.Caption = "Save" And TotalAmount <> 0 Then
AskReply:
   MSG = "This Entry has not been Saved." + Chr(13) + _
   Chr(13) + "Enter 'Y' to proceed Without Saving "
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo PrintForm
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
End If
PrintForm:
 Label23.BackColor = &H40C0&
 Label23.Caption = Chr(13) & "       Request under processing.  Please wait."
 Label23.Visible = True
 DoEvents
 ThisWorkbook.Worksheets("TempRP").Activate
  Range("D123").Select
  I = 1
  Do While I < 21
   If ActiveCell.Value = "" Then
    ActiveCell.EntireRow.Delete
   Else
    ActiveCell.Offset(1, 0).Select
   End If
   I = I + 1
  Loop
Call Form6AmountRefresh("")
ThisWorkbook.Worksheets("Invoice").Activate
ActiveSheet.UsedRange.EntireRow.Hidden = False
ActiveSheet.UsedRange.ClearContents
For Each Sh In ActiveSheet.Shapes
 If Sh.Type = msoPicture Then Sh.Delete
Next
Range("A1").ColumnWidth = 5.25
Range("B1").ColumnWidth = 14.25
Range("C1").ColumnWidth = 14.5
Range("D1").ColumnWidth = 13.25
Range("E1").ColumnWidth = 1.25
Range("F1").ColumnWidth = 12.13
Range("G1").ColumnWidth = 8.5
Range("H1").ColumnWidth = 13
Range("I1").ColumnWidth = 13
If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
  Worksheets("InvForm").Activate
   Rows("1:100").Select
  Selection.Copy
  Worksheets("Invoice").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Rows("92:3000").Delete
ElseIf Label1.Caption = "SALES ORDER" Or Label1.Caption = "SALES ORDER " Then
  Worksheets("InvForm").Activate
  Rows("1:50").Select
  Selection.Copy
  Worksheets("Invoice").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Rows("47:3000").Delete
  EventOff = True
  Call PIPrint(PINo)
  EventOff = False
  Exit Sub
Else
  Worksheets("CNForm").Activate
   Rows("1:50").Select
  Selection.Copy
  Worksheets("Invoice").Activate
  Range("A1").Select
  Selection.PasteSpecial Paste:=xlFormats, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
  Application.CutCopyMode = False
  Rows("47:3000").Delete
End If
Range("H6").Value = "Date : "
Range("A9").Value = "Customer : "
Range("A17").Value = "Item"
Range("B17").Value = "Product #"
Range("C17").Value = "Product Description"
Range("G17").Value = "Qty"
Range("H16").Value = "Unit Price "
Range("H17").Value = "(" & SysCurrency & ")"
Range("I16").Value = "Amount "
Range("I17").Value = "(" & SysCurrency & ")"
Range("H40").Value = "Sub-Total : "
Range("H41").Value = "Discount Amount : "
Range("H42").Value = "Total : "
Range("G46").Value = "Authorized Signature"
Range("I6").Value = InvDate
Range("I40").Value = TotalSum
Range("I42").Value = TotalAmount
Range("B43").Value = TextBox47.Text & Chr(10) & TextBox48.Text & Chr(10) & TextBox49.Text
If DisAmount = 0 Then
   Range("I41").Value = DisAmount
Else
   Range("I41").Value = DisAmount * (-1)
End If
 Range("A10").Value = "   " & CustName
 Range("A11").Value = "   " & Address1
 Range("A12").Value = "   " & Address2
 Range("A13").Value = "   " & Address3
 If TelNo <> "" Then
  Range("A14").Value = "   Contact : " & CustContact & " (Tel: " & TelNo & ")"
 Else
  Range("A14").Value = "   Contact : " & CustContact
 End If
If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
  Range("B40").Value = "Sales Person : "
  Range("C40").Value = SalesRep
  Range("H51").Value = "Date : "
  Range("A54").Value = "Customer : "
  Range("A62").Value = "Item"
  Range("B62").Value = "Product #"
  Range("C62").Value = "Product Description"
  Range("G62").Value = "Qty"
  Range("I51").Value = InvDate
  Range("A55").Value = "   " & CustName
  Range("A56").Value = "   " & Address1
  Range("A57").Value = "   " & Address2
  Range("A58").Value = "   " & Address3
  If TelNo <> "" Then
    Range("A59").Value = "   Contact : " & CustContact & " (Tel: " & TelNo & ")"
  Else
    Range("A59").Value = "   Contact : " & CustContact
  End If
  Range("A3").Value = "INVOICE"
  Range("H5").Value = "Invoice # : "
  Range("H7").Value = "Customer PO : "
  Range("H8").Value = "Delivery note # : "
  Range("F9").Value = "Goods delivered to: "
  Range("B41").Value = "Payment Term : "
  Range("B42").Value = "Payment Due Date : "
  If Right(InvNo, 1) <> " " Then
   Range("I5").Value = "INV" & InvNo
  Else
   Range("I5").Value = InvNo
  End If
   With New StdFont
        .Name = "IDAutomationHC39M Free Version"
        If (StrComp("IDAutomationHC39M Free Version", .Name, vbTextCompare) = 0) = True Then
         Range("A5").RowHeight = 16.5
         Range("A5").VerticalAlignment = xlTop
         Range("A5").HorizontalAlignment = xlLeft
         Range("A5").Font.Name = "IDAutomationHC39M Free Version"
         Range("A5").Value = Code39(Range("I5").Value)
        End If
    End With
  Range("I8").Value = InvNo
  Range("I7").Value = CustPO
  Range("C41").Value = PayTerm
  Range("C42").Value = DueDate
  Range("F10").Value = "   " & DelName
  Range("F11").Value = "   " & DelAddress1
  Range("F12").Value = "   " & DelAddress2
  Range("F13").Value = "   " & DelAddress3
  Range("F14").Value = "   Contact : " & DelContact
  If PayTerm = "C.O.D." Or UCase(PayTerm) = "PREPAID" Then
    Range("B42:C42").ClearContents
  End If
  Range("A48").Value = "DELIVERY NOTE"
  Range("H50").Value = "Delivery note # : "
  Range("H52").Value = "Customer PO : "
  Range("F54").Value = "Goods delivered to: "
  Range("I50").Value = TextBox38.Text & InvNo
  Range("I52").Value = CustPO
  Range("F55").Value = "   " & DelName
  Range("F56").Value = "   " & DelAddress1
  Range("F57").Value = "   " & DelAddress2
  Range("F58").Value = "   " & DelAddress3
  Range("F59").Value = "   Contact : " & DelContact
  Range("B85").Value = "Goods Received by : "
  Range("B89").Value = "Authorized Signature and Stamp"
  Range("B91").Value = "Date : "
Else
  Range("B41").Value = "Sales Person : "
  Range("C41").Value = SalesRep
  Range("A3").Value = "CREDIT NOTE "
  Range("H5").Value = "Credit Note # : "
  Range("H7").Value = "Ref. Invoice : "
  Range("I7").Value = CustPO
  Range("I5").Value = "CN" & InvNo
  Range("B42").Value = "Remarks : "
  Range("C42").Value = DelName
End If
I = 19
ThisWorkbook.Worksheets("TempRP").Activate
Range("D123").Select
Do While ActiveCell.Value <> ""
 ThisWorkbook.Worksheets("Invoice").Cells(I, 1).Value = I - 18
 ThisWorkbook.Worksheets("Invoice").Cells(I, 2).Value = ActiveCell.Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 3).Value = ActiveCell.Offset(0, 1).Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 7).Value = ActiveCell.Offset(0, 2).Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 8).Value = ActiveCell.Offset(0, 3).Value
 ThisWorkbook.Worksheets("Invoice").Cells(I, 9).Value = ActiveCell.Offset(0, 4).Value
 ActiveCell.Offset(1, 0).Select
 I = I + 1
Loop
If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
 ThisWorkbook.Worksheets("Invoice").Activate
 Range("A19:G39").Copy
 Range("A64").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
End If
 Call InvPageLayout("Invoice")
ThisWorkbook.Worksheets("Invoice").Visible = xlSheetVisible
 Worksheets("Invoice").CommandButton2.Visible = False
 Worksheets("Invoice").CommandButton3.Visible = False
 Worksheets("Invoice").CommandButton4.Visible = True
 Worksheets("Invoice").CommandButton5.Visible = True
Worksheets("System Menu").Visible = xlSheetVeryHidden
SheetName = "Invoice"
 ActiveWindow.DisplayGridlines = False
 Label23.BackColor = &HC0&
 Label23.Visible = False
Me.Hide
Worksheets("Invoice").Activate
Range("A1:K19").Select
ActiveWindow.Zoom = True
Range("I1").Select
Application.ScreenUpdating = True
Range("A2").Select
End Sub
Private Sub CommandButton16_Click()
Dim Sh As Shape
Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = False
 CommandButton14.Visible = False
 Label23.Visible = False
 If CommandButton16.Caption = "Convert SO to Invoice" Then
   Label23.Visible = False
   PIPartial = "S"
   EventOff = True
   Call PItoInvoice(PINo, "")
   EventOff = False
   Exit Sub
 End If
If CommandButton1.Visible = True And CommandButton1.Caption = "Save" And TotalAmount <> 0 Then
AskReply:
   MSG = "This Entry has not been Saved." + _
    Chr(13) + "Multiple printing only handles 'Saved' entries" + Chr(13) _
    + Chr(13) + "Enter 'Y' to proceed Without Saving "
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo PrintForm
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
End If
PrintForm:
 ThisWorkbook.Worksheets("Invoice").Activate
 ActiveSheet.UsedRange.EntireRow.Hidden = False
 ActiveSheet.UsedRange.ClearContents
For Each Sh In ActiveSheet.Shapes
 If Sh.Type = msoPicture Then Sh.Delete
Next
Range("A1").ColumnWidth = 5.25
Range("B1").ColumnWidth = 14.25
Range("C1").ColumnWidth = 14.5
Range("D1").ColumnWidth = 13.25
Range("E1").ColumnWidth = 1.25
Range("F1").ColumnWidth = 12.13
Range("G1").ColumnWidth = 8.5
Range("H1").ColumnWidth = 13
Range("I1").ColumnWidth = 13
If Label1.Caption = "INVOICE " Or Label1.Caption = "INVOICE" Then
  ThisWorkbook.Worksheets("Invoice").CommandButton2.Caption = "Invoice Only"
  ThisWorkbook.Worksheets("Invoice").CommandButton3.Caption = "Delivery Note Only"
  ThisWorkbook.Worksheets("Invoice").CommandButton2.Visible = True
  ThisWorkbook.Worksheets("Invoice").CommandButton3.Visible = True
  Call InvPrint("")
Else
  ThisWorkbook.Worksheets("Invoice").CommandButton2.Visible = False
  ThisWorkbook.Worksheets("Invoice").CommandButton3.Visible = False
  Call CNPrint("")
End If
  ThisWorkbook.Worksheets("Invoice").CommandButton4.Visible = True
End Sub
Private Sub CommandButton17_Click()
Dim NewSum As Double, NewTotal As Double, NewDisAmt As Double, I As Long, J As Long
Dim FRow As Long, LRow As Long, StockQty As Double, StockAmt As Double, UnitCost As Double
Dim CreditSum As Double, BalSum As Double, CheckRange As Range
  If Label1.Caption <> "SALES ORDER " Then Exit Sub
  Application.EnableCancelKey = xlDisabled
 If LabelAlert = True And Label23.Visible = True Then
  LabelAlert = False
  Exit Sub
 End If
   PIPartial = "R"
   EventOff = True
 ThisWorkbook.Worksheets("TempRP").Activate
 Rows("1:1").ClearContents
 Range("D1").NumberFormat = "yyyy/mm/dd"
 Range("D1").Value = InvDate
 Range("E1").NumberFormat = "General"
 Range("E1").Value = DebtorAcct
 Range("H1:I1").NumberFormat = "General"
 Range("J1").NumberFormat = "@"
 Range("J1").Value = "R"
 Range("K1").NumberFormat = "General"
 Range("M1").NumberFormat = "yyyy/mm/dd"
 Range("N1").NumberFormat = "@"
 Range("N1").Value = TextBox36.Text
 Range("O1:AC1").NumberFormat = "@"
 Range("O1").Value = PayTerm
 Range("P1").Value = CustNo
 Range("Q1").Value = CustName
 Range("R1").Value = Address1
 Range("S1").Value = Address2
 Range("T1").Value = Address3
 Range("U1").Value = CustContact
 Range("V1").Value = TelNo
 Range("AB1").Value = CustPO
 Range("AC1").Value = SalesRep
 Range("AD1:AG1").NumberFormat = "General"
 Range("AH1").NumberFormat = "@"
 Range("AH1").Value = InvPrefix
 Range("AG1").Value = DisRate
 Range("B1").NumberFormat = "@"
 Range("A1").Value = "PI"
 Range("B1").Value = PINo
 NewSum = Application.Sum(Range(Cells(123, 21), Cells(142, 21)))
 NewDisAmt = Round(NewSum * DisRate, 2)
 NewTotal = NewSum - NewDisAmt
 Range("AE1").Value = NewDisAmt
 If NewTotal >= 0 Then
   Range("H1").Value = NewTotal
 Else
   Range("I1").Value = NewTotal * (-1)
 End If
 Range("G1").Value = PINo & " for " & CustName
 Range("K1").Value = NewTotal
 Range("AF1").Value = NewTotal
 Range("W1").Value = DelName
 Range("X1").Value = DelAddress1
 Range("Y1").Value = DelAddress2
 Range("Z1").Value = DelAddress3
 Range("AA1").Value = DelContact
 I = 35
 J = 0
 Range("C123").Select
 Do While ActiveCell.Value <> ""
 If ActiveCell.Offset(0, 17).Value <> 0 Then
  Cells(1, I).NumberFormat = "General"
  Cells(1, I).Value = ActiveCell.Offset(0, 6).Value
  Cells(1, I + 1).NumberFormat = "@"
  Cells(1, I + 1).Value = ActiveCell.Offset(0, 1).Value
  Cells(1, I + 2).NumberFormat = "@"
  Cells(1, I + 2).Value = ActiveCell.Offset(0, 2).Value
  Range(Cells(1, I + 3), Cells(1, I + 6)).NumberFormat = "General"
  Cells(1, I + 3).Value = ActiveCell.Offset(0, 17).Value
  Cells(1, I + 4).Value = ActiveCell.Offset(0, 4).Value
  Cells(1, I + 5).Value = ActiveCell.Offset(0, 18).Value
  Cells(1, I + 6).Value = ActiveCell.Offset(0, 9).Value
  Cells(1, I + 7).NumberFormat = "@"
  Cells(1, I + 7).Value = ActiveCell.Offset(0, 10).Value
  I = I + 8
  J = J + 1
 End If
  ActiveCell.Offset(1, 0).Select
 Loop
 Range("AD1").Value = J
 If J = 0 Then
   PIPartial = "S"
 Else
   PIPartial = "R"
   ThisWorkbook.Worksheets("RunningDat").UsedRange.Delete
   Worksheets("TempRP").Rows(1).Copy
   ThisWorkbook.Worksheets("RunningDat").Activate
   Range("A1").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
 End If
   Worksheets("TempRP").Activate
   Rows(1).ClearContents
   Range("R123:R142").Copy
   Range("F123").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("S123:S142").Copy
   Range("H123").Select
   ActiveSheet.Paste
   Application.CutCopyMode = False
   Range("R123:U142").ClearContents
   Call Form6AmountRefresh("")
   If UCase(PayTerm) <> "C.O.D." And UCase(PayTerm) <> "PREPAID" Then
   CustNo = TextBox1.Text
    I = Application.Match(CustNo, MyBook.Worksheets("Customer Data").Range("B:B"), 0)
    CreditSum = MyBook.Worksheets("Customer Data").Cells(I, 8).Value
    MyBook.Worksheets("Receivable").Activate
    BalSum = 0
   If Range("B4").Value <> "" Then
    Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("P1"), Order1:=xlAscending, Key2:=Range("J1") _
        , Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Set CheckRange = Tbl.Offset(3, 0).Resize(Tbl.Rows.Count - 3, Tbl.Columns.Count).Columns("P")
   If IsError(Application.Match(CustNo, CheckRange, 0)) Then GoTo NoBalance
    FRow = Application.Match(CustNo, CheckRange, 0) + 3
    LRow = Application.Match(CustNo, CheckRange, 1) + 3
    If LRow < FRow Then LRow = FRow
    BalSum = Application.Sum(Range(Cells(FRow, 11), Cells(LRow, 11)))
   End If
NoBalance:
   CreditSum = CreditSum - BalSum
   Label36.Caption = Format(CreditSum, "#,##0.00")
   Label33.Caption = "Available Credit Amount (" & SysCurrency & ") : "
   Label33.Visible = True
   Label36.Visible = True
 Else
  Label33.Visible = False
  Label36.Visible = False
 End If
  ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
  Label1.Caption = "INVOICE"
  Label4.Caption = "Invoice # : "
  Label38.Caption = "INV"
  Label38.Width = 24
  Label38.Visible = True
  Label10.Top = 156
  Label10.Height = 18
  Label10.Caption = "Qty"
  TextBox2.Left = 450
  TextBox2.Text = InvNo
  InvDate = Date
  TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
  TextBox36.Width = 84
  CommandButton1.Caption = "Save"
  CommandButton4.Visible = False
  CommandButton11.Caption = "Issue New Invoice  for the same items"
  CommandButton11.Visible = False
  CommandButton12.Caption = "New Invoice"
  CommandButton13.Caption = "Delete Invoice"
  CommandButton13.Visible = False
  CommandButton15.Caption = "Print-out   Invoice"
  Label60.Visible = True
  CommandButton16.Caption = "Multiple    Print-Out"
  CommandButton16.BackColor = &H800000
  CommandButton16.Visible = True
  CommandButton19.Visible = True
  Label35.Visible = True
  Label35.Left = 84
  Label35.Width = 138
  Label35.Caption = PayTerm
  TextBox39.Visible = False
  TextBox39.Text = ""
  TextBox46.Visible = False
  TextBox46.Text = ""
  CommandButton18.Visible = True
  Label22.Caption = "Payment Due : "
  CommandButton17.Visible = False
  Label57.Visible = False
  For I = 40 To 45
   Controls("TextBox" & I).Visible = False
  Next I
  Call DueDateCal("")
   Call Form6AmountRefresh("")
    ThisWorkbook.Worksheets("TempRP").Activate
    Range("D123").Select
    I = 1
    Do While ActiveCell.Value <> ""
     ActiveCell.Offset(0, 13).Value = I
     I = I + 1
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("M1"), Order1:=xlAscending, Key2:=Range("Q1"), Order2:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
    Range("D123").Select
    Do While ActiveCell.Value <> ""
     If ActiveCell.Offset(0, 9).Value <> "" Then
       StockNo = ActiveCell.Offset(0, 9).Value
       StockQty = ActiveCell.Offset(0, 10).Value
       StockAmt = ActiveCell.Offset(0, 12).Value
       UnitCost = ActiveCell.Offset(0, 7).Value
       If StockQty = ActiveCell.Offset(0, 2).Value Then
          ActiveCell.Offset(0, 8).Value = StockAmt
       Else
         ActiveCell.Offset(0, 8).Value = Round(UnitCost * ActiveCell.Offset(0, 2).Value, 2)
       End If
       Do While ActiveCell.Offset(1, 9).Value = StockNo
        StockQty = Format(StockQty - ActiveCell.Offset(0, 2).Value, "0.0000")
        StockAmt = Format(StockAmt - ActiveCell.Offset(0, 8).Value, "0.00")
        ActiveCell.Offset(1, 10).Value = StockQty
        ActiveCell.Offset(1, 12).Value = StockAmt
        ActiveCell.Offset(1, 7).Value = UnitCost
        If StockQty = ActiveCell.Offset(1, 2).Value Then
          ActiveCell.Offset(1, 8).Value = StockAmt
        Else
         ActiveCell.Offset(1, 8).Value = Round(UnitCost * ActiveCell.Offset(1, 2).Value, 2)
        End If
        ActiveCell.Offset(0, 11).Value = "*"
        ActiveCell.Offset(1, 0).Select
       Loop
     End If
     ActiveCell.Offset(1, 0).Select
    Loop
    Range("A123:Q142").Select
    Selection.Sort Key1:=Range("Q1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
     Range("Q123:Q142").ClearContents
     Range("D123").Select
     Do While ActiveCell.Value <> ""
      If ActiveCell.Offset(0, 2).Value = "" Or ActiveCell.Offset(0, 2).Value = 0 Then
       ActiveCell.EntireRow.Delete
      Else
       ActiveCell.Offset(1, 0).Select
      End If
     Loop
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = I
  Controls("TextBox" & I * 5).Text = Cells(122 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(122 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(122 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(122 + I, 7).Value
  Controls("Label" & I + 40).Caption = Format(Cells(122 + I, 8).Value, "#,##0.00")
  Controls("Label" & I + 50).Caption = Cells(122 + I, 14).Value
  Next I
  Label23.Visible = False
  MsgBox ("REMINDER : " & Chr(13) & Chr(13) & "     This Invoice has not been saved" & Chr(13) & _
    "     Remember to save the invoice after adding necessary data " & Chr(13) & "     (e.g. Invoice Date & etc)." & Chr(13) & Chr(13) & _
    "NOTE : The original Sales Order is deducted with the quantities converted. " & Chr(13) & _
    "              However, this system will not update the Sales Order for subsequent" & Chr(13) & _
    "              changes made in the invoice.  Users are responsible to adjust " & Chr(13) & _
    "              the Sales Order by their own for any amendment in the invoice.")
   EventOff = False
End Sub

Private Sub CommandButton18_Click()
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = True
End Sub

Private Sub CommandButton19_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
 Dim I As Long
 Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = False
 ListBox2.Visible = False
 ListBox3.Visible = False
 Application.EnableEvents = False
 Application.ScreenUpdating = False
 If Label1.Caption = "INVOICE" Or Label1.Caption = "INVOICE " Then
  ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
  PINo = "PI" & InvNo
  Label1.Caption = "SALES ORDER"
  Label4.Caption = "Order Ref # : "
  Label38.Caption = "PI"
  Label38.Width = 18
  Label38.Visible = True
  TextBox2.Left = 444
  TextBox2.Width = 90
  TextBox36.Width = 280
  Label37.Visible = False
  Label60.Visible = False
  Label61.Visible = False
  Label10.Top = 156
  Label10.Height = 18
  Label10.Caption = "Qty"
  CommandButton12.Caption = "New Order"
  CommandButton13.Caption = "Delete Order"
  CommandButton15.Caption = "Print as   Proforma"
  CommandButton16.Caption = "Convert SO to Invoice"
  CommandButton16.BackColor = &H80&
  Label22.Caption = "Ship Schedule : "
  CommandButton18.Visible = True
  CommandButton19.Visible = False
  For I = 1 To 7
   Controls("Label" & I + 49).Visible = True
  Next I
  Call TempRPFormat("AR")
  Label33.Visible = False
  Label36.Visible = False
  Label35.Caption = ""
   Label23.Visible = False
   TextBox4.SetFocus
 End If
 Application.EnableEvents = True
End Sub

Private Sub CommandButton2_Click()
Dim C As String
Application.EnableCancelKey = xlDisabled
 EventOff = False
If CommandButton1.Visible = True And CommandButton1.Caption = "Save" And TotalAmount <> 0 And TextBox1 <> "" Then
AskReply:
   MSG = "This Entry has not been Saved." + Chr(13) + _
   Chr(13) + "Enter 'Y' to confirm leave Without Saving "
    Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo CloseForm
    If C = "N" Or C = "n" Or C = "" Then Exit Sub
    GoTo AskReply
End If
CloseForm:
 Unload Me
 Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 Application.ScreenUpdating = True
 DoEvents
 Application.EnableEvents = True
 Application.ScreenUpdating = False
 UserForm8.Show
End Sub

Private Sub CommandButton3_Click()
 If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 ListBox1.Visible = True
 ListBox2.Visible = False
 ListBox3.Visible = False
 CommandButton14.Visible = False
 Label23.Visible = False
End Sub

Private Sub CommandButton4_Click()
If Label1.Caption <> "INVOICE" And Label1.Caption <> "SALES ORDER" Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox3.Visible = False
Label23.Visible = False
Me.Hide
ThisWorkbook.Worksheets("System Menu").Activate
Application.ScreenUpdating = True
Application.ScreenUpdating = False
UserForm7.CommandButton3.Visible = False
UserForm7.Show
End Sub

Private Sub CommandButton5_Click()
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = True And Label23.Visible = True Then
 LabelAlert = False
 Exit Sub
End If
If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ButtonNo = 5
 Label23.Visible = False
End Sub

Private Sub CommandButton6_Click()
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = True And Label23.Visible = True Then
 LabelAlert = False
 Exit Sub
End If
If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ButtonNo = 6
 Label23.Visible = False
End Sub

Private Sub CommandButton7_Click()
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = True And Label23.Visible = True Then
 LabelAlert = False
 Exit Sub
End If
If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
 ButtonNo = 7
 Label23.Visible = False
End Sub

Private Sub CommandButton8_Click()
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = True And Label23.Visible = True Then
 LabelAlert = False
 Exit Sub
End If
If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
ButtonNo = 8
Label23.Visible = False
End Sub

Private Sub CommandButton9_Click()
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = True And Label23.Visible = True Then
 LabelAlert = False
 Exit Sub
End If
If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
ButtonNo = 9
Label23.Visible = False
End Sub

Private Sub CommandButton10_Click()
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then Exit Sub
Application.EnableCancelKey = xlDisabled
If LabelAlert = True And Label23.Visible = True Then
 LabelAlert = False
 Exit Sub
End If
If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 ListBox2.Visible = True
 ListBox1.Visible = False
 ListBox3.Visible = False
ButtonNo = 10
Label23.Visible = False
End Sub

Private Sub Listbox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox1.List(0) = "No Customer Data" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.Text = "CLOSE this box" Or ListBox1.ListIndex < 0 Or ListBox1.Text = "" Then
 ListBox1.Visible = False
 Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer name" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer #"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
  Exit Sub
End If
If ListBox1.ListIndex = 0 And ListBox1.List(0) = "SWITCH to listing by Customer #" Then
  ListBox1.Visible = False
  ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
  ListBox1.Visible = True
 Exit Sub
End If
 EventOff = True
 RowNo = ListBox1.ListIndex + 2
 MyBook.Worksheets("Customer Data").Activate
 CustNo = Cells(RowNo, 2).Value
 TextBox1.Text = CustNo
 Call Form6Text1Exit("AR")
 EventOff = False
End Sub

Private Sub ListBox2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Dim RowNo As Long
Application.EnableCancelKey = xlDisabled
If ListBox2.List(0) = "No Registered Product" Then
 ListBox2.Visible = False
 CommandButton14.Visible = False
 Exit Sub
End If
If ListBox2.Text = "CLOSE this box" Or ListBox2.ListIndex < 0 Or ListBox2.Text = "" Then
 ListBox2.Visible = False
 CommandButton14.Visible = False
 Exit Sub
End If
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Product Description" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("C1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox2.AddItem "SWITCH to listing by Product #"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Registered Product"
 End If
 ListBox2.AddItem "CLOSE this box"
 ListBox2.Visible = True
 If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 Exit Sub
End If
If ListBox2.ListIndex = 0 And ListBox2.List(0) = "SWITCH to listing by Product #" Then
  ListBox2.Visible = False
  ListBox2.Clear
  MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox2.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Registered Product"
 End If
 ListBox2.AddItem "CLOSE this box"
 ListBox2.Visible = True
 If Label1.Caption = "INVOICE" Or Label1.Caption = "SALES ORDER" Then CommandButton14.Visible = True
 Exit Sub
End If
EventOff = True
RowNo = ListBox2.ListIndex + 2
Form6TextNo = (ButtonNo - 4) * 5
Form6RowNo = Val(Controls("Label" & ButtonNo + 10).Caption)
ListBox2.Visible = False
CommandButton14.Visible = False
MyBook.Worksheets("Product Data").Activate
Controls("TextBox" & Form6TextNo).Text = Cells(RowNo, 2).Value
Call Form6Col1Exit("List")
 EventOff = False
End Sub

Private Sub ListBox3_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
Application.EnableCancelKey = xlDisabled
If ListBox3.Text = "CLOSE this box" Or ListBox3.ListIndex < 0 Or ListBox3.Text = "" Then
 ListBox3.Visible = False
 Exit Sub
End If
EventOff = True
If ListBox3.Text <> "C.O.D." And ListBox3.Text <> "Prepaid" And ListBox3.Text <> "User Input" Then
  Label35.Visible = True
  TextBox39.Visible = True
  TextBox46.Visible = False
  Label35.Left = 114
  Label35.Width = 108
  TextBox39.Width = 30
 If ListBox3.Text = "# of Days" Then Label35.Caption = "Days"
 If ListBox3.Text = "# of Days after EOM" Then Label35.Caption = "Days after EOM"
 TextBox39.Visible = True
  If TextBox39.Text = "" Then
   If Val(PayTerm) = 0 Then
      TextBox39.Text = "30"
    Else
     TextBox39.Text = Val(PayTerm)
    End If
  End If
   PayTerm = TextBox39.Text & " " & Label35.Caption
ElseIf ListBox3.Text = "User Input" Then
  TextBox39.Visible = False
  Label35.Visible = False
  TextBox46.Visible = True
  TextBox46.SetFocus
Else
 Label35.Left = 84
 Label35.Width = 138
 Label35.Caption = ListBox3.Text
 TextBox39.Text = ""
 Label35.Visible = True
 TextBox39.Visible = False
 TextBox46.Visible = False
 PayTerm = Label35.Caption
End If
 Call DueDateCal("")
 ListBox3.Visible = False
 EventOff = False
End Sub
Private Sub ScrollBar1_Change()
 Dim LineNo As Long, I As Long
 Application.EnableCancelKey = xlDisabled
 LineNo = ScrollBar1.Value
 ThisWorkbook.Worksheets("TempRP").Activate
 For I = 1 To 6
  Controls("Label" & I + 14).Caption = LineNo + I - 1
  Controls("TextBox" & I * 5).Text = Cells(LineNo + 121 + I, 4).Value
  Controls("TextBox" & I * 5 + 1).Text = Cells(LineNo + 121 + I, 5).Value
  Controls("TextBox" & I * 5 + 2).Text = Cells(LineNo + 121 + I, 6).Value
  Controls("TextBox" & I * 5 + 3).Text = Cells(LineNo + 121 + I, 7).Value
  Controls("Label" & I + 40).Caption = Format(Cells(LineNo + 121 + I, 8).Value, "#,##0.00")
  Controls("Label" & I + 50).Caption = Cells(LineNo + 121 + I, 14).Value
  Controls("Textbox" & I + 39).Text = Cells(LineNo + 121 + I, 18).Value
  Next I
 Call Form6AmountRefresh("")
End Sub

Private Sub TextBox1_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox1.Text = CustNo
 EventOff = False
 Exit Sub
End If
Call Form6Text1Exit("AR")
EventOff = False
End Sub

Private Sub TextBox1_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox11_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox12_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox13_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox16_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox17_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox18_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox2_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
CommandButton1.Visible = False
CommandButton13.Visible = False
CommandButton17.Visible = False
CommandButton18.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim InvRow As Long, I As Long, J As Long, K As Long, InvPrefix As String, ProdRow As Long, ProductNo As String
Dim StockQty As Double, StockAmt As Double, InvInput As String
Application.EnableCancelKey = xlDisabled
 EventOff = True
InvInput = UCase(TextBox2.Text)
If Left(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = 1
 Do While J <= I And Mid(InvInput, J, 1) = " "
  J = J + 1
 Loop
  If J > I Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Right(InvInput, I - J + 1)
  End If
End If
If Right(InvInput, 1) = " " Then
 I = Len(InvInput)
 J = I
 Do While J > 0 And Mid(InvInput, J, 1) = " "
  J = J - 1
 Loop
  If J = 0 Then
    InvInput = ""
    GoTo InputChecked
  Else
   InvInput = Left(InvInput, J)
  End If
End If
InputChecked:
If InvInput = "" Then InvInput = "0"
TextBox2.Text = InvInput
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
 Call Form6ViewOnly("")
  Instr1 = TextBox47.Text
  Instr2 = TextBox48.Text
  Instr3 = TextBox49.Text
 EventOff = False
 Exit Sub
End If
If Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "CREDIT NOTE " Then
 Call CreditNo("")
  Instr1 = TextBox47.Text
  Instr2 = TextBox48.Text
  Instr3 = TextBox49.Text
 EventOff = False
 Exit Sub
End If
If Label1.Caption = "SALES ORDER" Or Label1.Caption = "SALES ORDER " Then
 EventOff = True
 Call PInvoice(PINo)
  Instr1 = TextBox47.Text
  Instr2 = TextBox48.Text
  Instr3 = TextBox49.Text
 EventOff = False
 Exit Sub
End If
 Label1.Caption = "INVOICE"
InvNo = TextBox2.Text
If IsNumeric(InvNo) Then
 If Len(InvNo) < 7 Then
   InvNo = Right(("000000" & InvNo), 6)
   If InvNo = "000000" Then
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1)), 6)
   ElseIf IsError(Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = True Then
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1)), 6)
   End If
  Label38.Visible = True
  TextBox2.Left = 450
  TextBox2.Width = 90
 Else
  InvNo = InvNo & " "
  Label38.Visible = False
  TextBox2.Left = 426
  TextBox2.Width = 114
 End If
ElseIf Len(InvInput) > 3 Then
 If Left(InvInput, 3) = "INV" Then
  If IsNumeric(Right(InvInput, Len(InvInput) - 3)) Then
   InvNo = Right(InvInput, Len(InvInput) - 3)
   InvNo = Right("000000" & InvNo, 6)
   If InvNo = "000000" Then
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1)), 6)
   ElseIf IsError(Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = True Then
     InvNo = Right(("000000" & (Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1)), 6)
   End If
   Label38.Visible = True
   TextBox2.Left = 450
   TextBox2.Width = 90
  Else
   InvNo = InvNo & " "
   Label38.Visible = False
   TextBox2.Left = 426
   TextBox2.Width = 114
  End If
 ElseIf Left(InvInput, 2) = "CN" Then
   If Len(InvInput) = 7 Then
    If IsNumeric(Right(InvInput, 5)) Then
      InvNo = "CN0" & Right(InvInput, 5) & " "
      Label38.Visible = False
      TextBox2.Left = 426
      TextBox2.Width = 114
    Else
     InvNo = InvNo & " "
     Label38.Visible = False
     TextBox2.Left = 426
     TextBox2.Width = 114
    End If
   Else
     InvNo = InvNo & " "
     Label38.Visible = False
     TextBox2.Left = 426
     TextBox2.Width = 114
   End If
 Else
   InvNo = InvNo & " "
   Label38.Visible = False
   TextBox2.Left = 426
   TextBox2.Width = 114
 End If
ElseIf InvInput = "INV" Then
  InvNo = Right(("000000" & (Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1)), 6)
  Label38.Visible = True
  TextBox2.Left = 450
  TextBox2.Width = 90
Else
  InvNo = InvNo & " "
 Label38.Visible = False
 TextBox2.Left = 426
 TextBox2.Width = 114
End If
TextBox2.Text = InvNo
 Label35.Visible = True
 Label35.Left = 84
 Label35.Width = 138
 TextBox39.Visible = False
 TextBox39.Text = ""
 TextBox46.Visible = False
 TextBox46.Text = ""
If IsError(Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)) = True Then
 If CommandButton1.Caption <> "Save" Or Label51.Visible = False Or ThisWorkbook.Worksheets("TempRP").Range("D100") <> "" Or _
   (IsNumeric(InvNo) = True And Len(InvNo) < 7) Then
  PINo = ""
  Call TempRPFormat("AR")
  Call Form6Text1Exit("AR")
  Label23.Caption = Chr(13) & Chr(13) & "    The Invoice is not found from the record.  "
  Label23.Visible = True
  For I = 50 To 56
   Controls("Label" & I).Visible = True
  Next I
  CommandButton18.Visible = True
 Else
  If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
   CommandButton1.Visible = False
  Else
   CommandButton1.Visible = True
   CommandButton18.Visible = True
  End If
 End If
   EventOff = False
   Exit Sub
Else
 PINo = ""
 CommandButton1.Caption = "Edit"
 Label1.Caption = "INVOICE "
 InvRow = Application.Match(InvNo, MyBook.Worksheets("Receivable").Range("B:B"), 0)
 ThisWorkbook.Worksheets("TempRP").UsedRange.EntireRow.Delete
 MyBook.Worksheets("Receivable").Activate
 Cells(InvRow, 1).EntireRow.Copy
 ThisWorkbook.Worksheets("TempRP").Activate
 Cells(1, 1).Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 InvStatus = Range("J1").Value
 CustNo = Range("P1").Value
 CustName = Range("Q1").Value
 Address1 = Range("R1").Value
 Address2 = Range("S1").Value
 Address3 = Range("T1").Value
 CustContact = Range("U1").Value
 TelNo = Range("V1").Value
 DelName = Range("W1").Value
 DelAddress1 = Range("X1").Value
 DelAddress2 = Range("Y1").Value
 DelAddress3 = Range("Z1").Value
 DelContact = Range("AA1").Value
 SalesRep = Range("AC1").Value
 DisAmount = Range("AE1").Value
 TotalAmount = Range("AF1").Value
 InvPrefix = Range("AH1").Value
 DisRate = Range("AG1").Value
 InvDate = Range("D1").Value
 DueDate = Range("N1").Value
 CustPO = Range("AB1").Value
 PayTerm = Range("O1").Value
 If Range("IS1").Value = "" Then
  Instr1 = Range("IT1").Value
  Instr2 = Range("IU1").Value
  Instr3 = Range("IV1").Value
 Else
  Instr1 = ""
  Instr2 = ""
  Instr3 = ""
 End If
 If TelNo <> "" Then
  Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
  "     " & Address1 & Chr(13) & _
  "     " & Address2 & Chr(13) & _
  "     " & Address3 & Chr(13) & _
  "     Contact: " & CustContact & " (Tel: " & TelNo & ")"
 Else
  Label3.Caption = "Customer :   " & Chr(13) & "     " & CustName & Chr(13) & _
  "     " & Address1 & Chr(13) & _
  "     " & Address2 & Chr(13) & _
  "     " & Address3 & Chr(13) & _
  "     Contact: " & CustContact
 End If
 Label7.Caption = "Delivered To :   " & Chr(13) & "     " & DelName & Chr(13) & _
 "     " & DelAddress1 & Chr(13) & _
 "     " & DelAddress2 & Chr(13) & _
 "     " & DelAddress3 & Chr(13) & _
 "     Contact: " & DelContact
 TextBox1.Text = CustNo
 TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 TextBox4.Text = CustPO
 TextBox35.Text = SalesRep
 TextBox36.Text = Format(DueDate, "yyyy/mm/dd")
 TextBox38.Text = InvPrefix
 Label35.Caption = PayTerm
 TextBox47.Text = Instr1
 TextBox48.Text = Instr2
 TextBox49.Text = Instr3
 Label14.Caption = DisRate * 100 & "% Discount " & "(" & SysCurrency & ") : "
 If DisAmount = 0 Then
  Label47.Caption = Format(DisAmount, "#,##0.00")
 Else
  Label47.Caption = Format((DisAmount * (-1)), "#,##0.00")
 End If
 Label25.Caption = Format(TotalAmount, "#,##0.00")
For I = 15 To 20
 Controls("Label" & I).Caption = I - 14
Next I
J = 122
K = 1
For I = 5 To 164 Step 8
 ActiveCell.Offset(J, K + 1).NumberFormat = "General"
 ActiveCell.Offset(J, K + 7).NumberFormat = "General"
 ActiveCell.Offset(J, K + 2).NumberFormat = "@"
 ActiveCell.Offset(J, K + 3).NumberFormat = "@"
 ActiveCell.Offset(J, K + 11).NumberFormat = "@"
 ActiveCell.Offset(J, K + 7).Value = Cells(1, I + 30).Value
 ActiveCell.Offset(J, K + 2).Value = Cells(1, I + 31).Value
 ActiveCell.Offset(J, K + 3).Value = Cells(1, I + 32).Value
 ActiveCell.Offset(J, K + 4).Value = Cells(1, I + 33).Value
 ActiveCell.Offset(J, K + 5).Value = Cells(1, I + 34).Value
 ActiveCell.Offset(J, K + 6).Value = Cells(1, I + 35).Value
 ActiveCell.Offset(J, K + 10).Value = Cells(1, I + 36).Value
 ActiveCell.Offset(J, K + 11).Value = Cells(1, I + 37).Value
 J = J + 1
 K = 1
 Next I
 Range("D123").Select
 For I = 5 To 34 Step 5
  Controls("TextBox" & I).Text = ActiveCell.Value
  Controls("TextBox" & I + 1).Text = ActiveCell.Offset(0, 1).Value
  Controls("TextBox" & I + 2).Text = ActiveCell.Offset(0, 2).Value
  Controls("TextBox" & I + 3).Text = ActiveCell.Offset(0, 3).Value
  Controls("Label" & I / 5 + 40).Caption = ActiveCell.Offset(0, 4).Value
  ActiveCell.Offset(1, 0).Select
 Next I
 ScrollBar1.Value = 1
For J = 41 To 46
  If IsNumeric(Controls("Label" & J).Caption) Then Controls("Label" & J).Caption = Format(Controls("Label" & J).Caption, "#,##0.00")
Next J
End If
Range("A1").EntireRow.ClearContents
 CommandButton11.Visible = True
If InvStatus <> "*" Or InvDate < BeginningDate Then
  CommandButton1.Visible = False
Else
 CommandButton1.Caption = "Edit"
 CommandButton1.Visible = True
End If
 TotalSum = Application.Sum(Range(Cells(123, 8), Cells(142, 8)))
 Label40.Caption = Format(TotalSum, "#,##0.00")
Label23.Visible = False
Label33.Visible = False
Label36.Visible = False
Label37.Visible = False
ListBox1.Visible = False
ListBox2.Visible = False
CommandButton13.Visible = False
CommandButton14.Visible = False
 For I = 50 To 56
  Controls("Label" & I).Visible = False
 Next I
If InvDate < BeginningDate Then
 EventOff = False
 Exit Sub
End If
 Range("A123:P142").Copy
 Range("A100").Select
 ActiveSheet.Paste
 Application.CutCopyMode = False
 Range("D100").Select
 Do While ActiveCell.Value <> ""
  If ActiveCell.Offset(0, 2).Value = "" Then
   ActiveCell.Offset(0, 2).Value = 0
  Else
   ActiveCell.Offset(0, 2).Value = ActiveCell.Offset(0, 2).Value * (-1)
  End If
  If ActiveCell.Offset(0, 8).Value = "" Then
   ActiveCell.Offset(0, 8).Value = 0
  Else
   ActiveCell.Offset(0, 8).Value = ActiveCell.Offset(0, 8).Value * (-1)
  End If
  ActiveCell.Offset(1, 0).Select
 Loop
 Range("A100").Value = InvDate
 EventOff = False
End Sub

Private Sub TextBox21_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox22_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox23_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox26_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox27_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox28_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox3_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
EventOff = True
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
 EventOff = False
End If
 Label23.Visible = False
 If TextBox3.Text = "" Then
  EventOff = False
  Exit Sub
 End If
 DateString = TextBox3.Text
 Call DateConvert(DateString)
 If IsDate(DateString) = False Then
  Cancel = True
  Label23.Caption = Chr(13) & "    Incorrect Date Input. "
  Label23.Visible = True
  LabelAlert = True
  EventOff = False
  Exit Sub
 Else
  InvDate = DateString
  TextBox3.Text = Format(InvDate, "yyyy/mm/dd")
  If InvDate < BeginningDate Then
   If Label1.Caption <> "SALES ORDER" Then
    If MyBook.Worksheets("Raw Data").Range("F1").Value = 1 Then
AskReply:
      MSG = "WARNING!!!" & Chr(13) & Chr(13) & "The date entered belongs to previous year" & Chr(13) & _
       "Thus, no posting to the Inventory and the General Ledger." & Chr(13) & Chr(13) _
        + "Enter 'Y' to confirm proceed.  Or 'N' to Cancel"
      Title = "WARNING"
      C = InputBox(MSG, Title)
      If C = "Y" Or C = "y" Then
       OldData = True
       GoTo DateProceed
      End If
     If C = "N" Or C = "n" Or C = "" Then
       Label23.Caption = Chr(13) & "    Please enter a new Date. "
       Label23.Visible = True
       LabelAlert = True
       EventOff = False
       Exit Sub
     End If
      GoTo AskReply
    Else
     Label23.Caption = Chr(13) & "    The date entered belongs to previous Posted year which is not allowed" & _
     Chr(13) & "    Please enter a new Date. "
     Label23.Visible = True
     LabelAlert = True
     EventOff = False
     Exit Sub
    End If
   End If
  End If
DateProceed:
  Call DueDateCal("")
 End If
 EventOff = False
End Sub

Private Sub TextBox31_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox32_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox33_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox35_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox35_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox35.Text = SalesRep
 Exit Sub
End If
SalesRep = TextBox35.Text
End Sub

Private Sub TextBox36_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox36_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim DateString As String
Application.EnableCancelKey = xlDisabled
If Label1.Caption <> "INVOICE" And Label1.Caption <> "SALES ORDER" Then
 TextBox36.Text = Format(DueDate, "yyyy/mm/dd")
 Exit Sub
End If
If Label1.Caption = "SALES ORDER" Then Exit Sub
If TextBox36.Text = "" Then Exit Sub
DateString = TextBox36.Text
 Call DateConvert(DateString)
If IsDate(DateString) = False Then
  Cancel = True
  Label23.Caption = Chr(13) & "    Not a Valid Date. "
  Label23.Visible = True
  LabelAlert = True
  Exit Sub
Else
 DueDate = DateString
 TextBox36.Text = Format(DueDate, "yyyy/mm/dd")
 Label23.Visible = False
End If
End Sub
Private Sub TextBox38_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox39_AfterUpdate()
If Label1.Caption = "CREDIT NOTE " Then
  TextBox39.Text = DelName
ElseIf Label1.Caption = "CREDIT NOTE" Then
  DelName = TextBox39.Text
Else
  If IsNumeric(TextBox39.Text) = False Then
   EventOff = True
   If Val(PayTerm) = 0 Then
      TextBox39.Text = "30"
    Else
     TextBox39.Text = Val(PayTerm)
    End If
    Label23.Caption = Chr(13) & "     Incorrect Input.  It must be a number     "
    Label23.Visible = True
    EventOff = False
    Exit Sub
  End If
 If UCase(Right(Label35.Caption, 4)) = "DAYS" Or UCase(Right(Label35.Caption, 4)) = " EOM" Then
  PayTerm = TextBox39.Text & " " & Label35.Caption
 End If
  Call DueDateCal("")
End If
End Sub

Private Sub TextBox39_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox4_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox4_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox4.Text = CustPO
 Exit Sub
End If
 CustPO = TextBox4.Text
End Sub

Private Sub TextBox40_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label15.Caption)
 Call Form6Col7Exit(Form6RowNo, 1)
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox40_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
   Form6RowNo = Val(Label15.Caption)
   Call Form6Col7Exit(Form6RowNo, 1)
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox41.SetFocus
      SendKeys "{Up}", False
  End If
 EventOff = False
End Sub
Private Sub TextBox41_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label16.Caption)
 Call Form6Col7Exit(Form6RowNo, 2)
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox42_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label17.Caption)
 Call Form6Col7Exit(Form6RowNo, 3)
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox43_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label18.Caption)
 Call Form6Col7Exit(Form6RowNo, 4)
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox44_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label19.Caption)
 Call Form6Col7Exit(Form6RowNo, 5)
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox45_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label20.Caption)
 Call Form6Col7Exit(Form6RowNo, 6)
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox45_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyDown Then
  Form6RowNo = Val(Label20.Caption)
  Call Form6Col7Exit(Form6RowNo, 6)
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox44.SetFocus
     SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox46_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Application.EnableCancelKey = xlDisabled
PayTerm = TextBox46.Text & "    "
Label35.Caption = PayTerm
Label35.Left = 84
Label35.Width = 138
End Sub

Private Sub TextBox47_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
End Sub

Private Sub TextBox47_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox47.Text = Instr1
 EventOff = False
 Exit Sub
End If
 Instr1 = TextBox47.Text
End Sub

Private Sub TextBox48_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
End Sub

Private Sub TextBox48_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox48.Text = Instr2
 EventOff = False
 Exit Sub
End If
 Instr2 = TextBox48.Text
End Sub

Private Sub TextBox49_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
End Sub

Private Sub TextBox49_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox49.Text = Instr3
 EventOff = False
 Exit Sub
End If
 Instr3 = TextBox49.Text
End Sub

Private Sub TextBox5_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label15.Caption)
 Form6TextNo = 5
 Call Form6Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox5_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox6_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label15.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox6.Text = Cells(Form6RowNo + 122, 5).Value
 EventOff = False
 Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 5).Value = TextBox6.Text
 EventOff = False
End Sub

Private Sub TextBox6_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox7_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label15.Caption)
 Form6TextNo = 7
 Call Form6Col3Exit("AR")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox7_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox7_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox7.Text) = False And TextBox7.Text <> "" And TextBox5.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox7_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
EventOff = True
If KeyCode = vbKeyUp Then
   Form6RowNo = Val(Label15.Caption)
   Form6TextNo = 7
   Call Form6Col3Exit("AR")
  If ScrollBar1.Value > 1 Then ScrollBar1.Value = ScrollBar1.Value - 1
     TextBox12.SetFocus
      SendKeys "{Up}", False
  End If
 EventOff = False
End Sub

Private Sub TextBox8_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label15.Caption)
 Form6TextNo = 8
 Call Form6Col4Exit("AR")
 EventOff = False
End Sub

Private Sub TextBox8_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox8_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox8.Text) = False And TextBox8.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox10_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label16.Caption)
 Form6TextNo = 10
 Call Form6Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox10_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox11_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label16.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox11.Text = Cells(Form6RowNo + 122, 5).Value
 EventOff = False
 Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 5).Value = TextBox11.Value
 EventOff = False
End Sub

Private Sub TextBox12_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label16.Caption)
 Form6TextNo = 12
 Call Form6Col3Exit("AR")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox12_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox12.Text) = False And TextBox12.Text <> "" And TextBox10.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox13_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label16.Caption)
 Form6TextNo = 13
 Call Form6Col4Exit("AR")
 EventOff = False
End Sub

Private Sub TextBox13_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox13.Text) = False And TextBox13.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox15_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label17.Caption)
 Form6TextNo = 15
 Call Form6Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox15_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox16_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label17.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox16.Text = Cells(Form6RowNo + 122, 5).Value
 EventOff = False
 Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 5).Value = TextBox16.Value
 EventOff = False
End Sub

Private Sub TextBox17_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label17.Caption)
 Form6TextNo = 17
 Call Form6Col3Exit("AR")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox17_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox17.Text) = False And TextBox17.Text <> "" And TextBox15.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox18_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label17.Caption)
 Form6TextNo = 18
 Call Form6Col4Exit("AR")
 EventOff = False
End Sub

Private Sub TextBox18_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox18.Text) = False And TextBox18.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox20_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label18.Caption)
 Form6TextNo = 20
 Call Form6Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox20_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox21_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label18.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox21.Text = Cells(Form6RowNo + 122, 5).Value
 EventOff = False
 Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 5).Value = TextBox21.Value
 EventOff = False
End Sub

Private Sub TextBox22_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label18.Caption)
 Form6TextNo = 22
 Call Form6Col3Exit("AR")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox22_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox22.Text) = False And TextBox22.Text <> "" And TextBox20.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox23_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label18.Caption)
 Form6TextNo = 23
 Call Form6Col4Exit("AR")
 EventOff = False
End Sub

Private Sub TextBox23_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox23.Text) = False And TextBox23.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox25_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label19.Caption)
 Form6TextNo = 25
 Call Form6Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox25_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox26_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label19.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox26.Text = Cells(Form6RowNo + 122, 5).Value
 EventOff = False
 Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 5).Value = TextBox26.Value
 EventOff = False
End Sub

Private Sub TextBox27_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label19.Caption)
 Form6TextNo = 27
 Call Form6Col3Exit("AR")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox27_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox27.Text) = False And TextBox27.Text <> "" And TextBox25.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox28_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label19.Caption)
 Form6TextNo = 28
 Call Form6Col4Exit("AR")
 EventOff = False
End Sub

Private Sub TextBox28_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox28.Text) = False And TextBox28.Text <> "" Then Cancel = True
End Sub

Private Sub TextBox30_AfterUpdate()
 If EventOff = True Then Exit Sub
 Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label20.Caption)
 Form6TextNo = 30
 Call Form6Col1Exit("")
 EventOff = False
End Sub

Private Sub TextBox30_Enter()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
ListBox1.Visible = False
ListBox2.Visible = False
ListBox3.Visible = False
CommandButton14.Visible = False
LabelAlert = False
End Sub

Private Sub TextBox31_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label20.Caption)
 ThisWorkbook.Worksheets("TempRP").Activate
If Not (Label1.Caption = "INVOICE" Or Label1.Caption = "CREDIT NOTE" Or Label1.Caption = "SALES ORDER") Then
 TextBox31.Text = Cells(Form6RowNo + 122, 5).Value
 EventOff = False
 Exit Sub
End If
 ThisWorkbook.Worksheets("TempRP").Cells(Form6RowNo + 122, 5).Value = TextBox31.Value
 EventOff = False
End Sub

Private Sub TextBox32_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label20.Caption)
 Form6TextNo = 32
 Call Form6Col3Exit("AR")
 If Label23.Visible = True Then
  LabelAlert = True
 Else
  LabelAlert = False
 End If
 EventOff = False
End Sub

Private Sub TextBox32_Exit(ByVal Cancel As MSForms.ReturnBoolean)
If IsNumeric(TextBox32.Text) = False And TextBox32.Text <> "" And TextBox30.Text <> "" _
 Then Cancel = True
End Sub

Private Sub TextBox32_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
If KeyCode = vbKeyDown Then
  Form6RowNo = Val(Label20.Caption)
  Form6TextNo = 32
  Call Form6Col3Exit("AR")
  If ScrollBar1.Value < ScrollBar1.Max Then ScrollBar1.Value = ScrollBar1.Value + 1
     TextBox27.SetFocus
     SendKeys "{Down}", False
 End If
 EventOff = False
End Sub

Private Sub TextBox33_AfterUpdate()
If EventOff = True Then Exit Sub
Application.EnableCancelKey = xlDisabled
 EventOff = True
 Form6RowNo = Val(Label20.Caption)
 Form6TextNo = 33
 Call Form6Col4Exit("AR")
 EventOff = False
 End Sub
 
Private Sub TextBox33_Exit(ByVal Cancel As MSForms.ReturnBoolean)
 If IsNumeric(TextBox33.Text) = False And TextBox33.Text <> "" Then Cancel = True
End Sub

Private Sub UserForm_Initialize()
Dim AddNo As Long
Application.EnableCancelKey = xlDisabled
Me.Zoom = FormZoom
If FormZoom < 40 Then
  AddNo = 4
ElseIf FormZoom < 60 Then
  AddNo = 3
ElseIf FormZoom < 80 Then
  AddNo = 2
ElseIf FormZoom < 90 Then
  AddNo = 1
Else
 AddNo = 0
End If
Me.Height = Me.Height * (FormZoom + AddNo) / 100
Me.Width = Me.Width * (FormZoom + AddNo) / 100
ListBox1.Clear
  MyBook.Worksheets("Customer Data").Activate
 If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox1.AddItem "SWITCH to listing by Customer name"
  Do While ActiveCell.Value <> ""
   ListBox1.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox1.AddItem "No Customer Data"
 End If
  ListBox1.AddItem "CLOSE this box"
ListBox2.Clear
MyBook.Worksheets("Product Data").Activate
  If Range("B3") <> "" Then
   Set Tbl = ActiveSheet.UsedRange
    Tbl.Offset(2, 0).Resize(Tbl.Rows.Count - 2, Tbl.Columns.Count).Select
    Selection.Sort Key1:=Range("B1"), Order1:=xlAscending, Header:=xlNo, OrderCustom:=1, MatchCase:= _
        False, Orientation:=xlTopToBottom
  Range("B3").Select
  ListBox2.AddItem "SWITCH to listing by Product Description"
  Do While ActiveCell.Value <> ""
   ListBox2.AddItem "  " & ActiveCell.Value & "  -- " & ActiveCell.Offset(0, 1).Value
   ActiveCell.Offset(1, 0).Select
  Loop
 Else
  ListBox2.AddItem "No Registered Product"
 End If
ListBox2.AddItem "CLOSE this box"
ThisWorkbook.Worksheets("ComFactSheet").Activate
Range("E1").Select
ListBox3.Clear
Do While ActiveCell.Value <> ""
 ListBox3.AddItem ActiveCell.Value
 ActiveCell.Offset(1, 0).Select
Loop
ListBox3.AddItem "User Input"
ListBox3.Value = "C.O.D."
CustNo = ""
InvDate = Date
 DueDate = Date
 EventOff = True
 Label33.Caption = "Available Credit Amount (" & SysCurrency & ") : "
If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Then
  Label1.Caption = "INVOICE"
  InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
  PINo = ""
  CommandButton15.Caption = "Print-out   Invoice"
  Label60.Visible = True
  Label38.Caption = "INV"
  Label38.Width = 24
  TextBox2.Left = 450
  CommandButton19.Visible = True
ElseIf ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE" Then
  InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
  PINo = "PI" & InvNo
  Label1.Caption = "SALES ORDER"
  Label4.Caption = "Order Ref # : "
  Label38.Caption = "PI"
  Label38.Width = 18
  TextBox2.Left = 444
  TextBox36.Width = 280
  Label61.Visible = False
  CommandButton12.Caption = "New Order"
  CommandButton13.Caption = "Delete Order"
  CommandButton15.Caption = "Print as   Proforma"
  CommandButton16.Caption = "Convert SO to Invoice"
  CommandButton16.BackColor = &H80&
  Label22.Caption = "Ship Schedule : "
Else
  InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1), 5)
  Label1.Caption = "CREDIT NOTE"
  Label4.Caption = "Credit Note # : "
  Label6.Caption = " Ref Invoice : "
  Label7.Visible = False
  Label22.Visible = False
  Label34.Caption = "Remarks : "
  TextBox39.Visible = True
  Label35.Visible = False
  TextBox36.Visible = False
  Label61.Visible = False
  TextBox38.Visible = False
  Label38.Caption = "CN"
  Label38.Width = 18
  TextBox2.Left = 444
  CommandButton4.Visible = False
  CommandButton12.Caption = "New" & Chr(13) & "Credit Note"
  CommandButton13.Caption = "Delete" & Chr(13) & "Credit Note"
  CommandButton15.Caption = "Print-out   This CN"
  CommandButton18.Visible = False
  For I = 50 To 56
   Controls("Label" & I).Visible = False
  Next I
  Label59.Visible = True
End If
Call TempRPFormat("AR")
If MyBook.Worksheets("ComData").Range("B14").Value = "Year End File" Or FileStatus = "AlertEnd" Or FileStatus = "ReadOnly" Then
  If ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "INVOICE" Then
    Label1.Caption = "INVOICE "
    InvNo = Right(("000000" & Val(MyBook.Worksheets("Receivable").Range("A1").Value) + 1), 6)
    PINo = ""
  ElseIf ThisWorkbook.Worksheets("NewCom").Range("A6").Value = "PROFORMA INVOICE" Then
    Label1.Caption = "SALES ORDER "
    InvNo = Right(("000000" & Val(MyBook.Worksheets("ProInvoice").Range("A1").Value) + 1), 6)
    PINo = "PI" & InvNo
    CommandButton16.Visible = False
  Else
    InvNo = Right(("00000" & Val(MyBook.Worksheets("Receivable").Range("F1").Value) + 1), 5)
    Label1.Caption = "CREDIT NOTE "
  End If
 CommandButton1.Visible = False
 CommandButton3.Visible = False
 CommandButton4.Visible = False
 CommandButton12.Visible = False
 CommandButton18.Visible = False
 CommandButton19.Visible = False
  For I = 50 To 56
   Controls("Label" & I).Visible = False
  Next I
End If
 PIPartial = ""
 EventOff = False
End Sub

Private Sub UserForm_Terminate()
Application.EnableCancelKey = xlDisabled
If ThisWorkbook.Worksheets("NewCom").Range("A8").Value = "C" Then
 On Error Resume Next
 MyBook.Save
 On Error GoTo 0
 ThisWorkbook.Worksheets("NewCom").Range("A8").ClearContents
End If
ThisWorkbook.Worksheets("NewCom").Range("A6").ClearContents
Application.EnableEvents = False
 ThisWorkbook.Worksheets("System Menu").Activate
 SheetName = "System Menu"
 Application.EnableEvents = True
End Sub

' InQuest injected base64 decoded content
' {Qjx
' )^J)

INQUEST-PP=macro
