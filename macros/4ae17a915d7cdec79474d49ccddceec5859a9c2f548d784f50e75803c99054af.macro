Attribute VB_Name = "AddPayment"
Attribute VB_Base = "0{DA3549C1-F0AF-4687-8547-4BA5A8D45977}{355292E2-BDBF-40C2-A22D-3D2ED7659CF5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim personnel As String
 Dim personelName As String
 Dim personelAccount As String
 Dim personelIBAN As String

Private Sub btnCancel_Click()
Unload Me

End Sub

Private Sub btnOK_Click()
If cbPersonnel.ListCount = 0 Then
MsgBox "Kay|fffd|tl|fffd| Personel Bulunmamaktad|fffd|r"
Else


If Trim(txtAmount.Text) = Empty Then
MsgBox "L|fffd|tfen tutar giriniz"

ElseIf IsNumeric(txtAmount.Text) = False Then
MsgBox "L|fffd|tfen tutar alan|fffd|na say|fffd|sal veri giriniz"
Else
personel = cbPersonnel.Value
personnelName = Worksheets("PERSONEL").Range("A" & cbPersonnel.ListIndex + 8).Value
personnelBranch = Worksheets("PERSONEL").Range("C" & cbPersonnel.ListIndex + 8).Value
personnelAccount = Worksheets("PERSONEL").Range("D" & cbPersonnel.ListIndex + 8).Value
personnelSuffix = Worksheets("PERSONEL").Range("E" & cbPersonnel.ListIndex + 8).Value
personnelIBAN = Worksheets("PERSONEL").Range("B" & cbPersonnel.ListIndex + 8).Value



personnelTax = Worksheets("PERSONEL").Range("F" & cbPersonnel.ListIndex + 8).Value
personnelTC = Worksheets("PERSONEL").Range("G" & cbPersonnel.ListIndex + 8).Value
i = 10
While c = 0

If (Worksheets("MAAS").Range("A" & i).Value) = Empty Then
    
    Worksheets("MAAS").Range("A" & i).Value = personnelName
    Worksheets("MAAS").Range("B" & i).Value = personnelIBAN
    Worksheets("MAAS").Range("C" & i).Value = personnelBranch
    Worksheets("MAAS").Range("D" & i).Value = personnelAccount
    Worksheets("MAAS").Range("E" & i).Value = personnelSuffix
    Worksheets("MAAS").Range("F" & i).Value = CCur(txtAmount.Text)
    Worksheets("MAAS").Range("G" & i).Value = txtExplanation.Text
    Worksheets("MAAS").Range("H" & i).Value = txtFirmReferance.Text
    Worksheets("MAAS").Range("I" & i).Value = personnelTax
    Worksheets("MAAS").Range("J" & i).Value = personnelTC
    

c = c + 1
End If

i = i + 1

Wend
MsgBox "|fffd|deme ba|fffd|ar|fffd|yla eklendi"
cbPersonnel.ListIndex = 0
cbPersonnel.SetFocus
txtAmount.Text = ""
txtExplanation.Text = ""
txtFirmReferance.Text = ""
lblPaymentCount.Caption = "Toplam |fffd|deme Adedi :" & Worksheets("MAAS").Range("D" & 9).Value
lblPaymentAmount.Caption = "Toplam |fffd|deme Tutar|fffd| :" & Format(Worksheets("MAAS").Range("G" & 9).Value, "##,##0.00")

End If
End If

End Sub

Private Sub txtAmount_Change()
Dim k As Double
k = 5 / 2
'If InStr(k, ",") <> 0 Then
lblAmount.Caption = Format(txtAmount.Text, "##,##0.00")
'Else
'lblAmount.Caption = Format(txtAmount.Text, "##.##0,00")
'End If


End Sub

Private Sub txtAmount_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
k = 5 / 2
If InStr(k, ",") <> 0 Then
If KeyAscii = 46 Then
KeyAscii = 44
End If

Else

If KeyAscii = 44 Then
KeyAscii = 46
End If

End If

End Sub

Private Sub UserForm_Click()

End Sub

Private Sub UserForm_Initialize()
 

 


lblPaymentCount.Caption = "Toplam |fffd|deme Adedi :" & Worksheets("MAAS").Range("D" & 9).Value
lblPaymentAmount.Caption = "Toplam |fffd|deme Tutar|fffd| :" & Format(Worksheets("MAAS").Range("G" & 9).Value, "##,##0.00")

i = 8
Dim comboValue As String


While c = 0
If (Worksheets("PERSONEL").Range("A" & i).Value) <> Empty Then

 personelName = Worksheets("PERSONEL").Range("A" & i).Value

 
 personelAccount = Space$(50) & (Format(Worksheets("PERSONEL").Range("C" & i).Value, "00000")) & "-" & Format(Worksheets("PERSONEL").Range("D" & i).Value, "00000000") & "-" & Worksheets("PERSONEL").Range("E" & i).Value
 personelAccount = Right(personelAccount, 25)
 
 personelIBAN = Space$(50) & Worksheets("PERSONEL").Range("B" & i).Value
 personelIBAN = Right(personelIBAN, 30)
 
 comboValue = personelName & personelAccount & personelIBAN
 cbPersonnel.AddItem (comboValue)
 
Else
c = c + 1
End If

i = i + 1

Wend
If (cbPersonnel.ListCount > 0) Then
cbPersonnel.ListIndex = 0
End If
End Sub
Attribute VB_Name = "InsertFirmInfo"
Attribute VB_Base = "0{FC402268-8F95-4F36-BE9E-36B8F725ABE3}{55508077-07E4-442E-9C7F-CCD4DCD1D97A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim firmName As String
Dim accountType As Integer
Dim IBAN As String
Dim branchNo As String
Dim accountNo As String
Dim accountSuffixNo As String


Private Sub btnAdd_Click()

firmName = Trim(txtFirmName.Text)


If firmName = Empty Then
    
    MsgBox ("Firma Ad|fffd| Bilgisi Bo|fffd| Ge|fffd|ilemez")
   Exit Sub
End If

If drpAccountType.Value = "Hesap No" Then
    
    accountType = 0 'Hesap
    branchNo = Trim(txtBranchCode.Text)
    accountNo = Trim(txtAccountNo.Text)
    accountSuffixNo = Trim(txtAccountSuffixNo.Text)

Else
    accountType = 1 'IBAN
    IBAN = Trim(txtIBAN.Text)

End If

If accountType = 0 Then

    If branchNo = Empty Then
        MsgBox ("|fffd|ube Kodu Bilgisi Bo|fffd| Ge|fffd|ilemez")
       Exit Sub
    ElseIf IsNumeric(branchNo) = False Then
        MsgBox ("|fffd|ube Kodu Alan|fffd| say|fffd|sal olmal|fffd|d|fffd|r")
   Exit Sub
    ElseIf accountNo = Empty Then
        MsgBox ("Hesap Numaras|fffd| Bilgisi Bo|fffd| Ge|fffd|ilemez")
   Exit Sub
    ElseIf IsNumeric(accountNo) = False Then
        MsgBox ("Hesap Numaras|fffd| Alan|fffd| Say|fffd|sal Olmal|fffd|d|fffd|r")
       Exit Sub
    ElseIf accountSuffixNo = Empty Then
        MsgBox ("Hesap Ek No Bilgisi Bo|fffd| Ge|fffd|ilemez")
       Exit Sub
    ElseIf IsNumeric(accountSuffixNo) = False Then
        MsgBox ("Hesap Ek No Alan|fffd| Say|fffd|sal Olmal|fffd|d|fffd|r")
           Exit Sub
        
    ElseIf CLng(accountSuffixNo) > 65099 Or CLng(accountSuffixNo) < 351 Then
        MsgBox ("Ek numaras|fffd| 351 - 651 ile 35100 - 65099 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r.")
           Exit Sub

    ElseIf Len(accountSuffixNo) < 3 Or Len(taccountSuffixNo) > 5 Or Len(accountSuffixNo) = 4 Then
        MsgBox ("Ek numaras|fffd| 351 - 651 ile 35100 - 65099 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r.")
           Exit Sub
    End If


ElseIf accountType = 1 Then

   If (txtIBAN.Text = "") Then
         
      MsgBox ("IBAN bo|fffd| olamaz. Kontrol ediniz...")
      Exit Sub
   
   End If
   
   If (IsNumeric(Mid(txtIBAN.Text, 3, Len(txtIBAN.Text) - 2)) = True) Then
      IBAN = txtIBAN.Text
   
   Else
      MsgBox ("IBAN ilk iki karakteri d|fffd||fffd||fffd|nda rakamlardan olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
       Exit Sub
   
   End If
   
   If (Len(txtIBAN.Text) < 26) Then
           
      MsgBox ("IBAN 26 karakterden olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
      Exit Sub
   End If
    
   If (IbanKontrol(IBAN) = False) Then
      
      MsgBox ("IBAN No hatal|fffd|. L|fffd|tfen kontrol ediniz.")
      Exit Sub
   End If
    
End If


accountSuffixNo = "00" & txtAccountSuffixNo.Text
accountSuffixNo = Right(accountSuffixNo, 5)

Worksheets("MAAS").Range("A6").Value = UCase(txtFirmName.Text) & "  Hesap No : " & txtBranchCode.Text & " - " & txtAccountNo.Text & " - " & accountSuffixNo & "   IBAN : " & txtIBAN.Text & "  Hesab|fffd|ndan |fffd||fffd|kacak Maa|fffd| |fffd|demeleri "
Worksheets("MAAS").Range("Z6").Value = UCase(txtFirmName.Text)
Worksheets("MAAS").Range("Z7").Value = txtBranchCode.Text
Worksheets("MAAS").Range("Z8").Value = txtAccountNo.Text
Worksheets("MAAS").Range("Z9").Value = accountSuffixNo
Worksheets("MAAS").Range("Z10").Value = txtIBAN.Text


MsgBox ("Firma Bilgisi Ba|fffd|ar|fffd|yla Kaydedilmi|fffd|tir")

Unload Me


End Sub

Public Sub FillDrpAccountType()

    drpAccountType.AddItem "IBAN"
    drpAccountType.AddItem "Hesap No"
    drpAccountType.Value = "IBAN"

End Sub

Private Sub BtnExit_Click()
  Unload Me
   
End Sub

Private Sub drpAccountType_Change()
  
   ' Call FillIBANAndAccountNo
    
    If (drpAccountType.Value) = "Hesap No" Then
  
            lblIBAN.Visible = False
            txtIBAN.Visible = False
            lblAccount.Visible = True
            txtBranchCode.Visible = True
            txtAccountNo.Visible = True
            txtAccountSuffixNo.Visible = True
            lblIBANSeperated.Visible = False
            
            paymentType = 0 'Hesap No
            
     Else
            
            lblIBAN.Visible = True
            txtIBAN.Visible = True
            lblAccount.Visible = False
            txtBranchCode.Visible = False
            txtAccountNo.Visible = False
            txtAccountSuffixNo.Visible = False
            lblIBANSeperated.Visible = True
            
           paymentType = 1 'IBAN
            
     End If

End Sub

Private Sub txtIBAN_Change()
  
   IBAN = txtIBAN.Text
   lblIBANSeperated.Caption = IBAN + lblIBANSeperated.Caption
   lblIBANSeperated.Caption = Mid(IBAN, 1, 4) + " - " + Mid(IBAN, 5, 4) + " - " + Mid(IBAN, 9, 4) + " - " + Mid(IBAN, 13, 4) + " - " + Mid(IBAN, 17, 4) + " - " + Mid(IBAN, 21, 4) + " - " + Mid(IBAN, 25, 2)
   
End Sub

Private Sub txtAccountNum_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
If KeyAscii < Asc("0") Or KeyAscii > Asc("9") Then
KeyAscii = 32
MsgBox ("Hesap Numaras|fffd| Bilgisi Say|fffd|sal Olmal|fffd|d|fffd|r")
txtAccountNum.Text = ""
End If

End Sub

Private Sub txtBranchCode_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)

If KeyAscii < Asc("0") Or KeyAscii > Asc("9") Then
KeyAscii = 32
txtBranchCode.Text = ""


MsgBox ("|fffd|ube Kodu Bilgisi Say|fffd|sal Olmal|fffd|d|fffd|r")
End If


End Sub


Private Sub txtSuffixNo_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
If KeyAscii < Asc("0") Or KeyAscii > Asc("9") Then
KeyAscii = 32
MsgBox ("Hesap Ek No Bilgisi Say|fffd|sal Olmal|fffd|d|fffd|r")
txtSuffixNo.Text = ""
End If

End Sub


Private Sub UserForm_Initialize()

Call FillDrpAccountType
        txtFirmName.Text = Worksheets("MAAS").Range("Z6").Value
        txtBranchCode.Text = Worksheets("MAAS").Range("Z7").Value
        txtAccountNo.Text = Worksheets("MAAS").Range("Z8").Value
        txtAccountSuffixNo.Text = Worksheets("MAAS").Range("Z9").Value
        txtIBAN.Text = Worksheets("MAAS").Range("Z10").Value



End Sub
Public Function IbanKontrol(s As String) As Boolean
Dim MyStr As String
Dim yIban As String
Dim sIban As String
Dim i As Integer
Dim aa As String * 1
Dim X As Double
i = 1

yIban = Mid(s, 5) & Mid(s, 1, 4)

Do While i < Len(yIban) + 1
    aa = Mid(yIban, i, 1)
    Select Case aa
            Case "0" To "9"
                MyStr = MyStr & aa
            Case Else
                MyStr = MyStr & CharToNum(aa)
    End Select
i = i + 1
Loop

'X = MyStr Mod 97
X = ModSpe(MyStr, 97)

 If X = 1 Then
    IbanKontrol = True
Else
    IbanKontrol = False
End If

End Function

Public Function ModSpe(s As String, a As Integer) As Integer
Dim l As Integer
Dim i As Integer
Dim t As Double
Dim r As String
Dim F As Boolean

l = Len(s)
r = ""

If l > 6 Then
    i = 1
    r = ""
    Do
         t = CDec(r & Mid(s, i, 6)) Mod a
         r = t
         
         i = i + 6
         If i > l Then
            F = True
         Else
            F = False
         End If
    Loop Until F
    ModSpe = r
Else
    ModSpe = CDec(s) Mod a
End If

End Function



Public Function CharToNum(s As String) As String
Dim t As String
Select Case s
    Case "A"
         t = "10"
    Case "B"
         t = "11"
    Case "C"
         t = "12"
    Case "D"
         t = "13"
    Case "E"
         t = "14"
    Case "F"
         t = "15"
    Case "G"
         t = "16"
    Case "H"
         t = "17"
    Case "I"
         t = "18"
    Case "J"
         t = "19"
    Case "K"
         t = "20"
    Case "L"
         t = "21"
    Case "M"
         t = "22"
    Case "N"
         t = "23"
    Case "O"
         t = "24"
    Case "P"
         t = "25"
    Case "Q"
         t = "26"
    Case "R"
         t = "27"
    Case "S"
         t = "28"
    Case "T"
         t = "29"
    Case "U"
         t = "30"
    Case "V"
         t = "31"
    Case "W"
         t = "32"
    Case "X"
         t = "33"
    Case "Y"
         t = "34"
    Case "Z"
         t = "35"
End Select
CharToNum = t
End Function

Attribute VB_Name = "InsertPersonnelInfo"
Attribute VB_Base = "0{65D5748B-E4C7-48C4-BF46-ECDC082FA9F1}{00809471-FBBD-4C24-A78D-899DF4C0D18B}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim personelName As String
Dim accountType As Integer
Dim IBAN As String
Dim branchNo As String
Dim accountNo As String
Dim accountSuffixNo As String
Dim TCKimlikNo As String
Dim taxNumber As String

Private Sub btnAdd_Click()

i = 8
c = 0

personelName = Trim(txtPersonelName.Text)
TCKimlikNo = Trim(txtTCKN.Text)
taxNumber = Trim(txtTaxNo.Text)

If personelName = Empty Then
    
    MsgBox ("Personel |fffd|sim Bilgisi Bo|fffd| Ge|fffd|ilemez")
   Exit Sub
End If

If drpAccountType.Value = "Hesap No" Then
    
    accountType = 0 'Hesap
    branchNo = Trim(txtBranchCode.Text)
    accountNo = Trim(txtAccountNo.Text)
    accountSuffixNo = Trim(txtAccountSuffixNo.Text)

Else
    accountType = 1 'IBAN
    IBAN = Trim(txtIBAN.Text)

End If

If accountType = 0 Then

    If branchNo = Empty Then
        MsgBox ("|fffd|ube Kodu Bilgisi Bo|fffd| Ge|fffd|ilemez")
       Exit Sub
    ElseIf IsNumeric(branchNo) = False Then
        MsgBox ("|fffd|ube Kodu Alan|fffd| say|fffd|sal olmal|fffd|d|fffd|r")
   Exit Sub
    ElseIf accountNo = Empty Then
        MsgBox ("Hesap Numaras|fffd| Bilgisi Bo|fffd| Ge|fffd|ilemez")
   Exit Sub
    ElseIf IsNumeric(accountNo) = False Then
        MsgBox ("Hesap Numaras|fffd| Alan|fffd| Say|fffd|sal Olmal|fffd|d|fffd|r")
       Exit Sub
    ElseIf accountSuffixNo = Empty Then
        MsgBox ("Hesap Ek No Bilgisi Bo|fffd| Ge|fffd|ilemez")
       Exit Sub
    ElseIf IsNumeric(accountSuffixNo) = False Then
        MsgBox ("Hesap Ek No Alan|fffd| Say|fffd|sal Olmal|fffd|d|fffd|r")
           Exit Sub
        
    ElseIf CLng(accountSuffixNo) > 65099 Or CLng(accountSuffixNo) < 351 Then
        MsgBox ("Ek numaras|fffd| 351 - 651 ile 35100 - 65099 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r.")
           Exit Sub

    ElseIf Len(accountSuffixNo) < 3 Or Len(taccountSuffixNo) > 5 Or Len(accountSuffixNo) = 4 Then
        MsgBox ("Ek numaras|fffd| 351 - 651 ile 35100 - 65099 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r.")
           Exit Sub
    End If


ElseIf accountType = 1 Then

   If (txtIBAN.Text = "") Then
         
      MsgBox ("IBAN bo|fffd| olamaz. Kontrol ediniz...")
      Exit Sub
   
   End If
   
   If (IsNumeric(Mid(txtIBAN.Text, 3, Len(txtIBAN.Text) - 2)) = True) Then
      IBAN = txtIBAN.Text
   
   Else
      MsgBox ("IBAN ilk iki karakteri d|fffd||fffd||fffd|nda rakamlardan olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
       Exit Sub
   
   End If
   
   If (Len(txtIBAN.Text) < 26) Then
           
      MsgBox ("IBAN 26 karakterden olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
      Exit Sub
   End If
    
   If (IbanKontrol(IBAN) = False) Then
      
      MsgBox ("IBAN No hatal|fffd|. L|fffd|tfen kontrol ediniz.")
      Exit Sub
   End If
    
End If
If TCKimlikNo <> Empty Then
    If (IsNumeric(TCKimlikNo) = False Or Val(TCKimlikNo) = 0 Or (Len(TCKimlikNo) <> 11)) Then
        MsgBox ("T.C. Kimlik Numaras|fffd| Alan|fffd| Say|fffd|sal ve 11 Karakter Olmal|fffd|d|fffd|r")
        Exit Sub
    End If
ElseIf taxNumber <> Empty Then
   
    If (IsNumeric(taxNumber) = False Or Val(taxNumber) = 0 Or (Len(taxNumber) <> 10)) Then
        MsgBox ("Vergi Numaras|fffd| Alan|fffd| Say|fffd|sal ve 10 Karakter Olmal|fffd|d|fffd|r")
        Exit Sub
    End If
End If

While c = 0
    If (Worksheets("PERSONEL").Range("A" & i).Value) = Empty Then
        Worksheets("PERSONEL").Range("A" & i).Value = UCase(personelName)
        
        If (accountType = 0) Then
            Worksheets("PERSONEL").Range("C" & i).Value = branchNo
            Worksheets("PERSONEL").Range("D" & i).Value = accountNo
            Worksheets("PERSONEL").Range("E" & i).Value = "00" & accountSuffixNo
            Worksheets("PERSONEL").Range("E" & i).Value = Right(Worksheets("PERSONEL").Range("E" & i).Value, 5)
        Else
            Worksheets("PERSONEL").Range("B" & i).Value = IBAN
        End If
        
        Worksheets("PERSONEL").Range("F" & i).Value = taxNumber
        Worksheets("PERSONEL").Range("G" & i).Value = TCKimlikNo
        c = c + 1

        If i Mod 2 = 0 Then
            Worksheets("PERSONEL").Range("A" & i & ":" & "G" & i).Interior.colorIndex = 15
        Else
            Worksheets("PERSONEL").Range("A" & i & ":" & "G" & i).Interior.colorIndex = 34
        End If
    End If

i = i + 1

Wend
c = 0

MsgBox ("Personel Bilgisi Ba|fffd|ar|fffd|yla Eklenmi|fffd|tir")

txtPersonelName.Text = ""
txtBranchCode.Text = ""
txtAccountNo.Text = ""
txtAccountSuffixNo.Text = ""
txtIBAN.Text = ""
txtTCKN.Text = ""
txtTaxNo.Text = ""
txtPersonelName.SetFocus





End Sub

Public Sub FillDrpAccountType()

    drpAccountType.AddItem "IBAN"
    drpAccountType.AddItem "Hesap No"
    drpAccountType.Value = "IBAN"

End Sub

Private Sub drpAccountType_Change()
  
   ' Call FillIBANAndAccountNo
    
    If (drpAccountType.Value) = "Hesap No" Then
  
            lblIBAN.Visible = False
            txtIBAN.Visible = False
            lblAccount.Visible = True
            txtBranchCode.Visible = True
            txtAccountNo.Visible = True
            txtAccountSuffixNo.Visible = True
            lblIBANSeperated.Visible = False
            
            paymentType = 0 'Hesap No
            
     Else
            
            lblIBAN.Visible = True
            txtIBAN.Visible = True
            lblAccount.Visible = False
            txtBranchCode.Visible = False
            txtAccountNo.Visible = False
            txtAccountSuffixNo.Visible = False
            lblIBANSeperated.Visible = True
            
           paymentType = 1 'IBAN
            
     End If

End Sub

Private Sub txtIBAN_Change()
  
   IBAN = txtIBAN.Text
   lblIBANSeperated.Caption = IBAN + lblIBANSeperated.Caption
   lblIBANSeperated.Caption = Mid(IBAN, 1, 4) + " - " + Mid(IBAN, 5, 4) + " - " + Mid(IBAN, 9, 4) + " - " + Mid(IBAN, 13, 4) + " - " + Mid(IBAN, 17, 4) + " - " + Mid(IBAN, 21, 4) + " - " + Mid(IBAN, 25, 2)
   
End Sub

Private Sub BtnExit_Click()
    Unload Me
End Sub


Private Sub UserForm_Click()

End Sub

Private Sub UserForm_Initialize()
      
    Call FillDrpAccountType
 '   Call FillIBANAndAccountNo
    
End Sub

Public Function IbanKontrol(s As String) As Boolean
Dim MyStr As String
Dim yIban As String
Dim sIban As String
Dim i As Integer
Dim aa As String * 1
Dim X As Double
i = 1

yIban = Mid(s, 5) & Mid(s, 1, 4)

Do While i < Len(yIban) + 1
    aa = Mid(yIban, i, 1)
    Select Case aa
            Case "0" To "9"
                MyStr = MyStr & aa
            Case Else
                MyStr = MyStr & CharToNum(aa)
    End Select
i = i + 1
Loop

'X = MyStr Mod 97
X = ModSpe(MyStr, 97)

 If X = 1 Then
    IbanKontrol = True
Else
    IbanKontrol = False
End If

End Function

Public Function ModSpe(s As String, a As Integer) As Integer
Dim l As Integer
Dim i As Integer
Dim t As Double
Dim r As String
Dim F As Boolean

l = Len(s)
r = ""

If l > 6 Then
    i = 1
    r = ""
    Do
         t = CDec(r & Mid(s, i, 6)) Mod a
         r = t
         
         i = i + 6
         If i > l Then
            F = True
         Else
            F = False
         End If
    Loop Until F
    ModSpe = r
Else
    ModSpe = CDec(s) Mod a
End If

End Function



Public Function CharToNum(s As String) As String
Dim t As String
Select Case s
    Case "A"
         t = "10"
    Case "B"
         t = "11"
    Case "C"
         t = "12"
    Case "D"
         t = "13"
    Case "E"
         t = "14"
    Case "F"
         t = "15"
    Case "G"
         t = "16"
    Case "H"
         t = "17"
    Case "I"
         t = "18"
    Case "J"
         t = "19"
    Case "K"
         t = "20"
    Case "L"
         t = "21"
    Case "M"
         t = "22"
    Case "N"
         t = "23"
    Case "O"
         t = "24"
    Case "P"
         t = "25"
    Case "Q"
         t = "26"
    Case "R"
         t = "27"
    Case "S"
         t = "28"
    Case "T"
         t = "29"
    Case "U"
         t = "30"
    Case "V"
         t = "31"
    Case "W"
         t = "32"
    Case "X"
         t = "33"
    Case "Y"
         t = "34"
    Case "Z"
         t = "35"
End Select
CharToNum = t
End Function


Attribute VB_Name = "Module1"
Sub FirmInfo_Click()

InsertFirmInfo.Show
End Sub
Sub btnPersonnelInfo_Click()

End Sub

Sub btnPaymentInfo_Click()
Payment.Show
End Sub
Attribute VB_Name = "Module2"
Sub btnAddPersonel_Click()
InsertPersonnelInfo.Show

End Sub
Sub btnUpdate_Click()
If (Worksheets("PERSONEL").Range("A" & ActiveCell.Row).Value = Empty) Or (ActiveCell.Row < 8) Then
MsgBox "L|fffd|tfen personel se|fffd|iniz"
Else
UpdatePersonnel.Show
End If
End Sub
Sub btnDeletePersonel_Click()
Dim rs As VbMsgBoxResult
If (Worksheets("PERSONEL").Range("A" & ActiveCell.Row).Value = Empty) Or (ActiveCell.Row < 8) Then
MsgBox "L|fffd|tfen personel se|fffd|iniz"
Else

rs = MsgBox("Se|fffd|ili Personeli ve Ona Ait Bilgileri Silmek |fffd|stedi|fffd|inizden Emin misiniz?", vbYesNo, "Uyar|fffd|")
If rs = vbYes Then
 

ActiveCell.EntireRow.Select
Selection.Delete Shift:=xlUp

Dim say As Integer
say = 8
While Worksheets("PERSONEL").Range("A" & say).Value <> ""
 If say Mod 2 = 0 Then
   Worksheets("PERSONEL").Range("A" & say & ":" & "G" & say).Interior.colorIndex = 15
   Else
  Worksheets("PERSONEL").Range("A" & say & ":" & "G" & say).Interior.colorIndex = 34
   End If
   say = say + 1
   Wend
   

MsgBox "Personel Bilgisi Ba|fffd|ar|fffd|yla Silinmi|fffd|tir"

End If
End If

End Sub
Sub addPayment_Click()
AddPayment.Show

End Sub
Attribute VB_Name = "Module3"
Sub btnDeletePayment_Click()
If (Worksheets("MAAS").Range("A" & ActiveCell.Row).Value = Empty) Or ActiveCell.Row < 11 Then
MsgBox "L|fffd|tfen |fffd|deme se|fffd|iniz"
Else
rs = MsgBox("Se|fffd|ili |fffd|demeyi ve Ona Ait Bilgileri Silmek |fffd|stedi|fffd|inizden Emin misiniz?", vbYesNo, "Uyar|fffd|")
If rs = vbYes Then
 
 
ActiveCell.Rows.EntireRow.Select



Selection.Delete Shift:=xlUp

MsgBox "|fffd|deme Bilgisi Ba|fffd|ar|fffd|yla Silinmi|fffd|tir"

End If
End If
End Sub
Sub btnUpdatePayment_Click()
If (Worksheets("MAAS").Range("A" & ActiveCell.Row).Value = Empty) Or ActiveCell.Row < 11 Then

MsgBox "L|fffd|tfen |fffd|deme se|fffd|iniz"
Else
UpdatePayment.Show
End If

End Sub
Attribute VB_Name = "Module4"
Sub GetAkibet_Click()


Range("A11:K60000").Select
    Selection.ClearContents
    Range("A11").Select
    Worksheets("AKIBET").Range("H2").Value = ""
     Worksheets("AKIBET").Range("H4").Value = ""
     Worksheets("AKIBET").Range("E2").Value = ""
     Worksheets("AKIBET").Range("E4").Value = ""
   
   Dim X As Integer
   X = 11
   While X < 1000
   
    Worksheets("AKIBET").Range("A" & X & ":" & "J" & X).Interior.colorIndex = 0
    X = X + 1
    Wend
    
  
 

Dim sirketKodu As String
Dim kayitTarihi As String


Dim bankaKodu As String
Dim subeKodu As String
Dim hesapNo As String
Dim hesapEkNo As String
Dim tutar As Double
Dim aciklama As String
Dim firmaReferans As String
Dim musteriUnvan As String
Dim musteriAdres As String
Dim musteriTelefon As String
Dim vergiNo As String
Dim TCKNo As String
Dim odemeDurumu As Integer
Dim islemReferansi As String
Dim Akibet As String
Dim tutarToplam As Double
tutarToplam = 0
Dim tutarAdet As Integer
tutarAdet = 0
Dim dosyaTutar As Double
Dim dosyaAdet As Integer
tutar = 0
   tutarAdet = 0
   dosyaAdet = 0
   dosyaTutar = 0

 Set fileReadName = Nothing
    fileReadName = Application.GetOpenFilename( _
    fileFilter:="Text Files (*.txt), *.txt")
   
   
If (fileReadName <> False) Then
 Open fileReadName For Input As #1
    
   
 index = 11
Do While Not EOF(1)
Line Input #1, InputData

   
 If Mid(InputData, 1, 1) = "H" Then
   sirketKodu = CStr(Mid(InputData, 10, 15))
   kayitTarihi = CStr(Mid(InputData, 2, 8))
   
 End If
 

 If Mid(InputData, 1, 1) = "D" Then
 
   bankaKodu = CStr(Mid(InputData, 2, 4))
   subeKodu = CStr(Mid(InputData, 6, 5))
   
   If bankaKodu = "0134" Then
   hesapNo = CStr(Mid(InputData, 11, 8))
   hesapEkNo = CStr(Mid(InputData, 19, 5))
  
   Else
   hesapNo = CStr(Mid(InputData, 11, 15))
   hesapEkNo = ""
  
   End If
   
   tutar = CStr(Mid(InputData, 29, 18))
   aciklama = CStr(Mid(InputData, 50, 60))
   firmaReferans = CStr(Mid(InputData, 160, 30))
   musteriUnvan = CStr(Mid(InputData, 110, 50))
   'musteriAdres = CStr(Mid(InputData, 181, 50))
   'musteriTelefon = CStr(Mid(InputData, 231, 10))
   vergiNo = CStr(Mid(InputData, 190, 10))
   TCKNo = CStr(Mid(InputData, 200, 11))
   odemeDurumu = CStr(Mid(InputData, 211, 2))
   islemReferansi = CStr(Mid(InputData, 253, 6))
   'EftSorguNo = (Mid(InputData, 259, 7))
   
   
   
   Worksheets("AKIBET").Range("A" & index).Value = musteriUnvan
   Worksheets("AKIBET").Range("B" & index).Value = subeKodu
   Worksheets("AKIBET").Range("C" & index).Value = hesapNo
   Worksheets("AKIBET").Range("D" & index).Value = hesapEkNo
   Worksheets("AKIBET").Range("E" & index).Value = CStr(tutar)
   Worksheets("AKIBET").Range("F" & index).Value = aciklama
   Worksheets("AKIBET").Range("G" & index).Value = firmaReferans
   Worksheets("AKIBET").Range("H" & index).Value = vergiNo
   Worksheets("AKIBET").Range("I" & index).Value = TCKNo
   
   

   Dim a As String
  
   
   If index Mod 2 = 0 Then
   Worksheets("AKIBET").Range("A" & index & ":" & "J" & index).Interior.colorIndex = 15
   Else
  Worksheets("AKIBET").Range("A" & index & ":" & "J" & index).Interior.colorIndex = 34
  
   End If
   
   
   


  If odemeDurumu = 0 Then
  Akibet = "ODEME GERCEKLESMEDI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 1 Then
  Akibet = "ODEME GERCEKLESTI"
  tutarAdet = tutarAdet + 1
  tutarToplam = tutarToplam + tutar
  ElseIf odemeDurumu = 2 Then
  Akibet = "YETERSIZ BAKIYE"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 3 Then
  Akibet = "HATALI HESAP"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 4 Then
  Akibet = "FIRMA HESAP BULUNAMADI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 5 Then
  Akibet = "FIRMA HESAP KAPALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 6 Then
  Akibet = "ISLEM ONAYLANMADI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 7 Then
  Akibet = "VERGI NUMARASI GIRILMEMIS YADA HATALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 8 Then
  Akibet = "HEDEF HESAP BULUNAMADI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 9 Then
  Akibet = "HEDEF HESAP KAPALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 10 Then
  Akibet = "HEDEF HESAP BLOKELI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 11 Then
  Akibet = "HATALI BAKIYE"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 12 Then
  Akibet = "HEDEF HESAP HATALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 13 Then
  Akibet = "HEDEF HESAP BULUNAMADI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 14 Then
  Akibet = "HEDEF HESAP KAPALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 15 Then
  Akibet = "HEDEF HESAP TIPI UYGUN DEGIL"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 16 Then
  Akibet = "FIRMA VE HEDEF HESAP DOVIZ TIPI AYNI OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 17 Then
  Akibet = "HEDEF HESAP VADELI HESAP"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 18 Then
  Akibet = "HEDEF BANKA-SUBE KODU HATALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 19 Then
  Akibet = "ALICI VERGINO NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 20 Then
  Akibet = "HEDEF BANKA NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 21 Then
  Akibet = "HEDEF SUBE NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 22 Then
  Akibet = "HEDEF HESAP NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 23 Then
  Akibet = "HEDEF EKNO NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 24 Then
  Akibet = "TUTAR NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  Akibet = "HEDEF BANKA NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 25 Then
  Akibet = "TOPLAM ADET NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 26 Then
  Akibet = "TOPLAM TUTAR NUMERIK OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 27 Then
  Akibet = "ODEME YAPILAN HESAP TRY HESABI OLMALI"
  dosyaTutar = dosyaTutar + tutar
  ElseIf odemeDurumu = 99 Then
  Akibet = "TANIMLANMAMIS HATA"
  dosyaTutar = dosyaTutar + tutar

  
  End If

   If odemeDurumu <> 1 Then
   dosyaAdet = dosyaAdet + 1
    
   End If
   
   Worksheets("AKIBET").Range("J" & index).Value = Akibet
   Worksheets("AKIBET").Range("E2").Value = tutarAdet
   Worksheets("AKIBET").Range("E4").Value = tutarToplam
   Worksheets("AKIBET").Range("H2").Value = dosyaAdet
   Worksheets("AKIBET").Range("H4").Value = dosyaTutar
   
   
    
   
   index = index + 1
 
 

   End If
   
 
Loop

Else
   Exit Sub
End If
    Close #1
End Sub
Sub Button2_Click()

Range("A11:K60000").Select
    Selection.ClearContents
    Range("A11").Select
    Worksheets("AKIBET").Range("H2").Value = ""
     Worksheets("AKIBET").Range("H4").Value = ""
   Worksheets("AKIBET").Range("E2").Value = tutarAdet
   Worksheets("AKIBET").Range("E4").Value = tutarToplam
   
   Dim X As Integer
   X = 11
   While X < 1000
   
    Worksheets("AKIBET").Range("A" & X & ":" & "J" & X).Interior.colorIndex = 0
    X = X + 1
    Wend
    
End Sub
Attribute VB_Name = "Module5"
Attribute VB_Name = "Payment"
Attribute VB_Base = "0{F4D290FE-69AE-40F3-B030-1283952CB006}{43F840A8-95BD-4C9B-BA60-7E37B83231B1}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Dim firmaReferans As String
Dim bankaKodu As String
Dim firmaHesapNo As String
Dim firmaSubeKodu As String
Dim firmaHesapEkNo As String
Dim kayitTipi As String
Dim dosyaTarihi As String
Dim odemeTarihi As String
Dim header As String
Dim hedefBankaKodu As String
Dim hedefSubeKodu As String
Dim hedefHesapNo As String
Dim hedefHesapEkNo As String
Dim paraKodu As String
Dim aliciUnvan As String
Dim aliciVergiNo As String
Dim aliciTCKN As String
Dim durumKodu As String
Dim tutar As String
Dim aciklama As String
Dim islemReferansi As String
Dim detail As String
Dim trailer As String
Dim toplamTutar As Double
Dim separator As String



Private Sub btnCreateFile_Click()

If (IsNumeric(txtDay.Text) = False) Then
      MsgBox ("G|fffd|n rakamlardan olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
      Exit Sub
 End If
 
 If (CInt(txtDay.Text) > 31 Or CInt(txtDay.Text) < 1) Then
      MsgBox ("G|fffd|n de|fffd|eri 1-31 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r. Kontrol ediniz...")
  Exit Sub
 End If
 
 If (IsNumeric(txtMonth.Text) = False) Then
      MsgBox ("Ay rakamlardan olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
     Exit Sub
 End If
 
 If (CInt(txtMonth.Text) > 12 Or CInt(txtMonth.Text) < 1) Then
      MsgBox ("Ay de|fffd|eri 1-12 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r. Kontrol ediniz...")
     Exit Sub
 End If
 
 If (IsNumeric(txtYear.Text) = False) Then
       MsgBox ("Y|fffd|l rakamlardan olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
     Exit Sub
 End If

 If Worksheets("MAAS").Range("A" & 6).Value = Empty Then
 MsgBox "Firma bilgisi girilmemi|fffd|tir"
 Exit Sub
 End If
 

 
 Call DosyaOlustur
 
 End Sub
 
 Sub DosyaOlustur()
        
    Dim index As Integer
    Dim tutar As Double
    Dim tempTutar As String
    Dim toplamTutar As Double
    Dim tempToplamTutar As String
    Dim initialFileName As String
    Dim hedefIBAN As String
    Dim file As String
    Dim fileIsMistaken As Integer
    Dim firmIBAN As String
        
    index = 11
    fileIsMistaken = 0
        
 If (Worksheets("MAAS").Range("A" & index).Value) = Empty Then
    MsgBox "|fffd|deme giri|fffd|i bulunmamaktad|fffd|r"
 Exit Sub
 End If
'HEADER ***********************************************************************************************************
    
    paymentType = 1
    
    firmIBAN = Worksheets("MAAS").Range("Z10").Value
    
    If (firmIBAN = "") Then
         firmIBAN = Space$(26)
         paymentType = 0
    End If
    
    kayitTipi = "H"
    dosyaTarihi = DateTime.Year(DateTime.Now) & Format(DateTime.Month(DateTime.Now), "00") & Format(DateTime.Day(DateTime.Now), "00")
    bankaKodu = "0134"
    odemeTarihi = txtYear.Text & Format(txtMonth.Text, "00") & Format(txtDay.Text, "00")
    
    If (paymentType = 0) Then
       firmaSubeKodu = Worksheets("MAAS").Range("Z7").Value
       firmaHesapNo = Worksheets("MAAS").Range("Z8").Value
       firmaHesapEkNo = Worksheets("MAAS").Range("Z9").Value
    
       firmaSubeKodu = Format(firmaSubeKodu, "0000")
       firmaHesapNo = Format(firmaHesapNo, "00000000")
       firmaHesapEkNo = Format(firmaHesapEkNo, "00000")
          firmIBAN = Space$(26)
   
    Else
         firmaSubeKodu = "    "
         firmaHesapNo = "        "
         firmaHesapEkNo = "     "
         firmIBAN = Worksheets("MAAS").Range("Z10").Value
    End If
    header = kayitTipi & dosyaTarihi & bankaKodu & firmaSubeKodu & firmaHesapNo & firmaHesapEkNo & odemeTarihi & firmIBAN
    
    file = file & header & vbCrLf
'****************************************************************************************************************
    
    toplamTutar = 0

'DETAIL ***********************************************************************************************************

    firstcellvalue = (Worksheets("MAAS").Range("A" & index).Value)
    
    While (firstcellvalue <> Empty)
        
      kayitTipi = "D"
      hedefIBAN = Worksheets("MAAS").Range("B" & index).Value
   
     If (Left(hedefIBAN, 2) = "TR") Then
        If (IbanKontrol(hedefIBAN) = False) Then
           MsgBox ("IBAN alan|fffd| hatal|fffd| kay|fffd|t. Sat|fffd|r No : " & index)
           fileIsMistaken = 1 ' Dosyada hatal|fffd| kay|fffd|t var
        End If
     End If
     
     
      If (Len(Trim(hedefIBAN)) < 26) Then
       
        hedefBankaKodu = "0134"
        hedefSubeKodu = Format(Worksheets("MAAS").Range("C" & index).Value, "00000")
        hedefHesapNo = Format(Worksheets("MAAS").Range("D" & index).Value, "00000000")
        hedefHesapEkNo = Format(Worksheets("MAAS").Range("E" & index).Value, "00000")
        hedefHesapNo = hedefHesapNo & hedefHesapEkNo & "     "
        
      Else
        
        hedefBankaKodu = Format(Mid(Worksheets("MAAS").Range("B" & index).Value, 1, 4), "0000")
        hedefSubeKodu = Format(Mid(Worksheets("MAAS").Range("B" & index).Value, 5, 5), "00000")
        hedefHesapNo = Mid(Worksheets("MAAS").Range("B" & index).Value, 10, 17) & " "
      
      End If
         
'       regionalSeperator = Get_locale 'decimal seperator
'
'
'        If (regionalSeperator = ".") Then
'           tutar = CDbl(Replace(Worksheets("MAAS").Range("F" & index).Value, ",", "."))
'           tempTutar = Format(tutar, "000000000000000.00")
'          Else
'
'          tutar = CDbl(Replace(Worksheets("MAAS").Range("F" & index).Value, ".", ","))
'          tempTutar = Format(tutar, "000000000000000.00")
'         End If
'
'
'        If (tutar = 0) Then
'
'            MsgBox ("Tutar alan|fffd| hatal|fffd| kay|fffd|t. Sat|fffd|r No : " & index)
'            fileIsMistaken = 1 ' Dosyada hatal|fffd| kay|fffd|t var
'
'        End If

 tutar = Replace(Worksheets("MAAS").Range("F" & index).Value, ",", ".")
        
        Dim devam As Integer
        Dim i As Integer
        
        kontrolTutar = Replace(tutar, ",", "")
        kontrolTutar = Replace(kontrolTutar, ".", "")
        
        For i = 0 To Len(kontrolTutar) - 1
            If (Asc(Mid$(kontrolTutar, i + 1, 1)) >= 48 And Asc(Mid$(kontrolTutar, i + 1, 1)) <= 57) Then
                devam = devam + 1
            Else
                MsgBox ("Tutar k|fffd|sm|fffd|na say|fffd| giriniz.")
                Close #1
                Exit Sub
            End If
        Next i
        toplamTutar = CDbl(toplamTutar + tutar)
        tempTutar = Format(tutar, "000000000000000.00")
        
        
        
        aciklama = Worksheets("MAAS").Range("G" & index).Value & String$(60 - Len(Worksheets("MAAS").Range("G" & index).Value), " ")
        firmaReferans = "EXC" & String$(27, " ")
        paraKodu = cbCurrency.Value
        aliciUnvan = Worksheets("MAAS").Range("A" & index).Value & String$(50 - Len(Worksheets("MAAS").Range("A" & index).Value), " ")
        
        
        aliciVergiNo = Format(Worksheets("MAAS").Range("I" & index).Value, "0000000000")
               If (aliciVergiNo = "") Then
               aliciVergiNo = Space$(10)
               End If
                
                aliciTCKN = Format(Worksheets("MAAS").Range("J" & index).Value, "00000000000")
        If (aliciTCKN = "") Then
               aliciTCKN = Space$(11)
               End If
               
        durumKodu = "00"
        islemReferansi = "0000000000"
        
        tempTutar = Replace(tempTutar, ",", ".")
        detail = kayitTipi & hedefBankaKodu & hedefSubeKodu & hedefHesapNo & tempTutar & paraKodu & aciklama & aliciUnvan & firmaReferans & aliciVergiNo & aliciTCKN & durumKodu & islemReferansi
        index = index + 1
        firstcellvalue = (Worksheets("MAAS").Range("A" & index).Value)
        
        kayitAdedi = kayitAdedi + 1
        file = file & detail & vbCrLf
        
        hedefBankaKodu = ""
        hedefSubeKodu = ""
        hedefHesapNo = ""
      
        
    Wend

'****************************************************************************************************************

'TRAILER***********************************************************************************************************

    kayitTipi = "T"
    If (regionalSeperator = ".") Then
           
           tempToplamTutar = Format(toplamTutar, "000000000000000.00")
          
          Else
         
           tempToplamTutar = Format(toplamTutar, "000000000000000.00")
         
        
         End If
          tempTutar = Replace(tempTutar, ",", ".")
       
       
         
         tempToplamTutar = Replace(tempToplamTutar, ",", ".")
         
         trailer = kayitTipi & Format(kayitAdedi, "00000") & tempToplamTutar
    
    file = file & trailer
   
'******************************************************************************************************************
Dim firmName As String
firmName = Worksheets("MAAS").Range("A" & 6).Value
firmName = Trim(Mid(firmName, 1, InStr(1, firmName, "Hesap", vbTextCompare) - 1))

initialFileName = firmName & "_" & DateTime.Year(DateTime.Now) & Format(DateTime.Month(DateTime.Now), "00") & DateTime.Day(DateTime.Now) & Format(DateTime.Hour(DateTime.Now), "00") & Format(DateTime.Minute(DateTime.Now), "00") & Format(DateTime.Second(DateTime.Now), "00") & ".txt"

    'If (paymentType = 0) Then 'Hesap No
             'initialFileName = "MOD" & "134" & DateTime.Year(DateTime.Now) & Format(DateTime.Month(DateTime.Now), "00") & DateTime.Day(DateTime.Now) & Format(DateTime.Hour(DateTime.Now), "00") & Format(DateTime.Minute(DateTime.Now), "00") & Format(DateTime.Second(DateTime.Now), "00") & "_" & firmName & ".txt"  'Format(firmaHesapNo, "00000000") & ".txt"
             
    'Else
             'initialFileName = "MOD" & "134" & DateTime.Year(DateTime.Now) & Format(DateTime.Month(DateTime.Now), "00") & DateTime.Day(DateTime.Now) & Format(DateTime.Hour(DateTime.Now), "00") & Format(DateTime.Minute(DateTime.Now), "00") & Format(DateTime.Second(DateTime.Now), "00") & "_" & firmName & ".txt" 'Mid(firmIBAN, 14, 8) & ".txt"
    'End If
    
    If (fileIsMistaken <> 1) Then
    
    fileSaveName = Application.GetSaveAsFilename( _
    initialFileName:=initialFileName, fileFilter:="Text Files (*.txt), *.txt")
    
    If (fileSaveName <> False) Then
    Open fileSaveName For Output As #1
      Print #1, file
    Close #1
     
     MsgBox ("Dosya Ba|fffd|ar|fffd|yla Olu|fffd|turulmu|fffd|tur" & vbCrLf & vbCrLf & "Toplam |fffd|deme Adeti   :" & kayitAdedi & vbCrLf & "Toplam |fffd|deme Tutar|fffd|  :" & toplamTutar)
     Else
    MsgBox ("|fffd||fffd|lem |fffd|ptal Edildi!!!")
    End If
      Else
       MsgBox ("|fffd|deme bilgilerinde hata var. " & vbCrLf & "Dosya olu|fffd|turulamad|fffd|...")
    
     End If
     Unload Me

End Sub

Private Sub BtnExit_Click()
Unload Me
End Sub



Private Sub UserForm_Initialize()

txtDay.Text = Format(DateTime.Day(DateTime.Now), "00")
txtMonth.Text = Format(DateTime.Month(DateTime.Now), "00")
txtYear.Text = Format(DateTime.Year(DateTime.Now), "0000")
cbCurrency.AddItem "TRY"
cbCurrency.AddItem "USD"
cbCurrency.AddItem "GBP"
cbCurrency.AddItem "EUR"

cbCurrency.Value = "TRY"
End Sub

Public Function IbanKontrol(s As String) As Boolean
Dim MyStr As String
Dim yIban As String
Dim sIban As String
Dim i As Integer
Dim aa As String * 1
Dim X As Double
i = 1

yIban = Mid(s, 5) & Mid(s, 1, 4)

Do While i < Len(yIban) + 1
    aa = Mid(yIban, i, 1)
    Select Case aa
            Case "0" To "9"
                MyStr = MyStr & aa
            Case Else
                MyStr = MyStr & CharToNum(aa)
    End Select
i = i + 1
Loop

'X = MyStr Mod 97
X = ModSpe(MyStr, 97)

 If X = 1 Then
    IbanKontrol = True
Else
    IbanKontrol = False
End If

End Function

Public Function ModSpe(s As String, a As Integer) As Integer
Dim l As Integer
Dim i As Integer
Dim t As Double
Dim r As String
Dim F As Boolean

l = Len(s)
r = ""

If l > 6 Then
    i = 1
    r = ""
    Do
         t = CDec(r & Mid(s, i, 6)) Mod a
         r = t
         
         i = i + 6
         If i > l Then
            F = True
         Else
            F = False
         End If
    Loop Until F
    ModSpe = r
Else
    ModSpe = CDec(s) Mod a
End If

End Function



Public Function CharToNum(s As String) As String
Dim t As String
Select Case s
    Case "A"
         t = "10"
    Case "B"
         t = "11"
    Case "C"
         t = "12"
    Case "D"
         t = "13"
    Case "E"
         t = "14"
    Case "F"
         t = "15"
    Case "G"
         t = "16"
    Case "H"
         t = "17"
    Case "I"
         t = "18"
    Case "J"
         t = "19"
    Case "K"
         t = "20"
    Case "L"
         t = "21"
    Case "M"
         t = "22"
    Case "N"
         t = "23"
    Case "O"
         t = "24"
    Case "P"
         t = "25"
    Case "Q"
         t = "26"
    Case "R"
         t = "27"
    Case "S"
         t = "28"
    Case "T"
         t = "29"
    Case "U"
         t = "30"
    Case "V"
         t = "31"
    Case "W"
         t = "32"
    Case "X"
         t = "33"
    Case "Y"
         t = "34"
    Case "Z"
         t = "35"
End Select
CharToNum = t
End Function

Private Function FindAmountSeperator() As String



End Function
Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()

End Sub
Attribute VB_Name = "UpdatePayment"
Attribute VB_Base = "0{303358B5-47CB-44CD-AEE8-F4EA59F32374}{F9620CCB-F46B-459D-9049-7CE63EF2D5C1}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub btnCancel_Click()
Unload Me

End Sub

Private Sub btnOK_Click()
If Trim(txtAmount.Text) = Empty Then
MsgBox "L|fffd|tfen tutar giriniz"

ElseIf IsNumeric(txtAmount.Text) = False Then
MsgBox "L|fffd|tfen tutar alan|fffd|na say|fffd|sal veri giriniz"
Else



Worksheets("MAAS").Range("F" & ActiveCell.Row).Value = CCur(txtAmount.Text)
Worksheets("MAAS").Range("G" & ActiveCell.Row).Value = txtExplanation.Text
Worksheets("MAAS").Range("H" & ActiveCell.Row).Value = txtFirmReferance.Text




MsgBox "|fffd|deme ba|fffd|ar|fffd|yla g|fffd|ncellendi"
txtAmount.Text = ""
txtExplanation.Text = ""
txtFirmReferance.Text = ""

 
 Unload Me
 
 End If
End Sub

Private Sub Label9_Click()

End Sub

Private Sub Frame1_Click()

End Sub

Private Sub txtAmount_Change()
Dim k As Double
k = 5 / 2
'If InStr(k, ",") <> 0 Then
lblAmount.Caption = Format(txtAmount.Text, "##,##0.00")
End Sub

Private Sub txtAmount_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
k = 5 / 2
If InStr(k, ",") <> 0 Then
If KeyAscii = 46 Then
KeyAscii = 44
End If

Else

If KeyAscii = 44 Then
KeyAscii = 46
End If

End If

End Sub

Private Sub UserForm_Click()

End Sub

Private Sub UserForm_Initialize()
txtAmount.Text = Worksheets("MAAS").Range("F" & ActiveCell.Row).Value
txtExplanation.Text = Worksheets("MAAS").Range("G" & ActiveCell.Row).Value
txtFirmReferance.Text = Worksheets("MAAS").Range("H" & ActiveCell.Row).Value

i = 8
lblPersonnelInfo.Caption = Worksheets("MAAS").Range("A" & ActiveCell.Row).Value & " " & Worksheets("MAAS").Range("C" & ActiveCell.Row).Value & "-" & Worksheets("MAAS").Range("D" & ActiveCell.Row).Value & "-" & Worksheets("MAAS").Range("E" & ActiveCell.Row).Value & "     " & Worksheets("MAAS").Range("B" & ActiveCell.Row).Value


 
lblPaymentCount.Caption = "Toplam |fffd|deme Adedi :" & Worksheets("MAAS").Range("C" & 9).Value
lblPaymentAmount.Caption = "Toplam |fffd|deme Tutar|fffd| :" & Format(Worksheets("MAAS").Range("F" & 9).Value, "##,##0.00")
 
End Sub
Attribute VB_Name = "UpdatePersonnel"
Attribute VB_Base = "0{A39CFB82-5EA9-4470-A54A-87D81A798E35}{C20355E1-9C34-4343-9A99-0740FCD7A879}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim personelName As String
Dim accountType As Integer
Dim IBAN As String
Dim branchNo As String
Dim accountNo As String
Dim accountSuffixNo As String
Dim TCKimlikNo As String
Dim taxNumber As String

Private Sub btnAdd_Click()

i = 8
c = 0

personelName = Trim(txtPersonelName.Text)
TCKimlikNo = Trim(txtTCKN.Text)
taxNumber = Trim(txtTaxNo.Text)

If personelName = Empty Then
    
    MsgBox ("Personel |fffd|sim Bilgisi Bo|fffd| Ge|fffd|ilemez")
   Exit Sub
End If

If drpAccountType.Value = "Hesap No" Then
    
    accountType = 0 'Hesap
    branchNo = Trim(txtBranchCode.Text)
    accountNo = Trim(txtAccountNo.Text)
    accountSuffixNo = Trim(txtAccountSuffixNo.Text)

Else
    accountType = 1 'IBAN
    IBAN = Trim(txtIBAN.Text)

End If

If accountType = 0 Then

    If branchNo = Empty Then
        MsgBox ("|fffd|ube Kodu Bilgisi Bo|fffd| Ge|fffd|ilemez")
       Exit Sub
    ElseIf IsNumeric(branchNo) = False Then
        MsgBox ("|fffd|ube Kodu Alan|fffd| say|fffd|sal olmal|fffd|d|fffd|r")
   Exit Sub
    ElseIf accountNo = Empty Then
        MsgBox ("Hesap Numaras|fffd| Bilgisi Bo|fffd| Ge|fffd|ilemez")
   Exit Sub
    ElseIf IsNumeric(accountNo) = False Then
        MsgBox ("Hesap Numaras|fffd| Alan|fffd| Say|fffd|sal Olmal|fffd|d|fffd|r")
       Exit Sub
    ElseIf accountSuffixNo = Empty Then
        MsgBox ("Hesap Ek No Bilgisi Bo|fffd| Ge|fffd|ilemez")
       Exit Sub
    ElseIf IsNumeric(accountSuffixNo) = False Then
        MsgBox ("Hesap Ek No Alan|fffd| Say|fffd|sal Olmal|fffd|d|fffd|r")
           Exit Sub
        
    ElseIf CLng(accountSuffixNo) > 65099 Or CLng(accountSuffixNo) < 351 Then
        MsgBox ("Ek numaras|fffd| 351 - 651 ile 35100 - 65099 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r.")
           Exit Sub

    ElseIf Len(accountSuffixNo) < 3 Or Len(taccountSuffixNo) > 5 Or Len(accountSuffixNo) = 4 Then
        MsgBox ("Ek numaras|fffd| 351 - 651 ile 35100 - 65099 aral|fffd||fffd||fffd|nda olmal|fffd|d|fffd|r.")
           Exit Sub
    End If


ElseIf accountType = 1 Then

   If (txtIBAN.Text = "") Then
         
      MsgBox ("IBAN bo|fffd| olamaz. Kontrol ediniz...")
      Exit Sub
   
   End If
   
   If (IsNumeric(Mid(txtIBAN.Text, 3, Len(txtIBAN.Text) - 2)) = True) Then
      IBAN = txtIBAN.Text
   
   Else
      MsgBox ("IBAN ilk iki karakteri d|fffd||fffd||fffd|nda rakamlardan olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
       Exit Sub
   
   End If
   
   If (Len(txtIBAN.Text) < 26) Then
           
      MsgBox ("IBAN 26 karakterden olu|fffd|mal|fffd|d|fffd|r. Kontrol ediniz...")
      Exit Sub
   End If
    
   If (IbanKontrol(IBAN) = False) Then
      
      MsgBox ("IBAN No hatal|fffd|. L|fffd|tfen kontrol ediniz.")
      Exit Sub
   End If
    
End If
If TCKimlikNo <> Empty Then
    If (IsNumeric(TCKimlikNo) = False Or Val(TCKimlikNo) = 0 Or (Len(TCKimlikNo) <> 11)) Then
        MsgBox ("T.C. Kimlik Numaras|fffd| Alan|fffd| Say|fffd|sal ve 11 Karakter Olmal|fffd|d|fffd|r")
        Exit Sub
    End If
ElseIf taxNumber <> Empty Then
   
    If (IsNumeric(taxNumber) = False Or Val(taxNumber) = 0 Or (Len(taxNumber) <> 10)) Then
        MsgBox ("Vergi Numaras|fffd| Alan|fffd| Say|fffd|sal ve 10 Karakter Olmal|fffd|d|fffd|r")
        Exit Sub
    End If
End If



Worksheets("PERSONEL").Range("A" & ActiveCell.Row).Value = UCase(txtPersonelName.Text)
Worksheets("PERSONEL").Range("B" & ActiveCell.Row).Value = txtIBAN.Text
Worksheets("PERSONEL").Range("C" & ActiveCell.Row).Value = txtBranchCode.Text
Worksheets("PERSONEL").Range("D" & ActiveCell.Row).Value = txtAccountNo.Text
Worksheets("PERSONEL").Range("E" & ActiveCell.Row).Value = "00" & txtAccountSuffixNo.Text
Worksheets("PERSONEL").Range("E" & ActiveCell.Row).Value = Right(Worksheets("PERSONEL").Range("E" & ActiveCell.Row).Value, 5)
Worksheets("PERSONEL").Range("F" & ActiveCell.Row).Value = txtTaxNo.Text
Worksheets("PERSONEL").Range("G" & ActiveCell.Row).Value = txtTCKN.Text


c = 0

MsgBox ("Personel Bilgisi Ba|fffd|ar|fffd|yla g|fffd|ncellenmi|fffd|tir.")


Unload Me

End Sub
Public Sub FillDrpAccountType()

    drpAccountType.AddItem "IBAN"
    drpAccountType.AddItem "Hesap No"
    drpAccountType.Value = "IBAN"

End Sub

Private Sub drpAccountType_Change()
  
   ' Call FillIBANAndAccountNo
    
    If (drpAccountType.Value) = "Hesap No" Then
  
            lblIBAN.Visible = False
            txtIBAN.Visible = False
            lblAccount.Visible = True
            txtBranchCode.Visible = True
            txtAccountNo.Visible = True
            txtAccountSuffixNo.Visible = True
            lblIBANSeperated.Visible = False
            
            paymentType = 0 'Hesap No
            
     Else
            
            lblIBAN.Visible = True
            txtIBAN.Visible = True
            lblAccount.Visible = False
            txtBranchCode.Visible = False
            txtAccountNo.Visible = False
            txtAccountSuffixNo.Visible = False
            lblIBANSeperated.Visible = True
            
           paymentType = 1 'IBAN
            
     End If

End Sub

Private Sub txtIBAN_Change()
  
   IBAN = txtIBAN.Text
   lblIBANSeperated.Caption = IBAN + lblIBANSeperated.Caption
   lblIBANSeperated.Caption = Mid(IBAN, 1, 4) + " - " + Mid(IBAN, 5, 4) + " - " + Mid(IBAN, 9, 4) + " - " + Mid(IBAN, 13, 4) + " - " + Mid(IBAN, 17, 4) + " - " + Mid(IBAN, 21, 4) + " - " + Mid(IBAN, 25, 2)
   
End Sub


Private Sub BtnExit_Click()
Unload Me
End Sub

Private Sub UserForm_Click()

End Sub

Private Sub UserForm_Initialize()
 Call FillDrpAccountType
txtPersonelName.Text = Worksheets("PERSONEL").Range("A" & ActiveCell.Row).Value
txtIBAN.Text = Worksheets("PERSONEL").Range("B" & ActiveCell.Row).Value
txtBranchCode.Text = Worksheets("PERSONEL").Range("C" & ActiveCell.Row).Value
txtAccountNo.Text = Worksheets("PERSONEL").Range("D" & ActiveCell.Row).Value
txtAccountSuffixNo.Text = Worksheets("PERSONEL").Range("E" & ActiveCell.Row).Value
txtTaxNo.Text = Worksheets("PERSONEL").Range("F" & ActiveCell.Row).Value
txtTCKN.Text = Worksheets("PERSONEL").Range("G" & ActiveCell.Row).Value

 
End Sub

Public Function IbanKontrol(s As String) As Boolean
Dim MyStr As String
Dim yIban As String
Dim sIban As String
Dim i As Integer
Dim aa As String * 1
Dim X As Double
i = 1

yIban = Mid(s, 5) & Mid(s, 1, 4)

Do While i < Len(yIban) + 1
    aa = Mid(yIban, i, 1)
    Select Case aa
            Case "0" To "9"
                MyStr = MyStr & aa
            Case Else
                MyStr = MyStr & CharToNum(aa)
    End Select
i = i + 1
Loop

'X = MyStr Mod 97
X = ModSpe(MyStr, 97)

 If X = 1 Then
    IbanKontrol = True
Else
    IbanKontrol = False
End If

End Function

Public Function ModSpe(s As String, a As Integer) As Integer
Dim l As Integer
Dim i As Integer
Dim t As Double
Dim r As String
Dim F As Boolean

l = Len(s)
r = ""

If l > 6 Then
    i = 1
    r = ""
    Do
         t = CDec(r & Mid(s, i, 6)) Mod a
         r = t
         
         i = i + 6
         If i > l Then
            F = True
         Else
            F = False
         End If
    Loop Until F
    ModSpe = r
Else
    ModSpe = CDec(s) Mod a
End If

End Function



Public Function CharToNum(s As String) As String
Dim t As String
Select Case s
    Case "A"
         t = "10"
    Case "B"
         t = "11"
    Case "C"
         t = "12"
    Case "D"
         t = "13"
    Case "E"
         t = "14"
    Case "F"
         t = "15"
    Case "G"
         t = "16"
    Case "H"
         t = "17"
    Case "I"
         t = "18"
    Case "J"
         t = "19"
    Case "K"
         t = "20"
    Case "L"
         t = "21"
    Case "M"
         t = "22"
    Case "N"
         t = "23"
    Case "O"
         t = "24"
    Case "P"
         t = "25"
    Case "Q"
         t = "26"
    Case "R"
         t = "27"
    Case "S"
         t = "28"
    Case "T"
         t = "29"
    Case "U"
         t = "30"
    Case "V"
         t = "31"
    Case "W"
         t = "32"
    Case "X"
         t = "33"
    Case "Y"
         t = "34"
    Case "Z"
         t = "35"
End Select
CharToNum = t
End Function




INQUEST-PP=macro
