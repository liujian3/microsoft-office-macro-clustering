Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
'====================================
'== |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|===================
'== |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||2f0||fffd||fffd||fffd||fffd||fffd|==================
'== 2013-06-26 |fffd||fffd|====================
'== By kim wonsob====================
'====================================

Const POP = 200
Const VehicleCapacity = 2500 ' |fffd||fffd||fffd||fffd| |fffd||bdee| |fffd||2b0||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
Const LENTH = 44 '|fffd||fffd||fffd||fc||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
Const CROSSOVER_RATE = 0.6 '0.6 |fffd||33f||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| 80% |fffd||fffd| |fffd||fffd||fffd||f5||234||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||388f0||fffd||fffd||fffd|
Const MUTATION_RATE = 0.01
Const FuelEfficiency = 10
Const ROUTE = 4             ' ROUTE |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||178||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd| |fffd||1bd||fffd||fffd||fffd| 6|fffd||334||fffd|.
Const Vehicle_Speed = 60


Option Explicit

    Dim NEWGENE As Variant                '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||3bf||fffd| Gene|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||338||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||3bd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)
    Dim GRADIENT_COEFFICIENT As Variant   '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||adff||fffd||67f||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||3f4||fffd| |fffd||fffd||7d75||fffd||fffd||fffd|)
    Dim GRADIENT As Variant               '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||7dee||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||3f4||fffd| |fffd||fffd||7d75||fffd||fffd|)
    Dim OBJECT As Variant                 '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||adff||fffd||67f||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||53c||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||178||fffd||fffd||fffd||fffd| |fffd||fffd|)
    Dim DIS As Variant                    '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||335||fffd||fffd||178||fffd||fffd||fffd| |fffd||fffd||178||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||3f4||fffd| |fffd||178||fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
    Dim ELITEGENE As Variant              '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (ELITE |fffd||fffd| GENE |fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||1b5||fffd|)
        
    
    Dim TEMPOBJECT As Single              '|fffd||4fd||fffd||fffd||fffd||fffd||fffd||fffd||3ff||fffd|, |fffd||5bc||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||53c||fffd||fffd||fffd| |fffd||4fd||fffd| |fffd||fffd||fffd||fffd||fffd||3f4||fffd| |fffd||fffd|
    
 
Private Sub MAIN_Genetic_Algorithm()
    Dim i As Integer
    Dim j As Integer
    Dim runtime As Date
    
    Application.ScreenUpdating = False
    
    runtime = Time             'CODE |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||f0||fffd|
    
    ReDim ELITEGENE(1, 1 To 1 + LENTH + LENTH) ' 1|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||53c||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||330||fffd|, lenth + lenth |fffd||fffd| |fffd||5f6||fffd||fffd||fffd| |fffd||6e6e||fffd||fffd||fffd||fffd| |fffd||fffd| Route|fffd||fffd| |fffd||fffd||b4||fffd|.
                
    DISTANCE                   '(|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||335||fffd||fffd||178||fffd||fffd||fffd| |fffd||8fed||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|) 'DIS(I,J)
    CAL_GRADIENT               '(|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||7d75| |fffd||fffd| |fffd||fffd||7d75| |fffd||fffd||fffd||fffd||fffd| |fffd||8fed||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|)   'GARADIENT, GRADIENT_COEFFICIENT
    
    TEMPOBJECT = 999999        'Elite |fffd||fffd||fffd||fffd||fffd||6bf||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||53c||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||2b1||fffd| |fffd||fffd||fffd||fffd| |16b| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|
    
    
    
    INITIALROULLETWHEEL        '(|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)

'    For i = 1 To 1
'        GENEEXCHANGE      '(|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||8fed|)

'        NEIGHBORHOOD_REMOVE                  (|fffd||fffd||fffd||fffd||ff||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)
 '       CROSS_OVER          '(|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)
 '       MUTATION            '(|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)
 '       ROULLETWHEEL

'        For j = 1 To 1 + LENTH + LENTH
'            Sheets(2).Cells(i, j + 2).Value = ELITEGENE(1, j)
'        Next j
'
'    Next i
    
    
   '============ |fffd||330||fffd|, NEWGENE |fffd||fffd| |fffd||fffd||fffd||fffd| |22e||fffd||fffd||fffd||3f1||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| ============
    'For i = 1 To POP
    '    For j = 1 To LENTH + LENTH
    '        Sheets(2).Cells(i + 1, j + 2).Value = NEWGENE(i, j)
    '    Next j
    'Next i
    
    Sheets(1).Cells(1, 8).Value = Time - runtime     ' CODE |fffd||fffd| |fffd||fffd||fffd||fffd||f0||fffd|

End Sub
Private Sub DISTANCE()   '|fffd||3f7||fffd|
    Dim i As Integer
    Dim j As Integer
        
    ReDim DIS(0 To LENTH, 0 To LENTH)              ' |fffd||fffd||fffd||2f2d|, DIS(0, 10) |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 0|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 10|fffd||fffd||fffd||fffd| |fffd||335||fffd||fffd||178||fffd|, DIS(2,0) |fffd||fffd| 2|fffd||fffd||fffd||fffd| 0|fffd||fffd||fffd||fffd| |fffd||335||fffd||fffd||178||fffd|
                                                   ' |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd| 0 |fffd||fffd| DEPOT|fffd||fffd| |fffd||1f9||fffd||fffd||474||fffd|.
        For i = 1 To LENTH + 1
            For j = 1 To LENTH + 1
                DIS(i - 1, j - 1) = ((Cells(3 + i, 4) - Cells(3 + j, 4)) ^ 2 _
                         + (Cells(3 + i, 5) - Cells(3 + j, 5)) ^ 2) ^ 0.5
            Next j
        Next i
        
End Sub

Private Sub CAL_GRADIENT()    ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||3f7||fffd|)
    Dim i As Integer
    Dim j As Integer
    Dim DISTEMP As Variant
    Dim HEIGHT As Variant
    Dim TEMPVAR As Variant
        
    ReDim GRADIENT_COEFFICIENT(0 To LENTH, 0 To LENTH)                  ' |fffd||fffd||fffd||2f2d|, GRADIENT_COEFFICIENT (0, 10) |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 0|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 10|fffd||fffd||fffd||fffd| |fffd||fffd||7d75||fffd||fffd||fffd|, DIS(2,0) |fffd||fffd| 2|fffd||fffd||fffd||fffd| 0|fffd||fffd||fffd||fffd| |fffd||fffd||7d75|
    ReDim GRADIENT(0 To LENTH, 0 To LENTH)                              ' |fffd||fffd||fffd||2f2d|, GRADIENT (0, 10) |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 0|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 10|fffd||fffd||fffd||fffd| |fffd||fffd||7d75|, DIS(2,0) |fffd||fffd| 2|fffd||fffd||fffd||fffd| 0|fffd||fffd||fffd||fffd| |fffd||fffd||7d75|
                                                                        ' |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd| 0 |fffd||fffd| DEPOT|fffd||fffd| |fffd||1f9||fffd||fffd||474||fffd|.
    
    ReDim DISTEMP(0 To LENTH, 0 To LENTH)
    ReDim HEIGHT(0 To LENTH, 0 To LENTH)
    ReDim TEMPVAR(0 To LENTH, 0 To LENTH)
    
    For i = 1 To LENTH + 1
        For j = 1 To LENTH + 1
            HEIGHT(i - 1, j - 1) = Cells(3 + j, 7).Value - Cells(3 + i, 7).Value '|fffd||330||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd|
            DISTEMP(i - 1, j - 1) = ((((Cells(3 + j, 4) - Cells(3 + i, 4)) ^ 2) ^ 0.5) * 110996.8 + (((Cells(3 + j, 5) - Cells(3 + i, 5)) ^ 2) ^ 0.5) * 87754.2) '(|fffd||330||fffd| |fffd||178||fffd| |fffd||fffd||fffd|)
        Next j
    Next i
    
    
    For i = 1 To LENTH + 1
        For j = 1 To LENTH + 1
            If HEIGHT(i - 1, j - 1) = 0 Then
               HEIGHT(i - 1, j - 1) = 0.00001
            End If
            
            If DISTEMP(i - 1, j - 1) = 0 Then
               DISTEMP(i - 1, j - 1) = 0.00001
            End If
        Next j
    Next i
    
    
    For i = 1 To LENTH + 1
        For j = 1 To LENTH + 1
            TEMPVAR(i - 1, j - 1) = (DISTEMP(i - 1, j - 1)) ^ 2 + (HEIGHT(i - 1, j - 1)) ^ 2
        Next j
    Next i
    
    For i = 1 To LENTH + 1
        For j = 1 To LENTH + 1
            GRADIENT(i - 1, j - 1) = (HEIGHT(i - 1, j - 1) / (TEMPVAR(i - 1, j - 1) - (HEIGHT(i - 1, j - 1)) ^ 2) ^ 0.5) * 100 * 10000 '|fffd||fffd||7d75||fffd||fffd| GRADIENT |fffd||8fed||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
        Next j
    Next i
    
    For i = 1 To LENTH + 1                                                                                      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        For j = 1 To LENTH + 1
            If i = j Then
                GRADIENT_COEFFICIENT(i - 1, j - 1) = 99999
            
            ElseIf i <> j Then
            
            Select Case GRADIENT(i - 1, j - 1)
            
            Case -90 To -4
            GRADIENT_COEFFICIENT(i - 1, j - 1) = (0.0000258 * Vehicle_Speed ^ 2) + (-0.00481 * Vehicle_Speed) + 0.482
            
            
            Case -4 To -2
            GRADIENT_COEFFICIENT(i - 1, j - 1) = (0.0000891 * Vehicle_Speed ^ 2) + (-0.0162 * Vehicle_Speed) + 1.12
            
            
            Case -2 To 0
            GRADIENT_COEFFICIENT(i - 1, j - 1) = (0.0000148 * Vehicle_Speed ^ 2) + (-0.00312 * Vehicle_Speed) + 0.885
            
            
            Case 0 To 2
            GRADIENT_COEFFICIENT(i - 1, j - 1) = (-0.00000787 * Vehicle_Speed ^ 2) + (0.00392 * Vehicle_Speed) + 1.11
            
            
            Case 2 To 4
            GRADIENT_COEFFICIENT(i - 1, j - 1) = (-0.0000356 * Vehicle_Speed ^ 2) + (0.00699 * Vehicle_Speed) + 1.52
            
            
            Case 4 To 90
            GRADIENT_COEFFICIENT(i - 1, j - 1) = (-0.0000642 * Vehicle_Speed ^ 2) + (0.0096 * Vehicle_Speed) + 1.89
            
            End Select
            
            End If
        Next j
    Next i
    
    Set DISTEMP = Nothing                '|fffd||8fed||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||5b4||fffd| |fffd||fffd||fffd||fffd| |fffd||2b1||fffd||22d|
    Set HEIGHT = Nothing                 '|fffd||8fed||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||5b4||fffd| |fffd||fffd||fffd||fffd| |fffd||2b1||fffd||22d|
    Set TEMPVAR = Nothing                '|fffd||8fed||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||5b4||fffd| |fffd||fffd||fffd||fffd| |fffd||2b1||fffd||22d|
End Sub

Private Sub INITIALROULLETWHEEL() '|fffd||3f7||fffd|

    '===================
    '=|fffd||fffd||fffd||fffd||fffd||53c||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|=
    '===================
    
    Dim a, b, c, d, i, j, r, k, t, s As Integer
    Dim sum As Single
    Dim INITIALGene As Variant
    
    ReDim OBJECT(1 To POP, 0)
    
    INITIALSOLUTION INITIALGene
 
    For i = 1 To POP
        a = 0
        b = 0
        c = 0
        d = 0
        r = 0
        s = 0
        sum = 0
    
    For j = 1 To LENTH
        If INITIALGene(i, j + LENTH) = 1 Then
            a = a + 1
        ElseIf INITIALGene(i, j + LENTH) = 2 Then
            b = b + 1
        ElseIf INITIALGene(i, j + LENTH) = 3 Then
            c = c + 1
        ElseIf INITIALGene(i, j + LENTH) = 4 Then
            d = d + 1
        ElseIf INITIALGene(i, j + LENTH) = 5 Then
            r = r + 1
        ElseIf INITIALGene(i, j + LENTH) = 6 Then
            s = s + 1
        End If
    
    Next j

'=========== Route 1 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If a >= 1 Then
    k = 1
    For j = 1 To a
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5
    End If

'=========== Route 2 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If b >= 1 Then
    k = 1
    For j = a + 1 To a + b
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5

    End If

'=========== Route 3 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
   If c >= 1 Then
    k = 1
    For j = a + b + 1 To a + b + c
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5

    End If
    
'=========== Route 4 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If d >= 1 Then
    k = 1
    For j = a + b + c + 1 To a + b + c + d
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5
    End If

'=========== Route 5 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If r >= 1 Then
    k = 1
    For j = a + b + c + d + 1 To a + b + c + d + r
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5
    End If

'=========== Route 6 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If s >= 1 Then
    k = 1
    For j = a + b + c + d + r + 1 To a + b + c + d + r + s
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5

    End If



'===== |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||53c||fffd||fffd||fffd| |fffd||fffd||b4||fffd|. ==========
        OBJECT(i, 0) = sum '|fffd||335||fffd||fffd||178||fffd| |fffd||5bc||fffd||22d| |fffd||fffd||fffd||fffd||fffd||53c||fffd| sum |fffd||fffd| object|fffd||fffd| |fffd||fffd||fffd||fffd||634||fffd|.
   
        sum = 0
Next i
    
    
    '===========================
    '= |fffd||fffd||fffd||fffd| |fffd||53c||fffd| |fffd||fffd||fffd||fffd| |fffd||477||fffd||fffd||634||fffd|.=
    '===========================


    '==================================
    '===== |fffd||adff| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
    '==================================
    
    Dim FitnessValue As Variant
    Dim FitnessValuesum As Single
    Dim FitnessValuerate As Variant
    Dim SumOfFitness As Single
    
    ReDim FitnessValue(1 To POP)
    ReDim fitnessrate(1 To POP)
    ReDim NEWGENE(1 To POP, 1 To LENTH + LENTH)
      
    c = 2 'linear scaling
    
    Maxvalue = Application.Max(OBJECT)
    Minvalue = Application.Min(OBJECT)
    Meanvalue = Application.Average(OBJECT)

'================ linear Scaling ================
            a = ((c - 1) * Meanvalue) / (Minvalue - Meanvalue)
            b = (Meanvalue * (Minvalue - c * Meanvalue)) / (Minvalue - Meanvalue)
            
            For i = 1 To POP
                FitnessValue(i) = a * OBJECT(i, 0) + b
            Next i
'================================================

    For i = 1 To POP
        FitnessValuesum = FitnessValuesum + FitnessValue(i)
    Next i

    For i = 1 To POP
        fitnessrate(i) = FitnessValue(i) / FitnessValuesum
    Next i
    
'===============================================
'===== |fffd||fffd||fffd||f5||fffd| |fffd||fffd||fffd||fffd||fffd||6b8||fffd| gene(i, j)|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| =====
'===============================================
    
    For i = 1 To POP
        Random = rnd()
        SumOfFitness = 0
        
        For j = 1 To POP
            SumOfFitness = SumOfFitness + fitnessrate(j)
            If (Random < SumOfFitness) Then Exit For
        Next j
        
        For k = 1 To LENTH + LENTH
            NEWGENE(i, k) = INITIALGene(j, k)
        Next k
    
    Next i
    
    Set FitnessValue = Nothing
    Set FitnessValuerate = Nothing

End Sub
Private Sub INITIALSOLUTION(INITIALGene) '|fffd||3f7||fffd|
          
        Dim CreateGENE As New Collection
        Dim i, j, r, k, t As Integer
        Dim sum As Single
        
        ReDim INITIALGene(1 To POP, 1 To LENTH + LENTH)
                

        For i = 1 To POP                     '// |fffd||fffd| population |fffd||fffd||fffd||fffd||fffd||fffd||16d| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||7fb||fffd|
            On Error Resume Next
                Do

                    k = Int(LENTH * rnd) + 1
                    CreateGENE.Add k, CStr(k)
                
                Loop Until CreateGENE.Count = LENTH

                j = 1
                
                For Each r In CreateGENE
                    INITIALGene(i, j) = r
                    j = j + 1
                Next r
            Set CreateGENE = Nothing
        Next i


    For i = 1 To POP
        t = 1
        sum = 0
        For j = 1 To LENTH
            sum = sum + Cells(4 + INITIALGene(i, j), 6).Value
                If sum > VehicleCapacity Then
                    t = t + 1
                    sum = Cells(4 + INITIALGene(i, j), 6).Value
                    INITIALGene(i, j + LENTH) = t
                
                ElseIf sum <= VehicleCapacity Then
                    INITIALGene(i, j + LENTH) = t
                End If
        Next j
        
    Next i

End Sub
Private Sub NEIGHBORHOOD_REMOVE()

Dim DIS  As Variant
Dim GENE As Variant
Dim REMOVE As Variant
Dim DISTEMP As Single
Dim INSERTGENE As Variant

ReDim REMOVE(1 To POP, 1 To ROUTE)
ReDim GENE(1 To POP, 1 To LENTH + LENTH)
ReDim INSERTGENE(1 To POP, 1 To LENTH + LENTH)


For i = 1 To POP
    For j = 1 To LENTH + LENTH
        GENE(i, j) = NEWGENE(i, j)
    Next j
Next i




'================ REMOVE CODE ================

For i = 1 To POP
t = 1                                        ' |fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| ROUTE |fffd||fffd| 1|fffd||fffd| |fffd||331||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||2b1||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
k = 1
ReDim DIS(1 To LENTH + 1)                    ' K |fffd||fffd| DEPOT |fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3f1||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    
    For j = 1 To LENTH
                
        If GENE(i, j + LENTH) = t Then       ' |fffd||fffd||fffd||fffd| T = 1, 2, 3, 4 |fffd||fffd| ROUTE |fffd||7ff||fffd| |fffd||fffd||fffd||f5||1fe||fffd||fffd||678||fffd|
            
            If k = 1 Then                    ' DEPOT|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
                
                DIS(j) = ((Cells(1, 4) - Cells(4 + GENE(i, j), 4)) ^ 2 _
                         + (Cells(1, 5) - Cells(4 + GENE(i, j), 5)) ^ 2) ^ 0.5
                
                k = k + 1                    ' ROUTE |fffd||fffd| |fffd||fffd||fffd||fffd||5b4||fffd| |fffd||fffd||fffd||fc||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd|
            
            ElseIf k <> 1 Then               ' |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
                
                DIS(j) = ((Cells(4 + GENE(i, j - 1), 4) - Cells(4 + GENE(i, j), 4)) ^ 2 _
                         + (Cells(4 + GENE(i, j - 1), 5) - Cells(4 + GENE(i, j), 5)) ^ 2) ^ 0.5
                
                k = k + 1                    ' ROUTE |fffd||fffd| |fffd||fffd||fffd||fffd||5b4||fffd| |fffd||fffd||fffd||fc||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd|
            
            End If

        ElseIf GENE(i, j + LENTH) <> t Then  '1, 2, 3, |fffd||fffd| ROUTE|fffd||fffd| |fffd||fffd||fffd||2f2d| REMOVE |fffd||fffd||fffd||fffd||fffd||63e||fffd| |fffd||474||fffd|.
            
            DIS(j) = ((Cells(1, 4) - Cells(4 + GENE(1, j), 4)) ^ 2 _
                         + (Cells(1, 5) - Cells(4 + GENE(1, j), 5)) ^ 2) ^ 0.5         ' |fffd||fffd||fffd||fffd||fffd||fffd|, DIS(J) |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| DEPOT |fffd||fffd||fffd||fffd| |fffd||178||fffd|
            
            
            If Application.Max(DIS) > 1.2 * Application.Average(DIS) Then              ' |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||178||fffd||fffd||fffd||fffd||fffd| 1.2 |fffd||8c21| |169||fffd||fffd|, DIS(A) |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||636||fffd|
                
                For x = 1 To LENTH
                    If DIS(x) = Application.Max(DIS) Then
                       REMOVE(i, t) = GENE(i, j)
                    End If
                Next x
                
            End If
            
            k = 1                                                                      ' |fffd||fffd||fffd||fffd| ROUTE|fffd||fffd| DEPOT|fffd||fffd||fffd||fffd| |f3||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd||fffd||fffd| |fffd||fffd||fffd||63e||fffd| |fffd||3f4||3f1||fffd| K =1 |fffd||fffd||fffd||fffd|
            t = t + 1                                                                  ' |fffd||339||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ROUTE|fffd||fffd| |fffd||fffd||fffd||63c||fffd| REMOVE|fffd||fffd| |fffd||fffd||fffd||63e||fffd||fffd||474||fffd|.
        End If
        
    Next j

    ' |fffd||fffd||fffd||fffd||fffd||fffd| ROUTE|fffd||fffd| |fffd||fffd||fffd||2f2d| REMOVE |fffd||fffd||fffd||fffd| |fffd||63e||fffd||fffd||474||fffd|.
    ' |fffd||fffd||fffd||fffd| T = 4 |fffd||3b0||fffd||fffd||fffd| T |fffd||fffd| 5|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||230||fffd||fffd||3f1||fffd|, FOR J |fffd||77a||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||333||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||2fe1| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
         
         j = LENTH                                                                     ' NEXT J |fffd||3f1||fffd|, J+1 |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||1fe||fffd||fffd||fffd||fffd||fffd||fffd|.
         
         DIS(j) = ((Cells(1, 4) - Cells(4 + GENE(1, j), 4)) ^ 2 _
                         + (Cells(1, 5) - Cells(4 + GENE(1, j), 5)) ^ 2) ^ 0.5         ' |fffd||fffd||fffd||fffd||fffd||fffd|, DIS(J) |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| DEPOT |fffd||fffd||fffd||fffd| |fffd||178||fffd|
            
            
            If Application.Max(DIS) > 1.5 * Application.Average(DIS) Then              ' |fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||178||fffd||fffd||fffd||fffd||fffd| 1.5 |fffd||8c21| |169||fffd||fffd|, DIS(A) |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||636||fffd|
                
                For x = 1 To LENTH
                    If DIS(x) = Application.Max(DIS) Then
                       REMOVE(i, t) = GENE(i, j)
                    End If
                Next x
                
            End If
Next i



'================ INSERT CODE ================

For i = 1 To POP

k = 0
DISTEMP = 99999
ReDim DIS(1 To LENTH)
    
    Do
        k = k + 1
        
        If REMOVE(i, k) = "" Then                                               ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||63e||fffd||fffd||3f4||fffd| ROUTE|fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            
        
        ElseIf REMOVE(i, k) <> "" Then                                          ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||63e||fffd||fffd||3f4||fffd| ROUTE|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||474||678||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            
            For j = 1 To LENTH                                                 ' |fffd||fffd||fffd||fffd| |fffd||63e||fffd||fffd||3f4||fffd| ROUTE|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |e3||fffd||1be||fffd| |fffd||fffd|
                DIS(j) = Abs(Cells(4 + GENE(i, j), 4) - Cells(4 + REMOVE(i, k), 4)) _
                        + Abs(Cells(4 + GENE(i, j), 5) - Cells(4 + REMOVE(i, k), 5))       '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||121||fffd||fffd| |e3||fffd||b4||fffd|.
                
                If DIS(j) = 0 Then                                                        '0 |fffd||336||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||230||fffd||fffd||674||fffd| |fffd||fffd||fffd||334||fffd|.
                        y = j                                                             'GENE(I,J)|fffd||fffd||fffd||fffd| REMOVE |fffd||fffd| |fffd||fffd||121||fffd||fffd| Y |fffd||fffd||fffd||fffd| |fffd||fffd||121||fffd||334||fffd|.
                        
                ElseIf DIS(j) <> 0 Then
                    
                    If DIS(j) < DISTEMP Then
                        DISTEMP = DIS(j)
                        x = j                                                             ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||121||fffd||fffd| |e3||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||5f6||fffd||fffd||fffd| |fffd||fffd||121||fffd||fffd| X|fffd||fffd| |fffd||fffd|
                    End If
                End If
            Next j
        
        
        If y < x Then                                                                     ' REMOVE |fffd||3f4||fffd| |fffd||fffd| INSERT |fffd||3f4||fffd| |fffd||fffd||121||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
            t = 1
            For j = 1 To x
                If j = y Then
                
                ElseIf j <> y Then
                    NEWGENE(i, t) = GENE(i, j)
                    t = t + 1
                End If
            Next j
                    
            NEWGENE(i, t) = GENE(i, y)
                    
            For j = x + 1 To LENTH
                NEWGENE(i, j) = GENE(i, j)
            Next j
        
        ElseIf y > x Then
            t = 1
            
            For j = 1 To x
                NEWGENE(i, j) = GENE(i, j)
                t = t + 1
            Next j
            
            NEWGENE(i, t) = GENE(i, y)
            t = t + 1
            
            For j = x + 1 To LENTH
                If j = y Then
                
                ElseIf j <> y Then
                    NEWGENE(i, t) = GENE(i, j)
                    t = t + 1
                End If
            Next j
        End If

        End If
        
    Loop Until k = ROUTE

Next i

End Sub

Private Sub GENEEXCHANGE() '|fffd||3f7||fffd|
    Dim i, j, k, t, p, x As Integer
    Dim a, b, c, d, r, s As Integer
    
ReDim DISTEMP(0 To LENTH, 1 To LENTH)
ReDim DIS(0 To LENTH, 1 To LENTH)
ReDim GENE(1 To POP, 1 To LENTH + LENTH)



For i = 1 To POP
    For j = 1 To LENTH + LENTH
        GENE(i, j) = NEWGENE(i, j)
    Next j
Next i
     
    '==== |fffd||178||fffd| |fffd||fffd||1ae||fffd||fffd||fffd||fffd||fffd||fffd| population |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||5b3||fffd||fffd||3f8||fffd| |fffd||fffd||fffd| 9999 |fffd||fffd| |fffd||1fe||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
For i = 1 To LENTH

    
    DIS(0, i) = ((Cells(1, 4).Value - Cells(i + 4, 4).Value) ^ 2 + (Cells(1, 5).Value - Cells(i + 4, 5).Value) ^ 2) ^ 0.5 'Depot|fffd||fffd| |fffd||178||fffd|
    DISTEMP(0, i) = ((Cells(1, 4).Value - Cells(i + 4, 4).Value) ^ 2 + (Cells(1, 5).Value - Cells(i + 4, 5).Value) ^ 2) ^ 0.5 'Depot|fffd||fffd| |fffd||178||fffd|
    
    For j = 1 To LENTH
                If i = j Then
                    DIS(i, j) = 9999
                    DISTEMP(i, j) = 9999
                ElseIf i <> j Then
                    DIS(i, j) = ((Cells(i + 4, 4).Value - Cells(j + 4, 4).Value) ^ 2 + (Cells(i + 4, 5).Value - Cells(j + 4, 5).Value) ^ 2) ^ 0.5 '|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                    DISTEMP(i, j) = ((Cells(i + 4, 4).Value - Cells(j + 4, 4).Value) ^ 2 + (Cells(i + 4, 5).Value - Cells(j + 4, 5).Value) ^ 2) ^ 0.5 '|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
        End If
    Next j
Next i
    
    
For i = 1 To POP
    
    a = 0
    b = 0
    c = 0
    d = 0
    r = 0
    s = 0
    
    For j = 1 To LENTH
        
        If GENE(i, j + LENTH) = 1 Then
            a = a + 1
        ElseIf GENE(i, j + LENTH) = 2 Then
            b = b + 1
        ElseIf GENE(i, j + LENTH) = 3 Then
            c = c + 1
        ElseIf GENE(i, j + LENTH) = 4 Then
            d = d + 1
        ElseIf GENE(i, j + LENTH) = 5 Then
            r = r + 1
        ElseIf GENE(i, j + LENTH) = 6 Then
            s = s + 1
        End If
    
    Next j
    
    For j = 0 To LENTH
        For k = 1 To LENTH
            DIS(j, k) = DISTEMP(j, k)
        Next k
    Next j
            
    

'==============================================
'=========|f9||fffd||fffd||fffd||fffd|  Route========================
'==============================================

' Route|fffd||fffd| |fffd||fffd||fffd||6b4||fffd|, a, b, c, d, r, s |fffd||fffd| 6|fffd||fffd| |fffd||334||fffd|.


' ===== |f9||fffd||fffd||b0| Route |fffd||fffd| Gene Exchage =====
    If a >= 3 Then

        x = 1
        Do
'===== |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||1fe||fffd||fffd| |fffd||3f8||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||5be||fffd||fffd||fffd| ====
        If x = 1 Then
        t = 9999
        'For j = 1 To a
        '        If t > DIS(0, GENE(i, j)) Then
        '            t = DIS(0, GENE(i, j))
        '            k = j
        '        End If
        '    p = k
        'Next j
            NEWGENE(i, x) = GENE(i, x)
            p = x
        

        
'===== |fffd||677||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
        ElseIf x > 1 Then
        
        t = 9999
        For j = 1 To a
                    If t > DIS(GENE(i, p), GENE(i, j)) Then
                            t = DIS(GENE(i, p), GENE(i, j))
                            k = j
                    End If
        Next j
        
        NEWGENE(i, x) = GENE(i, k)
        
        For j = 1 To LENTH
            DIS(GENE(i, p), j) = 9999
            DIS(j, GENE(i, p)) = 9999
        Next j
        
        p = k
        
        End If
        
        x = x + 1
        Loop Until x = a + 1
    
    ElseIf a < 3 Then
        
        For j = 1 To a
            NEWGENE(i, j) = GENE(i, j)
        Next j
        
    End If
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
      
   
  
'==============================================
'=========|fffd||3b9||fffd||fffd||fffd|  Route========================
'==============================================
    If b >= 3 Then
        x = a + 1
        Do
'===== |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ====
        If x = a + 1 Then
        
        't = 9999
        'For j = a + 1 To a + b
        '        If t > DIS(0, GENE(i, j)) Then
        '            t = DIS(0, GENE(i, j))
        '            k = j
        '       End If
        '    p = k
        'Next j
        
        NEWGENE(i, x) = GENE(i, x)
        p = x

        
'===== |fffd||677||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
        ElseIf x > a + 1 Then
        
        t = 9999
        For j = a + 1 To a + b
                    If t > DIS(GENE(i, p), GENE(i, j)) Then
                            t = DIS(GENE(i, p), GENE(i, j))
                            k = j
                    End If
        Next j
        
        NEWGENE(i, x) = GENE(i, k)
        
        For j = 1 To LENTH
            DIS(GENE(i, p), j) = 9999
            DIS(j, GENE(i, p)) = 9999
        Next j
        
        p = k
        
        End If
        
        x = x + 1
        Loop Until x = a + b + 1
    
     ElseIf b < 3 Then
        
        For j = a + 1 To a + b
            NEWGENE(i, j) = GENE(i, j)
        Next j
    
    End If
            
            
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
    

  
'==============================================
'=========|fffd||fffd||fffd||fffd||fffd||fffd|  Route========================
'==============================================
            
    
    If c >= 3 Then
          x = a + b + 1
        Do
'===== |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ====
        If x = a + b + 1 Then
       
       ' t = 9999
       ' For j = a + b + 1 To a + b + c
       '         If t > DIS(0, GENE(i, j)) Then
       '             t = DIS(0, GENE(i, j))
       '             k = j
       '         End If
       '     p = k
       ' Next j
        
        NEWGENE(i, x) = GENE(i, x)
        p = x


        
'===== |fffd||677||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
        ElseIf x > a + b + 1 Then
        
        t = 9999
        For j = a + b + 1 To a + b + c
                    If t > DIS(GENE(i, p), GENE(i, j)) Then
                            t = DIS(GENE(i, p), GENE(i, j))
                            k = j
                    End If
        Next j
        
        NEWGENE(i, x) = GENE(i, k)
        
        For j = 1 To LENTH
            DIS(GENE(i, p), j) = 9999
            DIS(j, GENE(i, p)) = 9999
        Next j
        
        p = k
        
        End If
        
        x = x + 1
        Loop Until x = a + b + c + 1
    
    ElseIf c < 3 Then
        
        For j = a + b + 1 To a + b + c
            NEWGENE(i, j) = GENE(i, j)
        Next j
    
    End If
    
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================


  
'==============================================
'=========|fffd||5f9||fffd||fffd||fffd|  Route========================
'==============================================
            
    
    If d >= 3 Then
          x = a + b + c + 1
        Do
'===== |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ====
        If x = a + b + c + 1 Then
        
        't = 9999
        'For j = a + b + c + 1 To a + b + c + d
        '        If t > DIS(0, GENE(i, j)) Then
        '            t = DIS(0, GENE(i, j))
        '            k = j
        '        End If
        '    p = k
        'Next j
        
        NEWGENE(i, x) = GENE(i, x)
        p = x

        
'===== |fffd||677||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
        ElseIf x > a + b + c + 1 Then
        
        t = 9999
        For j = a + b + c + 1 To a + b + c + d
                    If t > DIS(GENE(i, p), GENE(i, j)) Then
                            t = DIS(GENE(i, p), GENE(i, j))
                            k = j
                    End If
        Next j
        
        NEWGENE(i, x) = GENE(i, k)
        
        For j = 1 To LENTH
            DIS(GENE(i, p), j) = 9999
            DIS(j, GENE(i, p)) = 9999
        Next j
        
        p = k
        
        End If
        
        x = x + 1
        Loop Until x = a + b + c + d + 1
    
    ElseIf d < 3 Then
        
        For j = a + b + c + 1 To a + b + c + d
            NEWGENE(i, j) = GENE(i, j)
        Next j
    
    End If
    
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================


'==============================================
'=========|fffd||67c||fffd||fffd||fffd||fffd||fffd|  Route========================
'==============================================
            
    
    If r >= 3 Then
          x = a + b + c + d + 1
        Do
'===== |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ====
        If x = a + b + c + d + 1 Then
        't = 9999
        'For j = a + b + c + d + 1 To a + b + c + d + r
        '        If t > DIS(0, GENE(i, j)) Then
        '            t = DIS(0, GENE(i, j))
        '            k = j
        '        End If
        '    p = k
        'Next j
        
        NEWGENE(i, x) = GENE(i, x)
        p = x


        
'===== |fffd||677||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
        ElseIf x > a + b + c + d + 1 Then
        
        t = 9999
        For j = a + b + c + d + 1 To a + b + c + d + r
                    If t > DIS(GENE(i, p), GENE(i, j)) Then
                            t = DIS(GENE(i, p), GENE(i, j))
                            k = j
                    End If
        Next j
        
        NEWGENE(i, x) = GENE(i, k)
        
        For j = 1 To LENTH
            DIS(GENE(i, p), j) = 9999
            DIS(j, GENE(i, p)) = 9999
        Next j
        
        p = k
        
        End If
        
        x = x + 1
        Loop Until x = a + b + c + d + r + 1
    
    ElseIf r < 3 Then
        
        For j = a + b + c + d + 1 To a + b + c + d + r
            NEWGENE(i, j) = GENE(i, j)
        Next j
    
    End If
    
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================


'==============================================
'=========|fffd||67c||fffd||fffd||fffd||fffd||fffd|  Route========================
'==============================================
            
    
    If s >= 3 Then
          x = a + b + c + d + r + 1
        Do
'===== |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| ====
        If x = a + b + c + d + r + 1 Then
        
        't = 9999
        'For j = a + b + c + d + r + 1 To a + b + c + d + r + s
        '        If t > DIS(0, GENE(i, j)) Then
        '            t = DIS(0, GENE(i, j))
        '            k = j
        '        End If
        '    p = k
        'Next j
        NEWGENE(i, x) = GENE(i, k)
        p = x


        
'===== |fffd||677||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
        ElseIf x > a + b + c + d + r + 1 Then
        
        t = 9999
        For j = a + b + c + d + r + 1 To a + b + c + d + r + s
                    If t > DIS(GENE(i, p), GENE(i, j)) Then
                            t = DIS(GENE(i, p), GENE(i, j))
                            k = j
                    End If
        Next j
        
        NEWGENE(i, x) = GENE(i, k)
        
        For j = 1 To LENTH
            DIS(GENE(i, p), j) = 9999
            DIS(j, GENE(i, p)) = 9999
        Next j
        
        p = k
        
        End If
        
        x = x + 1
        Loop Until x = a + b + c + d + r + s + 1
    
    ElseIf s < 3 Then
        
        For j = a + b + c + d + r + 1 To a + b + c + d + r + s
            NEWGENE(i, j) = GENE(i, j)
        Next j
    
    End If
    
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================
' ========================================================================================================================

Next i

End Sub

Private Sub CROSS_OVER() '|fffd||3f7||fffd|
    
    Dim TEMPPMX As Variant
    Dim TEMPNEWGENE As Variant
    Maxvalue = LENTH - 2
    Minvalue = 2
    
    Do
    
    k = 0
    ReDim GENE(1 To POP, 1 To LENTH)
    ReDim TEMPPMX(1 To POP)
    ReDim TEMPNEWGENE(1 To POP, 1 To LENTH)
    For i = 1 To POP
    
    If rnd() <= CROSSOVER_RATE Then

            k = k + 1
            point = k
            TEMPPMX(i) = "PMX"
            
            For j = 1 To LENTH
                GENE(k, j) = NEWGENE(i, j)
            Next j
    
    End If
    Next i
    Loop Until k Mod 2 = 0
    

    For i = 1 To point Step 2
        Do
        BP1 = (Maxvalue - Minvalue) * rnd + Minvalue
        BP2 = (Maxvalue + 1 - BP1) * rnd + BP1
        Loop Until BP1 <> BP2
        
'========================= Step 1 (|fffd||7fa||fffd| |fffd||fffd||fffd||fffd||fffd||63c||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||477||fffd||fffd||fffd|) ========================
        For j = BP1 To BP2
            a = 0
            b = 0
            a = GENE(i, j)
            b = GENE(i + 1, j)
            TEMPNEWGENE(i, j) = b
            TEMPNEWGENE(i + 1, j) = a
        Next j
        
        For j = 1 To BP1 - 1
            a = 0
            b = 0
            a = GENE(i, j)
            b = GENE(i + 1, j)
            TEMPNEWGENE(i, j) = a
            TEMPNEWGENE(i + 1, j) = b
        Next j
        
        For j = BP2 + 1 To LENTH
            a = 0
            b = 0
            a = GENE(i, j)
            b = GENE(i + 1, j)
            TEMPNEWGENE(i, j) = a
            TEMPNEWGENE(i + 1, j) = b
        Next j

'========================= Step 2 (|fffd||7fa||fffd| |fffd||fffd||fffd||fffd|) ========================
            
            c = 0
            d = 0
            For r = 1 To BP2 - BP1 + 1
                For t = 1 To BP1 - 1
                    a = 0
                    b = 0
                    
                    For s = BP1 To BP2
                        If TEMPNEWGENE(i, t) = GENE(i + 1, s) Then
                           a = GENE(i, BP1 + c)
                           TEMPNEWGENE(i, t) = a
                           c = c + 1
                        Exit For
                        End If
                    Next s
                    
                    For s = BP1 To BP2
                        If TEMPNEWGENE(i + 1, t) = GENE(i, s) Then
                           a = GENE(i + 1, BP1 + d)
                           TEMPNEWGENE(i + 1, t) = a
                           d = d + 1
                        Exit For
                        End If
                    Next s
                Next t
                
                For t = BP2 + 1 To LENTH
                    a = 0
                    b = 0
                    
                    For s = BP1 To BP2
                        If TEMPNEWGENE(i, t) = GENE(i + 1, s) Then
                           a = GENE(i, BP1 + c)
                           TEMPNEWGENE(i, t) = a
                           c = c + 1
                        Exit For
                        End If
                    Next s
                    
                    For s = BP1 To BP2
                        If TEMPNEWGENE(i + 1, t) = GENE(i, s) Then
                           a = GENE(i + 1, BP1 + d)
                           TEMPNEWGENE(i + 1, t) = a
                           d = d + 1
                        Exit For
                        End If
                    Next s
                Next t
                
            Next r
    Next i

k = 0
For i = 1 To POP
    If TEMPPMX(i) = "PMX" Then
    k = k + 1
        For j = 1 To LENTH
            NEWGENE(i, j) = TEMPNEWGENE(k, j)
        Next j
    End If
Next i

End Sub

Private Sub MUTATION() '|fffd||3f7||fffd|
    
    Maxvalue = LENTH - 1
    Minvalue = 1

    For i = 1 To POP
        If (rnd() <= MUTATION_RATE) Then
            Do
                BP1 = (Maxvalue - Minvalue) * rnd + Minvalue
                BP2 = (Maxvalue + 1 - BP1) * rnd + BP1
            
            Loop Until BP1 <> BP2
        
                a = NEWGENE(i, BP1)
                b = NEWGENE(i, BP2)
        
                NEWGENE(i, BP2) = a
                NEWGENE(i, BP1) = b
        End If
    Next i
    
End Sub

Private Sub ROULLETWHEEL() '|fffd||3f7||fffd|

    '===================
    '=|fffd||fffd||fffd||fffd||fffd||53c||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|=
    '===================
    Dim INITIALGene As Variant
    ReDim OBJECT(1 To POP, 0)
    ReDim INITIALGene(1 To POP, 1 To LENTH + LENTH)
    
    
    For i = 1 To POP
        For j = 1 To LENTH + LENTH
            INITIALGene(i, j) = NEWGENE(i, j)
        Next j
    Next i
    
 '===========================
 '==== Route |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3f1||fffd| ====
    For i = 1 To POP
        t = 1
        sum = 0
        For j = 1 To LENTH
            sum = sum + Cells(4 + INITIALGene(i, j), 6).Value 'Sheets(2).Cells(i + 4, j + 4).Value, 6).Value
                If sum > VehicleCapacity Then
                    t = t + 1
                    sum = Cells(4 + INITIALGene(i, j), 6).Value 'Sheets(2).Cells(i + 4, j + 4).Value, 6).Value
                    INITIALGene(i, j + LENTH) = t 'Sheets(2).Cells(i + 4, j + 5 + LENTH).Value = t
                
                ElseIf sum <= VehicleCapacity Then
                    INITIALGene(i, j + LENTH) = t 'Sheets(2).Cells(i + 4, j + 5 + LENTH).Value = t
                End If
        Next j
        
    Next i
 
 '===========================
 '===========================
 '===========================
    
 For i = 1 To POP
    a = 0
    b = 0
    c = 0
    d = 0
    r = 0
    s = 0
    sum = 0
    
    For j = 1 To LENTH
        If INITIALGene(i, j + LENTH) = 1 Then
            a = a + 1
        ElseIf INITIALGene(i, j + LENTH) = 2 Then
            b = b + 1
        ElseIf INITIALGene(i, j + LENTH) = 3 Then
            c = c + 1
        ElseIf INITIALGene(i, j + LENTH) = 4 Then
            d = d + 1
        ElseIf INITIALGene(i, j + LENTH) = 5 Then
            r = r + 1
        ElseIf INITIALGene(i, j + LENTH) = 6 Then
            s = s + 1
        End If
    
    Next j

'=========== Route 1 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If a >= 1 Then
    k = 1
    For j = 1 To a
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5
    End If

'=========== Route 2 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If b >= 1 Then
    k = 1
    For j = a + 1 To a + b
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5

    End If

'=========== Route 3 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
   If c >= 1 Then
    k = 1
    For j = a + b + 1 To a + b + c
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5

    End If
    
'=========== Route 4 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If d >= 1 Then
    k = 1
    For j = a + b + c + 1 To a + b + c + d
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5
    End If

'=========== Route 5 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If r >= 1 Then
    k = 1
    For j = a + b + c + d + 1 To a + b + c + d + r
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5
    End If

'=========== Route 6 |fffd||fffd| |fffd||335||fffd||fffd||178||fffd| ====================
    If s >= 1 Then
    k = 1
    For j = a + b + c + d + r + 1 To a + b + c + d + r + s
        If k = 1 Then   'Depot|fffd||fffd||fffd||fffd| |f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
            sum = sum + ((Cells(1, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(1, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
            k = k + 1
        ElseIf k <> 1 Then '|f9||fffd||fffd||b0| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||178||fffd|
                sum = sum + ((Cells(4 + t, 4) - Cells(4 + INITIALGene(i, j), 4)) ^ 2 + _
                             (Cells(4 + t, 5) - Cells(4 + INITIALGene(i, j), 5)) ^ 2) ^ 0.5
        End If
        t = INITIALGene(i, j)
    Next j
    
    '|f9||fffd||fffd||b0| Route|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Depot|fffd||fffd| |fffd||178||fffd|
    sum = sum + ((Cells(1, 4) - Cells(4 + t, 4)) ^ 2 + _
              (Cells(1, 5) - Cells(4 + t, 5)) ^ 2) ^ 0.5

    End If
        
        OBJECT(i, 0) = sum '|fffd||335||fffd||fffd||178||fffd| |fffd||5bc||fffd||22d| |fffd||fffd||fffd||fffd||fffd||53c||fffd| sum |fffd||fffd| object|fffd||fffd| |fffd||fffd||fffd||fffd||634||fffd|.
        
            If TEMPOBJECT > OBJECT(i, 0) Then
                
                For j = 1 To LENTH + LENTH
                    ELITEGENE(1, j + 1) = INITIALGene(i, j)
                Next j
                
                TEMPOBJECT = OBJECT(i, 0)
                ELITEGENE(1, 1) = OBJECT(i, 0)
            End If
        sum = 0
Next i
    
    '===========================
    '= |fffd||fffd||fffd||fffd| |fffd||53c||fffd| |fffd||fffd||fffd||fffd| |fffd||477||fffd||fffd||634||fffd|.=
    '===========================


    '==================================
    '===== |fffd||adff| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| =====
    '==================================
    
    Dim FitnessValue As Variant
    Dim FitnessValuesum As Single
    Dim FitnessValuerate As Variant
    Dim SumOfFitness As Single
    
    ReDim FitnessValue(1 To POP)
    ReDim fitnessrate(1 To POP)
        
    c = 2 'linear scaling
    
    Maxvalue = Application.Max(OBJECT)
    Minvalue = Application.Min(OBJECT)
    Meanvalue = Application.Average(OBJECT)
    
'============ linear Scaling ===================
            If Minvalue - Meanvalue = 0 Then
            a = ((c - 1) * Meanvalue) / 0.0001
            b = (Meanvalue * (Minvalue - c * Meanvalue)) / 0.0001
            
            ElseIf Minvalue - Meanvalue <> 0 Then
            a = ((c - 1) * Meanvalue) / (Minvalue - Meanvalue)
            b = (Meanvalue * (Minvalue - c * Meanvalue)) / (Minvalue - Meanvalue)
            End If
            
            For i = 1 To POP
                FitnessValue(i) = a * OBJECT(i, 0) + b
            Next i

'===============================================
   
    For i = 1 To POP
        FitnessValuesum = FitnessValuesum + FitnessValue(i)
    Next i

    For i = 1 To POP
        fitnessrate(i) = FitnessValue(i) / FitnessValuesum
    Next i
    
'==================================================
'===== |fffd||fffd||fffd||f5||fffd| |fffd||fffd||fffd||fffd||fffd||6b8||fffd| NEWGENE(i, j)|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| =====
'==================================================
    
    For i = 1 To POP
        Random = rnd()
        SumOfFitness = 0
        
        For j = 1 To POP
            SumOfFitness = SumOfFitness + fitnessrate(j)
            If (Random < SumOfFitness) Then Exit For
        Next j
        
        For k = 1 To LENTH + LENTH
            NEWGENE(i, k) = INITIALGene(j, k)
        Next k
        
    Next i
    
   
        For j = 1 To LENTH + LENTH
            NEWGENE(1, j) = ELITEGENE(1, j + 1)
            NEWGENE(2, j) = ELITEGENE(1, j + 1)
            NEWGENE(3, j) = ELITEGENE(1, j + 1)
        Next j

End Sub

Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd|"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


INQUEST-PP=macro
