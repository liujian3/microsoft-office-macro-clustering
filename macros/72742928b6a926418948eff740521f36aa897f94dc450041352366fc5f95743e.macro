Attribute VB_Name = "ShowForm"
Public Sub Showaddfujian()
   frmAddFujian.Show
End Sub


Public Function CheckFileName(filename As String) As String
    Dim i As Integer
    Dim tmpFileName As String
    If Trim(filename) = "" Then Exit Function
    If Dir(strPath & filename) <> "" Then
        Do
            tmpFileName = Mid(filename, 1, InStrRev(filename, ".") - 1) & "-" & i & Mid(filename, InStrRev(filename, "."))
            i = i + 1
            If Dir(strPath & tmpFileName) = "" Then
                CheckFileName = tmpFileName
                Exit Do
            End If
        Loop
    Else
        CheckFileName = filename
    End If
End Function
Attribute VB_Name = "ThisDocument"
Attribute VB_Base = "1Normal.ThisDocument"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = True
Attribute VB_Customizable = True
Attribute VB_Control = "txtXml, 0, 0, MSForms, TextBox"
'----------------------------------|fffd||fffd||fffd||fffd||2b5||fffd||5b5||13a||fffd||fffd||fffd||fffd||fffd||fffd||fffd|----------------------------------
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Sub setPassword(pwd As String)
    strPassword = pwd
End Sub
'|fffd||fffd||fffd||f8||fffd||fffd||fffd||fffd||fffd||fffd||b7||fffd||fffd|
Sub setPath(filepath As String)
    If Right(filepath, 1) <> "\" Then
        filepath = filepath & "\"
    End If
    strPath = filepath
End Sub

'|2b9||fffd||fffd||fffd||b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4f5||13a||fffd||fffd||fffd|

Sub getAddItems(str As String) '|fffd||fffd||fffd||fffd||fffd||2cbf||fffd||132||fffd||fffd||fffd||461||fffd||fffd|
    str = "|fffd||f2d||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||bd||1f1||fffd|,|fffd||fffd||fffd||fffd||37c||1ac|"
End Sub

Sub addSomeThing(strKey As String) '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||461||fffd||fffd||132||fffd||fffd||fffd|id|5b4||fffd||fffd||fffd||fffd||4e6||fffd||132||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||13f||fffd||fffd||27e||fffd||fffd||fffd||fffd||13f||fffd||fffd|
    On Error Resume Next
    ThisDocument.Unprotect strPassword    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    Select Case LCase(strKey)
        Case "|fffd||f2d||fffd||fffd||fffd||fffd|"
            Showaddfujian
        Case "|fffd||fffd||fffd||bd||1f1||fffd|"
            frmSup.Show
        Case "|fffd||fffd||fffd||fffd||37c||1ac|"
             Dim filepath As String
             If Selection.Range.Start >= ThisDocument.Bookmarks("LoadDoc").Start And Selection.Range.End <= ThisDocument.Bookmarks("LoadDoc").End Then
                filepath = OpenFile(0)
                ThisDocument.Application.Selection.InlineShapes.AddPicture filename:=filepath, LinkToFile:=True, SaveWithDocument:=True
             Else
                MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b4||fffd||434||2f2||fffd||fffd||fffd|!"
             End If
    End Select
    ThisDocument.Protect Type:=wdAllowOnlyFormFields, Password:=strPassword, noreset:=True '|fffd||fffd||fffd||fffd||fffd||135||fffd|
End Sub

Private Sub Document_Open()
    HideRecover
    AddSignDate
    LockDoc
End Sub

Private Sub HideRecover()
    On Error Resume Next
    ThisDocument.CommandBars("Document Recovery").Visible = False
    Err.Clear
End Sub

Attribute VB_Name = "fileDialog"
'2
Public Type OPENFILENAME
        lStructSize As Long
        hwndOwner As Long
        hInstance As Long
        lpstrFilter As String
        lpstrCustomFilter As String
        nMaxCustFilter As Long
        nFilterIndex As Long
        lpstrFile As String
        nMaxFile As Long
        lpstrFileTitle As String
        nMaxFileTitle As Long
        lpstrInitialDir As String
        lpstrTitle As String
        flags As Long
        nFileOffset As Integer
        nFileExtension As Integer
        lpstrDefExt As String
        lCustData As Long
        lpfnHook As Long
        lpTemplateName As String
End Type
'3
Public Declare Function GetOpenFileName Lib "comdlg32.dll" Alias "GetOpenFileNameA" (pOpenfilename As OPENFILENAME) As Long
'1
'|fffd||13c||fffd||fffd||bfab6||53b||fffd||fffd||fffd|
'|fffd||fffd||fffd||fffd|:OpenFile
'|fffd||fffd||fffd||fffd|:WinHwnd   |fffd||fffd||fffd||f4||2fa||fffd||fffd||fffd||fffd||fffd|HWND
'     BoxLabel  |fffd||fffd||fffd||f6||53b||fffd||fffd||fffd||131||fffd||1e9|.
'     StartPath |fffd||fffd||fffd||f3||fffd||2bc||fffd||fffd||b7||fffd||fffd|.
'     FilterStr |fffd||13c||fffd||fffd||fffd||fffd||fffd|.
'     Flag      |fffd||fffd||5be|.(|fffd||3bf||fffd|MSDN)
'|fffd||fffd||fffd||fffd||5b5|:String |fffd||13c||fffd||fffd||fffd|.
'|fffd||fffd||fffd||4e3||fffd|
Public Function OpenFile(WinHwnd As Long, _
                         Optional BoxLabel As String = "", _
                         Optional StartPath As String = "", _
                         Optional FilterStr = "*.*|*.*", _
                         Optional Flag As Variant = &H8 Or &H200000) As String
  Dim Rc As Long
  Dim pOpenfilename As OPENFILENAME
  Dim Fstr1() As String
  Dim Fstr As String
  Dim i As Long
  Const MAX_Buffer_LENGTH = 256
  
  On Error Resume Next
  
  If Len(Trim$(StartPath)) > 0 Then
     If Right$(StartPath, 1) <> "\" Then StartPath = StartPath & "\"
     If Dir$(StartPath, vbDirectory + vbHidden) = "" Then
'        StartPath = App.Path
     End If
  Else
'     StartPath = App.Path
  End If
  If Len(Trim$(FilterStr)) = 0 Then
     Fstr = "*.*|*.*"
  End If
  Fstr = ""
  Fstr1 = Split(FilterStr, "|")
  For i = 0 To UBound(Fstr1)
      Fstr = Fstr & Fstr1(i) & vbNullChar
  Next
  With pOpenfilename
       .hwndOwner = WinHwnd
'       .hInstance = App.hInstance
       .lpstrTitle = BoxLabel
       .lpstrInitialDir = StartPath
       .lpstrFilter = Fstr
       .nFilterIndex = 1
       .lpstrDefExt = vbNullChar & vbNullChar
       .lpstrFile = String(MAX_Buffer_LENGTH, 0)
       .nMaxFile = MAX_Buffer_LENGTH - 1
       .lpstrFileTitle = .lpstrFile
       .nMaxFileTitle = MAX_Buffer_LENGTH
       .lStructSize = Len(pOpenfilename)
       .flags = Flag
  End With
  Rc = GetOpenFileName(pOpenfilename)
  If Rc Then
     OpenFile = Left$(pOpenfilename.lpstrFile, pOpenfilename.nMaxFile)
     OpenFile = Mid(OpenFile, 1, InStr(1, OpenFile, Chr(0)) - 1)
  Else
     OpenFile = ""
  End If
End Function

'|221||fffd||fffd||fffd||fffd||b7||fffd||fffd||fffd||fffd||fffd||13c||fffd||fffd||fffd||fffd||fffd|
Public Function getNoPathFileName(sFileName As String) As String
   Dim i As Integer
    If sFileName = "" Then Exit Function
    i = InStrRev(sFileName, "\")
    If i = 0 Then getNoPathFileName = sFileName: Exit Function
    getNoPathFileName = Mid(sFileName, i + 1)
End Function
Attribute VB_Name = "frmAddFujian"
Attribute VB_Base = "0{4C3D4D12-52FB-4D33-B8A2-2329C6587003}{E9886982-2417-4743-867A-9DB689AE8089}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Private Sub butBrowser_Click()
    Dim oriFileName As String
    oriFileName = OpenFile(0)
    If oriFileName <> "" Then
        Me.txtFilePath.Text = oriFileName
    End If
    With Me.txtFujianName
        .SetFocus
        .SelStart = 0
        .SelLength = Len(.Text)
    End With
End Sub

Private Sub butCancel_Click()
    Unload Me
End Sub

Public Function CheckEmpty() As Boolean
    If cmbitem.Text = "" Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3aa||fffd||563||fffd||fffd||fffd||461||fffd||fffd|..."
        CheckEmpty = True
        Exit Function
    End If
    If txtFujianName.Text = "" Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3aa||fffd||563||fffd||fffd||fffd||fffd||fffd||fffd||fffd|..."
        CheckEmpty = True
        Exit Function
    End If
'    If Me.OptionButton_DianziJian.Value = True Then
'        If Me.txtFilePath.Text = "" Then
'            MsgBox "|fffd||bd7c||fffd||fffd||fffd||fffd||fffd||fffd||13c||fffd||fffd||fffd|", vbExclamation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
'            CheckEmpty = True
'        Else
'            If Dir(Me.txtFilePath.Text) = "" Then
'                MsgBox "|fffd||bd7c||fffd||fffd||fffd||fffd||fffd||fffd||13c||fffd||fffd||fffd|", vbExclamation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
'                CheckEmpty = True
'                Me.butBrowser.SetFocus
'            End If
'        End If
'    End If
End Function

Public Sub butConfirm_Click()
    Dim DesPath As String
    Dim filename As String
    Dim fujianAttri As String
    If CheckEmpty = True Then Exit Sub
    UnlockDoc
    If OptionButton_ZhiJian.Value = True Then fujianAttri = OptionButton_ZhiJian.Caption
    If OptionButton_DianziJian.Value = True Then
        fujianAttri = OptionButton_DianziJian.Caption
        filename = getNoPathFileName(Me.txtFilePath.Text)
        filename = CheckFileName(filename)
        DesPath = strPath & filename
        If Dir(Me.txtFilePath.Text) <> "" Or Me.txtFilePath.Visible = False Then
            If Me.txtFilePath.Text <> "" And Me.txtFilePath.Text <> "none" And Me.txtFilePath.Text <> "|fffd||13c||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
                FileCopy Me.txtFilePath.Text, DesPath
            End If
            addFujiannew cmbitem.Text, txtFujianName.Text, fujianAttri, filename '|fffd||2f4||fffd||fffd||fffd||4aa||fffd||fffd||fffd||fffd||fffd||fffd||132||fffd||fffd||fffd|
        Else
            MsgBox "|fffd||13c||fffd||fffd||fffd||fffd||fffd||fffd||6a3||fffd|", vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
            LockDoc
            Exit Sub
        End If
    Else
        fujianAttri = Me.OptionButton_ZhiJian.Caption
        addFujiannew cmbitem.Text, txtFujianName.Text, fujianAttri
    End If
    cmdDelCtrl
    TxtToNewListfujia filename
    Me.ListBox1.Selected(Me.ListBox1.ListCount - 1) = True
    Me.txtFilePath.Text = "none"
    RefreshOcxTree
    LockDoc
'    ClearTxtValuefujia Me.Frame1
    Exit Sub
L:
    MsgBox Err.Description, vbCritical, ""
End Sub

Private Sub cmdDelCtrl()
    If Me.ListBox1.ListCount > 0 Then
        Me.cmdDel.Enabled = True
        If Me.ListBox1.ListIndex = -1 Then
            Me.cmdDel.Enabled = False
        End If
    Else
        Me.cmdDel.Enabled = False
    End If
End Sub

Private Sub cmbitem_Change()

End Sub

Private Sub cmbitem_Click()
'    Me.txtFilePath.Text = ""
    With Me.txtFujianName
        .Text = Me.cmbitem.Text
        .SetFocus
        .SelStart = 0
        .SelLength = Len(.Text)
    End With
End Sub

Private Sub cmdClear_Click()
    ClearTxtValuefujia Me.Frame1
    cmdModefyCtrl
End Sub

Private Sub cmdModefyCtrl()
    If Me.ListBox1.ListIndex >= 0 Then
        Me.cmdModify.Enabled = True
    Else
        Me.cmdModify.Enabled = False
    End If
End Sub


Public Sub cmdDel_Click()
    UnlockDoc
    DelFilefujia Me.ListBox1.List(Me.ListBox1.ListIndex, 2)
    DelRecordfujia Me.ListBox1
    RefreshOcxTree
    LockDoc
    ClearTxtValuefujian frmAddFujian.Frame1
    cmdDelCtrl
    ListBox1_Click
End Sub
Private Sub cmdDown_Click()
    UnlockDoc
    iRegularUpDown Me.ListBox1, 1, MarkBodyfujia
    LockDoc
    CtrlcmUpDown
    cmdModefyCtrl
End Sub

Private Sub cmdModify_Click()
    If cmbitem.Text = "" Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3aa||fffd||563||fffd||fffd||fffd||461||fffd||fffd|..."
        Exit Sub
    End If
    If txtFujianName.Text = "" Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3aa||fffd||563||fffd||fffd||fffd||fffd||fffd||fffd||fffd|..."
        Exit Sub
    End If
    If Me.txtFilePath.Text = "" And frmAddFujian.txtFilePath.Visible = True Then
        MsgBox "|fffd||13c||fffd||b7||fffd||fffd||3aa||fffd||563||fffd|", vbExclamation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
        Exit Sub
    End If
    UnlockDoc
    RegularModifyFormFields MarkBodyfujia & Me.ListBox1.ListIndex + 1, Me.Frame1, Me.ListBox1
    LockDoc
    cmdModefyCtrl
End Sub

Private Sub cmdUp_Click()
    UnlockDoc
    iRegularUpDown Me.ListBox1, -1, MarkBodyfujia
    LockDoc
    CtrlcmUpDown
    cmdModefyCtrl
End Sub

Private Sub ListBox1_Click()
    If QuitSub = True Then
        Exit Sub
    End If
    If Me.ListBox1.ListIndex = -1 Then Exit Sub
    ListToTextfujia Me.ListBox1, Me.Frame1
    If Me.ListBox1.List(Me.ListBox1.ListIndex, 3) = "|5bd||fffd||fffd|" Then
        Me.OptionButton_ZhiJian.Value = True
        Me.OptionButton_DianziJian.Value = False
    Else
        Me.OptionButton_ZhiJian.Value = False
        Me.OptionButton_DianziJian.Value = True
        Me.txtFilePath.Text = "|fffd||13c||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    End If
    cmdDelCtrl
    CtrlcmUpDown
    cmdModefyCtrl
End Sub

Private Sub CtrlcmUpDown()
    With Me.ListBox1
        If .ListCount = 1 Then
            Me.cmdUp.Enabled = False
            Me.cmdDown.Enabled = False
            Exit Sub
        End If
        If .ListIndex = 0 Then
            Me.cmdUp.Enabled = False
            Me.cmdDown.Enabled = True
        ElseIf .ListIndex = .ListCount - 1 Then
            Me.cmdDown.Enabled = False
            Me.cmdUp.Enabled = True
        ElseIf .ListIndex > 0 Then
            Me.cmdUp.Enabled = True
            Me.cmdDown.Enabled = True
        Else
            Me.cmdUp.Enabled = False
            Me.cmdDown.Enabled = False
        End If
    End With
End Sub

'Private Sub OptionButton_DianziJian_Click()
'    If OptionButton_DianziJian.Value = True Then
'        lblFilePath.Visible = True
'        txtFilePath.Visible = True
'        Me.butBrowser.Visible = True
'    End If
'End Sub

Private Sub OptionButton_ZhiJian_Click()
    If OptionButton_ZhiJian.Value = True Then
        lblFilePath.Visible = False
        txtFilePath.Visible = False
        Me.butBrowser.Visible = False
    End If
End Sub

Private Sub UserForm_Initialize()
    Dim lngDeskTopHandle As Long
    lngDeskTopHandle = FindWindow(vbNullString, Me.Caption)
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3aa||fffd||fffd||fffd||fffd||fffd||fffd||1f0|
    'SetWindowPos lngDeskTopHandle, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOMOVE Or SWP_NOSIZE
    
    

    cmbitem.AddItem "|fffd||fffd||fffd||43b||3d65||52d||fffd||fffd|"
    cmbitem.AddItem "|fffd||2be||5bb||3d65||52d||fffd||fffd|"
    cmbitem.AddItem "|fffd||fffd||fffd||fffd||fffd||57e||fffd||52d||fffd||fffd|"
    cmbitem.AddItem "|fffd||4f8||1f9||fffd||fffd||bb||beb79||fffd||5a4||fffd||fffd||fffd||fffd||fffd||43b||3d65||fffd||fffd||4e1||fffd||fffd|"
    cmbitem.AddItem "|fffd||4f8||1f9||fffd||fffd||bb||beb79||fffd||5a4||fffd||fffd||fffd||2be||5bb||3d65||fffd||fffd||4e1||fffd||fffd|"
    cmbitem.AddItem "|fffd||fffd||fffd||fffd||fffd||57e||778||fffd||4e1||fffd||fffd|"
    cmbitem.AddItem "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    RecordToListBoxfujia Me.ListBox1
    cmdDelCtrl
    Set CurFrm = Me
End Sub


Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    Set CurFrm = Nothing
    LockDoc
End Sub
Attribute VB_Name = "frmSup"
Attribute VB_Base = "0{DE8B1D98-897C-47CA-AA5C-EDF6B1237145}{93CBC018-C056-4E1C-A777-F55387D9AC89}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub cmdAdd_Click()
    Dim suFlag As Integer
    If optSup.Value = True Then
        suFlag = 0
    Else
        suFlag = 1
    End If
    AddSubscript Me.TextBox1.Text, suFlag
    
    Unload Me
End Sub

Private Sub cmdQuit_Click()
    Unload Me
End Sub

Public Function AddSubscript(strTxt As String, Mode As Integer) '|fffd||3f1||fffd||3aa|0|fffd||fffd||fffd||b1||fffd||3aa|1
    Dim strLen As Integer
    Dim RngStart As Long
    Dim RngEnd As Long
    Dim strTag As String
    If Selection.Range.Start >= ThisDocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range.Start And Selection.Range.End <= ThisDocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range.End Then
        Application.ScreenUpdating = False
        strLen = Len(strTxt)
        Set tmpRange = Selection.Range
        RngStart = Selection.Range.Start
        RngEnd = tmpRange.Start + strLen
        Selection.Text = strTxt
        UnlockDoc
        If Mode = 1 Then
'            strTag = thisdocument.Range(thisdocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range.Start + 13, Selection.Range.Start).Text
'            strTag = strTag + "<sub>"
'            strTag = strTag + Me.TextBox1.Text
'            strTag = strTag + "</sub>"
'            strTag = strTag + thisdocument.Range(Selection.Range.End, thisdocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range.End).Text
            ThisDocument.Range(RngStart, RngEnd).Font.Subscript = True
        Else
'            strTag = thisdocument.Range(thisdocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range.Start + 13, Selection.Range.Start).Text
'            strTag = strTag + "<sup>"
'            strTag = strTag + Me.TextBox1.Text
'            strTag = strTag + "</sup>"
'            strTag = strTag + thisdocument.Range(Selection.Range.End, thisdocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range.End).Text
'            thisdocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").HelpText = PutFlagValue(thisdocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").HelpText, "Tag=", strTag)
            ThisDocument.Range(RngStart, RngEnd).Font.Superscript = True
        End If
'        thisdocument.FormFields ("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
        LockDoc
        Application.ScreenUpdating = True
        Application.ScreenRefresh
    Else
        MsgBox "|fffd||2f9||fffd||fffd||fffd||13f||1f0||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a3||fffd|", vbOKOnly + vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
    End If
End Function

Private Sub UserForm_Click()

End Sub
Private Sub UserForm_Initialize()
    Dim lngDeskTopHandle As Long
    lngDeskTopHandle = FindWindow(vbNullString, Me.Caption)
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3aa||fffd||fffd||fffd||fffd||fffd||fffd||1f0|
    'SetWindowPos lngDeskTopHandle, HWND_TOPMOST, 0, 0, 0, 0, SWP_NOMOVE Or SWP_NOSIZE
    
    
End Sub
Attribute VB_Name = "modBorderCtrl"
Option Explicit

Public Sub AddBorders(WorkingRange As Range)
    With WorkingRange.ParagraphFormat
        .Borders(wdBorderLeft).LineStyle = wdLineStyleNone
        .Borders(wdBorderRight).LineStyle = wdLineStyleNone
        .Borders(wdBorderTop).LineStyle = wdLineStyleNone
        .Borders(wdBorderBottom).LineStyle = wdLineStyleNone
        .Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
        With .Borders
            .DistanceFromTop = 1
            .DistanceFromLeft = 4
            .DistanceFromBottom = 1
            .DistanceFromRight = 4
            .Shadow = False
        End With
    End With
    With Options
        .DefaultBorderLineStyle = wdLineStyleSingle
        .DefaultBorderLineWidth = wdLineWidth050pt
        .DefaultBorderColor = wdColorAutomatic
    End With
End Sub
Attribute VB_Name = "modCheck"
Public Sub Cursor()
    If PreFldName <> "" Then
        If ThisDocument.Bookmarks.Exists(PreFldName) Then
            ThisDocument.FormFields(PreFldName).Select
            PreFldName = ""
            Exit Sub
        End If
    End If
    Selection.Start = Selection.End
End Sub

Sub pzy()
    Dim fld As FormField
    For Each fld In ThisDocument.FormFields
        If fld.Type = wdFieldFormTextInput Then
            fld.EntryMacro = "Cursor"
        End If
    Next
    LockDoc
End Sub
Attribute VB_Name = "modChrProcess"
Option Explicit

Public Function DelChr63(fldTxt As String) As String
    If fldTxt = "" Then Exit Function
    Do While Asc(Right(fldTxt, 1)) = 63
        If Len(fldTxt) = 0 Then Exit Do
        fldTxt = Left(fldTxt, Len(fldTxt) - 1)
        If fldTxt = "" Then Exit Function
    Loop
    Do While Asc(Left(fldTxt, 1)) = 63
        If Len(fldTxt) = 0 Then Exit Do
        fldTxt = Right(fldTxt, Len(fldTxt) - 1)
        If fldTxt = "" Then Exit Function
    Loop
    DelChr63 = fldTxt
End Function

Public Function GetPureResult(fldObj As FormField) As String
    With fldObj
        If fldObj.Type = 70 Then
            GetPureResult = DelChr63(fldObj.Range.Text)
            Exit Function
        ElseIf fldObj.Type = 71 Then
            GetPureResult = .Result
            Exit Function
        End If
    End With
End Function
Attribute VB_Name = "modDya"
'================================================
'|fffd||fffd||fffd||4f8||fffd||fffd||fffd|
'================================================
'''''Public Sub addFuJian()
'''''    Dim fld As FormField
'''''    Dim MarkName As String
'''''    Dim i As Integer
'''''    Dim oriFileName As String
'''''    Dim FileName As String
'''''    On Error GoTo L
'''''    oriFileName = OpenFile(0)
'''''    If oriFileName <> "" Then
'''''        FileName = oriFileName
'''''    Else
'''''        Exit Sub
'''''    End If
'''''    '|fffd||fffd||fffd||fffd||2b1||fffd||e3||fffd||fffd||1f7b||2b1||4aa||5e2||fffd||fffd|
''''''    strPath = "D:\workspace\Gwssi\0|fffd||fffd||fffd||fffd||fffd||fffd||fffd||7ff||37b||fffd||fffd||fffd|\cpees-dtd\schemaExample\"
'''''    If strPath = "" Then
'''''        MsgBox "|fffd||13c||fffd||b7||fffd||fffd||3aa||fffd||fffd|", vbInformation, ""
'''''    End If
'''''    FileName = getNoPathFileName(FileName)
'''''    If Dir(strPath & FileName, vbNormal + vbReadOnly + vbHidden) = "" Then
'''''        FileCopy oriFileName, strPath & FileName
'''''
'''''        'MarkName = "|fffd||fffd||fffd||fffd||fffd||5d65||fffd||fffd||fffd||4f1||fffd||1e9|"
'''''        MarkName = "marks04_|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|"
'''''        i = 1
'''''        Do While thisdocument.Bookmarks.Exists(MarkName & i)
'''''            i = i + 1
'''''        Loop
'''''        'update for addFujian v1.0 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'''''        If i = 1 Then
'''''            thisdocument.Bookmarks("|fffd||fffd||fffd||fffd||fffd||5d65||fffd||fffd||fffd||4f1||fffd||1e9|").Select
'''''        Else
'''''            thisdocument.Bookmarks(MarkName & (i - 1)).Select
'''''        End If
'''''        Selection.MoveRight Unit:=wdCharacter, Count:=1
'''''        Selection.TypeParagraph
'''''        Selection.TypeText Text:=" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a1||fffd|  "
'''''        Set fld = Selection.FormFields.Add(Range:=Selection.Range, Type:=wdFieldFormTextInput)
'''''        fld.name = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|" & i
'''''        fld.StatusText = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|" & i
'''''        Selection.Start = Selection.Start - 28
'''''        With thisdocument.Bookmarks
'''''            .Add Range:=Selection.Range, name:=MarkName & i
'''''            .DefaultSorting = wdSortByLocation
'''''            .ShowHidden = False
'''''        End With
'''''        fld.Result = FileName
'''''        Selection.MoveRight Unit:=wdCharacter, Count:=1
'''''    Else
'''''        MsgBox "|36c||fffd||fffd||fffd||13c||fffd||fffd||474||fffd||fffd||6a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||461||fffd||fffd|", vbInformation, ""
'''''    End If
'''''    Exit Sub
'''''L:
'''''    MsgBox Err.Description, vbCritical, ""
'''''
'''''End Sub

Public Sub addFujian(FuJianType As String, fujianName As String)
    Dim fldType As FormField
    Dim fldName As FormField
    Dim MarkName As String
    Dim i As Integer
    MarkName = "marks05_|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||e3d||fffd||fffd|"
    i = 1
    Do While ThisDocument.Bookmarks.Exists(MarkName & i)
        i = i + 1
    Loop
    If i = 1 Then
        ThisDocument.Bookmarks("|fffd||fffd||fffd||fffd||fffd||5d65||fffd||fffd||fffd||4f1||fffd||1e9|").Select
    Else
        ThisDocument.Bookmarks(MarkName & (i - 1)).Select
    End If
    Selection.MoveRight unit:=wdCharacter, Count:=1
    Selection.TypeParagraph
    
    Selection.TypeText Text:=" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||361||fffd| "
    Set fldType = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
            wdFieldFormTextInput)
    fldType.name = "|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    fldType.StatusText = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    Selection.TypeText Text:=" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a1||fffd| "
    Set fldName = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
            wdFieldFormTextInput)
    fldName.name = "|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    fldName.StatusText = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    Selection.Start = Selection.Start - 54
    With ThisDocument.Bookmarks
        .Add Range:=Selection.Range, name:=MarkName & i
        .DefaultSorting = wdSortByLocation
        .ShowHidden = False
    End With
    fldType.Result = FuJianType
    fldName.Result = fujianName
    Selection.MoveRight unit:=wdCharacter, Count:=1
End Sub


'|fffd||fffd||32c||fffd||fffd||fffd||638||fffd||fffd||fffd||fffd||fffd||3aa|loadXMLData|fffd||fffd|
Public Sub addFuJianByXML()
    Dim fld As FormField
    Dim MarkName As String
    Dim i As Integer
         
'    MarkName = "|fffd||fffd||fffd||fffd||fffd||5d65||fffd||fffd||fffd||4f1||fffd||1e9|"
    MarkName = "marks04_|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|"
    i = 1
    Do While ThisDocument.Bookmarks.Exists(MarkName & i)
    i = i + 1
    Loop
    
    If i = 1 Then
        ThisDocument.Bookmarks("|fffd||fffd||fffd||fffd||fffd||5d65||fffd||fffd||fffd||4f1||fffd||1e9|").Select
    Else
        ThisDocument.Bookmarks(MarkName & (i - 1)).Select
    End If
    Selection.MoveRight unit:=wdCharacter, Count:=1
    Selection.TypeParagraph
        Selection.TypeText Text:=" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a1||fffd|  "
    Set fld = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
            wdFieldFormTextInput)
        fld.name = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|" & i
        fld.StatusText = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|" & i
        Selection.Start = Selection.Start - 28
        With ThisDocument.Bookmarks
            .Add Range:=Selection.Range, name:=MarkName & i
            .DefaultSorting = wdSortByLocation
            .ShowHidden = False
        End With
        fld.Result = ""
        Selection.MoveRight unit:=wdCharacter, Count:=1
                
End Sub

'----------------------------|27e||fffd||fffd||fffd||fffd||461||fffd||fffd||fffd||fffd|----------------------------
Public Sub delFuJian()
    Dim MarkName As String
    Dim i As Integer
    Dim filename As String
    
    On Error Resume Next
    MarkName = "marks04_|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|"
    i = 1
    Do While ThisDocument.Bookmarks.Exists(MarkName & i)
        i = i + 1
    Loop
    i = i - 1
    If i = 0 Then
        Exit Sub
    End If
    '|fffd||fffd||fffd||fffd||2b1||fffd||e3||fffd||fffd||1f7b||2b1||4aa||5e2||fffd||fffd|
'    strPath = "D:\workspace\Gwssi\0|fffd||fffd||fffd||fffd||fffd||fffd||fffd||7ff||37b||fffd||fffd||fffd|\cpees-dtd\schemaExample\"
    filename = GetPureResult(ThisDocument.FormFields("|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||fffd|" & i))
    
    ThisDocument.Bookmarks(MarkName & i).Select
    Selection.Delete
    Selection.MoveLeft unit:=wdCharacter, Count:=1
    Selection.Delete
    
    Kill strPath & filename
    Exit Sub
L:
    MsgBox Err.Description, vbCritical, errHint

End Sub
Attribute VB_Name = "modFuJia"
Public Const RecordStarkMarkfujia As String = "|fffd||fffd||fffd||fffd||fffd||5d65||fffd||fffd||fffd||4f1||fffd||1e9|"
Public Const SingleRecordFormFieldCountfujia As Integer = 2
Public Const MarkBodyfujia As String = "marks04_|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||e3d||fffd||fffd|"
Public QuitSub As Boolean
Public RecordRange As Range
'Dim Pos1 As Long '|fffd||fffd||fffd|
'Dim Pos2 As Long '|fffd||575||fffd|

Public Function GetRecordCountfujia() As Integer
    With ThisDocument
        GetRecordCountfujia = .Bookmarks(RecordStarkMarkfujia).Range.Cells(1).Range.FormFields.Count / SingleRecordFormFieldCountfujia
        If .Bookmarks.Exists("|fffd||fffd||fffd||fffd||5a4||fffd||fffd||fffd||13c||fffd|") = True Then
           GetRecordCountfujia = (.Bookmarks(RecordStarkMarkfujia).Range.Cells(1).Range.FormFields.Count - 1) / SingleRecordFormFieldCountfujia
      
        End If
        Set RecordRange = .Bookmarks(RecordStarkMarkfujia).Range.Cells(1).Range
    End With
End Function

Public Sub RecordToListBoxfujia(LstObj As ListBox) '|fffd||fffd|word|fffd||435||13c||fffd||bc||fffd||fffd||fffd||fffd|listbox|fffd||fffd|
    Dim i As Integer, j As Integer
    Dim CurIndex As Integer
    With LstObj
        For i = 1 To GetRecordCountfujia
            .AddItem
            CurIndex = .ListCount - 1
            QueueList LstObj
            .List(CurIndex, 1) = GetFlagValue(RecordRange.FormFields(1 + (i - 1) * SingleRecordFormFieldCountfujia).HelpText, "code=")
            .List(CurIndex, 2) = GetPureResult(RecordRange.FormFields(1 + (i - 1) * SingleRecordFormFieldCountfujia))
            .List(CurIndex, 3) = GetPureResult(RecordRange.FormFields(2 + (i - 1) * SingleRecordFormFieldCountfujia))
            .List(CurIndex, 4) = GetFlagValue(RecordRange.FormFields(2 + (i - 1) * SingleRecordFormFieldCountfujia).HelpText, "file=")
        Next i
    End With
End Sub

Public Function GetFlagValue(DataSource As String, Flag As String) As String  '|fffd||fffd||4bb||fffd||fffd|flag|fffd||fffd||fffd||fffd||221||fffd||fffd||fffd||fffd||4e6||fffd||fffd||fffd||fffd||5b5||fffd||fffd|datasource|fffd||fffd||2bd||fffd||fffd|FormField ("|fffd||fffd||fffd||fffd||fffd||fffd|_|fffd||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd|")
    Dim pos1 As Integer
    Dim Pos2 As Integer
    Dim FlagLength As Integer
    FlagLength = Len(Flag)
    pos1 = InStr(1, DataSource, Flag)
    If pos1 > 0 Then
        Pos2 = InStr(pos1, DataSource, ";")
        GetFlagValue = Mid(DataSource, pos1 + FlagLength, Pos2 - pos1 - FlagLength)
    End If
End Function

Public Sub QueueList(LstObj As ListBox) '|fffd||fffd|Listbox|fffd||135||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd|'|fffd||33b||fffd||123||fffd||fffd|
    Dim i As Integer
    With LstObj
        For i = 0 To .ListCount - 1
            .List(i, 0) = i + 1
        Next i
    End With
End Sub

Public Sub ListToTextfujia(LstObj As ListBox, OcxContainer As Object) 'ListBox|fffd||435||fffd||fffd||fffd||fffd||fffd||5ea||fffd||fffd|Text|fffd||423||fffd||1f0||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|TextBox|fffd||fffd|Tag
    Dim ctl As Control
    If LstObj.ListIndex = -1 Then Exit Sub
    With OcxContainer
        For Each ctl In .Controls
            If TypeName(ctl) = "TextBox" Or TypeName(ctl) = "ComboBox" Then
                ctl.Value = LstObj.List(LstObj.ListIndex, ctl.Tag)
            End If
        Next
    End With
End Sub

Public Sub DelRecordfujia(LstObj As ListBox)
    Dim RecordStartPos As Long
    RecordStartPos = RecordRange.Bookmarks(MarkBodyfujia & LstObj.ListIndex + 1).Range.Start
    RecordRange.Bookmarks(MarkBodyfujia & LstObj.ListIndex + 1).Range.Delete
    ThisDocument.Range(RecordStartPos - 1, RecordStartPos).Delete
'    ClearTxtValuefujia frmAddFujian.Frame1
    LstObj.RemoveItem LstObj.ListIndex
    QueueList LstObj
    ReNameBKMfujia LstObj
End Sub

Private Sub ReNameBKMfujia(LstObj As ListBox)
    Dim bkM As Bookmark
    Dim bkmRange As Range
    Dim i As Integer
    On Error Resume Next
    If LstObj.ListIndex = -1 Then Exit Sub
'    If LstObj.ListIndex = LstObj.ListCount - 1 Then Exit Sub
    For i = LstObj.ListIndex + 2 To LstObj.ListCount + 1
        Set bkM = ThisDocument.Bookmarks(MarkBodyfujia & i)
        Set bkmRange = bkM.Range
        bkM.Delete
        bkmRange.Bookmarks.Add MarkBodyfujia & i - 1
        ReNameFldStatusInRange bkmRange, i, i - 1
    Next
    Err.Clear
End Sub

Private Sub ReNameFldStatusInRange(InRange As Range, OldID As Integer, NewID As Integer)
    Dim fld As FormField
    Dim tmpStatusText As String
    For Each fld In InRange.FormFields
        With fld
            tmpStatusText = .StatusText
            .StatusText = Replace(tmpStatusText, OldID, NewID)
        End With
    Next
End Sub

Public Function ClearTxtValuefujia(OcxContainer As Object) '|fffd||33b||fffd||123||fffd||fffd|
    Dim ctl As Control
    Dim OcxTypeName As String
    For Each ctl In OcxContainer.Controls
        OcxTypeName = TypeName(ctl)
        If OcxTypeName = "TextBox" Or OcxTypeName = "ComboBox" Then
            On Error Resume Next
            ctl.Text = ""
            If Err Then
                frmAddFujian.cmbitem.Value = ""
            End If
            Err.Clear
        End If
    Next
End Function

Public Sub TxtToNewListfujia(Optional filename As String)
    With frmAddFujian.ListBox1
        .AddItem
        CurIndex = .ListCount - 1
        .List(CurIndex, 1) = frmAddFujian.cmbitem.Text
        .List(CurIndex, 2) = frmAddFujian.txtFujianName.Text
        .List(CurIndex, 3) = IIf(frmAddFujian.OptionButton_ZhiJian.Value = True, "|5bd||fffd||fffd|", "|fffd||fffd||fffd||4fc||fffd|")
        .List(CurIndex, 4) = filename
    End With
    QueueList frmAddFujian.ListBox1
End Sub

Public Sub DelFilefujia(filename As String)
    Dim fName As String
    If Trim(filename) = "" Then Exit Sub
    On Error Resume Next
    fName = strPath & filename
    If Trim(fName) = "" Then Exit Sub
    If Dir(fName, vbNormal + vbReadOnly + vbHidden) <> "" Then
        SetAttr fName, vbNormal
        Kill fName
    End If
    Err.Clear
End Sub

Public Sub UnlockDoc()
    If Not ThisDocument.ProtectionType = wdNoProtection Then
        ThisDocument.Unprotect "1"   '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    End If
End Sub

Public Function LockDoc()
    If ThisDocument.ProtectionType = wdNoProtection Then
        ThisDocument.Protect wdAllowOnlyFormFields, Password:="1", noreset:=True
    End If
End Function

Public Sub addFujiannew(Optional FuJianType As String, Optional fujianName As String, Optional fujianAttri As String, Optional EFJName As String = "")
    Dim fldType As FormField
    Dim fldName As FormField
    Dim MarkName As String
    Dim i As Integer
    ThisDocument.Application.ScreenUpdating = False
    MarkName = MarkBodyfujia
    i = 1
    Do While ThisDocument.Bookmarks.Exists(MarkName & i)
        i = i + 1
    Loop
    If i = 1 Then
        ThisDocument.Bookmarks(RecordStarkMarkfujia).Select
    Else
        ThisDocument.Bookmarks(MarkName & (i - 1)).Select
    End If
    Selection.MoveRight unit:=wdCharacter, Count:=1
    Selection.TypeParagraph
    
'    Selection.TypeText Text:=" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||361||fffd| "
'    Set fldType = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
'            wdFieldFormTextInput)
'    fldType.name = "|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
'    fldType.StatusText = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    Selection.TypeText Text:=" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a1||fffd| "
    Set fldName = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
            wdFieldFormTextInput)
    fldName.name = "|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    fldName.StatusText = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    fldName.OwnHelp = True
    fldName.HelpText = "code=" & FuJianType & ";"
    
    Selection.TypeText Text:=" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||521||fffd| "
    Set fldattri = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
            wdFieldFormTextInput)
    fldattri.name = "|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd|"
    fldattri.StatusText = "|fffd||fffd||fffd||fffd||fffd||5d65|_|fffd||fffd||fffd||e3d||fffd||fffd|" & i & "_|fffd||fffd||fffd||fffd|"
    If EFJName <> "" Then
        fldattri.OwnHelp = True
        fldattri.HelpText = "file=" & EFJName & ";"
    End If
    fldattri.Enabled = False
    Selection.Start = Selection.Start - 54
    With ThisDocument.Bookmarks
        .Add Range:=Selection.Range, name:=MarkName & i
        .DefaultSorting = wdSortByLocation
        .ShowHidden = False
    End With
'    fldType.Result = fujianType
    If fujianName <> "" Then
        fldName.Result = fujianName
    End If
    If fujianAttri <> "" Then
        fldattri.Result = fujianAttri
    End If
    Selection.MoveRight unit:=wdCharacter, Count:=1
    ThisDocument.Application.ScreenUpdating = True
End Sub

Public Sub iRegularUpDown(LstObj As ListBox, MoveStep As Integer, ComPonentBody As String) '|fffd||fffd||123||fffd||fffd||fffd||478||123||fffd||fffd||fffd||fffd||fffd||fffd||fffd||368||fffd||fffd||fffd||fffd|
    Dim strField As String
    Dim Lfor As Integer
    With LstObj
        If MoveStep = -1 Then
            If .ListIndex <= 0 Then Exit Sub
            Lfor = 0
        Else
            If .ListIndex = -1 Or .ListIndex = .ListCount - 1 Then Exit Sub
            Lfor = -1
        End If
        ChangeListBoxItem LstObj, MoveStep, 1
        For i = .ListIndex + Lfor To .ListIndex + Lfor + 1
            With ThisDocument.Bookmarks(ComPonentBody & i + 1).Range
                .FormFields(1).Result = LstObj.List(i, 2)
                .FormFields(1).OwnHelp = True
                .FormFields(1).HelpText = "code=" & LstObj.List(i, 1) & ";"
                .FormFields(2).Result = LstObj.List(i, 3)
                .FormFields(2).OwnHelp = True
                If Not IsNull(LstObj.List(i, 4)) And Trim(LstObj.List(i, 4)) <> "" Then
                    .FormFields(2).HelpText = "file=" & LstObj.List(i, 4) & ";"
                Else
                    .FormFields(2).HelpText = ""
                End If
            End With
        Next i
    End With
End Sub '|fffd||fffd||123||fffd||fffd||fffd||478||123||fffd||fffd||fffd||fffd||fffd||fffd||fffd||368||fffd||fffd||fffd||fffd|

Public Sub RegularModifyFormFields(MarkName As String, OcxContainer As Object, LstObj As ListBox) '|fffd||fffd||123||fffd||fffd||fffd||478||139||fffd||fffd||fffd||2a7||225||368||fffd||fffd||fffd||fffd|
    Dim FieldStr As String
    Dim i As Integer
    Dim ctl As Control
    Dim strCtlTypeName As String
    If LstObj.ListIndex = -1 Then Exit Sub
    For Each ctl In OcxContainer.Controls
        strCtlTypeName = TypeName(ctl)
        If strCtlTypeName = "TextBox" Or strCtlTypeName = "ComboBox" Then
            With LstObj
                .List(.ListIndex, ctl.Tag) = ctl.Text
            End With
        End If
    Next
    LstObj.List(LstObj.ListIndex, 3) = IIf(frmAddFujian.OptionButton_ZhiJian.Value = True, "|5bd||fffd||fffd|", "|fffd||fffd||fffd||4fc||fffd|")
    With ThisDocument.Bookmarks(MarkName).Range
        .FormFields(1).Result = LstObj.List(LstObj.ListIndex, 2)
        .FormFields(1).HelpText = "code=" & LstObj.List(LstObj.ListIndex, 1) & ";"
        .FormFields(2).Result = LstObj.List(LstObj.ListIndex, 3)
        If frmAddFujian.txtFilePath.Text <> "|fffd||13c||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" And frmAddFujian.Visible = True Then
            QuitSub = True
            DelRecordfujia frmAddFujian.ListBox1
            frmAddFujian.butConfirm_Click
            QuitSub = False
        End If
    End With
End Sub

Public Function ClearTxtValuefujian(OcxContainer As Object) '|fffd||33b||fffd||123||fffd||fffd|
    Dim ctl As Control
    Dim OcxTypeName As String
    For Each ctl In OcxContainer.Controls
        OcxTypeName = TypeName(ctl)
        If OcxTypeName = "TextBox" Or OcxTypeName = "ComboBox" Then
            On Error Resume Next
            ctl.Text = ""
            If Err Then
                frmAddFujian.cmbitem.Value = ""
            End If
            Err.Clear
        End If
    Next
End Function

Public Function ChangeListBoxItem(LstObj As ListBox, ChangeStep As Integer, Optional StartColumn As Integer = 2)
    Dim i As Integer
    Dim t As String
    On Error Resume Next
    With LstObj
        For i = StartColumn To .ColumnCount - 1
            t = .List(.ListIndex, i)
            .List(.ListIndex, i) = .List(.ListIndex + ChangeStep, i)
            .List(.ListIndex + ChangeStep, i) = t
        Next i
        .Selected(.ListIndex + ChangeStep) = True
    End With
    Err.Clear
End Function

Attribute VB_Name = "modPub"
'======================================================================================================
'|fffd||fffd||fffd||fffd||123||fffd||6e6b||fffd||fa||fffd||fffd||fffd|
'created by wangchaoyuan@gwssi.com.cn
'date 2008-06-26
'======================================================================================================
Public Declare Function FindWindow Lib "user32" Alias "FindWindowA" (ByVal lpClassName As String, ByVal lpWindowName As String) As Long
Public Declare Function SetWindowPos Lib "user32" (ByVal hwnd As Long, ByVal hWndInsertAfter As Long, ByVal x As Long, ByVal y As Long, ByVal cx As Long, ByVal cy As Long, ByVal wFlags As Long) As Long
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||431||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3bb||fffd||fffd||fffd||3ba||fffd||fffd||eda5||fffd||fffd||fffd||fffd||fffd||6b5||fffd||1f0||fffd||fffd|
Public Const HWND_TOPMOST = -1
' |fffd||fffd||fffd||5b4||fffd||fffd||6b4||fffd||421|
Public Const SWP_NOSIZE = &H1
' |fffd||fffd||fffd||5b4||fffd||fffd||fffd||3bb||fffd||fffd|
Public Const SWP_NOMOVE = &H2

Public Type ShenQingRen
    strName As String
    strTel As String
    strType As String
    strCountry As String
    strCity As String
    strPostCode As String
    strAddress_Pro As String
    strAddress_City As String
    strAddress_Street As String
    
End Type
Public Enum FontType
    Supsc = 0
    Subsc = 1
End Enum
Public ForAppObj As Object
Public typeShenQingRen As ShenQingRen
'|fffd||fffd||fffd||b2||fffd||fffd||fffd||3aa||fffd||fffd||fffd||fffd||123||fffd||fffd||368||fffd||fa||fffd||fffd||fffd|
Public Const XML_OBJ_NAME = "MSXML2.DOMDocument.4.0"
Public Const SHUNXV = "|2f3||fffd||fffd|"
Public strPassword As String
Public strPath As String
Public Const errHint As String = "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
Public Const glbHint As String = "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
Public Const XMLFlag As String = "XMLLoaded"
Public CurFrm As Object
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'|fffd||6b5||fffd||1f0||3bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||a3b32||fffd||fffd||fffd|strName|fffd||fffd||5b8||fffd||fffd||fffd||fffd||fffd||4f5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a3||fffd|
'|fffd||fffd||461||fffd||fffd||fffd||fffd|oriFldName|fffd||1f2||3bf||fffd||fffd||f5||fffd||fffd||fffd||fffd||fffd||fffd||63c||fffd||fffd||fffd||fffd||fffd||fffd||5a3||fffd||fffd||fffd||fffd||4f5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5a4||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2bd||fffd||fffd||fffd||535||fffd||221||5b5||fffd||fffd||3bf||fffd||fffd||63c||fffd||fffd||fffd||36c|
Sub addTextInput(strName As String, Optional oriFldName As String = "", Optional fldName As String = "")
    Dim fld As FormField
     Set fld = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
        wdFieldFormTextInput)
    If fldName <> "" Then
        fld.name = fldName
    Else
        fld.name = strName
    End If
    If oriFldName = "" Then Exit Sub
    If Not isExistFormfield(oriFldName) Then Exit Sub
    setFormFieldSame fld, ThisDocument.FormFields(oriFldName)
    Selection.EndKey unit:=wdLine
End Sub


'|fffd||fffd||fffd||fffd||fffd||131||fffd||fffd||fffd||fffd||fffd||fffd|
'|fffd||6b5||fffd||1f0||3bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||a3b32||fffd||fffd||fffd|strName|fffd||fffd||5b8||fffd||fffd||fffd||fffd||fffd||4f5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a3||fffd|
'|fffd||fffd||461||fffd||fffd||fffd||fffd|oriFldName|fffd||1f2||3bf||fffd||fffd||f5||fffd||fffd||fffd||fffd||fffd||fffd||63c||fffd||fffd||fffd||fffd||fffd||fffd||5a3||fffd||fffd||fffd||fffd||4f5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5a4||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2bd||fffd||fffd||fffd||535||fffd||221||5b5||fffd||fffd||3bf||fffd||fffd||63c||fffd||fffd||fffd||36c|
Sub addDropdownInput(strName As String, Optional oriFldName As String = "")
    Dim fld As FormField
    Dim i As Integer
    Dim iC As Integer
     Set fld = Selection.FormFields.Add(Range:=Selection.Range, Type:= _
        wdFieldFormDropDown)
    fld.name = strName
    If oriFldName = "" Then Exit Sub
    If Not isExistFormfield(oriFldName) Then Exit Sub
    setFormFieldSame fld, ThisDocument.FormFields(oriFldName)
    iC = ThisDocument.FormFields(oriFldName).DropDown.ListEntries.Count
    For i = 1 To iC
       fld.DropDown.ListEntries.Add ThisDocument.FormFields(oriFldName).DropDown.ListEntries(i).name
    Next i
    Selection.EndKey unit:=wdLine
End Sub
'|fffd||436||3ff||63c||fffd||fffd||1f7||fffd||fffd||fffd||6a3||fffd||fffd||fffd||fffd||6b7||fffd||fffd||fffd||5b5||3aa|true|fffd||fffd||fffd||fffd||fffd||fffd||3aa|false
Function isExistFormfield(strName As String) As Boolean
    On Error GoTo L
    Dim s As String
    s = GetPureResult(ThisDocument.FormFields(strName))
    isExistFormfield = True
    Exit Function
L:
    Err.Clear
    isExistFormfield = False
End Function

'|fffd||fffd||fffd||63c||fffd||fffd||fffd||fffd||131||fffd||fffd||fffd|oriFld|fffd||fffd||fffd||fffd||5a4||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||538||fffd||fffd||1b5||fffd||13f||fffd||fffd||63c||fffd|desFld
Sub setFormFieldSame(desFld As FormField, oriFld As FormField)
   With desFld
        .EntryMacro = oriFld.EntryMacro
        .ExitMacro = oriFld.ExitMacro
        .HelpText = oriFld.HelpText
        .OwnStatus = oriFld.OwnStatus
        .StatusText = oriFld.StatusText
        .TextInput.EditType Type:=oriFld.TextInput.Type, Default:=oriFld.TextInput.Default, Format:=oriFld.TextInput.Format
        .TextInput.Width = oriFld.TextInput.Width
'        .TextInput.Type = oriFld.TextInput.Type
'        .TextInput.Default = oriFld.TextInput.Default
'        .TextInput.Format = oriFld.TextInput.Format
    End With
End Sub


'|fffd||fffd||fffd||fffd|form|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1ba||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|xml|fffd||13c||fffd||fffd||fffd||fffd||2fa||fffd||fffd||fffd||3aa||368||fffd||fa||fffd||fffd||fffd|
Public Sub createFormXML(filename As String, wordFileName As String)
    Dim nodLst As Object ' MSXML2.IXMLDOMNodeList
    Dim nod As Object ' MSXML2.IXMLDOMNode
    Dim cNod As Object ' IXMLDOMNode
    Dim fld As Object
    Dim rootName As String
    Dim ID As String
    Dim i As Integer
    Dim xmlobj As Object
    On Error GoTo L
    Debug.Print Now
    Set xmlobj = CreateObject(XML_OBJ_NAME) ' New DOMDocument
    rootName = Mid(wordFileName, InStrRev(wordFileName, "\") + 1)
    rootName = Mid(rootName, 1, Len(rootName) - 4)
    i = 1
    Do While IsNumeric(Mid(rootName, i, 1))
        i = i + 1
    Loop
    ID = Mid(rootName, 1, i - 1)
    rootName = Mid(rootName, i)
    xmlobj.loadXML "<?xml version=""1.0"" encoding=""utf-8""?><" & rootName & " id='" & ID & "'></" & rootName & ">"
    Set nod = xmlobj.SelectSingleNode(rootName)
    For Each fld In ThisDocument.FormFields
     createChildNode xmlobj, fld.StatusText, GetPureResult(fld)
    Next
    formatNodeIndex xmlobj.SelectSingleNode("//" & rootName)
    xmlobj.Save filename '|fffd||fffd||fffd||fffd|xml|fffd||13c||fffd|
    Debug.Print Now
    Exit Sub
L:
    Err.Clear
    Resume Next
End Sub 'createFormXML "c:\a.xml","110101|fffd||fffd||fffd||fffd||5e8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.doc"

Public Function createChildNode(xmlobj As Object, NodeName As String, sValue As String) ' As MSXML2.IXMLDOMNode  ' Object
        Dim i As Integer
        Dim root As IXMLDOMNode
        Dim tmpNode As IXMLDOMNode
        Dim newNod As IXMLDOMNode
        Dim curNode As IXMLDOMNode
        Dim newNode
        Dim rStart As Integer
        Dim sPath As String
        Dim rootName As String
        Dim curPath As String
        Dim curName As String
        Dim parentPath As String
        On Error GoTo L

    
        rStart = InStrB(1, NodeName, "_")
        i = InStr(1, NodeName, "_", vbBinaryCompare)
        For Each root In xmlobj.ChildNodes
            If root.NodeType = NODE_ELEMENT Then
                rootName = root.baseName
            End If
        Next

        Select Case i
            Case 0
              root.appendChild createNode(xmlobj, NodeName, sValue)
            Case Else
                 Do While i <> 0
                    curPath = Replace(Mid(NodeName, 1, i - 1), "_", "/")
                    sPath = rootName & "/" & curPath
                    parentPath = Mid(sPath, 1, InStrRev(sPath, "/") - 1)
                    curName = Mid(sPath, InStrRev(sPath, "/") + 1)
                    Set tmpNode = xmlobj.SelectSingleNode(sPath)
                    If UCase(TypeName(tmpNode)) = "NOTHING" Then
                         Set newNode = xmlobj.createNode(1, curName, "")
                        Set root = xmlobj.SelectSingleNode(parentPath)
                        root.appendChild (newNode)
                       
                    End If
                    i = InStr(i + 1, NodeName, "_", vbBinaryCompare)
                 Loop
                 Set root = xmlobj.SelectSingleNode(sPath)
              root.appendChild createNode(xmlobj, Mid(NodeName, InStrRev(NodeName, "_") + 1), sValue)
                 
        End Select
L:
        Err.Clear
End Function
Private Function createNameNode(xmlobj As Object, NodeName As String) As MSXML2.IXMLDOMNode ' Object
    Set createNameNode = xmlobj.createNode(1, NodeName, "")
End Function
Private Function createNode(xmlobj As Object, NodeName As String, sValue As String) As MSXML2.IXMLDOMNode ' Object
        Dim cNod As IXMLDOMNode 'Object '
        Dim i As Integer
            Set cNod = xmlobj.createNode(1, NodeName, "")
            cNod.Text = sValue
            Set createNode = cNod
        
End Function


'|fffd||fffd||221||fffd||fffd||1f0||fffd||63c||fffd||fffd||fffd||fffd||fffd||fffd||77c||fffd||fffd||fffd||fffd||fffd|
'|fffd||fffd||fffd||fffd|fldName|fffd||fffd||fffd||fffd||5b5||fffd||1f5||fffd||1f0||fffd||63c||fffd||fffd||fffd||fffd||fffd||fffd||1a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b5||fffd||1f5||fffd||1f0||fffd||63c||fffd||fffd||fffd||fffd||fffd||fffd||fffd|

Public Function getCurrentFormControl(fldName As String) As String
    Dim s As String
    Dim L As Long
    Dim t As Long
    L = Selection.Start
'   Debug.Print Now
   For t = 1 To ThisDocument.Bookmarks.Count
        If ThisDocument.Bookmarks(t).Start < L And ThisDocument.Bookmarks(t).End > L Then
            fldName = ThisDocument.Bookmarks(t).name
            If isExistFormfield(fldName) Then
                getCurrentFormControl = GetPureResult(ThisDocument.FormFields(ThisDocument.Bookmarks(t).name))
                Exit Function
            End If
        End If
   Next t
'   Debug.Print Now
   fldName = ""
End Function
'|fffd||fffd||5b8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1a3||fffd|name|fffd||fffd||fffd||fffd|formfield|fffd||fffd||5b5|
Public Sub setFormFieldValue(fld As FormField, Value As String)
    On Error GoTo L
        Select Case fld.Type
            Case 71
                fld.CheckBox.Value = Value
            
            Case Else
                fld.Result = Value
        End Select
    Exit Sub
L:
    Err.Clear
End Sub
'|fffd||fffd||5bd||6b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public Function getIndex(nodName As String, indexNum As Integer) As String
    Dim i As Integer
    Dim iLen As Integer
    iLen = Len(nodName)
    For i = iLen To 1 Step -1
        If Not IsNumeric(Mid(nodName, i)) Then Exit For
    Next i
    indexNum = Val(Mid(nodName, i + 1))
    getIndex = Mid(nodName, 1, i)
 
End Function
Public Sub testxml()
Dim xmlobj As New MSXML2.DOMDocument40
Dim nl As IXMLDOMNodeList
xmlobj.Load "c:\a.xml"
Index2Name xmlobj.SelectSingleNode("//|fffd||fffd||fffd||fffd||5e8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
xmlobj.Save "c:\b.xml"
End Sub
Public Sub formatNodeIndex(nod As IXMLDOMNode) '|fffd||fffd||fffd||6b5||fffd||fffd||fffd||fffd||fffd||fffd||435||fffd||2f3||fffd||fffd||fffd||5ea||fffd||4d7d||fffd||6b5||fffd||fffd||fffd||fffd||fffd|,|fffd||6b5||fffd||fffd||fffd||fffd||1b2||fffd||fffd||671||fffd||fffd||fffd||2f3||fffd||fffd||fffd|,|fffd||fffd|Index2Name|fffd||fffd||fffd||df4||fffd||139||fffd||fffd||fffd|
    Dim baseName As String
    Dim indexNum As Integer
    Dim nd As IXMLDOMNode
    Dim attrNod As IXMLDOMNode
    Dim xmlobj As New DOMDocument40
    baseName = getIndex(nod.baseName, indexNum)
    If indexNum <> 0 Then
        Set nd = xmlobj.createNode(1, baseName, "")
        Set attrNod = xmlobj.createNode(2, SHUNXV, "")
        attrNod.NodeValue = indexNum ' wi
        nd.Attributes.setNamedItem attrNod
       ' nd.nodeValue = nod.nodeValue
        AddAllChildren nd, nod
        nod.ParentNode.InsertBefore nd, nod
        nod.ParentNode.RemoveChild nod
    End If
    If nod.HasChildNodes Then
        For Each nd In nod.ChildNodes
           formatNodeIndex nd
        Next
    End If
End Sub
Public Sub Index2Name(nod As IXMLDOMNode) '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3e2||fffd||435||fffd||2f3||fffd||fffd||fffd||5ea||fffd||4d7d||fffd||6b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd|formatNodeIndex|fffd||fffd||fffd||df4||fffd||139||fffd||fffd||fffd|
     Dim baseName As String
    Dim indexNum As Integer
    Dim nd As IXMLDOMNode
    Dim attrNod As IXMLDOMNode
    Dim xmlobj As New DOMDocument40
    indexNum = Val(getAttrib(nod, SHUNXV))
    If indexNum > 0 Then
        Set nd = xmlobj.createNode(1, nod.baseName & indexNum, "")
        AddAllChildren nd, nod
        nod.ParentNode.InsertBefore nd, nod
        nod.ParentNode.RemoveChild nod
    End If
    If nod.HasChildNodes Then
        For Each nd In nod.ChildNodes
           Index2Name nd
        Next
    End If
   
End Sub
Private Function AddAllChildren(desNod As IXMLDOMNode, oriNod As IXMLDOMNode)
Dim nod As IXMLDOMNode
    For Each nod In oriNod.ChildNodes
        desNod.appendChild nod
    Next
End Function

Public Function getAttrib(nod As Object, attrName As String) As String
    On Error GoTo L
    getAttrib = nod.Attributes.getNamedItem(attrName).NodeValue
    Exit Function
L:
    Err.Clear
    getAttrib = ""
End Function


'|fffd||fffd||fffd||fffd|form|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1ba||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|xml|fffd||13c||fffd||fffd||fffd||fffd||2fa||fffd||fffd||fffd||3aa||368||fffd||fa||fffd||fffd||fffd|
Sub SaveXmlFile()
    Dim xmlFileName As String
    xmlFileName = Mid(ThisDocument.FullName, 1, Len(ThisDocument.FullName) - 3) & "xml"
    createFormXMLTemplate xmlFileName
'    MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||3e3||fffd|", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
End Sub

Public Function getxmlTemplate() As String   '|fffd||fffd||fffd||fffd|xml|fffd||fffd||fffd||fffd|
    getxmlTemplate = Mid(ThisDocument.txtXml.Text, 9)
End Function

Public Function createFormXMLTemplate(filename As String) As Boolean
    Dim nodLst As Object ' MSXML2.IXMLDOMNodeList
    Dim nod As MSXML2.IXMLDOMNode
    Dim cNod As Object ' IXMLDOMNode
    Dim fld As Object
    Dim rootName As String
    Dim ID As String
    Dim i As Integer
    Dim tmpNodeName As String 'new
    Dim tmpStatus As String 'new
    Dim NodeValue As String 'new
    Dim xmlobj As MSXML2.DOMDocument40
    On Error GoTo L
    ThisDocument.Application.ScreenUpdating = False
    Set xmlobj = CreateObject(XML_OBJ_NAME) ' New DOMDocument
   
    '|fffd||bf||63c||fffd||fffd||7b8||fffd||2b1||fffd||fffd||fffd||fffd|
    xmlobj.validateOnParse = False
    xmlobj.resolveExternals = False
    xmlobj.loadXML getxmlTemplate
    For Each nod In xmlobj.ChildNodes
        If nod.NodeType = NODE_ELEMENT Then
            rootName = nod.baseName
        End If
    Next
    ThisDocument.FormFields(1).Select '|fffd||fffd||fffd||2fe||fffd||5d7d||fffd||fffd||fffd||fffd||123||fffd||fffd||fffd||fffd|
    Index2Name xmlobj.SelectSingleNode("//" & rootName)
    For Each fld In ThisDocument.FormFields
        If Trim(GetPureResult(fld)) <> "" Then
            Set nod = xmlobj.SelectSingleNode("//" & rootName & "/" & Replace(fld.StatusText, "_", "/"))
            If TypeName(nod) = "Nothing" Then
               createChildNode xmlobj, fld.StatusText, getCode(fld)
            Else
               nod.Text = getCode(fld)
            End If
         End If
            '=====================new
            If fld.HelpText <> "" Then
                If Len(fld.HelpText) > 4 Then
                    If Left(fld.HelpText, 4) = "code" Then
                        tmpStatus = fld.StatusText
                        If InStr(tmpStatus, "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|") > 0 Then
                            tmpNodeName = Replace(tmpStatus, "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
                        Else
                            tmpNodeName = Replace(tmpStatus, "_|fffd||fffd||fffd||fffd||fffd||13f||fffd||fffd||fffd||fffd|", "_|fffd||fffd||fffd||fffd||fffd||13f||fffd||fffd||fffd||fffd|")
                        End If
                        NodeValue = GetFlagValue(fld.HelpText, "code=")
                    ElseIf Left(fld.HelpText, 4) = "file" Then
                        tmpNodeName = Replace(fld.StatusText, "_|fffd||fffd||fffd||fffd|", "_|fffd||13c||fffd||fffd||fffd||fffd||fffd|")
                        NodeValue = GetFlagValue(fld.HelpText, "file=")
                    End If
                    Set nod = xmlobj.SelectSingleNode(tmpNodeName)
                    If TypeName(nod) = "Nothing" Then
                        createChildNode xmlobj, tmpNodeName, NodeValue
                    Else
                       nod.Text = NodeValue
                    End If
                End If
            End If
            '=====================new
    Next
    formatNodeIndex xmlobj.SelectSingleNode("//" & rootName)
    RefreshFM xmlobj
    xmlobj.Save filename '|fffd||fffd||fffd||fffd|xml|fffd||13c||fffd|
    ChangeWord        '|fffd||fffd||52d|*
    UpdateSpecialData filename '|fffd||fffd|* |fffd||fffd||52d||37c||1ac|
    ThisDocument.Application.ScreenUpdating = True
    createFormXMLTemplate = True
    Exit Function
L:
    Err.Clear
    Resume Next
End Function 'createFormXML "c:\a.xml","110101|fffd||fffd||fffd||fffd||5e8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.doc"
'''''''''''''''''''''''''''''''''''''''''''''|fffd||fffd||fffd||bd||171||fffd|
Private Sub RefreshFM(ByRef xmlobj As MSXML2.DOMDocument40)
    Dim nod As MSXML2.IXMLDOMNode
    Dim tmpNodeTxt As String
    tmpNodeTxt = ""
    Set nod = xmlobj.SelectSingleNode("//|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
    tmpNodeTxt = GetInvName("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
    If tmpNodeTxt <> "" Then
        nod.Text = DelChr63(GetMixFldResult(ThisDocument.FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"), tmpNodeTxt)) ' spical
    End If
End Sub

Public Function GetInvName(strFieldName As String) As String
    Dim tmpRng As Range
    Dim RngStart As Long
    Dim RngEnd As Long
    Dim i As Integer
    Dim tmpNodeTxt As String
    UnlockDoc
    tmpNodeTxt = ""
    With ThisDocument
        With .FormFields(strFieldName)
           RngEnd = .Range.End
           RngStart = .Range.Start + 13
        '     For i = 0 To Len(.Result) - 1
           For i = 1 To Len(.Result)
              With .Range.Characters(i)
                  If .Font.Superscript = 9999999 Then
                        If i = 1 Then
                             With ThisDocument.Range(RngStart, RngStart + 1)
                                 If .Font.Superscript = True Then
                                     tmpNodeTxt = tmpNodeTxt + "<sup>" + .Text + "</sup>"
                                 ElseIf .Font.Subscript = True Then
                                     tmpNodeTxt = tmpNodeTxt + "<sub>" + .Text + "</sub>"
                                 Else
                                     tmpNodeTxt = tmpNodeTxt + .Text
                                 End If
                             End With
                         Else
                              With ThisDocument.Range(RngEnd - 2, RngEnd - 1)
                                 If .Font.Superscript = True Then
                                     tmpNodeTxt = tmpNodeTxt + "<sup>" + .Text + "</sup>"
                                 ElseIf .Font.Subscript = True Then
                                     tmpNodeTxt = tmpNodeTxt + "<sub>" + .Text + "</sub>"
                                 Else
                                     tmpNodeTxt = tmpNodeTxt + .Text
                                 End If
                             End With
                         End If
                  Else
                        If .Font.Superscript = True Then
                            tmpNodeTxt = tmpNodeTxt + "<sup>" + .Text + "</sup>"
                        ElseIf .Font.Subscript = True Then
                            tmpNodeTxt = tmpNodeTxt + "<sub>" + .Text + "</sub>"
                        Else
                            tmpNodeTxt = tmpNodeTxt + .Text
                        End If
                 End If
              End With
            Next i
        End With
        tmpNodeTxt = Replace(tmpNodeTxt, "</sup><sup>", "")
        tmpNodeTxt = Replace(tmpNodeTxt, "</sub><sub>", "")
    End With
    LockDoc
    GetInvName = tmpNodeTxt
End Function

Public Sub UpdateField()
    Application.ScreenUpdating = False
    UnlockDoc
    DeepSetFont "<sup>", "</sup>", Supsc
    DeepSetFont "<sub>", "</sub>", Subsc
    Application.ScreenUpdating = True
    LockDoc
End Sub
Private Sub DeepSetFont(strBegin As String, strEnd As String, Supsc As FontType)
    Dim i As Integer
    Dim tmpRngStart As Long
    Dim tmpRngEnd As Long
    Dim RngStart As Long
    Dim RngEnd As Long
    tmpRngStart = 1
    tmpRngEnd = 1
    With ThisDocument
        With .FormFields("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
         For i = 1 To Len(.Result)
                tmpRngStart = InStrRev(.Range.Text, strBegin)
                If tmpRngStart > 0 Then
                    tmpRngEnd = InStr(tmpRngStart, .Range.Text, strEnd)
                    If tmpRngStart > 0 And tmpRngEnd > 0 Then
                        RngStart = .Range.Start
                        SetSupFont ThisDocument.Range(RngStart + 17 + tmpRngStart, RngStart + 12 + tmpRngEnd), Supsc
                        ThisDocument.Range(RngStart + 12 + tmpRngEnd, RngStart + 18 + tmpRngEnd).Text = ""
                        ThisDocument.Range(RngStart + 12 + tmpRngStart, RngStart + 17 + tmpRngStart).Text = ""
                    End If
                End If
                If tmpRngStart = 0 Or tmpRngEnd = 0 Then Exit For
              Next
        End With
    End With
End Sub

Private Sub SetSupFont(RngObj As Range, sType As FontType)
    With RngObj
        Select Case sType
            Case 0
                RngObj.Font.Superscript = True
            Case 1
                RngObj.Font.Subscript = True
        End Select
    End With
End Sub
''''''''''''''''''''''''''''''''''''''
'========================================================================================
'|fffd||fffd|xml|fffd||13c||fffd||fffd||fffd||5f0||fffd||fffd||fffd||fffd||fffd||fffd|
'========================================================================================
Public Sub loadXmlData(xmlFileName As String) '|368||fffd||fffd|xml|fffd||fffd||fffd||fffd||fffd||13c||fffd||fffd||fffd||123||fffd||fffd||fffd||13c||fffd||fffd||fffd||52d||fffd||fffd||434||fffd||13c||fffd|,|fffd||fffd||fffd||fffd|xml|fffd||fffd||fffd||775||fffd||fffd||fffd||fffd||fffd||63c||fffd|
    Dim nodLst As MSXML2.IXMLDOMNodeList ' Object ' MSXML2.IXMLDOMNodeList
    Dim nod As MSXML2.IXMLDOMNode
    Dim NodeName As String
    Dim NodeValue As String
    Dim rootName As String
    Dim fld As FormField ' Object
    Dim xmlobj As New DOMDocument40
    Dim childNum As Integer
    Dim i As Integer
    Dim LoadUnSuccessed As Boolean
    If Trim(xmlFileName) = "" Then Exit Sub
    If Dir(xmlFileName) = "" Then
        Exit Sub
    End If
    If GetProperty(XMLFlag) = True Then
       ChangeWord '|37c||1ac||fffd||fffd||52d|*
       UpdateSpecialData '* |fffd||fffd||52d||37c||1ac|
       Exit Sub
    End If
    On Error GoTo L
    UnlockDoc
    ThisDocument.Application.ScreenUpdating = False
    Set xmlobj = CreateObject(XML_OBJ_NAME) ' New DOMDocument
    '|fffd||bf||63c||fffd||fffd||7b8||fffd||2b1||fffd||fffd||fffd||fffd|
    xmlobj.validateOnParse = False
    xmlobj.resolveExternals = False
    xmlobj.Load xmlFileName
   Dim filename As String
    Set nodLst = xmlobj.SelectNodes("//|fffd||fffd||fffd||e3d||fffd||fffd|")
    childNum = nodLst.Length
    If childNum > 0 Then
        For i = 1 To childNum
            For Each nod In nodLst.Item(i - 1).ChildNodes
                If nod.NodeName = "|fffd||13c||fffd||fffd||fffd||fffd||fffd|" Then
                    filename = nod.Text
                    Exit For
                End If
            Next
            For Each nod In nodLst.Item(i - 1).ChildNodes
                If nod.NodeName = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
                    Set nod = nod
                    Exit For
                End If
            Next
            If TypeName(nod) <> "Nothing" Then
                addFujiannew nod.Text, , , filename
                filename = ""
            End If
        Next i
    End If
    
    For Each nod In xmlobj.ChildNodes
        If nod.NodeType = NODE_ELEMENT Then
            rootName = nod.baseName
        End If
    Next
   Index2Name xmlobj.SelectSingleNode("//" & rootName)
   For Each fld In ThisDocument.FormFields
        NodeName = fld.StatusText
        If NodeName <> "" Then
            Set nod = xmlobj.SelectSingleNode("//" & Replace(NodeName, "_", "/"))
            If TypeName(nod) <> "Nothing" Then
                If fld.Type = 70 Then
                    EvalueFormField fld, nod.Text
                ElseIf fld.Type = 71 Then
                    fld.CheckBox.Value = nod.Text
                End If
            End If
        End If
    Next
    
    If LoadUnSuccessed = False Then
        SetPropertyValue XMLFlag, True
    End If
    
    LoadDoc Mid(xmlFileName, 1, InStrRev(xmlFileName, "\") - 1)
    UpdateSpecialData xmlFileName '*|fffd||fffd||52d||37c||1ac|
    ThisDocument.Application.ScreenUpdating = True
    ThisDocument.Range(0, 0).Select
    LockDoc
    Exit Sub
L:
    Err.Clear
    Resume Next
End Sub

Private Sub LoadDoc(FileInFolder As String) '|fffd||bcbb||4aa||27e||fffd||fffd||5e2||fffd||fffd||fffd||fffd||fffd||761||fffd|
    Dim InsertRange As Range
    Dim StartPos As Long
    Dim EndPos As Long
    With ThisDocument
        If Dir(FileInFolder & "\section_1.doc") <> "" Then
            ChangeFileOpenDirectory FileInFolder
            With .Bookmarks("LoadDoc").Range
                StartPos = .Start '+ 1
                EndPos = .End - 1
            End With
            Set InsertRange = .Range(StartPos, EndPos)
            InsertRange.InsertFile filename:="section_1", Range:="", ConfirmConversions _
            :=False, Link:=False, Attachment:=False
'            AddBorders InsertRange
        End If
    End With
End Sub

Public Sub SetPropertyValue(PropertyName As String, PropertyValue As Boolean)
    Dim ShouldLock As Boolean
    With ThisDocument
        If .ProtectionType <> wdNoProtection Then
            ShouldLock = True
            UnlockDoc
        End If
        .CustomDocumentProperties(PropertyName).Value = PropertyValue
        If ShouldLock = True Then
            LockDoc
        End If
    End With
End Sub

Public Function GetProperty(PropertyName As String) As Boolean
    GetProperty = ThisDocument.CustomDocumentProperties(PropertyName).Value
End Function

Public Sub CtrlFormVisible(FormObj As Object)
    On Error GoTo L
    If FormObj Is Nothing Then Exit Sub
    With FormObj
        If .Visible = True Then
            .hide
        Else
            .Show
        End If
    End With
    Exit Sub
L:    If MsgBox("|fffd||731||fffd||1f8||fffd||fffd|CtrlFormVisible|fffd||fffd||fffd||fffd||fffd||fffd||5b4||fffd||fffd||fffd||437||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & vbCrLf & _
        "|fffd||fffd||fffd||fffd||fffd||fffd||b8fa|" & Err.Number & "|fffd||fffd|" & vbCrLf & _
        "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & Err.Description & "|fffd||fffd|" & vbCrLf & _
        "|fffd||1f7||fffd||fffd||fffd||fffd||5b4||fffd||43a||fffd||fffd||fffd||fffd||133||fffd||fffd||fffd|", vbYesNo + vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|") = vbYes Then
        Resume Next
    End If
End Sub

Public Sub FormHideOrShow()
    CtrlFormVisible CurFrm
End Sub

Public Sub RefreshOcxTree()
    On Error Resume Next
    ForAppObj.RefreshTree
    Err.Clear
End Sub

Public Sub GetWordObj(OcxObj As Object)
    Set ForAppObj = OcxObj
End Sub

Public Sub CloseDocument(Optional CloseMode As Integer = 0)
    On Error Resume Next
    With ThisDocument
        .Saved = True
        If .Application.Documents.Count > 1 Then
            Select Case CloseMode
                Case 0
                    .Close wdDoNotSaveChanges
            End Select
        Else
            .Application.Quit wdDoNotSaveChanges
        End If
    End With
    Err.Clear
End Sub

Public Sub AddSignDate()
    Dim fldYearName As String
    Dim fldMonthName As String
    Dim fldDateName As String
    fldYearName = "|1e9||fffd||fffd||fffd||fffd||fffd||fffd|_|fffd||fffd|"
    fldMonthName = "|1e9||fffd||fffd||fffd||fffd||fffd||fffd|_|fffd||fffd|"
    fldDateName = "|1e9||fffd||fffd||fffd||fffd||fffd||fffd|_|fffd||fffd|"
    With ThisDocument
        If Trim(DelChr63(.FormFields(fldYearName).Range.Text)) = "" And _
           Trim(DelChr63(.FormFields(fldMonthName).Range.Text)) = "" And _
           Trim(DelChr63(.FormFields(fldDateName).Range.Text)) = "" Then
        EvalueFormField .FormFields(fldYearName), Format(Now, "yyyy")
        EvalueFormField .FormFields(fldMonthName), Format(Now, "mm")
        EvalueFormField .FormFields(fldDateName), Format(Now, "dd")
        End If
    End With
End Sub

Attribute VB_Name = "modSpecialChar"
Option Explicit
Public Const DocPassword As String = "1"
Public Const SpecialCharFolder As String = "SpecialChar"
Public Const ReplaceFlag As String = "<Replace>"
Public Const SplitStr As String = "#$#"
Public PosStr As String

Public Sub InsertPic(ParaStr As String, Optional Ratio As Single = 1) '|fffd||fffd||2bd|pic=000009.gif,000010.gif;
    Dim i As Integer
    Dim filename As String
    Dim FileNames As String
    Dim CurFld As FormField
    Dim arrFileName
    Dim tmpRange As Range
    If ParaStr <> "" Then
        If strPath = "" Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|SetPath|fffd||fffd||fffd||323||fffd||5b8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd||534||fffd||13c||fffd||b7||fffd||fffd||fffd||fffd|", vbExclamation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
            Exit Sub
        End If
        If Right(ParaStr, 1) <> ";" Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||bc34||fffd||579||6df6||fffd||fffd||2bd||fffd||1f7b||fffd||fffd||fffd||fffd||fffd||fffd|", vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||3aa||fffd||fffd|" & ParaStr, vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
            Exit Sub
        End If
        FileNames = GetFlagValue(ParaStr, "pic=")
        Set CurFld = getCurrentFormField
        If TypeName(CurFld) <> "Nothing" Then
            If ThisDocument.FormFields(CurFld.name).Type = 70 Then
                arrFileName = Split(FileNames, ",")
                For i = 0 To UBound(arrFileName)
                    filename = strPath & SpecialCharFolder & "\" & arrFileName(i) '& ".gif"
                    If Dir(filename) <> "" Then
                        Set tmpRange = ThisDocument.Range(Selection.Range.Start, Selection.Range.End)
                        subInsertPic tmpRange, filename, Ratio
                    Else
                        MsgBox "|fffd||13c||fffd|'" & filename & "'|fffd||fffd||fffd||fffd||fffd||6a3||fffd||fffd||7b7||fffd||fffd||fffd||fffd||fffd||fffd||623||fffd|", vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
                    End If
                Next i
            Else
                MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd|", vbExclamation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
                Exit Sub
            End If
        Else
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd|", vbExclamation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
        End If
    End If
End Sub

Public Function getCurrentFormField() As FormField
    Dim s As String
    Dim L As Long
    Dim t As Long
    Dim bkM As Bookmark
    Dim fldName As String
    L = Selection.Start
    For Each bkM In Selection.Bookmarks
        If bkM.Start <= L And bkM.End >= L Then
            fldName = bkM.name
            If fldName <> "" Then
                If isExistFormfield(fldName) Then
                    Set getCurrentFormField = ThisDocument.FormFields(fldName)
                    Exit Function
                End If
            End If
        End If
    Next
End Function

Public Sub DelPic()
    If Selection.FormFields.Count = 1 Then
        Selection.FormFields(1).Result = ""
    End If
End Sub

Public Sub subInsertPic(InsertRange As Range, fPath As String, Optional Ratio As Single = 1)
    Dim insh As InlineShape
    Dim NerCursorPos As Long
    Set insh = InsertRange.InlineShapes.AddPicture(filename:=fPath _
        , LinkToFile:=True, SaveWithDocument:=True)
    ChangePicSize insh, Ratio
    NerCursorPos = insh.Range.End
    ThisDocument.Range(NerCursorPos, NerCursorPos).Select
End Sub

Public Sub ChangePicSize(ByRef insh As InlineShape, Optional Ratio As Single = 1)
    If Ratio < 0 Or Ratio > 1 Then
        MsgBox "|fffd||fffd||fffd||171||fffd||fffd||fffd||5bb||fffd||73d||fffd||fffd||fffd|0-100%|fffd||fffd|", vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
    Else
        With insh
            .Width = .Width * Ratio
            .Height = .Height * Ratio
        End With
    End If
End Sub
'|37c||1ac||5ea|*
Public Function ReturnMixFldResult(fld As FormField) As String
    Dim arrTmp
    Dim i As Integer
    Dim tmpResult As String
    Dim Count0 As Integer '|fffd||436||fffd|Result|fffd||fffd|"|01|"|fffd||5b7||fffd||fffd||138||fffd||fffd||fffd||fffd||fffd|
    Dim Count1 As Integer '|fffd||436||fffd|Result|fffd||fffd|InlineShape|fffd||138||fffd||fffd||fffd||fffd||fffd|
    tmpResult = GetPureResult(fld)
    Count0 = ReturnChrCountInStr(tmpResult, "|01|")
    Count1 = fld.Range.InlineShapes.Count
    If Count0 <> Count1 Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd|'" & fld.name & "'|fffd||fffd||fffd||fffd||423||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||763||fffd||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd||fffd|", vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
        ReturnMixFldResult = "#Error"
        Exit Function
    End If
    If Count0 > 0 Then
        arrTmp = Split(tmpResult, "|01|")
        For i = 1 To UBound(arrTmp)
'           ReturnMixFldResult = ReturnMixFldResult & arrTmp(i - 1) & ";" & "AdditionInfo=" & _
'                                 fld.Range.InlineShapes(i).LinkFormat.SourceName & ";"
            ReturnMixFldResult = ReturnMixFldResult & arrTmp(i - 1) & "*"
        Next i
        ReturnMixFldResult = ReturnMixFldResult & arrTmp(UBound(arrTmp))
        ReturnMixFldResult = Replace(ReturnMixFldResult, ";;", ";")
    ElseIf Count0 = 0 Then
        ReturnMixFldResult = tmpResult
    End If
End Function
'|fffd||fffd||fffd||bd||171||fffd||37c||1ac||5ea|*
Public Function GetMixFldResult(fld As FormField, tmpResult As String) As String
    Dim arrTmp
    Dim i As Integer
    Dim Count0 As Integer
    Dim Count1 As Integer
    Count0 = ReturnChrCountInStr(tmpResult, "|01|")
    Count1 = fld.Range.InlineShapes.Count
    If Count0 <> Count1 Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd|'" & fld.name & "'|fffd||fffd||fffd||fffd||423||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||763||fffd||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd||fffd|", vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
        GetMixFldResult = "#Error"
        Exit Function
    End If
    If Count0 > 0 Then
        arrTmp = Split(tmpResult, "|01|")
        For i = 1 To UBound(arrTmp)
            GetMixFldResult = GetMixFldResult & arrTmp(i - 1) & "*"
        Next i
        GetMixFldResult = GetMixFldResult & arrTmp(UBound(arrTmp))
        GetMixFldResult = Replace(GetMixFldResult, ";;", ";")
    ElseIf Count0 = 0 Then
        GetMixFldResult = tmpResult
    End If
End Function

Public Function ReturnChrCountInStr(ByVal StrBody As String, ByVal FlagStr As String) As Long
    Dim Len0 As Long
    Dim Len1 As Long
    If FlagStr = "" Or StrBody = "" Then Exit Function
    Len0 = Len(StrBody)
    StrBody = Replace(StrBody, FlagStr, "")
    Len1 = Len(StrBody)
    ReturnChrCountInStr = (Len0 - Len1) / Len(FlagStr)
End Function

Public Function GetNodeText(strMixNodeText As String) As String
    Dim arrTmp
    Dim i As Integer
    arrTmp = Split(strMixNodeText, ";")
    If UBound(arrTmp) < 0 Then Exit Function
    For i = 0 To UBound(arrTmp)
        If InStr(1, arrTmp(i), "AdditionInfo=") = 0 Then
            GetNodeText = GetNodeText & arrTmp(i)
        Else
            PosStr = PosStr & "Pos=" & ReplaceSubSup(GetNodeText) & ";" & arrTmp(i) & ";" & SplitStr
        End If
    Next i
    PosStr = DelTail(SplitStr, PosStr)
End Function

Public Function ReplaceSubSup(strtext As String) As Integer
      Dim str As String
      str = strtext
      str = Replace(str, "<sup>", "")
      str = Replace(str, "</sup>", "")
      str = Replace(str, "<sub>", "")
      str = Replace(str, "</sub>", "")
      ReplaceSubSup = Len(str)
End Function

Public Sub InsertException(ByVal InsertStr As String, RangeStartPos As Long)
    Dim InsertPos As Long
    Dim i As Long
    Dim arrTmp
    Dim PicName As String
    arrTmp = Split(InsertStr, SplitStr)
    For i = UBound(arrTmp) To 0 Step -1
        InsertPos = RangeStartPos + CInt(GetFlagValue(CStr(arrTmp(i)), "Pos="))
        subInsertPic ThisDocument.Range(InsertPos, InsertPos), strPath & "\" & GetFlagValue(CStr(arrTmp(i)), "AdditionInfo=")
    Next i
End Sub
Public Function getstr() As String
    getstr = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|,1;|fffd||fffd||fffd||fffd||fffd||fffd|,1"
End Function
Public Function ChangeSpecialItem(strKey As String, num As Integer) As String
    Select Case LCase(strKey)
        Case "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
           ChangeSpecialItem = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        Case "|fffd||fffd||fffd||fffd||fffd||fffd|"
           ChangeSpecialItem = "|fffd||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd|"
    End Select
End Function
' |37c||1ac||5ea|*
Public Sub ChangeWord()
    Dim str As String
    Dim TmpArray() As String
    Dim strFormField As String
    Dim strnum As Integer
    Dim i As Integer
    Dim t As Integer
    UnlockDoc
    str = getstr
    LockDoc
    TmpArray = Split(str, ";")
    For i = 0 To UBound(TmpArray)
        strFormField = Mid(TmpArray(i), 1, InStrRev(TmpArray(i), ",") - 1)
        strnum = Mid(TmpArray(i), InStrRev(TmpArray(i), ",") + 1)
        For t = 1 To strnum
            strFormField = Replace(strFormField, "1", t)
            If strFormField = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
               ThisDocument.FormFields(strFormField).Result = GetMixFldResult(ThisDocument.FormFields(strFormField), GetInvName(strFormField))
            Else
               ThisDocument.FormFields(strFormField).Result = ReturnMixFldResult(ThisDocument.FormFields(strFormField))
            End If
        Next
    Next
End Sub
'*|5ea||37c||1ac|
Public Sub UpdateSpecialData(Optional filepath As String = "")
    Dim str As String
    UnlockDoc
    str = getstr
    If filepath = "" Then
       filepath = ThisDocument.FullName
    End If
    filepath = Mid(filepath, 1, InStrRev(filepath, "\") - 1)
    strPath = filepath
    If Dir(filepath & "\uncommon.xml") <> "" Then
         SpecialData filepath & "\uncommon.xml", str
    Else
        filepath = Mid(filepath, 1, InStrRev(filepath, "\") - 1)
         strPath = filepath & "\uncommon"
         If Dir(filepath & "\uncommon\uncommon.xml") <> "" Then
            SpecialData filepath & "\uncommon\uncommon.xml", str
         Else
            UpdateField
         End If
    End If
    LockDoc
End Sub

Public Sub SpecialData(xmlname As String, str As String)
    Dim xmlSp As New DOMDocument40
    Dim nodLst As MSXML2.IXMLDOMNodeList
    Dim nod As MSXML2.IXMLDOMNode
    Dim i As Integer
    Dim j As Integer
    Dim k As Integer
    Dim t As Integer
    Dim tempCount As Integer
    Dim num As Integer
    Dim strValue As String
    Dim strField As String
    Dim strfileName As String
    Dim strFormField As String
    Dim strPic As String
    Dim strnum As Integer
    Dim TmpArray() As String
    Set xmlSp = CreateObject(XML_OBJ_NAME)
    xmlSp.validateOnParse = False
    xmlSp.resolveExternals = False
    xmlSp.Load xmlname
    On Error GoTo L
    Set nodLst = xmlSp.SelectNodes("//uncommonword")
    TmpArray = Split(str, ";")
    For i = 0 To UBound(TmpArray)
        strFormField = Mid(TmpArray(i), 1, InStrRev(TmpArray(i), ",") - 1)
        strnum = Mid(TmpArray(i), InStrRev(TmpArray(i), ",") + 1)
        For t = 1 To strnum
            strfileName = ChangeSpecialItem(strFormField, t)
            strFormField = Replace(strFormField, "1", t)
            strField = GetInvName(strFormField)
            UnlockDoc
            If strField <> "" Then
              tempCount = 1
              num = 1
              strValue = strField
              For j = 1 To Len(strValue)
                 If Mid(strField, tempCount, 1) = "*" Then
                    strPic = ""
                    For k = 0 To nodLst.Length - 1
                      Set nod = nodLst.Item(k)
                      If (nod.Attributes(0).Text = strfileName And nod.Attributes(1).Text = num) Then
                          strPic = nod.Attributes(2).Text
                          Exit For
                      End If
                    Next
                    If strPic <> "" Then
                        If tempCount < Len(strField) Then
                            strField = Mid(strField, 1, tempCount - 1) & ";AdditionInfo=" & strPic & ";" & Mid(strField, tempCount + 1)
                        Else
                            strField = Mid(strField, 1, tempCount - 1) & ";AdditionInfo=" & strPic & ";"
                        End If
                        tempCount = j + Len(strField) - Len(strValue) + 1
                    Else
                        tempCount = tempCount + 1
                    End If
                    num = num + 1
                 Else
                    tempCount = tempCount + 1
                 End If
              Next
              If strValue <> strField Then
                    setFormFieldValue ThisDocument.FormFields(strFormField), GetNodeText(strField) '|225||fffd||fffd|*
                    If strFormField = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
                       UpdateField   '|fffd||fffd||fffd||bd||171||fffd||fffd||7b8||fffd|
                    End If
                    If PosStr <> "" Then
                         UnlockDoc
                         InsertException PosStr, ThisDocument.FormFields(strFormField).Range.Start + 13 '|fffd||fffd||fffd||fffd||37c||1ac|
                         PosStr = ""
                    End If
              Else
                  If strFormField = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
                       UpdateField
                    End If
              End If
            End If
        Next
    Next
L:
    Err.Clear
End Sub

Public Function getCode(fld As FormField) As String
    If fld.Range.Text = "" Then Exit Function
    If fld.Type = wdFieldFormTextInput Then
       ' getCode = GetPureResult(fld)
        getCode = DelChr63(ReturnMixFldResult(fld)) 'special
        If getCode <> "" Then
            Exit Function
        End If
    ElseIf fld.Type = wdFieldFormCheckBox Then
        If fld.CheckBox.Value = True Then
            getCode = 1
        Else
            getCode = 0
        End If
        Exit Function
    End If
End Function
Attribute VB_Name = "modUpDown"
Public Sub RegularUpDown(LstObj As ListBox, MoveStep As Integer, ComPonentBody As String) '|fffd||fffd||fffd||1b4||fffd|-1|fffd||fffd||fffd||fffd||fffd||1b4||fffd|1
    Dim strField As String
    Dim Lfor As Integer
    With LstObj
        If MoveStep = -1 Then
            If .ListIndex <= 0 Then Exit Sub
            Lfor = 0
        Else
            If .ListIndex = -1 Or .ListIndex = .ListCount - 1 Then Exit Sub
            Lfor = -1
        End If
        ChangeListBoxItem LstObj, MoveStep, 1
        For i = .ListIndex + Lfor To .ListIndex + Lfor + 1
            strField = ""
            For j = 1 To .ColumnCount - 1
                strField = strField & .List(i, j) & ";"
            Next j
            strField = Left(strField, Len(strField) - 1)
            FillFieldsInMark ComPonentBody & i + 1, strField '|fffd||fffd||fffd||fffd||fffd||fffd|
        Next i
    End With
End Sub

Public Function ChangeListBoxItem(LstObj As ListBox, ChangeStep As Integer, Optional StartColumn As Integer = 2)
    Dim i As Integer
    Dim t As String
    On Error Resume Next
    With LstObj
        For i = StartColumn To .ColumnCount - 1
'            If IsNull(.List(.ListIndex, i)) Then .List(.ListIndex, i) = ""
'            If IsNull(.List(.ListIndex + ChangeStep, i)) Then .List(.ListIndex + ChangeStep, i) = ""
            t = .List(.ListIndex, i)
            .List(.ListIndex, i) = .List(.ListIndex + ChangeStep, i)
            .List(.ListIndex + ChangeStep, i) = t
        Next i
        .Selected(.ListIndex + ChangeStep) = True
    End With
'    frmShenQingRen.ListBox1.ColumnWidths(3) = 0
'    frmShenQingRen.ListBox1.ColumnWidths(4) = 0
    Err.Clear
End Function

Public Sub FillFieldsInMark(MarkName As String, FieldStr As String)
    Dim i As Integer
    Dim arrFieldStr
    Dim fld As FormField
    DelTail ";", FieldStr
    arrFieldStr = Split(FieldStr, ";")
    With ThisDocument.Bookmarks(MarkName).Range
        If UBound(arrFieldStr) <> .FormFields.Count - 1 Then
            ReDim Preserve arrFieldStr(.FormFields.Count - 1)
'            MsgBox "|fffd||fffd||fffd||5b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", vbExclamation, "|fffd||fffd||fffd||fffd||fffd||fffd||2be|"
'            Debug.Print .FormFields.Count - 1
'            Debug.Print UBound(arrFieldStr)
'            Debug.Print FieldStr
'            Exit Sub
        End If
        For Each fld In .FormFields
            If fld.Type = 71 Then
                fld.CheckBox.Value = arrFieldStr(i)
            Else
                'Fld.Result = arrFieldStr(i)
                EvalueFormField fld, CStr(arrFieldStr(i))
            End If
            i = i + 1
        Next
    End With
End Sub

Public Sub EvalueFormField(fldObj As FormField, fldTxt)
    Dim fStart As Long
    Dim fEnd As Long
    fldTxt = CStr(fldTxt)
    With fldObj.Range
        fStart = .Start + 13
        fEnd = .End - 1
    End With
    With ThisDocument
        If fldTxt <> "" Then
            .Range(fStart, fEnd).Text = Trim(fldTxt)
        Else
            '.Range(fStart, fEnd).Text = " "
            fldObj.Result = ""
        End If
    End With
End Sub

Public Function DelTail(TailFlag As String, ByRef StrBody As String) As String
    If Right(StrBody, Len(TailFlag)) = TailFlag Then
        StrBody = Left(StrBody, Len(StrBody) - Len(TailFlag))
    End If
    DelTail = StrBody
End Function
Attribute VB_Name = "modVerify"

'----------------------------------|fffd||fffd||2bd||fffd||fffd||5a4||fffd||fffd||fffd||fffd|------------------------------

Sub validateNumeric()
' Selection.MoveUp Unit:=wdParagraph, Count:=1
Dim strFldName As String
Dim strValue As String
Dim i As Integer

On Error Resume Next
    'strFldName = "|fffd||fffd||fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd||fffd||fffd|1_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    strValue = getCurrentFormControl(strFldName)
    If Not IsNumeric(strValue) Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", vbInformation, glbHint
    End If

End Sub
Sub validatePostCode()
' Selection.MoveUp Unit:=wdParagraph, Count:=1
Dim strFldName As String
Dim strValue As String
Dim i As Integer
Dim strErr As String

On Error Resume Next
    'strFldName = "|fffd||fffd||fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd||fffd||fffd|1_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    strErr = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4bb||fffd||fffd||fffd||fffd||4bb||fffd||fffd|6|3bb||fffd||fffd||fffd||fffd|..."
    strValue = getCurrentFormControl(strFldName)
    If strValue = "" Then Exit Sub
    If Not IsNumeric(strValue) Then
'        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", vbInformation, ""
        MsgBox strErr, vbInformation, errHint
        ThisDocument.FormFields(strFldName).Result = ""
        Exit Sub
    End If
    If Len(strValue) <> 6 Then
        MsgBox strErr, vbInformation, errHint
        ThisDocument.FormFields(strFldName).Result = ""
        Exit Sub
    End If
End Sub

Sub invalidEmail()
' Selection.MoveUp Unit:=wdParagraph, Count:=1
Dim strFldName As String
Dim strValue As String
Dim i As Integer
Dim strSub As String    '@|fffd||fffd||fffd||fffd||fffd||4b2||fffd||fffd||fffd||4f4||fffd|
Dim mark As Integer     '@|fffd||fffd||fffd||fffd||fffd||fffd|Email|fffd||435||fffd||3bb||fffd||fffd|
Dim dot As Integer      '|fffd||fffd|strSub|fffd||421||fffd|.|fffd||fffd||fffd||fffd||fffd||175||fffd||3bb||fffd||fffd|
Dim strErr As String

On Error Resume Next
'strFldName = "|fffd||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
strValue = getCurrentFormControl(strFldName)
If strValue = "" Then
    Exit Sub
Else
    strErr = "Email|fffd||fffd||5b7||fffd||fffd||2bd||fffd||fffd||fffd||fffd||237|..."
    mark = InStr(1, strValue, "@")
    If mark <= 1 Or mark = Len(strValue) Then
        MsgBox strErr, vbInformation, errHint
        ThisDocument.FormFields(strFldName).Select
        Exit Sub
    Else
        strSub = Mid(strValue, mark + 1)
        dot = InStr(1, strSub, ".")
        If dot <= 1 Or dot = Len(strSub) Or Right(strSub, 1) = "." Then
        '|fffd||fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|@|fffd||fffd||fffd||4bb||3bb||fffd||fffd||fffd||fffd||fffd||4bb||3bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||436||fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            MsgBox strErr, vbInformation, errHint
'            thisdocument.FormFields(strFldName).Select
            Exit Sub
        End If
    End If
End If
End Sub

Sub invalidYear()
    Dim strFldName As String
    Dim strValue As String
    
    strValue = getCurrentFormControl(strFldName)
    If strValue = "" Then Exit Sub
    
    If Val(strValue) < 1000 Or Val(strValue) > 9999 Then
        MsgBox "|4aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||fffd||fffd||fffd|...", vbInformation, glbHint
    End If
End Sub

Sub invalidMonth()
    Dim strFldName As String
    Dim strValue As String
    
    strValue = getCurrentFormControl(strFldName)
    If strValue = "" Then Exit Sub
    
    If Val(strValue) < 1 Or Val(strValue) > 12 Then
        MsgBox "|4aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||fffd||b7||fffd|...", vbInformation, glbHint
    End If
End Sub

Sub invalidDay()
    Dim strFldName As String
    Dim strValue As String
    
    strValue = getCurrentFormControl(strFldName)
    If strValue = "" Then Exit Sub
    
    If Val(strValue) < 1 Or Val(strValue) > 31 Then
        MsgBox "|4aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||fffd||fffd||fffd||fffd|...", vbInformation, glbHint
    End If
End Sub



' InQuest injected base64 decoded content
' eu+Z

INQUEST-PP=macro
