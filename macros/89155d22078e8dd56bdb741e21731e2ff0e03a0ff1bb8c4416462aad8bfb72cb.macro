Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "Label1, 2, 0, MSForms, Label"
Attribute VB_Control = "Label2, 3, 1, MSForms, Label"
Attribute VB_Control = "Label3, 7, 2, MSForms, Label"
Attribute VB_Control = "CommandButton1, 14, 3, MSForms, CommandButton"
Private Sub CommandButton1_Click()
Call cfjs
End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "UFzuce"
Attribute VB_Base = "0{997CC10A-D0D2-47CA-88E1-961838EEF00D}{53900708-4B72-4445-B697-575F8E299D08}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Private Sub CommandButton2_Click()
Unload UFzuce
End Sub

Private Sub CommandButton3_Click()
 Call goumai
 
End Sub
Private Sub zubox1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
On Error Resume Next


If Button = 2 Then
Dim MyData As DataObject
Dim strClip As String

Set MyData = New DataObject
MyData.GetFromClipboard
strClip = MyData.GetText

zubox1.Text = strClip
End If

End Sub

Private Sub wvzuce_Click()
Application.ScreenUpdating = False

Call zuce_c

Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "shtsys"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "wv_pAL"
Attribute VB_Name = "wvp"
Option Private Module
'Option Explicit

Type sum_detail
    hit_time As Long
    mbr_id() As Long
    plan_score As Long
End Type



Public yuanliaogengshu_q, yuliao_q, yuliaogengshu_q
Public zongshuqu(1 To 10000, 0 To 3), minxiqu(1 To 10000, 0 To 234)


Public tihuangshu As Long

Public prod_len_sav() As Long, prod_req_sav() As Long
Public raw_len_sav() As Long, raw_num_sav() As Long
Public prod_len() As Long, prod_req() As Long, prod_score() As Long, prod_seq() As Long
Public raw_len() As Long, raw_num() As Long
Public global_plan() As Long, global_stat() As Long, best_plan() As Long, best_stat() As Long
Public usage As Long, longest_remain As Long
Public best_usage, best_longest_remain As Long, patterns As Long, best_patterns As Long, cut_loss As Long

Public zhuiyou_hangshu As Long
Public zhuiyou_lieshu As Long
Public xianshishijian As Long
Public n As Long
Public yuanliao_Data

Public js_time
Public ks_time
Public lilunshijian
Public arr_huizong()
Public arr0_z()
Public arr_L As Long
Public hs As Long
Public ls As Long
Public yu_max As Long



Public relax_range As Long, relax_H As Long, relax_L As Long
Public firstid As Long, firstlen As Long
Public c As Long
Public t ' As Long
Public xunhuans As Long


Sub wvCommandButton3_Click() '|fffd||2f3||fffd||fffd||fffd||fffd||fffd|
Unload UFsezhi
End Sub


Sub goumai()
Dim Browser As Object
Dim URL As String
URL = "https://item.taobao.com/item.htm?id=555428350967"

                 Set Browser = CreateObject("wscript.shell")

                  Browser.Run (URL)

                  
End Sub




Sub zuce_c()
          
        On Error GoTo errline
        Dim i%
        Dim c
        Dim Y%
        Dim m%
        Dim d%
        Dim rq As String
        Dim sc
        If Len(UFzuce.zubox1.Text) <> 25 Then
        MsgBox "|5e2||fffd||fffd||fffd||bce4||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||b870|QQ|fffd||fffd|642595370|fffd||fffd||fffd||fffd||3f5||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
        Application.ScreenUpdating = True
        GoTo errline
        End If
        
        If IsNumeric(UFzuce.zubox1.Text) Then
        MsgBox "|5e2||fffd||fffd||fffd||fffd||fffd||fffd||fffd||e3b32||fffd||fffd||fffd||fffd||fffd||22b||fffd||fffd||fffd||fffd||3aa||fffd||fffd||fffd||5a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||b870|QQ|fffd||fffd|642595370|fffd||fffd||fffd||fffd||3f5||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
        Application.ScreenUpdating = True
        GoTo errline
        End If
        
        If VBA.Mid(UFzuce.zubox1.Text, 5, 1) & VBA.Mid(UFzuce.zubox1.Text, 21, 1) <> "YX" Then
        MsgBox "|5e2||fffd||fffd||fffd||fffd||fffd||fffd||fffd||372||fffd||1a5||fffd||48ec||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||5e2||fffd||fffd||fffd||b8e1|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
        GoTo errline
        End If
        
        
With shtsys
        If Int(CDate(Now())) - .Cells(4, 69).Value < 0 Then
        
        MsgBox "|3f5||373||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||b870|QQ|fffd||fffd|642595370|fffd||fffd||fffd||fffd||3f5||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
        Application.ScreenUpdating = True
        GoTo errline
        End If

            Y = "20" & VBA.Mid(UFzuce.zubox1.Text, 4, 1) & VBA.Mid(UFzuce.zubox1.Text, 23, 1)
            m = VBA.Mid(UFzuce.zubox1.Text, 6, 1) & VBA.Mid(UFzuce.zubox1.Text, 11, 1)
            d = VBA.Mid(UFzuce.zubox1.Text, 10, 1) & VBA.Mid(UFzuce.zubox1.Text, 19, 1)
            
            If .Cells(3, 69).Value = 0.5 Then
            MsgBox "|5ae||1f0||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4e1||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4e1||fffd||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd||fffd||fffd|30|fffd||763||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||6bc||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3aa|2|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2a3||fffd||fffd||fffd||fffd||fffd||fffd||17b||fffd||fffd||fffd||fffd||fffd||4b2||fffd||1c7b||221||fffd||fffd||fffd||fffd||2b9||fffd||f0||fffd||fffd||fffd||fffd||fffd||17b||fffd||221||fffd||fffd||fffd||fffd||5bb||fffd||fffd||2b9||fffd||fffd||4bb||fffd||fffd||b8e9|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
            End If
            
            .Cells(3, 69).Value = 1
            .Cells(2, 69).Value = val(VBA.Mid(UFzuce.zubox1.Text, 13, 1) & VBA.Mid(UFzuce.zubox1.Text, 18, 1))
            
            sc = .Cells(2, 69).Value
            If m = 0 Or m > 12 Then GoTo errline
            If d = 0 Or d > 31 Then GoTo errline
            
            rq = Y & "-" & m & "-" & d
            c = Abs(Int(CDate(Now())) - CDate(rq))
            
            
            If Int(CDate(Now())) - CDate(rq) > 11 Then
            MsgBox "|5e2||fffd||fffd||fffd||fffd||fffd||479||fffd||fffd||fffd|5|fffd||fffd||fffd||fffd||427||fffd||6a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||b870|QQ|fffd||fffd|642595370|fffd||fffd||fffd||fffd||3f5||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
            Application.ScreenUpdating = True
            GoTo errline
            End If
            
            If c > sc * 31 Then
            MsgBox "|5e2||fffd||fffd||fffd||fffd||2a7||427||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||b870|QQ|fffd||fffd|642595370|fffd||fffd||fffd||fffd||3f5||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
            Application.ScreenUpdating = True
            UFzuce.zubox1.Text = "": UFzuce.zubox1.SetFocus
            'ThisWorkbook.Save
            Else
            Dim zuceye()
            zuceye = .Range("A1").Resize(10, 200)

                            For i = 1 To 10
                            zuceye(1, i * 10 + 8) = 1
                            zuceye(2, i * 10 + 8) = 0
                            zuceye(1, i * 10 + 9) = 0
                            zuceye(2, i * 10 + 9) = sc
                            zuceye(10, i * 10 + 8) = UFzuce.zubox1.Text
                            Next
                            .Range("A1").Resize(10, 200) = zuceye
                            MsgBox "|5e2||fffd||fffd||279||fffd||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
                            Unload UFzuce
            ThisWorkbook.Save
            End If
            
End With
Exit Sub

errline:
MsgBox "|5e2||fffd||fffd||2a7||fffd||723||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||b870|QQ|fffd||fffd|642595370|fffd||fffd||fffd||fffd||3f5||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
Application.ScreenUpdating = True
UFzuce.zubox1.Text = "": UFzuce.zubox1.SetFocus
With shtsys
Dim zuceno()
zuceno = .Range("A1").Resize(2, 200)
    For i = 1 To 10
    zuceno(1, i * 10 + 8) = 1 '|fffd||fffd||2bd||2b9||fffd||f0||6c7e|
    zuceno(2, i * 10 + 8) = 1 '|2b9||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||fffd|
    zuceno(1, i * 10 + 9) = 1 '|fffd||fffd||fffd||fffd||5e2||fffd||fffd||134||fffd||fffd||fffd|
    zuceno(2, i * 10 + 9) = 0 '|2b1||fffd||4ce4|
    Next
.Range("A1").Resize(2, 200) = zuceno
End With

End Sub

Sub wwup()
Dim m%
Dim i%
Dim sysj
Dim wvkey As String
sysj = InputBox("|2b1||fffd||fffd||fffd||fffd|")
If Not IsNumeric(sysj) Then sysj = 10
If val(sysj) = 0 Then sysj = 10

With shtsys
.Cells(6, 10).Value = 1
.Cells(1, 65) = sysj
.Cells(3, 10).Value = 5
m = val(.Cells(1, 10).Value)
    For i = 1 To 10
    .Cells(1, i * 10 + 8).Value = 0 '|fffd||fffd||2bd||2b9||fffd||f0||6c7e|
    .Cells(2, i * 10 + 8).Value = 0 '|2b9||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||fffd|
    .Cells(3, i * 10 + 8).Value = 0 '|fffd||1f7||fffd||fffd||47e||fffd||fffd||fffd||2b1|
    .Cells(1, i * 10 + 9).Value = 0 '|fffd||fffd||fffd||fffd||5e2||fffd||fffd||134||fffd||fffd||fffd|
    .Cells(2, i * 10 + 9).Value = 0 '|2b1||fffd||fffd|
    .Cells(3, i * 10 + 9).Value = 1 '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    .Cells(4, i * 10 + 9).Value = 0 '|fffd||fffd||fffd||fffd||fffd||fffd|
    .Cells(5, i * 10 + 9).Value = "D:\Program Files\Microsoft Ni" 'key|fffd||13c||fffd||fffd||fffd||175||fffd||3bb||fffd||fffd|
    .Cells(1, i * 10 + 5).Value = sysj '|2b9||fffd||fffd||2b1||fffd||fffd|
    Next
sysj = InputBox("|fffd||5b6||fffd||fffd||fffd||fffd||fffd||5b5||fffd||fffd|")
If Not IsNumeric(sysj) Then sysj = 90
If val(sysj) = 0 Then sysj = 90
.Cells(5, 10).Value = sysj
    
wvkey = InputBox("|fffd||13c||fffd||fffd||fffd||fffd||fffd|")
If Len(wvkey) < 2 Then wvkey = "wangveiyx"
   .Cells(8, 20).Value = wvkey
End With

End Sub
Sub muluwjj()
On Error Resume Next

Dim idr$, cz%, path0$, path1$, fso, drs, dr

idr = "D:"  '|4aa||fffd||436||3f5||fffd||fffd||337||fffd|
cz = 0
Set fso = CreateObject("Scripting.FileSystemObject")
Set drs = fso.Drives
For Each dr In drs
If dr = idr Then cz = 1
Next
If cz = 1 Then
path0 = idr & "\Program Files"
Else
path0 = "C:\Program Files"
End If

path1 = path0 & "\Microsoft Ni"
'wvkey = "\" & "wangvei32" & ".txt"

If fso.folderexists(path0) Then
    SetAttr path0, vbHidden
    If fso.folderexists(path1) = False Then
        MkDir path1
        With shtsys
            For cz = 1 To 10
            .Cells(5, cz * 10 + 9).Value = path1 'key|fffd||13c||fffd||fffd||fffd||fffd||fffd||3bb||fffd||fffd|
            Next
        End With
    End If
Else
MkDir path0
MkDir path1

With shtsys
    For cz = 1 To 10
    .Cells(5, cz * 10 + 9).Value = path1 'key|fffd||13c||fffd||fffd||fffd||fffd||fffd||3bb||fffd||fffd|
    Next
End With

End If
End Sub

Sub wvpanduan()
Call muluwjj

On Error Resume Next
Dim path1
        Dim c
        Dim Y%
        Dim m%
        Dim d%
        Dim rq As String
        Dim l
        Dim i%
        Dim sysj
        Dim wvkey As String
          'On Error GoTo errline
          
        With shtsys
        
        
        If .Cells(1, 68).Value = "" Or _
        .Cells(2, 68).Value = "" Or _
        .Cells(3, 68).Value = "" Or _
        .Cells(1, 69).Value = "" Or _
        .Cells(2, 69).Value = "" Or _
        .Cells(4, 69).Value = "" Or _
        .Cells(1, 65).Value = "" Then
        
        MsgBox "|fffd||bcbb||4aa||27e||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||13c||fffd||fffd||fffd||fffd||3bd61||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||6a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||5e2||fffd||fffd||fffd||b8e1|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
        .Cells(2, 68).Value = 1
        .Cells(1, 69).Value = 1
        .Cells(1, 68).Value = 1
        Exit Sub
        End If
        
        If .Cells(2, 68).Value = 1 Or .Cells(1, 69).Value = 1 Then Exit Sub
        
        path1 = .Cells(5, 69).Value
        wvkey = "\" & .Cells(8, 20).Value & ".txt"
        If .Cells(1, 68).Value = 0 Then '|fffd||fffd||fffd||f0||fffd|
            
            If Dir(path1 & wvkey) <> "" Then .Cells(1, 68).Value = 1 '|5ea||3aa||fffd||fffd||2bd||fffd||fffd|
            
            If .Cells(3, 68).Value = 0 Then '|fffd||fffd||4bb||fffd||fffd||2b9||fffd||fffd|
            Dim shiyong()
            shiyong() = .Range("A3").Resize(2, 200)
                        For i = 1 To 10
                        shiyong(1, i * 10 + 8) = 1 '|fffd||131||fffd||2b9||fffd||fffd||5f4||32c||3aa||fffd||1f5||fffd||4bb||fffd||fffd|
                        shiyong(2, i * 10 + 8) = Date '|fffd||fffd||fffd||b5||fffd||4bb||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||fffd|
                        Next
            .Range("A3").Resize(2, 200) = shiyong
                    
            Else '|fffd||1f5||fffd||4bb||fffd||fffd||2b9||fffd||fffd|
            sysj = .Cells(1, 65).Value '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If Abs(CDbl(Date) - CDbl(.Cells(4, 68).Value)) > sysj Then
                        Dim sydaoqi()
                        sydaoqi() = .Range("A1").Resize(4, 200)
                        For i = 1 To 10
                        sydaoqi(1, i * 10 + 8) = 1 '|fffd||fffd||2bd||2b9||fffd||f0||6c7e|
                        sydaoqi(2, i * 10 + 8) = 1 '|2b9||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||fffd|
                        sydaoqi(1, i * 10 + 9) = 1 '|fffd||fffd||fffd||fffd||5e2||fffd||fffd||134||fffd||fffd||fffd|
                        sydaoqi(4, i * 10 + 9) = Int(CDate(Now())) - 1 '|fffd||fffd||fffd||fffd||fffd||fffd|
                        Next
                        .Range("A1").Resize(4, 200) = sydaoqi
                        
                        
                        
                         MsgBox "|fffd||fffd||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||6a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||5e2||fffd||fffd||fffd||b8e1|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
                        Open path1 & wvkey For Output As #1
                        Close #1
                                If Err.Number = 75 Or Err.Number = 76 Then
                                MsgBox "|fb||fffd||fffd||fffd||fffd||221||fffd||fffd||fffd||535||fffd||fffd||337||fffd||fffd||163||fffd||fffd||fffd||fffd||fffd||3f5||373||fffd||1f7||fffd||fffd||fffd|C|fffd||33b||fffd|D|fffd||323||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
                                Exit Sub
                                End If
                
                End If
            End If
        
        Else '|fffd||fffd||2bd||fffd||fffd|
                    If Len(.Cells(10, 68).Value) <> 25 Then GoTo errline
                    If IsNumeric(.Cells(10, 68).Value) Then GoTo errline
                    Y = "20" & VBA.Mid(.Cells(10, 68).Value, 4, 1) & VBA.Mid(.Cells(10, 68).Value, 23, 1)
                    m = VBA.Mid(.Cells(10, 68).Value, 6, 1) & VBA.Mid(.Cells(10, 68).Value, 11, 1)
                    d = VBA.Mid(.Cells(10, 68).Value, 10, 1) & VBA.Mid(.Cells(10, 68).Value, 19, 1)
                    
                    l = val(.Cells(2, 69).Value) * val(.Cells(3, 69).Value)
                    If m = 0 Or m > 12 Then GoTo errline
                    If d = 0 Or m > 31 Then GoTo errline
                    rq = Y & "-" & m & "-" & d
                    c = Abs(Int(CDate(Now())) - CDate(rq))
                        If c > l * 31 Then
                        'MsgBox c & "-->" & l * 31
                        Dim sydaoqiz()
                        sydaoqiz() = .Range("A1").Resize(4, 200)
                        For i = 1 To 10
                        sydaoqiz(1, i * 10 + 8) = 1 '|fffd||fffd||2bd||2b9||fffd||f0||6c7e|
                        sydaoqiz(2, i * 10 + 8) = 1 '|2b9||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||fffd|
                        sydaoqiz(1, i * 10 + 9) = 1 '|fffd||fffd||fffd||fffd||5e2||fffd||fffd||134||fffd||fffd||fffd|
                        sydaoqiz(4, i * 10 + 9) = Int(CDate(Now())) - 1 '|fffd||fffd||fffd||fffd||fffd||fffd|
                        Next
                        .Range("A1").Resize(4, 200) = sydaoqiz
                        MsgBox "|2b9||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||6a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||5e2||fffd||fffd||fffd||b8e1|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"

                        Open path1 & wvkey For Output As #1
                        Close #1
                                If Err.Number = 75 Or Err.Number = 76 Then
                                MsgBox "|fb||fffd||fffd||fffd||fffd||221||fffd||fffd||fffd||535||fffd||fffd||337||fffd||fffd||163||fffd||fffd||fffd||fffd||fffd||3f5||373||fffd||1f7||fffd||fffd||fffd|C|fffd||33b||fffd|D|fffd||323||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
                                Exit Sub
                                End If
                        ThisWorkbook.Save
                        End If
            
        End If
        
        
        End With
Exit Sub

errline:
MsgBox "|5e2||fffd||fffd||2a7||fffd||723||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b9||fffd||fffd||fffd||fffd||fffd||b870|QQ|fffd||fffd|642595370|fffd||fffd||fffd||fffd||3f5||fffd||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"

With shtsys
Dim zuceno()
zuceno = .Range("A1").Resize(2, 200)
    For i = 1 To 10
    zuceno(1, i * 10 + 8) = 1 '|fffd||fffd||2bd||2b9||fffd||f0||6c7e|
    zuceno(2, i * 10 + 8) = 1 '|2b9||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||fffd|
    zuceno(1, i * 10 + 9) = 1 '|fffd||fffd||fffd||fffd||5e2||fffd||fffd||134||fffd||fffd||fffd|
    zuceno(2, i * 10 + 9) = 0 '|2b1||fffd||4ce4|
    Next
.Range("A1").Resize(2, 200) = zuceno
End With
End Sub
'=========================================================================================================|461||fffd||3fc||fffd||fffd||fffd|
Sub cfjs()
Application.ScreenUpdating = False
ks_time = Timer

'On Error Resume Next
Call wvpanduan
        With shtsys
            If .Cells(2, 68).Value = 1 Or .Cells(1, 69).Value = 1 Then '|fffd||436||fffd||fffd||1f7||fffd||fffd||fffd||534||fffd||4e1|
            MsgBox "|2b9||fffd||fffd||2b1||fffd||fffd||fffd||475||fffd||fffd||6a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||237||fffd||fffd||5e2||fffd||fffd||fffd||b8e1|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
            UFzuce.Show
            Application.ScreenUpdating = True
            UFzuce.zubox1.SetFocus
            Exit Sub
            End If
        
        End With

Application.StatusBar = "|fffd||fffd||fffd||177||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||423||fffd||fffd||fffd||fffd||fffd||fffd||135||234||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"

ReDim arr3(0 To 10000, -4 To 200)
arr3(0, -4) = "|52d||fffd||3f3||fffd||fffd||fffd|"
arr3(0, -3) = "|fffd||fffd||fffd||fffd||fffd||fffd|"
arr3(0, -2) = "|fffd||fffd||fffd||3f3||fffd||fffd||fffd|"
arr3(0, -1) = "|fffd||43f||fffd||fffd||fffd||fffd|"
arr3(0, 0) = "|fffd||fffd||fffd||3f3||fffd||fffd||fffd|"
Call wv_huizong
With Sheet2
arr_wv0 = .Cells(2, 2).Resize(2, 234)
yuanliao_s = Sheet2.Cells(7, 200).End(1).Column - 1

End With

If yuanliao_s < 1 Then MsgBox "|fb||fffd||fffd||52d||fffd||fffd||fffd||fffd||fffd||763||fffd|", 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|": End
If yuanliao_s < 2 Then Call wv_danshuan
If yuanliao_s > 1 Then Call wv_duoyL

arr_L = Application.Max(Application.Index(arr3, , 205))

yong_z = 0
yuang_z = 0
    For i = 1 To h_arr + hs - 1
    yuang_z = yuang_z + arr3(i, -4) * arr3(i, -3)
    yong_z = yong_z + arr3(i, 0) * arr3(i, -3)
    Next i


    For i = 1 To arr_L
    arr3(0, i) = "|fffd||fffd|" & i & "|fffd||fffd|"
    Next i

yu_max = Application.Max(Application.Index(arr3, , 3))
ReDim arr0_z(1 To 3, 1 To 1)
arr0_z(1, 1) = Application.Sum(Application.Index(arr3, , 2))
arr0_z(2, 1) = yu_max
arr0_z(3, 1) = yong_z / yuang_z
With Sheet2
.Cells(12, 2).Resize(3, 1) = arr0_z
.Cells(17, 1).Resize(h_arr + hs, 200) = arr3
.Cells(17, 1).Resize(h_arr + hs, arr_L + 5).Sort _
key1:=.Cells(17, 1).Resize(h_arr + hs, arr_L + 5).Cells(3), order1:=xlAscending, _
key2:=.Cells(17, 1).Resize(h_arr + hs, arr_L + 5).Cells(1), order2:=xlAscending, Header:=xlYes
.Cells(17, 1).Resize(h_arr + hs, arr_L + 5).Borders.LineStyle = 1
.Cells(17, 1).Resize(h_arr + hs, arr_L + 5).Interior.ColorIndex = 38
.Cells(17, 1).Resize(h_arr + hs, 5).Interior.ColorIndex = 34
.Cells(17, 1).Resize(h_arr + hs, 2).Interior.ColorIndex = 40
.Cells(17, 1).Resize(h_arr + hs + 1, arr_L + 5).Font.size = 10
.Cells(17, 1).Offset(h_arr + hs, 1) = "|fffd||3fc||fffd|" & arr0_z(1, 1)
.Cells(17, 1 + 5).Resize(hs + 1, arr_L).EntireColumn.AutoFit

h_L1 = 17 + h_arr + hs - 1
If h_L1 - 18 > 1 Then
    For i = 18 To h_L1
    If val(.Cells(i, 3)) > 0 Then h_L2 = i: Exit For
    Next
.Cells(h_L2, 1).Resize(h_L1 - h_L2 + 1, arr_L + 5).Sort _
key1:=.Cells(h_L2, 1).Resize(h_L1 - h_L2 + 1, arr_L + 5).Cells(1), order1:=xlAscending, Header:=xlNo
End If
.Cells(17, 1 + 2).Resize(h_arr + hs, 1).Find(yu_max, lookat:=xlWhole).Interior.ColorIndex = 3
'.Shapes("TextBox 1").Visible = msoFalse

arr3_lin = .Cells(18, 1).Resize(h_arr + hs - 1, 200)
.Cells(2, 2).Resize(2, 234) = arr_wv0


arr_y_L = .Cells(7, 2).Resize(2, yuanliao_s + 1)
For i = 1 To yuanliao_s
    k = 0
    For j = 1 To UBound(arr3_lin, 1)
        If arr3_lin(j, 1) = arr_y_L(1, i) Then
        k = k + arr3_lin(j, 2)
        End If
    Next j
    arr_y_L(2, i) = k & "|fffd||fffd|"
    arr_y_L(2, yuanliao_s + 1) = arr_y_L(2, yuanliao_s + 1) + k
Next i
    arr_y_L(1, yuanliao_s + 1) = "|fffd||3fc||fffd|"
    arr_y_L(2, yuanliao_s + 1) = arr_y_L(2, yuanliao_s + 1) & "|fffd||fffd|"
.Cells(13, 7).Resize(2, 200).Clear
.Cells(13, 7).Resize(2, yuanliao_s + 1) = arr_y_L
.Cells(13, 7).Resize(2, yuanliao_s + 1).Borders.LineStyle = 1
.Cells(13, 7).Resize(2, yuanliao_s + 1).Font.size = 10
.Cells(13, 7).Resize(2, yuanliao_s + 1).HorizontalAlignment = xlRight
Application.StatusBar = False
.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
End With
js_time = Timer
DoEvents
Application.ScreenUpdating = True

MsgBox "|524||fffd||fffd||2b9||fffd||fffd||2b1||fffd||48fa|" & lilunshijian & "|fffd||fffd||2b5||fffd||fffd||2b9||fffd||fffd||2b1||fffd||48fa|" & (js_time - ks_time), 64, "QQ642595370|fffd||fffd||5bb||3aa||fffd||fffd||fffd||427||fffd||2a3||fffd||fffd||fffd||2be||fffd||fffd|"
ThisWorkbook.Save

End
End Sub

Public Sub solve_subsetsum(candidate_len() As Long, candidate_id() As Long, target_sum As Long, choosen() As Long)
Dim Arr() As sum_detail, known_sum(), last As Long
Dim exist_ids() As Long, new_ids() As Long, score1 As Long, score2 As Long
Dim i As Long, j As Long, k As Long, size As Long
Dim sum1 As Long, sum2 As Long, mysum As Long, id1 As Long, eff_hit As Long, hit_limit As Long

ReDim Arr(0 To target_sum)
ReDim known_sum(0 To target_sum)
ReDim Arr(0).mbr_id(1 To 1)

hit_limit = relax_range * 200

known_sum(0) = 0
last = 0
new_last = 0

For i = 1 To UBound(candidate_len)
    sum1 = candidate_len(i)
    id1 = candidate_id(i)
    
    For j = 0 To last
        sum2 = known_sum(j)
        mysum = sum1 + sum2
        
        If mysum > target_sum Then GoTo skip
        
        With Arr(mysum)
            If .hit_time = 0 Then
                .hit_time = .hit_time + 1
                .mbr_id = Arr(sum2).mbr_id
                size = UBound(.mbr_id) + 1
                ReDim Preserve .mbr_id(1 To size)
                .mbr_id(size) = id1
                .plan_score = get_my_score(.mbr_id)
                new_last = new_last + 1
                known_sum(new_last) = mysum
            ElseIf mysum >= target_sum - relax_range * 1.2 Then
                'eff_hit = eff_hit + 1
                .hit_time = .hit_time + 1
                'If eff_hit >= hit_limit Then GoTo i_have_enough_combin
                If .hit_time Mod 7 = 0 Then
                exist_ids = .mbr_id
                new_ids = Arr(sum2).mbr_id
                size = UBound(new_ids) + 1
                ReDim Preserve new_ids(1 To size)
                new_ids(size) = id1
                
                score1 = .plan_score
                score2 = get_my_score(new_ids)
                If score2 > score1 Then
                    .mbr_id = new_ids
                    .plan_score = score2
                End If
                End If
            End If
        End With
skip:
    Next j

    last = new_last
Next i

i_have_enough_combin:
Dim best As Long, best_score As Long
best_score = -2 ^ 30

    If relax_range >= target_sum Then relax_range = target_sum '++++++++++++++++++++++++++++++++++++++++++++++++++++|fffd||53c||fffd||fffd||fffd||fffd||4f5||fffd||4bb||fffd||3b4||fffd||fffd||fffd|
    
For i = target_sum To target_sum - relax_range Step -1
    If Arr(i).hit_time <= 0 Then GoTo no_plan_skip
        
    score1 = get_my_score(Arr(i).mbr_id)
    If score1 > best_score Then
        best_score = score1
        best = i
    End If

no_plan_skip:
Next i

If best > 0 Then
    choosen = Arr(best).mbr_id
    Exit Sub
Else
    For i = target_sum To 0 Step -1
        If Arr(i).hit_time > 0 Then
            choosen = Arr(i).mbr_id
            Exit Sub
        End If
    Next i
End If
End Sub

Function get_my_score(Arr() As Long) As Long
Dim i As Long, id As Long, mul As Long, max_mul As Long, usage As Long, score As Long
Dim plan() As Long
ReDim plan(1 To UBound(prod_len))

For i = 1 To UBound(Arr)
    id = Arr(i)
    If id > 0 Then
        plan(id) = plan(id) + 1
    End If
Next i
If firstid > 0 Then plan(firstid) = plan(firstid) + 1

max_mul = 2 ^ 30
For i = 1 To UBound(plan)
    If plan(i) > 0 Then
        mul = Int(prod_req(i) / plan(i))
        If mul < max_mul Then
            max_mul = mul
        End If
    End If
Next i

For i = 1 To UBound(plan)
    If plan(i) > 0 Then
        usage = usage + prod_len(i) * plan(i)
        score = usage + prod_score(i)
    End If
Next i
score = score * max_mul
get_my_score = score
End Function


Public Sub gen_rand_score(target_len As Long)
Dim mylen As Long, i As Long
    For i = 1 To UBound(prod_score)
        mylen = prod_len(i)
        If mylen >= target_len / 2 Then
            prod_score(i) = Int(Rnd * 80)
        ElseIf mylen >= target_len / 3 Then
            prod_score(i) = Int(Rnd * 40)
        ElseIf mylen >= target_len / 4 Then
            prod_score(i) = Int(Rnd * 30)
        ElseIf mylen >= target_len / 5 Then
            prod_score(i) = Int(Rnd * 20)
        Else
            prod_score(i) = 0
        End If
    Next i
End Sub
Public Sub adjust_prod_seq()
Dim i As Long, j As Long, k As Long, p As Long
Dim id As Long, raw_remain As Long, raw_mul As Long
p = UBound(prod_len)
For i = 1 To best_patterns
    raw_mul = best_stat(i, 1)
    raw_remain = best_stat(i, 3)
    If raw_mul <= 1 Then 'And raw_remain >= relax_range Then
        For j = 1 To p
            id = j
            If best_plan(i, j) > 0 Then
                Call lift_prod_seq(id)
            End If
        Next j
    End If
Next i
End Sub
Public Sub gen_rand_seq()
Dim i As Long, j As Long, p1 As Long, p2 As Long, swap As Long
j = UBound(prod_seq)
For i = 1 To j
    p1 = Int(Rnd * Int(j - 1)) + 1
    p2 = Int(Rnd * Int(j - 1)) + 1
    swap = prod_seq(p1)
    prod_seq(p1) = prod_seq(p2)
    prod_seq(p2) = swap
Next i
End Sub
Public Sub lift_prod_seq(pid As Long)
Dim i As Long, j As Long, k As Long, p1 As Long, p2 As Long, swap As Long

j = UBound(prod_seq)

For i = 1 To j
    If prod_seq(i) = pid Then
        p2 = i
        p1 = p2 - 10
        If p1 <= 0 Then p1 = 1
        
        For k = p2 To p1 + 1 Step -1
            prod_seq(k) = prod_seq(k - 1)
        Next k
         prod_seq(p1) = pid
         Exit Sub
    End If
Next i
End Sub


Sub rand_solves() ''|fffd||fffd||2bc||fffd||fffd||fffd||fffd|
Dim plan() As Long ', t
Dim i As Long, j As Long, k As Long, finish As Boolean, no_more As Boolean
Dim rawid As Long, rawlen As Long, prodid As Long, p As Long, r As Long
Dim search_count, search_step, search As Long, mul As Long, mymul As Long, mylen As Long

Randomize

Call read_data

search_count = 100 ' |12c||fffd||fffd||fffd||fffd||3f4||fffd||fffd||fffd|
search_step = 5

best_usage = 2 ^ 30
best_longest_remain = 0

For search = 1 To search_count

prod_len = prod_len_sav
prod_req = prod_req_sav
raw_len = raw_len_sav
raw_num = raw_num_sav

usage = 0
longest_remain = 0
patterns = 0

r = UBound(raw_len)
p = UBound(prod_len)
ReDim global_plan(1 To 20000, 1 To p)
ReDim global_stat(1 To 20000, 1 To 3)

finish = False
no_more = False
Do Until finish Or no_more
    
    rawid = get_raw()
    If rawid <= 0 Then
        no_more = True
        
        Exit Do
    Else
        rawlen = raw_len(rawid)
        
        relax_H = rawlen / 20
        If relax_H > 300 Then relax = 300
        relax_L = 5
        relax_range = 13 * search Mod relax_H 'Int(Rnd * (relax_H - relax_L) + relax_L)
        
        Call gen_a_plan(plan, rawlen)
        
        mul = raw_num(rawid)
        For i = 1 To UBound(plan)
            If plan(i) > 0 Then
                mymul = Int((prod_req(i)) / plan(i))
                If mymul > 0 And mymul < mul Then mul = mymul
            End If
        Next i
        
        For i = 1 To p
            prod_req(i) = prod_req(i) - mul * plan(i)
        Next i
        raw_num(rawid) = raw_num(rawid) - mul
        
        patterns = patterns + 1
        remain = rawlen
        For i = 1 To p
            global_plan(patterns, i) = plan(i)
            remain = remain - prod_len(i) * plan(i)
        Next i
        If remain > longest_remain Then longest_remain = remain
        global_stat(patterns, 1) = mul
        global_stat(patterns, 2) = rawlen - cut_loss
        global_stat(patterns, 3) = remain
        usage = usage + rawlen * mul
        
        finish = is_no_prod_left()
        
    End If
Loop

Dim improved As Boolean, not_improved_count As Long
improved = False
not_improved_count = not_improved_count + 1
If best_usage > usage Then
    improved = True
    not_improved_count = 0
    best_usage = usage
    best_longest_remain = longest_remain
    best_plan = global_plan
    best_stat = global_stat
    best_patterns = patterns
ElseIf best_usage = usage Then
    If best_longest_remain < longest_remain Or best_patterns > patterns Then
        improved = True
        not_improved_count = 0
        best_longest_remain = longest_remain
        best_plan = global_plan
        best_stat = global_stat
        best_patterns = patterns
    End If
End If

If not_improved_count >= 15 Then
    Call gen_rand_seq
    ReDim prod_score(1 To p)
    '|fffd||fffd||fffd||fffd||fffd||fffd||272||fffd||1b7||fffd||1b7||fffd||228||fffd||fffd|
    Call gen_rand_score(rawlen)
Else
    Call adjust_prod_seq
End If

'DoEvents
Next search

'xianshishijian = xianshishijian + 1
'If xianshishijian = 2 Then
'Dim shichang As Double
'shichang = (Timer - t) * xunhuans ' * search_count
'lilunshijian = Int(shichang * 0.5)
'jieshushijian = DateAdd("s", lilunshijian, Now)
'With Sheet2
'.Shapes("TextBox 1").OLEFormat.Object.Characters.Text = "|fffd||fffd||234||fffd|" & lilunshijian & "|fffd||b8e1||524||fffd||1b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||3aa||fffd||fffd|" & Format$(jieshushijian, "Long Time")
'.Shapes("TextBox 1").Visible = msoTrue
'End With
'Application.ScreenUpdating = True
'Application.ScreenUpdating = False
'End If



With Application
yuanliaogengshu_h = .Sum(.Index(best_stat, , 1))
yuliao_h = .Max(.Index(best_stat, , 3))
    yuliao_weizhi = 1
    For yuliao_search = 1 To best_patterns
        If best_stat(yuliao_search, 3) = yuliao_h Then yuliao_weizhi = yuliao_search
    Next
yuliaogengshu_h = best_stat(yuliao_weizhi, 1)
End With


If yuanliaogengshu_h < yuanliaogengshu_q Then
Erase minxiqu
Erase zongshuqu
zhuiyou_hangshu = best_patterns
zhuiyou_lieshu = p

        For i = 1 To zhuiyou_hangshu
            minxiqu(i, 0) = 0
            For j = 1 To p
            minxiqu(i, j) = best_plan(i, j)
            minxiqu(i, 0) = minxiqu(i, 0) + best_plan(i, j)
            Next j
            
            For j = 1 To 3
            zongshuqu(i, j) = best_stat(i, j)
            Next j
            zongshuqu(i, 0) = (minxiqu(i, 0) - 1) * cut_loss
        Next i



Else

    If yuanliaogengshu_h = yuanliaogengshu_q And yuliao_h > yuliao_q Then
        Erase minxiqu
        Erase zongshuqu
        zhuiyou_hangshu = best_patterns
        zhuiyou_lieshu = p
        
        For i = 1 To zhuiyou_hangshu
            minxiqu(i, 0) = 0
            For j = 1 To p
            minxiqu(i, j) = best_plan(i, j)
            minxiqu(i, 0) = minxiqu(i, 0) + best_plan(i, j)
            Next j
            
            For j = 1 To 3
            zongshuqu(i, j) = best_stat(i, j)
            Next j
            zongshuqu(i, 0) = (minxiqu(i, 0) - 1) * cut_loss
        Next i
        
    Else
        
            If yuanliaogengshu_h = yuanliaogengshu_q And yuliao_h = yuliao_q And yuliaogengshu_h > yuliaogengshu_q Then
                Erase minxiqu
                Erase zongshuqu
                zhuiyou_hangshu = best_patterns
                zhuiyou_lieshu = p
                
                For i = 1 To zhuiyou_hangshu
                    minxiqu(i, 0) = 0
                    For j = 1 To p
                    minxiqu(i, j) = best_plan(i, j)
                    minxiqu(i, 0) = minxiqu(i, 0) + best_plan(i, j)
                    Next j
                    
                    For j = 1 To 3
                    zongshuqu(i, j) = best_stat(i, j)
                    Next j
                    zongshuqu(i, 0) = (minxiqu(i, 0) - 1) * cut_loss
                Next i
            End If
    End If
End If

With Application
yuanliaogengshu_q = .Sum(.Index(zongshuqu, , 1))
yuliao_q = .Max(.Index(zongshuqu, , 3))
    yuliao_weizhi = 1
    For yuliao_search = 1 To .Count(.Index(zongshuqu, , 1))
        If zongshuqu(yuliao_search, 3) = yuliao_q Then yuliao_weizhi = yuliao_search
    Next
yuliaogengshu_q = zongshuqu(yuliao_weizhi, 1)
End With



End Sub


Public Sub read_data()
Dim data2(), val, i As Long, j As Long
If cut_loss <= 0 Then cut_loss = 0
'val = 20000 '|52d||fffd||3ff||fffd||fffd||fffd||2b9||fffd||f5||138||fffd||fffd||fffd|


ReDim raw_len(1 To 1)
ReDim raw_num(1 To 1)
    raw_len(1) = yuanliao_Data + cut_loss
    raw_num(1) = 20000


data2 = arr_pei_all
n = UBound(arr_pei_all, 2)

ReDim prod_len(1 To n)
ReDim prod_req(1 To n)
ReDim prod_score(1 To n)
ReDim prod_seq(1 To n)

For j = 1 To n
    prod_len(j) = data2(1, j) + cut_loss
    prod_req(j) = data2(2, j)
    prod_seq(j) = j
Next

prod_len_sav = prod_len
prod_req_sav = prod_req
raw_len_sav = raw_len
raw_num_sav = raw_num
End Sub
Public Function get_raw() As Long
Dim i As Long, j As Long
For i = 1 To UBound(raw_num)
    If raw_num(i) > 0 Then
        get_raw = i
        Exit For
    End If
Next
End Function
Public Function is_no_prod_left() As Boolean
Dim i As Long, j As Long
is_no_prod_left = True
For i = 1 To UBound(prod_req)
    If prod_req(i) > 0 Then
        is_no_prod_left = False
        Exit For
    End If
Next
End Function

Public Sub gen_a_plan(plan, target_len As Long)
Dim list_len() As Long, list_id() As Long, choosen() As Long
Dim prd_id As Long, prd_len As Long, prd_req As Long
Dim max_num As Long, i As Long, j As Long, k As Long, p As Long

p = UBound(prod_len)
ReDim plan(1 To p)
For i = 1 To p
    prd_id = prod_seq(i)
    prd_req = prod_req(prd_id)
    prd_len = prod_len(prd_id)
    If prd_req > 0 And prd_len <= target_len Then
        firstid = prd_id
        firstlen = prd_len
        Exit For
    End If
Next i

For i = 1 To p
    prd_id = prod_seq(i)
    prd_len = prod_len(prd_id)
    prd_req = prod_req(prd_id)
    
    If prd_len <= target_len And prd_req > 0 Then
        max_num = target_len / prd_len
        If max_num > prd_req Then max_num = prd_req
        If prd_id = firstid Then max_num = max_num - 1
        
        For j = 1 To max_num
            k = k + 1
            ReDim Preserve list_len(1 To k)
            ReDim Preserve list_id(1 To k)
            list_len(k) = prd_len
            list_id(k) = prd_id
        Next j
        
    End If
Next i

If k > 0 Then
    ReDim choosen(1 To 1)
    Call solve_subsetsum(list_len(), list_id(), target_len - firstlen, choosen())
    
    If UBound(choosen) > 1 Then
        For i = 2 To UBound(choosen)
            prd_id = choosen(i)
            plan(prd_id) = plan(prd_id) + 1
        Next i
    End If
    If firstid <> 0 Then plan(firstid) = plan(firstid) + 1
Else
    If firstid <> 0 Then plan(firstid) = plan(firstid) + 1
End If
End Sub



Attribute VB_Name = "wvpcs"
Option Private Module

Public choushukaiguan
Public h1
Public arr_pei_all
Public Arrcs3 As Variant
Public chichun_s_z As Long
Public theTempArr1 As Variant, theTempArr2 As Variant
Public arr3()
Public h_arr
Public Result() As Variant
Public arr_huizong_y


Dim Arr() As Variant, d As Object, theMaxRow&, theCount&, theElementsCount&
Dim theTargetNum#, theMinus#, theRecordsCount&, theMinusYes As Boolean, theDuplicate As Boolean

Sub choushu()
    Dim theStr$, i&, j&, theFinalRow&
    Dim theValue As Variant, theDecimalPlaces&, theTimeStart!, wvtheRecursionTime!
    
    Application.EnableCancelKey = xlErrorHandler '|4bb||fffd||fffd||fffd||5b9||fffd||1ff||fffd||fffd||fffd||436||3f4||fffd||fffd||fffd||13c||fffd||fffd||fffd||fffd||fffd||463||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd|
                                        '|fffd||fffd||fffd||fffd||fffd||9cbb||4aa||221||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||53c||fffd||fffd||b7||fffd||fffd||fffd|On Error|fffd||fffd||fffd|
    On Error GoTo Err_Handler '|fffd||5b9||fffd||1ff||fffd||fffd||fffd||436||fffd||2b1||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5ea||fffd||fffd||fffd||fffd||fffd||fffd|
    
    theCount = -1 '|fffd||fffd||fffd||fffd||5b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd||fffd||fffd||fffd||fffd||373||fffd||1b5||779||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd|theCount|3f5||fffd||fffd||32c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||4aa|)
    theDuplicate = False '|fffd||fffd||fffd||fffd||5b5| (|fffd||fffd|theDuplicate|3f5||fffd||fffd||32c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||4aa|)|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd||fffd||fffd||fffd||fffd||fffd||fffd|Dictionary|fffd||274||fffd||fffd||fffd||fffd||fffd||fffd||676||fffd|
    theMinusYes = False '|fffd||fffd||fffd||fffd||5b5| (|fffd||fffd|theMinusYes|3f5||fffd||fffd||32c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||4aa|)
    theRecordsCount = 0 '|fffd||fffd||fffd||fffd||5b5| (|fffd||fffd|theRecordsCount|3f5||fffd||fffd||32c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||4aa|)
    theMinus = 0 '|fffd||fffd||fffd||fffd||5b5| (|fffd||fffd|theMinus|3f5||fffd||fffd||32c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||4aa|)
    
    theFinalRow = h1 + 1
    theElementsCount = theFinalRow - 1 '|fffd||fffd||fffd||fffd||fffd||52a||fffd||638||fffd||fffd||fffd|theElementsCount
    If theElementsCount < 2 Then
        'MsgBox "A|fffd||435||fffd|2|fffd||fffd||fffd||fffd||2bc||fffd||fffd||fffd||fffd||fffd||52a||fffd||fffd||fffd||fffd||fffd||fffd|2|fffd||fffd|!", vbCritical, "|fffd||fffd||fffd||fffd|"
        choushukaiguan = 0
        Exit Sub
    End If
   
   
        
        
        For i = 1 To theElementsCount '|fffd||fffd||46d||fffd||fffd||221||fffd||fffd||fffd||fffd||fffd||fffd||534||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||3bb|
            theValue = CDec(theTempArr1(i, 1))
            theStr = theValue - Int(theValue)
            If theDecimalPlaces < Len(theStr) - 1 Then theDecimalPlaces = Len(theStr) - 1 '|237||fffd||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||3bb||fffd||fffd|
        Next i
    
        theTargetNum = yuanliao_Data + cut_loss '|13f||fffd||fffd||5b5|
        theValue = CDec(theTargetNum)
        theStr = theValue - Int(theValue)
        If Len(theStr) - 1 <= theDecimalPlaces Then '|fffd||fffd||13f||fffd||fffd||5b5||fffd||fffd||421||fffd||fffd||3bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||38ec||fffd||fffd||fffd||fffd||5b1||fffd||fffd||fffd||2f3||fffd|
            theTargetNum = theTargetNum * 10 ^ theDecimalPlaces '|1ff||fffd||fffd||fffd||fffd||fffd||fffd|10^theDecimalPlaces|fffd||fffd|(|fffd||3bc||fffd||fffd||fffd||fffd||fffd|)
        Else
            GoTo Err_Handler
        End If


        
For i = 1 To UBound(theTempArr2) - 1 'theTempArr2|3aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
flag = 0
For j = UBound(theTempArr2) To i + 1 Step -1
If theTempArr2(j - 1, 1) > theTempArr2(j, 1) Then '>|3aa||fffd||fffd||fffd||fffd|<|3aa||fffd||fffd||fffd||fffd|
t1 = theTempArr2(j - 1, 1): theTempArr2(j - 1, 1) = theTempArr2(j, 1): theTempArr2(j, 1) = t1: flag = 1
End If
Next j
If flag = 0 Then Exit For
Next i
        
        
        
        ReDim Arr(1 To theElementsCount, 1 To 3)
        For i = 1 To theElementsCount
            Arr(i, 1) = theTempArr2(i, 1) '|fffd||fffd||534||fffd||fffd|
            '|1ff||fffd||1b7||174||fffd|10^theDecimalPlaces|fffd||fffd||fffd||4f6||fffd||fffd||fffd|4|3bb||fffd||fffd||fffd||fffd||421||fffd||fffd||3bb||fffd||fffd||52d||2bc||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||3bb||fffd||13b||fffd|)|5ea||fffd||fffd||3aa||fffd||fffd||fffd||fffd||421||fffd||fffd||fffd||fffd||fffd||fffd||5b5|
            Arr(i, 2) = Arr(i, 1) * 10 ^ theDecimalPlaces '|fffd||fffd||1f0||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||13e||fffd||fffd||1f1||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                                '|5ae||fffd||fffd||fffd||530||fffd||534||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||13f||fffd||fffd||fffd||1fe||fffd||fffd||fffd||fffd||fffd||fffd||2e21||fffd||fffd||fffd||fffd||e8ec||fffd||fffd||7fe||fffd||fffd||221||fffd||fffd||6be||fffd||fffd||fffd||4aa||fffd||fffd||7f5||133||fffd||fffd||3e3||fffd||fffd||fffd|
                                '|fffd||fffd||421||fffd||fffd||fffd||fffd||fffd||fffd||5b5||373||4bb||5ea||fffd||277||fffd||421||fffd||fffd||fffd||1f3||fffd||fffd||f5||13c||fffd||fffd||fffd||fffd||5b6||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||421||fffd||fffd||fffd||fffd||373||4bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5ba||3b7||fffd||fffd||fffd|)
            
            If Arr(i, 2) > 0 Then '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||6fc||fffd||fffd||fffd||5b5||fffd||fffd||4aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1bf||6a3||fffd||4aa||fffd||fffd||fffd||fffd|
                            '|fffd||fffd||fffd||fffd||fffd||fffd||135||131||fffd||fffd||2f5||fffd||fffd||fffd||fffd||f5||139||6f2||fffd||fffd||fffd||fffd||5b5||fffd||fffd|Debug.Print|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||53f||fffd||fffd||fffd|
                            '|fffd||67d||fffd||fffd||2b5||fffd||2b5||779||fffd||fffd||fffd||323||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                If i > 1 Then '|fffd||fffd||fffd||fffd||fffd||6fc||1ba||375||fffd||5b5||fffd||fffd||fffd||1f1||fffd||fffd||435||fffd||1f0||5b5||fffd||fffd||fffd||23d||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd|If|fffd||fffd||fffd||463||fffd||4e6||fffd||fa||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                    '|fffd||fffd||fffd||123||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1f0||fffd||fffd||fffd||47e||fffd||fffd||fffd||fffd||230||fffd||fffd||fffd||fffd||fffd||fffd||163||fffd||fffd||2b8||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1f0||fffd||68ec||fffd||fffd||fffd||fffd||1f0||fffd||fffd||fffd|If>0|fffd||fffd||48ec|
                    '|fffd||fffd||fffd||fffd||fffd||1f2||fffd||fffd||fffd||fffd||fffd||225||fffd||533||fffd||fffd||6fc||fffd||5b5||fffd||123||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||28ec||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fa||fffd||fffd||135||fffd|Debug.Print|fffd||fffd||48ec||fffd||fffd||fffd||b5||fffd|3|fffd||43e||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                    Arr(i, 3) = Arr(i - 1, 3) + Arr(i, 2) '|fffd||6fc||1b5||fffd|2|fffd||435||13a||363||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||6fc||fffd||5b5||fffd||4f1||fffd||fffd||fffd||5b5||fffd||fffd|
                    If Arr(i, 2) = Arr(i - 1, 2) Then theDuplicate = True
                Else
                    Arr(i, 3) = Arr(i, 2) '|fffd||fffd|1|fffd||fffd||2b1||fffd||fffd||fffd||6fc||1b5||13a||37e||fffd||fffd||1f5||fffd|2|fffd||431||fffd||fffd||435||fffd||5b5||fffd|
                End If
            Else
                If i > 1 Then
                    If Arr(i, 2) = Arr(i - 1, 2) Then theDuplicate = True
                End If
                theMinusYes = True '|fffd||fffd||4aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||6b8||fffd||fffd||fffd||2b1||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||133||fffd||fffd||fffd||fffd||13a||fffd||fffd||fffd||fffd||fffd||fffd||435||fffd||52a||fffd||623||fffd|
                            '|fffd||fffd||fffd||fffd||133||fffd||fffd||fffd||fffd||2bc||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||435||fffd||52a||fffd||635||fffd||5b5||fffd||636||fffd||fffd||fffd||421||fffd||6b5||fffd||1f0||fffd||435||fffd||52a||fffd||635||fffd||5b5||fffd||fffd|
                        '|fffd||2f1||fffd||5be||fffd||fffd||fffd||fffd||fffd||35f7c||fffd||fffd||675||779||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||e3||fffd||366||fffd||fffd||4aa||fffd||fffd||176|
                theMinus = theMinus - Arr(i, 2) '|fffd||fffd||fffd||435||3cbb||fffd||f2||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1f0||478||fffd||fffd||fffd||5b5||fffd||6fc||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||17f||270||478||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                        '|fffd||fffd|theMinus|fffd||fffd||5b5||fffd||fffd||fffd||2fc||fffd||fffd||fffd||fffd||fffd||fffd||fffd||6fc||fffd||fffd||fffd||fffd||e3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||6b8||fffd||fffd||fffd||fffd||13b||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4aa||176||fffd||fffd|
                        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||533||fffd||fffd||fffd||fffd||f5||123||fffd||fffd||2b8||f1||fffd||fffd||fffd||fffd||fffd||fffd||fffd||135||fffd||13f||fffd||fffd||5b5|theTargetNum|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||6bc||fffd||fffd||fffd||fffd||fffd||fffd||52a||fffd||fffd|
                        '|fffd||fffd||fffd||fffd||fffd||1f2||fffd||fffd||fffd||fffd||fffd||fffd||28ec||5bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||e23||fffd||fffd||fffd||fffd||4f4||fffd||126||fffd||fffd|
            End If
        Next i
        
        
        Erase theTempArr1 '|fffd||377||fffd||fffd||6b4||68ec||fffd||fffd||fffd||fffd||4aa|
        Erase theTempArr2 '|fffd||377||fffd||fffd||6b4||68ec||fffd||fffd||fffd||fffd||4aa|
    
    DoEvents 'Excel|fffd||fffd|A|fffd||432||fffd||fffd||1fc||fffd||fffd||fffd||fffd||fffd||fffd||5bb||5b8||fffd||fffd||fffd||fffd||f8ec||fffd||1fe||fffd||fffd||fffd|Excel|e6||fffd||fffd||fffd||e6||fffd||123||fffd||fffd||fffd||fffd||fffd||4aa|
    
    If theDuplicate Then Set d = CreateObject("Scripting.Dictionary") 'Dictionary|fffd||fffd||fffd||fffd||fb||276||fffd||fffd||2f5||fffd||123||fffd|
            '|221||fffd||fffd||3fd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||7870|+5+6-2+9|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b4||fffd|)|2b1||fffd||fffd||fffd||fffd||fffd||173||fffd||fffd||638||fffd||fffd||fffd||fffd||5b4||fffd|
    
    '|fffd||fffd||fffd||f4||fffd||17c||fffd||fffd||fffd||fffd||fffd||3fd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|Result
    theMaxRow = Rows.Count - 1 '|fffd||fffd||fffd||fffd||221||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2f2f||fffd||fffd||fffd||463||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||1f1||fffd||fffd||fffd||fffd||423||fffd||fffd||2bc||fffd|1)
    ReDim Result(1 To theMaxRow, 1 To 3) '|fffd||fffd|1|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3f5||fffd||52a||fffd||638||fffd||fffd||fffd||fffd||fffd||fffd||463||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd|
                                    '|fffd||fffd|2|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||379||fffd||2bd||fffd||fffd||fffd||fffd||5b1||fffd||fffd||fffd||fffd||5a4||fffd||fffd||fffd||fffd||fffd||fffd||463||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd|
                                    '|fffd||fffd|3|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||52a||fffd||fffd||fffd||fffd||3f5||131||fffd||fffd||fffd||2bd|
    
    
    theStr = ""
    
    theTimeStart = Timer '|fffd||fffd||2b1||fffd||fffd||fffd||463||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd||fffd||fffd||22b||fffd||fffd||225||fffd||fffd||fffd||fffd||fffd||fffd||23b||fffd||2e3||fffd||fffd||fffd||225||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||f4||2f1||fffd||fffd||fffd||fffd||fffd|MsgBox|fffd||fffd||fffd||fffd||fffd||4e6||4aa||fffd||7b8||fffd|
    
    Call wvtheRecursion(theTargetNum, theStr, theElementsCount, 1) '|fffd||fffd||fffd||fffd||779||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||423||fffd|1|3f5||52a||fffd||638||fffd||fffd||fffd||fffd||133||fffd||5b5|)
    
Err_Handler:
    If theTimeStart > 0 Then
        wvtheRecursionTime = Round(Timer - theTimeStart, 6) '|fffd||fffd||fffd||435||779||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd|
    End If
    If theCount > 0 Then theTimeStart = Timer 'csSheet1.Cells(4, 2) = "|fffd||779||fffd| " & Format(theCount, "#,##0") & " |fffd||fffd|"
    
    If theRecordsCount Then '|fffd||fffd||fffd||434||fffd||be64||fffd||fffd||fffd||fffd|
        If theRecordsCount > theMaxRow Then theRecordsCount = theMaxRow
        'Application.ScreenUpdating = False '|fffd||fffd||fffd||fffd||4aa|
        
    
    Else
        'MsgBox IIf(Err = 18, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||436||3e3||fffd|", IIf(Err <> 0, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "")) & "|fffd||7bd||fffd|", vbInformation, "|fffd||fffd||3e2|"
        choushukaiguan = 0
    End If
    
    Application.EnableCancelKey = xlInterrupt '|fffd||5b8||fffd||12c||fffd||fffd||5b5||fffd||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd||fffd||fffd||fffd||636||fffd||fffd||fffd|
    Set d = Nothing
End Sub

Sub wvtheRecursion(theTargetSummary#, theStr$, theElementEnd&, theElementsCombinCount&)
    Dim i&, j&, theTempStr$
    theCount = theCount + 1 '|373||fffd||1b5||779||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
    If theCount > 100000 Then
    choushukaiguan = 0
    Exit Sub
    End If
    For i = 1 To theElementEnd '|fffd||fffd||52a||fffd||fffd||3bb||fffd||f4||fffd||421||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1f7||fffd||fffd||fffd||fffd||f4||fffd||fffd||fffd||4bb||52a||fffd||635||fffd||5b5||fffd||bd71||1f0||fffd||fffd||13f||fffd||fffd||5b5|theTargetSummary|fffd||1fa||fffd|
        If Round(Arr(i, 2) - theTargetSummary, 0) = 0 Then '|fffd||fffd||fffd||fffd||1f0||52a||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||13f||fffd||fffd||5b5||fffd||1fa||3e3||fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||4bb||fffd||fffd||fffd||fffd||3f1||fffd||fffd||fffd||2bd|
                                            'Round()|fffd||fffd||fffd||fffd||fffd||fffd||fffd||6bd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            theTempStr = theStr & IIf(Arr(i, 2) < 0, "", "+") & Arr(i, 1) '|fffd||fffd||fffd||235||fffd||fffd||fffd||fffd||52a||fffd||63c||fffd||fffd||3f5||fffd||1f0||fffd||4b5||fffd||fffd||fffd||52a||fffd||639||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3f5||fffd||fffd||5b7||fffd||fffd||fffd|
            
            If theDuplicate Then '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd||fffd||fffd||fffd||fffd||5bb||fffd||fd||fffd||fffd||fffd|Dictionary|fffd||436||fffd|
                If Not d.Exists(theTempStr) Then '|fffd||fffd||fffd||f1||fffd||fffd||fffd||2bd||3b4||fffd||fffd||fffd||439||fffd|
                    d(theTempStr) = "" '|fffd||fffd||fffd||4f8||f1||fffd||fffd||fffd||2bd||fffd||fffd||fffd||531||fffd||fffd||bb||fffd||fffd||436||fffd||fffd||fffd||36c||fffd||131||fffd||fffd||fffd||2bd||fffd||4f6||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||fffd||131||fffd||fffd||fffd||2bd|
                    theRecordsCount = theRecordsCount + 1 '|fffd||fffd||bc||fffd||fffd||fffd||fffd||fffd||fffd|
                    
                    If theRecordsCount > 1 Then Exit For  '|fffd||fffd||fffd||fffd||fffd|
                    
                    If theRecordsCount < theMaxRow Then '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||f5||fffd||1ff||fffd||fffd||fffd||436||3f5||779||fffd||fffd||fffd||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||463||fffd|
                                            '|fffd||fffd||fffd|theRecordsCount|fffd||fffd||fffd||fffd|theMaxRow|fffd||fffd||fffd||fffd||fffd||fffd||221||fffd||fffd||3fc||fffd|(|fffd||fffd||3aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||7b7||fffd||fffd||fffd||fffd||fffd|)|fffd||fffd||fffd||fffd||23b||fffd||2e3||fffd|
                                            '|fffd||fffd||538||fffd||28ec||fffd||fffd||27c||fffd||fffd||fffd||221||fffd||fffd||3e3||fffd||fffd||fffd||fffd||fffd||23b||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd||fffd||fffd||fffd||fffd||2e3||fffd||1f0||fffd||fffd||fffd||fffd||fffd||fffd||fffd||335||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd||fffd||7b8||fffd|
                        If Left(theTempStr, 1) = "+" Then theTempStr = Mid$(theTempStr, 2) '|225||fffd||fffd||fffd||fffd||1f0||fffd||fffd||121||fffd|+|fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||6b5||13b||fffd|)
                        If (UBound(Split(theTempStr, "+"))) > 2 Then choushukaiguan = 0: Exit Sub   '|fffd||fffd||fffd||fffd||fffd|
                        Result(theRecordsCount, 1) = theElementsCombinCount '|fffd||fffd||fffd||fffd||fffd||52a||fffd||638||fffd||fffd||fffd|
                        Result(theRecordsCount, 2) = "=" & theTempStr '|fffd||fffd||fffd||fffd||1f0||5fa||fffd||fffd|=|fffd||fffd||fffd||fffd||fffd||539||fffd||2bd||fffd||fffd||2bd||fffd||fffd||fffd||fffd||fffd||2bd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4aa|
                        Result(theRecordsCount, 3) = theTempStr '|fffd||fffd||3fd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2bd|
'                    Else
'                        Exit Sub '|fffd||2f3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||463||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||45c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3fc||fffd||fffd||fffd||1ff||fffd||fffd||fffd||2f3||fffd|
                    End If
                End If
            Else '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd||fffd||fffd||fffd||fffd||5b1||fffd||fffd||5f7||fffd||4fc||fffd||bc|
                theRecordsCount = theRecordsCount + 1 '|fffd||fffd||bc||fffd||fffd||fffd||fffd||fffd||fffd|
                
                If theRecordsCount > 1 Then Exit For  '|fffd||fffd||fffd||fffd||fffd|

                If theRecordsCount < theMaxRow Then '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||f5||fffd||1ff||fffd||fffd||fffd||436||3f5||779||fffd||fffd||fffd||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||463||fffd|
                                        '|fffd||fffd||fffd|theRecordsCount|fffd||fffd||fffd||fffd|theMaxRow|fffd||fffd||fffd||fffd||fffd||fffd||221||fffd||fffd||3fc||fffd|(|fffd||fffd||3aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||7b7||fffd||fffd||fffd||fffd||fffd|)|fffd||fffd||fffd||fffd||23b||fffd||2e3||fffd|
                                        '|fffd||fffd||538||fffd||28ec||fffd||fffd||27c||fffd||fffd||fffd||221||fffd||fffd||3e3||fffd||fffd||fffd||fffd||fffd||23b||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||434||fffd||fffd||fffd||fffd||fffd||2e3||fffd||1f0||fffd||fffd||fffd||fffd||fffd||fffd||fffd||335||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd||fffd||7b8||fffd|
                    If Left(theTempStr, 1) = "+" Then theTempStr = Mid$(theTempStr, 2) '|225||fffd||fffd||fffd||fffd||1f0||fffd||fffd||121||fffd|+|fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||6b5||13b||fffd|)
                    If (UBound(Split(theTempStr, "+"))) > 2 Then choushukaiguan = 0: Exit Sub   '|fffd||fffd||fffd||fffd||fffd|
                    Result(theRecordsCount, 1) = theElementsCombinCount '|fffd||fffd||fffd||fffd||fffd||52a||fffd||638||fffd||fffd||fffd|
                    Result(theRecordsCount, 2) = "=" & theTempStr '|fffd||fffd||fffd||fffd||1f0||5fa||fffd||fffd|=|fffd||fffd||fffd||fffd||fffd||539||fffd||2bd||fffd||fffd||2bd||fffd||fffd||fffd||fffd||fffd||2bd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4aa|
                    Result(theRecordsCount, 3) = theTempStr '|fffd||fffd||3fd||fffd||fffd||fffd||fffd||fffd||5b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2bd|
'                Else
'                    Exit Sub '|fffd||2f3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4bb||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||463||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||45c||fffd||fffd||fffd||fffd||fffd||fffd||fffd||a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3fc||fffd||fffd||fffd||1ff||fffd||fffd||fffd||2f3||fffd|
                End If
            End If
            If Not theMinusYes Then '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||6b8||fffd||fffd||fffd||fffd||fffd||fffd||372||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||533||58ec||fffd||fffd||fffd||fffd||fffd||135||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd|
                            '|fffd||fffd||22b||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2bc||fffd||13a||fffd||fffd||fffd||fffd||fffd||fffd||435||134||fffd||fffd||fffd||5b5||52a||fffd||fffd|
                theElementEnd = i - 1 '|fffd||fffd||fffd||6d71||1f0||fffd||573||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1fa||fffd||13f||fffd||fffd||5b5||fffd||138||fffd||52a||fffd||635||fffd||fffd||fffd||4bb||fffd||fffd||fffd||43a||163||fffd|
                            '|fffd||531||fffd||fffd||fffd||131||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||52a||fffd||fffd|(|fffd||fffd||fffd||421||fffd||fffd||5b5||fffd||fffd||52a||fffd||fffd|)|2b1||fffd||fffd||fffd||534||4f8||fffd||fffd||43f||fffd||2bc||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                Exit For '|fffd||4b5||fffd||fffd||2f4||573||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|theTargetSummery|fffd||1fa||3f5||fffd||52a||fffd||623||fffd||fffd||2f3||fffd||fffd||fffd||fffd||fffd||23b||fffd||2e3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd||fffd||fffd||52a||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd||52a||fffd||635||13b||fffd|)
            End If
        End If
    Next i
    
    '|fffd||fffd||fffd||b4||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||3e3||fffd||fffd||fffd||fffd||635||fffd||fffd||fffd||fffd|(|fffd||fffd||23b||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|For|fffd||1e79||4b2||fffd||fffd||fffd||fffd||4aa|)
    For j = theElementEnd To 2 Step -1 '|fffd||fffd|theRowElementFound|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|theRowElementFound|fffd||fffd||fffd||423||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1f0||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b5|)
        If Round(Arr(j, 2) - theTargetSummary - theMinus, 0) <= 0 Then '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||1f0||fffd||fffd|1|fffd||fffd||52a||fffd||63e||371||232||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b5| theTargetSummary+theMinus |fffd||fffd||4aa||fffd||fffd||fffd||f4||fffd|
                                            '|fffd||fffd||fffd||431||fffd||4aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4b9||fffd||fffd||fffd||1a5||fffd||fffd||fffd||fffd||3f5||fffd||52a||fffd||fffd||fffd||fffd||fffd||fffd||23b||fffd||fffd||4aa||fffd||fffd|!
                                            
            If Round(Arr(j, 3) - theTargetSummary, 0) < 0 Then '|fffd||fffd||fffd||fffd||fffd||1f0||fffd||435||fffd||fffd||6fc||1ba||375||fffd||5b5||fffd||fffd||13f||fffd||fffd||5b5||421|(|fffd||fffd||fffd||fffd||fffd||3f8||fffd||fffd||fffd||fffd||fffd||fffd||378||fffd||421||fffd||132||fffd||fffd||fffd||fffd||2e3||fffd||fffd||3fb||fffd||fffd||fffd|)|fffd||fffd|
                                        '|fffd||fffd||f4||fffd||fffd||fffd||532||fffd||fffd||fffd||fffd||fffd||fffd||4b5||fffd||fffd||fffd||fffd||fffd||fffd||52a||fffd||fffd||fffd||fffd||3f4||573||fffd||13f||fffd||fffd||5b5||fffd||fffd||fffd||fffd||fffd||fffd||52a||fffd||fffd||fffd||fffd|
                Exit For
            Else
                Call wvtheRecursion(theTargetSummary - Arr(j, 2), theStr & IIf(Arr(j, 2) < 0, "", "+") & Arr(j, 1), j - 1, theElementsCombinCount + 1) '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||779||fffd|
            End If
        End If
    Next j

End Sub




Sub fuzhishuju()
With Sheet2
arrduans = .Range("B2").Resize(2, 234)
chichun_s_z = Application.Count(Application.Index(arrduans, 1))
arr_pei_all = .Range("B2").Resize(2, chichun_s_z)


choushukaiguan = 1
End With
End Sub

Sub peiqie()

h1 = 0
h1 = Application.Sum(Application.Index(arr_pei_all, 2))
h2 = 0
ReDim Arrcs3(0 To h1, 1 To 1)
ReDim theTempArr1(1 To h1, 1 To 1)
ReDim theTempArr2(1 To h1, 1 To 1)
For i = 1 To chichun_s_z '|fffd||fffd||5b5||fffd||fffd||fffd||fffd||fffd||fffd||579||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||435||fffd||fffd||fffd|
    For j = 1 To val(arr_pei_all(2, i))
    h2 = h2 + 1
    'Arrcs3(h2, 1) = arr_pei_all(1, i) + dkkd
    theTempArr1(h2, 1) = arr_pei_all(1, i) + cut_loss
    theTempArr2(h2, 1) = arr_pei_all(1, i) + cut_loss
    Next j
Next i



Call choushu

If choushukaiguan = 0 Then
Exit Sub
End If

On Error Resume Next
Dim dic1
Set dic1 = CreateObject("Scripting.Dictionary")

Dim Arrcs1_1()
minxi_shu = UBound(Split(Result(1, 3), "+")) + 1 '|fffd||fffd||fffd||fffd||fffd||fffd||bd||fffd||3aa|0|fffd||fffd||fffd||fffd||fffd||531||fffd||fffd||fffd|+1
If val(minxi_shu) = 0 Or val(minxi_shu) > 3 Then choushukaiguan = 0: Exit Sub

ReDim Arrcs1_1(1 To minxi_shu, 1 To 2) '|fffd||7f4||fffd||fffd||fffd||3f8|

For i = 1 To minxi_shu
Arrcs1_1(i, 1) = Split(Result(1, 3), "+")(i - 1) * 1 - cut_loss '|fffd||fffd||fffd||fffd||f5||133||7f4||fffd||22b||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||98ec||fffd||fffd||fffd||fffd||fffd||fffd||fffd||638||fffd|
Arrcs1_1(i, 2) = 1 '|ff||fffd||3bc||fffd||3aa||4bb||fffd||fffd|
dic1.Add (Arrcs1_1(i, 1)), ""   '|2b9||fffd||fffd||fffd||5b5||fffd||373||fffd||fffd||fffd||43c||fffd||fffd||fffd||fffd||7f4||fffd|
Next i


zongchichun_shu = dic1.Count '|fffd||f5||fffd||fffd||fffd||fffd||435||139||fffd||fffd||fffd||fffd|
Dim Arrcs1_2()
ReDim Arrcs1_2(1 To zongchichun_shu, 1 To 5) '|225||fffd||fffd||fffd||638||fffd||fffd||fffd||133||7f4||fffd|
                    
    For jj = 1 To zongchichun_shu
    Arrcs1_2(jj, 1) = dic1.keys()(jj - 1) * 1 '|ff||4bb||fffd||7f4||fffd|
    
            For i = 1 To minxi_shu
            If Arrcs1_1(i, 1) = Arrcs1_2(jj, 1) Then
            Arrcs1_2(jj, 2) = Arrcs1_2(jj, 2) + Arrcs1_1(i, 2) '|fffd||f5||fffd||ff||fffd||fffd||fffd||fffd||fffd||fffd||fffd||535||13a||fffd||fffd||fffd|
            End If
            Next i
            
            For i = 1 To UBound(arr_pei_all, 2)
            If arr_pei_all(1, i) = Arrcs1_2(jj, 1) Then
            Arrcs1_2(jj, 5) = i * 1 '|fffd||f5||fffd||3bb||fffd||fffd||fffd||fffd|
            Arrcs1_2(jj, 3) = arr_pei_all(2, i) '|fffd||f5||fffd||ff||fffd||fffd||fffd||fffd||fffd||fffd||fffd||535||fffd||fffd||fffd||fffd||fffd|
            Arrcs1_2(jj, 4) = Int(Arrcs1_2(jj, 3) / Arrcs1_2(jj, 2)) '|fffd||f5||fffd||fffd||fffd||fffd||fffd||fffd||435||131||fffd||fffd||fffd|
            End If
            Next i
   
    Next jj
   
Set dic1 = Nothing

With Application
    m = .Min(.Index(Arrcs1_2, , 4)) '|fffd||fffd||421||fffd||fffd||fffd||fffd|
For i = 1 To zongchichun_shu
Arrcs1_2(i, 4) = m
Next i


    For i = 1 To 10000
        If Len(arr3(i, 1)) = 0 Then
        h_arr = i
        arr3(i, -4) = yuanliao_Data
        arr3(i, -3) = m
        arr3(i, 200) = minxi_shu '|fffd||fffd||fffd||fffd|
        arr3(i, -1) = (minxi_shu - 1) * cut_loss '|fffd||fffd||fffd||5b5|
        arr3(i, 0) = .Sum(.Index(Arrcs1_1, , 1)) '|fffd||fffd||fffd||fffd||5b5|
        arr3(i, -2) = yuanliao_Data - arr3(i, 0) - arr3(i, -1) '|fffd||fffd||fffd||fffd||5b5|
            For j = 1 To minxi_shu
           
            arr3(i, j) = Arrcs1_1(j, 1)
            Next j
        Exit For
        End If
    Next i



For i = 1 To zongchichun_shu
arr_pei_all(2, Arrcs1_2(i, 5)) = arr_pei_all(2, Arrcs1_2(i, 5)) - Arrcs1_2(i, 2) * Arrcs1_2(i, 4) '|fffd||6f3||fffd||fffd||fffd||fffd||47e||fffd||2b9||fffd||f5||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Next


For i = 1 To chichun_s_z - 1
flag = 0
For j = chichun_s_z To i + 1 Step -1
If arr_pei_all(2, j - 1) < arr_pei_all(2, j) Then '>|3aa||fffd||fffd||fffd||fffd|<|3aa||fffd||fffd||fffd||fffd|
t1 = arr_pei_all(1, j - 1): arr_pei_all(1, j - 1) = arr_pei_all(1, j): arr_pei_all(1, j) = t1: flag = 1
t2 = arr_pei_all(2, j - 1): arr_pei_all(2, j - 1) = arr_pei_all(2, j): arr_pei_all(2, j) = t2
End If
Next j
If flag = 0 Then Exit For
Next i

lingshi = 0
For i = 1 To chichun_s_z
If arr_pei_all(2, i) = 0 Then
lingshi = lingshi + 1
arr_pei_all(1, i) = ""
arr_pei_all(2, i) = ""
End If
Next i

chichun_s_z = chichun_s_z - lingshi
ReDim Preserve arr_pei_all(1 To 2, 1 To chichun_s_z)
End With

End Sub


Sub wv_choushu()
'Application.ScreenUpdating = False
'Call fuzhishuju

With Sheet2
arrduans = .Range("B2").Resize(2, 234)
chichun_s_z = Application.Count(Application.Index(arrduans, 1))
arr_pei_all = .Range("B2").Resize(2, chichun_s_z)

yuanliao_s = .Cells(7, 200).End(1).Column - 1
ARR_YUAN = .Range("B7").Resize(1, yuanliao_s)
cut_loss = val(.Range("B9")) '|fffd||43f||6bf||fffd||fffd||fffd|

choushukaiguan = 1
End With






'MsgBox arr_yuan(1, 1).Type


For ii = 1 To yuanliao_s
    If yuanliao_s = 1 Then
    yuanliao_Data = val(ARR_YUAN) '|52d||fffd||3f3||fffd||fffd||fffd|
    Else
    yuanliao_Data = val(ARR_YUAN(1, ii)) '|52d||fffd||3f3||fffd||fffd||fffd|
    End If
    
    For i = 1 To 10
    If choushukaiguan = 1 Then
    Call peiqie
    End If
    Next

    For i = 1 To chichun_s_z - 1
    flag = 0
    For j = chichun_s_z To i + 1 Step -1
    If arr_pei_all(1, j - 1) < arr_pei_all(1, j) Then '>|3aa||fffd||fffd||fffd||fffd|<|3aa||fffd||fffd||fffd||fffd|
    t1 = arr_pei_all(1, j - 1): arr_pei_all(1, j - 1) = arr_pei_all(1, j): arr_pei_all(1, j) = t1: flag = 1
    t2 = arr_pei_all(2, j - 1): arr_pei_all(2, j - 1) = arr_pei_all(2, j): arr_pei_all(2, j) = t2
    End If
    Next j
    If flag = 0 Then Exit For
    Next i

'Sheet2.Cells(12, 5).Resize(10000, 100) = arr3

'MsgBox UBound(arr_pei_all, 2)
Sheet2.Range("B2").Resize(2, 200) = ""
Sheet2.Range("B2").Resize(2, chichun_s_z) = arr_pei_all




'Application.ScreenUpdating = True
Next ii









End Sub

Attribute VB_Name = "wvpp"
Option Private Module

Sub wv_huizong()
On Error Resume Next

With Sheet2
arr0 = .Cells(2, 2).Resize(2, 234)
g = Application.Count(Application.Index(arr0, 1))

arr0_y = .Cells(7, 2).Resize(1, 234)
g_y = Application.Count(arr0_y)
yuanliao_Data = .Cells(7, 2).Value ' arr_yuang(1, 1) '|52d||fffd||3f3||fffd|
cut_loss = .Cells(9, 2).Value  '|fffd||43f||6bf||fffd||fffd||fffd|
yuanliao_Data_max = Application.Max(arr0_y)


l2 = .Cells(2, Columns.Count).End(xlToLeft).Column - 1
        For i = 1 To l2
        zhi1 = arr0(1, i)
        zhi2 = arr0(2, i)
        
            If Not IsNumeric(zhi) Or zhi1 = 0 Or Not IsNumeric(zhi2) Or zhi2 = 0 Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||772||fffd||fffd||27f||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b9||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5a3||fffd||fffd||fffd||4aa||fffd||13f||fffd||fffd||1ff||fffd||fffd||532||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5b0||fffd||fffd||fffd|"
            End
            Else
            
            If zhi1 > val(yuanliao_Data_max) Or zhi1 < 0.01 Then
            MsgBox "|fffd||fffd||1b7||fffd||fffd||fffd||232||fffd||fffd||fffd||fffd||734||fffd||fffd||fffd||52d||fffd||3f3||fffd||fffd||223||fffd||fffd||fffd||fffd||fffd||52d||fffd||3f3||fffd||fffd||fffd||5b5||fffd||fffd||fffd||fffd||fffd||fffd||fffd||5a3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2c21||fffd||fffd|"
            End
            End If
            End If
        Next

Dim dic
Set dic = CreateObject("Scripting.Dictionary")
        For i = 1 To g
        If Len(arr0(1, i)) > 0 Then dic.Add (arr0(1, i)), ""
        Next
        n = dic.Count
        ReDim arr_huizong(1 To 2, 1 To n)
        For j = 1 To n
        arr_huizong(1, j) = dic.keys()(j - 1)
        
                For i = 1 To g
                If arr_huizong(1, j) = arr0(1, i) Then
                arr_huizong(2, j) = arr_huizong(2, j) + arr0(2, i)
                End If
                Next
        Next
Set dic = Nothing

        For i = 1 To n - 1
        flag = 0
        For j = n To i + 1 Step -1
        If arr_huizong(1, j - 1) < arr_huizong(1, j) Then '>|3aa||fffd||fffd||fffd||fffd|<|3aa||fffd||fffd||fffd||fffd|
        t1 = arr_huizong(1, j - 1): arr_huizong(1, j - 1) = arr_huizong(1, j): arr_huizong(1, j) = t1: flag = 1
        t2 = arr_huizong(2, j - 1): arr_huizong(2, j - 1) = arr_huizong(2, j): arr_huizong(2, j) = t2
        End If
        Next j
        If flag = 0 Then Exit For
        Next i


'Dim arr_huizong_y
Dim dic_y
Set dic_y = CreateObject("Scripting.Dictionary")
        For i = 1 To g_y
        If Len(arr0_y(1, i)) > 0 Then dic_y.Add (arr0_y(1, i)), ""
        Next
        n = dic_y.Count
        ReDim arr_huizong_y(1 To 2, 1 To n)
        For j = 1 To n
        arr_huizong_y(1, j) = dic_y.keys()(j - 1)
        
        Next
Set dic_y = Nothing

        For i = 1 To n - 1
        flag = 0
        For j = n To i + 1 Step -1
        If arr_huizong_y(1, j - 1) > arr_huizong_y(1, j) Then '>|3aa||fffd||fffd||fffd||fffd|<|3aa||fffd||fffd||fffd||fffd|
        t1 = arr_huizong_y(1, j - 1): arr_huizong_y(1, j - 1) = arr_huizong_y(1, j): arr_huizong_y(1, j) = t1: flag = 1
        End If
        Next j
        If flag = 0 Then Exit For
        Next i


.Unprotect
.Cells(2, 2).Resize(2, 234) = ""
.Cells(2, 2).Resize(2, 234).NumberFormat = "0_ "
.Cells(2, 2).Resize(2, UBound(arr_huizong, 2)) = arr_huizong

.Cells(7, 2).Resize(2, 234) = ""
.Cells(7, 2).Resize(2, 234).NumberFormat = "0_ "
.Cells(7, 2).Resize(2, UBound(arr_huizong_y, 2)) = arr_huizong_y



.Rows("17:1000").Clear
End With
End Sub

Sub wv_danshuan()
With Sheet2
xunhuans = 5 '.Cells(5, 9)

    With Application
    lilunshijian = 2 + Int(.Count(.Index(arr_huizong, 2)) * .Sum(.Index(arr_huizong, 2)) * 0.004 * xunhuans / 4)
    End With
    jieshushijian = DateAdd("s", lilunshijian, Now)


.Shapes("TextBox 1").OLEFormat.Object.Characters.Text = "|524||fffd||1b5||234||fffd|" & lilunshijian & "|fffd||b8e1||524||fffd||1b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||3aa||fffd||fffd|" & Format$(jieshushijian, "Long Time")
.Shapes("TextBox 1").Visible = msoTrue
Application.ScreenUpdating = True
Application.ScreenUpdating = False
End With



Call wv_choushu

yuanliaogengshu_q = 100000 '|fffd||6efb||52d||2bc||fffd||fffd||fffd||fffd|
tihuangshu = 0


For c = 1 To xunhuans
Call rand_solves
Next

hs = zhuiyou_hangshu
ls = zhuiyou_lieshu

arr1_s = arr_pei_all
    
    For i = 1 To 10000
        If Len(arr3(i, 1)) = 0 Then
        h_arr = i
        Exit For
        End If
    Next i
    
   For i = h_arr To h_arr + hs - 1
        g = 0
        For j = 1 To ls
        If minxiqu(i - h_arr + 1, j) > 0 Then
            For x = 1 To minxiqu(i - h_arr + 1, j)
            g = g + 1
            arr3(i, g) = arr1_s(1, j)
            'MsgBox arr3(i, g)
            Next x
        End If
        Next j
    arr3(i, 200) = g '|fffd||fffd||fffd||fffd|
    arr3(i, -4) = zongshuqu(i - h_arr + 1, 2) '|52d||fffd||3f3||fffd|
    arr3(i, -3) = zongshuqu(i - h_arr + 1, 1) '|fffd||438||fffd||fffd||fffd||fffd||fffd|
    arr3(i, -2) = zongshuqu(i - h_arr + 1, 3) '|fffd||fffd||fffd||3f3||fffd||fffd||fffd|
    arr3(i, -1) = zongshuqu(i - h_arr + 1, 0) '|fffd||43f||fffd||fffd||fffd||fffd|
    arr3(i, 0) = arr3(i, -4) - arr3(i, -2) - arr3(i, -1) '|fffd||fffd||fffd||3f3||fffd||fffd||fffd|
    
   Next i
   

End Sub
Attribute VB_Name = "wvppp"
Option Private Module

Sub wv_duoyL()
Application.ScreenUpdating = False

With Sheet2
g_y = .Cells(7, Columns.Count).End(xlToLeft).Column - 1

    With Application
    lilunshijian = 2 + Int(.Count(.Index(arr_huizong, 2)) * .Sum(.Index(arr_huizong, 2)) * 0.004 * g_y / 4)
    End With
    jieshushijian = DateAdd("s", lilunshijian, Now)


.Shapes("TextBox 1").OLEFormat.Object.Characters.Text = "|524||fffd||1b5||234||fffd|" & lilunshijian & "|fffd||b8e1||524||fffd||1b7||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2b1||fffd||fffd||3aa||fffd||fffd|" & Format$(jieshushijian, "Long Time")
.Shapes("TextBox 1").Visible = msoTrue
Application.ScreenUpdating = True
Application.ScreenUpdating = False
End With

    Dim ar, a&(), br, br1, br2, b(), bb, c&(), d(), dic, tr
    Dim i&, i0&, i1&, i2&, ii&, j&, k&, k1&, l&, l1&, m&, m1&, m2&, n&, n1&, n2&, cnt&, cnt1&, cnt2&
    Dim r&, r1&, r2&, s@, s1@, s2@, ss@, t&, t1&, u@, u1@, v@, v0@, v1@, v2@, w$, w1$, ww$, x#, tms#
    
    tms = Timer '|fffd||fffd||2b1||fffd||fffd||2bc|
    Call wv_choushu
    
    n = [b2].End(2).Column - 1 '|52a||fffd||635||138||fffd||fffd||fffd|
    m1 = Application.Sum([B3].Resize(1, n)) 'Need Total Qty
    u = Application.Max([b2].Resize(1, n)) 'Max Value
    u1 = Application.Min([b2].Resize(1, n)) 'Min Value
    l1 = Round(Log(n) * 10, 0): If l1 < 20 Then l1 = 20 'Rand Test Count
    n1 = 100 'precision of difference
    cnt = Int(n1 / 3) + 1 'Total Test Count
    
    arr_yan = [B7].Resize(1, [B7].End(2).Column - 1)
            For i = 1 To UBound(arr_yan, 2) - 1 'arr_yan|3aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            flag = 0
                For j = UBound(arr_yan, 2) To i + 1 Step -1
                If arr_yan(1, j - 1) > arr_yan(1, j) Then '>|3aa||fffd||fffd||fffd||fffd|<|3aa||fffd||fffd||fffd||fffd|
                t1 = arr_yan(1, j - 1): arr_yan(1, j - 1) = arr_yan(1, j): arr_yan(1, j) = t1: flag = 1
                End If
                Next j
            If flag = 0 Then Exit For
            Next i
            
      [B7].Resize(1, [B7].End(2).Column - 1) = arr_yan
      
    br = Application.Transpose([A7].Resize(2, [A7].End(2).Column))
    
    v = Application.Max(br): If v < u Then MsgBox "Max Spec Value < Max Value": Exit Sub '|fffd||fffd||fffd||52d||fffd||3f5||133||7f4||fffd||fcbb||fffd||fffd||fffd||fffd||1b7||fffd||fffd||fffd||2f3||fffd|
    v0 = 0 ' Val([g2]): '|fffd||5f6||fffd||fffd||fffd||2a7||5b5|
    v1 = val([B9]): v = v + v1 '|fffd||43f||fffd||fffd||fffd||fffd|
    v2 = 0 'Val([g13]): '|fffd||fffd||fffd||fffd||fffd||5bb||fffd||fffd||f5||fffd||fffd||fffd||4bb||fffd||3bc||fffd||fffd||fffd||fffd||5b5|
    
    s = WorksheetFunction.SumProduct([b2].Resize(1, n), [B3].Resize(1, n)) '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||4aa||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    n2 = Int((s - 1) / v) + 1: If n2 * v < s Then n2 = n2 + 1 'Good Plan
    'Dim br1
    'ReDim br1(1 To UBound(br), 1 To 4)
    'br1 = [d15].Resize(UBound(br), 4) 'Standard Value Array'|fffd||47e||fffd||fffd||fffd||fffd||fffd||fffd||fffd||2f5||fffd||52d||fffd||3e3||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||423||fffd|
    
    br1 = br
    ReDim Preserve br1(1 To UBound(br, 1), 1 To 4)
    For i = 2 To UBound(br, 1)
    br1(i, 2) = Int(s / (br1(i, 1) - v0) * 2) 'or =m1
    Next
    
    
    ss = u * m1 * 2: If ss < v * 2 Then ss = v * 2.2 'sum total record
    ii = m1 'i total record
    
    Application.EnableCancelKey = xlErrorHandler
    'On Error GoTo Err_Handler
    
    Set dic = CreateObject("Scripting.Dictionary") 'Uniqe Plan Record
    For n1 = n1 To 1 Step -3
        ar = [b1].Resize(4, n) 'Value/Qty Data'|fffd||fffd||1b7||fffd||7f4||fffd|
        
        k = 0: m = m1 'Need Total Qty
        ReDim a&(1 To m) 'Rand Index Record
        ReDim b(-1 To m, -3 To n) 'Output Record
        For j = 1 To n 'Process Data
            b(-1, j) = ar(2, j)
            u = ar(2, j): l = ar(3, j): ar(4, j) = u + v1 ': s = s + u * l 'Total Sum
            For l = 1 To l
                k = k + 1: a(k) = j 'Get Index
            Next
        Next
        
        For i = 1 To m1 'Get Answer until Get One Plan (s2=s remain=0)
            dic.RemoveAll
            r1 = Int(br(2, 1) * n1 / u1) 'temp max r1
            For i0 = 2 To UBound(br) 'Search all spec by origin sort
                i2 = 1 'spec no bal cnt
                For i1 = 2 To UBound(br1)
                    If br1(i1, 2) = 0 Then i2 = i2 + 1 Else If br(i0, 1) = br1(i1, 1) Then Exit For 'If has Bal
                Next
                
                If i1 <= UBound(br1) Then 'i1 has Bal
                    v = br1(i1, 1) - v0 + v1 '-FirstLoss+CutLoss
                    For l = 0 To l1 '[g10] Rnd times
                        ReDim c&(1 To m): m2 = m 'origin remain cnt
                        Do
                            k1 = k1 + 1 'rnd cnt: All Rnd Do test Cnt
                            ReDim d(n): u = v
                            For k = 1 To m 'Get One Answer
                                If c(k) = 0 Then
                                    j = a(k) 'Item Index
                                    If ar(4, j) > v Then
                                        c(k) = 1: m2 = m2 - 1 'remain cnt-1
                                    Else
                                        If u >= ar(4, j) Then
                                            c(k) = 1: d(j) = d(j) + 1: m2 = m2 - 1
                                            u = u - ar(4, j)
                                            If v + v0 - v1 - u = v2 Then 'If get v2
                                                w = "": t1 = -1
                                                For t = 1 To n
                                                    If d(t) <> "" Then w = w & "+" & ar(2, t) & "*" & d(t): t1 = t1 + d(t)
                                                Next
                                                '[f65536].End(3).Offset(1) = v2 & "=" & v0 & "+" & Mid(w, 2) & "+" & v1 & "*" & t1
                                                'MsgBox Format(Timer - tms, " 0.00s ") & l & "/" & k1 & "/" & dic.Count & vbCr & v2 & "=" & vbCr & w
                                                Exit Sub
                                            End If
                                            If u < IIf(v2, v - v2, u1) Then Exit For 'Exit k Get One Answer
                                        End If
                                    End If
                                End If
                            Next k
                            w = Join(d, ""): If w = "" Then Exit Do Else w = Join(d, ",")
                            If Not dic.Exists(w) Then
                                r = -Int(-u * n1 / u1)
                                If r <= r1 Then
                                    t1 = m
                                    For k = 1 To n
                                        If d(k) Then t = ar(3, k) \ d(k): If t < t1 Then t1 = t
                                    Next
                                    
                                    If r < r1 Then
                                        r1 = r: w1 = v & w: r2 = t1
                                    Else
                                        If t1 >= r2 Then r2 = t1: w1 = v & w
                                    End If
                                End If
                                If u = 0 Then Exit For 'Exit l Get One Good Answer
                            End If
                            dic(w) = dic(w) + 1
                        Loop While m2 'Until remain=0
                        
                        If l < l1 Then
                            Randomize
                            For k = 1 To m
                                r = Int(Rnd * (m - k + 1)) + k
                                t = a(r): a(r) = a(k): a(k) = t
                            Next
                        End If
                    Next l 'Randomize and then Test Again If not get One Good Answer
                    If u = 0 Then Exit For 'Exit i0 Get One Good Answer
                End If
            Next i0 'Get One Answer After Check All Spec by Order
            
            s1 = 0
            If i2 = UBound(br1) Or w = "" Then
                ReDim d(n)
                For k = 1 To m
                    j = a(k): d(j) = d(j) + 1
                Next
                For t = 1 To n
                    If d(t) <> "" Then s1 = s1 + ar(2, t) * d(t)
                Next
                w1 = s1 & Join(d, ",")
            End If
                
            tr = Split(w1, ",")
            u = val(tr(0)): v = u
            k = 0: r1 = m: w = "" 'Itmes/Plans/CombinText
            For j = 1 To n
                If tr(j) <> "" Then
                    k = k + 1: t = tr(j): u = u - ar(4, j) * t
                    r = ar(3, j) \ t: If r < r1 Then r1 = r
                    b(i, j) = t: w = w & "+" & ar(2, j) & "*" & t
                End If
            Next
            
            For j = 2 To UBound(br1) 'Find Suitable Value
                r2 = br1(j, 2)
                If r2 Then
                    If v + v0 - v1 - u = br1(j, 1) Then
                        If r2 > r1 Then
                            br1(j, 2) = r2 - r1: br1(j, 3) = br1(j, 3) + r1
                        Else
                            br1(j, 2) = 0: br1(j, 3) = br1(j, 3) + r2: r1 = r2
                        End If
                        Exit For
                    ElseIf v + v0 - v1 - u < br1(j, 1) Then
                        If r2 > r1 Then
                            br1(j, 2) = r2 - r1: br1(j, 4) = br1(j, 4) + r1
                        Else
                            br1(j, 2) = 0: br1(j, 4) = br1(j, 4) + r2: r1 = r2
                        End If
                        Exit For
                    End If
                End If
            Next
            For j = 1 To n
                t = val(tr(j)): If t Then ar(3, j) = ar(3, j) - r1 * t: b(0, j) = b(0, j) + r1 * t: m = m - r1 * t
            Next
            b(i, -1) = val(v - u - v1 + v0) 'Bal
            b(i, 0) = Mid(w, 2) & IIf(0, " [" & dic.Count & "]", "") 'Combin
            b(i, -3) = k: If s1 = 0 Then b(i, -2) = r1: b(0, -2) = b(0, -2) + r1 'Plans
            
            If Len(w) > 254 Then 'Total Bal
                tr = Split(w, "+")
                s2 = 0
                For l = 1 To UBound(tr)
                    s2 = s2 + Application.Evaluate(tr(l))
                Next
                b(0, -1) = b(0, -1) + val(s2 * r1)
            Else
                b(0, -1) = b(0, -1) + Application.Evaluate(w) * r1
            End If
            'Application.StatusBar = Format(Timer - tms, "0.00s ") & cnt1 & "/" & cnt2 & ww & "......" & w
            If b(0, -1) = s Then Exit For  'Exit i to Get One Plan
            
            ReDim a&(1 To m): k = 0
            For j = 1 To n
                For l = 1 To ar(3, j)
                    k = k + 1: a(k) = j 'Get Remian Index
                Next
            Next
        Next i
        
        s2 = 0 'Total Need Sum
        For i2 = 2 To UBound(br1)
            s2 = s2 + br1(i2, 1) * (br1(i2, 3) + br1(i2, 4))
        Next
        If s2 Then
            If s2 + s1 * 2 < ss Or (s2 + s1 * 2 = ss And i < ii) Then
                ss = s2 + s1 * 2: ii = i
                b(0, -1) = b(0, -1) - val(s1) 'Total Bal
                b(0, -3) = i: b(0, 0) = " = " & s2 & Format(b(0, -1) / s2, "(0.000%)")
                bb = b: br2 = br1
                'Range("g4") = Val(bb(0, -2)): Range("g5") = Val(s2): Range("g6") = Val(b(0, -1)): Range("g8") = Val(s1)
                ww = "......      " & Format(Timer - tms, "0.00s ") & cnt1 + 1 & "/" & cnt2 + 1 & " Get " & i & "/" & b(0, -2) & " Plans [" & Format(b(0, -1) / s2, "0.000%") & "]"
                cnt1 = 0
            End If
        End If
        
        cnt1 = cnt1 + 1: cnt2 = cnt2 + 1: If cnt2 > cnt Then Exit For 'cnt1=stop cnt/cnt2=cnt record
    Next n1
        wv_s = 0
        For i2 = 1 To UBound(bb, 1)
            If val(bb(i2, -2)) = 0 Then bb(0, -3) = wv_s: Exit For
            wv_s = wv_s + 1
        
        Next
Err_Handler:
    'If Range("g1") = 0 Then Range("i3").Resize(i, 4 + n).Sort Range("k3"), 2, Range("j3"), , 2, Range("i3"), 1, 2
    
    '[f10] = [f10] & "->" & k1: [f11] = [f11] & "->" & IIf(n1 > 0, n1, n1 + 3) 'rnd cnt /precision of diff
    '[g7] = Format([g6] / [g5], "0.000%"): [g9] = Format(Timer - tms, " 0.00s"): t = Val(bb(0, -2))
    'MsgBox "Test: " & cnt2 & vbCr & "Time: " & Format(Timer - tms, "0.000s ") & vbCr & " Get " & t & " Plans" & vbCr & IIf(t = n2, " Good Plan", "(Not Good Plan " & n2 & ")")
    
hs = val(bb(0, -3))
ls = UBound(bb, 2)


arr1_s = arr_pei_all
    
    For i = 1 To 10000
        If Len(arr3(i, 1)) = 0 Then
        h_arr = i
        Exit For
        End If
    Next i
    
   For i = h_arr To h_arr + hs - 1
          iii = i - h_arr + 1
                ling = 0
                k = 0
                For j = 1 To ls
                ling = ling + val(bb(iii, j))
                
                    
                    If bb(iii, j) > 0 Then
                        For g = 1 To bb(iii, j)
                        k = k + 1
                        arr3(i, k) = bb(-1, j)
                        Next g
                    End If
                Next j
                
            arr3(i, -3) = bb(iii, -2) '|fffd||fffd||fffd||5f8||fffd||fffd||fffd|
            arr3(i, 199) = bb(iii, -1) '|fffd||fffd||fffd||fffd|
            arr3(i, 200) = ling '|fffd||fffd||fffd||fffd|
            arr3(i, -1) = (ling - 1) * v1 '|fffd||43f||fffd||fffd||fffd||fffd|
            
                For j = 1 To UBound(arr_yan, 2)
                If arr_yan(1, j) >= bb(iii, -1) Then arr3(i, -4) = arr_yan(1, j): Exit For '|52d||fffd||3f3||fffd||fffd||fffd|
                Next j
            arr3(i, -2) = arr3(i, -4) - arr3(i, 199)
            arr3(i, 0) = arr3(i, 199) - arr3(i, -1)
    
    
   Next i
   
    
       
    
    
End Sub




INQUEST-PP=macro
