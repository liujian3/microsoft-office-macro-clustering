Attribute VB_Name = "BCQT"
Sub mod_bcqt()
Application.ScreenUpdating = False


Sheet1.Range("c5").Value = 5006
Sheet21.Range("c5").Value = 5006

'Sheets("BCQT").Activate

'If Sheets("BCQT").Range("bcqt_check").Value = "" Then GoTo ex

Unproxuat
UnproBCQT

Sheets("BCQT").Activate

Sheets("BCQT").Range("QT_copy1").Copy
Sheets("BCQT").Range("QT_paste1").PasteSpecial xlPasteFormulas
Sheets("BCQT").Range("QT_paste1").Value = Sheets("BCQT").Range("QT_paste1").Value

Sheets("BCQT").Range("QT_copy2").Copy
Sheets("BCQT").Range("QT_paste2").PasteSpecial xlPasteFormulas
Sheets("BCQT").Range("QT_paste2").Value = Sheets("BCQT").Range("QT_paste2").Value


Sheets("xuat").Range("c6:d5006").AdvancedFilter xlFilterCopy, criteriarange:=Range("criteria"), copytorange:=Range("copy"), unique:=True
Sheets("xuat").Range("c6:r5006").AutoFilter
Sheets("BCQT").Activate
Dim pt As PivotTable

Set pt = Sheets("bcqt").PivotTables("TOP10")
pt.RefreshTable


Sheets("BCQT").Range("A1").Select
ProBCQT
Proxuat

MsgBox "DA UPDATE XONG", , "THONG BAO"

'Exit Sub
'ex: MsgBox "DA UPDATE XONG", , "THONG BAO"


Application.ScreenUpdating = True

End Sub
Public Function CountUnique(rng As Range) As Integer
        Dim Dict As Object
        Dim cell As Range
        Set Dict = CreateObject("Scripting.Dictionary")
    
        For Each cell In rng.Cells
             If Not Dict.Exists(cell.Value) Then
                Dict.Add cell.Value, 0
            End If
        Next
        CountUnique = Dict.Count
    End Function
Attribute VB_Name = "CNCT"
Sub CNCT_KH()
On Error GoTo ex
Application.ScreenUpdating = False
Dim ngaydau As Double, ngaycuoi As Double, KH As String

ngaydau = Sheets("131ct").Range("chitiet_start").Value
ngaycuoi = Sheets("131ct").Range("chitiet_end").Value
KH = Sheets("131ct").Range("chitiet_ma").Value
Sheets("131ct").Range("chitiet_XOA").ClearContents

Unproxuat

Sheets("XUAT").Range("c1:r1").EntireColumn.Hidden = False

Sheets("XUAT").Range("d1:e1").EntireColumn.Hidden = True
Sheets("XUAT").Range("g1:h1").EntireColumn.Hidden = True
Sheets("XUAT").Range("k1:l1").EntireColumn.Hidden = True
Sheets("XUAT").Range("o1:p1").EntireColumn.Hidden = True
Sheets("XUAT").Range("R1").EntireColumn.Hidden = True

With Sheets("XUAT").Range("xuat_filter")
        .AutoFilter 1, ">=" & CDbl(ngaydau), xlAnd, "<=" & CDbl(ngaycuoi)
        .AutoFilter 13, "=" & KH
        .Offset(1, 0).SpecialCells(12).Copy
        Sheets("131ct").Range("C16").PasteSpecial xlPasteValues
        .AutoFilter
End With

Sheets("XUAT").Range("c1:r1").EntireColumn.Hidden = False
Sheets("XUAT").Range("xuat_filter").AutoFilter

Proxuat

UnproCNCT
Sheets("131CT").Range("D16:D1722").EntireRow.autofit
Sheets("131CT").Range("C15:J1722").AutoFilter 1, "<>"
ProCNCT

Sheets("131ct").Activate
Sheets("131ct").Range("L1").Select
Application.ScreenUpdating = True

Exit Sub
ex: MsgBox "CAN CHEN THEM DONG CHO BAO CAO CONG NO CHI TIET", , "THONG BAO"

End Sub

Sub CNCT_NCC()

Application.ScreenUpdating = False
Dim ngaydau As Double, ngaycuoi As Double, KH As String

ngaydau = Sheets("131ct").Range("chitiet_start").Value
ngaycuoi = Sheets("131ct").Range("chitiet_end").Value
KH = Sheets("131ct").Range("chitiet_ma").Value
Sheets("131ct").Range("chitiet_XOA").ClearContents

Unpronhap

Sheets("nhap").Range("c1:p1").EntireColumn.Hidden = False

Sheets("nhap").Range("d1:e1").EntireColumn.Hidden = True
Sheets("nhap").Range("g1").EntireColumn.Hidden = True
Sheets("nhap").Range("j1").EntireColumn.Hidden = True
Sheets("nhap").Range("m1:n1").EntireColumn.Hidden = True
Sheets("nhap").Range("P1").EntireColumn.Hidden = True

With Sheets("nhap").Range("nhap_filter")
        .AutoFilter 1, ">=" & CDbl(ngaydau), xlAnd, "<=" & CDbl(ngaycuoi)
        .AutoFilter 11, "=" & KH
        .Offset(1, 0).SpecialCells(12).Copy
        Sheets("131ct").Range("C16").PasteSpecial xlPasteValues
        .AutoFilter
End With

Sheets("nhap").Range("d1:e1").EntireColumn.Hidden = False
Sheets("nhap").Range("g1").EntireColumn.Hidden = False
Sheets("nhap").Range("g1").EntireColumn.Hidden = False
Sheets("nhap").Range("m1:n1").EntireColumn.Hidden = False
Sheets("nhap").Range("P1").EntireColumn.Hidden = False

Sheets("nhap").Range("nhap_filter").AutoFilter

Pronhap

UnproCNCT
Sheets("131CT").Range("C15:J1722").AutoFilter 1, "<>"
Sheets("131CT").Range("D16:D1722").EntireRow.autofit
ProCNCT

Sheets("131ct").Activate
Sheets("131ct").Range("L1").Select
Application.ScreenUpdating = True

End Sub
Attribute VB_Name = "CalendarFrm"
Attribute VB_Base = "0{7280D0EA-2250-48D5-A65D-26F0EE1E0B05}{C6EF1C9F-873A-484C-9B9C-54A22CD0A2C9}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit
    Dim ThisDay As Date
    Dim ThisYear, ThisMth As Date
    Dim CreateCal As Boolean
    Dim i As Integer

Private Sub CommandButton2_Click()
Unload Me
End Sub

Private Sub UserForm_INITIALIZE()
    Application.EnableEvents = False
    'starts the form on todays date
    ThisDay = VBA.DateTime.Date
    ThisMth = Application.WorksheetFunction.Text(ThisDay, "mm")
    ThisYear = Application.WorksheetFunction.Text(ThisDay, "yyyy")
    For i = 1 To 12
        CB_Mth.AddItem Application.WorksheetFunction.Text(DateSerial(Year(ThisDay), Month(ThisDay) + i, 0), "mmmm")
    Next
    CB_Mth.ListIndex = Application.WorksheetFunction.Text(ThisDay, "mm") - Application.WorksheetFunction.Text(ThisDay, "mm")
    For i = -20 To 50
        If i = 1 Then CB_Yr.AddItem Application.WorksheetFunction.Text((ThisDay), "yyyy") Else CB_Yr.AddItem _
            Application.WorksheetFunction.Text((DateAdd("yyyy", (i - 1), ThisDay)), "yyyy")
    Next
    CB_Yr.ListIndex = 21
    'Builds the calendar with todays date
    CalendarFrm.Width = CalendarFrm.Width
    CreateCal = True
    Call Build_Calendar
    Application.EnableEvents = True
End Sub
Private Sub CB_Mth_Change()
    'rebuilds the calendar when the month is changed by the user
    Build_Calendar
End Sub
Private Sub CB_Yr_Change()
    'rebuilds the calendar when the year is changed by the user
    Build_Calendar
End Sub
Private Sub Build_Calendar()
    'the routine that actually builds the calendar each time
    If CreateCal = True Then
    CalendarFrm.Caption = " " & CB_Mth.Value & " " & CB_Yr.Value
    'sets the focus for the todays date button
    CommandButton1.SetFocus
    For i = 1 To 42
        If i < Weekday((CB_Mth.Value) & "/1/" & (CB_Yr.Value)) Then
            Controls("D" & (i)).Caption = Application.WorksheetFunction.Text(DateAdd("d", (i - Weekday((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), _
                ((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), "d")
            Controls("D" & (i)).ControlTipText = Application.WorksheetFunction.Text(DateAdd("d", (i - Weekday((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), _
                ((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), "m/d/yy")
        ElseIf i >= Weekday((CB_Mth.Value) & "/1/" & (CB_Yr.Value)) Then
            Controls("D" & (i)).Caption = Application.WorksheetFunction.Text(DateAdd("d", (i - Weekday((CB_Mth.Value) _
                & "/1/" & (CB_Yr.Value))), ((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), "d")
            Controls("D" & (i)).ControlTipText = Application.WorksheetFunction.Text(DateAdd("d", (i - Weekday((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), _
                ((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), "m/d/yy")
        End If
        If Application.WorksheetFunction.Text(DateAdd("d", (i - Weekday((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), _
        ((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), "mmmm") = ((CB_Mth.Value)) Then
            If Controls("D" & (i)).BackColor <> &H80000016 Then Controls("D" & (i)).BackColor = &H80000018  '&H80000010
            Controls("D" & (i)).Font.Bold = True
        If Application.WorksheetFunction.Text(DateAdd("d", (i - Weekday((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), _
            ((CB_Mth.Value) & "/1/" & (CB_Yr.Value))), "m/d/yy") = Application.WorksheetFunction.Text(ThisDay, "m/d/yy") Then Controls("D" & (i)).SetFocus
        Else
            If Controls("D" & (i)).BackColor <> &H80000016 Then Controls("D" & (i)).BackColor = &H8000000F
            Controls("D" & (i)).Font.Bold = False
        End If
    Next
    End If
End Sub
Private Sub D1_Click()
    'this sub and the ones following represent the buttons for days on the form
    'retrieves the current value of the individual controltiptext and
    'places it in the active cell
    ActiveCell.Value = D1.ControlTipText
    Unload Me
    'after unload you can call a different userform to continue data entry
    'uncomment this line and add a userform named UserForm2
    'Userform2.Show
    
End Sub
Private Sub D2_Click()
    ActiveCell.Value = D2.ControlTipText
    Unload Me
    
End Sub
Private Sub D3_Click()
    ActiveCell.Value = D3.ControlTipText
    Unload Me
    
End Sub
Private Sub D4_Click()
    ActiveCell.Value = D4.ControlTipText
    Unload Me
    
End Sub
Private Sub D5_Click()
    ActiveCell.Value = D5.ControlTipText
    Unload Me
    
End Sub
Private Sub D6_Click()
    ActiveCell.Value = D6.ControlTipText
    Unload Me
    
End Sub
Private Sub D7_Click()
    ActiveCell.Value = D7.ControlTipText
    Unload Me
    
End Sub
Private Sub D8_Click()
    ActiveCell.Value = D8.ControlTipText
    Unload Me
    
End Sub
Private Sub D9_Click()
    ActiveCell.Value = D9.ControlTipText
    Unload Me
    
End Sub
Private Sub D10_Click()
    ActiveCell.Value = D10.ControlTipText
    Unload Me
    
End Sub
Private Sub D11_Click()
    ActiveCell.Value = D11.ControlTipText
    Unload Me
    
End Sub
Private Sub D12_Click()
    ActiveCell.Value = D12.ControlTipText
    Unload Me
    
End Sub
Private Sub D13_Click()
    ActiveCell.Value = D13.ControlTipText
    Unload Me
    
End Sub
Private Sub D14_Click()
    ActiveCell.Value = D14.ControlTipText
    Unload Me
    
End Sub
Private Sub D15_Click()
    ActiveCell.Value = D15.ControlTipText
    Unload Me
    
End Sub
Private Sub D16_Click()
    ActiveCell.Value = D16.ControlTipText
    Unload Me
    
End Sub
Private Sub D17_Click()
    ActiveCell.Value = D17.ControlTipText
    Unload Me
    
End Sub
Private Sub D18_Click()
    ActiveCell.Value = D18.ControlTipText
    Unload Me
    
End Sub
Private Sub D19_Click()
    ActiveCell.Value = D19.ControlTipText
    Unload Me
    
End Sub
Private Sub D20_Click()
    ActiveCell.Value = D20.ControlTipText
    Unload Me
    
End Sub
Private Sub D21_Click()
    ActiveCell.Value = D21.ControlTipText
    Unload Me
    
End Sub
Private Sub D22_Click()
    ActiveCell.Value = D22.ControlTipText
    Unload Me
    
End Sub
Private Sub D23_Click()
    ActiveCell.Value = D23.ControlTipText
    Unload Me
    
End Sub
Private Sub D24_Click()
    ActiveCell.Value = D24.ControlTipText
    Unload Me
    
End Sub
Private Sub D25_Click()
    ActiveCell.Value = D25.ControlTipText
    Unload Me
    
End Sub
Private Sub D26_Click()
    ActiveCell.Value = D26.ControlTipText
    Unload Me
    
End Sub
Private Sub D27_Click()
    ActiveCell.Value = D27.ControlTipText
    Unload Me
    
End Sub
Private Sub D28_Click()
    ActiveCell.Value = D28.ControlTipText
    Unload Me
    
End Sub
Private Sub D29_Click()
    ActiveCell.Value = D29.ControlTipText
    Unload Me
    
End Sub
Private Sub D30_Click()
    ActiveCell.Value = D30.ControlTipText
    Unload Me
    
End Sub
Private Sub D31_Click()
    ActiveCell.Value = D31.ControlTipText
    Unload Me
    
End Sub
Private Sub D32_Click()
    ActiveCell.Value = D32.ControlTipText
    Unload Me
    
End Sub
Private Sub D33_Click()
    ActiveCell.Value = D33.ControlTipText
    Unload Me
    
End Sub
Private Sub D34_Click()
    ActiveCell.Value = D34.ControlTipText
    Unload Me
    
End Sub
Private Sub D35_Click()
    ActiveCell.Value = D35.ControlTipText
    Unload Me
    
End Sub
Private Sub D36_Click()
    ActiveCell.Value = D36.ControlTipText
    Unload Me
    
End Sub
Private Sub D37_Click()
    ActiveCell.Value = D37.ControlTipText
    Unload Me
    
End Sub
Private Sub D38_Click()
    ActiveCell.Value = D38.ControlTipText
    Unload Me
    
End Sub
Private Sub D39_Click()
    ActiveCell.Value = D39.ControlTipText
    Unload Me
    
End Sub
Private Sub D40_Click()
    ActiveCell.Value = D40.ControlTipText
    Unload Me
    
End Sub
Private Sub D41_Click()
    ActiveCell.Value = D41.ControlTipText
    Unload Me
    
End Sub
Private Sub D42_Click()
    ActiveCell.Value = D42.ControlTipText
    Unload Me
    
End Sub




Attribute VB_Name = "DPB"
Attribute VB_Base = "0{393B6541-9BAA-4889-9D30-4E4AFDBE03EC}{F09F54CA-CF3F-4DC1-A8CD-0769A496AA8D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Option Explicit
Attribute VB_Name = "F_KH"
Attribute VB_Base = "0{6E5D1ED1-D5DE-49CD-9FD2-C1FA726F8050}{E25DF0DD-7795-48B9-90E8-FA8211FCE595}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
    F_themKH.Show
End Sub

Private Sub KHlist_DblClick(ByVal Cancel As MSForms.ReturnBoolean)

If ActiveCell.Row > 56 Then Exit Sub

On Error GoTo err
ActiveCell.Value = Me.KHlist.Value
ActiveCell.Offset(0, 1).Value = Me.KHlist.Column(1)
Unload Me
Exit Sub
err: MsgBox "BAN CAN CHON MA TRUOC KHI KICH DUP CHUOT"
End Sub

Private Sub KHlist_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
On Error GoTo err
    If KeyAscii = 13 Then
 '       On Error GoTo err
        ActiveCell.Value = Me.KHlist.Value
        ActiveCell.Offset(0, 1).Value = Me.KHlist.Column(1)
        Unload Me
        'Exit Sub
'err:         MsgBox "BAN CAN CHON MA TRUOC KHI KICH DUP CHUOT"
    End If
Exit Sub
err: MsgBox "BAN CAN CHON MA TRUOC KHI KICH DUP CHUOT"
End Sub

Private Sub locmakh_Change()
Sheets("dmkh").Range("timKH").Value = Me.locmakh.Value
Me.KHlist.RowSource = "KHfind"

End Sub

Private Sub Thoat_Click()
Unload Me
End Sub

Private Sub UserForm_activate()
    If ActiveSheet.Name = "Nhap" Then
        Sheets("DMKH").Range("LoaiKH").Value = "NCC"
    ElseIf ActiveSheet.Name = "Xuat" Then
        Sheets("DMKH").Range("LoaiKH").Value = "KH"
    Else
    End If
    Sheets("dmkh").Range("timKH").ClearContents
    Me.KHlist.RowSource = "KHfind"
    
End Sub

Attribute VB_Name = "F_MHN"
Attribute VB_Base = "0{E179FC10-D968-4C37-8181-928BCC70136C}{E34F96DD-F8E5-45C2-9BBC-0F4EDEFC3178}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
    F_themHH.Show
End Sub

Private Sub HHList_DblClick(ByVal Cancel As MSForms.ReturnBoolean)

If ActiveCell.Row > 56 Then Exit Sub

On Error GoTo err
  Application.Calculation = xlCalculationManual
  ActiveCell.Value = Me.HHList.Value
  ActiveCell.Offset(0, 1).Value = Me.HHList.Column(1)
  ActiveCell.Offset(0, 2).Value = Me.HHList.Column(2)
  ActiveCell.Offset(0, 4).Value = Me.HHList.Column(3)
  ActiveCell.Offset(0, 6).Value = Me.HHList.Column(5)
  ActiveCell.Offset(0, -2).Value = Date
  ActiveCell.Offset(0, 3).Select
  ActiveCell.EntireRow.autofit
  Application.Calculation = xlCalculationAutomatic
  
  Unload Me
Exit Sub
err: MsgBox "BAN CAN CHON MA TRUOC KHI KICH DUP CHUOT"
End Sub

Private Sub HHList_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)

On Error GoTo err
    If KeyAscii = 13 Then
        Application.Calculation = xlCalculationManual
        ActiveCell.Value = Me.HHList.Value
        ActiveCell.Offset(0, 1).Value = Me.HHList.Column(1)
        ActiveCell.Offset(0, 2).Value = Me.HHList.Column(2)
        ActiveCell.Offset(0, 4).Value = Me.HHList.Column(3)
        ActiveCell.Offset(0, 6).Value = Me.HHList.Column(5)
        ActiveCell.Offset(0, -2).Value = Date
        ActiveCell.Offset(0, 3).Select
        ActiveCell.EntireRow.autofit
        Application.Calculation = xlCalculationAutomatic
        
        Unload Me
    End If
Exit Sub
err: MsgBox "BAN CAN CHON MA TRUOC KHI KICH DUP CHUOT"
End Sub

Private Sub NhomHang_Change()
    Range("Tim").Value = Me.NhomHang.Value
    Me.HHList.RowSource = "HHFind"
End Sub
Private Sub Thoat_Click()
    Unload Me
End Sub

Private Sub UserForm_activate()
    Range("Tim").ClearContents
    Me.HHList.RowSource = "HHFind"
End Sub
Attribute VB_Name = "F_MHX"
Attribute VB_Base = "0{798660A3-34BF-4B1C-AD11-0AE042EA970F}{0076DC5A-203E-4D55-ACE0-5BA29FE4C842}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
    F_themHH.Show
End Sub

Private Sub HHList_DblClick(ByVal Cancel As MSForms.ReturnBoolean)


If ActiveCell.Row > 56 Then Exit Sub

On Error GoTo err
  Application.Calculation = xlCalculationManual
  ActiveCell.Value = Me.HHList.Value
  ActiveCell.Offset(0, 1).Value = Me.HHList.Column(1)
  ActiveCell.Offset(0, 2).Value = Me.HHList.Column(2)
  ActiveCell.Offset(0, 5).Value = Me.HHList.Column(4)
  ActiveCell.Offset(0, 8).Value = Me.HHList.Column(5)
  ActiveCell.Offset(0, -2).Value = Date
  
  Sheets("XUAT").Range("check_ngay").Value = ActiveCell.Offset(0, -2).Value
  Sheets("XUAT").Range("check_ma").Value = Me.HHList.Value
  ActiveCell.EntireRow.autofit
  Sheets("XUAT").Range("TK_MA").Value = Me.HHList.Value
  Application.Calculation = xlCalculationAutomatic
  ActiveCell.Offset(0, 3).Value = Sheets("XUAT").Range("TK_sl").Value
  Sheets("XUAT").Range("tk_dgv").Value = Sheets("XUAT").Range("check_dgvon").Value
  ActiveCell.Offset(0, 4).Select
  
  Unload Me
Exit Sub
err: MsgBox "BAN CAN CHON MA TRUOC KHI KICH DUP CHUOT"
End Sub

Private Sub HHList_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
On Error GoTo err
    If KeyAscii = 13 Then
    
        Application.Calculation = xlCalculationManual
        ActiveCell.Value = Me.HHList.Value
        ActiveCell.Offset(0, 1).Value = Me.HHList.Column(1)
        ActiveCell.Offset(0, 2).Value = Me.HHList.Column(2)
        ActiveCell.Offset(0, 5).Value = Me.HHList.Column(4)
        ActiveCell.Offset(0, 8).Value = Me.HHList.Column(5)
        ActiveCell.Offset(0, -2).Value = Date
        
        Sheets("XUAT").Range("check_ngay").Value = ActiveCell.Offset(0, -2).Value
        Sheets("XUAT").Range("check_ma").Value = Me.HHList.Value
        ActiveCell.EntireRow.autofit
        Sheets("XUAT").Range("TK_MA").Value = Me.HHList.Value
        Application.Calculation = xlCalculationAutomatic
        ActiveCell.Offset(0, 3).Value = Sheets("XUAT").Range("TK_sl").Value
        Sheets("XUAT").Range("tk_dgv").Value = Sheets("XUAT").Range("check_dgvon").Value
        ActiveCell.Offset(0, 4).Select

        Unload Me
    End If
Exit Sub
err: MsgBox "BAN CAN CHON MA TRUOC KHI KICH DUP CHUOT"
End Sub

Private Sub NhomHang_Change()
    Range("Tim").Value = Me.NhomHang.Value
    Me.HHList.RowSource = "HHFind"
End Sub
Private Sub Thoat_Click()
    Unload Me
End Sub

Private Sub UserForm_activate()
    Range("Tim").ClearContents
    Me.HHList.RowSource = "HHFind"
End Sub

Attribute VB_Name = "F_inphieunx"
Attribute VB_Base = "0{0CAD1AC6-CD90-4EDC-B022-0778FF806300}{89C6D3E2-E006-4FD2-A40D-2050FE227C47}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub Thoat_Click()
    Unload Me
End Sub

Private Sub UserForm_activate()
    If ActiveSheet.Name = "Nhap" Then
        Me.loai.Value = "NHAP"
        Me.sophieu.Value = Range("d" & ActiveCell.Row).Value
    ElseIf ActiveSheet.Name = "Xuat" Then
        Me.loai.Value = "XUAT"
        Me.sophieu.Value = Range("d" & ActiveCell.Row).Value
    Else
    End If
End Sub

Private Sub xem_Click()
If Me.loai.Value = "" Then
    MsgBox "LOAI NGHIEP VU KHONG DUOC TRONG", , "THONG BAO"
ElseIf Me.sophieu.Value = "" Then
    MsgBox "KHONG DE TRONG SO PHIEU", , "THONG BAO"
Else
    If Me.loai.Value = "NHAP" Then
    
        Sheets("pn").Range("i9").Value = Me.sophieu.Value
        PN
        Unload Me
        Sheets("PN").PrintPreview
    
    ElseIf Me.loai.Value = "XUAT" Then
        
        Sheets("px").Range("i9").Value = Me.sophieu.Value
        PX
        Unload Me
        Sheets("Px").PrintPreview
    
    Else
    End If
End If
End Sub
Attribute VB_Name = "F_suaHH"
Attribute VB_Base = "0{B5A31DAF-0DEA-4B8D-A94F-4AA3BB719A1E}{49234AEF-38A4-4537-9555-EBEE7EE6503E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub amount_afterupdate()
Me.amount.Value = Format(Me.amount.Value, "#,#")
End Sub

Private Sub CommandButton1_Click()
Dim i As Long
Dim j As Long

Application.ScreenUpdating = False

j = Sheet7.Range("DM_POS").Value + 6

    Sheet7.Range("c" & j).Value = Sheet7.Range("d4").Value
    Sheet7.Range("d" & j).Value = Me.ten.Value
    Sheet7.Range("e" & j).Value = Me.dvt.Value
    Sheet7.Range("f" & j).Value = Me.nhom.Value
    Sheet7.Range("g" & j).Value = Me.sl.Value
    Sheet7.Range("h" & j).Value = Me.dg_ton.Value
    Sheet7.Range("i" & j).Value = Me.tt.Value
    Sheet7.Range("j" & j).Value = Me.dg_n.Value
    Sheet7.Range("k" & j).Value = Me.dg_b.Value
    Sheet7.Range("l" & j).Value = Me.vat.Value
    Sheet7.Range("M" & j).Value = Me.ghichu.Value
    
    Sheet7.Range("c7:c1006").EntireRow.autofit
    
    
    'MsgBox ("Ban da CAP NHAT thong tin thanh cong")
    'Unload Me

Application.ScreenUpdating = True

End Sub

Private Sub CommandButton2_Click()
Unload Me
    ThisWorkbook.Save
End Sub

Private Sub CommandButton3_Click()
Dim j As Long

If Me.ma.Value = "" Then

    MsgBox ("Ban chua chon ma nao de xoa")
    
Else
    j = Sheet7.Range("DM_POS").Value + 6
    
    Sheet7.Range("c" & j).Resize(1, 11).ClearContents
    
    Call sx_DMhh
    
    Sheet7.Range("c7:c1006").EntireRow.autofit
    
    Sheet7.Range("c7").Select
    
    MsgBox ("Ban da XOA thanh cong")
    Unload Me
End If

End Sub

Private Sub ma_afterupdate()
Dim i As Long

Sheet7.Range("d4").Value = Me.ma.Value
j = Sheet7.Range("DM_POS").Value + 6

Me.ten.Value = Sheet7.Range("d" & j).Value
Me.dvt.Value = Sheet7.Range("e" & j).Value
Me.nhom.Value = Sheet7.Range("f" & j).Value
Me.sl.Value = Format(Sheet7.Range("g" & j).Value, "#,#")
Me.dg_ton.Value = Format(Sheet7.Range("h" & j).Value, "#,#")
Me.tt.Value = Format(Sheet7.Range("i" & j).Value, "#,#")
Me.dg_n.Value = Format(Sheet7.Range("j" & j).Value, "#,#")
Me.dg_b.Value = Format(Sheet7.Range("k" & j).Value, "#,#")
Me.vat.Value = Sheet7.Range("l" & j).Value
Me.ghichu.Value = Sheet7.Range("M" & j).Value

End Sub

Private Sub sl_afterupdate()

Me.sl.Value = Format(Me.sl.Value, "#,#")
Sheet7.Range("R_SLTON").Value = Me.sl.Value
Sheet7.Range("R_DGTON").Value = Me.dg_ton.Value
Me.tt.Value = Format(Sheet7.Range("R_THANHTIEN").Value, "#,#")

End Sub

Private Sub dg_TON_afterupdate()
Me.dg_ton.Value = Format(Me.dg_ton.Value, "#,#")
Sheet7.Range("R_slTON").Value = Me.sl.Value
Sheet7.Range("R_DGTON").Value = Me.dg_ton.Value
Me.tt.Value = Format(Sheet7.Range("R_THANHTIEN").Value, "#,#")

End Sub

Attribute VB_Name = "F_suaKH"
Attribute VB_Base = "0{412D3626-E2DD-418B-8B6F-A6B026463F3D}{9CBC9E9A-2C10-42A6-B87F-6B7239EE048A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub amount_afterupdate()
Me.amount.Value = Format(Me.amount.Value, "#,#")
End Sub

Private Sub CommandButton1_Click()
Dim i As Long
Dim j As Long

Application.ScreenUpdating = False

i = Sheet11.Range("e4").Value + 6

    Sheet11.Range("c" & i).Value = Sheet11.Range("d4").Value
    Sheet11.Range("d" & i).Value = Me.ten.Value
    Sheet11.Range("e" & i).Value = Me.loai.Value
    Sheet11.Range("h" & i).Value = Me.dc.Value
    Sheet11.Range("i" & i).Value = Me.sdt.Value
    
    If Me.loai.Value = "KH" Then
    
        Sheet11.Range("g" & i).Value = Me.amount.Value
    
    Else
        Sheet11.Range("f" & i).Value = Me.amount.Value
    End If
    
    Sheet11.Range("c7:c206").EntireRow.autofit
    
    'MsgBox ("Ban da CAP NHAT thong tin thanh cong")
    'Unload Me

Application.ScreenUpdating = True

End Sub

Private Sub CommandButton2_Click()
Unload Me
    ThisWorkbook.Save
End Sub

Private Sub CommandButton3_Click()
Dim j As Long

If Me.ma.Value = "" Then

    MsgBox ("Ban chua chon ma nao de xoa")
    
Else
    j = Sheet11.Range("e4").Value + 6
    
    Sheet11.Range("c" & j).Resize(1, 8).ClearContents
    
    Call sx_DMKH
    
    Sheet11.Range("c7:c206").EntireRow.autofit
    
    MsgBox ("Ban da XOA thanh cong")
    Unload Me
End If

End Sub

Private Sub ma_afterupdate()
Dim i As Long

Sheet11.Range("d4").Value = Me.ma.Value
j = Sheet11.Range("e4").Value + 6

Me.ten.Value = Sheet11.Range("d" & j).Value
Me.loai.Value = Sheet11.Range("e" & j).Value
Me.dc.Value = Sheet11.Range("h" & j).Value
Me.sdt.Value = Sheet11.Range("i" & j).Value
If Me.loai.Value = "KH" Then

    Me.amount.Value = Format(Sheet11.Range("g" & j).Value, "#,#")
Else
    Me.amount.Value = Format(Sheet11.Range("f" & j).Value, "#,#")
End If

End Sub

Attribute VB_Name = "F_themHH"
Attribute VB_Base = "0{DB6C8884-A8E3-496B-A41D-A1EC22B76551}{946B3E99-275A-4171-843D-A6B787344CF9}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub amount_afterupdate()
Me.amount.Value = Format(Me.amount.Value, "#,#")
End Sub

Private Sub CommandButton1_Click()

Application.ScreenUpdating = False
Dim i As Long
i = Sheet7.Range("c65000").End(xlUp).Row + 1

If i >= 57 Then GoTo err

Sheet7.Range("d4").Value = Me.ma.Value

If Me.ma.Value = "" Then

MsgBox ("Ban chua nhap Ma hang hoa")

Else

    If Sheet7.Range("dm_pos").Value <> "" Then
    
    MsgBox ("Ma khach hang da ton tai, vui long kiem tra lai")
    
    Else
    
        If Me.sl.Value <> "" And Me.dg_ton.Value <> "" Then
        
            Me.tt.Value = Me.sl.Value * Me.dg_ton.Value
        
        Else
        
        End If
        
        Sheet7.Range("c" & i).Value = Me.ma.Value
        Sheet7.Range("d" & i).Value = Me.ten.Value
        Sheet7.Range("e" & i).Value = Me.dvt.Value
        Sheet7.Range("f" & i).Value = Me.nhom.Value
        Sheet7.Range("g" & i).Value = Me.sl.Value
        Sheet7.Range("h" & i).Value = Me.dg_ton.Value
        Sheet7.Range("i" & i).Value = Me.tt.Value
        Sheet7.Range("j" & i).Value = Me.dg_n.Value
        Sheet7.Range("k" & i).Value = Me.dg_b.Value
        Sheet7.Range("l" & i).Value = Me.vat.Value
        Sheet7.Range("m" & i).Value = Me.ghichu.Value
        
        Call sx_DMhh
        
        Sheet7.Range("c7:c1006").EntireRow.autofit

        Application.ScreenUpdating = True
    End If

End If

Exit Sub

'If i >= 17 Then GoTo err
err: MsgBox "HET GIOI HAN MA HANG DUOC NHAP, BAN VUI LONG LIEN HE BQT: WEBKYNANG.VN@GMAIL.COM", , "THONG BAO"
Unload Me


End Sub

Private Sub CommandButton2_Click()
    Unload Me
    ThisWorkbook.Save
   ' MsgBox "CAC SUA DOI DA DUOC LUU LAI", , "THONG BAO"
End Sub

Private Sub ma_afterupdate()

Me.ma.Value = UCase(Me.ma.Value)

End Sub

Private Sub sl_afterupdate()

Me.sl.Value = Format(Me.sl.Value, "#,#")
Sheet7.Range("R_SLTON").Value = Me.sl.Value
Me.tt.Value = Format(Sheet7.Range("R_THANHTIEN").Value, "#,#")

End Sub

Private Sub dg_TON_afterupdate()
Me.dg_ton.Value = Format(Me.dg_ton.Value, "#,#")
Sheet7.Range("R_DGTON").Value = Me.dg_ton.Value
Me.tt.Value = Format(Sheet7.Range("R_THANHTIEN").Value, "#,#")

End Sub

Private Sub tt_Change()
Me.tt.Value = Format(Me.tt.Value, "#,#")
End Sub

Private Sub dg_n_afterupdate()
    Me.dg_n.Value = Format(Me.dg_n.Value, "#,#")
End Sub

Private Sub dg_b_afterupdate()
    Me.dg_b.Value = Format(Me.dg_b.Value, "#,#")
End Sub

Private Sub UserForm_INITIALIZE()
    Sheets("DM").Range("R_SLTON").Value = ""
    Sheets("DM").Range("R_DGTON").Value = ""
End Sub
Attribute VB_Name = "F_themKH"
Attribute VB_Base = "0{199A8E85-E37F-430B-9CFC-9E0467B3390A}{577B91AE-2CE8-41F3-B893-645673BA7087}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub amount_afterupdate()
Me.amount.Value = Format(Me.amount.Value, "#,#")
End Sub

Private Sub CommandButton1_Click()

Application.ScreenUpdating = False
Dim i As Long
i = Sheet11.Range("c65000").End(xlUp).Row + 1

If i >= 17 Then GoTo err

Sheet11.Range("d4").Value = Me.ma.Value

If Me.ma.Value = "" Or Me.loai.Value = "" Then

MsgBox ("Ban nhap thieu: Ma KH/NCC hoac Loai KH/NCC")

Else

    If Sheet11.Range("e4").Value <> "" Then
    
    MsgBox ("Ma khach hang da ton tai, vui long kiem tra lai")
    
    Else
    
        Sheet11.Range("c" & i).Value = Me.ma.Value
        Sheet11.Range("d" & i).Value = Me.ten.Value
        Sheet11.Range("e" & i).Value = Me.loai.Value
        Sheet11.Range("h" & i).Value = Me.dc.Value
        Sheet11.Range("i" & i).Value = Me.sdt.Value
        
        If Me.loai.Value = "KH" Then
        
            Sheet11.Range("g" & i).Value = Me.amount.Value
        
        Else
            Sheet11.Range("f" & i).Value = Me.amount.Value
        End If
        
        Call sx_DMKH
        
        MsgBox ("Ban da luu Khach moi thanh cong")
    
    End If
    
End If

Sheet11.Range("c7:c206").EntireRow.autofit

Application.ScreenUpdating = True


Exit Sub
err: MsgBox "HET GIOI HAN MA HANG DUOC NHAP, BAN VUI LONG LIEN HE BQT: WEBKYNANG.VN@GMAIL.COM", , "THONG BAO"
Unload Me



End Sub

Private Sub CommandButton2_Click()
    Unload Me
    ThisWorkbook.Save
    'MsgBox "CAC SUA DOI DA DUOC LUU LAI", , "THONG BAO"
End Sub

Private Sub loai_afterupdate()
    
End Sub

Private Sub ma_afterupdate()

Me.ma.Value = UCase(Me.ma.Value)

End Sub

Attribute VB_Name = "F_thutienngay"
Attribute VB_Base = "0{201D41DE-483E-4494-A724-E6D036BFAC44}{26D276AF-9480-4C10-93D5-8E193B70B05A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub locmakh_Change()
    Sheets("dmkh").Range("timkh").Value = Me.locmakh.Value
    Me.KHlist.RowSource = "khfind"
End Sub

Private Sub n_ngay_afterupdate()
    Me.n_ngay.Value = Format(n_ngay, "dd-mmm-yy")
End Sub

Private Sub sotienthanhtoan_Change()
    Me.sotienthanhtoan.Value = Format(sotienthanhtoan, "#,###")
End Sub

Private Sub Thoat_Click()
Unload Me
End Sub

Private Sub ghi_Click()

'On Error GoTo err

'Ghi vao bang ke ban hang
    Dim i As Long
    i = Sheet21.Range("c65000").End(xlUp).Row + 1
    
If Me.N_sophieu.Value = "" Then
    MsgBox "BAN CHUA NHAP SO PHIEU", , "THONG BAO"
ElseIf Me.KHlist.Text = "" Then
    MsgBox "BAN CHUA CHON MA KHACH HANG NAO", , "THONG BAO"
Else
    
    Application.Calculation = xlCalculationManual
    Sheet21.Range("e5").Value = Me.N_sophieu.Value
    Sheet21.Range("c" & i).Value = Me.n_ngay.Value
    Sheet21.Range("f" & i).Value = Range("ND_thutienngay") & UCase(Me.N_sophieu.Value)
    Sheet21.Range("o" & i).Value = Me.KHlist.Value
    Sheet21.Range("p" & i).Value = Me.KHlist.Column(1)
    Application.Calculation = xlCalculationAutomatic
    Sheet21.Range("q" & i).Value = Sheet21.Range("f5").Value
    
'Ghi vao so quy

    Dim j As Long
    j = Sheets("Chiphi").Range("D65000").End(xlUp).Row + 1
    
    Range("loaithuchi").Value = "PT"
    
    Sheets("CHIPHI").Range("D" & j).Value = Me.n_ngay.Value
    Sheets("CHIPHI").Range("E" & j).Value = Range("sophieu_moi").Value
    Sheets("CHIPHI").Range("F" & j).Value = Range("ND_thutienngay") & UCase(Me.N_sophieu.Value)
    Sheets("CHIPHI").Range("H" & j).Value = Sheet21.Range("f5").Value
    Sheets("CHIPHI").Range("I" & j).Value = Me.KHlist.Column(1)
    
    auto_chiphi
    
    MsgBox ("BAN DA LUU THU TIEN THANH CONG")
    Unload Me

End If

'Exit Sub
'err:
 '  MsgBox "BAN CHUA CHON MA KHACH HANG NAO HOAC CHUA NHAP SO PHIEU", , "THONG BAO"


End Sub

Private Sub UserForm_activate()
    Me.n_ngay.Value = Format(Date, "dd-mmm-yyyy")
    Sheets("DMKH").Range("LoaiKH").Value = "KH"
    Sheets("dmkh").Range("timkh").ClearContents
    Me.KHlist.RowSource = "khfind"
End Sub

Attribute VB_Name = "F_thutiensau"
Attribute VB_Base = "0{157FBA77-1633-4FBE-A474-87D9DD34680F}{5ED4B035-E1D7-4EE3-80E4-7F597274EC1B}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub locmakh_Change()
    Sheets("dmkh").Range("timkh").Value = Me.locmakh.Value
    Me.KHlist.RowSource = "khfind"
End Sub

Private Sub ngaytt_afterupdate()
    Me.ngaytt.Value = Format(ngaytt, "dd-mmm-yy")
End Sub

Private Sub sotienthanhtoan_Change()
    Me.sotienthanhtoan.Value = Format(sotienthanhtoan, "#,###")
End Sub

Private Sub Thoat_Click()
Unload Me
End Sub

Private Sub ghi_Click()
Dim i As Long
i = Sheet21.Range("c65000").End(xlUp).Row + 1

On Error GoTo err

'Ghi vao bang ke xuat
    If Me.sotienthanhtoan.Value = "" Then
    
    MsgBox "BAN CHUA NHAP SO TIEN", , "THONG BAO"
    
    ElseIf Me.KHlist.Text = "" Then
        MsgBox "BAN CHUA CHON MA KHACH HANG NAO", , "THONG BAO"
    ElseIf Me.noidungtt.Value = "" Then
        MsgBox "BAN CHUA NHAP NOI DUNG THU TIEN", , "THONG BAO"
    Else
        Sheet21.Range("p" & i).Value = Me.KHlist.Column(1)
        Sheet21.Range("o" & i).Value = Me.KHlist.Value
        Sheet21.Range("q" & i).Value = Me.sotienthanhtoan.Value
        Sheet21.Range("F" & i).Value = Me.noidungtt.Value
        Sheet21.Range("C" & i).Value = Me.ngaytt.Value
            
        'Ghi vao so quy
        
        Dim j As Long
        j = Sheets("Chiphi").Range("D65000").End(xlUp).Row + 1
        
        Range("loaithuchi").Value = "PT"
        
        Sheets("CHIPHI").Range("D" & j).Value = Me.ngaytt.Value
        Sheets("CHIPHI").Range("E" & j).Value = Range("sophieu_moi").Value
        Sheets("CHIPHI").Range("F" & j).Value = Me.noidungtt.Value
        Sheets("CHIPHI").Range("H" & j).Value = Me.sotienthanhtoan.Value
        Sheets("CHIPHI").Range("I" & j).Value = Me.KHlist.Column(1)
        
        auto_chiphi
    
        Unload Me
        MsgBox "BAN DA THU TIEN THANH CONG", , "THONG BAO"
        
    End If

Exit Sub
err:
    MsgBox "BAN CHUA CHON MA KHACH HANG NAO", , "THONG BAO"

End Sub

Private Sub UserForm_activate()
    Me.ngaytt.Value = Format(Date, "dd-mmm-yyyy")
    Sheets("DMKH").Range("LoaiKH").Value = "KH"
    Sheets("dmkh").Range("timkh").ClearContents
    Me.KHlist.RowSource = "khfind"
End Sub
Attribute VB_Name = "F_tratienngay"
Attribute VB_Base = "0{F8D6097B-BB5F-47AC-94A5-6D85C0AF0388}{74CF16BD-23EC-4907-9AE1-6A94E403CB57}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub locmakh_Change()
Sheets("dmkh").Range("timkh").Value = Me.locmakh.Value
Me.KHlist.RowSource = "khfind"
End Sub

Private Sub n_ngay_afterupdate()
Me.n_ngay.Value = Format(n_ngay, "dd-mmm-yy")
End Sub

Private Sub Thoat_Click()
Unload Me
End Sub

Private Sub ghi_Click()
Dim i As Long
i = Sheet1.Range("c65000").End(xlUp).Row + 1

If Me.N_sophieu.Value = "" Then
    MsgBox "BAN CHUA NHAP SO PHIEU", , "THONG BAO"
ElseIf Me.KHlist.Text = "" Then
    MsgBox "BAN CHUA CHON MA NHA CUNG CAP NAO", , "THONG BAO"
Else

On Error GoTo err
Application.Calculation = xlCalculationManual

Sheet1.Range("n" & i).Value = Me.KHlist.Column(1)
Sheet1.Range("f5").Value = Me.N_sophieu.Value
Sheet1.Range("c" & i).Value = Me.n_ngay.Value
Sheet1.Range("f" & i).Value = Range("ND_tratienngay") & UCase(Me.N_sophieu.Value)
Sheet1.Range("m" & i).Value = Me.KHlist.Value
Application.Calculation = xlCalculationAutomatic
Sheet1.Range("o" & i).Value = Sheet1.Range("g5").Value

'Ghi vao so quy

    Dim j As Long
    j = Sheets("Chiphi").Range("D65000").End(xlUp).Row + 1
    
    Range("loaithuchi").Value = "PC"
    
    Sheets("CHIPHI").Range("D" & j).Value = Me.n_ngay.Value
    Sheets("CHIPHI").Range("E" & j).Value = Range("sophieu_moi").Value
    Sheets("CHIPHI").Range("F" & j).Value = Range("ND_tratienngay") & UCase(Me.N_sophieu.Value)
    Sheets("CHIPHI").Range("H" & j).Value = Sheet1.Range("g5").Value
    Sheets("CHIPHI").Range("I" & j).Value = Me.KHlist.Column(1)
    
    auto_chiphi
    
    MsgBox "BAN DA LUU TRA TIEN THANH CONG"
    Unload Me

End If

Exit Sub
err:
    MsgBox "BAN CHUA CHON MA NHA CUNG CAP NAO", , "THONG BAO"

End Sub

Private Sub UserForm_activate()
    Me.n_ngay.Value = Format(Date, "dd-mmm-yyyy")
    Sheets("DMKH").Range("LoaiKH").Value = "NCC"
    Sheets("dmkh").Range("timkh").ClearContents
    Me.KHlist.RowSource = "khfind"
End Sub

Attribute VB_Name = "F_tratiensau"
Attribute VB_Base = "0{696C7BC8-F318-4FDA-BC4A-0C1AC0799C1E}{623F0ACE-987C-444B-AE18-4EAFA73C1D4D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub locmakh_Change()
Sheets("dmkh").Range("timkh").Value = Me.locmakh.Value
Me.KHlist.RowSource = "khfind"
End Sub

Private Sub ngaytt_afterupdate()
Me.ngaytt.Value = Format(ngaytt, "dd-mmm-yy")
End Sub

Private Sub sotienthanhtoan_Change()

Me.sotienthanhtoan.Value = Format(sotienthanhtoan, "#,###")

End Sub


Private Sub Thoat_Click()
Unload Me
End Sub

Private Sub ghi_Click()
Dim i As Long
i = Sheet1.Range("c65000").End(xlUp).Row + 1

On Error GoTo err

    If Me.sotienthanhtoan.Value = "" Then
        MsgBox "BAN CHUA NHAP SO TIEN THANH TOAN"
    ElseIf Me.KHlist.Text = "" Then
        MsgBox "BAN CHUA CHON MA NHA CUNG CAP NAO", , "THONG BAO"
    ElseIf Me.noidungtt.Value = "" Then
        MsgBox "BAN CHUA NHAP NOI DUNG TRA TIEN", , "THONG BAO"
    Else
        Sheet1.Range("N" & i).Value = Me.KHlist.Column(1)
        Sheet1.Range("m" & i).Value = Me.KHlist.Value
        Sheet1.Range("o" & i).Value = Me.sotienthanhtoan.Value
        Sheet1.Range("f" & i).Value = Me.noidungtt.Value
        Sheet1.Range("C" & i).Value = Me.ngaytt.Value
    
    'Ghi vao so quy

        Dim j As Long
        j = Sheets("Chiphi").Range("D65000").End(xlUp).Row + 1
        
        Range("loaithuchi").Value = "PC"
        
        Sheets("CHIPHI").Range("D" & j).Value = Me.ngaytt.Value
        Sheets("CHIPHI").Range("E" & j).Value = Range("sophieu_moi").Value
        Sheets("CHIPHI").Range("F" & j).Value = Me.noidungtt.Value
        Sheets("CHIPHI").Range("H" & j).Value = Me.sotienthanhtoan.Value
        Sheets("CHIPHI").Range("I" & j).Value = Me.KHlist.Column(1)
        
        auto_chiphi
        
        MsgBox ("BAN DA LUU TRA TIEN THANH CONG")
        Unload Me
    
    End If
    
Exit Sub
err:
    MsgBox "BAN CHUA CHON MA NHA CUNG CAP NAO", , "THONG BAO"


End Sub

Private Sub UserForm_activate()
    Me.ngaytt.Value = Format(Date, "dd-mmm-yyyy")
    Sheets("DMKH").Range("LoaiKH").Value = "NCC"
    Sheets("dmkh").Range("timkh").ClearContents
    Me.KHlist.RowSource = "khfind"
End Sub
Attribute VB_Name = "M_about"
Attribute VB_Base = "0{89CA4D7E-C8D3-473B-91A4-B8E0BE19EBE9}{295033EC-89EC-4688-85C4-1E5EB0A89FD2}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
Unload Me
End Sub
Attribute VB_Name = "Mod_rightmenu"
Sub deleterow()

If ActiveSheet.Name = "Xuat" Then
    Unproxuat
    Dim i As Long
    i = Selection.Rows.Count
    Selection.EntireRow.Delete
    Rows(5006 - i + 1 & ":" & 5006).Insert
    Sheets("xuat").Range("b7:b5006").Value = Sheets("stt").Range("a1:a5000").Value
    Proxuat

ElseIf ActiveSheet.Name = "Nhap" Then
    Unpronhap
    i = Selection.Rows.Count
    Selection.EntireRow.Delete
    Rows(5006 - i + 1 & ":" & 5006).Insert
    Sheets("nhap").Range("b7:b5006").Value = Sheets("stt").Range("a1:a5000").Value
    Pronhap
    
Else
End If


End Sub

Sub insertrow()

If ActiveSheet.Name = "Xuat" Then
    Unproxuat
    Dim i As Long
    i = Selection.Rows.Count
    Selection.EntireRow.Insert
    Rows(5005 - i + 1 & ":" & 5005).EntireRow.Delete
    Sheets("xuat").Range("b7:b5006").Value = Sheets("stt").Range("a1:a5000").Value
    Proxuat

ElseIf ActiveSheet.Name = "Nhap" Then
    Unpronhap
    i = Selection.Rows.Count
    Selection.EntireRow.Insert
    Rows(5005 - i + 1 & ":" & 5005).EntireRow.Delete
    Sheets("nhap").Range("b7:b5006").Value = Sheets("stt").Range("a1:a5000").Value
    Pronhap
    
Else
End If

End Sub


Sub in_nx()
If ActiveSheet.Name = "Xuat" Or ActiveSheet.Name = "Nhap" Then
    If ActiveCell.Column = 4 Then
        F_inphieunx.Show
    Else
        MsgBox "VUI LONG CHON TRONG COT 'SO CHUNG TU'", , "THONG BAO"
    End If
Else
    MsgBox "CHI IN DUOC PHIEU KHI O BANG KE NHAP KHO VA XUAT KHO", , "THONG BAO"
End If
End Sub


Sub in_tc()
If ActiveSheet.Name = "Chiphi" Then
    If ActiveCell.Column = 5 Then
        Range("Sochungtu").Value = ActiveCell.Value
        Sheets("thu-chi").Activate
        ActiveSheet.PrintPreview
    Else
        MsgBox "VUI LONG CHON TRONG COT 'CHUNG TU'", , "THONG BAO"
    End If
Else
    MsgBox "CHI IN DUOC PHIEU KHI O BANG KE THU/ CHI", , "THONG BAO"
End If
End Sub

Attribute VB_Name = "PhieuNX"
Sub PN()
'On Error GoTo EX
Application.ScreenUpdating = False
Dim SP As String

Unpronhap
UnproPN

SP = Sheets("pn").Range("i9").Value
Sheets("pn").Range("pn_XOA").ClearContents

If Sheets("pn").Range("pn_check").Value = "" Then
    MsgBox "SO PHIEU KHONG TON TAI", , "THONG BAO"
    Pronhap
Else

Sheets("nhap").Range("c1:p1").EntireColumn.Hidden = False
Sheets("nhap").Range("c1:e1").EntireColumn.Hidden = True
Sheets("nhap").Range("j1").EntireColumn.Hidden = True
Sheets("nhap").Range("m1:o1").EntireColumn.Hidden = True

With Sheets("nhap").Range("nhap_filter")
        .AutoFilter 2, "=" & SP
        .Offset(1, 0).SpecialCells(12).Copy
        Sheets("pn").Range("d15").PasteSpecial xlPasteValues
        .AutoFilter
End With

Sheets("nhap").Range("c1:p1").EntireColumn.Hidden = False

Sheets("nhap").Range("nhap_filter").AutoFilter

Pronhap

Sheets("pn").Range("d15:d115").EntireRow.autofit
Sheets("pn").Range("c14:i115").AutoFilter 2, "<>"

End If

ProPN

Sheets("pn").Activate
Sheets("pn").Range("L1").Select
Application.ScreenUpdating = True



'Exit Sub
'EX: Exit Sub
End Sub

Sub PX()
On Error GoTo ex
Application.ScreenUpdating = False
Dim SP As String

Unproxuat
UnproPX

SP = Sheets("PX").Range("i9").Value
Sheets("PX").Range("PX_XOA").ClearContents

If Sheets("px").Range("px_check").Value = "" Then
    MsgBox "SO PHIEU KHONG TON TAI", , "THONG BAO"
    Proxuat
Else


    Sheets("xuat").Range("c1:r1").EntireColumn.Hidden = False
    Sheets("xuat").Range("c1:e1").EntireColumn.Hidden = True
    Sheets("xuat").Range("h1").EntireColumn.Hidden = True
    Sheets("xuat").Range("k1:l1").EntireColumn.Hidden = True
    Sheets("xuat").Range("o1:r1").EntireColumn.Hidden = True
    
    With Sheets("xuat").Range("xuat_filter")
            .AutoFilter 2, "=" & SP
            .Offset(1, 0).SpecialCells(12).Copy
            Sheets("PX").Range("d15").PasteSpecial xlPasteValues
            .AutoFilter
    End With

    Sheets("xuat").Range("c1:r1").EntireColumn.Hidden = False
    Sheets("xuat").Range("xuat_filter").AutoFilter
    
    Proxuat
    
    Sheets("PX").Range("d15:d115").EntireRow.autofit
    Sheets("PX").Range("c14:i115").AutoFilter 2, "<>"
    
    Sheets("PX").Activate
    Sheets("PX").Range("L1").Select

End If
ProPX

Application.ScreenUpdating = True

Exit Sub
ex: Exit Sub
End Sub

Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_activate()
 
 Sheet1.Range("c5").Value = 1
 Sheets("nhap").Range("c65000").End(xlUp).Select
 'Application.CommandBars("Cell").Controls("CUT").Enabled = False

End Sub


Private Sub Worksheet_SelectionChange(ByVal Target As Range)

Dim rMyRg_MH As Range
Dim rMyRg_KH As Range


Set rMyRg_MH = Range("$E$7:$E$5006")
Set rMyRg_KH = Range("$M$7:$M$5006")

Set rMyRg_MH = Application.Intersect(rMyRg_MH, Target)
Set rMyRg_KH = Application.Intersect(rMyRg_KH, Target)

'Hien thi chon ma khach hang gui
If Target.Count > 1 Then Exit Sub

If Not rMyRg_MH Is Nothing Then

    If F_MHN.Visible = False Then

        F_MHN.Show

        
    End If

End If


Set rMyRg_MH = Nothing


'Hien thi chon ma khach hang

If Not rMyRg_KH Is Nothing Then

    If F_KH.Visible = False Then

        F_KH.Show

        
    End If

End If

Set rMyRg_KH = Nothing


End Sub

Private Sub Worksheet_Change(ByVal Target As Range)

If Target.Count > 1 Then Exit Sub
On Error GoTo err:

    If Not Intersect(Target, Target.Worksheet.Range("h7:h5006")) Is Nothing Then
        Target.Offset(0, 2).Value = Target.Value * Target.Offset(0, 1).Value
        Target.Offset(0, 4).Value = Target.Offset(0, 2).Value * (1 + Target.Offset(0, 3).Value)
        'Target.Offset(0, 5).Select
    End If
    
    If Not Intersect(Target, Target.Worksheet.Range("i7:i5006")) Is Nothing Then
        Target.Offset(0, 1).Value = Target.Value * Target.Offset(0, -1).Value
        Target.Offset(0, 3).Value = Target.Offset(0, 1).Value * (1 + Target.Offset(0, 2).Value)
    End If
    
    If Not Intersect(Target, Target.Worksheet.Range("k7:k5006")) Is Nothing Then
        Target.Offset(0, 1).Value = Target.Offset(0, -1).Value * (1 + Target.Value)
    End If

Exit Sub

err: MsgBox "Ban vui long kiem tra lai So luong / Don gia cua mat hang vua nhap"

End Sub
Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Private Sub worksheet_deactivate()
 
 Sheet1.Range("c5").Value = 1
 Sheet21.Range("c5").Value = 1

End Sub



Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub worksheet_deactivate()
 
 Sheet1.Range("c5").Value = 1
 Sheet21.Range("c5").Value = 1

End Sub
Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_activate()
 
 Sheets("chiphi").Range("d65000").End(xlUp).Select

End Sub
Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_activate()
 
 Sheet21.Range("c5").Value = 1
 Sheets("xuat").Range("c65000").End(xlUp).Select

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)

Dim rMyRg_MH As Range
Dim rMyRg_KH As Range


Set rMyRg_MH = Range("$E$7:$E$5006")
Set rMyRg_KH = Range("$O$7:$O$5006")

Set rMyRg_MH = Application.Intersect(rMyRg_MH, Target)
Set rMyRg_KH = Application.Intersect(rMyRg_KH, Target)

'Hien thi chon ma khach hang gui
If Target.Count > 1 Then Exit Sub

If Not rMyRg_MH Is Nothing Then

    If F_MHX.Visible = False Then

        F_MHX.Show

        
    End If

End If



Set rMyRg_MH = Nothing


'Hien thi chon ma khach hang

If Not rMyRg_KH Is Nothing Then

    If F_KH.Visible = False Then

        F_KH.Show

        
    End If

End If

Set rMyRg_KH = Nothing


End Sub



Private Sub Worksheet_Change(ByVal Target As Range)

If Target.Count > 1 Then Exit Sub
'On Error GoTo err:
If Not IsNumeric(Target.Value) Then Exit Sub
    If Not Intersect(Target, Target.Worksheet.Range("I7:I5006")) Is Nothing Then
    
            Target.Offset(0, 2).Value = Target.Value * Target.Offset(0, 1).Value
            Target.Offset(0, 5).Value = Target.Offset(0, 2).Value * (1 + Target.Offset(0, 4).Value)
        
            'TINH GIA VON
            Sheets("xuat").Range("check_slxuat").Value = Target.Value
            If Target.Value > Target.Offset(0, -1).Value Then
                MsgBox "SO LUONG TON KHONG DU DE XUAT", , "CANH BAO"
                Target.ClearContents
            Else
                Target.Offset(0, 3).Value = Target.Value * Sheets("xuat").Range("tk_dgv").Value
                Sheets("XUAT").Range("tk_dgv").ClearContents
                'Target.Offset(0, 6).Select
            End If

        'ThisWorkbook.Save
        
    End If
    
    If Not Intersect(Target, Target.Worksheet.Range("J7:J5006")) Is Nothing Then
        Target.Offset(0, 1).Value = Target.Value * Target.Offset(0, -1).Value
        Target.Offset(0, 4).Value = Target.Offset(0, 1).Value * (1 + Target.Offset(0, 3).Value)
    End If
    
    If Not Intersect(Target, Target.Worksheet.Range("M7:M5006")) Is Nothing Then
        Target.Offset(0, 1).Value = Target.Offset(0, -2).Value * (1 + Target.Value)
    End If

'Exit Sub

'err: MsgBox "Ban vui long kiem tra lai So luong / Don gia cua mat hang vua nhap"

End Sub

Attribute VB_Name = "Sheet25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet31"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Private Sub worksheet_deactivate()

 Sheet1.Range("c5").Value = 1
 Sheet21.Range("c5").Value = 1

End Sub
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub worksheet_deactivate()

 Sheet1.Range("c5").Value = 1
 Sheet21.Range("c5").Value = 1

End Sub



Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sothanhchu"
'ref: huuthang_bd - giaiphapexcel.com

Function DocSo(ByVal Number, Optional ByVal Font = 1) As String
Dim MyArray
Dim Str
Str = Format(Abs(Number), "000000000000000000")
Select Case Font
Case 1
MyArray = Array("kh|fffd|ng ", "m" & ChrW(7897) & "t ", "hai ", "ba ", "b" & ChrW(7889) & "n ", "n" & ChrW(259) & "m ", "s|fffd|u ", "b" & ChrW(7843) & "y ", "t|fffd|m ", "ch|fffd|n ", "tri" & ChrW(7879) & "u, ", "ng|fffd|n, ", "t" & ChrW(7927) & ", ", "tri" & ChrW(7879) & "u, ", "ng|fffd|n, ", "", "tr" & ChrW(259) & "m ", "m" & ChrW(432) & ChrW(417) & "i ", "kh|fffd|ng " & "m" & ChrW(432) & ChrW(417) & "i" & " kh|fffd|ng ", "kh|fffd|ng " & "m" & ChrW(432) & ChrW(417) & "i", "l" & ChrW(7867), "m" & ChrW(432) & ChrW(417) & "i" & " kh|fffd|ng", "m" & ChrW(432) & ChrW(417) & "i", "m" & ChrW(432) & ChrW(417) & "i" & " n" & ChrW(259) & "m", "m" & ChrW(432) & ChrW(417) & "i" & " l" & ChrW(259) & "m", "m" & ChrW(7897) & "t " & "m" & ChrW(432) & ChrW(417) & "i", "m" & ChrW(432) & ChrW(7901) & "i", "m" & ChrW(432) & ChrW(417) & "i" & " m" & ChrW(7897) & "t", "m" & ChrW(432) & ChrW(417) & "i" & " m" & ChrW(7889) & "t", "|fffd|m ")
Case 2
MyArray = Array("kho|fffd|ng ", "mo|fffd|t ", "hai ", "ba ", "bo|fffd|n ", "na|fffd|m ", "sa|fffd|u ", "ba|fffd|y ", "ta|fffd|m ", "ch|fffd|n ", "trie|fffd|u, ", "nga|fffd|n, ", "ty|fffd|, ", "trie|fffd|u, ", "nga|fffd|n, ", "", "tra|fffd|m ", "m|fffd||fffd|i ", "kho|fffd|ng m|fffd||fffd|i kho|fffd|ng ", "kho|fffd|ng m|fffd||fffd|i", "le|fffd|", "m|fffd||fffd|i kho|fffd|ng", "m|fffd||fffd|i", "m|fffd||fffd|i na|fffd|m", "m|fffd||fffd|i la|fffd|m", "mo|fffd|t m|fffd||fffd|i", "m|fffd||fffd||fffd|i", "m|fffd||fffd|i mo|fffd|t", "m|fffd||fffd|i mo|fffd|t", "A|fffd|m ")
Case 3
MyArray = Array("kh|fffd|ng ", "m|fffd|t ", "hai ", "ba ", "b|fffd|n ", "n|fffd|m ", "s|fffd|u ", "b|fffd|y ", "t|fffd|m ", "ch|fffd|n ", "tri|fffd|u, ", "ng|fffd|n, ", "t|fffd|, ", "tri|fffd|u, ", "ng|fffd|n, ", "", "tr|fffd|m ", "m|fffd||fffd|i ", "kh|fffd|ng m|fffd||fffd|i kh|fffd|ng ", "kh|fffd|ng m|fffd||fffd|i", "l|fffd|", "m|fffd||fffd|i kh|fffd|ng", "m|fffd||fffd|i", "m|fffd||fffd|i n|fffd|m", "m|fffd||fffd|i l|fffd|m", "m|fffd|t m|fffd||fffd|i", "m|fffd||fffd|i", "m|fffd||fffd|i m|fffd|t", "m|fffd||fffd|i m|fffd|t", "|fffd|m ")
End Select
If Str = "000000000000000000" Then
    DocSo = UCase(Left(MyArray(0), 1)) & Trim(Mid(MyArray(0), 2)) & ""
    Exit Function
End If
For i = 1 To Len(Str)
If Left(Str, i) <> 0 And Mid(Str, (Int((i + 2) / 3) - 1) * 3 + 1, 3) <> 0 Then
    DocSo = DocSo & MyArray(Mid(Str, i, 1)) & MyArray(-(9 + i / 3) * (i Mod 3 = 0) - (15 + i Mod 3) * (i Mod 3 <> 0))
ElseIf i = 9 And Mid(Str, 7, 3) = 0 And Left(Str, 6) <> 0 Then
    DocSo = DocSo & MyArray(12)
End If
Next
DocSo = Trim(Replace(Replace(Replace(Replace(Replace(Replace(DocSo, MyArray(18), MyArray(15)), MyArray(19), MyArray(20)), MyArray(21), MyArray(22)), MyArray(23), MyArray(24)), MyArray(25), MyArray(26)), MyArray(27), MyArray(28)))
If Number < 0 Then
DocSo = MyArray(29) & DocSo
End If
DocSo = Replace(UCase(Left(DocSo, 1)) & Mid(DocSo, 2) & "", ",", "")
End Function

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Sub workbook_open()
On Error Resume Next
Application.StatusBar = "BAN QUYEN: WEBKYNANG.VN; HOTLINE: 038 997 8430; EMAIL: WEBKYNANG.VN@GMAIL.COM"
Sheets("menu").Activate
With Application
   .OnKey "^x", ""
   .OnKey "^a", ""
   .CellDragAndDrop = False
   .CommandBars("Cell").Controls("CUT").Enabled = False
End With

    Dim contextMenu As CommandBar
    Set contextMenu = Application.CommandBars("cell")
    With contextMenu.Controls.Add(Type:=msoControlButton, Before:=1)
        .OnAction = "Deleterow"
        .FaceId = 67
        .Caption = Range("cap_del").Value
        .Tag = "brccm"
    End With
    
    With contextMenu.Controls.Add(Type:=msoControlButton, Before:=1)
        .OnAction = "Insertrow"
        .FaceId = 19
        .Caption = Range("cap_ins").Value
        .Tag = "brccm"
    End With
    
    With contextMenu.Controls.Add(Type:=msoControlButton, Before:=1)
        .OnAction = "IN_NX"
        .FaceId = 19
        .Caption = Range("cap_print").Value
        .Tag = "brccm"
    End With
    
    With contextMenu.Controls.Add(Type:=msoControlButton, Before:=1)
        .OnAction = "IN_TC"
        .FaceId = 19
        .Caption = Range("cap_thuchi").Value
        .Tag = "brccm"
    End With
End Sub


Private Sub Workbook_BeforeClose(Cancel As Boolean)

  'ThisWorkbook.Save

With Application
   .OnKey "^x"
   .OnKey "^a"
   .CellDragAndDrop = True
   .CommandBars("Cell").Controls("CUT").Enabled = True
End With

Dim contextMenu As CommandBar
    Set contextMenu = Application.CommandBars("cell")
    
    For Each ctrl In contextMenu.Controls
        If ctrl.Tag = "brccm" Then
            ctrl.Delete
        End If
    Next ctrl

Sheets("menu").Activate
'ThisWorkbook.Save

End Sub


Sub resst_rightclick_menu()
    Application.CommandBars("Cell").Reset
End Sub
Attribute VB_Name = "autofit"
Sub auto_chiphi()
    UnproChiphi
    Sheets("chiphi").Range("C10:C4509").EntireRow.autofit
    ProChiphi
End Sub
Attribute VB_Name = "chonngay"
Sub BH_start()
    Sheets("ban hang").Range("BHCT_start").Select
    CalendarFrm.Show
End Sub
Sub BH_end()
    Sheets("ban hang").Range("BHCT_end").Select
    CalendarFrm.Show
End Sub

Sub SQ_start()
    Sheets("soquy").Range("RSQ_start").Select
    CalendarFrm.Show
End Sub
Sub SQ_end()
    Sheets("soquy").Range("RSQ_end").Select
    CalendarFrm.Show
End Sub

Sub modNXT_start()
    Sheets("nxt").Range("nxt_start").Select
    CalendarFrm.Show
End Sub
Sub modNXT_end()
    Sheets("nxt").Range("nxt_end").Select
    CalendarFrm.Show
End Sub


Attribute VB_Name = "command_button"
'DMKH, DMHH

Sub cmdDMHH_sx()
    sx_DMhh
End Sub

Sub cmdDMHH_sua()
    F_suaHH.Show
End Sub

Sub cmdDMHH_them()
    F_themHH.Show
End Sub

Sub cmdDMKH_sx()
    sx_DMKH
End Sub

Sub cmdDMKH_them()
    F_themKH.Show
End Sub

Sub cmdDMKH_sua()
    F_suaKH.Show
End Sub



'NHAP KHO

Sub cmdnhap_nhaphang()
     mahang.Show
End Sub

Sub cmdnhap_tra1phan()
    F_tratiensau.Show
End Sub

Sub cmdnhap_tra100()
    F_tratienngay.Show
End Sub

'XUAT KHO

Sub cmdxuat_xuathang()
     xuathang.Show
End Sub

Sub cmdxuat_thu1phan()
    F_thutiensau.Show
End Sub

Sub cmdxuat_thu100()
    F_thutienngay.Show
End Sub


'BAO CAO

Sub cmd_131ct()
 
ct131.Show

End Sub

Sub cmd_131th()
 
th131.Show

End Sub


Sub cmd_NXT()
 Sheet1.Range("c5").Value = 56
 Sheet21.Range("c5").Value = 56
 UnproNXT
 Sheet31.Range("NXT_COPY").Copy
 Sheet31.Range("NXT_PASTE").PasteSpecial xlPasteFormulas
 Sheet31.Range("NXT_PASTE").Value = Sheet31.Range("NXT_PASTE").Value
 Sheet31.Range("c11").Select
 ProNXT
End Sub

Sub cmd_BH()
Application.ScreenUpdating = False
 
Sheet1.Range("c5").Value = 56
Sheet21.Range("c5").Value = 56
UnproBH
Sheet8.Range("bh_copy").Copy
Sheet8.Range("bh_paste").PasteSpecial xlPasteFormulas
Sheet8.Range("bh_paste").Value = Sheet8.Range("bh_paste").Value
Sheet8.Range("D13:D1012").EntireRow.autofit
Sheet8.Range("d13").Select
ProBH
Application.ScreenUpdating = True
End Sub

Sub cmd_QUY()
    UnproSQ
    baocao_quy
    ProSQ
End Sub

Attribute VB_Name = "ct131"
Attribute VB_Base = "0{E9939653-64AE-4701-881F-8CC8A85B051A}{03F94217-D61E-4D5E-8256-6E7FE9B3D8CB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub locmakh_Change()
Sheets("dmkh").Range("timKH").Value = Me.locmakh.Value
Me.KHlist.RowSource = "KHfind"

End Sub

Private Sub start131_AfterUpdate()
Me.start131.Value = Format(start131, "dd-mmm-yyyy")
End Sub

Private Sub end131_AfterUpdate()

Me.end131.Value = Format(end131, "dd-mmm-yyyy")
End Sub

Private Sub Thoat_Click()
Unload Me
End Sub

Private Sub UserForm_activate()
    Sheets("DMKH").Range("LoaiKH").ClearContents
    Sheets("dmkh").Range("timKH").ClearContents
    Me.KHlist.RowSource = "KHfind"
    
End Sub

Private Sub xem_Click()

Application.ScreenUpdating = False

Sheet10.Range("chitiet_ma").Value = Me.KHlist.Value
Sheet10.Range("chitiet_start").Value = Me.start131.Value
Sheet10.Range("chitiet_end").Value = Me.end131.Value
Sheets("131ct").Range("chitiet_XOA").ClearContents
Sheet1.Range("c5").Value = 5006
Sheet21.Range("c5").Value = 5006

If Sheet10.Range("chitiet_check").Value > 0 Then
    If Sheet10.Range("chitiet_loai").Value = "KH" Then
        CNCT_KH
    Else
        CNCT_NCC
    End If
Else
    MsgBox "KHONG PHAT SINH GIAO DICH", , "THONG BAO"
End If

Application.ScreenUpdating = True
Unload Me
End Sub
Attribute VB_Name = "danhmuc"
Sub sx_DMKH()

    ActiveWorkbook.Worksheets("DMKH").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("DMKH").Sort.SortFields.Add Key:=Range("C7:C1006"), _
        SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("DMKH").Sort
        .SetRange Range("C7:j1006")
        .Header = xlGuess
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
End Sub

Sub sx_DMhh()

    ActiveWorkbook.Worksheets("DM").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("DM").Sort.SortFields.Add Key:=Range("C7:C1006"), _
        SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("DM").Sort
        .SetRange Range("C7:l1006")
        .Header = xlGuess
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
End Sub


Attribute VB_Name = "mahang"
Attribute VB_Base = "0{D5F18483-4E5D-4A04-9470-6374C4BAD10C}{E4CB0C6A-F706-488B-B480-3BAA4FC0AE3A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
Dim i As Long
i = Sheet1.Range("c65000").End(xlUp).Row + 1

Application.Calculation = xlCalculationManual

Sheet1.Range("f5").Value = Me.N_sophieu.Value
Sheet1.Range("c" & i).Value = Me.n_ngay.Value
'Sheet1.Range("d" & i).Value = Me.N_sophieu.Value & "-TT"
Sheet1.Range("f" & i).Value = "Thanh toan luon tien cho NCC"
Sheet1.Range("m" & i).Value = Me.KHlist.Value
Sheet1.Range("n" & i).Value = Sheet1.Range("g5").Value

Application.Calculation = xlCalculationAutomatic

MsgBox ("Ban da LUU thanh toan tien NCC thanh cong")
Unload Me

End Sub

Private Sub dg_Change()
    Me.dg.Value = Format(dg.Value, "#,#")
End Sub

Private Sub HHList_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
  Me.NhomHang.Value = Me.HHList.Value
End Sub


Private Sub inphieu_Click()

Dim i As Long

Sheet4.Range("h9").Value = Me.N_sophieu.Value

Sheet1.Range("c5").Formula = "=IF(COUNTA(C7:C3000)=0,1,COUNTA(C7:C3000))"
 Sheet21.Range("c5").Formula = "=IF(COUNTA(C7:C3000)=0,1,COUNTA(C7:C3000))"
 Sheet1.Range("D5").Formula = "=MATCH(PN!H9,NHAP!$D$7:$D$3000,0)+COUNTIF(NHAP!$D$7:$D$3000,PN!H9)"
Sheet4.Unprotect Password:="58577xlkghsdjDHKHL124Dss"
Sheet4.Range("$c$17:$l$67").AutoFilter Field:=10, Criteria1:="<>"
Sheet4.Protect Password:="58577xlkghsdjDHKHL124Dss", DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=True, AllowInsertingRows _
        :=True, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=True, _
        AllowDeletingRows:=True, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
        

Unload Me
Sheet4.PrintPreview
Sheet1.Activate
i = Sheet1.Range("c65000").End(xlUp).Row + 1
Sheet1.Range("c" & i).Select

End Sub

Private Sub locmakh_Change()
Sheets("dmkh").Range("timKH").Value = Me.locmakh.Value
Me.KHlist.RowSource = "KHfind"

End Sub

Private Sub N_gia_Change()
    Me.N_gia.Value = Format(N_gia, "#,###")
End Sub


Private Sub N_sl_Change()
    Me.N_SL.Value = Format(N_SL, "#,###")
End Sub

Private Sub n_ngay_afterupdate()
            
    Me.n_ngay.Value = Format(n_ngay, "dd-mmm-yyyy")
    
End Sub

Private Sub NHAP_Click()
    Dim i As Long
    i = Sheet1.Range("C65000").End(xlUp).Row + 1
    
    If i > 56 Then GoTo err
    

    If Me.n_ngay.Value = "" Then
        MsgBox "BAN CHUA NHAP NGAY THANG", , "THONG BAO"
    ElseIf Me.KHlist.Text = "" Then
        MsgBox "BAN CHUA CHON MA NHA CUNG CAP NAO", , "THONG BAO"
    ElseIf Me.HHList.Text <> "" Then
       
        Application.Calculation = xlCalculationManual
        
        Sheet1.Range("C" & i).Value = Me.n_ngay.Value
        Sheet1.Range("D" & i).Value = Me.N_sophieu.Value
               
        Sheet1.Range("e" & i).Value = Me.HHList.Value
        Sheet1.Range("f" & i).Value = Me.HHList.Column(1)
        Sheet1.Range("g" & i).Value = Me.HHList.Column(2)
    
        Sheet1.Range("h" & i).Value = Me.N_SL.Value
        
        If Me.dg.Value = "" Then
            Sheet1.Range("i" & i).Value = Me.HHList.Column(3)
        Else
            Sheet1.Range("i" & i).Value = Me.dg.Value
        End If
        Sheet1.Range("k" & i).Value = Me.HHList.Column(5)
        Sheet1.Range("m" & i).Value = Me.KHlist.Value
        Sheet1.Range("n" & i).Value = Me.KHlist.Column(1)
        
        Application.Calculation = xlCalculationAutomatic
    Else
        MsgBox "BAN CHUA CHON MAT HANG NAO", , "THONG BAO"
    End If
    
Exit Sub
err: MsgBox "HET GIOI HAN SO BAN GHI DUOC NHAP, BAN VUI LONG LIEN HE BQT: WEBKYNANG.VN@GMAIL.COM", , "THONG BAO"
    

End Sub

Private Sub NhomHang_Change()
    Range("Tim").Value = Me.NhomHang.Value
    Me.HHList.RowSource = "HHFind"
End Sub

Private Sub themhh_Click()
    F_themHH.Show
End Sub

Private Sub themkh_Click()
    F_themKH.Show
End Sub

Private Sub Thoat_Click()
    Unload Me
    ThisWorkbook.Save
End Sub

Private Sub UserForm_activate()
    Me.n_ngay.Value = Format(Date, "dd-mmm-yyyy")
    Sheets("DMKH").Range("LoaiKH").Value = "NCC"
    
    Sheets("dmkh").Range("timkh").ClearContents
    Me.KHlist.RowSource = "khfind"
    
    Range("Tim").ClearContents
    Me.HHList.RowSource = "HHFind"
    
    
End Sub

Attribute VB_Name = "mod_backup"
Sub backup()

If MsgBox("BAN CO MUON SAO LUU LIEU ?", vbYesNo, "RESTORE BACKUP") = vbNo Then Exit Sub
Application.ScreenUpdating = False
    Dim FName           As String
    Dim FPath           As String
    Dim NewBook         As Workbook
 
    FPath = Sheets("menu").Range("backuppath").Value
    FName = "Backup phan mem - " & Format(Date, "ddmmyyyy") & ".xls"
    
    backup_copydulieu
    
    Set NewBook = Workbooks.Add
    ThisWorkbook.Sheets("backup").Copy Before:=NewBook.Sheets(1)
    NewBook.SaveAs Filename:=FPath & "\" & FName
    NewBook.Close
    
    backup_xoadulieu
    MsgBox "BAN DA SAO LUU DU LIEU THANH CONG VAO FOLDER:" & vbNewLine & vbNewLine & _
    FPath
    
Application.ScreenUpdating = True
End Sub


Sub backup_copydulieu()

    Sheets("backup").Range("backup_nhap").Value = Sheets("NHAP").Range("nhap_xoa").Value
    Sheets("backup").Range("backup_xuat").Value = Sheets("xuat").Range("xuat_xoa").Value
    Sheets("backup").Range("backup_dmhh").Value = Sheets("dm").Range("dmhh_xoa").Value
    Sheets("backup").Range("backup_dmkh").Value = Sheets("dmkh").Range("dmkh_xoa").Value
    Sheets("backup").Range("backup_thuchi").Value = Sheets("chiphi").Range("thuchi_clear").Value
    
End Sub

Sub backup_xoadulieu()

    Sheets("backup").Range("backup_nhap").ClearContents
    Sheets("backup").Range("backup_xuat").ClearContents
    Sheets("backup").Range("backup_dmhh").ClearContents
    Sheets("backup").Range("backup_dmkh").ClearContents
    Sheets("backup").Range("backup_thuchi").ClearContents
    
End Sub


Sub restore_backup()

If MsgBox("BAN CO MUON KHOI PHUC DU LIEU BACKUP ?", vbYesNo, "RESTORE BACKUP") = vbNo Then Exit Sub

    Dim link As String
    With Application.FileDialog(msoFileDialogOpen)
        .Show
        link = .SelectedItems(1)
    End With
    
    Application.ScreenUpdating = False
    
    Dim x As Workbook
    Dim y As Workbook
    
    Set x = Workbooks.Open(link)
    Set y = ThisWorkbook
    
    y.Sheets("chiphi").Range("thuchi_clear").Value = x.Sheets("BACKUP").Range("BACKUP_thuchi").Value
    y.Sheets("dmkh").Range("dmkh_xoa").Value = x.Sheets("BACKUP").Range("BACKUP_dmkh").Value
    y.Sheets("dm").Range("dmhh_xoa").Value = x.Sheets("BACKUP").Range("BACKUP_dmhh").Value
    y.Sheets("nhap").Range("nhap_xoa").Value = x.Sheets("BACKUP").Range("BACKUP_nhap").Value
    y.Sheets("xuat").Range("xuat_xoa").Value = x.Sheets("BACKUP").Range("BACKUP_xuat").Value
    
    x.Close savechanges:=False
    Sheets("menu").Activate
    Application.ScreenUpdating = True
    
    MsgBox "PHAN MEM DA HOAN TAT VIEC TAI DU LIEU TU FILE BACKUP LEN PHAN MEM", , "KHOI PHUC DU LIEU THANH CONG"
    
End Sub


Sub GetFilePath()

Dim objFSO As New FileSystemObject
Dim link As String

Set myFile = Application.FileDialog(msoFileDialogOpen)
With myFile
.Title = "Choose File"
.AllowMultiSelect = False
If .Show <> -1 Then
Exit Sub
End If
fileselected = .SelectedItems(1)
End With

MsgBox link = fileselected

'ActiveSheet.Range("A1") = FileSelected 'The file path
'ActiveSheet.Range("A2") = objFSO.GetFileName(FileSelected) 'The file name
End Sub
Attribute VB_Name = "mod_taoky"
Sub Taokymoi()
    If MsgBox("BAN CO MUON TAO KY MOI ?", vbYesNo, "THONG BAO") = vbNo Then Exit Sub
    
    ThisWorkbook.Save

    FPath = ThisWorkbook.Path
    FName = "PHAN MEM BAN HANG 1.4 PRO - TU NGAY " & Format(Date, "yyyy-mm-dd") & ".xlsm"
    
    ThisWorkbook.SaveAs Filename:=FPath & "\" & FName

    Sheet1.Range("c5").Value = 5006
    Sheet21.Range("c5").Value = 5006


    'Chuyen so du cong no phai thu/ phai tra
    
    Sheets("DMKH").Range("tkDMKH_copy").Copy
    Sheets("DMKH").Range("tkDMKH_paste").PasteSpecial xlPasteFormulas
    Sheets("DMKH").Range("tkDMKH_paste1").Value = Sheets("DMKH").Range("tkDMKH_paste").Value
    Sheets("DMKH").Range("tkDMKH_paste").ClearContents
    
    'Chuyen so du ton kho
    
    Sheets("DM").Range("tkDM_copy").Copy
    Sheets("DM").Range("tkDM_paste").PasteSpecial xlPasteFormulas
    Sheets("DM").Range("tkDM_paste1").Value = Sheets("DM").Range("tkDM_paste").Value
    Sheets("DM").Range("tkDM_paste").ClearContents
    
    'Xoa du lieu nhap, xuat, thu, chi
    
    Sheets("nhap").Range("nhap_clear").ClearContents
    Sheets("xuat").Range("xuat_clear").ClearContents
    Sheets("chiphi").Range("thuchi_clear").ClearContents
    
    
    MsgBox "BAN DA TAO KY MOI THANH CONG" & vbNewLine & vbNewLine _
    & "PHAN MEM MOI NAM CUNG FOLDER VOI PHAN MEM TRUOC DO", , "THONG BAO"
    
End Sub
Attribute VB_Name = "pass"
Private Const pass As String = "58577xlkghsdjDHKHL124Dss"

Sub UnproH()
    Sheets("thekho").Unprotect (pass)
End Sub

Sub ProH()
    Sheets("dmncc").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Sub Unproxuat()
    Sheets("xuat").Unprotect (pass)
End Sub

Sub Proxuat()
    Sheets("xuat").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub


Sub Unpronhap()
    Sheets("nhap").Unprotect (pass)
End Sub

Sub Pronhap()
    Sheets("nhap").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Sub UnproCNCT()
    Sheets("131ct").Unprotect (pass)
End Sub

Sub ProCNCT()
    Sheets("131ct").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Sub UnproCNTH()
    Sheets("131th").Unprotect (pass)
End Sub

Sub ProCNTH()
    Sheets("131th").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Sub UnproPN()
    Sheets("pn").Unprotect (pass)
End Sub

Sub ProPN()
    Sheets("pn").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Sub UnproPX()
    Sheets("PX").Unprotect (pass)
End Sub

Sub ProPX()
    Sheets("PX").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub


Sub UnproNXT()
    Sheets("NXT").Unprotect (pass)
End Sub

Sub ProNXT()
    Sheets("NXT").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Sub UnproBH()
    Sheets("ban hang").Unprotect (pass)
End Sub

Sub ProBH()
    Sheets("ban hang").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub
Sub UnproSQ()
    Sheets("soquy").Unprotect (pass)
End Sub

Sub ProSQ()
    Sheets("soquy").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Sub UnproBCQT()
    Sheets("BCQT").Unprotect (pass)
End Sub

Sub ProBCQT()
    Sheets("BCQT").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub


Sub UnproChiphi()
    Sheets("Chiphi").Unprotect (pass)
End Sub

Sub ProChiphi()
    Sheets("Chiphi").Protect (pass), DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingColumns:=False, AllowInsertingRows _
        :=False, AllowInsertingHyperlinks:=True, AllowDeletingColumns:=False, _
        AllowDeletingRows:=False, AllowSorting:=True, AllowFiltering:=True, _
        AllowUsingPivotTables:=True
End Sub

Attribute VB_Name = "ribbon"
Sub Banquyen(control As IRibbonControl)
On Error GoTo err:
    M_banquyen.Show
Exit Sub
err: MsgBox "- KHACH HANG: Ban Mien phi" & vbNewLine & vbNewLine & "- THIET KE: CONG TY TNHH WEBKYNANG VIET NAM", , "THONG TIN BAN QUYEN"
End Sub

Sub taoky(control As IRibbonControl)
On Error GoTo err:
    Taokymoi
err: Exit Sub
End Sub

Sub saoluu(control As IRibbonControl)
On Error GoTo err:
    backup
err: Exit Sub
End Sub

Sub khoiphuc(control As IRibbonControl)
On Error GoTo err:
    restore_backup
err: Exit Sub
End Sub

Sub lienhe(control As IRibbonControl)
On Error GoTo err:
    M_about.Show
    Exit Sub
err: MsgBox "- Email: Webkynang.vn@gmail.com" & vbNewLine & vbNewLine & "- Hotline: 0168-997-8430" & vbNewLine & vbNewLine & "- Phone: 024-2239-7373", , "THONG TIN LIEN HE"
End Sub

Sub video(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="Http://webkynang.vn/1-4", NewWindow:=True
err: Exit Sub
End Sub

Sub all(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="Http://webkynang.vn/download", NewWindow:=True
err: Exit Sub
End Sub

Sub thuchi(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://excel.webkynang.vn/thiet-ke-file-excel/phieu-thu-chi-tren-excel-ban-mau/", NewWindow:=True
err: Exit Sub
End Sub

Sub crm(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="Http://webkynang.vn/crm", NewWindow:=True
err: Exit Sub
End Sub

Sub nhansu(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://webkynang.vn/phan-mem-quan-ly-nhan-su/", NewWindow:=True
err: Exit Sub
End Sub

Sub dongtien(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://webkynang.vn/quan-ly-dong-tien/", NewWindow:=True
err: Exit Sub
End Sub

Sub donhang(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://excel.webkynang.vn/mau-file-quan-ly-don-hang-bang-excel/", NewWindow:=True
err: Exit Sub
End Sub

Sub baogia(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://excel.webkynang.vn/bang-bao-gia-mau-dep-chuyen-nghiep-tren-excel-download-free/", NewWindow:=True
err: Exit Sub
End Sub

Sub quantri(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://webkynang.vn/bao-cao-quan-tri/", NewWindow:=True
err: Exit Sub
End Sub

Sub congviec(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://excel.webkynang.vn/mau-file-excel-lap-ke-hoach-cong-viec/", NewWindow:=True
err: Exit Sub
End Sub

Sub ketoan(control As IRibbonControl)
On Error GoTo err:
    ActiveWorkbook.FollowHyperlink Address:="http://excel.webkynang.vn/phan-mem-ke-toan-excel-mien-phi-qd-48-15-moi-nhat/", NewWindow:=True
err: Exit Sub
End Sub
Attribute VB_Name = "soquy"
Sub baocao_quy()

On Error GoTo ex

Dim ArrQUY, Res
Dim i As Long, j As Long, k As Long, dk As Long, dk1 As Long
Dim fDate As Date, tDate As Date

Sheets("soquy").Range("sq_dk").Formula = "=SUMIFS(BKCP_SOTIEN,BKCP_Chungtu,""PT*"",BKCP_NGAY,""<""&RSQ_start)-SUMIFS(BKCP_SOTIEN,BKCP_Chungtu,""PC*"",BKCP_NGAY,""<""&RSQ_start)"
Sheets("soquy").Range("sq_dk").Value = Sheets("soquy").Range("sq_dk").Value

dk = Sheets("soquy").[sq_dk]

fDate = Sheets("soquy").[rsq_start]
tDate = Sheets("soquy").[rsq_end]
ArrQUY = Sheets("CHIPHI").Range("d10:k" & Sheets("Chiphi").Range("d665536").End(3).Row)
ReDim Res(1 To UBound(ArrQUY, 1), 1 To 7)

Range("c18:i1000").ClearContents
    For i = 1 To UBound(ArrQUY, 1)
        If ArrQUY(i, 1) >= fDate And ArrQUY(i, 1) <= tDate Then
        If UCase(ArrQUY(i, 2)) Like "PT*" Or UCase(ArrQUY(i, 2)) Like "PC*" Then
            k = k + 1
            Res(k, 1) = ArrQUY(i, 1)
            Res(k, 2) = ArrQUY(i, 2)
            Res(k, 3) = ArrQUY(i, 3)
            'Res(k, 7) = ArrQUY(i, 6)
            If k = 1 Then
            dk1 = dk
            Else
            dk1 = Res(k - 1, 6)
            End If
            
            If UCase(ArrQUY(i, 2)) Like "PT*" Then
                Res(k, 4) = ArrQUY(i, 5)
                Res(k, 6) = dk1 + ArrQUY(i, 5)
            ElseIf UCase(ArrQUY(i, 2)) Like "PC*" Then
                Res(k, 5) = ArrQUY(i, 5)
                Res(k, 6) = dk1 - ArrQUY(i, 5)
            End If
        End If
        End If
    Next
'MsgBox k
Sheets("soquy").Range("c18").Resize(k, 7) = Res

Sheets("soquy").Range("c18:i1000").ClearFormats
With Sheets("soquy").Range("c18:i" & Sheets("soquy").Range("c65000").End(xlUp).Row + 1)
        .Borders(xlEdgeLeft).LineStyle = xlContinuous
        .Borders(xlEdgeTop).LineStyle = xlContinuous
        .Borders(xlEdgeBottom).LineStyle = xlContinuous
        .Borders(xlEdgeRight).LineStyle = xlContinuous
        .Borders(xlInsideVertical).LineStyle = xlContinuous
        .Borders(xlInsideHorizontal).LineStyle = xlContinuous
End With

Sheets("soquy").Range("c18:c" & Sheets("soquy").Range("c65000").End(xlUp).Row + 1).NumberFormat = "dd-mm-yyyy"
Sheets("soquy").Range("f18:h" & Sheets("soquy").Range("c65000").End(xlUp).Row + 1).NumberFormat = "#,#"

MsgBox "DA CHAY XONG BAO CAO", , "THONG BAO"
Exit Sub
ex: MsgBox "KHONG PHAT SINH GIAO DICH TRONG KHOANG THOI GIAN BAN CHON", , "THONG BAO"

End Sub



Attribute VB_Name = "th131"
Attribute VB_Base = "0{F3653E0A-BA93-4AAF-9B14-2D8D74198276}{AE048AF5-6A5A-4911-9959-358FB135FA9E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub Thoat_Click()
Unload Me

End Sub

Private Sub xem_Click()
 
 Sheets("131th").Range("congno_start").Value = Me.start131.Value
 Sheets("131th").Range("congno_end").Value = Me.end131.Value
 Sheets("131th").Range("P8").Value = Me.makh131.Value

Sheet1.Range("c5").Value = 5006
Sheet21.Range("c5").Value = 5006
 
UnproCNTH

ActiveSheet.Range("$D$12:$k$1012").AutoFilter Field:=8
Sheets("131th").Range("CNTH_COPY").Copy
Sheets("131th").Range("CNTH_PASTE").PasteSpecial xlPasteFormulas
Sheets("131th").Range("CNTH_PASTE").Value = Sheets("131th").Range("CNTH_PASTE").Value

ActiveSheet.Range("$D$12:$k$1012").AutoFilter Field:=8, Criteria1:=Sheets("131th").Range("P8").Value

ProCNTH

Sheets("131th").Range("d11").Select
Unload Me
End Sub
Attribute VB_Name = "xuathang"
Attribute VB_Base = "0{6908D5C0-9F88-4E46-B16B-89F6B2DDE97B}{526683D2-21E4-448D-8DD2-822B7BAA6A0C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
Dim i As Long
i = Sheet21.Range("c65000").End(xlUp).Row + 1

Application.Calculation = xlCalculationManual

Sheet21.Range("e5").Value = Me.N_sophieu.Value
Sheet21.Range("c" & i).Value = Me.n_ngay.Value
'Sheet21.Range("d" & i).Value = "TT-" & Me.N_sophieu.Value
Sheet21.Range("f" & i).Value = "Thu tien luon"
Sheet21.Range("o" & i).Value = Me.KHlist.Value
Sheet21.Range("p" & i).Value = Me.KHlist.Column(1)
Sheet21.Range("q" & i).Value = Sheet21.Range("f5").Value

Application.Calculation = xlCalculationAutomatic

MsgBox ("Ban da LUU thu tien KH thanh cong")
Unload Me

End Sub

Private Sub dg_Change()
    Me.dg.Value = Format(dg.Value, "#,#")
End Sub

Private Sub inphieu_Click()

Sheet5.Range("i9").Value = Me.N_sophieu.Value
Unload Me
Sheet5.Activate
PX
Sheet5.PrintPreview

End Sub

Private Sub N_gia_Change()
    Me.N_gia.Value = Format(N_gia, "#,###")
End Sub

Private Sub N_sl_Change()
    Me.N_SL.Value = Format(N_SL, "#,###")
End Sub

Private Sub n_ngay_afterupdate()
    Me.n_ngay.Value = Format(n_ngay, "dd-mmm-yyyy")
End Sub


Private Sub NHAP_Click()

Sheets("xuat").Range("check_ma").Value = Me.HHList.Value
Sheets("xuat").Range("check_slxuat").Value = Me.N_SL.Value
Sheets("xuat").Range("check_ngay").Value = Me.n_ngay.Value

If Sheets("xuat").Range("check_slxuat").Value > Sheets("xuat").Range("check_slton").Value Then
    MsgBox "SO LUONG TON KHONG DU DE XUAT", , "CANH BAO"
Else

    Dim i As Long
    i = Sheet21.Range("C65000").End(xlUp).Row + 1
    
        If i > 56 Then GoTo err
    

    
    If Me.n_ngay.Value = "" Then
        MsgBox "BAN CHUA NHAP NGAY THANG", , "THONG BAO"
    ElseIf Me.KHlist.Text = "" Then
        MsgBox "BAN CHUA CHON MA KHACH HANG NAO", , "THONG BAO"
    ElseIf Me.HHList.Text <> "" Then
            
        Sheets("XUAT").Range("tk_dgv").Value = Sheets("XUAT").Range("check_dgvon").Value
        Sheet21.Range("l" & i).Value = Sheets("xuat").Range("check_dgvon").Value * Sheets("xuat").Range("check_slxuat").Value
        
        Application.Calculation = xlCalculationManual
        
        Sheet21.Range("C" & i).Value = Me.n_ngay.Value
        Sheet21.Range("D" & i).Value = Me.N_sophieu.Value
               
        Sheet21.Range("e" & i).Value = Me.HHList.Value
        Sheet21.Range("f" & i).Value = Me.HHList.Column(1)
        Sheet21.Range("g" & i).Value = Me.HHList.Column(2)
        Sheet21.Range("h" & i).Value = Sheets("xuat").Range("check_slton").Value
        Sheet21.Range("i" & i).Value = Me.N_SL.Value
        
        If Me.dg.Value = "" Then
            Sheet21.Range("j" & i).Value = Me.HHList.Column(4)
        Else
            Sheet21.Range("j" & i).Value = Me.dg.Value
        End If
        Sheet21.Range("m" & i).Value = Me.HHList.Column(5)
        
        Sheet21.Range("o" & i).Value = Me.KHlist.Value
        Sheet21.Range("p" & i).Value = Me.KHlist.Column(1)
        
        Application.Calculation = xlCalculationAutomatic
        
    Else
        MsgBox "BAN CHUA CHON MA HANG NAO", , "THONG BAO"
    End If

End If

Exit Sub
err: MsgBox "HET GIOI HAN SO BAN GHI DUOC NHAP, BAN VUI LONG LIEN HE BQT: WEBKYNANG.VN@GMAIL.COM", , "THONG BAO"


End Sub

Private Sub NhomHang_Change()
    Range("Tim").Value = Me.NhomHang.Value
    Me.HHList.RowSource = "HHFind"
End Sub

Private Sub locmakh_Change()
    Sheets("dmkh").Range("timkh").Value = Me.locmakh.Value
    Me.KHlist.RowSource = "KHfind"
End Sub

Private Sub themhh_Click()
    F_themHH.Show
End Sub

Private Sub themkh_Click()
    F_themKH.Show
End Sub

Private Sub Thoat_Click()
    Unload Me
    ThisWorkbook.Save
End Sub

Private Sub UserForm_activate()
    Me.n_ngay.Value = Format(Date, "dd-mmm-yyyy")
    Sheets("DMKH").Range("LoaiKH").Value = "KH"
    
    Sheets("dmkh").Range("timkh").ClearContents
    Me.KHlist.RowSource = "khfind"
    
    Range("Tim").ClearContents
    Me.HHList.RowSource = "HHFind"
    
End Sub





INQUEST-PP=macro
