Attribute VB_Name = "Tabelle12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Sub Check_old_new()
'
' Check_old_new Makro
'
' Tastenkombination: Strg+Umschalt+U
'
' Ein Makro nach der Idee von A. Sezemsky
    
    
Dim i, imax As Integer
Dim txt, sh_o, sh, sh1 As String
Dim f_name, name1, fname2, result, GivePath As String
Dim check_field(50, 1000) As String
Dim nc, pos, stufe, document As String
Dim fDialog
Dim y, x, xmax, ymax, j, k, l, z, n, m, ms, msb, istart, gef, test As Integer
Dim xmax1, ymax1 As Integer

sh_o = "old"
sh = "MaterialData"

On Error Resume Next
ActiveSheet.Previous.Select
If Mid(Application.ActiveSheet.Name, 1, 3) <> "old" And UCase(Mid(Application.ActiveSheet.Name, 1, 2)) <> "DO" Then
    sh = Application.ActiveSheet.Name
Else
    ActiveSheet.Previous.Select
    If Mid(Application.ActiveSheet.Name, 1, 3) <> "old" And UCase(Mid(Application.ActiveSheet.Name, 1, 2)) <> "DO" Then
        sh = Application.ActiveSheet.Name
    Else
        ActiveSheet.Previous.Select
        If Mid(Application.ActiveSheet.Name, 1, 3) <> "old" And UCase(Mid(Application.ActiveSheet.Name, 1, 2)) <> "DO" Then
            
            sh = Application.ActiveSheet.Name
        Else
            ActiveSheet.Next.Select
            ActiveSheet.Next.Select
            ActiveSheet.Next.Select
            ActiveSheet.Next.Select
            If Mid(Application.ActiveSheet.Name, 1, 3) <> "old" And UCase(Mid(Application.ActiveSheet.Name, 1, 2)) <> "DO" Then
                sh = Application.ActiveSheet.Name
            Else
                ActiveSheet.Next.Select
                If Mid(Application.ActiveSheet.Name, 1, 3) <> "old" And UCase(Mid(Application.ActiveSheet.Name, 1, 2)) <> "DO" Then
                    sh = Application.ActiveSheet.Name
                Else
                    MsgBox ("Blatt nicht gefunden!")
                    Exit Sub
                End If
            End If
        End If
    End If
End If
                    
Sheets(sh_o).Select
For i = 2 To 3
    If Cells(i, 1) & Cells(i, 2) & Cells(i, 3) & Cells(i, 4) = "" Then
        txt = "Bitte zuerst die alten Daten in dieses Blatt kopieren" & Chr(10)
        txt = txt & "Please copy the old datas in this sheet first"
        MsgBox (txt)
        Exit Sub
    End If
Next
              
On Error Resume Next

Sheets(sh).Select
Columns("X:AD").Select
Selection.EntireColumn.Hidden = False
Rem ------------------------------------------------------------------
Rem Suche nach der letzten Zeile / letzten Spalte im aktuellen File
Rem ------------------------------------------------------------------
For y = 2 To 59999
    If Sheets(sh).Cells(y, 1) & Sheets(sh).Cells(y, 2) & Sheets(sh).Cells(y, 4) & Sheets(sh).Cells(y, 16) = "" Then
        ymax = y
        Exit For
    End If
Next
For x = 11 To 99
    If Sheets(sh).Cells(1, x) = "" Then xmax = x: Exit For
Next

Rem ------------------------------------------------------------------
Rem Vorbereitung f|fffd|r die Auswertung
Rem ------------------------------------------------------------------
For y = 2 To ymax - 1
    If Sheets(sh).Cells(y, 1) & Sheets(sh).Cells(y, 2) & Sheets(sh).Cells(y, 4) & Sheets(sh).Cells(y, 16) = "" Then
        Sheets(sh).Cells(y, xmax) = "x"
    End If
Next
ymax1 = ymax
Sheets(sh).Cells(ymax, 1) = "Nicht mehr gefundene Positionsnummern / Deleted positonen numbers:"
ymax = ymax + 1

Rem ------------------------------------------------------------------
Rem Suche nach der Materialnummer
Rem ------------------------------------------------------------------
For i = 1 To Len(f_name)
    If Mid(f_name, i, 1) = "_" Or Mid(f_name, i, 1) = "-" Then
        nc = Mid(f_name, 1, i - 1)
        Exit For
    End If
Next

Rem ------------------------------------------------------------------
Rem Suche nach maximaler Anzahl der Spalten, plus Leerspalte
Rem ------------------------------------------------------------------
For x = 1 To 50
    If Sheets(sh_o).Cells(1, x) = "" Then xmax1 = x: Exit For
Next

istart = 2
For l = 1 To 100
    Sheets(sh_o).Select
    Rem ------------------------------------------------------------------
    Rem Speichern aller alten Werte
    Rem ------------------------------------------------------------------
    z = 0
    For y = 1 To 1000
        If (l - 1) * 1000 + y = 1 Then y = 2
        If Cells((l - 1) * 1000 + y, 2) & Cells((l - 1) * 1000 + y, 3) & Cells((l - 1) * 1000 + y, 4) & Cells((l - 1) * 1000 + y, 16) = "" Then             'V4.12
            z = (l - 1) * 1000 + y - 1
            Exit For
        End If
        For x = 1 To xmax1
            check_field(x, (l - 1) * 1000 + y) = Cells((l - 1) * 1000 + y, x)
            If check_field(x, (l - 1) * 1000 + y) = " " Then check_field(x, (l - 1) * 1000 + y) = ""
            Rem ------------------------------------------------------------------
            Rem Wurde Langtext aufgesplittet,
            Rem dann werden die Werte von oben |fffd|bernommen
            Rem ------------------------------------------------------------------
            If Cells((l - 1) * 1000 + y, 1) & Cells((l - 1) * 1000 + y, 2) & Cells((l - 1) * 1000 + y, 4) = "" Then
                If check_field(x, (l - 1) * 1000 + y) = "" And y > 2 Then check_field(x, (l - 1) * 1000 + y) = Cells((l - 1) * 1000 + y - 1, x)
                If check_field(x, (l - 1) * 1000 + y) = "" And y > 3 Then check_field(x, (l - 1) * 1000 + y) = Cells((l - 1) * 1000 + y - 2, x)
                If check_field(x, (l - 1) * 1000 + y) = "" And y > 4 Then check_field(x, (l - 1) * 1000 + y) = Cells((l - 1) * 1000 + y - 3, x)
            End If
        Next
    Next
    
    Sheets(sh).Select
    Rem ------------------------------------------------------------------
    Rem Suche nach den Werten im neuen File
    Rem ------------------------------------------------------------------
    For y = 1 To 1000
        If y = 1 And l = 1 Then y = 2
        gef = 0
        If z >= (l - 1) * 1000 + y - 1 Then
            For i = istart To ymax1
                If Sheets(sh).Cells(i, 1) = " " Then Sheets(sh).Cells(i, 1) = ""
                stufe = Sheets(sh).Cells(i, 1)
                pos = Sheets(sh).Cells(i, 2)
                nc = Sheets(sh).Cells(i, 3)
                document = Sheets(sh).Cells(i, 5) & Sheets(sh).Cells(i, 7)
                If stufe = "" And i > 2 Then stufe = Sheets(sh).Cells(i - 1, 1): pos = Sheets(sh).Cells(i - 1, 2): nc = Sheets(sh).Cells(i - 1, 3): document = Sheets(sh).Cells(i - 1, 5) & Sheets(sh).Cells(i - 1, 7)
                If stufe = "" And i > 3 Then stufe = Sheets(sh).Cells(i - 2, 1): pos = Sheets(sh).Cells(i - 2, 2): nc = Sheets(sh).Cells(i - 2, 3): document = Sheets(sh).Cells(i - 2, 5) & Sheets(sh).Cells(i - 2, 7)
                If stufe = "" And i > 4 Then stufe = Sheets(sh).Cells(i - 3, 1): pos = Sheets(sh).Cells(i - 3, 2): nc = Sheets(sh).Cells(i - 3, 3): document = Sheets(sh).Cells(i - 3, 5) & Sheets(sh).Cells(i - 3, 7)
                Rem ------------------------------------------------------------------
                Rem Markierung X bei verbundenen Zellen l|fffd|schen
                Rem ------------------------------------------------------------------
                Cells(i + 1, 2).Select
                If Application.ActiveCell.MergeCells = True Then
                    Sheets(sh).Cells(i + 1, xmax) = ""
                    Sheets(sh).Cells(i + 2, 2).Select
                    If Application.ActiveCell.MergeCells = True Then
                        Sheets(sh).Cells(i + 2, xmax) = ""
                        Sheets(sh).Cells(i + 3, 2).Select
                        If Application.ActiveCell.MergeCells = True Then
                            Sheets(sh).Cells(i + 3, xmax) = ""
                            Sheets(sh).Cells(i + 4, 2).Select
                            If Application.ActiveCell.MergeCells = True Then
                                Sheets(sh).Cells(i + 4, xmax) = ""
                            End If
                        End If
                    End If
                End If
                
                Rem ------------------------------------------------------------------
                Rem Erste Abfrage: Stimmen Stufe und Position |fffd|berein
                Rem und gab es f|fffd|r diese Position noch keine |fffd|bereinstimmung
                Rem ------------------------------------------------------------------
                If stufe = check_field(1, (l - 1) * 1000 + y) And pos = check_field(2, (l - 1) * 1000 + y) And Sheets(sh).Cells(i, xmax) = "x" Then
                    Rem ------------------------------------------------------------------
                    Rem Stimmt die Materialnummer |fffd|berein?
                    Rem ------------------------------------------------------------------
                    If nc = check_field(3, (l - 1) * 1000 + y) And nc <> "" Then
                        Sheets(sh).Cells(y, xmax) = ""
                        For x = 1 To xmax - 1
                            If Sheets(sh).Cells(i, x) <> check_field(x, (l - 1) * 1000 + y) Then
                                Sheets(sh).Cells(i, x).Select
                                With Selection.Interior
                                    .Pattern = xlSolid
                                    .PatternColorIndex = xlAutomatic
                                    .Color = 14730670
                                    .TintAndShade = 0
                                    .PatternTintAndShade = 0
                                End With
                                    
                                Rem ------------------------------------------------------------------
                                Rem Bei Langtextfehler alle Nachfolgenden Zellen markieren
                                Rem ------------------------------------------------------------------
                                If Application.ActiveCell.MergeCells = False Then
                                    If x = 16 Or x = 24 Then
                                        Sheets(sh).Cells(i + 1, 2).Select
                                        If Application.ActiveCell.MergeCells = True Then
                                            Sheets(sh).Cells(i + 1, x).Select
                                            With Selection.Interior
                                                .Pattern = xlSolid
                                                .PatternColorIndex = xlAutomatic
                                                .Color = 14730670
                                                .TintAndShade = 0
                                                .PatternTintAndShade = 0
                                            End With
                                            Sheets(sh).Cells(i + 2, 2).Select
                                            If Application.ActiveCell.MergeCells = True Then
                                                Sheets(sh).Cells(i + 2, x).Select
                                                With Selection.Interior
                                                    .Pattern = xlSolid
                                                    .PatternColorIndex = xlAutomatic
                                                    .Color = 14730670
                                                    .TintAndShade = 0
                                                    .PatternTintAndShade = 0
                                                End With
                                                Sheets(sh).Cells(i + 3, 2).Select
                                                If Application.ActiveCell.MergeCells = True Then
                                                    Sheets(sh).Cells(i + 3, x).Select
                                                    With Selection.Interior
                                                        .Pattern = xlSolid
                                                        .PatternColorIndex = xlAutomatic
                                                        .Color = 14730670
                                                        .TintAndShade = 0
                                                        .PatternTintAndShade = 0
                                                    End With
                                                    Sheets(sh).Cells(i + 4, 2).Select
                                                    If Application.ActiveCell.MergeCells = True Then
                                                        Sheets(sh).Cells(i + 4, x).Select
                                                        With Selection.Interior
                                                            .Pattern = xlSolid
                                                            .PatternColorIndex = xlAutomatic
                                                            .Color = 14730670
                                                            .TintAndShade = 0
                                                            .PatternTintAndShade = 0
                                                        End With
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                                Sheets(sh).Cells(ymax1 + ymax1 + 1, 2).Select
                                    With Selection.Interior
                                        .Pattern = xlSolid
                                        .PatternColorIndex = xlAutomatic
                                        .Color = 14730670
                                        .TintAndShade = 0
                                        .PatternTintAndShade = 0
                                    End With
                                Sheets(sh).Cells(ymax1 + ymax1 + 1, 2) = "txt"
                                Sheets(sh).Cells(ymax1 + ymax1 + 1, 2).Select
                                Sheets(sh).Cells(ymax1 + ymax1 + 1, 3) = "... |fffd|nderung zur vorherigen Version"
                            End If
                            Rem ------------------------------------------------------------------
                            Rem Textvergleich Zeichenweise                                 V4.00.f
                            Rem ------------------------------------------------------------------
                            If x = 16 Or x = 24 Then
                            'If x = 16 And test = 1 Then
                                ms = 0: n = 0: m = 0 'n...Verschiebungswert (falls was weggel|fffd|scht wurde)
                                Sheets(sh).Cells(i, x).Select
                                check_field(x, (l - 1) * 1000 + y) = Replace(check_field(x, (l - 1) * 1000 + y), "%!%", "")
                                For j = 1 To Len(Cells(i, x))
                                    If Mid(Sheets(sh).Cells(i, x), j, 3) <> Mid(check_field(x, (l - 1) * 1000 + y), j + n, 3) Then
                                        Rem ------------------------------------------------------------------
                                        Rem Sucht die n|fffd|chsten 40 Zeichen im restli. alten Bereich     V4.02.g
                                        Rem ------------------------------------------------------------------
                                        For m = ms To Len(check_field(x, (l - 1) * 1000 + y))
                                            If Mid(Sheets(sh).Cells(i, x), j, 40) = Mid(check_field(x, (l - 1) * 1000 + y), m, 40) Then
                                                n = m - j
                                                m = 9999
                                            End If
                                        Next
                                        If m < 9999 Then
                                            Sheets(sh).Cells(i, x).Select
                                            With ActiveCell.Characters(Start:=j, Length:=3).Font
                                                .FontStyle = "Fett"
                                                .Color = -16776961
                                            End With
                                            Sheets(sh).Cells(ymax1 + ymax1 + 2, 2) = "txt"
                                            Sheets(sh).Cells(ymax1 + ymax1 + 2, 2).Select
                                            With Selection.Font
                                                .Color = -16776961
                                                .TintAndShade = 0
                                            End With
                                            Sheets(sh).Cells(ymax1 + ymax1 + 2, 3) = "... ge|fffd|nderter Text / change text"
                                        End If
                                    Else
                                        ms = j + n
                                    End If
                                Next
                            End If
                            
                            Rem ------------------------------------------------------------------
                            Rem Textvergleich Zeichenweise                                 V4.03.a
                            Rem ------------------------------------------------------------------
                            If x = 16 And test = 0 Then
                                ms = 0: n = 0: m = 0 'n...Verschiebungswert (falls was weggel|fffd|scht wurde)
                                Sheets(sh).Cells(i, x).Select
                                check_field(x, (l - 1) * 1000 + y) = Replace(check_field(x, (l - 1) * 1000 + y), "%!%", "")
                                For j = 1 To Len(Cells(i, x))
                                    If Mid(Sheets(sh).Cells(i, x), j, 3) <> Mid(check_field(x, (l - 1) * 1000 + y), j + n, 3) Then     'V2.00.g
                                        Rem ------------------------------------------------------------------
                                        Rem Sucht die n|fffd|chsten 40 Zeichen im restli. alten Bereich     V4.02.g
                                        Rem ------------------------------------------------------------------
                                        For m = ms To Len(check_field(x, (l - 1) * 1000 + y))
                                            If Mid(Sheets(sh).Cells(i, x), j, 40) = Mid(check_field(x, (l - 1) * 1000 + y), m, 40) Then
                                                n = m - j
                                                m = 9999
                                            End If
                                        Next

                                        Rem ------------------------------------------------------------------
                                        Rem Sucht die n|fffd|chsten 80 Zeichen im vorherigen alten Bereich  V4.03.a
                                        Rem ------------------------------------------------------------------
                                        msb = ms - 80
                                        If msb > 2 Then
                                            For m = msb To 1 Step -1
                                                If Mid(Sheets(sh).Cells(i, x), j, 80) = Mid(check_field(x, (l - 1) * 1000 + y), m, 80) Then
                                                    m = 9999
                                                    Exit For
                                                End If
                                            Next
                                        End If

                                        If m < 9999 Then
                                            Sheets(sh).Cells(i, x).Select
                                            With ActiveCell.Characters(Start:=j, Length:=3).Font
                                                .FontStyle = "Fett"
                                                .Color = -16776961
                                            End With
                                            Sheets(sh).Cells(ymax1 + ymax1 + 2, 2) = "txt"
                                            Sheets(sh).Cells(ymax1 + ymax1 + 2, 2).Select
                                            With Selection.Font
                                                .Color = -16776961
                                                .TintAndShade = 0
                                            End With
                                            Sheets(sh).Cells(ymax1 + ymax1 + 2, 3) = "... ge|fffd|nderter Text / changed text"
                                        End If
                                    Else
                                        ms = j + n
                                    End If
                                Next
                            End If
                            check_field(x, (l - 1) * 1000 + y) = ""
                        Next
                        If i > 5 Then istart = i - 3 Else istart = i
                        gef = 1
                        Sheets(sh).Cells(i, xmax) = ""
                    Else
                        Rem ------------------------------------------------------------------
                        Rem oder handelt es sich um eine Dokumentenposition?
                        Rem ------------------------------------------------------------------
                        If document = check_field(5, (l - 1) * 1000 + y) & check_field(7, (l - 1) * 1000 + y) And nc = "" Then
                            Sheets(sh).Cells(i, xmax) = ""
                            For x = 1 To xmax - 1
                                If Sheets(sh).Cells(i, x) <> check_field(x, (l - 1) * 1000 + y) Then
                                    Rem ------------------------------------------------------------------
                                    Rem Umgleicher Wert wurde gefunden, Zelle wird markiert
                                    Rem ------------------------------------------------------------------
                                    Sheets(sh).Cells(i, x).Select
                                    With Selection.Interior
                                        .Pattern = xlSolid
                                        .PatternColorIndex = xlAutomatic
                                        .Color = 14730670
                                        .TintAndShade = 0
                                        .PatternTintAndShade = 0
                                    End With
                                    Rem --------------------------------------------------------------------------
                                    Rem Umgleicher Wert werden nicht verbunden Zellen ebenfalls markiert
                                    Rem --------------------------------------------------------------------------
                                    Sheets(sh).Cells(i + 1, 2).Select
                                    If Application.ActiveCell.MergeCells = True And Cells(i + 1, 2) = "" Then
                                        Sheets(sh).Cells(i + 1, x).Select
                                        With Selection.Interior
                                            .Pattern = xlSolid
                                            .PatternColorIndex = xlAutomatic
                                            .Color = 14730670
                                            .TintAndShade = 0
                                            .PatternTintAndShade = 0
                                        End With
                                        Sheets(sh).Cells(i + 2, 2).Select
                                        If Application.ActiveCell.MergeCells = True And Cells(i + 2, 2) = "" Then
                                            Sheets(sh).Cells(i + 2, x).Select
                                            With Selection.Interior
                                                .Pattern = xlSolid
                                                .PatternColorIndex = xlAutomatic
                                                .Color = 14730670
                                                .TintAndShade = 0
                                                .PatternTintAndShade = 0
                                            End With
                                            Sheets(sh).Cells(i + 3, 2).Select
                                            If Application.ActiveCell.MergeCells = True And Cells(i + 3, 2) = "" Then
                                                Sheets(sh).ells(i + 3, x).Select
                                                With Selection.Interior
                                                    .Pattern = xlSolid
                                                    .PatternColorIndex = xlAutomatic
                                                    .Color = 14730670
                                                    .TintAndShade = 0
                                                    .PatternTintAndShade = 0
                                                End With
                                                Sheets(sh).Cells(i + 4, 2).Select
                                                If Application.ActiveCell.MergeCells = True And Cells(i + 4, 2) = "" Then
                                                    Sheets(sh).Cells(i + 4, x).Select
                                                    With Selection.Interior
                                                        .Pattern = xlSolid
                                                        .PatternColorIndex = xlAutomatic
                                                        .Color = 14730670
                                                        .TintAndShade = 0
                                                        .PatternTintAndShade = 0
                                                    End With
                                                End If
                                            End If
                                        End If
                                    End If
                                    
                                    Rem ------------------------------------------------------------------
                                    Rem Hier k|fffd|nnte man jetzt den alten Wert |fffd|bertragen lassen
                                    Rem ------------------------------------------------------------------
                                    Rem F|fffd|r Spalten: Ext.-Number bis Tech.Info
                                    If x > 8 And x < 16 Then
                                        Sheets(sh).Cells(i, x) = Sheets(sh).Cells(i, x) & Chr(10) & "(" & check_field(x, (l - 1) * 1000 + y) & ")"
                                    End If
                                    Rem F|fffd|r Spalten: Bemerkung 1-4
                                    If x > 16 And x < 21 Then
                                        Sheets(sh).Cells(i, x) = Sheets(sh).Cells(i, x) & Chr(10) & "(" & check_field(x, (l - 1) * 1000 + y) & ")"
                                    End If
                                    Rem Quantit|fffd|t und Gewicht
                                    If x > 21 And x < 25 Then
                                        Sheets(sh).Cells(i, x) = Sheets(sh).Cells(i, x) & Chr(10) & "(" & check_field(x, (l - 1) * 1000 + y) & ")"
                                    End If
                                End If
                                check_field(x, (l - 1) * 1000 + y) = ""
                            Next
                            If i > 5 Then istart = i - 3 Else istart = i
                            gef = 1
                            Sheets(sh).Cells(i, xmax) = ""
                        End If
                    End If
                End If
            Next
            If check_field(1, (l - 1) * 1000 + y) & check_field(2, (l - 1) * 1000 + y) & check_field(4, (l - 1) * 1000 + y) = "" Then gef = 2
            If gef = 0 Then
                Rem ------------------------------------------------------------------
                Rem Keine |fffd|bereinstimmung wurde gefunden
                Rem ------------------------------------------------------------------
                Workbooks(f_name).Activate
                For x = 1 To xmax - 1
                    Sheets(sh).Cells(ymax, x) = check_field(x, (l - 1) * 1000 + y)
                Next
                
                Rem ------------------------------------------------------------------
                Rem Kopiere des Format von Zeile 3                               V4.40
                Rem ------------------------------------------------------------------
                Sheets(sh).Rows("3:3").Select
                Selection.Copy
                Sheets(sh).Rows(ymax & ":" & ymax).Select
                Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
                Application.CutCopyMode = False
                Sheets(sh).Rows(ymax & ":" & ymax).EntireRow.AutoFit
                Sheets(sh).Rows(ymax & ":" & ymax).Select
                With Selection.Interior
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorDark1
                    .TintAndShade = 0
                    .PatternTintAndShade = 0
                End With
                Selection.Borders(xlDiagonalDown).LineStyle = xlNone
                Selection.Borders(xlDiagonalUp).LineStyle = xlNone
                With Selection.Borders(xlEdgeLeft)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlEdgeTop)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlEdgeBottom)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlEdgeRight)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlInsideVertical)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlInsideHorizontal)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With

                Rem ------------------------------------------------------------------
                Rem Spalte A wird ROT (255) markiert
                Rem ------------------------------------------------------------------
                Sheets(sh).Cells(ymax, 1).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .Color = 255
                    .TintAndShade = 0
                    .PatternTintAndShade = 0
                End With
                Rem ------------------------------------------------------------------
                Rem Formatierung Spalte A+B                                      V4.03
                Rem ------------------------------------------------------------------
                If Len(Cells(ymax, 1)) > 1 Then
                    If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)) - 1, 2) = "11" Then Cells(ymax, 1) = "'...........11"
                End If
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "1" Then Cells(ymax, 1) = "'.1"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "2" Then Cells(ymax, 1) = "'..2"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "3" Then Cells(ymax, 1) = "'...3"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "4" Then Cells(ymax, 1) = "'....4"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "5" Then Cells(ymax, 1) = "'.....5"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "6" Then Cells(ymax, 1) = "'......6"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "7" Then Cells(ymax, 1) = "'.......7"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "8" Then Cells(ymax, 1) = "'........8"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "9" Then Cells(ymax, 1) = "'.........9"
                If Mid(Sheets(sh).Cells(ymax, 1), Len(Sheets(sh).Cells(ymax, 1)), 1) = "0" Then Cells(ymax, 1) = "'..........10"
                If Len(Sheets(sh).Cells(ymax, 2)) = 1 Then Sheets(sh).Cells(ymax, 2) = "0" & Sheets(sh).Cells(ymax, 2)
                If Len(Sheets(sh).Cells(ymax, 2)) = 2 Then Sheets(sh).Cells(ymax, 2) = "0" & Sheets(sh).Cells(ymax, 2)
                If Len(Sheets(sh).Cells(ymax, 2)) = 3 Then Sheets(sh).Cells(ymax, 2) = "'0" & Sheets(sh).Cells(ymax, 2)
                If Len(Sheets(sh).Cells(ymax, 7)) = 1 Then Sheets(sh).Cells(ymax, 7) = "'0" & Sheets(sh).Cells(ymax, 7)
                ymax = ymax + 1
            End If
        End If
    Next
    If z < 1000 Then Exit For
Next

Rem **************************************************************
Rem ** |fffd|berpr|fffd|fen, ob |fffd|nderunen gefunden wurden           V4.12 **
Rem ** Alle Leerzeilen l|fffd|schen                                  **
Rem **************************************************************
If Sheets(sh).Cells(ymax - 1, 1) = "Nicht mehr gefundene Positionsnummern / Not founded pos. numbers:" Then
    Sheets(sh).Rows(ymax - 1 & ":" & ymax1 + ymax1).Select
    Selection.Delete Shift:=xlUp
End If

z = 0
For y = ymax1 To ymax1 + ymax1
    If Sheets(sh).Cells(y, 1) & Sheets(sh).Cells(y, 2) & Sheets(sh).Cells(y, 3) & Sheets(sh).Cells(y, 4) = "" Then
        Sheets(sh).Rows(y & ":" & y).Select
        Selection.Delete Shift:=xlUp
        y = y - 1
        z = z + 1
    End If
    If y + z = ymax1 + ymax1 Then Exit For
Next y
For y = ymax1 To ymax1 + ymax1 + ymax1
    If Sheets(sh).Cells(y, 1) & Sheets(sh).Cells(y, 2) & Sheets(sh).Cells(y, 3) & Sheets(sh).Cells(y, 4) = "" Then
        Sheets(sh).Rows(y & ":65000").Select
        Selection.Delete Shift:=xlUp
        Exit For
    End If
Next

Rem ***************************************************************************
Rem ** Und jetzt noch die Formatierung nach der letzten Zeile l|fffd|schen V4.12  **
Rem ***************************************************************************
Sheets(sh).Rows(ymax1 & ":65000").Select                                 'V5.25
Selection.Borders(xlDiagonalDown).LineStyle = xlNone
Selection.Borders(xlDiagonalUp).LineStyle = xlNone
With Selection.Borders(xlEdgeLeft)
    .LineStyle = xlNone
End With
With Selection.Borders(xlEdgeBottom)
    .LineStyle = xlNone
End With
With Selection.Borders(xlEdgeRight)
    .LineStyle = xlNone
End With
With Selection.Borders(xlInsideVertical)
    .LineStyle = xlNone
End With
With Selection.Borders(xlInsideHorizontal)
    .LineStyle = xlNone
End With

Rem ------------------------------------------------------------------
Rem Zeile wird HELLBLAU, wenn die Zeile NEU ist
Rem ------------------------------------------------------------------
Sheets(sh).Select
For y = 3 To ymax1 + 100
    If Sheets(sh).Cells(y, xmax) = "x" And Sheets(sh).Cells(y, 1) & Sheets(sh).Cells(y, 2) & Sheets(sh).Cells(y, 3) & Sheets(sh).Cells(y, 4) <> "" Then
        Sheets(sh).Cells(y, xmax) = ""
        Sheets(sh).Rows(y & ":" & y).Select
        With Selection.Interior
            .Pattern = xlSolid
            .PatternColorIndex = xlAutomatic
           '.Color = 15773696                        BLAU
           '.Color = 5296274                         GR|fffd|N
           '.ThemeColor = xlThemeColorAccent3        HELLGR|fffd|N
            .ThemeColor = xlThemeColorLight2        'HELLBLAU
            .TintAndShade = 0.799981688894314
            .PatternTintAndShade = 0
        End With
        Rem ----------------------------------------------------------------------------
        Rem 2. Zeile wird HELLBLAU, wenn die Zeile NEU ist (Langtext Splitting)  V4.03.a
        Rem ----------------------------------------------------------------------------
        If Sheets(sh).Cells(y + 1, 4) & Sheets(sh).Cells(y + 1, 1) = "" Then
            If Sheets(sh).Cells(y + 1, 16) <> "" Then
                Sheets(sh).Rows(y + 1 & ":" & y + 1).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorLight2        'HELLBLAU
                    .TintAndShade = 0.799981688894314
                    .PatternTintAndShade = 0
                End With
            End If
        End If
        Rem ----------------------------------------------------------------------------
        Rem 3. Zeile wird HELLBLAU, wenn die Zeile NEU ist (Langtext Splitting)  V4.03.a
        Rem ----------------------------------------------------------------------------
        If Sheets(sh).Cells(y + 2, 4) & Sheets(sh).Cells(y + 2, 1) = "" Then
            If Sheets(sh).Cells(y + 2, 16) <> "" Then
                Sheets(sh).Rows(y + 2 & ":" & y + 2).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorLight2        'HELLBLAU
                    .TintAndShade = 0.799981688894314
                    .PatternTintAndShade = 0
                End With
            End If
        End If
        Rem ----------------------------------------------------------------------------
        Rem 4. Zeile wird HELLBLAU, wenn die Zeile NEU ist (Langtext Splitting)  V4.03.a
        Rem ----------------------------------------------------------------------------
        If Sheets(sh).Cells(y + 3, 4) & Sheets(sh).Cells(y + 3, 1) = "" Then
            If Sheets(sh).Cells(y + 3, 16) <> "" Then
                Sheets(sh).Rows(y + 3 & ":" & y + 3).Select
                With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    .ThemeColor = xlThemeColorLight2        'HELLBLAU
                    .TintAndShade = 0.799981688894314
                    .PatternTintAndShade = 0
                End With
            End If
        End If
    Else
        Sheets(sh).Cells(y, xmax) = ""
    End If
Next


Rem ----------------------------------------------------------------------------
Rem Bl|fffd|tter bereinigen
Rem ----------------------------------------------------------------------------
Sheets(sh_o).Select
For y = 1 To 59999
    If Cells(y, 1) & Cells(y, 2) & Cells(y, 3) & Cells(y, 4) & Cells(y, 16) = "" Then
        Rows(y + 10 & ":65000").Select
        Selection.Delete Shift:=xlUp
        Exit For
    End If
Next
Sheets(sh).Select
For y = 1 To 59999
    If Cells(y, 1) & Cells(y, 2) & Cells(y, 3) & Cells(y, 4) & Cells(y, 16) = "" Then
        Rows(y + 10 & ":65000").Select
        Selection.Delete Shift:=xlUp
        Exit For
    End If
Next

ActiveWorkbook.Save
   
End Sub



INQUEST-PP=macro
