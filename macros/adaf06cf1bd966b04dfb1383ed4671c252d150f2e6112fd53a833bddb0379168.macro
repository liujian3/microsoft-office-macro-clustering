Attribute VB_Name = "Module1"
Dim fs_rows_length As Long
Dim cntx As Long
Sub getMatches()

    Dim lr As Long
    Dim celPaste As Range
    

    timezone = Sheets("Settings").Range("B1").Value - 1
    dayzone = Sheets("Settings").Range("D1").Value - 8
    sourcer = Sheets("Settings").Range("F1").Value
    If sourcer = 1 Then
        sourcer = "flashscore.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 2 Then
        sourcer = "soccerstand.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 3 Then
        sourcer = "soccerstand.com/ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 4 Then
        sourcer = "myscore.ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 5 Then
        sourcer = "myscore.com.ua/"
        suffix = "_ru_1"
    End If
    
    x1 = ThisWorkbook.Sheets("Settings").Range("I1").Value
    
    
    If Sheets("Data").Range("j1").Value > 2 Then


        Sheets("Data").Range("j40").ClearContents
    Dim lRetVal As Long
    If lRetVal = vbNo Then
        Sheets("Data").Range("j40").Value = 2
        Else
        If lRetVal = vbYes Then
        Sheets("Data").Range("j40").Value = 1
        Else
        If lRetVal = vbCancel Then
        Exit Sub
    End If
    End If
    End If
        Else
        End If
        If Sheets("Data").Range("j40").Value = 1 Then
        ClearLIST
        ClearPrevious
        Else
        End If
        
    a1 = Sheets("Data").Range("j1").Value
    b1 = 1
    Set http = CreateObject("MSXML2.XMLHTTP")
    http.Open "GET", "https://d." & sourcer & "x/feed/f_1_" & dayzone & "_" & timezone & suffix, False
    http.setRequestHeader "X-Fsign", "SW9D1eZo"
    http.Send
    fs_input = http.ResponseText
    fs_rows = Split(fs_input, "~")
    fs_rows_length = UBound(fs_rows) - LBound(fs_rows)
    
        Call Show_PrBar_Or_No(fs_rows_length, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|...")
    For i = 0 To fs_rows_length - 4
        If bShowBar Then Call MyProgresBar
        fs_row = Split(fs_rows(i), "|fffd|")
        fs_row_length = UBound(fs_row) - LBound(fs_row)
        fs_index = Split(fs_row(0), ChrW(&HF7))
        If IsArray(fs_index) Then
            fs_index_name = fs_index(0)
            fs_index_value = fs_index(1)
        End If
        If fs_index_name = "SA" Then
            sport_id = fs_index_value
        ElseIf fs_index_name = "ZA" Then
            For J = 0 To fs_row_length - 1
                fs_row_parts = Split(fs_row(J), ChrW(&HF7))
                If fs_row_parts(0) = "ZA" Then tour_name = fs_row_parts(1)
                If fs_row_parts(0) = "ZB" Then country_id = fs_row_parts(1)
            Next J
        ElseIf fs_index_name = "AA" Then
            first_home = "": first_away = "": second_home = "": second_away = ""
            For J = 0 To fs_row_length - 1
                fs_row_parts = Split(fs_row(J), ChrW(&HF7))
                If fs_row_parts(0) = "AA" Then match_id = fs_row_parts(1)
                If fs_row_parts(0) = "AD" Then
                    date_match = DateAdd("s", fs_row_parts(1), "01/01/1970")
                    date_match = DateAdd("h", timezone, date_match)
                    date_match = Format(date_match, "dd.mm.yyyy hh:mm")
                End If
                If fs_row_parts(0) = "AE" Then home_name = fs_row_parts(1)
                If fs_row_parts(0) = "AF" Then away_name = fs_row_parts(1)
                If fs_row_parts(0) = "BA" Then first_home = fs_row_parts(1)
                If fs_row_parts(0) = "BB" Then first_away = fs_row_parts(1)
                If fs_row_parts(0) = "BC" Then second_home = fs_row_parts(1)
                If fs_row_parts(0) = "BD" Then second_away = fs_row_parts(1)
            Next J
            
            Sheets("Data").Range("B37").Value = tour_name
            Sheets("Data").Range("B38").Value = date_match
            Sheets("Data").Range("B39").Value = home_name
            Sheets("Data").Range("B40").Value = away_name
            Sheets("Data").Range("B41").Value = match_id
          
            ddd = Sheets("Data").Range("J41").Value
            If ddd > 0 Then
            GoTo 5:
            Else
            End If

            If first_home <> "" And second_home <> "" Then
                half_time = first_home & " : " & first_away
                full_time = (Val(first_home) + Val(second_home)) & " : " & (Val(first_away) + Val(second_away))
                Sheets("Data").Range("B42").Value = half_time
                Sheets("Data").Range("B43").Value = full_time
            Else
                Sheets("Data").Range("B42").Value = ""
                Sheets("Data").Range("B43").Value = ""
            End If
            
            Call getOdds2

            Set http = CreateObject("MSXML2.XMLHTTP")
            http.Open "GET", "https://www." & sourcer & "match/" & match_id & "/", False
            http.Send
            fs_input = http.ResponseText
            Set objRegExp = CreateObject("VBScript.RegExp")
            objRegExp.Pattern = "participantEncodedIds = \[\'(.*)\',\'(.*)\'\]"
            If objRegExp.test(fs_input) = True Then
                Set objMatches = objRegExp.Execute(fs_input)
                home_id1 = objMatches.Item(0).submatches(0)
                away_id1 = objMatches.Item(0).submatches(1)
            End If
            objRegExp.Pattern = "tournamentStageEncodedId = \'(.*?)\'"
            If objRegExp.test(fs_input) = True Then
                Set objMatches = objRegExp.Execute(fs_input)
                tournament_stage_id1 = objMatches.Item(0).submatches(0)
            End If
            objRegExp.Pattern = "tournamentEncodedId = \'(.*?)\'"
            If objRegExp.test(fs_input) = True Then
                Set objMatches = objRegExp.Execute(fs_input)
                tournament_id1 = objMatches.Item(0).submatches(0)
            End If
            Sheets("Data").Range("B44").Value = home_id1
            Sheets("Data").Range("B45").Value = away_id1
            Sheets("Data").Range("B46").Value = tournament_stage_id1
            Sheets("Data").Range("B47").Value = tournament_id1
            
            If Sheets("Data").Range("J46").Value = 1 Then GoTo 40:
            If Sheets("Data").Range("J46").Value = 0 Then GoTo 42:
42:
            ClearDataPort
            b1 = 2
            Set http = CreateObject("MSXML2.XMLHTTP")
            http.Open "GET", "https://d." & sourcer & "x/feed/ss_1_" & tournament_id1 & "_" & tournament_stage_id1 & "_table_overall?hp1=" & home_id1 & "&hp2=" & away_id1 & "&e=" & match_id, False
            http.setRequestHeader "X-Fsign", "SW9D1eZo"
            http.Send
            fs_input = http.ResponseText
            Set objRegExp = CreateObject("VBScript.RegExp")
            objRegExp.Global = True
            objRegExp.MultiLine = True
            objRegExp.Pattern = Chr(9)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(10)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(13)
            fs_input = objRegExp.Replace(fs_input, "")
            If InStr(1, fs_input, "col_wins_pen") = 0 And InStr(1, fs_input, "col_wins_ot") = 0 Then
                objRegExp.Pattern = "<tr(.*?)>([0-9]+)\.<(.*?)>(.*?)team_name_span(.*?)>(.*?)>(.*?)<(.*?)col_matches_played(.*?)>(.*?)<(.*?)wins(.*?)>(.*?)<(.*?)draws(.*?)>(.*?)<(.*?)losses(.*?)>(.*?)<(.*?)goals(.*?)>(.*?):(.*?)<(.*?)goals(.*?)>(.*?)<\/td>"
                If objRegExp.test(fs_input) = True Then
                    Set objMatches = objRegExp.Execute(fs_input)
                    For Each M In objMatches
                        Sheets("Data").Range("a" & b1).Value = M.submatches(1)
                        Sheets("Data").Range("b" & b1).Value = M.submatches(6)
                        Sheets("Data").Range("c" & b1).Value = M.submatches(9)
                        Sheets("Data").Range("d" & b1).Value = M.submatches(12)
                        Sheets("Data").Range("e" & b1).Value = M.submatches(15)
                        Sheets("Data").Range("f" & b1).Value = M.submatches(18)
                        Sheets("Data").Range("g" & b1).Value = M.submatches(21)
                        Sheets("Data").Range("h" & b1).Value = M.submatches(22)
                        Sheets("Data").Range("i" & b1).Value = M.submatches(25)
                        b1 = b1 + 1
                    Next
                End If
            End If
            
            b1 = 2
            Set http = CreateObject("MSXML2.XMLHTTP")
            http.Open "GET", "https://d." & sourcer & "x/feed/ss_1_" & tournament_id1 & "_" & tournament_stage_id1 & "_table_home?hp1=" & home_id1 & "&hp2=" & away_id1 & "&e=" & match_id, False
            http.setRequestHeader "X-Fsign", "SW9D1eZo"
            http.Send
            fs_input = http.ResponseText
            Set objRegExp = CreateObject("VBScript.RegExp")
            objRegExp.Global = True
            objRegExp.MultiLine = True
            objRegExp.Pattern = Chr(9)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(10)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(13)
            fs_input = objRegExp.Replace(fs_input, "")
            If InStr(1, fs_input, "col_wins_pen") = 0 And InStr(1, fs_input, "col_wins_ot") = 0 Then
                objRegExp.Pattern = "<tr(.*?)>([0-9]+)\.<(.*?)>(.*?)team_name_span(.*?)>(.*?)>(.*?)<(.*?)col_matches_played(.*?)>(.*?)<(.*?)wins(.*?)>(.*?)<(.*?)draws(.*?)>(.*?)<(.*?)losses(.*?)>(.*?)<(.*?)goals(.*?)>(.*?):(.*?)<(.*?)goals(.*?)>(.*?)<\/td>"
                If objRegExp.test(fs_input) = True Then
                    Set objMatches = objRegExp.Execute(fs_input)
                    For Each M In objMatches
                        Sheets("Data").Range("k" & b1).Value = M.submatches(1)
                        Sheets("Data").Range("l" & b1).Value = M.submatches(6)
                        Sheets("Data").Range("m" & b1).Value = M.submatches(9)
                        Sheets("Data").Range("n" & b1).Value = M.submatches(12)
                        Sheets("Data").Range("o" & b1).Value = M.submatches(15)
                        Sheets("Data").Range("p" & b1).Value = M.submatches(18)
                        Sheets("Data").Range("q" & b1).Value = M.submatches(21)
                        Sheets("Data").Range("r" & b1).Value = M.submatches(22)
                        Sheets("Data").Range("s" & b1).Value = M.submatches(25)
                        b1 = b1 + 1
                    Next
                End If
            End If
                       
            b1 = 2
            Set http = CreateObject("MSXML2.XMLHTTP")
            http.Open "GET", "https://d." & sourcer & "x/feed/ss_1_" & tournament_id1 & "_" & tournament_stage_id1 & "_form_overall?hp1=" & home_id1 & "&hp2=" & away_id1 & "&e=" & match_id, False
            http.setRequestHeader "X-Fsign", "SW9D1eZo"
            http.Send
            fs_input = http.ResponseText
            Set objRegExp = CreateObject("VBScript.RegExp")
            objRegExp.Global = True
            objRegExp.MultiLine = True
            objRegExp.Pattern = Chr(9)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(10)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(13)
            fs_input = objRegExp.Replace(fs_input, "")
            If InStr(1, fs_input, "col_wins_pen") = 0 And InStr(1, fs_input, "col_wins_ot") = 0 Then
                objRegExp.Pattern = "<tr(.*?)>([0-9]+)\.<(.*?)>(.*?)team_name_span(.*?)>(.*?)>(.*?)<(.*?)col_matches_played(.*?)>(.*?)<(.*?)wins(.*?)>(.*?)<(.*?)draws(.*?)>(.*?)<(.*?)losses(.*?)>(.*?)<(.*?)goals(.*?)>(.*?):(.*?)<(.*?)goals(.*?)>(.*?)<\/td>"
                If objRegExp.test(fs_input) = True Then
                    Set objMatches = objRegExp.Execute(fs_input)
                    For Each M In objMatches
                        Sheets("Data").Range("BD1").Value = M.submatches(9)
                        F = M.submatches(9)
                            If F = 5 Then
                        Sheets("Data").Range("Bd" & b1).Value = M.submatches(1)
                        Sheets("Data").Range("Be" & b1).Value = M.submatches(6)
                        Sheets("Data").Range("Bf" & b1).Value = M.submatches(9)
                        Sheets("Data").Range("BG" & b1).Value = M.submatches(12)
                        Sheets("Data").Range("BH" & b1).Value = M.submatches(15)
                        Sheets("Data").Range("BI" & b1).Value = M.submatches(18)
                        Sheets("Data").Range("BJ" & b1).Value = M.submatches(21)
                        Sheets("Data").Range("BK" & b1).Value = M.submatches(22)
                        Sheets("Data").Range("BL" & b1).Value = M.submatches(25)
                        b1 = b1 + 1
                        Else: GoTo 10:
                        End If
10:
                    Next
                End If
            End If
               
               b1 = 2
            Set http = CreateObject("MSXML2.XMLHTTP")
            http.Open "GET", "https://d." & sourcer & "x/feed/ss_1_" & tournament_id1 & "_" & tournament_stage_id1 & "_over_under_overall?hp1=" & home_id1 & "&hp2=" & away_id1 & "&e=" & match_id, False
            http.setRequestHeader "X-Fsign", "SW9D1eZo"
            http.Send
            fs_input = http.ResponseText
            Set objRegExp = CreateObject("VBScript.RegExp")
            objRegExp.Global = True
            objRegExp.MultiLine = True
            objRegExp.Pattern = Chr(9)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(10)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(13)
            fs_input = objRegExp.Replace(fs_input, "")
            If InStr(1, fs_input, "col_wins_pen") = 0 And InStr(1, fs_input, "col_wins_ot") = 0 Then
                objRegExp.Pattern = ">(\d+)" & Chr(46) & "<\/td>(.*?)team_name_span(.*?);" & Chr(34) & ">(.*?)<\/a>(.*?)col_matches_played" & Chr(34) & ">(.*?)<\/td>(.*?)col_over" & Chr(34) & ">(.*?)<\/td>(.*?)col_under" & Chr(34) & ">(.*?)<\/td>(.*?)col_goals" & Chr(34) & ">(.*?):(.*?)<\/td>"
                temper = "0"
                If objRegExp.test(fs_input) = True Then
                    Set objMatches = objRegExp.Execute(fs_input)
                    For Each M In objMatches
                        If M.submatches(0) = 1 And temper = "2.5" Then temper = "3.5"
                        If M.submatches(0) = 1 And temper = "1.5" Then temper = "2.5"
                        If M.submatches(0) = 1 And temper = "0.5" Then temper = "1.5"
                        If M.submatches(0) = 1 And temper = "0" Then temper = "0.5"
                        If temper = "2.5" Then
                        Sheets("Data").Range("AE" & b1).Value = temper
                        Sheets("Data").Range("AF" & b1).Value = M.submatches(0)
                        Sheets("Data").Range("AG" & b1).Value = M.submatches(3)
                        Sheets("Data").Range("AH" & b1).Value = M.submatches(5)
                        Sheets("Data").Range("AI" & b1).Value = M.submatches(7)
                        Sheets("Data").Range("AJ" & b1).Value = M.submatches(9)
                        Sheets("Data").Range("AK" & b1).Value = M.submatches(11)
                        Sheets("Data").Range("AL" & b1).Value = M.submatches(12)
                        b1 = b1 + 1
                        Else: GoTo 20:
                        End If
20:
                    Next
                End If
            End If
               
               b1 = 2
            temper = "0"
            Set http = CreateObject("MSXML2.XMLHTTP")
            http.Open "GET", "https://d." & sourcer & "x/feed/ss_1_" & tournament_id1 & "_" & tournament_stage_id1 & "_over_under_home?hp1=" & home_id1 & "&hp2=" & away_id1 & "&e=" & match_id, False
            http.setRequestHeader "X-Fsign", "SW9D1eZo"
            http.Send
            fs_input = http.ResponseText
            Set objRegExp = CreateObject("VBScript.RegExp")
            objRegExp.Global = True
            objRegExp.MultiLine = True
            objRegExp.Pattern = Chr(9)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(10)
            fs_input = objRegExp.Replace(fs_input, "")
            objRegExp.Pattern = Chr(13)
            fs_input = objRegExp.Replace(fs_input, "")
            If InStr(1, fs_input, "col_wins_pen") = 0 And InStr(1, fs_input, "col_wins_ot") = 0 Then
                objRegExp.Pattern = ">(\d+)" & Chr(46) & "<\/td>(.*?)team_name_span(.*?);" & Chr(34) & ">(.*?)<\/a>(.*?)col_matches_played" & Chr(34) & ">(.*?)<\/td>(.*?)col_over" & Chr(34) & ">(.*?)<\/td>(.*?)col_under" & Chr(34) & ">(.*?)<\/td>(.*?)col_goals" & Chr(34) & ">(.*?):(.*?)<\/td>"
                If objRegExp.test(fs_input) = True Then
                    Set objMatches = objRegExp.Execute(fs_input)
                    For Each M In objMatches
                    
                    If M.submatches(0) = 1 And temper = "2.5" Then temper = "3.5"
                        If M.submatches(0) = 1 And temper = "1.5" Then temper = "2.5"
                        If M.submatches(0) = 1 And temper = "0.5" Then temper = "1.5"
                        If M.submatches(0) = 1 And temper = "0" Then temper = "0.5"
                        If temper = "2.5" Then
                        Sheets("Data").Range("AM" & b1).Value = temper
                        Sheets("Data").Range("AN" & b1).Value = M.submatches(0)
                        Sheets("Data").Range("AO" & b1).Value = M.submatches(3)
                        Sheets("Data").Range("AP" & b1).Value = M.submatches(5)
                        Sheets("Data").Range("AQ" & b1).Value = M.submatches(7)
                        Sheets("Data").Range("AR" & b1).Value = M.submatches(9)
                        Sheets("Data").Range("AS" & b1).Value = M.submatches(11)
                        Sheets("Data").Range("AT" & b1).Value = M.submatches(12)
                        b1 = b1 + 1
                        Else: GoTo 30:
                        End If
30:
                    Next
                End If
            End If
                Application.ScreenUpdating = False
40:             Sheets("Forecasts").Range("A" & a1).Value = Sheets("Data").Range("B37").Value
                Sheets("Forecasts").Range("B" & a1).Value = Sheets("Data").Range("B38").Value
                Sheets("Forecasts").Range("C" & a1).Value = Sheets("Data").Range("B39").Value
                Sheets("Forecasts").Range("D" & a1).Value = Sheets("Data").Range("B40").Value
                Sheets("Forecasts").Range("E" & a1).Value = Sheets("Data").Range("B41").Value
                Sheets("Forecasts").Range("F" & a1).Value = Sheets("V3").Range("A31").Value
                Sheets("Forecasts").Range("G" & a1).Value = Sheets("V3").Range("B31").Value
                Sheets("Forecasts").Range("H" & a1).Value = Sheets("V3").Range("C31").Value
                Sheets("Forecasts").Range("I" & a1).Value = Sheets("V3").Range("D31").Value
                Sheets("Forecasts").Range("J" & a1).Value = Sheets("V3").Range("E31").Value
                Sheets("Forecasts").Range("K" & a1).Value = Sheets("V3").Range("F31").Value
                Sheets("Forecasts").Range("L" & a1).Value = Sheets("V3").Range("G31").Value
                Sheets("Forecasts").Range("M" & a1).Value = Sheets("V3").Range("H31").Value
                Sheets("Forecasts").Range("N" & a1).Value = Sheets("V3").Range("I31").Value
                Sheets("Forecasts").Range("O" & a1).Value = Sheets("V3").Range("J31").Value
                Sheets("Forecasts").Range("P" & a1).Value = Sheets("V3").Range("K31").Value
                Sheets("Forecasts").Range("Q" & a1).Value = Sheets("V3").Range("L31").Value
                Sheets("Forecasts").Range("R" & a1).Value = Sheets("V3").Range("W17").Value
                Sheets("Forecasts").Range("S" & a1).Value = Sheets("V3").Range("X17").Value
                Sheets("v3").Range("W17:X17").Copy
                Sheets("Forecasts").Range("R" & a1).PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
                SkipBlanks:=False, Transpose:=False
                
                
                Sheets("Forecasts").Range("T" & a1).Value = Sheets("V3").Range("O31").Value
                Sheets("Forecasts").Range("U" & a1).Value = Sheets("V3").Range("P31").Value
                Sheets("Forecasts").Range("V" & a1).Value = Sheets("Data").Range("B42").Value
                Sheets("Forecasts").Range("W" & a1).Value = Sheets("Data").Range("B43").Value
                Sheets("Forecasts").Range("X" & a1).Value = Sheets("Data").Range("K37").Value
                Sheets("Forecasts").Range("Y" & a1).Value = Sheets("Data").Range("L37").Value
                Sheets("Forecasts").Range("Z" & a1).Value = Sheets("Data").Range("M37").Value
                
            If x1 = 0 Then
            ThisWorkbook.Save
            x1 = ThisWorkbook.Sheets("Settings").Range("I1").Value
            Else
            End If
            x1 = x1 - 1
            a1 = a1 + 1
        End If
        Sheets("Data").Range("B37:B47").Copy Sheets("Data").Range("F37:F47")
        Sheets("Data").Range("B37:B47").ClearContents
        Sheets("Data").Range("K37:T47").ClearContents

5:
        Set celPaste = fncelPasteOnStatistic
        sbSelectRangeWithSheetVisible celPaste

    Next i
    
    If bShowBar Then Call MyProgresBar
    If bShowBar Then Unload frmStatusBar
    
    src = ThisWorkbook.Sheets("Forecasts").Range("A" & Cells.Rows.Count).End(xlUp).Row
    ThisWorkbook.Sheets("Forecasts").Range("A1:AI" & src).Sort Key1:=Sheets("Forecasts").Columns("B"), Header:=xlYes, Order1:=xlAscending
    
    MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| !"
    Application.ScreenUpdating = True
End Sub
Sub getOdds2()
    bookmaker1 = "1xBet"
    bookmaker2 = "1xStavka"
    bookmaker3 = "bet365"
    bookmaker4 = "Winline"
    bookmaker5 = "Leon"
    timezone = Sheets("Settings").Range("b1").Value - 1
    sourcer = Sheets("Settings").Range("f1").Value
    If sourcer = 1 Then
        sourcer = "flashscore.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 2 Then
        sourcer = "soccerstand.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 3 Then
        sourcer = "soccerstand.com/ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 4 Then
        sourcer = "myscore.ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 5 Then
        sourcer = "myscore.com.ua/"
        suffix = "_ru_1"
    End If
    id = Sheets("Data").Range("b41").Value
    Set http = CreateObject("MSXML2.XMLHTTP")

    http.Open "GET", "https://d." & sourcer & "x/feed/d_od_" & id & suffix & "_eu", False
    http.setRequestHeader "X-Fsign", "SW9D1eZo"
    http.Send
    fs_input = http.ResponseText
    Set objRegExp = CreateObject("VBScript.RegExp")
    
   
    objRegExp.Pattern = "block-1x2-ft(.*?)block-1x2-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        
        If bookmaker <> "" Then
            objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
            If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
                Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
                Sheets("Data").Range("K37").Value = objMatches2.Item(0).submatches(4)
                Sheets("Data").Range("L37").Value = objMatches2.Item(0).submatches(7)
                Sheets("Data").Range("M37").Value = objMatches2.Item(0).submatches(10)
            End If
        End If
    End If
    objRegExp.Pattern = "block-double-chance-ft(.*?)block-double-chance-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        
        If bookmaker <> "" Then
            objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
            If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
                Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
                Sheets("Data").Range("N37").Value = objMatches2.Item(0).submatches(4)
                Sheets("Data").Range("O37").Value = objMatches2.Item(0).submatches(7)
                Sheets("Data").Range("P37").Value = objMatches2.Item(0).submatches(10)
            End If
        End If
    End If

    objRegExp.Pattern = "block-under-over-ft(.*?)block-under-over-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_ou_1.5" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))
                End If
            End If
        End If
        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_ou_2.5" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))
                    Sheets("Data").Range("Q37").Value = objMatches3.Item(0).submatches(4)
                    Sheets("Data").Range("R37").Value = objMatches3.Item(0).submatches(7)
                End If
            End If
        End If
        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_ou_3.5" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))
                End If
            End If
        End If
    End If
    objRegExp.Pattern = "block-both-teams-to-score-ft(.*?)block-both-teams-to-score-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_both_teams_to_score" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))
                    Sheets("Data").Range("S37").Value = objMatches3.Item(0).submatches(4)
                    Sheets("Data").Range("T37").Value = objMatches3.Item(0).submatches(7)
                End If
            End If
        End If
    End If
End Sub


Sub getResults()
    On Error Resume Next
    timezone = ThisWorkbook.Sheets("Settings").Range("B1").Value - 1
    dayzone = ThisWorkbook.Sheets("Settings").Range("D1").Value - 8
    sourcer = ThisWorkbook.Sheets("Settings").Range("F1").Value

    If sourcer = 1 Then
        sourcer = "flashscore.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 2 Then
        sourcer = "soccerstand.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 3 Then
        sourcer = "soccerstand.com/ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 4 Then
        sourcer = "myscore.ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 5 Then
        sourcer = "myscore.com.ua/"
        suffix = "_ru_1"
    End If
    Set http = CreateObject("MSXML2.XMLHTTP")
    http.Open "GET", "https://d." & sourcer & "x/feed/f_1_" & dayzone & "_" & timezone & suffix, False
    http.setRequestHeader "X-Fsign", "SW9D1eZo"
    http.Send
    fs_input = http.ResponseText
    fs_rows = Split(fs_input, "~")
    fs_rows_length = UBound(fs_rows) - LBound(fs_rows)
    For i = 0 To fs_rows_length - 4
        fs_row = Split(fs_rows(i), "|fffd|")
        fs_row_length = UBound(fs_row) - LBound(fs_row)
        fs_index = Split(fs_row(0), ChrW(&HF7))
        If IsArray(fs_index) Then
            fs_index_name = fs_index(0)
            fs_index_value = fs_index(1)
        End If
        If fs_index_name = "SA" Then
            sport_id = fs_index_value
        ElseIf fs_index_name = "ZA" Then
            For J = 0 To fs_row_length - 1
                fs_row_parts = Split(fs_row(J), ChrW(&HF7))
                If fs_row_parts(0) = "ZA" Then tour_name = fs_row_parts(1)
                If fs_row_parts(0) = "ZB" Then country_id = fs_row_parts(1)
            Next J
        ElseIf fs_index_name = "AA" Then
            first_home = "": first_away = "": second_home = "": second_away = ""
            For J = 0 To fs_row_length - 1
                fs_row_parts = Split(fs_row(J), ChrW(&HF7))
                If fs_row_parts(0) = "AA" Then match_id = fs_row_parts(1)
                If fs_row_parts(0) = "BA" Then first_home = fs_row_parts(1)
                If fs_row_parts(0) = "BB" Then first_away = fs_row_parts(1)
                If fs_row_parts(0) = "BC" Then second_home = fs_row_parts(1)
                If fs_row_parts(0) = "BD" Then second_away = fs_row_parts(1)
            Next J
            Set fcell = ThisWorkbook.Sheets("Forecasts").Columns("E:E").Find(match_id)
            rowindx = CStr(fcell.Row)
            If first_home <> "" And second_home <> "" Then
                Sheets("Forecasts").Range("V" & rowindx).Value = first_home & " : " & first_away
                Sheets("Forecasts").Range("W" & rowindx).Value = (Val(first_home) + Val(second_home)) & " : " & (Val(first_away) + Val(second_away))
            End If
        End If
    Next i
End Sub

Sub getOdds(id, rowindx)
    bookmaker1 = "1xBet"
    bookmaker2 = "1xStavka"
    bookmaker3 = "bet365"
    bookmaker4 = "Winline"
    bookmaker5 = "Leon"
    timezone = Sheets("Settings").Range("b1").Value - 1
    sourcer = Sheets("Settings").Range("f1").Value
    If sourcer = 1 Then
        sourcer = "flashscore.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 2 Then
        sourcer = "soccerstand.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 3 Then
        sourcer = "soccerstand.com/ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 4 Then
        sourcer = "myscore.ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 5 Then
        sourcer = "myscore.com.ua/"
        suffix = "_ru_1"
    End If
    Set http = CreateObject("MSXML2.XMLHTTP")

    http.Open "GET", "https://d." & sourcer & "x/feed/d_od_" & id & suffix & "_eu", False ''"_ru_1_eu"
    http.setRequestHeader "X-Fsign", "SW9D1eZo"
    http.Send
    fs_input = http.ResponseText
    Set objRegExp = CreateObject("VBScript.RegExp")
    
   
    objRegExp.Pattern = "block-1x2-ft(.*?)block-1x2-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        
        If bookmaker <> "" Then
            objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
            If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
                Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
                Sheets("Forecasts").Range("X" & rowindx).Value = objMatches2.Item(0).submatches(4)
                Sheets("Forecasts").Range("Y" & rowindx).Value = objMatches2.Item(0).submatches(7)
                Sheets("Forecasts").Range("Z" & rowindx).Value = objMatches2.Item(0).submatches(10)
            End If
        End If
    End If
    objRegExp.Pattern = "block-double-chance-ft(.*?)block-double-chance-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        
        If bookmaker <> "" Then
            objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
            If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
                Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            End If
        End If
    End If

    objRegExp.Pattern = "block-under-over-ft(.*?)block-under-over-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_ou_2.5" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))
                End If
            End If
        End If
        End If
        

    objRegExp.Pattern = "block-both-teams-to-score-ft(.*?)block-both-teams-to-score-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_both_teams_to_score" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))
                End If
            End If
        End If
    End If
End Sub

Sub ClearPrevious()
Sheets("Data").Range("a2:s35").ClearContents
Sheets("Data").Range("ae2:at35").ClearContents
Sheets("Data").Range("bd2:bl35").ClearContents
Sheets("Data").Range("k37:t37").ClearContents
Sheets("Data").Range("b37:f47").ClearContents

End Sub
    
Sub ClearDataPort()
Sheets("Data").Range("a2:s35").ClearContents
Sheets("Data").Range("ae2:at35").ClearContents
Sheets("Data").Range("bd2:bl35").ClearContents

End Sub

    Function fncelPasteOnStatistic() As Range
    With Sheets("Forecasts")
        Set fncelPasteOnStatistic = .Cells(.Rows.Count, "A").End(xlUp).Offset(1)
    End With
End Function
Sub sbSelectRangeWithSheetVisible(rng As Range)
    Dim ws As Worksheet
    Set ws = rng.Parent
    ws.Visible = xlSheetVisible
    ws.Activate
    rng.Select
End Sub
Sub ClearLIST()
    Dim lastRow As Long: lastRow = Range("Forecasts!B1").End(xlDown).Row 'change to whatever column you have
    Dim i As Long
    Sheets("Forecasts").Activate
    Range(Cells(2, 1), Cells(lastRow, 34)).ClearContents
End Sub
Attribute VB_Name = "Module2"
Sub copyToArchive()
    src = ThisWorkbook.Sheets("Forecasts").Range("A" & Cells.Rows.Count).End(xlUp).Row
    dest = ThisWorkbook.Sheets("archive").Range("A" & Cells.Rows.Count).End(xlUp).Row + 1
    ThisWorkbook.Sheets("Forecasts").Range("A2:Z" & src).Copy ThisWorkbook.Sheets("archive").Range("A" & dest)
    MsgBox "|fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|", vbInformation, "|fffd||fffd||fffd||fffd||fffd|"
End Sub

Sub getResultsArchive()
    On Error Resume Next
    timezone = ThisWorkbook.Sheets("Settings").Range("B1").Value - 1
    dayzone = ThisWorkbook.Sheets("Settings").Range("D1").Value - 8
    sourcer = ThisWorkbook.Sheets("Settings").Range("F1").Value

    If sourcer = 1 Then
        sourcer = "flashscore.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 2 Then
        sourcer = "soccerstand.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 3 Then
        sourcer = "soccerstand.com/ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 4 Then
        sourcer = "myscore.ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 5 Then
        sourcer = "myscore.com.ua/"
        suffix = "_ru_1"
    End If
    Set http = CreateObject("MSXML2.XMLHTTP")
    http.Open "GET", "https://d." & sourcer & "x/feed/f_1_" & dayzone & "_" & timezone & suffix, False
    http.setRequestHeader "X-Fsign", "SW9D1eZo"
    http.Send
    fs_input = http.ResponseText
    fs_rows = Split(fs_input, "~")
    fs_rows_length = UBound(fs_rows) - LBound(fs_rows)
    For i = 0 To fs_rows_length - 4
        fs_row = Split(fs_rows(i), "|fffd|")
        fs_row_length = UBound(fs_row) - LBound(fs_row)
        fs_index = Split(fs_row(0), ChrW(&HF7))
        If IsArray(fs_index) Then
            fs_index_name = fs_index(0)
            fs_index_value = fs_index(1)
        End If
        If fs_index_name = "SA" Then
            sport_id = fs_index_value
        ElseIf fs_index_name = "ZA" Then
            For J = 0 To fs_row_length - 1
                fs_row_parts = Split(fs_row(J), ChrW(&HF7))
                If fs_row_parts(0) = "ZA" Then tour_name = fs_row_parts(1)
                If fs_row_parts(0) = "ZB" Then country_id = fs_row_parts(1)
            Next J
        ElseIf fs_index_name = "AA" Then
            first_home = "": first_away = "": second_home = "": second_away = ""
            For J = 0 To fs_row_length - 1
                fs_row_parts = Split(fs_row(J), ChrW(&HF7))
                If fs_row_parts(0) = "AA" Then match_id = fs_row_parts(1)
                If fs_row_parts(0) = "BA" Then first_home = fs_row_parts(1)
                If fs_row_parts(0) = "BB" Then first_away = fs_row_parts(1)
                If fs_row_parts(0) = "BC" Then second_home = fs_row_parts(1)
                If fs_row_parts(0) = "BD" Then second_away = fs_row_parts(1)
            Next J
            Set fcell = ThisWorkbook.Sheets("archive").Columns("E:E").Find(match_id)
            rowindx = CStr(fcell.Row)
            If first_home <> "" And second_home <> "" Then
                Sheets("archive").Range("V" & rowindx).Value = first_home & " : " & first_away
                Sheets("archive").Range("W" & rowindx).Value = (Val(first_home) + Val(second_home)) & " : " & (Val(first_away) + Val(second_away))
            End If
        End If
    Next i
End Sub

Sub getOddsArchive(id, rowindx)
    bookmaker1 = "1xBet"
    bookmaker2 = "1xStavka"
    bookmaker3 = "bet365"
    bookmaker4 = "Winline"
    bookmaker5 = "Leon"
    timezone = Sheets("Settings").Range("b1").Value - 1
    sourcer = Sheets("Settings").Range("f1").Value
    If sourcer = 1 Then
        sourcer = "flashscore.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 2 Then
        sourcer = "soccerstand.com/"
        suffix = "_en_1_"
    ElseIf sourcer = 3 Then
        sourcer = "soccerstand.com/ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 4 Then
        sourcer = "myscore.ru/"
        suffix = "_ru_1"
    ElseIf sourcer = 5 Then
        sourcer = "myscore.com.ua/"
        suffix = "_ru_1"
    End If
    Set http = CreateObject("MSXML2.XMLHTTP")

    http.Open "GET", "https://d." & sourcer & "x/feed/d_od_" & id & suffix & "_eu", False
    http.setRequestHeader "X-Fsign", "SW9D1eZo"
    http.Send
    fs_input = http.ResponseText
    Set objRegExp = CreateObject("VBScript.RegExp")
    
    objRegExp.Pattern = "block-1x2-ft(.*?)block-1x2-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        
        If bookmaker <> "" Then
            objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
            If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
                Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
                Sheets("archive").Range("X" & rowindx).Value = objMatches2.Item(0).submatches(4)
                Sheets("archive").Range("Y" & rowindx).Value = objMatches2.Item(0).submatches(7)
                Sheets("archive").Range("Z" & rowindx).Value = objMatches2.Item(0).submatches(10)

            End If
        End If
    End If
    objRegExp.Pattern = "block-double-chance-ft(.*?)block-double-chance-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        
        If bookmaker <> "" Then
            objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
            If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
                Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
                Sheets("archive").Range("AA" & rowindx).Value = objMatches2.Item(0).submatches(4)
                Sheets("archive").Range("AB" & rowindx).Value = objMatches2.Item(0).submatches(7)

            End If
        End If
    End If

    objRegExp.Pattern = "block-under-over-ft(.*?)block-under-over-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If

        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_ou_2.5" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))

                End If
            End If
        End If

    objRegExp.Pattern = "block-both-teams-to-score-ft(.*?)block-both-teams-to-score-1hf"
    If objRegExp.test(fs_input) = True Then
        Set objMatches = objRegExp.Execute(fs_input)
        If InStr(1, objMatches.Item(0).submatches(0), bookmaker1) = 0 Then
            If InStr(1, objMatches.Item(0).submatches(0), bookmaker2) = 0 Then
                If InStr(1, objMatches.Item(0).submatches(0), bookmaker3) = 0 Then
                    If InStr(1, objMatches.Item(0).submatches(0), bookmaker4) = 0 Then
                        If InStr(1, objMatches.Item(0).submatches(0), bookmaker5) = 0 Then
                            bookmaker = ""
                        Else: bookmaker = bookmaker5: End If
                    Else: bookmaker = bookmaker4: End If
                Else: bookmaker = bookmaker3: End If
            Else: bookmaker = bookmaker2: End If
        Else: bookmaker = bookmaker1: End If
        objRegExp.Pattern = "<table id=" & Chr(34) & "odds_both_teams_to_score" & Chr(34) & "(.*)" & "<\/table>"
        If objRegExp.test(objMatches.Item(0).submatches(0)) = True Then
            Set objMatches2 = objRegExp.Execute(objMatches.Item(0).submatches(0))
            If bookmaker <> "" Then
                objRegExp.Pattern = "<tr(.*?)bookmaker(.*?)" & bookmaker & "(.*?)wrap(.*?)>(.*?)<\/span>(.*?)wrap(.*?)>(.*?)<\/span>(.*?)<\/tr>"
                If objRegExp.test(objMatches2.Item(0).submatches(0)) = True Then
                    Set objMatches3 = objRegExp.Execute(objMatches2.Item(0).submatches(0))

                End If
            End If
        End If
    End If
End Sub

Sub UpdateOddsArchive()
    cnt = ThisWorkbook.Sheets("archive").Range("E" & Cells.Rows.Count).End(xlUp).Row
    For i = 2 To cnt
        rowindx = i
        id = ThisWorkbook.Sheets("archive").Range("E" & i).Value
        Call getOddsArchive(id, rowindx)
    Next i
End Sub

Sub toList()
    ThisWorkbook.Sheets("Forecasts").Activate
End Sub
Sub ClearArchive()
    src = ThisWorkbook.Sheets("archive").Range("E" & Cells.Rows.Count).End(xlUp).Row
   
    ThisWorkbook.Sheets("archive").Range("A2:AI" & src).ClearContents
    
End Sub
Attribute VB_Name = "Module3"
Sub W1_HomeToGoal_Filter()

    Columns("F:U").Select
    Selection.AutoFilter
    Range("K1").Select
    ActiveSheet.Range("F:U").AutoFilter Field:=6, Criteria1:="=1", _
        Operator:=xlOr, Criteria2:="=-"
    ActiveSheet.Range("F:U").AutoFilter Field:=5, Criteria1:=Array("|fffd|1" _
        , "|fffd|1 0", "1|fffd|"), Operator:=xlFilterValues
    ActiveSheet.Range("F:U").AutoFilter Field:=3, Criteria1:=">=80%", _
        Operator:=xlAnd
End Sub
Sub ClearFilters()
    ActiveSheet.ShowAllData
    Selection.AutoFilter
End Sub
Sub W2_AwayToGoal_Filter()

    Columns("F:U").Select
    Selection.AutoFilter
    ActiveSheet.Range("F:U").AutoFilter Field:=6, Criteria1:="=2", _
        Operator:=xlOr, Criteria2:="=-"
    ActiveSheet.Range("F:U").AutoFilter Field:=5, Criteria1:=Array("|fffd|2" _
        , "|fffd|2 0", "|fffd|2"), Operator:=xlFilterValues
    ActiveSheet.Range("F:U").AutoFilter Field:=4, Criteria1:=">=80%", _
        Operator:=xlAnd
End Sub
Sub TotalOverFilter()

    Columns("F:U").Select
    Selection.AutoFilter
    ActiveSheet.Range("F:U").AutoFilter Field:=6, Criteria1:="<>"
    ActiveSheet.Range("F:U").AutoFilter Field:=11, Criteria1:="<>"
    ActiveSheet.Range("F:U").AutoFilter Field:=7, Criteria1:="|fffd||fffd|1,5"
    ActiveSheet.Range("F:U").AutoFilter Field:=12, Criteria1:="|fffd||fffd|1,5"
    ActiveSheet.Range("F:U").AutoFilter Field:=15, Criteria1:=Array("1" _
        , "2", "3", "4", "5", "6", "7", "8"), Operator:=xlFilterValues
    ActiveSheet.Range("F:U").AutoFilter Field:=16, Criteria1:=Array("1" _
        , "2", "3", "4", "5", "6", "7", "8"), Operator:=xlFilterValues
End Sub
Sub TotalUnderFilter()

    Columns("F:U").Select
    Selection.AutoFilter
    ActiveSheet.Range("F:U").AutoFilter Field:=6, Criteria1:="<>"
    ActiveSheet.Range("F:U").AutoFilter Field:=11, Criteria1:="<>"
    ActiveSheet.Range("F:U").AutoFilter Field:=7, Criteria1:="|fffd||fffd|3,5"
    ActiveSheet.Range("F:U").AutoFilter Field:=12, Criteria1:="|fffd||fffd|3,5"
    ActiveSheet.Range("F:U").AutoFilter Field:=15, Criteria1:=Array("-2" _
        , "-1", "0", "1", "2"), Operator:=xlFilterValues
    ActiveSheet.Range("F:U").AutoFilter Field:=16, Criteria1:=Array("-2" _
        , "-1", "0", "1", "2"), Operator:=xlFilterValues
End Sub




Attribute VB_Name = "Module4"
Sub |fffd||fffd||fffd||fffd||fffd||fffd|1()
Attribute |fffd||fffd||fffd||fffd||fffd||fffd|1.VB_ProcData.VB_Invoke_Func = " \n14"
'
' |fffd||fffd||fffd||fffd||fffd||fffd|1 |fffd||fffd||fffd||fffd||fffd||fffd|
'

'
    Range("M31:N31").Select
    Selection.Copy
    Sheets("ARCHIVE").Select
    Sheets("Forecasts").Select
    Range("R32").Select
    Range("C41").Select
    Application.CutCopyMode = False
    Sheets("V31V34").Select
    Range("M31:N31").Select
    Selection.Copy
    Sheets("Forecasts").Select
    Range("R33").Select
    Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
    Range("R34").Select
    Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
    Range("R35").Select
    Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
        SkipBlanks:=False, Transpose:=False
    Range("O38").Select
End Sub
Attribute VB_Name = "Module5"
Sub |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|()
'
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'

'
    Range("A2:Z6000").Select
    Selection.ClearContents
End Sub
Attribute VB_Name = "frmStatusBar"
Attribute VB_Base = "0{5B8C7C93-9B13-4209-9B8E-AB00586B6B0C}{68924FA7-826C-4EC8-8063-90BBF08CAC1A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'---------------------------------------------------------------------------------------
' Module    : frmStatusBar
' Author    : The_Prist (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
' Purpose   : |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'            (|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| 300 |fffd||fffd||fffd||fffd||fffd|)
'---------------------------------------------------------------------------------------

Private Sub UserForm_Initialize()
10        FrameProgress.Width = 0.0001
End Sub
Attribute VB_Name = "mCustomProgressBarModule"
'---------------------------------------------------------------------------------------
' Author    : The_Prist(|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
'             WebMoney - R298726502453; |fffd||fffd||fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd||fffd||fffd| - 41001332272872
'             http://www.excel-vba.ru
' Purpose   : |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'---------------------------------------------------------------------------------------
Option Explicit
Public bShowBar As Boolean
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public dblProgressWidth As Double, dblStep As Double, dblPercent As Double
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Sub MyProgresBar()
    dblProgressWidth = dblProgressWidth + dblStep
    frmStatusBar.FrameProgress.Width = dblProgressWidth
    If dblProgressWidth > dblPercent Then
        frmStatusBar.lblPercentWhite.Caption = Format(dblPercent / frmStatusBar.FramePrgBar.Width, "0%")
        frmStatusBar.lblPercentBlack.Caption = frmStatusBar.lblPercentWhite.Caption
        dblPercent = dblPercent + dblStep
        frmStatusBar.Repaint
        DoEvents
    End If
End Sub
Function Show_PrBar_Or_No(lCnt As Long, Optional sUfCaption As String = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|...")
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 10 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    bShowBar = (lCnt > 10)
    If bShowBar = False Then Exit Function
    
    frmStatusBar.Caption = sUfCaption
    dblStep = frmStatusBar.FramePrgBar.Width / lCnt
    frmStatusBar.lblPercentWhite.Left = 96
    frmStatusBar.lblPercentBlack.Left = frmStatusBar.lblPercentWhite.Left
    
    frmStatusBar.Show 0
    dblPercent = 0: dblProgressWidth = 0
End Function
Attribute VB_Name = "qwerty"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub TextBox2_Change()

End Sub
Attribute VB_Name = "|fffd||fffd||fffd||fffd|15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub TextBox2_Change()

End Sub
Attribute VB_Name = "|fffd||fffd||fffd||fffd|3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


INQUEST-PP=macro
