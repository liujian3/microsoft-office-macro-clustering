Attribute VB_Name = "CargarDatosBaan"
Attribute VB_Base = "0{107223CB-A2F0-4A0B-B1B2-BF1483FECDD6}{DA76FF94-67A5-4893-BE90-30095E2E30BE}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub cmd_OK_Click()
    CargarDatosBaan.Hide
        If (Me.opt_2) Then
            If (Sheets("Data").Range("tipo_estudio").Value = "estudioArgentina") Then
                If (Sheets("Baan_Rental").Range("ID_Baan_Cotizacion").Value = 0 Or Sheets("Baan_Rental").Range("ID_Baan_Dias").Value = 0) Then
                    MsgBox "Los campos de cotizaci|fffd|n y/o Dias no pueden ser 0"
                    GoTo fin
                End If
            End If
            Ma11_Baan.eguneratu "Baan_Rental"
            Ma11_Baan.eguneratu "Baan_Sale"
        Else
            If referer = "Baan_Rental" Then
                If (Sheets("Data").Range("tipo_estudio").Value = "estudioArgentina") Then
                    If (Sheets("Baan_Rental").Range("ID_Baan_Cotizacion").Value = 0 Or Sheets("Baan_Rental").Range("ID_Baan_Dias").Value = 0) Then
                        MsgBox "Los campos de cotizaci|fffd|n y/o Dias no pueden ser 0"
                        GoTo fin
                    End If
                End If
                Ma11_Baan.eguneratu "Baan_Rental"
            Else
                Ma11_Baan.eguneratu "Baan_Sale"
            End If
        End If
fin:
End Sub



Private Sub UserForm_Activate()
    With CargarDatosBaan
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
    End With
    Dim estudio As String
    estudio = Sheets("Data").Range("tipo_estudio").Value
    If (estudio = "estudioArgentina") Then
            Me.chk_Alquiler = True
            Me.chk_Venta = True
    ElseIf (estudio = "estudioEspana") Then
            Me.chk_Alquiler = False
            Me.chk_Venta = False
    Else
            Me.chk_Alquiler = False
            Me.chk_Venta = False
    End If
    If referer = "Baan_Sale" Then
        Me.chk_Alquiler = False
        Me.chk_Alquiler.Enabled = False
    Else
        Me.chk_Alquiler.Enabled = True
    End If
    Me.Caption = Sheets("Languages").Range("baan_cargaDatos_Titulo").Value
    Me.Frame1.Caption = Sheets("Languages").Range("baan_cargaDatos_frame1Caption").Value
    Me.Frame2.Caption = Sheets("Languages").Range("baan_cargaDatos_frame2Caption").Value
    Me.opt_2.Caption = Sheets("Languages").Range("baan_Ambos").Value & " (Baan_Rental & Baan_Sale)"
    Me.lbl_PrecioAlq.Caption = Sheets("Languages").Range("A1Alquiler").Value
    Me.lbl_PrecioVenta.Caption = Sheets("Languages").Range("A2Venta").Value
End Sub

Attribute VB_Name = "CombinarForm"
Attribute VB_Base = "0{6644019D-123F-468D-9F3D-C41204CF3D62}{9D4F3930-89CD-4077-BBAC-C82807C477B9}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Private Sub cmd_Aceptar_Click()
    Me.Hide
    If Me.chk_Venta.Value = True Then
        ipiniDenaSalmentan
    End If
    konbinatu
End Sub

Private Sub cmd_Cancelar_Click()
    Me.Hide
End Sub


Private Sub UserForm_Activate()
    With CombinarForm
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .chk_Venta.Caption = Sheets("Languages").Range("CombinarForm_chk_Venta").Value
        .frm_Advertencia.Caption = Sheets("Languages").Range("CombinarForm_frm_Advertencia").Value
        .lbl_Advertencia.Caption = Sheets("Languages").Range("CombinarForm_lbl_Advertencia").Value
        .cmd_Aceptar.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdAceptar").Value
        .cmd_Cancelar.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdCancelar").Value
    End With
End Sub

Attribute VB_Name = "CreaEliminaColumna"
Attribute VB_Base = "0{73FDD9C7-D300-45F2-8388-6B43233D6E69}{786A2013-6729-49E9-840E-A61D170F1D15}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub cmd_OK_Click()
    Me.Hide
    If ((txt_Desde.Value = "") And opt_Elimina.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg1_CamposVacios").Value
        Exit Sub
    End If
    Dim inicio, fin As Integer
    inicio = ThisWorkbook.Sheets("Data").Range("NumColumInicioLista").Value
    fin = ThisWorkbook.Sheets("Data").Range("NumColumFinLista").Value
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.DisplayAlerts = False
    ThisWorkbook.Worksheets("BoM").Unprotect
    ThisWorkbook.Worksheets("Summary").Unprotect
    'eliminatzeko balioen txekeoak
    If ((CInt(ConvertToNumber(txt_Desde.Value)) < inicio Or CInt(ConvertToNumber(txt_Desde.Value)) > fin) And opt_Elimina.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg2_FueraRango").Value
        GoTo fin
    End If
    If (inicio = fin And opt_Elimina.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg3_UltColumna").Value
        GoTo fin
    End If
    If opt_Crea.Value = True Then
        creaColumna
    Else
        eliminaColumna
    End If
fin:
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
    ThisWorkbook.Worksheets("Summary").Protect
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.DisplayAlerts = True
End Sub

Sub eliminaColumna()
    colInicio = Sheets("Data").Range("NumColumInicioLista").Value
    inicio = ThisWorkbook.Sheets("Data").Range("FilaInicioArticulos").Value
    colSel = ConvertToNumber(txt_Desde.Value)
    valTajoElim = Sheets("BoM").Cells(inicio - 5, colSel).Value
    valTajoSig = Sheets("BoM").Cells(inicio - 5, colSel + 1).Value
    valDesElim = Sheets("BoM").Cells(inicio - 6, colSel).Value
    Sheets("BoM").Columns(colSel).EntireColumn.Delete
    If (colSel = colInicio) Then
        Sheets("BoM").Range(ConvertToLetter(colInicio) & inicio - 6).Value = "=ID_DespieceMatApar"
    End If
    ColumnaTajoS = Sheets("Data").Range("ColumnaTajoS").Value
    filaIniTajo = Sheets("Data").Range("FilaInicioTajos").Value
    elimSumTajo = colSel - colInicio + filaIniTajo
    ColumnaMultTajoS = Sheets("Data").Range("ColumnaMultTajoS").Value
    If (valTajoElim <> "" And valTajoSig = " ") Then
        Sheets("Summary").Range(ColumnaTajoS & elimSumTajo + 1).Value = valTajoElim
        Sheets("Summary").Range(ColumnaMultTajoS & elimSumTajo + 1).Value = 1
    End If
    Sheets("Summary").Rows(elimSumTajo).EntireRow.Delete
    ''
    filaIniPrecio = Sheets("Data").Range("FilaInicioPrecio").Value
    elimSumPrecio = colSel - colInicio + filaIniPrecio
    Sheets("Summary").Rows(elimSumPrecio).EntireRow.Delete
    ''
    filaIniPeso = Sheets("Data").Range("FilaInicioPeso").Value
    elimSumPeso = colSel - colInicio + filaIniPeso
    Sheets("Summary").Rows(elimSumPeso).EntireRow.Delete
End Sub

Sub creaColumna()
    'BOM
    Dim stock, sobra, falta, colInicio, sarpuntuaLetra, norainoletra As String
    Dim inicio, fin, zenbat As Integer
    Dim rConstants As Range
    colInicio = Sheets("Data").Range("NumColumInicioLista").Value
    colFin = Sheets("Data").Range("NumColumFinLista").Value
    inicio = ThisWorkbook.Sheets("Data").Range("FilaInicioArticulos").Value
    fin = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value
    sarpuntua = colFin
    sarpuntuaLetra = ConvertToLetter(sarpuntua)
    zenbat = 1
    norainoletra = ConvertToLetter(sarpuntua + zenbat)
    Sheets("BoM").Columns(sarpuntua).Select
    ActiveCell.EntireColumn.Offset(, 1).Resize(, zenbat).Insert
    Sheets("BoM").Range(sarpuntuaLetra & inicio - 6 & ":" & sarpuntuaLetra & fin + 1000).Select
    Selection.Copy
    kopiama = ConvertToLetter(ConvertToNumber(norainoletra))
    Sheets("BoM").Range(kopiama & inicio - 6 & ":" & kopiama & fin + 1000).Select
    ActiveSheet.Paste
    Sheets("BoM").Range(norainoletra & inicio - 5 & ":" & kopiama & inicio - 5).Locked = False
    On Error Resume Next
    Sheets("BoM").Range(norainoletra & inicio - 6).Formula = ""
    Set rConstants = Sheets("BoM").Range(norainoletra & inicio - 6 & ":" & kopiama & fin + 1000).SpecialCells(xlCellTypeConstants)
    rConstants.ClearContents
    rConstants.ClearComments
    Application.CutCopyMode = False
    Sheets("BoM").Range("A1").Select
    'SUMMARY
    Dim filafintajo, filafinprecio, filafinpeso As Integer
    Dim ColumnaTajoS, ColumnaMultTajoS, ColumnaListaS, ColumnaMultListaS, ColumnaAlquilerS As String
    filafintajo = Sheets("Data").Range("FilaFinTajos").Value
    ColumnaTajoS = Sheets("Data").Range("ColumnaTajoS").Value
    ColumnaMultTajoS = Sheets("Data").Range("ColumnaMultTajoS").Value
    ColumnaListaS = Sheets("Data").Range("ColumnaListaS").Value
    ColumnaMultListaS = Sheets("Data").Range("ColumnaMultListaS").Value
    ColumnaAlquilerS = Sheets("Data").Range("ColumnaAlquilerS").Value
    Sheets("Summary").Select
    Sheets("Summary").Rows(filafintajo).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafintajo & ":" & "ZZ" & filafintajo).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafintajo + 1 & ":" & "ZZ" & filafintajo + 1).Select
    ActiveSheet.Paste
    Set rConstants = Sheets("Summary").Range("A" & filafintajo + 1 & ":" & "ZZ" & filafintajo + 1).SpecialCells(xlCellTypeConstants)
    rConstants.ClearContents
    rConstants.ClearComments
    Sheets("Summary").Range(ColumnaTajoS & filafintajo + 1).Value = "NEW UNIT " & Sheets("Data").Range("NumNuevoTajo").Value
    Sheets("Data").Range("NumNuevoTajo").Value = Sheets("Data").Range("NumNuevoTajo").Value + 1
    Sheets("Summary").Range(ColumnaMultTajoS & filafintajo + 1).Value = 1
    Sheets("Summary").Range(ColumnaListaS & filafintajo + 1).Value = "NEW LIST " & Sheets("Data").Range("NumNuevaLista").Value
    Sheets("Data").Range("NumNuevaLista").Value = Sheets("Data").Range("NumNuevaLista").Value + 1
    Sheets("Summary").Range(ColumnaMultListaS & filafintajo + 1).Value = 1
    Sheets("Summary").Range(ColumnaAlquilerS & filafintajo + 1).Value = 0
    ''
    filafinprecio = Sheets("Data").Range("FilaFinPrecio").Value
    Sheets("Summary").Rows(filafinprecio).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafinprecio & ":" & "ZZ" & filafinprecio).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafinprecio + 1 & ":" & "ZZ" & filafinprecio + 1).Select
    ActiveSheet.Paste
    ''
    filafinpeso = Sheets("Data").Range("FilaFinPeso").Value
    Sheets("Summary").Rows(filafinpeso).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafinpeso & ":" & "ZZ" & filafinpeso).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafinpeso + 1 & ":" & "ZZ" & filafinpeso + 1).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Sheets("BoM").Select
End Sub

Private Sub opt_Crea_Change()
    If opt_Crea.Value = True Then
        lbl_Desde.Visible = False
        txt_Desde.Visible = False
        txt_Desde.Value = ""
        lbl_Hasta.Visible = False
        txt_hasta.Visible = False
        txt_hasta.Value = ""
    End If
End Sub


Private Sub opt_Elimina_Change()
    If opt_Elimina.Value = True Then
        lbl_Desde.Visible = True
        txt_Desde.Visible = True
        txt_Desde.Value = ""
'        lbl_Hasta.Visible = True
'        txt_hasta.Visible = True
'        txt_hasta.Value = ""
        lbl_Desde.Caption = Sheets("Languages").Range("CreaEliminaColumna_Desde").Value
        lbl_Hasta.Caption = Sheets("Languages").Range("CreaEliminaColumna_Hasta").Value
    End If
End Sub

Private Sub UserForm_Activate()
    With CreaEliminaColumna
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .opt_Crea.Value = True
        .opt_Crea.Caption = Sheets("Languages").Range("CreaEliminaColumna_Insertar").Value
        .opt_Elimina.Caption = Sheets("Languages").Range("CreaEliminaColumna_Eliminar").Value
        .Caption = Sheets("Languages").Range("CreaEliminaColumna_Titulo").Value
        .lbl_Desde = Sheets("Languages").Range("CreaEliminaColumna_Donde").Value
        .lbl_Hasta = Sheets("Languages").Range("CreaEliminaColumna_Cantidad").Value
        .lbl_Desde.Visible = False
        .txt_Desde.Visible = False
        .txt_Desde.Value = ""
        .lbl_Hasta.Visible = False
        .txt_hasta.Visible = False
        .txt_hasta.Value = ""
    End With
End Sub





Attribute VB_Name = "CreaEliminaLinea"
Attribute VB_Base = "0{A06799D6-CADD-4620-9336-57F9A4A1FFD1}{CEB39443-3FDA-47EA-BAD7-EC3DD71E101D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Private Sub cmd_OK_Click()
    Me.Hide
    If (txt_Desde.Value = "" Or txt_hasta.Value = "") Then
        MsgBox Sheets("Languages").Range("Msg1_CamposVacios").Value
        Exit Sub
    End If
    Dim inicio, fin As Integer
    inicio = ThisWorkbook.Sheets("Data").Range("FilaInicioArticulos").Value
    fin = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.DisplayAlerts = False
    ThisWorkbook.Worksheets("BoM").Unprotect
    'eliminatzeko balioen txekeoak
    If (CInt(txt_Desde.Value) < inicio Or CInt(txt_hasta.Value) > fin And opt_Elimina.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg2_FueraRango").Value
        GoTo fin
    End If
    If (CInt(txt_Desde.Value) > CInt(txt_hasta.Value) And opt_Elimina.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg5_DesdeMayorHasta").Value
        GoTo fin
    End If
    If (CInt(txt_Desde.Value) = inicio And CInt(txt_hasta.Value) = fin And opt_Elimina.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg6_ElimTodasLineas").Value
        GoTo fin
    End If
    If (inicio = fin And opt_Elimina.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg4_UltLinea").Value
        GoTo fin
    End If
    If (CInt(txt_Desde.Value) < inicio Or CInt(txt_Desde.Value) > fin And opt_Crea.Value = True) Then
        MsgBox Sheets("Languages").Range("Msg1_CamposVacios").Value
        GoTo fin
    End If
    If opt_Crea.Value = True Then
        creaLinea
    Else
        eliminalinea
    End If
fin:
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.DisplayAlerts = True
End Sub




Sub eliminalinea()
    For i = txt_Desde.Value To txt_hasta.Value
        kenduIkonoaBaldinBadu "D" & i
    Next
    Sheets("BoM").Range(CInt(txt_Desde.Value) & ":" & CInt(txt_hasta.Value)).EntireRow.Delete
End Sub

Sub creaLinea()
    Dim stock, sobra, falta, colInicio As String
    colInicio = Sheets("Data").Range("ColumInicioLista").Value
    colFin = Sheets("Data").Range("ColumFinLista").Value
    sarpuntua = CInt(txt_Desde.Value)
    zenbat = CInt(txt_hasta.Value)
    Sheets("BoM").Rows(sarpuntua & ":" & sarpuntua).Select
    ActiveCell.EntireRow.Resize(zenbat).Insert
    Sheets("BoM").Range("B" & sarpuntua + zenbat & ":" & colFin & sarpuntua + zenbat).Select
    Selection.Copy
    Sheets("BoM").Range("B" & sarpuntua & ":" & colFin & sarpuntua + zenbat - 1).Select
    ActiveSheet.Paste
    Range("D" & sarpuntua & ":E" & sarpuntua + zenbat - 1 & ",G" & sarpuntua & ":G" & sarpuntua + zenbat - 1 & ",J" & sarpuntua & ":J" & sarpuntua + zenbat - 1 & ",L" & sarpuntua & ":L" & sarpuntua + zenbat - 1 & ",P" & sarpuntua & ":P" & sarpuntua + zenbat - 1 & ",R" & sarpuntua & ":" & colFin & sarpuntua + zenbat - 1).Select
    'Range("M" & sarpuntua).Activate
    Application.CutCopyMode = False
    Selection.ClearContents
    Selection.ClearComments
    Range("K" & sarpuntua & ":K" & sarpuntua + zenbat - 1).Value = 1#
    Range("M" & sarpuntua & ":M" & sarpuntua + zenbat - 1).Value = 1#
End Sub

Private Sub opt_Crea_Change()
    If opt_Crea.Value = True Then
        lbl_Desde.Caption = Sheets("Languages").Range("CreaEliminaLinea_Donde").Value
        lbl_Hasta.Caption = Sheets("Languages").Range("CreaEliminaLinea_Cantidad").Value
    End If
End Sub


Private Sub opt_Elimina_Change()
    If opt_Elimina.Value = True Then
        lbl_Desde.Caption = Sheets("Languages").Range("CreaEliminaLinea_Desde").Value
        lbl_Hasta.Caption = Sheets("Languages").Range("CreaEliminaLinea_Hasta").Value
    End If
End Sub


Private Sub UserForm_Activate()
    With CreaEliminaLinea
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .opt_Crea.Caption = Sheets("Languages").Range("CreaEliminaLinea_Insertar").Value
        .opt_Elimina.Caption = Sheets("Languages").Range("CreaEliminaLinea_Eliminar").Value
        .Caption = Sheets("Languages").Range("CreaEliminaLinea_Titulo").Value
        .lbl_Desde = Sheets("Languages").Range("CreaEliminaLinea_Donde").Value
        .lbl_Hasta = Sheets("Languages").Range("CreaEliminaLinea_Cantidad").Value
    End With
End Sub


Attribute VB_Name = "FREIGHT"
Attribute VB_Base = "0{3A880160-CD4C-485B-9112-AD73C5EEE18F}{445C634D-5224-43DD-8A0E-828B73E4BBBB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()

    If ((OptionButton1.Value Or OptionButton2.Value Or OptionButton3.Value Or OptionButton4.Value Or OptionButton5.Value Or OptionButton6.Value Or OptionButton9.Value Or OptionButton10.Value)) Then
        
        If OptionButton1.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "B"

        End If
        If OptionButton2.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "C.P.U."
    
        End If
        If OptionButton3.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "N.B.E."
  
        End If
        If OptionButton4.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "N.B.L."

        End If
        If OptionButton5.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "N.B.S."

        End If
        If OptionButton6.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "N.B.A."
        End If

        If OptionButton9.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "S.D."
        End If
        
        If OptionButton10.Value Then
            Sheets("ItemView").Range("ID_Data_Freight").Value = "B-LTL/FEDEX"
        End If
    End If

        If ((OptionButton7.Value Or OptionButton8.Value Or OptionButton2.Value Or OptionButton9.Value Or OptionButton10.Value)) Then
            If OptionButton7.Value Then
                Sheets("ItemView").Range("ID_Data_Union").Value = "UNION"
            End If
        
           If OptionButton8.Value Then
              Sheets("ItemView").Range("ID_Data_Union").Value = "NON UNION"
            End If
            
            If OptionButton2.Value Or OptionButton9.Value Or OptionButton10.Value Then
                Sheets("ItemView").Range("ID_Data_Union").Value = "N/A"
            Else

            End If
            
        Else

        End If
        
                    If (Not OptionButton2.Value And Not OptionButton9.Value And Not OptionButton10.Value And Sheets("ItemView").Range("ID_Data_Union").Value = "N/A") Then
                        Sheets("ItemView").Range("ID_Data_Union").Value = ""
                    End If
        Unload Me
        

    
End Sub

Private Sub OptionButton1_Click()
    OptionButton7.Enabled = True
    OptionButton8.Enabled = True
End Sub

Private Sub OptionButton3_Click()
    OptionButton7.Enabled = True
    OptionButton8.Enabled = True
End Sub
Private Sub OptionButton4_Click()
    OptionButton7.Enabled = True
    OptionButton8.Enabled = True
End Sub
Private Sub OptionButton5_Click()
    OptionButton7.Enabled = True
    OptionButton8.Enabled = True
End Sub
Private Sub OptionButton6_Click()
    OptionButton7.Enabled = True
    OptionButton8.Enabled = True
End Sub
Private Sub OptionButton9_Click()
    OptionButton7.Enabled = False
    OptionButton8.Enabled = False
End Sub

Private Sub OptionButton2_Click()
    OptionButton7.Enabled = False
    OptionButton8.Enabled = False
End Sub

Private Sub OptionButton10_Click()
    OptionButton7.Enabled = False
    OptionButton8.Enabled = False
End Sub



Private Sub UserForm_Activate()
    With FREIGHT
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
    End With
End Sub


Attribute VB_Name = "FamilyFactors_Form"
Attribute VB_Base = "0{FF3936D7-0F52-4380-90F0-25309F3108F6}{D16E1A56-EDE5-462D-A6AC-C5D1FAE33C30}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private familiakForm() As String
Dim tbCollection As Collection

Private Sub cmd_Cancel_Click()
    Me.Hide
    Unload Me
End Sub

Private Sub cmd_OK_Click()
    For i = LBound(familiakForm) To UBound(familiakForm)
        'lortu faktoreak
        For j = 0 To Me.Frame1.Controls.Count - 1
            If Me.Frame1.Controls.Item(j).Name = "txtAlq_" & familiakForm(i) Then
                faktAlq = Me.Frame1.Controls.Item(j).Value
            End If
            If Me.Frame1.Controls.Item(j).Name = "txtVen_" & familiakForm(i) Then
                faktVen = Me.Frame1.Controls.Item(j).Value
            End If
        Next
        esleituFakt familiakForm(i), faktAlq, True
        esleituFakt familiakForm(i), faktVen, False
    Next
    'Globalak aparte
    esleituFaktGB Me.txt_factAlqGlobal, True
    esleituFaktGB Me.txt_factVenGlobal, False
        
    Me.Hide
    Unload Me
End Sub



Private Sub UserForm_Activate()
    Dim familiak() As String
    Dim colFactAlq As Integer
    Dim colFactVen As Integer
    Dim mezua As Boolean
    'zentratu
    With FamilyFactors_Form
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .lbl_factAlq = Sheets("Languages").Range("FamilyFactors_factAlq").Value
        .lbl_Venta = Sheets("Languages").Range("FamilyFactors_Venta").Value
        .lbl_Familias = Sheets("Languages").Range("FamilyFactors_Familias").Value
        .frm_Global.Caption = Sheets("Languages").Range("FamilyFactors_Global").Value
        .cmd_Cancel.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdCancelar").Value
        .cmd_OK.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdAceptar").Value
    End With
    mezua = False
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    idFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    filaTitulos = inicio - 1
    idPrecioAlq = Sheets("Languages").Range("ID_PrecioAlquiler").Value
    idPrecioVen = Sheets("Languages").Range("ID_PrecioVenta").Value
    familyCol = Application.Match(idFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0)
    factAlqCol = ConvertToLetter(Application.Match(idPrecioAlq, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    factVenCol = ConvertToLetter(Application.Match(idPrecioVen, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    Me.txt_factAlqGlobal.Value = Format(Sheets("BoM").Range(factAlqCol & filaTitulos).Value, "0.000")
    Me.txt_factVenGlobal.Value = Format(Sheets("BoM").Range(factVenCol & filaTitulos).Value, "0.000")
    familiak = getFamilyArray()
    familiakForm = familiak
    For i = LBound(familiak) To UBound(familiak)
        Set theLabel = Me.Frame1.Controls.Add("Forms.Label.1", "lbl_" & familiak(i), True)
        With theLabel
            .Caption = familiak(i)
            If (Left(familiak(i), 4) = "****") Then
                .ForeColor = vbRed
            Else
                .ForeColor = vbBlack
            End If
            .Left = 15
            .Width = 200
            .Top = 3 + (15 * i)
        End With
        fakt = checkSameFactor(familiak(i), True)
        If fakt = -1 Then
            mezua = True
        End If
        faktorea = ""
        If fakt <> -1 Then
            faktorea = fakt
        End If
        Set edtBox_Alq = Me.Frame1.Controls.Add("Forms.TextBox.1", "txtAlq_" & familiak(i), True)
        With edtBox_Alq
            .Left = 216 + 5
            .MultiLine = False
            .EnterKeyBehavior = True
            .Height = 18
            .Width = 35
            .Top = 3 + (15 * i)
            .Value = Format(faktorea, "0.000")
        End With
        Set theLabel2 = Me.Frame1.Controls.Add("Forms.Label.1", "lblAlq_" & familiak(i), True)
        If IsNumeric(edtBox_Alq.Value) And IsNumeric(Me.txt_factAlqGlobal.Value) Then
            idatzi = Format(edtBox_Alq.Value * Me.txt_factAlqGlobal.Value, "0.000")
        Else
            idatzi = "#N/A"
        End If
        With theLabel2
            .Caption = "(" & idatzi & ")" 'factorAlq * factorFam
            .Left = 265
            .Width = 30
            .Top = 5 + (15 * i)
        End With
        fakt = checkSameFactor(familiak(i), False)
        If fakt = -1 Then
            mezua = True
        End If
        faktorea = ""
        If fakt <> -1 Then
            faktorea = fakt
        End If
        Set edtBox_Ven = Me.Frame1.Controls.Add("Forms.TextBox.1", "txtVen_" & familiak(i), True)
        With edtBox_Ven
            .Left = 300 + 5
            .MultiLine = False
            .EnterKeyBehavior = True
            .Height = 18
            .Width = 35
            .Top = 3 + (15 * i)
            .Value = Format(faktorea, "0.000")
        End With
        If IsNumeric(edtBox_Ven.Value) And IsNumeric(Me.txt_factVenGlobal.Value) Then
            idatzi = Format(edtBox_Ven.Value * Me.txt_factVenGlobal.Value, "0.000")
        Else
            idatzi = "#N/A"
        End If
        Set theLabel3 = Me.Frame1.Controls.Add("Forms.Label.1", "lblVen_" & familiak(i), True)
        With theLabel3
            .Caption = "(" & idatzi & ")" 'factorVen * factorFam
            .Left = 348
            .Width = 30
            .Top = 5 + (15 * i)
        End With
    Next
    Me.Frame1.ScrollHeight = (UBound(familiak) - LBound(familiak)) * 17
    If mezua Then
        MsgBox "Las familias con diferentes factores se han dejado vacios."
    End If
    '''' Dinamikoki sortutako textBox-en ebentuak kontrolatzeko gure dynTxtBox klaseko instantzia bezala sortu ondoren han kontrolatzeko ebentua
     Dim ctrl As MSForms.Control
    Dim obj As dynTxtBox

    Set tbCollection = New Collection
        For Each ctrl In Me.Controls
            If TypeOf ctrl Is MSForms.TextBox Then
                Set obj = New dynTxtBox
                Set obj.Control = ctrl
                tbCollection.Add obj
            End If
        Next ctrl
    Set obj = Nothing
    ''''
End Sub

Sub refrescar()
Dim lblAlq As Object
    Dim lblVen As Object
    factAlgGB = Me.txt_factAlqGlobal.Value
    factVenGB = Me.txt_factVenGlobal.Value
    For i = LBound(familiakForm) To UBound(familiakForm)
        For j = 0 To Me.Frame1.Controls.Count - 1
            If Me.Frame1.Controls.Item(j).Name = "txtAlq_" & familiakForm(i) Then
                faktAlq = Me.Frame1.Controls.Item(j).Value
            End If
            If Me.Frame1.Controls.Item(j).Name = "txtVen_" & familiakForm(i) Then
                faktVen = Me.Frame1.Controls.Item(j).Value
            End If
            If Me.Frame1.Controls.Item(j).Name = "lblAlq_" & familiakForm(i) Then
                Set lblAlq = Me.Frame1.Controls.Item(j)
            End If
            If Me.Frame1.Controls.Item(j).Name = "lblVen_" & familiakForm(i) Then
                Set lblVen = Me.Frame1.Controls.Item(j)
            End If
        Next
       If IsNumeric(factAlgGB) And IsNumeric(faktAlq) Then
            lblAlq.Caption = "(" & Format(factAlgGB * faktAlq, "0.000") & ")"
        Else
            lblAlq.Caption = "(#N/A)"
        End If
        If IsNumeric(factVenGB) And IsNumeric(faktVen) Then
            lblVen.Caption = "(" & Format(factVenGB * faktVen, "0.000") & ")"
        Else
            lblVen.Caption = "(#N/A)"
        End If
    Next
    Me.Repaint
End Sub

Attribute VB_Name = "GenerarTXTBaan"
Attribute VB_Base = "0{339E8BED-ED24-4EF2-8762-590EE7C9F91C}{46EB4842-D34B-4F07-A41F-BED5DF7E68EF}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub cmd_OK_Click()
    Me.Hide
    If opt_1 Then
        If Sheets(referer).Range("A14") = "" Then
            MsgBox referer & ": " & Sheets("Languages").Range("Msg25_FaltanDatosArt").Value
            GoTo fin
        End If
        correcto = comprobarDatosCabecera(opt_1.Caption)
        If correcto Then
            Ma11_Baan.generartxt (opt_1.Caption)
        End If
    End If
    If opt_2 Then
        If Sheets(referer).Range("A14") = "" Then
            MsgBox referer & ": " & Sheets("Languages").Range("Msg25_FaltanDatosArt").Value
            GoTo sig
        Else
            correcto1 = comprobarDatosCabecera(referer)
            If correcto1 Then
                Ma11_Baan.generartxt (referer)
            End If
        End If
sig:
        If referer = "Baan_Rental" Then
            bi = "Baan_Sale"
        Else
            bi = "Baan_Rental"
        End If
        If Sheets(bi).Range("A14") = "" Then
            MsgBox bi & ": " & Sheets("Languages").Range("Msg25_FaltanDatosArt").Value
            GoTo fin
        Else
            correcto2 = comprobarDatosCabecera(bi)
            If correcto2 Then
                If cabecerasIguales Then
                    MsgBox referer & " " & Sheets("Languages").Range("Msg26_SolounTXT").Value
                Else
                    Ma11_Baan.generartxt (bi)
                End If
            End If
        End If
    End If
fin:
End Sub

Private Sub UserForm_Activate()
    With GenerarTXTBaan
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
    End With
    Me.Caption = Sheets("Languages").Range("baan_generarTxt_Titulo").Value
    Me.opt_2.Caption = Sheets("Languages").Range("baan_Ambos").Value & " (Baan_Rental & Baan_Sale)"
End Sub
Attribute VB_Name = "Hoja1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cmd_gmaps, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "cmd_gmaps2, 2, 1, MSForms, CommandButton"
Private Sub cmd_gmaps_Click()
    gmaps_arakatu Sheets("BoM").Range("ID_Data_PoblacionObra").Value
End Sub



Private Sub cmd_gmaps2_Click()
    gmaps_arakatu Sheets("BoM").Range("ID_Data_Direccion").Value & "," & Sheets("BoM").Range("ID_Data_PoblacionCliente").Value
End Sub
Attribute VB_Name = "Hoja2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cmd_toRepcon, 30, 0, MSForms, CommandButton"
Attribute VB_Control = "cmd_JoinColumns, 29, 1, MSForms, CommandButton"
Attribute VB_Control = "cmd_SplitGrSGr, 28, 2, MSForms, CommandButton"
Attribute VB_Control = "cmd_Factores, 27, 3, MSForms, CommandButton"
Attribute VB_Control = "cmd_SavePNG, 26, 4, MSForms, CommandButton"
Attribute VB_Control = "cmd_Combinar, 24, 5, MSForms, CommandButton"
Attribute VB_Control = "cmd_gmaps, 15, 6, MSForms, CommandButton"
Attribute VB_Control = "btn_importarPrecios, 13, 7, MSForms, CommandButton"
Attribute VB_Control = "comboCambioCaratulas, 12, 8, MSForms, ComboBox"
Attribute VB_Control = "btnCargarImagenesBoM, 5, 9, MSForms, CommandButton"
Attribute VB_Control = "btnQuitarImagenesBoM, 6, 10, MSForms, CommandButton"
Attribute VB_Control = "btnNuevoArticulo, 7, 11, MSForms, CommandButton"
Attribute VB_Control = "btn_Cotizador, 14, 12, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 16, 13, MSForms, CommandButton"
Attribute VB_Control = "cmd_ModoXML, 17, 14, MSForms, CommandButton"
Attribute VB_Control = "tgb_idiomaLocal, 19, 15, MSForms, ToggleButton"
Attribute VB_Control = "tgb_idiomaESCorp, 20, 16, MSForms, ToggleButton"
Attribute VB_Control = "tgb_idiomaENCorp, 21, 17, MSForms, ToggleButton"
Attribute VB_Control = "cmd_updatePrices, 22, 18, MSForms, CommandButton"
Attribute VB_Control = "cmd_gmaps2, 23, 19, MSForms, CommandButton"
Attribute VB_Control = "cmd_FromAcadRevit, 31, 20, MSForms, CommandButton"



Private Sub cmd_Combinar_Click()
    CombinarForm.Show
End Sub

Private Sub cmd_Factores_Click()
    FamilyFactors_Form.Show
End Sub

Private Sub cmd_FromAcadRevit_Click()
    Mzz_FromAutocadRevit.fromACAD
End Sub

Private Sub cmd_JoinColumns_Click()
    Mzz_Split_Join_ColumnasGR.unirAUnaColumna
End Sub

Private Sub cmd_SavePNG_Click()
    Mzz_SavePNG.SavePNG
End Sub

Private Sub cmd_SplitGrSGr_Click()
    SplitInColumns_Form.Show
End Sub

Private Sub cmd_toRepcon_Click()
    Mzz_ToRepcon.toRepcon
End Sub

Private Sub cmd_updatePrices_Click()
    actualizarPrecios
End Sub



Private Sub tgb_idiomaENCorp_Click()
    Application.EnableEvents = False
    Dim finalizado As String
    finalizado = Sheets("Data").Range("CargaInicialFinalizada").Value
    If finalizado = "X" And tgb_idiomas <> "X" Then
        Application.Interactive = False
        If tgb_idiomaENCorp.Value = True Then
            tgb_idiomas = "X"
            If (tgb_idiomaESCorp.Value = False And tgb_idiomaLocal.Value = False) Then
                tgb_idiomas = ""
            End If
            tgb_idiomaESCorp.Value = False
            tgb_idiomaLocal.Value = False
            cambiaIdiomaDesc 2
            Sheets("Data").Range("IdiomaDatos").Value = "ENCorp"
        Else
            tgb_idiomas = "X"
            tgb_idiomaENCorp.Value = True
        End If
        Application.Interactive = True
    Else
        tgb_idiomas = ""
    End If
    Application.EnableEvents = True
End Sub

Private Sub tgb_idiomaESCorp_Click()
    Application.EnableEvents = False
    Dim finalizado As String
    finalizado = Sheets("Data").Range("CargaInicialFinalizada").Value
    If finalizado = "X" And tgb_idiomas <> "X" Then
        Application.Interactive = False
        If tgb_idiomaESCorp.Value = True Then
            tgb_idiomas = "X"
            If (tgb_idiomaENCorp.Value = False And tgb_idiomaLocal.Value = False) Then
                tgb_idiomas = ""
            End If
            tgb_idiomaENCorp.Value = False
            tgb_idiomaLocal.Value = False
            cambiaIdiomaDesc 1
            Sheets("Data").Range("IdiomaDatos").Value = "ESCorp"
        Else
            tgb_idiomas = "X"
            tgb_idiomaESCorp.Value = True
        End If
        Application.Interactive = True
    Else
        tgb_idiomas = ""
    End If
    Application.EnableEvents = True
End Sub


Private Sub tgb_idiomaLocal_Click()
    Application.EnableEvents = False
    Dim finalizado As String
    finalizado = Sheets("Data").Range("CargaInicialFinalizada").Value
    If finalizado = "X" And tgb_idiomas <> "X" Then
        Application.Interactive = False
        If tgb_idiomaLocal.Value = True Then
            tgb_idiomas = "X"
            If (tgb_idiomaENCorp.Value = False And tgb_idiomaESCorp.Value = False) Then
                tgb_idiomas = ""
            End If
            tgb_idiomaENCorp.Value = False
            tgb_idiomaESCorp.Value = False
            cambiaIdiomaDesc 0
            Sheets("Data").Range("IdiomaDatos").Value = "local"
        Else
            tgb_idiomas = "X"
            tgb_idiomaLocal.Value = True
        End If
        Application.Interactive = True
    Else
        tgb_idiomas = ""
    End If
    Application.EnableEvents = True
End Sub


Private Sub btn_Cotizador_Click()
    If Sheets("Data").Range("tipo_estudio").Value = "estudioMexico" Then
        Cotizador
    ElseIf Sheets("Data").Range("tipo_estudio").Value = "estudioChequia" Then
        exportSteny
    ElseIf Sheets("Data").Range("tipo_estudio").Value = "estudioEslovaquia" Then
        exportStenySK
    ElseIf Sheets("Data").Range("tipo_estudio").Value = "estudioAlemania" Then
        ExportMLGermanyNew
    End If
End Sub

Private Sub btn_importarPrecios_Click()
    ImportForm.Show
End Sub

Private Sub btnCargarImagenesBoM_Click()
    If Worksheets("Data").Range("UtilizandoCD").Value = "X" Then
        CargarImagenesBoMCD
    Else
        CargarImagenesBoM
    End If
    btnCargarImagenesBoM.Visible = False
    btnQuitarImagenesBoM.Visible = True
    ComprimirImagenes
End Sub

Private Sub btnNuevoArticulo_Click()
    'InsertarFila
    CreaEliminaLinea.Show
End Sub

Private Sub btnQuitarImagenesBoM_Click()
    QuitarImagenesBoM
    btnQuitarImagenesBoM.Visible = False
    btnCargarImagenesBoM.Visible = True
End Sub

Private Sub cbox_idiomaMat_Change()
    Select Case cbox_idiomaMat.Value
        Case "local"
            cambiaIdiomaDesc 0
        Case "ESCorp"
            cambiaIdiomaDesc 1
        Case "ENCorp"
            cambiaIdiomaDesc 2
        Case Else
            cambiaIdiomaDesc 0
    End Select
End Sub

Private Sub cmd_gmaps_Click()
    gmaps_arakatu Sheets("BoM").Range("ID_Data_PoblacionObra").Value
End Sub



Private Sub cmd_gmaps2_Click()
    gmaps_arakatu Sheets("BoM").Range("ID_Data_Direccion").Value & "," & Sheets("BoM").Range("ID_Data_PoblacionCliente").Value
End Sub

Private Sub cmd_ModoXML_Click()
    If cmd_ModoXML.Caption = "Online" Then
        cmd_ModoXML.Caption = "Offline"
        cmd_ModoXML.BackColor = RGB(255, 0, 0)
        tgb_idiomaLocal.Enabled = False
        tgb_idiomaESCorp.Enabled = False
        tgb_idiomaENCorp.Enabled = False
        'cmd_updatePrices.Enabled = False
    Else
        cmd_ModoXML.Caption = "Online"
        cmd_ModoXML.BackColor = RGB(102, 255, 102)
        'cbox_idiomaMat.Enabled = True
        tgb_idiomaLocal.Enabled = True
        tgb_idiomaESCorp.Enabled = True
        tgb_idiomaENCorp.Enabled = True
        'Ezgaitu eta berriro gaitu, konexio edukita Offline-tik Onlinera gatozen kasuan, ez baititu lehenengoan hizkuntza botoiak aktibatzen (bug).
        tgb_idiomaLocal.Enabled = False
        tgb_idiomaESCorp.Enabled = False
        tgb_idiomaENCorp.Enabled = False
        tgb_idiomaLocal.Enabled = True
        tgb_idiomaESCorp.Enabled = True
        tgb_idiomaENCorp.Enabled = True
        'cmd_updatePrices.Enabled = True
    End If
End Sub

'Private Sub comboCambioCaratulas_Change()
'    If Sheets("Data").Range("CargaInicialFinalizada").Value = "X" Then
'        Application.ScreenUpdating = False
'        voyACambiarCaratulas = "OK"
'        Sheets("ItemView").Select
'        Sheets("ItemView").Unprotect
'        DeleteAllPivotTablesInWorkbook
'        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True _
'            , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
'            AllowFormattingRows:=True, AllowSorting:=True, AllowFiltering:=True, _
'            AllowUsingPivotTables:=True
'        Sheets("BoM").Select
'        'CambiarCondicion
'        Range("M2").Select
'        voyACambiarCaratulas = ""
'        Application.ScreenUpdating = True
'    End If
'End Sub

Private Sub CommandButton1_Click()
    CreaEliminaColumna.Show
End Sub


Attribute VB_Name = "Hoja3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Hoja4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Hoja5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cmd_gmaps, 10, 0, MSForms, CommandButton"
Attribute VB_Control = "btnQuitarImagenesItemView, 4, 1, MSForms, CommandButton"
Attribute VB_Control = "btnCargarImagenesItemView, 3, 2, MSForms, CommandButton"
Attribute VB_Control = "btnListadoPDF, 5, 3, MSForms, CommandButton"
Attribute VB_Control = "btn_Freight, 7, 4, MSForms, CommandButton"
Attribute VB_Control = "btn_Release, 8, 5, MSForms, CommandButton"
Attribute VB_Control = "cmd_gmaps2, 11, 6, MSForms, CommandButton"
Dim actualizandoPT As Boolean

Private Sub btn_Freight_Click()
    FREIGHT.Show
End Sub

Private Sub btn_Release_Click()
    If (Sheets("ItemView").Range("ID_Data_Freight").Value = "") Then
        MsgBox "Please, Fill Freight and Union before exporting to Release", vbOKOnly, "Warning"
    Else
        ReleaseForm.Show
    End If
End Sub

Private Sub btnCargarImagenesItemView_Click()
    If Worksheets("Data").Range("UtilizandoCD").Value = "X" Then
        CargarImagenesItemViewCD
    Else
        CargarImagenesItemView
    End If
    btnCargarImagenesItemView.Visible = False
    btnQuitarImagenesItemView.Visible = True
    ComprimirImagenes
End Sub

Private Sub btnListadoPDF_Click()
        ImageFormExt.Show
End Sub

Private Sub btnQuitarImagenesItemView_Click()
    QuitarImagenesItemView
    btnQuitarImagenesItemView.Visible = False
    btnCargarImagenesItemView.Visible = True
End Sub

Private Sub cmd_Baan_Click()
    Ma11_Baan_NEW.eguneratu "Baan_Sale"
    Ma11_Baan_NEW.eguneratu "Baan_Rental"
    MsgBox "Data exported to Baan_Rental and Baan_Sale sheets"
End Sub

Private Sub cmd_gmaps_Click()
    gmaps_arakatu Sheets("BoM").Range("ID_Data_PoblacionObra").Value
End Sub



Private Sub cmd_gmaps2_Click()
    gmaps_arakatu Sheets("BoM").Range("ID_Data_Direccion").Value & "," & Sheets("BoM").Range("ID_Data_PoblacionCliente").Value
End Sub
'Private Sub Worksheet_PivotTableUpdate(ByVal Target As PivotTable)
'    Application.ScreenUpdating = False
'    If Worksheets("Data").Range("Imagenes3DCargadas").Value = "X" And ThisWorkbook.seHaCambiadoAPesta|fffd|aItemView = False Then
'            QuitarImagenesParaDespuesRecargarItemView
'    End If
'
'    If actualizandoPT = False Then
'
'        actualizandoPT = True
'        Application.EnableEvents = False
'        Set PT1 = Nothing
'        On Error Resume Next
'        Set PT1 = Worksheets("ItemView").PivotTables("TablaDinamica")
'        ActiveSheet.PivotTables("TablaDinamica").ChangePivotCache ActiveWorkbook. _
'            PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
'            "=indirect(RangoTD)", Version:=xlPivotTableVersion12)
'
'        On Error GoTo 0
'
'        If PT1 Is Nothing Then
'            Else
'                R = PT1.DataBodyRange.Rows.Count
'                Cells(26, 15) = R - 1
'                Columns("O:O").EntireColumn.AutoFit
'        End If
'        Application.EnableEvents = True
'        actualizandoPT = False
'    End If
'
'    If Worksheets("Data").Range("Imagenes3DCargadas").Value = "X" And ThisWorkbook.seHaCambiadoAPesta|fffd|aItemView = False Then
'        If Worksheets("Data").Range("UtilizandoCD").Value = "X" Then
'            CargarImagenesItemViewCD
'        Else
'            CargarImagenesItemView
'            ComprimirImagenes
'        End If
'    End If
'    ReasignaRangoAFormatoCondicionalItemView
'    Application.ScreenUpdating = True
'End Sub
Attribute VB_Name = "Hoja6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cmd_CopiarCabecera, 12, 0, MSForms, CommandButton"
Attribute VB_Control = "cmd_eliminarNegativos, 11, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 10, 2, MSForms, CommandButton"
Attribute VB_Control = "cmd_CargarDatos, 9, 3, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 8, 4, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 7, 5, MSForms, CommandButton"
Attribute VB_Control = "generartxt, 1, 6, MSForms, CommandButton"
Private Sub cmd_CargarDatos_Click()
    referer = Me.Name
    CargarDatosBaan.opt_bat.Caption = Me.Name
    CargarDatosBaan.Show
End Sub

Private Sub cmd_CopiarCabecera_Click()
    Sheets("Baan_Sale").Range("Cliente").Value = Sheets("Baan_Rental").Range("Cliente").Value
    Sheets("Baan_Sale").Range("nomCli").Value = Sheets("Baan_Rental").Range("nomCli").Value
    Sheets("Baan_Sale").Range("Comercial").Value = Sheets("Baan_Rental").Range("Comercial").Value
    Sheets("Baan_Sale").Range("nomCom").Value = Sheets("Baan_Rental").Range("nomCom").Value
    Sheets("Baan_Sale").Range("Oferta").Value = Sheets("Baan_Rental").Range("Oferta").Value
    Sheets("Baan_Sale").Range("Contrato").Value = Sheets("Baan_Rental").Range("Contrato").Value
    MsgBox Sheets("Languages").Range("Msg24_CopiaCabecera").Value & "Baan_Sale"
End Sub

Private Sub cmd_eliminarNEgativos_Click()
    eliminaLineasNegativas Me.Name
End Sub

Private Sub CommandButton1_Click()
    Ma11_Baan.CargarDatosCliente "Baan_Rental"
    Ma11_Baan.CargarDatosCliente "Baan_Sale"
End Sub



Private Sub CommandButton2_Click()
    Ma11_Baan.BorrarDatos "Baan_Rental"
    Ma11_Baan.BorrarDatos "Baan_Sale"
End Sub

Private Sub CommandButton3_Click()
    referer = Me.Name
    importarPreciosForm.Show
End Sub

Private Sub generartxt_Click()
        referer = Me.Name
    GenerarTXTBaan.opt_1.Caption = Me.Name
    GenerarTXTBaan.Show
End Sub

Private Sub Worksheet_Activate()
    Me.cmd_CargarDatos.Caption = Sheets("Languages").Range("baan_btn_cargarDatos").Value
    Me.CommandButton1.Caption = Sheets("Languages").Range("baan_btn_compCliente").Value
    Me.CommandButton2.Caption = Sheets("Languages").Range("baan_btn_borrarDatos").Value
    Me.generartxt.Caption = Sheets("Languages").Range("baan_btn_genFichero").Value
    Me.cmd_copiarCabecera.Caption = Sheets("Languages").Range("baan_btn_copiarCabecera").Value & "_Sale"
    Me.cmd_eliminarNEgativos.Caption = Sheets("Languages").Range("baan_btn_eliminarNegativos").Value
'    If (Sheets("Data").Range("tipo_estudio") <> "estudioArgentina" And Sheets("Data").Range("CargaInicialFinalizada").Value = "X") Then
'        eliminaCotizacionArgentina
'    End If
End Sub


Private Sub Worksheet_Change(ByVal Target As Range)
    If Target.row >= 14 And Target.row <= 160 And Target.column >= 7 And Target.column <= 22 Then
        TaulaKoloreak Me.Name
    End If
End Sub
Attribute VB_Name = "Hoja7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cmd_copiarCabecera, 12, 0, MSForms, CommandButton"
Attribute VB_Control = "cmd_eliminarNEgativos, 11, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 10, 2, MSForms, CommandButton"
Attribute VB_Control = "cmd_CargarDatos, 9, 3, MSForms, CommandButton"
Attribute VB_Control = "cmd_BorrarDatos, 8, 4, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 7, 5, MSForms, CommandButton"
Attribute VB_Control = "generartxt, 1, 6, MSForms, CommandButton"
Private Sub cmd_BorrarDatos_Click()
    Ma11_Baan_NEW.BorrarDatos "Baan_Rental"
    Ma11_Baan_NEW.BorrarDatos "Baan_Sale"
End Sub

Private Sub cmd_CargarDatos_Click()
        referer = Me.Name
    CargarDatosBaan.opt_bat.Caption = Me.Name
    CargarDatosBaan.Show
End Sub

Private Sub cmd_CopiarCabecera_Click()
    Sheets("Baan_Rental").Range("Cliente").Value = Sheets("Baan_Sale").Range("Cliente").Value
    Sheets("Baan_Rental").Range("nomCli").Value = Sheets("Baan_Sale").Range("nomCli").Value
    Sheets("Baan_Rental").Range("Comercial").Value = Sheets("Baan_Sale").Range("Comercial").Value
    Sheets("Baan_Rental").Range("nomCom").Value = Sheets("Baan_Sale").Range("nomCom").Value
    Sheets("Baan_Rental").Range("Oferta").Value = Sheets("Baan_Sale").Range("Oferta").Value
    Sheets("Baan_Rental").Range("Contrato").Value = Sheets("Baan_Sale").Range("Contrato").Value
    MsgBox Sheets("Languages").Range("Msg24_CopiaCabecera").Value & "Baan_Rental"
End Sub

Private Sub cmd_eliminarNEgativos_Click()
    eliminaLineasNegativas Me.Name
End Sub

Private Sub CommandButton1_Click()
    Ma11_Baan_NEW.CargarDatosCliente "Baan_Rental"
    Ma11_Baan_NEW.CargarDatosCliente "Baan_Sale"
End Sub



Private Sub CommandButton2_Click()
    referer = Me.Name
    importarPreciosForm.Show
End Sub

Private Sub generartxt_Click()
    referer = Me.Name
    GenerarTXTBaan.opt_1.Caption = Me.Name
    GenerarTXTBaan.Show
End Sub



Private Sub Worksheet_Activate()
    Me.cmd_CargarDatos.Caption = Sheets("Languages").Range("baan_btn_cargarDatos").Value
    Me.CommandButton1.Caption = Sheets("Languages").Range("baan_btn_compCliente").Value
    Me.cmd_BorrarDatos.Caption = Sheets("Languages").Range("baan_btn_borrarDatos").Value
    Me.generartxt.Caption = Sheets("Languages").Range("baan_btn_genFichero").Value
    Me.cmd_copiarCabecera.Caption = Sheets("Languages").Range("baan_btn_copiarCabecera").Value & "_Rental"
    Me.cmd_eliminarNEgativos.Caption = Sheets("Languages").Range("baan_btn_eliminarNegativos").Value
End Sub


Private Sub Worksheet_Change(ByVal Target As Range)
    If Target.row >= 14 And Target.row <= 160 And Target.column >= 7 And Target.column <= 22 Then
        TaulaKoloreak Me.Name
    End If
End Sub
Attribute VB_Name = "ImageFormExt"
Attribute VB_Base = "0{8A493042-9618-4E3E-AE12-1E5AC9BD8D53}{931BC479-1F00-4CAC-87D5-7CD285C9D6C0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Private Sub CommandButton1_Click()
    ImageFormExt.Hide
    ProgressBar.Show
    ProgressBar.Top = Application.Top + 200
    ProgressBar.Left = Application.Left + 400
    If (OptionGrandes.Value = True) Then
        If (opt_layoutGrandes) Then
            crearListadoWordExtRef (2)
        Else
            crearListadoWordExpressExtRef (2)
        End If
    ElseIf (OptionMed.Value = True) Then
        If (opt_layoutGrandes) Then
            crearListadoWordExtRef (1)
        Else
            crearListadoWordExpressExtRef (1)
        End If
    ElseIf (OptionPeq.Value = True) Then
        If (opt_layoutGrandes) Then
            crearListadoWordExtRef (0)
        Else
            crearListadoWordExpressExtRef (0)
        End If
    End If
End Sub



Private Sub opt_layoutGrandes_Click()
    opt_layoutPeq.Value = False
End Sub

Private Sub opt_layoutPeq_Click()
    opt_layoutGrandes.Value = False
End Sub

Private Sub OptionGrandes_Click()
    OptionPeq.Value = False
End Sub

Private Sub OptionPeq_Click()
    OptionGrandes.Value = False
End Sub

Private Sub UserForm_Activate()
    With ImageFormExt
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .fr_resolution.Caption = Sheets("Languages").Range("ImageForm_fr_resolution").Value
        .fr_template.Caption = Sheets("Languages").Range("ImageForm_fr_template").Value
        .OptionGrandes.Caption = Sheets("Languages").Range("ImageForm_OptionGrandes").Value
        .OptionPeq.Caption = Sheets("Languages").Range("ImageForm_OptionPeq").Value
        .OptionMed.Caption = Sheets("Languages").Range("ImageForm_OptionMed").Value
        .opt_layoutPeq.Caption = Sheets("Languages").Range("ImageForm_opt_layoutPeq").Value
        .opt_layoutGrandes.Caption = Sheets("Languages").Range("ImageForm_opt_layoutGrandes").Value
        .CommandButton1.Caption = Sheets("Languages").Range("ImageForm_CommandButton1").Value
        .Format.Caption = Sheets("Languages").Range("ImageForm_Format").Value
        .OptionMed.Value = True
        .opt_layoutPeq.Value = True
    End With
End Sub


Attribute VB_Name = "ImportForm"
Attribute VB_Base = "0{38E7C289-9C2A-4E23-80A4-8337854D559D}{E509ED5B-8BAE-46D0-9714-5A9F80E37ABB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Private Sub cmd_ImportCancel_Click()
    Me.Hide
End Sub

Private Sub cmd_ImportOK_Click()
    Me.Hide
    If (Me.opt_ImportPrices.Value = True) Then
        importarPreciosForm.Show
        hustuImportForm (1)
    ElseIf Me.opt_importDen.Value = True Then
        importarDenominacionesForm.Show
        hustuImportForm (2)
    End If
End Sub


Private Sub UserForm_Activate()
    With ImportForm
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
    End With
    Me.Caption = Sheets("Languages").Range("ImportForm_Caption").Value
    Me.opt_ImportPrices.Caption = Sheets("Languages").Range("ImportForm_opt_ImportPrices").Value
    Me.opt_importDen.Caption = Sheets("Languages").Range("ImportForm_opt_ImportDen").Value
    Me.cmd_ImportOK.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdAceptar").Value
    Me.cmd_ImportCancel.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdCancelar").Value
End Sub
Attribute VB_Name = "M1_Varios"
''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''  FUNTZIOEN DEKLARAZIOAK
''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''''''''''''''''''''''''''''''''''''''''''


Public voyACambiarCaratulas As String
Public voyACambiarCondicion As String
Public tgb_idiomas As String


 ' Declare Type for API call:
      Private Type OSVERSIONINFO
        dwOSVersionInfoSize As Long
        dwMajorVersion As Long
        dwMinorVersion As Long
        dwBuildNumber As Long
        dwPlatformId As Long
        szCSDVersion As String * 128   '  Maintenance string for PSS usage
      End Type

      ' API declarations:
#If Win64 Then
      Private Declare PtrSafe Function GetVersionEx Lib "kernel32" _
         Alias "GetVersionExA" _
         (lpVersionInformation As OSVERSIONINFO) As Long

      Private Declare PtrSafe Sub keybd_event Lib "user32" _
         (ByVal bVk As Byte, _
          ByVal bScan As Byte, _
          ByVal dwFlags As Long, ByVal dwExtraInfo As Long)

      Private Declare PtrSafe Function GetKeyboardState Lib "user32" _
         (pbKeyState As Byte) As Long

      Private Declare PtrSafe Function SetKeyboardState Lib "user32" _
         (lppbKeyState As Byte) As Long
#Else
     Private Declare Function GetVersionEx Lib "kernel32" _
         Alias "GetVersionExA" _
         (lpVersionInformation As OSVERSIONINFO) As Long

      Private Declare Sub keybd_event Lib "user32" _
         (ByVal bVk As Byte, _
          ByVal bScan As Byte, _
          ByVal dwFlags As Long, ByVal dwExtraInfo As Long)

      Private Declare Function GetKeyboardState Lib "user32" _
         (pbKeyState As Byte) As Long

      Private Declare Function SetKeyboardState Lib "user32" _
         (lppbKeyState As Byte) As Long
#End If
      ' Constant declarations:
      Const VK_NUMLOCK = &H90
      Const VK_SCROLL = &H91
      Const VK_CAPITAL = &H14
      Const KEYEVENTF_EXTENDEDKEY = &H1
      Const KEYEVENTF_KEYUP = &H2
      Const VER_PLATFORM_WIN32_NT = 2
      Const VER_PLATFORM_WIN32_WINDOWS = 1
      
''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''  FUNTZIO NAGUSIA: ZABALTZEAN EXEKUTATUA
''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub inicializar()
    contador = 0

    seHaCambiadoAPesta|fffd|aItemView = False
    Application.ScreenUpdating = False
    Application.DisplayStatusBar = True
    Application.StatusBar = "Iniciando..."
    Application.EnableEvents = False
    
    Sheets("Summary").Unprotect
    Sheets("BoM").Unprotect
    Sheets("Languages").Unprotect
    Sheets("Data").Unprotect
    
    
    'Worksheets("BoM").comboCambioCaratulas.Value = Worksheets("Data").Range("IdiomaTitulosPlantilla").Value
    'Hizkuntzen Combo-a bete zelda batetik hartuz hizkuntza denak
    'Sheets("BoM").Range("ComboIdiomas").Select
    Worksheets("BoM").comboCambioCaratulas.List = split(Worksheets("BoM").Range("ComboIdiomas").Value, ",") 'karatulak
    tgb_idiomas = "X"
    Select Case Sheets("Data").Range("IdiomaDatos").Value
        Case "local"
            Worksheets("BoM").OLEObjects("tgb_idiomaLocal").Object.Value = True
        Case "ENcorp"
            Worksheets("BoM").OLEObjects("tgb_idiomaENCorp").Object.Value = True
        Case "EScorp"
            Worksheets("BoM").OLEObjects("tgb_idiomaESCorp").Object.Value = True
        Case Else
    End Select
    tgb_idiomas = ""
    'Worksheets("BoM").comboCambioCaratulas.Value = "es"
    ComprobarGenericos
    
      '''''''''''''''''''''''''''''''''''''''''
       '''''''' BEZERO BERTSIORAKO EGOKITZAPENAK
      '''''''''''''''''''''''''''''''''''''''''
    
    If Worksheets("Data").Range("UtilizandoCD").Value = "X" Then
        Sheets("Summary").Shapes("LogoUlma").Visible = False
        Sheets("Summary").Shapes("LogoGraf").Visible = True
        Sheets("BoM").Shapes("LogoUlma").Visible = False
        Sheets("BoM").Shapes("LogoGraf").Visible = True
'        Sheets("Baan_Rental").Visible = False
'        Sheets("Baan_Sale").Visible = False
        Dispalertsegoera = Application.DisplayAlerts
        Application.DisplayAlerts = False
        Sheets("Baan_Rental").Delete
        Sheets("Baan_Sale").Delete
        Application.DisplayAlerts = Dispalertsegoera
        Worksheets("BoM").OLEObjects("cmd_modoXML").Object.BackColor = RGB(255, 0, 0)
        Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Caption = "Offline"
        Worksheets("BoM").Shapes("cmd_modoXML").Visible = False
        Worksheets("BoM").Shapes("tgb_idiomaLocal").Visible = False
        Worksheets("BoM").Shapes("tgb_idiomaESCorp").Visible = False
        Worksheets("BoM").Shapes("tgb_idiomaENCorp").Visible = False
    Else
        Sheets("Summary").Shapes("LogoUlma").Visible = True
        Sheets("Summary").Shapes("LogoGraf").Visible = False
        Sheets("BoM").Shapes("LogoUlma").Visible = True
        Sheets("BoM").Shapes("LogoGraf").Visible = False
    End If
    
    If Sheets("BoM").Cells(12, 12).Value <> "" Then
        If Worksheets("Data").Range("EsOferta").Value <> "OK" Then
            If Worksheets("Data").Range("EsOferta").Value = "X" Then
                Call AddWatermark("Summary", 300, 200)
                Call AddWatermark("BoM", 495, 290)
                Worksheets("Data").Range("EsOferta").Value = "OK*"
            End If
        End If
        If Worksheets("Data").Range("HayArticulosGenericos").Value = "OK" Then
            If Worksheets("Data").Range("EsOferta").Value <> "OK*" Then
                Call AddWatermark("Summary", 300, 200)
                Call AddWatermark("BoM", 495, 290)
                Worksheets("Data").Range("HayArticulosGenericos").Value = "OK*"
            End If
        End If
        Set WshShell = CreateObject("WScript.Shell")
        Ping = WshShell.Run("ping -n 1 " & "192.227.20.160", 0, True)
        If Worksheets("Data").Range("UtilizandoCD").Value <> "X" Then
            Dim ruta As String
            ruta = "\\192.227.20.160\FotosProductos\Repcon"
            Dim tmp As String
            tmp = ""
            On Error Resume Next
            Select Case Ping
            Case 0
                tmp = Dir(ruta, vbDirectory)
                If tmp <> "" Then
                    Worksheets("BoM").Shapes("btnCargarImagenesBoM").Visible = True
                    Worksheets("ItemView").Shapes("btnCargarImagenesItemView").Visible = True
                Else
                    Worksheets("BoM").Shapes("btnCargarImagenesBoM").Visible = False
                    Worksheets("BoM").Shapes("btnQuitarImagenesBoM").Visible = False
                    Worksheets("ItemView").Shapes("btnCargarImagenesItemView").Visible = False
                    Worksheets("ItemView").Shapes("btnQuitarImagenesItemView").Visible = False
                    Worksheets("ItemView").Shapes("btnListadoPDF").Visible = False
                End If
            Case 1
                    Worksheets("BoM").Shapes("btnCargarImagenesBoM").Visible = False
                    Worksheets("BoM").Shapes("btnQuitarImagenesBoM").Visible = False
                    Worksheets("ItemView").Shapes("btnCargarImagenesItemView").Visible = False
                    Worksheets("ItemView").Shapes("btnQuitarImagenesItemView").Visible = False
                    Worksheets("ItemView").Shapes("btnListadoPDF").Visible = False
            End Select
        Else
            If Worksheets("Data").Range("RutaImagenes3D") <> "" Then
                Worksheets("BoM").Shapes("btnCargarImagenesBoM").Visible = True
                Worksheets("ItemView").Shapes("btnCargarImagenesItemView").Visible = True
            Else
                Worksheets("BoM").Shapes("btnCargarImagenesBoM").Visible = False
                Worksheets("BoM").Shapes("btnQuitarImagenesBoM").Visible = False
                Worksheets("ItemView").Shapes("btnCargarImagenesItemView").Visible = False
                Worksheets("ItemView").Shapes("btnQuitarImagenesItemView").Visible = False
                Worksheets("ItemView").Shapes("btnListadoPDF").Visible = False
            End If
        End If
        
    'Desactivar modo XML si no hay acceso a la ruta de ficheros XML
        Dim tmp2 As String
        tmp2 = ""
        On Error Resume Next
        initPaths
        Ping = WshShell.Run("ping -n 1 " & "192.227.20.52", 0, True)
        Select Case Ping
        Case 0
            tmp2 = Dir(RunRC4(pathXML, "qwerty"), vbDirectory)
            If tmp2 = "" Then
                Worksheets("BoM").OLEObjects("cmd_modoXML").Object.BackColor = RGB(255, 0, 0)
                Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Caption = "Offline"
                Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaLocal").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaESCorp").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaENCorp").Object.Enabled = False
                'Worksheets("BoM").OLEObjects("cmd_updatePrices").Object.Enabled = False
            Else
            'Worksheets("BoM").OLEObjects("cmd_modoXML").Object.BackColor = RGB(255, 0, 0)
            'Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Caption = "Offline"
            Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Enabled = True
            If Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Caption = "Offline" Then
                Worksheets("BoM").OLEObjects("tgb_idiomaLocal").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaESCorp").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaENCorp").Object.Enabled = False
            Else
                Worksheets("BoM").OLEObjects("tgb_idiomaLocal").Object.Enabled = True
                Worksheets("BoM").OLEObjects("tgb_idiomaESCorp").Object.Enabled = True
                Worksheets("BoM").OLEObjects("tgb_idiomaENCorp").Object.Enabled = True
            End If
            End If
        Case 1
                Worksheets("BoM").OLEObjects("cmd_modoXML").Object.BackColor = RGB(255, 0, 0)
                Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Caption = "Offline"
                Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaLocal").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaESCorp").Object.Enabled = False
                Worksheets("BoM").OLEObjects("tgb_idiomaENCorp").Object.Enabled = False
        End Select
        Worksheets("BoM").Shapes("cmd_updatePrices").Visible = False
        
        '''''''
        'Sheets("BoM").Select
        CambiarCondicion
        Sheets("Data").Visible = False
        Sheets("Printable_Data").Visible = False
        
        '''''''''''''''''''''''''''''''''''''''''
        '''''''' FILIAL BAKOITZEKO EGOKITZAPENAK
        '''''''''''''''''''''''''''''''''''''''''
        
        'Erakutsi/ezkutatu Cotizador botoia tipo estudio-ren arabera
        If (Sheets("Data").Range("tipo_estudio").Value = "estudioMexico") And (Not (Dir("c:\Ulma\Repcon_57\s26\data\doctemplates\template_CotizadorMX.xlsx", vbDirectory) = vbNullString)) Then
            Worksheets("BoM").Shapes("btn_Cotizador").Visible = True
        Else
            Worksheets("BoM").Shapes("btn_Cotizador").Visible = False
        End If
        'Argentina ez bada kendu Cotizacion eta Dias Baan_Rentaletik
        If (Sheets("Data").Range("tipo_estudio").Value <> "estudioArgentina") Then
            eliminaCotizacionArgentina
        End If
        'Erakutsi/ezkutatu Material Lista botoia tipo estudio-ren arabera
        If (Sheets("Data").Range("tipo_estudio").Value = "estudioAlemania") And (Not (Dir("c:\Ulma\Repcon_57\s26\data\doctemplates\Materialliste2017.xlsm", vbDirectory) = vbNullString)) Then
            Worksheets("BoM").Shapes("btn_Cotizador").Visible = True
            Worksheets("BoM").OLEObjects("btn_Cotizador").Object.Caption = "Materialliste"
        End If
        'txekiarako botoia ipini Materiallistena aprobetxatuz
        If (Sheets("Data").Range("tipo_estudio").Value = "estudioChequia") And (Not (Dir("c:\Ulma\Repcon_57\s26\data\doctemplates\CZ_template.xlsm", vbDirectory) = vbNullString)) Then
            Worksheets("BoM").Shapes("btn_Cotizador").Visible = True
            Worksheets("BoM").OLEObjects("btn_Cotizador").Object.Caption = "seznam materi|fffd|lu"
            iniciarFormatoServicioCZSK
            'DoituCZSK
        End If
        'Eslovakiarako botoia ipini Materiallistena aprobetxatuz
        If (Sheets("Data").Range("tipo_estudio").Value = "estudioEslovaquia") And (Not (Dir("c:\Ulma\Repcon_57\s26\data\doctemplates\SK_template.xlsm", vbDirectory) = vbNullString)) Then
            Worksheets("BoM").Shapes("btn_Cotizador").Visible = True
            Worksheets("BoM").OLEObjects("btn_Cotizador").Object.Caption = "zoznam materi|fffd|lov"
            iniciarFormatoServicioCZSK
            'DoituCZSK
            EslovakiaExtraInfo
        End If
        'Erakutsi/ezkutatu Freight/Release botoiak tipo estudio-ren arabera
        If (Sheets("Data").Range("tipo_estudio").Value = "estudioUSA") Then
            If (Not (Dir("c:\Ulma\Repcon_57\s26\data\doctemplates\RELEASE_TEMPLATE_current.xlsm", vbDirectory) = vbNullString)) Then
                Worksheets("ItemView").Shapes("btn_Freight").Visible = True
                Worksheets("ItemView").Shapes("btn_Release").Visible = True
            Else
                Worksheets("ItemView").Shapes("btn_Freight").Visible = False
                Worksheets("ItemView").Shapes("btn_Release").Visible = False
                ezabatuFreightUnion
            End If
            kalkulatuPaletE1
            kalkulatuRack
        Else
            Worksheets("ItemView").Shapes("btn_Freight").Visible = False
            Worksheets("ItemView").Shapes("btn_Release").Visible = False
            ezabatuFreightUnion
        End If
        Sheets("Data").Visible = False
        Sheets("Languages").Visible = False
        'Rumanian kasuan ez ezik, kendu Baremoaren filak (bakarrik behin)
        
        '''''''''''''''''''''''''''''''''''''''''
        '''''''' EZARPEN OROKORRAK
        '''''''''''''''''''''''''''''''''''''''''
        
        
        ''''''''''''''''''''''''''''''''''''
        'Dokumentazio menuan Repconen komentarioak TextBox batean sartu
        If (Sheets("Data").Range("id_ejecutadoUnaVez").Value <> "X") Then
            addExplanationBox
        End If
        ''''''''''''''''''''''''''''''''''''
        If Not (Sheets("Data").Range("id_ejecutadoUnaVez").Value = "X") Then
            EliminarFilasBaremo
            If (Sheets("Data").Range("tipo_estudio").Value = "estudioUSA") Then
                dataUSAformatua
            End If
            Sheets("Data").Range("id_ejecutadoUnaVez").Value = "X"
        End If
        'orokorrean exekutatu Precio Alquiler/unidad listaren formatu ezartzea
        iniciarFormatoPrecioAlqDia
        'Espana bada Baremo-ri eman formatu egokia hasieran
        If (Sheets("Data").Range("tipo_estudio").Value = "estudioEspana") Then
            iniciarFormatoBaremo
        End If

        ''''''''''''''''''''''''''''''''''''
        'PRO duten artikuluei ikonoa ipini
        PROzesatu
        
        ''''''''''''''''''''''''''''''''''''
        ''''''''''''''''''''''''''''''''''''
        'Familia Hutsa baldin badago ipini familia ezezeguna
        familiaEzezaguna
        
        ''''''''''''''''''''''''''''''''''''
        ''''''''''''''''''''''''''''''''''''
        'ezarriInprimatzeArea
        
        
        ''''''''''''''''''''''''''''''''''''
        ''''''''''''''''''''''''''''''''''''
        'toRepconbotoia (Bezero bertsioa ez bada aktibatuta)
        If Worksheets("Data").Range("UtilizandoCD").Value <> "X" Then
            Worksheets("BoM").Shapes("cmd_toRepcon").Visible = True
        Else
            Worksheets("BoM").Shapes("cmd_toRepcon").Visible = False
        End If
        
        ''''''''''''''''''''''''''''''''''''
        ''''''''''''''''''''''''''''''''''''
        'GARAPENAK
        
'        If Application.UserName = "arigartu" Or Application.UserName = "xcalvo" Or Environ("username") = "srepcon" Then
'            Worksheets("BoM").Shapes("cmd_toRepcon").Visible = True
'            Worksheets("BoM").Shapes("cmd_FromAcadRevit").Visible = True
'        Else
'            Worksheets("BoM").Shapes("cmd_toRepcon").Visible = False
'            Worksheets("BoM").Shapes("cmd_FromAcadRevit").Visible = False
'        End If
        Worksheets("BoM").Shapes("cmd_FromAcadRevit").Visible = False
        ''''''''''''''''''''''''''''''''''''
        ''''''' AMAIERA ERAGIKETAK
        ''''''''''''''''''''''''''''''''''''
        ThisWorkbook.Worksheets("Summary").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True
        ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
        ThisWorkbook.Worksheets("BoM").EnableOutlining = True
        ThisWorkbook.Worksheets("Languages").Protect
        ThisWorkbook.Worksheets("Data").Protect
    End If
    'ActiveSheet.PageSetup.PrintArea = "$B$2:$" + Worksheets("Data").Range("ColumFinLista").Value + "$68"
    Application.ScreenUpdating = True
    Application.StatusBar = "Ejecuci|fffd|n terminada."
    Application.EnableEvents = True


    Sheets("BoM").Select
    Range("A1").Select
    'Sheets("Data").Range("CargaInicialFinalizada").Value = "X"
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''   UR MARKA FUNTZIOA (OFERTAK)  '''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Public Sub AddWatermark(hoja As String, x As Integer, y As Integer)
    Dim Texto As String
    Texto = Worksheets("Languages").Range("ID_MarcaDeAguaOferta").Value
    ThisWorkbook.Worksheets(hoja).Select
    'ThisWorkbook.Worksheets(hoja).Unprotect
    With ActiveSheet.Shapes.AddTextEffect(msoTextEffect2, Texto, _
    "Arial Black", 28, msoTrue, msoTrue, _
    x, y)
    'ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True _
            , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
            AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:= _
            True
    End With
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''      IRUDIAK KONPRIMITU (3D)   '''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Public Sub ComprimirImagenes()
    Dim NumLockStateBefore As Boolean
      
      Dim keys(0 To 255) As Byte
      GetKeyboardState keys(0)
      NumLockStateBefore = keys(VK_NUMLOCK)
    Application.DisplayAlerts = False
    Dim octl As CommandBarControl
    Range("A1").Select
    With Selection
        Set octl = Application.CommandBars.FindControl(ID:=6382)
        Application.SendKeys "{TAB}{UP}~"
        Application.SendKeys "{TAB}{TAB}{BACKSPACE}~"
        octl.Execute
    End With
    If NumLockStateBefore = True Then    'Turn numlock on
        'Simulate Key Press
          keybd_event VK_NUMLOCK, &H45, KEYEVENTF_EXTENDEDKEY Or 0, 0
        'Simulate Key Release
          keybd_event VK_NUMLOCK, &H45, KEYEVENTF_EXTENDEDKEY _
             Or KEYEVENTF_KEYUP, 0
    End If
    'Application.SendKeys "{NUMLOCK}", True
    Application.DisplayAlerts = True
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''  GENERIKOAK DAUDEN KONPROBATU  '''''''''''''
'''''' (HONEN ARABERA ONDOREN UR MARKA SARTUKO DA) ''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Public Sub ComprobarGenericos()
    If (Worksheets("Data").Range("HayArticulosGenericos").Value = "") Then
        Dim InicioCodigos As Integer
        InicioCodigos = Worksheets("Data").Range("FilaInicioArticulos").Value
            
        Dim FinCodigos As Integer
        FinCodigos = Worksheets("Data").Range("FilaFinArticulos").Value
        
        Dim ColumnaCodigos As String
        ColumnaCodigos = "D"
        
        Dim codigo As String
       
        For rowind = InicioCodigos To FinCodigos
            On Error GoTo x:
            codigo = Range(ColumnaCodigos & rowind).Value
            codigo = Left(Right(codigo, 3), 1)
            If codigo = "G" Then
                Worksheets("Data").Range("HayArticulosGenericos").Value = "OK"
                Exit Sub
            End If
x:
        Next rowind
        
        Range("B" & InicioCodigos).Select
    End If
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
''''''''''''  TAULA DINAMIKOA '''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Public Sub DeleteAllPivotTablesInWorkbook()
    Dim xWs As Worksheet
    Dim xPT As PivotTable
    On Error GoTo x:
    Sheets("Summary").Unprotect
    Sheets("BoM").Unprotect
    Sheets("Languages").Unprotect
    Sheets("Data").Unprotect
    For Each xWs In Application.ActiveWorkbook.Worksheets
        For Each xPT In xWs.PivotTables
            xWs.Range(xPT.TableRange2.Address).Delete Shift:=xlUp
        Next
    Next
    ThisWorkbook.Worksheets("Summary").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
    ThisWorkbook.Worksheets("Languages").Protect
    ThisWorkbook.Worksheets("Data").Protect
x:
End Sub

Sub ReasignaRangoAFormatoCondicionalItemView()
    Sheets("ItemView").Range("D:D").FormatConditions(1).ModifyAppliesToRange Range("D:D")
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''  BALDINTZAK EDO LISTA MOTAK ALDATU ''''''''''
''''''''   (BALOREAK FORMULAK BIHURTZEKO BERRIZ)  '''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Public Sub CambiarCondicion()
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim InicioCondiciones As Integer
    InicioCondiciones = Worksheets("Data").Range("FilaInicioArticulos").Value
        
    Dim FinCondiciones As Integer
    FinCondiciones = Worksheets("Data").Range("FilaFinArticulos").Value
    
    Dim ColumnaCondiciones As String
    ColumnaCondiciones = "F"
    
    Dim Condicion As String
    Dim Formula As String
    
    For rowind = InicioCondiciones To FinCondiciones
        On Error GoTo x:
        Condicion = Worksheets("BoM").Range(ColumnaCondiciones & rowind).Value
        Formula = WorksheetFunction.VLookup(Condicion, Worksheets("Data").[F33:G37], 2, 0)
        Worksheets("BoM").Range(ColumnaCondiciones & rowind).Formula = Formula
        Worksheets("BoM").Range(ColumnaCondiciones & rowind).NumberFormat = "General"
x:
    Next rowind
    
    Worksheets("BoM").Range("B" & InicioCondiciones).Select
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

Public Sub CambiarUnaCondicion(fila As Integer)
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim ColumnaCondiciones As String
    ColumnaCondiciones = ConvertToLetter(Worksheets("Data").Range("NumColumnaCondicion").Value)
    On Error GoTo x:
    voyACambiarCondicion = "X"
    Condicion = Worksheets("BoM").Range(ColumnaCondiciones & fila).Value
        Formula = WorksheetFunction.VLookup(Condicion, Worksheets("Data").[F33:G37], 2, 0)
        Worksheets("BoM").Range(ColumnaCondiciones & fila).Formula = Formula
        Worksheets("BoM").Range(ColumnaCondiciones & fila).NumberFormat = "General"
    voyACambiarCondicion = ""
x:
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     BAREMO/DESKONTU LERROAK EGOKITU   '''''''''
''''''''''''  DAGOKION FILIALAREN ARABERA    ''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Public Sub EliminarFilasBaremo()
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    'Momentuz ezabatu CZ/SK eta Argentina -> Espainia uzteko soilik
    'CZSK 3 lerro (lerro huts bat kenduz)
    'Argentina 3 lerro (lerro huts bat kenduz)
    If (Sheets("Data").Range("tipo_estudio").Value = "estudioEspana") Then
        ezabatuPortzentaiak "Tag_BaremoCZSK", 3
        ezabatuPortzentaiak "Tag_BaremoArgentina", 3
    ElseIf (Sheets("Data").Range("tipo_estudio").Value = "estudioChequia" Or Sheets("Data").Range("tipo_estudio").Value = "estudioEslovaquia" Or Sheets("Data").Range("tipo_estudio").Value = "estudioRumania") Then
        ezabatuPortzentaiak "Tag_BaremoEspana", 5
        ezabatuPortzentaiak "Tag_BaremoArgentina", 3
    ElseIf (Sheets("Data").Range("tipo_estudio").Value = "estudioArgentina") Then
        ezabatuPortzentaiak "Tag_BaremoEspana", 5
        ezabatuPortzentaiak "Tag_BaremoCZSK", 3
    Else ' momentuz besteak Txekia eta Eslovakia bezala
        ezabatuPortzentaiak "Tag_BaremoEspana", 5
        ezabatuPortzentaiak "Tag_BaremoArgentina", 3
    End If
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

Sub ezabatuPortzentaiak(ByVal tag As String, ByVal kop As Integer)
    Dim columnaTags As String
    Dim ezabatzekoTag
    columnaTags = ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 3)
    ezabatzekoTag = Application.IfError(Application.Match(tag, Sheets("BoM").Range(columnaTags & "1:" & columnaTags & "5000"), 0), 0)
    If ezabatzekoTag > 0 Then
        EzabatuLerroak ezabatzekoTag, kop
    End If
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     INPRIMATZE AREA EZARTZEKO FUNTZIOA ''''''''
''''''''' USA BADA BERAIEN ORRI TAMAINAK EZARTZEN DITU ''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub ezarriInprimatzeArea()
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim gapLerro As Integer
    On Error GoTo x
    If Sheets("Data").Range("tipo_Estudio").Value = "estudioRumania" Then
         gapLerro = 2
    End If
    Dim inicio As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
    Dim fin As Integer
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    Dim cantLineas As Integer
    Dim lineasUltimaHoja As Integer
    Dim lineasPorHoja As Integer
    Dim lineasTotales  As Integer
    lineasTotales = 9 + gapLerro 'orriaren oinean totalen blokeak hartzen duten linea kopurua
    lineasPorHoja = 45 'orri bakoitzean sartzen diren linea kopurua A4 horizontala
    lineasUltimaHoja = cantLineas Mod lineasPorHoja
    cantLineas = fin - inicio
    Sheets("BoM").PageSetup.printArea = "A2:" & Sheets("Data").Range("ColumFinLista").Value & Sheets("Data").Range("FilaFinARticulos").Value + 3
    Sheets("BoM").PageSetup.PrintTitleRows = "$2:$" & inicio - 1
    If cantLineas > 15 Then
        If lineasUltimaHoja + lineasTotales > lineasPorHoja Then
            Sheets("BoM").Rows(inicio + cantLineas - 5).PageBreak = xlPageBreakManual
        End If
    End If
    '''''Ezarri orri oina eta bertan orri zenbakia/orri totala
    Sheets("BoM").PageSetup.RightFooter = "&R&P/&N"
        
    
    
'''''Estudio USA bada aldatu orrien tamaina A2tik Tabloid-era (A3 antzerakoa)

If Sheets("Data").Range("tipo_estudio").Value = "estudioUSA" Then
    Dim paper1117(6) As String
    paper1117(0) = "11x17"
    paper1117(1) = "11 x 17"
    paper1117(2) = "11"" x 17"""
    paper1117(3) = "11""x17"""
    paper1117(4) = "Ledger"
    paper1117(5) = "ledger"
    Dim paper As Long
    Dim i As Integer
    i = 0
    paper = 0
    Do While paper = 0 And i <= UBound(paper1117) - 1
        paper = GetPapers(ActivePrinterPort(0), ActivePrinterPort(1), paper1117(i))
        i = i + 1
    Loop
    Dim paperLetter(8) As String
    paperLetter(0) = "Letter"
    paperLetter(1) = "Letter (8.5"" x 11"")"
    paperLetter(2) = "Letter (8.5x11)"
    paperLetter(3) = "Letter (8.5 x 11)"
    paperLetter(4) = "Letter (8.5""x11"")"
    paperLetter(5) = "8.5 x 11"
    paperLetter(6) = "8.5"" x 11"""
    paperLetter(7) = "8.5""x11"""
    Dim paper2 As Long
    Dim j As Integer
    j = 0
    paper2 = 0
    Do While paper2 = 0 And j <= UBound(paperLetter) - 1
        paper2 = GetPapers(ActivePrinterPort(0), ActivePrinterPort(1), paperLetter(j))
        j = j + 1
    Loop
    If paper > 0 Then
        Sheets("Summary").PageSetup.PaperSize = paper
    End If
    If paper2 > 0 Then
        Sheets("BoM").PageSetup.PaperSize = paper2
        Sheets("ItemView").PageSetup.PaperSize = paper2
    End If
End If
    ''''' Itxuraz Repcon-etik inprimatze Area ezartzean izen-kudeatzaileak sortzen ditu Print_area eta Print_Titles-entzat (Office 2007tik datorren konportamentua dirudi)
    ''''' Ondoren excel hau inportatzeko erabiltzean Izenen gatazka agertzen da eta aplikazioak blokeatzen dira. Beraz inprimatze area ezarri eta gero, bi izen kudeatzaileak ezabatuko ditugu arazoa ekiditeko
    For Each izena In ThisWorkbook.Names
        If izena.Name = "BoM!Print_Area" Or izena.Name = "BoM!Print_Titles" Then
          izena.Delete
     End If
    Next
    'ThisWorkbook.Save
x:
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''    BAREMO LERROEI DAGOKIEN FORMATUA EMAN   ''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub formatosBaremoTotalesEspana(ByVal row As Integer, ByVal column As Integer)
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
        If (row = Sheets("Data").Range("FilaUnidadLista").Value) Then
            formato = "#,##0.0000" & " """ & "/ " & Sheets("BoM").Cells(row, column).Value & """"
            non = Application.IfError(Application.Match(ThisWorkbook.Names("ID_PrecioOfertaAlqDiaUnidad").RefersToRange(1, 1), Sheets("BoM").Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1) & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1)), 0), 0)
            Sheets("BoM").Cells(non, column).NumberFormat = formato
        Else
            columnaCheck = ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 1)
            hasi = Sheets("Data").Range("NumColumInicioLista").Value
            ama = Sheets("Data").Range("NumColumFinLista").Value
            
            If (Sheets("BoM").Range(columnaCheck & row).Value = ThisWorkbook.Names("ID_Baremo").RefersToRange(1, 1)) Then
                For i = hasi To ama
                    formato1 = "#,##0.0000" & " """ & "/ " & Sheets("BoM").Cells(Sheets("Data").Range("FilaUnidadLista").Value, i) & """"
                    formato2 = "0.00|fffd|"
                
                    Sheets("BoM").Cells(row + 1, i).NumberFormat = formato1
                    Sheets("BoM").Cells(row, i).NumberFormat = formato2
                    Sheets("BoM").Cells(row, i).Value = ""
                Next
            Else
                For i = hasi To ama
                    formato1 = "0.00|fffd|"
                    formato2 = "#,##0.0000" & " """ & "/ " & Sheets("BoM").Cells(Sheets("Data").Range("FilaUnidadLista").Value, i) & """"
                
                    Sheets("BoM").Cells(row, i).NumberFormat = formato2
                    Sheets("BoM").Cells(row, i).Value = ""
                    Sheets("BoM").Cells(row + 1, i).NumberFormat = formato1
                Next
            End If
        End If
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub


Sub formatoPrecioAlqDia(ByVal row As Integer, ByVal column As Integer)
    If (row = Sheets("Data").Range("FilaUnidadLista").Value) Then
            formato = "#,##0.0000" & " """ & "/ " & Sheets("BoM").Cells(row, column).Value & """"
            non = Application.IfError(Application.Match(ThisWorkbook.Names("ID_PrecioAlqUnidadLista").RefersToRange(1, 1), Sheets("BoM").Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1) & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1)), 0), 0)
            Sheets("BoM").Cells(non, column).NumberFormat = formato
    End If
End Sub

Sub iniciarFormatoPrecioAlqDia()
    non = Application.IfError(Application.Match(ThisWorkbook.Names("ID_PrecioAlqUnidadLista").RefersToRange(1, 1), Sheets("BoM").Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1) & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1)), 0), 0)
    inicio = Sheets("Data").Range("NumColumInicioLista").Value
    fin = Sheets("Data").Range("NumColumFinLista").Value
    For i = inicio To fin
        unidad = Sheets("BoM").Cells(Sheets("Data").Range("FilaUnidadLista").Value, i).Value
        formato2 = "#,##0.0000" & " """ & "/ " & unidad & """"
        Sheets("BoM").Cells(non, i).NumberFormat = formato2
    Next
End Sub

Sub iniciarFormatoServicioCZSK()
    nonServicio = Application.IfError(Application.Match(ThisWorkbook.Names("ID_Servicio").RefersToRange(1, 1), Sheets("BoM").Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1) & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1)), 0), 0)
    nonPortzentaia = Application.IfError(Application.Match(ThisWorkbook.Names("ID_Porcentaje").RefersToRange(1, 1), Sheets("BoM").Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1) & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1)), 0), 0)
    inicio = Sheets("Data").Range("NumColumInicioLista").Value
    fin = Sheets("Data").Range("NumColumFinLista").Value
    For i = inicio To fin
        Sheets("BoM").Cells(nonServicio, i).Formula = "=" & ConvertToLetter(i) & nonPortzentaia & " * 100"
        Sheets("BoM").Cells(nonServicio, i).Locked = True
        Sheets("BoM").Cells(nonServicio, i).Interior.Color = RGB(141, 180, 226)
    Next
End Sub

Sub iniciarFormatoBaremo()
    non = Application.IfError(Application.Match(ThisWorkbook.Names("ID_BAREMO").RefersToRange(1, 1), Sheets("BoM").Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1) & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista") - 1)), 0), 0)
    If non = Sheets("Data").Range("FilaBaremoPrecioOfertado").Value Then
        lerroa1 = non
        lerroa2 = non - 1
    Else
        lerroa1 = non
        lerroa2 = non + 1
    End If
        formato = "0.00|fffd|"
        Sheets("BoM").Range(Sheets("Data").Range("ColumInicioLista").Value & lerroa1 & ":" & Sheets("Data").Range("ColumFinLista").Value & lerroa1).NumberFormat = formato
        inicio = Sheets("Data").Range("ColumInicioLista").Value
        fin = Sheets("Data").Range("ColumFinLista").Value
        For i = inicio To fin
            unidad = Sheets("BoM").Cells(Sheets("Data").Range("FilaUnidadLista").Value, i).Value
            formato2 = "#,##0.0000" & " """ & "/ " & unidad & """"
            Sheets("BoM").Cells(lerroa2, i).NumberFormat = formato2
        Next
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     XEHETASUNENTZAT TESTU KOADROA SARTZEKO ''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub addExplanationBox()
   egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
   inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    sarpuntua = inicio - 3
    Set sh = Sheets("BoM").Shapes.AddTextbox(msoTextOrientationHorizontal, Sheets("BoM").Range("A" & sarpuntua).Left + 2, Sheets("BoM").Range("A" & sarpuntua).Top + 5, Sheets("BoM").Range("A1:I1").Width - 10, 70)
    With sh
        .Name = "CommentBox1"
        .Locked = False
        .ControlFormat.LockedText = False
        .line.Visible = True
        .line.ForeColor.ObjectThemeColor = msoThemeColorText1
        .TextFrame2.TextRange.text = "Details:" & vbNewLine & Sheets("Data").Range("CommentBox").Value
        .TextFrame2.TextRange.Font.Bold = True
        .TextFrame2.TextRange.Font.Size = 16
    End With
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub


'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     HIZKUNTZA BOTOI DENAK DESKLIKATU       ''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
Sub unpushedDescButtons()
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim finalizado As String
    finalizado = Sheets("Data").Range("CargaInicialFinalizada").Value
    If finalizado = "X" And tgb_idiomas <> "X" Then
        tgb_idiomas = "X"
        Sheets("BoM").OLEObjects("tgb_idiomaESCorp").Object.Value = False
        Sheets("BoM").OLEObjects("tgb_idiomaLocal").Object.Value = False
        Sheets("BoM").OLEObjects("tgb_idiomaENCorp").Object.Value = False
    End If
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     ARTIKULU DENAK SALMENTAN               ''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub ipiniDenaSalmentan()
    Dim inicio As Integer
    Dim fin As Integer
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    Sheets("BoM").Range("F" & inicio & ":F" & fin).Formula = "=A2Venta"
End Sub

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     PRO DUTENEI IKONOA SARTU/KENDU         ''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub PROzesatu() 'Bakarrik behin exekutatu beharrekoa
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim inicio As Integer
    Dim fin As Integer
    Dim sh As Shape
    Sheets("BoM").Shapes("PRO").Visible = False
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    For i = inicio To fin
        'Kendu PRO ikonoa beti eta gero ikusi berriz ipini beharra dagoen
        kenduIkonoaBaldinBadu "D" & i
        If Sheets("BoM").Range("A" & i).Value = "PRO" Then
            Sheets("BoM").Range("A" & i).Font.Color = vbWhite
            Set sh = Sheets("BoM").Shapes("PRO").Duplicate
            sh.Left = Sheets("BoM").Range("D" & i).Left + (Sheets("BoM").Range("D" & i).Width - sh.Width)
            sh.Top = Sheets("BoM").Range("D" & i).Top
            sh.Visible = True
        End If
    Next
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

Sub PROzesatuBakarra(ByVal linea As Integer) 'Lerro jakin baterako begiratu POR ikonoa behar duen.
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = True
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    babestua = Sheets("BoM").ProtectContents
    If (babestua) Then
        Sheets("BoM").Unprotect
    End If
    'Kendu PRO ikonoa beti eta gero ikusi berriz ipini beharra dagoen
    kenduIkonoaBaldinBadu "D" & linea
    Dim sh As Shape
    Sheets("BoM").Shapes("PRO").Visible = False
    If Sheets("BoM").Range("A" & linea).Value = "PRO" Then
         Sheets("BoM").Range("A" & linea).Font.Color = vbWhite
         Set sh = Sheets("BoM").Shapes("PRO").Duplicate
         sh.Left = Sheets("BoM").Range("D" & linea).Left + (Sheets("BoM").Range("D" & linea).Width - sh.Width)
         sh.Top = Sheets("BoM").Range("D" & linea).Top
         sh.Visible = True
    End If
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
    If babestua Then
        ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    End If
End Sub

Sub kenduIkonoaBaldinBadu(ByVal zelda As String)
    For Each Shp In Sheets("BoM").Shapes
        If (Shp.Name = "PRO") Then
            If Not Intersect(Range(Shp.TopLeftCell.Address), Sheets("BoM").Range(zelda)) Is Nothing Then
                Shp.Delete
            End If
        End If
    Next
End Sub


'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     FAMILIA EZEZAGUNA IPINI HUTSA DUTENEI  ''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub familiaEzezaguna()
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = True
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim inicio As Integer
    Dim fin As Integer
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    For i = inicio To fin
        familiaEzezagunaLerroa i
    Next
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

Sub familiaEzezagunaLerroa(ByVal lerroa As Integer)
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    Dim FamiliaZut As Integer
    Dim inicio As Integer
    Dim filaTitulos As Integer
    Dim idFamilia As String
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    idFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    FamiliaZut = Application.Match(idFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0)
    If (Trim(Sheets("BoM").Cells(lerroa, FamiliaZut).Value) = "") Then
        Sheets("BoM").Cells(lerroa, FamiliaZut).Value = Sheets("Languages").Range("id_FamiliaDesconicida").Value
    End If
    Application.ScreenUpdating = egoera
End Sub



Attribute VB_Name = "M2_CargarImagenesItemViewBoM"


'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     3D IRUDIAK KARGATU
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Public Sub CargarImagenesItemView()
    Dim ruta As String
    Dim Comentario As Comment
    Sheets("Itemview").Select
    ActiveSheet.Unprotect
    
    Dim inicio As Integer
    inicio = Worksheets("Data").Range("ID_ini").Value
        
    Dim fin As Integer
    fin = Worksheets("Data").Range("ID_FinalItemview").Value
    
    ActiveSheet.PivotTables("TablaDinamica").DisplayContextTooltips = False
   
    For rowind = inicio To fin
            ruta = "\\192.227.20.160\FotosProductos\Repcon\" & Range("C" & CStr(rowind)).Value & ".png"
            Range("D" & CStr(rowind)).Select
            On Error Resume Next
            Set Comentario = Range("D" & CStr(rowind)).Comment
            If Err.Number = 0 Then
                ' cell has comment
                Range("D" & CStr(rowind)).Comment.Delete
            End If
            On Error GoTo 0
            If fileExists(ruta) <> "" Then
                Range("D" & CStr(rowind)).AddComment
                Range("D" & CStr(rowind)).Comment.Visible = False
                With Range("D" & CStr(rowind)).Comment.Shape.TextFrame.Characters.Font
                    .ColorIndex = 1
                    .Size = 18
                    .Bold = True
                    .Underline = True
                End With
                Range("D" & CStr(rowind)).Comment.text text:=Range("C" & CStr(rowind)).text & " - " & Range("D" & CStr(rowind)).text
                With Range("D" & CStr(rowind)).Comment
                    .Shape.Fill.UserPicture ruta
                    .Shape.ScaleHeight 6, msoFalse, msoScaleFromTopLeft
                    .Shape.ScaleWidth 6, msoFalse, msoScaleFromTopLeft
                End With
            Else
                'Range("D" & CStr(rowInd)).Comment.Text Text:=Worksheets("Languages").Range("ID_MensajeNoHayImagen3D").Value
            End If
            
    Next rowind
    Worksheets("Data").Range("Imagenes3DCargadas").Value = "X"
    Range("C26").Select
End Sub

Public Sub QuitarImagenesItemView()
    ThisWorkbook.Worksheets("ItemView").Unprotect
    Sheets("Itemview").Select
    Columns("D:D").Select
    Selection.ClearComments
    Worksheets("Data").Range("Imagenes3DCargadas").Value = ""
    Range("C26").Select
    ThisWorkbook.Worksheets("ItemView").Protect
End Sub

Public Sub QuitarImagenesParaDespuesRecargarItemView()
    ThisWorkbook.Worksheets("ItemView").Unprotect
    Sheets("Itemview").Select
    Columns("D:D").Select
    Selection.ClearComments
    Range("C26").Select
    ThisWorkbook.Worksheets("ItemView").Protect
End Sub


Public Sub CargarImagenesBoM()
    Dim ruta As String
    Dim Comentario As Comment
    Sheets("BoM").Select
    ActiveSheet.Unprotect
    
    Dim inicio As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
        
    Dim fin As Integer
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    
    For rowind = inicio To fin
            ruta = "\\192.227.20.160\FotosProductos\Repcon\" & Range("D" & CStr(rowind)).Value & ".png"
            Range("E" & CStr(rowind)).Select
            On Error Resume Next
            Set Comentario = Range("E" & CStr(rowind)).Comment
            If Err.Number = 0 Then
                ' cell has comment
                Range("E" & CStr(rowind)).Comment.Delete
            End If
            On Error GoTo 0
            If fileExists(ruta) <> "" Then
                Range("E" & CStr(rowind)).AddComment
                Range("E" & CStr(rowind)).Comment.Visible = False
                With Range("E" & CStr(rowind)).Comment.Shape.TextFrame.Characters.Font
                    .ColorIndex = 1
                    .Size = 18
                    .Bold = True
                    .Underline = True
                End With
                Range("E" & CStr(rowind)).Comment.text text:=Range("D" & CStr(rowind)).text & " - " & Range("E" & CStr(rowind)).text
                With Range("E" & CStr(rowind)).Comment
                    .Shape.Fill.UserPicture ruta
                    .Shape.ScaleHeight 6, msoFalse, msoScaleFromTopLeft
                    .Shape.ScaleWidth 6, msoFalse, msoScaleFromTopLeft
                End With
            Else
                'Range("D" & CStr(rowInd)).Comment.Text Text:=Worksheets("Languages").Range("ID_MensajeNoHayImagen3D").Value
            End If
    Next rowind
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
    Range("B16").Select
End Sub


Public Sub QuitarImagenesBoM()
    ThisWorkbook.Worksheets("BoM").Unprotect
    Sheets("BoM").Select
    Columns("E:E").Select
    Selection.ClearComments
    Range("B16").Select
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
End Sub
Public Sub CargarImagenesItemViewCD()
    Dim Comentario As Comment
    Sheets("Itemview").Select
    ActiveSheet.Unprotect
    
    Dim inicio As Integer
    inicio = Worksheets("Data").Range("ID_ini").Value
        
    Dim fin As Integer
    fin = Worksheets("Data").Range("ID_FinalItemview").Value
    
    Dim ruta As String
    Dim rutatemp As String
    rutatemp = Worksheets("Data").Range("RutaImagenes3D").Value
    
    ActiveSheet.PivotTables("TablaDinamica").DisplayContextTooltips = False
   
    For rowind = inicio To fin
            ruta = rutatemp & "/" & Range("C" & CStr(rowind)).Value & ".jpg"
            Range("D" & CStr(rowind)).Select
            On Error Resume Next
            Set Comentario = Range("D" & CStr(rowind)).Comment
            If Err.Number = 0 Then
                ' cell has comment
                Range("D" & CStr(rowind)).Comment.Delete
            End If
            On Error GoTo 0
            If FileFolderExists(ruta) Then
                Range("D" & CStr(rowind)).AddComment
                Range("D" & CStr(rowind)).Comment.Visible = False
                With Range("D" & CStr(rowind)).Comment.Shape.TextFrame.Characters.Font
                    .ColorIndex = 1
                    .Size = 18
                    .Bold = True
                    .Underline = True
                End With
                Range("D" & CStr(rowind)).Comment.text text:=Range("C" & CStr(rowind)).text & " - " & Range("D" & CStr(rowind)).text
                With Range("D" & CStr(rowind)).Comment
                    .Shape.Fill.UserPicture ruta
                    .Shape.ScaleHeight 6, msoFalse, msoScaleFromTopLeft
                    .Shape.ScaleWidth 6, msoFalse, msoScaleFromTopLeft
                End With
            Else
                
            End If
            
    Next rowind
    Worksheets("Data").Range("Imagenes3DCargadas").Value = "X"
    Range("C26").Select
End Sub

Public Sub CargarImagenesBoMCD()
    Dim Comentario As Comment
    Sheets("BoM").Select
    ActiveSheet.Unprotect
    
    Dim inicio As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
        
    Dim fin As Integer
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    
    Dim ruta As String
    Dim rutatemp As String
    rutatemp = Worksheets("Data").Range("RutaImagenes3D").Value
   
    For rowind = inicio To fin
            ruta = rutatemp & "/" & Range("D" & CStr(rowind)).Value & ".jpg"
            Range("E" & CStr(rowind)).Select
            On Error Resume Next
            Set Comentario = Range("E" & CStr(rowind)).Comment
            If Err.Number = 0 Then
                ' cell has comment
                Range("E" & CStr(rowind)).Comment.Delete
            End If
            On Error GoTo 0
            If FileFolderExists(ruta) Then
                Range("E" & CStr(rowind)).AddComment
                Range("E" & CStr(rowind)).Comment.Visible = False
                With Range("E" & CStr(rowind)).Comment.Shape.TextFrame.Characters.Font
                    .ColorIndex = 1
                    .Size = 18
                    .Bold = True
                    .Underline = True
                End With
                Range("E" & CStr(rowind)).Comment.text text:=Range("D" & CStr(rowind)).text & " - " & Range("E" & CStr(rowind)).text
                With Range("E" & CStr(rowind)).Comment
                    .Shape.Fill.UserPicture ruta
                    .Shape.ScaleHeight 6, msoFalse, msoScaleFromTopLeft
                    .Shape.ScaleWidth 6, msoFalse, msoScaleFromTopLeft
                End With
            Else
                
            End If
    Next rowind
    Worksheets("Data").Range("Imagenes3DCargadas").Value = "X"
    Range("C26").Select
End Sub

Attribute VB_Name = "M3ExtRef_CrearListadoWord"

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     PDF INFORMEA FORMATU HANDIA
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Option Explicit

Sub crearListadoWordExtRef(ByVal res As Integer)

'Aldagaiak
Dim wordObj As Object
Dim wordDoc As Object
Dim wordSel As Object
Dim myRange As Object
Dim tabla As Object
Dim ruta, rutaCD, rutaTempCD As String
Dim rutatemp As String
Dim rutatemp_t As String
Dim rutatemp_w As String
Dim saltoPag As Integer
Dim unekoa As Long
Dim ehunekoa As Long
Dim kopurua As Integer
Dim tituluBarra As Integer
Dim pctCompl As Integer
Dim fitxategia As Variant
Dim excelizena As String
Dim user As String
Dim pass As String
Dim imagen As String
Dim formatua As Integer
Dim filtroa As String
Dim kantitatea As Long
Dim inicio As Integer
    inicio = Worksheets("Data").Range("ID_ini").Value
        
Dim fin As Integer
    fin = Worksheets("Data").Range("ID_FinalItemview").Value
    
Dim rowind As Integer

If (ImageFormExt.opt_frmWord) Then
    filtroa = "Word Files (*.docx), *.docx"
    formatua = 12
Else
    filtroa = "PDF Files (*.pdf), *.pdf"
    formatua = 17
End If

'sortu Word objektua eta dokumentu bat gehitu
Set wordObj = CreateObject("Word.Application")
Set wordDoc = wordObj.Documents.Add
Set wordSel = wordObj.Selection
wordObj.Visible = True
wordObj.WindowState = 2 'wdWindowStateMinimize
Application.ScreenUpdating = False
wordObj.ScreenUpdating = False
'Lortu excelaren izena
excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)

'ULMA logoa kopiatu eta Word dokumentuko goiburuan sartu eskuinaldean
'''''''''''''''''''''''''''''''
Sheets("BoM").Unprotect
On Error GoTo cont
Sheets("BoM").Shapes("LogoUlma").CopyPicture
' 1=wdHeaderFooterPrimary
wordDoc.Sections.Item(1).Headers(1) _
  .Range.Select
wordObj.Selection.PasteSpecial
wordDoc.Sections.Item(1).Headers(1).Shapes(1).Height = 25
wordDoc.Sections.Item(1).Headers(1).Shapes(1).Width = 60
wordDoc.Sections.Item(1).Headers(1).Shapes(1).ConvertToInlineShape
wordDoc.Sections(1).Headers(1).Range.Paragraphs(1).Alignment = 0 'wdAlignParagraphLeft
cont:
ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
ThisWorkbook.Worksheets("BoM").EnableOutlining = True
wordObj.Selection.EndOf
'''''''''''''''''''''''''''''''
'dokumentuaren lerroan dokumentu izena eta zenbakia sartu

wordDoc.Sections.Item(1).Footers(1).Range.Font.Size = 8
wordDoc.Sections.Item(1).Footers(1).PageNumbers.Add PageNumberAlignment:=2 'wdAlignPageNumberRight
wordDoc.Sections.Item(1).Footers(1).Range.InsertAfter vbNewLine & excelizena


'''''''''''''''''''''''''''''
'Lehen orrian goiburuko informazioa sartu
'''''''''''''''''''''''''''''

'Taula Sortu
Set myRange = wordDoc.Content
myRange.Collapse Direction:=0 'wdCollapseEnd
Set tabla = wordDoc.Tables.Add(myRange, 8, 4)
tabla.Range.Font.Name = "Verdana"
tabla.Range.Font.Size = 8

tabla.Range.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter

tabla.Rows.Height = 12
tabla.Columns(1).Width = 60
tabla.Columns(2).Width = 180
tabla.Columns(3).Width = 60
tabla.Columns(4).Width = 160

tabla.Columns(1).Select
wordObj.Selection.Font.Size = 5
wordObj.Selection.Font.Bold = True
tabla.Columns(2).Select
wordObj.Selection.Font.Size = 6
tabla.Columns(3).Select
wordObj.Selection.Font.Size = 5
wordObj.Selection.Font.Bold = True
tabla.Columns(4).Select
wordObj.Selection.Font.Size = 6

With tabla
    .Rows.HeightRule = 2 'wdRowHeightExactly
    .Borders.InsideLineStyle = 1 'wdLineStyleSingle
    .Borders.OutsideLineStyle = 1 'wdLineStyleSingle
    .Cell(1, 1).Merge .Cell(1, 2)
    .Cell(1, 1).Merge .Cell(1, 2)
    .Cell(1, 1).Height = 15
    .Cell(1, 1).Width = 400
    .Cell(1, 1).Range.Font.Bold = True
    .Cell(1, 1).Range.Font.Size = 8
    .Cell(1, 1).Shading.BackgroundPatternColorIndex = 16 'wdGray25
    .Cell(1, 2).Shading.BackgroundPatternColorIndex = 16 'wdGray25
    .Cell(1, 2).Width = 60
    '-3=wdBorderBottom
    .Rows(4).Borders(-3).LineStyle = 3 'wdLineStyleDashSmallGap
    .Rows(4).Borders(-3).LineWidth = 4 'wdLineWidth050pt
End With


'Taula bete

With tabla
    .Cell(1, 1).Range.InsertAfter excelizena
    .Cell(1, 2).Range.InsertAfter Range("ID_Data_Fecha").Value
    .Cell(2, 1).Range.InsertAfter Sheets("Languages").Range("ID_NomEstudio").Value
    .Cell(3, 1).Range.InsertAfter Sheets("Languages").Range("ID_NumEstudio").Value
    .Cell(4, 1).Range.InsertAfter Sheets("Languages").Range("ID_RealizadoPor").Value
    .Cell(5, 1).Range.InsertAfter Sheets("Languages").Range("ID_CodObra").Value
    .Cell(6, 1).Range.InsertAfter Sheets("Languages").Range("ID_Obra").Value
    .Cell(7, 1).Range.InsertAfter Sheets("Languages").Range("ID_Poblacion").Value
    .Cell(8, 1).Range.InsertAfter Sheets("Languages").Range("ID_Subsector").Value
    '''
    .Cell(2, 3).Range.InsertAfter Sheets("Languages").Range("ID_Cliente").Value
    .Cell(3, 3).Range.InsertAfter Sheets("Languages").Range("ID_Direccion").Value
    .Cell(4, 3).Range.InsertAfter Sheets("Languages").Range("ID_Poblacion").Value
    .Cell(5, 3).Range.InsertAfter Sheets("Languages").Range("ID_OfertaSolicitud").Value
    .Cell(6, 3).Range.InsertAfter Sheets("Languages").Range("ID_FaseObra").Value
    .Cell(7, 3).Range.InsertAfter Sheets("Languages").Range("ID_Contacto").Value
    .Cell(8, 3).Range.InsertAfter Sheets("Languages").Range("ID_CodNomComercial").Value
    '''
    .Cell(2, 2).Range.InsertAfter Range("ID_Data_NomEstudio")
    .Cell(3, 2).Range.InsertAfter Range("ID_Data_NumEstudio")
    .Cell(4, 2).Range.InsertAfter Range("ID_Data_Realizado")
    .Cell(5, 2).Range.InsertAfter Range("ID_Data_CodObra")
    .Cell(6, 2).Range.InsertAfter Range("ID_Data_ObraGet")
    .Cell(7, 2).Range.InsertAfter Range("ID_Data_PoblacionObra")
    .Cell(8, 2).Range.InsertAfter Range("_ID_DataSubsector")
    '''
    .Cell(2, 4).Range.InsertAfter Range("ID_Data_Cliente")
    .Cell(3, 4).Range.InsertAfter Range("ID_Data_Direccion")
    .Cell(4, 4).Range.InsertAfter Range("ID_Data_PoblacionCliente")
    .Cell(5, 4).Range.InsertAfter Range("ID_Data_OfertaSolicitud")
    .Cell(6, 4).Range.InsertAfter Range("ID_Data_FaseObra")
    .Cell(7, 4).Range.InsertAfter Range("ID_Data_Contacto")
    .Cell(8, 4).Range.InsertAfter Range("ID_Data_CodNomComercial")
    
End With

 wordDoc.Sections.Add , Start:=0 'wdSectionContinuous
 wordDoc.Sections.Add , Start:=0 'wdSectionContinuous




'''''''''''''''''''''''''''''


'Loop linea bakoitzeko
    'Hartu datuak: kodigoa, deskripzioa, irudia --> Wordera
    
    'Progresu barrarako %100-a kalkulatu
    ''''''''''''''''''''''''''''''''''''
    unekoa = CLng(1)
    ehunekoa = fin - inicio + 1
    kopurua = ehunekoa
    pctCompl = Application.WorksheetFunction.RoundDown((unekoa * CLng(100)) / ehunekoa, 0)
    ProgressBar.Label1.Caption = pctCompl & "% Completed"
    ProgressBar.Bar.Width = pctCompl * 2
    ''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''
Dim pisuUnit As String
If (Range("CiaDatos").Value = "107") Then
    pisuUnit = "Lbs."
Else
    pisuUnit = "Kg."
End If

'''''''''''''''''''''''''''''
    
    tituluBarra = Worksheets("Data").Range("ID_ini").Value - 1
    saltoPag = 2
    
    'Irudien proportzioa gordetzeko aldagaia
    Dim aspect, altuera, zabalera, eskala As Double
    
    For rowind = inicio To fin
        kantitatea = Sheets("ItemView").Range("K" & CStr(rowind)).Value + Sheets("ItemView").Range("L" & CStr(rowind)).Value
        If kantitatea > 0 Then
            Set myRange = wordDoc.Content
            myRange.Collapse Direction:=0 'wdCollapseEnd
            
            rutatemp = "\\192.227.20.160\\FotosProductos\\Repcon"
            rutatemp_t = "\\192.227.20.160\\FotosProductos\\Repcon\\_t"
            rutatemp_w = "\\192.227.20.160\\FotosProductos\\Repcon\\_w"
            rutaTempCD = Sheets("Data").Range("RutaImagenes3D").Value
            rutaCD = rutatemp & "/" & Range("C" & rowind).Value & ".jpg"
            If (Worksheets("Data").Range("UtilizandoCD").Value = "X") Then
                ruta = rutaCD
            Else
                Select Case res
                    Case 0
                        ruta = rutatemp_t & "\\" & Range("C" & rowind).Value & ".jpg"
                    Case 1
                        ruta = rutatemp_w & "\\" & Range("C" & rowind).Value & ".jpg"
                    Case 2
                        ruta = rutatemp & "\\" & Range("C" & rowind).Value & ".png"
                End Select
            End If
            
            'Taula sortu eta formatua eman
            Set tabla = wordDoc.Tables.Add(myRange, 4, 2)
            tabla.Range.Font.Name = "Verdana"
            tabla.Range.Font.Size = 10
            With tabla
                .Rows.HeightRule = 2 'wdRowHeightExactly
                .Borders.InsideLineStyle = 1 'wdLineStyleSingle
                .Borders.OutsideLineStyle = 1 ' wdLineStyleSingle
                .Cell(1, 1).Merge .Cell(1, 2)
                .Cell(2, 2).Merge .Cell(3, 2)
                .Cell(2, 2).Merge .Cell(4, 2)
                .Cell(1, 1).Height = 20
                .Cell(2, 1).Height = 20
                .Cell(3, 1).Height = 140
                .Cell(4, 1).Height = 20
                .Cell(1, 1).Range.Font.Bold = True
                .Cell(1, 1).Range.Font.Size = 12
            End With
            
            'datuz bete exceletik
            
            On Error GoTo 0
            tabla.Cell(1, 1).Range.InsertAfter Range("C" & CStr(rowind)) & "  -  " & Range("D" & CStr(rowind))
            tabla.Cell(2, 1).Range.InsertAfter Range("F" & tituluBarra) & ":  " & Range("F" & CStr(rowind)) & pisuUnit
            tabla.Cell(3, 1).Range.InsertAfter ThisWorkbook.Names("ID_Cantidades").RefersToRange(1, 1) & ":  " & vbNewLine & vbNewLine & (Range("K" & CStr(rowind)) + Range("L" & CStr(rowind)))
            '3,1 zeldan bigarren linea aukeratu zentratu eta tamainaz handitzeko
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            wordSel.SetRange tabla.Cell(3, 1).Range.Start, tabla.Cell(3, 1).Range.Start
            wordSel.MoveDown Unit:=5, Count:=2 ' 5 = wdLine
            wordSel.MoveRight Unit:=2, Count:=1, Extend:=1 '2= wdWord eta 1=wdExtend
            wordSel.Font.Size = 26
            wordSel.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
            wordSel.EndOf
            ''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            tabla.Cell(4, 1).Range.InsertAfter Range("M" & tituluBarra) & ":  " & Range("M" & CStr(rowind)) & pisuUnit
            
            'Irudia campus-en badago sartu, bestela "NO IMAGE" ipini
            
            On Error Resume Next
            
            imagen = fileExists(ruta)
                
            If (imagen <> "") Then
                wordSel.SetRange tabla.Cell(2, 2).Range.Start, tabla.Cell(2, 2).Range.Start 'zelda hautatu
                wordSel.Fields.Add Range:=wordSel.Range, Type:=67, text:=Chr(34) & "\\" & imagen & Chr(34) & " \d" 'irudia erreferentziaz sartu
                If (formatua = 12) Then
                    IrudiLinkakApurtu tabla.Cell(2, 2).Range.InlineShapes(1)
                End If
                'VBA-n ez dabil Aspect Ratio. Eskuz egin beharko da
                altuera = tabla.Cell(2, 2).Range.InlineShapes(1).Height
                zabalera = tabla.Cell(2, 2).Range.InlineShapes(1).Width
                If (altuera > zabalera) Then 'proportzioa kalkulatu
                    aspect = altuera / zabalera
                Else
                    aspect = zabalera / altuera
                End If
                'Irudia handitu/txikitu zeldaren tamainura
                tabla.Cell(2, 2).Range.InlineShapes(1).Width = tabla.Cell(2, 2).Range.Cells(1).Width - 1
                If (zabalera > tabla.Cell(2, 2).Range.InlineShapes(1).Width) Then ' haunditze/txikitze eskala kalkulatu
                    eskala = zabalera / tabla.Cell(2, 2).Range.InlineShapes(1).Width
                Else
                    eskala = tabla.Cell(2, 2).Range.InlineShapes(1).Width / zabalera
                End If
                tabla.Cell(2, 2).Range.InlineShapes(1).Height = tabla.Cell(2, 2).Range.InlineShapes(1).Height * (eskala)
                
                If (tabla.Cell(2, 2).Range.InlineShapes(1).Width > tabla.Cell(2, 2).Range.Cells(1).Width) Then 'zabalagoa bada doitu
                   tabla.Cell(2, 2).Range.InlineShapes(1).Width = tabla.Cell(2, 2).Range.Cells(1).Width
                   tabla.Cell(2, 2).Range.InlineShapes(1).Height = tabla.Cell(2, 2).Range.InlineShapes(1).Width / aspect 'proportzioa mantendu
                End If
                If (tabla.Cell(2, 2).Range.InlineShapes(1).Height > 170) Then 'altuagoa bada doitu
                   tabla.Cell(2, 2).Range.InlineShapes(1).Height = 170
                   tabla.Cell(2, 2).Range.InlineShapes(1).Width = tabla.Cell(2, 2).Range.InlineShapes(1).Height / aspect 'proportzioa mantendu
                End If
                tabla.Cell(2, 2).Range.Cells(1).LeftPadding = 0
                tabla.Cell(2, 2).Range.Cells(1).TopPadding = 5
                tabla.Cell(2, 2).Range.Cells(1).RightPadding = 5
                'zentratu bertikal eta horizontalki
                tabla.Cell(2, 2).Range.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter
                wordSel.SetRange tabla.Cell(2, 2).Range.Start, tabla.Cell(2, 2).Range.Start
                wordSel.Collapse
                wordSel.Expand Unit:=1
                wordSel.ParagraphFormat.Alignment = 1  'wdAlignParagraphCenter
            Else
                With tabla.Cell(2, 2)
                    .Range.Select
                    wordObj.Selection.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter
                    .Range.InsertAfter "NO " & Sheets("Languages").Range("ImageForm_Image").Value
                    .Range.Font.Size = 30
                    .Range.Font.Bold = True
                    .Range.Font.Color = 6710886   'wdColorGray60
                    .Range.Font.Shadow = True
                    .Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
                    wordObj.Selection.EndOf
                End With
            End If
            'Sartutako 3 taulako orri berrirako jauzia azkenengo artikulua ez bada
            If saltoPag <> kopurua + 1 And saltoPag Mod 3 = 0 Then
                wordDoc.Sections.Add
            Else
                If saltoPag <> kopurua + 1 Then
                    'taulen arteko jauzia sartu
                    wordDoc.Sections.Add , Start:=0 'wdSectionContinuous
                    'wordDoc.Sections.Add , Start:=0 'wdSectionContinuous
                End If
            End If
            saltoPag = saltoPag + 1
            
            'eguneratu progesu barra
            ''''''''''''''''''''''''
            pctCompl = Application.WorksheetFunction.RoundUp((unekoa * CLng(100)) / ehunekoa, 0)
            ProgressBar.Label1.Caption = pctCompl & "% Completed"
            ProgressBar.Bar.Width = pctCompl * 2
            unekoa = unekoa + 1
            ''''''''''''''''''''''''
        End If
    Next
    'Amaitu da prozesua -> ezkutatu prozesu barra
    ProgressBar.Hide
    wordObj.Visible = False
    'Gorde PDF/Word bezala fitxategia
    fitxategia = Application.GetSaveAsFilename(InitialFileName:=excelizena, fileFilter:=filtroa)
    If Not fitxategia = False Then
        wordDoc.SaveAs fitxategia, formatua ' 17 = wdFormatPDF / 12 = wdFormatXMLDocument
    End If
    'Itxi word objektua
    If Not wordDoc Is Nothing Then
        wordDoc.Close SaveChanges:=0 'wdDoNotSaveChanges
        wordObj.Quit 0 'wdDoNotSaveChanges
        Set wordObj = Nothing
    End If
    Application.ScreenUpdating = True
End Sub




Sub IrudiLinkakApurtu(ByRef s As Variant)
        If s.Type = 4 Then 'wdInlineShapeLinkedPicture
            s.LinkFormat.SavePictureWithDocument = True
            s.LinkFormat.BreakLink
        End If
End Sub

Attribute VB_Name = "M4ExtRef_CrearListPDFExpr"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     PDF INFORMEA FORMATU TXIKIA
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Option Explicit

Sub crearListadoWordExpressExtRef(ByVal res As Integer)

'Aldagaiak
Dim wordObj As Object
Dim wordDoc As Object
Dim wordSel As Object
Dim myRange As Object
Dim tabla As Object
Dim ruta, rutaCD, rutaTempCD As String
Dim rutatemp As String
Dim rutatemp_t As String
Dim rutatemp_w As String
Dim saltoPag As Integer
Dim unekoa As Long
Dim ehunekoa As Long
Dim kopurua As Integer
Dim tituluBarra As Integer
Dim pctCompl As Integer
Dim fitxategia As Variant
Dim excelizena As String
Dim user As String
Dim pass As String
Dim imagen As String
Dim formatua As Integer
Dim filtroa As String
Dim kantitatea As Long
Dim inicio As Integer
    inicio = Worksheets("Data").Range("ID_ini").Value
        
Dim fin As Integer
    fin = Worksheets("Data").Range("ID_FinalItemview").Value
    
Dim rowind As Integer

If (ImageFormExt.opt_frmWord) Then
    filtroa = "Word Files (*.docx), *.docx"
    formatua = 12
Else
    filtroa = "PDF Files (*.pdf), *.pdf"
    formatua = 17
End If

'sortu Word objektua eta dokumentu bat gehitu
Set wordObj = CreateObject("Word.Application")
Set wordDoc = wordObj.Documents.Add
Set wordSel = wordObj.Selection
Application.ScreenUpdating = False
wordObj.ScreenUpdating = False


'Lortu excelaren izena
excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)

'ULMA logoa kopiatu eta Word dokumentuko goiburuan sartu eskuinaldean
'''''''''''''''''''''''''''''''
Sheets("BoM").Unprotect
On Error GoTo cont
' 1 = wdHeaderFooterPrimary
Sheets("BoM").Shapes("LogoUlma").CopyPicture
wordDoc.Sections.Item(1).Headers(1) _
  .Range.Select
wordObj.Selection.PasteSpecial
wordDoc.Sections.Item(1).Headers(1).Shapes(1).Height = 25
wordDoc.Sections.Item(1).Headers(1).Shapes(1).Width = 60
wordDoc.Sections.Item(1).Headers(1).Shapes(1).ConvertToInlineShape
wordDoc.Sections(1).Headers(1).Range.Paragraphs(1).Alignment = 0 'wdAlignParagraphRight
cont:
ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
ThisWorkbook.Worksheets("BoM").EnableOutlining = True
wordObj.Selection.EndOf
'''''''''''''''''''''''''''''''
'dokumentuaren lerroan dokumentu izena eta zenbakia sartu

wordDoc.Sections.Item(1).Footers(1).Range.Font.Size = 8
wordDoc.Sections.Item(1).Footers(1).PageNumbers.Add PageNumberAlignment:=2 'wdAlignPageNumberRight
wordDoc.Sections.Item(1).Footers(1).Range.InsertAfter vbNewLine & excelizena


'''''''''''''''''''''''''''''
'Lehen orrian goiburuko informazioa sartu
'''''''''''''''''''''''''''''

'Taula Sortu
Set myRange = wordDoc.Content
myRange.Collapse Direction:=0 'wdCollapseEnd
Set tabla = wordDoc.Tables.Add(myRange, 8, 4)
tabla.Range.Font.Name = "Verdana"
tabla.Range.Font.Size = 8

tabla.Range.Cells.VerticalAlignment = 1 ' wdCellAlignVerticalCenter

tabla.Rows.Height = 12
tabla.Columns(1).Width = 60
tabla.Columns(2).Width = 180
tabla.Columns(3).Width = 60
tabla.Columns(4).Width = 160

tabla.Columns(1).Select
wordObj.Selection.Font.Size = 5
wordObj.Selection.Font.Bold = True
tabla.Columns(2).Select
wordObj.Selection.Font.Size = 6
tabla.Columns(3).Select
wordObj.Selection.Font.Size = 5
wordObj.Selection.Font.Bold = True
tabla.Columns(4).Select
wordObj.Selection.Font.Size = 6

With tabla
    .Rows.HeightRule = 2 'wdRowHeightExactly
    .Borders.InsideLineStyle = 1 'wdLineStyleSingle
    .Borders.OutsideLineStyle = 1 'wdLineStyleSingle
    .Cell(1, 1).Merge .Cell(1, 2)
    .Cell(1, 1).Merge .Cell(1, 2)
    .Cell(1, 1).Height = 15
    .Cell(1, 1).Width = 400
    .Cell(1, 1).Range.Font.Bold = True
    .Cell(1, 1).Range.Font.Size = 8
    .Cell(1, 1).Shading.BackgroundPatternColorIndex = 16 'wdGray25
    .Cell(1, 2).Shading.BackgroundPatternColorIndex = 16 'wdGray25
    .Cell(1, 2).Width = 60
    '-3=wdBorderBottom
    .Rows(4).Borders(-3).LineStyle = 3 'wdLineStyleDashSmallGap
    .Rows(4).Borders(-3).LineWidth = 4 'wdLineWidth050pt
End With


'Taula bete

With tabla
    .Cell(1, 1).Range.InsertAfter excelizena
    .Cell(1, 2).Range.InsertAfter Range("ID_Data_Fecha").Value
    .Cell(2, 1).Range.InsertAfter Sheets("Languages").Range("ID_NomEstudio").Value
    .Cell(3, 1).Range.InsertAfter Sheets("Languages").Range("ID_NumEstudio").Value
    .Cell(4, 1).Range.InsertAfter Sheets("Languages").Range("ID_RealizadoPor").Value
    .Cell(5, 1).Range.InsertAfter Sheets("Languages").Range("ID_CodObra").Value
    .Cell(6, 1).Range.InsertAfter Sheets("Languages").Range("ID_Obra").Value
    .Cell(7, 1).Range.InsertAfter Sheets("Languages").Range("ID_Poblacion").Value
    .Cell(8, 1).Range.InsertAfter Sheets("Languages").Range("ID_Subsector").Value
    '''
    .Cell(2, 3).Range.InsertAfter Sheets("Languages").Range("ID_Cliente").Value
    .Cell(3, 3).Range.InsertAfter Sheets("Languages").Range("ID_Direccion").Value
    .Cell(4, 3).Range.InsertAfter Sheets("Languages").Range("ID_Poblacion").Value
    .Cell(5, 3).Range.InsertAfter Sheets("Languages").Range("ID_OfertaSolicitud").Value
    .Cell(6, 3).Range.InsertAfter Sheets("Languages").Range("ID_FaseObra").Value
    .Cell(7, 3).Range.InsertAfter Sheets("Languages").Range("ID_Contacto").Value
    .Cell(8, 3).Range.InsertAfter Sheets("Languages").Range("ID_CodNomComercial").Value
    '''
    .Cell(2, 2).Range.InsertAfter Range("ID_Data_NomEstudio")
    .Cell(3, 2).Range.InsertAfter Range("ID_Data_NumEstudio")
    .Cell(4, 2).Range.InsertAfter Range("ID_Data_Realizado")
    .Cell(5, 2).Range.InsertAfter Range("ID_Data_CodObra")
    .Cell(6, 2).Range.InsertAfter Range("ID_Data_ObraGet")
    .Cell(7, 2).Range.InsertAfter Range("ID_Data_PoblacionObra")
    .Cell(8, 2).Range.InsertAfter Range("_ID_DataSubsector")
    '''
    .Cell(2, 4).Range.InsertAfter Range("ID_Data_Cliente")
    .Cell(3, 4).Range.InsertAfter Range("ID_Data_Direccion")
    .Cell(4, 4).Range.InsertAfter Range("ID_Data_PoblacionCliente")
    .Cell(5, 4).Range.InsertAfter Range("ID_Data_OfertaSolicitud")
    .Cell(6, 4).Range.InsertAfter Range("ID_Data_FaseObra")
    .Cell(7, 4).Range.InsertAfter Range("ID_Data_Contacto")
    .Cell(8, 4).Range.InsertAfter Range("ID_Data_CodNomComercial")
End With

 wordDoc.Sections.Add , Start:=0 'wdSectionContinuous
 wordDoc.Sections.Add , Start:=0 'wdSectionContinuous


'''''''''''''''''''''''''''''
Dim pisuUnit As String
If (Range("CiaDatos").Value = "107") Then
    pisuUnit = "Lbs."
Else
    pisuUnit = "Kg."
End If

'''''''''''''''''''''''''''''
goiburua wordDoc

'Loop linea bakoitzeko
    'Hartu datuak: kodigoa, deskripzioa, irudia --> Wordera
    
    'Progresu barrarako %100-a kalkulatu
    ''''''''''''''''''''''''''''''''''''
    unekoa = CLng(1)
    ehunekoa = fin - inicio + 1
    kopurua = ehunekoa
    pctCompl = Application.WorksheetFunction.RoundDown((unekoa * CLng(100)) / ehunekoa, 0)
    ProgressBar.Label1.Caption = pctCompl & "% Completed"
    ProgressBar.Bar.Width = pctCompl * 2
    ''''''''''''''''''''''''''''''''''''
    
    
    'saltoPag = 2
    
    'Irudien proportzioa gordetzeko aldagaia
    Dim aspect, altuera, zabalera, eskala As Double
    
    For rowind = inicio To fin
        kantitatea = Sheets("ItemView").Range("K" & CStr(rowind)).Value + Sheets("ItemView").Range("L" & CStr(rowind)).Value
        If kantitatea > 0 Then
            Set myRange = wordDoc.Content
            myRange.Collapse Direction:=0  'wdCollapseEnd
            
            rutatemp = "\\192.227.20.160\\FotosProductos\\Repcon"
            rutatemp_t = "\\192.227.20.160\\FotosProductos\\Repcon\\_t"
            rutatemp_w = "\\192.227.20.160\\FotosProductos\\Repcon\\_w"
            rutaTempCD = Sheets("Data").Range("RutaImagenes3D").Value
            rutaCD = rutatemp & "/" & Range("C" & rowind).Value & ".jpg"
            If (Worksheets("Data").Range("UtilizandoCD").Value = "X") Then
                ruta = rutaCD
            Else
                Select Case res
                    Case 0
                        ruta = rutatemp_t & "\\" & Range("C" & rowind).Value & ".jpg"
                    Case 1
                        ruta = rutatemp_w & "\\" & Range("C" & rowind).Value & ".jpg"
                    Case 2
                        ruta = rutatemp & "\\" & Range("C" & rowind).Value & ".png"
                End Select
            End If
            
            'Taula sortu eta formatua eman
            Set tabla = wordDoc.Tables.Add(myRange, 1, 6)
            With tabla
                .Rows.Last.Height = wordObj.CentimetersToPoints(1.41)
                .Rows.Last.HeightRule = 2 'wdRowHeightExactly
                .Rows.Last.Range.Font.Name = "Verdana"
                .Rows.Last.Range.Font.Size = 6
                .Borders.InsideLineStyle = 1 'wdLineStyleSingle
                .Borders.OutsideLineStyle = 1 'wdLineStyleSingle
                .Range.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter
                
            End With
            
            'datuz bete exceletik
            
            On Error GoTo 0
            tabla.Cell(unekoa + 1, 1).Range.Font.Size = 6
            tabla.Cell(unekoa + 1, 1).Range.InsertAfter Range("C" & CStr(rowind))
            tabla.Cell(unekoa + 1, 1).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
            tabla.Cell(unekoa + 1, 1).Range.Font.Bold = True
            tabla.Cell(unekoa + 1, 2).Range.InsertAfter Range("D" & CStr(rowind))
            tabla.Cell(unekoa + 1, 2).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
            tabla.Cell(unekoa + 1, 3).Range.InsertAfter Range("F" & CStr(rowind)) & " " & pisuUnit
            tabla.Cell(unekoa + 1, 4).Range.InsertAfter (Range("K" & CStr(rowind)) + Range("L" & CStr(rowind)))
            tabla.Cell(unekoa + 1, 5).Range.InsertAfter Range("M" & CStr(rowind)) & " " & pisuUnit
            tabla.Cell(unekoa + 1, 3).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
            tabla.Cell(unekoa + 1, 4).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
            tabla.Cell(unekoa + 1, 5).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
            
            'Irudia campus-en badago sartu, bestela "NO IMAGE" ipini
            
            On Error Resume Next
            
            imagen = fileExists(ruta)
            
            If (imagen <> "") Then
                wordSel.SetRange tabla.Cell(unekoa + 1, 6).Range.Start, tabla.Cell(unekoa + 1, 6).Range.Start 'zelda hautatu
                wordSel.Fields.Add Range:=wordSel.Range, Type:=67, text:=Chr(34) & "\\" & imagen & Chr(34) & " \d" 'irudia erreferentziaz sartu
                If (formatua = 12) Then
                    IrudiLinkakApurtu tabla.Cell(2, 2).Range.InlineShapes(1)
                End If
                'VBA-n ez dabil Aspect Ratio. Eskuz egin beharko da
                altuera = tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Height
                zabalera = tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width
                If (altuera > zabalera) Then 'proportzioa kalkulatu
                    aspect = altuera / zabalera
                Else
                    aspect = zabalera / altuera
                End If
                'Irudia handitu/txikitu zeldaren tamainura
                tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width = tabla.Cell(unekoa + 1, 6).Range.Cells(1).Width - 1
                If (zabalera > tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width) Then ' haunditze/txikitze eskala kalkulatu
                    eskala = zabalera / tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width
                Else
                    eskala = tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width / zabalera
                End If
                tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Height = tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Height * (eskala)
                If (tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width > tabla.Cell(unekoa + 1, 6).Range.Cells(1).Width) Then 'zabalagoa bada doitu
                   tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width = tabla.Cell(unekoa + 1, 6).Range.Cells(1).Width
                   tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Height = tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Height / aspect 'proportzioa mantendu
                End If
                If (tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Height > tabla.Cell(unekoa + 1, 6).Range.Cells(1).Height) Then 'altuagoa bada doitu
                   tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Height = tabla.Cell(unekoa + 1, 6).Range.Cells(1).Height
                   tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width = tabla.Cell(unekoa + 1, 6).Range.InlineShapes(1).Width / aspect 'proportzioa mantendu
                End If
                tabla.Cell(unekoa + 1, 6).Range.Cells(1).LeftPadding = 0
                tabla.Cell(unekoa + 1, 6).Range.Cells(1).TopPadding = 0
                tabla.Cell(unekoa + 1, 6).Range.Cells(1).RightPadding = 0
                'zentratu bertikal eta horizontalki
                tabla.Cell(unekoa + 1, 6).Range.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter
                wordSel.SetRange tabla.Cell(unekoa + 1, 6).Range.Start, tabla.Cell(unekoa + 1, 6).Range.Start
                wordSel.Collapse
                wordSel.Expand Unit:=1
                wordSel.ParagraphFormat.Alignment = 1  'wdAlignParagraphCenter
            Else
                With tabla.Cell(unekoa + 1, 6)
                    .Range.Select
                    wordObj.Selection.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter
                    .Range.InsertAfter "NO " & Sheets("Languages").Range("ImageForm_Image").Value
                    .Range.Font.Size = 8
                    .Range.Font.Bold = True
                    .Range.Font.Color = 6710886  'wdColorGray60
                    .Range.Font.Shadow = True
                    .Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
                    wordObj.Selection.EndOf
                End With
            End If
            
            'Sartutako 17 artikuluko (lehen orrian 13) orri berrirako jauzia
            If unekoa = 13 Then
                If unekoa < kopurua Then
                    wordDoc.Sections.Add
                    goiburua wordDoc
                End If
            End If
            If (unekoa - 13) Mod 17 = 0 And unekoa > 14 Then
                If unekoa < kopurua Then
                    wordDoc.Sections.Add
                    goiburua wordDoc
                End If
            End If
            
            'eguneratu progesu barra
            ''''''''''''''''''''''''
            pctCompl = Application.WorksheetFunction.RoundUp((unekoa * CLng(100)) / ehunekoa, 0)
            ProgressBar.Label1.Caption = pctCompl & "% Completed"
            ProgressBar.Bar.Width = pctCompl * 2
            unekoa = unekoa + 1
            ''''''''''''''''''''''''
        End If
    Next
    'Amaitu da prozesua -> ezkutatu prozesu barra
    ProgressBar.Hide
    'Gorde PDF/Word bezala fitxategia
    fitxategia = Application.GetSaveAsFilename(InitialFileName:=excelizena, fileFilter:=filtroa)
    If Not fitxategia = False Then
        wordDoc.SaveAs fitxategia, formatua ' 17 = wdFormatPDF / 12 = wdFormatXMLDocument
    End If
    'Itxi word objektua
    If Not wordDoc Is Nothing Then
        wordDoc.Close SaveChanges:=0 'wdDoNotSaveChanges
        wordObj.Quit 0 'wdDoNotSaveChanges
        Set wordObj = Nothing
    End If
    Application.ScreenUpdating = True
End Sub

Sub goiburua(ByRef wordDoc As Object)
Dim tituluBarra As Integer
Dim myRange As Object
Dim tabla As Object
tituluBarra = Worksheets("Data").Range("ID_ini").Value - 1
Set myRange = wordDoc.Content
myRange.Collapse Direction:=0  'wdCollapseEnd
Set tabla = wordDoc.Tables.Add(myRange, 1, 6)
tabla.Range.Font.Name = "Verdana"
tabla.Range.Font.Size = 6
tabla.Range.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter
tabla.Cell(1, 1).Range.InsertAfter Range("C" & CStr(tituluBarra))
tabla.Cell(1, 1).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
tabla.Cell(1, 2).Range.InsertAfter Range("D" & CStr(tituluBarra))
tabla.Cell(1, 2).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
tabla.Cell(1, 3).Range.InsertAfter Range("F" & CStr(tituluBarra))
tabla.Cell(1, 4).Range.InsertAfter ThisWorkbook.Names("ID_Cantidades").RefersToRange(1, 1) ' Range("K" & CStr(tituluBarra)) & "+" & Range("L" & CStr(tituluBarra))
tabla.Cell(1, 5).Range.InsertAfter Range("M" & CStr(tituluBarra))
tabla.Cell(1, 3).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
tabla.Cell(1, 4).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
tabla.Cell(1, 5).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
tabla.Cell(1, 6).Range.InsertAfter Sheets("Languages").Range("ImageForm_Image").Value
tabla.Cell(1, 6).Range.ParagraphFormat.Alignment = 1 'wdAlignParagraphCenter
tabla.Rows(1).Height = 8
tabla.Rows.Shading.BackgroundPatternColorIndex = 16 'wdGray25
tabla.Range.Cells.VerticalAlignment = 1 'wdCellAlignVerticalCenter
End Sub



Sub IrudiLinkakApurtu(ByRef s As Variant)
        If s.Type = 4 Then 'wdInlineShapeLinkedPicture
            s.LinkFormat.SavePictureWithDocument = True
            s.LinkFormat.BreakLink
        End If
End Sub

Attribute VB_Name = "M5_Germany"

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     GERMANY EXPORT
'' BERTSIO ZAHARRA (KARLARENA)
'' BERTSIO BERRIA (GOPPINGEN, ORAIN ERABILTZEN DENA)
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Option Explicit
Sub ExportMLGermany()
    
    Dim inicio As Integer
    Dim fin As Integer
    inicio = Worksheets("Data").Range("ID_ini").Value
    fin = Worksheets("Data").Range("ID_FinalItemview").Value
    Dim ML As Workbook
    Set ML = Application.Workbooks.Open("c:\Ulma\Repcon_57\s26\data\doctemplates\Materialliste.xlsm")
    'ML.Windows.Application.WindowState = xlMinimized
    Dim fitxategia As Variant
    Dim lehenLerroa As Integer
    Dim azkenLerroa As Integer
    Dim azkenMat As Integer
    Dim rutatemp As String
    Dim ruta As String
    Dim excelizena As String
    Dim karpeta As String
    Dim del As String
    lehenLerroa = 21
    azkenLerroa = 3372
    azkenMat = azkenLerroa
    
    ' Tajo izen eta zenbaki banatzea
    Dim celdaValorTajo As String
    Dim TajoDes As String
    Dim TajoNum As String
     celdaValorTajo = ThisWorkbook.Sheets("ItemView").Range("E9").Value
     TajoDes = celdaValorTajo
     TajoNum = celdaValorTajo
     On Error Resume Next
     TajoDes = Right(celdaValorTajo, (Len(celdaValorTajo) - Application.Find(" ", celdaValorTajo)))
     TajoNum = Left(celdaValorTajo, Application.Find(" ", celdaValorTajo) - 1)
     
     ' Materiallisteko goiburuko datuak bete gure excelean ditugun datuekin
     
    ML.Sheets("GESAMT").Range("D10").Value = separadorCodNom(ThisWorkbook.Sheets("BoM").Range("ID_Data_Cliente").Value, "//", False)
    ML.Sheets("GESAMT").Range("D12").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Direccion").Value & "," & ThisWorkbook.Sheets("BoM").Range("ID_Data_PoblacionCliente").Value
    ML.Sheets("GESAMT").Range("D14").Value = separadorCodNom(ThisWorkbook.Sheets("BoM").Range("ID_Data_Cliente").Value, "//", True)
    ML.Sheets("GESAMT").Range("D16").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_ObraGet").Value
    ML.Sheets("GESAMT").Range("R5").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_CodObra").Value
    ML.Sheets("GESAMT").Range("R4").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Fecha").Value
    'ML.Sheets("GESAMT").Range("R8").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Delegacion").Value
    del = ThisWorkbook.Sheets("BoM").Range("ID_Data_Delegacion").Value
    ML.Sheets("GESAMT").Range("R8").Value = Application.IfError(Left(Right(del, Len(del) - Application.IfError(Application.Find("-", del, Application.IfError(Application.Find("[", del), 0)), 0)), Len(Right(del, Len(del) - Application.IfError(Application.Find("-", del, Application.IfError(Application.Find("[", del), 0)), 0))) - 1), del)
    ML.Sheets("GESAMT").Range("R7").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Realizado").Value
    ML.Sheets("GESAMT").Range("D8").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Tarifa").Value
    ML.Sheets("GESAMT").Range("R6").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_CodContrato").Value
    ML.Sheets("GESAMT").Range("D17").Value = TajoDes
    ML.Sheets("GESAMT").Range("R10").Value = TajoNum
    ML.Sheets("GESAMT").Range("R11").Value = TajoDes
    ML.Sheets("GESAMT").Range("R12").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Lista").Value
    ML.Sheets("GESAMT").Range("R13").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_FechaINSum").Value
    ML.Sheets("GESAMT").Range("R14").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_FechaPRESum").Value
    
    'Gure exceleko lerro bakoitzeko begiratu badagoen Materiallisten
    'Hala bada sartu kantitatea
    'Ezezkoan sartu lerro bat amaieran kodigo eta kantitatearekin
    'Behin denak amaituta, ezabatu menge ez duten lineak
    
    Dim rowind As Integer
    Dim posizioa As Integer
    Dim konpBalioa As String
    ''''''''''''''''''
    'lerro bakoitzeko
    For rowind = inicio To fin
    'lortu MaterialListe barruan momentuko kodearen posizioa, baldin badago - ItemView-n gaudenez, kode gelaxka hutsa badago, aurrekoaren berdina delako da
        On Error GoTo x
        If (ThisWorkbook.Sheets("ItemView").Range("C" & CStr(rowind)).Value = "") Then
            konpBalioa = ThisWorkbook.Sheets("ItemView").Range("C" & CStr(rowind - 1)).Value
        Else
            konpBalioa = ThisWorkbook.Sheets("ItemView").Range("C" & CStr(rowind)).Value
        End If
        posizioa = Application.IfError(Application.Match(konpBalioa, ML.Sheets("GESAMT").Range("B" & CStr(lehenLerroa), "B" & CStr(azkenMat)), 0), 0)
        GoTo cont
x:
        posizioa = 0
cont:
        'MaterialListen kodea baldin badago
        If posizioa > 0 Then
            Dim non As Integer
            non = posizioa + lehenLerroa - 1
            'Begiratu sartzera goazen kodea alokairu edo saltzeko den, eta Materiallisten modu berdinean doan, bestela beste lerro baten sartu
            If ((ThisWorkbook.Sheets("ItemView").Range("E" & CStr(rowind)).Value = "Miete" And ML.Sheets("GESAMT").Range("A" & CStr(non)).Value = "v") Or (ThisWorkbook.Sheets("ItemView").Range("E" & CStr(rowind)).Value = "Kauf" And ML.Sheets("GESAMT").Range("A" & CStr(non)).Value = "k")) Then
                ML.Sheets("GESAMT").Range("E" & CStr(non)).Value = ThisWorkbook.Sheets("ItemView").Range("K" & CStr(rowind)).Value + ThisWorkbook.Sheets("ItemView").Range("L" & CStr(rowind)).Value
                ML.Sheets("GESAMT").Range("Q" & CStr(non)).Value = ThisWorkbook.Sheets("ItemView").Range("G" & CStr(rowind)).Value
            Else 'Suministro modu ezberdinean badoa, kode bereko beste lerro bat sartu azpian
                ML.Sheets("GESAMT").Range("E" & CStr(non)).EntireRow.Copy
                ML.Sheets("GESAMT").Range("E" & CStr(non + 1)).EntireRow.Insert xlShiftDown
                If (ML.Sheets("GESAMT").Range("A" & CStr(non)).Value = "v") Then
                    ML.Sheets("GESAMT").Range("A" & CStr(non + 1)).Value = "k"
                Else
                    ML.Sheets("GESAMT").Range("A" & CStr(non + 1)).Value = "v"
                End If
                ML.Sheets("GESAMT").Range("E" & CStr(non + 1)).Value = ThisWorkbook.Sheets("ItemView").Range("K" & CStr(rowind)).Value + ThisWorkbook.Sheets("ItemView").Range("L" & CStr(rowind)).Value
                ML.Sheets("GESAMT").Range("Q" & CStr(non + 1)).Value = ThisWorkbook.Sheets("ItemView").Range("J" & CStr(rowind)).Value
            End If
        Else 'Ez badago kodea MaterialListen amaieran sartu
            ML.Sheets("GESAMT").Rows(CStr(azkenLerroa) & ":" & CStr(azkenLerroa)).Select
            Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
            Range("D" & CStr(azkenLerroa + 1) & ":D" & CStr(azkenLerroa + 1)).Select
            Selection.Copy
            ML.Worksheets("GESAMT").Range("D" & CStr(azkenLerroa)).Select
            ML.Worksheets("GESAMT").PasteSpecial
            Range("R" & CStr(azkenLerroa + 1) & ":R" & CStr(azkenLerroa + 1)).Select
            Selection.Copy
            ML.Worksheets("GESAMT").Range("R" & CStr(azkenLerroa)).Select
            ML.Worksheets("GESAMT").PasteSpecial
            If (ThisWorkbook.Sheets("ItemView").Range("E" & CStr(rowind)).Value = "Miete") Then
                ML.Sheets("GESAMT").Range("A" & CStr(azkenLerroa)).Value = "v"
            ElseIf (ThisWorkbook.Sheets("ItemView").Range("E" & CStr(rowind)).Value = "Kauf") Then
                ML.Sheets("GESAMT").Range("A" & CStr(azkenLerroa)).Value = "k"
            Else
                ML.Sheets("GESAMT").Range("A" & CStr(azkenLerroa)).Value = " "
            End If
            ML.Sheets("GESAMT").Range("B" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("ItemView").Range("C" & CStr(rowind)).Value
            ML.Sheets("GESAMT").Range("E" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("ItemView").Range("K" & CStr(rowind)).Value + ThisWorkbook.Sheets("ItemView").Range("L" & CStr(rowind)).Value
            ML.Sheets("GESAMT").Range("O" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("ItemView").Range("D" & CStr(rowind)).Value
            ML.Sheets("GESAMT").Range("Q" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("ItemView").Range("J" & CStr(rowind)).Value
            'rutatemp = "http://campus/actividadnegocio/soporteproducto/Dibujos%203D/"
            ruta = "\\192.227.20.160\FotosProductos\Repcon\" & Range("C" & CStr(rowind)).Value & ".jpg"
            If fileExists(ruta) <> "" Then
                ML.Sheets("GESAMT").Hyperlinks.Add Anchor:=ML.Sheets("GESAMT").Range("S" & CStr(azkenLerroa)), Address:=ruta, TextToDisplay:="BILD"
                ML.Sheets("GESAMT").Range("S" & CStr(azkenLerroa)).Font.Size = 10
                ML.Sheets("GESAMT").Range("S" & CStr(azkenLerroa)).Font.Color = vbBlack
            End If
            azkenLerroa = azkenLerroa + 1
            ML.Sheets("GESAMT").Range("B21").Select
        End If
    Next
    'Menge Sum zutabean filtroa ipini hutsak kenduz, eta erabili gabeko takt zutabeak ezkutatu
    ML.Sheets("GESAMT").Range("A20:Ab3397").AutoFilter Field:=4, Criteria1:="<>"
    ML.Sheets("GESAMT").Range("F:N").EntireColumn.Hidden = True
    'fitxategia = Application.GetSaveAsFilename(InitialFileName:="Materialliste", fileFilter:="Excel Files (*.xlsm), *.xlsm")
    karpeta = Environ("temp")
    excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    fitxategia = karpeta & "\" & "Materialliste_" & excelizena
    If Not fitxategia = False Then
        Dim rev As Integer
        rev = 0
        Dim fileTemp As String
        fileTemp = fitxategia & ".xlsm"
        Do While (Not (Dir(fileTemp, vbDirectory) = vbNullString))
            rev = rev + 1
            fileTemp = fitxategia & "_" & rev & ".xslm"
        Loop
        ML.SaveAs fileTemp
    End If
End Sub

Sub ExportMLGermanyNew() 'aktualisiert: 11.07.2018 (Datei 17.5.18)
    Application.ScreenUpdating = False
    Dim inicio As Integer
    Dim fin As Integer
    Dim colInicio, colFin, colTemp, colRent, colSale As String
    Dim colinicioNum, colfinNum, kantitatea, biderkatzaileak As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    colInicio = Worksheets("Data").Range("ColumInicioLista").Value
    colFin = Worksheets("Data").Range("ColumFinLista").Value
    colinicioNum = Worksheets("Data").Range("NumColumInicioLista").Value
    colfinNum = Worksheets("Data").Range("NumColumFinLista").Value
    colRent = "H"
    colSale = "I"
    Dim ML As Workbook
    Set ML = Application.Workbooks.Open("c:\Ulma\Repcon_57\s26\data\doctemplates\Materialliste2018.xlsm")
    'ML.Windows.Application.WindowState = xlMinimized
    Dim fitxategia As Variant
    Dim lehenLerroa As Integer
    Dim azkenLerroa As Integer
    Dim azkenMat As Integer
    Dim i As Integer
    Dim rutatemp As String
    Dim ruta As String
    Dim excelizena As String
    Dim karpeta As String
    Dim del As String
    lehenLerroa = 21
    azkenLerroa = 3851
    azkenMat = azkenLerroa
    
    ' Tajo izen eta zenbaki banatzea
    Dim celdaValorTajo As String
    Dim TajoDes As String
    Dim TajoNum As String
     celdaValorTajo = ThisWorkbook.Sheets("BoM").Range("ID_Data_Tajo").Value
     TajoDes = celdaValorTajo
     TajoNum = celdaValorTajo
     On Error Resume Next
     TajoDes = Right(celdaValorTajo, (Len(celdaValorTajo) - Application.Find(" ", celdaValorTajo)))
     TajoNum = Left(celdaValorTajo, Application.Find(" ", celdaValorTajo) - 1)
     
     ' Materiallisteko goiburuko datuak bete gure excelean ditugun datuekin
     
    ML.Sheets("GESAMT").Range("D10").Value = separadorCodNom(ThisWorkbook.Sheets("BoM").Range("ID_Data_Cliente").Value, "//", False)
    ML.Sheets("GESAMT").Range("D12").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Direccion").Value & "," & ThisWorkbook.Sheets("BoM").Range("ID_Data_PoblacionCliente").Value
    ML.Sheets("GESAMT").Range("D14").Value = separadorCodNom(ThisWorkbook.Sheets("BoM").Range("ID_Data_Cliente").Value, "//", True)
    ML.Sheets("GESAMT").Range("D16").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_ObraGet").Value
    ML.Sheets("GESAMT").Range("R5").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_CodObra").Value
    ML.Sheets("GESAMT").Range("R4").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Fecha").Value
    'ML.Sheets("GESAMT").Range("R8").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Delegacion").Value
    del = ThisWorkbook.Sheets("BoM").Range("ID_Data_Delegacion").Value
    ML.Sheets("GESAMT").Range("R8").Value = Application.IfError(Left(Right(del, Len(del) - Application.IfError(Application.Find("-", del, Application.IfError(Application.Find("[", del), 0)), 0)), Len(Right(del, Len(del) - Application.IfError(Application.Find("-", del, Application.IfError(Application.Find("[", del), 0)), 0))) - 1), del)
    ML.Sheets("GESAMT").Range("R7").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Realizado").Value
    ML.Sheets("GESAMT").Range("D8").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Tarifa").Value
    ML.Sheets("GESAMT").Range("R6").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_CodContrato").Value
    ML.Sheets("GESAMT").Range("D17").Value = TajoDes
    ML.Sheets("GESAMT").Range("R10").Value = TajoNum
    ML.Sheets("GESAMT").Range("R11").Value = TajoDes
    ML.Sheets("GESAMT").Range("R12").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Lista").Value
    ML.Sheets("GESAMT").Range("R13").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_FechaINSum").Value
    ML.Sheets("GESAMT").Range("R14").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_FechaPRESum").Value
    
    'Gure exceleko lerro bakoitzeko begiratu badagoen Materiallisten
    'Hala bada sartu kantitatea
    'Ezezkoan sartu lerro bat amaieran kodigo eta kantitatearekin
    'Behin denak amaituta, ezabatu (filtroa) menge ez duten lineak
    
    Dim rowind As Integer
    Dim posizioa As Integer
    Dim konpBalioa As String
    ''''''''''''''''''
    'lerro bakoitzeko
    For rowind = inicio To fin
    'lortu MaterialListe barruan momentuko kodearen posizioa, baldin badago
        On Error GoTo x
        konpBalioa = ThisWorkbook.Sheets("BoM").Range("D" & CStr(rowind)).Value
        posizioa = Application.IfError(Application.Match(konpBalioa, Application.text(ML.Sheets("GESAMT").Range("B" & CStr(lehenLerroa), "B" & CStr(azkenMat)), "0000000"), 0), 0)
        GoTo cont
x:
        posizioa = 0
cont:
        'MaterialListen kodea baldin badago
        If posizioa > 0 Then
            Dim non As Integer
            non = posizioa + lehenLerroa - 1
            'Begiratu sartzera goazen kodea alokairu edo saltzeko den, eta Materiallisten modu berdinean doan, bestela beste lerro baten sartu
            If ((ThisWorkbook.Sheets("BoM").Range("F" & CStr(rowind)).Value = "Miete" And ML.Sheets("GESAMT").Range("A" & CStr(non)).Value = "v") Or (ThisWorkbook.Sheets("BoM").Range("F" & CStr(rowind)).Value = "Kauf" And ML.Sheets("GESAMT").Range("A" & CStr(non)).Value = "k")) Then
                kantitatea = 0
                biderkatzaileak = 0
'                For i = colinicioNum To colfinNum
'                    colTemp = ConvertToLetter(i)
'                    biderkatzaileak = ThisWorkbook.Sheets("BoM").Range(colTemp & inicio - 1).Value * ThisWorkbook.Sheets("BoM").Range(colTemp & inicio - 4).Value
'                    kantitatea = kantitatea + (ThisWorkbook.Sheets("BoM").Range(colTemp & CStr(rowind)).Value * biderkatzaileak)
'                Next
                kantitatea = ThisWorkbook.Sheets("BoM").Range(colRent & CStr(rowind)).Value + ThisWorkbook.Sheets("BoM").Range(colSale & CStr(rowind)).Value
                ML.Sheets("GESAMT").Range("E" & CStr(non)).Value = kantitatea + ML.Sheets("GESAMT").Range("E" & CStr(non)).Value 'kantitatea
                ML.Sheets("GESAMT").Range("Q" & CStr(non)).Value = ThisWorkbook.Sheets("BoM").Range("N" & CStr(rowind)).Value 'prezioa
                ML.Sheets("GESAMT").Range("Y" & CStr(non)).Value = ThisWorkbook.Sheets("BoM").Range("P" & CStr(rowind)).Value 'pisua
                ML.Sheets("GESAMT").Range("W" & CStr(non)).Value = ThisWorkbook.Sheets("BoM").Range("Q" & CStr(rowind)).Value 'area
'                ML.Sheets("GESAMT").Range("U" & CStr(non)).Value = ThisWorkbook.Sheets("BoM").Range("B" & CStr(rowind)).Value 'grupo
'                ML.Sheets("GESAMT").Range("V" & CStr(non)).Value = ThisWorkbook.Sheets("BoM").Range("C" & CStr(rowind)).Value 'subgrupo
            Else 'Suministro modu ezberdinean badoa, kode bereko beste lerro bat sartu azpian
                ML.Sheets("GESAMT").Range("A" & CStr(non) & ":AZ" & CStr(non)).Copy
                ML.Sheets("GESAMT").Rows(CStr(non + 1)).Insert xlShiftDown
                If (ML.Sheets("GESAMT").Range("A" & CStr(non)).Value = "v") Then
                    ML.Sheets("GESAMT").Range("A" & CStr(non + 1)).Value = "k"
                Else
                    ML.Sheets("GESAMT").Range("A" & CStr(non + 1)).Value = "v"
                End If
                kantitatea = 0
'                For i = colinicioNum To colfinNum
'                    colTemp = ConvertToLetter(i)
'                    biderkatzaileak = ThisWorkbook.Sheets("BoM").Range(colTemp & inicio - 1).Value * ThisWorkbook.Sheets("BoM").Range(colTemp & inicio - 4).Value
'                    kantitatea = kantitatea + (ThisWorkbook.Sheets("BoM").Range(colTemp & CStr(rowind)).Value * biderkatzaileak)
'                Next
                kantitatea = ThisWorkbook.Sheets("BoM").Range(colRent & CStr(rowind)).Value + ThisWorkbook.Sheets("BoM").Range(colSale & CStr(rowind)).Value
                ML.Sheets("GESAMT").Range("E" & CStr(non + 1)).Value = kantitatea 'kantitatea
                ML.Sheets("GESAMT").Range("Q" & CStr(non + 1)).Value = ThisWorkbook.Sheets("BoM").Range("N" & CStr(rowind)).Value
                ML.Sheets("GESAMT").Range("Y" & CStr(non + 1)).Value = ThisWorkbook.Sheets("BoM").Range("P" & CStr(rowind)).Value 'pisua
                ML.Sheets("GESAMT").Range("W" & CStr(non + 1)).Value = ThisWorkbook.Sheets("BoM").Range("Q" & CStr(rowind)).Value 'area
                ML.Sheets("GESAMT").Range("U" & CStr(non + 1)).Value = ThisWorkbook.Sheets("BoM").Range("B" & CStr(rowind)).Value 'grupo
                ML.Sheets("GESAMT").Range("V" & CStr(non + 1)).Value = ThisWorkbook.Sheets("BoM").Range("C" & CStr(rowind)).Value 'subgrupo
            End If
        Else 'Ez badago kodea MaterialListen amaieran sartu
            ML.Sheets("GESAMT").Rows(CStr(azkenLerroa)).Select
            Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
            Range("D" & CStr(azkenLerroa + 1) & ":D" & CStr(azkenLerroa + 1)).Select
            Selection.Copy
            ML.Worksheets("GESAMT").Range("D" & CStr(azkenLerroa)).Select
            ML.Worksheets("GESAMT").PasteSpecial
            Range("R" & CStr(azkenLerroa + 1) & ":R" & CStr(azkenLerroa + 1)).Select
            Selection.Copy
            ML.Worksheets("GESAMT").Range("R" & CStr(azkenLerroa)).Select
            ML.Worksheets("GESAMT").PasteSpecial
            Range("X" & CStr(azkenLerroa + 1) & ":X" & CStr(azkenLerroa + 1)).Select
            Selection.Copy
            ML.Worksheets("GESAMT").Range("X" & CStr(azkenLerroa)).Select
            ML.Worksheets("GESAMT").PasteSpecial
            Range("Z" & CStr(azkenLerroa + 1) & ":Z" & CStr(azkenLerroa + 1)).Select
            Selection.Copy
            ML.Worksheets("GESAMT").Range("Z" & CStr(azkenLerroa)).Select
            ML.Worksheets("GESAMT").PasteSpecial
            If (ThisWorkbook.Sheets("BoM").Range("E" & CStr(rowind)).Value = "Miete") Then
                ML.Sheets("GESAMT").Range("A" & CStr(azkenLerroa)).Value = "v"
            ElseIf (ThisWorkbook.Sheets("BoM").Range("E" & CStr(rowind)).Value = "Kauf") Then
                ML.Sheets("GESAMT").Range("A" & CStr(azkenLerroa)).Value = "k"
            Else
                ML.Sheets("GESAMT").Range("A" & CStr(azkenLerroa)).Value = "v"
            End If
            kantitatea = 0
            biderkatzaileak = 0
'            For i = colinicioNum To colfinNum
'                colTemp = ConvertToLetter(i)
'                biderkatzaileak = ThisWorkbook.Sheets("BoM").Range(colTemp & inicio - 1).Value * ThisWorkbook.Sheets("BoM").Range(colTemp & inicio - 4).Value
'                kantitatea = kantitatea + (ThisWorkbook.Sheets("BoM").Range(colTemp & CStr(rowind)).Value * biderkatzaileak)
'            Next
            kantitatea = ThisWorkbook.Sheets("BoM").Range(colRent & CStr(rowind)).Value + ThisWorkbook.Sheets("BoM").Range(colSale & CStr(rowind)).Value
            ML.Sheets("GESAMT").Range("B" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("BoM").Range("D" & CStr(rowind)).Value 'kodea
            ML.Sheets("GESAMT").Range("E" & CStr(azkenLerroa)).Value = kantitatea 'kantitatea
            ML.Sheets("GESAMT").Range("O" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("BoM").Range("E" & CStr(rowind)).Value 'deskripzioa
            ML.Sheets("GESAMT").Range("Q" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("BoM").Range("N" & CStr(rowind)).Value 'prezioa
            ML.Sheets("GESAMT").Range("Y" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("BoM").Range("P" & CStr(rowind)).Value 'pisua
            ML.Sheets("GESAMT").Range("W" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("BoM").Range("Q" & CStr(rowind)).Value 'area
            ML.Sheets("GESAMT").Range("U" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("BoM").Range("B" & CStr(rowind)).Value 'grupo
            ML.Sheets("GESAMT").Range("V" & CStr(azkenLerroa)).Value = ThisWorkbook.Sheets("BoM").Range("C" & CStr(rowind)).Value 'subgrupo
            'rutatemp = "http://campus/actividadnegocio/soporteproducto/Dibujos%203D/"
            ruta = "\\192.227.20.160\FotosProductos\Repcon\" & Range("C" & CStr(rowind)).Value & ".jpg"
            If fileExists(ruta) <> "" Then
                ML.Sheets("GESAMT").Hyperlinks.Add Anchor:=ML.Sheets("GESAMT").Range("S" & CStr(azkenLerroa)), Address:=ruta, TextToDisplay:="BILD"
                ML.Sheets("GESAMT").Range("S" & CStr(azkenLerroa)).Font.Size = 10
                ML.Sheets("GESAMT").Range("S" & CStr(azkenLerroa)).Font.Color = vbBlack
            End If
            azkenLerroa = azkenLerroa + 1
            ML.Sheets("GESAMT").Range("B21").Select
        End If
    Next
    'Menge Sum zutabean filtroa ipini hutsak kenduz, eta erabili gabeko takt zutabeak ezkutatu
    ML.Sheets("GESAMT").Range("A20:AB" & azkenLerroa + 2).AutoFilter Field:=3, Criteria1:="<>"
    ML.Sheets("GESAMT").Range("F:N").EntireColumn.Hidden = True
    'fitxategia = Application.GetSaveAsFilename(InitialFileName:="Materialliste", fileFilter:="Excel Files (*.xlsm), *.xlsm")
    karpeta = Environ("temp")
    excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    fitxategia = karpeta & "\" & "Materialliste_" & excelizena
    If Not fitxategia = False Then
        Dim rev As Integer
        rev = 0
        Dim fileTemp As String
        fileTemp = fitxategia & ".xlsm"
        Do While (Not (Dir(fileTemp, vbDirectory) = vbNullString))
            rev = rev + 1
            fileTemp = fitxategia & "_" & rev & ".xslm"
        Loop
        ML.SaveAs fileTemp
    End If
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "M6_Ordenacion"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     ORDENATU: KODE EDO IZENA
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'Stock-a dagoenean, zutabe hau ordenatzen ez zela ikusi eta gero eginiko aldaketak.
'columna: ordenatu nahi den zutabe zenbakia (1=C)
Sub ordenarFilas(ByVal columna As Integer)
  Application.Interactive = False
  Dim inicio As Integer
  inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
  Dim fin As Integer
  fin = Worksheets("Data").Range("FilaFinArticulos").Value
  Dim orden As Integer
  orden = 1
  If (Sheets("Data").Range("id_OrientacionOrden" & columna).Value = 1) Then
    orden = 1
    Sheets("Data").Range("id_OrientacionOrden" & columna).Value = 2
  ElseIf (Sheets("Data").Range("id_OrientacionOrden" & columna).Value = 2) Then
    orden = 2
    Sheets("Data").Range("id_OrientacionOrden" & columna).Value = 1
  End If
  Sheets("BoM").Unprotect
  egoera1 = Application.ScreenUpdating
  egoera2 = Application.EnableEvents
  Application.ScreenUpdating = False
  Application.EnableEvents = False
  Dim Col As Integer
  Col = columna + 3 ' zutabe bat gehiago, PRO adierazteko B zutabea erabiltzen hasi bait gara.
  Dim colFin As Integer 'FIN zutabea zein den jakiteko, ordenatzean aldagai hau erabiltzen da DATAtik hartu beharrean, zutabea tokiz aldatu denez, BoM zerrenden azken zutabearen kalkulua ere mugitzen baita (NumColumFinLista)
  colFin = Sheets("Data").Range("NumColumFinLista").Value
  Sheets("BoM").Range("A" & (inicio - 1) & ":" & ConvertToLetter(colFin) & fin).Sort _
    Key1:=Sheets("BoM").Range("A" & (inicio - 1) & ":" & ConvertToLetter(colFin) & fin).Columns(Col), _
    header:=xlYes, _
    Order1:=orden, _
    MatchCase:=False, _
    SortMethod:=xlPinYin
  Application.ScreenUpdating = egoera1
  Application.EnableEvents = egoera2
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
  Application.Interactive = True
End Sub

Sub ord()
    ordenarFilas 1
End Sub



Attribute VB_Name = "M7_Importar"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     IMPORT TARIFAK
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Sub KargatuOrriak(ByVal zein As Integer)
    Dim app As Object
    Dim ML As Object
    Set app = CreateObject("Excel.Application")
    app.EnableEvents = False
    app.ScreenUpdating = False
    If zein = 1 Then
        Set ML = app.Workbooks.Add(importarPreciosForm.txtExcel)
    ElseIf zein = 2 Then
        Set ML = app.Workbooks.Add(importarDenominacionesForm.txtExcel)
    End If
    For i = 1 To ML.Sheets.Count
        If zein = 1 Then
            importarPreciosForm.ComboBox1.AddItem ML.Sheets(i).Name
        ElseIf zein = 2 Then
            importarDenominacionesForm.ComboBox1.AddItem ML.Sheets(i).Name
        End If
    Next
    If zein = 1 Then
        importarPreciosForm.ComboBox1.ListIndex = 0
    ElseIf zein = 2 Then
        importarDenominacionesForm.ComboBox1.ListIndex = 0
    End If
    ML.Close False
    app.EnableEvents = True
    app.ScreenUpdating = True
    app.Quit
    Set app = Nothing
End Sub

Sub hustuImportForm(ByVal zein As Integer)
If zein = 1 Then
    importarPreciosForm.Hide
    importarPreciosForm.txtExcel = ""
    importarPreciosForm.ComboBox1.Clear
    importarPreciosForm.txtColCod = ""
    importarPreciosForm.txtColPre = ""
    importarPreciosForm.txtFila = ""
    importarPreciosForm.txtNomPre = ""
ElseIf zein = 2 Then
    importarDenominacionesForm.Hide
    importarDenominacionesForm.txtExcel = ""
    importarDenominacionesForm.ComboBox1.Clear
    importarDenominacionesForm.txtColCod = ""
    importarDenominacionesForm.txtColDen = ""
    importarDenominacionesForm.txtFila = ""
End If
End Sub

Function IsLetter(strValue As String) As Boolean
    Dim intPos As Integer
    For intPos = 1 To Len(strValue)
        Select Case Asc(Mid(strValue, intPos, 1))
            Case 65 To 90, 97 To 122
                IsLetter = True
            Case Else
                IsLetter = False
                Exit For
        End Select
    Next
End Function

Sub importarPrecios(ByVal tipoTarifa As String)
    Dim app As Object
    Dim ML As Object
    GoTo hasi
errorea:
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    If Not app Is Nothing Then
        ML.Close False
        Set ML = Nothing
        app.EnableEvents = True
        app.ScreenUpdating = True
        app.Quit
        Set app = Nothing
    End If
    MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError1").Value, vbCritical, "Unhandled Error"
    importarPreciosForm.Show
    Exit Sub
hasi:
    On Error GoTo errorea
    'Eventak gelditu hau exekutatzeko
    Application.EnableEvents = False
    'Ez eguneratu pantaila azkarrago exekutatu dadin dena
    Application.ScreenUpdating = False
  ''''Zabaldu excela
  ''''Topau kodigo eta preziuak
    Set app = CreateObject("Excel.Application")
    app.EnableEvents = False
    app.ScreenUpdating = False
    Set ML = app.Workbooks.Add(importarPreciosForm.txtExcel)
    
    Dim orria As String
    orria = importarPreciosForm.ComboBox1.Value
    Dim fila As Integer
    Dim inicioPrec As Integer
    Dim finPrec As Integer
    inicioPrec = importarPreciosForm.txtFila
    Dim CodZut As String
    Dim PrezioZut As String
    CodZut = importarPreciosForm.txtColCod
    PrezioZut = importarPreciosForm.txtColPre
    Dim PrezioIzena As String
    PrezioIzena = importarPreciosForm.txtNomPre
    finPrec = ML.Sheets(orria).Cells(ML.Sheets(orria).Rows.Count, CodZut).End(xlUp).row
    
  ''''Topau gure exceleko kodigo eta preziuak
  Dim inicio As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
        
  Dim fin As Integer
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    
  Dim gurePrezioZut As String
  If (tipoTarifa = "Alquiler") Then
    gurePrezioZut = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("B10").Value) - 4)
  Else
    gurePrezioZut = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("B10").Value) - 2)
  End If
  Dim gureCodZut As String
  gureCodZut = Sheets("Data").Range("B16").Value
  
  ''''Gure exceleko lerro bakoitzeko, buscarv zabalduta excelian eta preziua ipini
  'Dim prezioZerrenda As Range
  'Set prezioZerrenda = ML.Sheets(orria).Range(CodZut & inicioPrec & ":" & CodZut & finPrec)
  'AldatuTestura prezioZerrenda
  For i = inicio To fin
    If (Application.IfError(Application.Match(Sheets("BoM").Range(gureCodZut & i).Value, Application.text(ML.Sheets(orria).Range(CodZut & inicioPrec & ":" & CodZut & finPrec), "0000000"), 0), -1) <> -1) Then
        Sheets("BoM").Range(gurePrezioZut & i).Value = Application.Index(ML.Sheets(orria).Range(PrezioZut & inicioPrec & ":" & PrezioZut & finPrec), Application.Match(Sheets("BoM").Range(gureCodZut & i).Value, Application.text(ML.Sheets(orria).Range(CodZut & inicioPrec & ":" & CodZut & finPrec), "0000000"), 0))
    Else
        Sheets("BoM").Range(gurePrezioZut & i).Value = 0
    End If
  Next
  ''''Tarifa kasillara eraman lista berrixan izena
  If (tipoTarifa = "Alquiler") Then
    Sheets("BoM").Range("ID_Data_Tarifa").Value = PrezioIzena
  Else
    Sheets("BoM").Range("ID_Data_TarifaVenta").Value = PrezioIzena
  End If
  'Leheneratu balioak
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    ML.Close False
    app.Quit
    Set ML = Nothing
    app.EnableEvents = True
    app.ScreenUpdating = True
    Set app = Nothing
End Sub
Sub importarDenominaciones()
    Dim app As Object
    Dim ML As Object
    GoTo hasi
errorea:
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    If Not app Is Nothing Then
        ML.Close False
        app.Quit
        Set ML = Nothing
        app.EnableEvents = True
        app.ScreenUpdating = True
        Set app = Nothing
    End If
    MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError1").Value, vbCritical, "Unhandled Error"
    importarDenominacionesForm.Show
    Exit Sub
hasi:
   ' On Error GoTo errorea
    'Eventak gelditu hau exekutatzeko
    Application.EnableEvents = False
    'Ez eguneratu pantaila azkarrago exekutatu dadin dena
    Application.ScreenUpdating = False
    ThisWorkbook.Worksheets("BoM").Unprotect
    'datuak jaso
    
    Dim orria As String
    Dim fila As Integer
    Dim CodZut As String
    
    Set app = CreateObject("Excel.Application")
    app.EnableEvents = False
    app.ScreenUpdating = False
    
    
    
  
        txtExcel = importarDenominacionesForm.txtExcel
        Set ML = app.Workbooks.Add(txtExcel)
        Combo1 = importarDenominacionesForm.ComboBox1.Value
        orria = Combo1
        inicioML = importarDenominacionesForm.txtFila
        CodZut = importarDenominacionesForm.txtColCod
        DenZut = importarDenominacionesForm.txtColDen

    

    finML = ML.Sheets(orria).Cells(ML.Sheets(orria).Rows.Count, CodZut).End(xlUp).row
    
    
  ''''Topau gure exceleko kodigo eta preziuak/Stocka
  Dim inicio As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
        
  Dim fin As Integer
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    
  Dim gureImportZut As String

        gureImportZut = "E"

  Dim gureCodZut As String
  gureCodZut = "D"
  
  ''''Gure exceleko lerro bakoitzeko, buscarv zabalduta excelian eta preziua ipini
  'Dim prezioZerrenda As Range
  'Set prezioZerrenda = ML.Sheets(orria).Range(CodZut & inicioPrec & ":" & CodZut & finPrec)
  'AldatuTestura prezioZerrenda
  For i = inicio To fin
    If (Application.IfError(Application.Match(Sheets("BoM").Range(gureCodZut & i).Value, Application.text(ML.Sheets(orria).Range(CodZut & inicioML & ":" & CodZut & finML), "0000000"), 0), -1) <> -1) Then
        Sheets("BoM").Range(gureImportZut & i).Value = Application.Index(ML.Sheets(orria).Range(DenZut & inicioML & ":" & DenZut & finML), Application.Match(Sheets("BoM").Range(gureCodZut & i).Value, Application.text(ML.Sheets(orria).Range(CodZut & inicioML & ":" & CodZut & finML), "0000000"), 0))
    Else
        Sheets("BoM").Range(gureImportZut & i).Value = Sheets("Languages").Range("ID_MaterialDesconocido").Value
    End If
  Next
  
  'Leheneratu balioak
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    ML.Close False
    app.EnableEvents = True
    app.ScreenUpdating = True
    app.Quit
    Set app = Nothing
    unpushedDescButtons
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True
End Sub

Sub zabalduExcela(ByVal zein As Integer)
    Dim app As Object
    Dim ML As Object
    Set app = CreateObject("Excel.Application")
    app.EnableEvents = False
    app.ScreenUpdating = False
    If zein = 1 Then
        izena = importarPreciosForm.txtExcel
    ElseIf zein = 2 Then
        izena = importarDenominacionesForm.txtExcel
    End If
    If (izena <> "") Then
        Set ML = app.Workbooks.Add(izena)
        app.Visible = True
    End If
    app.EnableEvents = True
    app.ScreenUpdating = True
End Sub

'deprecated Application.Text funtzioarekin ordezkatua
Sub AldatuTestura(ByVal prezioZerrenda As Range)
    For i = 1 To prezioZerrenda.Count
        Application.Trim (prezioZerrenda(i).Value)
        If (Not (prezioZerrenda(i).PrefixCharacter = "'")) Then
            prezioZerrenda(i).Value = "'" & prezioZerrenda(i).Value
        End If
    Next
End Sub

Sub importarBaan(ByVal zein As Integer, ByVal tipoTarifa As String, ByVal hoja As String)
    Dim app As Object
    Dim ML As Object
    GoTo hasi
errorea:
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    If Not app Is Nothing Then
        ML.Close False
        app.Quit
        Set ML = Nothing
        app.EnableEvents = True
        app.ScreenUpdating = True
        Set app = Nothing
    End If
    MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError1").Value, vbCritical, "Unhandled Error"
    If zein = 1 Then
        importarPreciosForm.Show
    Else
        'importarStockForm.Show
    End If
    Exit Sub
hasi:
    On Error GoTo errorea
    'Eventak gelditu hau exekutatzeko
    Application.EnableEvents = False
    'Ez eguneratu pantaila azkarrago exekutatu dadin dena
    Application.ScreenUpdating = False
    'datuak jaso
    If zein = 1 Then
        txtExcel = importarPreciosForm.txtExcel
        Combo1 = importarPreciosForm.ComboBox1.Value
        txtFila = importarPreciosForm.txtFila
        txtColCod = importarPreciosForm.txtColCod
        txtColPre = importarPreciosForm.txtColPre
        txtNomPre = importarPreciosForm.txtNomPre
    ElseIf zein = 0 Then
'        txtExcel = importarStockForm.txtExcel
'        Combo1 = importarStockForm.ComboBox1.Value
'        txtFila = importarStockForm.txtFila
'        txtColCod = importarStockForm.txtColCod
'        txtColPre = importarStockForm.txtColPre
'        txtNomPre = importarStockForm.txtNomPre
    End If
    
    
  ''''Zabaldu excela
  ''''Topau kodigo eta preziuak

    Set app = CreateObject("Excel.Application")
    app.EnableEvents = False
    app.ScreenUpdating = False
    Set ML = app.Workbooks.Add(txtExcel)
    
    Dim orria As String
    orria = Combo1
    Dim fila As Integer
    Dim inicioPrec As Integer
    Dim finPrec As Integer
    inicioPrec = txtFila
    Dim CodZut As String
    Dim PrezioZut As String
    CodZut = txtColCod
    PrezioZut = txtColPre
    Dim PrezioIzena As String
    PrezioIzena = txtNomPre
    finPrec = ML.Sheets(orria).Cells(ML.Sheets(orria).Rows.Count, CodZut).End(xlUp).row
    
  ''''Topau gure exceleko kodigo eta preziuak/Stocka
  Dim inicio As Integer
    inicio = 14
        
  Dim fin As Integer
    fin = 151
    
  Dim gureImportZut As String
  Dim gureCodZut As String
  gureCodZut = "A"
  If zein = 1 Then
    If (tipoTarifa = "Alquiler") Then
        gureImportZut = "E"
    Else
        gureImportZut = "D"
    End If
  ElseIf zein = 0 Then
    gureImportZut = Sheets("Data").Range("B18").Value
  End If
  
  

  
  ''''Gure exceleko lerro bakoitzeko, buscarv zabalduta excelian eta preziua ipini
  'Dim prezioZerrenda As Range
  'Set prezioZerrenda = ML.Sheets(orria).Range(CodZut & inicioPrec & ":" & CodZut & finPrec)
  'AldatuTestura prezioZerrenda
  For i = inicio To fin
    If (Application.IfError(Application.Match(Sheets(hoja).Range(gureCodZut & i).Value, Application.text(ML.Sheets(orria).Range(CodZut & inicioPrec & ":" & CodZut & finPrec), "0000000"), 0), -1) <> -1) Then
        Sheets(hoja).Range(gureImportZut & i).Value = Application.Index(ML.Sheets(orria).Range(PrezioZut & inicioPrec & ":" & PrezioZut & finPrec), Application.Match(Sheets(hoja).Range(gureCodZut & i).Value, Application.text(ML.Sheets(orria).Range(CodZut & inicioPrec & ":" & CodZut & finPrec), "0000000"), 0))
    Else
        If Sheets(hoja).Range(gureCodZut & i).Value = "" Then
            Sheets(hoja).Range(gureImportZut & i).Value = ""
        Else
            Sheets(hoja).Range(gureImportZut & i).Value = 0
        End If
    End If
  Next
'  If zein = 1 Then
'    ''''Tarifa kasillara eraman lista berrixan izena
'    Sheets("BoM").Range("J11").Value = PrezioIzena
'  ElseIf zein = 0 Then
'    Sheets("Data").Range("nombre_stock").Value = PrezioIzena
'  End If
  'Leheneratu balioak
    Application.EnableEvents = True
    Application.ScreenUpdating = True
    ML.Close False
    app.EnableEvents = True
    app.ScreenUpdating = True
    app.Quit
    Set app = Nothing
End Sub

Attribute VB_Name = "M8_Usa"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     USA EXPORT
'' EXTRA PALETAK, ETAB....
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Public actualizandoPalet As String

Sub simple_release()
    
Dim xlsObj As Object
   Dim ML As Object
   
   Set xlsObj = CreateObject("Excel.Application")
   xlsObj.ScreenUpdating = False
    
    Dim inicio As Integer
    inicio = Worksheets("Data").Range("ID_ini").Value
    Dim fin As Integer
    fin = Worksheets("Data").Range("ID_FinalItemview").Value

Application.ScreenUpdating = False
SEED_FILE = "C:\Ulma\Repcon_57\s26\data\doctemplates\RELEASE_TEMPLATE_current.xlsm"
COLPRECIOS = Sheets("Data").Range("B13")
COLPESOS = Sheets("Data").Range("B14")
COLSUPERFICIE = Sheets("Data").Range("B15")

    Set ML = xlsObj.Workbooks.Open(SEED_FILE)
        
'RELEASE_EXPORT

x = ThisWorkbook.Name
ActiveSheet.Unprotect
ML.Sheets("Material List").Range("B3") = ReleaseForm.txt_JobNumber.Value '' Job Number - Study Number
ML.Sheets("Material List").Range("B4") = ReleaseForm.txt_Salesman.Value '' Salesman
ML.Sheets("Material List").Range("B5") = ReleaseForm.txt_Customer.Value '' Customer - Customer
ML.Sheets("Material List").Range("B6") = ReleaseForm.txt_Project.Value '' Project - Jobsite
ML.Sheets("Material List").Range("B7") = ReleaseForm.txt_Area.Value '' Area - Unit
ML.Sheets("Material List").Range("B8") = ReleaseForm.txt_Notes.Value '' Notes - List

ML.Sheets("Material List").Range("E3") = ReleaseForm.txt_ShipDate.Value ''Ship Date - Delivery Date
ML.Sheets("Material List").Range("E4") = ReleaseForm.txt_EnteredBy.Value '' Entered By - Done By
ML.Sheets("Material List").Range("E5") = ReleaseForm.txt_EntryDate.Value ''Entry Date - Date
ML.Sheets("Material List").Range("E6") = ReleaseForm.txt_Family.Value ''Family


ML.Sheets("Material List").Range("J4") = ReleaseForm.txt_Hours.Value ''Hours
ML.Sheets("Material List").Range("J5") = ReleaseForm.txt_JobsiteCode.Value ''Jobsite Code
ML.Sheets("Material List").Range("J6") = ReleaseForm.txt_JobsiteContact.Value ''Jobsite Contact
ML.Sheets("Material List").Range("J7") = ReleaseForm.txt_ContactPhone.Value ''Contact Phone
ML.Sheets("Material List").Range("J8") = ReleaseForm.txt_JobsiteAddress.Value ''Jobsite Address

ML.Sheets("Material List").Range("K25") = ReleaseForm.txt_ListPrice.Value '' List Price - Price List




ML.Sheets("Material List").Range("O4") = Application.UserName
ML.Sheets("Material List").Range("O5") = Date
ML.Sheets("Material List").Range("P5") = Time
ML.Sheets("Material List").Range("F26") = Workbooks(x).Worksheets("ItemView").Range("N12") & " - " & Workbooks(x).Worksheets("ItemView").Range("N13")


'''''''''''''''''''''''''''''''''''''''''''''''''''
' if we are including an engineering package
If (ReleaseForm.chb_Package.Value = True) Then
    ML.Sheets("Material List").Cells(22, 1) = "WITH ENGINEERING"
    ML.Sheets("Material List").Cells(23, 1) = "PACKAGE"
    ML.Sheets("Material List").Range("A22:A23").Font.Bold = True
    ML.Sheets("Material List").Range("A22:A23").Font.Size = 11
    ML.Sheets("Material List").Range("A22:A23").HorizontalAlignment = xlLeft
    ML.Sheets("Material List").Range("A22:A23").VerticalAlignment = xlBottom
    ML.Sheets("Material List").Range("A22:A23").WrapText = False
    ML.Sheets("Material List").Range("A22:A23").Orientation = 0
    ML.Sheets("Material List").Range("A22:A23").AddIndent = False
    ML.Sheets("Material List").Range("A22:A23").IndentLevel = 0
    ML.Sheets("Material List").Range("A22:A23").ShrinkToFit = False
    ML.Sheets("Material List").Range("A22:A23").ReadingOrder = xlContext
    ML.Sheets("Material List").Range("A22:A23").MergeCells = False
End If
''''''''''''''''''''''''''''''''''''''''''''
PRECIOREPCON = Workbooks(x).Worksheets("ItemView").Range("F22").Value
PESOREPCON = Workbooks(x).Worksheets("ItemView").Range("E22").Value + 520 '4 metal baskets
AREAREPCON = WorksheetFunction.Sum(Workbooks(x).Worksheets("Summary").Range("H" & Workbooks(x).Worksheets("Data").Range("FilaInicioResumen"), "H" & Workbooks(x).Worksheets("Data").Range("FilaFinResumen")))
Dim PRECIOTOTALREPCON As Double
Dim PESOTOTALREPCON As Double
Dim AREATOTALREPCON As Double
PRECIOTOTALREPCON = PRECIOREPCON
PESOTOTALREPCON = PESOREPCON
AREATOTALREPCON = AREAREPCON




'Bete datuak
ML.Activate
Dim releaseRow As Integer
releaseRow = 13
For i = inicio To fin
'Workbooks(SEED_FILE).Activate
  If ((Workbooks(x).Worksheets("ItemView").Cells(i, 11) + Workbooks(x).Worksheets("ItemView").Cells(i, 12)) > 0) Then
    ML.Sheets("Material List").Range("A" & releaseRow & ":O" & releaseRow).EntireRow.Insert Shift:=xlUp
    ML.Sheets("Material List").Range("A" & (releaseRow - 1) & ":O" & (releaseRow - 1)).AutoFill destination:=ML.Sheets("Material List").Range("A" & (releaseRow - 1) & ":O" & releaseRow), Type:=xlFillDefault
    ML.Sheets("Material List").Range("A" & releaseRow) = Workbooks(x).Worksheets("ItemView").Cells(i, 3) 'Codigo
    ML.Sheets("Material List").Range("B" & releaseRow) = Workbooks(x).Worksheets("ItemView").Cells(i, 4) ' Descripcion
    ML.Sheets("Material List").Range("E" & releaseRow) = Workbooks(x).Worksheets("ItemView").Cells(i, 11) + Workbooks(x).Worksheets("ItemView").Cells(i, 12) ' Cantidad
    If (Workbooks(x).Worksheets("ItemView").Cells(i, 5).Value = "Rental") Then
        ML.Sheets("Material List").Range("H" & releaseRow) = "R" 'Modo suministro
    ElseIf (Workbooks(x).Worksheets("ItemView").Cells(i, 5).Value = "Sale") Then
        ML.Sheets("Material List").Range("H" & releaseRow) = "S" 'Modo suministro
    Else
        ML.Sheets("Material List").Range("H" & releaseRow) = "R" 'Modo suministro
    End If
    ML.Sheets("Material List").Range("J" & releaseRow) = Workbooks(x).Worksheets("ItemView").Cells(i, 6) 'Peso unitario
    ML.Sheets("Material List").Range("L" & releaseRow) = Workbooks(x).Worksheets("ItemView").Cells(i, 7) 'Superficie
    ML.Sheets("Material List").Range("N" & releaseRow) = Workbooks(x).Worksheets("ItemView").Cells(i, 10) 'Precio unitario
    releaseRow = releaseRow + 1
  Else
    PRECIOREPCON = Application.IfError(PRECIOREPCON - ((Workbooks(x).Worksheets("ItemView").Cells(i, 11) + Workbooks(x).Worksheets("ItemView").Cells(i, 12)) * Workbooks(x).Worksheets("ItemView").Cells(i, 10)), PRECIOREPCON)
    PESOREPCON = Application.IfError(PESOREPCON - ((Workbooks(x).Worksheets("ItemView").Cells(i, 11) + Workbooks(x).Worksheets("ItemView").Cells(i, 12)) * Workbooks(x).Worksheets("ItemView").Cells(i, 6)), PESOREPCON)
    AREAREPCON = Application.IfError(AREAREPCON - ((Workbooks(x).Worksheets("ItemView").Cells(i, 11) + Workbooks(x).Worksheets("ItemView").Cells(i, 12)) * Workbooks(x).Worksheets("ItemView").Cells(i, 7)), AREAREPCON)
  End If
Next

If (PRECIOREPCON <> PRECIOTOTALREPCON Or PESOREPCON <> PESOTOTALREPCON Or AREAREPCON <> AREATOTALREPCON) Then
    MsgBox "Only positive values are transferred to the Release template"
End If

'Double Check:
' Repcon Weight = Release Weight
' Repcon Price = Release Price
' Material boxes added to Repcon's weight


PESORELEASE = ML.Sheets("Material List").Range("TOTAL_WEIGHT").Value
PRECIORELEASE = ML.Sheets("Material List").Range("SALE_TOTAL_VALUE").Value + ML.Sheets("Material List").Range("TOTAL_RENT_VALUE").Value
AREARELEASE = ML.Sheets("Material List").Range("TOTAL_AREA").Value


MENSAJE = ""
If (Application.Round(PRECIOREPCON, 2) <> Application.Round(PRECIORELEASE, 2)) Then
    MENSAJE = MENSAJE & " Different price between Repcon (" & PRECIOREPCON & ") and Release (" & PRECIORELEASE & ")" & vbCrLf
End If
If (Application.Round(PESOREPCON, 2) <> Application.Round(PESORELEASE, 2)) Then
    MENSAJE = MENSAJE & " Different weight between Repcon (" & PESOREPCON & ")(w/ Metal Baskets) and Release (" & PESORELEASE & ")" & vbCrLf
    End If
If (Application.Round(AREAREPCON, 2) <> Application.Round(AREARELEASE, 2)) Then
    MENSAJE = MENSAJE & " Different area between Repcon (" & AREAREPCON & ") and Release (" & AREARELEASE & ")"
End If
If MENSAJE <> "" Then
    MsgBox MENSAJE
End If

''''''''''''''''''''''''''''''''''''''''

 'ActiveSheet.Protect AllowFiltering:=True
 ActiveSheet.Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True

ML.Sheets("Material List").Activate
ML.Sheets("Material List").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True

Application.ScreenUpdating = True

'Gorde
karpeta = Environ("temp")
excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
fitxategia = karpeta & "\" & "RELEASE_" & excelizena
    If Not fitxategia = False Then
        Dim rev As Integer
        rev = 0
        Dim fileTemp As String
        fileTemp = fitxategia & ".xlsm"
        Do While (Not (Dir(fileTemp, vbDirectory) = vbNullString))
            rev = rev + 1
            fileTemp = fitxategia & "_" & rev & ".xslm"
        Loop
        ML.SaveAs fileTemp
    End If
xlsObj.Visible = True
xlsObj.ScreenUpdating = True
ShowXLOnTop xlsObj, True
ShowXLOnTop xlsObj, False
Set xlsObj = Nothing

End Sub



Sub ezabatuFreightUnion()
 Sheets("ItemView").Range("M12:O13").Value = ""
 Sheets("ItemView").Range("Q13:Q13").Copy
 Sheets("ItemView").Range("M12:O13").PasteSpecial (xlPasteFormats)
End Sub

Sub kalkulatuPaletE1()
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim artikuluak20PaletE1(9) As String
    artikuluak20PaletE1(0) = "2220010"
    artikuluak20PaletE1(1) = "U222003"
    artikuluak20PaletE1(2) = "2220020"
    artikuluak20PaletE1(3) = "2220030"
    artikuluak20PaletE1(4) = "2220040"
    Dim artikuluak36PaletE1(9) As String
    artikuluak36PaletE1(0) = "U784005"
    artikuluak36PaletE1(3) = "2200000"
    artikuluak36PaletE1(4) = "2200068"
    artikuluak36PaletE1(5) = "2200012"
    artikuluak36PaletE1(6) = "2200057"
    artikuluak36PaletE1(7) = "2200023"
    artikuluak36PaletE1(8) = "2200033"
    
    Dim inicio As Integer
    Dim fin As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    
    Dim total20 As Long
    Dim total36 As Integer
    total20 = 0
    total36 = 0
    Dim zestoiak As Integer
    zestoiak = 0
    Dim PaletKodea As String
    PaletKodea = 1800000
    Dim PaletLerroa As Integer
    PaletLerroa = 0
    
    For i = inicio To fin
       If (IsInArray("$" & Sheets("BoM").Range("D" & i).Value & "$", artikuluak20PaletE1)) Then
            total20 = total20 + Sheets("BoM").Range("H" & i).Value + Sheets("BoM").Range("I" & i).Value
       End If
       If (IsInArray("$" & Sheets("BoM").Range("D" & i).Value & "$", artikuluak36PaletE1)) Then
            total36 = total36 + Sheets("BoM").Range("H" & i).Value + Sheets("BoM").Range("I" & i).Value
       End If
       If (Sheets("BoM").Range("D" & i).Value = PaletKodea) Then
            PaletLerroa = i
       End If
    Next
    If (total20 > 0 Or total36 > 0) Then
        zestoiak = WorksheetFunction.RoundUp(total20 / 20 + total36 / 36, 0)
        'Sartu linea zestoiarekin
        sartuZestoiak zestoiak, PaletLerroa
    End If
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2

End Sub




Sub sartuZestoiak(ByVal kant As String, ByVal lerroa As Integer)
    Application.ScreenUpdating = False
    Dim protejidu As Boolean
    protejidu = False
    If Sheets("BoM").ProtectContents Then
        Sheets("BoM").Unprotect
        protejidu = True
    End If
    actualizandoPalet = "X"
    Dim Zestoia As String
    Zestoia = "PALET E1"
    Dim zestKodea, mezua, kondizioa, produktua, agrupazioa As String
    Dim prezioa, pisua, area As Double
    produktua = "ALUPROP"
    agrupazioa = "GENERAL ITEMS"
    zestKodea = "1800000"
    kondizioa = "=A1Alquiler"
    prezioa = 373
    pisua = 116.84
    area = 0
    mezua = "PRICE IS NOT UPDATED. PLEASE CHECK IT"
    Dim fila As Integer
    On Error GoTo x
    If lerroa = 0 Then 'sartu lerro berria
        fila = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value + 1
    
    '''
        Rows(fila & ":" & fila).Select
        Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
        Rows(fila - 1 & ":" & fila - 1).Copy
        Rows(fila & ":" & fila).PasteSpecial xlPasteFormats
        Range("B" & fila - 1 & ":Q" & fila - 1).Select
        Selection.Copy
        Range("B" & fila).Select
        ActiveSheet.Paste
        Range("D" & fila & ":F" & fila & ",J" & fila & ",L" & fila & ",P" & fila & ",R" & fila).Select
        Range("M" & fila).Activate
        Application.CutCopyMode = False
        Selection.ClearContents
        Range("D" & fila).Select
    '''
        Sheets("BoM").Range("B" & fila) = produktua
        Sheets("BoM").Range("C" & fila) = agrupazioa
        Sheets("BoM").Range("D" & fila) = zestKodea
        Sheets("BoM").Range("E" & fila) = Zestoia
        Sheets("BoM").Range("F" & fila) = kondizioa
        Sheets("BoM").Range("J" & fila) = prezioa
        Sheets("BoM").Range("K" & fila) = 1#
        Sheets("BoM").Range("L" & fila) = 0 'prezioa salmentan
        Sheets("BoM").Range("M" & fila) = 1#
        Sheets("BoM").Range("P" & fila) = pisua
        Sheets("BoM").Range("R" & fila) = area
        Sheets("BoM").Range("S" & fila) = mezua
        Sheets("BoM").Range("S" & fila).Font.Color = vbRed
        Sheets("BoM").Range("T" & fila) = kant
    
    'Sartu berri den errenkadak iruzkinik balu --> ezabatu
        Range("E" & fila).Select
        On Error Resume Next
        Set Comentario = Range("E" & fila).Comment
        If Err.Number = 0 Then
       ' cell has comment
        Range("E" & fila).Comment.Delete
        End If
    Else
        MultTajo = Sheets("BoM").Range("T" & Sheets("Data").Range("NumFilaMultiplicTajo").Value).Value
        MultLista = Sheets("BoM").Range("T" & Sheets("Data").Range("B19").Value).Value
        Sheets("BoM").Range("T" & lerroa).Value = kant / MultTajo / MultLista
    End If
x:
actualizandoPalet = ""
If protejidu Then
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
End If
Application.ScreenUpdating = True
End Sub



Sub kalkulatuRack()
    Application.ScreenUpdating = False
    Dim protejidu As Boolean
    protejidu = False
    If Sheets("BoM").ProtectContents Then
        Sheets("BoM").Unprotect
        protejidu = True
    End If
    actualizandoPalet = "X"
    On Error GoTo x
    Dim inicio, fin, lerroa, lerroa2 As Integer
    lerroa = 0
    inicio = ThisWorkbook.Sheets("Data").Range("FilaInicioArticulos").Value
    fin = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value
    Dim zatitzailea As Long
    Dim total, totalTemp As Double
    Dim art25, art26, art63, art66, art49, art60, art36, art30, art32, art20, art70, artTemp, zerrenda, zerrendaTemp, kantitateak As Variant
    art25 = Array("U222018", "U222016", "U222014") 'bakarrik notifikatu, ez kalkulatu
    art26 = Array("U789008", "U789006", "U789005", "U789004", "U789013", "U789014", "U789113", "U789114")
    art63 = Array("U785008")
    art66 = Array("U785006", "U785005", "U785004")
    art49 = Array("U785018")
    art60 = Array("U785016", "U785015", "U785014", "U787017")
    art20 = Array("U784001", "U784002", "U784003", "U784004")
    art36 = Array("U784005", "U784006")
    
    zerrendaTemp = Sheets("BoM").Range("D" & inicio & ":D" & fin)
    On Error GoTo art1
    kont = UBound(zerrendaTemp, 1)
    ReDim zerrenda(1 To kont)
    For j = 1 To kont
        zerrenda(j) = zerrendaTemp(j, 1)
    Next
    GoTo segi
art1:
    kont = 1
    ReDim zerrenda(1 To kont)
    zerrenda = zerrendaTemp
segi:

    kont2 = fin - inicio
    ReDim kantitateak(1 To kont2 + 1)
    
    
    i = 1
    For h = inicio To fin
        kantitateak(i) = Sheets("BoM").Range("H" & h).Value + Sheets("BoM").Range("I" & h).Value
        i = i + 1
    Next
    

    Dim artikuluak As New Scripting.Dictionary
    
    artikuluak.Add Key:=25, Item:=art25
    artikuluak.Add Key:=26, Item:=art26
    artikuluak.Add Key:=63, Item:=art63
    artikuluak.Add Key:=66, Item:=art66
    artikuluak.Add Key:=49, Item:=art49
    artikuluak.Add Key:=60, Item:=art60
    artikuluak.Add Key:=20, Item:=art20
    artikuluak.Add Key:=36, Item:=art36
    
    
    Dim badago As Integer
    For Each gakoa In artikuluak.keys
        zatitzailea = gakoa
         totalTemp = 0
        artTemp = artikuluak(gakoa)
        For Each balioa In artTemp
            If kont = 1 Then
                If zerrenda = balioa Then
                    badago = 0
                Else
                    badago = -1
                End If
            ElseIf kont > 1 Then
                badago = UBound(Filter(zerrenda, balioa))
            End If
            If badago > -1 Then
                If zatitzailea = "25" Then
                    Col = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("ColumInicioLista")) - 1)
                    linea = Application.Match(balioa, Sheets("BoM").Range("D1:D" & fin), 0)
                    Sheets("BoM").Range(Col & linea).Value = "IF FORMADECK, RACKS FOR THIS ITEM MUST BE CALCULATED MANUALLY"
                    Sheets("BoM").Range(Col & linea).Font.Color = vbRed
                Else
                    If kont = 1 Then
                        If zerrenda = balioa Then
                           totalTemp = totalTemp + kantitateak(1)
                        End If
                    ElseIf kont > 1 Then
                        Dim nora As Integer
                        nora = UBound(zerrenda, 1)
                        For i = 1 To nora
                            If zerrenda(i) = balioa Then
                                totalTemp = totalTemp + kantitateak(i)
                            End If
                    Next
                    End If
                End If
            End If
        Next
        total = total + (totalTemp / zatitzailea)
    Next
    total = Application.RoundUp(total, 0)
    total2 = (4 * Application.RoundDown(total / 2, 0)) + (4 * ((total / 2) - (total \ 2)))
    'Racka-ren datuak
    produktua = "FORMADECK"
    agrupazioa = "GENERAL ITEMS"
    
    kodea = "U786008"
    izena = "SHIPPING RACK"
    pisua = 113.7
    prezioa = 187
    kondizioa = "=A1Alquiler"
    area = 0
    mezua = "PRICE IS NOT UPDATED. PLEASE CHECK IT"
    
    'CasterRacka-ren datuak
    kodea2 = "U786048"
    izena2 = "ASSEMBLED CASTER FOR RACK/BASK"
    pisua2 = 86.8
    prezioa2 = 75

    For i = inicio To fin
        If (Sheets("BoM").Range("D" & i).Value = kodea) Then
            lerroa = i
       End If
       If (Sheets("BoM").Range("D" & i).Value = kodea2) Then
            lerroa2 = i
       End If
    Next
                 
        If lerroa = 0 Then 'sartu lerro berria
          If total > 0 Then
            fila = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value + 1
            Rows(fila & ":" & fila).Select
            Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
            Rows(fila - 1 & ":" & fila - 1).Copy
            Rows(fila & ":" & fila).PasteSpecial xlPasteFormats
            Range("B" & fila - 1 & ":Q" & fila - 1).Select
            Selection.Copy
            Range("B" & fila).Select
            ActiveSheet.Paste
            Range("D" & fila & ":F" & fila & ",J" & fila & ",L" & fila & ",P" & fila & ",R" & fila).Select
            'Range("M" & fila).Activate
            Application.CutCopyMode = False
            Selection.ClearContents
            Range("D" & fila).Select
            
            '''
            
            Sheets("BoM").Range("B" & fila) = produktua
            Sheets("BoM").Range("C" & fila) = agrupazioa
            Sheets("BoM").Range("D" & fila) = kodea
            Sheets("BoM").Range("E" & fila) = izena
            Sheets("BoM").Range("F" & fila) = kondizioa
            Sheets("BoM").Range("J" & fila) = prezioa
            Sheets("BoM").Range("K" & fila) = 1#
            Sheets("BoM").Range("L" & fila) = 0 'prezioa salmentan
            Sheets("BoM").Range("M" & fila) = 1#
            Sheets("BoM").Range("P" & fila) = pisua
            Sheets("BoM").Range("R" & fila) = area
            Sheets("BoM").Range("S" & fila) = mezua
            Sheets("BoM").Range("S" & fila).Font.Color = vbRed
            Sheets("BoM").Range("T" & fila) = total
    
            'Sartu berri den errenkadak iruzkinik balu --> ezabatu
            Range("E" & fila).Select
            On Error Resume Next
            Set Comentario = Range("E" & fila).Comment
            If Not Comentario Is Nothing Then
                ' cell has comment
                Range("E" & fila).Comment.Delete
            End If
          End If
        Else
            Sheets("BoM").Range("T" & lerroa).Value = total
        End If
    
        If lerroa2 = 0 Then 'sartu lerro berria
          If total2 > 0 Then
            fila = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value + 1
            Rows(fila & ":" & fila).Select
            Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
            Rows(fila - 1 & ":" & fila - 1).Copy
            Rows(fila & ":" & fila).PasteSpecial xlPasteFormats
            Range("B" & fila - 1 & ":Q" & fila - 1).Select
            Selection.Copy
            Range("B" & fila).Select
            ActiveSheet.Paste
            Range("D" & fila & ":F" & fila & ",J" & fila & ",L" & fila & ",P" & fila & ",R" & fila).Select
            'Range("M" & fila).Activate
            Application.CutCopyMode = False
            Selection.ClearContents
            Range("D" & fila).Select
            
            '''
            
            Sheets("BoM").Range("B" & fila) = produktua
            Sheets("BoM").Range("C" & fila) = agrupazioa
            Sheets("BoM").Range("D" & fila) = kodea2
            Sheets("BoM").Range("E" & fila) = izena2
            Sheets("BoM").Range("F" & fila) = kondizioa
            Sheets("BoM").Range("J" & fila) = prezioa2
            Sheets("BoM").Range("K" & fila) = 1#
            Sheets("BoM").Range("L" & fila) = 0 'prezioa salmentan
            Sheets("BoM").Range("M" & fila) = 1#
            Sheets("BoM").Range("P" & fila) = pisua2
            Sheets("BoM").Range("R" & fila) = area
            Sheets("BoM").Range("S" & fila) = mezua
            Sheets("BoM").Range("S" & fila).Font.Color = vbRed
            Sheets("BoM").Range("T" & fila) = total2

    
            'Sartu berri den errenkadak iruzkinik balu --> ezabatu
            Range("E" & fila).Select
            On Error Resume Next
            Set Comentario = Range("E" & fila).Comment
            If Not Comentario Is Nothing Then
                ' cell has comment
                Range("E" & fila).Comment.Delete
            End If
          End If
        Else
            Sheets("BoM").Range("T" & lerroa2).Value = total2
        End If
    ''''''''''
x:
    actualizandoPalet = ""
    If protejidu Then
        ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
        ThisWorkbook.Worksheets("BoM").EnableOutlining = True
    End If
    Application.ScreenUpdating = True
End Sub

Sub dataUSAformatua()
egoera = Application.ScreenUpdating
Application.ScreenUpdating = False
egoera2 = Application.EnableEvents
Application.EnableEvents = False
Dim dataA, dataB, dataC, dataD As String
Dim egunaA, egunaB, egunaC, egunaD As String
Dim urteaA, urteaB, urteaC, urteaD As String
Dim hilabeteaA, hilabeteaB, hilabeteaC, hilabeteaD As String

'Sheets("BoM").Range("I2").Value = "Date (mm-dd-yyyy):"
dataA = Sheets("BoM").Range("ID_Data_Fecha").Value
If (dataA <> "") Then
urteaA = Mid(Sheets("BoM").Range("ID_Data_Fecha").Value, 1, 4)
hilabeteaA = Mid(Sheets("BoM").Range("ID_Data_Fecha").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_Fecha").Value) + 1, 2)
egunaA = Mid(Sheets("BoM").Range("ID_Data_Fecha").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_Fecha").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_Fecha").Value) + 1) + 1, 2)
Sheets("BoM").Range("ID_Data_Fecha").Value = "'" & hilabeteaA & "/" & egunaA & "/" & urteaA
End If

dataB = Sheets("BoM").Range("ID_Data_FechaINSum").Value
If (dataB <> "") Then
urteaB = Mid(Sheets("BoM").Range("ID_Data_FechaINSum").Value, 1, 4)
hilabeteaB = Mid(Sheets("BoM").Range("ID_Data_FechaINSum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaINSum").Value) + 1, 2)
egunaB = Mid(Sheets("BoM").Range("ID_Data_FechaINSum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaINSum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaINSum").Value) + 1) + 1, 2)
Sheets("BoM").Range("ID_Data_FechaINSum").Value = "'" & hilabeteaB & "/" & egunaB & "/" & urteaB
End If

dataC = Sheets("BoM").Range("ID_Data_FechaFINSum").Value
If (dataC <> "") Then
urteaC = Mid(Sheets("BoM").Range("ID_Data_FechaFINSum").Value, 1, 4)
hilabeteaC = Mid(Sheets("BoM").Range("ID_Data_FechaFINSum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaFINSum").Value) + 1, 2)
egunaC = Mid(Sheets("BoM").Range("ID_Data_FechaFINSum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaFINSum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaFINSum").Value) + 1) + 1, 2)
Sheets("BoM").Range("ID_Data_FechaFINSum").Value = "'" & hilabeteaC & "/" & egunaC & "/" & urteaC
End If

dataD = Sheets("BoM").Range("ID_Data_FechaPRESum").Value
If (dataD <> "") Then
urteaD = Mid(Sheets("BoM").Range("ID_Data_FechaPRESum").Value, 1, 4)
hilabeteaD = Mid(Sheets("BoM").Range("ID_Data_FechaPRESum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaPRESum").Value) + 1, 2)
egunaD = Mid(Sheets("BoM").Range("ID_Data_FechaPRESum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaPRESum").Value, Application.Find("-", Sheets("BoM").Range("ID_Data_FechaPRESum").Value) + 1) + 1, 2)
Sheets("BoM").Range("ID_Data_FechaPRESum").Value = "'" & hilabeteaD & "/" & egunaD & "/" & urteaD
End If
Application.ScreenUpdating = egoera
Application.EnableEvents = egoera2

End Sub


Attribute VB_Name = "M9_InsertarFila"
Public Sub InsertarFila()
    ActiveSheet.Unprotect
    Dim fila As Integer
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     INSERTAR FILA (EZ DA ERABILTZEN)
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    
    
    On Error GoTo x
    fila = InputBox("Row number to insert the item / N|fffd| de linea para insertar el art|fffd|culo:")
    'Dim Codigo As String
    'Codigo = InputBox("C|fffd|digo del art|fffd|culo a insertar:")
    'Dim DescripcionArticulo As String
    'DescripcionArticulo = ObtenerNombreArticuloDesdeXML(Codigo)
    'Dim PesoArticulo As String
    'PesoArticulo = ObtenerPesoArticuloDesdeXML(Codigo)
    'Dim AreaArticulo As String
    'AreaArticulo = ObtenerAreaArticuloDesdeXML(Codigo)
    Rows(fila & ":" & fila).Select
    Selection.Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
    Range("B" & fila - 1 & ":N" & fila - 1).Select
    Selection.Copy
    Range("B" & fila).Select
    ActiveSheet.Paste
    Range("D" & fila & ":F" & fila & ",I" & fila & ",J" & fila & ",M" & fila).Select
    Range("M" & fila).Activate
    Application.CutCopyMode = False
    Selection.ClearContents
    'Range("D" & Fila).Value = Codigo
    'Range("E" & Fila).Value = DescripcionArticulo
    'Range("K" & Fila).Value = PesoArticulo
    'Range("M" & Fila).Value = AreaArticulo
    Range("D" & fila).Select
    
        'Sartu berri den errenkadak iruzkinik balu --> ezabatu
    Range("E" & fila).Select
    On Error Resume Next
    Set Comentario = Range("E" & fila).Comment
    If Err.Number = 0 Then
       ' cell has comment
       Range("E" & fila).Comment.Delete
    End If
    
    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True _
        , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
        AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:= _
        True
x:
End Sub



Attribute VB_Name = "Ma10_Mexico"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     MEXICO EXPORT
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Sub Cotizador()
    Dim ML As Object
    Set ML = Application.Workbooks.Open("c:\Ulma\Repcon_57\s26\data\doctemplates\template_CotizadorMX.xlsx")
    Dim inicio As Integer
    inicio = ThisWorkbook.Worksheets("Data").Range("FilaInicioArticulos").Value
    Dim fin As Integer
    fin = ThisWorkbook.Worksheets("Data").Range("FilaFinArticulos").Value
    Application.ScreenUpdating = False
    'Goiburua sartu
    'ML.Sheets("Venta").Range("E5").Value = ThisWorkbook.Sheets("Bom").Range("ID_Data_Cliente").Value ' Cliente
    ML.Sheets("Venta").Range("E5").Value = separadorCodNom(ThisWorkbook.Sheets("Bom").Range("ID_Data_Cliente").Value, "//", False) ' Cliente
    ML.Sheets("Venta").Range("E6").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Direccion").Value & "," & ThisWorkbook.Sheets("BoM").Range("ID_Data_PoblacionCliente").Value ' Direccion
    ML.Sheets("Venta").Range("E7").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Contacto").Value ' Contacto
    ML.Sheets("Venta").Range("L5").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Fecha").Value ' Fecha
    ML.Sheets("Venta").Range("J8").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_ObraGet").Value ' Obra
    
    ''''
    ML.Sheets("Renta").Range("E5").Value = separadorCodNom(ThisWorkbook.Sheets("Bom").Range("ID_Data_Cliente").Value, "//", False) ' Cliente
    ML.Sheets("Renta").Range("E6").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Direccion").Value & "," & ThisWorkbook.Sheets("BoM").Range("ID_Data_PoblacionCliente").Value ' Direccion
    ML.Sheets("Renta").Range("E7").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Contacto").Value ' Contacto
    ML.Sheets("Renta").Range("L5").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Fecha").Value ' Fecha
    ML.Sheets("Renta").Range("J8").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_ObraGet").Value ' Obra
    ''''
    ML.Sheets("Especiales").Range("E5").Value = separadorCodNom(ThisWorkbook.Sheets("Bom").Range("ID_Data_Cliente").Value, "//", False) ' Cliente
    ML.Sheets("Especiales").Range("E6").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Direccion").Value & "," & ThisWorkbook.Sheets("BoM").Range("ID_Data_PoblacionCliente").Value ' Direccion
    ML.Sheets("Especiales").Range("E7").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Contacto").Value ' Contacto
    ML.Sheets("Especiales").Range("L5").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_Fecha").Value ' Fecha
    ML.Sheets("Especiales").Range("J8").Value = ThisWorkbook.Sheets("BoM").Range("ID_Data_ObraGet").Value ' Obra
    
    ''''''
    Dim columnaInicio As String
    Dim columnaFin As String
    Dim columnas As Integer
    columnaInicio = ThisWorkbook.Sheets("Data").Range("ColumInicioLista").Value
    columnaFin = ThisWorkbook.Sheets("Data").Range("ColumFinLista").Value
    columnas = ConvertToNumber(columnaFin) - ConvertToNumber(columnaInicio) + 1
    If columnas > 1 Then
        For i = 1 To columnas - 1
            ML.Sheets("Especiales").Columns("N").Copy
            ML.Sheets("Especiales").Columns("N").Insert Shift:=xlToRight
            ML.Sheets("renta").Columns("O").Copy
            ML.Sheets("renta").Columns("O").Insert Shift:=xlToRight
            ML.Sheets("venta").Columns("N").Copy
            ML.Sheets("venta").Columns("N").Insert Shift:=xlToRight
        Next
    End If
    
    ''''''
    
    LcopiaV = 14
    CCopiaV = 14
    LcopiaR = 14
    CcopiaR = 15
    LcopiaE = 14
    CcopiaE = 14
    nombreColumnas = 0
    
    For i = inicio To fin
        If nombreColumnas = 0 Then
            For h = 0 To columnas - 1
                ML.Sheets("Renta").Range(ConvertToLetter(CcopiaR + h) & "5") = (ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + h) & (ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value + 1)).Value) ' zutabearen izena
                ML.Sheets("Especiales").Range(ConvertToLetter(CcopiaE + h) & "5") = (ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + h) & (ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value + 1)).Value) ' zutabearen izena
                ML.Sheets("Venta").Range(ConvertToLetter(CCopiaV + h) & "5") = (ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + h) & (ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value + 1)).Value) ' zutabearen izena
            Next
        End If
        nombreColumnas = 1
        If (ThisWorkbook.Sheets("Bom").Range("F" & i).Value = "Alquiler" Or ThisWorkbook.Sheets("Bom").Range("F" & i).Value = "Montaje") Then
            'linea sartu errentan
            ML.Sheets("Renta").Activate
            ML.Sheets("Renta").Range(LcopiaR & ":" & LcopiaR).Copy
            ML.Sheets("Renta").Range(LcopiaR & ":" & LcopiaR).Insert
            ''''''''''''''
            ML.Sheets("Renta").Range("B" & LcopiaR) = ThisWorkbook.Sheets("BoM").Range("B" & i).Value ' Producto
            ML.Sheets("Renta").Range("C" & LcopiaR) = ThisWorkbook.Sheets("BoM").Range("C" & i).Value ' Agrupacion
            ML.Sheets("Renta").Range("D" & LcopiaR) = ThisWorkbook.Sheets("BoM").Range("D" & i).Value ' Codigo
            For j = 0 To columnas - 1
                ML.Sheets("Renta").Range(ConvertToLetter(CcopiaR + j) & LcopiaR) = ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & i).Value * ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value).Value * (ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & (ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value + 3)).Value) ' Cantidad
            Next
            ML.Sheets("Renta").Range("F" & LcopiaR) = ThisWorkbook.Sheets("BoM").Range("E" & i).Value ' Descripcion
            ML.Sheets("Renta").Range("J" & LcopiaR) = ThisWorkbook.Sheets("BoM").Range("P" & i).Value ' Peso
            ML.Sheets("Renta").Range("L" & LcopiaR) = ThisWorkbook.Sheets("BoM").Range("N" & i).Value ' Precio
            LcopiaR = LcopiaR + 1
        ElseIf (ThisWorkbook.Sheets("Bom").Range("F" & i).Value = "Especial") Then
            'linea sartu berezietan
            ML.Sheets("Especiales").Activate
            ML.Sheets("Especiales").Range(LcopiaE & ":" & LcopiaE).Copy
            ML.Sheets("Especiales").Range(LcopiaE & ":" & LcopiaE).Insert
            ''''''''''''
            ML.Sheets("Especiales").Range("B" & LcopiaE) = ThisWorkbook.Sheets("BoM").Range("B" & i).Value ' Producto
            ML.Sheets("Especiales").Range("C" & LcopiaE) = ThisWorkbook.Sheets("BoM").Range("C" & i).Value ' Agrupacion
            ML.Sheets("Especiales").Range("D" & LcopiaE) = ThisWorkbook.Sheets("BoM").Range("D" & i).Value ' Codigo
            For j = 0 To columnas - 1
                ML.Sheets("Especiales").Range(ConvertToLetter(CcopiaE + j) & LcopiaE) = ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & i).Value * ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value).Value * (ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & (ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value + 3)).Value) ' Cantidad
            Next
            ML.Sheets("Especiales").Range("F" & LcopiaE) = ThisWorkbook.Sheets("BoM").Range("E" & i).Value ' Descripcion
            ML.Sheets("Especiales").Range("J" & LcopiaE) = ThisWorkbook.Sheets("BoM").Range("P" & i).Value ' Peso
            ML.Sheets("Especiales").Range("L" & LcopiaE) = ThisWorkbook.Sheets("BoM").Range("N" & i).Value ' Precio
            LcopiaE = LcopiaE + 1
        Else
            'linea sartu salmentan
            ML.Sheets("Venta").Activate
            ML.Sheets("Venta").Range(LcopiaV & ":" & LcopiaV).Copy
            ML.Sheets("Venta").Range(LcopiaV & ":" & LcopiaV).Insert
            ''''''''''''
            ML.Sheets("Venta").Range("B" & LcopiaV) = ThisWorkbook.Sheets("BoM").Range("B" & i).Value ' Producto
            ML.Sheets("Venta").Range("C" & LcopiaV) = ThisWorkbook.Sheets("BoM").Range("C" & i).Value ' Agrupacion
            ML.Sheets("Venta").Range("D" & LcopiaV) = ThisWorkbook.Sheets("BoM").Range("D" & i).Value ' Codigo
            For j = 0 To columnas - 1
                ML.Sheets("Venta").Range(ConvertToLetter(CCopiaV + j) & LcopiaV) = ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & i).Value * ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value).Value * (ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(ConvertToNumber(columnaInicio) + j) & (ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value + 3)).Value) ' Cantidad
            Next
            ML.Sheets("Venta").Range("F" & LcopiaV) = ThisWorkbook.Sheets("BoM").Range("E" & i).Value ' Descripcion
            ML.Sheets("Venta").Range("J" & LcopiaV) = ThisWorkbook.Sheets("BoM").Range("P" & i).Value ' Peso
            ML.Sheets("Venta").Range("L" & LcopiaV) = ThisWorkbook.Sheets("BoM").Range("N" & i).Value ' Precio
            LcopiaV = LcopiaV + 1
        End If
    Next
    'Ezabatu lehen eta azken lineak
    ML.Sheets("Venta").Rows(13).Delete
    ML.Sheets("Venta").Rows(LcopiaV - 1).Delete
    ML.Sheets("Renta").Rows(13).Delete
    ML.Sheets("Renta").Rows(LcopiaR - 1).Delete
    ML.Sheets("Especiales").Rows(13).Delete
    ML.Sheets("Especiales").Rows(LcopiaE - 1).Delete
    
    'Ezabatu 0 biderkatzailea duten zutabeak
        Dim Col As Integer
        Col = CCopiaV ' + 1 alquiler zutabearentzat
        Dim colR As Integer
        For colR = ConvertToNumber(columnaInicio) To ConvertToNumber(columnaFin)
            If (ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(colR) & ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value).Value = 0 Or ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(colR) & (ThisWorkbook.Sheets("Data").Range("NumFilaMultiplicTajo").Value + 3)).Value = 0) Then
                ML.Sheets("Renta").Columns(Col + 1).EntireColumn.Delete
                ML.Sheets("Venta").Columns(Col).EntireColumn.Delete
                ML.Sheets("Especiales").Columns(Col).EntireColumn.Delete
            Else
                Col = Col + 1
            End If
        Next
    'Gorde
    karpeta = Environ("temp")
    excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    fitxategia = karpeta & "\" & "CotizadorMX_" & excelizena
    If Not fitxategia = False Then
        Dim rev As Integer
        rev = 0
        Dim fileTemp As String
        fileTemp = fitxategia & ".xlsx"
        Do While (Not (Dir(fileTemp, vbDirectory) = vbNullString))
            rev = rev + 1
            fileTemp = fitxategia & "_" & rev & ".xslx"
        Loop
        ML.SaveAs fileTemp
    End If
    Application.ScreenUpdating = True
End Sub





Attribute VB_Name = "Ma11_Baan"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     BAAN RENTAL/SALE
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Dim cn As New Connection
Dim rs As New Recordset
Dim provincia As String
Dim nombrepro As String
Dim parte1 As String
Public referer As String

Sub conectar()
    'Establecer la conexi|fffd|n con la BD del servidor
    With cn
        .ConnectionString = "Provider=SQLOLEDB.1;Persist Security Info=False;User ID=excel;Password=ex1957co;Initial Catalog=baan_reporting;Data Source=192.227.20.165"
        .Open
    End With
End Sub


Sub CargarDatosCliente(ByVal hoja As String)
       Dim i As Integer
       Dim compania As String
       compania = Sheets("Data").Range("CiaDatos").Value
       
       If compania = 121 Then
        compania = 120
       End If
       If compania = "" Then
        MsgBox Sheets("Languages").Range("Msg7_NoInfoCia").Value
        GoTo fin
       End If
       If Sheets(hoja).Range("Cliente").Cells(1, 1).Value <> "" Then
        'cargar datos del cliente
        conectar
        If Len(Sheets(hoja).Range("Cliente").Cells(1, 1)) <> 6 Then
            For i = Len(Sheets(hoja).Range("Cliente").Cells(1, 1)) To 5
                Sheets(hoja).Range("Cliente").Cells(1, 1) = " " & Sheets(hoja).Range("Cliente").Cells(1, 1)
            Next i
        End If
        
        rs.Open "select t_fovn,t_domcli, t_nomcli, t_pobcli, t_codpos, t_codprv, t_numtel1, t_numfax from ttckco020" & compania & " where t_cuno ='" & Sheets(hoja).Range("Cliente").Cells(1, 1).Value & "'", cn, adOpenStatic, adLockOptimistic
        If Not rs.EOF And Not rs.BOF Then
            rs.MoveFirst
            Sheets(hoja).Range("nomcli").Cells(1, 1).Value = rs!t_nomcli
        Else
            MsgBox Sheets("Languages").Range("Msg8_NoInfoCliente").Value
            Sheets(hoja).Range("nomcli").Cells(1, 1).Value = ""
        End If
        rs.Close
        cn.Close
    End If
fin:
End Sub

Sub generartxt(ByVal hoja As String)
On Error GoTo x
    Dim Texto As Object
    Dim objdoc As Object
    Dim nombrefichero As String
    Dim contrato As String
    Dim fechasuministro As String
    Dim tipofich As String
    Dim cliente As String
    Dim i As Integer
    Dim z As Integer
    Dim fechamax As String
    Dim werror As Boolean
    
    Application.ScreenUpdating = False
    
    If Sheets(hoja).Range("Cliente").Cells(1, 1) = "" Then 'si no se ha introducido cliente
        MsgBox "C|fffd|digo cliente es necesario para crear fichero"
    Else
        If Sheets(hoja).Range("Comercial").Cells(1, 1).Value = "" Then 'si no se ha introducido comercial
            MsgBox "Comercial es necesario para crear fichero"
        Else
            parte1 = ""
            If Sheets(hoja).Range("Contrato").Cells(1, 1) <> "" Then
                'se ha introducido contrato
                parte1 = Sheets(hoja).Range("Contrato").Cells(1, 1)
                tipofich = "contrato"
            Else
                'si no se ha introducido contrato
                If Sheets(hoja).Range("Comercial").Cells(1, 1) = "" Or Sheets(hoja).Range("Oferta").Cells(1, 1) = "" Then
                    'no se ha introducido comercial-oferta
                    parte1 = ""
                Else
                    'se han introducido comercial-oferta
                    parte1 = Sheets(hoja).Range("Comercial").Cells(1, 1) & "-" & Sheets(hoja).Range("Oferta").Cells(1, 1)
                    tipofich = "comercial-oferta"
                End If
            End If
            If parte1 = "" Then
                MsgBox "Numero contrato o Comercial-Oferta son necesario para crear fichero"
            Else
                'construir el nombre del fichero
                nombrefichero = ""
                cliente = Sheets(hoja).Range("Cliente").Cells(1, 1)
                
                'buscar la fecha de suministro mayor del fichero
                fechamax = CStr(CDate(Application.WorksheetFunction.Max(Sheets(hoja).Range("fecha1").Cells(13, 1), Sheets(hoja).Range("fecha2").Cells(13, 1), Sheets(hoja).Range("fecha3").Cells(13, 1), Sheets(hoja).Range("fecha4").Cells(13, 1), Sheets(hoja).Range("fecha5").Cells(13, 1), Sheets(hoja).Range("fecha6").Cells(13, 1), Sheets(hoja).Range("fecha7").Cells(13, 1), Sheets(hoja).Range("fecha8").Cells(13, 1))))
                fechasuministro = Replace(CStr(fechamax), "/", "")
                fechasuministro = Replace(CStr(fechasuministro), ".", "")
                If fechasuministro = "0:00:00" Then
                    MsgBox "No ha introducido ninguna fecha de suministro"
                Else
                    'componer el nombre del fichero
                    nombrefichero = parte1 & "-" & fechasuministro & ".txt"
                    'Borrar ficheros anteriores que pueden existir en el
                    'directorio c:\Informes Baan para este n|fffd|mero de contrato.
                    BorrarFicheros
                    
                    'crear el fichero
                    Set Texto = CreateObject("excel.application")
                    Texto.DisplayAlerts = False
                    Texto.Interactive = False
                    Texto.ScreenUpdating = False
                    Set objdoc = Texto.Workbooks.Add
                    objdoc.SaveAs ("C:\Informes Baan\" & nombrefichero), FileFormat:=xlText
                    'crear cabecera
                    Texto.Worksheets(1).Cells(13, 1).Value = "Cliente"
                    Texto.Worksheets(1).Cells(13, 2).Value = "Comercial"
                    If tipofich = "contrato" Then
                        Texto.Worksheets(1).Cells(13, 3).Value = "Contrato"
                    Else
                        Texto.Worksheets(1).Cells(13, 3).Value = "Oferta"
                    End If
                    Texto.Worksheets(1).Cells(13, 4).Value = "Articulo"
                    Texto.Worksheets(1).Cells(13, 5).Value = "Calidad"
                    Texto.Worksheets(1).Cells(13, 6).Value = "PreVta"
                    Texto.Worksheets(1).Cells(13, 7).Value = "PreUdi"
                    Texto.Worksheets(1).Cells(13, 8).Value = "Servicio"
                
                    Texto.Worksheets(1).Cells(13, 9).Value = "FechaSum1"
                    Texto.Worksheets(1).Cells(13, 10).Value = "AlmSum1"
                    Texto.Worksheets(1).Cells(13, 11).Value = "Ctd1"
                    Texto.Worksheets(1).Cells(13, 12).Value = "FechaSum2"
                    Texto.Worksheets(1).Cells(13, 13).Value = "AlmSum2"
                    Texto.Worksheets(1).Cells(13, 14).Value = "Ctd2"
                    Texto.Worksheets(1).Cells(13, 15).Value = "FechaSum3"
                    Texto.Worksheets(1).Cells(13, 16).Value = "AlmSum3"
                    Texto.Worksheets(1).Cells(13, 17).Value = "Ctd3"
                    Texto.Worksheets(1).Cells(13, 18).Value = "FechaSum4"
                    Texto.Worksheets(1).Cells(13, 19).Value = "AlmSum4"
                    Texto.Worksheets(1).Cells(13, 20).Value = "Ctd4"
                    Texto.Worksheets(1).Cells(13, 21).Value = "FechaSum5"
                    Texto.Worksheets(1).Cells(13, 22).Value = "AlmSum5"
                    Texto.Worksheets(1).Cells(13, 23).Value = "Ctd5"
                    Texto.Worksheets(1).Cells(13, 24).Value = "FechaSum6"
                    Texto.Worksheets(1).Cells(13, 25).Value = "AlmSum6"
                    Texto.Worksheets(1).Cells(13, 26).Value = "Ctd6"
                    Texto.Worksheets(1).Cells(13, 27).Value = "FechaSum7"
                    Texto.Worksheets(1).Cells(13, 28).Value = "AlmSum7"
                    Texto.Worksheets(1).Cells(13, 29).Value = "Ctd7"
                    Texto.Worksheets(1).Cells(13, 30).Value = "FechaSum8"
                    Texto.Worksheets(1).Cells(13, 31).Value = "AlmSum8"
                    Texto.Worksheets(1).Cells(13, 32).Value = "Ctd8"
                    
                    'crear las l|fffd|neas del fichero
                    For i = 14 To 1500          'bucle para sacar todas las l|fffd|neas del fichero
                       werror = False
                       If Sheets(hoja).Range("Articulos").Cells(i, 1) = "" Then 'el campo art|fffd|culo no est|fffd| completado
                            For z = 2 To 20
                                If Sheets(hoja).Cells(i, z) <> "" Then
                                    werror = True
                                    Exit For
                                End If
                            Next z
                            If werror = True Then
                                MsgBox Sheets("Languages").Range("Msg9_NoInfoCodigo") & i
                                Exit For
                            End If
                       Else
                            'cliente
                            Texto.Worksheets(1).Cells(i, 1).Value = Sheets(hoja).Range("Cliente").Cells(1, 1)
                            Texto.Worksheets(1).Cells(i, 2).Value = Sheets(hoja).Range("Comercial").Cells(1, 1)
                            If tipofich = "contrato" Then
                                Texto.Worksheets(1).Cells(i, 3).Value = Sheets(hoja).Range("Contrato").Cells(1, 1)
                            Else
                                Texto.Worksheets(1).Cells(i, 3).Value = Sheets(hoja).Range("Oferta").Cells(1, 1)
                            End If
                            'articulo
                            Texto.Worksheets(1).Cells(i, 4).Value = Sheets(hoja).Range("Articulos").Cells(i, 1)
                            'calidad
                            Texto.Worksheets(1).Cells(i, 5).Value = Sheets(hoja).Range("Calidades").Cells(i, 1)
                            'PreVta
                            If IsNumeric(Sheets(hoja).Range("Precios").Cells(i, 1)) Then
                               If CDbl(Sheets(hoja).Range("Precios").Cells(i, 1)) <> 0 Then
                                   If CDbl(Sheets(hoja).Range("Precios").Cells(i, 1)) < 0 Then
                                       MsgBox Sheets("Languages").Range("Msg11_NoPrecioNegVenta")
                                       werror = True
                                       Exit For
                                   Else
                                       Texto.Worksheets(1).Cells(i, 6).Value = Sheets(hoja).Range("Precios").Cells(i, 1)
                                   End If
                                Else
                                   'si no introducen precio vta se coger|fffd| en baan de la tarifa
                                    Texto.Worksheets(1).Cells(i, 6).Value = 0
                                End If
                            Else
                                MsgBox Sheets("Languages").Range("Msg12_PrecioVentaNumerico")
                                werror = True
                                Exit For
                            End If
                            'Preudi
                            If IsNumeric(Sheets(hoja).Range("Preudis").Cells(i, 1)) Then
                                If CDbl(Sheets(hoja).Range("Preudis").Cells(i, 1)) <> 0 Then
                                    If CDbl(Sheets(hoja).Range("Preudis").Cells(i, 1)) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg11_NoPrecioNegAlq")
                                        werror = True
                                        Exit For
                                     Else
                                       Texto.Worksheets(1).Cells(i, 7).Value = Sheets(hoja).Range("Preudis").Cells(i, 1)
                                     End If
                                 Else
                                   Texto.Worksheets(1).Cells(i, 7).Value = 0
                                   'Sheets(hoja).Range("Preudis").Cells(i, 1) = 0
                                 End If
                             Else
                                 MsgBox Sheets("Languages").Range("Msg13_PrecioAlqNumerico")
                                 werror = True
                                 Exit For
                             End If
                            'servicio
                            If Sheets(hoja).Range("Servicios").Cells(i, 1) > 0 Then
                                If IsNumeric(Sheets(hoja).Range("Servicios").Cells(i, 1)) Then
                                    Texto.Worksheets(1).Cells(i, 8).Value = Sheets(hoja).Range("Servicios").Cells(i, 1)
                                Else
                                    MsgBox Sheets("Languages").Range("Msg14_ServicioNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                Texto.Worksheets(1).Cells(i, 8).Value = 1
                                Sheets(hoja).Range("Servicios").Cells(i, 1) = 1
                            End If
                            
                            'fecha suministro 1, almac|fffd|n 1, cantidad
    
                            If Sheets(hoja).Range("fecha1").Cells(i, 1).Value <> "" Then 'si cantidad <>0
                                If IsNumeric(Sheets(hoja).Range("fecha1").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha1").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 11).Value = Sheets(hoja).Range("fecha1").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha1").Cells(13, 1).Value) <> "" Then 'fecha
                                            Texto.Worksheets(1).Cells(i, 9).Value = CStr(Sheets(hoja).Range("fecha1").Cells(13, 1).Value) 'fecha sum
                                            Texto.Worksheets(1).Cells(i, 9).NumberFormat = "mm/dd/yyyy"
                                        Else
                                            MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 1"
                                            werror = True
                                            Exit For
                                            'Texto.Worksheets(1).Cells(i, 8).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen1").Cells(i, 1).Value <> "" Then 'almacen
                                            Texto.Worksheets(1).Cells(i, 10).Value = Sheets(hoja).Range("almacen1").Cells(i, 1).Value 'almacen
                                        Else
                                            Texto.Worksheets(1).Cells(i, 10).Value = 0
                                        End If
                                    End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 9).Value = 0
                                Texto.Worksheets(1).Cells(i, 10).Value = 0
                                Texto.Worksheets(1).Cells(i, 11).Value = 0
                            End If
                            
                            'fecha suministro 2, almac|fffd|n 2, cantidad
                            If Sheets(hoja).Range("fecha2").Cells(i, 1).Value <> "" Then 'si hay cantidad
                               If IsNumeric(Sheets(hoja).Range("fecha2").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha2").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 14).Value = Sheets(hoja).Range("fecha2").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha2").Cells(13, 1).Value) <> "" Then
                                            Texto.Worksheets(1).Cells(i, 12).Value = CStr(Sheets(hoja).Range("fecha2").Cells(13, 1).Value)
                                            Texto.Worksheets(1).Cells(i, 12).NumberFormat = "mm/dd/yyyy"
                                        Else
                                            MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 2"
                                            werror = True
                                            Exit For
                                            'Texto.Worksheets(1).Cells(i, 11).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen2").Cells(i, 1).Value <> "" Then
                                            Texto.Worksheets(1).Cells(i, 13).Value = Sheets(hoja).Range("almacen2").Cells(i, 1).Value
                                        Else
                                            Texto.Worksheets(1).Cells(i, 13).Value = 0
                                        End If
                                    End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 12).Value = 0
                                Texto.Worksheets(1).Cells(i, 13).Value = 0
                                Texto.Worksheets(1).Cells(i, 14).Value = 0
                            End If
                            
                            'fecha suministro 3, almac|fffd|n 3, cantidad
                            If Sheets(hoja).Range("fecha3").Cells(i, 1).Value <> "" Then
                                If IsNumeric(Sheets(hoja).Range("fecha3").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha3").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 17).Value = Sheets(hoja).Range("fecha3").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha3").Cells(13, 1).Value) <> "" Then
                                            Texto.Worksheets(1).Cells(i, 15).Value = CStr(Sheets(hoja).Range("fecha3").Cells(13, 1).Value)
                                            Texto.Worksheets(1).Cells(i, 15).NumberFormat = "mm/dd/yyyy"
                                        Else
                                            MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 3"
                                            werror = True
                                            Exit For
                                            'Texto.Worksheets(1).Cells(i, 14).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen3").Cells(i, 1).Value <> "" Then
                                            Texto.Worksheets(1).Cells(i, 16).Value = Sheets(hoja).Range("almacen3").Cells(i, 1).Value
                                        Else
                                            Texto.Worksheets(1).Cells(i, 16).Value = 0
                                        End If
                                    End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 15).Value = 0
                                Texto.Worksheets(1).Cells(i, 16).Value = 0
                                Texto.Worksheets(1).Cells(i, 17).Value = 0
                            End If
                            
                            'fecha suministro 4, almac|fffd|n 4, cantidad
                            If Sheets(hoja).Range("fecha4").Cells(i, 1).Value <> "" Then
                               If IsNumeric(Sheets(hoja).Range("fecha4").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha4").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 20).Value = Sheets(hoja).Range("fecha4").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha4").Cells(13, 1).Value) <> "" Then
                                            Texto.Worksheets(1).Cells(i, 18).Value = CStr(Sheets(hoja).Range("fecha4").Cells(13, 1).Value)
                                            Texto.Worksheets(1).Cells(i, 18).NumberFormat = "mm/dd/yyyy"
                                        Else
                                            MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 4"
                                            werror = True
                                            Exit For
                                            'Texto.Worksheets(1).Cells(i, 17).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen4").Cells(i, 1).Value <> "" Then
                                            Texto.Worksheets(1).Cells(i, 19).Value = Sheets(hoja).Range("almacen4").Cells(i, 1).Value
                                        Else
                                            Texto.Worksheets(1).Cells(i, 19).Value = 0
                                        End If
                                    End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 18).Value = 0
                                Texto.Worksheets(1).Cells(i, 19).Value = 0
                                Texto.Worksheets(1).Cells(i, 20).Value = 0
                            End If
                            
                            'fecha suministro 5, almac|fffd|n 5, cantidad
                            If Sheets(hoja).Range("fecha5").Cells(i, 1).Value <> "" Then
                                If IsNumeric(Sheets(hoja).Range("fecha5").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha5").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 23).Value = Sheets(hoja).Range("fecha5").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha5").Cells(13, 1).Value) <> "" Then
                                            Texto.Worksheets(1).Cells(i, 21).Value = CStr(Sheets(hoja).Range("fecha5").Cells(13, 1).Value)
                                            Texto.Worksheets(1).Cells(i, 21).NumberFormat = "mm/dd/yyyy"
                                        Else
                                            MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 5"
                                            werror = True
                                            Exit For
                                            'Texto.Worksheets(1).Cells(i, 20).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen5").Cells(i, 1).Value <> "" Then
                                            Texto.Worksheets(1).Cells(i, 22).Value = Sheets(hoja).Range("almacen5").Cells(i, 1).Value
                                        Else
                                            Texto.Worksheets(1).Cells(i, 22).Value = 0
                                        End If
                                    End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 21).Value = 0
                                Texto.Worksheets(1).Cells(i, 22).Value = 0
                                Texto.Worksheets(1).Cells(i, 23).Value = 0
                            End If
                            
                            'fecha suministro 6, almac|fffd|n 6, cantidad
                            If Sheets(hoja).Range("fecha6").Cells(i, 1).Value <> "" Then
                                If IsNumeric(Sheets(hoja).Range("fecha6").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha6").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 26).Value = Sheets(hoja).Range("fecha6").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha6").Cells(13, 1).Value) <> "" Then
                                            Texto.Worksheets(1).Cells(i, 24).Value = CStr(Sheets(hoja).Range("fecha6").Cells(13, 1).Value)
                                            Texto.Worksheets(1).Cells(i, 24).NumberFormat = "mm/dd/yyyy"
                                        Else
                                            MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 6"
                                            werror = True
                                            Exit For
                                            'Texto.Worksheets(1).Cells(i, 23).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen6").Cells(i, 1).Value <> "" Then
                                            Texto.Worksheets(1).Cells(i, 25).Value = Sheets(hoja).Range("almacen6").Cells(i, 1).Value
                                        Else
                                            Texto.Worksheets(1).Cells(i, 25).Value = 0
                                        End If
                                     End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 24).Value = 0
                                Texto.Worksheets(1).Cells(i, 25).Value = 0
                                Texto.Worksheets(1).Cells(i, 26).Value = 0
                            End If
                            
                            'fecha suministro 7, almac|fffd|n 7, cantidad
                            If Sheets(hoja).Range("fecha7").Cells(i, 1).Value <> "" Then
                                If IsNumeric(Sheets(hoja).Range("fecha7").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha7").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 29).Value = Sheets(hoja).Range("fecha7").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha7").Cells(13, 1).Value) <> "" Then
                                            Texto.Worksheets(1).Cells(i, 27).Value = CStr(Sheets(hoja).Range("fecha7").Cells(13, 1).Value)
                                            Texto.Worksheets(1).Cells(i, 27).NumberFormat = "mm/dd/yyyy"
                                        Else
                                            MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 7"
                                            werror = True
                                            Exit For
                                            'Texto.Worksheets(1).Cells(i, 26).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen7").Cells(i, 1).Value <> "" Then
                                            Texto.Worksheets(1).Cells(i, 28).Value = Sheets(hoja).Range("almacen7").Cells(i, 1).Value
                                        Else
                                            Texto.Worksheets(1).Cells(i, 28).Value = 0
                                        End If
                                    End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 27).Value = 0
                                Texto.Worksheets(1).Cells(i, 28).Value = 0
                                Texto.Worksheets(1).Cells(i, 29).Value = 0
                            End If
                            'fecha suministro 8, almac|fffd|n 8, cantidad
                            If Sheets(hoja).Range("fecha8").Cells(i, 1).Value <> "" Then
                                If IsNumeric(Sheets(hoja).Range("fecha8").Cells(i, 1).Value) Then
                                    If CDbl(Sheets(hoja).Range("fecha8").Cells(i, 1).Value) < 0 Then
                                        MsgBox Sheets("Languages").Range("Msg15_NoCantNeg")
                                        werror = True
                                        Exit For
                                    Else
                                        Texto.Worksheets(1).Cells(i, 32).Value = Sheets(hoja).Range("fecha8").Cells(i, 1).Value
                                        If CStr(Sheets(hoja).Range("fecha8").Cells(13, 1).Value) <> "" Then
                                            Texto.Worksheets(1).Cells(i, 30).Value = CStr(Sheets(hoja).Range("fecha8").Cells(13, 1).Value)
                                            Texto.Worksheets(1).Cells(i, 30).NumberFormat = "mm/dd/yyyy"
                                        Else
                                             MsgBox Sheets("Languages").Range("Msg23_FaltaFechaSum") & " 8"
                                             werror = True
                                             Exit For
                                            'Texto.Worksheets(1).Cells(i, 29).Value = 0
                                        End If
                                        If Sheets(hoja).Range("almacen8").Cells(i, 1).Value <> "" Then
                                            Texto.Worksheets(1).Cells(i, 31).Value = Sheets(hoja).Range("almacen8").Cells(i, 1).Value
                                        Else
                                            Texto.Worksheets(1).Cells(i, 31).Value = 0
                                        End If
                                    End If
                                Else
                                    MsgBox Sheets("Languages").Range("Msg16_CantidadesNumerico")
                                    werror = True
                                    Exit For
                                End If
                            Else
                                'no hay cantidad de suministro
                                Texto.Worksheets(1).Cells(i, 30).Value = 0
                                Texto.Worksheets(1).Cells(i, 31).Value = 0
                                Texto.Worksheets(1).Cells(i, 32).Value = 0
                            End If
                        End If
                    Next i
                    GoTo y
x:
                    werror = True
                    MsgBox Sheets("Languages").Range("Msg19_DatosErroneos")
y:
                    objdoc.Save
                    Texto.Quit
                    Set Texto = Nothing
                    If werror Then
                        BorrarFicheros
                        MsgBox Sheets("Languages").Range("Msg18_FicheroNoGen")
                    Else
                        MsgBox Sheets("Languages").Range("Msg17_FicheroGen") & "C:\Informes Baan\" & nombrefichero
                    End If
                End If
            End If
        End If
    End If
    Application.ScreenUpdating = True
End Sub

Sub BorrarFicheros()
    Dim fs As Object
    Dim f, f1, fc, s
    Dim fichero As String
      
    Set fs = CreateObject("Scripting.FileSystemObject")
    If fs.FolderExists("C:\Informes Baan") Then
        Set f = fs.GetFolder("C:\Informes Baan\")
        Set fc = f.Files
        For Each f1 In fc
            fichero = f1.Name
            If Mid(fichero, 1, 6) = parte1 Then
                fs.DeleteFile ("c:\Informes Baan\" & parte1 & "-*.txt")
            Else
                If Mid(fichero, 1, 9) = parte1 Then
                  fs.DeleteFile ("c:\Informes Baan\" & parte1 & "-*.txt")
                End If
            End If
        Next
    Else
        fs.createfolder ("C:\Informes Baan\")
    End If
    
End Sub

Sub eguneratu(ByVal hoja As String)
    Dim estudio As String
    taulaFormatua hoja
    estudio = Sheets("Data").Range("tipo_estudio").Value
'    If (Sheets("Data").Range("tipo_estudio").Value = "estudioArgentina") Then
'        eguneratuBoMetik (hoja)
'    Else
'        eguneratuOrokorra (hoja)
'    End If
    Select Case estudio
        Case "estudioArgentina"
            eguneratuArgentina (hoja)
'        Case "estudioChequia"
'            eguneratuZerbitzuekin (hoja)
'        Case "estudioEslovaquia"
'            eguneratuZerbitzuekin (hoja)
'        Case "estudioEspana"
'            eguneratuZerbitzuekin (hoja)
        Case Else
            eguneratuZerbitzuekin (hoja)
    End Select
End Sub



Sub eguneratuOrokorra(ByVal hoja As String)
Application.ScreenUpdating = False
    Application.EnableEvents = False
    'Sheets("Baan").Unprotect
    'Lortu ItemView orriko beharrezko datuak
    Dim zutAlqItemView, zutVentaItemView As String
    Dim lerroHasiItemView, lerroAmaItemView As Integer
    lerroHasiItemView = Sheets("Data").Range("ID_ini").Value
    lerroAmaItemView = Sheets("Data").Range("ID_FinalItemview").Value
    zutAlqItemView = Sheets("Data").Range("ID_ColumItemviewAlquiler").Value
    zutVentaItemView = Sheets("Data").Range("ID_ColumItemviewVenta").Value
    
    
    'goiburua
    
    Dim cliente, codCliente, nomCliente, comercial, codComercial, nomComercial As String
    cliente = Application.Trim(Sheets("BoM").Range("ID_Data_Cliente").Value)
    codCliente = Left(cliente, Application.IfError(Application.Find("//", cliente), 1) - 1)
    nomCliente = Right(cliente, Len(cliente) - (Application.IfError(Application.Find("//", cliente), Len(cliente) - 1) + 1))
    comercial = Application.Trim(Sheets("BoM").Range("ID_Data_CodNomComercial").Value)
    codComercial = Left(comercial, Application.IfError(Application.Find("//", comercial), 1) - 1)
    nomComercial = Right(comercial, Len(comercial) - (Application.IfError(Application.Find("//", comercial), Len(comercial) - 1) + 1))
    If nomCliente = "" And codCliente = "" Then
        nomCliente = cliente
        codCliente = cliente
    End If
    If nomComercial = "" And codComercial = "" Then
        nomComercial = comercial
        codComercial = comercial
    End If
    
    Sheets(hoja).Range("B6").Value = codCliente 'nombre cliente
    Sheets(hoja).Range("D6").Value = nomCliente 'nombre cliente
    Sheets(hoja).Range("B7").Value = codComercial 'Cod Comercial
    Sheets(hoja).Range("D7").Value = nomComercial 'Nom Comercial
    
    Dim ofertaSolicitud, oferta, solicitud As String
    Dim pos As Integer
    ofertaSolicitud = Application.Trim(Sheets("BoM").Range("ID_Data_OfertaSolicitud").Value)
    pos = Application.IfError(Application.Find("//", ofertaSolicitud), -1)
    If (pos > -1) Then
        oferta = ""
        solicitud = Right(ofertaSolicitud, Len(ofertaSolicitud) - (Application.IfError(Application.Find("//", ofertaSolicitud), Len(ofertaSolicitud) - 1) + 1))
    Else
        oferta = Application.Trim(Sheets("BoM").Range("ID_Data_OfertaSolicitud").Value)
        'solicitud = Right(ofertaSolicitud, Len(ofertaSolicitud) - (Application.IfError(Application.Find("//", ofertaSolicitud), Len(ofertaSolicitud) - 1) + 1))
    End If
    If oferta <> "" Then
        Sheets(hoja).Range("B8").Value = oferta 'ofertaSolicitud
    Else
        Sheets(hoja).Range("B8").Value = ""
    End If
    
    Dim codigoItemView, MaterialItemView, CondicionItemView, CantidadesAlquilerItemView, CantidadesVentaItemView, PreciosItemView, FechaSumItemView As String
    
    codigoItemView = "C" 'columna
    MaterialItemView = "D" ' columna
    CondicionItemView = "E" ' columna
    CantidadesAlquilerItemView = "K" 'columna
    CantidadesVentaItemView = "L" 'columna
    PreciosAlquilerItemView = "H" 'columna
    PreciosVentaItemView = "I" 'columna
    PreciosItemView = "J" 'columna
    'PreciosAlquilerItemView = "G" 'columna
    FechaSumItemView = "J6" 'celda
    
    'Baan orriko beharrezko aldagaiak definitu
    Dim lerroHasiBaan, unekoLerroa As Integer
    Dim CodigoBaan, DescripcionBaan, MaterialBaan, CondicionBaan, CalidadBaan, CantidadesBaan, PreciosBaan, ServicioBaan, FechaSumBaan As String
    
    CodigoBaan = "A" 'columna
    DescripcionBaan = "B" 'columna
    'MaterialBaan = "C" 'columna
    'CondicionBaan = "D" 'columna
    CalidadBaan = "C" 'columna
    CantidadesBaan = "G" 'columna
    PreciosVentaBaan = "D" 'columna
    PreciosAlquilerBaan = "E" 'columna
    ServicioBaan = "F" 'columna
    FechaSumBaan = "G13" 'celda
    
    'eguneratu datu denak
    lerroHasBaan = 14 'lerroa
    unekoLerroa = lerroHasBaan
    For i = lerroHasiItemView To lerroAmaItemView
        ModoSum = Application.VLookup(Sheets("ItemView").Range(CondicionItemView & i).Value, Sheets("Data").Range("rangoCondiciones"), 2, 0)
        If ((ModoSum = "=A1Alquiler" And hoja = "Baan_Rental") Or (ModoSum = "=A4Montaje" And hoja = "Baan_Rental") Or (ModoSum = "=A2Venta" And hoja = "Baan_Sale") Or (ModoSum = "=A3Especial" And hoja = "Baan_Sale") Or (ModoSum = "=A5VentaTongada" And hoja = "Baan_Sale")) Then
            cantidad = Sheets("ItemView").Range(CantidadesAlquilerItemView & i).Value + Sheets("ItemView").Range(CantidadesVentaItemView & i).Value 'Cantidades
            If cantidad > 0 Then
                Sheets(hoja).Range(CantidadesBaan & unekoLerroa).Value = cantidad
                Sheets(hoja).Range(CodigoBaan & unekoLerroa).Value = Sheets("ItemView").Range(codigoItemView & i).Value 'Codigo
                Sheets(hoja).Range(DescripcionBaan & unekoLerroa).Value = Sheets("ItemView").Range(MaterialItemView & i).Value 'Descripcion
                'Sheets(hoja).Range(MaterialBaan & unekoLerroa).Value = Sheets("ItemView").Range(MaterialItemView & i).Value 'Material
                'Sheets(hoja).Range(CalidadBaan & unekoLerroa).Interior.Color = RGB(242, 242, 242)
                'Sheets(hoja).Range(CondicionBaan & unekoLerroa).Formula = Sheets("ItemView").Range(CondicionItemView & i).Formula 'Condicion
                Sheets(hoja).Range(CantidadesBaan & unekoLerroa).Value = Sheets("ItemView").Range(CantidadesAlquilerItemView & i).Value + Sheets("ItemView").Range(CantidadesVentaItemView & i).Value 'Cantidades
                Sheets(hoja).Range(FechaSumBaan).Value = Sheets("BoM").Range("ID_Data_FechaINSum").Value 'Fecha Suministro
                Sheets(hoja).Range(PreciosVentaBaan & unekoLerroa).Value = Sheets("ItemView").Range(PreciosVentaItemView & i).Value 'Precios Venta
                If hoja = "Baan_Rental" Then 'Rental bada idatzi alkilerreko prezioak
                    Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroa).Value = Sheets("ItemView").Range(PreciosAlquilerItemView & i).Value 'Precios Alquiler
                Else
                    Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroa).Value = 0
                End If
                Sheets(hoja).Range(ServicioBaan & unekoLerroa).Value = 1
                unekoLerroa = unekoLerroa + 1
            End If
        End If
    Next
    TaulaKoloreak (hoja)
    'Sheets("Baan").Protect
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    
End Sub

Sub eguneratuArgentina(ByVal hoja As String)
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    
    'datuak borratu
    
    BorrarDatos (hoja)
    
    
    'goiburua
    
    Dim cliente, codCliente, nomCliente, comercial, codComercial, nomComercial As String
    cliente = Application.Trim(Sheets("BoM").Range("ID_Data_Cliente").Value)
    codCliente = Left(cliente, Application.IfError(Application.Find("//", cliente), 1) - 1)
    nomCliente = Right(cliente, Len(cliente) - (Application.IfError(Application.Find("//", cliente), Len(cliente) - 1) + 1))
    comercial = Application.Trim(Sheets("BoM").Range("ID_Data_CodNomComercial").Value)
    codComercial = Left(comercial, Application.IfError(Application.Find("//", comercial), 1) - 1)
    nomComercial = Right(comercial, Len(comercial) - (Application.IfError(Application.Find("//", comercial), Len(comercial) - 1) + 1))
    If nomCliente = "" And codCliente = "" Then
        nomCliente = cliente
        codCliente = cliente
    End If
    If nomComercial = "" And codComercial = "" Then
        nomComercial = comercial
        codComercial = comercial
    End If
    Sheets(hoja).Range("B6").Value = codCliente 'nombre cliente
    Sheets(hoja).Range("D6").Value = nomCliente 'nombre cliente
    Sheets(hoja).Range("B7").Value = codComercial 'Cod Comercial
    Sheets(hoja).Range("D7").Value = nomComercial 'Nom Comercial
    Sheets(hoja).Range("B9").Value = Sheets("BoM").Range("ID_Data_CodContrato").Value 'contrato
    
    Dim ofertaSolicitud, oferta, solicitud As String
    Dim pos As Integer
    ofertaSolicitud = Application.Trim(Sheets("BoM").Range("ID_Data_OfertaSolicitud").Value)
    pos = Application.IfError(Application.Find("//", ofertaSolicitud), -1)
    If (pos > -1) Then
        oferta = ""
        solicitud = Right(ofertaSolicitud, Len(ofertaSolicitud) - (Application.IfError(Application.Find("//", ofertaSolicitud), Len(ofertaSolicitud) - 1) + 1))
    Else
        oferta = Application.Trim(Sheets("BoM").Range("ID_Data_OfertaSolicitud").Value)
        'solicitud = Right(ofertaSolicitud, Len(ofertaSolicitud) - (Application.IfError(Application.Find("//", ofertaSolicitud), Len(ofertaSolicitud) - 1) + 1))
    End If
    If oferta <> "" Then
        Sheets(hoja).Range("B8").Value = oferta 'ofertaSolicitud
    Else
        Sheets(hoja).Range("B8").Value = ""
    End If
    
    
    Dim hasLerroaBom, amaLerroaBom, portzLerroaBom, hasZutabeaBom, amaZutabeaBom, tajoBiderLerroaBom, zerrenBiderLerroaBom As Integer
    Dim prezioUdZutBom, prezioSalmZutBom, prezioAlokZutBom, pisuZutBom, kondZutBom, areaZutBom, kodeZutBom, izenZutBom, FechaSumBom As String
    
    hasLerroaBom = Sheets("Data").Range("FilaInicioArticulos").Value
    amaLerroaBom = Sheets("Data").Range("FilaFinArticulos").Value
    tajoBiderLerroaBom = Sheets("Data").Range("NumFilaMultiplicTajo").Value
    zerrenBiderLerroaBom = Sheets("Data").Range("FilaInicioArticulos").Value - 1
    
    hasZutabeaBom = Sheets("Data").Range("NumColumInicioLista").Value
    amaZutabeaBom = Sheets("Data").Range("NumColumFinLista").Value
    portzLerroaBom = Sheets("Data").Range("FilaFinArticulos").Value + 15
    
    kodeZutBom = "D"
    izenZutBom = "E"
    prezioUdZutBom = Sheets("Data").Range("B10").Value
    prezioSalmZutBom = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("B10").Value) - 2)
    prezioAlokZutBom = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("B10").Value) - 4)
    pisuZutBom = Sheets("Data").Range("B11").Value
    kondZutBom = Sheets("Data").Range("B14").Value
    areaZutBom = Sheets("Data").Range("B15").Value
    columnaCheck = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("ColumInicioLista").Value) - 3)
    filaServicio = Application.IfError(Application.Match("Tag_Servicio", Sheets("BoM").Range(columnaCheck & ":" & columnaCheck), 0), 0)
    
    'Baan orriko beharrezko aldagaiak definitu
    Dim lerroHasiBaan, unekoLerroa As Integer
    Dim CodigoBaan, DescripcionBaan, MaterialBaan, CondicionBaan, CalidadBaan, CantidadesBaan, PreciosBaan, ServicioBaan, FechaSumBaan As String
    Dim unekoLerroaBaan As Integer
    
    unekoLerroaBaan = 14
    
    CodigoBaan = "A" 'columna
    DescripcionBaan = "B" 'columna
    'MaterialBaan = "C" 'columna
    'CondicionBaan = "D" 'columna
    CalidadBaan = "C" 'columna
    CantidadesBaan = "G" 'columna
    PreciosVentaBaan = "D" 'columna
    PreciosAlquilerBaan = "E" 'columna
    ServicioBaan = "F" 'columna
    FechaSumBaan = "G13" 'celda
    
    Dim kantTotala As Long
    Dim PrezioSalm, PrezioAlok, area, pisua, portzentaia As Double
    Dim kodea, izena, kond As String
    
    'lerro bakoitzeko
    For i = hasLerroaBom To amaLerroaBom
        'begiratu lista bakoitzean kantitaterik duen
        For j = hasZutabeaBom To amaZutabeaBom
            zutabea = ConvertToLetter(j)
            biderTajo = Sheets("BoM").Range(zutabea & tajoBiderLerroaBom).Value
            biderLista = Sheets("BoM").Range(zutabea & zerrenBiderLerroaBom).Value
            unekoBalioa = Sheets("BoM").Range(zutabea & i).Value
            baliobidertua = unekoBalioa * biderTajo * biderLista
            portzentaia = Sheets("BoM").Range(zutabea & portzLerroaBom).Value
            If (baliobidertua <> 0) Then 'baldin badauka, biderkatu biderkatzaileekin eta hartu portzentaia
              If (CargarDatosBaan.chk_Venta) Then
                PrezioSalm = Sheets("BoM").Range(prezioSalmZutBom & i).Value 'Precios Venta
              Else
                PrezioSalm = 0
              End If
              If (CargarDatosBaan.chk_Alquiler) Then
                    PrezioAlok = prezioaKalkulatuArg(Sheets("BoM").Range(prezioAlokZutBom & i).Value, portzentaia) 'Precios Alquiler
              Else
                    PrezioAlok = 0
              End If
              kodea = Sheets("BoM").Range(kodeZutBom & i).Value
              izena = Sheets("BoM").Range(izenZutBom & i).Value
              kond = Sheets("BoM").Range(kondZutBom & i).Formula
              area = Sheets("BoM").Range(areaZutBom & i).Value
              pisua = Sheets("BoM").Range(pisuZutBom & i).Value
              zerbitzua = Sheets("BoM").Range(zutabea & filaServicio).Value
              If ((kond = "=A1Alquiler" And hoja = "Baan_Rental") Or (kond = "=A4Montaje" And hoja = "Baan_Rental") Or (kond = "=A2Venta" And hoja = "Baan_Sale") Or (kond = "=A3Especial" And hoja = "Baan_Sale") Or (kond = "=A5VentaTongada" And hoja = "Baan_Sale")) Then
                'matchLerroa = Application.IfError(Application.Match(kodea, Sheets(hoja).Range("A1:A250"), 0), 0)
                matchLerroa = bilatuLerroa(hoja, kodea, PrezioSalm, PrezioAlok, zerbitzua)
                If (matchLerroa > 0) Then 'begiratu Baan orrian sartuta dugun
                    prezioaSalmBaan = Sheets(hoja).Range(PreciosVentaBaan & matchLerroa).Value
                    prezioaAlokBaan = Sheets(hoja).Range(PreciosAlquilerBaan & matchLerroa).Value
                    zerbitzuaBaan = Sheets(hoja).Range(ServicioBaan & matchLerroa).Value
                    
                    If (prezioaSalmBaan = PrezioSalm And prezioaAlokBaan = PrezioAlok And zerbitzua = zerbitzuaBaan) Then   'sartuta badago eta prezio/zerbitzu berdina badu, gehitu kantitatea
                        idaztekoBal = Sheets(hoja).Range(CantidadesBaan & matchLerroa).Value + baliobidertua
                        Sheets(hoja).Range(CantidadesBaan & matchLerroa).Value = idaztekoBal
'                        If idaztekoBal < 0 Then
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Font.Color = vbRed
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Interior.Color = RGB(255, 204, 204)
'                        Else
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Font.Color = vbBlack
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Interior.Color = RGB(255, 255, 255)
'                        End If
                    Else 'salmenta prezio ezberdina du, lerro berrian sartu zerbitzu berriaz
                            Sheets(hoja).Range(CodigoBaan & unekoLerroaBaan).Value = kodea 'Codigo
                            Sheets(hoja).Range(DescripcionBaan & unekoLerroaBaan).Value = izena 'Descripcion
                            Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Value = baliobidertua 'Cantidades
'                            If baliobidertua < 0 Then
'                                Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Font.Color = vbRed
'                                Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Interior.Color = RGB(255, 204, 204)
'                            End If
                            Sheets(hoja).Range(FechaSumBaan).Value = Sheets("BoM").Range("ID_Data_FechaINSum").Value 'Fecha Suministro
                            Sheets(hoja).Range(PreciosVentaBaan & unekoLerroaBaan).Value = PrezioSalm 'Precios Venta
                            If hoja = "Baan_Rental" Then 'Rental bada idatzi alkilerreko prezioak
                                Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = PrezioAlok 'Precios Alquiler
                            Else
                                Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = 0
                            End If
'                            If zerbitzua <> "" Then
'                                zerbitzuaBaan = zerbitzua
'                            Else
'                                zerbitzuaBaan = WorksheetFunction.Max(Sheets(hoja).Range("E1:E200")) + 1
'                            End If
                            zerbitzuaBaan = zerbitzua
                            Sheets(hoja).Range(ServicioBaan & unekoLerroaBaan).Value = zerbitzuaBaan
                            unekoLerroaBaan = unekoLerroaBaan + 1
                    End If
                Else 'ez dago zerrendan
                    Sheets(hoja).Range(CodigoBaan & unekoLerroaBaan).Value = kodea 'Codigo
                    Sheets(hoja).Range(DescripcionBaan & unekoLerroaBaan).Value = izena 'Descripcion
                    Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Value = baliobidertua 'Cantidades
'                    If baliobidertua < 0 Then
'                        Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Font.Color = vbRed
'                        Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Interior.Color = RGB(255, 204, 204)
'                    End If
                    Sheets(hoja).Range(FechaSumBaan).Value = Sheets("BoM").Range("ID_Data_FechaINSum").Value 'Fecha Suministro
                    Sheets(hoja).Range(PreciosVentaBaan & unekoLerroaBaan).Value = PrezioSalm 'Precios Venta
                    If hoja = "Baan_Rental" Then 'Rental bada idatzi alkilerreko prezioak
                        Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = PrezioAlok 'Precios Alquiler
                    Else
                        Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = 0
                    End If
'                    If zerbitzua <> "" Then
'                        zerbitzuaBaan = zerbitzua
'                    Else
'                        zerbitzuaBaan = WorksheetFunction.Max(Sheets(hoja).Range("E1:E200")) + 1
'                    End If
                    zerbitzuaBaan = zerbitzua
                    Sheets(hoja).Range(ServicioBaan & unekoLerroaBaan).Value = zerbitzuaBaan
                    unekoLerroaBaan = unekoLerroaBaan + 1
                End If
            End If
         End If
       Next
    Next
    TaulaKoloreak (hoja)
    Application.ScreenUpdating = True
    Application.EnableEvents = True
End Sub

Sub eguneratuZerbitzuekin(ByVal hoja As String)
Application.ScreenUpdating = False
    Application.EnableEvents = False
    
    'datuak borratu
    
    BorrarDatos (hoja)
    
    
    'goiburua
    
    Dim cliente, codCliente, nomCliente, comercial, codComercial, nomComercial As String
    cliente = Application.Trim(Sheets("BoM").Range("ID_Data_Cliente").Value)
    codCliente = Left(cliente, Application.IfError(Application.Find("//", cliente), 1) - 1)
    nomCliente = Right(cliente, Len(cliente) - (Application.IfError(Application.Find("//", cliente), Len(cliente) - 1) + 1))
    comercial = Application.Trim(Sheets("BoM").Range("ID_Data_CodNomComercial").Value)
    codComercial = Left(comercial, Application.IfError(Application.Find("//", comercial), 1) - 1)
    nomComercial = Right(comercial, Len(comercial) - (Application.IfError(Application.Find("//", comercial), Len(comercial) - 1) + 1))
    If nomCliente = "" And codCliente = "" Then
        nomCliente = cliente
        codCliente = cliente
    End If
    If nomComercial = "" And codComercial = "" Then
        nomComercial = comercial
        codComercial = comercial
    End If
    Sheets(hoja).Range("B6").Value = codCliente 'nombre cliente
    Sheets(hoja).Range("D6").Value = nomCliente 'nombre cliente
    Sheets(hoja).Range("B7").Value = codComercial 'Cod Comercial
    Sheets(hoja).Range("D7").Value = nomComercial 'Nom Comercial
    Sheets(hoja).Range("B9").Value = Sheets("BoM").Range("ID_Data_CodContrato").Value 'contrato
    
    Dim ofertaSolicitud, oferta, solicitud As String
    Dim pos As Integer
    ofertaSolicitud = Application.Trim(Sheets("BoM").Range("ID_Data_OfertaSolicitud").Value)
    pos = Application.IfError(Application.Find("//", ofertaSolicitud), -1)
    If (pos > -1) Then
        oferta = ""
        solicitud = Right(ofertaSolicitud, Len(ofertaSolicitud) - (Application.IfError(Application.Find("//", ofertaSolicitud), Len(ofertaSolicitud) - 1) + 1))
    Else
        oferta = Application.Trim(Sheets("BoM").Range("ID_Data_OfertaSolicitud").Value)
        'solicitud = Right(ofertaSolicitud, Len(ofertaSolicitud) - (Application.IfError(Application.Find("//", ofertaSolicitud), Len(ofertaSolicitud) - 1) + 1))
    End If
    If oferta <> "" Then
        Sheets(hoja).Range("B8").Value = oferta 'ofertaSolicitud
    Else
        Sheets(hoja).Range("B8").Value = ""
    End If
    
    
    Dim hasLerroaBom, amaLerroaBom, portzLerroaBom, hasZutabeaBom, amaZutabeaBom, tajoBiderLerroaBom, zerrenBiderLerroaBom As Integer
    Dim prezioUdZutBom, prezioSalmZutBom, prezioAlokZutBom, pisuZutBom, kondZutBom, areaZutBom, kodeZutBom, izenZutBom, FechaSumBom As String
    
    hasLerroaBom = Sheets("Data").Range("FilaInicioArticulos").Value
    amaLerroaBom = Sheets("Data").Range("FilaFinArticulos").Value
    tajoBiderLerroaBom = Sheets("Data").Range("NumFilaMultiplicTajo").Value
    zerrenBiderLerroaBom = Sheets("Data").Range("FilaInicioArticulos").Value - 1
    
    hasZutabeaBom = Sheets("Data").Range("NumColumInicioLista").Value
    amaZutabeaBom = Sheets("Data").Range("NumColumFinLista").Value
    portzLerroaBom = Sheets("Data").Range("FilaFinArticulos").Value + 15
    
    kodeZutBom = "D"
    izenZutBom = "E"
    prezioUdZutBom = Sheets("Data").Range("B10").Value
    prezioSalmZutBom = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("B10").Value) - 2)
    prezioAlokZutBom = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("B10").Value) - 4)
    pisuZutBom = Sheets("Data").Range("B11").Value
    kondZutBom = Sheets("Data").Range("B14").Value
    areaZutBom = Sheets("Data").Range("B15").Value
    columnaCheck = ConvertToLetter(ConvertToNumber(Sheets("Data").Range("ColumInicioLista").Value) - 3)
    filaServicio = Application.IfError(Application.Match("Tag_Servicio", Sheets("BoM").Range(columnaCheck & ":" & columnaCheck), 0), 0)
    
    'Baan orriko beharrezko aldagaiak definitu
    Dim lerroHasiBaan, unekoLerroa As Integer
    Dim CodigoBaan, DescripcionBaan, MaterialBaan, CondicionBaan, CalidadBaan, CantidadesBaan, PreciosBaan, ServicioBaan, FechaSumBaan As String
    Dim unekoLerroaBaan As Integer
    
    unekoLerroaBaan = 14
    
    CodigoBaan = "A" 'columna
    DescripcionBaan = "B" 'columna
    'MaterialBaan = "C" 'columna
    'CondicionBaan = "D" 'columna
    CalidadBaan = "C" 'columna
    CantidadesBaan = "G" 'columna
    PreciosVentaBaan = "D" 'columna
    PreciosAlquilerBaan = "E" 'columna
    ServicioBaan = "F" 'columna
    FechaSumBaan = "G13" 'celda
    
    Dim kantTotala As Long
    Dim PrezioSalm, PrezioAlok, area, pisua, portzentaia As Double
    Dim kodea, izena, kond As String
    
    'lerro bakoitzeko
    For i = hasLerroaBom To amaLerroaBom
        'begiratu lista bakoitzean kantitaterik duen
        For j = hasZutabeaBom To amaZutabeaBom
            zutabea = ConvertToLetter(j)
            biderTajo = Sheets("BoM").Range(zutabea & tajoBiderLerroaBom).Value
            biderLista = Sheets("BoM").Range(zutabea & zerrenBiderLerroaBom).Value
            unekoBalioa = Sheets("BoM").Range(zutabea & i).Value
            baliobidertua = unekoBalioa * biderTajo * biderLista
            If (baliobidertua <> 0) Then 'baldin badauka, biderkatu biderkatzaileekin eta hartu portzentaia
              If (CargarDatosBaan.chk_Venta) Then
                PrezioSalm = Sheets("BoM").Range(prezioSalmZutBom & i).Value 'Precios Venta
              Else
                PrezioSalm = 0
              End If
              If (CargarDatosBaan.chk_Alquiler) Then
                    PrezioAlok = Sheets("BoM").Range(prezioAlokZutBom & i).Value 'Precios Alquiler
              Else
                    PrezioAlok = 0
              End If
              kodea = Sheets("BoM").Range(kodeZutBom & i).Value
              izena = Sheets("BoM").Range(izenZutBom & i).Value
              kond = Sheets("BoM").Range(kondZutBom & i).Formula
              area = Sheets("BoM").Range(areaZutBom & i).Value
              pisua = Sheets("BoM").Range(pisuZutBom & i).Value
              zerbitzua = Sheets("BoM").Range(zutabea & filaServicio).Value
              If ((kond = "=A1Alquiler" And hoja = "Baan_Rental") Or (kond = "=A4Montaje" And hoja = "Baan_Rental") Or (kond = "=A2Venta" And hoja = "Baan_Sale") Or (kond = "=A3Especial" And hoja = "Baan_Sale") Or (kond = "=A5VentaTongada" And hoja = "Baan_Sale")) Then
                'matchLerroa = Application.IfError(Application.Match(kodea, Sheets(hoja).Range("A1:A250"), 0), 0)
                matchLerroa = bilatuLerroa(hoja, kodea, PrezioSalm, PrezioAlok, zerbitzua)
                If (matchLerroa > 0) Then 'begiratu Baan orrian sartuta dugun
                    prezioaSalmBaan = Sheets(hoja).Range(PreciosVentaBaan & matchLerroa).Value
                    prezioaAlokBaan = Sheets(hoja).Range(PreciosAlquilerBaan & matchLerroa).Value
                    zerbitzuaBaan = Sheets(hoja).Range(ServicioBaan & matchLerroa).Value
                    If (prezioaSalmBaan = PrezioSalm And prezioaAlokBaan = PrezioAlok And zerbitzua = zerbitzuaBaan) Then   'sartuta badago eta prezio/zerbitzu berdina badu, gehitu kantitatea
                        idaztekoBal = Sheets(hoja).Range(CantidadesBaan & matchLerroa).Value + baliobidertua
                        Sheets(hoja).Range(CantidadesBaan & matchLerroa).Value = idaztekoBal
'                        If idaztekoBal < 0 Then
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Font.Color = vbRed
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Interior.Color = RGB(255, 204, 204)
'                        Else
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Font.Color = vbBlack
'                                Sheets(hoja).Range(CantidadesBaan & matchLerroa).Interior.Color = RGB(255, 255, 255)
'                        End If
                    Else 'salmenta prezio ezberdina du, lerro berrian sartu
                            Sheets(hoja).Range(CodigoBaan & unekoLerroaBaan).Value = kodea 'Codigo
                            Sheets(hoja).Range(DescripcionBaan & unekoLerroaBaan).Value = izena 'Descripcion
                            Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Value = baliobidertua 'Cantidades
'                            If baliobidertua < 0 Then
'                                Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Font.Color = vbRed
'                                Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Interior.Color = RGB(255, 204, 204)
'                            End If
                            Sheets(hoja).Range(FechaSumBaan).Value = Sheets("BoM").Range("ID_Data_FechaINSum").Value 'Fecha Suministro
                            Sheets(hoja).Range(PreciosVentaBaan & unekoLerroaBaan).Value = PrezioSalm 'Precios Venta
                            If hoja = "Baan_Rental" Then 'Rental bada idatzi alkilerreko prezioak
                                Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = PrezioAlok 'Precios Alquiler
                            Else
                                Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = 0
                            End If
'                            If zerbitzua <> "" Then
'                                zerbitzuaBaan = zerbitzua
'                            Else
'                                zerbitzuaBaan = WorksheetFunction.Max(Sheets(hoja).Range("E1:E200")) + 1
'                            End If
                            zerbitzuaBaan = zerbitzua
                            Sheets(hoja).Range(ServicioBaan & unekoLerroaBaan).Value = zerbitzuaBaan
                            unekoLerroaBaan = unekoLerroaBaan + 1
                    End If
                Else 'ez dago zerrendan
                    Sheets(hoja).Range(CodigoBaan & unekoLerroaBaan).Value = kodea 'Codigo
                    Sheets(hoja).Range(DescripcionBaan & unekoLerroaBaan).Value = izena 'Descripcion
                    Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Value = baliobidertua 'Cantidades
'                    If baliobidertua < 0 Then
'                                Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Font.Color = vbRed
'                                Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Interior.Color = RGB(255, 204, 204)
'                    End If
                    Sheets(hoja).Range(FechaSumBaan).Value = Sheets("BoM").Range("ID_Data_FechaINSum").Value 'Fecha Suministro
                    Sheets(hoja).Range(PreciosVentaBaan & unekoLerroaBaan).Value = PrezioSalm 'Precios Venta
                    If hoja = "Baan_Rental" Then 'Rental bada idatzi alkilerreko prezioak
                        Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = PrezioAlok 'Precios Alquiler
                    Else
                        Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = 0
                    End If
'                    If zerbitzua <> "" Then
'                        zerbitzuaBaan = zerbitzua
'                    Else
'                        zerbitzuaBaan = WorksheetFunction.Max(Sheets(hoja).Range("E1:E200")) + 1
'                    End If
                    zerbitzuaBaan = zerbitzua
                    Sheets(hoja).Range(ServicioBaan & unekoLerroaBaan).Value = zerbitzuaBaan
                    unekoLerroaBaan = unekoLerroaBaan + 1
                End If
            End If
         End If
       Next
    Next
    TaulaKoloreak (hoja)
    Application.ScreenUpdating = True
    Application.EnableEvents = True
End Sub


Function prezioaKalkulatuArg(ByVal prezioa As Double, ByVal portzentaia As Double) As Double
    If portzentaia <> 0 Then
        prezioaTotala = prezioa + (prezioa * portzentaia)
    Else
        prezioaTotala = prezioa
    End If
    prezioaKalkulatuArg = prezioaTotala / Sheets("Baan_Rental").Range("ID_Baan_Cotizacion").Value / Sheets("Baan_Rental").Range("ID_Baan_Dias").Value
End Function

Sub BorrarDatos(ByVal hoja As String)
    'borratu taula
    Sheets(hoja).Range("A14:V1500").Value = ""
    'borratu fecha Sum
    Sheets(hoja).Range("G13,I13,K13,M13,O13,Q13,S13,U13").Value = ""
End Sub


Sub DoituCZSK()
    'ezabatu behar ez diren zutabeak
    Sheets("Baan_Rental").Columns("H:U").EntireColumn.Delete
    Sheets("Baan_Sale").Columns("H:U").EntireColumn.Delete
    
End Sub


Sub SartuBuruaCZSK(ByVal hoja As String, ByVal unekoLerroaBaan As Integer)

    Dim CodigoBaan, MaterialBaan, CondicionBaan, CalidadBaan, CantidadesBaan, PreciosBaan, ServicioBaan, FechaSumBaan As String

    
    CodigoBaan = "A" 'columna
    CalidadBaan = "B" 'columna
    CantidadesBaan = "F" 'columna
    PreciosVentaBaan = "C" 'columna
    PreciosAlquilerBaan = "D" 'columna
    ServicioBaan = "E" 'columna
    FechaSumBaan = "F13" 'celda


    Sheets(hoja).Range(CodigoBaan & unekoLerroaBaan).Value = "Q180999" 'Codigo
    If hoja = "Baan_Rental" Then
        Sheets(hoja).Range(CalidadBaan & unekoLerroaBaan).Value = "U0" 'kalitatea
    Else
        Sheets(hoja).Range(CalidadBaan & unekoLerroaBaan).Value = "N" 'kalitatea
    End If
    Sheets(hoja).Range(PreciosVentaBaan & unekoLerroaBaan).Value = 0.01 'Prezioa
    Sheets(hoja).Range(PreciosAlquilerBaan & unekoLerroaBaan).Value = 0 'Precios Alquiler beti 0 (Baanek kalkulatuta
    Sheets(hoja).Range(ServicioBaan & unekoLerroaBaan).Value = 2 'Zerbitzua
    Sheets(hoja).Range(CantidadesBaan & unekoLerroaBaan).Value = 0.1 'Cantidades
    
End Sub

Sub ZerbitzuakCZSK(ByVal hoja As String, ByVal azkenLerroa As Integer)

    Dim ServicioBaan As String
    ServicioBaan = "E" 'columna
    Dim zerbitzuZerrenda As New Scripting.Dictionary
    Dim zein, zerbitzua As Integer
    zein = 1
    For i = 14 To azkenLerroa
        zerbitzua = Sheets(hoja).Range(ServicioBaan & i).Value
        If Not zerbitzuZerrenda.Exists(zerbitzua) Then
            zerbitzuZerrenda.Add Key:=zerbitzua, Item:=zein
            Sheets(hoja).Range(ServicioBaan & i).Value = zein
            zein = zein + 1
        Else
            Sheets(hoja).Range(ServicioBaan & i).Value = zerbitzuZerrenda(zerbitzua)
        End If
    Next
End Sub

Sub eliminaCotizacionArgentina()
    Sheets("Baan_Rental").Range("O6:O7").Value = ""
    Sheets("Baan_Rental").Range("Q6:Q7").Formula = ""
    Sheets("Baan_Sale").Range("O6:O7").Value = ""
    Sheets("Baan_Sale").Range("Q6:Q7").Formula = ""
End Sub


Sub eliminaLineasNegativas(ByVal hoja As String)
    Dim inicio, fin, j, i As Integer
    Dim deleted As Boolean
    inicio = 14
    fin = 2000
    i = inicio
    Do While i <= fin
        deleted = False
        j = 7
        Do While j < 22 And deleted = False
            If Not (Len(Trim(Sheets(hoja).Cells(i, j).Value)) = 0) Then
                If CDbl(Sheets(hoja).Cells(i, j).Value) <= 0 Then
                    Sheets(hoja).Rows(i).EntireRow.Delete
                    deleted = True
                End If
            End If
            j = j + 2
        Loop
        If deleted = False Then
            i = i + 1
        End If
    Loop
End Sub

Function comprobarDatosCabecera(ByVal hoja As String) As Boolean
    Dim codCliente, codComercial, codOferta, codContrato, fechaSum As String
    Dim correcto As Boolean
    correcto = True
    codCliente = Sheets(hoja).Range("Cliente").Value
    codComercial = Sheets(hoja).Range("Comercial").Value
    codOferta = Sheets(hoja).Range("Oferta").Value
    codContrato = Sheets(hoja).Range("Contrato").Value
    fechaSum = Sheets(hoja).Range("G13").Value
    If codCliente = "" Then
        MsgBox hoja & ": " & Sheets("Languages").Range("Msg20_FaltaCodCliente").Value
        correcto = False
    End If
    If codComercial = "" Then
        MsgBox hoja & ": " & Sheets("Languages").Range("Msg21_FaltaCodComercial").Value
        correcto = False
    End If
    If codOferta = "" And codContrato = "" Then
        MsgBox hoja & ": " & Sheets("Languages").Range("Msg22_FaltaCodOfertaContrato").Value
        correcto = False
    End If
    If fechaSum = "" Then
        MsgBox hoja & ": " & Sheets("Languages").Range("Msg23_FaltaFechaSum").Value
        correcto = False
    End If
    comprobarDatosCabecera = correcto
End Function

Function cabecerasIguales() As Boolean
    Dim codClienteRental, codComercialRental, codOfertaRental, codContratoRental, fechaSumRental As String
    Dim codClienteSale, codComercialSale, codOfertaSale, codContratoSale, fechaSumSale As String
    Dim iguales As Boolean
    iguales = False
    codClienteRental = Sheets("Baan_Rental").Range("Cliente").Value
    codComercialRental = Sheets("Baan_Rental").Range("Comercial").Value
    codOfertaRental = Sheets("Baan_Rental").Range("Oferta").Value
    codContratoRental = Sheets("Baan_Rental").Range("Contrato").Value
    fechaSumRental = Sheets("Baan_Rental").Range("G13").Value
    codClienteSale = Sheets("Baan_Sale").Range("Cliente").Value
    codComercialSale = Sheets("Baan_Sale").Range("Comercial").Value
    codOfertaSale = Sheets("Baan_Sale").Range("Oferta").Value
    codContratoSale = Sheets("Baan_Sale").Range("Contrato").Value
    fechaSumSale = Sheets("Baan_Sale").Range("G13").Value
    If codClienteRental = codClienteSale And codComercialRental = codComercialSale And codOfertaRental = codOfertaSale And codContratoRental = codContratoSale And fechaSumRental = fechaSumSale Then
        iguales = True
    End If
    cabecerasIguales = iguales
End Function


Function bilatuLerroa(ByVal hoja As String, ByVal kodea As String, ByVal PrezioSalm As Double, ByVal PrezioAlok As Double, ByVal zerbitzua As String) As Integer
    'lehenengo sortu konkatenatutako zerrenda BP zutabean
'    For i = 14 To 151
'        Sheets(hoja).Range("BP" & i).Value = Sheets(hoja).Range("A" & i) & "_" & Sheets(hoja).Range("C" & i) & "_" & Sheets(hoja).Range("D" & i) & "_" & Sheets(hoja).Range("E" & i)
'    Next
    lerroa = Application.IfError(Application.Match(kodea & "_" & PrezioSalm & "_" & Application.Round(PrezioAlok, 4) & "_" & zerbitzua, Sheets(hoja).Range("BP1:BP250"), 0), 0)
    'hustu BP zutabea
'    Sheets(hoja).Range("BP:BP").Value = ""
    bilatuLerroa = lerroa
End Function

Sub taulaFormatua(ByVal hoja As String)
    Sheets(hoja).Range("BT12:CO12").Copy
    Sheets(hoja).Range("A14:V160").PasteSpecial xlFormats
    If ActiveSheet.Name = hoja Then
        Sheets(hoja).Range("A1").Select
    Else
        Sheets(hoja).Activate
        Sheets(hoja).Range("A1").Select
        If hoja = "Baan_Rental" Then
            Sheets("Baan_Sale").Activate
        Else
            Sheets("Baan_Rental").Activate
        End If
    End If
    'Sheets(hoja).Range("A1").Select
End Sub


Sub TaulaKoloreak(ByVal hoja As String)
    egoera1 = Application.ScreenUpdating
    egoera2 = Application.EnableEvents
    inicio = 14
    fin = 160
    LehenZut = 7
    AzkenZut = 21
    For i = inicio To fin
        j = LehenZut
        Do While j <= AzkenZut
            If Sheets(hoja).Cells(i, j).Value <= 0 Then
                Sheets(hoja).Cells(i, j).Font.Color = vbRed
                Sheets(hoja).Cells(i, j).Interior.Color = RGB(255, 204, 204)
            Else
                Sheets(hoja).Cells(i, j).Font.Color = vbBlack
                Sheets(hoja).Cells(i, j).Interior.Color = RGB(255, 255, 255)
            End If
            j = j + 2
        Loop
    Next
    Application.ScreenUpdating = egoera1
    Application.EnableEvents = egoera2
End Sub

Attribute VB_Name = "Ma11_Descuentos"
Sub copiasBoM()
    Application.ScreenUpdating = False
    ezabatu
    Sheets("BoM").Copy After:=Worksheets("ItemView")
    Sheets("BoM (2)").Name = "Alquiler"
    Sheets("Alquiler").Unprotect
    Sheets("Alquiler").Tab.Color = RGB(204, 255, 229) 'Urdina
    Sheets("BoM").Copy After:=Worksheets("Alquiler")
    Sheets("BoM (2)").Name = "Venta"
    Sheets("Venta").Unprotect
    Sheets("Venta").Tab.Color = RGB(204, 255, 229) 'Urdina
    Sheets("BoM").Copy After:=Worksheets("Venta")
    Sheets("BoM (2)").Name = "Especial"
    Sheets("Especial").Unprotect
    Sheets("Especial").Tab.Color = RGB(204, 255, 229) 'Urdina
    ThisWorkbook.Sheets.Add After:=Worksheets(Worksheets.Count)
    Sheets(Worksheets.Count).Name = "Resumen"
    Sheets("Resumen").Move Before:=Sheets("Alquiler")
    Dim inicio As Integer
    inicio = Worksheets("Data").Range("FilaInicioArticulos").Value
    Dim fin As Integer
    fin = Worksheets("Data").Range("FilaFinArticulos").Value
    Dim FinTemp As Integer
    Dim rowind As Integer
    rowind = inicio
    FinTemp = fin
    Do While rowind <= FinTemp
       If Sheets("Alquiler").Range(Sheets("Data").Range("B14").Value & rowind).Value = "Alquiler" Or Sheets("Alquiler").Range(Sheets("Data").Range("B14").Value & rowind).Value = ("Montaje") Then
            rowind = rowind + 1
        Else
            Sheets("Alquiler").Rows(rowind).EntireRow.Delete
            FinTemp = FinTemp - 1
       End If
    Loop
    For i = FinTemp + 1 To FinTemp + 3
            Sheets("Alquiler").Rows(i).Replace what:="FilaFinArticulos", replacement:=FinTemp, lookat:=xlPart, MatchCase:=False
            Sheets("Alquiler").Rows(i).Replace what:="PrecioUd", replacement:="""" & Sheets("Data").Range("B10").Value & inicio & ":" & Sheets("Data").Range("B10").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
            Sheets("Alquiler").Rows(i).Replace what:="PesoUd", replacement:="""" & Sheets("Data").Range("B11").Value & inicio & ":" & Sheets("Data").Range("B11").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
            Sheets("Alquiler").Rows(i).Replace what:="SuperficieUd", replacement:="""" & Sheets("Data").Range("B15").Value & inicio & ":" & Sheets("Data").Range("B15").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
    Next
    
    deskontua FinTemp, "Alquiler", "BAREMO:", "TOTAL BAREMO:"
    Sheets("Alquiler").Range(Sheets("Data").Range("B14").Value & inicio & ":" & Sheets("Data").Range("B14").Value & FinTemp).Locked = True
    Sheets("Alquiler").Protect
    rowind = inicio
    FinTemp = fin
    Do While rowind <= FinTemp
       If Sheets("Venta").Range(Sheets("Data").Range("B14").Value & rowind).Value = "Venta" Or Sheets("Venta").Range(Sheets("Data").Range("B14").Value & rowind).Value = ("Venta-Tongada") Then
            rowind = rowind + 1
       Else
            Sheets("Venta").Rows(rowind).EntireRow.Delete
            FinTemp = FinTemp - 1
       End If
    Loop
    For i = FinTemp + 1 To FinTemp + 3
            Sheets("Venta").Rows(i).Replace what:="FilaFinArticulos", replacement:=FinTemp, lookat:=xlPart, MatchCase:=False
            Sheets("Venta").Rows(i).Replace what:="PrecioUd", replacement:="""" & Sheets("Data").Range("B10").Value & inicio & ":" & Sheets("Data").Range("B10").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
            Sheets("Venta").Rows(i).Replace what:="PesoUd", replacement:="""" & Sheets("Data").Range("B11").Value & inicio & ":" & Sheets("Data").Range("B11").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
            Sheets("Venta").Rows(i).Replace what:="SuperficieUd", replacement:="""" & Sheets("Data").Range("B15").Value & inicio & ":" & Sheets("Data").Range("B15").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
    Next
    deskontua FinTemp, "Venta", "DESCUENTO:", "TOTAL DESCUENTO:"
    Sheets("Venta").Range(Sheets("Data").Range("B14").Value & inicio & ":" & Sheets("Data").Range("B14").Value & FinTemp).Locked = True
    Sheets("Venta").Protect
    rowind = inicio
    FinTemp = fin
    Do While rowind <= FinTemp
       If Sheets("Especial").Range(Sheets("Data").Range("B14").Value & rowind).Value = "Especial" Then
            rowind = rowind + 1
       Else
            Sheets("Especial").Rows(rowind).EntireRow.Delete
            FinTemp = FinTemp - 1
       End If
    Loop
    For i = FinTemp + 1 To FinTemp + 3
            Sheets("Especial").Rows(i).Replace what:="FilaFinArticulos", replacement:=FinTemp, lookat:=xlPart, MatchCase:=False
            Sheets("Especial").Rows(i).Replace what:="PrecioUd", replacement:="""" & Sheets("Data").Range("B10").Value & inicio & ":" & Sheets("Data").Range("B10").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
            Sheets("Especial").Rows(i).Replace what:="PesoUd", replacement:="""" & Sheets("Data").Range("B11").Value & inicio & ":" & Sheets("Data").Range("B11").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
            Sheets("Especial").Rows(i).Replace what:="SuperficieUd", replacement:="""" & Sheets("Data").Range("B15").Value & inicio & ":" & Sheets("Data").Range("B15").Value & FinTemp & """", lookat:=xlPart, MatchCase:=False
    Next
    deskontua FinTemp, "Especial", "DESCUENTO:", "TOTAL DESCUENTO:"
    Sheets("Especial").Range(Sheets("Data").Range("B14").Value & inicio & ":" & Sheets("Data").Range("B14").Value & FinTemp).Locked = True
    Sheets("Especial").Protect
    Application.ScreenUpdating = True
End Sub

Sub ezabatu()
    For Each Sheet In ThisWorkbook.Sheets
        If Sheet.Name = "Resumen" Or Sheet.Name = "Alquiler" Or Sheet.Name = "Venta" Or Sheet.Name = "Especial" Then
            If Sheet.Protect = True Then
                Sheet.Unprotect
            End If
            Sheet.Delete
        End If
    Next
End Sub

Sub deskontua(ByVal FinTemp As Integer, ByVal orria As String, ByVal texto1 As String, ByVal texto2 As String)
    'Formatuak ipini
    Sheets(orria).Cells(FinTemp + 2, Sheets("Data").Range("NumColumInicioLista").Value - 2).Copy
    Sheets(orria).Cells(FinTemp + 4, Sheets("Data").Range("NumColumInicioLista").Value - 2).PasteSpecial (xlPasteFormats)
    Sheets(orria).Cells(FinTemp + 2, Sheets("Data").Range("NumColumInicioLista").Value - 2).Copy
    Sheets(orria).Cells(FinTemp + 5, Sheets("Data").Range("NumColumInicioLista").Value - 2).PasteSpecial (xlPasteFormats)
    Application.CutCopyMode = False
    Sheets(orria).Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 2) & FinTemp + 4 & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 1) & FinTemp + 4).Merge
    Sheets(orria).Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 2) & FinTemp + 4).Value = texto1
    Sheets(orria).Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 2) & FinTemp + 5 & ":" & ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 1) & FinTemp + 5).Merge
    Sheets(orria).Range(ConvertToLetter(Sheets("Data").Range("NumColumInicioLista").Value - 2) & FinTemp + 5).Value = texto2
    Dim t As Integer
    For t = Sheets("Data").Range("NumColumInicioLista").Value To Sheets("Data").Range("NumColumFinLista").Value
        Sheets(orria).Range(ConvertToLetter(t) & FinTemp + 5).Formula = "=" & ConvertToLetter(t) & (FinTemp + 1) & " - (" & ConvertToLetter(t) & (FinTemp + 1) & "*" & ConvertToLetter(t) & (FinTemp + 4) & "/100)"
        'Formatua kopiatu deskontuarentzat
        Sheets(orria).Cells(FinTemp + 3, t).Copy
        Sheets(orria).Cells(FinTemp + 5, t).PasteSpecial (xlPasteFormats)
        'Formatua kopiatu deskontu totalarentzat
        Sheets(orria).Cells(FinTemp + 3, t).Copy
        Sheets(orria).Cells(FinTemp + 5, t).PasteSpecial (xlPasteFormats)
        Application.CutCopyMode = False
    Next
End Sub
Attribute VB_Name = "Ma12_Czech_Slovakia"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     CZ/SK EXPORT
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Sub exportSteny()
    Dim xlObj As Object
    Dim ML As Object
    Set xlObj = CreateObject("Excel.Application")
    xlObj.Visible = False
    Set ML = xlObj.Workbooks.Open("c:\Ulma\Repcon_57\s26\data\doctemplates\CZ_template.xlsm", UpdateLinks:=False)
    xlObj.EnableEvents = False
    Dim inicio As Integer
    inicio = ThisWorkbook.Worksheets("Data").Range("FilaInicioArticulos").Value
    Dim fin As Integer
    fin = ThisWorkbook.Worksheets("Data").Range("FilaFinArticulos").Value
    xlObj.ScreenUpdating = False
    xlObj.EnableEvents = False
    'xlObj.Visible = True
    'xlObj.Calculation = xlCalculationManual
    xlObj.DisplayStatusBar = False
    xlObj.Sheets("TO BnJ").DisplayPageBreaks = False
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.Calculation = xlCalculationManual
    Application.DisplayStatusBar = False
    
    
    
    
    'Goiburuko datuak
    ML.Sheets("To BnJ").Range("AQ6").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Direccion").Value & "," & ThisWorkbook.Worksheets("BoM").Range("ID_Data_PoblacionCliente").Value 'Direccion
    'ML.Sheets("To BnJ").Range("AQ8").Value = ThisWorkbook.Worksheets("BoM").Range("").Value 'NIF
    ML.Sheets("DATA").Range("B1").Value = "X"
    ML.Sheets("To BnJ").OLEObjects("ComboBox1").Object.AddItem ThisWorkbook.Worksheets("BoM").Range("ID_Data_Cliente").Value 'Cliente
   ML.Sheets("To BnJ").OLEObjects("ComboBox1").Object.Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Cliente").Value 'Cliente
    ML.Sheets("To BnJ").Range("AT5").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Contacto").Value 'COntacto
    ML.Sheets("To BnJ").Range("AT7").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Telefono").Value 'Telefono
    ML.Sheets("To BnJ").Range("AT9").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Email").Value 'Email
    
    'Repconeko zutabe bakoitzeko kantitateak Stenyko zutabeetara
    Dim RepLehenZut, RepAzkenZut, RepExtraZut As String
    RepLehenZut = ThisWorkbook.Worksheets("Data").Range("NumColumInicioLista").Value
    RepAzkenZut = ThisWorkbook.Worksheets("Data").Range("NumColumFinLista").Value
    'RepExtraZut = ConvertToLetter(ConvertToNumber(ThisWorkbook.Worksheets("Data").Range("NumColumFinListaLR").Value) + 2)
    Dim RepCod, RepMod As String
    Dim StLehenZut As String
    StLehenZut = "J"
    Dim StBesteLerroaSale, StBesteLerroaRental, STAzkenLerroaSale, STAzkenLerroaRental As Integer
    StBesteLerroaRental = 1778 'INNI RENTAL zatiko lehen lerroa.
    STAzkenLerroaRental = 1810 'Filtroa ipintzeko azken lerroa
    StBesteLerroaSale = 1888 'INNI SALE (PRODEJ) zatiko lehen lerroa.
    STAzkenLerroaSale = 1920 'Filtroa ipintzeko azken lerroa
    Dim StAzkenZut As String
    StAzkenZut = ConvertToLetter(ConvertToNumber(StLehenZut) + (RepconAzkenZut - RepconLehenZut))
    Dim posizioa As Integer
    Dim StKodZut, StDescZut, StPisuZut, StPrezioZut As String
    StKodZut = "AP"
    StDescZut = "AQ"
    StPisuZut = "AS"
    StPrezioZut = "AU"
    If (ConvertToNumber(StAzkenZut) > 16) Then
        'sortu zutabe berriak
        For t = 1 To ConvertToNumber(RepconAzkenZut - RepconLehenZut)
            'Sartu zuatabea azkenaren ondoan
            'Aldatu azken zutabearen aldagaia
        Next
    End If
    
    For i = inicio To fin
        RepCod = Application.text(ThisWorkbook.Sheets("BoM").Range("D" & i).Value, "0000000") 'Kodigoa
        RepMod = ThisWorkbook.Sheets("BoM").Range("F" & i).Value 'Modo de suministro
        'Modo suministro hau ze formula den ikusi DATA orrian
        RepMod = Application.VLookup(RepMod, Sheets("Data").Range("rangoCondiciones"), 2, 0)
        RepDesc = ThisWorkbook.Sheets("BoM").Range("E" & i).Value 'Deskripzioa
        RepPisu = ThisWorkbook.Sheets("BoM").Range("P" & i).Value 'Pisua
        RepPrezio = ThisWorkbook.Sheets("BoM").Range("N" & i).Value 'Prezioa
        'Bilatu kodea Steny-n badagoen
        posizioa = Application.IfError(Application.Match(Application.text(RepCod, "0000000"), Application.text(ML.Sheets("TO BnJ").Range("AP1:AP1920"), "0000000"), 0), 0) 'AP1-etik egiten da bilaketa, lortutako posizia absolutoa izan dadin
        If (posizioa = 0) Then 'Ez da kodea aurkitu
            'Sartu lerro berria
            'ML.Sheets("TO BnJ").Range(StBesteLerroa & ":" & StBesteLerroa).Copy
            'ML.Sheets("TO BnJ").Rows(StBesteLerroa & ":" & StBesteLerroa).Insert Shift:=xlDown
'            ML.Sheets("TO BnJ").Rows(StBesteLerroa + 1 & ":" & StBesteLerroa + 1).Copy
'            ML.Sheets("TO BnJ").Rows(StBesteLerroa & ":" & StBesteLerroa).PasteSpecial xlPasteFormulas
            'Esleitu posizioari lerro berria
            If (RepMod = "=A1Alquiler") Then 'errentan denez errentako gunean sartuko dugu
                posizioa = StBesteLerroaRental
                StBesteLerroaRental = StBesteLerroaRental + 1
            Else
                posizioa = StBesteLerroaSale
                StBesteLerroaSale = StBesteLerroaSale + 1
            End If
            
            ML.Sheets("TO BnJ").Range(StKodZut & posizioa).Value = CStr(RepCod) 'kodea
            ML.Sheets("TO BnJ").Range(StDescZut & posizioa).Value = CStr(RepDesc) 'deskripzioa
            ML.Sheets("TO BnJ").Range(StPisuZut & posizioa).Value = RepPisu 'pisua
            ML.Sheets("TO BnJ").Range(StPrezioZut & posizioa).Value = RepPrezio 'prezioa
            StBesteLerroa = StBesteLerroa + 1
        End If
        Dim unekoZut As String
        unekoZut = StLehenZut
        For j = RepLehenZut To RepAzkenZut
            kantitatea = ML.Sheets("TO BnJ").Range(unekoZut & posizioa).Value
            kantitatea = kantitatea + ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(j) & i).Value
            ML.Sheets("TO BnJ").Range(unekoZut & posizioa).Value = kantitatea ' kantitatea
            
            unekoZut = ConvertToLetter(ConvertToNumber(unekoZut) + 1)
        Next
    Next
    'filtroa aplikatu kantitate gabeko lerroak ezkutatzeko
    xlObj.ScreenUpdating = True
    xlObj.EnableEvents = True
    xlObj.Calculation = xlCalculationAutomatic
    ML.Sheets("TO BnJ").Range("AN14:AN" & STAzkenLerroaSale).AutoFilter Field:=40, Criteria1:="<>"
    'Gorde eta itxi
    'Gorde
    karpeta = Environ("temp")
    excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    fitxategia = karpeta & "\" & "STENY_" & excelizena
    If Not fitxategia = False Then
        Dim rev As Integer
        rev = 0
        Dim fileTemp As String
        fileTemp = fitxategia & ".xlsm"
        Do While (Not (Dir(fileTemp, vbDirectory) = vbNullString))
            rev = rev + 1
            fileTemp = fitxategia & "_" & rev & ".xslm"
        Loop
        ML.CheckCompatibility = False
        ML.SaveAs fileTemp
        ML.CheckCompatibility = True
    End If
    xlObj.DisplayStatusBar = True
    xlObj.Sheets("TO BnJ").DisplayPageBreaks = True
    xlObj.Visible = True
    xlObj.EnableEvents = True
    Set xlObj = Nothing
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.Calculation = xlCalculationAutomatic
    Application.DisplayStatusBar = True
    
End Sub


Sub exportStenySK()
    Dim xlObj As Object
    Dim ML As Object
    Set xlObj = CreateObject("Excel.Application")
    xlObj.Visible = False
    Set ML = xlObj.Workbooks.Open("c:\Ulma\Repcon_57\s26\data\doctemplates\SK_template.xlsm", UpdateLinks:=False)
    Dim inicio As Integer
    inicio = ThisWorkbook.Worksheets("Data").Range("FilaInicioArticulos").Value
    Dim fin As Integer
    fin = ThisWorkbook.Worksheets("Data").Range("FilaFinArticulos").Value
    xlObj.ScreenUpdating = False
    xlObj.EnableEvents = False
    'xlObj.Calculation = xlCalculationManual
    xlObj.DisplayStatusBar = False
    xlObj.Sheets("K.C._SK").DisplayPageBreaks = False
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.Calculation = xlCalculationManual
    Application.DisplayStatusBar = False
    
    
    
    
    'Goiburuko datuak
    
     ML.Sheets("K.C._SK").Range("AK1").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_CodObra").Value 'Codigo Obra GET
'    ML.Sheets("K.C._SK").Range("AG5").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Direccion").Value & "," & ThisWorkbook.Worksheets("BoM").Range("ID_Data_PoblacionCliente").Value 'Direccion
'    'ML.Sheets("K.C._SK").Range("AQ8").Value = ThisWorkbook.Worksheets("BoM").Range("").Value 'NIF
'    ML.Sheets("K.C._SK").Range("AI4").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Contacto").Value 'COntacto
'    ML.Sheets("K.C._SK").Range("AG4").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Cliente").Value 'Cliente
'    ML.Sheets("K.C._SK").Range("AI5").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Telefono").Value 'Telefono
'    ML.Sheets("K.C._SK").Range("AI6").Value = ThisWorkbook.Worksheets("BoM").Range("ID_Data_Email").Value 'Email
    
    'Repconeko zutabe bakoitzeko kantitateak Stenyko zutabeetara
    Dim RepLehenZut, RepAzkenZut, RepExtraZut As String
    RepLehenZut = ThisWorkbook.Worksheets("Data").Range("NumColumInicioLista").Value
    RepAzkenZut = ThisWorkbook.Worksheets("Data").Range("NumColumFinLista").Value
    'RepExtraZut = ConvertToLetter(ConvertToNumber(ThisWorkbook.Worksheets("Data").Range("NumColumFinListaLR").Value) + 2)
    Dim RepCod, RepMod As String
    Dim StLehenZut As String
    StLehenZut = "C"
    Dim StBesteLerroaSale, StBesteLerroaRental, STAzkenLerroaSale, STAzkenLerroaRental As Integer
    StBesteLerroaRental = 2644 'INNI RENTAL zatiko lehen lerroa.
    STAzkenLerroaRental = 2692 'Filtroa ipintzeko azken lerroa
    'StBesteLerroaSale = 1888 'INNI SALE (PRODEJ) zatiko lehen lerroa.
    'STAzkenLerroaSale = 1920 'Filtroa ipintzeko azken lerroa
    Dim StAzkenZut As String
    StAzkenZut = ConvertToLetter(ConvertToNumber(StLehenZut) + (RepconAzkenZut - RepconLehenZut))
    Dim posizioa As Integer
    Dim StKodZut, StDescZut, StPisuZut, StPrezioZut As String
    StKodZut = "AF"
    StDescZut = "AG"
    StPisuZut = "AI"
    StPrezioZut = "AK"
    If (ConvertToNumber(StAzkenZut) > 16) Then
        'sortu zutabe berriak
        For t = 1 To ConvertToNumber(RepconAzkenZut - RepconLehenZut)
            'Sartu zuatabea azkenaren ondoan
            'Aldatu azken zutabearen aldagaia
        Next
    End If
    
    For i = inicio To fin
        RepCod = Application.text(ThisWorkbook.Sheets("BoM").Range("D" & i).Value, "0000000") 'Kodigoa
        RepMod = ThisWorkbook.Sheets("BoM").Range("F" & i).Value 'Modo de suministro
        'Modo suministro hau ze formula den ikusi DATA orrian
        RepMod = Application.VLookup(RepMod, Sheets("Data").Range("rangoCondiciones"), 2, 0)
        RepDesc = ThisWorkbook.Sheets("BoM").Range("E" & i).Value 'Deskripzioa
        RepPisu = ThisWorkbook.Sheets("BoM").Range("P" & i).Value 'Pisua
        RepPrezio = ThisWorkbook.Sheets("BoM").Range("N" & i).Value 'Prezioa
        'Bilatu kodea Steny-n badagoen
        posizioa = Application.IfError(Application.Match(Application.text(RepCod, "0000000"), Application.text(ML.Sheets("K.C._SK").Range("AF1:AF3030"), "0000000"), 0), 0) 'AP1-etik egiten da bilaketa, lortutako posizia absolutoa izan dadin
        If (posizioa = 0) Then 'Ez da kodea aurkitu
            'Sartu lerro berria
            'ML.Sheets("K.C._SK").Range(StBesteLerroa & ":" & StBesteLerroa).Copy
            'ML.Sheets("K.C._SK").Rows(StBesteLerroa & ":" & StBesteLerroa).Insert Shift:=xlDown
'            ML.Sheets("K.C._SK").Rows(StBesteLerroa + 1 & ":" & StBesteLerroa + 1).Copy
'            ML.Sheets("K.C._SK").Rows(StBesteLerroa & ":" & StBesteLerroa).PasteSpecial xlPasteFormulas
            'Esleitu posizioari lerro berria
'            If (RepMod = "=A1Alquiler") Then 'errentan denez errentako gunean sartuko dugu
'                posizioa = StBesteLerroaRental
'                StBesteLerroaRental = StBesteLerroaRental + 1
'            Else
'                posizioa = StBesteLerroaSale
'                StBesteLerroaSale = StBesteLerroaSale + 1
'            End If
            posizioa = StBesteLerroaRental
            StBesteLerroaRental = StBesteLerroaRental + 1
            ML.Sheets("K.C._SK").Range(StKodZut & posizioa).Value = CStr(RepCod) 'kodea
            ML.Sheets("K.C._SK").Range(StDescZut & posizioa).Value = CStr(RepDesc) 'deskripzioa
            ML.Sheets("K.C._SK").Range(StPisuZut & posizioa).Value = RepPisu 'pisua
            ML.Sheets("K.C._SK").Range(StPrezioZut & posizioa).Value = RepPrezio 'prezioa
            StBesteLerroa = StBesteLerroa + 1
        End If
        Dim unekoZut As String
        unekoZut = StLehenZut
        For j = RepLehenZut To RepAzkenZut
            kantitatea = ML.Sheets("K.C._SK").Range(unekoZut & posizioa).Value
            kantitatea = kantitatea + ThisWorkbook.Sheets("BoM").Range(ConvertToLetter(j) & i).Value
            ML.Sheets("K.C._SK").Range(unekoZut & posizioa).Value = kantitatea ' kantitatea
            unekoZut = ConvertToLetter(ConvertToNumber(unekoZut) + 1)
        Next
    Next
    'filtroa aplikatu kantitate gabeko lerroak ezkutatzeko
    xlObj.ScreenUpdating = True
    xlObj.EnableEvents = True
    xlObj.Calculation = xlCalculationAutomatic
    ML.Sheets("K.C._SK").Range("AE11:AE" & STAzkenLerroaRental).AutoFilter Field:=31, Criteria1:="<>"
    'Gorde eta itxi
    'Gorde
    karpeta = Environ("temp")
    excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    fitxategia = karpeta & "\" & "SK_ItemView_" & excelizena
    If Not fitxategia = False Then
        Dim rev As Integer
        rev = 0
        Dim fileTemp As String
        fileTemp = fitxategia & ".xlsm"
        Do While (Not (Dir(fileTemp, vbDirectory) = vbNullString))
            rev = rev + 1
            fileTemp = fitxategia & "_" & rev & ".xslm"
        Loop
        ML.CheckCompatibility = False
        ML.SaveAs fileTemp
        ML.CheckCompatibility = True
    End If
    xlObj.DisplayStatusBar = True
    xlObj.Sheets("K.C._SK").DisplayPageBreaks = True
    xlObj.Visible = True
    Set xlObj = Nothing
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.Calculation = xlCalculationAutomatic
    Application.DisplayStatusBar = True
    
End Sub
Sub EslovakiaExtraInfo()
    'kopiatu zelden formatua eta itsasi
    Sheets("BoM").Range("D12:H12").Copy
    Sheets("BoM").Range("D13:H14").PasteSpecial Paste:=xlPasteFormats
    Sheets("BoM").Range("D12:H12").Copy
    Sheets("BoM").Range("J14:O14").PasteSpecial Paste:=xlPasteFormats
    Sheets("BoM").Range("N14").Copy
    Sheets("BoM").Range("O14").PasteSpecial Paste:=xlPasteFormats
    Application.CutCopyMode = False
    'idatzi tituloak
    Sheets("BoM").Range("D13").Value = "CODE:"
    Sheets("BoM").Range("D14").Value = "AFT/VTA:"
    Sheets("BoM").Range("J14").Value = "Contract Name:"
    'jarri formulak
    'Sheets("BoM").Range("D14").Formula = "IF"
    'Sheets("BoM").Range("I13").Formula = "IF"
    Sheets("BoM").Range("A1").Select
End Sub

Attribute VB_Name = "Ma14_PrintableSheet"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     PRINTABLE SHEET (GARATU GABE. LC-KOA ERABILI)
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Sub SortuPrintable()
    Dim inicio, fin, inicioP, finP, azkenLerroa As Integer
    Application.ScreenUpdating = False
    inicio = ThisWorkbook.Worksheets("Data").Range("FilaInicioArticulosLR").Value
    fin = ThisWorkbook.Worksheets("Data").Range("FilaFinArticulosLR").Value
    inicioP = 20
    finP = inicioP + (fin - inicio + 1)
    Dim izena As String
    izena = "Printable"
    'Aurretik printable orririk balego ezabatu
    SeekAndDestroy (izena)
    'Sortu Printable Orria
    Dim printOrria, iturburua As String
    printOrria = CreatePrintableSheet(izena)
    iturburua = "BoM"
    'Goiburua Kopiatu
    CopyPasteHeader iturburua, printOrria
    'gorputzeko datuak bete
    fillBody iturburua, printOrria, inicio, fin, inicioP, finP
    'ipini totalak/datu extrak
    createTotals printOrria, inicioP, finP
    'Sartu Disclaimerra
    azkenLerroa = insertDisclaimer(printOrria, inicioP, finP)
    'sartu orri saltoak
    InsertPageBreaks printOrria, inicioP, finP, azkenLerroa
    'ezarri inprimatze area
    With Sheets(printOrria).PageSetup
        .PrintTitleRows = "$1:$20"
        .printArea = "A1:F" & finP + 30
        .Zoom = False
        .FitToPagesWide = 1
        .FitToPagesTall = False
    End With
    'formatu polita eman
    formatKombat printOrria, inicioP, finP
    'PDF botoia ipini
    printToPDF printOrria
    'utzi printable orria aukeratuta
    Sheets(printOrria).Range("A1").Select
    Application.ScreenUpdating = True
End Sub


Sub SeekAndDestroy(ByVal izena As String)
    With ThisWorkbook
        If SheetExists(izena) Then
            .Sheets(izena).Delete
        End If
    End With
End Sub

Function CreatePrintableSheet(ByVal izena As String) As String
    With ThisWorkbook
        .Sheets.Add(After:=.Sheets(.Sheets.Count)).Name = izena
    End With
    CreatePrintableSheet = izena
End Function

Sub CopyPasteHeader(ByVal originSheet As String, ByVal targetSheet As String)
    'logoa ekarri
    Dim Logo As Shape
    Dim tempImageFile As String
    Set Logo = Sheets(originSheet).Shapes("LogoUlma")
    tempImageFile = Environ("temp") & "\image.jpg"
    Save_Object_As_Picture Logo, tempImageFile
    'Sheets(targetSheet).Range("A1").PasteSpecial
    With Sheets(targetSheet).PageSetup
        .RightHeaderPicture.Filename = tempImageFile
        .RightHeader = "&G"
        .HeaderMargin = 50
    End With
    'Sheets(targetSheet).Shapes("Picture 1").Height = 50
    'goiburua ekarri
    Sheets(originSheet).Range("D2:E6").Copy
    Sheets(targetSheet).Range("A6").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets(targetSheet).Range("A6").PasteSpecial Paste:=xlPasteFormats
    Sheets(originSheet).Range("I3:J3").Copy
    Sheets(targetSheet).Range("A11").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets(targetSheet).Range("A11").PasteSpecial Paste:=xlPasteFormats
    Sheets(originSheet).Range("N3:O6").Copy
    Sheets(targetSheet).Range("A12").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets(targetSheet).Range("A12").PasteSpecial Paste:=xlPasteFormats
    'tamaina txikitu
    Sheets(targetSheet).Range("A5:F16").Font.Size = 7
    Sheets(targetSheet).Rows("5:16").RowHeight = 9
End Sub

Function SheetExists(shtName As String, Optional wb As Workbook) As Boolean
    Dim sht As Worksheet

     If wb Is Nothing Then Set wb = ThisWorkbook
     On Error Resume Next
     Set sht = wb.Sheets(shtName)
     On Error GoTo 0
     SheetExists = Not sht Is Nothing
 End Function
 
 
Function Eval(Ref As String)
    Application.Volatile
    Eval = Evaluate(Ref)
End Function

Sub fillBody(ByVal iturburua As String, ByVal printOrria As String, ByVal inicio As Integer, ByVal fin As Integer, ByVal inicioP As Integer, ByVal finP As Integer)
    'Beharrezko zutabeak: C,D,E,H,I,J,M
    Sheets(iturburua).Range("C" & inicio - 1 & ":E" & fin).Copy
    Sheets(printOrria).Range("A" & inicioP).PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets(iturburua).Range("H" & inicio - 1 & ":J" & fin).Copy
    Sheets(printOrria).Range("C" & inicioP).PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Sheets(iturburua).Range("M" & inicio - 1 & ":M" & fin).Copy
    Sheets(printOrria).Range("F" & inicioP).PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    'formatua kopiatu eta itsatsi (Ftik hartzen dugu ez baitu formatu arrarorik balio berdinak agertzen diren kasurako)
    Sheets(iturburua).Range("F" & inicio - 1 & ":F" & fin).Copy
    Sheets(printOrria).Range("A" & inicioP & ":F" & finP).PasteSpecial Paste:=xlPasteFormats

    'aldatu letra tamaina goiburua ez den beste guztiarentzat
    Sheets(printOrria).Range("A" & inicioP & ":F500").Font.Size = 8
    'autofit
    Sheets(printOrria).Range("A1:ZZ999999").Columns.AutoFit
End Sub

Sub InsertPageBreaks(ByVal printOrria As String, ByVal inicioP As Integer, ByVal finP As Integer, ByVal azkenLerroa As Integer)
    Dim lerroKop As Integer
    lerroKop = finP - inicioP + 1
    If lerroKop > 20 And lerroKop <= 46 Then
        Sheets(printOrria).HPageBreaks.Add Before:=Rows(15 + inicioP)
    End If
    If lerroKop > 46 Then
        For i = inicioP To finP
            If i Mod 46 = 0 Then
                Sheets(printOrria).HPageBreaks.Add Before:=Rows(i + inicioP)
            End If
        Next
        If lerroKop Mod 46 > 20 Then
            non = lerroKop + inicioP
            Sheets(printOrria).HPageBreaks.Add Before:=Rows(non)
        End If
    End If
End Sub

Sub createTotals(ByVal printOrria As String, ByVal inicioP As Integer, ByVal finP As Integer)
    Dim TotalsLabel, TotalsFormula, FormulaF, FormulaT, Str, RangeNameValue As String
    Dim TotalLehena As Integer
    TotalLehena = finP + 1
    TotalsLabel = "E"
    TotalsFormula = "F"
    For i = 1 To 10
        FormulaT = "=IFERROR(INDIRECT(CONCATENATE(""T_"",Pregunta_" & i & ")),"""")"
        FormulaF = "=IFERROR(Eval(INDIRECT(CONCATENATE(""F_"",Pregunta_" & i & "))),"""")"
        Sheets(printOrria).Range(TotalsLabel & TotalLehena + i).Formula = FormulaT
        Sheets(printOrria).Range(TotalsFormula & TotalLehena + i).Formula = FormulaF
    Next
    Sheets(printOrria).Range("A" & TotalLehena & ":F500").Font.Size = 8
    Sheets(printOrria).Range("A" & TotalLehena & ":F500").Font.Name = "Arial"
End Sub

Function insertDisclaimer(ByVal printOrria As String, ByVal inicioP As Integer, ByVal finP As Integer) As Integer
    'Disclaimerra beti 25. galdera bezala utziko dugu.
    Dim FormulaT As String
    azkenLerroa = finP + 13
        Sheets(printOrria).Range("A" & azkenLerroa & ":F" & azkenLerroa + 15).Merge
        FormulaT = "=IFERROR(INDIRECT(CONCATENATE(""T_"",Pregunta_25)),"""")"
        Sheets(printOrria).Range("A" & azkenLerroa).WrapText = True
        Sheets(printOrria).Range("A" & azkenLerroa).VerticalAlignment = xlTop
        Sheets(printOrria).Range("A" & azkenLerroa).Font.Size = 8
        Sheets(printOrria).Range("A" & azkenLerroa).Font.Name = "Courier New"
        Sheets(printOrria).Range("A" & azkenLerroa).Font.Bold = True
        Sheets(printOrria).Range("A" & azkenLerroa).Value = FormulaT
    insertDisclaimer = finP + 28
End Function

Private Sub Save_Object_As_Picture(saveObject As Object, imageFileName As String)

    'Save a picture of an object as a JPG/JPEG/GIF/PNG file
    
    'Arguments
    'saveObject     - any object in the CopyPicture method's 'Applies To' list, for example a Range or Shape
    'imageFileName  - the .gif, .jpg, or .png file name (including folder path if required) the picture will be saved as
    
    Dim temporaryChart As ChartObject
     
    Application.ScreenUpdating = False
    
    saveObject.CopyPicture xlScreen, xlPicture
    
    Set temporaryChart = ActiveSheet.ChartObjects.Add(0, 0, saveObject.Width + 1, saveObject.Height + 1)
    With temporaryChart
        .Activate
        .Border.LineStyle = xlLineStyleNone      'No border
        .Chart.Paste
        .Chart.Export imageFileName
        .Delete
    End With
    
    Application.ScreenUpdating = True
    
    Set temporaryChart = Nothing
    
End Sub

Sub formatKombat(ByVal printOrria As String, ByVal inicioP As Integer, ByVal finP As Integer)
    'header
    Sheets(printOrria).Range("A5:D16").Interior.Color = RGB(255, 231, 155)
    With Sheets(printOrria).Range("A5:D16").Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
    With Sheets(printOrria).Range("A5:D16").Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
    With Sheets(printOrria).Range("A5:D16").Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
    With Sheets(printOrria).Range("A5:D16").Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
    Sheets(printOrria).Range("A20:F20").Interior.Color = RGB(255, 196, 9)
    'kantitateen zutabeari kendu dezimalak
    Sheets(printOrria).Range("F" & inicioP & ":F" & finP).NumberFormat = "0"
    'Totalak (finP + 1)
    Dim azkenGaldera As Integer
    For i = finP + 1 To finP + 11
        If Sheets(printOrria).Range("E" & i).Value <> "" Then
        azkenGaldera = i
        End If
    Next
    'zabaldu totalen zabalera zelda batzuk batuz
    For i = finP + 2 To azkenGaldera
        Sheets(printOrria).Range("C" & i & ":E" & i).Merge
        Sheets(printOrria).Range("C" & i & ":E" & i).HorizontalAlignment = xlLeft
    Next
    Sheets(printOrria).Range("C" & finP + 2 & ":F" & azkenGaldera).Interior.Color = RGB(255, 231, 155)
    Sheets(printOrria).Range("C" & finP + 2 & ":F" & azkenGaldera).Font.Size = 8
    Sheets(printOrria).Range("C" & finP + 2 & ":F" & azkenGaldera).Font.Bold = True
    With Sheets(printOrria).Range("C" & finP + 2 & ":F" & azkenGaldera).Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
        With Sheets(printOrria).Range("C" & finP + 2 & ":F" & azkenGaldera).Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
        With Sheets(printOrria).Range("C" & finP + 2 & ":F" & azkenGaldera).Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
        With Sheets(printOrria).Range("C" & finP + 2 & ":F" & azkenGaldera).Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
    'azken zutabea pasa 2 dezimaleko formatura eta kendu bold
    Sheets(printOrria).Range("F" & finP + 2 & ":F" & azkenGaldera).NumberFormat = "#,##0.00"
    Sheets(printOrria).Range("F" & finP + 2 & ":F" & azkenGaldera).Font.Bold = False
    'disclaimer
    Sheets(printOrria).Range("A" & finP + 13 & ":F" & finP + 28).Interior.Color = RGB(242, 242, 242)
        With Sheets(printOrria).Range("A" & finP + 13 & ":F" & finP + 28).Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
        With Sheets(printOrria).Range("A" & finP + 13 & ":F" & finP + 28).Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
        With Sheets(printOrria).Range("A" & finP + 13 & ":F" & finP + 28).Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
        With Sheets(printOrria).Range("A" & finP + 13 & ":F" & finP + 28).Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .Weight = xlThin
        .ColorIndex = 0
    End With
    '
End Sub

Sub printToPDF(ByVal printOrria As String)
    Application.ScreenUpdating = False
    Dim x As Object, y As Object
    Set x = Sheets("Printable_Data").Shapes("Button 2")
    Set y = x.Duplicate
    Dim xName As String
    xName = x.Name
    y.Cut
    With Sheets(printOrria)
        .Range("F6").Select
        .Paste
        .Activate
    End With
    Application.ScreenUpdating = True
    With Sheets(printOrria).Shapes("Button 1")
        .OnAction = "saveAsPDF"
    End With
End Sub

Sub saveAsPDF()
    'Lortu excelaren izena
    excelizena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    'Gorde PDF/Word bezala fitxategia
    filtroa = "PDF Files (*.pdf), *.pdf"
    fitxategia = Application.GetSaveAsFilename(InitialFileName:=excelizena, fileFilter:=filtroa)
    If Not fitxategia = False Then
        ThisWorkbook.Sheets("Printable").ExportAsFixedFormat Type:=xlTypePDF, Filename:=fitxategia, _
        Quality:=xlQualityStandard, _
        IncludeDocProperties:=True, _
        IgnorePrintAreas:=False, _
        OpenAfterPublish:=True
    End If
End Sub
Attribute VB_Name = "Ma16_Argentina"

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     ARGENTINA TEMPLATE ALL - REBISATZEKO!!!!
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''



'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     NAGUSIAK
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


' SOLMAT
'--------

Sub procArgentina(ByVal hoja As String)
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    generartxt (hoja)
    fitxZerb = ArgZebitzariraTXT("C:\Informes Baan\", nomFichBaanArg)
    mezua = crearListado(hoja, fitxZerb)
    generateEmailArgentina fichSolMat(hoja), mezua
    Application.ScreenUpdating = True
    Application.EnableEvents = True
End Sub

' PREVISIONES
'------------

Sub procArgentinaPrevisiones(ByVal hoja As String)
    Application.ScreenUpdating = False
    Dim fitx() As String
    fitx = fichPrevisiones(hoja)
    mezua = crearListadoPrevisiones(hoja)
    generateEmailArgentinaPrevisiones fitx, mezua
    Application.ScreenUpdating = True
End Sub



'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     SOLICITUD DE MATERIALES
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'EMAILAREN GORPUTZA -ZERRENDA SORTU

Function crearListado(ByVal hoja As String, ByVal fitxZerb As String) As String
    Application.ScreenUpdating = False
    Dim inicio As Integer, fin As Integer
    Dim colIni As String, colFin As String
    Dim filaCantidad As Integer

    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value

    Dim rentOrSale As Boolean, Modo As Boolean
    If hoja = "Baan_Rental" Then
        rentOrSale = 1
    Else
        rentOrSale = 0
    End If
    
    Dim i As Integer, j As Integer
    Dim nomCol As String
    Dim peso As Double, area As Double
    Dim cantTotal As Double, pesoTotal As Double
    cantTotal = 0
    pesoTotal = 0
    Dim resultado As String, conPiezas As String
    Dim unekoZut As String, codigo As String, descripcion As String
    Dim cantidad As Integer
    Dim cliente As String, codObra As String, nomObra As String, contrato As String, fitxTxT As String, cotizacion As String, nomFitx As String
    
    Data = Now
    user = Environ("Username")

    presupuesto = "-"
    nomFitx = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    codCliente = Sheets(hoja).Range("Cliente")
    cliente = Sheets(hoja).Range("nomcli")
    codObra = Sheets("BoM").Range("ID_Data_CodObra")
    nomObra = Sheets("BoM").Range("ID_Data_ObraGet")
    codCom = Sheets(hoja).Range("Comercial")
    nomCom = Sheets(hoja).Range("nomCom")
    cotizacion = Sheets(hoja).Range("ID_Baan_Cotizacion")
    contrato = Sheets(hoja).Range("Contrato")
    codOferta = Sheets(hoja).Range("Oferta")
    listaPrecios = "?"
    procentajev = "?"
    fechaPrevision = Sheets(hoja).Range("G13")
    fitxTxT = nomFichBaanArg
    If (hoja = "Baan_Rental") Then
        cotizacion = Sheets(hoja).Range("ID_Baan_Cotizacion").Value
        modoEmail = "EN ALQUILER"
    Else
        modoEmail = "EN VENTA"
    End If
    
    '''''''''''''''Ordenau BoM kodigoz, errezau kudeatu eta ondorioz kodigo berdinak ez daitezen errepetidu emailian
    ordenatuBaanOrria hoja
    '''Goiburua
    resultado = resultado & "NUEVA SOLICITUD DE MATERIALES: " & vbNewLine
    resultado = resultado & vbTab & "UBICACI|fffd|N ARCHIVO BAAN:" & fitxZerb & " " & vbNewLine
    resultado = resultado & "Generado por: " & user & " " & Data & vbNewLine
    resultado = resultado & "Desde Archivo: " & nomFitx & vbNewLine
    resultado = resultado & "G.E.T.: " & codObra & " | Presupuesto: " & presupuesto & " | Oferta: " & codOferta & vbNewLine
    resultado = resultado & "Cliente: " & "(" & codCliente & ") " & cliente & vbNewLine
    resultado = resultado & "Comercial: " & "(" & codCom & ") " & " " & nomCom & vbNewLine
    resultado = resultado & "Obra: (" & codObra & ") " & nomObra & vbNewLine
    resultado = resultado & "--->Contrato: " & contrato & "| T.C.: " & cotizacion & vbNewLine
    resultado = resultado & vbTab & "Ref.Material: " & nomFitx & " (" & area & ")" & vbNewLine
    resultado = resultado & vbTab & "Cotizado:" & vbNewLine
    resultado = resultado & vbNewLine
    resultado = resultado & vbTab & modoEmail & vbNewLine
    
    '''Gorputza
    total = 0
    codigo = ""
    calc = ""
    Dim h As Integer
    h = 14
    conPiezas = ""
    For i = 14 To 500
        codAnt = codigo
        codigo = Sheets(hoja).Range("A" & i)
        calcAnt = calc
        calc = Sheets(hoja).Range("BP" & i)
        siguienteCalc = Application.IfError(Sheets(hoja).Range("BP" & i + 1), "")
        siguienteCodigo = Sheets(hoja).Range("A" & i + 1)
        If codigo <> "" Then
            cant = Sheets(hoja).Range("G" & i)
            cantTotal = cantTotal + cant
            peso = Application.IfError(Application.VLookup(codigo, Sheets("BoM").Range("C" & inicio & ":" & "R" & fin), 16, 0), 0)
            pesoTotal = pesoTotal + peso
            cantAnt = cantidad
            cantidad = Sheets(hoja).Range("G" & i)
            If (calcAnt = calc) Then
                total = total + cantidad
            Else
                total = cantidad
            End If
            observacion = Application.IfError(Application.VLookup(Sheets(hoja).Range("A" & i), Sheets("BoM").Range("C" & inicio & ":" & "S" & fin), 17, 0), 0)
            precio = Format(Sheets(hoja).Range("E" & i), "##0.0000")
            descripcion = Sheets(hoja).Range("B" & i)
            servicio = Sheets(hoja).Range("F" & i)
            ajuste = Sheets(hoja).Range("BQ" & i) * 100 & "%"
            If (siguienteCalc <> calc) Then
                Sheets(hoja).Range("AF" & h) = servicio
                Sheets(hoja).Range("AG" & h) = ajuste
                Sheets(hoja).Range("AH" & h) = Format(codigo, "0000000")
                Sheets(hoja).Range("AI" & h) = total
                Sheets(hoja).Range("AJ" & h) = descripcion
                h = h + 1
                'conPiezas = conPiezas & servicio & vbTab & vbTab & ajuste & vbTab & vbTab & Format(codigo, "0000000") & vbTab & vbTab & total & vbTab & vbTab & descripcion & vbNewLine
            End If
        End If
    Next
    conPiezas = sortuStringDatuak(hoja)
    resultado = resultado & vbTab & "Fecha Prevista: " & fechaPrevision & vbTab & "Total= " & pesoTotal & " Kg  " & cantTotal & " Piezas" & vbNewLine
    'resultado = resultado & "[Serv]" & "       " & "[Ajuste]" & "       " & "[Cod]" & "              " & "[Cant]" & vbTab & vbTab & "[Descr]" & vbNewLine & vbNewLine
    resultado = resultado & conPiezas & vbNewLine
    cantTotal = 0
    pesoTotal = 0
    conPiezas = ""
    
    Application.ScreenUpdating = True
    crearListado = resultado
End Function


'EMAILA SORTU
'------------

Sub generateEmailArgentina(ByVal fitx As String, ByVal mezua As String)
    Dim objOutlook As Object
    Dim objMail As Object
    Dim cliente As String, codGet As String, nomGet As String
    cliente = separadorCodNom(Sheets("BoM").Range("ID_Data_Cliente").Value, "//", False)
    codGet = Sheets("BoM").Range("ID_Data_CodObra").Value
    nomGet = Sheets("BoM").Range("ID_Data_ObraGet").Value
    Set objOutlook = CreateObject("Outlook.Application")
    Set objMail = objOutlook.CreateItem(0)
    
    With objMail
    '.to = "get_ficherocliente@aura.ulmaconstruction.com"
    .Subject = "Nueva SolMat: " & cliente & " - [" & codGet & "] " & nomGet & " (" & CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name) & ")"
    .body = mezua
    .Attachments.Add fitx
    .Display 'Instead of .Display, you can use .Send to send the email _
                or .Save to save a copy in the drafts folder
    End With

    Set objOutlook = Nothing
    Set objMail = Nothing
End Sub


'BAANERAKO txt FITXATEGIA existitzen bada, eta ahal bada, ARGENTINAKO ZERBITZARIRA IGO
'-------------------------------------------------------------------------------------

Function ArgZebitzariraTXT(ByVal source As String, ByVal fitx As String) As String
    Dim destination As String
    On Error GoTo errorTag
    destination = "N:\BAAN\TemporalCargasSolMats\"
    Dim fso As Object
    Set fso = VBA.CreateObject("Scripting.FileSystemObject")
    Call fso.CopyFile(source & fitx, destination & fitx, overwrite)
    ArgZebitzariraTXT = destination & fitx
    GoTo endFunct
errorTag:
    ArgZebitzariraTXT = source & fitx
endFunct:
End Function

'SOLMAT SIGO-rako FITXATEGIA SORTU

Function fichSolMat(ByVal hoja As String) As String
    'Beharrezko datuak
    Data = Now
    nork = Environ("Username")
    user = Environ("Username")
    'Date = Now
    contrato = Sheets(hoja).Range("Contrato")
    presupuesto = "-"
    fitxIzena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    codCliente = Sheets(hoja).Range("Cliente")
    nomCliente = Sheets(hoja).Range("nomcli")
    codObra = Sheets("BoM").Range("ID_Data_CodObra")
    nomObra = Sheets("BoM").Range("ID_Data_ObraGet")
    codCom = Sheets(hoja).Range("Comercial")
    nomCom = Sheets(hoja).Range("nomCom")
    cotizacion = Sheets(hoja).Range("ID_Baan_Cotizacion")
    listaPrecios = "?"
    procentajev = "?"
    fechaPrevision = "?"

    '''''''''''''''''''''''''''''''
    ordenatuBaanOrria hoja
    
    ''''''''''''' sortu fitxategia
    Dim fichPrev As String
    fichPrev = "C:\Informes Baan\SOLMAT " & presupuesto & Format(Now, "yyyymmdd.hhmmss") & ".txt"
    Dim FileNum As Integer
    FileNum = FreeFile ' next file number
    Open fichPrev For Append As #FileNum ' creates the file if it doesn't exist
    'Print #FileNum, LogMessage ' write information at the end of the text file
    
    'goiburua
    Print #FileNum, "## SOLICITUD DE MATERIALES: EXPORTACION DE COMPUTO POR ITEM"
    Print #FileNum, "# cu|fffd|ndo?: " & Date
    Print #FileNum, "# Generado por: " & user
    Print #FileNum, "# Correspondiente al presupuesto N|fffd|: " & presupuesto
    Print #FileNum, "# Archivo Origen: " & fitxIzena
    Print #FileNum, "# Solapa Origen: ?"
    Print #FileNum, "# Cliente: " & "(" & codCliente & ") " & nomCliente
    Print #FileNum, "# Obra: " & "(" & codObra & ") " & nomObra
    Print #FileNum, "# Ref.Material: " & fitxIzena
    Print #FileNum, "# Representante: " & "(" & codCom & ") " & nomCom
    Print #FileNum, "# Autor: " & nork
    Print #FileNum, "#      Lista de Precios: " & listaPrecios
    Print #FileNum, "#      Ajuste alq: " & porcentaje
    Print #FileNum, "#      T.C. $" & cotizacion
    Print #FileNum, "#"
    'Print #FileNum, "# Bultos: " & cantPiezas & " - Peso: " & pesoTotal & "Kg"
    Print #FileNum, "# COD" & vbTab & "CANT" & vbTab & " $/UNIT " & vbTab & "DESCRIPCI|fffd|N"
    cant = 0
    cantTotal = 0
    peso = 0
    pesoTotal = 0
    total = 0
    codigo = ""
    Dim precio As String
    For i = 14 To 150
        codAnt = codigo
        codigo = Sheets(hoja).Range("A" & i)
        siguienteCodigo = Sheets(hoja).Range("A" & i + 1)
        If codigo <> "" Then
            cant = Sheets(hoja).Range("G" & i)
            cantTotal = cantTotal + cant
            peso = Application.IfError(Application.VLookup(Sheets(hoja).Range("A" & i), Sheets("BoM").Range("C" & inicio & ":" & "L" & fin), 10, 0), 0)
            pesoTotal = pesoTotal + peso
            cantAnt = cantidad
            cantidad = Sheets(hoja).Range("G" & i)
            If (codAnt = codigo) Then
                total = total + cantidad
            Else
                total = cantidad
            End If
            observacion = Application.IfError(Application.VLookup(Sheets(hoja).Range("A" & i), Sheets("BoM").Range("C" & inicio & ":" & "S" & fin), 17, 0), 0)
            precio = Format(Sheets(hoja).Range("E" & i), "##0.0000")
            descripcion = Sheets(hoja).Range("B" & i)
            If (siguienteCodigo <> codigo) Then
                Print #FileNum, Format(codigo, "0000000") & vbTab & total & vbTab & vbTab & precio & vbTab & observacion & vbTab & vbTab & descripcion
            End If
        End If
    Next
    Close #FileNum ' close the file
    fichSolMat = fichPrev
End Function


Function sortuStringDatuak(ByVal hoja As String) As String
    Dim azkenLerroa As Integer
    azkenLerroa = [AF:AF].Find("*", , xlValues, , xlByRows, xlPrevious).row
    Sheets(hoja).Range("AF13:AJ" & azkenLerroa).Sort _
    Key1:=Range("AF13:AJ" & azkenLerroa), _
    header:=xlYes, _
    Order1:=1, _
    MatchCase:=False, _
    SortMethod:=xlPinYin
    conPiezas = ""
    lastServ = ""
    For i = 14 To azkenLerroa
        servicio = Sheets(hoja).Range("AF" & i).Value
        If lastServ <> servicio Then
            lastServ = servicio
            conPiezas = conPiezas & vbNewLine & "--------------- Servicio: " & lastServ & " -----------------" & vbNewLine & vbNewLine
            conPiezas = conPiezas & "[Serv]" & "       " & "[Ajuste]" & "       " & "[Cod]" & "              " & "[Cant]" & vbTab & vbTab & "[Descr]" & vbNewLine & vbNewLine
        End If
        ajuste = Sheets(hoja).Range("AG" & i).Value * 100 & "%"
        codigo = Sheets(hoja).Range("AH" & i).Value
        total = Sheets(hoja).Range("AI" & i).Value
        descripcion = Sheets(hoja).Range("AJ" & i).Value
        conPiezas = conPiezas & servicio & vbTab & vbTab & ajuste & vbTab & vbTab & Format(codigo, "0000000") & vbTab & vbTab & total & vbTab & vbTab & descripcion & vbNewLine
    Next
    'hustu taula tenporala
    Sheets(hoja).Range("AF14:AJ" & azkenLerroa).Value = ""
    sortuStringDatuak = conPiezas
End Function


'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     PREVISIONES
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


' PREVISIONES fitxategia SORTU SIGO.rako
'----------------------------------------


Function fichPrevisiones(ByVal hoja As String) As String()
    'Beharrezko datuak
    Data = Now
    nork = Environ("Username")
    user = Environ("Username")
    contrato = Sheets(hoja).Range("Contrato")
    fitxIzena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    codCliente = Sheets(hoja).Range("Cliente")
    nomCliente = Sheets(hoja).Range("nomcli")
    codObra = Sheets("BoM").Range("ID_Data_CodObra")
    nomObra = Sheets("BoM").Range("ID_Data_ObraGet")
    codCom = Sheets(hoja).Range("Comercial")
    nomCom = Sheets(hoja).Range("nomCom")
    cotizacion = Sheets(hoja).Range("ID_Baan_Cotizacion")
    listaPrecios = "?"
    fechaPrevision = Sheets(hoja).Range("G13").Value
    
    Dim inicio As Integer, fin As Integer, cantColumnas As Integer
    Dim colInicio As String, colFin As String
    inicio = Sheets("Data").Range("FilaInicioArticulosLR").Value
    fin = Sheets("Data").Range("FilaFinArticulosLR").Value
    colInicio = Sheets("Data").Range("NumColumInicioListaLR").Value
    colFin = Sheets("Data").Range("NumColumFinListaLR").Value
    colInicioN = ConvertToNumber(colInicio)
    colFinN = ConvertToNumber(colFin)
    cantColumnas = ConvertToNumber(colFin) - ConvertToNumber(colInicio) + 1
    Dim resultado() As String
    ReDim resultado(1 To cantColumnas) As String

    '''''''''''''''''''''''''''''''
    '''''''''''''''Ordenau BoM kodigoz, errezau kudeatu eta ondorioz kodigo berdinak ez daitezen errepetidu emailian
    Sheets("BoM").Select
    ordenarFilas 1
    'Sheets(hoja).Select
    
    ''''''''''''' sortu fitxategia
    Dim fichPrev As String
    Dim FileNum As Integer
    Dim h As Integer
    h = 1
    
    For j = colInicioN To colFinN
        unekoZut = ConvertToLetter(j)
        servicio = Sheets("BoM").Range(unekoZut & fin + 29).Value
        porcentaje = Sheets("BoM").Range(unekoZut & fin + 26).Value * 100 & "%"
        nomColumna = Sheets("BoM").Range(unekoZut & inicio - 3).Value
        presupuesto = nomColumna & "-"
        peso = Sheets("BoM").Range(unekoZut & fin + 6).Value
        bultos = Application.Sum(Sheets("BoM").Range(unekoZut & inicio & ":" & unekoZut & fin)) * Sheets("BoM").Range(unekoZut & inicio - 2)
        fichPrev = "C:\Informes Baan\PRV " & presupuesto & Format(Now, "yyyymmdd.hhmmss") & ".txt"
        FileNum = FreeFile ' next file number
        Open fichPrev For Append As #FileNum ' creates the file if it doesn't exist
        'Print #FileNum, LogMessage ' write information at the end of the text file
        
        'goiburua
        Print #FileNum, "## PREVISTO: EXPORTACION DE COMPUTO POR ITEM"
        Print #FileNum, "# cu|fffd|ndo?: " & Date & " (" & user & ")"
        Print #FileNum, "# Correspondiente al presupuesto N|fffd|: " & presupuesto
        Print #FileNum, "# Correspondiente al contrato N|fffd|: " & contrato & " - Servicio " & servicio
        Print #FileNum, "# Archivo Origen: " & fitxIzena
        Print #FileNum, "# Cliente: " & "(" & codCliente & ") " & nomCliente
        Print #FileNum, "# Obra: " & "(" & codObra & ") " & nomObra
        Print #FileNum, "# Ref.Material: " & fitxIzena & " - " & nomColumna
        Print #FileNum, "# Representante: " & "(" & codCom & ") " & nomCom
        Print #FileNum, "# Autor: " & nork
        Print #FileNum, "# T.C. $" & cotizacion & " - Lista de precios: " & listaPrecios
        Print #FileNum, "# Ajuste alq: " & porcentaje
        Print #FileNum, "#"
        Print #FileNum, "#    Fecha Prevista:" & fechaPrevision
        Print #FileNum, "#"
        Print #FileNum, "# Bultos: " & bultos & " - Peso: " & peso & "Kg"
        Print #FileNum, "# COD" & vbTab & "CANT" & vbTab & " OBSERVACIONES " & vbTab & "DESCRIPCION"
        cant = 0
        cantTotal = 0
        total = 0
        codigo = ""
        For i = inicio To fin
            cantidad = Sheets("BoM").Range(unekoZut & i).Value * Sheets("BoM").Range(unekoZut & inicio - 2)
            If cantidad > 0 Then
                codAnt = codigo
                codigo = Sheets("BoM").Range("C" & i).Value
                siguienteCodigo = Sheets("BoM").Range("C" & i + 1).Value
                If (codAnt = codigo) Then
                    total = total + cantidad
                Else
                    total = cantidad
                End If
                descripcion = Sheets("BoM").Range("D" & i).Value
                If (siguienteCodigo <> codigo) Then
                     Print #FileNum, Format(codigo, "0000000") & vbTab & total & vbTab & vbTab & vbTab & vbTab & descripcion
                End If
            End If
        Next
        Close #FileNum ' close the file
        resultado(h) = fichPrev
        h = h + 1
    Next
    fichPrevisiones = resultado
End Function


'SORTU EMAILA
'------------

Sub generateEmailArgentinaPrevisiones(ByRef fitx() As String, ByVal mezua As String)
    Dim objOutlook As Object
    Dim objMail As Object
    Dim cliente As String, codGet As String, nomGet As String
    cliente = separadorCodNom(Sheets("BoM").Range("ID_Data_Cliente").Value, "//", False)
    codGet = Sheets("BoM").Range("ID_Data_CodObra").Value
    nomGet = Sheets("BoM").Range("ID_Data_ObraGet").Value
    Set objOutlook = CreateObject("Outlook.Application")
    Set objMail = objOutlook.CreateItem(0)
    
    With objMail
    '.to = "get_ficherocliente@aura.ulmaconstruction.com"
    .Subject = "Previsto: " & cliente & nomGet & " (" & CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name) & ")"
    .body = mezua
    For i = 1 To UBound(fitx)
        .Attachments.Add fitx(i)
    Next
    .Display 'Instead of .Display, you can use .Send to send the email _
                or .Save to save a copy in the drafts folder
    End With

    Set objOutlook = Nothing
    Set objMail = Nothing
End Sub


'PREVISIONES emailerako gorputza SORTU (ZERRENDA)
'------------------------------------------------

Function crearListadoPrevisiones(ByVal hoja As String) As String
    'Beharrezko datuak
    Data = Now
    nork = Environ("Username")
    user = Environ("Username")
    contrato = Sheets(hoja).Range("Contrato")
    presupuesto = "-"
    oferta = "-"
    fitxIzena = CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name)
    codCliente = separadorCodNom(Sheets("BoM").Range("ID_Data_Cliente"), "//", 0) 'Sheets(hoja).Range("Cliente")
    nomCliente = separadorCodNom(Sheets("BoM").Range("ID_Data_Cliente"), "//", 1) 'Sheets(hoja).Range("nomcli")
    codObra = Sheets("BoM").Range("ID_Data_CodObra")
    nomObra = Sheets("BoM").Range("ID_Data_ObraGet")
    codCom = separadorCodNom(Sheets("BoM").Range("ID_Data_CodNomComercial"), "//", 0) 'Sheets(hoja).Range("Comercial")
    nomCom = separadorCodNom(Sheets("BoM").Range("ID_Data_CodNomComercial"), "//", 1) 'Sheets(hoja).Range("nomCom")
    cotizacion = Sheets(hoja).Range("ID_Baan_Cotizacion")
    oferta = Sheets("BoM").Range("ID_Data_OfertaSolicitud") 'Sheets(hoja).Range("oferta")
    cotizado = Sheets(hoja).Range("ID_Baan_Cotizacion")
    listaPrecios = "?"
    fechaPrevision = Sheets("BoM").Range("ID_Data_FechaINSum") 'Sheets(hoja).Range("G13").Value
    
    '''''''
    Dim inicio As Integer, fin As Integer, cantColumnas As Integer
    Dim colInicio As String, colFin As String
    inicio = Sheets("Data").Range("FilaInicioArticulosLR").Value
    fin = Sheets("Data").Range("FilaFinArticulosLR").Value
    colInicio = Sheets("Data").Range("NumColumInicioListaLR").Value
    colFin = Sheets("Data").Range("NumColumFinListaLR").Value
    colInicioN = ConvertToNumber(colInicio)
    colFinN = ConvertToNumber(colFin)
    cantColumnas = ConvertToNumber(colFin) - ConvertToNumber(colInicio) + 1
    
    'goiburua
    resultado = resultado & "NUEVA PREVISI|fffd|N: " & vbNewLine
    resultado = resultado & "Generado por: " & user & " " & Now & vbNewLine
    resultado = resultado & "Desde Archivo: " & fitxIzena & vbNewLine
    resultado = resultado & "G.E.T.: " & codObra & "| Presupuesto: " & presupuesto & " | Oferta: " & oferta & vbNewLine
    resultado = resultado & "Cliente: " & "(" & codCliente & ") " & nomCliente & vbNewLine
    resultado = resultado & "Comercial: " & "(" & codCom & ") " & nomCom & vbNewLine
    resultado = resultado & "Obra: " & " (" & codObra & ") " & nomObra & vbNewLine
    resultado = resultado & "--> contrato: " & contrato & " | Solapa: " & solapa & vbNewLine
    resultado = resultado & " Ref.Material: " & fitxIzena & vbNewLine
    resultado = resultado & "Cotizado: $" & cotizado & vbNewLine
    resultado = resultado & vbTab & "EN ALQUILER" & vbNewLine & vbNewLine
    
    cant = 0
    cantTotal = 0
    peso = 0
    pesoTotal = 0
    total = 0
    codigo = ""
    Dim precio As String
    For j = colInicioN To colFinN
        unekoZut = ConvertToLetter(j)
        servicio = Sheets("BoM").Range(unekoZut & fin + 29).Value
        porcentaje = Sheets("BoM").Range(unekoZut & fin + 26).Value * 100 & "%"
        nomColumna = Sheets("BoM").Range(unekoZut & inicio - 3).Value
        presupuesto = nomColumna & "-"
        peso = Sheets("BoM").Range(unekoZut & fin + 6).Value
        bultos = Application.Sum(Sheets("BoM").Range(unekoZut & inicio & ":" & unekoZut & fin)) * Sheets("BoM").Range(unekoZut & inicio - 2)
        cant = 0
        cantTotal = 0
        total = 0
        codigo = ""
        resultado = resultado & "------------- " & nomColumna & "  --------------" & vbNewLine
        resultado = resultado & "------------  Fecha Prevista: " & fechaPrevision & vbTab & "Total " & peso & " Kg. " & bultos & " Piezas" & " -  Servicio: " & servicio & vbNewLine
        resultado = resultado & "[Cod]" & vbTab & vbTab & "[Cant]" & vbTab & vbTab & "[Descr]" & vbNewLine
        For i = inicio To fin
            cantidad = Sheets("BoM").Range(unekoZut & i).Value * Sheets("BoM").Range(unekoZut & inicio - 2)
            If cantidad > 0 Then
                codAnt = codigo
                codigo = Sheets("BoM").Range("C" & i).Value
                siguienteCodigo = Sheets("BoM").Range("C" & i + 1).Value
                If (codAnt = codigo) Then
                    total = total + cantidad
                Else
                    total = cantidad
                End If
                descripcion = Sheets("BoM").Range("D" & i).Value
                If (siguienteCodigo <> codigo) Then
                     resultado = resultado & Format(codigo, "0000000") & vbTab & vbTab & total & vbTab & vbTab & descripcion & vbNewLine
                End If
            End If
        Next
        resultado = resultado & vbNewLine
    Next
    crearListadoPrevisiones = resultado
End Function


'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     FUNTZIO LAGUNTZAILEAK
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Function bilatuOrrian(ByVal hoja As String, ByVal codigo As String) As Integer
    bilatuOrrian = Application.IfError(Application.Match(codigo, Sheets(hoja).Range("A14:A2000"), 0), 0)
End Function

Sub ordenatuBaanOrria(ByVal hoja As String)
    Dim azkenLerroa As Integer
    azkenLerroa = [A:A].Find("*", , xlValues, , xlByRows, xlPrevious).row
    Sheets(hoja).Range("A13:V" & azkenLerroa).Sort _
    Key1:=Range("A13:V" & azkenLerroa), _
    header:=xlYes, _
    Order1:=1, _
    MatchCase:=False, _
    SortMethod:=xlPinYin
End Sub



Sub lanzau()
ordenatuBaanOrria ("Baan_Rental")
    'procArgentinaPrevisiones ("Baan_Rental")
End Sub
Attribute VB_Name = "Mzz_Columnas"
Sub eliminaColumna(Optional ByVal nombreCol As String)
    colInicio = Sheets("Data").Range("NumColumInicioLista").Value
    inicio = ThisWorkbook.Sheets("Data").Range("FilaInicioArticulos").Value
    colSel = ConvertToNumber(nombreCol)
    valTajoElim = Sheets("BoM").Cells(inicio - 5, colSel).Value
    valTajoSig = Sheets("BoM").Cells(inicio - 5, colSel + 1).Value
    valDesElim = Sheets("BoM").Cells(inicio - 6, colSel).Value
    egoera = Application.Calculation
    Application.Calculation = xlCalculationManual
    Sheets("BoM").Columns(colSel).EntireColumn.Delete
    Application.Calculation = egoera
    If (colSel = colInicio) Then
        Sheets("BoM").Range(ConvertToLetter(colInicio) & inicio - 6).Value = "=ID_DespieceMatApar"
    End If
    ColumnaTajoS = Sheets("Data").Range("ColumnaTajoS").Value
    filaIniTajo = Sheets("Data").Range("FilaInicioTajos").Value
    elimSumTajo = colSel - colInicio + filaIniTajo
    ColumnaMultTajoS = Sheets("Data").Range("ColumnaMultTajoS").Value
    If (valTajoElim <> "" And valTajoSig = " ") Then
        Sheets("Summary").Range(ColumnaTajoS & elimSumTajo + 1).Value = valTajoElim
        Sheets("Summary").Range(ColumnaMultTajoS & elimSumTajo + 1).Value = 1
    End If
    egoera = Application.Calculation
    Application.Calculation = xlCalculationManual
    Sheets("Summary").Rows(elimSumTajo).EntireRow.Delete
    Application.Calculation = egoera
    ''
    filaIniPrecio = Sheets("Data").Range("FilaInicioPrecio").Value
    elimSumPrecio = colSel - colInicio + filaIniPrecio
    egoera = Application.Calculation
    Application.Calculation = xlCalculationManual
    Sheets("Summary").Rows(elimSumPrecio).EntireRow.Delete
    Application.Calculation = egoera
    ''
    filaIniPeso = Sheets("Data").Range("FilaInicioPeso").Value
    elimSumPeso = colSel - colInicio + filaIniPeso
    egoera = Application.Calculation
    Application.Calculation = xlCalculationManual
    Sheets("Summary").Rows(elimSumPeso).EntireRow.Delete
    Application.Calculation = egoera
End Sub

Sub creaColumna(Optional ByVal nombreCol As String)
    'BOM
    Dim stock, sobra, falta, colInicio, sarpuntuaLetra, norainoletra As String
    Dim inicio, fin, zenbat As Integer
    Dim rConstants As Range
    colInicio = Sheets("Data").Range("NumColumInicioLista").Value
    colFin = Sheets("Data").Range("NumColumFinLista").Value
    inicio = ThisWorkbook.Sheets("Data").Range("FilaInicioArticulos").Value
    fin = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value
    sarpuntua = colFin
    sarpuntuaLetra = ConvertToLetter(sarpuntua)
    zenbat = 1
    norainoletra = ConvertToLetter(sarpuntua + zenbat)
    Sheets("BoM").Columns(sarpuntua).Select
    ActiveCell.EntireColumn.Offset(, 1).Resize(, zenbat).Insert
    Sheets("BoM").Range(sarpuntuaLetra & inicio - 6 & ":" & sarpuntuaLetra & fin + 1000).Select
    Selection.Copy
    kopiama = ConvertToLetter(ConvertToNumber(norainoletra))
    Sheets("BoM").Range(kopiama & inicio - 6 & ":" & kopiama & fin + 1000).Select
    ActiveSheet.Paste
    Sheets("BoM").Range(norainoletra & inicio - 5 & ":" & kopiama & inicio - 5).Locked = False
    On Error Resume Next
    Sheets("BoM").Range(norainoletra & inicio - 6).Formula = ""
    Set rConstants = Sheets("BoM").Range(norainoletra & inicio - 6 & ":" & kopiama & fin + 1000).SpecialCells(xlCellTypeConstants)
    rConstants.ClearContents
    rConstants.ClearComments
    Application.CutCopyMode = False
    Sheets("BoM").Range("A1").Select
    'SUMMARY
    Dim filafintajo, filafinprecio, filafinpeso As Integer
    Dim ColumnaTajoS, ColumnaMultTajoS, ColumnaListaS, ColumnaMultListaS, ColumnaAlquilerS As String
    filafintajo = Sheets("Data").Range("FilaFinTajos").Value
    ColumnaTajoS = Sheets("Data").Range("ColumnaTajoS").Value
    ColumnaMultTajoS = Sheets("Data").Range("ColumnaMultTajoS").Value
    ColumnaListaS = Sheets("Data").Range("ColumnaListaS").Value
    ColumnaMultListaS = Sheets("Data").Range("ColumnaMultListaS").Value
    ColumnaAlquilerS = Sheets("Data").Range("ColumnaAlquilerS").Value
    Sheets("Summary").Select
    Sheets("Summary").Rows(filafintajo).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafintajo & ":" & "ZZ" & filafintajo).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafintajo + 1 & ":" & "ZZ" & filafintajo + 1).Select
    ActiveSheet.Paste
    Set rConstants = Sheets("Summary").Range("A" & filafintajo + 1 & ":" & "ZZ" & filafintajo + 1).SpecialCells(xlCellTypeConstants)
    rConstants.ClearContents
    rConstants.ClearComments
    Sheets("Summary").Range(ColumnaTajoS & filafintajo + 1).Value = "NEW UNIT " & Sheets("Data").Range("NumNuevoTajo").Value
    Sheets("Data").Range("NumNuevoTajo").Value = Sheets("Data").Range("NumNuevoTajo").Value + 1
    Sheets("Summary").Range(ColumnaMultTajoS & filafintajo + 1).Value = 1
    'If nombreCol <> "" Then
        nombre = nombreCol
'    Else
'        nombre = "NEW LIST " & Sheets("Data").Range("NumNuevaLista").Value
'    End If
    Sheets("Summary").Range(ColumnaListaS & filafintajo + 1).Value = nombre
    Sheets("Data").Range("NumNuevaLista").Value = Sheets("Data").Range("NumNuevaLista").Value + 1
    Sheets("Summary").Range(ColumnaMultListaS & filafintajo + 1).Value = 1
    Sheets("Summary").Range(ColumnaAlquilerS & filafintajo + 1).Value = 0
    ''
    filafinprecio = Sheets("Data").Range("FilaFinPrecio").Value
    Sheets("Summary").Rows(filafinprecio).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafinprecio & ":" & "ZZ" & filafinprecio).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafinprecio + 1 & ":" & "ZZ" & filafinprecio + 1).Select
    ActiveSheet.Paste
    ''
    filafinpeso = Sheets("Data").Range("FilaFinPeso").Value
    Sheets("Summary").Rows(filafinpeso).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafinpeso & ":" & "ZZ" & filafinpeso).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafinpeso + 1 & ":" & "ZZ" & filafinpeso + 1).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Sheets("BoM").Select
End Sub

Sub aldatuZutabeIzenaBakarraDagoenean(ByVal izena As String)
    Dim filaIniciotajo As Integer
    Dim ColumnaListaS As String
    filaIniciotajo = Sheets("Data").Range("FilaInicioTajos").Value
    ColumnaListaS = Sheets("Data").Range("ColumnaListaS").Value
    Sheets("Summary").Select
    'colNombreLista = ConvertToLetter(Application.Match(oraingoIzena, Sheets("Summary").Range(filaTitulos - 2 & ":" & filaTitulos - 2), 0))
    Sheets("Summary").Range(ColumnaListaS & filaIniciotajo) = izena
    Sheets("BoM").Select
End Sub
Attribute VB_Name = "Mzz_Combinador"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     COMBINADOR
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'Lerroak konbinatu berdinak badira (modosum da ezberdina izan daitekeen bakarra

'----------------------
'    NAGUSIA
'---------------------

Sub konbinatu()
    'If (MsgBox("Se va a proceder a combinar lineas iguales pero con distinto modo de suministro. |fffd|Desea continuar?", vbYesNo) = vbYes) Then
        egoera1 = Application.ScreenUpdating
        egoera2 = Application.EnableEvents
        Application.ScreenUpdating = False
        Application.EnableEvents = False
        ordenarFilas 1
        Dim inicio, fin As Integer
        Dim lerroak() As Integer
        Dim berdinak() As Integer
        inicio = Sheets("Data").Range("FilaInicioArticulos").Value
        fin = Sheets("Data").Range("FilaFinArticulos").Value
        'Ezabatu producto eta agrupaci|fffd|n zutabeak
        Sheets("BoM").Range("B" & inicio - 1 & ":C" & fin).Value = ""
        Sheets("BoM").Range("B" & inicio).Copy
        Sheets("BoM").Range("B" & inicio - 1 & ":C" & inicio - 1).PasteSpecial Paste:=xlPasteFormats
        Sheets("BoM").Range("B" & inicio - 1 & ":C" & fin).Borders.LineStyle = xlLineStyleNone
        ''
        i = inicio
        j = 0
        berdinak = berdintzekoak
        Do While i <= fin
            If lineaBerdinak(i, i - 1) Then
                ReDim Preserve lerroak(j)
                lerroak(j) = i
                j = j + 1
            End If
            i = i + 1
        Loop
        If j <> 0 Then 'ezabatzeko lerroak daude
            eguneratuKantitateak berdinak
            ezabatuLerroa lerroak
        End If
        'Aukeratu A1 zelda eta ordenatu
        ordenarFilas 1
        Sheets("BoM").Range("A1").Select
        Application.ScreenUpdating = egoera1
        Application.EnableEvents = egoera2
    'End If
End Sub

'----------------------
'    LAGUNTZAILEAK
'---------------------


Function lineaBerdinak(ByVal lerroa As Integer, ByVal aurrekoLerroa As Integer) As Boolean
    Dim columnaCodigo, columnaDesc, columnaModo, columnaAlq, columnaMultAlq, columnaVen, columnaMultVen, columnaPeso, columnaArea As String
    columnaCodigo = "D"
    columnaDesc = "E"
    columnaModo = "F"
    columnaAlq = "J"
    columnaMultAlq = "K"
    columnaVen = "L"
    columnaMultVen = "M"
    columnaPeso = "P"
    columnaArea = "R"
    codigo = Sheets("BoM").Range(columnaCodigo & lerroa).Value
    codigoAnt = Sheets("BoM").Range(columnaCodigo & aurrekoLerroa).Value
    desc = Sheets("BoM").Range(columnaDesc & lerroa).Value
    descAnt = Sheets("BoM").Range(columnaDesc & aurrekoLerroa).Value
    Modo = Sheets("BoM").Range(columnaModo & lerroa).Value
    modoAnt = Sheets("BoM").Range(columnaModo & aurrekoLerroa).Value
    precioAlq = Sheets("BoM").Range(columnaAlq & lerroa).Value
    precioALqAnt = Sheets("BoM").Range(columnaAlq & aurrekoLerroa).Value
    multAlq = Sheets("BoM").Range(columnaMultAlq & lerroa).Value
    multAlqAnt = Sheets("BoM").Range(columnaMultAlq & aurrekoLerroa).Value
    precioVen = Sheets("BoM").Range(columnaVen & lerroa).Value
    precioVenAnt = Sheets("BoM").Range(columnaVen & aurrekoLerroa).Value
    multVen = Sheets("BoM").Range(columnaMultVen & lerroa).Value
    multVenAnt = Sheets("BoM").Range(columnaMultVen & aurrekoLerroa).Value
    peso = Sheets("BoM").Range(columnaPeso & lerroa).Value
    pesoAnt = Sheets("BoM").Range(columnaPeso & aurrekoLerroa).Value
    area = Sheets("BoM").Range(columnaArea & lerroa).Value
    areaAnt = Sheets("BoM").Range(columnaArea & aurrekoLerroa).Value
    If codigo = codigoAnt And desc = descAnt And precioAlq = precioALqAnt And multAlq = multAlqAnt And precioVen = precioVenAnt And multVen = multVenAnt And peso = pesoAnt And area = areaAnt Then
        lineaBerdinak = True
    Else
        lineaBerdinak = False
    End If
End Function



Sub eguneratuKantitateak(berdinak() As Integer)
    Dim inicioCol, finCol As String
    inicioCol = Sheets("Data").Range("NumColumInicioLista").Value
    finCol = Sheets("Data").Range("NumColumFinLista").Value
    For i = LBound(berdinak, 2) To UBound(berdinak, 2)
        For j = inicioCol To finCol
            unekoZut = ConvertToLetter(j)
            Sheets("BoM").Range(unekoZut & berdinak(0, i)).Value = Application.Sum(Sheets("BoM").Range(unekoZut & berdinak(0, i) & ":" & unekoZut & berdinak(1, i)))
        Next
    Next
End Sub

Function berdintzekoak() As Integer()
    kontrola = False
    Dim ezab() As Integer
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    j = -1
    For i = inicio To fin
        If lineaBerdinak(i, i - 1) Then
            If kontrola = False Then
                kontrola = True
                j = j + 1
                ReDim Preserve ezab(1, j)
                ezab(0, j) = i - 1
                ezab(1, j) = i
            Else
                ezab(1, j) = i
            End If
        Else
            kontrola = False
        End If
    Next
    berdintzekoak = ezab
End Function


Sub ezabatuLerroa(lerroak() As Integer)
    eliminalineaRequest lerroak
End Sub
Attribute VB_Name = "Mzz_Family_Factors"
Function getFamilyArray() As String()
    Dim familyCol As String
    Dim inicio As Integer
    Dim fin As Integer
    Dim filaTitulos As Integer
    Dim familias() As String
    Dim ind As Integer
    ind = 0
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    idFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    familyCol = Application.Match(idFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0)
    ReDim Preserve familias(ind)
    familias(ind) = Sheets("BoM").Range(ConvertToLetter(familyCol) & inicio).Value
    For i = inicio To fin
        unekoDat = Sheets("BoM").Range(ConvertToLetter(familyCol) & i).Value
        If UBound(Filter(familias, unekoDat)) = -1 Then
            ind = ind + 1
            ReDim Preserve familias(ind)
            familias(ind) = unekoDat
        End If
    Next
    getFamilyArray = familias
End Function


Function checkSameFactor(ByVal family As String, ByVal alq As Boolean) As Variant
    Dim inicio As Integer
    Dim fin As Integer
    Dim filaTitulos As Integer
    Dim erantzuna As Variant
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    idFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    idPrecioAlq = Sheets("Languages").Range("ID_PrecioAlquiler").Value
    idPrecioVen = Sheets("Languages").Range("ID_PrecioVenta").Value
    familyCol = Application.Match(idFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0)
    lehena = True
    If alq Then
        colFactor = ConvertToLetter(Application.Match(idPrecioAlq, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    Else
        colFactor = ConvertToLetter(Application.Match(idPrecioVen, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    End If
    For i = inicio To fin
        unekoFam = Sheets("BoM").Range(ConvertToLetter(familyCol) & i).Value
        If unekoFam = family Then
            If lehena Then
                    erantzuna = Sheets("BoM").Range(colFactor & i).Value
                    lehena = False
            End If
            If erantzuna <> Sheets("BoM").Range(colFactor & i).Value Then
                erantzuna = -1
            End If
        End If
    Next
    checkSameFactor = erantzuna
End Function

Sub esleituFakt(ByVal familia As String, ByVal fakt As Variant, ByVal alq As Boolean)
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Dim inicio As Integer
    Dim fin As Integer
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    idFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    idPrecioAlq = Sheets("Languages").Range("ID_PrecioAlquiler").Value
    idPrecioVen = Sheets("Languages").Range("ID_PrecioVenta").Value
    familyCol = ConvertToLetter(Application.Match(idFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    lehena = True
    If alq Then
        colFactor = ConvertToLetter(Application.Match(idPrecioAlq, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    Else
        colFactor = ConvertToLetter(Application.Match(idPrecioVen, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    End If
    For i = inicio To fin
        If Sheets("BoM").Range(familyCol & i).Value = familia Then
            Sheets("BoM").Range(colFactor & i).Value = CDbl(fakt)
        End If
    Next
    Application.ScreenUpdating = True
    Application.EnableEvents = True
End Sub

Sub esleituFaktGB(ByVal fakt As Variant, ByVal alq As Boolean)
    Application.ScreenUpdating = False
    Dim inicio As Integer
    Dim fin As Integer
    Dim erantzuna As Variant
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    idFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    idPrecioAlq = Sheets("Languages").Range("ID_PrecioAlquiler").Value
    idPrecioVen = Sheets("Languages").Range("ID_PrecioVenta").Value
    familyCol = ConvertToLetter(Application.Match(idFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    If alq Then
        colFactor = ConvertToLetter(Application.Match(idPrecioAlq, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    Else
        colFactor = ConvertToLetter(Application.Match(idPrecioVen, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0) + 1)
    End If
'    If fakt <> "" Then
'        fakt = Format(fakt, "0.000")
'    End If
    Sheets("BoM").Range(colFactor & filaTitulos).Value = CDbl(fakt)
    Application.ScreenUpdating = True
End Sub
Attribute VB_Name = "Mzz_FromAutocadRevit"

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     DESDE AUTOCAD O REVIT (VolcadosACAD)
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub fromACAD()
    Dim inicio, fin As Integer
    Dim colTot As String
    egoera1 = Application.ScreenUpdating
    egoera2 = Application.EnableEvents
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    
    excelizena = "C:\ULMA\Repcon_57\VolcadosACAD\BCAcad.xlsx"
    Dim xlObj As Object
    Set xlObj = CreateObject("Excel.Application")
    xlObj.Visible = False
    xlObj.ScreenUpdating = False
    xlObj.EnableEvents = False
    xlObj.DisplayAlerts = False
    Dim xlWbk  As Object
    If fileExists(excelizena) <> "" Then
        erantzuna = MsgBox("Autocad data found. Load it?", vbYesNo)
        If erantzuna = vbYes Then
            Set xlWbk = xlObj.Workbooks.Add(excelizena)
        Else
            GoTo finTag
        End If
    Else
        MsgBox "No data found to be imported.", vbExclamation
        GoTo finTag
    End If
    'sortu zutabe berria
    Mzz_FromAutocadRevit.creaColumnaParaAutocadRevit
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    BoMColCod = "D"
    BoMUltCol = Sheets("Data").Range("ColumFinLista").Value
    AcadColCod = "A"
    AcadColCant = "B"
    AcadUltLinea = xlWbk.Sheets(1).Range("A:A").End(xlDown).row
    For i = 2 To AcadUltLinea
        unekoa = xlWbk.Sheets(1).Range(AcadColCod & i).Value
        If IsNumeric(unekoa) Then
            unekoa = Format(unekoa, "0000000")
        End If
        badago = Application.IfError(Application.Match(unekoa, Sheets("BoM").Range(BoMColCod & inicio & ":" & BoMColCod & fin), 0), -1)
        If badago > 0 Then
            Sheets("BoM").Range(BoMUltCol & inicio + badago - 1).Value = xlWbk.Sheets(1).Range(AcadColCant & i).Value
        Else
            Mzz_FromAutocadRevit.creaLineaParaAutocadRevit
            fin = Sheets("Data").Range("FilaFinArticulos").Value
            egoeraTemp = Application.EnableEvents
            'Application.EnableEvents = True
            Sheets("BoM").Range(BoMColCod & fin).Value = unekoa
            Sheets("BoM").Range(BoMUltCol & fin).Value = xlWbk.Sheets(1).Range(AcadColCant & i).Value
            'Application.EnableEvents = egoeraTemp
        End If
    Next
    eguneratuArtikuluenDatuak
    xlObj.ScreenUpdating = True
    xlObj.EnableEvents = True
    xlObj.DisplayAlerts = True
    If Not xlWbk Is Nothing Then
        xlWbk.Close
        Set xlWbk = Nothing
    End If
    If Not xlObj Is Nothing Then
        xlObj.Quit
        Set xlObj = Nothing
    End If
    GoTo finTag
x:
    MsgBox "Error exporting to Repcon", vbCritical
finTag:
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub


Sub creaLineaParaAutocadRevit()
    Dim stock, sobra, falta, colInicio As String
    colInicio = Sheets("Data").Range("ColumInicioLista").Value
    colFin = Sheets("Data").Range("ColumFinLista").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    sarpuntua = fin + 1
    zenbat = 1
    Sheets("BoM").Rows(sarpuntua & ":" & sarpuntua).Select
    ActiveCell.EntireRow.Resize(zenbat).Insert
    Sheets("BoM").Range("B" & sarpuntua - zenbat & ":" & colFin & sarpuntua - zenbat).Select
    Selection.Copy
    Sheets("BoM").Range("B" & sarpuntua & ":" & colFin & sarpuntua + zenbat - 1).Select
    ActiveSheet.Paste
    Range("D" & sarpuntua & ":E" & sarpuntua + zenbat - 1 & ",G" & sarpuntua & ":G" & sarpuntua + zenbat - 1 & ",J" & sarpuntua & ":J" & sarpuntua + zenbat - 1 & ",L" & sarpuntua & ":L" & sarpuntua + zenbat - 1 & ",P" & sarpuntua & ":P" & sarpuntua + zenbat - 1 & ",R" & sarpuntua & ":" & colFin & sarpuntua + zenbat - 1).Select
    'Range("M" & sarpuntua).Activate
    Application.CutCopyMode = False
    Selection.ClearContents
    Selection.ClearComments
    Range("K" & sarpuntua & ":K" & sarpuntua + zenbat - 1).Value = 1#
    Range("M" & sarpuntua & ":M" & sarpuntua + zenbat - 1).Value = 1#
End Sub

Sub creaColumnaParaAutocadRevit()
    'BOM
    Application.Sheets("BoM").Unprotect
    Application.Sheets("Summary").Unprotect
    Dim stock, sobra, falta, colInicio, sarpuntuaLetra, norainoletra As String
    Dim inicio, fin, zenbat As Integer
    Dim rConstants As Range
    colInicio = Sheets("Data").Range("NumColumInicioLista").Value
    colFin = Sheets("Data").Range("NumColumFinLista").Value
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    sarpuntua = colFin
    sarpuntuaLetra = ConvertToLetter(sarpuntua)
    zenbat = 1
    norainoletra = ConvertToLetter(sarpuntua + zenbat)
    'Sheets("BoM").Columns(sarpuntua).Select
    Sheets("BoM").Columns(sarpuntua).EntireColumn.Offset(, 1).Resize(, 1).Insert
    Sheets("BoM").Range(sarpuntuaLetra & inicio - 6 & ":" & sarpuntuaLetra & fin + 1000).Select
    Selection.Copy
    kopiama = ConvertToLetter(ConvertToNumber(norainoletra))
    Sheets("BoM").Range(kopiama & inicio - 6 & ":" & kopiama & fin + 1000).Select
    ActiveSheet.Paste
    Sheets("BoM").Range(norainoletra & inicio - 5 & ":" & kopiama & inicio - 5).Locked = False
    On Error Resume Next
    Sheets("BoM").Range(norainoletra & inicio - 6).Formula = ""
    Set rConstants = Sheets("BoM").Range(norainoletra & inicio - 6 & ":" & kopiama & fin + 1000).SpecialCells(xlCellTypeConstants)
    rConstants.ClearContents
    rConstants.ClearComments
    Application.CutCopyMode = False
    Sheets("BoM").Range("A1").Select
    'SUMMARY
    Dim filafintajo, filafinprecio, filafinpeso As Integer
    Dim ColumnaTajoS, ColumnaMultTajoS, ColumnaListaS, ColumnaMultListaS, ColumnaAlquilerS As String
    filafintajo = Sheets("Data").Range("FilaFinTajos").Value
    ColumnaTajoS = Sheets("Data").Range("ColumnaTajoS").Value
    ColumnaMultTajoS = Sheets("Data").Range("ColumnaMultTajoS").Value
    ColumnaListaS = Sheets("Data").Range("ColumnaListaS").Value
    ColumnaMultListaS = Sheets("Data").Range("ColumnaMultListaS").Value
    ColumnaAlquilerS = Sheets("Data").Range("ColumnaAlquilerS").Value
    Sheets("Summary").Select
    Sheets("Summary").Rows(filafintajo).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafintajo & ":" & "ZZ" & filafintajo).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafintajo + 1 & ":" & "ZZ" & filafintajo + 1).Select
    ActiveSheet.Paste
    Set rConstants = Sheets("Summary").Range("A" & filafintajo + 1 & ":" & "ZZ" & filafintajo + 1).SpecialCells(xlCellTypeConstants)
    rConstants.ClearContents
    rConstants.ClearComments
    Sheets("Summary").Range(ColumnaTajoS & filafintajo + 1).Value = "NEW UNIT " & Sheets("Data").Range("NumNuevoTajo").Value
    Sheets("Data").Range("NumNuevoTajo").Value = Sheets("Data").Range("NumNuevoTajo").Value + 1
    Sheets("Summary").Range(ColumnaMultTajoS & filafintajo + 1).Value = 1
    Sheets("Summary").Range(ColumnaListaS & filafintajo + 1).Value = "FROM ACAD " & Sheets("Data").Range("NumNuevaLista").Value
    Sheets("Data").Range("NumNuevaLista").Value = Sheets("Data").Range("NumNuevaLista").Value + 1
    Sheets("Summary").Range(ColumnaMultListaS & filafintajo + 1).Value = 1
    Sheets("Summary").Range(ColumnaAlquilerS & filafintajo + 1).Value = 0
    ''
    filafinprecio = Sheets("Data").Range("FilaFinPrecio").Value
    Sheets("Summary").Rows(filafinprecio).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafinprecio & ":" & "ZZ" & filafinprecio).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafinprecio + 1 & ":" & "ZZ" & filafinprecio + 1).Select
    ActiveSheet.Paste
    ''
    filafinpeso = Sheets("Data").Range("FilaFinPeso").Value
    Sheets("Summary").Rows(filafinpeso).Select
    ActiveCell.EntireRow.Offset(1).Resize(1).Insert
    Sheets("Summary").Range("A" & filafinpeso & ":" & "ZZ" & filafinpeso).Select
    Selection.Copy
    Sheets("Summary").Range("A" & filafinpeso + 1 & ":" & "ZZ" & filafinpeso + 1).Select
    ActiveSheet.Paste
    Application.CutCopyMode = False
    Sheets("BoM").Select
    Application.Sheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    Application.Sheets("BoM").EnableOutlining = True
    Application.Sheets("Summary").Protect
End Sub


Sub eguneratuArtikuluenDatuak()
    inicio = ThisWorkbook.Sheets("Data").Range("FilaInicioArticulos").Value
    fin = ThisWorkbook.Sheets("Data").Range("FilaFinArticulos").Value
    For i = inicio To fin
        If Worksheets("BoM").OLEObjects("cmd_modoXML").Object.Caption = "Online" Then
            rellenaDatosXML (i)
            familiaEzezagunaLerroa (i)
        End If
        PROzesatuBakarra (i)
    Next
End Sub
Attribute VB_Name = "Mzz_ObtenerDatosDesdeXML"
Public pathXML As String
Private pathXMLLocal As String
Private articulosXML As String
Private grupoSubgrupoXML As String
Private tarifasXML As String
Private pesoArt, areaArt, descArt, familiaArt, codAvisoArt As String

Public Sub initPaths()
    pathXML = "{|fffd||fffd||04||fffd||fffd|[|fffd|]|01||fffd||fffd||fffd||fffd||fffd||fffd||0f||17|e|fffd||fffd|MZ|fffd|tn|fffd||fffd|0|fffd|Cyl|fffd|"
    pathXMLLocal = "||fffd||fffd|7|7f||fffd||fffd||fffd||fffd||fffd||10||fffd|M|14|\l]|01||fffd|wYa,|fffd|c|fffd|<v|19||18|y|fffd|L|fffd|||fffd||fffd|5w|71c||01|)|fffd||fffd||fffd||fffd||10||1a||fffd||fffd||fffd|Kg|fffd||1b|O|fffd|rjX|fffd||165|S|fffd||fffd|8|fffd|r"
    articulosXML = "_articles.xml"
    grupoSubgrupoXML = "groups_subgroups_elements.xml"
    tarifasXML = "_fees.xml"
End Sub

Function open_XML_Articulos(ByVal compania As String) As Object
    'Create xml object
    initPaths
    Dim myXML As Object
    Set myXML = CreateObject("MSXML2.DOMDocument.6.0")

    myXML.Load RunRC4(pathXML, "qwerty") & compania & articulosXML

    If myXML.parseError <> 0 Then
        MsgBox "Something went wrong loading XML!" & vbCrLf & vbCrLf & myXML.parseError.reason
        Exit Function
    End If
    Set open_XML_Articulos = myXML
End Function

Function open_XML_Precios(ByVal compania As String) As Object
    'Create xml object
    initPaths
    Dim myXML As Object
    Set myXML = CreateObject("MSXML2.DOMDocument.6.0")

    myXML.Load RunRC4(pathXMLLocal, "abcdef") & compania & tarifasXML

    If myXML.parseError <> 0 Then
        MsgBox "Something went wrong loading XML!" & vbCrLf & vbCrLf & myXML.parseError.reason
        Exit Function
    End If
    Set open_XML_Precios = myXML
End Function
'Idioma: 0_Local, 1_Spanish, 2_English, 3_French
Private Function ObtenerNombreArticuloDesdeXML(ByVal myXML As Object, ByVal compania As String, ByVal codigo As String, ByVal idioma As Integer) As String
    Dim myNodes As Object
    Dim myNode As Object
    Dim myRow As Integer
    Dim desc As String
    
    desc = Sheets("Languages").Range("ID_MaterialDesconocido").Value

    Set myNodes = myXML.SelectNodes("//article")
    myRow = 1
    For Each myNode In myNodes
        If myNode.SelectSingleNode("articleCode").text = UCase(codigo) Then
            Select Case idioma
                Case 0
                    desc = myNode.SelectSingleNode("description[@language='local']").text
                Case 1
                    desc = myNode.SelectSingleNode("description[@language='EScorp']").text
                Case 2
                    desc = myNode.SelectSingleNode("description[@language='ENcorp']").text
                Case 3
                    desc = myNode.SelectSingleNode("description[@language='FRcorp']").text
                Case Else
                    desc = myNode.SelectSingleNode("description[@language='local']").text
            End Select
            Exit For
        End If
        myRow = myRow + 1
    Next myNode
    ObtenerNombreArticuloDesdeXML = desc
End Function

Private Function ObtenerPesoArticuloDesdeXML(ByVal myXML As Object, ByVal compania As String, ByVal codigo As String) As String
    Dim myXML As Object
    Dim myNodes As Object
    Dim myNode As Object
    Dim myRow As Integer
    Dim peso As String

    peso = 0
    

    Set myNodes = myXML.SelectNodes("//article")
    myRow = 1
    For Each myNode In myNodes
        If myNode.SelectSingleNode("articleCode").text = UCase(codigo) Then
            peso = myNode.SelectSingleNode("aditionalData/weight").text
            Exit For
        End If
        myRow = myRow + 1
    Next myNode
    ObtenerPesoArticuloDesdeXML = peso
End Function

Private Function ObtenerAreaArticuloDesdeXML(ByVal myXML As Object, ByVal compania As String, ByVal codigo As String) As String
    Dim myNodes As Object
    Dim myNode As Object
    Dim myRow As Integer
    Dim area As String
    
    area = 0

    Set myNodes = myXML.SelectNodes("//article")
    myRow = 1
    For Each myNode In myNodes
        If myNode.SelectSingleNode("articleCode").text = UCase(codigo) Then
            On Error Resume Next
            area = myNode.SelectSingleNode("aditionalData/formArea").text
            Exit For
        End If
        myRow = myRow + 1
    Next myNode
    ObtenerAreaArticuloDesdeXML = area
End Function

Private Function ObtenerPrecioArticuloDesdeXML(ByVal myXML As Object, ByVal compania As String, ByVal codigo As String, ByVal tarifa As String) As String
    Dim myNodes As Object
    Dim myNode As Object
    Dim myRow As Integer
    Dim precio As String
    
    precio = 0


    Set myNodes = myXML.SelectNodes("//fee")
    myRow = 1
    For Each myNode In myNodes
        If myNode.SelectSingleNode("feeCode").text = tarifa Then
            'Set artNodes = myNode.ChildNodes(3).SelectNodes("//articles")
            Set artNodes = myNode.SelectSingleNode("articles")
                  For Each artNode In artNodes.ChildNodes
                        If artNode.SelectSingleNode("articleCode").text = UCase(codigo) Then
                            'On Error Resume Next
                            precio = artNode.SelectSingleNode("price").text
                            Exit For
                        End If
                 Next
        End If
        myRow = myRow + 1
    Next myNode
    ObtenerPrecioArticuloDesdeXML = precio
End Function


Private Function ObtenerFamiliaArticuloDesdeXML(ByVal myXML As Object, ByVal compania As String, ByVal codigo As String) As String
    Dim myXML As Object
    Dim myNodes As Object
    Dim myNode As Object
    Dim myRow As Integer
    Dim familia As String

    familia = ""
    

    Set myNodes = myXML.SelectNodes("//article")
    myRow = 1
    For Each myNode In myNodes
        If myNode.SelectSingleNode("articleCode").text = UCase(codigo) Then
            familia = myNode.SelectSingleNode("Family").text
            Exit For
        End If
        myRow = myRow + 1
    Next myNode
    ObtenerPesoArticuloDesdeXML = familia
End Function

Private Sub ObtenerDatosArticuloDesdeXML(ByVal myXML As Object, ByVal compania As String, ByVal codigo As String, ByVal idioma As Integer)
    Dim myNodes As Object
    Dim myNode As Object
    Dim myRow As Integer
    Dim desc, peso, area, fami, cod, cod120 As String
    
    desc = Sheets("Languages").Range("ID_MaterialDesconocido").Value
    area = 0
    peso = 0
    codAvisoArt = ""
    Set myNodes = myXML.SelectNodes("//article")
    myRow = 1
    For Each myNode In myNodes
        If myNode.SelectSingleNode("articleCode").text = UCase(codigo) Then
            Select Case idioma
                Case 0
                    desc = myNode.SelectSingleNode("description[@language='local']").text
                Case 1
                    desc = myNode.SelectSingleNode("description[@language='es']").text
                Case 2
                    desc = myNode.SelectSingleNode("description[@language='en']").text
                Case 3
                    desc = myNode.SelectSingleNode("description[@language='fr']").text
                Case Else
                    desc = myNode.SelectSingleNode("description[@language='local']").text
            End Select
            peso = myNode.SelectSingleNode("aditionalData/weight").text
            On Error Resume Next
            area = myNode.SelectSingleNode("aditionalData/formArea").text
            fami = myNode.SelectSingleNode("Family").text
            cod = myNode.SelectSingleNode("WarningCode").text
            cod120 = myNode.SelectSingleNode("WarningCode120").text
            Exit For
        End If
        myRow = myRow + 1
    Next myNode
    pesoArt = peso
    areaArt = area
    descArt = desc
    familiaArt = fami
    If cod120 = "PRO" Then
        codAvisoArt = cod120
    End If
End Sub



Sub rellenaDatosXML(ByVal linea As Integer)
    Dim egoeraSU As Boolean, egoeraEE As Boolean
    egoeraSU = Application.ScreenUpdating
    egoeraEE = Application.EnableEvents
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Dim compania As String
    Dim myXML As Object
    Dim myXMLFee As Object
    compania = Sheets("Data").Range("CiaDatos").Value
    codigo = Sheets("BoM").Range("D" & linea).Value
    Set myXML = open_XML_Articulos(compania)
    'Set myXMLFee = open_XML_Precios(compania)
    tarifaAlq = Application.text(Replace(Replace(separadorCodNom(Sheets("BoM").Range("ID_Data_Tarifa").Value, " ", True), "[", ""), "]", ""), "000")
    tarifaVenta = Application.text(Replace(Replace(separadorCodNom(Sheets("BoM").Range("ID_Data_TarifaVenta").Value, " ", True), "[", ""), "]", ""), "000")
    ObtenerDatosArticuloDesdeXML myXML, compania, codigo, 0 'idioma local
    
    Sheets("BoM").Range("E" & linea).Value = descArt 'ObtenerNombreArticuloDesdeXML(compania, Codigo, 0) 'Descripcion
    Sheets("BoM").Range("F" & linea).Value = "=A1Alquiler" 'ModoSum
    
'    Sheets("BoM").Range("G" & linea).Value = ObtenerPrecioArticuloDesdeXML(myXMLFee, compania, codigo, tarifaAlq) 'PrecioAlquiler
'    Sheets("BoM").Range("I" & linea).Value = ObtenerPrecioArticuloDesdeXML(myXMLFee, compania, codigo, tarifaVenta) 'PrecioVenta
    Sheets("BoM").Range("J" & linea).Value = 0 'PrecioAlquiler
    Sheets("BoM").Range("L" & linea).Value = 0 'PrecioVenta
    Sheets("BoM").Range("P" & linea).Value = pesoArt 'ObtenerPesoArticuloDesdeXML(compania, Codigo) 'Peso
    Sheets("BoM").Range("R" & linea).Value = areaArt ' ObtenerAreaArticuloDesdeXML(compania, Codigo) 'Area
    Sheets("BoM").Range("G" & linea).Value = familiaArt 'ObtenerFamiliaArticuloDesdeXML(compania, Codigo) 'Familia
    Sheets("BoM").Range("A" & linea).Value = codAvisoArt 'ObtenerCodigoAvisoArticuloDesdeXML(compania, Codigo) 'codAviso
    
    Application.ScreenUpdating = egoeraSU
    Application.EnableEvents = egoeraEE
    
End Sub

Sub cambiaIdiomaDesc(ByVal idioma As Integer)
    Dim egoeraSU As Boolean, egoeraEE As Boolean
    egoeraSU = Application.ScreenUpdating
    egoeraEE = Application.EnableEvents
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    idFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    familyCol = Application.Match(idFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0)
    familiaDesc = Sheets("Languages").Range("ID_FamiliaDesconicida").Value
    Dim compania As String
    Dim myXML As Object
    compania = Sheets("Data").Range("CiaDatos").Value
    Set myXML = open_XML_Articulos(compania)
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    For i = inicio To fin
        familia = Sheets("BoM").Range(ConvertToLetter(familyCol) & i).Value
       If (Trim(Sheets("BoM").Range("G" & i).Value) <> "" And familia <> familiaDesc) Then
            codigo = Sheets("BoM").Range("D" & i).Value
            Sheets("BoM").Range("E" & i).Value = ObtenerNombreArticuloDesdeXML(myXML, compania, codigo, idioma)
        End If
    Next
        Application.ScreenUpdating = egoeraSU
    Application.EnableEvents = egoeraEE
End Sub



'Sub actualizarPrecios()
'    Dim egoeraSU As Boolean, egoeraEE As Boolean
'    egoeraSU = Application.ScreenUpdating
'    egoeraEE = Application.EnableEvents
'    Application.ScreenUpdating = False
'    Application.EnableEvents = False
'    Dim compania As String, codigo As String, descripcion As String
'    Dim myXMLFee As Object
'    compania = Sheets("Data").Range("CiaDatos").Value
'    tarifaAlq = Application.text(Replace(Replace(separadorCodNom(Sheets("BoM").Range("ID_Data_Tarifa").Value, " ", True), "[", ""), "]", ""), "000")
'    tarifaVenta = Application.text(Replace(Replace(separadorCodNom(Sheets("BoM").Range("ID_Data_TarifaVenta").Value, " ", True), "[", ""), "]", ""), "000")
'    Set myXMLFee = open_XML_Precios(compania)
'    Dim inicio As Integer, fin As Integer
'    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
'    fin = Sheets("Data").Range("FilaFinArticulos").Value
'    For i = inicio To fin
'        codigo = Sheets("BoM").Range("D" & i).Value
'        descripcion = Sheets("BoM").Range("E" & i).Value
'        precioAlqAct = Sheets("BoM").Range("I" & i).Value
'        precioVentaAct = Sheets("BoM").Range("J" & i).Value
'        precioAlq = ObtenerPrecioArticuloDesdeXML(myXMLFee, compania, codigo, tarifaAlq)
'        precioVenta = ObtenerPrecioArticuloDesdeXML(myXMLFee, compania, codigo, tarifaVenta)
''        If precioAlq = -1 And Left(descripcion, 4) <> "****" Then
''            precioAlq = precioAlqAct
''        ElseIf precioAlq = -1 And Left(descripcion, 4) = "****" Then
''            precioAlq = 0
''        End If
''        If precioVenta = -1 And Left(descripcion, 4) <> "****" Then
''            precioVenta = precioVentaAct
''        ElseIf precioVenta = -1 And Left(descripcion, 4) = "****" Then
''            precioVenta = 0
''        End If
'        Sheets("BoM").Range("I" & i).Value = precioAlq
'        Sheets("BoM").Range("J" & i).Value = precioVenta
'    Next
'    Application.ScreenUpdating = egoeraSU
'    Application.EnableEvents = egoeraEE
'End Sub



'CODIGO DE AVISO
'-------------------

Private Function ObtenerCodigoAvisoArticuloDesdeXML(ByVal myXML As Object, ByVal compania As String, ByVal codigo As String) As String
    Dim myXML As Object
    Dim myNodes As Object
    Dim myNode As Object
    Dim myRow As Integer
    Dim result As String

    result = ""
    

    Set myNodes = myXML.SelectNodes("//article")
    myRow = 1
    For Each myNode In myNodes
        If myNode.SelectSingleNode("articleCode").text = UCase(codigo) Then
            cod = myNode.SelectSingleNode("WarningCode").text
            cod120 = myNode.SelectSingleNode("WarningCode120").text
            Exit For
        End If
        myRow = myRow + 1
    Next myNode
    If cod120 = "PRO" Then
        result = "PRO"
    End If
        
    ObtenerCodigoAvisoArticuloDesdeXML = result
End Function
Attribute VB_Name = "Mzz_SavePNG"
Sub SavePNG()
    Dim PicPath As String
    Dim OutPutPath As String
    Dim wS As Worksheet
    ThisWorkbook.Worksheets("BoM").Unprotect
    Set wS = ThisWorkbook.Sheets("BoM")
    OutPutPath = "C:\temp\"
    If wS.PageSetup.printArea <> "" Then
        PicPath = Generate_Image_From_Range(wS, wS.Range(wS.PageSetup.printArea).Address, OutPutPath, "pic", "png", False)
        MsgBox wS.Name & " exported to : " & vbCrLf & _
                PicPath, vbInformation + vbOKOnly
    Else
        MsgBox "Please, set Print Area before using this tool"
    End If
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
End Sub



Public Function Generate_Image_From_Range(wS As Worksheet, _
                                        RgStr As String, _
                                        OutPutPath As String, _
                                        ImgName As String, _
                                        ImgType As String, _
                                        Optional TrueToTuneFilters As Boolean = False) As String
    Dim ImgPath As String
    Dim oRng As Range
    Dim oChrtO As ChartObject
    Dim lWidth As Long, lHeight As Long
    Dim ActSh As Worksheet
    Dim ValScUp As Boolean
    ImgPath = OutPutPath & ImgName & "." & ImgType
    Set ActSh = ActiveSheet
    Set oRng = wS.Range(RgStr)

    wS.Activate
'On Error GoTo ErrHdlr
    With oRng
        .Select
        '''Zoom to improve render
        ValScUp = Application.ScreenUpdating
        Application.ScreenUpdating = False
        zooma = ActiveWindow.Zoom
        ActiveWindow.Zoom = True
        DoEvents
        Application.ScreenUpdating = ValScUp

        lWidth = .Width
        lHeight = .Height
        .CopyPicture xlScreen, xlBitmap        'Best render
       
    End With 'oRng


    Set oChrtO = wS.ChartObjects.Add(Left:=0, Top:=0, Width:=lWidth, Height:=lHeight)
    With oChrtO
        .Activate
        .Chart.Paste
        With .ShapeRange
            .line.Visible = msoFalse
            .Fill.Visible = msoFalse
            With .Chart.Shapes.Item(1)
                .line.Visible = msoFalse
                .Fill.Visible = msoFalse
            End With '.Chart.Shapes.Item (1)
        End With '.ShapeRange
        With .Chart
            DoEvents
            .Export Filename:=ImgPath, Filtername:=ImgType, Interactive:=TrueToTuneFilters
'            If Not TrueToTuneFilters Then _
'                .Export filename:=ImgPath, Filtername:=ImgType, Interactive:=False
'            If TrueToTuneFilters Then _
'                .Export filename:=ImgPath, Filtername:=ImgType, Interactive:=True
        End With '.Chart
        DoEvents
        .Delete
    End With 'oChrtO
    ActiveWindow.Zoom = zooma
    ActSh.Activate
    
    Generate_Image_From_Range = ImgPath
On Error GoTo 0
Exit Function
ErrHdlr:
Generate_Image_From_Range = vbNullString
End Function

Attribute VB_Name = "Mzz_Split_Join_ColumnasGR"
Sub splitInColumns(Optional ByVal columna As String)
    unirAUnaColumna
    ThisWorkbook.Worksheets("BoM").Unprotect
    ThisWorkbook.Worksheets("Summary").Unprotect
    egoera1 = Application.ScreenUpdating
    egoera2 = Application.EnableEvents
    egoera3 = Application.DisplayAlerts
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.DisplayAlerts = False
    Dim inicio As Integer
    Dim fin As Integer
    Dim inicioCol As String
    Dim finCol As String
    Dim zerrenda() As String
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    inicioCol = Sheets("Data").Range("ColumInicioLista").Value
    finCol = Sheets("Data").Range("ColumFinLista").Value
    If finCol = inicioCol Then
        aldatuZutabeIzenaBakarraDagoenean "Processing"
        If IsMissing(columna) Or columna = "" Then
            zerrenda = getGrSGr
        Else
            zerrenda = getzerrenda(columna)
        End If
        For i = 0 To UBound(zerrenda)
            creaColumna (zerrenda(i))
        Next
        'Zutabe berriak sartu ditugunez, azken zutabearen balio berritua hartu
        finCol = Sheets("Data").Range("ColumFinLista").Value
        '
        filaTitulos = inicio - 1
        idProducto = Sheets("Languages").Range("ID_Producto").Value
        grCol = ConvertToLetter(Application.IfError(Application.Match(idProducto, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0), 702))
        idAgrupacion = Sheets("Languages").Range("ID_Agrupacion").Value
        sgrCol = ConvertToLetter(Application.IfError(Application.Match(idAgrupacion, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0), 702))
        For i = inicio To fin
            If IsMissing(columna) Or columna = "" Then
                grSgr = Sheets("BoM").Range(grCol & i).Value & "_" & Sheets("BoM").Range(sgrCol & i).Value
            Else
                grSgr = Sheets("BoM").Range(columna & i).Value
            End If
            If IsEmpty(grSgr) Then
                grSgr = ""
            End If
            colInsert = ConvertToLetter(Application.Match(grSgr, Sheets("BoM").Range(filaTitulos - 2 & ":" & filaTitulos - 2), 0))
            Sheets("BoM").Range(colInsert & i).Value = Sheets("BoM").Range(inicioCol & i).Value * Sheets("BoM").Range(inicioCol & inicio - 1).Value * Sheets("BoM").Range(inicioCol & inicio - 4).Value
        Next
        'Ezabatu lehen zutabea
        Mzz_Columnas.eliminaColumna (inicioCol)
    End If
    Application.ScreenUpdating = egoera1
    Application.EnableEvents = egoera2
    Application.DisplayAlerts = egoera3
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
    ThisWorkbook.Worksheets("Summary").Protect
End Sub

Function getGrSGr() As String()
    Dim grCol As String
    Dim sgrCol As String
    Dim inicio As Integer
    Dim fin As Integer
    Dim inicioCol As String
    Dim finCol As String
    ReDim zerrenda(0) As String
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    inicioCol = Sheets("Data").Range("ColumInicioLista").Value
    finCol = Sheets("Data").Range("ColumFinLista").Value
    filaTitulos = inicio - 1
    idProducto = Sheets("Languages").Range("ID_Producto").Value
    grCol = ConvertToLetter(Application.Match(idProducto, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    idAgrupacion = Sheets("Languages").Range("ID_Agrupacion").Value
    sgrCol = ConvertToLetter(Application.Match(idAgrupacion, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    lehenDatua = True
    For i = inicio To fin
        unekoGR = Sheets("BoM").Range(grCol & i).Value
        unekoSGR = Sheets("BoM").Range(sgrCol & i).Value
        If lehenDatua Then
            zerrenda(UBound(zerrenda)) = unekoGR & "_" & unekoSGR
            lehenDatua = False
        End If
        If (Not IsInArrayExact(unekoGR & "_" & unekoSGR, zerrenda)) Then
            ReDim Preserve zerrenda(UBound(zerrenda) + 1)
            zerrenda(UBound(zerrenda)) = unekoGR & "_" & unekoSGR
        End If
    Next
    getGrSGr = zerrenda
End Function

Function getzerrenda(ByVal columna As String) As String()
    Dim inicio As Integer
    Dim fin As Integer
    Dim inicioCol As String
    Dim finCol As String
    ReDim zerrenda(0) As String
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    inicioCol = Sheets("Data").Range("ColumInicioLista").Value
    finCol = Sheets("Data").Range("ColumFinLista").Value
    filaTitulos = inicio - 1
    lehenDatua = True
    For i = inicio To fin
        unekoDatua = Sheets("BoM").Range(columna & i).Value
        If lehenDatua Then
            zerrenda(UBound(zerrenda)) = unekoDatua
            lehenDatua = False
        End If
        If (Not IsInArrayExact(unekoDatua, zerrenda)) Then
            ReDim Preserve zerrenda(UBound(zerrenda) + 1)
            zerrenda(UBound(zerrenda)) = unekoDatua
        End If
    Next
    getzerrenda = zerrenda
End Function

Sub unirAUnaColumna()
    ThisWorkbook.Worksheets("BoM").Unprotect
    ThisWorkbook.Worksheets("Summary").Unprotect
    egoera1 = Application.ScreenUpdating
    egoera2 = Application.EnableEvents
    egoera3 = Application.DisplayAlerts
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    Application.DisplayAlerts = False
    Dim inicio As Integer
    Dim fin As Integer
    Dim inicioCol As String
    Dim finCol As String
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    inicioCol = ConvertToNumber(Sheets("Data").Range("ColumInicioLista").Value)
    finCol = ConvertToNumber(Sheets("Data").Range("ColumFinLista").Value)
    If inicioCol <> finCol Then
        creaColumna ("JOINED COLUMN")
        finCol = ConvertToNumber(Sheets("Data").Range("ColumFinLista").Value)
        For i = inicio To fin
            batura = 0
            For j = inicioCol To finCol - 1
                unekoZut = ConvertToLetter(j)
                batura = batura + Sheets("BoM").Range(unekoZut & i).Value * Sheets("BoM").Range(unekoZut & inicio - 1).Value * Sheets("BoM").Range(unekoZut & inicio - 4).Value
            Next
            Sheets("BoM").Range(ConvertToLetter(finCol) & i).Value = batura
        Next
        For h = inicioCol To finCol - 1
            zutabea = ConvertToLetter(inicioCol)
            Mzz_Columnas.eliminaColumna (zutabea)
        Next
    End If
    Application.ScreenUpdating = egoera1
    Application.EnableEvents = egoera2
    Application.DisplayAlerts = egoera3
    ThisWorkbook.Worksheets("BoM").Protect AllowFormattingCells:=True, AllowFormattingColumns:=True, AllowFormattingRows:=True, AllowInsertingRows:=True, AllowDeletingRows:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("BoM").EnableOutlining = True
    ThisWorkbook.Worksheets("Summary").Protect
End Sub
Attribute VB_Name = "Mzz_ToRepcon"

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     CSV PARA REPCON (VolcadosACAD)
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Sub toRepcon()
    Dim inicio, fin As Integer
    Dim colTot As String
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    colTot1 = "H"
    colTot2 = "I"
    colCod = "D"
    excelizena = "C:\ULMA\Repcon_57\VolcadosACAD\BCExcel.xlsx"
    Dim xlObj As Object
    Set xlObj = CreateObject("Excel.Application")
    xlObj.Visible = False
    xlObj.ScreenUpdating = False
    xlObj.EnableEvents = False
    xlObj.DisplayAlerts = False
    Dim xlWbk  As Object
    Set xlWbk = xlObj.Workbooks.Add()
    'goiburua
    xlWbk.Sheets(1).Range("A1").Value = "Code"
    xlWbk.Sheets(1).Range("B1").Value = "Quantity"
    j = 2
    For i = inicio To fin
        kodea = Sheets("BoM").Range(colCod & i).Value
        kantitatea = Sheets("BoM").Range(colTot1 & i).Value + Sheets("BoM").Range(colTot2 & i).Value
        xlWbk.Sheets(1).Range("A" & j).Value = kodea
        xlWbk.Sheets(1).Range("B" & j).Value = kantitatea
        j = j + 1
    Next
    xlWbk.SaveAs excelizena, AccessMode:=xlExclusive, ConflictResolution:=Excel.XlSaveConflictResolution.xlLocalSessionChanges
    xlObj.ScreenUpdating = True
    xlObj.EnableEvents = True
    xlObj.DisplayAlerts = True
    If Not xlWbk Is Nothing Then
        xlWbk.Close
        Set xlWbk = Nothing
    End If
    If Not xlObj Is Nothing Then
        xlObj.Quit
        Set xlObj = Nothing
    End If
        MsgBox "Exported to Repcon succesfully", vbInformation
    GoTo fin
x:
    MsgBox "Error exporting to Repcon", vbCritical
fin:
End Sub

Attribute VB_Name = "ProgressBar"
Attribute VB_Base = "0{31B39218-D1F4-4729-BF12-99E5458D635C}{A0655A18-DD16-4A61-A39D-222D9A84D698}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub UserForm_Activate()
    With ProgressBar
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
    End With
End Sub

Attribute VB_Name = "ReleaseForm"
Attribute VB_Base = "0{1B59961A-B067-4E1B-A026-8B922D44FDBB}{5D35213C-99F1-4F38-AEAF-996A3E50D109}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False




Private Sub CommandButton1_Click()
If (Application.Trim(ReleaseForm.txt_Hours.Value) = "" Or Application.Trim(ReleaseForm.txt_Salesman.Value) = "" Or Application.Trim(ReleaseForm.txt_Family.Value) = "" Or Application.Trim(ReleaseForm.txt_JobNumber.Value) = "" Or Application.Trim(ReleaseForm.txt_Project.Value) = "" Or Application.Trim(ReleaseForm.txt_Area.Value) = "" Or Application.Trim(ReleaseForm.txt_ShipDate.Value) = "") Then
   If Application.Trim(ReleaseForm.txt_Hours.Value) = "" Then
        ReleaseForm.txt_Hours.BackColor = vbRed
   Else
        ReleaseForm.txt_Hours.BackColor = &HE0E0E0
   End If
   If Application.Trim(ReleaseForm.txt_Salesman.Value) = "" Then
        ReleaseForm.txt_Salesman.BackColor = vbRed
   Else
        ReleaseForm.txt_Salesman.BackColor = &HE0E0E0
   End If
   If Application.Trim(ReleaseForm.txt_Family.Value) = "" Then
        ReleaseForm.txt_Family.BackColor = vbRed
   Else
        ReleaseForm.txt_Family.BackColor = &HE0E0E0
   End If
   If Application.Trim(ReleaseForm.txt_JobNumber.Value) = "" Then
        ReleaseForm.txt_JobNumber.BackColor = vbRed
   Else
        ReleaseForm.txt_JobNumber.BackColor = &HE0E0E0
   End If
   If Application.Trim(ReleaseForm.txt_Project.Value) = "" Then
        ReleaseForm.txt_Project.BackColor = vbRed
   Else
        ReleaseForm.txt_Project.BackColor = &HE0E0E0
   End If
   If Application.Trim(ReleaseForm.txt_Area.Value) = "" Then
        ReleaseForm.txt_Area.BackColor = vbRed
   Else
        ReleaseForm.txt_Area.BackColor = &HE0E0E0
   End If
   If Application.Trim(ReleaseForm.txt_ShipDate.Value) = "" Then
        ReleaseForm.txt_ShipDate.BackColor = vbRed
   Else
        ReleaseForm.txt_ShipDate.BackColor = &HE0E0E0
   End If
Else
    simple_release
    Unload Me
End If
End Sub

Private Sub CommandButton2_Click()
    Unload Me
End Sub



Private Sub txt_Area_Change()
    If ReleaseForm.txt_Area.Value <> "" Then
       ReleaseForm.txt_Area.BackColor = &HE0E0E0
    End If
End Sub

Private Sub txt_Family_Change()
    If ReleaseForm.txt_Family.Value <> "" Then
       ReleaseForm.txt_Family.BackColor = &HE0E0E0
    End If
End Sub

Private Sub txt_Hours_Change()
    If ReleaseForm.txt_Hours.Value <> "" Then
       ReleaseForm.txt_Hours.BackColor = &HE0E0E0
    End If
End Sub

Private Sub txt_JobNumber_Change()
    If ReleaseForm.txt_JobNumber.Value <> "" Then
       ReleaseForm.txt_JobNumber.BackColor = &HE0E0E0
    End If
End Sub

Private Sub txt_Project_Change()
    If ReleaseForm.txt_Project.Value <> "" Then
       ReleaseForm.txt_Project.BackColor = &HE0E0E0
    End If
End Sub

Private Sub txt_Salesman_Change()
    If ReleaseForm.txt_Salesman.Value <> "" Then
       ReleaseForm.txt_Salesman.BackColor = &HE0E0E0
    End If
End Sub

Private Sub txt_ShipDate_Change()
    If ReleaseForm.txt_ShipDate.Value <> "" Then
       ReleaseForm.txt_ShipDate.BackColor = &HE0E0E0
    End If
End Sub

Private Sub UserForm_Activate()
With ReleaseForm
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))

        'Bete datuak Repconeko goiburutik
        .txt_JobNumber.Value = separadorCodNom(Application.Trim(Worksheets("BoM").Range("ID_Data_NumEstudio")), "//", False) '' Job Number - Study Number??
        .txt_Customer.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Cliente")) '' Customer - Customer
        .txt_Project.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_ObraGet")) '' Project - Jobsite
        .txt_Area.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Tajo")) '' Area - Unit
        .txt_Notes.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Lista")) '' Notes - List
        .txt_ShipDate.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_FechaINSum")) ''Ship Date - Delivery Date
        .txt_EnteredBy.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Realizado")) '' Entered By - Done By
        .txt_EntryDate.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Fecha")) ''Entry Date - Date
        .txt_ListPrice.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Tarifa")) ''List Price
        .txt_JobsiteContact.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Contacto")) ''Contacto
        .txt_ContactPhone.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_Telefono")) ''Telefono
        .txt_JobsiteAddress.Value = Application.Trim(Worksheets("BoM").Range("ID_Data_PoblacionObra")) ''Poblacion
        .txt_Salesman.Value = separadorCodNom(Application.Trim(Worksheets("BoM").Range("ID_Data_CodNomComercial")), "//", False) ''Comercial
        'Aldatu formatuak
        
        .txt_EnteredBy.BackColor = vbYellow
        
        'Font berdina denek
        .txt_JobNumber.Font.Size = 10
        .txt_Salesman.Font.Size = 10
        .txt_Customer.Font.Size = 10
        .txt_Project.Font.Size = 10
        .txt_Area.Font.Size = 10
        .txt_Notes.Font.Size = 10
        
        .txt_ShipDate.Font.Size = 10
        .txt_EnteredBy.Font.Size = 10
        .txt_EntryDate.Font.Size = 10
        .txt_Family.Font.Size = 10
        
        .txt_Hours.Font.Size = 10
        .txt_JobsiteCode.Font.Size = 10
        .txt_JobsiteContact.Font.Size = 10
        .txt_ContactPhone.Font.Size = 10
        .txt_JobsiteAddress.Font.Size = 10
        
        .txt_ListPrice.Font.Size = 10
    End With
End Sub




Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "SplitInColumns_Form"
Attribute VB_Base = "0{94612B56-4342-4B89-8F2A-07723DD532A7}{64627481-A7AE-4195-A879-772CF9BC0A49}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub cmd_OK_Click()
    Unload Me
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    nomAgrupacion = Sheets("Languages").Range("ID_Agrupacion").Value
    agrupacion = ConvertToLetter(Application.IfError(Application.Match(nomAgrupacion, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0), 702))
    nomProducto = Sheets("Languages").Range("ID_Producto").Value
    producto = ConvertToLetter(Application.IfError(Application.Match(nomProducto, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0), 702))
    nomFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    familia = ConvertToLetter(Application.Match(nomFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    nomNotas = Sheets("Languages").Range("ID_Notas").Value
    notas = ConvertToLetter(Application.Match(nomNotas, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    aukera = ComboBox1.SelText
    If aukera = nomAgrupacion & "_" & nomProducto Then
        Mzz_Split_Join_ColumnasGR.splitInColumns
    Else
        columna = ConvertToLetter(Application.Match(aukera, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
        Mzz_Split_Join_ColumnasGR.splitInColumns columna
    End If
End Sub

Private Sub UserForm_Activate()
    With SplitInColumns_Form
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .Caption = Sheets("Languages").Range("SplitInColumns_Form_Titulo").Value
        .cmd_OK.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdAceptar").Value
    End With
End Sub

Private Sub UserForm_Initialize()
    inicio = Sheets("Data").Range("FilaInicioArticulos").Value
    fin = Sheets("Data").Range("FilaFinArticulos").Value
    filaTitulos = inicio - 1
    nomAgrupacion = Sheets("Languages").Range("ID_Agrupacion").Value
    agrupacion = ConvertToLetter(Application.IfError(Application.Match(nomAgrupacion, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0), 702))
    nomProducto = Sheets("Languages").Range("ID_Producto").Value
    producto = ConvertToLetter(Application.IfError(Application.Match(nomProducto, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0), 702))
    nomSuministro = Sheets("Languages").Range("ID_Condicion").Value
    suministro = ConvertToLetter(Application.Match(nomSuministro, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    nomFamilia = Sheets("Languages").Range("ID_FamiliaBaan").Value
    familia = ConvertToLetter(Application.Match(nomFamilia, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    nomNotas = Sheets("Languages").Range("ID_Notas").Value
    notas = ConvertToLetter(Application.Match(nomNotas, Sheets("BoM").Range(filaTitulos & ":" & filaTitulos), 0))
    If (agrupacion <> "ZZ" And producto <> "ZZ") Then
        ComboBox1.AddItem (UCase(nomAgrupacion & "_" & nomProducto))
    End If
    ComboBox1.AddItem (UCase(nomSuministro))
    ComboBox1.AddItem (UCase(nomFamilia))
    ComboBox1.AddItem (UCase(nomNotas))
    ComboBox1.ListIndex = 0
End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Public contador As Integer
Public seHaCambiadoAPesta|fffd|aItemView As Boolean




Private Sub Workbook_Open()
    inicializar
End Sub



Private Sub Workbook_SheetActivate(ByVal sh As Object)
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = False
    If ActiveWorkbook.ActiveSheet.Name = "ItemView" And voyACambiarCaratulas <> "OK" Then
        If Worksheets("Data").Range("EsOferta").Value <> "OK" Then
            If Worksheets("Data").Range("EsOferta").Value = "OK*" Then
                Call AddWatermark("ItemView", 400, 350)
                Sheets("Data").Unprotect
                Worksheets("Data").Range("EsOferta").Value = "OK"
                ThisWorkbook.Worksheets("Data").Protect
            End If
        End If
        seHaCambiadoAPesta|fffd|aItemView = True
        Sheets("ItemView").Unprotect
        DeleteAllPivotTablesInWorkbook
        If Worksheets("Data").Range("UtilizandoCD").Value = "X" Then
            ActiveSheet.Shapes("LogoUlma").Visible = False
            ActiveSheet.Shapes("LogoGraf").Visible = True
        Else
            ActiveSheet.Shapes("LogoUlma").Visible = True
        ActiveSheet.Shapes("LogoGraf").Visible = False
        End If
        Dim codigo As String
                codigo = Range("ID_Codigo")
        Dim material As String
                material = Range("ID_Material")
        Dim Condicion As String
                Condicion = Range("ID_Condicion")
        Dim alquiler As String
                alquiler = Range("ID_Alquiler")
        Dim textoalquiler As String
                textoalquiler = Range("ID_Alquiler") & " "
        Dim venta As String
                venta = Range("ID_Venta")
        Dim textoventa As String
                textoventa = Range("ID_Venta") & " "
        Dim pesoud As String
                pesoud = Range("ID_PesoUd")
        Dim textopesoud As String
                textopesoud = Range("ID_PesoUd") & " "
        Dim pesoTotal As String
                pesoTotal = Range("ID_PesoTotal")
        Dim textopesototal As String
                textopesototal = Range("ID_PesoTotal") & " "
        Dim precioud As String
                precioud = Range("ID_PrecioUd")
        Dim superficieud As String
                superficieud = Range("ID_Superficiem2")
        Dim textosuperficieud As String
                textosuperficieud = Range("ID_Superficiem2") & " "
        Dim textoprecioud As String
                textoprecioud = Range("ID_PrecioUd") & " "
        Dim precioAlqud As String
                precioAlqud = Range("ID_PrecioAlquiler")
        Dim textoprecioAlqud As String
                textoprecioAlqud = Range("ID_PrecioAlquiler") & " "
        Dim precioVentaud As String
                precioVentaud = Range("ID_PrecioVenta")
        Dim textoprecioVentaud As String
                textoprecioVentaud = Range("ID_PrecioVenta") & " "
        Dim preciototal As String
               preciototal = Range("ID_PrecioTotal")
        Dim textopreciototal As String
               textopreciototal = Range("ID_PrecioTotal") & " "
        Dim rangoTabla As String
               rangoTabla = Range("RangoTD")
               
        
        Dim PT As PivotTable
        Set PT = Nothing
        On Error Resume Next
        Set PT = Worksheets("ItemView").PivotTables("TablaDinamica")
        On Error GoTo 0
    
        If PT Is Nothing Then
            ActiveWorkbook.PivotCaches.Create(SourceType:=xlDatabase, SourceData:= _
                rangoTabla, Version:=xlPivotTableVersion12).CreatePivotTable _
                TableDestination:="ItemView!R27C3", TableName:="TablaDinamica", _
                DefaultVersion:=xlPivotTableVersion12
                Sheets("ItemView").Select
                Cells(27, 3).Select
                With ActiveSheet.PivotTables("TablaDinamica")
                    .MergeLabels = False
                     .InGridDropZones = True
                    .RowAxisLayout xlTabularRow
                    .HasAutoFormat = False
                End With
            ActiveSheet.PivotTables("TablaDinamica").TableStyle2 = "TD1"
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(codigo)
                .Orientation = xlRowField
                .Position = 1
            End With
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(material)
                .Orientation = xlRowField
                .Position = 2
            End With
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(Condicion)
                .Orientation = xlRowField
                .Position = 3
            End With
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(pesoud)
                .Orientation = xlRowField
                .Position = 4
            End With
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(superficieud)
                .Orientation = xlRowField
                .Position = 5
            End With
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(precioAlqud)
                .Orientation = xlRowField
                .Position = 6
            End With
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(precioVentaud)
                .Orientation = xlRowField
                .Position = 7
            End With
            With ActiveSheet.PivotTables("TablaDinamica").PivotFields(precioud)
                .Orientation = xlRowField
                .Position = 8
            End With
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(codigo).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(material).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(Condicion).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(pesoud).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(superficieud).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(precioAlqud).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(precioVentaud).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            ActiveSheet.PivotTables("TablaDinamica").PivotFields(precioud).Subtotals = _
                Array(False, False, False, False, False, False, False, False, False, False, False, False)
            
            ActiveSheet.PivotTables("TablaDinamica").AddDataField ActiveSheet.PivotTables _
                ("TablaDinamica").PivotFields(alquiler), textoalquiler, xlSum
            ActiveSheet.PivotTables("TablaDinamica").AddDataField ActiveSheet.PivotTables _
                ("TablaDinamica").PivotFields(venta), textoventa, xlSum
            ActiveSheet.PivotTables("TablaDinamica").AddDataField ActiveSheet.PivotTables _
                ("TablaDinamica").PivotFields(pesoTotal), textopesototal, xlSum
            ActiveSheet.PivotTables("TablaDinamica").AddDataField ActiveSheet.PivotTables _
                ("TablaDinamica").PivotFields(preciototal), textopreciototal, xlSum
            
            ActiveSheet.PivotTables("TablaDinamica").ShowDrillIndicators = False
            
            ActiveSheet.PivotTables("TablaDinamica").PageFieldWrapCount = 2
        End If
        
        Sheets("ItemView").PivotTables("TablaDinamica").RefreshTable
                        
        ActiveSheet.PivotTables("TablaDinamica").MergeLabels = False
        Columns("C:C").Select
        Columns("C:C").EntireColumn.AutoFit
        Columns("D:D").Select
        Columns("D:D").EntireColumn.AutoFit
        
           
        Dim rngPTTot As Range, rngPTData As Range
        Dim x As Long, y As Integer
         
         
        With ActiveSheet
            Set rngPTData = .PivotTables(1).DataBodyRange
            x = rngPTData.Rows.Count
            y = rngPTData.Columns.Count
             
            Set rngPTTot = rngPTData.Cells(1).Offset(x - 1, y - 1)
            
            ActiveSheet.PivotTables("TablaDinamica").DataBodyRange.Cells(x, y - 3).Select
            With Selection.Font
            .Color = -16727809
            .TintAndShade = 0
            End With
             ActiveSheet.PivotTables("TablaDinamica").DataBodyRange.Cells(x, y - 2).Select
            With Selection.Font
            .Color = -16727809
            .TintAndShade = 0
            End With
        End With
        
        Columns("E:L").Select
        Selection.ColumnWidth = 20
        R = rngPTData.Rows.Count
        Cells(26, 15) = R - 1
        Columns("O:O").EntireColumn.AutoFit
        
        If Worksheets("Data").Range("Imagenes3DCargadas").Value = "X" Then
        If Worksheets("Data").Range("UtilizandoCD").Value = "X" Then
            CargarImagenesItemViewCD
        Else
            CargarImagenesItemView
            ComprimirImagenes
        End If
    End If
    ReasignaRangoAFormatoCondicionalItemView
            
         ThisWorkbook.Worksheets("ItemView").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True _
                , AllowFormattingCells:=True, AllowFormattingColumns:=True, _
                AllowFormattingRows:=True, AllowSorting:=True, AllowFiltering:=True, _
                AllowUsingPivotTables:=True
                
        Range("A1").Select
        seHaCambiadoAPesta|fffd|aItemView = False
    End If
    Application.ScreenUpdating = egoera
End Sub






Private Sub Workbook_SheetChange(ByVal sh As Object, ByVal Target As Range)
    If (Sheets("Data").Range("CargaInicialFinalizada").Value <> "X") Then
        Application.EnableEvents = False
    End If
    If ActiveWorkbook.ActiveSheet.Name = "BoM" And Sheets("Data").Range("CargaInicialFinalizada") = "X" And voyACambiarCondicion = "" Then
        Dim filaInicio As Integer
        filaInicio = Sheets("Data").Range("FilaInicioArticulos")
        Dim filaFin As Integer
        filaFin = Sheets("Data").Range("FilaFinArticulos")
        If Target.column = Sheets("Data").Range("NumColumnaCondicion") And Target.row >= filaInicio And Target.row <= filaFin Then
            Call CambiarUnaCondicion(Target.row)
        End If
    End If
    If ActiveWorkbook.ActiveSheet.Name = "BoM" And Sheets("Data").Range("CargaInicialFinalizada") = "X" And (Target.column = 4 Or (Target.column >= Sheets("Data").Range("NumColumInicioLista") And Target.column <= Sheets("Data").Range("NumColumFinLista"))) And Not actualizandoPalet = "X" And Sheets("Data").Range("tipo_estudio").Value = "estudioUSA" Then
        kalkulatuPaletE1
        kalkulatuRack
    End If
    If (Target.Address = Sheets("Data").Range("id_inicializar").Address And Sheets("Data").Range("id_inicializar").Value = "X") Then
        inicializar
    End If
        If ((sh.Name = "BoM" And Target.column >= Sheets("Data").Range("NumColumInicioLista") And Target.column <= Sheets("Data").Range("NumColumFinLista") And Target.row = Sheets("Data").Range("FilaUnidadLista").Value) Or (Target.column = (Sheets("Data").Range("NumColumInicioLista").Value - 1) And Target.row = Sheets("Data").Range("FilaBaremoPrecioOfertado").Value - 1)) Then
       If (Sheets("Data").Range("tipo_estudio").Value = "estudioEspana") Then
            formatosBaremoTotalesEspana Target.row, Target.column
'       ElseIf (Sheets("Data").Range("tipo_estudio").Value = "estudioChequia" Or (Sheets("Data").Range("tipo_estudio").Value = "estudioEslovaquia") Or (Sheets("Data").Range("tipo_estudio").Value = "estudioRumania")) Then
'            formatosBaremoTotalesCZSK Target.row, Target.column
'       ElseIf (Sheets("Data").Range("tipo_estudio").Value = "estudioArgentina") Then
'            formatosBaremoTotalesArgentina Target.row, Target.column
       End If
    formatoPrecioAlqDia Target.row, Target.column
    End If
    If (sh.Name = "BoM" And Target.column = 4 And Target.row >= Sheets("Data").Range("FilaInicioArticulos") And Target.row <= Sheets("Data").Range("FilaFinArticulos") And Worksheets("BoM").OLEObjects("cmd_ModoXML").Object.Caption = "Online" And Sheets("Data").Range("CargaInicialFinalizada") = "X") Then
        lehena = Target.Rows(1).row
        azkena = Target.Rows.Count + lehena - 1
        If azkena <= Sheets("Data").Range("FilaFinArticulos") Then
            For i = lehena To azkena
                rellenaDatosXML (i)
                familiaEzezagunaLerroa (i)
            Next
        End If
    End If
        If (sh.Name = "BoM" And Target.column = 4 And Target.row >= Sheets("Data").Range("FilaInicioArticulos") And Target.row <= Sheets("Data").Range("FilaFinArticulos") And Sheets("Data").Range("CargaInicialFinalizada") = "X") Then
        lehena = Target.Rows(1).row
        azkena = Target.Rows.Count + lehena - 1
        If azkena <= Sheets("Data").Range("FilaFinArticulos") Then
            For i = lehena To azkena
                PROzesatuBakarra (i)
            Next
        End If
    End If
End Sub

Attribute VB_Name = "ZZ_Aux_Printers"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     INPRIMAGAILUEZ BALIOTZEKO FUNTZIO LAGUNGARRIAK
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


' Declaration for the DeviceCapabilities function API call.
#If Win64 Then
    Private Declare PtrSafe Function DeviceCapabilities Lib "winspool.drv" _
    Alias "DeviceCapabilitiesA" (ByVal lpsDeviceName As String, _
    ByVal lpPort As String, ByVal iIndex As Long, lpOutput As Any, _
    ByVal lpDevMode As Long) As Long
#Else
    Private Declare Function DeviceCapabilities Lib "winspool.drv" _
    Alias "DeviceCapabilitiesA" (ByVal lpsDeviceName As String, _
    ByVal lpPort As String, ByVal iIndex As Long, lpOutput As Any, _
    ByVal lpDevMode As Long) As Long
#End If
' DeviceCapabilities function constants.
Private Const DC_PAPERNAMES = 16
Private Const DC_PAPERS = 2
Private Const DC_BINNAMES = 12
Private Const DC_BINS = 6
Private Const DEFAULT_VALUES = 0


Sub GetPaperList()
    Dim lngPaperCount As Long
    Dim lngCounter As Long
    Dim hPrinter As Long
    Dim strDeviceName As String
    Dim strDevicePort As String
    Dim strPaperNamesList As String
    Dim strPaperName As String
    Dim intLength As Integer
    Dim strMsg As String
    Dim aintNumPaper() As Integer
     
    On Error GoTo GetPaperList_Err
     
    ' Get the name and port of the default printer.
    strDeviceName = ActivePrinterPort(0)
    strDevicePort = ActivePrinterPort(1)
     
    ' Get the count of paper names supported by the printer.
    lngPaperCount = DeviceCapabilities(lpsDeviceName:=strDeviceName, _
        lpPort:=strDevicePort, _
        iIndex:=DC_PAPERNAMES, _
        lpOutput:=ByVal vbNullString, _
        lpDevMode:=DEFAULT_VALUES)
     
    ' Re-dimension the array to the count of paper names.
    ReDim aintNumPaper(1 To lngPaperCount)
     
    ' Pad the variable to accept 64 bytes for each paper name.
    strPaperNamesList = String(64 * lngPaperCount, 0)
 
    ' Get the string buffer of all paper names supported by the printer.
    lngPaperCount = DeviceCapabilities(lpsDeviceName:=strDeviceName, _
        lpPort:=strDevicePort, _
        iIndex:=DC_PAPERNAMES, _
        lpOutput:=ByVal strPaperNamesList, _
        lpDevMode:=DEFAULT_VALUES)
     
    ' Get the array of all paper numbers supported by the printer.
    lngPaperCount = DeviceCapabilities(lpsDeviceName:=strDeviceName, _
        lpPort:=strDevicePort, _
        iIndex:=DC_PAPERS, _
        lpOutput:=aintNumPaper(1), _
        lpDevMode:=DEFAULT_VALUES)
     
    ' List the available paper names.
    strMsg = "Papers available for " & strDeviceName & vbCrLf
    For lngCounter = 1 To lngPaperCount
         
        ' Parse a paper name from the string buffer.
        strPaperName = Mid(String:=strPaperNamesList, _
            Start:=64 * (lngCounter - 1) + 1, Length:=64)
        intLength = VBA.InStr(Start:=1, String1:=strPaperName, String2:=Chr(0)) - 1
        strPaperName = Left(String:=strPaperName, Length:=intLength)
         
        ' Add a paper number and name to text string for the message box.
        strMsg = strMsg & vbCrLf & aintNumPaper(lngCounter) _
            & vbTab & strPaperName
             
    Next lngCounter
         
    ' Show the paper names in a message box.
    MsgBox Prompt:=strMsg
 
GetPaperList_End:
    Exit Sub
     
GetPaperList_Err:
    MsgBox Prompt:=Err.Description, Buttons:=vbCritical & vbOKOnly, _
        Title:="Error Number " & Err.Number & " Occurred"
    Resume GetPaperList_End
     
End Sub
 

Sub GetBinList()
' Uses the DeviceCapabilities API function to display a
' message box with the name of the default printer and a
' list of the paper bins it supports.
 
    Dim lngBinCount As Long
    Dim lngCounter As Long
    Dim hPrinter As Long
    Dim strDeviceName As String
    Dim strDevicePort As String
    Dim strBinNamesList As String
    Dim strBinName As String
    Dim intLength As Integer
    Dim strMsg As String
    Dim aintNumBin() As Integer
     
    On Error GoTo GetBinList_Err
     
    ' Get name and port of the default printer.
    strDeviceName = ActivePrinterPort(0)
    strDevicePort = ActivePrinterPort(1)
     
    ' Get count of paper bin names supported by the printer.
    lngBinCount = DeviceCapabilities(lpsDeviceName:=strDeviceName, _
        lpPort:=strDevicePort, _
        iIndex:=DC_BINNAMES, _
        lpOutput:=ByVal vbNullString, _
        lpDevMode:=DEFAULT_VALUES)
     
    ' Re-dimension the array to count of paper bins.
    ReDim aintNumBin(1 To lngBinCount)
     
    ' Pad variable to accept 24 bytes for each bin name.
    strBinNamesList = String(Number:=24 * lngBinCount, Character:=0)
 
    ' Get string buffer of paper bin names supported by the printer.
    lngBinCount = DeviceCapabilities(lpsDeviceName:=strDeviceName, _
        lpPort:=strDevicePort, _
        iIndex:=DC_BINNAMES, _
        lpOutput:=ByVal strBinNamesList, _
        lpDevMode:=DEFAULT_VALUES)
         
    ' Get array of paper bin numbers supported by the printer.
    lngBinCount = DeviceCapabilities(lpsDeviceName:=strDeviceName, _
        lpPort:=strDevicePort, _
        iIndex:=DC_BINS, _
        lpOutput:=aintNumBin(1), _
        lpDevMode:=0)
         
    ' List available paper bin names.
    strMsg = "Paper bins available for " & strDeviceName & vbCrLf
    For lngCounter = 1 To lngBinCount
         
        ' Parse a paper bin name from string buffer.
        strBinName = Mid(String:=strBinNamesList, _
            Start:=24 * (lngCounter - 1) + 1, _
            Length:=24)
        intLength = VBA.InStr(Start:=1, _
            String1:=strBinName, String2:=Chr(0)) - 1
        strBinName = Left(String:=strBinName, _
                Length:=intLength)
 
        ' Add bin name and number to text string for message box.
        strMsg = strMsg & vbCrLf & aintNumBin(lngCounter) _
            & vbTab & strBinName
             
    Next lngCounter
         
    ' Show paper bin numbers and names in message box.
    MsgBox Prompt:=strMsg
     
GetBinList_End:
    Exit Sub
GetBinList_Err:
    MsgBox Prompt:=Err.Description, Buttons:=vbCritical & vbOKOnly, _
        Title:="Error Number " & Err.Number & " Occurred"
    Resume GetBinList_End
End Sub

Function ActivePrinterPort(ByVal Zer As Integer) As String
Dim Info, MyPrinter As String, MyActivePrinter As String, x As String, erantzuna As String
MyPrinter = ActivePrinter
Info = split(MyPrinter, " ")
port = Left(Info(UBound(Info)), Len(Info(UBound(Info))) - 1)
  For i = 0 To UBound(Info) - 2
     x = x & Info(i) & " "
  Next
MyActivePrinter = Left(x, Len(x) - 1)
If Zer = 0 Then
    erantzuna = MyActivePrinter
ElseIf Zer = 1 Then
    erantzuna = port
Else
    erantzuna = "error"
End If
ActivePrinterPort = erantzuna
End Function

Public Function GetPapers(prn As String, port As String, strPaperName As String) As Long
    Dim x As Integer, p As Integer, Papers As Integer
    Dim AA As String, bb As String, PaperList As String
    Dim PSize As String
    Dim dX As Long, dY As Long
    Dim PaperNums() As Integer
    
    Papers = DeviceCapabilities(prn, port, _
             DC_PAPERS, ByVal vbNullString, 0)
    
    If Papers > 0 Then
        ReDim PaperNums(1 To Papers)
        Papers = DeviceCapabilities(prn, port, _
                 DC_PAPERS, PaperNums(1), 0)
        
        PaperList = String$(64 * Papers, 0)
        Papers = DeviceCapabilities(prn, port, _
                 DC_PAPERNAMES, ByVal PaperList, 0)
        
        For x = 1 To Papers
            AA = Mid(PaperList, 64 * (x - 1) + 1, 64)
            p = InStr(AA, vbNullChar)
            
            If p Then AA = Left$(AA, p - 1)
            If AA = strPaperName Then
                GetPapers = PaperNums(x)
                Exit For
            End If
        Next x
    Else
        Call MsgBox("Error! Maybe your printer doesn't support this function.")
    End If
    
End Function


Attribute VB_Name = "ZZ_General_Tools"
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     FUNTZIOEN OROKORRAK
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     STRUCTak
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''

Public Type txt
    fso As Object
    oFile As Object
End Type

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     FUNTZIOEN DEKLARAZIOAK
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''



#If Win64 Then
    Public Declare PtrSafe Function SetWindowPos _
        Lib "user32" ( _
            ByVal hwnd As LongPtr, _
            ByVal hwndInsertAfter As LongPtr, _
            ByVal x As Long, ByVal y As Long, _
            ByVal cx As Long, ByVal cy As Long, _
            ByVal wFlags As Long) _
    As Long
#Else
    Public Declare Function SetWindowPos _
        Lib "user32" ( _
            ByVal hwnd As Long, _
            ByVal hwndInsertAfter As Long, _
            ByVal x As Long, ByVal y As Long, _
            ByVal cx As Long, ByVal cy As Long, _
            ByVal wFlags As Long) _
    As Long
#End If
Public Const SWP_NOSIZE = &H1
Public Const SWP_NOMOVE = &H2
Public Const HWND_TOPMOST = -1
Public Const HWND_NOTOPMOST = -2

Sub ShowXLOnTop(ByRef xlObj As Object, ByVal OnTop As Boolean)
    Dim xStype As Long
    #If Win64 Then
        Dim xHwnd As LongPtr
    #Else
        Dim xHwnd As Long
    #End If
    If OnTop Then
        xStype = HWND_TOPMOST
    Else
        xStype = HWND_NOTOPMOST
    End If
    Call SetWindowPos(xlObj.hwnd, xStype, 0, 0, 0, 0, SWP_NOSIZE Or SWP_NOMOVE)
End Sub
Sub SetXLOnTop()
    ShowXLOnTop True
End Sub
Sub SetXLNormal()
    ShowXLOnTop False
End Sub

Public Function FileFolderExists(strFullPath As String) As Boolean
    On Error GoTo EarlyExit
    If Not Dir(strFullPath, vbDirectory) = vbNullString Then FileFolderExists = True
    
EarlyExit:
    On Error GoTo 0
End Function

Function ConvertToLetter2(ByVal iCol As Integer) As String
   Dim iAlpha As Integer
   Dim iRemainder As Integer
   iAlpha = Int(iCol / 27)
   iRemainder = iCol - (iAlpha * 26)
   If iAlpha > 0 Then
      ConvertToLetter = Chr(iAlpha + 64)
   End If
   If iRemainder > 0 Then
      ConvertToLetter2 = ConvertToLetter & Chr(iRemainder + 64)
   End If
End Function

Function ConvertToLetter(ByVal lngCol As Integer) As String
    Dim vArr
    vArr = split(Cells(1, lngCol).Address(True, False), "$")
    ConvertToLetter = vArr(0)
End Function

Function ConvertToNumber(ByVal ColumnLetter As String) As Integer
    Dim ColumnLetterToNumber As Integer
    ColumnLetterToNumber = 0
    For i = 1 To Len(ColumnLetter)
         ColumnLetterToNumber = ColumnLetterToNumber * 26 + (Asc(UCase(Mid(ColumnLetter, i, 1))) - 64)
    Next
    ConvertToNumber = ColumnLetterToNumber
End Function

Function fileExists(ByVal Path As String) As String
    Dim Fitxerua As String
    Fitxerua = ""
    On Error Resume Next
    Fitxerua = Dir(Path, vbNormal)
    If Fitxerua <> "" Then
        Fitxerua = Path
    End If
    fileExists = Fitxerua
End Function


Sub gmaps_arakatu(ByVal hel As String)
    Dim helbidea, URL As String
    helbidea = hel
    helbidea = Application.Trim(helbidea)
    If helbidea = "" Then
        helbidea = "Ps. Otadui 3, 20560, O|fffd|ati, Gipuzkoa"
    End If
    If Application.Version = "12.0" Or Application.Version = "14.0" Then
        helbideaEncoded = URLEncode(helbidea)
    Else
        helbideaEncoded = WorksheetFunction.EncodeURL(helbidea)
    End If
    URL = "https://www.google.com/maps/search/?api=1&query=" & helbideaEncoded
    ThisWorkbook.FollowHyperlink Address:=URL
End Sub

Function URLEncode(ByVal text As String) As String
  Dim i As Integer
  Dim acode As Integer
  Dim char As String
  URLEncode = text
  For i = Len(URLEncode) To 1 Step -1
    acode = Asc(Mid$(URLEncode, i, 1))
    Select Case acode
      Case 48 To 57, 65 To 90, 97 To 122
        ' don't touch alphanumeric chars
      Case 32
        ' replace space with "+"
        Mid$(URLEncode, i, 1) = "+"
      Case Else
        ' replace punctuation chars with "%hex"
        URLEncode = Left$(URLEncode, i - 1) & "%" & Hex$(acode) & Mid$(URLEncode, i + 1)
    End Select
  Next
End Function

Function separadorCodNom(ByVal valor As String, ByVal separador As String, ByVal codNom As Boolean) As String
        cod = Left(valor, Application.IfError(Application.Find(separador, valor), 1) - 1)
        nom = Right(valor, Len(valor) - (Application.IfError(Application.Find(separador, valor), Len(valor) - 1) + 1))
        If cod = "" Then
            cod = valor
        End If
        If nom = "" Then
            nom = valor
        End If
        If codNom Then
            separadorCodNom = cod
        Else
            separadorCodNom = nom
        End If
End Function


Sub EzabatuLerroak(lerroa, kopurua)
    egoera = Application.ScreenUpdating
    Application.ScreenUpdating = True
    egoera2 = Application.EnableEvents
    Application.EnableEvents = False
    Dim i As Integer
    i = 0
    Do While i < kopurua
    Sheets("BoM").Rows(lerroa).EntireRow.Delete
    i = i + 1
    Loop
    Application.ScreenUpdating = egoera
    Application.EnableEvents = egoera2
End Sub

Function createTXT(ByVal strPath) As txt
    Dim txtObj As txt
    Set txtObj.fso = CreateObject("Scripting.FileSystemObject")
    Set txtObj.oFile = txtObj.fso.CreateTextFile(strPath)
    createTXT = txtObj
End Function

Function closeTXT(txtObj As txt) As Integer
    On Error GoTo errorea
    txtObj.oFile.Close
    txtObj.fso = Nothing
    txtObj.oFile = Nothing
    closeTXT = 0
errorea:
    closeTXT = 1
End Function

Function writeTXT(txtObj As txt, ByVal text As String) As Integer
    On Error GoTo errorea
    txtObj.oFile.WriteLine text
    writeTXT = 0
errorea:
    writeTXT = 1
End Function

Sub LogInformation(logFilename As String, LogMessage As String)
    Dim FileNum As Integer
    FileNum = FreeFile ' next file number
    Open logFilename For Append As #FileNum ' creates the file if it doesn't exist
    Print #FileNum, LogMessage ' write information at the end of the text file
    Close #FileNum ' close the file
End Sub

'' LOG-a idazteko erabili horrela:
''
''   Log fitxategia
'''''''''''''''''''
'
'    Dim logFilename As String, logDate  As String
'    logDate = Strings.Format(Now, "yyyymmddHHnnss")
'    logFilename = "C:\temp\" & CreateObject("scripting.filesystemobject").getbasename(ThisWorkbook.Name) & logDate & ".txt"
'    LogInformation logFilename, Strings.Format(Now, "dd-MMM-yyyy HH:nn:ss") & "." & Strings.Right(Strings.Format(Timer, "#0.00"), 2) & "Testua"


Public Function RunRC4(ByVal sMessage As String, ByVal strKey As String) As String
Dim kLen, x, y, i, j, temp
Dim s(256), k(256)
'Init keystream'
kLen = Len(strKey)
For i = 0 To 255
    s(i) = i
    k(i) = Asc(Mid(strKey, (i Mod kLen) + 1, 1))
Next
j = 0
For i = 0 To 255
    j = (j + k(i) + s(i)) Mod 255
    temp = s(i)
    s(i) = s(j)
    s(j) = temp
Next
'Drop n bytes from keystream'
x = 0
y = 0
For i = 1 To 3072
    x = (x + 1) Mod 255
    y = (y + s(x)) Mod 255
    temp = s(x)
    s(x) = s(y)
    s(y) = temp
Next
'Encode/Decode'
For i = 1 To Len(sMessage)
    x = (x + 1) Mod 255
    y = (y + s(x)) Mod 255
    temp = s(x)
    s(x) = s(y)
    s(y) = temp

    RunRC4 = RunRC4 & Chr(s((s(x) + s(y)) Mod 255) Xor Asc(Mid(sMessage, i, 1)))
Next
End Function

Public Function IsInArray(ByVal stringToBeFound As String, arr As Variant) As Boolean
    Dim st As String, M As String

    M = "$"
    st = M & Join(arr, M) & M
    IsInArray = InStr(st, stringToBeFound) > 0
End Function

Public Function IsInArrayExact(ByVal stringToBeFound As String, arr As Variant) As Boolean
    Dim st As String, M As String

    M = "$"
    st = M & Join(arr, M) & M
    IsInArrayExact = InStr(st, M & stringToBeFound & M) > 0
End Function

'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''     BOM-en LERROAK EZABATU (2dim ARRAY BIDEZ)
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''


Sub eliminalineaRequest(lerroak() As Integer)
    For i = 1 To UBound(lerroak)
        lerroak(i) = lerroak(i) - i
    Next
    For i = LBound(lerroak) To UBound(lerroak)
        kenduIkonoaBaldinBadu "D" & lerroak(i)
        Sheets("BoM").Range(lerroak(i) & ":" & lerroak(i)).EntireRow.Delete
    Next
End Sub
Attribute VB_Name = "dynTxtBox"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private WithEvents MyTextBox As MSForms.TextBox
Attribute MyTextBox.VB_VarHelpID = -1

Public Property Set Control(tb As MSForms.TextBox)
    Set MyTextBox = tb
End Property

Private Sub MyTextBox_Change()
    FamilyFactors_Form.refrescar
End Sub


Attribute VB_Name = "importarDenominacionesForm"
Attribute VB_Base = "0{2C5D5B95-1FE2-4434-9D4E-D664007EE023}{9C73DFB0-7563-481E-A9D7-F7D0FCB09EB0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False





Private Sub btn_zabalduExcel_Click()
    zabalduExcela 2
End Sub

Private Sub cmdAceptar_Click()
    Me.Hide
   importarDenominaciones
End Sub

Private Sub cmdBrowse_Click()
     Dim fd As Office.FileDialog
    
    Set fd = Application.FileDialog(msoFileDialogFilePicker)

   With fd

      .AllowMultiSelect = False

      ' Set the title of the dialog box.
      .Title = "Please select the file."

      ' Clear out the current filters, and add our own.
      .Filters.Clear
'      .Filters.Add "Excel 2003", "*.xls"
'      .Filters.Add "Excel 2007-2016", "*.xlsx"
'      .Filters.Add "Macro enabled Excel 2007-2016", "*.xlsm"
      .Filters.Add "All Files", "*.*"

      ' Show the dialog box. If the .Show method returns True, the
      ' user picked at least one file. If the .Show method returns
      ' False, the user clicked Cancel.
      If .Show = True Then
        txtExcel = .SelectedItems(1) 'replace txtFileName with your textbox
      End If
   End With
   KargatuOrriak (2)
End Sub

Private Sub cmdCancelar_Click()
    hustuImportForm (2)
End Sub

Private Sub txtColCod_Change()
    If Not IsLetter(txtColCod.Value) And txtColCod.Value <> vbNullString Then
        MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError2").Value, vbInformation, "Atenci|fffd|n:"
        txtColCod.Value = ""
    End If
End Sub

Private Sub txtColDen_Change()
     If Not IsLetter(txtColDen.Value) And txtColDen.Value <> vbNullString Then
        MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError2").Value, vbInformation, "Atenci|fffd|n:"
        txtColDen.Value = ""
    End If
End Sub

Private Sub txtFila_Change()
    If Not IsNumeric(txtFila.Value) And txtFila.Value <> vbNullString Then
        MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError3").Value, vbInformation, "Atenci|fffd|n:"
        txtFila.Value = ""
    End If
End Sub

Private Sub UserForm_Activate()
    With importarDenominacionesForm
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .Caption = Sheets("Languages").Range("ImportarDenominacionesForm_Caption").Value
        
        .lblBrowse.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblBrowser").Value
        .lblHoja.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblHoja").Value
        .lblFila.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblFila").Value
        .lblCodigo.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblCodigo").Value
        .lblDen.Caption = Sheets("Languages").Range("ImportarDenominacionesForm_lblDen").Value
        .cmdAceptar.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdAceptar").Value
        .cmdCancelar.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdCancelar").Value
    End With
End Sub
Attribute VB_Name = "importarPreciosForm"
Attribute VB_Base = "0{6E714FEE-D08A-4F08-AA6C-85D32279CD2D}{57CE4ED2-6848-4540-8811-B2798876EC69}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False




Private Sub btn_zabalduExcel_Click()
    zabalduExcela 1
End Sub

Private Sub cmdAceptar_Click()
    Me.Hide
    If referer = "Baan_Rental" Or referer = "Baan_Sale" Then
        If Me.opt_Alquiler = True Then
            importarBaan 1, "Alquiler", referer
        Else
            importarBaan 1, "Venta", referer
        End If
    Else
        If (Me.opt_Venta = True) Then
            importarPrecios "Venta"
        Else
            importarPrecios "Alquiler"
        End If
    End If
End Sub

Private Sub cmdBrowse_Click()
     Dim fd As Office.FileDialog
    
    Set fd = Application.FileDialog(msoFileDialogFilePicker)

   With fd

      .AllowMultiSelect = False

      ' Set the title of the dialog box.
      .Title = "Please select the file."

      ' Clear out the current filters, and add our own.
      .Filters.Clear
'      .Filters.Add "Excel 2003", "*.xls"
'      .Filters.Add "Excel 2007-2016", "*.xlsx"
'      .Filters.Add "Macro enabled Excel 2007-2016", "*.xlsm"
      .Filters.Add "All Files", "*.*"

      ' Show the dialog box. If the .Show method returns True, the
      ' user picked at least one file. If the .Show method returns
      ' False, the user clicked Cancel.
      If .Show = True Then
        txtExcel = .SelectedItems(1) 'replace txtFileName with your textbox
      End If
   End With
   KargatuOrriak 1
End Sub

Private Sub cmdCancelar_Click()
    hustuImportForm 1
End Sub

Private Sub txtColCod_Change()
    If Not IsLetter(txtColCod.Value) And txtColCod.Value <> vbNullString Then
        MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError2").Value, vbInformation, "Atenci|fffd|n:"
        txtColCod.Value = ""
    End If
End Sub

Private Sub txtColPre_Change()
     If Not IsLetter(txtColPre.Value) And txtColPre.Value <> vbNullString Then
        MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError2").Value, vbInformation, "Atenci|fffd|n:"
        txtColPre.Value = ""
    End If
End Sub

Private Sub txtFila_Change()
    If Not IsNumeric(txtFila.Value) And txtFila.Value <> vbNullString Then
        MsgBox Sheets("Languages").Range("ImportarPreciosForm_MsgError3").Value, vbInformation, "Atenci|fffd|n:"
        txtFila.Value = ""
    End If
End Sub

Private Sub UserForm_Activate()
    With importarPreciosForm
        .Top = Application.Top + ((Application.Height / 2) - (.Height / 2))
        .Left = Application.Left + ((Application.Width / 2) - (.Width / 2))
        .Caption = Sheets("Languages").Range("ImportarPreciosForm_Caption").Value
        .lbl_TipoTarifa = Sheets("Languages").Range("ImportarPreciosForm_lblTipoTarifa").Value
        .opt_Alquiler.Caption = Sheets("Languages").Range("A1Alquiler").Value
        .opt_Venta.Caption = Sheets("Languages").Range("A2Venta").Value
        .lblBrowse.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblBrowser").Value
        .lblHoja.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblHoja").Value
        .lblFila.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblFila").Value
        .lblCodigo.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblCodigo").Value
        .lblPrecio.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblPrecio").Value
        .lblNombreLista.Caption = Sheets("Languages").Range("ImportarPreciosForm_lblNombreLista").Value
        .cmdAceptar.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdAceptar").Value
        .cmdCancelar.Caption = Sheets("Languages").Range("ImportarPreciosForm_cmdCancelar").Value
    End With
End Sub

' InQuest injected base64 decoded content
' -zeb{
' -zeb{
' -zeb{
' *'v'"
' r*'z
' K)jv
' r*'z
' -zeb{
' r*'z

INQUEST-PP=macro
