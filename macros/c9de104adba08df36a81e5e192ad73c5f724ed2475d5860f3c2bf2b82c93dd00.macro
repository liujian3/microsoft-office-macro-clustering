Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cboBaseM, 12, 3, MSForms, ComboBox"
Attribute VB_Control = "cboBaseY, 11, 4, MSForms, ComboBox"
Attribute VB_Control = "cboBRK, 10, 5, MSForms, ComboBox"
Attribute VB_Control = "CommandButton1, 13, 6, MSForms, CommandButton"
'======================================================
' |fffd||5bf||fffd||fffd||fffd||1e5| Refresh
'======================================================
Public Sub CommandButton1_Click()
Dim iIndex      As Integer
Dim iBRKIdx     As Integer
Dim iRowCnt     As Integer
Dim sBRK_CD     As String
Dim sBRK_NM     As String
Dim sBaseY      As String
Dim sBaseM      As String
Dim sMaxDT      As String
Dim sMinDT      As String
Dim sParam      As String
Dim i           As Integer
Dim iYear       As Integer
Dim iTryCnt     As Integer

On Error GoTo ErrRaised

TryAgain:

    iTryCnt = iTryCnt + 1
    Application.DisplayAlerts = False
    
    '|fffd||fffd||fffd|
    If Range("AA2").Value = "ENG" Then
        g_Lang = "E"
        sSheetNM = "Main Indicator"
    Else
        g_Lang = "K"
        sSheetNM = "|fffd||5bf||fffd||fffd||fffd||1e5|"
    End If
    Sheet2.Name = sSheetNM

    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||6b5||fffd|
'    Sheet2.Activate
    iBRKIdx = cboBRK.ListIndex
    sBRK_NM = cboBRK.List(iBRKIdx)
    
    Range("AA1").Value = "=VLOOKUP(""" & sBRK_NM & """, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|1, 2, FALSE)"
    sBRK_CD = Range("AA1").Value
    
'    If sBRK_CD = "ALL" Then
'        Range("AB1").Value = "=VLOOKUP(""" & sBRK_CD & """, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|1_1, 2, FALSE)"
'    Else
'        Range("AB1").Value = "=VLOOKUP(" & sBRK_CD & ", |fffd||fffd||fffd||fffd||fffd||fffd||fffd|1_1, 2, FALSE)"
'    End If
    
    '|fffd||537||bd||f1||fffd|
    '|fffd||fffd|
    iIndex = cboBaseY.ListIndex
    sBaseY = Left(cboBaseY.List(iIndex), 4)
    '|fffd||fffd|
    iIndex = cboBaseM.ListIndex
    sBaseM = Left(cboBaseM.List(iIndex), 2)

    sBaseYYMM = sBaseY & sBaseM
    sMinDT = Range("BG2").Value
    sMaxDT = Range("BH2").Value

    '-------------------------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| Raw Data |fffd||fffd||fffd||fffd||fffd||fffd||1ae| |fffd||fffd| |fffd||fffd||fffd||fffd|
    '-------------------------------------
    Call SetJiPyo
    
    
    For i = 0 To cboBRK.ListCount
        If cboBRK.List(i) = sBRK_NM Then
            cboBRK.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboBaseY.ListCount
        If Left(cboBaseY.List(i), 4) = sBaseY Then
            cboBaseY.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboBaseM.ListCount
        If Left(cboBaseM.List(i), 2) = sBaseM Then
            cboBaseM.ListIndex = i
            Exit For
        End If
    Next

    If g_Lang = "K" Then
        If sBaseYYMM > sMaxDT Then
            MsgBox "|fffd||5bf||fffd||fffd||fffd||1e5| |fffd||537||bd||f1||fffd||fffd| " & Left(sMaxDT, 4) & "|fffd||fffd| " & Right(sMaxDT, 2) & "|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||574||3f4||fffd|."
            Exit Sub
        ElseIf sBaseYYMM < sMinDT Then
            MsgBox "|fffd||5bf||fffd||fffd||fffd||1e5| |fffd||537||bd||f1||fffd||fffd| " & Left(sMinDT, 4) & "|fffd||fffd| " & Right(sMinDT, 2) & "|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||574||3f4||fffd|."
            Exit Sub
        End If
    Else
        If sBaseYYMM > sMaxDT Then
            MsgBox "Main Indicator can be contributed until " & Left(sMaxDT, 4) & "." & Right(sMaxDT, 2)
            Exit Sub
        ElseIf sBaseYYMM < sMinDT Then
            MsgBox "Main Indicator can be contributed after " & Left(sMinDT, 4) & "." & Right(sMinDT, 2)
            Exit Sub
        End If
    End If

    
    '--------------------------
    '|fffd||5bf||fffd||fffd||fffd||1e5| |fffd||fffd||fffd||fffd||fffd||fffd| Refresh
    '--------------------------
    '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    sParam = "ALL" & "%05" & sBaseYYMM & "%05" & "1"
    getDatatoExcel ASP_JIPYO & sParam, "AE7", Sheet2.Name, Sheet2
    
    '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|
    Columns("T:V").Select
    Selection.EntireColumn.Hidden = False

    '|fffd||5bf||fffd||fffd||fffd||1e5| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|
    sParam = sBRK_CD & "%05" & sBaseYYMM & "%05" & "2"
    getDatatoExcel ASP_JIPYO & sParam, "AA8", Sheet2.Name, Sheet2
    
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| (|fffd||fffd| |fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd|:|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd|:|fffd||fffd||fffd||fffd|)
    Range(Range("AA30"), Range("AA30").Offset(iRowCnt, 18)).ClearContents
    sParam = sBRK_CD & "%05" & sBaseYYMM & "%05" & "3"
    getDatatoExcel ASP_JIPYO & sParam, "AA30", Sheet2.Name, Sheet2
    
    
    '|fffd||fffd||fffd||33e||1bf||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||5b1||fffd|
    '|fffd||2d75|(HEAD)
    If Int(Right(sBaseYYMM, 2)) >= 9 Then
        iYear = Int(Left(sBaseYYMM, 4))
    Else
        iYear = Int(Left(sBaseYYMM, 4)) - 1
    End If
    
    Range("G6").Select
    For i = 0 To 2  '3|fffd||fffd||fffd||fffd|
        If g_Lang = "K" Then
            ActiveCell.Formula = iYear + i & "|fffd||fffd|"
        Else
            ActiveCell.Formula = iYear + i
        End If
        Selection.Offset(0, 1).Select
    Next
    
    '12|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||133||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3f9||1f7||fffd|
    '|fffd||537||bd||f1||2c21| 09~11|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 2|fffd||fffd||fffd||2e38| |fffd||fffd||fffd||fffd||fffd||5b1||fffd|
    If Right(sBaseYYMM, 2) > 8 And Right(sBaseYYMM, 2) < 12 Then
        Columns("U:U").Select
        Selection.EntireColumn.Hidden = True
    End If
     
    
    '|fffd||5f5||3b8||fffd| |fffd||fffd|
    Range(Range("B6"), Range("B8").Offset(iRowCnt - 1, 18)).Select
    Range(Range("B6"), Range("B8").Offset(iRowCnt - 1, 18)).Borders(xlEdgeBottom).LineStyle = xlContinuous
    
    Application.CutCopyMode = False
    Range("A1").Select
    Application.DisplayAlerts = True
    
    Exit Sub
    
ErrRaised:
'    Resume
    If iTryCnt < 2 Then
        Call SetJiPyo
        GoTo TryAgain
    End If
    Application.DisplayAlerts = True
End Sub



Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 4, 2, MSForms, CommandButton"
Attribute VB_Control = "cboEndYY, 14, 3, MSForms, ComboBox"
Attribute VB_Control = "cboPrdBRK, 15, 4, MSForms, ComboBox"
Attribute VB_Control = "cboStrYY, 16, 5, MSForms, ComboBox"
'======================================================
' |fffd||2c23||fffd||fffd| |fffd||5bf||fffd||fffd||fffd||1e5| Refresh
'======================================================
Public Sub CommandButton1_Click()
Dim iIndex      As Integer
Dim iBRKIdx     As Integer
Dim iRowCnt     As Integer
Dim sBRK_CD     As String
Dim sBRK_NM     As String
Dim sStrYY      As String
Dim sEndYY      As String
Dim sParam      As String
Dim i           As Integer
Dim iYear       As Integer
Dim iHeadCNT    As Integer
Dim rngTmp      As Range
Dim iTryCnt     As Integer

On Error GoTo ErrRaised

TryAgain:

    iTryCnt = iTryCnt + 1
    Application.DisplayAlerts = False
    
    '|fffd||fffd||fffd|
    If Range("CA2").Value = "ENG" Then
        g_Lang = "E"
        sSheetNM = "Periodical Main Indicator"
    Else
        g_Lang = "K"
        sSheetNM = "|fffd||2c23||fffd||fffd| |fffd||5bf||fffd||fffd||fffd||1e5|"
    End If
    Sheet3.Name = sSheetNM
    
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||6b5||fffd|
    iBRKIdx = cboPrdBRK.ListIndex
    sBRK_NM = cboPrdBRK.List(iBRKIdx)
    
    Range("CA1").Value = "=VLOOKUP(""" & sBRK_NM & """, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|2, 2, FALSE)"
    sBRK_CD = Range("CA1").Value

    
    '|fffd||537||bd||f1||fffd|
    iIndex = cboStrYY.ListIndex
    sStrYY = Left(cboStrYY.List(iIndex), 4)
    iIndex = cboEndYY.ListIndex
    sEndYY = Left(cboEndYY.List(iIndex), 4)
    
    If g_Lang = "K" Then
        If sStrYY > sEndYY Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3fa||fffd||fffd||fffd| |fffd||6f0||173||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3ff||fffd| |fffd||5bd||2bd||ff||fffd|."
            Exit Sub
        End If
        iYear = sEndYY - sStrYY + 1
        
        If iYear > 10 Then
            MsgBox "|fffd||5b4||fffd| 10|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||574||3f4||fffd|."
            Exit Sub
        End If
    Else
        If sStrYY > sEndYY Then
            MsgBox "The start date must be forward from the end date."
            Exit Sub
        End If
        iYear = sEndYY - sStrYY + 1
        
        If iYear > 10 Then
            MsgBox "Data will be downloaded within the next 10 years."
            Exit Sub
        End If
    End If
        
    Rows("8:71").EntireRow.Hidden = False

    '-------------------------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| Raw Data |fffd||fffd||fffd||fffd||fffd||fffd||1ae| |fffd||fffd| |fffd||fffd||fffd||fffd|
    '-------------------------------------
    Call SetP_JiPyo
    
    For i = 0 To cboPrdBRK.ListCount
        If cboPrdBRK.List(i) = sBRK_NM Then
            cboPrdBRK.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboStrYY.ListCount
        If Left(cboStrYY.List(i), 4) = sStrYY Then
            cboStrYY.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboEndYY.ListCount
        If Left(cboEndYY.List(i), 4) = sEndYY Then
            cboEndYY.ListIndex = i
            Exit For
        End If
    Next

    
    '-------------------------------
    '|fffd||2c23||fffd||fffd| |fffd||5bf||fffd||fffd||fffd||1e5| |fffd||fffd||fffd||fffd||fffd||fffd| Refresh
    '-------------------------------
    iRowCnt = 16

    Range(Range("N6"), Range("N6").Offset(iRowCnt * 4 + 1, (7 * 7))).Select
    Selection.ClearContents
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    Selection.Borders(xlEdgeTop).LineStyle = xlNone
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    With Selection.Interior
        .Pattern = xlNone
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    
    Range(Range("G6"), Range("G6").Offset(iRowCnt * 4 + 1, 0)).Select
    Selection.ClearContents
    Application.CutCopyMode = False
    If iYear > 1 Then
        Selection.Copy
        Range(Selection.Address, Selection.Offset(0, 7 * (iYear - 1))).Select
        
        Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
            SkipBlanks:=False, Transpose:=False
        ActiveSheet.Paste
        Application.CutCopyMode = False
    End If
    
    'RawData |fffd||fffd||ba||3ba||fffd| |fffd||fffd||fffd||fffd|
    Range("CA7").Select
    Range(Selection, Selection.Offset(iRowCnt * 4, 63)).ClearContents
  
    
    '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    If g_Lang = "K" Then
        sParam = "ALL" & "%05" & sStrYY & "%05" & sEndYY & "%05" & "1"
    Else
        sParam = "ALL" & "%05" & sStrYY & "%05" & sEndYY & "%05" & "101"
    End If
    getDatatoExcel ASP_P_JIPYO & sParam, "CA7", Sheet3.Name, Sheet3
    
    
    '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||3f3||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|
    If Not (iYear = 1 And sStrYY > Left(Date, 4)) Then
        Range("CA7").Select
        iHeadCNT = Range(Selection, Selection.End(xlToRight)).Count
        If iYear * 7 <> iHeadCNT Then
    '        Range("G" & 6 + iHeadCNT - iYear).Select
            Sheet3.Cells(6, 7 + iHeadCNT).Select
            Range(Selection, Selection.Offset(iRowCnt * 4 + 1, (iYear * 7) - (iHeadCNT) - 1)).Select
            
            Selection.Borders(xlDiagonalDown).LineStyle = xlNone
            Selection.Borders(xlDiagonalUp).LineStyle = xlNone
            Selection.Borders(xlEdgeTop).LineStyle = xlNone
            Selection.Borders(xlEdgeBottom).LineStyle = xlNone
            Selection.Borders(xlEdgeRight).LineStyle = xlNone
            Selection.Borders(xlInsideVertical).LineStyle = xlNone
            Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
            With Selection.Interior
                .Pattern = xlNone
                .TintAndShade = 0
                .PatternTintAndShade = 0
            End With
'        Else
'            iHeadCNT = 1
        End If
    Else
        iHeadCNT = 1
'        Range("CA7").Select
'        iHeadCNT = Range(Selection, Selection.End(xlToRight)).Count
    End If
    
    If iHeadCNT = 7 Then
        Range(Range("G7"), Range("G7").Offset(iRowCnt * 4, 0)).Select
    Else
        Range(Range("G7"), Range("G7").Offset(iRowCnt * 4, iHeadCNT - 1)).Select
    End If
    
    Selection.Borders(xlEdgeLeft).LineStyle = xlContinuous
    Selection.Borders(xlEdgeTop).LineStyle = xlContinuous
    Selection.Borders(xlEdgeBottom).LineStyle = xlContinuous
    Selection.Borders(xlEdgeRight).LineStyle = xlContinuous
    
    Selection.NumberFormatLocal = "0.00_ "

    'DB |fffd||fffd||fffd||fffd| |fffd||2c23||fffd||fffd| |fffd||5bf||fffd||fffd||fffd||1e5| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    sParam = sBRK_CD & "%05" & sStrYY & "%05" & sEndYY & "%05" & "2"
    getDatatoExcel ASP_P_JIPYO & sParam, "CA8", Sheet3.Name, Sheet3
    
    Columns("F:CA").EntireColumn.Hidden = False
    
    Range("G6:M6").Select
    Range("G6:M6").Merge
    Selection.Copy
    
    If iYear * 7 <> iHeadCNT Then
        If iYear > 2 Then
            Range(Cells(6, 14), Cells(6, 7).Offset(0, 7 * (iYear - 2))).Select
            Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
                SkipBlanks:=False, Transpose:=False
            Application.CutCopyMode = False
        End If
    Else
        If iYear > 1 Then
            Range(Cells(6, 14), Cells(6, 7).Offset(0, 7 * (iYear - 1))).Select
            Selection.PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, _
                SkipBlanks:=False, Transpose:=False
            Application.CutCopyMode = False
        End If
    End If


    '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    Range("G6").Select
    For i = 0 To iYear - 1
        If g_Lang = "K" Then
            ActiveCell.Formula = sStrYY + i & "|fffd||fffd|"
        Else
            ActiveCell.Formula = sStrYY + i
        End If
        ActiveCell.HorizontalAlignment = xlCenter
        Selection.Offset(0, 1).Select
    Next
    
    Range("G7").Select
    For i = 0 To iHeadCNT - 1
        ActiveCell.Formula = "=" & Cells(7, 79 + i).Address
        ActiveCell.HorizontalAlignment = xlCenter
        Selection.Offset(0, 1).Select
    Next
    
    
    If iHeadCNT <> 1 Then

        '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
        Range("G8").Select
        Range("G8").Formula = "=IF(CA8<>"""", CA8, ""-"")"
        Range("G9").Formula = "=IF(CA9<>"""", CA9, ""-"")"
        Range("G10").Formula = "=IF(G8<>""-"", IF(G9<>""-"", G8-G9, ""-""), ""-"")"
        Range("G11").Formula = "=IF(CA11<>"""", CA11, ""-"")"
        
        Range("G8:G11").Copy
        Range("G8:G71").Select
        ActiveSheet.Paste
        Selection.Copy
        Range(Cells(8, 7), Cells(16 * 4 + 7, 6 + iHeadCNT)).Select
        Selection.PasteSpecial Paste:=xlPasteFormulasAndNumberFormats
        Application.CutCopyMode = False
        
        
        '|fffd||fffd||771||fffd| |fffd||3f9||771||fffd|
        Range("I8").Formula = "=IF(G8<>""-"", IF(H8<>""-"", AVERAGE(G8:H8), ""-""), ""-"")"
        Range("I9").Formula = "=IF(G9<>""-"", IF(H9<>""-"", AVERAGE(G9:H9), ""-""), ""-"")"
        Range("I11").Formula = "=IF(G11<>""-"", IF(H11<>""-"", AVERAGE(G11:H11), ""-""), ""-"")"
        
        Range("I8:I11").Select
        Selection.Copy
        Range("I8:I55").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Selection.Copy
        
        '|fffd||fffd| |fffd||3f9||771||fffd| (|fffd||fffd||fffd||631||778||fffd|, |fffd||fffd||fffd||fffd||e4|, KOSPI |fffd||fffd||fffd||fffd||fffd||fffd|)
        Range("I56").Formula = "=IF(CC56<>"""", CC56, ""-"")"
        Range("I57").Formula = "=IF(CC57<>"""", CC57, ""-"")"
        Range("I59").Formula = "=IF(CC59<>"""", CC59, ""-"")"
        
        Range("I56:I59").Select
        Selection.Copy
        Range("I56:I71").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        Selection.Copy
        
         '|fffd||fffd||fffd||fffd||fffd||fffd|
        Range("I36").Formula = "=IF(G36<>""-"", IF(H36<>""-"", SUM(G36:H36), ""-""), ""-"")"
        Range("I37").Formula = "=IF(G37<>""-"", IF(H37<>""-"", SUM(G37:H37), ""-""), ""-"")"
        Range("I38").Formula = "=IF(I36<>""-"", IF(I37<>""-"", I36-I37, ""-""), ""-"")"
        Range("I39").Formula = "=IF(CC39<>"""", CC39, ""-"")"
        
        '|fffd||fffd||fffd||fffd| - |fffd||7b7||fffd||fffd||fffd||fffd| |fffd||fffd| |22f||fffd||fffd| ~ KOSPI |fffd||fffd||fffd| - |fffd||fffd||fffd||fffd|
'        Range("M52").Formula = "=IF(I52<>""-"", IF(L52<>""-"", AVERAGE(I52,L52), ""-""), ""-"")"
        Range("M53").Formula = "=IF(I53<>""-"", IF(L53<>""-"", AVERAGE(I53,L53), ""-""), ""-"")"
        Range("M55").Formula = "=IF(I55<>""-"", IF(L55<>""-"", AVERAGE(I55,L55), ""-""), ""-"")"
        
        Range("M52:M55").Select
        Selection.Copy
        Range("M52:M63").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
        
        Range("M64").Formula = "=IF(I64<>""-"", IF(L64<>""-"", IF(I64>L64, I64, L64),""-""), ""-"")"
        Range("M65").Formula = "=IF(I65<>""-"", IF(L65<>""-"", IF(I65>L65, I65, L65),""-""), ""-"")"
        Range("M67").Formula = "=IF(I65<>""-"", IF(L65<>""-"", IF(I67<>"""", IF(L67<>"""", IF(I65>L65, I67, L67),""-""), ""-""), ""-""), ""-"")"
        
        Range("M68").Formula = "=IF(I68<>""-"", IF(L68<>""-"", IF(I68<L68, I68, L68),""-""), ""-"")"
        Range("M69").Formula = "=IF(I69<>""-"", IF(L69<>""-"", IF(I69<L69, I69, L69),""-""), ""-"")"
        Range("M71").Formula = "=IF(I69<>""-"", IF(L69<>""-"", IF(I71<>"""", IF(L71<>"""", IF(I69<L69, I71, L71),""-""), ""-""), ""-""), ""-"")"
        
        
        Range("I8:I71").Select
        Selection.Copy
        
        Range("L8").Select
        ActiveSheet.Paste
            

        If iHeadCNT Mod 7 = 0 Then
            iCnt = Int(sEndYY) - Int(sStrYY)
        Else
            iCnt = Int(sEndYY) - Int(sStrYY) - 1
        End If

        For i = 1 To iCnt
            Cells(8, 9 + (7 * i)).Select
            ActiveSheet.Paste
            
            Cells(8, 12 + (7 * i)).Select
            ActiveSheet.Paste
        Next
        
        
        Range("M8:M71").Select
        Selection.Copy
        For i = 1 To Int(sEndYY) - Int(sStrYY) - 1
            Cells(8, 13 + (7 * i)).Select
            ActiveSheet.Paste
        Next
        
        
    Else
        Columns("G:L").EntireColumn.Hidden = True
        
        'HEAD
        Range("M7").Formula = "=CA7"
               
        
        '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
        Range("M8").Select
        Range("M8").Formula = "=IF(CA8<>"""", CA8, ""-"")"
        Range("M9").Formula = "=IF(CA9<>"""", CA9, ""-"")"
        Range("M10").Formula = "=IF(M8<>""-"", IF(M9<>""-"", M8-M9, ""-""), ""-"")"
        Range("M11").Formula = "=IF(CA11<>"""", CA11, ""-"")"
        
        Range("M8:M11").Copy
        Range("M8:M71").Select
        ActiveSheet.Paste
        Application.CutCopyMode = False
                
        
    End If
    
    '|fffd||fffd||22f||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd||fffd||fffd|) |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||22f||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||f3||fffd||fffd|
    If InStr(cboPrdBRK.List(iBRKIdx), "|fffd||fffd||22f||fffd||fffd||fffd||fffd|") > 0 Or InStr(cboPrdBRK.List(iBRKIdx), "Dealer") > 0 Then
        Rows("8:71").EntireRow.Hidden = False
        Rows("8:51").EntireRow.Hidden = True
        Rows("56:71").EntireRow.Hidden = True
    ElseIf sBRK_CD = "ALL" Then
        Rows("8:71").EntireRow.Hidden = False
    Else
        Rows("8:71").EntireRow.Hidden = False
        Rows("52:55").EntireRow.Hidden = True
    End If
    
    
    Application.CutCopyMode = False
    Range("A1").Select
    Sheet1.Visible = xlSheetHidden
    Application.DisplayAlerts = True
    
    Exit Sub
    
ErrRaised:
'    Resume
    If iTryCnt < 2 Then
        Call SetP_JiPyo
        GoTo TryAgain
    End If
    Application.DisplayAlerts = True
    
End Sub


Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cboDeBaseY, 13, 4, MSForms, ComboBox"
Attribute VB_Control = "cboDeBaseM, 12, 5, MSForms, ComboBox"
Attribute VB_Control = "cboJiPyo, 11, 6, MSForms, ComboBox"
Attribute VB_Control = "cboDeBRK, 10, 7, MSForms, ComboBox"
Attribute VB_Control = "CommandButton1, 14, 8, MSForms, CommandButton"
'======================================================
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Refresh
'======================================================
Public Sub CommandButton1_Click()
Dim iIndex      As Integer
Dim iBRKIdx     As Integer
Dim iRowCnt     As Integer
Dim sBRK_CD     As String
Dim sBRK_NM     As String
Dim sJiPyo      As String
Dim sJiPyo_CD   As String
Dim sBaseY      As String
Dim sBaseM      As String
Dim sMaxDT      As String
Dim sMinDT      As String
Dim sBaseYYMM   As String
Dim sParam      As String
Dim sTmp        As String
Dim i           As Integer
Dim iYear       As Integer
Dim iRow        As Integer
Dim iEnd_Q      As Integer
Dim iEnd_H      As Integer
Dim iTmp        As Integer
Dim iHeadCNT    As Integer
Dim rngTmp      As Range
Dim sSheetNM    As String
Dim iTryCnt     As Integer

On Error GoTo ErrRaised

TryAgain:

    iTryCnt = iTryCnt + 1

    Application.DisplayAlerts = False
    
    '|fffd||fffd||fffd|
    If Range("AA4").Value = "ENG" Then
        g_Lang = "E"
        sSheetNM = "Detailed Consensus List"
    Else
        g_Lang = "K"
        sSheetNM = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    End If
    Sheet4.Name = sSheetNM

    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||6b5||fffd|
    Sheet4.Activate
    iBRKIdx = cboDeBRK.ListIndex
    sBRK_NM = cboDeBRK.List(iBRKIdx)
    Range("AA1").Value = "=VLOOKUP(""" & sBRK_NM & """, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|3, 2, FALSE)"
    sBRK_CD = Range("AA1").Value
       
    '|fffd||fffd||1e5|
    iIndex = cboJiPyo.ListIndex
    sJiPyo = cboJiPyo.List(iIndex)
    Range("AA2").Value = "=VLOOKUP(""" & sJiPyo & """, |fffd||fffd||1e5|1, 2, FALSE)"
    sJiPyo_CD = Range("AA2").Value

    Range("C7").Formula = sJiPyo
    

    '|fffd||537||bd||f1||fffd|
    '|fffd||fffd|
    iIndex = cboDeBaseY.ListIndex
    sBaseY = Left(cboDeBaseY.List(iIndex), 4)
    '|fffd||fffd|
    iIndex = cboDeBaseM.ListIndex
    sBaseM = Left(cboDeBaseM.List(iIndex), 2)
    
    sBaseYYMM = sBaseY & sBaseM
    sMinDT = Range("BR2").Value
    sMaxDT = Range("BS2").Value
    

    '-------------------------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| Raw Data |fffd||fffd||fffd||fffd||fffd||fffd||1ae| |fffd||fffd| |fffd||fffd||fffd||fffd|
    '-------------------------------------
    Call SetDetail
    
    For i = 0 To cboDeBRK.ListCount
        If cboDeBRK.List(i) = sBRK_NM Then
            cboDeBRK.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboJiPyo.ListCount
        If cboJiPyo.List(i) = sJiPyo Then
            cboJiPyo.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboDeBaseY.ListCount
        If Left(cboDeBaseY.List(i), 4) = sBaseY Then
            cboDeBaseY.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboDeBaseM.ListCount
        If Left(cboDeBaseM.List(i), 2) = sBaseM Then
            cboDeBaseM.ListIndex = i
            Exit For
        End If
    Next

    
    If g_Lang = "K" Then
        If sBaseYYMM > sMaxDT Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||537||bd||f1||fffd||fffd| " & Left(sMaxDT, 4) & "|fffd||fffd| " & Right(sMaxDT, 2) & "|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||574||3f4||fffd|."
            Exit Sub
        ElseIf sBaseYYMM < sMinDT Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||537||bd||f1||fffd||fffd| " & Left(sMinDT, 4) & "|fffd||fffd| " & Right(sMinDT, 2) & "|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||574||3f4||fffd|."
            Exit Sub
        End If
    Else
        If sBaseYYMM > sMaxDT Then
            MsgBox "Detailed Consensus List can be contributed until " & Left(sMaxDT, 4) & "." & Right(sMaxDT, 2)
            Exit Sub
        ElseIf sBaseYYMM < sMinDT Then
            MsgBox "Detailed Consensus List can be contributed after " & Left(sMinDT, 4) & "." & Right(sMinDT, 2)
            Exit Sub
        End If
    End If
    
    
    '|fffd||7b8||fffd||fffd||fffd||fffd|
    If sJiPyo_CD = "10101001" Or sJiPyo_CD = "10101002" Or sJiPyo_CD = "10101003" Or sJiPyo_CD = "10101004" Then
        If g_Lang = "E" Then
            Range("C21").Formula = sJiPyo & "from The Bank of Korea and KDI calculated using the same period data in the last year as the previous period"
        Else
            Range("C21").Formula = "*|fffd||471||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| KDI |fffd||fffd||f3||fffd||fffd| " & sJiPyo & " |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||2d7f||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||378||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||574||3f4||fffd|."
        End If
    Else
        Range("C21").ClearContents
    End If

        
    '-------------------------------
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| Refresh
    '-------------------------------
     iRowCnt = 15

    'RawData |fffd||fffd||ba||3ba||fffd| |fffd||fffd||fffd||fffd|
    Range("AA24:AP200").ClearContents
 
    
    '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & sBaseYYMM & "%05" & "1"
    getDatatoExcel ASP_Detail & sParam, "AB23", sSheetNM, Sheet4
    
    
    'DB |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If g_Lang = "E" Then
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & sBaseYYMM & "%05" & "102"
    Else
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & sBaseYYMM & "%05" & "2"
    End If
    
    getDatatoExcel ASP_Detail & sParam, "AA24", sSheetNM, Sheet4
    
    
    '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    Range("AB22").Select
    If Int(Right(sBaseYYMM, 2)) >= 9 Then
        iYear = Int(Left(sBaseYYMM, 4))
    Else
        iYear = Int(Left(sBaseYYMM, 4)) - 1
    End If

    For i = 0 To 2
        If g_Lang = "K" Then
            ActiveCell.Formula = iYear + i & "|fffd||fffd|"
        Else
            ActiveCell.Formula = iYear + i
        End If
        Selection.Offset(0, 1).Select
    Next

    
    '|fffd||fffd||fffd||631||778||fffd|, |fffd||fffd||fffd||fffd||e4|, KOPI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||3f9||771||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||2b0||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If sJiPyo_CD = "10201002" Or sJiPyo_CD = "10201004" Or sJiPyo_CD = "10204001" Or sJiPyo_CD = "10204002" Then
        Range("G24").Select
        ActiveCell.Formula = "=IF(AD24<>"""", AD24, ""-"")"
        Selection.AutoFill Destination:=Range("G24:G136"), Type:=xlFillValues
        
        Range("G26").Formula = "=IF(G$24<>""-"", IF(G$25<>""-"", G$24-G$25,""-""),""-"")"
        Range("G28").Formula = "=IF(AD28<>"""", AD28, ""-"")"
        Range("G29").Formula = "=IF(AD29<>"""", AD29, ""-"")"
        
        
    Else
        Range("G24").Select
        ActiveCell.Formula = "=IF(E24<>""-"", IF(F24<>""-"", AVERAGE(E24:F24),""-""),""-"")"
        Selection.AutoFill Destination:=Range("G24:G136"), Type:=xlFillValues
        
        Range("G26").Select
        ActiveCell.Formula = "=IF(G$24<>""-"", IF(G$25<>""-"", G$24-G$25,""-""),""-"")"
        
        Range("G30").Select
        ActiveCell.Formula = "=IF(AD30<>"""", AD30, ""-"")"
        Selection.AutoFill Destination:=Range("G30:G32"), Type:=xlFillValues
        
        '|fffd||471||fffd||fffd||fffd||fffd||fffd|, KDI, OECD |fffd||fffd||fffd||3f9||771||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||2b0||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Range("G33").Formula = "=IF(AD33<>"""", AD33, ""-"")"
        Range("G34").Formula = "=IF(AD34<>"""", AD34, ""-"")"
        Range("G35").Formula = "=IF(AD35<>"""", AD35, ""-"")"
        
        '       |fffd||5b0||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd|,|fffd||3f9||771||fffd|
        Range("G28").Formula = "=IF(E28<>""-"", IF(F28<>""-"", MAX(E28:F28),""-""),""-"")"
        Range("G29").Formula = "=IF(E29<>""-"", IF(F29<>""-"", MIN(E29:F29),""-""),""-"")"
        
    End If
    
    ' |fffd||fffd|, |fffd||3f9||771||fffd| |fffd||fffd||fffd||fffd|
    '       |fffd||fffd||fffd||fffd||fffd||fffd|(10103005) |fffd||fffd||1e5||121||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||634||fffd|.(|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||375||fffd|)
    If sJiPyo_CD = "10103005" Then
    
        Range("G24").Formula = "=IF(E24<>""-"", IF(F24<>""-"", SUM(E24:F24),""-""),""-"")"
        Range("J24").Formula = "=IF(H24<>""-"", IF(I24<>""-"", SUM(H24:I24),""-""),""-"")"
        Range("N24").Formula = "=IF(L24<>""-"", IF(M24<>""-"", SUM(L24:M24),""-""),""-"")"
        Range("Q24").Formula = "=IF(O24<>""-"", IF(P24<>""-"", SUM(O24:P24),""-""),""-"")"
        
        Range("G25").Formula = "=IF(E25<>""-"", IF(F25<>""-"", SUM(E25:F25),""-""),""-"")"
        Range("J25").Formula = "=IF(H25<>""-"", IF(I25<>""-"", SUM(H25:I25),""-""),""-"")"
        Range("N25").Formula = "=IF(L25<>""-"", IF(M25<>""-"", SUM(L25:M25),""-""),""-"")"
        Range("Q25").Formula = "=IF(O25<>""-"", IF(P25<>""-"", SUM(O25:P25),""-""),""-"")"
        Range("G36").Formula = "=IF(E36<>""-"", IF(F36<>""-"", SUM(E36:F36),""-""),""-"")"

    End If
    
    Range("G36").Select
    Selection.AutoFill Destination:=Range("G36:G136"), Type:=xlFillValues
    
    Range("G24:G136").Copy
    Range("J24").Select
    ActiveSheet.Paste
    Range("N24").Select
    ActiveSheet.Paste
    Range("Q24").Select
    ActiveSheet.Paste
    
    ' (|fffd||fffd||fffd||fffd|)
    '       |fffd||6bd||fffd||fffd||fffd| |fffd||fffd||fffd| - |fffd||fffd||fffd||fffd|
    If sJiPyo_CD = "10204001" Then
        
        Range("K25").Formula = "=IF(G25<>""-"", IF(J25<>""-"", MAX(G25,J25), ""-""), ""-"")"
        Range("K27").Formula = "=IF(G27<>""-"", IF(J27<>""-"", AVERAGE(G27,J27), ""-""), ""-"")"
        Range("K28").Formula = "=IF(G28<>""-"", IF(J28<>""-"", MAX(G28,J28), ""-""), ""-"")"

        Range("K29").Formula = "=IF(G29<>""-"", IF(J29<>""-"", MIN(G29,J29), ""-""), ""-"")"
        Range("K30").Formula = "=IF(G30<>""-"", IF(J30<>""-"", AVERAGE(G30,J30), ""-""), ""-"")"
        Range("K31").Formula = "=IF(G31<>""-"", IF(J31<>""-"", AVERAGE(G31,J31), ""-""), ""-"")"
        Range("K32").Formula = "=IF(G32<>""-"", IF(J32<>""-"", AVERAGE(G32,J32), ""-""), ""-"")"
        Range("K36").Formula = "=IF(G36<>""-"", IF(J36<>""-"", MAX(G36,J36), ""-""), ""-"")"
        
        Range("K37").Formula = "=IF(G37<>""-"", IF(J37<>""-"", MAX(G37,J37), ""-""), ""-"")"
        Range("K37").Select
        Selection.AutoFill Destination:=Range("K37:K136"), Type:=xlFillValues
        
            
    '       |fffd||6bd||fffd||fffd||fffd| |fffd||fffd||fffd| - |fffd||fffd||fffd||fffd|
    ElseIf sJiPyo_CD = "10204002" Then
    
        Range("K25").Formula = "=IF(G25<>""-"", IF(J25<>""-"", MIN(G25,J25), ""-""), ""-"")"
        Range("K27").Formula = "=IF(G27<>""-"", IF(J27<>""-"", AVERAGE(G27,J27), ""-""), ""-"")"
        Range("K28").Formula = "=IF(G28<>""-"", IF(J28<>""-"", MAX(G28,J28), ""-""), ""-"")"
        Range("K29").Formula = "=IF(G29<>""-"", IF(J29<>""-"", MIN(G29,J29), ""-""), ""-"")"
        Range("K30").Formula = "=IF(G30<>""-"", IF(J30<>""-"", AVERAGE(G30,J30), ""-""), ""-"")"
        Range("K31").Formula = "=IF(G31<>""-"", IF(J31<>""-"", AVERAGE(G31,J31), ""-""), ""-"")"
        Range("K32").Formula = "=IF(G32<>""-"", IF(J32<>""-"", AVERAGE(G32,J32), ""-""), ""-"")"
        Range("K36").Formula = "=IF(G36<>""-"", IF(J36<>""-"", MIN(G36,J36), ""-""), ""-"")"
        
        Range("K37").Formula = "=IF(G37<>""-"", IF(J37<>""-"", MIN(G37,J37), ""-""), ""-"")"
        Range("K37").Select
        Selection.AutoFill Destination:=Range("K37:K136"), Type:=xlFillValues
    
    Else
        Range("K25").Formula = "=IF(AH25<>"""", AH25, ""-"")"
        Range("K27").Formula = "=IF(AH27<>"""", AH27, ""-"")"
        Range("K27").Select
        Selection.AutoFill Destination:=Range("K27:K33"), Type:=xlFillValues
        
        Range("K36").Formula = "=IF(AH36<>"""", AH36, ""-"")"
        Range("K36").Select
        Selection.AutoFill Destination:=Range("K36:K136"), Type:=xlFillValues
    
    End If
        
    Range("K25:K135").Copy
    Range("R25").Select
    ActiveSheet.Paste
'    Range("S25").Select
'    ActiveSheet.Paste


    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||33e||1bf||fffd| |fffd||fffd||fffd||fffd|
    Rows("34:136").EntireRow.Hidden = False
    Range("AA36").Select
    
    If Range("AA36").Value = "" Then
        iRow = 0
    ElseIf Range("AA37").Value = "" Then
        iRow = 1
    Else
        iRow = Range(Selection, Selection.End(xlDown)).Count
    End If
    
    If sBRK_CD = "ALL" Then
        Rows(36 + iRow & ":136").EntireRow.Hidden = True
    Else
        Range("AB2").Formula = "VLOOKUP(sBRK_NM, AA:AA, 0)"
        iTmp = Int(Range("AB36").Value)
        If iTmp < 37 Then
            Rows("37:136").EntireRow.Hidden = True
        Else
            Rows("36:" & iTmp - 1).EntireRow.Hidden = True
            Rows(iTmp + 1 & ":135").EntireRow.Hidden = True
        End If
    End If
    Application.CutCopyMode = False
    
    '==============================
    '  |fffd||fffd||1ae| |fffd||5f8||fffd||fffd||fffd|
    '==============================
    '|fffd||fffd||1ae| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||370||fffd| |fffd||5b4||fffd| |fffd||431||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||5f7||fffd||fffd||634||fffd|)
    If sBRK_CD = "ALL" Then
        For iEnd_Q = 0 To 7
            Cells(20, 45 + iEnd_Q).Select
            If Cells(20, 45 + iEnd_Q).Value = 0 Then Exit For
        Next
    Else
        For iEnd_Q = 0 To 7
            Cells(28, 45 + iEnd_Q).Select
            If Cells(28, 45 + iEnd_Q).Value = 0 Then Exit For
        Next
    End If
    
    If sBRK_CD = "ALL" Then
        For iEnd_H = 0 To 3
            Cells(20, 54 + iEnd_H).Select
            If Cells(20, 54 + iEnd_H).Value = 1 Then Exit For
        Next
    Else
        For iEnd_H = 0 To 3
            Cells(28, 54 + iEnd_H).Select
            If Cells(28, 54 + iEnd_H).Value = 1 Then Exit For
        Next
    End If
    
    Range("A1").Select
    Sheet4.Shapes("|fffd||fffd||1ae| 1").Select
    
    If ActiveChart.SeriesCollection.Count > 0 Then
        For i = 1 To ActiveChart.SeriesCollection.Count
            ActiveChart.SeriesCollection(1).Delete
        Next
    End If
    ActiveChart.SeriesCollection.NewSeries
    ActiveChart.SeriesCollection.NewSeries
    
    If sJiPyo_CD = "10201002" Or sJiPyo_CD = "10201004" Or sJiPyo_CD = "10204001" Or sJiPyo_CD = "10204002" Then

        ActiveChart.PlotArea.Select
        sTmp = "='" & sSheetNM & "'!$BB$23:" & Cells(23, 53 + iEnd_H).Address
        ActiveChart.SeriesCollection(1).XValues = sTmp
        
        
        '|fffd||fffd||fffd||fffd||121|
        If g_Lang = "K" Then
            ActiveChart.SeriesCollection(1).Name = "|fffd||fffd||1e5||121|"
        Else
            ActiveChart.SeriesCollection(1).Name = "Actuals"
        End If
        'sTmp = "='" & sSheetNM & "'!$BB$24:BE24"
        sTmp = "='" & sSheetNM & "'!$BB$24:" & Cells(24, 53 + iEnd_H).Address
        ActiveChart.SeriesCollection(1).Values = sTmp
        
        If sBRK_NM = "|fffd||fffd||fc|" Or sBRK_NM = "All Institution" Then
            ActiveChart.SeriesCollection(2).Name = "Consensus"
            'sTmp = "='" & sSheetNM & "'!$BB$25:BE25"
            sTmp = "='" & sSheetNM & "'!$BB$25:" & Cells(25, 53 + iEnd_H).Address
            ActiveChart.SeriesCollection(2).Values = sTmp
        Else
            ActiveChart.SeriesCollection(2).Name = sBRK_NM
            sTmp = "='" & sSheetNM & "'!$BB$26:" & Cells(26, 53 + iEnd_H).Address
            ActiveChart.SeriesCollection(2).Values = sTmp
        End If
    Else
         ActiveChart.PlotArea.Select
        sTmp = "='" & sSheetNM & "'!$AS$23:" & Cells(23, 44 + iEnd_Q).Address
        ActiveChart.SeriesCollection(1).XValues = sTmp
        
        '|fffd||fffd||fffd||fffd||121|
        If g_Lang = "K" Then
            ActiveChart.SeriesCollection(1).Name = "|fffd||fffd||1e5||121|"
        Else
            ActiveChart.SeriesCollection(1).Name = "Actuals"
        End If
        sTmp = "='" & sSheetNM & "'!$AS$24:" & Cells(24, 44 + iEnd_Q).Address
        ActiveChart.SeriesCollection(1).Values = sTmp
        
        If sBRK_NM = "|fffd||fffd||fc|" Or sBRK_NM = "All Institution" Then
            ActiveChart.SeriesCollection(2).Name = "Consensus"
            sTmp = "='" & sSheetNM & "'!$AS$25:" & Cells(25, 44 + iEnd_Q).Address
            ActiveChart.SeriesCollection(2).Values = sTmp
        Else
            ActiveChart.SeriesCollection(2).Name = sBRK_NM
            ActiveChart.SeriesCollection(2).Values = _
                "='" & sSheetNM & "'!$AS$26:" & Cells(26, 44 + iEnd_Q).Address
        End If
    
    End If

    
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||33a||fffd||fffd||fffd| |fffd||4bc||fffd||fffd||fffd| |fffd||fffd||b0||fffd||6b8||fffd| |fffd||fffd||fffd||fffd|
    Range("E24:T29").NumberFormatLocal = "0.00_ "
    Range("E33:T" & 35 + iRow).NumberFormatLocal = "0.00_ "
    
    
    '|fffd||fffd||fffd||fffd||fffd||370||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||1fb||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    For i = 0 To iRow - 1
        If Range("Z" & 36 + i).Value = 0 Then
            Rows(36 + i & ":" & 36 + i).EntireRow.Hidden = True
        End If
    Next
    
    
    
    Application.CutCopyMode = False
    Range("A1").Select
    Application.DisplayAlerts = True
    
    Exit Sub
    
    
    
ErrRaised:
'    Resume
    If iTryCnt < 2 Then
        Call SetDetail
        GoTo TryAgain
    End If
    Application.DisplayAlerts = True
    
End Sub


Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cboMmBRK, 5, 1, MSForms, ComboBox"
Attribute VB_Control = "cboMmJiPyo, 6, 2, MSForms, ComboBox"
Attribute VB_Control = "CommandButton1, 7, 3, MSForms, CommandButton"
'======================================================
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Refresh
'======================================================
Public Sub CommandButton1_Click()
Dim iIndex      As Integer
Dim iBRKIdx     As Integer
Dim iRowCnt     As Integer
Dim sBRK_CD     As String
Dim sBRK_NM     As String
Dim sJiPyo      As String
Dim sJiPyo_CD   As String
Dim sBaseYYMM   As String
Dim sBaseNM     As String
Dim sParam      As String
Dim sTemp       As String
Dim i           As Integer
Dim iCnt        As Integer
Dim iRow        As Integer
Dim iChartRow   As Integer
Dim iChartStr   As Integer
Dim iYearStr    As Integer
Dim iYear       As Integer
Dim iHeadCNT    As Integer
Dim rngTmp      As Range
Dim sSheetNM    As String
Dim sTargetDT   As String

On Error GoTo ErrRaised
    
TryAgain:

    iTryCnt = iTryCnt + 1
    Application.DisplayAlerts = False
    
    '|fffd||fffd||fffd|
    If Range("AA4").Value = "ENG" Then
        g_Lang = "E"
        sSheetNM = "Monthly Consensus List"
    Else
        g_Lang = "K"
        sSheetNM = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    End If
    Sheet5.Name = sSheetNM

    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||6b5||fffd|
    Sheet5.Activate
    iBRKIdx = cboMmBRK.ListIndex
    sBRK_NM = cboMmBRK.List(iBRKIdx)
    
    Range("AA1").Value = "=VLOOKUP(""" & sBRK_NM & """, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|4, 2, FALSE)"
    sBRK_CD = Range("AA1").Value
    
    If sBRK_CD = "ALL" Then
        Range("AB1").Value = "=VLOOKUP(""" & sBRK_CD & """, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|4_1, 2, FALSE)"
    Else
        Range("AB1").Value = "=VLOOKUP(" & sBRK_CD & ", |fffd||fffd||fffd||fffd||fffd||fffd||fffd|4_1, 2, FALSE)"
    End If
    
    '|fffd||fffd||1e5|
    iIndex = cboMmJiPyo.ListIndex
    sJiPyo = cboMmJiPyo.List(iIndex)
    Range("AA2").Value = "=VLOOKUP(""" & sJiPyo & """, |fffd||fffd||1e5|2, 2, FALSE)"
    sJiPyo_CD = Range("AA2").Value
    
    sBaseYYMM = "ALL"

    
    '-------------------------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| Raw Data |fffd||fffd||fffd||fffd||fffd||fffd||1ae| |fffd||fffd| |fffd||fffd||fffd||fffd|
    '-------------------------------------
    Call SetMonth
    
    For i = 0 To cboMmBRK.ListCount
        If cboMmBRK.List(i) = sBRK_NM Then
            cboMmBRK.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboMmJiPyo.ListCount
        If cboMmJiPyo.List(i) = sJiPyo Then
            cboMmJiPyo.ListIndex = i
            Exit For
        End If
    Next
        

    
    '-------------------------------
    '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| Refresh
    '-------------------------------

    'RawData |fffd||fffd||ba||3ba||fffd| |fffd||fffd||fffd||fffd|
    Sheet5.Activate
    Range("AA21:AL300").ClearContents
    Range("AP21:AS300").Select
    Range(Selection, Selection.End(xlDown)).ClearContents
    
    Rows("20:57").Select
    Selection.EntireRow.Hidden = False
    
    If g_Lang = "K" Then
        'DB |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & sBaseYYMM & "%05" & "2"
        getDatatoExcel ASP_Month & sParam, "AA21", sSheetNM, ActiveWorkbook.Sheets(5)
        
        'DB |fffd||fffd||fffd||fffd| |fffd||fffd||1ae||fffd||fffd| |fffd||5b1||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & sBaseYYMM & "%05" & "3"
        getDatatoExcel ASP_Month & sParam, "AP21", sSheetNM, ActiveWorkbook.Sheets(5)
        
    Else
        'DB |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & sBaseYYMM & "%05" & "102"
        getDatatoExcel ASP_Month & sParam, "AA21", sSheetNM, ActiveWorkbook.Sheets(5)
        
        'DB |fffd||fffd||fffd||fffd| |fffd||fffd||1ae||fffd||fffd| |fffd||5b1||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & sBaseYYMM & "%05" & "103"
        getDatatoExcel ASP_Month & sParam, "AP21", sSheetNM, ActiveWorkbook.Sheets(5)
        
    End If
    
    '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    Range("AA20").Formula = "=COUNTA(AA21:AA250)"
    iRow = Range("AA20").Value
    
    Range("B22:M22").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Delete Shift:=xlUp
    
    Range("B21:M21").ClearContents

    
    Range("B21").Formula = "=IF(AA21<>"""", AA21, ""-"")"
    Range("B21").Select
    Selection.AutoFill Destination:=Range("B21:M21"), Type:=xlFillValues
    
    If sBRK_CD = "ALL" Then
        Range("G21").Formula = "=IF(D21<>""-"", IF(F21<>""-"",D21-F21, ""-""), ""-"")"
    Else
        Range("G21").Formula = "=IF(D21<>""-"", IF(E21<>""-"",D21-E21, ""-""), ""-"")"
    End If
    
    
    If iRow = 0 Then
        With Range("B21:M21").Borders(xlEdgeBottom)
            .LineStyle = xlContinuous
            .ThemeColor = 2
            .TintAndShade = 0.249946592608417
            .Weight = xlThin
        End With
    
        GoTo Jump
    ElseIf iRow = 1 Then
        Range("B21:M21").Select
    Else
        Range("B21:M21").Select
        Selection.AutoFill Destination:=Range("B21:M" & 20 + iRow), Type:=xlFillDefault
        
        Range("B21:M21").Select
        Range(Selection, Selection.End(xlDown)).Select
    End If
    

    '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.249946592608417
        .Weight = xlThin
    End With
    
    Range("D21:J21").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.NumberFormatLocal = "0.00_ "
    
    Range("AA3").Formula = "=COUNTIF(D21:D" & 20 + iRow & ", ""-"")"
    
    Range("N21:N136").ClearContents
    Range("N21").Select
    'Range("N21").Formula = "=IF(RIGHT(C21,1) = ""Q"", ""Q"", IF(RIGHT(C21,2) = ""|fffd||771||fffd|"", ""H"", IF(RIGHT(C21,2)=""|fffd||fffd||fffd||fffd|"", ""Y"","""")))"
    Range("N21").Formula = "=IF(RIGHT(C21,1) = ""Q"", ""Q"", IF(RIGHT(C21,1)=""Y"", ""Y"", IF(RIGHT(C21,2) = ""|fffd||771||fffd|"", ""H"", IF(RIGHT(C21,2)=""|fffd||fffd||fffd||fffd|"", ""Y"",""""))))"
    If iRow > 1 Then
        Selection.AutoFill Destination:=Range("N21:N" & 20 + iRow), Type:=xlFillValues
    End If

    For i = 1 To iRow
        If Range("N" & 20 + i).Value = "Q" Or Range("N" & 20 + i).Value = "H" Then
            iChartStr = 20 + i
            Exit For
        End If
    Next
    
    For i = 1 To iRow
        If Range("N" & 20 + i).Value = "Y" Then
            iYearStr = 20 + i
            Exit For
        End If
    Next
    
    If iYearStr <> O Then
        Range("B" & iYearStr & ":M" & iYearStr).Select
        With Selection.Borders(xlEdgeTop)
            .LineStyle = xlDouble
            .ThemeColor = 2
            .TintAndShade = 0.249946592608417
            .Weight = xlThick
        End With
    End If
    
    '================================
    ' |fffd||fffd||1ae| |fffd||5f8||fffd||fffd||fffd|
    '================================
    Range("AP21").Select
    If Range("AP21").Value = "" Then
        iChartRow = 1
    ElseIf Range("AP22").Value = "" Then
        iChartRow = 1
    Else
        iChartRow = Range(Selection, Selection.End(xlDown)).Count
    End If

    
    Range("AS21").Formula = "=ISERROR(AQ21)"
    Range("AT21").Formula = "=ISERROR(AR21)"
    Range("AU21").Formula = "=IF(AS21=TRUE, IF(AT21=TRUE, 1, 0), 0)"
    Range("AS21:AU21").Copy
    Range("AS21:AU" & 20 + iChartRow).Select
    ActiveSheet.Paste
    
    For iCnt = 0 To iChartRow - 1
        If Range("AU" & 21 + iCnt).Value = 1 Then Exit For
    Next
    
    Sheet5.Shapes("|fffd||fffd||1ae| 2").Select
    
    If ActiveChart.SeriesCollection.Count > 0 Then
        For i = 1 To ActiveChart.SeriesCollection.Count
            ActiveChart.SeriesCollection(1).Delete
        Next
    End If
    ActiveChart.SeriesCollection.NewSeries
    ActiveChart.SeriesCollection.NewSeries
    
    ActiveChart.PlotArea.Select
    sTmp = "='" & sSheetNM & "'!$AP$21:AP" & 20 + iCnt
    ActiveChart.SeriesCollection(1).XValues = sTmp
    
    '|fffd||fffd||fffd||fffd||121|
    If Range("AA4").Value = "ENG" Then
        ActiveChart.SeriesCollection(1).Name = "Actuals"
    Else
        ActiveChart.SeriesCollection(1).Name = "|fffd||fffd||1e5||121|"
    End If
    sTmp = "='" & sSheetNM & "'!$AQ$21:AQ" & 20 + iCnt
    ActiveChart.SeriesCollection(1).Values = sTmp
    
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If sBRK_CD = "ALL" Then
        ActiveChart.SeriesCollection(2).Name = "Consensus"
    Else
        ActiveChart.SeriesCollection(2).Name = sBRK_NM
    End If
    sTmp = "='" & sSheetNM & "'!$AR$21:AR" & 20 + iCnt
    ActiveChart.SeriesCollection(2).Values = sTmp

Jump:
    
    Range("B6").Formula = sJiPyo
    
    Application.CutCopyMode = False
    Range("A1").Select
    Sheet1.Visible = xlSheetHidden
    Application.DisplayAlerts = True
    
    Exit Sub
    
ErrRaised:
'    Resume
    If iTryCnt < 2 Then
        Call SetMonth
        GoTo TryAgain
    End If
    Application.DisplayAlerts = True
    
End Sub




Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "cboTrendTerm, 20, 10, MSForms, ComboBox"
Attribute VB_Control = "cboTrendEnd, 11, 11, MSForms, ComboBox"
Attribute VB_Control = "cboTrendStr, 10, 12, MSForms, ComboBox"
Attribute VB_Control = "CommandButton1, 9, 13, MSForms, CommandButton"
Attribute VB_Control = "cboTrendBRK, 1, 14, MSForms, ComboBox"
Attribute VB_Control = "cboTrendJipyo, 5, 15, MSForms, ComboBox"
Attribute VB_Control = "cboTrendTarget, 7, 16, MSForms, ComboBox"
Dim bDealer     As Boolean

' |fffd||fffd||22f||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||238| |fffd||5b1||fffd||fffd| M|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
Private Sub cboTrendBRK_Change()
Dim sTERM           As String
Dim bDealer_CHG     As Boolean

    If InStr(1, cboTrendBRK.Value, "(|fffd||fffd||22f||fffd||fffd||fffd||fffd|)") > 0 Or InStr(1, cboTrendBRK.Value, "(FX Dealer)") > 0 Then
        bDealer_CHG = True
    End If

    If bDealer <> bDealer_CHG Then
        
        If bDealer_CHG Then
            cboTrendTerm.ListIndex = 0
            cboTrendTerm.Enabled = False
        Else
            cboTrendTerm.Enabled = True
        End If
    
        sTERM = cboTrendTerm.Text
        
        '|fffd||fffd||1e5| |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
        If bDealer_CHG Then
            cboTrendJipyo.ListFillRange = Range("|fffd||fffd||1e5|6_D").Address
        Else
            cboTrendJipyo.ListFillRange = Range("|fffd||fffd||1e5|6_M").Address
        End If

        cboTrendJipyo.ListIndex = 0
        
    End If
    
    bDealer = bDealer_CHG
    
End Sub

' |fffd||fffd||238||fffd||5b1||fffd| M |fffd||fffd||fffd||fffd| |fffd||fffd| - |fffd||fffd||238||fffd||2c23| |230||fffd||fffd||22d| & |fffd||fffd||1e5| |fffd||5b1||2c21| M|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
' |fffd||fffd||238||fffd||5b1||fffd| Q,H,Y |fffd||fffd||fffd||fffd| |fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd| |230||fffd||fffd||22d| & |fffd||fffd| |fffd||5b1||2fe1| |fffd||fffd||fffd||fffd| |fffd||fffd||1e5| |fffd||fffd||fffd||fffd||1ae| |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
Private Sub cboTrendTerm_Change()
Dim sParam      As String
Dim sTERM       As String
Dim rngList     As Range
Dim rngList2    As Range


    sTERM = cboTrendTerm.Text

    With Sheet6
        .Activate
        
        'M
        If sTERM = "M" Then
            
            .cboTrendStr.Enabled = True
            .cboTrendEnd.Enabled = True
            .cboTrendTarget.Enabled = False
            
            '|fffd||fffd||1e5| |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
            If InStr(1, cboTrendBRK.Value, "(|fffd||fffd||22f||fffd||fffd||fffd||fffd|)") > 0 Or InStr(1, cboTrendBRK.Value, "(FX Dealer)") > 0 Then
                .cboTrendJipyo.ListFillRange = Range("|fffd||fffd||1e5|6_D").Address
            Else
                .cboTrendJipyo.ListFillRange = Range("|fffd||fffd||1e5|6_M").Address
            End If
            .cboTrendJipyo.ListIndex = 0

            
            '|fffd||fffd||238||fffd||2c23| |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
            If .Range("AA4").Value = "ENG" Then
                Set rngList = .Range(.Range("BQ2"), .Range("BQ2").End(xlDown))
                Set rngList2 = .Range(rngList, rngList.End(xlDown))
            Else
                Set rngList = .Range(.Range("BP2"), .Range("BP2").End(xlDown))
                Set rngList2 = .Range(rngList, rngList.End(xlDown))
            End If
            
            
            .cboTrendStr.ListFillRange = rngList2.Address
            .cboTrendEnd.ListFillRange = rngList2.Address
            .cboTrendStr.ListIndex = 0
            .cboTrendEnd.ListIndex = .cboTrendEnd.ListCount - 1
            
        ' Q,H,Y
        Else
            .cboTrendStr.Enabled = False
            .cboTrendEnd.Enabled = False
            .cboTrendTarget.Enabled = True
            
            '|fffd||fffd||1e5| |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
            If sTERM = "H" Then
                .cboTrendJipyo.ListFillRange = Range("|fffd||fffd||1e5|6_H").Address
            Else
                .cboTrendJipyo.ListFillRange = Range("|fffd||fffd||1e5|6_QY").Address
            End If
            
            .cboTrendJipyo.ListIndex = 0
    
            ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
            .Range("BN2:BN200").ClearContents
            If .cboTrendTerm.Text = "Q" Then
                getDatatoExcel ASP_GET_LIST & 21 & "%05" & g_Lang, "BN2", Sheet6.Name, Sheet6
            ElseIf .cboTrendTerm.Text = "H" Then
                getDatatoExcel ASP_GET_LIST & 22 & "%05" & g_Lang, "BN2", Sheet6.Name, Sheet6
            Else
                getDatatoExcel ASP_GET_LIST & 23 & "%05" & g_Lang, "BN2", Sheet6.Name, Sheet6
            End If
            
            Set rngList = .Range(.Range("BN2"), .Range("BN2").End(xlDown))
            Set rngList2 = .Range(rngList, rngList.End(xlDown))
            
            .cboTrendTarget.ListFillRange = rngList2.Address
            .cboTrendTarget.ListIndex = .cboTrendTarget.ListCount - 2
            
        End If
    
    End With
    
End Sub


'======================================================
' |fffd||fffd||169||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Refresh
'======================================================
Public Sub CommandButton1_Click()
Dim iBRKIdx     As Integer
Dim iJipyoIdx   As Integer
Dim iTargetIdx  As Integer
Dim iStrIdx     As Integer
Dim iEndIdx     As Integer
Dim iRowCnt     As Integer
Dim sBRK_CD     As String
Dim sBRK_NM     As String
Dim sJiPyo      As String
Dim sJiPyo_CD   As String
Dim sBaseYYMM   As String
Dim sBaseNM     As String
Dim sParam      As String
Dim sTemp       As String
Dim i           As Integer
Dim iCnt        As Integer
Dim iRow        As Integer
Dim iChartRow   As Integer
Dim iChartStr   As Integer
Dim iYearStr    As Integer
Dim iYear       As Integer
Dim iHeadCNT    As Integer
Dim iTryCnt     As Integer
Dim rngTmp      As Range
Dim sSheetNM    As String
Dim sTargetTXT  As String
Dim sStrTXT     As String
Dim sEndTxt     As String
Dim sTERM       As String
Dim sStartDT    As String
Dim sEndDT      As String
Dim sTargetDT   As String

On Error GoTo ErrRaised
    
TryAgain:

    iTryCnt = iTryCnt + 1
    Application.DisplayAlerts = False
    
    '|fffd||fffd||fffd|
    If Range("AA4").Value = "ENG" Then
        g_Lang = "E"
        sSheetNM = "MacroConsensus Trend"
    Else
        g_Lang = "K"
        sSheetNM = "|fffd||fffd||169||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |1ae||fffd||fffd||fffd||fffd|"
    End If
    Sheet6.Name = sSheetNM
    
    sTERM = cboTrendTerm.Text
    If sTERM = "M" Then
        If g_Lang = "K" Then
            sStartDT = Left(Trim(cboTrendStr.Text), 4) & Mid(Trim(cboTrendStr.Text), 7, 2)
            sEndDT = Left(Trim(cboTrendEnd.Text), 4) & Mid(Trim(cboTrendEnd.Text), 7, 2)
        Else
            sStartDT = Left(Trim(cboTrendStr.Text), 4) & Mid(Trim(cboTrendStr.Text), 6, 2)
            sEndDT = Left(Trim(cboTrendEnd.Text), 4) & Mid(Trim(cboTrendEnd.Text), 6, 2)
        End If
        
        If CLng(sStartDT) > CLng(sEndDT) Then
        
            If g_Lang = "K" Then
                MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3fa||fffd||fffd||fffd| |fffd||6f0||173||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3ff||fffd| |fffd||5bd||2bd||ff||fffd|."
                Exit Sub
            Else
                MsgBox "The start date must be forward from the end date."
                Exit Sub
            End If
        End If
    ElseIf sTERM = "Q" Then
        If g_Lang = "K" Then
            sTargetDT = Left(Trim(cboTrendTarget.Text), 4) & Mid(Trim(cboTrendTarget.Text), 7, 2)
        Else
            sTargetDT = Left(Trim(cboTrendTarget.Text), 4) & Mid(Trim(cboTrendTarget.Text), 6, 2)
        End If
    ElseIf sTERM = "H" Then
        If g_Lang = "K" Then
            If Mid(Trim(cboTrendTarget.Text), 7, 3) = "|fffd||fffd||771||fffd|" Then
                sTargetDT = Left(Trim(cboTrendTarget.Text), 4) & "80"
            Else
                sTargetDT = Left(Trim(cboTrendTarget.Text), 4) & "90"
            End If
        Else
            If Mid(Trim(cboTrendTarget.Text), 6, 2) = "1H" Then
                sTargetDT = Left(Trim(cboTrendTarget.Text), 4) & "80"
            Else
                sTargetDT = Left(Trim(cboTrendTarget.Text), 4) & "90"
            End If
        End If
    ElseIf sTERM = "Y" Then
        sTargetDT = Left(Trim(cboTrendTarget.Text), 4) + "00"
    End If

    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||6b5||fffd|
    Sheet6.Activate
    sBRK_NM = cboTrendBRK.Value
    
    Range("AA1").Value = "=VLOOKUP(""" & sBRK_NM & """, |fffd||fffd||fffd||fffd||fffd||fffd||fffd|5, 2, FALSE)"
    sBRK_CD = Range("AA1").Value
    sJiPyo = cboTrendJipyo.Value
    Range("AA2").Value = "=VLOOKUP(""" & sJiPyo & """, |fffd||fffd||1e5|6, 2, FALSE)"
    sJiPyo_CD = Range("AA2").Value
    
    sBaseYYMM = "ALL"
        
    sStrTXT = cboTrendStr.Value
    sEndTxt = cboTrendEnd.Value
    sTargetTXT = cboTrendTarget.Value
    '-------------------------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| Raw Data |fffd||fffd||fffd||fffd||fffd||fffd||1ae| |fffd||fffd| |fffd||fffd||fffd||fffd|
    '-------------------------------------
    Call SetTrend

    For i = 0 To cboTrendBRK.ListCount
        If cboTrendBRK.List(i) = sBRK_NM Then
            cboTrendBRK.ListIndex = i
            Exit For
        End If
    Next

    For i = 0 To cboTrendJipyo.ListCount
        If cboTrendJipyo.List(i) = sJiPyo Then
            cboTrendJipyo.ListIndex = i
            Exit For
        End If
    Next
     
    If sTERM <> "M" Then
        For i = 0 To cboTrendTarget.ListCount
            If cboTrendTarget.List(i) = sTargetTXT Then
                cboTrendTarget.ListIndex = i
                Exit For
            End If
        Next
    End If
    
    For i = 0 To cboTrendStr.ListCount
        If cboTrendStr.List(i) = sStrTXT Then
            cboTrendStr.ListIndex = i
            Exit For
        End If
    Next
    
    For i = 0 To cboTrendEnd.ListCount
        If cboTrendEnd.List(i) = sEndTxt Then
            cboTrendEnd.ListIndex = i
            Exit For
        End If
    Next
    
    '-------------------------------
    '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| Refresh
    '-------------------------------

    'RawData |fffd||fffd||ba||3ba||fffd| |fffd||fffd||fffd||fffd|
    Sheet6.Activate
    Range("AA23:AL300").ClearContents
    Range("AP23:AY300").Select
    Range(Selection, Selection.End(xlDown)).ClearContents


    Sheet6.Range("A1").Select
    
    If g_Lang = "K" Then
        'DB |fffd||fffd||fffd||fffd| |1ae||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & cboTrendTerm.Text & "%05" & sTargetDT & "%05" & sStartDT & "%05" & sEndDT & "%05" & "2"
        getDatatoExcel ASP_Trend & sParam, "AA23", sSheetNM, ActiveWorkbook.Sheets(6)
    Else
        'DB |fffd||fffd||fffd||fffd| |1ae||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & cboTrendTerm.Text & "%05" & sTargetDT & "%05" & sStartDT & "%05" & sEndDT & "%05" & "102"
        getDatatoExcel ASP_Trend & sParam, "AA23", sSheetNM, ActiveWorkbook.Sheets(6)
    End If
    
    'DB |fffd||fffd||fffd||fffd| |fffd||fffd||1ae||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    sParam = sBRK_CD & "%05" & sJiPyo_CD & "%05" & cboTrendTerm.Text & "%05" & sTargetDT & "%05" & sStartDT & "%05" & sEndDT & "%05" & "3"
    getDatatoExcel ASP_Trend & sParam, "AP23", sSheetNM, ActiveWorkbook.Sheets(6)
    
    
    '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    Range("AA22").Formula = "=COUNTA(AA23:AA250)"
    iRow = Range("AA22").Value

    Range("B24:M200").Select
    Range(Selection, Selection.End(xlDown)).Select
    ' Shift:=xlUp |fffd||fffd||fffd||fffd||fffd| cboTrendTerm_Change |fffd||33a||fffd||1ae||fffd||fffd| |178||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||7fb||fffd|.
'    Selection.Delete Shift:=xlUp
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    Selection.Borders(xlEdgeLeft).LineStyle = xlNone
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.249946592608417
        .Weight = xlThin
    End With
    Selection.Borders(xlEdgeBottom).LineStyle = xlNone
    Selection.Borders(xlEdgeRight).LineStyle = xlNone
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    With Selection.Interior
        .Pattern = xlNone
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    Selection.ClearContents
    
    
    Range("B23:M23").ClearContents

    If g_Lang = "K" Then
        Range("B23").Formula = "=IF(AA23<>"""", AA23, ""-"")"
        Range("C23").Formula = "=IF(AB23<>"""", AB23, ""-"")"
    Else
        Range("B23").Formula = "=IF(AA23<>"""", LEFT(AA23,7), ""-"")"
        Range("C23").Formula = "=IF(AB23<>"""", LEFT(AB23,7), ""-"")"
    End If
    Range("D23").Formula = "=IF(AC23<>"""", AC23, ""-"")"
    Range("D23").Select
    Selection.AutoFill Destination:=Range("D23:M23"), Type:=xlFillValues
    
    If sBRK_CD = "ALL" Then
        Range("G23").Formula = "=IF(D23<>""-"", IF(F23<>""-"",D23-F23, ""-""), ""-"")"
    Else
        Range("G23").Formula = "=IF(D23<>""-"", IF(E23<>""-"",D23-E23, ""-""), ""-"")"
    End If
    
    
    If iRow = 0 Then
        With Range("B23:M23").Borders(xlEdgeBottom)
            .LineStyle = xlContinuous
            .ThemeColor = 2
            .TintAndShade = 0.249946592608417
            .Weight = xlThin
        End With
    
        GoTo Jump
    ElseIf iRow = 1 Then
        Range("B23:M23").Select
    Else
        Range("B23:M23").Select
        Selection.AutoFill Destination:=Range("B23:M" & 22 + iRow), Type:=xlFillDefault
        
        Range("B23:M23").Select
        Range(Selection, Selection.End(xlDown)).Select
    End If
    

    '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0.249946592608417
        .Weight = xlThin
    End With
    
    If iRow > 1 Then
        With Selection.Borders(xlInsideHorizontal)
            .LineStyle = xlContinuous
            .ThemeColor = 1
            .TintAndShade = -0.249946592608417
            .Weight = xlThin
        End With
    End If
    
    Range("D23:J23").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.NumberFormatLocal = "0.00_ "
    
    Range("AA3").Formula = "=COUNTIF(D23:D" & 22 + iRow & ", ""-"")"
    
    Range("N23:N200").ClearContents
    Range("N23").Select
    'Range("N21").Formula = "=IF(RIGHT(C21,1) = ""Q"", ""Q"", IF(RIGHT(C21,2) = ""|fffd||771||fffd|"", ""H"", IF(RIGHT(C21,2)=""|fffd||fffd||fffd||fffd|"", ""Y"","""")))"
    Range("N23").Formula = "=IF(RIGHT(C23,1) = ""Q"", ""Q"", IF(RIGHT(C23,1)=""Y"", ""Y"", IF(RIGHT(C23,2) = ""|fffd||771||fffd|"", ""H"", IF(RIGHT(C23,2)=""|fffd||fffd||fffd||fffd|"", ""Y"",""""))))"
    If iRow > 1 Then
        Selection.AutoFill Destination:=Range("N23:N" & 22 + iRow), Type:=xlFillValues
    End If

    For i = 1 To iRow
        If Range("N" & 22 + i).Value = "Q" Or Range("N" & 22 + i).Value = "H" Then
            iChartStr = 22 + i
            Exit For
        End If
    Next
    
    For i = 1 To iRow
        If Range("N" & 22 + i).Value = "Y" Then
            iYearStr = 22 + i
            Exit For
        End If
    Next
    
    If iYearStr <> O Then
        Range("B" & iYearStr & ":M" & iYearStr).Select
        With Selection.Borders(xlEdgeTop)
            .LineStyle = xlDouble
            .ThemeColor = 2
            .TintAndShade = 0.249946592608417
            .Weight = xlThick
        End With
    End If
    
    '================================
    ' |fffd||fffd||1ae| |fffd||5f8||fffd||fffd||fffd|
    '================================
    Range("AP23").Select
    If Range("AP23").Value = "" Then
        iChartRow = 1
    ElseIf Range("AP24").Value = "" Then
        iChartRow = 1
    Else
        iChartRow = Range(Selection, Selection.End(xlDown)).Count
    End If

    If cboTrendTerm = "M" Then
        Range("AS23").Formula = "=ISERROR(AQ23)"
        Range("AT23").Formula = "=ISERROR(AR23)"
        Range("AU23").Formula = "=IF(AS23=TRUE, IF(AT23=TRUE, 1, 0), 0)"
        Range("AS23:AU23").Copy
        Range("AS23:AU" & 22 + iChartRow).Select
        ActiveSheet.Paste
    '    Range("AS21:AU" & 20 + iChartRow).Select
        
        For iCnt = 0 To iChartRow - 1
            If Range("AU" & 23 + iCnt).Value = 1 Then Exit For
        Next
    End If
    
    Sheet6.Shapes("|fffd||fffd||1ae| 2").Select
    
    If ActiveChart.SeriesCollection.Count > 0 Then
        For i = 1 To ActiveChart.SeriesCollection.Count
            ActiveChart.SeriesCollection(1).Delete
        Next
    End If
    ActiveChart.SeriesCollection.NewSeries
    If cboTrendTerm = "M" Then
        ActiveChart.SeriesCollection.NewSeries
    End If
    
    If iCnt = 0 Then iCnt = iChartRow
    ActiveChart.PlotArea.Select
    sTmp = "='" & sSheetNM & "'!$AP$23:AP" & 22 + iCnt
    ActiveChart.SeriesCollection(1).XValues = sTmp
    
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If sBRK_CD = "ALL" Then
        ActiveChart.SeriesCollection(1).Name = "Consensus"
    Else
        ActiveChart.SeriesCollection(1).Name = sBRK_NM
    End If
    sTmp = "='" & sSheetNM & "'!$AQ$23:AQ" & 22 + iCnt
    ActiveChart.SeriesCollection(1).Values = sTmp
    ActiveChart.SeriesCollection(1).Select
    
    With Selection
        .MarkerStyle = xlAutomatic
        .MarkerSize = 7
        .Format.Line.ForeColor.ObjectThemeColor = 6
        .Format.Fill.ForeColor.ObjectThemeColor = 6
    End With
    
    
    '|fffd||fffd||fffd||fffd||121|
    If cboTrendTerm = "M" Then
        If Range("AA4").Value = "ENG" Then
            ActiveChart.SeriesCollection(2).Name = "Actuals"
        Else
            ActiveChart.SeriesCollection(2).Name = "|fffd||fffd||1e5||121|"
        End If
        sTmp = "='" & sSheetNM & "'!$AR$23:AR" & 22 + iCnt
        ActiveChart.SeriesCollection(2).Values = sTmp
        ActiveChart.SeriesCollection(2).Select
        
        With Selection
            .MarkerStyle = xlAutomatic
            .MarkerSize = 7
            .Format.Line.ForeColor.ObjectThemeColor = 5
            .Format.Fill.ForeColor.ObjectThemeColor = 5
        End With
    
    End If

Jump:
    
    Range("B8").Formula = sJiPyo
    
    Application.CutCopyMode = False
    Range("A1").Select
    Sheet1.Visible = xlSheetHidden
    Application.DisplayAlerts = True
    
    Exit Sub
    
ErrRaised:
'    Resume
    If iTryCnt < 2 Then
        Call SetTrend
        GoTo TryAgain
    End If
    Application.DisplayAlerts = True
    
End Sub


Attribute VB_Name = "mdlFunction"

Public Const ASP_GET_LIST As String = "URL;http://seven.quantiwise.com/QWWebTemplate.aspx?Type=401&Param="
Public Const ASP_JIPYO As String = "URL;http://seven.quantiwise.com/QWWebTemplate.aspx?Type=402&Param="
Public Const ASP_P_JIPYO As String = "URL;http://seven.quantiwise.com/QWWebTemplate.aspx?Type=403&Param="
Public Const ASP_Detail As String = "URL;http://seven.quantiwise.com/QWWebTemplate.aspx?Type=404&Param="
Public Const ASP_Month As String = "URL;http://seven.quantiwise.com/QWWebTemplate.aspx?Type=405&Param="
Public Const ASP_Trend As String = "URL;http://seven.quantiwise.com/QWWebTemplate.aspx?Type=406&Param="

'|fffd||5fd||fffd||1ae| |fffd||fffd||fffd||fffd||fffd||fffd|
Public Const ASP_GET_LIST_test As String = "URL;http://testquantiwise.wisefn.com/QWWebTemplate.aspx?Type=401&Param="
Public Const ASP_JIPYO_test As String = "URL;http://testquantiwise.wisefn.com/QWWebTemplate.aspx?Type=402&Param="
Public Const ASP_P_JIPYO_test As String = "URL;http://testquantiwise.wisefn.com/QWWebTemplate.aspx?Type=403&Param="
Public Const ASP_Detail_test As String = "URL;http://testquantiwise.wisefn.com/QWWebTemplate.aspx?Type=404&Param="
Public Const ASP_Month_test As String = "URL;http://testquantiwise.wisefn.com/QWWebTemplate.aspx?Type=405&Param="
Public Const ASP_Trend_test As String = "URL;http://testquantiwise.wisefn.com/QWWebTemplate.aspx?Type=406&Param="


Public Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)


'Public Function LoadComboData()
'Dim rngTmp  As Range
'
'On Error Resume Next
'
'    Sheet1.Activate
'    Set rngTmp = Sheet1.Range("A2:O100")
'    rngTmp.ClearContents
'
'    getDatatoExcel ASP_GET_LIST & 1 & "%05" & g_Lang, "A3", "SetCombo", ActiveWorkbook.Sheets(1)
'
'    getDatatoExcel ASP_GET_LIST & 6 & "%05" & g_Lang, "E2", "SetCombo", ActiveWorkbook.Sheets(1)
'
'    getDatatoExcel ASP_GET_LIST & 3 & "%05" & g_Lang, "G2", "SetCombo", ActiveWorkbook.Sheets(1)
'
'    getDatatoExcel ASP_GET_LIST & 4 & "%05" & g_Lang, "I2", "SetCombo", ActiveWorkbook.Sheets(1)
'
'    getDatatoExcel ASP_GET_LIST & 7 & "%05" & g_Lang, "L2", "SetCombo", ActiveWorkbook.Sheets(1)
'
'    getDatatoExcel ASP_GET_LIST & 5 & "%05" & g_Lang, "N3", "SetCombo", ActiveWorkbook.Sheets(1)
'
'    getDatatoExcel ASP_GET_LIST & 2 & "%05" & g_Lang, "T2", "SetCombo", ActiveWorkbook.Sheets(1)
'
'    getDatatoExcel ASP_GET_LIST & 8 & "%05" & g_Lang, "P3", "SetCombo", ActiveWorkbook.Sheets(1)
'
'
'    Set rngTmp = Sheet1.Range("A2")
'    rngTmp.Value = "|fffd||fffd||fc|"
'
'    Set rngTmp = Sheet1.Range("B2")
'    rngTmp.Value = "ALL"
'
'    Set rngTmp = Sheet1.Range("N2")
'    rngTmp.Value = "ALL"
'
'    Set rngTmp = Sheet1.Range("P2")
'    rngTmp.Value = "ALL"
'
'
'
'End Function


'Public Function SetCombo()
'
'    '--------------------------
'    '|fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'    '--------------------------
'    Call LoadComboData
'    Call SetNameManager
'
'    '--------------------------
'    '|fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
'    '--------------------------
'    Call SetJiPyo
'    Call SetP_JiPyo
'    Call SetDetail
'    Call SetMonth
'
'End Function


Public Function SetJiPyo()
Dim rngList     As Range
Dim rngList2     As Range

    With Sheet2
        .Activate
        
        If .Range("AA2").Value = "ENG" Then
            g_Lang = "E"
        Else
            g_Lang = "K"
        End If
        
    '-----------------------
    'Raw Data
    '-----------------------
        .Range("BA2:BH200").ClearContents
        
        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        getDatatoExcel ASP_GET_LIST & 8 & "%05" & g_Lang, "BA3", Sheet2.Name, Sheet2
        If g_Lang = "E" Then
            .Range("BA2").Value = "All Institution"
            .Range("BC2").Value = "All Institution"
        Else
            .Range("BA2").Value = "|fffd||fffd||fc|"
            .Range("BC2").Value = "|fffd||fffd||fc|"
        End If
        
        .Range("BB2").Value = "ALL"
        
    '    cboBRK.ListIndex = iBRKIdx
    '    sBRK_NM = Range("AB1").Value
        
        ' |fffd||537||fffd| |fffd||fffd||fffd||fffd|
        getDatatoExcel ASP_GET_LIST & 6 & "%05" & g_Lang, "BE2", Sheet2.Name, Sheet2
        
        ' |fffd||537||bd||fffd||fffd||fffd|(MIN, MAX)
        getDatatoExcel ASP_GET_LIST & 2 & "%05" & g_Lang, "BG2", Sheet2.Name, Sheet2
        
        ' |fffd||338||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|1").Delete
        Set rngTmp = .Range(.Range("BA2:BB2"), .Range("BA2:BB2").End(xlDown))
        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|1", RefersToR1C1:=rngTmp
        
'        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|1_1").Delete
'        Set rngTmp = .Range(.Range("BB2:BC2"), .Range("BB2:BC2").End(xlDown))
'        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|1_1", RefersToR1C1:=rngTmp

    '-----------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
    '-----------------------
        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        .Activate
        Set rngList = .Range(.Range("BA2"), .Range("BA2").End(xlDown))
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        
        .cboBRK.ListFillRange = rngList2.Address
        .cboBRK.ListIndex = 0
            
            
        '|fffd||537||bd||f1||fffd|
        '  |fffd||fffd|
        Set rngList = .Range(.Range("BE2"), .Range("BE2").End(xlDown))
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        .cboBaseY.ListFillRange = rngList2.Address
        .cboBaseY.ListIndex = 0
    
'        '  |fffd||fffd|
'        .cboBaseM.Clear
'
'        If .Range("AA2").Value = "KOR" Then
'            .cboBaseM.AddItem "01|fffd||fffd|"
'            .cboBaseM.AddItem "02|fffd||fffd|"
'            .cboBaseM.AddItem "03|fffd||fffd|"
'            .cboBaseM.AddItem "04|fffd||fffd|"
'            .cboBaseM.AddItem "05|fffd||fffd|"
'            .cboBaseM.AddItem "06|fffd||fffd|"
'            .cboBaseM.AddItem "07|fffd||fffd|"
'            .cboBaseM.AddItem "08|fffd||fffd|"
'            .cboBaseM.AddItem "09|fffd||fffd|"
'            .cboBaseM.AddItem "10|fffd||fffd|"
'            .cboBaseM.AddItem "11|fffd||fffd|"
'            .cboBaseM.AddItem "12|fffd||fffd|"
'        Else
'            .cboBaseM.AddItem "01"
'            .cboBaseM.AddItem "02"
'            .cboBaseM.AddItem "03"
'            .cboBaseM.AddItem "04"
'            .cboBaseM.AddItem "05"
'            .cboBaseM.AddItem "06"
'            .cboBaseM.AddItem "07"
'            .cboBaseM.AddItem "08"
'            .cboBaseM.AddItem "09"
'            .cboBaseM.AddItem "10"
'            .cboBaseM.AddItem "11"
'            .cboBaseM.AddItem "12"
'        End If
        
        .cboBaseM.ListIndex = 0
        
    End With

End Function

Public Function SetP_JiPyo()
Dim rngList     As Range
Dim rngList2    As Range
    
    With Sheet3
        .Activate
        
        If .Range("CA2").Value = "ENG" Then
            g_Lang = "E"
        Else
            g_Lang = "K"
        End If
        
    '-----------------------
    'Raw Data
    '-----------------------
        .Range("CS2:CW200").ClearContents
        
        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        getDatatoExcel ASP_GET_LIST & 1 & "%05" & g_Lang, "BR3", "|fffd||2c23||fffd||fffd| |fffd||5bf||fffd||fffd||fffd||1e5|", Sheet3
        If g_Lang = "E" Then
            .Range("BR2").Value = "All Institution"
            .Range("BT2").Value = "All Institution"
        Else
            .Range("BR2").Value = "|fffd||fffd||fc|"
            .Range("BT2").Value = "|fffd||fffd||fc|"
        End If
        
       .Range("BS2").Value = "ALL"

        
        ' |fffd||fffd||238||fffd||2c23|
        getDatatoExcel ASP_GET_LIST & 3 & "%05" & g_Lang, "BU2", Sheet3.Name, Sheet3
    
        
        ' |fffd||338||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|2").Delete
        Set rngTmp = .Range(.Range("BR2:BS2"), .Range("BR2:BS2").End(xlDown))
        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|2", RefersToR1C1:=rngTmp
        
'        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|2_1").Delete
'        Set rngTmp = .Range(.Range("CT2:CV2"), .Range("CT2:CV2").End(xlDown))
'        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|2_1", RefersToR1C1:=rngTmp
        
    '-----------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
    '-----------------------
        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set rngList = .Range(.Range("BR2"), .Range("BR2").End(xlDown))
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        
        .cboPrdBRK.ListFillRange = rngList2.Address
        .cboPrdBRK.ListIndex = 0
    
    
        '|fffd||fffd||238||fffd||2c23|
        Set rngList = .Range(.Range("BU2"), .Range("BU2").End(xlDown))
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        
        .cboStrYY.ListFillRange = rngList2.Address
        .cboStrYY.ListIndex = 2
        
        .cboEndYY.ListFillRange = rngList2.Address
        .cboEndYY.ListIndex = 0
        
    End With
    
End Function

Public Function SetDetail()
Dim rngList     As Range
Dim rngList2    As Range
    
    With Sheet4
        .Activate
        
        If .Range("AA4").Value = "ENG" Then
            g_Lang = "E"
        Else
            g_Lang = "K"
        End If
        
    '-----------------------
    'Raw Data
    '-----------------------
        .Range("BI2:BK200").ClearContents
        .Range("BP2:BS50").ClearContents
        .Rows("36:137").EntireRow.Hidden = False
        
        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        getDatatoExcel ASP_GET_LIST & 8 & "%05" & g_Lang, "BI3", Sheet4.Name, Sheet4
        If g_Lang = "E" Then
            .Range("BI2").Value = "All Institution"
        Else
            .Range("BI2").Value = "|fffd||fffd||fc|"
        End If
        
        .Range("BJ2").Value = "ALL"
        
'        cboDeBRK.ListIndex = iBRKIdx
'        sBRK_NM = .Range("AB1").Value
        
        ' |fffd||537||fffd| |fffd||fffd||fffd||fffd|
        getDatatoExcel ASP_GET_LIST & 6 & "%05" & g_Lang, "BP2", Sheet4.Name, Sheet4
        
        ' |fffd||537||bd||fffd||fffd||fffd|(MIN, MAX)
        getDatatoExcel ASP_GET_LIST & 2 & "%05" & g_Lang, "BR2", Sheet4.Name, Sheet4
        
        
        ' |fffd||338||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|3").Delete
        Set rngTmp = Range(Range("BI2:BJ2"), Range("BI2:BJ2").End(xlDown))
        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|3", RefersToR1C1:=rngTmp
        
'        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|3_1").Delete
'        Set rngTmp = Range(Range("BJ2:BK2"), Range("BJ2:BK2").End(xlDown))
'        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|3_1", RefersToR1C1:=rngTmp

    '-----------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
    '-----------------------
        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        .Activate
        Set rngList = .Range(.Range("BI2"), .Range("BI2").End(xlDown))
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        
        .cboDeBRK.ListFillRange = rngList2.Address
        .cboDeBRK.ListIndex = 0
            
            
        '|fffd||537||bd||f1||fffd|
        '  |fffd||fffd|
        Set rngList = .Range(.Range("BP2"), .Range("BP2").End(xlDown))
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        .cboDeBaseY.ListFillRange = rngList2.Address
        .cboDeBaseY.ListIndex = 0
        .cboDeBaseM.ListIndex = 0
        
    End With

    
End Function

Public Function SetMonth()
Dim rngList     As Range
Dim rngList3    As Range
    
    With Sheet5
        .Activate
        
        If .Range("AA4").Value = "ENG" Then
            g_Lang = "E"
        Else
            g_Lang = "K"
        End If
        
    '-----------------------
    'Raw Data
    '-----------------------
        .Range("BA2:BB200").ClearContents
        .Rows("20:56").EntireRow.Hidden = False
        
        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        getDatatoExcel ASP_GET_LIST & 8 & "%05" & g_Lang, "BA3", Sheet5.Name, Sheet5
        If g_Lang = "E" Then
            .Range("BA2").Value = "All Institution"
        Else
            .Range("BA2").Value = "|fffd||fffd||fc|"
        End If
        
        .Range("BB2").Value = "ALL"
        
        
        ' |fffd||338||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|4").Delete
        Set rngTmp = .Range(.Range("BA2:BB2"), .Range("BA2:BB2").End(xlDown))
        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|4", RefersToR1C1:=rngTmp

    '-----------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
    '-----------------------
        Set rngList = .Range(.Range("BA2"), .Range("BA2").End(xlDown))
        Set rngList3 = .Range(rngList, rngList.End(xlDown))
        
        .cboMmBRK.ListFillRange = rngList3.Address
        .cboMmBRK.ListIndex = 0

    End With

End Function


Public Function SetTrend()
Dim rngList     As Range
Dim rngList3    As Range
Dim sTERM       As String
Dim sTerm_T     As String
    
    With Sheet6
        .Activate
        
        If .Range("AA4") = "ENG" Then
            g_Lang = "E"
        Else
            g_Lang = "K"
        End If
        sTERM = .cboTrendTerm.Text
        
    '-----------------------
    'Raw Data
    '-----------------------
        .cboTrendBRK.ListFillRange = Range("A1")
        .Range("BA2:BB200").ClearContents
        
        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||22f||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)
        getDatatoExcel ASP_GET_LIST & 1 & "%05" & g_Lang, "BA3", Sheet6.Name, Sheet6
        If g_Lang = "E" Then
            .Range("BA2").Value = "All Institution"
        Else
            .Range("BA2").Value = "|fffd||fffd||fc|"
        End If
        
        .Range("BB2").Value = "ALL"

        
'        If sTERM = "M" Then
            ' |fffd||fffd||238||fffd||2c23|
            .Range("BP2:BP200").ClearContents
            If g_Lang = "K" Then
                getDatatoExcel ASP_GET_LIST & 24 & "%05" & g_Lang, "BP2", Sheet6.Name, Sheet6
            Else
                getDatatoExcel ASP_GET_LIST & 20 & "%05" & g_Lang, "BP2", Sheet6.Name, Sheet6
                .Range("BQ2").Formula = "=LEFT(BP2,7)"
                
                iCnt = Range(Range("BP2"), Range("BP2").End(xlDown)).Count
                Range("BQ2").AutoFill Destination:=Range("BQ2:BQ" & 1 + iCnt)
            End If
'        Else
            ' |fffd||fffd||fffd||fffd||fffd||fffd|
            If sTERM = "M" Then
                sTerm_T = "Q"
            Else
                sTerm_T = sTERM
            End If
            
            .Range("BN2:BN200").ClearContents
            If sTerm_T = "Q" Then
                getDatatoExcel ASP_GET_LIST & 21 & "%05" & g_Lang, "BN2", Sheet6.Name, Sheet6
            ElseIf sTerm_T = "H" Then
                getDatatoExcel ASP_GET_LIST & 22 & "%05" & g_Lang, "BN2", Sheet6.Name, Sheet6
            Else
                getDatatoExcel ASP_GET_LIST & 23 & "%05" & g_Lang, "BN2", Sheet6.Name, Sheet6
            End If
'        End If
        
        
        
        ' |fffd||338||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|5").Delete
        Set rngTmp = .Range(.Range("BA2:BB2"), .Range("BA2:BB2").End(xlDown))
        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|5", RefersToR1C1:=rngTmp
        
        ActiveWorkbook.Names("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|5_1").Delete
        Set rngTmp = .Range(.Range("BB2:BC2"), .Range("BB2:BC2").End(xlDown))
        ActiveWorkbook.Names.Add Name:="|fffd||fffd||fffd||fffd||fffd||fffd||fffd|5_1", RefersToR1C1:=rngTmp

    '-----------------------
    ' |fffd||7ba||fffd||fffd||6bd||fffd| |fffd||fffd||fffd||fffd|
    '-----------------------
        ' |fffd||fffd||fb||fffd||fffd||fffd|
        Set rngList = .Range(.Range("BA2"), .Range("BA2").End(xlDown))
        Set rngList3 = .Range(rngList, rngList.End(xlDown))
        
        .cboTrendBRK.ListFillRange = rngList3.Address
        .cboTrendBRK.ListIndex = 0
        
        ' |fffd||fffd||1e5|
        If sTERM = "M" Then
            .cboTrendJipyo.ListFillRange = .Range("|fffd||fffd||1e5|6_M").Address
        ElseIf sTERM = "H" Then
            .cboTrendJipyo.ListFillRange = .Range("|fffd||fffd||1e5|6_H").Address
        Else
            .cboTrendJipyo.ListFillRange = .Range("|fffd||fffd||1e5|6_QY").Address
        End If

        ' |fffd||fffd||238||fffd||2c23|
        If g_Lang = "K" Then
            Set rngList = .Range(.Range("BP2"), .Range("BP2").End(xlDown))
        Else
            Set rngList = .Range(.Range("BQ2"), .Range("BQ2").End(xlDown))
        End If
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        
        .cboTrendStr.ListFillRange = rngList2.Address
        .cboTrendEnd.ListFillRange = rngList2.Address
        .cboTrendStr.ListIndex = 0
        .cboTrendEnd.ListIndex = .cboTrendEnd.ListCount - 1

        ' |fffd||fffd||fffd||fffd||fffd||fffd|
        Set rngList = .Range(.Range("BN2"), .Range("BN2").End(xlDown))
        Set rngList2 = .Range(rngList, rngList.End(xlDown))
        
        .cboTrendTarget.ListFillRange = rngList2.Address
        .cboTrendTarget.ListIndex = .cboTrendTarget.ListCount - 2


    End With

End Function


Public Sub getDatatoExcel(parmUrl As String, parmRange As String, parmSheetName As String, sSheet As Object)
    
Dim QT As QueryTable
Dim QN As Name
    
    Set QT = sSheet.QueryTables.Add(Connection:=parmUrl, Destination:=Range(parmRange))
    With QT
        .Name = "WISEfnExtWebData"
        .FieldNames = True
        .RowNumbers = False
        .FillAdjacentFormulas = False
        .PreserveFormatting = True
        .RefreshOnFileOpen = False
        .BackgroundQuery = False
        .RefreshStyle = xlOverwriteCells
        .SavePassword = False
        .SaveData = False
        .AdjustColumnWidth = False
        .RefreshPeriod = 0
        .WebSelectionType = xlAllTables
        .WebFormatting = xlWebFormattingNone
        .WebPreFormattedTextToColumns = True
        .WebConsecutiveDelimitersAsOne = True
        .WebSingleBlockTextImport = False
        .WebDisableDateRecognition = False
        .Refresh BackgroundQuery:=False
        
    End With
    QT.Delete
    
End Sub






Attribute VB_Name = "mdlRun"
Public g_Main As Boolean
Public g_Lang As String

Public Sub Test()
Dim vCondi() As Variant
    
    ReDim Preserve vCondi(4, 2)
    vCondi(4, 0) = "1"
    vCondi(4, 2) = "1|05|3|05|2|05|13|05|14"
    Call SetTemplate(0, vCondi, "E")

End Sub

Public Sub SetTemplate(iBRK As Integer, vCondi As Variant, sLanguage As String)
Dim i, j        As Integer
Dim vSheet      As Variant
Dim vCombo      As Variant
Dim vTmp        As Variant

On Error GoTo ErrRaised:

    g_Lang = sLanguage
    Debug.Print g_Lang

    '|fffd||fffd||1ae| |fffd||fffd||fffd||fffd||fffd|
    Sheet1.Visible = xlSheetVisible
    Sheet2.Visible = xlSheetHidden
    Sheet3.Visible = xlSheetHidden
    Sheet4.Visible = xlSheetHidden
    Sheet5.Visible = xlSheetHidden
    Sheet6.Visible = xlSheetHidden
    
    For i = 0 To UBound(vCondi)
        If vCondi(i, 0) = "1" Then
            If i = 0 Then
                Sheet2.Visible = xlSheetVisible
                If g_Lang = "K" Then
                    Sheet2.Name = "|fffd||5bf||fffd||fffd||fffd||1e5|"
                Else
                    Sheet2.Name = "Main Indicator"
                End If
                
            ElseIf i = 1 Then
                Sheet3.Visible = xlSheetVisible
                If g_Lang = "K" Then
                    Sheet3.Name = "|fffd||2c23||fffd||fffd| |fffd||5bf||fffd||fffd||fffd||1e5|"
                Else
                    Sheet3.Name = "Periodical Main Indicator"
                End If
                
            ElseIf i = 2 Then
                Sheet4.Visible = xlSheetVisible
                If g_Lang = "K" Then
                    Sheet4.Name = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                Else
                    Sheet4.Name = "Detailed Consensus List"
                End If
                
            ElseIf i = 3 Then
                Sheet5.Visible = xlSheetVisible
                If g_Lang = "K" Then
                    Sheet5.Name = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
                Else
                    Sheet5.Name = "Monthly Consensus List"
                End If
                
            ElseIf i = 4 Then
                Sheet6.Visible = xlSheetVisible
                If g_Lang = "K" Then
                    Sheet6.Name = "|fffd||fffd||169||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |1ae||fffd||fffd||fffd||fffd|"
                Else
                    Sheet6.Name = "MacroConsensus Trend"
                End If
                
            End If
        End If
    Next

    Sheet1.Visible = xlSheetHidden
        
    '|fffd||fffd||238||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|(|fffd||7ba||fffd||fffd||6bd||fffd|)
    For i = 0 To UBound(vCondi)
        If vCondi(i, 0) = "1" Then
        
            Select Case i
                ' |fffd||5bf||fffd||fffd||fffd||1e5|
                Case "0"
                
                    If g_Lang = "K" Then
                        Sheet2.Range("AA2").Value = "KOR"
                    Else
                        Sheet2.Range("AA2").Value = "ENG"
                    End If
                    Call SetJiPyo

                    vTmp = Split(vCondi(0, 2), Chr(5))
                    Sheet2.cboBRK.ListIndex = iBRK
                    
                    Sheet2.cboBaseY.ListIndex = vTmp(0)
                    Sheet2.cboBaseM.ListIndex = vTmp(1)

                    Call Sheet2.CommandButton1_Click
                    
                '|fffd||2c23||fffd||fffd| |fffd||5bf||fffd||fffd||fffd||1e5|
                Case "1"
                    
                    If g_Lang = "K" Then
                        Sheet3.Range("CA2").Value = "KOR"
                    Else
                        Sheet3.Range("CA2").Value = "ENG"
                    End If
                    Call SetP_JiPyo
                    
                    vTmp = Split(vCondi(1, 2), Chr(5))
                        
                    Sheet3.cboPrdBRK.ListIndex = iBRK
                    Sheet3.cboStrYY.ListIndex = vTmp(0)
                    Sheet3.cboEndYY.ListIndex = vTmp(1)

                    Call Sheet3.CommandButton1_Click
                    
                '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                Case "2"

                    If g_Lang = "K" Then
                        Sheet4.Range("AA4").Value = "KOR"
                    Else
                        Sheet4.Range("AA4").Value = "ENG"
                    End If
                    Call SetDetail
                    
                    vTmp = Split(vCondi(2, 2), Chr(5))
                    
                    Sheet4.cboDeBRK.ListIndex = iBRK
                    Sheet4.cboJiPyo.ListIndex = vTmp(0)
                    
                    Sheet4.cboDeBaseY.ListIndex = vTmp(1)
                    Sheet4.cboDeBaseM.ListIndex = vTmp(2)
                    
                    Call Sheet4.CommandButton1_Click
                    
                '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                Case "3"

                    If g_Lang = "K" Then
                        Sheet5.Range("AA4").Value = "KOR"
                    Else
                        Sheet5.Range("AA4").Value = "ENG"
                    End If
                    Call SetMonth
                    
                    vTmp = Split(vCondi(3, 2), Chr(5))
                    
                    Sheet5.cboMmBRK.ListIndex = iBRK
                    Sheet5.cboMmJiPyo.ListIndex = vTmp(0)

                    Call Sheet5.CommandButton1_Click
                    
                '|fffd||fffd||169||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |1ae||fffd||fffd||fffd||fffd|
                Case "4"

                    If g_Lang = "K" Then
                        Sheet6.Range("AA4").Value = "KOR"
                    Else
                        Sheet6.Range("AA4").Value = "ENG"
                    End If
                    
                    vTmp = Split(vCondi(4, 2), Chr(5))
                    Sheet6.cboTrendTerm.ListIndex = vTmp(0)
                    
                    Call SetTrend

                    
                    Sheet6.cboTrendBRK.ListIndex = iBRK
                    
                    Sheet6.cboTrendJipyo.ListIndex = vTmp(1)
                    If vTmp(0) = "0" Then
                        Sheet6.cboTrendTarget.ListIndex = Sheet6.cboTrendTarget.ListCount - 2
                    Else
                        Sheet6.cboTrendTarget.ListIndex = vTmp(2)
                    End If
                    Sheet6.cboTrendStr.ListIndex = vTmp(3)
                    Sheet6.cboTrendEnd.ListIndex = vTmp(4)

                    Call Sheet6.CommandButton1_Click
                    
            End Select

        End If
    Next

ErrRaised:
'    Resume
    
End Sub




Attribute VB_Name = "|fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd|"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Private bBackgroundChecking As Boolean

Private Sub Workbook_Open()
    bBackgroundChecking = Application.ErrorCheckingOptions.BackgroundChecking
    
    If bBackgroundChecking = True Then Application.ErrorCheckingOptions.BackgroundChecking = Not bBackgroundChecking
    
End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
    If Cancel = False Then Application.ErrorCheckingOptions.BackgroundChecking = bBackgroundChecking
    
End Sub



INQUEST-PP=macro
